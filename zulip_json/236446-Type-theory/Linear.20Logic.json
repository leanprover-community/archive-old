[
    {
        "content": "<p>My question is really about the cases tactic and inductive definitions, but I'm making this thread to contain whatever further discussion might arise.</p>\n<p>My expectation is that I should be able to close the first goal with <code>cases s₂</code>, so it realises that <code>Ci</code> must be <code>Bi</code></p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"n\">ps</span><span class=\"o\">:</span> <span class=\"n\">proof_structure</span>\n<span class=\"n\">S</span><span class=\"o\">:</span> <span class=\"n\">switching</span>\n<span class=\"n\">AiBiCi</span><span class=\"o\">:</span> <span class=\"n\">Form_occ</span>\n<span class=\"n\">hA</span><span class=\"o\">:</span> <span class=\"n\">Ai</span> <span class=\"bp\">∈</span> <span class=\"n\">ps.form_occs</span>\n<span class=\"n\">hB</span><span class=\"o\">:</span> <span class=\"n\">Bi</span> <span class=\"bp\">∈</span> <span class=\"n\">ps.form_occs</span>\n<span class=\"n\">hC</span><span class=\"o\">:</span> <span class=\"n\">Ci</span> <span class=\"bp\">∈</span> <span class=\"n\">ps.form_occs</span>\n<span class=\"n\">d₃</span><span class=\"o\">:</span> <span class=\"n\">dir</span>\n<span class=\"n\">s₂</span><span class=\"o\">:</span> <span class=\"n\">steps</span> <span class=\"o\">(</span><span class=\"n\">S</span> <span class=\"o\">(</span><span class=\"n\">Link.ax</span> <span class=\"n\">Ai.snd</span> <span class=\"n\">Bi.snd</span> <span class=\"n\">Ai.fst</span><span class=\"o\">))</span> <span class=\"o\">(</span><span class=\"n\">Link.ax</span> <span class=\"n\">Ai.snd</span> <span class=\"n\">Bi.snd</span> <span class=\"n\">Ai.fst</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">Ai</span><span class=\"o\">,</span> <span class=\"n\">tt</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">Ci</span><span class=\"o\">,</span> <span class=\"n\">d₃</span><span class=\"o\">)</span>\n<span class=\"n\">s₁</span><span class=\"o\">:</span> <span class=\"n\">steps</span> <span class=\"o\">(</span><span class=\"n\">S</span> <span class=\"o\">(</span><span class=\"n\">Link.ax</span> <span class=\"n\">Ai.snd</span> <span class=\"n\">Bi.snd</span> <span class=\"n\">Ai.fst</span><span class=\"o\">))</span> <span class=\"o\">(</span><span class=\"n\">Link.ax</span> <span class=\"n\">Ai.snd</span> <span class=\"n\">Bi.snd</span> <span class=\"n\">Ai.fst</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">Ai</span><span class=\"o\">,</span> <span class=\"n\">tt</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">Bi</span><span class=\"o\">,</span> <span class=\"n\">ff</span><span class=\"o\">)</span>\n<span class=\"bp\">⊢</span> <span class=\"n\">Bi</span> <span class=\"bp\">=</span> <span class=\"n\">Ci</span> <span class=\"bp\">∧</span> <span class=\"n\">ff</span> <span class=\"bp\">=</span> <span class=\"n\">d₃</span>\n</code></pre></div>\n<p>however when I do this, I get <code>cases tactic failed, unsupported equality between type and constructor indices\n(only equalities between constructors and/or variables are supported, try cases on the indices):\nAi.snd = s₂_Ai.snd</code></p>\n<p>Could someone explain what this means and how to overcome it? Here's my mwe</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kn\">import</span> <span class=\"n\">tactic</span>\n\n<span class=\"kd\">inductive</span> <span class=\"n\">Form</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span>\n<span class=\"bp\">|</span> <span class=\"n\">atom</span> <span class=\"o\">:</span> <span class=\"n\">ℕ</span> <span class=\"bp\">→</span> <span class=\"n\">Form</span>\n<span class=\"bp\">|</span> <span class=\"n\">tensor</span> <span class=\"o\">:</span> <span class=\"n\">Form</span> <span class=\"bp\">→</span> <span class=\"n\">Form</span> <span class=\"bp\">→</span> <span class=\"n\">Form</span>\n<span class=\"bp\">|</span> <span class=\"n\">par</span> <span class=\"o\">:</span> <span class=\"n\">Form</span> <span class=\"bp\">→</span> <span class=\"n\">Form</span> <span class=\"bp\">→</span> <span class=\"n\">Form</span>\n<span class=\"bp\">|</span> <span class=\"n\">neg</span> <span class=\"o\">:</span> <span class=\"n\">Form</span> <span class=\"bp\">→</span> <span class=\"n\">Form</span>\n\n<span class=\"kd\">infix</span> <span class=\"bp\">`</span> <span class=\"bp\">⊗</span> <span class=\"bp\">`</span><span class=\"o\">:</span><span class=\"mi\">70</span> <span class=\"o\">:=</span> <span class=\"n\">Form.tensor</span>\n<span class=\"kd\">infix</span> <span class=\"bp\">`</span> <span class=\"n\">⅋</span> <span class=\"bp\">`</span><span class=\"o\">:</span><span class=\"mi\">65</span> <span class=\"o\">:=</span> <span class=\"n\">Form.par</span>\n<span class=\"kd\">prefix</span> <span class=\"bp\">`~`</span> <span class=\"o\">:=</span> <span class=\"n\">Form.neg</span>\n\n<span class=\"kd\">inductive</span> <span class=\"n\">Link</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span>\n<span class=\"bp\">|</span> <span class=\"n\">ax</span> <span class=\"o\">:</span> <span class=\"n\">ℕ</span> <span class=\"bp\">→</span> <span class=\"n\">ℕ</span> <span class=\"bp\">→</span> <span class=\"n\">Form</span> <span class=\"bp\">→</span> <span class=\"n\">Link</span>\n<span class=\"bp\">|</span> <span class=\"n\">cut</span> <span class=\"o\">:</span> <span class=\"n\">ℕ</span> <span class=\"bp\">→</span> <span class=\"n\">ℕ</span> <span class=\"bp\">→</span> <span class=\"n\">Form</span> <span class=\"bp\">→</span> <span class=\"n\">Link</span>\n<span class=\"bp\">|</span> <span class=\"n\">tensor</span> <span class=\"o\">:</span> <span class=\"n\">ℕ</span> <span class=\"bp\">→</span> <span class=\"n\">ℕ</span> <span class=\"bp\">→</span> <span class=\"n\">ℕ</span> <span class=\"bp\">→</span> <span class=\"n\">Form</span> <span class=\"bp\">→</span> <span class=\"n\">Form</span> <span class=\"bp\">→</span> <span class=\"n\">Link</span>\n<span class=\"bp\">|</span> <span class=\"n\">par</span> <span class=\"o\">:</span> <span class=\"n\">ℕ</span> <span class=\"bp\">→</span> <span class=\"n\">ℕ</span> <span class=\"bp\">→</span> <span class=\"n\">ℕ</span> <span class=\"bp\">→</span> <span class=\"n\">Form</span> <span class=\"bp\">→</span> <span class=\"n\">Form</span> <span class=\"bp\">→</span> <span class=\"n\">Link</span>\n<span class=\"bp\">|</span> <span class=\"n\">con</span> <span class=\"o\">:</span> <span class=\"n\">ℕ</span> <span class=\"bp\">→</span> <span class=\"n\">Form</span> <span class=\"bp\">→</span> <span class=\"n\">Link</span>\n\n<span class=\"kd\">def</span> <span class=\"n\">Form_occ</span> <span class=\"o\">:=</span> <span class=\"n\">Form</span> <span class=\"bp\">×</span> <span class=\"n\">ℕ</span>\n\n<span class=\"kd\">def</span> <span class=\"n\">is_premise</span> <span class=\"o\">(</span><span class=\"n\">Ai</span> <span class=\"o\">:</span> <span class=\"n\">Form_occ</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">Link</span> <span class=\"bp\">→</span> <span class=\"kt\">Prop</span>\n<span class=\"bp\">|</span> <span class=\"o\">(</span><span class=\"n\">Link.ax</span> <span class=\"n\">n</span> <span class=\"n\">m</span> <span class=\"n\">B</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"n\">false</span>\n<span class=\"bp\">|</span> <span class=\"o\">(</span><span class=\"n\">Link.cut</span> <span class=\"n\">n</span> <span class=\"n\">m</span> <span class=\"n\">B</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"o\">(</span><span class=\"n\">Ai</span> <span class=\"bp\">=</span> <span class=\"o\">⟨</span><span class=\"n\">B</span><span class=\"o\">,</span><span class=\"n\">n</span><span class=\"o\">⟩)</span> <span class=\"bp\">∨</span> <span class=\"o\">(</span><span class=\"n\">Ai</span> <span class=\"bp\">=</span> <span class=\"o\">⟨</span><span class=\"bp\">~</span><span class=\"n\">B</span><span class=\"o\">,</span><span class=\"n\">m</span><span class=\"o\">⟩)</span>\n<span class=\"bp\">|</span> <span class=\"o\">(</span><span class=\"n\">Link.tensor</span> <span class=\"n\">n</span> <span class=\"n\">m</span> <span class=\"n\">k</span> <span class=\"n\">A</span> <span class=\"n\">B</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"o\">(</span><span class=\"n\">Ai</span> <span class=\"bp\">=</span> <span class=\"o\">⟨</span><span class=\"n\">A</span><span class=\"o\">,</span><span class=\"n\">n</span><span class=\"o\">⟩)</span> <span class=\"bp\">∨</span> <span class=\"o\">(</span><span class=\"n\">Ai</span> <span class=\"bp\">=</span> <span class=\"o\">⟨</span><span class=\"n\">B</span><span class=\"o\">,</span><span class=\"n\">m</span><span class=\"o\">⟩)</span>\n<span class=\"bp\">|</span> <span class=\"o\">(</span><span class=\"n\">Link.par</span> <span class=\"n\">n</span> <span class=\"n\">m</span> <span class=\"n\">k</span> <span class=\"n\">A</span> <span class=\"n\">B</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"o\">(</span><span class=\"n\">Ai</span> <span class=\"bp\">=</span> <span class=\"o\">⟨</span><span class=\"n\">A</span><span class=\"o\">,</span><span class=\"n\">n</span><span class=\"o\">⟩)</span> <span class=\"bp\">∨</span> <span class=\"o\">(</span><span class=\"n\">Ai</span> <span class=\"bp\">=</span> <span class=\"o\">⟨</span><span class=\"n\">B</span><span class=\"o\">,</span><span class=\"n\">m</span><span class=\"o\">⟩)</span>\n<span class=\"bp\">|</span> <span class=\"o\">(</span><span class=\"n\">Link.con</span> <span class=\"n\">n</span> <span class=\"n\">A</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"n\">Ai</span> <span class=\"bp\">=</span> <span class=\"o\">⟨</span><span class=\"n\">A</span><span class=\"o\">,</span><span class=\"n\">n</span><span class=\"o\">⟩</span>\n\n<span class=\"kd\">def</span> <span class=\"n\">is_conclusion</span> <span class=\"o\">(</span><span class=\"n\">Ai</span> <span class=\"o\">:</span> <span class=\"n\">Form_occ</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">Link</span> <span class=\"bp\">→</span> <span class=\"kt\">Prop</span>\n<span class=\"bp\">|</span> <span class=\"o\">(</span><span class=\"n\">Link.ax</span> <span class=\"n\">n</span> <span class=\"n\">m</span> <span class=\"n\">B</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"o\">(</span><span class=\"n\">Ai</span> <span class=\"bp\">=</span> <span class=\"o\">⟨</span><span class=\"n\">B</span><span class=\"o\">,</span><span class=\"n\">n</span><span class=\"o\">⟩)</span> <span class=\"bp\">∨</span> <span class=\"o\">(</span><span class=\"n\">Ai</span> <span class=\"bp\">=</span> <span class=\"o\">⟨</span><span class=\"bp\">~</span><span class=\"n\">B</span><span class=\"o\">,</span><span class=\"n\">m</span><span class=\"o\">⟩)</span>\n<span class=\"bp\">|</span> <span class=\"o\">(</span><span class=\"n\">Link.cut</span> <span class=\"n\">n</span> <span class=\"n\">m</span> <span class=\"n\">B</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"n\">false</span>\n<span class=\"bp\">|</span> <span class=\"o\">(</span><span class=\"n\">Link.tensor</span> <span class=\"n\">n</span> <span class=\"n\">m</span> <span class=\"n\">k</span> <span class=\"n\">A</span> <span class=\"n\">B</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"n\">Ai</span> <span class=\"bp\">=</span> <span class=\"o\">⟨</span><span class=\"n\">A</span> <span class=\"bp\">⊗</span> <span class=\"n\">B</span><span class=\"o\">,</span><span class=\"n\">k</span><span class=\"o\">⟩</span>\n<span class=\"bp\">|</span> <span class=\"o\">(</span><span class=\"n\">Link.par</span> <span class=\"n\">n</span> <span class=\"n\">m</span> <span class=\"n\">k</span> <span class=\"n\">A</span> <span class=\"n\">B</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"n\">Ai</span> <span class=\"bp\">=</span> <span class=\"o\">⟨</span><span class=\"n\">A</span> <span class=\"n\">⅋</span> <span class=\"n\">B</span><span class=\"o\">,</span><span class=\"n\">k</span><span class=\"o\">⟩</span>\n<span class=\"bp\">|</span> <span class=\"o\">(</span><span class=\"n\">Link.con</span> <span class=\"n\">n</span> <span class=\"n\">A</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"n\">false</span>\n\n<span class=\"kd\">structure</span> <span class=\"n\">proof_structure</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span> <span class=\"o\">:=</span>\n<span class=\"o\">(</span><span class=\"n\">links</span> <span class=\"o\">:</span> <span class=\"n\">set</span> <span class=\"n\">Link</span><span class=\"o\">)</span>\n<span class=\"o\">(</span><span class=\"n\">form_occs</span> <span class=\"o\">:</span> <span class=\"n\">set</span> <span class=\"n\">Form_occ</span><span class=\"o\">)</span>\n<span class=\"o\">(</span><span class=\"n\">link_prem</span> <span class=\"o\">:</span> <span class=\"bp\">∀</span> <span class=\"n\">l</span> <span class=\"bp\">∈</span> <span class=\"n\">links</span><span class=\"o\">,</span> <span class=\"bp\">∀</span> <span class=\"n\">Ai</span> <span class=\"o\">:</span> <span class=\"n\">Form_occ</span><span class=\"o\">,</span> <span class=\"n\">is_premise</span> <span class=\"n\">Ai</span> <span class=\"n\">l</span> <span class=\"bp\">→</span> <span class=\"n\">Ai</span> <span class=\"bp\">∈</span> <span class=\"n\">form_occs</span><span class=\"o\">)</span>\n<span class=\"o\">(</span><span class=\"n\">link_con</span> <span class=\"o\">:</span> <span class=\"bp\">∀</span> <span class=\"n\">l</span> <span class=\"bp\">∈</span> <span class=\"n\">links</span><span class=\"o\">,</span> <span class=\"bp\">∀</span> <span class=\"n\">Ai</span> <span class=\"o\">:</span> <span class=\"n\">Form_occ</span><span class=\"o\">,</span> <span class=\"n\">is_conclusion</span> <span class=\"n\">Ai</span> <span class=\"n\">l</span> <span class=\"bp\">→</span> <span class=\"n\">Ai</span> <span class=\"bp\">∈</span> <span class=\"n\">form_occs</span><span class=\"o\">)</span>\n<span class=\"o\">(</span><span class=\"n\">premise</span> <span class=\"o\">:</span> <span class=\"n\">Form_occ</span> <span class=\"bp\">→</span> <span class=\"n\">Link</span><span class=\"o\">)</span>\n<span class=\"o\">(</span><span class=\"n\">prem_unique</span> <span class=\"o\">:</span> <span class=\"bp\">∀</span> <span class=\"n\">Ai</span> <span class=\"bp\">∈</span> <span class=\"n\">form_occs</span><span class=\"o\">,</span> <span class=\"bp\">∀</span> <span class=\"n\">l</span> <span class=\"bp\">∈</span> <span class=\"n\">links</span><span class=\"o\">,</span> <span class=\"n\">is_premise</span> <span class=\"n\">Ai</span> <span class=\"n\">l</span> <span class=\"bp\">→</span> <span class=\"n\">premise</span> <span class=\"n\">Ai</span> <span class=\"bp\">=</span> <span class=\"n\">l</span><span class=\"o\">)</span>\n<span class=\"o\">(</span><span class=\"n\">prem_range</span> <span class=\"o\">:</span> <span class=\"bp\">∀</span> <span class=\"n\">Ai</span> <span class=\"bp\">∈</span> <span class=\"n\">form_occs</span><span class=\"o\">,</span> <span class=\"n\">premise</span> <span class=\"n\">Ai</span> <span class=\"bp\">∈</span> <span class=\"n\">links</span> <span class=\"bp\">∧</span> <span class=\"n\">is_premise</span> <span class=\"n\">Ai</span> <span class=\"o\">(</span><span class=\"n\">premise</span> <span class=\"n\">Ai</span><span class=\"o\">))</span>\n<span class=\"o\">(</span><span class=\"n\">conclusion</span> <span class=\"o\">:</span> <span class=\"n\">Form_occ</span> <span class=\"bp\">→</span> <span class=\"n\">Link</span><span class=\"o\">)</span>\n<span class=\"o\">(</span><span class=\"n\">con_unique</span> <span class=\"o\">:</span> <span class=\"bp\">∀</span> <span class=\"n\">Ai</span> <span class=\"bp\">∈</span> <span class=\"n\">form_occs</span><span class=\"o\">,</span> <span class=\"bp\">∀</span> <span class=\"n\">l</span> <span class=\"bp\">∈</span> <span class=\"n\">links</span><span class=\"o\">,</span> <span class=\"n\">is_conclusion</span> <span class=\"n\">Ai</span> <span class=\"n\">l</span> <span class=\"bp\">→</span> <span class=\"n\">conclusion</span> <span class=\"n\">Ai</span> <span class=\"bp\">=</span> <span class=\"n\">l</span><span class=\"o\">)</span>\n<span class=\"o\">(</span><span class=\"n\">con_range</span> <span class=\"o\">:</span> <span class=\"bp\">∀</span> <span class=\"n\">Ai</span> <span class=\"bp\">∈</span> <span class=\"n\">form_occs</span><span class=\"o\">,</span> <span class=\"n\">conclusion</span> <span class=\"n\">Ai</span> <span class=\"bp\">∈</span> <span class=\"n\">links</span> <span class=\"bp\">∧</span> <span class=\"n\">is_conclusion</span> <span class=\"n\">Ai</span> <span class=\"o\">(</span><span class=\"n\">conclusion</span> <span class=\"n\">Ai</span><span class=\"o\">))</span>\n\n<span class=\"kd\">@[reducible]</span>\n<span class=\"kd\">def</span> <span class=\"n\">dir</span> <span class=\"o\">:=</span> <span class=\"n\">bool</span>\n\n<span class=\"kd\">def</span> <span class=\"n\">down</span> <span class=\"o\">:=</span> <span class=\"n\">ff</span>\n<span class=\"kd\">def</span> <span class=\"n\">up</span> <span class=\"o\">:=</span> <span class=\"n\">tt</span>\n\n<span class=\"kd\">@[reducible]</span>\n<span class=\"kd\">def</span> <span class=\"n\">switch</span> <span class=\"o\">:=</span> <span class=\"n\">bool</span>\n\n<span class=\"kd\">def</span> <span class=\"n\">L</span> <span class=\"o\">:=</span> <span class=\"n\">ff</span>\n<span class=\"kd\">def</span> <span class=\"n\">R</span> <span class=\"o\">:=</span> <span class=\"n\">tt</span>\n\n<span class=\"kd\">def</span> <span class=\"n\">switching</span> <span class=\"o\">:=</span> <span class=\"n\">Link</span> <span class=\"bp\">→</span> <span class=\"n\">bool</span>\n\n<span class=\"kd\">inductive</span> <span class=\"n\">steps</span> <span class=\"o\">(</span><span class=\"n\">T</span> <span class=\"o\">:</span> <span class=\"n\">switch</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">Link</span> <span class=\"bp\">→</span> <span class=\"n\">Form_occ</span> <span class=\"bp\">×</span> <span class=\"n\">dir</span> <span class=\"bp\">→</span> <span class=\"n\">Form_occ</span> <span class=\"bp\">×</span> <span class=\"n\">dir</span> <span class=\"bp\">→</span> <span class=\"kt\">Prop</span>\n<span class=\"bp\">|</span> <span class=\"n\">ax</span> <span class=\"o\">(</span><span class=\"n\">Ai</span> <span class=\"n\">Bi</span> <span class=\"o\">:</span> <span class=\"n\">Form_occ</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">steps</span> <span class=\"o\">(</span><span class=\"n\">Link.ax</span> <span class=\"n\">Ai.2</span> <span class=\"n\">Bi.2</span> <span class=\"n\">Ai.1</span><span class=\"o\">)</span> <span class=\"o\">⟨</span><span class=\"n\">Ai</span><span class=\"o\">,</span> <span class=\"n\">up</span><span class=\"o\">⟩</span> <span class=\"o\">⟨</span><span class=\"n\">Bi</span><span class=\"o\">,</span> <span class=\"n\">down</span><span class=\"o\">⟩</span>\n<span class=\"bp\">|</span> <span class=\"n\">cut</span> <span class=\"o\">(</span><span class=\"n\">Ai</span> <span class=\"n\">Bi</span> <span class=\"o\">:</span> <span class=\"n\">Form_occ</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">steps</span> <span class=\"o\">(</span><span class=\"n\">Link.cut</span> <span class=\"n\">Ai.2</span> <span class=\"n\">Bi.2</span> <span class=\"n\">Ai.1</span><span class=\"o\">)</span> <span class=\"o\">⟨</span><span class=\"n\">Ai</span><span class=\"o\">,</span> <span class=\"n\">down</span><span class=\"o\">⟩</span> <span class=\"o\">⟨</span><span class=\"n\">Bi</span><span class=\"o\">,</span> <span class=\"n\">up</span><span class=\"o\">⟩</span>\n<span class=\"bp\">|</span> <span class=\"n\">tensordown</span> <span class=\"o\">(</span><span class=\"n\">Ai</span> <span class=\"n\">Bi</span> <span class=\"n\">Ci</span> <span class=\"o\">:</span> <span class=\"n\">Form_occ</span><span class=\"o\">)</span> <span class=\"o\">:</span>\n  <span class=\"n\">steps</span> <span class=\"o\">(</span><span class=\"n\">Link.tensor</span> <span class=\"n\">Ai.2</span> <span class=\"n\">Bi.2</span> <span class=\"n\">Ci.2</span> <span class=\"n\">Ai.1</span> <span class=\"n\">Bi.1</span><span class=\"o\">)</span> <span class=\"o\">⟨</span><span class=\"k\">if</span> <span class=\"n\">T</span> <span class=\"bp\">=</span> <span class=\"n\">L</span> <span class=\"k\">then</span> <span class=\"n\">Ai</span> <span class=\"k\">else</span> <span class=\"n\">Bi</span><span class=\"o\">,</span><span class=\"n\">down</span><span class=\"o\">⟩</span> <span class=\"o\">⟨</span><span class=\"n\">Ci</span><span class=\"o\">,</span><span class=\"n\">down</span><span class=\"o\">⟩</span>\n<span class=\"bp\">|</span> <span class=\"n\">tensorturn</span> <span class=\"o\">(</span><span class=\"n\">Ai</span> <span class=\"n\">Bi</span> <span class=\"n\">Ci</span> <span class=\"o\">:</span> <span class=\"n\">Form_occ</span><span class=\"o\">)</span> <span class=\"o\">:</span>\n  <span class=\"n\">steps</span> <span class=\"o\">(</span><span class=\"n\">Link.tensor</span> <span class=\"n\">Ai.2</span> <span class=\"n\">Bi.2</span> <span class=\"n\">Ci.2</span> <span class=\"n\">Ai.1</span> <span class=\"n\">Bi.1</span><span class=\"o\">)</span> <span class=\"o\">⟨</span><span class=\"k\">if</span> <span class=\"n\">T</span> <span class=\"bp\">=</span> <span class=\"n\">L</span> <span class=\"k\">then</span> <span class=\"n\">Bi</span> <span class=\"k\">else</span> <span class=\"n\">Ai</span><span class=\"o\">,</span><span class=\"n\">down</span><span class=\"o\">⟩</span> <span class=\"o\">⟨</span><span class=\"k\">if</span> <span class=\"n\">T</span> <span class=\"bp\">=</span> <span class=\"n\">L</span> <span class=\"k\">then</span> <span class=\"n\">Ai</span> <span class=\"k\">else</span> <span class=\"n\">Bi</span><span class=\"o\">,</span><span class=\"n\">up</span><span class=\"o\">⟩</span>\n<span class=\"bp\">|</span> <span class=\"n\">tensorup</span> <span class=\"o\">(</span><span class=\"n\">Ai</span> <span class=\"n\">Bi</span> <span class=\"n\">Ci</span> <span class=\"o\">:</span> <span class=\"n\">Form_occ</span><span class=\"o\">)</span> <span class=\"o\">:</span>\n  <span class=\"n\">steps</span> <span class=\"o\">(</span><span class=\"n\">Link.tensor</span> <span class=\"n\">Ai.2</span> <span class=\"n\">Bi.2</span> <span class=\"n\">Ci.2</span> <span class=\"n\">Ai.1</span> <span class=\"n\">Bi.1</span><span class=\"o\">)</span> <span class=\"o\">⟨</span><span class=\"n\">Ci</span><span class=\"o\">,</span><span class=\"n\">up</span><span class=\"o\">⟩</span> <span class=\"o\">⟨</span><span class=\"k\">if</span> <span class=\"n\">T</span> <span class=\"bp\">=</span> <span class=\"n\">L</span> <span class=\"k\">then</span> <span class=\"n\">Bi</span> <span class=\"k\">else</span> <span class=\"n\">Ai</span><span class=\"o\">,</span><span class=\"n\">up</span><span class=\"o\">⟩</span>\n<span class=\"bp\">|</span> <span class=\"n\">pardown</span> <span class=\"o\">(</span><span class=\"n\">Ai</span> <span class=\"n\">Bi</span> <span class=\"n\">Ci</span> <span class=\"o\">:</span> <span class=\"n\">Form_occ</span><span class=\"o\">)</span> <span class=\"o\">:</span>\n  <span class=\"n\">steps</span> <span class=\"o\">(</span><span class=\"n\">Link.par</span> <span class=\"n\">Ai.2</span> <span class=\"n\">Bi.2</span> <span class=\"n\">Ci.2</span> <span class=\"n\">Ai.1</span> <span class=\"n\">Bi.1</span><span class=\"o\">)</span> <span class=\"o\">⟨</span><span class=\"k\">if</span> <span class=\"n\">T</span> <span class=\"bp\">=</span> <span class=\"n\">L</span> <span class=\"k\">then</span> <span class=\"n\">Ai</span> <span class=\"k\">else</span> <span class=\"n\">Bi</span><span class=\"o\">,</span><span class=\"n\">down</span><span class=\"o\">⟩</span> <span class=\"o\">⟨</span><span class=\"n\">Ci</span><span class=\"o\">,</span><span class=\"n\">down</span><span class=\"o\">⟩</span>\n<span class=\"bp\">|</span> <span class=\"n\">parturn</span> <span class=\"o\">(</span><span class=\"n\">Ai</span> <span class=\"n\">Bi</span> <span class=\"n\">Ci</span> <span class=\"o\">:</span> <span class=\"n\">Form_occ</span><span class=\"o\">)</span> <span class=\"o\">:</span>\n  <span class=\"n\">steps</span> <span class=\"o\">(</span><span class=\"n\">Link.par</span> <span class=\"n\">Ai.2</span> <span class=\"n\">Bi.2</span> <span class=\"n\">Ci.2</span> <span class=\"n\">Ai.1</span> <span class=\"n\">Bi.1</span><span class=\"o\">)</span> <span class=\"o\">⟨</span><span class=\"k\">if</span> <span class=\"n\">T</span> <span class=\"bp\">=</span> <span class=\"n\">L</span> <span class=\"k\">then</span> <span class=\"n\">Bi</span> <span class=\"k\">else</span> <span class=\"n\">Ai</span><span class=\"o\">,</span><span class=\"n\">down</span><span class=\"o\">⟩</span> <span class=\"o\">⟨</span><span class=\"k\">if</span> <span class=\"n\">T</span> <span class=\"bp\">=</span> <span class=\"n\">L</span> <span class=\"k\">then</span> <span class=\"n\">Bi</span> <span class=\"k\">else</span> <span class=\"n\">Ai</span><span class=\"o\">,</span><span class=\"n\">up</span><span class=\"o\">⟩</span>\n<span class=\"bp\">|</span> <span class=\"n\">parup</span> <span class=\"o\">(</span><span class=\"n\">Ai</span> <span class=\"n\">Bi</span> <span class=\"n\">Ci</span> <span class=\"o\">:</span> <span class=\"n\">Form_occ</span><span class=\"o\">)</span> <span class=\"o\">:</span>\n  <span class=\"n\">steps</span> <span class=\"o\">(</span><span class=\"n\">Link.par</span> <span class=\"n\">Ai.2</span> <span class=\"n\">Bi.2</span> <span class=\"n\">Ci.2</span> <span class=\"n\">Ai.1</span> <span class=\"n\">Bi.1</span><span class=\"o\">)</span> <span class=\"o\">⟨</span><span class=\"n\">Ci</span><span class=\"o\">,</span><span class=\"n\">up</span><span class=\"o\">⟩</span> <span class=\"o\">⟨</span><span class=\"k\">if</span> <span class=\"n\">T</span> <span class=\"bp\">=</span> <span class=\"n\">L</span> <span class=\"k\">then</span> <span class=\"n\">Ai</span> <span class=\"k\">else</span> <span class=\"n\">Bi</span><span class=\"o\">,</span><span class=\"n\">up</span><span class=\"o\">⟩</span>\n\n<span class=\"kd\">def</span> <span class=\"n\">step_link</span> <span class=\"o\">(</span><span class=\"n\">ps</span> <span class=\"o\">:</span> <span class=\"n\">proof_structure</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">Ai</span> <span class=\"o\">:</span> <span class=\"n\">Form_occ</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">d</span> <span class=\"o\">:</span> <span class=\"n\">dir</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">Link</span> <span class=\"o\">:=</span>\n<span class=\"k\">if</span> <span class=\"n\">d</span> <span class=\"bp\">=</span> <span class=\"n\">up</span>\n<span class=\"k\">then</span> <span class=\"n\">ps.conclusion</span> <span class=\"n\">Ai</span>\n<span class=\"k\">else</span> <span class=\"n\">ps.premise</span> <span class=\"n\">Ai</span>\n\n<span class=\"kd\">theorem</span> <span class=\"n\">steps_unique_prev</span> <span class=\"o\">(</span><span class=\"n\">ps</span> <span class=\"o\">:</span> <span class=\"n\">proof_structure</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">S</span> <span class=\"o\">:</span> <span class=\"n\">switching</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"bp\">∀</span> <span class=\"o\">(</span><span class=\"n\">Ai</span> <span class=\"n\">Bi</span> <span class=\"n\">Ci</span> <span class=\"bp\">∈</span> <span class=\"n\">ps.form_occs</span><span class=\"o\">),</span> <span class=\"bp\">∀</span> <span class=\"o\">(</span><span class=\"n\">d₁</span> <span class=\"n\">d₂</span> <span class=\"n\">d₃</span> <span class=\"o\">:</span> <span class=\"n\">dir</span><span class=\"o\">),</span>\n  <span class=\"n\">steps</span> <span class=\"o\">(</span><span class=\"n\">S</span> <span class=\"o\">(</span><span class=\"n\">step_link</span> <span class=\"n\">ps</span> <span class=\"n\">Ai</span> <span class=\"n\">d₁</span><span class=\"o\">))</span> <span class=\"o\">(</span><span class=\"n\">step_link</span> <span class=\"n\">ps</span> <span class=\"n\">Ai</span> <span class=\"n\">d₁</span><span class=\"o\">)</span> <span class=\"o\">⟨</span><span class=\"n\">Ai</span><span class=\"o\">,</span><span class=\"n\">d₁</span><span class=\"o\">⟩</span> <span class=\"o\">⟨</span><span class=\"n\">Bi</span><span class=\"o\">,</span><span class=\"n\">d₂</span><span class=\"o\">⟩</span> <span class=\"bp\">→</span>\n  <span class=\"n\">steps</span> <span class=\"o\">(</span><span class=\"n\">S</span> <span class=\"o\">(</span><span class=\"n\">step_link</span> <span class=\"n\">ps</span> <span class=\"n\">Ai</span> <span class=\"n\">d₁</span><span class=\"o\">))</span> <span class=\"o\">(</span><span class=\"n\">step_link</span> <span class=\"n\">ps</span> <span class=\"n\">Ai</span> <span class=\"n\">d₁</span><span class=\"o\">)</span> <span class=\"o\">⟨</span><span class=\"n\">Ai</span><span class=\"o\">,</span><span class=\"n\">d₁</span><span class=\"o\">⟩</span> <span class=\"o\">⟨</span><span class=\"n\">Ci</span><span class=\"o\">,</span><span class=\"n\">d₃</span><span class=\"o\">⟩</span> <span class=\"bp\">→</span>\n  <span class=\"n\">Bi</span> <span class=\"bp\">=</span> <span class=\"n\">Ci</span> <span class=\"bp\">∧</span> <span class=\"n\">d₂</span> <span class=\"bp\">=</span> <span class=\"n\">d₃</span> <span class=\"o\">:=</span>\n<span class=\"kd\">begin</span>\n  <span class=\"n\">intros</span> <span class=\"n\">Ai</span> <span class=\"n\">Bi</span> <span class=\"n\">Ci</span> <span class=\"n\">hA</span> <span class=\"n\">hB</span> <span class=\"n\">hC</span> <span class=\"n\">d₁</span> <span class=\"n\">d₂</span> <span class=\"n\">d₃</span> <span class=\"n\">s₁</span> <span class=\"n\">s₂</span><span class=\"o\">,</span>\n  <span class=\"n\">cases</span> <span class=\"o\">(</span><span class=\"n\">step_link</span> <span class=\"n\">ps</span> <span class=\"n\">Ai</span> <span class=\"n\">d₁</span><span class=\"o\">),</span>\n  <span class=\"n\">cases</span> <span class=\"n\">s₁</span><span class=\"o\">,</span>\n  <span class=\"n\">cases</span> <span class=\"n\">s₂</span><span class=\"o\">,</span>\n\n<span class=\"kd\">end</span>\n</code></pre></div>",
        "id": 242678773,
        "sender_full_name": "Billy Price",
        "timestamp": 1623721042
    },
    {
        "content": "<p>This is being caused by the use of <code>steps (Link.tensor Ai.2 Bi.2 Ci.2 Ai.1 Bi.1)</code> et al in your <code>steps</code> inductive</p>",
        "id": 242680599,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1623723423
    },
    {
        "content": "<p>the easiest way to fix it is to case split <code>Ai Bi Ci</code> in your lemma first</p>",
        "id": 242680611,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1623723447
    },
    {
        "content": "<p>Oh the <code>Ai.1</code> stuff?</p>",
        "id": 242680693,
        "sender_full_name": "Billy Price",
        "timestamp": 1623723555
    },
    {
        "content": "<p>yes</p>",
        "id": 242680706,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1623723577
    },
    {
        "content": "<p>Could you explain why Lean is complaining about that - what equality is not supported?</p>",
        "id": 242680763,
        "sender_full_name": "Billy Price",
        "timestamp": 1623723636
    },
    {
        "content": "<p>when you do two <code>cases</code> in a row like this, lean has to figure out which step combinations are impossible because of incompatible indices, and that means that when the indices are complicated functions you can get this unhelpful error</p>",
        "id": 242680766,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1623723644
    },
    {
        "content": "<p>indices meaning any argument to an inductive constructor?</p>",
        "id": 242680795,
        "sender_full_name": "Billy Price",
        "timestamp": 1623723688
    },
    {
        "content": "<p>here's a simpler example:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kd\">constant</span> <span class=\"n\">f</span> <span class=\"o\">:</span> <span class=\"n\">ℕ</span> <span class=\"bp\">→</span> <span class=\"n\">ℕ</span>\n<span class=\"kd\">inductive</span> <span class=\"n\">foo</span> <span class=\"o\">:</span> <span class=\"n\">ℕ</span> <span class=\"bp\">→</span> <span class=\"kt\">Prop</span>\n<span class=\"bp\">|</span> <span class=\"n\">zero</span> <span class=\"o\">:</span> <span class=\"n\">foo</span> <span class=\"mi\">0</span>\n<span class=\"bp\">|</span> <span class=\"n\">foo</span> <span class=\"o\">(</span><span class=\"n\">n</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">foo</span> <span class=\"o\">(</span><span class=\"n\">f</span> <span class=\"n\">n</span><span class=\"o\">)</span>\n\n<span class=\"kd\">example</span> <span class=\"o\">(</span><span class=\"n\">a</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">h1</span> <span class=\"n\">h2</span> <span class=\"o\">:</span> <span class=\"n\">foo</span> <span class=\"n\">a</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">false</span> <span class=\"o\">:=</span>\n<span class=\"kd\">begin</span>\n  <span class=\"n\">cases</span> <span class=\"n\">h1</span><span class=\"o\">,</span>\n  <span class=\"n\">cases</span> <span class=\"n\">h2</span><span class=\"o\">,</span>\n<span class=\"kd\">end</span>\n</code></pre></div>",
        "id": 242680900,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1623723801
    },
    {
        "content": "<p>you get the same error without the <code>zero</code> constructor, that might be easier</p>",
        "id": 242680962,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1623723876
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kd\">constant</span> <span class=\"n\">f</span> <span class=\"o\">:</span> <span class=\"n\">ℕ</span> <span class=\"bp\">→</span> <span class=\"n\">ℕ</span>\n<span class=\"kd\">inductive</span> <span class=\"n\">foo</span> <span class=\"o\">:</span> <span class=\"n\">ℕ</span> <span class=\"bp\">→</span> <span class=\"kt\">Prop</span>\n<span class=\"bp\">|</span> <span class=\"n\">foo</span> <span class=\"o\">(</span><span class=\"n\">n</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">foo</span> <span class=\"o\">(</span><span class=\"n\">f</span> <span class=\"n\">n</span><span class=\"o\">)</span>\n\n<span class=\"kd\">example</span> <span class=\"o\">(</span><span class=\"n\">a</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">h1</span> <span class=\"n\">h2</span> <span class=\"o\">:</span> <span class=\"n\">foo</span> <span class=\"n\">a</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">false</span> <span class=\"o\">:=</span>\n<span class=\"kd\">begin</span>\n  <span class=\"n\">cases</span> <span class=\"n\">h1</span> <span class=\"k\">with</span> <span class=\"n\">n</span><span class=\"o\">,</span>\n  <span class=\"n\">cases</span> <span class=\"n\">h2</span> <span class=\"k\">with</span> <span class=\"n\">m</span><span class=\"o\">,</span>\n<span class=\"kd\">end</span>\n</code></pre></div>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"n\">cases</span> <span class=\"n\">tactic</span> <span class=\"n\">failed</span><span class=\"o\">,</span> <span class=\"n\">unsupported</span> <span class=\"n\">equality</span> <span class=\"n\">between</span> <span class=\"n\">type</span> <span class=\"n\">and</span> <span class=\"n\">constructor</span> <span class=\"n\">indices</span>\n<span class=\"o\">(</span><span class=\"n\">only</span> <span class=\"n\">equalities</span> <span class=\"n\">between</span> <span class=\"n\">constructors</span> <span class=\"n\">and</span><span class=\"bp\">/</span><span class=\"n\">or</span> <span class=\"kd\">variables</span> <span class=\"n\">are</span> <span class=\"n\">supported</span><span class=\"o\">,</span> <span class=\"n\">try</span> <span class=\"n\">cases</span> <span class=\"n\">on</span> <span class=\"n\">the</span> <span class=\"n\">indices</span><span class=\"o\">):</span>\n<span class=\"n\">f</span> <span class=\"n\">n</span> <span class=\"bp\">=</span> <span class=\"n\">f</span> <span class=\"n\">m</span>\n</code></pre></div>",
        "id": 242680969,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1623723901
    },
    {
        "content": "<p>the problem is that cases wants to prove that both cases apply, so <code>a</code> has to equal <code>f n</code> and also <code>f m</code>, so <code>f n = f m</code>, but rather than putting this equality in your context it assumes that the equality can be eliminated by using injectivity of constructors. That is often the case, for example if I do the same thing with <code>0</code> and +1:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kd\">inductive</span> <span class=\"n\">foo</span> <span class=\"o\">:</span> <span class=\"n\">ℕ</span> <span class=\"bp\">→</span> <span class=\"kt\">Prop</span>\n<span class=\"bp\">|</span> <span class=\"n\">zero</span> <span class=\"o\">:</span> <span class=\"n\">foo</span> <span class=\"mi\">0</span>\n<span class=\"bp\">|</span> <span class=\"n\">foo</span> <span class=\"o\">(</span><span class=\"n\">n</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">foo</span> <span class=\"o\">(</span><span class=\"n\">n</span> <span class=\"bp\">+</span> <span class=\"mi\">1</span><span class=\"o\">)</span>\n\n<span class=\"kd\">example</span> <span class=\"o\">(</span><span class=\"n\">a</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">h1</span> <span class=\"n\">h2</span> <span class=\"o\">:</span> <span class=\"n\">foo</span> <span class=\"n\">a</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">false</span> <span class=\"o\">:=</span>\n<span class=\"kd\">begin</span>\n  <span class=\"n\">cases</span> <span class=\"n\">h1</span> <span class=\"k\">with</span> <span class=\"n\">n</span><span class=\"bp\">;</span>\n  <span class=\"n\">cases</span> <span class=\"n\">h2</span> <span class=\"k\">with</span> <span class=\"n\">m</span><span class=\"o\">,</span>\n  <span class=\"c1\">-- two cases generated, and in the second case we only have one `n`,</span>\n  <span class=\"c1\">-- because `n + 1 = m + 1` was used to derive `n = m` and eliminate `m`</span>\n<span class=\"kd\">end</span>\n</code></pre></div>\n<p>But in general the index can be an arbitrary function and in that case you get that error</p>",
        "id": 242681152,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1623724093
    },
    {
        "content": "<p>hmm, I'm a little confused by the constructor also being called foo - is that overloading?</p>",
        "id": 242681275,
        "sender_full_name": "Billy Price",
        "timestamp": 1623724261
    },
    {
        "content": "<p>Oh it doesn't really matter. They are in different namespaces, the constructor is called <code>foo.foo</code></p>",
        "id": 242681292,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1623724298
    },
    {
        "content": "<p>gotcha</p>",
        "id": 242681295,
        "sender_full_name": "Billy Price",
        "timestamp": 1623724309
    },
    {
        "content": "<p>A general way to avoid the issue and explicitly receive equality assumptions instead of letting cases try and fail to discharge them is to use <code>generalize</code> or <code>generalize_hyp</code> to replace the problematic subterms with fresh variables</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kd\">begin</span>\n  <span class=\"n\">intros</span> <span class=\"n\">Ai</span> <span class=\"n\">Bi</span> <span class=\"n\">Ci</span> <span class=\"n\">hA</span> <span class=\"n\">hB</span> <span class=\"n\">hC</span> <span class=\"n\">d₁</span> <span class=\"n\">d₂</span> <span class=\"n\">d₃</span> <span class=\"n\">s₁</span> <span class=\"n\">s₂</span><span class=\"o\">,</span>\n  <span class=\"n\">cases</span> <span class=\"o\">(</span><span class=\"n\">step_link</span> <span class=\"n\">ps</span> <span class=\"n\">Ai</span> <span class=\"n\">d₁</span><span class=\"o\">),</span>\n  <span class=\"n\">cases</span> <span class=\"n\">s₁</span><span class=\"o\">,</span>\n  <span class=\"n\">generalize_hyp</span> <span class=\"n\">eA1</span> <span class=\"o\">:</span> <span class=\"n\">Ai.1</span> <span class=\"bp\">=</span> <span class=\"n\">Ai1</span> <span class=\"n\">at</span> <span class=\"n\">s₂</span><span class=\"o\">,</span>\n  <span class=\"n\">generalize_hyp</span> <span class=\"n\">eA2</span> <span class=\"o\">:</span> <span class=\"n\">Ai.2</span> <span class=\"bp\">=</span> <span class=\"n\">Ai2</span> <span class=\"n\">at</span> <span class=\"n\">s₂</span><span class=\"o\">,</span>\n  <span class=\"n\">generalize_hyp</span> <span class=\"n\">eB2</span> <span class=\"o\">:</span> <span class=\"n\">Bi.2</span> <span class=\"bp\">=</span> <span class=\"n\">Bi2</span> <span class=\"n\">at</span> <span class=\"n\">s₂</span><span class=\"o\">,</span>\n  <span class=\"n\">cases</span> <span class=\"n\">s₂</span><span class=\"bp\">;</span> <span class=\"n\">try</span> <span class=\"o\">{</span> <span class=\"n\">cases</span> <span class=\"n\">eA1</span> <span class=\"o\">}</span><span class=\"bp\">;</span> <span class=\"n\">try</span> <span class=\"o\">{</span> <span class=\"n\">cases</span> <span class=\"n\">eA2</span> <span class=\"o\">}</span><span class=\"bp\">;</span> <span class=\"n\">try</span> <span class=\"o\">{</span> <span class=\"n\">cases</span> <span class=\"n\">eB2</span> <span class=\"o\">},</span>\n<span class=\"kd\">end</span>\n</code></pre></div>\n<p>The <code>cases eA1</code> step tries to eliminate the equality the same way <code>cases</code> normally would, but since it's in a try block it will simply leave the equality in the context if it failed to eliminate it</p>",
        "id": 242681424,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1623724454
    },
    {
        "content": "<p>looking at the resulting subgoals, the only failure was <code>eB2: Bi.snd = Ci.snd</code> in the first subgoal</p>",
        "id": 242681444,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1623724498
    },
    {
        "content": "<p>which can't be eliminated by cases unless you pattern match <code>Bi</code> and <code>Ci</code> first</p>",
        "id": 242681462,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1623724519
    },
    {
        "content": "<p>(deleted)</p>",
        "id": 242681639,
        "sender_full_name": "Billy Price",
        "timestamp": 1623724714
    },
    {
        "content": "<p>(deleted)</p>",
        "id": 242681646,
        "sender_full_name": "Billy Price",
        "timestamp": 1623724726
    },
    {
        "content": "<p>It would be nice to not have to destruct the Ai's every time I want to prove something, but the need for Ai.1 traces back to the definition of a link. For example I can't just make it <code>Link.tensor : Form_occ -&gt; Form_occ -&gt; Form_occ -&gt; Link</code> because I need the third Form_occ to have a formula which is the tensor of the first two.</p>",
        "id": 242681846,
        "sender_full_name": "Billy Price",
        "timestamp": 1623724933
    },
    {
        "content": "<p>and if I do <code>Link.tensor : Form_occ -&gt; Form_occ -&gt; Link</code> then I'm missing the index that accompanies the tensored formula. Is there a better way to implement this?</p>",
        "id": 242681894,
        "sender_full_name": "Billy Price",
        "timestamp": 1623725023
    },
    {
        "content": "<p>Another way to avoid the need to generalize all the time is to bake additional variables into the inductive constructor:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"bp\">|</span> <span class=\"n\">tensordown</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"n\">B</span> <span class=\"n\">C</span> <span class=\"o\">:</span> <span class=\"n\">Form</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">ai</span> <span class=\"n\">bi</span> <span class=\"n\">ci</span> <span class=\"o\">:</span> <span class=\"n\">ℕ</span><span class=\"o\">)</span> <span class=\"o\">:</span>\n  <span class=\"n\">steps</span> <span class=\"o\">(</span><span class=\"n\">Link.tensor</span> <span class=\"n\">ai</span> <span class=\"n\">bi</span> <span class=\"n\">ci</span> <span class=\"n\">A</span> <span class=\"n\">B</span><span class=\"o\">)</span> <span class=\"o\">⟨</span><span class=\"k\">if</span> <span class=\"n\">T</span> <span class=\"bp\">=</span> <span class=\"n\">L</span> <span class=\"k\">then</span> <span class=\"o\">(</span><span class=\"n\">A</span><span class=\"o\">,</span> <span class=\"n\">ai</span><span class=\"o\">)</span> <span class=\"k\">else</span> <span class=\"o\">(</span><span class=\"n\">B</span><span class=\"o\">,</span> <span class=\"n\">bi</span><span class=\"o\">),</span><span class=\"n\">down</span><span class=\"o\">⟩</span> <span class=\"o\">⟨(</span><span class=\"n\">C</span><span class=\"o\">,</span> <span class=\"n\">ci</span><span class=\"o\">),</span><span class=\"n\">down</span><span class=\"o\">⟩</span>\n</code></pre></div>",
        "id": 242682134,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1623725387
    },
    {
        "content": "<p>I don't really understand the role of <code>Form_occ</code> here</p>",
        "id": 242682191,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1623725434
    },
    {
        "content": "<p>what does the nat mean?</p>",
        "id": 242682198,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1623725449
    },
    {
        "content": "<p>Do you have a more mathematical presentation of this logic?</p>",
        "id": 242682213,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1623725511
    },
    {
        "content": "<p>This is Girard's proof nets. It's a graph of formula occurrences (the same formula can appear distinctly) connected by edges which are each part of a tensor, par, axiom or cut link. A link is really a subgraph containing 2-3 formulas and 1-2 edges.  There are other definitions but here is what I'm trying to stay truest to <a href=\"https://williamtroiani.github.io/pdfs/Proof-nets.pdf\">https://williamtroiani.github.io/pdfs/Proof-nets.pdf</a></p>",
        "id": 242682550,
        "sender_full_name": "Billy Price",
        "timestamp": 1623725895
    },
    {
        "content": "<p>Here's what the proof net \"looks like\"<br>\n<a href=\"/user_uploads/3121/jKovjd2M5lNBUcK11YWa23jm/image.png\">image.png</a> <br>\nYou can ignore the blue lines (they are a path around the proof net I'm defining later), and the dotted lines indicate what switching is associated to the link. The links are implicit as subgraphs here, but I think that's hard to formalise, hence the definition \"a proof structure is a set of formula occurrences and a set of links\", where a link is explicitly the data of the associated formula occurences in the subgraph, and the actual edges of the intended graph are implicit in the definition</p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/jKovjd2M5lNBUcK11YWa23jm/image.png\" title=\"image.png\"><img src=\"/user_uploads/3121/jKovjd2M5lNBUcK11YWa23jm/image.png\"></a></div>",
        "id": 242682883,
        "sender_full_name": "Billy Price",
        "timestamp": 1623726361
    },
    {
        "content": "<p>I see, so this is more of a directed graph than an inductive proof object in the traditional sense</p>",
        "id": 242683019,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1623726557
    },
    {
        "content": "<p>and the <code>Form_occ</code>s are nodes in the graph</p>",
        "id": 242683026,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1623726569
    },
    {
        "content": "<p>yeah</p>",
        "id": 242683028,
        "sender_full_name": "Billy Price",
        "timestamp": 1623726574
    },
    {
        "content": "<p>So what does <code>steps</code> correspond to in that document? It looks kind of like the \"multiplicative proof structure\" 1.0.9 but <code>dir</code> and <code>T : switch</code> look different</p>",
        "id": 242683128,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1623726696
    },
    {
        "content": "<p>Oh steps describes the flow of the path around a proof structure. In the example picture, if you start at \"down on A\", the next step must be \"down on A ox B\", since A is the premise of a tensor link and the switching of that tensor link is L.</p>",
        "id": 242683253,
        "sender_full_name": "Billy Price",
        "timestamp": 1623726883
    },
    {
        "content": "<p>See 2.0.2</p>",
        "id": 242683268,
        "sender_full_name": "Billy Price",
        "timestamp": 1623726912
    },
    {
        "content": "<p>Then a path is a list of formulas paired with ups and downs, such that each sequential pair satisfies <code>steps</code></p>",
        "id": 242683349,
        "sender_full_name": "Billy Price",
        "timestamp": 1623726995
    },
    {
        "content": "<p>I could define it as a function from the current \"step\" to the next - not sure what's better.</p>",
        "id": 242683420,
        "sender_full_name": "Billy Price",
        "timestamp": 1623727097
    },
    {
        "content": "<p>hm, I don't have any much better suggestion than having <code>steps</code> like</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"bp\">|</span> <span class=\"n\">tensordown</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"n\">B</span> <span class=\"n\">C</span> <span class=\"o\">:</span> <span class=\"n\">Form</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">ai</span> <span class=\"n\">bi</span> <span class=\"n\">ci</span> <span class=\"o\">:</span> <span class=\"n\">ℕ</span><span class=\"o\">)</span> <span class=\"o\">:</span>\n  <span class=\"n\">steps</span> <span class=\"o\">(</span><span class=\"n\">Link.tensor</span> <span class=\"n\">ai</span> <span class=\"n\">bi</span> <span class=\"n\">ci</span> <span class=\"n\">A</span> <span class=\"n\">B</span><span class=\"o\">)</span> <span class=\"o\">⟨</span><span class=\"k\">if</span> <span class=\"n\">T</span> <span class=\"bp\">=</span> <span class=\"n\">L</span> <span class=\"k\">then</span> <span class=\"o\">(</span><span class=\"n\">A</span><span class=\"o\">,</span> <span class=\"n\">ai</span><span class=\"o\">)</span> <span class=\"k\">else</span> <span class=\"o\">(</span><span class=\"n\">B</span><span class=\"o\">,</span> <span class=\"n\">bi</span><span class=\"o\">),</span><span class=\"n\">down</span><span class=\"o\">⟩</span> <span class=\"o\">⟨(</span><span class=\"n\">C</span><span class=\"o\">,</span> <span class=\"n\">ci</span><span class=\"o\">),</span><span class=\"n\">down</span><span class=\"o\">⟩</span>\n</code></pre></div>\n<p>although you can also factor out the tensor steps like so, to keep the <code>Form_occ</code> encapsulated:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kd\">inductive</span> <span class=\"n\">steps_tensor</span> <span class=\"o\">(</span><span class=\"n\">T</span> <span class=\"o\">:</span> <span class=\"n\">switch</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">Ai</span> <span class=\"n\">Bi</span> <span class=\"n\">Ci</span> <span class=\"o\">:</span> <span class=\"n\">Form_occ</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">Form_occ</span> <span class=\"bp\">×</span> <span class=\"n\">dir</span> <span class=\"bp\">→</span> <span class=\"n\">Form_occ</span> <span class=\"bp\">×</span> <span class=\"n\">dir</span> <span class=\"bp\">→</span> <span class=\"kt\">Prop</span>\n<span class=\"bp\">|</span> <span class=\"n\">down</span> <span class=\"o\">:</span> <span class=\"n\">steps_tensor</span> <span class=\"o\">⟨</span><span class=\"k\">if</span> <span class=\"n\">T</span> <span class=\"bp\">=</span> <span class=\"n\">L</span> <span class=\"k\">then</span> <span class=\"n\">Ai</span> <span class=\"k\">else</span> <span class=\"n\">Bi</span><span class=\"o\">,</span><span class=\"n\">down</span><span class=\"o\">⟩</span> <span class=\"o\">⟨</span><span class=\"n\">Ci</span><span class=\"o\">,</span><span class=\"n\">down</span><span class=\"o\">⟩</span>\n<span class=\"bp\">|</span> <span class=\"n\">turn</span> <span class=\"o\">:</span> <span class=\"n\">steps_tensor</span> <span class=\"o\">⟨</span><span class=\"k\">if</span> <span class=\"n\">T</span> <span class=\"bp\">=</span> <span class=\"n\">L</span> <span class=\"k\">then</span> <span class=\"n\">Bi</span> <span class=\"k\">else</span> <span class=\"n\">Ai</span><span class=\"o\">,</span><span class=\"n\">down</span><span class=\"o\">⟩</span> <span class=\"o\">⟨</span><span class=\"k\">if</span> <span class=\"n\">T</span> <span class=\"bp\">=</span> <span class=\"n\">L</span> <span class=\"k\">then</span> <span class=\"n\">Ai</span> <span class=\"k\">else</span> <span class=\"n\">Bi</span><span class=\"o\">,</span><span class=\"n\">up</span><span class=\"o\">⟩</span>\n<span class=\"bp\">|</span> <span class=\"n\">up</span> <span class=\"o\">:</span> <span class=\"n\">steps_tensor</span> <span class=\"o\">⟨</span><span class=\"n\">Ci</span><span class=\"o\">,</span><span class=\"n\">up</span><span class=\"o\">⟩</span> <span class=\"o\">⟨</span><span class=\"k\">if</span> <span class=\"n\">T</span> <span class=\"bp\">=</span> <span class=\"n\">L</span> <span class=\"k\">then</span> <span class=\"n\">Bi</span> <span class=\"k\">else</span> <span class=\"n\">Ai</span><span class=\"o\">,</span><span class=\"n\">up</span><span class=\"o\">⟩</span>\n\n<span class=\"kd\">inductive</span> <span class=\"n\">steps</span> <span class=\"o\">(</span><span class=\"n\">T</span> <span class=\"o\">:</span> <span class=\"n\">switch</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">Link</span> <span class=\"bp\">→</span> <span class=\"n\">Form_occ</span> <span class=\"bp\">×</span> <span class=\"n\">dir</span> <span class=\"bp\">→</span> <span class=\"n\">Form_occ</span> <span class=\"bp\">×</span> <span class=\"n\">dir</span> <span class=\"bp\">→</span> <span class=\"kt\">Prop</span>\n<span class=\"bp\">...</span>\n<span class=\"bp\">|</span> <span class=\"n\">tensor</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"n\">B</span> <span class=\"n\">C</span> <span class=\"o\">:</span> <span class=\"n\">Form</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">ai</span> <span class=\"n\">bi</span> <span class=\"n\">ci</span> <span class=\"o\">:</span> <span class=\"n\">ℕ</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">x</span> <span class=\"n\">y</span><span class=\"o\">)</span> <span class=\"o\">:</span>\n  <span class=\"n\">steps_tensor</span> <span class=\"n\">T</span> <span class=\"o\">(</span><span class=\"n\">A</span><span class=\"o\">,</span> <span class=\"n\">ai</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">B</span><span class=\"o\">,</span> <span class=\"n\">bi</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"bp\">⊗</span> <span class=\"n\">B</span><span class=\"o\">,</span> <span class=\"n\">ci</span><span class=\"o\">)</span> <span class=\"n\">x</span> <span class=\"n\">y</span> <span class=\"bp\">→</span> <span class=\"n\">steps</span> <span class=\"o\">(</span><span class=\"n\">Link.tensor</span> <span class=\"n\">ai</span> <span class=\"n\">bi</span> <span class=\"n\">ci</span> <span class=\"n\">A</span> <span class=\"n\">B</span><span class=\"o\">)</span> <span class=\"n\">x</span> <span class=\"n\">y</span>\n</code></pre></div>",
        "id": 242683720,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1623727541
    },
    {
        "content": "<p>you can even factor out the switching like so:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kd\">inductive</span> <span class=\"n\">steps_tensor</span> <span class=\"o\">(</span><span class=\"n\">Ai</span> <span class=\"n\">Bi</span> <span class=\"n\">Ci</span> <span class=\"o\">:</span> <span class=\"n\">Form_occ</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">Form_occ</span> <span class=\"bp\">×</span> <span class=\"n\">dir</span> <span class=\"bp\">→</span> <span class=\"n\">Form_occ</span> <span class=\"bp\">×</span> <span class=\"n\">dir</span> <span class=\"bp\">→</span> <span class=\"kt\">Prop</span>\n<span class=\"bp\">|</span> <span class=\"n\">down</span> <span class=\"o\">:</span> <span class=\"n\">steps_tensor</span> <span class=\"o\">⟨</span><span class=\"n\">Ai</span><span class=\"o\">,</span><span class=\"n\">down</span><span class=\"o\">⟩</span> <span class=\"o\">⟨</span><span class=\"n\">Ci</span><span class=\"o\">,</span><span class=\"n\">down</span><span class=\"o\">⟩</span>\n<span class=\"bp\">|</span> <span class=\"n\">turn</span> <span class=\"o\">:</span> <span class=\"n\">steps_tensor</span> <span class=\"o\">⟨</span><span class=\"n\">Bi</span><span class=\"o\">,</span><span class=\"n\">down</span><span class=\"o\">⟩</span> <span class=\"o\">⟨</span><span class=\"n\">Ai</span><span class=\"o\">,</span><span class=\"n\">up</span><span class=\"o\">⟩</span>\n<span class=\"bp\">|</span> <span class=\"n\">up</span> <span class=\"o\">:</span> <span class=\"n\">steps_tensor</span> <span class=\"o\">⟨</span><span class=\"n\">Ci</span><span class=\"o\">,</span><span class=\"n\">up</span><span class=\"o\">⟩</span> <span class=\"o\">⟨</span><span class=\"n\">Bi</span><span class=\"o\">,</span><span class=\"n\">up</span><span class=\"o\">⟩</span>\n\n<span class=\"bp\">|</span> <span class=\"n\">tensor_L</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"n\">B</span> <span class=\"n\">C</span> <span class=\"o\">:</span> <span class=\"n\">Form</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">ai</span> <span class=\"n\">bi</span> <span class=\"n\">ci</span> <span class=\"o\">:</span> <span class=\"n\">ℕ</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">x</span> <span class=\"n\">y</span><span class=\"o\">)</span> <span class=\"o\">:</span>\n  <span class=\"n\">T</span> <span class=\"bp\">=</span> <span class=\"n\">L</span> <span class=\"bp\">→</span> <span class=\"n\">steps_tensor</span> <span class=\"o\">(</span><span class=\"n\">A</span><span class=\"o\">,</span> <span class=\"n\">ai</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">B</span><span class=\"o\">,</span> <span class=\"n\">bi</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"bp\">⊗</span> <span class=\"n\">B</span><span class=\"o\">,</span> <span class=\"n\">ci</span><span class=\"o\">)</span> <span class=\"n\">x</span> <span class=\"n\">y</span> <span class=\"bp\">→</span>\n  <span class=\"n\">steps</span> <span class=\"o\">(</span><span class=\"n\">Link.tensor</span> <span class=\"n\">ai</span> <span class=\"n\">bi</span> <span class=\"n\">ci</span> <span class=\"n\">A</span> <span class=\"n\">B</span><span class=\"o\">)</span> <span class=\"n\">x</span> <span class=\"n\">y</span>\n<span class=\"bp\">|</span> <span class=\"n\">tensor_R</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"n\">B</span> <span class=\"n\">C</span> <span class=\"o\">:</span> <span class=\"n\">Form</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">ai</span> <span class=\"n\">bi</span> <span class=\"n\">ci</span> <span class=\"o\">:</span> <span class=\"n\">ℕ</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">x</span> <span class=\"n\">y</span><span class=\"o\">)</span> <span class=\"o\">:</span>\n  <span class=\"n\">T</span> <span class=\"bp\">=</span> <span class=\"n\">R</span> <span class=\"bp\">→</span> <span class=\"n\">steps_tensor</span> <span class=\"o\">(</span><span class=\"n\">B</span><span class=\"o\">,</span> <span class=\"n\">bi</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">A</span><span class=\"o\">,</span> <span class=\"n\">ai</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"bp\">⊗</span> <span class=\"n\">B</span><span class=\"o\">,</span> <span class=\"n\">ci</span><span class=\"o\">)</span> <span class=\"n\">x</span> <span class=\"n\">y</span> <span class=\"bp\">→</span>\n  <span class=\"n\">steps</span> <span class=\"o\">(</span><span class=\"n\">Link.tensor</span> <span class=\"n\">ai</span> <span class=\"n\">bi</span> <span class=\"n\">ci</span> <span class=\"n\">A</span> <span class=\"n\">B</span><span class=\"o\">)</span> <span class=\"n\">x</span> <span class=\"n\">y</span>\n</code></pre></div>",
        "id": 242683886,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1623727754
    },
    {
        "content": "<p>that last one is a bit more convenient if <code>T</code> is an index of the inductive type:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kd\">inductive</span> <span class=\"n\">steps</span> <span class=\"o\">:</span> <span class=\"n\">switch</span> <span class=\"bp\">→</span> <span class=\"n\">Link</span> <span class=\"bp\">→</span> <span class=\"n\">Form_occ</span> <span class=\"bp\">×</span> <span class=\"n\">dir</span> <span class=\"bp\">→</span> <span class=\"n\">Form_occ</span> <span class=\"bp\">×</span> <span class=\"n\">dir</span> <span class=\"bp\">→</span> <span class=\"kt\">Prop</span>\n<span class=\"bp\">...</span>\n<span class=\"bp\">|</span> <span class=\"n\">tensor_L</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"n\">B</span> <span class=\"n\">C</span> <span class=\"o\">:</span> <span class=\"n\">Form</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">ai</span> <span class=\"n\">bi</span> <span class=\"n\">ci</span> <span class=\"o\">:</span> <span class=\"n\">ℕ</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">x</span> <span class=\"n\">y</span><span class=\"o\">)</span> <span class=\"o\">:</span>\n  <span class=\"n\">steps_tensor</span> <span class=\"o\">(</span><span class=\"n\">A</span><span class=\"o\">,</span> <span class=\"n\">ai</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">B</span><span class=\"o\">,</span> <span class=\"n\">bi</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"bp\">⊗</span> <span class=\"n\">B</span><span class=\"o\">,</span> <span class=\"n\">ci</span><span class=\"o\">)</span> <span class=\"n\">x</span> <span class=\"n\">y</span> <span class=\"bp\">→</span>\n  <span class=\"n\">steps</span> <span class=\"n\">L</span> <span class=\"o\">(</span><span class=\"n\">Link.tensor</span> <span class=\"n\">ai</span> <span class=\"n\">bi</span> <span class=\"n\">ci</span> <span class=\"n\">A</span> <span class=\"n\">B</span><span class=\"o\">)</span> <span class=\"n\">x</span> <span class=\"n\">y</span>\n<span class=\"bp\">|</span> <span class=\"n\">tensor_R</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"n\">B</span> <span class=\"n\">C</span> <span class=\"o\">:</span> <span class=\"n\">Form</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">ai</span> <span class=\"n\">bi</span> <span class=\"n\">ci</span> <span class=\"o\">:</span> <span class=\"n\">ℕ</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">x</span> <span class=\"n\">y</span><span class=\"o\">)</span> <span class=\"o\">:</span>\n  <span class=\"n\">steps_tensor</span> <span class=\"o\">(</span><span class=\"n\">B</span><span class=\"o\">,</span> <span class=\"n\">bi</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">A</span><span class=\"o\">,</span> <span class=\"n\">ai</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"bp\">⊗</span> <span class=\"n\">B</span><span class=\"o\">,</span> <span class=\"n\">ci</span><span class=\"o\">)</span> <span class=\"n\">x</span> <span class=\"n\">y</span> <span class=\"bp\">→</span>\n  <span class=\"n\">steps</span> <span class=\"n\">R</span> <span class=\"o\">(</span><span class=\"n\">Link.tensor</span> <span class=\"n\">ai</span> <span class=\"n\">bi</span> <span class=\"n\">ci</span> <span class=\"n\">A</span> <span class=\"n\">B</span><span class=\"o\">)</span> <span class=\"n\">x</span> <span class=\"n\">y</span>\n</code></pre></div>",
        "id": 242683994,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1623727897
    },
    {
        "content": "<p>Here's a full version with those refactorings. I renamed <code>steps_tensor</code> to <code>routing</code> because <code>steps_par</code> is the same thing</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kd\">inductive</span> <span class=\"n\">routing</span> <span class=\"o\">(</span><span class=\"n\">Ai</span> <span class=\"n\">Bi</span> <span class=\"n\">Ci</span> <span class=\"o\">:</span> <span class=\"n\">Form_occ</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">Form_occ</span> <span class=\"bp\">×</span> <span class=\"n\">dir</span> <span class=\"bp\">→</span> <span class=\"n\">Form_occ</span> <span class=\"bp\">×</span> <span class=\"n\">dir</span> <span class=\"bp\">→</span> <span class=\"kt\">Prop</span>\n<span class=\"bp\">|</span> <span class=\"n\">down</span> <span class=\"o\">:</span> <span class=\"n\">routing</span> <span class=\"o\">⟨</span><span class=\"n\">Ai</span><span class=\"o\">,</span><span class=\"n\">down</span><span class=\"o\">⟩</span> <span class=\"o\">⟨</span><span class=\"n\">Ci</span><span class=\"o\">,</span><span class=\"n\">down</span><span class=\"o\">⟩</span>\n<span class=\"bp\">|</span> <span class=\"n\">turn</span> <span class=\"o\">:</span> <span class=\"n\">routing</span> <span class=\"o\">⟨</span><span class=\"n\">Bi</span><span class=\"o\">,</span><span class=\"n\">down</span><span class=\"o\">⟩</span> <span class=\"o\">⟨</span><span class=\"n\">Ai</span><span class=\"o\">,</span><span class=\"n\">up</span><span class=\"o\">⟩</span>\n<span class=\"bp\">|</span> <span class=\"n\">up</span> <span class=\"o\">:</span> <span class=\"n\">routing</span> <span class=\"o\">⟨</span><span class=\"n\">Ci</span><span class=\"o\">,</span><span class=\"n\">up</span><span class=\"o\">⟩</span> <span class=\"o\">⟨</span><span class=\"n\">Bi</span><span class=\"o\">,</span><span class=\"n\">up</span><span class=\"o\">⟩</span>\n\n<span class=\"kd\">def</span> <span class=\"n\">switch.flip</span> <span class=\"o\">{</span><span class=\"n\">α</span> <span class=\"n\">β</span><span class=\"o\">}</span> <span class=\"o\">(</span><span class=\"n\">f</span> <span class=\"o\">:</span> <span class=\"n\">α</span> <span class=\"bp\">→</span> <span class=\"n\">α</span> <span class=\"bp\">→</span> <span class=\"n\">β</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">switch</span> <span class=\"bp\">→</span> <span class=\"n\">α</span> <span class=\"bp\">→</span> <span class=\"n\">α</span> <span class=\"bp\">→</span> <span class=\"n\">β</span>\n<span class=\"bp\">|</span> <span class=\"n\">L</span> <span class=\"n\">a</span> <span class=\"n\">b</span> <span class=\"o\">:=</span> <span class=\"n\">f</span> <span class=\"n\">a</span> <span class=\"n\">b</span>\n<span class=\"bp\">|</span> <span class=\"n\">R</span> <span class=\"n\">a</span> <span class=\"n\">b</span> <span class=\"o\">:=</span> <span class=\"n\">f</span> <span class=\"n\">b</span> <span class=\"n\">a</span>\n\n<span class=\"kd\">inductive</span> <span class=\"n\">steps</span> <span class=\"o\">(</span><span class=\"n\">T</span> <span class=\"o\">:</span> <span class=\"n\">switch</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">Link</span> <span class=\"bp\">→</span> <span class=\"n\">Form_occ</span> <span class=\"bp\">×</span> <span class=\"n\">dir</span> <span class=\"bp\">→</span> <span class=\"n\">Form_occ</span> <span class=\"bp\">×</span> <span class=\"n\">dir</span> <span class=\"bp\">→</span> <span class=\"kt\">Prop</span>\n<span class=\"bp\">|</span> <span class=\"n\">ax</span> <span class=\"o\">(</span><span class=\"n\">Ai</span> <span class=\"n\">Bi</span> <span class=\"o\">:</span> <span class=\"n\">Form_occ</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">steps</span> <span class=\"o\">(</span><span class=\"n\">Link.ax</span> <span class=\"n\">Ai.2</span> <span class=\"n\">Bi.2</span> <span class=\"n\">Ai.1</span><span class=\"o\">)</span> <span class=\"o\">⟨</span><span class=\"n\">Ai</span><span class=\"o\">,</span> <span class=\"n\">up</span><span class=\"o\">⟩</span> <span class=\"o\">⟨</span><span class=\"n\">Bi</span><span class=\"o\">,</span> <span class=\"n\">down</span><span class=\"o\">⟩</span>\n<span class=\"bp\">|</span> <span class=\"n\">cut</span> <span class=\"o\">(</span><span class=\"n\">Ai</span> <span class=\"n\">Bi</span> <span class=\"o\">:</span> <span class=\"n\">Form_occ</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">steps</span> <span class=\"o\">(</span><span class=\"n\">Link.cut</span> <span class=\"n\">Ai.2</span> <span class=\"n\">Bi.2</span> <span class=\"n\">Ai.1</span><span class=\"o\">)</span> <span class=\"o\">⟨</span><span class=\"n\">Ai</span><span class=\"o\">,</span> <span class=\"n\">down</span><span class=\"o\">⟩</span> <span class=\"o\">⟨</span><span class=\"n\">Bi</span><span class=\"o\">,</span> <span class=\"n\">up</span><span class=\"o\">⟩</span>\n<span class=\"bp\">|</span> <span class=\"n\">tensor</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"n\">B</span> <span class=\"n\">C</span> <span class=\"o\">:</span> <span class=\"n\">Form</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">ai</span> <span class=\"n\">bi</span> <span class=\"n\">ci</span> <span class=\"o\">:</span> <span class=\"n\">ℕ</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">x</span> <span class=\"n\">y</span><span class=\"o\">)</span> <span class=\"o\">:</span>\n  <span class=\"n\">T.flip</span> <span class=\"n\">routing</span> <span class=\"o\">(</span><span class=\"n\">A</span><span class=\"o\">,</span> <span class=\"n\">ai</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">B</span><span class=\"o\">,</span> <span class=\"n\">bi</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"bp\">⊗</span> <span class=\"n\">B</span><span class=\"o\">,</span> <span class=\"n\">ci</span><span class=\"o\">)</span> <span class=\"n\">x</span> <span class=\"n\">y</span> <span class=\"bp\">→</span>\n  <span class=\"n\">steps</span> <span class=\"o\">(</span><span class=\"n\">Link.tensor</span> <span class=\"n\">ai</span> <span class=\"n\">bi</span> <span class=\"n\">ci</span> <span class=\"n\">A</span> <span class=\"n\">B</span><span class=\"o\">)</span> <span class=\"n\">x</span> <span class=\"n\">y</span>\n<span class=\"bp\">|</span> <span class=\"n\">par</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"n\">B</span> <span class=\"n\">C</span> <span class=\"o\">:</span> <span class=\"n\">Form</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">ai</span> <span class=\"n\">bi</span> <span class=\"n\">ci</span> <span class=\"o\">:</span> <span class=\"n\">ℕ</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">x</span> <span class=\"n\">y</span><span class=\"o\">)</span> <span class=\"o\">:</span>\n  <span class=\"n\">T.flip</span> <span class=\"n\">routing</span> <span class=\"o\">(</span><span class=\"n\">A</span><span class=\"o\">,</span> <span class=\"n\">ai</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">B</span><span class=\"o\">,</span> <span class=\"n\">bi</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"n\">⅋</span> <span class=\"n\">B</span><span class=\"o\">,</span> <span class=\"n\">ci</span><span class=\"o\">)</span> <span class=\"n\">x</span> <span class=\"n\">y</span> <span class=\"bp\">→</span>\n  <span class=\"n\">steps</span> <span class=\"o\">(</span><span class=\"n\">Link.par</span> <span class=\"n\">ai</span> <span class=\"n\">bi</span> <span class=\"n\">ci</span> <span class=\"n\">A</span> <span class=\"n\">B</span><span class=\"o\">)</span> <span class=\"n\">x</span> <span class=\"n\">y</span>\n</code></pre></div>",
        "id": 242684232,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1623728312
    },
    {
        "content": "<p>ooh I like that</p>",
        "id": 242684242,
        "sender_full_name": "Billy Price",
        "timestamp": 1623728345
    },
    {
        "content": "<p>steps_par is different to steps_tensor in the up and turn cases</p>",
        "id": 242684246,
        "sender_full_name": "Billy Price",
        "timestamp": 1623728368
    },
    {
        "content": "<p>oh, like this:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kd\">inductive</span> <span class=\"n\">steps_tensor</span> <span class=\"o\">(</span><span class=\"n\">Ai</span> <span class=\"n\">Bi</span> <span class=\"n\">Ci</span> <span class=\"o\">:</span> <span class=\"n\">Form_occ</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">Form_occ</span> <span class=\"bp\">×</span> <span class=\"n\">dir</span> <span class=\"bp\">→</span> <span class=\"n\">Form_occ</span> <span class=\"bp\">×</span> <span class=\"n\">dir</span> <span class=\"bp\">→</span> <span class=\"kt\">Prop</span>\n<span class=\"bp\">|</span> <span class=\"n\">down</span> <span class=\"o\">:</span> <span class=\"n\">steps_tensor</span> <span class=\"o\">⟨</span><span class=\"n\">Ai</span><span class=\"o\">,</span><span class=\"n\">down</span><span class=\"o\">⟩</span> <span class=\"o\">⟨</span><span class=\"n\">Ci</span><span class=\"o\">,</span><span class=\"n\">down</span><span class=\"o\">⟩</span>\n<span class=\"bp\">|</span> <span class=\"n\">turn</span> <span class=\"o\">:</span> <span class=\"n\">steps_tensor</span> <span class=\"o\">⟨</span><span class=\"n\">Bi</span><span class=\"o\">,</span><span class=\"n\">down</span><span class=\"o\">⟩</span> <span class=\"o\">⟨</span><span class=\"n\">Ai</span><span class=\"o\">,</span><span class=\"n\">up</span><span class=\"o\">⟩</span>\n<span class=\"bp\">|</span> <span class=\"n\">up</span> <span class=\"o\">:</span> <span class=\"n\">steps_tensor</span> <span class=\"o\">⟨</span><span class=\"n\">Ci</span><span class=\"o\">,</span><span class=\"n\">up</span><span class=\"o\">⟩</span> <span class=\"o\">⟨</span><span class=\"n\">Bi</span><span class=\"o\">,</span><span class=\"n\">up</span><span class=\"o\">⟩</span>\n\n<span class=\"kd\">inductive</span> <span class=\"n\">steps_par</span> <span class=\"o\">(</span><span class=\"n\">Ai</span> <span class=\"n\">Bi</span> <span class=\"n\">Ci</span> <span class=\"o\">:</span> <span class=\"n\">Form_occ</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">Form_occ</span> <span class=\"bp\">×</span> <span class=\"n\">dir</span> <span class=\"bp\">→</span> <span class=\"n\">Form_occ</span> <span class=\"bp\">×</span> <span class=\"n\">dir</span> <span class=\"bp\">→</span> <span class=\"kt\">Prop</span>\n<span class=\"bp\">|</span> <span class=\"n\">down</span> <span class=\"o\">:</span> <span class=\"n\">steps_par</span> <span class=\"o\">⟨</span><span class=\"n\">Ai</span><span class=\"o\">,</span><span class=\"n\">down</span><span class=\"o\">⟩</span> <span class=\"o\">⟨</span><span class=\"n\">Ci</span><span class=\"o\">,</span><span class=\"n\">down</span><span class=\"o\">⟩</span>\n<span class=\"bp\">|</span> <span class=\"n\">turn</span> <span class=\"o\">:</span> <span class=\"n\">steps_par</span> <span class=\"o\">⟨</span><span class=\"n\">Bi</span><span class=\"o\">,</span><span class=\"n\">down</span><span class=\"o\">⟩</span> <span class=\"o\">⟨</span><span class=\"n\">Bi</span><span class=\"o\">,</span><span class=\"n\">up</span><span class=\"o\">⟩</span>\n<span class=\"bp\">|</span> <span class=\"n\">up</span> <span class=\"o\">:</span> <span class=\"n\">steps_par</span> <span class=\"o\">⟨</span><span class=\"n\">Ci</span><span class=\"o\">,</span><span class=\"n\">up</span><span class=\"o\">⟩</span> <span class=\"o\">⟨</span><span class=\"n\">Ai</span><span class=\"o\">,</span><span class=\"n\">up</span><span class=\"o\">⟩</span>\n</code></pre></div>",
        "id": 242684303,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1623728454
    },
    {
        "content": "<p>I think you can still use <code>switch.flip</code> to get the L and R versions though</p>",
        "id": 242684309,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1623728491
    },
    {
        "content": "<p>are you saying steps_par could be defined using steps_tensor and switch.flip?</p>",
        "id": 242684389,
        "sender_full_name": "Billy Price",
        "timestamp": 1623728632
    },
    {
        "content": "<p>no, I only mean that <code>steps_par</code> in the L and R case is correctly constructed by conditionally flipping the <code>Ai</code> and <code>Bi</code> inputs</p>",
        "id": 242684439,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1623728684
    },
    {
        "content": "<p>ah yep</p>",
        "id": 242684443,
        "sender_full_name": "Billy Price",
        "timestamp": 1623728693
    },
    {
        "content": "<p>Cheers, I really like this refactoring!</p>",
        "id": 242684453,
        "sender_full_name": "Billy Price",
        "timestamp": 1623728705
    },
    {
        "content": "<p>I didn't touch the <code>ax</code> and <code>cut</code> constructors, you probably want to use separate <code>Form</code> and <code>nat</code> parameters there</p>",
        "id": 242684473,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1623728739
    },
    {
        "content": "<p>It seems like this will help break up the proof into a few shorter ones</p>",
        "id": 242684478,
        "sender_full_name": "Billy Price",
        "timestamp": 1623728746
    },
    {
        "content": "<p>yeah that's the real power of this technique</p>",
        "id": 242684497,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1623728763
    },
    {
        "content": "<p>yep, I'll see how it goes.</p>",
        "id": 242684523,
        "sender_full_name": "Billy Price",
        "timestamp": 1623728768
    },
    {
        "content": "<p>it doesn't like the switch.flip definition</p>",
        "id": 242684635,
        "sender_full_name": "Billy Price",
        "timestamp": 1623728926
    },
    {
        "content": "<p>says delete the second equation</p>",
        "id": 242684643,
        "sender_full_name": "Billy Price",
        "timestamp": 1623728942
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kd\">@[pattern]</span> <span class=\"kd\">def</span> <span class=\"n\">L</span> <span class=\"o\">:=</span> <span class=\"n\">ff</span>\n<span class=\"kd\">@[pattern]</span> <span class=\"kd\">def</span> <span class=\"n\">R</span> <span class=\"o\">:=</span> <span class=\"n\">tt</span>\n</code></pre></div>",
        "id": 242684651,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1623728959
    },
    {
        "content": "<p>What is pattern (or where do I read about it in the docs)?</p>",
        "id": 242684750,
        "sender_full_name": "Billy Price",
        "timestamp": 1623729083
    },
    {
        "content": "<p>How do I make this notation appear in the goal window?</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kd\">@[reducible]</span>\n<span class=\"kd\">def</span> <span class=\"n\">dir</span> <span class=\"o\">:=</span> <span class=\"n\">bool</span>\n\n<span class=\"kd\">@[pattern]</span> <span class=\"kd\">def</span> <span class=\"n\">down</span> <span class=\"o\">:=</span> <span class=\"n\">ff</span>\n<span class=\"kd\">@[pattern]</span> <span class=\"kd\">def</span> <span class=\"n\">up</span> <span class=\"o\">:=</span> <span class=\"n\">tt</span>\n\n<span class=\"kd\">notation</span> <span class=\"n\">Ai</span><span class=\"bp\">`↓`</span> <span class=\"o\">:=</span> <span class=\"o\">((</span><span class=\"n\">Ai</span><span class=\"o\">,</span><span class=\"n\">down</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">Form_occ</span> <span class=\"bp\">×</span> <span class=\"n\">dir</span><span class=\"o\">)</span>\n<span class=\"kd\">notation</span> <span class=\"n\">Ai</span><span class=\"bp\">`↑`</span> <span class=\"o\">:=</span> <span class=\"o\">((</span><span class=\"n\">Ai</span><span class=\"o\">,</span><span class=\"n\">up</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">Form_occ</span> <span class=\"bp\">×</span> <span class=\"n\">dir</span><span class=\"o\">)</span>\n</code></pre></div>",
        "id": 242685368,
        "sender_full_name": "Billy Price",
        "timestamp": 1623730020
    },
    {
        "content": "<p><code>@[pattern]</code> lets the equation compiler unfold a definition when compiling a pattern match</p>",
        "id": 242685919,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1623730626
    },
    {
        "content": "<p>What was it doing before to accept this as a definition?</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kd\">def</span> <span class=\"n\">switch.flip</span> <span class=\"o\">{</span><span class=\"n\">α</span> <span class=\"n\">β</span><span class=\"o\">}</span> <span class=\"o\">(</span><span class=\"n\">f</span> <span class=\"o\">:</span> <span class=\"n\">α</span> <span class=\"bp\">→</span> <span class=\"n\">α</span> <span class=\"bp\">→</span> <span class=\"n\">β</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">switch</span> <span class=\"bp\">→</span> <span class=\"n\">α</span> <span class=\"bp\">→</span> <span class=\"n\">α</span> <span class=\"bp\">→</span> <span class=\"n\">β</span>\n<span class=\"bp\">|</span> <span class=\"n\">L</span> <span class=\"n\">a</span> <span class=\"n\">b</span> <span class=\"o\">:=</span> <span class=\"n\">f</span> <span class=\"n\">a</span> <span class=\"n\">b</span>\n</code></pre></div>",
        "id": 242685936,
        "sender_full_name": "Billy Price",
        "timestamp": 1623730666
    },
    {
        "content": "<p>it thinks <code>L</code> is a variable</p>",
        "id": 242685946,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1623730679
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kd\">def</span> <span class=\"n\">with_down</span> <span class=\"o\">(</span><span class=\"n\">Ai</span> <span class=\"o\">:</span> <span class=\"n\">Form_occ</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"o\">(</span><span class=\"n\">Ai</span><span class=\"o\">,</span><span class=\"n\">down</span><span class=\"o\">)</span>\n<span class=\"kd\">def</span> <span class=\"n\">with_up</span> <span class=\"o\">(</span><span class=\"n\">Ai</span> <span class=\"o\">:</span> <span class=\"n\">Form_occ</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"o\">(</span><span class=\"n\">Ai</span><span class=\"o\">,</span><span class=\"n\">up</span><span class=\"o\">)</span>\n<span class=\"kd\">postfix</span> <span class=\"bp\">`↓`</span><span class=\"o\">:</span><span class=\"n\">max_plus</span> <span class=\"o\">:=</span> <span class=\"n\">with_down</span>\n<span class=\"kd\">postfix</span> <span class=\"bp\">`↑`</span><span class=\"o\">:</span><span class=\"n\">max_plus</span> <span class=\"o\">:=</span> <span class=\"n\">with_up</span>\n\n<span class=\"kd\">inductive</span> <span class=\"n\">steps_tensor</span> <span class=\"o\">(</span><span class=\"n\">Ai</span> <span class=\"n\">Bi</span> <span class=\"n\">Ci</span> <span class=\"o\">:</span> <span class=\"n\">Form_occ</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">Form_occ</span> <span class=\"bp\">×</span> <span class=\"n\">dir</span> <span class=\"bp\">→</span> <span class=\"n\">Form_occ</span> <span class=\"bp\">×</span> <span class=\"n\">dir</span> <span class=\"bp\">→</span> <span class=\"kt\">Prop</span>\n<span class=\"bp\">|</span> <span class=\"n\">down</span> <span class=\"o\">:</span> <span class=\"n\">steps_tensor</span> <span class=\"n\">Ai</span><span class=\"bp\">↓</span> <span class=\"n\">Ci</span><span class=\"bp\">↓</span>\n<span class=\"bp\">|</span> <span class=\"n\">turn</span> <span class=\"o\">:</span> <span class=\"n\">steps_tensor</span> <span class=\"n\">Bi</span><span class=\"bp\">↓</span> <span class=\"n\">Ai</span><span class=\"bp\">↑</span>\n<span class=\"bp\">|</span> <span class=\"n\">up</span> <span class=\"o\">:</span> <span class=\"n\">steps_tensor</span> <span class=\"n\">Ci</span><span class=\"bp\">↑</span> <span class=\"n\">Bi</span><span class=\"bp\">↑</span>\n\n<span class=\"k\">#print</span> <span class=\"n\">steps_tensor.down</span>\n<span class=\"c1\">-- constructor steps_tensor.down : ∀ {Ai Bi Ci : Form_occ}, steps_tensor Ai Bi Ci Ai↓ Ci↓</span>\n</code></pre></div>",
        "id": 242686180,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1623730946
    },
    {
        "content": "<p>you can also mark <code>with_down</code> and <code>with_up</code> as <code>@[pattern]</code>:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kd\">@[pattern]</span> <span class=\"kd\">def</span> <span class=\"n\">with_down</span> <span class=\"o\">(</span><span class=\"n\">Ai</span> <span class=\"o\">:</span> <span class=\"n\">Form_occ</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"o\">(</span><span class=\"n\">Ai</span><span class=\"o\">,</span><span class=\"n\">down</span><span class=\"o\">)</span>\n<span class=\"kd\">@[pattern]</span> <span class=\"kd\">def</span> <span class=\"n\">with_up</span> <span class=\"o\">(</span><span class=\"n\">Ai</span> <span class=\"o\">:</span> <span class=\"n\">Form_occ</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"o\">(</span><span class=\"n\">Ai</span><span class=\"o\">,</span><span class=\"n\">up</span><span class=\"o\">)</span>\n<span class=\"kd\">postfix</span> <span class=\"bp\">`↓`</span><span class=\"o\">:</span><span class=\"n\">max_plus</span> <span class=\"o\">:=</span> <span class=\"n\">with_down</span>\n<span class=\"kd\">postfix</span> <span class=\"bp\">`↑`</span><span class=\"o\">:</span><span class=\"n\">max_plus</span> <span class=\"o\">:=</span> <span class=\"n\">with_up</span>\n\n<span class=\"kd\">example</span> <span class=\"o\">:</span> <span class=\"n\">Form_occ</span> <span class=\"bp\">×</span> <span class=\"n\">dir</span> <span class=\"bp\">→</span> <span class=\"n\">true</span>\n<span class=\"bp\">|</span> <span class=\"n\">A</span><span class=\"bp\">↑</span> <span class=\"o\">:=</span> <span class=\"n\">trivial</span>\n<span class=\"bp\">|</span> <span class=\"n\">A</span><span class=\"bp\">↓</span> <span class=\"o\">:=</span> <span class=\"n\">trivial</span>\n</code></pre></div>",
        "id": 242686276,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1623731058
    },
    {
        "content": "<p><span aria-label=\"heart eyes\" class=\"emoji emoji-1f60d\" role=\"img\" title=\"heart eyes\">:heart_eyes:</span></p>",
        "id": 242686304,
        "sender_full_name": "Billy Price",
        "timestamp": 1623731109
    },
    {
        "content": "<p>How do i do <code>cases on s1 with ...</code> when the constructor arguments vary?</p>",
        "id": 242689177,
        "sender_full_name": "Billy Price",
        "timestamp": 1623734385
    },
    {
        "content": "<p>like doing cases on <code>steps T Δ X Z</code> with this definition</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kd\">inductive</span> <span class=\"n\">steps</span> <span class=\"o\">(</span><span class=\"n\">T</span> <span class=\"o\">:</span> <span class=\"n\">switch</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">Link</span> <span class=\"bp\">→</span> <span class=\"n\">Form_occ</span> <span class=\"bp\">×</span> <span class=\"n\">dir</span> <span class=\"bp\">→</span> <span class=\"n\">Form_occ</span> <span class=\"bp\">×</span> <span class=\"n\">dir</span> <span class=\"bp\">→</span> <span class=\"kt\">Prop</span>\n<span class=\"bp\">|</span> <span class=\"n\">ax</span>  <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"o\">:</span> <span class=\"n\">Form</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">ai</span> <span class=\"n\">ni</span> <span class=\"o\">:</span> <span class=\"n\">ℕ</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">Bi</span> <span class=\"n\">Ci</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">dual</span> <span class=\"n\">A</span> <span class=\"n\">ai</span> <span class=\"n\">ni</span> <span class=\"n\">Bi</span> <span class=\"n\">Ci</span> <span class=\"bp\">→</span> <span class=\"n\">steps</span> <span class=\"o\">(</span><span class=\"n\">Link.ax</span> <span class=\"n\">ai</span> <span class=\"n\">ni</span> <span class=\"n\">A</span><span class=\"o\">)</span> <span class=\"n\">Bi</span><span class=\"bp\">↑</span> <span class=\"n\">Ci</span><span class=\"bp\">↓</span>\n<span class=\"bp\">|</span> <span class=\"n\">cut</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"o\">:</span> <span class=\"n\">Form</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">ai</span> <span class=\"n\">ni</span> <span class=\"o\">:</span> <span class=\"n\">ℕ</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">Bi</span> <span class=\"n\">Ci</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">dual</span> <span class=\"n\">A</span> <span class=\"n\">ai</span> <span class=\"n\">ni</span> <span class=\"n\">Bi</span> <span class=\"n\">Ci</span> <span class=\"bp\">→</span> <span class=\"n\">steps</span> <span class=\"o\">(</span><span class=\"n\">Link.cut</span> <span class=\"n\">ai</span> <span class=\"n\">ni</span> <span class=\"n\">A</span><span class=\"o\">)</span> <span class=\"n\">Bi</span><span class=\"bp\">↓</span> <span class=\"n\">Ci</span><span class=\"bp\">↑</span>\n<span class=\"bp\">|</span> <span class=\"n\">con</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"o\">:</span> <span class=\"n\">Form</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">ai</span> <span class=\"o\">:</span> <span class=\"n\">ℕ</span><span class=\"o\">)</span>            <span class=\"o\">:</span> <span class=\"n\">steps</span> <span class=\"o\">(</span><span class=\"n\">Link.con</span> <span class=\"n\">ai</span> <span class=\"n\">A</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">A</span><span class=\"o\">,</span> <span class=\"n\">ai</span><span class=\"o\">)</span><span class=\"bp\">↓</span> <span class=\"o\">(</span><span class=\"n\">A</span><span class=\"o\">,</span><span class=\"n\">ai</span><span class=\"o\">)</span><span class=\"bp\">↑</span>\n<span class=\"bp\">|</span> <span class=\"n\">tensor</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"n\">B</span> <span class=\"o\">:</span> <span class=\"n\">Form</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">ai</span> <span class=\"n\">bi</span> <span class=\"n\">ci</span> <span class=\"o\">:</span> <span class=\"n\">ℕ</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">x</span> <span class=\"n\">y</span><span class=\"o\">)</span> <span class=\"o\">:</span>\n  <span class=\"n\">T.flip</span> <span class=\"n\">steps_tensor</span> <span class=\"o\">(</span><span class=\"n\">A</span><span class=\"o\">,</span> <span class=\"n\">ai</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">B</span><span class=\"o\">,</span> <span class=\"n\">bi</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"bp\">⊗</span> <span class=\"n\">B</span><span class=\"o\">,</span> <span class=\"n\">ci</span><span class=\"o\">)</span> <span class=\"n\">x</span> <span class=\"n\">y</span> <span class=\"bp\">→</span>\n  <span class=\"n\">steps</span> <span class=\"o\">(</span><span class=\"n\">Link.tensor</span> <span class=\"n\">ai</span> <span class=\"n\">bi</span> <span class=\"n\">ci</span> <span class=\"n\">A</span> <span class=\"n\">B</span><span class=\"o\">)</span> <span class=\"n\">x</span> <span class=\"n\">y</span>\n<span class=\"bp\">|</span> <span class=\"n\">par</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"n\">B</span> <span class=\"o\">:</span> <span class=\"n\">Form</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">ai</span> <span class=\"n\">bi</span> <span class=\"n\">ci</span> <span class=\"o\">:</span> <span class=\"n\">ℕ</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">x</span> <span class=\"n\">y</span><span class=\"o\">)</span> <span class=\"o\">:</span>\n  <span class=\"n\">T.flip</span> <span class=\"n\">steps_par</span> <span class=\"o\">(</span><span class=\"n\">A</span><span class=\"o\">,</span> <span class=\"n\">ai</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">B</span><span class=\"o\">,</span> <span class=\"n\">bi</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"n\">⅋</span> <span class=\"n\">B</span><span class=\"o\">,</span> <span class=\"n\">ci</span><span class=\"o\">)</span> <span class=\"n\">x</span> <span class=\"n\">y</span> <span class=\"bp\">→</span>\n  <span class=\"n\">steps</span> <span class=\"o\">(</span><span class=\"n\">Link.par</span> <span class=\"n\">ai</span> <span class=\"n\">bi</span> <span class=\"n\">ci</span> <span class=\"n\">A</span> <span class=\"n\">B</span><span class=\"o\">)</span> <span class=\"n\">x</span> <span class=\"n\">y</span>\n</code></pre></div>",
        "id": 242689268,
        "sender_full_name": "Billy Price",
        "timestamp": 1623734486
    },
    {
        "content": "<p>I don't follow. Do you have a mwe? <code>cases s1 with ...</code> should work</p>",
        "id": 242689976,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1623735369
    },
    {
        "content": "<p>I mean the naming of the variables, since the different constructors have different arguments.<br>\n...<br>\nOkay so when I asked the question I thought that lean's behaviour was to use the same \"with\"-variables for each constructor, but trying it out it actually lets you name them all in sequence? So I guess my aim is to improve on this (which does what I want, but... wtf).</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kd\">theorem</span> <span class=\"n\">steps_unique_prev</span> <span class=\"o\">(</span><span class=\"n\">T</span> <span class=\"o\">:</span> <span class=\"n\">switch</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"bp\">Δ</span> <span class=\"o\">:</span> <span class=\"n\">Link</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">X</span> <span class=\"n\">Y</span> <span class=\"n\">Z</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">steps</span> <span class=\"n\">T</span> <span class=\"bp\">Δ</span> <span class=\"n\">X</span> <span class=\"n\">Z</span> <span class=\"bp\">→</span> <span class=\"n\">steps</span> <span class=\"n\">T</span> <span class=\"bp\">Δ</span> <span class=\"n\">Y</span> <span class=\"n\">Z</span> <span class=\"bp\">→</span> <span class=\"n\">X</span> <span class=\"bp\">=</span> <span class=\"n\">Y</span> <span class=\"o\">:=</span>\n<span class=\"kd\">begin</span>\n  <span class=\"n\">intros</span> <span class=\"n\">s₁</span> <span class=\"n\">s₂</span><span class=\"o\">,</span>\n  <span class=\"n\">cases</span> <span class=\"n\">s₁</span> <span class=\"k\">with</span> <span class=\"n\">A</span> <span class=\"n\">ai</span> <span class=\"n\">ni</span> <span class=\"n\">Bi</span> <span class=\"n\">Ci</span> <span class=\"n\">dBC</span> <span class=\"n\">A</span> <span class=\"n\">ai</span> <span class=\"n\">ni</span> <span class=\"n\">Bi</span> <span class=\"n\">Ci</span> <span class=\"n\">dBC</span> <span class=\"n\">A</span> <span class=\"n\">ai</span> <span class=\"n\">A</span> <span class=\"n\">B</span> <span class=\"n\">ai</span> <span class=\"n\">bi</span> <span class=\"n\">ci</span> <span class=\"n\">x</span> <span class=\"n\">y</span> <span class=\"n\">t₁</span> <span class=\"n\">A</span> <span class=\"n\">B</span> <span class=\"n\">ai</span> <span class=\"n\">bi</span> <span class=\"n\">ci</span> <span class=\"n\">x</span> <span class=\"n\">y</span> <span class=\"n\">p₁</span><span class=\"o\">,</span>\n<span class=\"kd\">end</span>\n</code></pre></div>",
        "id": 242690633,
        "sender_full_name": "Billy Price",
        "timestamp": 1623736280
    },
    {
        "content": "<p>mwe</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kn\">import</span> <span class=\"n\">tactic</span>\n\n<span class=\"kd\">inductive</span> <span class=\"n\">Form</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span>\n<span class=\"bp\">|</span> <span class=\"n\">atom</span> <span class=\"o\">:</span> <span class=\"n\">ℕ</span> <span class=\"bp\">→</span> <span class=\"n\">Form</span>\n<span class=\"bp\">|</span> <span class=\"n\">tensor</span> <span class=\"o\">:</span> <span class=\"n\">Form</span> <span class=\"bp\">→</span> <span class=\"n\">Form</span> <span class=\"bp\">→</span> <span class=\"n\">Form</span>\n<span class=\"bp\">|</span> <span class=\"n\">par</span> <span class=\"o\">:</span> <span class=\"n\">Form</span> <span class=\"bp\">→</span> <span class=\"n\">Form</span> <span class=\"bp\">→</span> <span class=\"n\">Form</span>\n<span class=\"bp\">|</span> <span class=\"n\">neg</span> <span class=\"o\">:</span> <span class=\"n\">Form</span> <span class=\"bp\">→</span> <span class=\"n\">Form</span>\n\n<span class=\"kd\">infix</span> <span class=\"bp\">`</span> <span class=\"bp\">⊗</span> <span class=\"bp\">`</span><span class=\"o\">:</span><span class=\"mi\">70</span> <span class=\"o\">:=</span> <span class=\"n\">Form.tensor</span>\n<span class=\"kd\">infix</span> <span class=\"bp\">`</span> <span class=\"n\">⅋</span> <span class=\"bp\">`</span><span class=\"o\">:</span><span class=\"mi\">65</span> <span class=\"o\">:=</span> <span class=\"n\">Form.par</span>\n<span class=\"kd\">prefix</span> <span class=\"bp\">`~`</span> <span class=\"o\">:=</span> <span class=\"n\">Form.neg</span>\n\n<span class=\"kd\">inductive</span> <span class=\"n\">Link</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span>\n<span class=\"bp\">|</span> <span class=\"n\">ax</span> <span class=\"o\">:</span> <span class=\"n\">ℕ</span> <span class=\"bp\">→</span> <span class=\"n\">ℕ</span> <span class=\"bp\">→</span> <span class=\"n\">Form</span> <span class=\"bp\">→</span> <span class=\"n\">Link</span>\n<span class=\"bp\">|</span> <span class=\"n\">cut</span> <span class=\"o\">:</span> <span class=\"n\">ℕ</span> <span class=\"bp\">→</span> <span class=\"n\">ℕ</span> <span class=\"bp\">→</span> <span class=\"n\">Form</span> <span class=\"bp\">→</span> <span class=\"n\">Link</span>\n<span class=\"bp\">|</span> <span class=\"n\">tensor</span> <span class=\"o\">:</span> <span class=\"n\">ℕ</span> <span class=\"bp\">→</span> <span class=\"n\">ℕ</span> <span class=\"bp\">→</span> <span class=\"n\">ℕ</span> <span class=\"bp\">→</span> <span class=\"n\">Form</span> <span class=\"bp\">→</span> <span class=\"n\">Form</span> <span class=\"bp\">→</span> <span class=\"n\">Link</span>\n<span class=\"bp\">|</span> <span class=\"n\">par</span> <span class=\"o\">:</span> <span class=\"n\">ℕ</span> <span class=\"bp\">→</span> <span class=\"n\">ℕ</span> <span class=\"bp\">→</span> <span class=\"n\">ℕ</span> <span class=\"bp\">→</span> <span class=\"n\">Form</span> <span class=\"bp\">→</span> <span class=\"n\">Form</span> <span class=\"bp\">→</span> <span class=\"n\">Link</span>\n<span class=\"bp\">|</span> <span class=\"n\">con</span> <span class=\"o\">:</span> <span class=\"n\">ℕ</span> <span class=\"bp\">→</span> <span class=\"n\">Form</span> <span class=\"bp\">→</span> <span class=\"n\">Link</span>\n\n<span class=\"kd\">def</span> <span class=\"n\">Form_occ</span> <span class=\"o\">:=</span> <span class=\"n\">Form</span> <span class=\"bp\">×</span> <span class=\"n\">ℕ</span>\n\n<span class=\"kd\">def</span> <span class=\"n\">is_premise</span> <span class=\"o\">(</span><span class=\"n\">Ai</span> <span class=\"o\">:</span> <span class=\"n\">Form_occ</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">Link</span> <span class=\"bp\">→</span> <span class=\"kt\">Prop</span>\n<span class=\"bp\">|</span> <span class=\"o\">(</span><span class=\"n\">Link.ax</span> <span class=\"n\">n</span> <span class=\"n\">m</span> <span class=\"n\">B</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"n\">false</span>\n<span class=\"bp\">|</span> <span class=\"o\">(</span><span class=\"n\">Link.cut</span> <span class=\"n\">n</span> <span class=\"n\">m</span> <span class=\"n\">B</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"o\">(</span><span class=\"n\">Ai</span> <span class=\"bp\">=</span> <span class=\"o\">⟨</span><span class=\"n\">B</span><span class=\"o\">,</span><span class=\"n\">n</span><span class=\"o\">⟩)</span> <span class=\"bp\">∨</span> <span class=\"o\">(</span><span class=\"n\">Ai</span> <span class=\"bp\">=</span> <span class=\"o\">⟨</span><span class=\"bp\">~</span><span class=\"n\">B</span><span class=\"o\">,</span><span class=\"n\">m</span><span class=\"o\">⟩)</span>\n<span class=\"bp\">|</span> <span class=\"o\">(</span><span class=\"n\">Link.tensor</span> <span class=\"n\">n</span> <span class=\"n\">m</span> <span class=\"n\">k</span> <span class=\"n\">A</span> <span class=\"n\">B</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"o\">(</span><span class=\"n\">Ai</span> <span class=\"bp\">=</span> <span class=\"o\">⟨</span><span class=\"n\">A</span><span class=\"o\">,</span><span class=\"n\">n</span><span class=\"o\">⟩)</span> <span class=\"bp\">∨</span> <span class=\"o\">(</span><span class=\"n\">Ai</span> <span class=\"bp\">=</span> <span class=\"o\">⟨</span><span class=\"n\">B</span><span class=\"o\">,</span><span class=\"n\">m</span><span class=\"o\">⟩)</span>\n<span class=\"bp\">|</span> <span class=\"o\">(</span><span class=\"n\">Link.par</span> <span class=\"n\">n</span> <span class=\"n\">m</span> <span class=\"n\">k</span> <span class=\"n\">A</span> <span class=\"n\">B</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"o\">(</span><span class=\"n\">Ai</span> <span class=\"bp\">=</span> <span class=\"o\">⟨</span><span class=\"n\">A</span><span class=\"o\">,</span><span class=\"n\">n</span><span class=\"o\">⟩)</span> <span class=\"bp\">∨</span> <span class=\"o\">(</span><span class=\"n\">Ai</span> <span class=\"bp\">=</span> <span class=\"o\">⟨</span><span class=\"n\">B</span><span class=\"o\">,</span><span class=\"n\">m</span><span class=\"o\">⟩)</span>\n<span class=\"bp\">|</span> <span class=\"o\">(</span><span class=\"n\">Link.con</span> <span class=\"n\">n</span> <span class=\"n\">A</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"n\">Ai</span> <span class=\"bp\">=</span> <span class=\"o\">⟨</span><span class=\"n\">A</span><span class=\"o\">,</span><span class=\"n\">n</span><span class=\"o\">⟩</span>\n\n<span class=\"kd\">def</span> <span class=\"n\">is_conclusion</span> <span class=\"o\">(</span><span class=\"n\">Ai</span> <span class=\"o\">:</span> <span class=\"n\">Form_occ</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">Link</span> <span class=\"bp\">→</span> <span class=\"kt\">Prop</span>\n<span class=\"bp\">|</span> <span class=\"o\">(</span><span class=\"n\">Link.ax</span> <span class=\"n\">n</span> <span class=\"n\">m</span> <span class=\"n\">B</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"o\">(</span><span class=\"n\">Ai</span> <span class=\"bp\">=</span> <span class=\"o\">⟨</span><span class=\"n\">B</span><span class=\"o\">,</span><span class=\"n\">n</span><span class=\"o\">⟩)</span> <span class=\"bp\">∨</span> <span class=\"o\">(</span><span class=\"n\">Ai</span> <span class=\"bp\">=</span> <span class=\"o\">⟨</span><span class=\"bp\">~</span><span class=\"n\">B</span><span class=\"o\">,</span><span class=\"n\">m</span><span class=\"o\">⟩)</span>\n<span class=\"bp\">|</span> <span class=\"o\">(</span><span class=\"n\">Link.cut</span> <span class=\"n\">n</span> <span class=\"n\">m</span> <span class=\"n\">B</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"n\">false</span>\n<span class=\"bp\">|</span> <span class=\"o\">(</span><span class=\"n\">Link.tensor</span> <span class=\"n\">n</span> <span class=\"n\">m</span> <span class=\"n\">k</span> <span class=\"n\">A</span> <span class=\"n\">B</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"n\">Ai</span> <span class=\"bp\">=</span> <span class=\"o\">⟨</span><span class=\"n\">A</span> <span class=\"bp\">⊗</span> <span class=\"n\">B</span><span class=\"o\">,</span><span class=\"n\">k</span><span class=\"o\">⟩</span>\n<span class=\"bp\">|</span> <span class=\"o\">(</span><span class=\"n\">Link.par</span> <span class=\"n\">n</span> <span class=\"n\">m</span> <span class=\"n\">k</span> <span class=\"n\">A</span> <span class=\"n\">B</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"n\">Ai</span> <span class=\"bp\">=</span> <span class=\"o\">⟨</span><span class=\"n\">A</span> <span class=\"n\">⅋</span> <span class=\"n\">B</span><span class=\"o\">,</span><span class=\"n\">k</span><span class=\"o\">⟩</span>\n<span class=\"bp\">|</span> <span class=\"o\">(</span><span class=\"n\">Link.con</span> <span class=\"n\">n</span> <span class=\"n\">A</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"n\">false</span>\n\n<span class=\"kd\">structure</span> <span class=\"n\">proof_structure</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span> <span class=\"o\">:=</span>\n<span class=\"o\">(</span><span class=\"n\">links</span> <span class=\"o\">:</span> <span class=\"n\">set</span> <span class=\"n\">Link</span><span class=\"o\">)</span>\n<span class=\"o\">(</span><span class=\"n\">form_occs</span> <span class=\"o\">:</span> <span class=\"n\">set</span> <span class=\"n\">Form_occ</span><span class=\"o\">)</span>\n<span class=\"o\">(</span><span class=\"n\">link_prem</span> <span class=\"o\">:</span> <span class=\"bp\">∀</span> <span class=\"n\">l</span> <span class=\"bp\">∈</span> <span class=\"n\">links</span><span class=\"o\">,</span> <span class=\"bp\">∀</span> <span class=\"n\">Ai</span> <span class=\"o\">:</span> <span class=\"n\">Form_occ</span><span class=\"o\">,</span> <span class=\"n\">is_premise</span> <span class=\"n\">Ai</span> <span class=\"n\">l</span> <span class=\"bp\">→</span> <span class=\"n\">Ai</span> <span class=\"bp\">∈</span> <span class=\"n\">form_occs</span><span class=\"o\">)</span>\n<span class=\"o\">(</span><span class=\"n\">link_con</span> <span class=\"o\">:</span> <span class=\"bp\">∀</span> <span class=\"n\">l</span> <span class=\"bp\">∈</span> <span class=\"n\">links</span><span class=\"o\">,</span> <span class=\"bp\">∀</span> <span class=\"n\">Ai</span> <span class=\"o\">:</span> <span class=\"n\">Form_occ</span><span class=\"o\">,</span> <span class=\"n\">is_conclusion</span> <span class=\"n\">Ai</span> <span class=\"n\">l</span> <span class=\"bp\">→</span> <span class=\"n\">Ai</span> <span class=\"bp\">∈</span> <span class=\"n\">form_occs</span><span class=\"o\">)</span>\n<span class=\"o\">(</span><span class=\"n\">premise</span> <span class=\"o\">:</span> <span class=\"n\">Form_occ</span> <span class=\"bp\">→</span> <span class=\"n\">Link</span><span class=\"o\">)</span>\n<span class=\"o\">(</span><span class=\"n\">prem_unique</span> <span class=\"o\">:</span> <span class=\"bp\">∀</span> <span class=\"n\">Ai</span> <span class=\"bp\">∈</span> <span class=\"n\">form_occs</span><span class=\"o\">,</span> <span class=\"bp\">∀</span> <span class=\"n\">l</span> <span class=\"bp\">∈</span> <span class=\"n\">links</span><span class=\"o\">,</span> <span class=\"n\">is_premise</span> <span class=\"n\">Ai</span> <span class=\"n\">l</span> <span class=\"bp\">→</span> <span class=\"n\">premise</span> <span class=\"n\">Ai</span> <span class=\"bp\">=</span> <span class=\"n\">l</span><span class=\"o\">)</span>\n<span class=\"o\">(</span><span class=\"n\">prem_range</span> <span class=\"o\">:</span> <span class=\"bp\">∀</span> <span class=\"n\">Ai</span> <span class=\"bp\">∈</span> <span class=\"n\">form_occs</span><span class=\"o\">,</span> <span class=\"n\">premise</span> <span class=\"n\">Ai</span> <span class=\"bp\">∈</span> <span class=\"n\">links</span> <span class=\"bp\">∧</span> <span class=\"n\">is_premise</span> <span class=\"n\">Ai</span> <span class=\"o\">(</span><span class=\"n\">premise</span> <span class=\"n\">Ai</span><span class=\"o\">))</span>\n<span class=\"o\">(</span><span class=\"n\">conclusion</span> <span class=\"o\">:</span> <span class=\"n\">Form_occ</span> <span class=\"bp\">→</span> <span class=\"n\">Link</span><span class=\"o\">)</span>\n<span class=\"o\">(</span><span class=\"n\">con_unique</span> <span class=\"o\">:</span> <span class=\"bp\">∀</span> <span class=\"n\">Ai</span> <span class=\"bp\">∈</span> <span class=\"n\">form_occs</span><span class=\"o\">,</span> <span class=\"bp\">∀</span> <span class=\"n\">l</span> <span class=\"bp\">∈</span> <span class=\"n\">links</span><span class=\"o\">,</span> <span class=\"n\">is_conclusion</span> <span class=\"n\">Ai</span> <span class=\"n\">l</span> <span class=\"bp\">→</span> <span class=\"n\">conclusion</span> <span class=\"n\">Ai</span> <span class=\"bp\">=</span> <span class=\"n\">l</span><span class=\"o\">)</span>\n<span class=\"o\">(</span><span class=\"n\">con_range</span> <span class=\"o\">:</span> <span class=\"bp\">∀</span> <span class=\"n\">Ai</span> <span class=\"bp\">∈</span> <span class=\"n\">form_occs</span><span class=\"o\">,</span> <span class=\"n\">conclusion</span> <span class=\"n\">Ai</span> <span class=\"bp\">∈</span> <span class=\"n\">links</span> <span class=\"bp\">∧</span> <span class=\"n\">is_conclusion</span> <span class=\"n\">Ai</span> <span class=\"o\">(</span><span class=\"n\">conclusion</span> <span class=\"n\">Ai</span><span class=\"o\">))</span>\n\n<span class=\"kd\">@[reducible]</span>\n<span class=\"kd\">def</span> <span class=\"n\">dir</span> <span class=\"o\">:=</span> <span class=\"n\">bool</span>\n\n<span class=\"kd\">@[pattern]</span> <span class=\"kd\">def</span> <span class=\"n\">down</span> <span class=\"o\">:=</span> <span class=\"n\">ff</span>\n<span class=\"kd\">@[pattern]</span> <span class=\"kd\">def</span> <span class=\"n\">up</span> <span class=\"o\">:=</span> <span class=\"n\">tt</span>\n\n<span class=\"kd\">@[pattern]</span> <span class=\"kd\">def</span> <span class=\"n\">with_down</span> <span class=\"o\">(</span><span class=\"n\">Ai</span> <span class=\"o\">:</span> <span class=\"n\">Form_occ</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"o\">(</span><span class=\"n\">Ai</span><span class=\"o\">,</span><span class=\"n\">down</span><span class=\"o\">)</span>\n<span class=\"kd\">@[pattern]</span> <span class=\"kd\">def</span> <span class=\"n\">with_up</span> <span class=\"o\">(</span><span class=\"n\">Ai</span> <span class=\"o\">:</span> <span class=\"n\">Form_occ</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"o\">(</span><span class=\"n\">Ai</span><span class=\"o\">,</span><span class=\"n\">up</span><span class=\"o\">)</span>\n<span class=\"kd\">postfix</span> <span class=\"bp\">`↓`</span><span class=\"o\">:</span><span class=\"n\">max_plus</span> <span class=\"o\">:=</span> <span class=\"n\">with_down</span>\n<span class=\"kd\">postfix</span> <span class=\"bp\">`↑`</span><span class=\"o\">:</span><span class=\"n\">max_plus</span> <span class=\"o\">:=</span> <span class=\"n\">with_up</span>\n\n<span class=\"kd\">@[reducible]</span>\n<span class=\"kd\">def</span> <span class=\"n\">switch</span> <span class=\"o\">:=</span> <span class=\"n\">bool</span>\n\n<span class=\"kd\">@[pattern]</span> <span class=\"kd\">def</span> <span class=\"n\">L</span> <span class=\"o\">:=</span> <span class=\"n\">ff</span>\n<span class=\"kd\">@[pattern]</span> <span class=\"kd\">def</span> <span class=\"n\">R</span> <span class=\"o\">:=</span> <span class=\"n\">tt</span>\n\n<span class=\"kd\">def</span> <span class=\"n\">switching</span> <span class=\"o\">:=</span> <span class=\"n\">Link</span> <span class=\"bp\">→</span> <span class=\"n\">switch</span>\n\n<span class=\"kd\">def</span> <span class=\"n\">switch.flip</span> <span class=\"o\">{</span><span class=\"n\">α</span> <span class=\"n\">β</span><span class=\"o\">}</span> <span class=\"o\">(</span><span class=\"n\">f</span> <span class=\"o\">:</span> <span class=\"n\">α</span> <span class=\"bp\">→</span> <span class=\"n\">α</span> <span class=\"bp\">→</span> <span class=\"n\">β</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">switch</span> <span class=\"bp\">→</span> <span class=\"n\">α</span> <span class=\"bp\">→</span> <span class=\"n\">α</span> <span class=\"bp\">→</span> <span class=\"n\">β</span>\n<span class=\"bp\">|</span> <span class=\"n\">L</span> <span class=\"n\">a</span> <span class=\"n\">b</span> <span class=\"o\">:=</span> <span class=\"n\">f</span> <span class=\"n\">a</span> <span class=\"n\">b</span>\n<span class=\"bp\">|</span> <span class=\"n\">R</span> <span class=\"n\">a</span> <span class=\"n\">b</span> <span class=\"o\">:=</span> <span class=\"n\">f</span> <span class=\"n\">b</span> <span class=\"n\">a</span>\n\n<span class=\"kd\">inductive</span> <span class=\"n\">steps_tensor</span> <span class=\"o\">(</span><span class=\"n\">Ai</span> <span class=\"n\">Bi</span> <span class=\"n\">Ci</span> <span class=\"o\">:</span> <span class=\"n\">Form_occ</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">Form_occ</span> <span class=\"bp\">×</span> <span class=\"n\">dir</span> <span class=\"bp\">→</span> <span class=\"n\">Form_occ</span> <span class=\"bp\">×</span> <span class=\"n\">dir</span> <span class=\"bp\">→</span> <span class=\"kt\">Prop</span>\n<span class=\"bp\">|</span> <span class=\"n\">down</span> <span class=\"o\">:</span> <span class=\"n\">steps_tensor</span> <span class=\"n\">Ai</span><span class=\"bp\">↓</span> <span class=\"n\">Ci</span><span class=\"bp\">↓</span>\n<span class=\"bp\">|</span> <span class=\"n\">turn</span> <span class=\"o\">:</span> <span class=\"n\">steps_tensor</span> <span class=\"n\">Bi</span><span class=\"bp\">↓</span> <span class=\"n\">Ai</span><span class=\"bp\">↑</span>\n<span class=\"bp\">|</span> <span class=\"n\">up</span> <span class=\"o\">:</span> <span class=\"n\">steps_tensor</span> <span class=\"n\">Ci</span><span class=\"bp\">↑</span> <span class=\"n\">Bi</span><span class=\"bp\">↑</span>\n\n<span class=\"kd\">inductive</span> <span class=\"n\">steps_par</span> <span class=\"o\">(</span><span class=\"n\">Ai</span> <span class=\"n\">Bi</span> <span class=\"n\">Ci</span> <span class=\"o\">:</span> <span class=\"n\">Form_occ</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">Form_occ</span> <span class=\"bp\">×</span> <span class=\"n\">dir</span> <span class=\"bp\">→</span> <span class=\"n\">Form_occ</span> <span class=\"bp\">×</span> <span class=\"n\">dir</span> <span class=\"bp\">→</span> <span class=\"kt\">Prop</span>\n<span class=\"bp\">|</span> <span class=\"n\">down</span> <span class=\"o\">:</span> <span class=\"n\">steps_par</span> <span class=\"n\">Ai</span><span class=\"bp\">↓</span> <span class=\"n\">Ci</span><span class=\"bp\">↓</span>\n<span class=\"bp\">|</span> <span class=\"n\">turn</span> <span class=\"o\">:</span> <span class=\"n\">steps_par</span> <span class=\"n\">Bi</span><span class=\"bp\">↓</span> <span class=\"n\">Bi</span><span class=\"bp\">↑</span>\n<span class=\"bp\">|</span> <span class=\"n\">up</span> <span class=\"o\">:</span> <span class=\"n\">steps_par</span> <span class=\"n\">Ci</span><span class=\"bp\">↑</span> <span class=\"n\">Ai</span><span class=\"bp\">↑</span>\n\n<span class=\"kd\">inductive</span> <span class=\"n\">dual</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"o\">:</span> <span class=\"n\">Form</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">ai</span> <span class=\"n\">ni</span> <span class=\"o\">:</span> <span class=\"n\">ℕ</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">Form_occ</span> <span class=\"bp\">→</span> <span class=\"n\">Form_occ</span> <span class=\"bp\">→</span> <span class=\"kt\">Prop</span>\n<span class=\"bp\">|</span> <span class=\"n\">posneg</span> <span class=\"o\">:</span> <span class=\"n\">dual</span> <span class=\"o\">(</span><span class=\"n\">A</span><span class=\"o\">,</span><span class=\"n\">ai</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"bp\">~</span><span class=\"n\">A</span><span class=\"o\">,</span><span class=\"n\">ni</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"n\">negpos</span> <span class=\"o\">:</span> <span class=\"n\">dual</span> <span class=\"o\">(</span><span class=\"bp\">~</span><span class=\"n\">A</span><span class=\"o\">,</span><span class=\"n\">ni</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">A</span><span class=\"o\">,</span><span class=\"n\">ai</span><span class=\"o\">)</span>\n\n<span class=\"kd\">inductive</span> <span class=\"n\">steps</span> <span class=\"o\">(</span><span class=\"n\">T</span> <span class=\"o\">:</span> <span class=\"n\">switch</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">Link</span> <span class=\"bp\">→</span> <span class=\"n\">Form_occ</span> <span class=\"bp\">×</span> <span class=\"n\">dir</span> <span class=\"bp\">→</span> <span class=\"n\">Form_occ</span> <span class=\"bp\">×</span> <span class=\"n\">dir</span> <span class=\"bp\">→</span> <span class=\"kt\">Prop</span>\n<span class=\"bp\">|</span> <span class=\"n\">ax</span>  <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"o\">:</span> <span class=\"n\">Form</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">ai</span> <span class=\"n\">ni</span> <span class=\"o\">:</span> <span class=\"n\">ℕ</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">Bi</span> <span class=\"n\">Ci</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">dual</span> <span class=\"n\">A</span> <span class=\"n\">ai</span> <span class=\"n\">ni</span> <span class=\"n\">Bi</span> <span class=\"n\">Ci</span> <span class=\"bp\">→</span> <span class=\"n\">steps</span> <span class=\"o\">(</span><span class=\"n\">Link.ax</span> <span class=\"n\">ai</span> <span class=\"n\">ni</span> <span class=\"n\">A</span><span class=\"o\">)</span> <span class=\"n\">Bi</span><span class=\"bp\">↑</span> <span class=\"n\">Ci</span><span class=\"bp\">↓</span>\n<span class=\"bp\">|</span> <span class=\"n\">cut</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"o\">:</span> <span class=\"n\">Form</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">ai</span> <span class=\"n\">ni</span> <span class=\"o\">:</span> <span class=\"n\">ℕ</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">Bi</span> <span class=\"n\">Ci</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">dual</span> <span class=\"n\">A</span> <span class=\"n\">ai</span> <span class=\"n\">ni</span> <span class=\"n\">Bi</span> <span class=\"n\">Ci</span> <span class=\"bp\">→</span> <span class=\"n\">steps</span> <span class=\"o\">(</span><span class=\"n\">Link.cut</span> <span class=\"n\">ai</span> <span class=\"n\">ni</span> <span class=\"n\">A</span><span class=\"o\">)</span> <span class=\"n\">Bi</span><span class=\"bp\">↓</span> <span class=\"n\">Ci</span><span class=\"bp\">↑</span>\n<span class=\"bp\">|</span> <span class=\"n\">con</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"o\">:</span> <span class=\"n\">Form</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">ai</span> <span class=\"o\">:</span> <span class=\"n\">ℕ</span><span class=\"o\">)</span>            <span class=\"o\">:</span> <span class=\"n\">steps</span> <span class=\"o\">(</span><span class=\"n\">Link.con</span> <span class=\"n\">ai</span> <span class=\"n\">A</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">A</span><span class=\"o\">,</span> <span class=\"n\">ai</span><span class=\"o\">)</span><span class=\"bp\">↓</span> <span class=\"o\">(</span><span class=\"n\">A</span><span class=\"o\">,</span><span class=\"n\">ai</span><span class=\"o\">)</span><span class=\"bp\">↑</span>\n<span class=\"bp\">|</span> <span class=\"n\">tensor</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"n\">B</span> <span class=\"o\">:</span> <span class=\"n\">Form</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">ai</span> <span class=\"n\">bi</span> <span class=\"n\">ci</span> <span class=\"o\">:</span> <span class=\"n\">ℕ</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">x</span> <span class=\"n\">y</span><span class=\"o\">)</span> <span class=\"o\">:</span>\n  <span class=\"n\">T.flip</span> <span class=\"n\">steps_tensor</span> <span class=\"o\">(</span><span class=\"n\">A</span><span class=\"o\">,</span> <span class=\"n\">ai</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">B</span><span class=\"o\">,</span> <span class=\"n\">bi</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"bp\">⊗</span> <span class=\"n\">B</span><span class=\"o\">,</span> <span class=\"n\">ci</span><span class=\"o\">)</span> <span class=\"n\">x</span> <span class=\"n\">y</span> <span class=\"bp\">→</span>\n  <span class=\"n\">steps</span> <span class=\"o\">(</span><span class=\"n\">Link.tensor</span> <span class=\"n\">ai</span> <span class=\"n\">bi</span> <span class=\"n\">ci</span> <span class=\"n\">A</span> <span class=\"n\">B</span><span class=\"o\">)</span> <span class=\"n\">x</span> <span class=\"n\">y</span>\n<span class=\"bp\">|</span> <span class=\"n\">par</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"n\">B</span> <span class=\"o\">:</span> <span class=\"n\">Form</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">ai</span> <span class=\"n\">bi</span> <span class=\"n\">ci</span> <span class=\"o\">:</span> <span class=\"n\">ℕ</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">x</span> <span class=\"n\">y</span><span class=\"o\">)</span> <span class=\"o\">:</span>\n  <span class=\"n\">T.flip</span> <span class=\"n\">steps_par</span> <span class=\"o\">(</span><span class=\"n\">A</span><span class=\"o\">,</span> <span class=\"n\">ai</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">B</span><span class=\"o\">,</span> <span class=\"n\">bi</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"n\">⅋</span> <span class=\"n\">B</span><span class=\"o\">,</span> <span class=\"n\">ci</span><span class=\"o\">)</span> <span class=\"n\">x</span> <span class=\"n\">y</span> <span class=\"bp\">→</span>\n  <span class=\"n\">steps</span> <span class=\"o\">(</span><span class=\"n\">Link.par</span> <span class=\"n\">ai</span> <span class=\"n\">bi</span> <span class=\"n\">ci</span> <span class=\"n\">A</span> <span class=\"n\">B</span><span class=\"o\">)</span> <span class=\"n\">x</span> <span class=\"n\">y</span>\n\n<span class=\"kd\">theorem</span> <span class=\"n\">steps_unique_prev</span> <span class=\"o\">(</span><span class=\"n\">T</span> <span class=\"o\">:</span> <span class=\"n\">switch</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"bp\">Δ</span> <span class=\"o\">:</span> <span class=\"n\">Link</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">X</span> <span class=\"n\">Y</span> <span class=\"n\">Z</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">steps</span> <span class=\"n\">T</span> <span class=\"bp\">Δ</span> <span class=\"n\">X</span> <span class=\"n\">Z</span> <span class=\"bp\">→</span> <span class=\"n\">steps</span> <span class=\"n\">T</span> <span class=\"bp\">Δ</span> <span class=\"n\">Y</span> <span class=\"n\">Z</span> <span class=\"bp\">→</span> <span class=\"n\">X</span> <span class=\"bp\">=</span> <span class=\"n\">Y</span> <span class=\"o\">:=</span>\n<span class=\"kd\">begin</span>\n  <span class=\"n\">intros</span> <span class=\"n\">s₁</span> <span class=\"n\">s₂</span><span class=\"o\">,</span>\n  <span class=\"n\">cases</span> <span class=\"n\">s₁</span> <span class=\"k\">with</span> <span class=\"n\">A</span> <span class=\"n\">ai</span> <span class=\"n\">ni</span> <span class=\"n\">Bi</span> <span class=\"n\">Ci</span> <span class=\"n\">dBC</span> <span class=\"n\">A</span> <span class=\"n\">ai</span> <span class=\"n\">ni</span> <span class=\"n\">Bi</span> <span class=\"n\">Ci</span> <span class=\"n\">dBC</span> <span class=\"n\">A</span> <span class=\"n\">ai</span> <span class=\"n\">A</span> <span class=\"n\">B</span> <span class=\"n\">ai</span> <span class=\"n\">bi</span> <span class=\"n\">ci</span> <span class=\"n\">x</span> <span class=\"n\">y</span> <span class=\"n\">t₁</span> <span class=\"n\">A</span> <span class=\"n\">B</span> <span class=\"n\">ai</span> <span class=\"n\">bi</span> <span class=\"n\">ci</span> <span class=\"n\">x</span> <span class=\"n\">y</span> <span class=\"n\">p₁</span><span class=\"o\">,</span>\n<span class=\"kd\">end</span>\n</code></pre></div>",
        "id": 242690644,
        "sender_full_name": "Billy Price",
        "timestamp": 1623736306
    },
    {
        "content": "<p>Okay it's been a while since I wrote lean and I just remembered the <code>case</code> syntax.</p>",
        "id": 242690724,
        "sender_full_name": "Billy Price",
        "timestamp": 1623736397
    },
    {
        "content": "<p>I'm running into this error</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"n\">cases</span> <span class=\"n\">tactic</span> <span class=\"n\">failed</span><span class=\"o\">,</span> <span class=\"n\">when</span> <span class=\"n\">eliminating</span> <span class=\"n\">equality</span> <span class=\"n\">left</span><span class=\"bp\">-</span><span class=\"n\">hand</span><span class=\"bp\">-</span><span class=\"n\">side</span> <span class=\"n\">depends</span> <span class=\"n\">on</span> <span class=\"n\">right</span><span class=\"bp\">-</span><span class=\"n\">hand</span><span class=\"bp\">-</span><span class=\"n\">side</span>\n<span class=\"n\">state</span><span class=\"o\">:</span>\n<span class=\"n\">T</span> <span class=\"o\">:</span> <span class=\"n\">switch</span><span class=\"o\">,</span>\n<span class=\"n\">A</span> <span class=\"o\">:</span> <span class=\"n\">Form</span><span class=\"o\">,</span>\n<span class=\"n\">ai</span> <span class=\"n\">ni</span> <span class=\"o\">:</span> <span class=\"n\">ℕ</span><span class=\"o\">,</span>\n<span class=\"n\">dBC</span> <span class=\"o\">:</span> <span class=\"n\">dual</span> <span class=\"n\">A</span> <span class=\"n\">ai</span> <span class=\"n\">ni</span> <span class=\"o\">(</span><span class=\"n\">A</span><span class=\"o\">,</span> <span class=\"n\">ai</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"bp\">~</span><span class=\"n\">A</span><span class=\"o\">,</span> <span class=\"n\">ni</span><span class=\"o\">),</span>\n<span class=\"n\">s₁</span> <span class=\"o\">:</span> <span class=\"n\">steps</span> <span class=\"n\">T</span> <span class=\"o\">(</span><span class=\"n\">Link.ax</span> <span class=\"n\">ai</span> <span class=\"n\">ni</span> <span class=\"n\">A</span><span class=\"o\">)</span> <span class=\"o\">((</span><span class=\"n\">A</span><span class=\"o\">,</span> <span class=\"n\">ai</span><span class=\"o\">),</span> <span class=\"n\">up</span><span class=\"o\">)</span> <span class=\"o\">((</span><span class=\"bp\">~</span><span class=\"n\">A</span><span class=\"o\">,</span> <span class=\"n\">ni</span><span class=\"o\">),</span> <span class=\"n\">down</span><span class=\"o\">),</span>\n<span class=\"n\">s₂</span> <span class=\"o\">:</span> <span class=\"n\">steps</span> <span class=\"n\">T</span> <span class=\"o\">(</span><span class=\"n\">Link.ax</span> <span class=\"n\">ai</span> <span class=\"n\">ni</span> <span class=\"n\">A</span><span class=\"o\">)</span> <span class=\"o\">((</span><span class=\"bp\">~</span><span class=\"n\">A</span><span class=\"o\">,</span> <span class=\"n\">ni</span><span class=\"o\">),</span> <span class=\"n\">up</span><span class=\"o\">)</span> <span class=\"o\">((</span><span class=\"bp\">~</span><span class=\"n\">A</span><span class=\"o\">,</span> <span class=\"n\">ni</span><span class=\"o\">),</span> <span class=\"n\">down</span><span class=\"o\">),</span>\n<span class=\"n\">d₂</span> <span class=\"o\">:</span> <span class=\"n\">dual</span> <span class=\"n\">A</span> <span class=\"n\">ai</span> <span class=\"n\">ni</span> <span class=\"o\">(</span><span class=\"bp\">~</span><span class=\"n\">A</span><span class=\"o\">,</span> <span class=\"n\">ni</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"bp\">~</span><span class=\"n\">A</span><span class=\"o\">,</span> <span class=\"n\">ni</span><span class=\"o\">)</span>\n<span class=\"bp\">⊢</span> <span class=\"o\">(</span><span class=\"bp\">~</span><span class=\"n\">A</span><span class=\"o\">)</span> <span class=\"bp\">=</span> <span class=\"n\">A</span> <span class=\"bp\">→</span> <span class=\"n\">ni</span> <span class=\"bp\">=</span> <span class=\"n\">ai</span> <span class=\"bp\">→</span> <span class=\"n\">d₂</span> <span class=\"bp\">==</span> <span class=\"n\">dual.negpos</span> <span class=\"bp\">→</span> <span class=\"o\">(</span><span class=\"n\">A</span><span class=\"o\">,</span> <span class=\"n\">ai</span><span class=\"o\">)</span> <span class=\"bp\">=</span> <span class=\"o\">(</span><span class=\"bp\">~</span><span class=\"n\">A</span><span class=\"o\">,</span> <span class=\"n\">ni</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>here's my proof so far (compatible with mwe above)</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kd\">theorem</span> <span class=\"n\">steps_unique_prev</span> <span class=\"o\">(</span><span class=\"n\">T</span> <span class=\"o\">:</span> <span class=\"n\">switch</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"bp\">Δ</span> <span class=\"o\">:</span> <span class=\"n\">Link</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">X</span> <span class=\"n\">Y</span> <span class=\"n\">Z</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">steps</span> <span class=\"n\">T</span> <span class=\"bp\">Δ</span> <span class=\"n\">X</span> <span class=\"n\">Z</span> <span class=\"bp\">→</span> <span class=\"n\">steps</span> <span class=\"n\">T</span> <span class=\"bp\">Δ</span> <span class=\"n\">Y</span> <span class=\"n\">Z</span> <span class=\"bp\">→</span> <span class=\"n\">X</span> <span class=\"bp\">=</span> <span class=\"n\">Y</span> <span class=\"o\">:=</span>\n<span class=\"kd\">begin</span>\n  <span class=\"n\">intros</span> <span class=\"n\">s₁</span> <span class=\"n\">s₂</span><span class=\"o\">,</span>\n  <span class=\"n\">cases</span> <span class=\"n\">s₁</span><span class=\"o\">,</span>\n  <span class=\"n\">case</span> <span class=\"n\">steps.ax</span> <span class=\"o\">:</span> <span class=\"n\">A</span> <span class=\"n\">ai</span> <span class=\"n\">ni</span> <span class=\"n\">Bi</span> <span class=\"n\">Ci</span> <span class=\"n\">dBC</span> <span class=\"o\">{</span> <span class=\"n\">cases</span> <span class=\"n\">dBC</span><span class=\"o\">,</span> <span class=\"n\">cases</span> <span class=\"n\">s₂</span> <span class=\"k\">with</span> <span class=\"n\">_</span> <span class=\"n\">_</span> <span class=\"n\">_</span> <span class=\"n\">Di</span> <span class=\"n\">_</span> <span class=\"n\">d₂</span><span class=\"o\">,</span> <span class=\"n\">congr</span><span class=\"o\">,</span> <span class=\"n\">cases</span> <span class=\"n\">d₂</span><span class=\"o\">,</span> <span class=\"o\">},</span>\n<span class=\"kd\">end</span>\n</code></pre></div>",
        "id": 242691181,
        "sender_full_name": "Billy Price",
        "timestamp": 1623736978
    },
    {
        "content": "<p>I completely agree with the error, i.e. that it shouldn't be able to solve <code>(~A) = A</code>, but then shouldn't it throw out the <code>negpos</code> case as a possible constructor for <code>d₂: dual A ai ni Di (~A, ni)</code>?</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kd\">inductive</span> <span class=\"n\">dual</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"o\">:</span> <span class=\"n\">Form</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">ai</span> <span class=\"n\">ni</span> <span class=\"o\">:</span> <span class=\"n\">ℕ</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">Form_occ</span> <span class=\"bp\">→</span> <span class=\"n\">Form_occ</span> <span class=\"bp\">→</span> <span class=\"kt\">Prop</span>\n<span class=\"bp\">|</span> <span class=\"n\">posneg</span> <span class=\"o\">:</span> <span class=\"n\">dual</span> <span class=\"o\">(</span><span class=\"n\">A</span><span class=\"o\">,</span><span class=\"n\">ai</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"bp\">~</span><span class=\"n\">A</span><span class=\"o\">,</span><span class=\"n\">ni</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"n\">negpos</span> <span class=\"o\">:</span> <span class=\"n\">dual</span> <span class=\"o\">(</span><span class=\"bp\">~</span><span class=\"n\">A</span><span class=\"o\">,</span><span class=\"n\">ni</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">A</span><span class=\"o\">,</span><span class=\"n\">ai</span><span class=\"o\">)</span>\n</code></pre></div>",
        "id": 242692362,
        "sender_full_name": "Billy Price",
        "timestamp": 1623738357
    },
    {
        "content": "<p>You can also use <code>rcases</code> instead of <code>cases</code> followed by <code>case</code>; it allows you to write all the variables at the top but grouped by constructor like <code>rcases s1 with &lt;A, ai, ni, Bi, Ci, dBC&gt; | &lt;A, ai, ni, Bi, Ci, dBC&gt; | ...</code></p>",
        "id": 242693472,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1623739391
    },
    {
        "content": "<p>probably for an inductive as big as this <code>case</code> is preferable</p>",
        "id": 242693489,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1623739410
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kd\">theorem</span> <span class=\"n\">dual_unique_prev</span> <span class=\"o\">{</span><span class=\"n\">A</span> <span class=\"n\">ai</span> <span class=\"n\">ni</span> <span class=\"n\">Bi</span> <span class=\"n\">Ci</span> <span class=\"n\">Di</span><span class=\"o\">}</span>\n  <span class=\"o\">(</span><span class=\"n\">d₁</span> <span class=\"o\">:</span> <span class=\"n\">dual</span> <span class=\"n\">A</span> <span class=\"n\">ai</span> <span class=\"n\">ni</span> <span class=\"n\">Bi</span> <span class=\"n\">Ci</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">d₂</span> <span class=\"o\">:</span> <span class=\"n\">dual</span> <span class=\"n\">A</span> <span class=\"n\">ai</span> <span class=\"n\">ni</span> <span class=\"n\">Di</span> <span class=\"n\">Ci</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">Bi</span> <span class=\"bp\">=</span> <span class=\"n\">Di</span> <span class=\"o\">:=</span>\n<span class=\"kd\">begin</span>\n  <span class=\"n\">generalize_hyp</span> <span class=\"n\">e</span> <span class=\"o\">:</span> <span class=\"n\">Ci</span> <span class=\"bp\">=</span> <span class=\"n\">Ci'</span> <span class=\"n\">at</span> <span class=\"n\">d₂</span><span class=\"o\">,</span>\n  <span class=\"k\">have</span> <span class=\"o\">:</span> <span class=\"n\">A</span> <span class=\"bp\">≠</span> <span class=\"bp\">~</span><span class=\"n\">A</span><span class=\"o\">,</span>\n  <span class=\"o\">{</span> <span class=\"n\">intro</span> <span class=\"n\">e</span><span class=\"o\">,</span>\n    <span class=\"n\">apply_fun</span> <span class=\"n\">Form.sizeof</span> <span class=\"n\">at</span> <span class=\"n\">e</span><span class=\"o\">,</span>\n    <span class=\"n\">refine</span> <span class=\"n\">ne_of_lt</span> <span class=\"n\">_</span> <span class=\"n\">e</span><span class=\"o\">,</span>\n    <span class=\"n\">rw</span> <span class=\"o\">[</span><span class=\"n\">Form.sizeof</span><span class=\"o\">,</span> <span class=\"n\">nat.add_comm</span><span class=\"o\">],</span> <span class=\"n\">exact</span> <span class=\"n\">nat.lt_succ_self</span> <span class=\"n\">_</span> <span class=\"o\">},</span>\n  <span class=\"n\">cases</span> <span class=\"n\">d₁</span><span class=\"bp\">;</span> <span class=\"n\">cases</span> <span class=\"n\">d₂</span><span class=\"bp\">;</span> <span class=\"n\">injection</span> <span class=\"n\">e</span> <span class=\"k\">with</span> <span class=\"n\">e1</span> <span class=\"n\">e2</span><span class=\"bp\">;</span> <span class=\"n\">cases</span> <span class=\"n\">e2</span><span class=\"bp\">;</span>\n  <span class=\"n\">try</span> <span class=\"o\">{</span> <span class=\"n\">cases</span> <span class=\"n\">e1</span> <span class=\"o\">}</span><span class=\"bp\">;</span> <span class=\"o\">[</span><span class=\"n\">refl</span><span class=\"o\">,</span> <span class=\"n\">cases</span> <span class=\"n\">this</span> <span class=\"n\">e1.symm</span><span class=\"o\">,</span> <span class=\"n\">cases</span> <span class=\"n\">this</span> <span class=\"n\">e1</span><span class=\"o\">,</span> <span class=\"n\">refl</span><span class=\"o\">]</span>\n<span class=\"kd\">end</span>\n\n<span class=\"kd\">theorem</span> <span class=\"n\">steps_unique_prev</span> <span class=\"o\">(</span><span class=\"n\">T</span> <span class=\"o\">:</span> <span class=\"n\">switch</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"bp\">Δ</span> <span class=\"o\">:</span> <span class=\"n\">Link</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">X</span> <span class=\"n\">Y</span> <span class=\"n\">Z</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">steps</span> <span class=\"n\">T</span> <span class=\"bp\">Δ</span> <span class=\"n\">X</span> <span class=\"n\">Z</span> <span class=\"bp\">→</span> <span class=\"n\">steps</span> <span class=\"n\">T</span> <span class=\"bp\">Δ</span> <span class=\"n\">Y</span> <span class=\"n\">Z</span> <span class=\"bp\">→</span> <span class=\"n\">X</span> <span class=\"bp\">=</span> <span class=\"n\">Y</span> <span class=\"o\">:=</span>\n<span class=\"kd\">begin</span>\n  <span class=\"n\">intros</span> <span class=\"n\">s₁</span> <span class=\"n\">s₂</span><span class=\"o\">,</span>\n  <span class=\"n\">cases</span> <span class=\"n\">s₁</span><span class=\"o\">,</span>\n  <span class=\"n\">case</span> <span class=\"n\">steps.ax</span> <span class=\"o\">:</span> <span class=\"n\">A</span> <span class=\"n\">ai</span> <span class=\"n\">ni</span> <span class=\"n\">Bi</span> <span class=\"n\">Ci</span> <span class=\"n\">dBC</span> <span class=\"o\">{</span>\n    <span class=\"n\">cases</span> <span class=\"n\">s₂</span> <span class=\"k\">with</span> <span class=\"n\">_</span> <span class=\"n\">_</span> <span class=\"n\">_</span> <span class=\"n\">Di</span> <span class=\"n\">_</span> <span class=\"n\">d₂</span><span class=\"o\">,</span>\n    <span class=\"n\">rw</span> <span class=\"n\">dual_unique_prev</span> <span class=\"n\">dBC</span> <span class=\"n\">d₂</span> <span class=\"o\">},</span>\n<span class=\"kd\">end</span>\n</code></pre></div>",
        "id": 242694370,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1623740173
    },
    {
        "content": "<p>wild - I would have expected ~A /= A to be as simple as nat.succ x /= x - or does that also require a proof like that?</p>",
        "id": 242694687,
        "sender_full_name": "Billy Price",
        "timestamp": 1623740469
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"255481\">Billy Price</span> <a href=\"#narrow/stream/236446-Type-theory/topic/Linear.20Logic/near/242692362\">said</a>:</p>\n<blockquote>\n<p>I completely agree with the error, i.e. that it shouldn't be able to solve <code>(~A) = A</code>, but then shouldn't it throw out the <code>negpos</code> case as a possible constructor for <code>d₂: dual A ai ni Di (~A, ni)</code>?</p>\n<p><div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kd\">inductive</span> <span class=\"n\">dual</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"o\">:</span> <span class=\"n\">Form</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">ai</span> <span class=\"n\">ni</span> <span class=\"o\">:</span> <span class=\"n\">ℕ</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">Form_occ</span> <span class=\"bp\">→</span> <span class=\"n\">Form_occ</span> <span class=\"bp\">→</span> <span class=\"kt\">Prop</span>\n<span class=\"bp\">|</span> <span class=\"n\">posneg</span> <span class=\"o\">:</span> <span class=\"n\">dual</span> <span class=\"o\">(</span><span class=\"n\">A</span><span class=\"o\">,</span><span class=\"n\">ai</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"bp\">~</span><span class=\"n\">A</span><span class=\"o\">,</span><span class=\"n\">ni</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"n\">negpos</span> <span class=\"o\">:</span> <span class=\"n\">dual</span> <span class=\"o\">(</span><span class=\"bp\">~</span><span class=\"n\">A</span><span class=\"o\">,</span><span class=\"n\">ni</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">A</span><span class=\"o\">,</span><span class=\"n\">ai</span><span class=\"o\">)</span>\n</code></pre></div><br>\n</p>\n</blockquote>\n<p>The problem isn't that it can't solve <code>(~A) = A</code>, but it can't solve or refute it. It is possible to refute with a proof (the <code>have</code> in my proof), but this proof isn't obvious to lean</p>",
        "id": 242694696,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1623740478
    },
    {
        "content": "<p>The proof of ~A != A is being reduced to the proof that nat.succ x != x here</p>",
        "id": 242694727,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1623740507
    },
    {
        "content": "<p>I'm taking advantage of the fact that there is already a function <code>Form.sizeof : Form -&gt; nat</code> such that <code>sizeof (~A) = sizeof A + 1</code></p>",
        "id": 242694810,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1623740553
    },
    {
        "content": "<p>this function is defined automatically and used as a component in the equation compiler</p>",
        "id": 242694829,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1623740573
    },
    {
        "content": "<p>oh right - but how is  n /= n+1 proved?</p>",
        "id": 242694839,
        "sender_full_name": "Billy Price",
        "timestamp": 1623740586
    },
    {
        "content": "<p>by induction</p>",
        "id": 242694847,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1623740591
    },
    {
        "content": "<p>you can also prove this form theorem by induction</p>",
        "id": 242694856,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1623740600
    },
    {
        "content": "<p>is this not \"easy\" to do for any inductive type? I thought it was essentially a theorem about injectivity of inductively defined things</p>",
        "id": 242694952,
        "sender_full_name": "Billy Price",
        "timestamp": 1623740663
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kd\">theorem</span> <span class=\"n\">ne_neg_self</span> <span class=\"o\">:</span> <span class=\"bp\">∀</span> <span class=\"n\">A</span> <span class=\"o\">:</span> <span class=\"n\">Form</span><span class=\"o\">,</span> <span class=\"n\">A</span> <span class=\"bp\">≠</span> <span class=\"bp\">~</span><span class=\"n\">A</span>\n<span class=\"bp\">|</span> <span class=\"o\">(</span><span class=\"n\">Form.neg</span> <span class=\"n\">A</span><span class=\"o\">)</span> <span class=\"n\">e</span> <span class=\"o\">:=</span> <span class=\"n\">ne_neg_self</span> <span class=\"n\">_</span> <span class=\"o\">(</span><span class=\"n\">Form.neg.inj</span> <span class=\"n\">e</span><span class=\"o\">)</span>\n</code></pre></div>",
        "id": 242695014,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1623740726
    },
    {
        "content": "<p>it's not an \"easy\" theorem in that sense, because <code>A</code> shows up on both sides</p>",
        "id": 242695039,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1623740753
    },
    {
        "content": "<p>it's not injectivity of the constructor, for example</p>",
        "id": 242695090,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1623740767
    },
    {
        "content": "<p>This generalizes to theorems saying that <code>A != ~~(A ⅋ B) ⊗ C</code> for example, and the general proof approach uses <code>sizeof</code> to prove that the size of <code>A</code> has to be less than itself</p>",
        "id": 242695162,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1623740851
    },
    {
        "content": "<p>It just seems like they could all be bowled over by some theorem saying that if f(A) = g(A) where f and g are combinations of constructors  then f = g at some level between syntax and semantics.</p>",
        "id": 242695431,
        "sender_full_name": "Billy Price",
        "timestamp": 1623741045
    },
    {
        "content": "<p>If not a theorem then at least a tactic that does what you did</p>",
        "id": 242695447,
        "sender_full_name": "Billy Price",
        "timestamp": 1623741061
    },
    {
        "content": "<p>Not complaining I'm just surprised lean doesn't take care of it</p>",
        "id": 242695491,
        "sender_full_name": "Billy Price",
        "timestamp": 1623741103
    },
    {
        "content": "<p>That's injectivity, and there are tactics for that (<code>cases</code> and <code>injection</code>)</p>",
        "id": 242695503,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1623741111
    },
    {
        "content": "<p>It seems clear that that should extend to the case where f is the \"identity pattern\"</p>",
        "id": 242695616,
        "sender_full_name": "Billy Price",
        "timestamp": 1623741189
    },
    {
        "content": "<p>Actually maybe I don't know what you mean</p>",
        "id": 242695636,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1623741218
    },
    {
        "content": "<p>what is <code>f</code>?</p>",
        "id": 242695651,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1623741233
    },
    {
        "content": "<p>Wait isn't injectivity f(A) = f(B) =&gt; A = B? not what I wrote</p>",
        "id": 242695708,
        "sender_full_name": "Billy Price",
        "timestamp": 1623741248
    },
    {
        "content": "<p>A tactic could do what I did, yes. It doesn't exist and it's a little hard to detect the case of interest</p>",
        "id": 242695730,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1623741269
    },
    {
        "content": "<p>f is like any pattern of constructors</p>",
        "id": 242695735,
        "sender_full_name": "Billy Price",
        "timestamp": 1623741271
    },
    {
        "content": "<p>I think this is false</p>",
        "id": 242695748,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1623741282
    },
    {
        "content": "<p>like <code>A ⊗ B = B ⊗ A</code> does not imply <code>(\\lam x, x ⊗ B) = (\\lam x, B ⊗ x)</code></p>",
        "id": 242695813,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1623741339
    },
    {
        "content": "<p>oh of course, I've gone wrong somewhere</p>",
        "id": 242695897,
        "sender_full_name": "Billy Price",
        "timestamp": 1623741380
    },
    {
        "content": "<p>the actual theorem I'm using is that a term cannot be a strict subterm of itself</p>",
        "id": 242695917,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1623741395
    },
    {
        "content": "<p>and the proof is to map terms to sizes (natural numbers or other well ordered type) such that strict subterm implies strict inequality</p>",
        "id": 242695989,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1623741450
    },
    {
        "content": "<p>but there is no general definition of \"strict subterm\" in lean</p>",
        "id": 242696017,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1623741481
    },
    {
        "content": "<p>that would presumably be part of the aforementioned tactic</p>",
        "id": 242696071,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1623741503
    },
    {
        "content": "<p>ah okay, why not? is it something to do with different expressions being the same term or something?</p>",
        "id": 242696100,
        "sender_full_name": "Billy Price",
        "timestamp": 1623741523
    },
    {
        "content": "<p>the definition has to be created on the fly for every inductive</p>",
        "id": 242696137,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1623741563
    },
    {
        "content": "<p>and this particular definition is only useful if you want this acyclicity tactic; it doesn't come up in the equation compiler so no one bothered</p>",
        "id": 242696178,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1623741598
    },
    {
        "content": "<p>I mean it seems clear to me that something like this could come up fairly often with <code>cases</code></p>",
        "id": 242696299,
        "sender_full_name": "Billy Price",
        "timestamp": 1623741678
    },
    {
        "content": "<p>But I appreciate what I've got to work with. Lean is great. Thanks Mario <span aria-label=\"pray\" class=\"emoji emoji-1f64f\" role=\"img\" title=\"pray\">:pray:</span></p>",
        "id": 242696425,
        "sender_full_name": "Billy Price",
        "timestamp": 1623741762
    },
    {
        "content": "<p>I think this particular goal came up because of the way <code>dual</code> is defined</p>",
        "id": 242696442,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1623741775
    },
    {
        "content": "<p>sure, but is it that an odd usage?</p>",
        "id": 242696614,
        "sender_full_name": "Billy Price",
        "timestamp": 1623741889
    },
    {
        "content": "<p>By the way, in the notes, <code>~</code> is not an inductive constructor, it is an involution on <code>Form</code></p>",
        "id": 242696620,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1623741895
    },
    {
        "content": "<p>so this lemma about <code>A = ~A</code> is not necessary because the two constructors of <code>dual</code> are the same</p>",
        "id": 242696768,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1623741987
    },
    {
        "content": "<p>Oh yeah, I'm not following the notes in that sense because I thought it would be too complicated. My Form is the PreForm from the notes.</p>",
        "id": 242697743,
        "sender_full_name": "Billy Price",
        "timestamp": 1623742739
    },
    {
        "content": "<p>Though it would be more desirable to prove these things for the real formulas, not just Preforms.</p>",
        "id": 242697782,
        "sender_full_name": "Billy Price",
        "timestamp": 1623742800
    },
    {
        "content": "<p>If I were to do that, would it be more sensible to introduce an equivalence relation on my inductive definition of <code>Form</code>? Or would I make a class/structure over some abstract type with negation, tensor and par operations satisfying ~~A = A, and the de morgan laws?</p>",
        "id": 242697932,
        "sender_full_name": "Billy Price",
        "timestamp": 1623742908
    },
    {
        "content": "<p>How is this possible?</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"n\">rewrite</span> <span class=\"n\">tactic</span> <span class=\"n\">failed</span><span class=\"o\">,</span> <span class=\"n\">did</span> <span class=\"n\">not</span> <span class=\"n\">find</span> <span class=\"kd\">instance</span> <span class=\"n\">of</span> <span class=\"n\">the</span> <span class=\"n\">pattern</span> <span class=\"k\">in</span> <span class=\"n\">the</span> <span class=\"n\">target</span> <span class=\"n\">expression</span>\n  <span class=\"n\">switch.flip</span> <span class=\"bp\">?</span><span class=\"n\">m_3</span> <span class=\"n\">L</span> <span class=\"bp\">?</span><span class=\"n\">m_4</span> <span class=\"bp\">?</span><span class=\"n\">m_5</span>\n<span class=\"n\">state</span><span class=\"o\">:</span>\n<span class=\"n\">case</span> <span class=\"n\">bool.ff</span>\n<span class=\"n\">X</span> <span class=\"n\">Y</span> <span class=\"n\">y</span> <span class=\"o\">:</span> <span class=\"n\">Form_occ</span> <span class=\"bp\">×</span> <span class=\"n\">dir</span><span class=\"o\">,</span>\n<span class=\"n\">A</span> <span class=\"n\">B</span> <span class=\"o\">:</span> <span class=\"n\">Form</span><span class=\"o\">,</span>\n<span class=\"n\">ai</span> <span class=\"n\">bi</span> <span class=\"n\">ci</span> <span class=\"o\">:</span> <span class=\"n\">ℕ</span><span class=\"o\">,</span>\n<span class=\"n\">s₁</span> <span class=\"o\">:</span> <span class=\"n\">steps</span> <span class=\"n\">ff</span> <span class=\"o\">(</span><span class=\"n\">Link.tensor</span> <span class=\"n\">ai</span> <span class=\"n\">bi</span> <span class=\"n\">ci</span> <span class=\"n\">A</span> <span class=\"n\">B</span><span class=\"o\">)</span> <span class=\"n\">X</span> <span class=\"n\">y</span><span class=\"o\">,</span>\n<span class=\"n\">t₁</span> <span class=\"o\">:</span> <span class=\"n\">switch.flip</span> <span class=\"n\">steps_tensor</span> <span class=\"n\">ff</span> <span class=\"o\">(</span><span class=\"n\">A</span><span class=\"o\">,</span> <span class=\"n\">ai</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">B</span><span class=\"o\">,</span> <span class=\"n\">bi</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"bp\">⊗</span> <span class=\"n\">B</span><span class=\"o\">,</span> <span class=\"n\">ci</span><span class=\"o\">)</span> <span class=\"n\">X</span> <span class=\"n\">y</span><span class=\"o\">,</span>\n<span class=\"n\">t₂</span> <span class=\"o\">:</span> <span class=\"n\">switch.flip</span> <span class=\"n\">steps_tensor</span> <span class=\"n\">ff</span> <span class=\"o\">(</span><span class=\"n\">A</span><span class=\"o\">,</span> <span class=\"n\">ai</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">B</span><span class=\"o\">,</span> <span class=\"n\">bi</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"bp\">⊗</span> <span class=\"n\">B</span><span class=\"o\">,</span> <span class=\"n\">ci</span><span class=\"o\">)</span> <span class=\"n\">Y</span> <span class=\"n\">y</span>\n<span class=\"bp\">⊢</span> <span class=\"n\">X</span> <span class=\"bp\">=</span> <span class=\"n\">Y</span>\n</code></pre></div>\n<p>here's where I'm at - I originally tried to do <code>simp</code> but it wouldn't recognise it so I added <code>flip_L</code> and <code>flip_R</code></p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kn\">import</span> <span class=\"n\">tactic</span>\n\n<span class=\"kd\">inductive</span> <span class=\"n\">Form</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span>\n<span class=\"bp\">|</span> <span class=\"n\">atom</span> <span class=\"o\">:</span> <span class=\"n\">ℕ</span> <span class=\"bp\">→</span> <span class=\"n\">Form</span>\n<span class=\"bp\">|</span> <span class=\"n\">tensor</span> <span class=\"o\">:</span> <span class=\"n\">Form</span> <span class=\"bp\">→</span> <span class=\"n\">Form</span> <span class=\"bp\">→</span> <span class=\"n\">Form</span>\n<span class=\"bp\">|</span> <span class=\"n\">par</span> <span class=\"o\">:</span> <span class=\"n\">Form</span> <span class=\"bp\">→</span> <span class=\"n\">Form</span> <span class=\"bp\">→</span> <span class=\"n\">Form</span>\n<span class=\"bp\">|</span> <span class=\"n\">neg</span> <span class=\"o\">:</span> <span class=\"n\">Form</span> <span class=\"bp\">→</span> <span class=\"n\">Form</span>\n\n<span class=\"kd\">infix</span> <span class=\"bp\">`</span> <span class=\"bp\">⊗</span> <span class=\"bp\">`</span><span class=\"o\">:</span><span class=\"mi\">70</span> <span class=\"o\">:=</span> <span class=\"n\">Form.tensor</span>\n<span class=\"kd\">infix</span> <span class=\"bp\">`</span> <span class=\"n\">⅋</span> <span class=\"bp\">`</span><span class=\"o\">:</span><span class=\"mi\">65</span> <span class=\"o\">:=</span> <span class=\"n\">Form.par</span>\n<span class=\"kd\">prefix</span> <span class=\"bp\">`~`</span> <span class=\"o\">:=</span> <span class=\"n\">Form.neg</span>\n\n<span class=\"kd\">inductive</span> <span class=\"n\">Link</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span>\n<span class=\"bp\">|</span> <span class=\"n\">ax</span> <span class=\"o\">:</span> <span class=\"n\">ℕ</span> <span class=\"bp\">→</span> <span class=\"n\">ℕ</span> <span class=\"bp\">→</span> <span class=\"n\">Form</span> <span class=\"bp\">→</span> <span class=\"n\">Link</span>\n<span class=\"bp\">|</span> <span class=\"n\">cut</span> <span class=\"o\">:</span> <span class=\"n\">ℕ</span> <span class=\"bp\">→</span> <span class=\"n\">ℕ</span> <span class=\"bp\">→</span> <span class=\"n\">Form</span> <span class=\"bp\">→</span> <span class=\"n\">Link</span>\n<span class=\"bp\">|</span> <span class=\"n\">tensor</span> <span class=\"o\">:</span> <span class=\"n\">ℕ</span> <span class=\"bp\">→</span> <span class=\"n\">ℕ</span> <span class=\"bp\">→</span> <span class=\"n\">ℕ</span> <span class=\"bp\">→</span> <span class=\"n\">Form</span> <span class=\"bp\">→</span> <span class=\"n\">Form</span> <span class=\"bp\">→</span> <span class=\"n\">Link</span>\n<span class=\"bp\">|</span> <span class=\"n\">par</span> <span class=\"o\">:</span> <span class=\"n\">ℕ</span> <span class=\"bp\">→</span> <span class=\"n\">ℕ</span> <span class=\"bp\">→</span> <span class=\"n\">ℕ</span> <span class=\"bp\">→</span> <span class=\"n\">Form</span> <span class=\"bp\">→</span> <span class=\"n\">Form</span> <span class=\"bp\">→</span> <span class=\"n\">Link</span>\n<span class=\"bp\">|</span> <span class=\"n\">con</span> <span class=\"o\">:</span> <span class=\"n\">ℕ</span> <span class=\"bp\">→</span> <span class=\"n\">Form</span> <span class=\"bp\">→</span> <span class=\"n\">Link</span>\n\n<span class=\"kd\">def</span> <span class=\"n\">Form_occ</span> <span class=\"o\">:=</span> <span class=\"n\">Form</span> <span class=\"bp\">×</span> <span class=\"n\">ℕ</span>\n\n<span class=\"kd\">def</span> <span class=\"n\">is_premise</span> <span class=\"o\">(</span><span class=\"n\">Ai</span> <span class=\"o\">:</span> <span class=\"n\">Form_occ</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">Link</span> <span class=\"bp\">→</span> <span class=\"kt\">Prop</span>\n<span class=\"bp\">|</span> <span class=\"o\">(</span><span class=\"n\">Link.ax</span> <span class=\"n\">n</span> <span class=\"n\">m</span> <span class=\"n\">B</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"n\">false</span>\n<span class=\"bp\">|</span> <span class=\"o\">(</span><span class=\"n\">Link.cut</span> <span class=\"n\">n</span> <span class=\"n\">m</span> <span class=\"n\">B</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"o\">(</span><span class=\"n\">Ai</span> <span class=\"bp\">=</span> <span class=\"o\">⟨</span><span class=\"n\">B</span><span class=\"o\">,</span><span class=\"n\">n</span><span class=\"o\">⟩)</span> <span class=\"bp\">∨</span> <span class=\"o\">(</span><span class=\"n\">Ai</span> <span class=\"bp\">=</span> <span class=\"o\">⟨</span><span class=\"bp\">~</span><span class=\"n\">B</span><span class=\"o\">,</span><span class=\"n\">m</span><span class=\"o\">⟩)</span>\n<span class=\"bp\">|</span> <span class=\"o\">(</span><span class=\"n\">Link.tensor</span> <span class=\"n\">n</span> <span class=\"n\">m</span> <span class=\"n\">k</span> <span class=\"n\">A</span> <span class=\"n\">B</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"o\">(</span><span class=\"n\">Ai</span> <span class=\"bp\">=</span> <span class=\"o\">⟨</span><span class=\"n\">A</span><span class=\"o\">,</span><span class=\"n\">n</span><span class=\"o\">⟩)</span> <span class=\"bp\">∨</span> <span class=\"o\">(</span><span class=\"n\">Ai</span> <span class=\"bp\">=</span> <span class=\"o\">⟨</span><span class=\"n\">B</span><span class=\"o\">,</span><span class=\"n\">m</span><span class=\"o\">⟩)</span>\n<span class=\"bp\">|</span> <span class=\"o\">(</span><span class=\"n\">Link.par</span> <span class=\"n\">n</span> <span class=\"n\">m</span> <span class=\"n\">k</span> <span class=\"n\">A</span> <span class=\"n\">B</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"o\">(</span><span class=\"n\">Ai</span> <span class=\"bp\">=</span> <span class=\"o\">⟨</span><span class=\"n\">A</span><span class=\"o\">,</span><span class=\"n\">n</span><span class=\"o\">⟩)</span> <span class=\"bp\">∨</span> <span class=\"o\">(</span><span class=\"n\">Ai</span> <span class=\"bp\">=</span> <span class=\"o\">⟨</span><span class=\"n\">B</span><span class=\"o\">,</span><span class=\"n\">m</span><span class=\"o\">⟩)</span>\n<span class=\"bp\">|</span> <span class=\"o\">(</span><span class=\"n\">Link.con</span> <span class=\"n\">n</span> <span class=\"n\">A</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"n\">Ai</span> <span class=\"bp\">=</span> <span class=\"o\">⟨</span><span class=\"n\">A</span><span class=\"o\">,</span><span class=\"n\">n</span><span class=\"o\">⟩</span>\n\n<span class=\"kd\">def</span> <span class=\"n\">is_conclusion</span> <span class=\"o\">(</span><span class=\"n\">Ai</span> <span class=\"o\">:</span> <span class=\"n\">Form_occ</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">Link</span> <span class=\"bp\">→</span> <span class=\"kt\">Prop</span>\n<span class=\"bp\">|</span> <span class=\"o\">(</span><span class=\"n\">Link.ax</span> <span class=\"n\">n</span> <span class=\"n\">m</span> <span class=\"n\">B</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"o\">(</span><span class=\"n\">Ai</span> <span class=\"bp\">=</span> <span class=\"o\">⟨</span><span class=\"n\">B</span><span class=\"o\">,</span><span class=\"n\">n</span><span class=\"o\">⟩)</span> <span class=\"bp\">∨</span> <span class=\"o\">(</span><span class=\"n\">Ai</span> <span class=\"bp\">=</span> <span class=\"o\">⟨</span><span class=\"bp\">~</span><span class=\"n\">B</span><span class=\"o\">,</span><span class=\"n\">m</span><span class=\"o\">⟩)</span>\n<span class=\"bp\">|</span> <span class=\"o\">(</span><span class=\"n\">Link.cut</span> <span class=\"n\">n</span> <span class=\"n\">m</span> <span class=\"n\">B</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"n\">false</span>\n<span class=\"bp\">|</span> <span class=\"o\">(</span><span class=\"n\">Link.tensor</span> <span class=\"n\">n</span> <span class=\"n\">m</span> <span class=\"n\">k</span> <span class=\"n\">A</span> <span class=\"n\">B</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"n\">Ai</span> <span class=\"bp\">=</span> <span class=\"o\">⟨</span><span class=\"n\">A</span> <span class=\"bp\">⊗</span> <span class=\"n\">B</span><span class=\"o\">,</span><span class=\"n\">k</span><span class=\"o\">⟩</span>\n<span class=\"bp\">|</span> <span class=\"o\">(</span><span class=\"n\">Link.par</span> <span class=\"n\">n</span> <span class=\"n\">m</span> <span class=\"n\">k</span> <span class=\"n\">A</span> <span class=\"n\">B</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"n\">Ai</span> <span class=\"bp\">=</span> <span class=\"o\">⟨</span><span class=\"n\">A</span> <span class=\"n\">⅋</span> <span class=\"n\">B</span><span class=\"o\">,</span><span class=\"n\">k</span><span class=\"o\">⟩</span>\n<span class=\"bp\">|</span> <span class=\"o\">(</span><span class=\"n\">Link.con</span> <span class=\"n\">n</span> <span class=\"n\">A</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"n\">false</span>\n\n<span class=\"kd\">structure</span> <span class=\"n\">proof_structure</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span> <span class=\"o\">:=</span>\n<span class=\"o\">(</span><span class=\"n\">links</span> <span class=\"o\">:</span> <span class=\"n\">set</span> <span class=\"n\">Link</span><span class=\"o\">)</span>\n<span class=\"o\">(</span><span class=\"n\">form_occs</span> <span class=\"o\">:</span> <span class=\"n\">set</span> <span class=\"n\">Form_occ</span><span class=\"o\">)</span>\n<span class=\"o\">(</span><span class=\"n\">link_prem</span> <span class=\"o\">:</span> <span class=\"bp\">∀</span> <span class=\"n\">l</span> <span class=\"bp\">∈</span> <span class=\"n\">links</span><span class=\"o\">,</span> <span class=\"bp\">∀</span> <span class=\"n\">Ai</span> <span class=\"o\">:</span> <span class=\"n\">Form_occ</span><span class=\"o\">,</span> <span class=\"n\">is_premise</span> <span class=\"n\">Ai</span> <span class=\"n\">l</span> <span class=\"bp\">→</span> <span class=\"n\">Ai</span> <span class=\"bp\">∈</span> <span class=\"n\">form_occs</span><span class=\"o\">)</span>\n<span class=\"o\">(</span><span class=\"n\">link_con</span> <span class=\"o\">:</span> <span class=\"bp\">∀</span> <span class=\"n\">l</span> <span class=\"bp\">∈</span> <span class=\"n\">links</span><span class=\"o\">,</span> <span class=\"bp\">∀</span> <span class=\"n\">Ai</span> <span class=\"o\">:</span> <span class=\"n\">Form_occ</span><span class=\"o\">,</span> <span class=\"n\">is_conclusion</span> <span class=\"n\">Ai</span> <span class=\"n\">l</span> <span class=\"bp\">→</span> <span class=\"n\">Ai</span> <span class=\"bp\">∈</span> <span class=\"n\">form_occs</span><span class=\"o\">)</span>\n<span class=\"o\">(</span><span class=\"n\">premise</span> <span class=\"o\">:</span> <span class=\"n\">Form_occ</span> <span class=\"bp\">→</span> <span class=\"n\">Link</span><span class=\"o\">)</span>\n<span class=\"o\">(</span><span class=\"n\">prem_unique</span> <span class=\"o\">:</span> <span class=\"bp\">∀</span> <span class=\"n\">Ai</span> <span class=\"bp\">∈</span> <span class=\"n\">form_occs</span><span class=\"o\">,</span> <span class=\"bp\">∀</span> <span class=\"n\">l</span> <span class=\"bp\">∈</span> <span class=\"n\">links</span><span class=\"o\">,</span> <span class=\"n\">is_premise</span> <span class=\"n\">Ai</span> <span class=\"n\">l</span> <span class=\"bp\">→</span> <span class=\"n\">premise</span> <span class=\"n\">Ai</span> <span class=\"bp\">=</span> <span class=\"n\">l</span><span class=\"o\">)</span>\n<span class=\"o\">(</span><span class=\"n\">prem_range</span> <span class=\"o\">:</span> <span class=\"bp\">∀</span> <span class=\"n\">Ai</span> <span class=\"bp\">∈</span> <span class=\"n\">form_occs</span><span class=\"o\">,</span> <span class=\"n\">premise</span> <span class=\"n\">Ai</span> <span class=\"bp\">∈</span> <span class=\"n\">links</span> <span class=\"bp\">∧</span> <span class=\"n\">is_premise</span> <span class=\"n\">Ai</span> <span class=\"o\">(</span><span class=\"n\">premise</span> <span class=\"n\">Ai</span><span class=\"o\">))</span>\n<span class=\"o\">(</span><span class=\"n\">conclusion</span> <span class=\"o\">:</span> <span class=\"n\">Form_occ</span> <span class=\"bp\">→</span> <span class=\"n\">Link</span><span class=\"o\">)</span>\n<span class=\"o\">(</span><span class=\"n\">con_unique</span> <span class=\"o\">:</span> <span class=\"bp\">∀</span> <span class=\"n\">Ai</span> <span class=\"bp\">∈</span> <span class=\"n\">form_occs</span><span class=\"o\">,</span> <span class=\"bp\">∀</span> <span class=\"n\">l</span> <span class=\"bp\">∈</span> <span class=\"n\">links</span><span class=\"o\">,</span> <span class=\"n\">is_conclusion</span> <span class=\"n\">Ai</span> <span class=\"n\">l</span> <span class=\"bp\">→</span> <span class=\"n\">conclusion</span> <span class=\"n\">Ai</span> <span class=\"bp\">=</span> <span class=\"n\">l</span><span class=\"o\">)</span>\n<span class=\"o\">(</span><span class=\"n\">con_range</span> <span class=\"o\">:</span> <span class=\"bp\">∀</span> <span class=\"n\">Ai</span> <span class=\"bp\">∈</span> <span class=\"n\">form_occs</span><span class=\"o\">,</span> <span class=\"n\">conclusion</span> <span class=\"n\">Ai</span> <span class=\"bp\">∈</span> <span class=\"n\">links</span> <span class=\"bp\">∧</span> <span class=\"n\">is_conclusion</span> <span class=\"n\">Ai</span> <span class=\"o\">(</span><span class=\"n\">conclusion</span> <span class=\"n\">Ai</span><span class=\"o\">))</span>\n\n<span class=\"kd\">@[reducible]</span>\n<span class=\"kd\">def</span> <span class=\"n\">dir</span> <span class=\"o\">:=</span> <span class=\"n\">bool</span>\n\n<span class=\"kd\">@[pattern]</span> <span class=\"kd\">def</span> <span class=\"n\">down</span> <span class=\"o\">:=</span> <span class=\"n\">ff</span>\n<span class=\"kd\">@[pattern]</span> <span class=\"kd\">def</span> <span class=\"n\">up</span> <span class=\"o\">:=</span> <span class=\"n\">tt</span>\n\n<span class=\"kd\">@[pattern]</span> <span class=\"kd\">def</span> <span class=\"n\">with_down</span> <span class=\"o\">(</span><span class=\"n\">Ai</span> <span class=\"o\">:</span> <span class=\"n\">Form_occ</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"o\">(</span><span class=\"n\">Ai</span><span class=\"o\">,</span><span class=\"n\">down</span><span class=\"o\">)</span>\n<span class=\"kd\">@[pattern]</span> <span class=\"kd\">def</span> <span class=\"n\">with_up</span> <span class=\"o\">(</span><span class=\"n\">Ai</span> <span class=\"o\">:</span> <span class=\"n\">Form_occ</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"o\">(</span><span class=\"n\">Ai</span><span class=\"o\">,</span><span class=\"n\">up</span><span class=\"o\">)</span>\n<span class=\"kd\">postfix</span> <span class=\"bp\">`↓`</span><span class=\"o\">:</span><span class=\"n\">max_plus</span> <span class=\"o\">:=</span> <span class=\"n\">with_down</span>\n<span class=\"kd\">postfix</span> <span class=\"bp\">`↑`</span><span class=\"o\">:</span><span class=\"n\">max_plus</span> <span class=\"o\">:=</span> <span class=\"n\">with_up</span>\n\n<span class=\"kd\">@[reducible]</span>\n<span class=\"kd\">def</span> <span class=\"n\">switch</span> <span class=\"o\">:=</span> <span class=\"n\">bool</span>\n\n<span class=\"kd\">@[pattern]</span> <span class=\"kd\">def</span> <span class=\"n\">L</span> <span class=\"o\">:=</span> <span class=\"n\">ff</span>\n<span class=\"kd\">@[pattern]</span> <span class=\"kd\">def</span> <span class=\"n\">R</span> <span class=\"o\">:=</span> <span class=\"n\">tt</span>\n\n<span class=\"kd\">def</span> <span class=\"n\">switching</span> <span class=\"o\">:=</span> <span class=\"n\">Link</span> <span class=\"bp\">→</span> <span class=\"n\">switch</span>\n\n<span class=\"kd\">@[simp]</span>\n<span class=\"kd\">def</span> <span class=\"n\">switch.flip</span> <span class=\"o\">{</span><span class=\"n\">α</span> <span class=\"n\">β</span><span class=\"o\">}</span> <span class=\"o\">(</span><span class=\"n\">f</span> <span class=\"o\">:</span> <span class=\"n\">α</span> <span class=\"bp\">→</span> <span class=\"n\">α</span> <span class=\"bp\">→</span> <span class=\"n\">β</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">switch</span> <span class=\"bp\">→</span> <span class=\"n\">α</span> <span class=\"bp\">→</span> <span class=\"n\">α</span> <span class=\"bp\">→</span> <span class=\"n\">β</span>\n<span class=\"bp\">|</span> <span class=\"n\">L</span> <span class=\"n\">a</span> <span class=\"n\">b</span> <span class=\"o\">:=</span> <span class=\"n\">f</span> <span class=\"n\">a</span> <span class=\"n\">b</span>\n<span class=\"bp\">|</span> <span class=\"n\">R</span> <span class=\"n\">a</span> <span class=\"n\">b</span> <span class=\"o\">:=</span> <span class=\"n\">f</span> <span class=\"n\">b</span> <span class=\"n\">a</span>\n\n<span class=\"kd\">@[simp]</span> <span class=\"kd\">lemma</span> <span class=\"n\">flip_L</span> <span class=\"o\">{</span><span class=\"n\">α</span> <span class=\"n\">β</span><span class=\"o\">}</span> <span class=\"o\">{</span><span class=\"n\">f</span> <span class=\"o\">:</span> <span class=\"n\">α</span> <span class=\"bp\">→</span> <span class=\"n\">α</span> <span class=\"bp\">→</span> <span class=\"n\">β</span><span class=\"o\">}</span> <span class=\"o\">{</span><span class=\"n\">a</span> <span class=\"n\">b</span><span class=\"o\">}</span> <span class=\"o\">:</span> <span class=\"n\">switch.flip</span> <span class=\"n\">f</span> <span class=\"n\">L</span> <span class=\"n\">a</span> <span class=\"n\">b</span> <span class=\"bp\">=</span> <span class=\"n\">f</span> <span class=\"n\">a</span> <span class=\"n\">b</span> <span class=\"o\">:=</span> <span class=\"n\">rfl</span>\n<span class=\"kd\">@[simp]</span> <span class=\"kd\">lemma</span> <span class=\"n\">flip_R</span> <span class=\"o\">{</span><span class=\"n\">α</span> <span class=\"n\">β</span><span class=\"o\">}</span> <span class=\"o\">{</span><span class=\"n\">f</span> <span class=\"o\">:</span> <span class=\"n\">α</span> <span class=\"bp\">→</span> <span class=\"n\">α</span> <span class=\"bp\">→</span> <span class=\"n\">β</span><span class=\"o\">}</span> <span class=\"o\">{</span><span class=\"n\">a</span> <span class=\"n\">b</span><span class=\"o\">}</span> <span class=\"o\">:</span> <span class=\"n\">switch.flip</span> <span class=\"n\">f</span> <span class=\"n\">R</span> <span class=\"n\">a</span> <span class=\"n\">b</span> <span class=\"bp\">=</span> <span class=\"n\">f</span> <span class=\"n\">b</span> <span class=\"n\">a</span> <span class=\"o\">:=</span> <span class=\"n\">rfl</span>\n\n<span class=\"kd\">inductive</span> <span class=\"n\">steps_tensor</span> <span class=\"o\">(</span><span class=\"n\">Ai</span> <span class=\"n\">Bi</span> <span class=\"n\">Ci</span> <span class=\"o\">:</span> <span class=\"n\">Form_occ</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">Form_occ</span> <span class=\"bp\">×</span> <span class=\"n\">dir</span> <span class=\"bp\">→</span> <span class=\"n\">Form_occ</span> <span class=\"bp\">×</span> <span class=\"n\">dir</span> <span class=\"bp\">→</span> <span class=\"kt\">Prop</span>\n<span class=\"bp\">|</span> <span class=\"n\">down</span> <span class=\"o\">:</span> <span class=\"n\">steps_tensor</span> <span class=\"n\">Ai</span><span class=\"bp\">↓</span> <span class=\"n\">Ci</span><span class=\"bp\">↓</span>\n<span class=\"bp\">|</span> <span class=\"n\">turn</span> <span class=\"o\">:</span> <span class=\"n\">steps_tensor</span> <span class=\"n\">Bi</span><span class=\"bp\">↓</span> <span class=\"n\">Ai</span><span class=\"bp\">↑</span>\n<span class=\"bp\">|</span> <span class=\"n\">up</span> <span class=\"o\">:</span> <span class=\"n\">steps_tensor</span> <span class=\"n\">Ci</span><span class=\"bp\">↑</span> <span class=\"n\">Bi</span><span class=\"bp\">↑</span>\n\n<span class=\"kd\">inductive</span> <span class=\"n\">steps_par</span> <span class=\"o\">(</span><span class=\"n\">Ai</span> <span class=\"n\">Bi</span> <span class=\"n\">Ci</span> <span class=\"o\">:</span> <span class=\"n\">Form_occ</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">Form_occ</span> <span class=\"bp\">×</span> <span class=\"n\">dir</span> <span class=\"bp\">→</span> <span class=\"n\">Form_occ</span> <span class=\"bp\">×</span> <span class=\"n\">dir</span> <span class=\"bp\">→</span> <span class=\"kt\">Prop</span>\n<span class=\"bp\">|</span> <span class=\"n\">down</span> <span class=\"o\">:</span> <span class=\"n\">steps_par</span> <span class=\"n\">Ai</span><span class=\"bp\">↓</span> <span class=\"n\">Ci</span><span class=\"bp\">↓</span>\n<span class=\"bp\">|</span> <span class=\"n\">turn</span> <span class=\"o\">:</span> <span class=\"n\">steps_par</span> <span class=\"n\">Bi</span><span class=\"bp\">↓</span> <span class=\"n\">Bi</span><span class=\"bp\">↑</span>\n<span class=\"bp\">|</span> <span class=\"n\">up</span> <span class=\"o\">:</span> <span class=\"n\">steps_par</span> <span class=\"n\">Ci</span><span class=\"bp\">↑</span> <span class=\"n\">Ai</span><span class=\"bp\">↑</span>\n\n<span class=\"kd\">inductive</span> <span class=\"n\">dual</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"o\">:</span> <span class=\"n\">Form</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">ai</span> <span class=\"n\">ni</span> <span class=\"o\">:</span> <span class=\"n\">ℕ</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">Form_occ</span> <span class=\"bp\">→</span> <span class=\"n\">Form_occ</span> <span class=\"bp\">→</span> <span class=\"kt\">Prop</span>\n<span class=\"bp\">|</span> <span class=\"n\">posneg</span> <span class=\"o\">:</span> <span class=\"n\">dual</span> <span class=\"o\">(</span><span class=\"n\">A</span><span class=\"o\">,</span><span class=\"n\">ai</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"bp\">~</span><span class=\"n\">A</span><span class=\"o\">,</span><span class=\"n\">ni</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"n\">negpos</span> <span class=\"o\">:</span> <span class=\"n\">dual</span> <span class=\"o\">(</span><span class=\"bp\">~</span><span class=\"n\">A</span><span class=\"o\">,</span><span class=\"n\">ni</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">A</span><span class=\"o\">,</span><span class=\"n\">ai</span><span class=\"o\">)</span>\n\n<span class=\"kd\">inductive</span> <span class=\"n\">steps</span> <span class=\"o\">(</span><span class=\"n\">T</span> <span class=\"o\">:</span> <span class=\"n\">switch</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">Link</span> <span class=\"bp\">→</span> <span class=\"n\">Form_occ</span> <span class=\"bp\">×</span> <span class=\"n\">dir</span> <span class=\"bp\">→</span> <span class=\"n\">Form_occ</span> <span class=\"bp\">×</span> <span class=\"n\">dir</span> <span class=\"bp\">→</span> <span class=\"kt\">Prop</span>\n<span class=\"bp\">|</span> <span class=\"n\">ax</span>  <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"o\">:</span> <span class=\"n\">Form</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">ai</span> <span class=\"n\">ni</span> <span class=\"o\">:</span> <span class=\"n\">ℕ</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">Bi</span> <span class=\"n\">Ci</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">dual</span> <span class=\"n\">A</span> <span class=\"n\">ai</span> <span class=\"n\">ni</span> <span class=\"n\">Bi</span> <span class=\"n\">Ci</span> <span class=\"bp\">→</span> <span class=\"n\">steps</span> <span class=\"o\">(</span><span class=\"n\">Link.ax</span> <span class=\"n\">ai</span> <span class=\"n\">ni</span> <span class=\"n\">A</span><span class=\"o\">)</span> <span class=\"n\">Bi</span><span class=\"bp\">↑</span> <span class=\"n\">Ci</span><span class=\"bp\">↓</span>\n<span class=\"bp\">|</span> <span class=\"n\">cut</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"o\">:</span> <span class=\"n\">Form</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">ai</span> <span class=\"n\">ni</span> <span class=\"o\">:</span> <span class=\"n\">ℕ</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">Bi</span> <span class=\"n\">Ci</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">dual</span> <span class=\"n\">A</span> <span class=\"n\">ai</span> <span class=\"n\">ni</span> <span class=\"n\">Bi</span> <span class=\"n\">Ci</span> <span class=\"bp\">→</span> <span class=\"n\">steps</span> <span class=\"o\">(</span><span class=\"n\">Link.cut</span> <span class=\"n\">ai</span> <span class=\"n\">ni</span> <span class=\"n\">A</span><span class=\"o\">)</span> <span class=\"n\">Bi</span><span class=\"bp\">↓</span> <span class=\"n\">Ci</span><span class=\"bp\">↑</span>\n<span class=\"bp\">|</span> <span class=\"n\">con</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"o\">:</span> <span class=\"n\">Form</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">ai</span> <span class=\"o\">:</span> <span class=\"n\">ℕ</span><span class=\"o\">)</span>            <span class=\"o\">:</span> <span class=\"n\">steps</span> <span class=\"o\">(</span><span class=\"n\">Link.con</span> <span class=\"n\">ai</span> <span class=\"n\">A</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">A</span><span class=\"o\">,</span> <span class=\"n\">ai</span><span class=\"o\">)</span><span class=\"bp\">↓</span> <span class=\"o\">(</span><span class=\"n\">A</span><span class=\"o\">,</span><span class=\"n\">ai</span><span class=\"o\">)</span><span class=\"bp\">↑</span>\n<span class=\"bp\">|</span> <span class=\"n\">tensor</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"n\">B</span> <span class=\"o\">:</span> <span class=\"n\">Form</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">ai</span> <span class=\"n\">bi</span> <span class=\"n\">ci</span> <span class=\"o\">:</span> <span class=\"n\">ℕ</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">x</span> <span class=\"n\">y</span><span class=\"o\">)</span> <span class=\"o\">:</span>\n  <span class=\"n\">T.flip</span> <span class=\"n\">steps_tensor</span> <span class=\"o\">(</span><span class=\"n\">A</span><span class=\"o\">,</span> <span class=\"n\">ai</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">B</span><span class=\"o\">,</span> <span class=\"n\">bi</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"bp\">⊗</span> <span class=\"n\">B</span><span class=\"o\">,</span> <span class=\"n\">ci</span><span class=\"o\">)</span> <span class=\"n\">x</span> <span class=\"n\">y</span> <span class=\"bp\">→</span>\n  <span class=\"n\">steps</span> <span class=\"o\">(</span><span class=\"n\">Link.tensor</span> <span class=\"n\">ai</span> <span class=\"n\">bi</span> <span class=\"n\">ci</span> <span class=\"n\">A</span> <span class=\"n\">B</span><span class=\"o\">)</span> <span class=\"n\">x</span> <span class=\"n\">y</span>\n<span class=\"bp\">|</span> <span class=\"n\">par</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"n\">B</span> <span class=\"o\">:</span> <span class=\"n\">Form</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">ai</span> <span class=\"n\">bi</span> <span class=\"n\">ci</span> <span class=\"o\">:</span> <span class=\"n\">ℕ</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">x</span> <span class=\"n\">y</span><span class=\"o\">)</span> <span class=\"o\">:</span>\n  <span class=\"n\">T.flip</span> <span class=\"n\">steps_par</span> <span class=\"o\">(</span><span class=\"n\">A</span><span class=\"o\">,</span> <span class=\"n\">ai</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">B</span><span class=\"o\">,</span> <span class=\"n\">bi</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"n\">⅋</span> <span class=\"n\">B</span><span class=\"o\">,</span> <span class=\"n\">ci</span><span class=\"o\">)</span> <span class=\"n\">x</span> <span class=\"n\">y</span> <span class=\"bp\">→</span>\n  <span class=\"n\">steps</span> <span class=\"o\">(</span><span class=\"n\">Link.par</span> <span class=\"n\">ai</span> <span class=\"n\">bi</span> <span class=\"n\">ci</span> <span class=\"n\">A</span> <span class=\"n\">B</span><span class=\"o\">)</span> <span class=\"n\">x</span> <span class=\"n\">y</span>\n\n<span class=\"kd\">theorem</span> <span class=\"n\">dual_unique_prev</span> <span class=\"o\">{</span><span class=\"n\">A</span> <span class=\"n\">ai</span> <span class=\"n\">ni</span> <span class=\"n\">Bi</span> <span class=\"n\">Ci</span> <span class=\"n\">Di</span><span class=\"o\">}</span>\n  <span class=\"o\">(</span><span class=\"n\">d₁</span> <span class=\"o\">:</span> <span class=\"n\">dual</span> <span class=\"n\">A</span> <span class=\"n\">ai</span> <span class=\"n\">ni</span> <span class=\"n\">Bi</span> <span class=\"n\">Ci</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">d₂</span> <span class=\"o\">:</span> <span class=\"n\">dual</span> <span class=\"n\">A</span> <span class=\"n\">ai</span> <span class=\"n\">ni</span> <span class=\"n\">Di</span> <span class=\"n\">Ci</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">Bi</span> <span class=\"bp\">=</span> <span class=\"n\">Di</span> <span class=\"o\">:=</span>\n<span class=\"kd\">begin</span>\n  <span class=\"n\">generalize_hyp</span> <span class=\"n\">e</span> <span class=\"o\">:</span> <span class=\"n\">Ci</span> <span class=\"bp\">=</span> <span class=\"n\">Ci'</span> <span class=\"n\">at</span> <span class=\"n\">d₂</span><span class=\"o\">,</span>\n  <span class=\"k\">have</span> <span class=\"o\">:</span> <span class=\"n\">A</span> <span class=\"bp\">≠</span> <span class=\"bp\">~</span><span class=\"n\">A</span><span class=\"o\">,</span>\n  <span class=\"o\">{</span> <span class=\"n\">intro</span> <span class=\"n\">e</span><span class=\"o\">,</span>\n    <span class=\"n\">apply_fun</span> <span class=\"n\">Form.sizeof</span> <span class=\"n\">at</span> <span class=\"n\">e</span><span class=\"o\">,</span>\n    <span class=\"n\">refine</span> <span class=\"n\">ne_of_lt</span> <span class=\"n\">_</span> <span class=\"n\">e</span><span class=\"o\">,</span>\n    <span class=\"n\">rw</span> <span class=\"o\">[</span><span class=\"n\">Form.sizeof</span><span class=\"o\">,</span> <span class=\"n\">nat.add_comm</span><span class=\"o\">],</span> <span class=\"n\">exact</span> <span class=\"n\">nat.lt_succ_self</span> <span class=\"n\">_</span> <span class=\"o\">},</span>\n  <span class=\"n\">cases</span> <span class=\"n\">d₁</span><span class=\"bp\">;</span> <span class=\"n\">cases</span> <span class=\"n\">d₂</span><span class=\"bp\">;</span> <span class=\"n\">injection</span> <span class=\"n\">e</span> <span class=\"k\">with</span> <span class=\"n\">e1</span> <span class=\"n\">e2</span><span class=\"bp\">;</span> <span class=\"n\">cases</span> <span class=\"n\">e2</span><span class=\"bp\">;</span>\n  <span class=\"n\">try</span> <span class=\"o\">{</span> <span class=\"n\">cases</span> <span class=\"n\">e1</span> <span class=\"o\">}</span><span class=\"bp\">;</span> <span class=\"o\">[</span><span class=\"n\">refl</span><span class=\"o\">,</span> <span class=\"n\">cases</span> <span class=\"n\">this</span> <span class=\"n\">e1.symm</span><span class=\"o\">,</span> <span class=\"n\">cases</span> <span class=\"n\">this</span> <span class=\"n\">e1</span><span class=\"o\">,</span> <span class=\"n\">refl</span><span class=\"o\">]</span>\n<span class=\"kd\">end</span>\n\n<span class=\"kd\">theorem</span> <span class=\"n\">steps_tensor_unique_prev</span> <span class=\"o\">(</span><span class=\"n\">Ai</span> <span class=\"n\">Bi</span> <span class=\"n\">Ci</span> <span class=\"o\">:</span> <span class=\"n\">Form_occ</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">X</span> <span class=\"n\">Y</span> <span class=\"n\">Z</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">Ai</span> <span class=\"bp\">≠</span> <span class=\"n\">Bi</span> <span class=\"bp\">→</span> <span class=\"n\">Bi</span> <span class=\"bp\">≠</span> <span class=\"n\">Ci</span> <span class=\"bp\">→</span> <span class=\"n\">Ai</span> <span class=\"bp\">≠</span> <span class=\"n\">Ci</span> <span class=\"bp\">→</span> <span class=\"n\">steps_tensor</span> <span class=\"n\">Ai</span> <span class=\"n\">Bi</span> <span class=\"n\">Ci</span> <span class=\"n\">X</span> <span class=\"n\">Z</span> <span class=\"bp\">→</span> <span class=\"n\">steps_tensor</span> <span class=\"n\">Ai</span> <span class=\"n\">Bi</span> <span class=\"n\">Ci</span> <span class=\"n\">Y</span> <span class=\"n\">Z</span> <span class=\"bp\">→</span> <span class=\"n\">X</span> <span class=\"bp\">=</span> <span class=\"n\">Y</span> <span class=\"o\">:=</span>\n<span class=\"kd\">begin</span>\n  <span class=\"n\">intros</span> <span class=\"n\">_</span> <span class=\"n\">_</span> <span class=\"n\">_</span> <span class=\"n\">s₁</span> <span class=\"n\">s₂</span><span class=\"o\">,</span>\n  <span class=\"n\">cases</span> <span class=\"n\">s₁</span><span class=\"bp\">;</span> <span class=\"n\">cases</span> <span class=\"n\">s₂</span><span class=\"bp\">;</span> <span class=\"n\">try</span> <span class=\"o\">{</span><span class=\"n\">refl</span><span class=\"o\">}</span><span class=\"bp\">;</span> <span class=\"n\">try</span> <span class=\"o\">{</span><span class=\"n\">contradiction</span><span class=\"o\">},</span>\n<span class=\"kd\">end</span>\n\n<span class=\"kd\">theorem</span> <span class=\"n\">steps_tensor_unique_next</span> <span class=\"o\">(</span><span class=\"n\">Ai</span> <span class=\"n\">Bi</span> <span class=\"n\">Ci</span> <span class=\"o\">:</span> <span class=\"n\">Form_occ</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">X</span> <span class=\"n\">Y</span> <span class=\"n\">Z</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">Ai</span> <span class=\"bp\">≠</span> <span class=\"n\">Bi</span> <span class=\"bp\">→</span> <span class=\"n\">Bi</span> <span class=\"bp\">≠</span> <span class=\"n\">Ci</span> <span class=\"bp\">→</span> <span class=\"n\">Ai</span> <span class=\"bp\">≠</span> <span class=\"n\">Ci</span> <span class=\"bp\">→</span> <span class=\"n\">steps_tensor</span> <span class=\"n\">Ai</span> <span class=\"n\">Bi</span> <span class=\"n\">Ci</span> <span class=\"n\">X</span> <span class=\"n\">Y</span> <span class=\"bp\">→</span> <span class=\"n\">steps_tensor</span> <span class=\"n\">Ai</span> <span class=\"n\">Bi</span> <span class=\"n\">Ci</span> <span class=\"n\">X</span> <span class=\"n\">Z</span> <span class=\"bp\">→</span> <span class=\"n\">Y</span> <span class=\"bp\">=</span> <span class=\"n\">Z</span> <span class=\"o\">:=</span>\n<span class=\"kd\">begin</span>\n  <span class=\"n\">intros</span> <span class=\"n\">_</span> <span class=\"n\">_</span> <span class=\"n\">_</span> <span class=\"n\">s₁</span> <span class=\"n\">s₂</span><span class=\"o\">,</span>\n  <span class=\"n\">cases</span> <span class=\"n\">s₁</span><span class=\"bp\">;</span> <span class=\"n\">cases</span> <span class=\"n\">s₂</span><span class=\"bp\">;</span> <span class=\"n\">try</span> <span class=\"o\">{</span><span class=\"n\">refl</span><span class=\"o\">}</span><span class=\"bp\">;</span> <span class=\"n\">try</span> <span class=\"o\">{</span><span class=\"n\">contradiction</span><span class=\"o\">},</span>\n<span class=\"kd\">end</span>\n\n<span class=\"kd\">theorem</span> <span class=\"n\">steps_par_unique_prev</span> <span class=\"o\">(</span><span class=\"n\">Ai</span> <span class=\"n\">Bi</span> <span class=\"n\">Ci</span> <span class=\"o\">:</span> <span class=\"n\">Form_occ</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">X</span> <span class=\"n\">Y</span> <span class=\"n\">Z</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">Ai</span> <span class=\"bp\">≠</span> <span class=\"n\">Bi</span> <span class=\"bp\">→</span> <span class=\"n\">Bi</span> <span class=\"bp\">≠</span> <span class=\"n\">Ci</span> <span class=\"bp\">→</span> <span class=\"n\">Ai</span> <span class=\"bp\">≠</span> <span class=\"n\">Ci</span> <span class=\"bp\">→</span> <span class=\"n\">steps_par</span> <span class=\"n\">Ai</span> <span class=\"n\">Bi</span> <span class=\"n\">Ci</span> <span class=\"n\">X</span> <span class=\"n\">Z</span> <span class=\"bp\">→</span> <span class=\"n\">steps_par</span> <span class=\"n\">Ai</span> <span class=\"n\">Bi</span> <span class=\"n\">Ci</span> <span class=\"n\">Y</span> <span class=\"n\">Z</span> <span class=\"bp\">→</span> <span class=\"n\">X</span> <span class=\"bp\">=</span> <span class=\"n\">Y</span> <span class=\"o\">:=</span>\n<span class=\"kd\">begin</span>\n  <span class=\"n\">intros</span> <span class=\"n\">_</span> <span class=\"n\">_</span> <span class=\"n\">_</span> <span class=\"n\">s₁</span> <span class=\"n\">s₂</span><span class=\"o\">,</span>\n  <span class=\"n\">cases</span> <span class=\"n\">s₁</span><span class=\"bp\">;</span> <span class=\"n\">cases</span> <span class=\"n\">s₂</span><span class=\"bp\">;</span> <span class=\"n\">try</span> <span class=\"o\">{</span><span class=\"n\">refl</span><span class=\"o\">}</span><span class=\"bp\">;</span> <span class=\"n\">try</span> <span class=\"o\">{</span><span class=\"n\">contradiction</span><span class=\"o\">},</span>\n<span class=\"kd\">end</span>\n\n<span class=\"kd\">theorem</span> <span class=\"n\">steps_par_unique_next</span> <span class=\"o\">(</span><span class=\"n\">Ai</span> <span class=\"n\">Bi</span> <span class=\"n\">Ci</span> <span class=\"o\">:</span> <span class=\"n\">Form_occ</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">X</span> <span class=\"n\">Y</span> <span class=\"n\">Z</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">Ai</span> <span class=\"bp\">≠</span> <span class=\"n\">Bi</span> <span class=\"bp\">→</span> <span class=\"n\">Bi</span> <span class=\"bp\">≠</span> <span class=\"n\">Ci</span> <span class=\"bp\">→</span> <span class=\"n\">Ai</span> <span class=\"bp\">≠</span> <span class=\"n\">Ci</span> <span class=\"bp\">→</span> <span class=\"n\">steps_par</span> <span class=\"n\">Ai</span> <span class=\"n\">Bi</span> <span class=\"n\">Ci</span> <span class=\"n\">X</span> <span class=\"n\">Y</span> <span class=\"bp\">→</span> <span class=\"n\">steps_par</span> <span class=\"n\">Ai</span> <span class=\"n\">Bi</span> <span class=\"n\">Ci</span> <span class=\"n\">X</span> <span class=\"n\">Z</span> <span class=\"bp\">→</span> <span class=\"n\">Y</span> <span class=\"bp\">=</span> <span class=\"n\">Z</span> <span class=\"o\">:=</span>\n<span class=\"kd\">begin</span>\n  <span class=\"n\">intros</span> <span class=\"n\">_</span> <span class=\"n\">_</span> <span class=\"n\">_</span> <span class=\"n\">s₁</span> <span class=\"n\">s₂</span><span class=\"o\">,</span>\n  <span class=\"n\">cases</span> <span class=\"n\">s₁</span><span class=\"bp\">;</span> <span class=\"n\">cases</span> <span class=\"n\">s₂</span><span class=\"bp\">;</span> <span class=\"n\">try</span> <span class=\"o\">{</span><span class=\"n\">refl</span><span class=\"o\">}</span><span class=\"bp\">;</span> <span class=\"n\">try</span> <span class=\"o\">{</span><span class=\"n\">contradiction</span><span class=\"o\">},</span>\n<span class=\"kd\">end</span>\n\n<span class=\"kd\">theorem</span> <span class=\"n\">steps_unique_prev</span> <span class=\"o\">(</span><span class=\"n\">T</span> <span class=\"o\">:</span> <span class=\"n\">switch</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"bp\">Δ</span> <span class=\"o\">:</span> <span class=\"n\">Link</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">X</span> <span class=\"n\">Y</span> <span class=\"n\">Z</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">steps</span> <span class=\"n\">T</span> <span class=\"bp\">Δ</span> <span class=\"n\">X</span> <span class=\"n\">Z</span> <span class=\"bp\">→</span> <span class=\"n\">steps</span> <span class=\"n\">T</span> <span class=\"bp\">Δ</span> <span class=\"n\">Y</span> <span class=\"n\">Z</span> <span class=\"bp\">→</span> <span class=\"n\">X</span> <span class=\"bp\">=</span> <span class=\"n\">Y</span> <span class=\"o\">:=</span>\n<span class=\"kd\">begin</span>\n  <span class=\"n\">intros</span> <span class=\"n\">s₁</span> <span class=\"n\">s₂</span><span class=\"o\">,</span>\n  <span class=\"n\">cases</span> <span class=\"n\">s₁</span><span class=\"o\">,</span>\n  <span class=\"n\">case</span> <span class=\"n\">steps.ax</span> <span class=\"o\">:</span> <span class=\"n\">A</span> <span class=\"n\">ai</span> <span class=\"n\">ni</span> <span class=\"n\">Bi</span> <span class=\"n\">Ci</span> <span class=\"n\">d₁</span> <span class=\"o\">{</span>\n    <span class=\"n\">cases</span> <span class=\"n\">s₂</span> <span class=\"k\">with</span> <span class=\"n\">_</span> <span class=\"n\">_</span> <span class=\"n\">_</span> <span class=\"n\">Di</span> <span class=\"n\">_</span> <span class=\"n\">d₂</span><span class=\"o\">,</span>\n    <span class=\"n\">rw</span> <span class=\"n\">dual_unique_prev</span> <span class=\"n\">d₁</span> <span class=\"n\">d₂</span> <span class=\"o\">},</span>\n  <span class=\"n\">case</span> <span class=\"n\">steps.cut</span> <span class=\"o\">:</span> <span class=\"n\">A</span> <span class=\"n\">ai</span> <span class=\"n\">ni</span> <span class=\"n\">Bi</span> <span class=\"n\">Ci</span> <span class=\"n\">d₁</span> <span class=\"o\">{</span>\n    <span class=\"n\">rcases</span> <span class=\"n\">s₂</span> <span class=\"k\">with</span> <span class=\"n\">_</span> <span class=\"bp\">|</span> <span class=\"o\">⟨</span><span class=\"n\">_</span><span class=\"o\">,</span><span class=\"n\">_</span><span class=\"o\">,</span><span class=\"n\">_</span><span class=\"o\">,</span><span class=\"n\">Di</span><span class=\"o\">,</span><span class=\"n\">_</span><span class=\"o\">,</span><span class=\"n\">d₂</span><span class=\"o\">⟩,</span>\n    <span class=\"n\">rw</span> <span class=\"n\">dual_unique_prev</span> <span class=\"n\">d₂</span> <span class=\"n\">d₁</span>\n  <span class=\"o\">},</span>\n  <span class=\"n\">case</span> <span class=\"n\">steps.con</span> <span class=\"o\">:</span> <span class=\"n\">A</span> <span class=\"n\">ai</span> <span class=\"o\">{</span> <span class=\"n\">cases</span> <span class=\"n\">s₂</span><span class=\"o\">,</span> <span class=\"n\">refl</span> <span class=\"o\">},</span>\n  <span class=\"n\">case</span> <span class=\"n\">steps.tensor</span> <span class=\"o\">:</span> <span class=\"n\">A</span> <span class=\"n\">B</span> <span class=\"n\">ai</span> <span class=\"n\">bi</span> <span class=\"n\">ci</span> <span class=\"n\">X</span> <span class=\"n\">y</span> <span class=\"n\">t₁</span> <span class=\"o\">{</span>\n    <span class=\"n\">rcases</span> <span class=\"n\">s₂</span> <span class=\"k\">with</span> <span class=\"n\">_</span> <span class=\"bp\">|</span> <span class=\"n\">_</span> <span class=\"bp\">|</span> <span class=\"n\">_</span> <span class=\"bp\">|</span> <span class=\"o\">⟨</span><span class=\"n\">_</span><span class=\"o\">,</span><span class=\"n\">_</span><span class=\"o\">,</span><span class=\"n\">_</span><span class=\"o\">,</span><span class=\"n\">_</span><span class=\"o\">,</span><span class=\"n\">_</span><span class=\"o\">,</span><span class=\"n\">_</span><span class=\"o\">,</span><span class=\"n\">_</span><span class=\"o\">,</span><span class=\"n\">t₂</span><span class=\"o\">⟩,</span>\n    <span class=\"n\">cases</span> <span class=\"n\">T</span><span class=\"o\">,</span> <span class=\"n\">rw</span> <span class=\"n\">flip_L</span><span class=\"o\">,</span>\n  <span class=\"o\">},</span>\n<span class=\"kd\">end</span>\n</code></pre></div>",
        "id": 242698975,
        "sender_full_name": "Billy Price",
        "timestamp": 1623743547
    },
    {
        "content": "<p>well, as you can see from the goal state, <code>t₁ : switch.flip steps_tensor ff (A, ai) (B, bi) (A ⊗ B, ci) X y,</code> does not have <code>L</code> in the second argument. <code>cases</code> has a bad habit of reducing all indices to weak head normal form, which is why it shows up as <code>ff</code> instead of <code>L</code>. Marking <code>L</code> as reducible should help</p>",
        "id": 242702513,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1623745911
    },
    {
        "content": "<p>Yeah I already tried removing all the L's and it's still the same problem</p>",
        "id": 242704597,
        "sender_full_name": "Billy Price",
        "timestamp": 1623747161
    },
    {
        "content": "<p>Also adding the reducible attribute also does nothign</p>",
        "id": 242704772,
        "sender_full_name": "Billy Price",
        "timestamp": 1623747292
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kn\">import</span> <span class=\"n\">tactic</span>\n\n<span class=\"kd\">inductive</span> <span class=\"n\">Form</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span>\n<span class=\"bp\">|</span> <span class=\"n\">atom</span> <span class=\"o\">:</span> <span class=\"n\">ℕ</span> <span class=\"bp\">→</span> <span class=\"n\">Form</span>\n<span class=\"bp\">|</span> <span class=\"n\">tensor</span> <span class=\"o\">:</span> <span class=\"n\">Form</span> <span class=\"bp\">→</span> <span class=\"n\">Form</span> <span class=\"bp\">→</span> <span class=\"n\">Form</span>\n<span class=\"bp\">|</span> <span class=\"n\">par</span> <span class=\"o\">:</span> <span class=\"n\">Form</span> <span class=\"bp\">→</span> <span class=\"n\">Form</span> <span class=\"bp\">→</span> <span class=\"n\">Form</span>\n<span class=\"bp\">|</span> <span class=\"n\">neg</span> <span class=\"o\">:</span> <span class=\"n\">Form</span> <span class=\"bp\">→</span> <span class=\"n\">Form</span>\n\n<span class=\"kd\">infix</span> <span class=\"bp\">`</span> <span class=\"bp\">⊗</span> <span class=\"bp\">`</span><span class=\"o\">:</span><span class=\"mi\">70</span> <span class=\"o\">:=</span> <span class=\"n\">Form.tensor</span>\n<span class=\"kd\">infix</span> <span class=\"bp\">`</span> <span class=\"n\">⅋</span> <span class=\"bp\">`</span><span class=\"o\">:</span><span class=\"mi\">65</span> <span class=\"o\">:=</span> <span class=\"n\">Form.par</span>\n<span class=\"kd\">prefix</span> <span class=\"bp\">`~`</span> <span class=\"o\">:=</span> <span class=\"n\">Form.neg</span>\n\n<span class=\"kd\">inductive</span> <span class=\"n\">Link</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span>\n<span class=\"bp\">|</span> <span class=\"n\">ax</span> <span class=\"o\">:</span> <span class=\"n\">ℕ</span> <span class=\"bp\">→</span> <span class=\"n\">ℕ</span> <span class=\"bp\">→</span> <span class=\"n\">Form</span> <span class=\"bp\">→</span> <span class=\"n\">Link</span>\n<span class=\"bp\">|</span> <span class=\"n\">cut</span> <span class=\"o\">:</span> <span class=\"n\">ℕ</span> <span class=\"bp\">→</span> <span class=\"n\">ℕ</span> <span class=\"bp\">→</span> <span class=\"n\">Form</span> <span class=\"bp\">→</span> <span class=\"n\">Link</span>\n<span class=\"bp\">|</span> <span class=\"n\">tensor</span> <span class=\"o\">:</span> <span class=\"n\">ℕ</span> <span class=\"bp\">→</span> <span class=\"n\">ℕ</span> <span class=\"bp\">→</span> <span class=\"n\">ℕ</span> <span class=\"bp\">→</span> <span class=\"n\">Form</span> <span class=\"bp\">→</span> <span class=\"n\">Form</span> <span class=\"bp\">→</span> <span class=\"n\">Link</span>\n<span class=\"bp\">|</span> <span class=\"n\">par</span> <span class=\"o\">:</span> <span class=\"n\">ℕ</span> <span class=\"bp\">→</span> <span class=\"n\">ℕ</span> <span class=\"bp\">→</span> <span class=\"n\">ℕ</span> <span class=\"bp\">→</span> <span class=\"n\">Form</span> <span class=\"bp\">→</span> <span class=\"n\">Form</span> <span class=\"bp\">→</span> <span class=\"n\">Link</span>\n<span class=\"bp\">|</span> <span class=\"n\">con</span> <span class=\"o\">:</span> <span class=\"n\">ℕ</span> <span class=\"bp\">→</span> <span class=\"n\">Form</span> <span class=\"bp\">→</span> <span class=\"n\">Link</span>\n\n<span class=\"kd\">inductive</span> <span class=\"n\">valid_link</span> <span class=\"o\">:</span> <span class=\"n\">Link</span> <span class=\"bp\">→</span> <span class=\"kt\">Prop</span>\n<span class=\"bp\">|</span> <span class=\"n\">ax</span>  <span class=\"o\">(</span><span class=\"n\">i</span> <span class=\"n\">j</span> <span class=\"n\">A</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">valid_link</span> <span class=\"o\">(</span><span class=\"n\">Link.ax</span> <span class=\"n\">i</span> <span class=\"n\">j</span> <span class=\"n\">A</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"n\">cut</span> <span class=\"o\">(</span><span class=\"n\">i</span> <span class=\"n\">j</span> <span class=\"n\">A</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">valid_link</span> <span class=\"o\">(</span><span class=\"n\">Link.cut</span> <span class=\"n\">i</span> <span class=\"n\">j</span> <span class=\"n\">A</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"n\">tensor</span> <span class=\"o\">(</span><span class=\"n\">i</span> <span class=\"n\">j</span> <span class=\"n\">k</span> <span class=\"n\">A</span> <span class=\"n\">B</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"o\">(</span><span class=\"n\">A</span><span class=\"o\">,</span><span class=\"n\">i</span><span class=\"o\">)</span> <span class=\"bp\">≠</span> <span class=\"o\">(</span><span class=\"n\">B</span><span class=\"o\">,</span><span class=\"n\">j</span><span class=\"o\">)</span> <span class=\"bp\">→</span> <span class=\"n\">valid_link</span> <span class=\"o\">(</span><span class=\"n\">Link.tensor</span> <span class=\"n\">i</span> <span class=\"n\">j</span> <span class=\"n\">k</span> <span class=\"n\">A</span> <span class=\"n\">B</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"n\">par</span> <span class=\"o\">(</span><span class=\"n\">i</span> <span class=\"n\">j</span> <span class=\"n\">k</span> <span class=\"n\">A</span> <span class=\"n\">B</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"o\">(</span><span class=\"n\">A</span><span class=\"o\">,</span><span class=\"n\">i</span><span class=\"o\">)</span> <span class=\"bp\">≠</span> <span class=\"o\">(</span><span class=\"n\">B</span><span class=\"o\">,</span><span class=\"n\">j</span><span class=\"o\">)</span> <span class=\"bp\">→</span> <span class=\"n\">valid_link</span> <span class=\"o\">(</span><span class=\"n\">Link.par</span> <span class=\"n\">i</span> <span class=\"n\">j</span> <span class=\"n\">k</span> <span class=\"n\">A</span> <span class=\"n\">B</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"n\">con</span> <span class=\"o\">(</span><span class=\"n\">i</span> <span class=\"n\">A</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">valid_link</span> <span class=\"o\">(</span><span class=\"n\">Link.con</span> <span class=\"n\">i</span> <span class=\"n\">A</span><span class=\"o\">)</span>\n\n<span class=\"kd\">def</span> <span class=\"n\">Form_occ</span> <span class=\"o\">:=</span> <span class=\"n\">Form</span> <span class=\"bp\">×</span> <span class=\"n\">ℕ</span>\n\n<span class=\"kd\">def</span> <span class=\"n\">is_premise</span> <span class=\"o\">(</span><span class=\"n\">Ai</span> <span class=\"o\">:</span> <span class=\"n\">Form_occ</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">Link</span> <span class=\"bp\">→</span> <span class=\"kt\">Prop</span>\n<span class=\"bp\">|</span> <span class=\"o\">(</span><span class=\"n\">Link.ax</span> <span class=\"n\">n</span> <span class=\"n\">m</span> <span class=\"n\">B</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"n\">false</span>\n<span class=\"bp\">|</span> <span class=\"o\">(</span><span class=\"n\">Link.cut</span> <span class=\"n\">n</span> <span class=\"n\">m</span> <span class=\"n\">B</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"o\">(</span><span class=\"n\">Ai</span> <span class=\"bp\">=</span> <span class=\"o\">⟨</span><span class=\"n\">B</span><span class=\"o\">,</span><span class=\"n\">n</span><span class=\"o\">⟩)</span> <span class=\"bp\">∨</span> <span class=\"o\">(</span><span class=\"n\">Ai</span> <span class=\"bp\">=</span> <span class=\"o\">⟨</span><span class=\"bp\">~</span><span class=\"n\">B</span><span class=\"o\">,</span><span class=\"n\">m</span><span class=\"o\">⟩)</span>\n<span class=\"bp\">|</span> <span class=\"o\">(</span><span class=\"n\">Link.tensor</span> <span class=\"n\">n</span> <span class=\"n\">m</span> <span class=\"n\">k</span> <span class=\"n\">A</span> <span class=\"n\">B</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"o\">(</span><span class=\"n\">Ai</span> <span class=\"bp\">=</span> <span class=\"o\">⟨</span><span class=\"n\">A</span><span class=\"o\">,</span><span class=\"n\">n</span><span class=\"o\">⟩)</span> <span class=\"bp\">∨</span> <span class=\"o\">(</span><span class=\"n\">Ai</span> <span class=\"bp\">=</span> <span class=\"o\">⟨</span><span class=\"n\">B</span><span class=\"o\">,</span><span class=\"n\">m</span><span class=\"o\">⟩)</span>\n<span class=\"bp\">|</span> <span class=\"o\">(</span><span class=\"n\">Link.par</span> <span class=\"n\">n</span> <span class=\"n\">m</span> <span class=\"n\">k</span> <span class=\"n\">A</span> <span class=\"n\">B</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"o\">(</span><span class=\"n\">Ai</span> <span class=\"bp\">=</span> <span class=\"o\">⟨</span><span class=\"n\">A</span><span class=\"o\">,</span><span class=\"n\">n</span><span class=\"o\">⟩)</span> <span class=\"bp\">∨</span> <span class=\"o\">(</span><span class=\"n\">Ai</span> <span class=\"bp\">=</span> <span class=\"o\">⟨</span><span class=\"n\">B</span><span class=\"o\">,</span><span class=\"n\">m</span><span class=\"o\">⟩)</span>\n<span class=\"bp\">|</span> <span class=\"o\">(</span><span class=\"n\">Link.con</span> <span class=\"n\">n</span> <span class=\"n\">A</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"n\">Ai</span> <span class=\"bp\">=</span> <span class=\"o\">⟨</span><span class=\"n\">A</span><span class=\"o\">,</span><span class=\"n\">n</span><span class=\"o\">⟩</span>\n\n<span class=\"kd\">def</span> <span class=\"n\">is_conclusion</span> <span class=\"o\">(</span><span class=\"n\">Ai</span> <span class=\"o\">:</span> <span class=\"n\">Form_occ</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">Link</span> <span class=\"bp\">→</span> <span class=\"kt\">Prop</span>\n<span class=\"bp\">|</span> <span class=\"o\">(</span><span class=\"n\">Link.ax</span> <span class=\"n\">n</span> <span class=\"n\">m</span> <span class=\"n\">B</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"o\">(</span><span class=\"n\">Ai</span> <span class=\"bp\">=</span> <span class=\"o\">⟨</span><span class=\"n\">B</span><span class=\"o\">,</span><span class=\"n\">n</span><span class=\"o\">⟩)</span> <span class=\"bp\">∨</span> <span class=\"o\">(</span><span class=\"n\">Ai</span> <span class=\"bp\">=</span> <span class=\"o\">⟨</span><span class=\"bp\">~</span><span class=\"n\">B</span><span class=\"o\">,</span><span class=\"n\">m</span><span class=\"o\">⟩)</span>\n<span class=\"bp\">|</span> <span class=\"o\">(</span><span class=\"n\">Link.cut</span> <span class=\"n\">n</span> <span class=\"n\">m</span> <span class=\"n\">B</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"n\">false</span>\n<span class=\"bp\">|</span> <span class=\"o\">(</span><span class=\"n\">Link.tensor</span> <span class=\"n\">n</span> <span class=\"n\">m</span> <span class=\"n\">k</span> <span class=\"n\">A</span> <span class=\"n\">B</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"n\">Ai</span> <span class=\"bp\">=</span> <span class=\"o\">⟨</span><span class=\"n\">A</span> <span class=\"bp\">⊗</span> <span class=\"n\">B</span><span class=\"o\">,</span><span class=\"n\">k</span><span class=\"o\">⟩</span>\n<span class=\"bp\">|</span> <span class=\"o\">(</span><span class=\"n\">Link.par</span> <span class=\"n\">n</span> <span class=\"n\">m</span> <span class=\"n\">k</span> <span class=\"n\">A</span> <span class=\"n\">B</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"n\">Ai</span> <span class=\"bp\">=</span> <span class=\"o\">⟨</span><span class=\"n\">A</span> <span class=\"n\">⅋</span> <span class=\"n\">B</span><span class=\"o\">,</span><span class=\"n\">k</span><span class=\"o\">⟩</span>\n<span class=\"bp\">|</span> <span class=\"o\">(</span><span class=\"n\">Link.con</span> <span class=\"n\">n</span> <span class=\"n\">A</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"n\">false</span>\n\n<span class=\"kd\">structure</span> <span class=\"n\">proof_structure</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span> <span class=\"o\">:=</span>\n<span class=\"o\">(</span><span class=\"n\">links</span> <span class=\"o\">:</span> <span class=\"n\">set</span> <span class=\"n\">Link</span><span class=\"o\">)</span>\n<span class=\"o\">(</span><span class=\"n\">form_occs</span> <span class=\"o\">:</span> <span class=\"n\">set</span> <span class=\"n\">Form_occ</span><span class=\"o\">)</span>\n<span class=\"o\">(</span><span class=\"n\">link_prem</span> <span class=\"o\">:</span> <span class=\"bp\">∀</span> <span class=\"n\">l</span> <span class=\"bp\">∈</span> <span class=\"n\">links</span><span class=\"o\">,</span> <span class=\"bp\">∀</span> <span class=\"n\">Ai</span> <span class=\"o\">:</span> <span class=\"n\">Form_occ</span><span class=\"o\">,</span> <span class=\"n\">is_premise</span> <span class=\"n\">Ai</span> <span class=\"n\">l</span> <span class=\"bp\">→</span> <span class=\"n\">Ai</span> <span class=\"bp\">∈</span> <span class=\"n\">form_occs</span><span class=\"o\">)</span>\n<span class=\"o\">(</span><span class=\"n\">link_con</span> <span class=\"o\">:</span> <span class=\"bp\">∀</span> <span class=\"n\">l</span> <span class=\"bp\">∈</span> <span class=\"n\">links</span><span class=\"o\">,</span> <span class=\"bp\">∀</span> <span class=\"n\">Ai</span> <span class=\"o\">:</span> <span class=\"n\">Form_occ</span><span class=\"o\">,</span> <span class=\"n\">is_conclusion</span> <span class=\"n\">Ai</span> <span class=\"n\">l</span> <span class=\"bp\">→</span> <span class=\"n\">Ai</span> <span class=\"bp\">∈</span> <span class=\"n\">form_occs</span><span class=\"o\">)</span>\n<span class=\"o\">(</span><span class=\"n\">premise</span> <span class=\"o\">:</span> <span class=\"n\">Form_occ</span> <span class=\"bp\">→</span> <span class=\"n\">Link</span><span class=\"o\">)</span>\n<span class=\"o\">(</span><span class=\"n\">prem_unique</span> <span class=\"o\">:</span> <span class=\"bp\">∀</span> <span class=\"n\">Ai</span> <span class=\"bp\">∈</span> <span class=\"n\">form_occs</span><span class=\"o\">,</span> <span class=\"bp\">∀</span> <span class=\"n\">l</span> <span class=\"bp\">∈</span> <span class=\"n\">links</span><span class=\"o\">,</span> <span class=\"n\">is_premise</span> <span class=\"n\">Ai</span> <span class=\"n\">l</span> <span class=\"bp\">→</span> <span class=\"n\">premise</span> <span class=\"n\">Ai</span> <span class=\"bp\">=</span> <span class=\"n\">l</span><span class=\"o\">)</span>\n<span class=\"o\">(</span><span class=\"n\">prem_range</span> <span class=\"o\">:</span> <span class=\"bp\">∀</span> <span class=\"n\">Ai</span> <span class=\"bp\">∈</span> <span class=\"n\">form_occs</span><span class=\"o\">,</span> <span class=\"n\">premise</span> <span class=\"n\">Ai</span> <span class=\"bp\">∈</span> <span class=\"n\">links</span> <span class=\"bp\">∧</span> <span class=\"n\">is_premise</span> <span class=\"n\">Ai</span> <span class=\"o\">(</span><span class=\"n\">premise</span> <span class=\"n\">Ai</span><span class=\"o\">))</span>\n<span class=\"o\">(</span><span class=\"n\">conclusion</span> <span class=\"o\">:</span> <span class=\"n\">Form_occ</span> <span class=\"bp\">→</span> <span class=\"n\">Link</span><span class=\"o\">)</span>\n<span class=\"o\">(</span><span class=\"n\">con_unique</span> <span class=\"o\">:</span> <span class=\"bp\">∀</span> <span class=\"n\">Ai</span> <span class=\"bp\">∈</span> <span class=\"n\">form_occs</span><span class=\"o\">,</span> <span class=\"bp\">∀</span> <span class=\"n\">l</span> <span class=\"bp\">∈</span> <span class=\"n\">links</span><span class=\"o\">,</span> <span class=\"n\">is_conclusion</span> <span class=\"n\">Ai</span> <span class=\"n\">l</span> <span class=\"bp\">→</span> <span class=\"n\">conclusion</span> <span class=\"n\">Ai</span> <span class=\"bp\">=</span> <span class=\"n\">l</span><span class=\"o\">)</span>\n<span class=\"o\">(</span><span class=\"n\">con_range</span> <span class=\"o\">:</span> <span class=\"bp\">∀</span> <span class=\"n\">Ai</span> <span class=\"bp\">∈</span> <span class=\"n\">form_occs</span><span class=\"o\">,</span> <span class=\"n\">conclusion</span> <span class=\"n\">Ai</span> <span class=\"bp\">∈</span> <span class=\"n\">links</span> <span class=\"bp\">∧</span> <span class=\"n\">is_conclusion</span> <span class=\"n\">Ai</span> <span class=\"o\">(</span><span class=\"n\">conclusion</span> <span class=\"n\">Ai</span><span class=\"o\">))</span>\n\n<span class=\"kd\">@[reducible]</span>\n<span class=\"kd\">def</span> <span class=\"n\">dir</span> <span class=\"o\">:=</span> <span class=\"n\">bool</span>\n\n<span class=\"kd\">@[pattern]</span> <span class=\"kd\">def</span> <span class=\"n\">down</span> <span class=\"o\">:=</span> <span class=\"n\">ff</span>\n<span class=\"kd\">@[pattern]</span> <span class=\"kd\">def</span> <span class=\"n\">up</span> <span class=\"o\">:=</span> <span class=\"n\">tt</span>\n\n<span class=\"kd\">@[pattern]</span> <span class=\"kd\">def</span> <span class=\"n\">with_down</span> <span class=\"o\">(</span><span class=\"n\">Ai</span> <span class=\"o\">:</span> <span class=\"n\">Form_occ</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"o\">(</span><span class=\"n\">Ai</span><span class=\"o\">,</span><span class=\"n\">down</span><span class=\"o\">)</span>\n<span class=\"kd\">@[pattern]</span> <span class=\"kd\">def</span> <span class=\"n\">with_up</span> <span class=\"o\">(</span><span class=\"n\">Ai</span> <span class=\"o\">:</span> <span class=\"n\">Form_occ</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"o\">(</span><span class=\"n\">Ai</span><span class=\"o\">,</span><span class=\"n\">up</span><span class=\"o\">)</span>\n<span class=\"kd\">postfix</span> <span class=\"bp\">`↓`</span><span class=\"o\">:</span><span class=\"n\">max_plus</span> <span class=\"o\">:=</span> <span class=\"n\">with_down</span>\n<span class=\"kd\">postfix</span> <span class=\"bp\">`↑`</span><span class=\"o\">:</span><span class=\"n\">max_plus</span> <span class=\"o\">:=</span> <span class=\"n\">with_up</span>\n\n<span class=\"kd\">@[reducible]</span>\n<span class=\"kd\">def</span> <span class=\"n\">switch</span> <span class=\"o\">:=</span> <span class=\"n\">bool</span>\n\n<span class=\"kd\">@[reducible, pattern]</span> <span class=\"kd\">def</span> <span class=\"n\">L</span> <span class=\"o\">:=</span> <span class=\"n\">ff</span>\n<span class=\"kd\">@[reducible, pattern]</span> <span class=\"kd\">def</span> <span class=\"n\">R</span> <span class=\"o\">:=</span> <span class=\"n\">tt</span>\n\n<span class=\"kd\">def</span> <span class=\"n\">switching</span> <span class=\"o\">:=</span> <span class=\"n\">Link</span> <span class=\"bp\">→</span> <span class=\"n\">switch</span>\n\n<span class=\"kd\">@[simp]</span>\n<span class=\"kd\">def</span> <span class=\"n\">switch.flip</span> <span class=\"o\">{</span><span class=\"n\">α</span> <span class=\"n\">β</span><span class=\"o\">}</span> <span class=\"o\">(</span><span class=\"n\">f</span> <span class=\"o\">:</span> <span class=\"n\">α</span> <span class=\"bp\">→</span> <span class=\"n\">α</span> <span class=\"bp\">→</span> <span class=\"n\">β</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">switch</span> <span class=\"bp\">→</span> <span class=\"n\">α</span> <span class=\"bp\">→</span> <span class=\"n\">α</span> <span class=\"bp\">→</span> <span class=\"n\">β</span>\n<span class=\"bp\">|</span> <span class=\"n\">L</span> <span class=\"n\">a</span> <span class=\"n\">b</span> <span class=\"o\">:=</span> <span class=\"n\">f</span> <span class=\"n\">a</span> <span class=\"n\">b</span>\n<span class=\"bp\">|</span> <span class=\"n\">R</span> <span class=\"n\">a</span> <span class=\"n\">b</span> <span class=\"o\">:=</span> <span class=\"n\">f</span> <span class=\"n\">b</span> <span class=\"n\">a</span>\n\n<span class=\"kd\">@[simp]</span> <span class=\"kd\">lemma</span> <span class=\"n\">flip_L</span> <span class=\"o\">{</span><span class=\"n\">α</span> <span class=\"n\">β</span><span class=\"o\">}</span> <span class=\"o\">{</span><span class=\"n\">f</span> <span class=\"o\">:</span> <span class=\"n\">α</span> <span class=\"bp\">→</span> <span class=\"n\">α</span> <span class=\"bp\">→</span> <span class=\"n\">β</span><span class=\"o\">}</span> <span class=\"o\">{</span><span class=\"n\">a</span> <span class=\"n\">b</span><span class=\"o\">}</span> <span class=\"o\">:</span> <span class=\"n\">switch.flip</span> <span class=\"n\">f</span> <span class=\"n\">L</span> <span class=\"n\">a</span> <span class=\"n\">b</span> <span class=\"bp\">=</span> <span class=\"n\">f</span> <span class=\"n\">a</span> <span class=\"n\">b</span> <span class=\"o\">:=</span> <span class=\"n\">rfl</span>\n<span class=\"kd\">@[simp]</span> <span class=\"kd\">lemma</span> <span class=\"n\">flip_R</span> <span class=\"o\">{</span><span class=\"n\">α</span> <span class=\"n\">β</span><span class=\"o\">}</span> <span class=\"o\">{</span><span class=\"n\">f</span> <span class=\"o\">:</span> <span class=\"n\">α</span> <span class=\"bp\">→</span> <span class=\"n\">α</span> <span class=\"bp\">→</span> <span class=\"n\">β</span><span class=\"o\">}</span> <span class=\"o\">{</span><span class=\"n\">a</span> <span class=\"n\">b</span><span class=\"o\">}</span> <span class=\"o\">:</span> <span class=\"n\">switch.flip</span> <span class=\"n\">f</span> <span class=\"n\">R</span> <span class=\"n\">a</span> <span class=\"n\">b</span> <span class=\"bp\">=</span> <span class=\"n\">f</span> <span class=\"n\">b</span> <span class=\"n\">a</span> <span class=\"o\">:=</span> <span class=\"n\">rfl</span>\n\n<span class=\"kd\">inductive</span> <span class=\"n\">steps_tensor</span> <span class=\"o\">(</span><span class=\"n\">Ai</span> <span class=\"n\">Bi</span> <span class=\"n\">Ci</span> <span class=\"o\">:</span> <span class=\"n\">Form_occ</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">Form_occ</span> <span class=\"bp\">×</span> <span class=\"n\">dir</span> <span class=\"bp\">→</span> <span class=\"n\">Form_occ</span> <span class=\"bp\">×</span> <span class=\"n\">dir</span> <span class=\"bp\">→</span> <span class=\"kt\">Prop</span>\n<span class=\"bp\">|</span> <span class=\"n\">down</span> <span class=\"o\">:</span> <span class=\"n\">steps_tensor</span> <span class=\"n\">Ai</span><span class=\"bp\">↓</span> <span class=\"n\">Ci</span><span class=\"bp\">↓</span>\n<span class=\"bp\">|</span> <span class=\"n\">turn</span> <span class=\"o\">:</span> <span class=\"n\">steps_tensor</span> <span class=\"n\">Bi</span><span class=\"bp\">↓</span> <span class=\"n\">Ai</span><span class=\"bp\">↑</span>\n<span class=\"bp\">|</span> <span class=\"n\">up</span> <span class=\"o\">:</span> <span class=\"n\">steps_tensor</span> <span class=\"n\">Ci</span><span class=\"bp\">↑</span> <span class=\"n\">Bi</span><span class=\"bp\">↑</span>\n\n<span class=\"kd\">inductive</span> <span class=\"n\">steps_par</span> <span class=\"o\">(</span><span class=\"n\">Ai</span> <span class=\"n\">Bi</span> <span class=\"n\">Ci</span> <span class=\"o\">:</span> <span class=\"n\">Form_occ</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">Form_occ</span> <span class=\"bp\">×</span> <span class=\"n\">dir</span> <span class=\"bp\">→</span> <span class=\"n\">Form_occ</span> <span class=\"bp\">×</span> <span class=\"n\">dir</span> <span class=\"bp\">→</span> <span class=\"kt\">Prop</span>\n<span class=\"bp\">|</span> <span class=\"n\">down</span> <span class=\"o\">:</span> <span class=\"n\">steps_par</span> <span class=\"n\">Ai</span><span class=\"bp\">↓</span> <span class=\"n\">Ci</span><span class=\"bp\">↓</span>\n<span class=\"bp\">|</span> <span class=\"n\">turn</span> <span class=\"o\">:</span> <span class=\"n\">steps_par</span> <span class=\"n\">Bi</span><span class=\"bp\">↓</span> <span class=\"n\">Bi</span><span class=\"bp\">↑</span>\n<span class=\"bp\">|</span> <span class=\"n\">up</span> <span class=\"o\">:</span> <span class=\"n\">steps_par</span> <span class=\"n\">Ci</span><span class=\"bp\">↑</span> <span class=\"n\">Ai</span><span class=\"bp\">↑</span>\n\n<span class=\"kd\">inductive</span> <span class=\"n\">dual</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"o\">:</span> <span class=\"n\">Form</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">ai</span> <span class=\"n\">ni</span> <span class=\"o\">:</span> <span class=\"n\">ℕ</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">Form_occ</span> <span class=\"bp\">→</span> <span class=\"n\">Form_occ</span> <span class=\"bp\">→</span> <span class=\"kt\">Prop</span>\n<span class=\"bp\">|</span> <span class=\"n\">posneg</span> <span class=\"o\">:</span> <span class=\"n\">dual</span> <span class=\"o\">(</span><span class=\"n\">A</span><span class=\"o\">,</span><span class=\"n\">ai</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"bp\">~</span><span class=\"n\">A</span><span class=\"o\">,</span><span class=\"n\">ni</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"n\">negpos</span> <span class=\"o\">:</span> <span class=\"n\">dual</span> <span class=\"o\">(</span><span class=\"bp\">~</span><span class=\"n\">A</span><span class=\"o\">,</span><span class=\"n\">ni</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">A</span><span class=\"o\">,</span><span class=\"n\">ai</span><span class=\"o\">)</span>\n\n<span class=\"kd\">inductive</span> <span class=\"n\">steps</span> <span class=\"o\">(</span><span class=\"n\">T</span> <span class=\"o\">:</span> <span class=\"n\">switch</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">Link</span> <span class=\"bp\">→</span> <span class=\"n\">Form_occ</span> <span class=\"bp\">×</span> <span class=\"n\">dir</span> <span class=\"bp\">→</span> <span class=\"n\">Form_occ</span> <span class=\"bp\">×</span> <span class=\"n\">dir</span> <span class=\"bp\">→</span> <span class=\"kt\">Prop</span>\n<span class=\"bp\">|</span> <span class=\"n\">ax</span>  <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"o\">:</span> <span class=\"n\">Form</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">ai</span> <span class=\"n\">ni</span> <span class=\"o\">:</span> <span class=\"n\">ℕ</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">Bi</span> <span class=\"n\">Ci</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">dual</span> <span class=\"n\">A</span> <span class=\"n\">ai</span> <span class=\"n\">ni</span> <span class=\"n\">Bi</span> <span class=\"n\">Ci</span> <span class=\"bp\">→</span> <span class=\"n\">steps</span> <span class=\"o\">(</span><span class=\"n\">Link.ax</span> <span class=\"n\">ai</span> <span class=\"n\">ni</span> <span class=\"n\">A</span><span class=\"o\">)</span> <span class=\"n\">Bi</span><span class=\"bp\">↑</span> <span class=\"n\">Ci</span><span class=\"bp\">↓</span>\n<span class=\"bp\">|</span> <span class=\"n\">cut</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"o\">:</span> <span class=\"n\">Form</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">ai</span> <span class=\"n\">ni</span> <span class=\"o\">:</span> <span class=\"n\">ℕ</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">Bi</span> <span class=\"n\">Ci</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">dual</span> <span class=\"n\">A</span> <span class=\"n\">ai</span> <span class=\"n\">ni</span> <span class=\"n\">Bi</span> <span class=\"n\">Ci</span> <span class=\"bp\">→</span> <span class=\"n\">steps</span> <span class=\"o\">(</span><span class=\"n\">Link.cut</span> <span class=\"n\">ai</span> <span class=\"n\">ni</span> <span class=\"n\">A</span><span class=\"o\">)</span> <span class=\"n\">Bi</span><span class=\"bp\">↓</span> <span class=\"n\">Ci</span><span class=\"bp\">↑</span>\n<span class=\"bp\">|</span> <span class=\"n\">con</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"o\">:</span> <span class=\"n\">Form</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">ai</span> <span class=\"o\">:</span> <span class=\"n\">ℕ</span><span class=\"o\">)</span>            <span class=\"o\">:</span> <span class=\"n\">steps</span> <span class=\"o\">(</span><span class=\"n\">Link.con</span> <span class=\"n\">ai</span> <span class=\"n\">A</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">A</span><span class=\"o\">,</span> <span class=\"n\">ai</span><span class=\"o\">)</span><span class=\"bp\">↓</span> <span class=\"o\">(</span><span class=\"n\">A</span><span class=\"o\">,</span><span class=\"n\">ai</span><span class=\"o\">)</span><span class=\"bp\">↑</span>\n<span class=\"bp\">|</span> <span class=\"n\">tensor</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"n\">B</span> <span class=\"o\">:</span> <span class=\"n\">Form</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">ai</span> <span class=\"n\">bi</span> <span class=\"n\">ci</span> <span class=\"o\">:</span> <span class=\"n\">ℕ</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">x</span> <span class=\"n\">y</span><span class=\"o\">)</span> <span class=\"o\">:</span>\n  <span class=\"n\">T.flip</span> <span class=\"n\">steps_tensor</span> <span class=\"o\">(</span><span class=\"n\">A</span><span class=\"o\">,</span> <span class=\"n\">ai</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">B</span><span class=\"o\">,</span> <span class=\"n\">bi</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"bp\">⊗</span> <span class=\"n\">B</span><span class=\"o\">,</span> <span class=\"n\">ci</span><span class=\"o\">)</span> <span class=\"n\">x</span> <span class=\"n\">y</span> <span class=\"bp\">→</span>\n  <span class=\"n\">steps</span> <span class=\"o\">(</span><span class=\"n\">Link.tensor</span> <span class=\"n\">ai</span> <span class=\"n\">bi</span> <span class=\"n\">ci</span> <span class=\"n\">A</span> <span class=\"n\">B</span><span class=\"o\">)</span> <span class=\"n\">x</span> <span class=\"n\">y</span>\n<span class=\"bp\">|</span> <span class=\"n\">par</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"n\">B</span> <span class=\"o\">:</span> <span class=\"n\">Form</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">ai</span> <span class=\"n\">bi</span> <span class=\"n\">ci</span> <span class=\"o\">:</span> <span class=\"n\">ℕ</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">x</span> <span class=\"n\">y</span><span class=\"o\">)</span> <span class=\"o\">:</span>\n  <span class=\"n\">T.flip</span> <span class=\"n\">steps_par</span> <span class=\"o\">(</span><span class=\"n\">A</span><span class=\"o\">,</span> <span class=\"n\">ai</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">B</span><span class=\"o\">,</span> <span class=\"n\">bi</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"n\">⅋</span> <span class=\"n\">B</span><span class=\"o\">,</span> <span class=\"n\">ci</span><span class=\"o\">)</span> <span class=\"n\">x</span> <span class=\"n\">y</span> <span class=\"bp\">→</span>\n  <span class=\"n\">steps</span> <span class=\"o\">(</span><span class=\"n\">Link.par</span> <span class=\"n\">ai</span> <span class=\"n\">bi</span> <span class=\"n\">ci</span> <span class=\"n\">A</span> <span class=\"n\">B</span><span class=\"o\">)</span> <span class=\"n\">x</span> <span class=\"n\">y</span>\n\n<span class=\"kd\">theorem</span> <span class=\"n\">dual_unique_prev</span> <span class=\"o\">{</span><span class=\"n\">A</span> <span class=\"n\">ai</span> <span class=\"n\">ni</span> <span class=\"n\">Bi</span> <span class=\"n\">Ci</span> <span class=\"n\">Di</span><span class=\"o\">}</span>\n  <span class=\"o\">(</span><span class=\"n\">d₁</span> <span class=\"o\">:</span> <span class=\"n\">dual</span> <span class=\"n\">A</span> <span class=\"n\">ai</span> <span class=\"n\">ni</span> <span class=\"n\">Bi</span> <span class=\"n\">Ci</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">d₂</span> <span class=\"o\">:</span> <span class=\"n\">dual</span> <span class=\"n\">A</span> <span class=\"n\">ai</span> <span class=\"n\">ni</span> <span class=\"n\">Di</span> <span class=\"n\">Ci</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">Bi</span> <span class=\"bp\">=</span> <span class=\"n\">Di</span> <span class=\"o\">:=</span>\n<span class=\"kd\">begin</span>\n  <span class=\"n\">generalize_hyp</span> <span class=\"n\">e</span> <span class=\"o\">:</span> <span class=\"n\">Ci</span> <span class=\"bp\">=</span> <span class=\"n\">Ci'</span> <span class=\"n\">at</span> <span class=\"n\">d₂</span><span class=\"o\">,</span>\n  <span class=\"k\">have</span> <span class=\"o\">:</span> <span class=\"n\">A</span> <span class=\"bp\">≠</span> <span class=\"bp\">~</span><span class=\"n\">A</span><span class=\"o\">,</span>\n  <span class=\"o\">{</span> <span class=\"n\">intro</span> <span class=\"n\">e</span><span class=\"o\">,</span>\n    <span class=\"n\">apply_fun</span> <span class=\"n\">Form.sizeof</span> <span class=\"n\">at</span> <span class=\"n\">e</span><span class=\"o\">,</span>\n    <span class=\"n\">refine</span> <span class=\"n\">ne_of_lt</span> <span class=\"n\">_</span> <span class=\"n\">e</span><span class=\"o\">,</span>\n    <span class=\"n\">rw</span> <span class=\"o\">[</span><span class=\"n\">Form.sizeof</span><span class=\"o\">,</span> <span class=\"n\">nat.add_comm</span><span class=\"o\">],</span> <span class=\"n\">exact</span> <span class=\"n\">nat.lt_succ_self</span> <span class=\"n\">_</span> <span class=\"o\">},</span>\n  <span class=\"n\">cases</span> <span class=\"n\">d₁</span><span class=\"bp\">;</span> <span class=\"n\">cases</span> <span class=\"n\">d₂</span><span class=\"bp\">;</span> <span class=\"n\">injection</span> <span class=\"n\">e</span> <span class=\"k\">with</span> <span class=\"n\">e1</span> <span class=\"n\">e2</span><span class=\"bp\">;</span> <span class=\"n\">cases</span> <span class=\"n\">e2</span><span class=\"bp\">;</span>\n  <span class=\"n\">try</span> <span class=\"o\">{</span> <span class=\"n\">cases</span> <span class=\"n\">e1</span> <span class=\"o\">}</span><span class=\"bp\">;</span> <span class=\"o\">[</span><span class=\"n\">refl</span><span class=\"o\">,</span> <span class=\"n\">cases</span> <span class=\"n\">this</span> <span class=\"n\">e1.symm</span><span class=\"o\">,</span> <span class=\"n\">cases</span> <span class=\"n\">this</span> <span class=\"n\">e1</span><span class=\"o\">,</span> <span class=\"n\">refl</span><span class=\"o\">]</span>\n<span class=\"kd\">end</span>\n\n<span class=\"kd\">theorem</span> <span class=\"n\">steps_tensor_unique_prev</span> <span class=\"o\">(</span><span class=\"n\">Ai</span> <span class=\"n\">Bi</span> <span class=\"n\">Ci</span> <span class=\"o\">:</span> <span class=\"n\">Form_occ</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">X</span> <span class=\"n\">Y</span> <span class=\"n\">Z</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">Ai</span> <span class=\"bp\">≠</span> <span class=\"n\">Bi</span> <span class=\"bp\">→</span> <span class=\"n\">Bi</span> <span class=\"bp\">≠</span> <span class=\"n\">Ci</span> <span class=\"bp\">→</span> <span class=\"n\">Ai</span> <span class=\"bp\">≠</span> <span class=\"n\">Ci</span> <span class=\"bp\">→</span> <span class=\"n\">steps_tensor</span> <span class=\"n\">Ai</span> <span class=\"n\">Bi</span> <span class=\"n\">Ci</span> <span class=\"n\">X</span> <span class=\"n\">Z</span> <span class=\"bp\">→</span> <span class=\"n\">steps_tensor</span> <span class=\"n\">Ai</span> <span class=\"n\">Bi</span> <span class=\"n\">Ci</span> <span class=\"n\">Y</span> <span class=\"n\">Z</span> <span class=\"bp\">→</span> <span class=\"n\">X</span> <span class=\"bp\">=</span> <span class=\"n\">Y</span> <span class=\"o\">:=</span>\n<span class=\"kd\">begin</span>\n  <span class=\"n\">intros</span> <span class=\"n\">_</span> <span class=\"n\">_</span> <span class=\"n\">_</span> <span class=\"n\">s₁</span> <span class=\"n\">s₂</span><span class=\"o\">,</span>\n  <span class=\"n\">cases</span> <span class=\"n\">s₁</span><span class=\"bp\">;</span> <span class=\"n\">cases</span> <span class=\"n\">s₂</span><span class=\"bp\">;</span> <span class=\"n\">try</span> <span class=\"o\">{</span><span class=\"n\">refl</span><span class=\"o\">}</span><span class=\"bp\">;</span> <span class=\"n\">try</span> <span class=\"o\">{</span><span class=\"n\">contradiction</span><span class=\"o\">},</span>\n<span class=\"kd\">end</span>\n\n<span class=\"kd\">theorem</span> <span class=\"n\">steps_tensor_unique_next</span> <span class=\"o\">(</span><span class=\"n\">Ai</span> <span class=\"n\">Bi</span> <span class=\"n\">Ci</span> <span class=\"o\">:</span> <span class=\"n\">Form_occ</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">X</span> <span class=\"n\">Y</span> <span class=\"n\">Z</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">Ai</span> <span class=\"bp\">≠</span> <span class=\"n\">Bi</span> <span class=\"bp\">→</span> <span class=\"n\">Bi</span> <span class=\"bp\">≠</span> <span class=\"n\">Ci</span> <span class=\"bp\">→</span> <span class=\"n\">Ai</span> <span class=\"bp\">≠</span> <span class=\"n\">Ci</span> <span class=\"bp\">→</span> <span class=\"n\">steps_tensor</span> <span class=\"n\">Ai</span> <span class=\"n\">Bi</span> <span class=\"n\">Ci</span> <span class=\"n\">X</span> <span class=\"n\">Y</span> <span class=\"bp\">→</span> <span class=\"n\">steps_tensor</span> <span class=\"n\">Ai</span> <span class=\"n\">Bi</span> <span class=\"n\">Ci</span> <span class=\"n\">X</span> <span class=\"n\">Z</span> <span class=\"bp\">→</span> <span class=\"n\">Y</span> <span class=\"bp\">=</span> <span class=\"n\">Z</span> <span class=\"o\">:=</span>\n<span class=\"kd\">begin</span>\n  <span class=\"n\">intros</span> <span class=\"n\">_</span> <span class=\"n\">_</span> <span class=\"n\">_</span> <span class=\"n\">s₁</span> <span class=\"n\">s₂</span><span class=\"o\">,</span>\n  <span class=\"n\">cases</span> <span class=\"n\">s₁</span><span class=\"bp\">;</span> <span class=\"n\">cases</span> <span class=\"n\">s₂</span><span class=\"bp\">;</span> <span class=\"n\">try</span> <span class=\"o\">{</span><span class=\"n\">refl</span><span class=\"o\">}</span><span class=\"bp\">;</span> <span class=\"n\">try</span> <span class=\"o\">{</span><span class=\"n\">contradiction</span><span class=\"o\">},</span>\n<span class=\"kd\">end</span>\n\n<span class=\"kd\">theorem</span> <span class=\"n\">steps_par_unique_prev</span> <span class=\"o\">(</span><span class=\"n\">Ai</span> <span class=\"n\">Bi</span> <span class=\"n\">Ci</span> <span class=\"o\">:</span> <span class=\"n\">Form_occ</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">X</span> <span class=\"n\">Y</span> <span class=\"n\">Z</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">Ai</span> <span class=\"bp\">≠</span> <span class=\"n\">Bi</span> <span class=\"bp\">→</span> <span class=\"n\">Bi</span> <span class=\"bp\">≠</span> <span class=\"n\">Ci</span> <span class=\"bp\">→</span> <span class=\"n\">Ai</span> <span class=\"bp\">≠</span> <span class=\"n\">Ci</span> <span class=\"bp\">→</span> <span class=\"n\">steps_par</span> <span class=\"n\">Ai</span> <span class=\"n\">Bi</span> <span class=\"n\">Ci</span> <span class=\"n\">X</span> <span class=\"n\">Z</span> <span class=\"bp\">→</span> <span class=\"n\">steps_par</span> <span class=\"n\">Ai</span> <span class=\"n\">Bi</span> <span class=\"n\">Ci</span> <span class=\"n\">Y</span> <span class=\"n\">Z</span> <span class=\"bp\">→</span> <span class=\"n\">X</span> <span class=\"bp\">=</span> <span class=\"n\">Y</span> <span class=\"o\">:=</span>\n<span class=\"kd\">begin</span>\n  <span class=\"n\">intros</span> <span class=\"n\">_</span> <span class=\"n\">_</span> <span class=\"n\">_</span> <span class=\"n\">s₁</span> <span class=\"n\">s₂</span><span class=\"o\">,</span>\n  <span class=\"n\">cases</span> <span class=\"n\">s₁</span><span class=\"bp\">;</span> <span class=\"n\">cases</span> <span class=\"n\">s₂</span><span class=\"bp\">;</span> <span class=\"n\">try</span> <span class=\"o\">{</span><span class=\"n\">refl</span><span class=\"o\">}</span><span class=\"bp\">;</span> <span class=\"n\">try</span> <span class=\"o\">{</span><span class=\"n\">contradiction</span><span class=\"o\">},</span>\n<span class=\"kd\">end</span>\n\n<span class=\"kd\">theorem</span> <span class=\"n\">steps_par_unique_next</span> <span class=\"o\">(</span><span class=\"n\">Ai</span> <span class=\"n\">Bi</span> <span class=\"n\">Ci</span> <span class=\"o\">:</span> <span class=\"n\">Form_occ</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">X</span> <span class=\"n\">Y</span> <span class=\"n\">Z</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">Ai</span> <span class=\"bp\">≠</span> <span class=\"n\">Bi</span> <span class=\"bp\">→</span> <span class=\"n\">Bi</span> <span class=\"bp\">≠</span> <span class=\"n\">Ci</span> <span class=\"bp\">→</span> <span class=\"n\">Ai</span> <span class=\"bp\">≠</span> <span class=\"n\">Ci</span> <span class=\"bp\">→</span> <span class=\"n\">steps_par</span> <span class=\"n\">Ai</span> <span class=\"n\">Bi</span> <span class=\"n\">Ci</span> <span class=\"n\">X</span> <span class=\"n\">Y</span> <span class=\"bp\">→</span> <span class=\"n\">steps_par</span> <span class=\"n\">Ai</span> <span class=\"n\">Bi</span> <span class=\"n\">Ci</span> <span class=\"n\">X</span> <span class=\"n\">Z</span> <span class=\"bp\">→</span> <span class=\"n\">Y</span> <span class=\"bp\">=</span> <span class=\"n\">Z</span> <span class=\"o\">:=</span>\n<span class=\"kd\">begin</span>\n  <span class=\"n\">intros</span> <span class=\"n\">_</span> <span class=\"n\">_</span> <span class=\"n\">_</span> <span class=\"n\">s₁</span> <span class=\"n\">s₂</span><span class=\"o\">,</span>\n  <span class=\"n\">cases</span> <span class=\"n\">s₁</span><span class=\"bp\">;</span> <span class=\"n\">cases</span> <span class=\"n\">s₂</span><span class=\"bp\">;</span> <span class=\"n\">try</span> <span class=\"o\">{</span><span class=\"n\">refl</span><span class=\"o\">}</span><span class=\"bp\">;</span> <span class=\"n\">try</span> <span class=\"o\">{</span><span class=\"n\">contradiction</span><span class=\"o\">},</span>\n<span class=\"kd\">end</span>\n\n<span class=\"kd\">theorem</span> <span class=\"n\">steps_unique_prev</span> <span class=\"o\">(</span><span class=\"n\">T</span> <span class=\"o\">:</span> <span class=\"n\">switch</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"bp\">Δ</span> <span class=\"o\">:</span> <span class=\"n\">Link</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">h</span><span class=\"bp\">Δ</span> <span class=\"o\">:</span> <span class=\"n\">valid_link</span> <span class=\"bp\">Δ</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">X</span> <span class=\"n\">Y</span> <span class=\"n\">Z</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">steps</span> <span class=\"n\">T</span> <span class=\"bp\">Δ</span> <span class=\"n\">X</span> <span class=\"n\">Z</span> <span class=\"bp\">→</span> <span class=\"n\">steps</span> <span class=\"n\">T</span> <span class=\"bp\">Δ</span> <span class=\"n\">Y</span> <span class=\"n\">Z</span> <span class=\"bp\">→</span> <span class=\"n\">X</span> <span class=\"bp\">=</span> <span class=\"n\">Y</span> <span class=\"o\">:=</span>\n<span class=\"kd\">begin</span>\n  <span class=\"n\">intros</span> <span class=\"n\">s₁</span> <span class=\"n\">s₂</span><span class=\"o\">,</span>\n  <span class=\"n\">cases</span> <span class=\"n\">s₁</span><span class=\"o\">,</span>\n  <span class=\"n\">case</span> <span class=\"n\">steps.ax</span> <span class=\"o\">:</span> <span class=\"n\">A</span> <span class=\"n\">ai</span> <span class=\"n\">ni</span> <span class=\"n\">Bi</span> <span class=\"n\">Ci</span> <span class=\"n\">d₁</span> <span class=\"o\">{</span>\n    <span class=\"n\">cases</span> <span class=\"n\">s₂</span> <span class=\"k\">with</span> <span class=\"n\">_</span> <span class=\"n\">_</span> <span class=\"n\">_</span> <span class=\"n\">Di</span> <span class=\"n\">_</span> <span class=\"n\">d₂</span><span class=\"o\">,</span>\n    <span class=\"n\">rw</span> <span class=\"n\">dual_unique_prev</span> <span class=\"n\">d₁</span> <span class=\"n\">d₂</span> <span class=\"o\">},</span>\n  <span class=\"n\">case</span> <span class=\"n\">steps.cut</span> <span class=\"o\">:</span> <span class=\"n\">A</span> <span class=\"n\">ai</span> <span class=\"n\">ni</span> <span class=\"n\">Bi</span> <span class=\"n\">Ci</span> <span class=\"n\">d₁</span> <span class=\"o\">{</span>\n    <span class=\"n\">rcases</span> <span class=\"n\">s₂</span> <span class=\"k\">with</span> <span class=\"n\">_</span> <span class=\"bp\">|</span> <span class=\"o\">⟨</span><span class=\"n\">_</span><span class=\"o\">,</span><span class=\"n\">_</span><span class=\"o\">,</span><span class=\"n\">_</span><span class=\"o\">,</span><span class=\"n\">Di</span><span class=\"o\">,</span><span class=\"n\">_</span><span class=\"o\">,</span><span class=\"n\">d₂</span><span class=\"o\">⟩,</span>\n    <span class=\"n\">rw</span> <span class=\"n\">dual_unique_prev</span> <span class=\"n\">d₂</span> <span class=\"n\">d₁</span>\n  <span class=\"o\">},</span>\n  <span class=\"n\">case</span> <span class=\"n\">steps.con</span> <span class=\"o\">:</span> <span class=\"n\">A</span> <span class=\"n\">ai</span> <span class=\"o\">{</span> <span class=\"n\">cases</span> <span class=\"n\">s₂</span><span class=\"o\">,</span> <span class=\"n\">refl</span> <span class=\"o\">},</span>\n  <span class=\"n\">case</span> <span class=\"n\">steps.tensor</span> <span class=\"o\">:</span> <span class=\"n\">A</span> <span class=\"n\">B</span> <span class=\"n\">ai</span> <span class=\"n\">bi</span> <span class=\"n\">ci</span> <span class=\"n\">X</span> <span class=\"n\">y</span> <span class=\"n\">t₁</span> <span class=\"o\">{</span>\n    <span class=\"n\">rcases</span> <span class=\"n\">s₂</span> <span class=\"k\">with</span> <span class=\"n\">_</span> <span class=\"bp\">|</span> <span class=\"n\">_</span> <span class=\"bp\">|</span> <span class=\"n\">_</span> <span class=\"bp\">|</span> <span class=\"o\">⟨</span><span class=\"n\">_</span><span class=\"o\">,</span><span class=\"n\">_</span><span class=\"o\">,</span><span class=\"n\">_</span><span class=\"o\">,</span><span class=\"n\">_</span><span class=\"o\">,</span><span class=\"n\">_</span><span class=\"o\">,</span><span class=\"n\">_</span><span class=\"o\">,</span><span class=\"n\">_</span><span class=\"o\">,</span><span class=\"n\">t₂</span><span class=\"o\">⟩,</span>\n    <span class=\"n\">cases</span> <span class=\"n\">T</span><span class=\"o\">,</span> <span class=\"n\">apply</span> <span class=\"n\">steps_tensor_unique_prev</span> <span class=\"n\">_</span> <span class=\"n\">_</span> <span class=\"n\">_</span> <span class=\"n\">_</span> <span class=\"n\">_</span> <span class=\"n\">_</span> <span class=\"n\">_</span> <span class=\"n\">_</span> <span class=\"n\">_</span> <span class=\"n\">t₁</span> <span class=\"n\">t₂</span><span class=\"o\">,</span>\n    <span class=\"n\">cases</span> <span class=\"n\">h</span><span class=\"bp\">Δ</span><span class=\"o\">,</span> <span class=\"n\">finish</span><span class=\"o\">,</span> <span class=\"n\">rw</span> <span class=\"n\">flip_L</span><span class=\"o\">,</span>\n\n  <span class=\"o\">},</span>\n<span class=\"kd\">end</span>\n</code></pre></div>",
        "id": 242704802,
        "sender_full_name": "Billy Price",
        "timestamp": 1623747316
    },
    {
        "content": "<p>oh, you have to <code>rw flip_L at t₁ t₂</code></p>",
        "id": 242706718,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1623748497
    },
    {
        "content": "<p>Shouldn't I be able to just <code>simp</code>?</p>",
        "id": 242707611,
        "sender_full_name": "Billy Price",
        "timestamp": 1623748947
    },
    {
        "content": "<p>it still has to be <code>at t₁ t₂</code></p>",
        "id": 242708319,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1623749389
    },
    {
        "content": "<p>otherwise it will only simplify the goal, which does not mention flip</p>",
        "id": 242708374,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1623749408
    },
    {
        "content": "<p>you can also <code>at *</code> but this is usually not a good idea</p>",
        "id": 242708403,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1623749425
    },
    {
        "content": "<p>ah okay cheers</p>",
        "id": 242708415,
        "sender_full_name": "Billy Price",
        "timestamp": 1623749434
    },
    {
        "content": "<p>How can I prove the example here using the lemma, since I can't use <code>cases</code> on the <code>e</code>?</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kn\">import</span> <span class=\"n\">tactic</span>\n\n<span class=\"kd\">inductive</span> <span class=\"n\">Form</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span>\n<span class=\"bp\">|</span> <span class=\"n\">atom</span> <span class=\"o\">:</span> <span class=\"n\">ℕ</span> <span class=\"bp\">→</span> <span class=\"n\">Form</span>\n<span class=\"bp\">|</span> <span class=\"n\">tensor</span> <span class=\"o\">:</span> <span class=\"n\">Form</span> <span class=\"bp\">→</span> <span class=\"n\">Form</span> <span class=\"bp\">→</span> <span class=\"n\">Form</span>\n<span class=\"bp\">|</span> <span class=\"n\">par</span> <span class=\"o\">:</span> <span class=\"n\">Form</span> <span class=\"bp\">→</span> <span class=\"n\">Form</span> <span class=\"bp\">→</span> <span class=\"n\">Form</span>\n<span class=\"bp\">|</span> <span class=\"n\">neg</span> <span class=\"o\">:</span> <span class=\"n\">Form</span> <span class=\"bp\">→</span> <span class=\"n\">Form</span>\n\n<span class=\"kd\">infix</span> <span class=\"bp\">`</span> <span class=\"bp\">⊗</span> <span class=\"bp\">`</span><span class=\"o\">:</span><span class=\"mi\">70</span> <span class=\"o\">:=</span> <span class=\"n\">Form.tensor</span>\n<span class=\"kd\">infix</span> <span class=\"bp\">`</span> <span class=\"n\">⅋</span> <span class=\"bp\">`</span><span class=\"o\">:</span><span class=\"mi\">65</span> <span class=\"o\">:=</span> <span class=\"n\">Form.par</span>\n<span class=\"kd\">prefix</span> <span class=\"bp\">`~`</span> <span class=\"o\">:=</span> <span class=\"n\">Form.neg</span>\n\n<span class=\"kd\">lemma</span> <span class=\"n\">not_self_sub_left_tensor</span> <span class=\"o\">{</span><span class=\"n\">A</span> <span class=\"n\">B</span><span class=\"o\">}</span> <span class=\"o\">:</span> <span class=\"n\">A</span> <span class=\"bp\">≠</span> <span class=\"n\">A</span> <span class=\"bp\">⊗</span> <span class=\"n\">B</span> <span class=\"o\">:=</span>\n<span class=\"kd\">begin</span>\n  <span class=\"n\">intro</span> <span class=\"n\">e</span><span class=\"o\">,</span>\n  <span class=\"n\">apply_fun</span> <span class=\"n\">Form.sizeof</span> <span class=\"n\">at</span> <span class=\"n\">e</span><span class=\"o\">,</span>\n  <span class=\"n\">refine</span> <span class=\"n\">ne_of_lt</span> <span class=\"n\">_</span> <span class=\"n\">e</span><span class=\"o\">,</span>\n  <span class=\"n\">rw</span> <span class=\"o\">[</span><span class=\"n\">Form.sizeof</span><span class=\"o\">,</span> <span class=\"n\">nat.add_comm</span><span class=\"o\">],</span>\n  <span class=\"n\">apply</span> <span class=\"n\">nat.lt_of_succ_le</span><span class=\"o\">,</span>\n  <span class=\"n\">rw</span> <span class=\"n\">nat.add_comm</span><span class=\"o\">,</span> <span class=\"n\">rw</span> <span class=\"n\">nat.add_comm</span> <span class=\"mi\">1</span><span class=\"o\">,</span>\n  <span class=\"n\">apply</span> <span class=\"n\">nat.le_add_right</span><span class=\"o\">,</span>\n<span class=\"kd\">end</span>\n\n<span class=\"kd\">example</span> <span class=\"o\">{</span><span class=\"n\">A</span> <span class=\"n\">B</span><span class=\"o\">}</span> <span class=\"o\">{</span><span class=\"n\">n</span> <span class=\"n\">m</span> <span class=\"o\">:</span> <span class=\"n\">ℕ</span><span class=\"o\">}</span> <span class=\"o\">:</span> <span class=\"o\">(</span><span class=\"n\">A</span><span class=\"o\">,</span><span class=\"n\">n</span><span class=\"o\">)</span> <span class=\"bp\">≠</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"bp\">⊗</span> <span class=\"n\">B</span><span class=\"o\">,</span> <span class=\"n\">m</span><span class=\"o\">)</span> <span class=\"o\">:=</span>\n<span class=\"kd\">begin</span>\n  <span class=\"n\">intro</span> <span class=\"n\">e</span><span class=\"o\">,</span>\n<span class=\"kd\">end</span>\n</code></pre></div>",
        "id": 242708512,
        "sender_full_name": "Billy Price",
        "timestamp": 1623749487
    },
    {
        "content": "<p>use <code>injection</code></p>",
        "id": 242708567,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1623749517
    },
    {
        "content": "<p><code>injection e with e1, apply not_self_sub_left_tensor e1</code></p>",
        "id": 242708633,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1623749533
    },
    {
        "content": "<p>I have some candidate definitions for a trip around a proof net, and I'd like to understand how the choices involved would affect the usability. The first definition I wrote was what is now called <code>list_trip</code>, but the downside was it doesn't explicate where the trip ends. That's important for my later definitions, because I will be constantly talking about partial trips that start with <code>Ai↓</code> and end with <code>Ai↑</code>, and I also want to define cyclic trips, which start and end with the same thing. Those motivations inspired <code>trip1</code> and <code>trip2</code>. <code>trip1</code> seems to me like I'm defining my own list type with extra constraints, and <code>trip2</code> is the same but I get to add to either end.</p>\n<p>So what considerations should I take into account when choosing a definition here?</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kd\">inductive</span> <span class=\"n\">trip1</span> <span class=\"o\">(</span><span class=\"n\">ps</span> <span class=\"o\">:</span> <span class=\"n\">proof_structure</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">S</span> <span class=\"o\">:</span> <span class=\"n\">switching</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">Form_occ</span> <span class=\"bp\">×</span> <span class=\"n\">dir</span> <span class=\"bp\">→</span> <span class=\"n\">Form_occ</span> <span class=\"bp\">×</span> <span class=\"n\">dir</span> <span class=\"bp\">→</span> <span class=\"kt\">Prop</span>\n<span class=\"bp\">|</span> <span class=\"n\">single</span> <span class=\"o\">(</span><span class=\"n\">Ai</span> <span class=\"o\">:</span> <span class=\"n\">Form_occ</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">d</span> <span class=\"o\">:</span> <span class=\"n\">dir</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">Ai</span> <span class=\"bp\">∈</span> <span class=\"n\">ps</span> <span class=\"bp\">→</span> <span class=\"n\">trip1</span> <span class=\"o\">(</span><span class=\"n\">Ai</span><span class=\"o\">,</span><span class=\"n\">d</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">Ai</span><span class=\"o\">,</span><span class=\"n\">d</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"n\">cons</span> <span class=\"o\">(</span><span class=\"n\">Ai</span> <span class=\"n\">Bi</span> <span class=\"n\">Ci</span> <span class=\"o\">:</span> <span class=\"n\">Form_occ</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">d₁</span> <span class=\"n\">d₂</span> <span class=\"n\">d₃</span> <span class=\"o\">:</span> <span class=\"n\">dir</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"bp\">Δ</span> <span class=\"o\">:</span> <span class=\"n\">Link</span><span class=\"o\">)</span> <span class=\"o\">:</span>\n  <span class=\"bp\">Δ</span> <span class=\"bp\">∈</span> <span class=\"n\">ps.links</span> <span class=\"bp\">→</span> <span class=\"n\">steps</span> <span class=\"o\">(</span><span class=\"n\">S</span> <span class=\"bp\">Δ</span><span class=\"o\">)</span> <span class=\"bp\">Δ</span> <span class=\"o\">(</span><span class=\"n\">Ai</span><span class=\"o\">,</span><span class=\"n\">d₁</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">Bi</span><span class=\"o\">,</span><span class=\"n\">d₂</span><span class=\"o\">)</span> <span class=\"bp\">→</span> <span class=\"n\">trip1</span> <span class=\"o\">(</span><span class=\"n\">Bi</span><span class=\"o\">,</span><span class=\"n\">d₂</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">Ci</span><span class=\"o\">,</span> <span class=\"n\">d₃</span><span class=\"o\">)</span> <span class=\"bp\">→</span> <span class=\"n\">trip1</span> <span class=\"o\">(</span><span class=\"n\">Ai</span><span class=\"o\">,</span><span class=\"n\">d₁</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">Ci</span><span class=\"o\">,</span><span class=\"n\">d₃</span><span class=\"o\">)</span>\n\n<span class=\"kd\">inductive</span> <span class=\"n\">trip2</span> <span class=\"o\">(</span><span class=\"n\">ps</span> <span class=\"o\">:</span> <span class=\"n\">proof_structure</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">S</span> <span class=\"o\">:</span> <span class=\"n\">switching</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">Form_occ</span> <span class=\"bp\">×</span> <span class=\"n\">dir</span> <span class=\"bp\">→</span> <span class=\"n\">Form_occ</span> <span class=\"bp\">×</span> <span class=\"n\">dir</span> <span class=\"bp\">→</span> <span class=\"kt\">Prop</span>\n<span class=\"bp\">|</span> <span class=\"n\">single</span> <span class=\"o\">(</span><span class=\"n\">Ai</span> <span class=\"o\">:</span> <span class=\"n\">Form_occ</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">d</span> <span class=\"o\">:</span> <span class=\"n\">dir</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">Ai</span> <span class=\"bp\">∈</span> <span class=\"n\">ps</span> <span class=\"bp\">→</span> <span class=\"n\">trip2</span> <span class=\"o\">(</span><span class=\"n\">Ai</span><span class=\"o\">,</span><span class=\"n\">d</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">Ai</span><span class=\"o\">,</span><span class=\"n\">d</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"n\">front</span> <span class=\"o\">(</span><span class=\"n\">Ai</span> <span class=\"n\">Bi</span> <span class=\"n\">Ci</span> <span class=\"o\">:</span> <span class=\"n\">Form_occ</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">d₁</span> <span class=\"n\">d₂</span> <span class=\"n\">d₃</span> <span class=\"o\">:</span> <span class=\"n\">dir</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"bp\">Δ</span> <span class=\"o\">:</span> <span class=\"n\">Link</span><span class=\"o\">)</span> <span class=\"o\">:</span>\n  <span class=\"bp\">Δ</span> <span class=\"bp\">∈</span> <span class=\"n\">ps.links</span> <span class=\"bp\">→</span> <span class=\"n\">steps</span> <span class=\"o\">(</span><span class=\"n\">S</span> <span class=\"bp\">Δ</span><span class=\"o\">)</span> <span class=\"bp\">Δ</span> <span class=\"o\">(</span><span class=\"n\">Ai</span><span class=\"o\">,</span><span class=\"n\">d₁</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">Bi</span><span class=\"o\">,</span><span class=\"n\">d₂</span><span class=\"o\">)</span> <span class=\"bp\">→</span> <span class=\"n\">trip2</span> <span class=\"o\">(</span><span class=\"n\">Bi</span><span class=\"o\">,</span><span class=\"n\">d₂</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">Ci</span><span class=\"o\">,</span> <span class=\"n\">d₃</span><span class=\"o\">)</span> <span class=\"bp\">→</span> <span class=\"n\">trip2</span> <span class=\"o\">(</span><span class=\"n\">Ai</span><span class=\"o\">,</span><span class=\"n\">d₁</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">Ci</span><span class=\"o\">,</span><span class=\"n\">d₃</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"n\">back</span> <span class=\"o\">(</span><span class=\"n\">Ai</span> <span class=\"n\">Bi</span> <span class=\"n\">Ci</span> <span class=\"o\">:</span> <span class=\"n\">Form_occ</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">d₁</span> <span class=\"n\">d₂</span> <span class=\"n\">d₃</span> <span class=\"o\">:</span> <span class=\"n\">dir</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"bp\">Δ</span> <span class=\"o\">:</span> <span class=\"n\">Link</span><span class=\"o\">)</span> <span class=\"o\">:</span>\n  <span class=\"bp\">Δ</span> <span class=\"bp\">∈</span> <span class=\"n\">ps.links</span> <span class=\"bp\">→</span> <span class=\"n\">steps</span> <span class=\"o\">(</span><span class=\"n\">S</span> <span class=\"bp\">Δ</span><span class=\"o\">)</span> <span class=\"bp\">Δ</span> <span class=\"o\">(</span><span class=\"n\">Bi</span><span class=\"o\">,</span><span class=\"n\">d₂</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">Ci</span><span class=\"o\">,</span><span class=\"n\">d₃</span><span class=\"o\">)</span> <span class=\"bp\">→</span> <span class=\"n\">trip2</span> <span class=\"o\">(</span><span class=\"n\">Ai</span><span class=\"o\">,</span><span class=\"n\">d₁</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">Bi</span><span class=\"o\">,</span> <span class=\"n\">d₂</span><span class=\"o\">)</span> <span class=\"bp\">→</span> <span class=\"n\">trip2</span> <span class=\"o\">(</span><span class=\"n\">Ai</span><span class=\"o\">,</span><span class=\"n\">d₁</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">Ci</span><span class=\"o\">,</span><span class=\"n\">d₃</span><span class=\"o\">)</span>\n\n<span class=\"kd\">inductive</span> <span class=\"n\">list_trip</span> <span class=\"o\">(</span><span class=\"n\">ps</span> <span class=\"o\">:</span> <span class=\"n\">proof_structure</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">S</span> <span class=\"o\">:</span> <span class=\"n\">switching</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">list</span> <span class=\"o\">(</span><span class=\"n\">Form_occ</span> <span class=\"bp\">×</span> <span class=\"n\">dir</span><span class=\"o\">)</span> <span class=\"bp\">→</span> <span class=\"kt\">Prop</span>\n<span class=\"bp\">|</span> <span class=\"n\">emp</span> <span class=\"o\">:</span> <span class=\"n\">list_trip</span> <span class=\"o\">[]</span>\n<span class=\"bp\">|</span> <span class=\"n\">single</span> <span class=\"o\">(</span><span class=\"n\">Ai</span> <span class=\"o\">:</span> <span class=\"n\">Form_occ</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">d</span> <span class=\"o\">:</span> <span class=\"n\">dir</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">Ai</span> <span class=\"bp\">∈</span> <span class=\"n\">ps</span> <span class=\"bp\">→</span> <span class=\"n\">list_trip</span> <span class=\"o\">[(</span><span class=\"n\">Ai</span><span class=\"o\">,</span><span class=\"n\">d</span><span class=\"o\">)]</span>\n<span class=\"bp\">|</span> <span class=\"n\">cons</span> <span class=\"o\">(</span><span class=\"n\">Ai</span> <span class=\"n\">Bi</span> <span class=\"o\">:</span> <span class=\"n\">Form_occ</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">d₁</span> <span class=\"n\">d₂</span> <span class=\"o\">:</span> <span class=\"n\">dir</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"bp\">Γ</span> <span class=\"o\">:</span> <span class=\"n\">list</span> <span class=\"o\">(</span><span class=\"n\">Form_occ</span> <span class=\"bp\">×</span> <span class=\"n\">dir</span><span class=\"o\">))</span> <span class=\"o\">(</span><span class=\"bp\">Δ</span> <span class=\"o\">:</span> <span class=\"n\">Link</span><span class=\"o\">)</span> <span class=\"o\">:</span>\n  <span class=\"bp\">Δ</span> <span class=\"bp\">∈</span> <span class=\"n\">ps.links</span> <span class=\"bp\">→</span> <span class=\"n\">steps</span> <span class=\"o\">(</span><span class=\"n\">S</span> <span class=\"bp\">Δ</span><span class=\"o\">)</span> <span class=\"bp\">Δ</span> <span class=\"o\">(</span><span class=\"n\">Ai</span><span class=\"o\">,</span><span class=\"n\">d₁</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">Bi</span><span class=\"o\">,</span><span class=\"n\">d₂</span><span class=\"o\">)</span> <span class=\"bp\">→</span> <span class=\"n\">list_trip</span> <span class=\"o\">((</span><span class=\"n\">Bi</span><span class=\"o\">,</span><span class=\"n\">d₂</span><span class=\"o\">)</span> <span class=\"o\">::</span> <span class=\"bp\">Γ</span><span class=\"o\">)</span> <span class=\"bp\">→</span> <span class=\"n\">list_trip</span> <span class=\"o\">((</span><span class=\"n\">Ai</span><span class=\"o\">,</span><span class=\"n\">d₁</span><span class=\"o\">)</span> <span class=\"o\">::</span> <span class=\"o\">(</span><span class=\"n\">Bi</span><span class=\"o\">,</span><span class=\"n\">d₂</span><span class=\"o\">)</span> <span class=\"o\">::</span> <span class=\"bp\">Γ</span><span class=\"o\">)</span>\n</code></pre></div>",
        "id": 243507579,
        "sender_full_name": "Billy Price",
        "timestamp": 1624364703
    },
    {
        "content": "<p>I've pushed ahead with the <code>trip1</code> definition but I also added a trip length (nat) parameter. Is that a bad idea?</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kd\">inductive</span> <span class=\"n\">trip</span> <span class=\"o\">(</span><span class=\"n\">ps</span> <span class=\"o\">:</span> <span class=\"n\">proof_structure</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">S</span> <span class=\"o\">:</span> <span class=\"n\">switching</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">ℕ</span> <span class=\"bp\">→</span> <span class=\"n\">Form_occ</span> <span class=\"bp\">×</span> <span class=\"n\">dir</span> <span class=\"bp\">→</span> <span class=\"n\">Form_occ</span> <span class=\"bp\">×</span> <span class=\"n\">dir</span> <span class=\"bp\">→</span> <span class=\"kt\">Prop</span>\n<span class=\"bp\">|</span> <span class=\"n\">single</span> <span class=\"o\">{</span><span class=\"n\">Ai</span> <span class=\"n\">d</span><span class=\"o\">}</span>    <span class=\"o\">:</span> <span class=\"n\">Ai</span> <span class=\"bp\">∈</span> <span class=\"n\">ps</span> <span class=\"bp\">→</span> <span class=\"n\">trip</span> <span class=\"mi\">0</span> <span class=\"o\">(</span><span class=\"n\">Ai</span><span class=\"o\">,</span><span class=\"n\">d</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">Ai</span><span class=\"o\">,</span><span class=\"n\">d</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"n\">cons</span> <span class=\"o\">{</span><span class=\"n\">X</span> <span class=\"n\">Y</span> <span class=\"n\">Z</span> <span class=\"bp\">Δ</span> <span class=\"n\">n</span><span class=\"o\">}</span> <span class=\"o\">:</span> <span class=\"bp\">Δ</span> <span class=\"bp\">∈</span> <span class=\"n\">ps.links</span> <span class=\"bp\">→</span> <span class=\"n\">steps</span> <span class=\"o\">(</span><span class=\"n\">S</span> <span class=\"bp\">Δ</span><span class=\"o\">)</span> <span class=\"bp\">Δ</span> <span class=\"n\">X</span> <span class=\"n\">Y</span> <span class=\"bp\">→</span> <span class=\"n\">trip</span> <span class=\"n\">n</span> <span class=\"n\">Y</span> <span class=\"n\">Z</span> <span class=\"bp\">→</span> <span class=\"n\">trip</span> <span class=\"o\">(</span><span class=\"n\">n.succ</span><span class=\"o\">)</span> <span class=\"n\">X</span> <span class=\"n\">Z</span>\n</code></pre></div>\n<p>I went on to define <code>trip.rcons</code> as dual to <code>trip.cons</code>, where I can extend a trip on the other end with <code>def trip.rcons {Δ} : Δ ∈ ps.links → trip ps S n X Y → steps (S Δ) Δ Y Z → trip ps S n.succ X Z</code>.</p>\n<p>Having <code>trip.cons</code> as a constructor for <code>trip</code> was very useful to prove this theorem<br>\n<code>trip ps S n X Z → trip ps S n Y Z → X = Y</code><br>\nI did it by induction on <code>n</code> and then I broke down the two trips with into their <code>trip.cons</code> constructions.</p>\n<p>I'm now trying to prove this <code>theorem trip_unique_stop : trip ps S n X Y → trip ps S n X Z → Y = Z</code>, for which I'd like to do the same thing (induction on <code>n</code>), but then in the <code>nat.succ</code> case I need to break down the two trips not into their <code>trip.cons</code> components, but into their canonical <code>trip.rcons</code> components.</p>\n<p>I tried to generalise this into a <code>lemma trip_rcons_decompose {α : Prop} (f : Π Δ Y, Δ ∈ ps.links → trip ps S n X Y → steps (S Δ) Δ Y Z → α) : trip ps S n.succ X Z → α</code>, but I've essentially moved the problem. What can I do?</p>",
        "id": 243656915,
        "sender_full_name": "Billy Price",
        "timestamp": 1624457354
    },
    {
        "content": "<p>hmm, seems my mwe is too big for one message. Here's the file. Lemme know if I should provide it another way. <a href=\"/user_uploads/3121/5lr0jkcg_mmSm72xWfgiP-FP/mll.lean\">mll.lean</a></p>",
        "id": 243657358,
        "sender_full_name": "Billy Price",
        "timestamp": 1624457534
    },
    {
        "content": "<p>Okay I went ahead and made a better mwe with <code>sorry</code>'s, enjoy :)</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kn\">import</span> <span class=\"n\">tactic</span>\n\n<span class=\"kd\">inductive</span> <span class=\"n\">Form</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span>\n<span class=\"bp\">|</span> <span class=\"n\">atom</span> <span class=\"o\">:</span> <span class=\"n\">ℕ</span> <span class=\"bp\">→</span> <span class=\"n\">Form</span>\n<span class=\"bp\">|</span> <span class=\"n\">tensor</span> <span class=\"o\">:</span> <span class=\"n\">Form</span> <span class=\"bp\">→</span> <span class=\"n\">Form</span> <span class=\"bp\">→</span> <span class=\"n\">Form</span>\n<span class=\"bp\">|</span> <span class=\"n\">par</span> <span class=\"o\">:</span> <span class=\"n\">Form</span> <span class=\"bp\">→</span> <span class=\"n\">Form</span> <span class=\"bp\">→</span> <span class=\"n\">Form</span>\n<span class=\"bp\">|</span> <span class=\"n\">neg</span> <span class=\"o\">:</span> <span class=\"n\">Form</span> <span class=\"bp\">→</span> <span class=\"n\">Form</span>\n\n<span class=\"kd\">infix</span> <span class=\"bp\">`</span> <span class=\"bp\">⊗</span> <span class=\"bp\">`</span><span class=\"o\">:</span><span class=\"mi\">70</span> <span class=\"o\">:=</span> <span class=\"n\">Form.tensor</span>\n<span class=\"kd\">infix</span> <span class=\"bp\">`</span> <span class=\"n\">⅋</span> <span class=\"bp\">`</span><span class=\"o\">:</span><span class=\"mi\">65</span> <span class=\"o\">:=</span> <span class=\"n\">Form.par</span>\n<span class=\"kd\">prefix</span> <span class=\"bp\">`~`</span> <span class=\"o\">:=</span> <span class=\"n\">Form.neg</span>\n\n<span class=\"kd\">inductive</span> <span class=\"n\">Link</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span>\n<span class=\"bp\">|</span> <span class=\"n\">ax</span> <span class=\"o\">:</span> <span class=\"n\">ℕ</span> <span class=\"bp\">→</span> <span class=\"n\">ℕ</span> <span class=\"bp\">→</span> <span class=\"n\">Form</span> <span class=\"bp\">→</span> <span class=\"n\">Link</span>\n<span class=\"bp\">|</span> <span class=\"n\">cut</span> <span class=\"o\">:</span> <span class=\"n\">ℕ</span> <span class=\"bp\">→</span> <span class=\"n\">ℕ</span> <span class=\"bp\">→</span> <span class=\"n\">Form</span> <span class=\"bp\">→</span> <span class=\"n\">Link</span>\n<span class=\"bp\">|</span> <span class=\"n\">tensor</span> <span class=\"o\">:</span> <span class=\"n\">ℕ</span> <span class=\"bp\">→</span> <span class=\"n\">ℕ</span> <span class=\"bp\">→</span> <span class=\"n\">ℕ</span> <span class=\"bp\">→</span> <span class=\"n\">Form</span> <span class=\"bp\">→</span> <span class=\"n\">Form</span> <span class=\"bp\">→</span> <span class=\"n\">Link</span>\n<span class=\"bp\">|</span> <span class=\"n\">par</span> <span class=\"o\">:</span> <span class=\"n\">ℕ</span> <span class=\"bp\">→</span> <span class=\"n\">ℕ</span> <span class=\"bp\">→</span> <span class=\"n\">ℕ</span> <span class=\"bp\">→</span> <span class=\"n\">Form</span> <span class=\"bp\">→</span> <span class=\"n\">Form</span> <span class=\"bp\">→</span> <span class=\"n\">Link</span>\n<span class=\"bp\">|</span> <span class=\"n\">con</span> <span class=\"o\">:</span> <span class=\"n\">ℕ</span> <span class=\"bp\">→</span> <span class=\"n\">Form</span> <span class=\"bp\">→</span> <span class=\"n\">Link</span>\n\n<span class=\"kd\">def</span> <span class=\"n\">Form_occ</span> <span class=\"o\">:=</span> <span class=\"n\">Form</span> <span class=\"bp\">×</span> <span class=\"n\">ℕ</span>\n\n<span class=\"kd\">inductive</span> <span class=\"n\">premise</span> <span class=\"o\">:</span> <span class=\"n\">Form_occ</span> <span class=\"bp\">→</span> <span class=\"n\">Link</span> <span class=\"bp\">→</span> <span class=\"kt\">Prop</span>\n<span class=\"bp\">|</span> <span class=\"n\">cut_pos</span> <span class=\"o\">{</span><span class=\"n\">A</span> <span class=\"n\">i</span> <span class=\"n\">j</span><span class=\"o\">}</span>          <span class=\"o\">:</span> <span class=\"n\">premise</span> <span class=\"o\">(</span><span class=\"n\">A</span><span class=\"o\">,</span><span class=\"n\">i</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">Link.cut</span> <span class=\"n\">i</span> <span class=\"n\">j</span> <span class=\"n\">A</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"n\">cut_neg</span> <span class=\"o\">{</span><span class=\"n\">A</span> <span class=\"n\">i</span> <span class=\"n\">j</span><span class=\"o\">}</span>          <span class=\"o\">:</span> <span class=\"n\">premise</span> <span class=\"o\">(</span><span class=\"bp\">~</span><span class=\"n\">A</span><span class=\"o\">,</span><span class=\"n\">j</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">Link.cut</span> <span class=\"n\">i</span> <span class=\"n\">j</span> <span class=\"n\">A</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"n\">tensor_left</span> <span class=\"o\">{</span><span class=\"n\">A</span> <span class=\"n\">B</span> <span class=\"n\">i</span> <span class=\"n\">j</span> <span class=\"n\">k</span><span class=\"o\">}</span>  <span class=\"o\">:</span> <span class=\"n\">premise</span> <span class=\"o\">(</span><span class=\"n\">A</span><span class=\"o\">,</span><span class=\"n\">i</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">Link.tensor</span> <span class=\"n\">i</span> <span class=\"n\">j</span> <span class=\"n\">k</span> <span class=\"n\">A</span> <span class=\"n\">B</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"n\">tensor_right</span> <span class=\"o\">{</span><span class=\"n\">A</span> <span class=\"n\">B</span> <span class=\"n\">i</span> <span class=\"n\">j</span> <span class=\"n\">k</span><span class=\"o\">}</span> <span class=\"o\">:</span> <span class=\"n\">premise</span> <span class=\"o\">(</span><span class=\"n\">B</span><span class=\"o\">,</span><span class=\"n\">j</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">Link.tensor</span> <span class=\"n\">i</span> <span class=\"n\">j</span> <span class=\"n\">k</span> <span class=\"n\">A</span> <span class=\"n\">B</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"n\">par_left</span> <span class=\"o\">{</span><span class=\"n\">A</span> <span class=\"n\">B</span> <span class=\"n\">i</span> <span class=\"n\">j</span> <span class=\"n\">k</span><span class=\"o\">}</span>     <span class=\"o\">:</span> <span class=\"n\">premise</span> <span class=\"o\">(</span><span class=\"n\">A</span><span class=\"o\">,</span><span class=\"n\">i</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">Link.par</span> <span class=\"n\">i</span> <span class=\"n\">j</span> <span class=\"n\">k</span> <span class=\"n\">A</span> <span class=\"n\">B</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"n\">par_right</span> <span class=\"o\">{</span><span class=\"n\">A</span> <span class=\"n\">B</span> <span class=\"n\">i</span> <span class=\"n\">j</span> <span class=\"n\">k</span><span class=\"o\">}</span>    <span class=\"o\">:</span> <span class=\"n\">premise</span> <span class=\"o\">(</span><span class=\"n\">B</span><span class=\"o\">,</span><span class=\"n\">j</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">Link.par</span> <span class=\"n\">i</span> <span class=\"n\">j</span> <span class=\"n\">k</span> <span class=\"n\">A</span> <span class=\"n\">B</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"n\">con</span> <span class=\"o\">{</span><span class=\"n\">A</span> <span class=\"n\">i</span><span class=\"o\">}</span>                <span class=\"o\">:</span> <span class=\"n\">premise</span> <span class=\"o\">(</span><span class=\"n\">A</span><span class=\"o\">,</span><span class=\"n\">i</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">Link.con</span> <span class=\"n\">i</span> <span class=\"n\">A</span><span class=\"o\">)</span>\n\n<span class=\"kd\">inductive</span> <span class=\"n\">conclusion</span> <span class=\"o\">:</span> <span class=\"n\">Form_occ</span> <span class=\"bp\">→</span> <span class=\"n\">Link</span> <span class=\"bp\">→</span> <span class=\"kt\">Prop</span>\n<span class=\"bp\">|</span> <span class=\"n\">ax_pos</span> <span class=\"o\">{</span><span class=\"n\">A</span> <span class=\"n\">i</span> <span class=\"n\">j</span><span class=\"o\">}</span>     <span class=\"o\">:</span> <span class=\"n\">conclusion</span> <span class=\"o\">(</span><span class=\"n\">A</span><span class=\"o\">,</span><span class=\"n\">i</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">Link.ax</span> <span class=\"n\">i</span> <span class=\"n\">j</span> <span class=\"n\">A</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"n\">ax_neg</span> <span class=\"o\">{</span><span class=\"n\">A</span> <span class=\"n\">i</span> <span class=\"n\">j</span><span class=\"o\">}</span>     <span class=\"o\">:</span> <span class=\"n\">conclusion</span> <span class=\"o\">(</span><span class=\"bp\">~</span><span class=\"n\">A</span><span class=\"o\">,</span><span class=\"n\">j</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">Link.ax</span> <span class=\"n\">i</span> <span class=\"n\">j</span> <span class=\"n\">A</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"n\">tensor</span> <span class=\"o\">{</span><span class=\"n\">A</span> <span class=\"n\">B</span> <span class=\"n\">i</span> <span class=\"n\">j</span> <span class=\"n\">k</span><span class=\"o\">}</span> <span class=\"o\">:</span> <span class=\"n\">conclusion</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"bp\">⊗</span> <span class=\"n\">B</span><span class=\"o\">,</span><span class=\"n\">k</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">Link.tensor</span> <span class=\"n\">i</span> <span class=\"n\">j</span> <span class=\"n\">k</span> <span class=\"n\">A</span> <span class=\"n\">B</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"n\">par</span> <span class=\"o\">{</span><span class=\"n\">A</span> <span class=\"n\">B</span> <span class=\"n\">i</span> <span class=\"n\">j</span> <span class=\"n\">k</span><span class=\"o\">}</span>    <span class=\"o\">:</span> <span class=\"n\">conclusion</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"n\">⅋</span> <span class=\"n\">B</span><span class=\"o\">,</span><span class=\"n\">k</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">Link.par</span> <span class=\"n\">i</span> <span class=\"n\">j</span> <span class=\"n\">k</span> <span class=\"n\">A</span> <span class=\"n\">B</span><span class=\"o\">)</span>\n\n<span class=\"kd\">inductive</span> <span class=\"n\">valid_link</span> <span class=\"o\">:</span> <span class=\"n\">Link</span> <span class=\"bp\">→</span> <span class=\"kt\">Prop</span>\n<span class=\"bp\">|</span> <span class=\"n\">ax</span>  <span class=\"o\">(</span><span class=\"n\">i</span> <span class=\"n\">j</span> <span class=\"n\">A</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">valid_link</span> <span class=\"o\">(</span><span class=\"n\">Link.ax</span> <span class=\"n\">i</span> <span class=\"n\">j</span> <span class=\"n\">A</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"n\">cut</span> <span class=\"o\">(</span><span class=\"n\">i</span> <span class=\"n\">j</span> <span class=\"n\">A</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">valid_link</span> <span class=\"o\">(</span><span class=\"n\">Link.cut</span> <span class=\"n\">i</span> <span class=\"n\">j</span> <span class=\"n\">A</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"n\">con</span> <span class=\"o\">(</span><span class=\"n\">i</span> <span class=\"n\">A</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">valid_link</span> <span class=\"o\">(</span><span class=\"n\">Link.con</span> <span class=\"n\">i</span> <span class=\"n\">A</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"n\">tensor</span> <span class=\"o\">(</span><span class=\"n\">i</span> <span class=\"n\">j</span> <span class=\"n\">k</span> <span class=\"n\">A</span> <span class=\"n\">B</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"o\">(</span><span class=\"n\">A</span><span class=\"o\">,</span><span class=\"n\">i</span><span class=\"o\">)</span> <span class=\"bp\">≠</span> <span class=\"o\">(</span><span class=\"n\">B</span><span class=\"o\">,</span><span class=\"n\">j</span><span class=\"o\">)</span> <span class=\"bp\">→</span> <span class=\"n\">valid_link</span> <span class=\"o\">(</span><span class=\"n\">Link.tensor</span> <span class=\"n\">i</span> <span class=\"n\">j</span> <span class=\"n\">k</span> <span class=\"n\">A</span> <span class=\"n\">B</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"n\">par</span> <span class=\"o\">(</span><span class=\"n\">i</span> <span class=\"n\">j</span> <span class=\"n\">k</span> <span class=\"n\">A</span> <span class=\"n\">B</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"o\">(</span><span class=\"n\">A</span><span class=\"o\">,</span><span class=\"n\">i</span><span class=\"o\">)</span> <span class=\"bp\">≠</span> <span class=\"o\">(</span><span class=\"n\">B</span><span class=\"o\">,</span><span class=\"n\">j</span><span class=\"o\">)</span> <span class=\"bp\">→</span> <span class=\"n\">valid_link</span> <span class=\"o\">(</span><span class=\"n\">Link.par</span> <span class=\"n\">i</span> <span class=\"n\">j</span> <span class=\"n\">k</span> <span class=\"n\">A</span> <span class=\"n\">B</span><span class=\"o\">)</span>\n\n<span class=\"kd\">structure</span> <span class=\"n\">proof_structure</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span> <span class=\"o\">:=</span>\n<span class=\"o\">(</span><span class=\"n\">links</span> <span class=\"o\">:</span> <span class=\"n\">set</span> <span class=\"n\">Link</span><span class=\"o\">)</span>\n<span class=\"o\">(</span><span class=\"n\">valid</span> <span class=\"o\">:</span> <span class=\"bp\">∀</span> <span class=\"n\">l</span> <span class=\"bp\">∈</span> <span class=\"n\">links</span><span class=\"o\">,</span> <span class=\"n\">valid_link</span> <span class=\"n\">l</span><span class=\"o\">)</span>\n<span class=\"o\">(</span><span class=\"n\">prem_unique</span> <span class=\"o\">:</span> <span class=\"bp\">∀</span> <span class=\"n\">Ai</span> <span class=\"o\">:</span> <span class=\"n\">Form_occ</span><span class=\"o\">,</span> <span class=\"bp\">∀</span> <span class=\"n\">l₁</span> <span class=\"n\">l₂</span> <span class=\"bp\">∈</span> <span class=\"n\">links</span><span class=\"o\">,</span> <span class=\"n\">premise</span> <span class=\"n\">Ai</span> <span class=\"n\">l₁</span> <span class=\"bp\">→</span> <span class=\"n\">premise</span> <span class=\"n\">Ai</span> <span class=\"n\">l₂</span> <span class=\"bp\">→</span> <span class=\"n\">l₁</span> <span class=\"bp\">=</span> <span class=\"n\">l₂</span><span class=\"o\">)</span>\n<span class=\"o\">(</span><span class=\"n\">con_unique</span> <span class=\"o\">:</span> <span class=\"bp\">∀</span> <span class=\"n\">Ai</span> <span class=\"o\">:</span> <span class=\"n\">Form_occ</span><span class=\"o\">,</span> <span class=\"bp\">∀</span> <span class=\"n\">l₁</span> <span class=\"n\">l₂</span> <span class=\"bp\">∈</span> <span class=\"n\">links</span><span class=\"o\">,</span> <span class=\"n\">conclusion</span> <span class=\"n\">Ai</span> <span class=\"n\">l₁</span> <span class=\"bp\">→</span> <span class=\"n\">conclusion</span> <span class=\"n\">Ai</span> <span class=\"n\">l₂</span> <span class=\"bp\">→</span> <span class=\"n\">l₁</span> <span class=\"bp\">=</span> <span class=\"n\">l₂</span><span class=\"o\">)</span>\n\n<span class=\"kd\">inductive</span> <span class=\"n\">mem_Form_occ_ps</span> <span class=\"o\">(</span><span class=\"n\">Ai</span> <span class=\"o\">:</span> <span class=\"n\">Form_occ</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">ps</span> <span class=\"o\">:</span> <span class=\"n\">proof_structure</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"kt\">Prop</span>\n<span class=\"bp\">|</span> <span class=\"n\">prem</span> <span class=\"o\">(</span><span class=\"n\">l</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">l</span> <span class=\"bp\">∈</span> <span class=\"n\">ps.links</span> <span class=\"bp\">→</span> <span class=\"n\">premise</span> <span class=\"n\">Ai</span> <span class=\"n\">l</span> <span class=\"bp\">→</span> <span class=\"n\">mem_Form_occ_ps</span>\n<span class=\"bp\">|</span> <span class=\"n\">con</span> <span class=\"o\">(</span><span class=\"n\">l</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">l</span> <span class=\"bp\">∈</span> <span class=\"n\">ps.links</span> <span class=\"bp\">→</span> <span class=\"n\">conclusion</span> <span class=\"n\">Ai</span> <span class=\"n\">l</span> <span class=\"bp\">→</span> <span class=\"n\">mem_Form_occ_ps</span>\n\n<span class=\"kd\">instance</span> <span class=\"o\">:</span> <span class=\"n\">has_mem</span> <span class=\"n\">Form_occ</span> <span class=\"n\">proof_structure</span> <span class=\"o\">:=</span> <span class=\"o\">⟨</span><span class=\"n\">mem_Form_occ_ps</span><span class=\"o\">⟩</span>\n\n<span class=\"kd\">@[reducible]</span>\n<span class=\"kd\">def</span> <span class=\"n\">dir</span> <span class=\"o\">:=</span> <span class=\"n\">bool</span>\n\n<span class=\"kd\">@[pattern]</span> <span class=\"kd\">def</span> <span class=\"n\">down</span> <span class=\"o\">:=</span> <span class=\"n\">ff</span>\n<span class=\"kd\">@[pattern]</span> <span class=\"kd\">def</span> <span class=\"n\">up</span> <span class=\"o\">:=</span> <span class=\"n\">tt</span>\n\n<span class=\"kd\">@[pattern]</span> <span class=\"kd\">def</span> <span class=\"n\">with_down</span> <span class=\"o\">(</span><span class=\"n\">Ai</span> <span class=\"o\">:</span> <span class=\"n\">Form_occ</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"o\">(</span><span class=\"n\">Ai</span><span class=\"o\">,</span><span class=\"n\">down</span><span class=\"o\">)</span>\n<span class=\"kd\">@[pattern]</span> <span class=\"kd\">def</span> <span class=\"n\">with_up</span> <span class=\"o\">(</span><span class=\"n\">Ai</span> <span class=\"o\">:</span> <span class=\"n\">Form_occ</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"o\">(</span><span class=\"n\">Ai</span><span class=\"o\">,</span><span class=\"n\">up</span><span class=\"o\">)</span>\n<span class=\"kd\">postfix</span> <span class=\"bp\">`↓`</span><span class=\"o\">:</span><span class=\"n\">max_plus</span> <span class=\"o\">:=</span> <span class=\"n\">with_down</span>\n<span class=\"kd\">postfix</span> <span class=\"bp\">`↑`</span><span class=\"o\">:</span><span class=\"n\">max_plus</span> <span class=\"o\">:=</span> <span class=\"n\">with_up</span>\n\n<span class=\"kd\">@[reducible]</span>\n<span class=\"kd\">def</span> <span class=\"n\">switch</span> <span class=\"o\">:=</span> <span class=\"n\">bool</span>\n\n<span class=\"kd\">@[reducible, pattern]</span> <span class=\"kd\">def</span> <span class=\"n\">L</span> <span class=\"o\">:=</span> <span class=\"n\">ff</span>\n<span class=\"kd\">@[reducible, pattern]</span> <span class=\"kd\">def</span> <span class=\"n\">R</span> <span class=\"o\">:=</span> <span class=\"n\">tt</span>\n\n<span class=\"kd\">def</span> <span class=\"n\">switching</span> <span class=\"o\">:=</span> <span class=\"n\">Link</span> <span class=\"bp\">→</span> <span class=\"n\">switch</span>\n\n<span class=\"kd\">@[simp]</span>\n<span class=\"kd\">def</span> <span class=\"n\">switch.flip</span> <span class=\"o\">{</span><span class=\"n\">α</span> <span class=\"n\">β</span><span class=\"o\">}</span> <span class=\"o\">(</span><span class=\"n\">f</span> <span class=\"o\">:</span> <span class=\"n\">α</span> <span class=\"bp\">→</span> <span class=\"n\">α</span> <span class=\"bp\">→</span> <span class=\"n\">β</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">switch</span> <span class=\"bp\">→</span> <span class=\"n\">α</span> <span class=\"bp\">→</span> <span class=\"n\">α</span> <span class=\"bp\">→</span> <span class=\"n\">β</span>\n<span class=\"bp\">|</span> <span class=\"n\">L</span> <span class=\"n\">a</span> <span class=\"n\">b</span> <span class=\"o\">:=</span> <span class=\"n\">f</span> <span class=\"n\">a</span> <span class=\"n\">b</span>\n<span class=\"bp\">|</span> <span class=\"n\">R</span> <span class=\"n\">a</span> <span class=\"n\">b</span> <span class=\"o\">:=</span> <span class=\"n\">f</span> <span class=\"n\">b</span> <span class=\"n\">a</span>\n\n<span class=\"kd\">inductive</span> <span class=\"n\">steps_tensor</span> <span class=\"o\">(</span><span class=\"n\">Ai</span> <span class=\"n\">Bi</span> <span class=\"n\">Ci</span> <span class=\"o\">:</span> <span class=\"n\">Form_occ</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">Form_occ</span> <span class=\"bp\">×</span> <span class=\"n\">dir</span> <span class=\"bp\">→</span> <span class=\"n\">Form_occ</span> <span class=\"bp\">×</span> <span class=\"n\">dir</span> <span class=\"bp\">→</span> <span class=\"kt\">Prop</span>\n<span class=\"bp\">|</span> <span class=\"n\">down</span> <span class=\"o\">:</span> <span class=\"n\">steps_tensor</span> <span class=\"n\">Ai</span><span class=\"bp\">↓</span> <span class=\"n\">Ci</span><span class=\"bp\">↓</span>\n<span class=\"bp\">|</span> <span class=\"n\">turn</span> <span class=\"o\">:</span> <span class=\"n\">steps_tensor</span> <span class=\"n\">Bi</span><span class=\"bp\">↓</span> <span class=\"n\">Ai</span><span class=\"bp\">↑</span>\n<span class=\"bp\">|</span> <span class=\"n\">up</span> <span class=\"o\">:</span> <span class=\"n\">steps_tensor</span> <span class=\"n\">Ci</span><span class=\"bp\">↑</span> <span class=\"n\">Bi</span><span class=\"bp\">↑</span>\n\n<span class=\"kd\">inductive</span> <span class=\"n\">steps_par</span> <span class=\"o\">(</span><span class=\"n\">Ai</span> <span class=\"n\">Bi</span> <span class=\"n\">Ci</span> <span class=\"o\">:</span> <span class=\"n\">Form_occ</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">Form_occ</span> <span class=\"bp\">×</span> <span class=\"n\">dir</span> <span class=\"bp\">→</span> <span class=\"n\">Form_occ</span> <span class=\"bp\">×</span> <span class=\"n\">dir</span> <span class=\"bp\">→</span> <span class=\"kt\">Prop</span>\n<span class=\"bp\">|</span> <span class=\"n\">down</span> <span class=\"o\">:</span> <span class=\"n\">steps_par</span> <span class=\"n\">Ai</span><span class=\"bp\">↓</span> <span class=\"n\">Ci</span><span class=\"bp\">↓</span>\n<span class=\"bp\">|</span> <span class=\"n\">turn</span> <span class=\"o\">:</span> <span class=\"n\">steps_par</span> <span class=\"n\">Bi</span><span class=\"bp\">↓</span> <span class=\"n\">Bi</span><span class=\"bp\">↑</span>\n<span class=\"bp\">|</span> <span class=\"n\">up</span> <span class=\"o\">:</span> <span class=\"n\">steps_par</span> <span class=\"n\">Ci</span><span class=\"bp\">↑</span> <span class=\"n\">Ai</span><span class=\"bp\">↑</span>\n\n<span class=\"kd\">inductive</span> <span class=\"n\">dual</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"o\">:</span> <span class=\"n\">Form</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">ai</span> <span class=\"n\">ni</span> <span class=\"o\">:</span> <span class=\"n\">ℕ</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">Form_occ</span> <span class=\"bp\">→</span> <span class=\"n\">Form_occ</span> <span class=\"bp\">→</span> <span class=\"kt\">Prop</span>\n<span class=\"bp\">|</span> <span class=\"n\">posneg</span> <span class=\"o\">:</span> <span class=\"n\">dual</span> <span class=\"o\">(</span><span class=\"n\">A</span><span class=\"o\">,</span><span class=\"n\">ai</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"bp\">~</span><span class=\"n\">A</span><span class=\"o\">,</span><span class=\"n\">ni</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"n\">negpos</span> <span class=\"o\">:</span> <span class=\"n\">dual</span> <span class=\"o\">(</span><span class=\"bp\">~</span><span class=\"n\">A</span><span class=\"o\">,</span><span class=\"n\">ni</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">A</span><span class=\"o\">,</span><span class=\"n\">ai</span><span class=\"o\">)</span>\n\n<span class=\"kd\">inductive</span> <span class=\"n\">steps</span> <span class=\"o\">(</span><span class=\"n\">T</span> <span class=\"o\">:</span> <span class=\"n\">switch</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">Link</span> <span class=\"bp\">→</span> <span class=\"n\">Form_occ</span> <span class=\"bp\">×</span> <span class=\"n\">dir</span> <span class=\"bp\">→</span> <span class=\"n\">Form_occ</span> <span class=\"bp\">×</span> <span class=\"n\">dir</span> <span class=\"bp\">→</span> <span class=\"kt\">Prop</span>\n<span class=\"bp\">|</span> <span class=\"n\">ax</span>  <span class=\"o\">{</span><span class=\"n\">A</span> <span class=\"n\">ai</span> <span class=\"n\">ni</span> <span class=\"n\">Bi</span> <span class=\"n\">Ci</span><span class=\"o\">}</span> <span class=\"o\">:</span> <span class=\"n\">dual</span> <span class=\"n\">A</span> <span class=\"n\">ai</span> <span class=\"n\">ni</span> <span class=\"n\">Bi</span> <span class=\"n\">Ci</span> <span class=\"bp\">→</span> <span class=\"n\">steps</span> <span class=\"o\">(</span><span class=\"n\">Link.ax</span> <span class=\"n\">ai</span> <span class=\"n\">ni</span> <span class=\"n\">A</span><span class=\"o\">)</span> <span class=\"n\">Bi</span><span class=\"bp\">↑</span> <span class=\"n\">Ci</span><span class=\"bp\">↓</span>\n<span class=\"bp\">|</span> <span class=\"n\">cut</span> <span class=\"o\">{</span><span class=\"n\">A</span> <span class=\"n\">ai</span> <span class=\"n\">ni</span> <span class=\"n\">Bi</span> <span class=\"n\">Ci</span><span class=\"o\">}</span> <span class=\"o\">:</span> <span class=\"n\">dual</span> <span class=\"n\">A</span> <span class=\"n\">ai</span> <span class=\"n\">ni</span> <span class=\"n\">Bi</span> <span class=\"n\">Ci</span> <span class=\"bp\">→</span> <span class=\"n\">steps</span> <span class=\"o\">(</span><span class=\"n\">Link.cut</span> <span class=\"n\">ai</span> <span class=\"n\">ni</span> <span class=\"n\">A</span><span class=\"o\">)</span> <span class=\"n\">Bi</span><span class=\"bp\">↓</span> <span class=\"n\">Ci</span><span class=\"bp\">↑</span>\n<span class=\"bp\">|</span> <span class=\"n\">con</span> <span class=\"o\">{</span><span class=\"n\">A</span> <span class=\"n\">ai</span><span class=\"o\">}</span>          <span class=\"o\">:</span> <span class=\"n\">steps</span> <span class=\"o\">(</span><span class=\"n\">Link.con</span> <span class=\"n\">ai</span> <span class=\"n\">A</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">A</span><span class=\"o\">,</span> <span class=\"n\">ai</span><span class=\"o\">)</span><span class=\"bp\">↓</span> <span class=\"o\">(</span><span class=\"n\">A</span><span class=\"o\">,</span><span class=\"n\">ai</span><span class=\"o\">)</span><span class=\"bp\">↑</span>\n<span class=\"bp\">|</span> <span class=\"n\">tensor</span> <span class=\"o\">{</span><span class=\"n\">A</span> <span class=\"n\">B</span> <span class=\"n\">ai</span> <span class=\"n\">bi</span> <span class=\"n\">ci</span> <span class=\"n\">X</span> <span class=\"n\">Y</span><span class=\"o\">}</span> <span class=\"o\">:</span>\n  <span class=\"n\">T.flip</span> <span class=\"n\">steps_tensor</span> <span class=\"o\">(</span><span class=\"n\">A</span><span class=\"o\">,</span> <span class=\"n\">ai</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">B</span><span class=\"o\">,</span> <span class=\"n\">bi</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"bp\">⊗</span> <span class=\"n\">B</span><span class=\"o\">,</span> <span class=\"n\">ci</span><span class=\"o\">)</span> <span class=\"n\">X</span> <span class=\"n\">Y</span> <span class=\"bp\">→</span>\n  <span class=\"n\">steps</span> <span class=\"o\">(</span><span class=\"n\">Link.tensor</span> <span class=\"n\">ai</span> <span class=\"n\">bi</span> <span class=\"n\">ci</span> <span class=\"n\">A</span> <span class=\"n\">B</span><span class=\"o\">)</span> <span class=\"n\">X</span> <span class=\"n\">Y</span>\n<span class=\"bp\">|</span> <span class=\"n\">par</span> <span class=\"o\">{</span><span class=\"n\">A</span> <span class=\"n\">B</span> <span class=\"n\">ai</span> <span class=\"n\">bi</span> <span class=\"n\">ci</span> <span class=\"n\">X</span> <span class=\"n\">Y</span><span class=\"o\">}</span> <span class=\"o\">:</span>\n  <span class=\"n\">T.flip</span> <span class=\"n\">steps_par</span> <span class=\"o\">(</span><span class=\"n\">A</span><span class=\"o\">,</span> <span class=\"n\">ai</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">B</span><span class=\"o\">,</span> <span class=\"n\">bi</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"n\">⅋</span> <span class=\"n\">B</span><span class=\"o\">,</span> <span class=\"n\">ci</span><span class=\"o\">)</span> <span class=\"n\">X</span> <span class=\"n\">Y</span> <span class=\"bp\">→</span>\n  <span class=\"n\">steps</span> <span class=\"o\">(</span><span class=\"n\">Link.par</span> <span class=\"n\">ai</span> <span class=\"n\">bi</span> <span class=\"n\">ci</span> <span class=\"n\">A</span> <span class=\"n\">B</span><span class=\"o\">)</span> <span class=\"n\">X</span> <span class=\"n\">Y</span>\n\n<span class=\"kd\">inductive</span> <span class=\"n\">trip</span> <span class=\"o\">(</span><span class=\"n\">ps</span> <span class=\"o\">:</span> <span class=\"n\">proof_structure</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">S</span> <span class=\"o\">:</span> <span class=\"n\">switching</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">ℕ</span> <span class=\"bp\">→</span> <span class=\"n\">Form_occ</span> <span class=\"bp\">×</span> <span class=\"n\">dir</span> <span class=\"bp\">→</span> <span class=\"n\">Form_occ</span> <span class=\"bp\">×</span> <span class=\"n\">dir</span> <span class=\"bp\">→</span> <span class=\"kt\">Prop</span>\n<span class=\"bp\">|</span> <span class=\"n\">single</span> <span class=\"o\">{</span><span class=\"n\">Ai</span> <span class=\"n\">d</span><span class=\"o\">}</span>    <span class=\"o\">:</span> <span class=\"n\">Ai</span> <span class=\"bp\">∈</span> <span class=\"n\">ps</span> <span class=\"bp\">→</span> <span class=\"n\">trip</span> <span class=\"mi\">0</span> <span class=\"o\">(</span><span class=\"n\">Ai</span><span class=\"o\">,</span><span class=\"n\">d</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">Ai</span><span class=\"o\">,</span><span class=\"n\">d</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"n\">cons</span> <span class=\"o\">{</span><span class=\"n\">X</span> <span class=\"n\">Y</span> <span class=\"n\">Z</span> <span class=\"bp\">Δ</span> <span class=\"n\">n</span><span class=\"o\">}</span> <span class=\"o\">:</span> <span class=\"bp\">Δ</span> <span class=\"bp\">∈</span> <span class=\"n\">ps.links</span> <span class=\"bp\">→</span> <span class=\"n\">steps</span> <span class=\"o\">(</span><span class=\"n\">S</span> <span class=\"bp\">Δ</span><span class=\"o\">)</span> <span class=\"bp\">Δ</span> <span class=\"n\">X</span> <span class=\"n\">Y</span> <span class=\"bp\">→</span> <span class=\"n\">trip</span> <span class=\"n\">n</span> <span class=\"n\">Y</span> <span class=\"n\">Z</span> <span class=\"bp\">→</span> <span class=\"n\">trip</span> <span class=\"o\">(</span><span class=\"n\">n.succ</span><span class=\"o\">)</span> <span class=\"n\">X</span> <span class=\"n\">Z</span>\n\n<span class=\"kn\">section</span>\n  <span class=\"kd\">variable</span> <span class=\"o\">{</span><span class=\"bp\">Δ</span> <span class=\"o\">:</span> <span class=\"n\">Link</span><span class=\"o\">}</span>\n  <span class=\"kd\">variable</span> <span class=\"o\">{</span><span class=\"n\">T</span> <span class=\"o\">:</span> <span class=\"n\">switch</span><span class=\"o\">}</span>\n  <span class=\"kd\">variables</span> <span class=\"o\">{</span><span class=\"n\">Ai</span> <span class=\"n\">Bi</span> <span class=\"n\">Ci</span> <span class=\"o\">:</span> <span class=\"n\">Form_occ</span><span class=\"o\">}</span>\n  <span class=\"kd\">variables</span> <span class=\"o\">{</span><span class=\"n\">X</span> <span class=\"n\">Y</span> <span class=\"n\">Z</span> <span class=\"o\">:</span> <span class=\"n\">Form_occ</span> <span class=\"bp\">×</span> <span class=\"n\">dir</span><span class=\"o\">}</span>\n\n  <span class=\"kd\">theorem</span> <span class=\"n\">steps_unique_prev</span> <span class=\"o\">:</span> <span class=\"n\">valid_link</span> <span class=\"bp\">Δ</span> <span class=\"bp\">→</span> <span class=\"n\">steps</span> <span class=\"n\">T</span> <span class=\"bp\">Δ</span> <span class=\"n\">X</span> <span class=\"n\">Z</span> <span class=\"bp\">→</span> <span class=\"n\">steps</span> <span class=\"n\">T</span> <span class=\"bp\">Δ</span> <span class=\"n\">Y</span> <span class=\"n\">Z</span> <span class=\"bp\">→</span> <span class=\"n\">X</span> <span class=\"bp\">=</span> <span class=\"n\">Y</span> <span class=\"o\">:=</span> <span class=\"gr\">sorry</span>\n\n  <span class=\"kd\">theorem</span> <span class=\"n\">steps_unique_next</span> <span class=\"o\">:</span> <span class=\"n\">valid_link</span> <span class=\"bp\">Δ</span> <span class=\"bp\">→</span> <span class=\"n\">steps</span> <span class=\"n\">T</span> <span class=\"bp\">Δ</span> <span class=\"n\">X</span> <span class=\"n\">Y</span> <span class=\"bp\">→</span> <span class=\"n\">steps</span> <span class=\"n\">T</span> <span class=\"bp\">Δ</span> <span class=\"n\">X</span> <span class=\"n\">Z</span> <span class=\"bp\">→</span> <span class=\"n\">Y</span> <span class=\"bp\">=</span> <span class=\"n\">Z</span> <span class=\"o\">:=</span> <span class=\"gr\">sorry</span>\n\n  <span class=\"kd\">lemma</span> <span class=\"n\">mem_ps_of_steps_next</span> <span class=\"o\">{</span><span class=\"n\">ps</span> <span class=\"o\">:</span> <span class=\"n\">proof_structure</span><span class=\"o\">}</span> <span class=\"o\">{</span><span class=\"n\">d</span> <span class=\"o\">:</span> <span class=\"n\">dir</span><span class=\"o\">}</span> <span class=\"o\">:</span>\n    <span class=\"bp\">Δ</span> <span class=\"bp\">∈</span> <span class=\"n\">ps.links</span> <span class=\"bp\">→</span> <span class=\"n\">steps</span> <span class=\"n\">T</span> <span class=\"bp\">Δ</span> <span class=\"n\">X</span> <span class=\"o\">(</span><span class=\"n\">Bi</span><span class=\"o\">,</span><span class=\"n\">d</span><span class=\"o\">)</span> <span class=\"bp\">→</span> <span class=\"n\">Bi</span> <span class=\"bp\">∈</span> <span class=\"n\">ps</span> <span class=\"o\">:=</span> <span class=\"gr\">sorry</span>\n\n<span class=\"kd\">end</span>\n\n<span class=\"kn\">section</span>\n  <span class=\"kd\">variable</span> <span class=\"o\">{</span><span class=\"n\">ps</span> <span class=\"o\">:</span> <span class=\"n\">proof_structure</span><span class=\"o\">}</span>\n  <span class=\"kd\">variable</span> <span class=\"o\">{</span><span class=\"n\">S</span> <span class=\"o\">:</span> <span class=\"n\">switching</span><span class=\"o\">}</span>\n  <span class=\"kd\">variables</span> <span class=\"o\">{</span><span class=\"n\">X</span> <span class=\"n\">Y</span> <span class=\"n\">Z</span> <span class=\"o\">:</span> <span class=\"n\">Form_occ</span> <span class=\"bp\">×</span> <span class=\"n\">dir</span><span class=\"o\">}</span>\n  <span class=\"kd\">variables</span> <span class=\"o\">{</span><span class=\"n\">n</span> <span class=\"n\">m</span> <span class=\"o\">:</span> <span class=\"n\">ℕ</span><span class=\"o\">}</span>\n\n  <span class=\"kd\">theorem</span> <span class=\"n\">link_unique_of_steps_prev</span> <span class=\"o\">{</span><span class=\"bp\">Δ₁</span> <span class=\"bp\">Δ₂</span><span class=\"o\">}</span> <span class=\"o\">:</span>\n    <span class=\"bp\">Δ₁</span> <span class=\"bp\">∈</span> <span class=\"n\">ps.links</span> <span class=\"bp\">→</span> <span class=\"bp\">Δ₂</span> <span class=\"bp\">∈</span> <span class=\"n\">ps.links</span> <span class=\"bp\">→</span> <span class=\"n\">steps</span> <span class=\"o\">(</span><span class=\"n\">S</span> <span class=\"bp\">Δ₁</span><span class=\"o\">)</span> <span class=\"bp\">Δ₁</span> <span class=\"n\">X</span> <span class=\"n\">Y</span> <span class=\"bp\">→</span> <span class=\"n\">steps</span> <span class=\"o\">(</span><span class=\"n\">S</span> <span class=\"bp\">Δ₂</span><span class=\"o\">)</span> <span class=\"bp\">Δ₂</span> <span class=\"n\">X</span> <span class=\"n\">Z</span> <span class=\"bp\">→</span> <span class=\"bp\">Δ₁</span> <span class=\"bp\">=</span> <span class=\"bp\">Δ₂</span> <span class=\"o\">:=</span> <span class=\"gr\">sorry</span>\n\n  <span class=\"kd\">theorem</span> <span class=\"n\">link_unique_of_steps_next</span> <span class=\"o\">{</span><span class=\"bp\">Δ₁</span> <span class=\"bp\">Δ₂</span><span class=\"o\">}</span> <span class=\"o\">:</span>\n    <span class=\"bp\">Δ₁</span> <span class=\"bp\">∈</span> <span class=\"n\">ps.links</span> <span class=\"bp\">→</span> <span class=\"bp\">Δ₂</span> <span class=\"bp\">∈</span> <span class=\"n\">ps.links</span> <span class=\"bp\">→</span> <span class=\"n\">steps</span> <span class=\"o\">(</span><span class=\"n\">S</span> <span class=\"bp\">Δ₁</span><span class=\"o\">)</span> <span class=\"bp\">Δ₁</span> <span class=\"n\">X</span> <span class=\"n\">Z</span> <span class=\"bp\">→</span> <span class=\"n\">steps</span> <span class=\"o\">(</span><span class=\"n\">S</span> <span class=\"bp\">Δ₂</span><span class=\"o\">)</span> <span class=\"bp\">Δ₂</span> <span class=\"n\">Y</span> <span class=\"n\">Z</span> <span class=\"bp\">→</span> <span class=\"bp\">Δ₁</span> <span class=\"bp\">=</span> <span class=\"bp\">Δ₂</span> <span class=\"o\">:=</span> <span class=\"gr\">sorry</span>\n\n  <span class=\"kd\">def</span> <span class=\"n\">trip.rcons</span> <span class=\"o\">{</span><span class=\"bp\">Δ</span><span class=\"o\">}</span> <span class=\"o\">:</span> <span class=\"bp\">Δ</span> <span class=\"bp\">∈</span> <span class=\"n\">ps.links</span> <span class=\"bp\">→</span> <span class=\"n\">trip</span> <span class=\"n\">ps</span> <span class=\"n\">S</span> <span class=\"n\">n</span> <span class=\"n\">X</span> <span class=\"n\">Y</span> <span class=\"bp\">→</span> <span class=\"n\">steps</span> <span class=\"o\">(</span><span class=\"n\">S</span> <span class=\"bp\">Δ</span><span class=\"o\">)</span> <span class=\"bp\">Δ</span> <span class=\"n\">Y</span> <span class=\"n\">Z</span> <span class=\"bp\">→</span> <span class=\"n\">trip</span> <span class=\"n\">ps</span> <span class=\"n\">S</span> <span class=\"n\">n.succ</span> <span class=\"n\">X</span> <span class=\"n\">Z</span> <span class=\"o\">:=</span>\n  <span class=\"kd\">begin</span>\n    <span class=\"n\">revert</span> <span class=\"n\">X</span> <span class=\"n\">Y</span> <span class=\"n\">Z</span><span class=\"o\">,</span>\n    <span class=\"n\">induction</span> <span class=\"n\">n</span><span class=\"o\">,</span>\n    <span class=\"n\">case</span> <span class=\"n\">nat.zero</span> <span class=\"o\">:</span> <span class=\"o\">{</span>\n      <span class=\"n\">rintros</span> <span class=\"n\">X</span> <span class=\"n\">Y</span> <span class=\"n\">Z</span> <span class=\"n\">h</span><span class=\"bp\">Δ</span> <span class=\"o\">⟨</span><span class=\"n\">Ai</span><span class=\"o\">,</span><span class=\"n\">d</span><span class=\"o\">,</span><span class=\"n\">hA</span><span class=\"o\">⟩</span> <span class=\"n\">s</span><span class=\"o\">,</span>\n      <span class=\"n\">apply</span> <span class=\"n\">trip.cons</span> <span class=\"n\">h</span><span class=\"bp\">Δ</span> <span class=\"n\">s</span><span class=\"o\">,</span>\n      <span class=\"n\">cases</span> <span class=\"n\">Z</span> <span class=\"k\">with</span> <span class=\"n\">Ci</span> <span class=\"n\">d'</span><span class=\"o\">,</span>\n      <span class=\"n\">apply</span> <span class=\"n\">trip.single</span><span class=\"o\">,</span>\n      <span class=\"n\">apply</span> <span class=\"n\">mem_ps_of_steps_next</span> <span class=\"n\">h</span><span class=\"bp\">Δ</span> <span class=\"n\">s</span><span class=\"o\">,</span>\n    <span class=\"o\">},</span>\n    <span class=\"n\">case</span> <span class=\"n\">nat.succ</span> <span class=\"o\">:</span> <span class=\"n\">n</span> <span class=\"n\">ih</span> <span class=\"o\">{</span>\n      <span class=\"n\">rintros</span> <span class=\"n\">X</span> <span class=\"n\">Y</span> <span class=\"n\">Z</span> <span class=\"n\">h</span><span class=\"bp\">Δ</span> <span class=\"n\">tXY</span> <span class=\"n\">sYZ</span><span class=\"o\">,</span>\n      <span class=\"n\">cases</span> <span class=\"n\">tXY</span> <span class=\"k\">with</span> <span class=\"n\">_</span> <span class=\"n\">_</span> <span class=\"n\">_</span> <span class=\"n\">_</span> <span class=\"n\">W</span> <span class=\"n\">_</span> <span class=\"bp\">Δ'</span> <span class=\"n\">_</span> <span class=\"n\">h</span><span class=\"bp\">Δ'</span> <span class=\"n\">sXW</span> <span class=\"n\">tWY</span><span class=\"o\">,</span>\n      <span class=\"n\">apply</span> <span class=\"n\">trip.cons</span> <span class=\"n\">h</span><span class=\"bp\">Δ'</span> <span class=\"n\">sXW</span><span class=\"o\">,</span>\n      <span class=\"n\">apply</span> <span class=\"n\">ih</span> <span class=\"n\">h</span><span class=\"bp\">Δ</span> <span class=\"n\">tWY</span> <span class=\"n\">sYZ</span><span class=\"o\">,</span>\n    <span class=\"o\">},</span>\n  <span class=\"kd\">end</span>\n\n  <span class=\"kd\">theorem</span> <span class=\"n\">trip_unique_start</span> <span class=\"o\">:</span> <span class=\"n\">trip</span> <span class=\"n\">ps</span> <span class=\"n\">S</span> <span class=\"n\">n</span> <span class=\"n\">X</span> <span class=\"n\">Z</span> <span class=\"bp\">→</span> <span class=\"n\">trip</span> <span class=\"n\">ps</span> <span class=\"n\">S</span> <span class=\"n\">n</span> <span class=\"n\">Y</span> <span class=\"n\">Z</span> <span class=\"bp\">→</span> <span class=\"n\">X</span> <span class=\"bp\">=</span> <span class=\"n\">Y</span> <span class=\"o\">:=</span>\n  <span class=\"kd\">begin</span>\n    <span class=\"n\">intros</span> <span class=\"n\">tX</span> <span class=\"n\">tY</span><span class=\"o\">,</span>\n    <span class=\"n\">revert</span> <span class=\"n\">X</span> <span class=\"n\">Y</span><span class=\"o\">,</span>\n    <span class=\"n\">induction</span> <span class=\"n\">n</span><span class=\"o\">,</span>\n    <span class=\"n\">case</span> <span class=\"n\">nat.zero</span> <span class=\"o\">:</span> <span class=\"o\">{</span> <span class=\"n\">intros</span><span class=\"o\">,</span> <span class=\"n\">cases</span> <span class=\"n\">tX</span><span class=\"bp\">;</span> <span class=\"n\">cases</span> <span class=\"n\">tY</span><span class=\"o\">,</span> <span class=\"n\">refl</span><span class=\"o\">},</span>\n    <span class=\"n\">case</span> <span class=\"n\">nat.succ</span> <span class=\"o\">:</span> <span class=\"n\">n</span> <span class=\"n\">ih</span> <span class=\"o\">{</span>\n      <span class=\"n\">rintros</span> <span class=\"n\">X</span> <span class=\"n\">Y</span> <span class=\"n\">tX</span> <span class=\"n\">tY</span><span class=\"o\">,</span>\n      <span class=\"n\">rcases</span> <span class=\"n\">tX</span> <span class=\"k\">with</span> <span class=\"n\">_</span> <span class=\"bp\">|</span> <span class=\"o\">⟨</span><span class=\"n\">_</span><span class=\"o\">,</span><span class=\"n\">X'</span><span class=\"o\">,</span><span class=\"n\">_</span><span class=\"o\">,</span><span class=\"bp\">Δ</span><span class=\"o\">,</span><span class=\"n\">_</span><span class=\"o\">,</span><span class=\"n\">h</span><span class=\"bp\">Δ</span><span class=\"o\">,</span><span class=\"n\">sX</span><span class=\"o\">,</span><span class=\"n\">tX'</span><span class=\"o\">⟩,</span>\n      <span class=\"n\">rcases</span> <span class=\"n\">tY</span> <span class=\"k\">with</span> <span class=\"n\">_</span> <span class=\"bp\">|</span> <span class=\"o\">⟨</span><span class=\"n\">_</span><span class=\"o\">,</span><span class=\"n\">Y'</span><span class=\"o\">,</span><span class=\"n\">_</span><span class=\"o\">,</span><span class=\"bp\">Δ'</span><span class=\"o\">,</span><span class=\"n\">_</span><span class=\"o\">,</span><span class=\"n\">h</span><span class=\"bp\">Δ'</span><span class=\"o\">,</span><span class=\"n\">sY</span><span class=\"o\">,</span><span class=\"n\">tY'</span><span class=\"o\">⟩,</span>\n      <span class=\"k\">have</span> <span class=\"o\">:</span> <span class=\"n\">Y'</span> <span class=\"bp\">=</span> <span class=\"n\">X'</span><span class=\"o\">,</span> <span class=\"kd\">by</span> <span class=\"n\">exact</span> <span class=\"n\">ih</span> <span class=\"n\">tY'</span> <span class=\"n\">tX'</span><span class=\"o\">,</span>\n      <span class=\"n\">rw</span> <span class=\"n\">this</span> <span class=\"n\">at</span> <span class=\"n\">sY</span><span class=\"o\">,</span>\n      <span class=\"k\">have</span> <span class=\"o\">:</span> <span class=\"bp\">Δ'</span> <span class=\"bp\">=</span> <span class=\"bp\">Δ</span><span class=\"o\">,</span> <span class=\"n\">apply</span> <span class=\"n\">link_unique_of_steps_next</span> <span class=\"n\">h</span><span class=\"bp\">Δ'</span> <span class=\"n\">h</span><span class=\"bp\">Δ</span> <span class=\"n\">sY</span> <span class=\"n\">sX</span><span class=\"o\">,</span>\n      <span class=\"n\">rw</span> <span class=\"n\">this</span> <span class=\"n\">at</span> <span class=\"n\">sY</span><span class=\"o\">,</span>\n      <span class=\"n\">exact</span> <span class=\"n\">steps_unique_prev</span> <span class=\"o\">(</span><span class=\"n\">ps.valid</span> <span class=\"bp\">Δ</span> <span class=\"n\">h</span><span class=\"bp\">Δ</span><span class=\"o\">)</span> <span class=\"n\">sX</span> <span class=\"n\">sY</span><span class=\"o\">,</span>\n      <span class=\"o\">}</span>\n  <span class=\"kd\">end</span>\n\n  <span class=\"kd\">lemma</span> <span class=\"n\">trip_rcons_decompose</span> <span class=\"o\">{</span><span class=\"n\">α</span> <span class=\"o\">:</span> <span class=\"kt\">Prop</span><span class=\"o\">}</span> <span class=\"o\">(</span><span class=\"n\">f</span> <span class=\"o\">:</span> <span class=\"bp\">Π</span> <span class=\"bp\">Δ</span> <span class=\"n\">Y</span><span class=\"o\">,</span> <span class=\"bp\">Δ</span> <span class=\"bp\">∈</span> <span class=\"n\">ps.links</span> <span class=\"bp\">→</span> <span class=\"n\">trip</span> <span class=\"n\">ps</span> <span class=\"n\">S</span> <span class=\"n\">n</span> <span class=\"n\">X</span> <span class=\"n\">Y</span> <span class=\"bp\">→</span> <span class=\"n\">steps</span> <span class=\"o\">(</span><span class=\"n\">S</span> <span class=\"bp\">Δ</span><span class=\"o\">)</span> <span class=\"bp\">Δ</span> <span class=\"n\">Y</span> <span class=\"n\">Z</span> <span class=\"bp\">→</span> <span class=\"n\">α</span><span class=\"o\">)</span> <span class=\"o\">:</span>\n    <span class=\"n\">trip</span> <span class=\"n\">ps</span> <span class=\"n\">S</span> <span class=\"n\">n.succ</span> <span class=\"n\">X</span> <span class=\"n\">Z</span> <span class=\"bp\">→</span> <span class=\"n\">α</span> <span class=\"o\">:=</span>\n  <span class=\"kd\">begin</span>\n    <span class=\"gr\">sorry</span>\n  <span class=\"kd\">end</span>\n\n  <span class=\"kd\">theorem</span> <span class=\"n\">trip_unique_stop</span> <span class=\"o\">:</span> <span class=\"n\">trip</span> <span class=\"n\">ps</span> <span class=\"n\">S</span> <span class=\"n\">n</span> <span class=\"n\">X</span> <span class=\"n\">Y</span> <span class=\"bp\">→</span> <span class=\"n\">trip</span> <span class=\"n\">ps</span> <span class=\"n\">S</span> <span class=\"n\">n</span> <span class=\"n\">X</span> <span class=\"n\">Z</span> <span class=\"bp\">→</span> <span class=\"n\">Y</span> <span class=\"bp\">=</span> <span class=\"n\">Z</span> <span class=\"o\">:=</span>\n  <span class=\"kd\">begin</span>\n    <span class=\"n\">revert</span> <span class=\"n\">Y</span> <span class=\"n\">Z</span><span class=\"o\">,</span>\n    <span class=\"n\">induction</span> <span class=\"n\">n</span><span class=\"o\">,</span>\n    <span class=\"n\">case</span> <span class=\"n\">nat.zero</span> <span class=\"o\">:</span> <span class=\"o\">{</span> <span class=\"n\">intros</span> <span class=\"n\">_</span> <span class=\"n\">_</span> <span class=\"n\">tXY</span> <span class=\"n\">tXZ</span><span class=\"o\">,</span> <span class=\"n\">cases</span> <span class=\"n\">tXY</span><span class=\"o\">,</span> <span class=\"n\">cases</span> <span class=\"n\">tXZ</span><span class=\"o\">,</span> <span class=\"n\">refl</span><span class=\"o\">},</span>\n    <span class=\"n\">case</span> <span class=\"n\">nat.succ</span> <span class=\"o\">:</span> <span class=\"n\">n</span> <span class=\"n\">ih</span> <span class=\"o\">{</span>\n      <span class=\"n\">rintros</span> <span class=\"n\">Y</span> <span class=\"n\">Z</span> <span class=\"n\">tXY</span> <span class=\"n\">tXZ</span><span class=\"o\">,</span>\n      <span class=\"n\">apply</span> <span class=\"n\">trip_rcons_decompose</span> <span class=\"n\">_</span> <span class=\"n\">tXY</span><span class=\"o\">,</span>\n      <span class=\"n\">intros</span> <span class=\"bp\">Δ</span> <span class=\"n\">V</span> <span class=\"n\">h</span><span class=\"bp\">Δ</span> <span class=\"n\">tXV</span> <span class=\"n\">sVY</span><span class=\"o\">,</span>\n      <span class=\"n\">apply</span> <span class=\"n\">trip_rcons_decompose</span> <span class=\"n\">_</span> <span class=\"n\">tXZ</span><span class=\"o\">,</span>\n      <span class=\"n\">intros</span> <span class=\"bp\">Δ'</span> <span class=\"n\">W</span> <span class=\"n\">h</span><span class=\"bp\">Δ'</span> <span class=\"n\">tXW</span> <span class=\"n\">sWZ</span><span class=\"o\">,</span>\n      <span class=\"k\">have</span> <span class=\"o\">:</span> <span class=\"n\">W</span> <span class=\"bp\">=</span> <span class=\"n\">V</span><span class=\"o\">,</span> <span class=\"n\">apply</span> <span class=\"n\">ih</span> <span class=\"n\">tXW</span> <span class=\"n\">tXV</span><span class=\"o\">,</span>\n      <span class=\"n\">rw</span> <span class=\"n\">this</span> <span class=\"n\">at</span> <span class=\"n\">sWZ</span><span class=\"o\">,</span>\n      <span class=\"k\">have</span> <span class=\"o\">:</span> <span class=\"bp\">Δ'</span> <span class=\"bp\">=</span> <span class=\"bp\">Δ</span><span class=\"o\">,</span> <span class=\"n\">apply</span> <span class=\"n\">link_unique_of_steps_prev</span> <span class=\"n\">h</span><span class=\"bp\">Δ'</span> <span class=\"n\">h</span><span class=\"bp\">Δ</span> <span class=\"n\">sWZ</span> <span class=\"n\">sVY</span><span class=\"o\">,</span>\n      <span class=\"n\">rw</span> <span class=\"n\">this</span> <span class=\"n\">at</span> <span class=\"n\">sWZ</span><span class=\"o\">,</span>\n      <span class=\"n\">apply</span> <span class=\"n\">steps_unique_next</span> <span class=\"o\">(</span><span class=\"n\">ps.valid</span> <span class=\"bp\">Δ</span> <span class=\"n\">h</span><span class=\"bp\">Δ</span><span class=\"o\">)</span> <span class=\"n\">sVY</span> <span class=\"n\">sWZ</span><span class=\"o\">,</span>\n      <span class=\"o\">}</span>\n  <span class=\"kd\">end</span>\n\n<span class=\"kd\">end</span>\n</code></pre></div>",
        "id": 243658283,
        "sender_full_name": "Billy Price",
        "timestamp": 1624457904
    },
    {
        "content": "<p>Yay I managed to prove <code>lemma trip_exists_rcons : trip ps S n.succ X Z → ∃ Y Δ, ∃ hΔ : Δ ∈ ps.links, ∃ tXY : trip ps S n X Y, steps (S Δ) Δ Y Z</code> by induction on n. My question remain about</p>\n<ol>\n<li>The consequences of choosing between <code>trip1</code>, <code>trip2</code> and <code>list_trip</code></li>\n<li>Pros and cons of including a length parameter in the trip definition</li>\n</ol>",
        "id": 243746210,
        "sender_full_name": "Billy Price",
        "timestamp": 1624516314
    },
    {
        "content": "<p>I'm in a pickle, my aim is to define a map <code>proof Γ -&gt; proof_structure</code>, but the definition of that map requires inductive reasoning on the properties of already constructed proof_structures. That property could be stated \"every formula in Γ is available in the proof structure\", where available means it's in some link but it's not a premise of any link. I tried to strengthen the concept of a proof_structure to the inductive type <code>proof_net : sequent -&gt; Type</code></p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kd\">inductive</span> <span class=\"n\">proof_net</span> <span class=\"o\">:</span> <span class=\"n\">sequent</span> <span class=\"bp\">→</span> <span class=\"kt\">Type</span>\n<span class=\"bp\">|</span> <span class=\"n\">mk</span> <span class=\"o\">{</span><span class=\"bp\">Γ</span> <span class=\"o\">:</span> <span class=\"n\">sequent</span><span class=\"o\">}</span> <span class=\"o\">(</span><span class=\"n\">ps</span> <span class=\"o\">:</span> <span class=\"n\">proof_structure</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"o\">(</span><span class=\"bp\">∀</span> <span class=\"n\">A</span> <span class=\"bp\">∈</span> <span class=\"bp\">Γ</span><span class=\"o\">,</span> <span class=\"bp\">∃</span> <span class=\"n\">i</span><span class=\"o\">,</span> <span class=\"bp\">∃</span> <span class=\"bp\">Δ</span> <span class=\"bp\">∈</span> <span class=\"n\">ps.links</span><span class=\"o\">,</span> <span class=\"n\">conclusion</span> <span class=\"o\">(</span><span class=\"n\">A</span><span class=\"o\">,</span><span class=\"n\">i</span><span class=\"o\">)</span> <span class=\"bp\">Δ</span> <span class=\"bp\">∧</span> <span class=\"bp\">∀</span> <span class=\"bp\">Δ'</span> <span class=\"bp\">∈</span> <span class=\"n\">ps.links</span><span class=\"o\">,</span> <span class=\"bp\">¬</span><span class=\"n\">premise</span> <span class=\"o\">(</span><span class=\"n\">A</span><span class=\"o\">,</span><span class=\"n\">i</span><span class=\"o\">)</span> <span class=\"bp\">Δ'</span><span class=\"o\">)</span> <span class=\"bp\">→</span> <span class=\"n\">proof_net</span> <span class=\"bp\">Γ</span>\n</code></pre></div>\n<p>but I need to utilise the existential i's  and Δ's to define the map <code>proof Γ -&gt; proof_net Γ</code>, which is impossible since I'm not eliminating into <code>Prop</code>.</p>\n<p>What can I do? I'm not married to this definition <code>proof_net Γ</code> at all, it's just my latest attempt to define something that assists me in defining <code>proof Γ -&gt; proof_structure</code>.</p>",
        "id": 244238094,
        "sender_full_name": "Billy Price",
        "timestamp": 1624948077
    },
    {
        "content": "<p>here's my mwe with a failed attempt to define the tensor map case at the bottom</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kn\">import</span> <span class=\"n\">tactic</span>\n\n<span class=\"kd\">inductive</span> <span class=\"n\">Form</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span>\n<span class=\"bp\">|</span> <span class=\"n\">atom</span> <span class=\"o\">:</span> <span class=\"n\">ℕ</span> <span class=\"bp\">→</span> <span class=\"n\">Form</span>\n<span class=\"bp\">|</span> <span class=\"n\">tensor</span> <span class=\"o\">:</span> <span class=\"n\">Form</span> <span class=\"bp\">→</span> <span class=\"n\">Form</span> <span class=\"bp\">→</span> <span class=\"n\">Form</span>\n<span class=\"bp\">|</span> <span class=\"n\">par</span> <span class=\"o\">:</span> <span class=\"n\">Form</span> <span class=\"bp\">→</span> <span class=\"n\">Form</span> <span class=\"bp\">→</span> <span class=\"n\">Form</span>\n<span class=\"bp\">|</span> <span class=\"n\">neg</span> <span class=\"o\">:</span> <span class=\"n\">Form</span> <span class=\"bp\">→</span> <span class=\"n\">Form</span>\n\n<span class=\"kd\">infix</span> <span class=\"bp\">`</span> <span class=\"bp\">⊗</span> <span class=\"bp\">`</span><span class=\"o\">:</span><span class=\"mi\">70</span> <span class=\"o\">:=</span> <span class=\"n\">Form.tensor</span>\n<span class=\"kd\">infix</span> <span class=\"bp\">`</span> <span class=\"n\">⅋</span> <span class=\"bp\">`</span><span class=\"o\">:</span><span class=\"mi\">65</span> <span class=\"o\">:=</span> <span class=\"n\">Form.par</span>\n<span class=\"kd\">prefix</span> <span class=\"bp\">`~`</span> <span class=\"o\">:=</span> <span class=\"n\">Form.neg</span>\n\n<span class=\"kd\">inductive</span> <span class=\"n\">Link</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span>\n<span class=\"bp\">|</span> <span class=\"n\">ax</span> <span class=\"o\">:</span> <span class=\"n\">ℕ</span> <span class=\"bp\">→</span> <span class=\"n\">ℕ</span> <span class=\"bp\">→</span> <span class=\"n\">Form</span> <span class=\"bp\">→</span> <span class=\"n\">Link</span>\n<span class=\"bp\">|</span> <span class=\"n\">cut</span> <span class=\"o\">:</span> <span class=\"n\">ℕ</span> <span class=\"bp\">→</span> <span class=\"n\">ℕ</span> <span class=\"bp\">→</span> <span class=\"n\">Form</span> <span class=\"bp\">→</span> <span class=\"n\">Link</span>\n<span class=\"bp\">|</span> <span class=\"n\">tensor</span> <span class=\"o\">:</span> <span class=\"n\">ℕ</span> <span class=\"bp\">→</span> <span class=\"n\">ℕ</span> <span class=\"bp\">→</span> <span class=\"n\">ℕ</span> <span class=\"bp\">→</span> <span class=\"n\">Form</span> <span class=\"bp\">→</span> <span class=\"n\">Form</span> <span class=\"bp\">→</span> <span class=\"n\">Link</span>\n<span class=\"bp\">|</span> <span class=\"n\">par</span> <span class=\"o\">:</span> <span class=\"n\">ℕ</span> <span class=\"bp\">→</span> <span class=\"n\">ℕ</span> <span class=\"bp\">→</span> <span class=\"n\">ℕ</span> <span class=\"bp\">→</span> <span class=\"n\">Form</span> <span class=\"bp\">→</span> <span class=\"n\">Form</span> <span class=\"bp\">→</span> <span class=\"n\">Link</span>\n\n<span class=\"kd\">def</span> <span class=\"n\">Form_occ</span> <span class=\"o\">:=</span> <span class=\"n\">Form</span> <span class=\"bp\">×</span> <span class=\"n\">ℕ</span>\n\n<span class=\"kd\">inductive</span> <span class=\"n\">premise</span> <span class=\"o\">:</span> <span class=\"n\">Form_occ</span> <span class=\"bp\">→</span> <span class=\"n\">Link</span> <span class=\"bp\">→</span> <span class=\"kt\">Prop</span>\n<span class=\"bp\">|</span> <span class=\"n\">cut_pos</span> <span class=\"o\">{</span><span class=\"n\">A</span> <span class=\"n\">i</span> <span class=\"n\">j</span><span class=\"o\">}</span>          <span class=\"o\">:</span> <span class=\"n\">premise</span> <span class=\"o\">(</span><span class=\"n\">A</span><span class=\"o\">,</span><span class=\"n\">i</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">Link.cut</span> <span class=\"n\">i</span> <span class=\"n\">j</span> <span class=\"n\">A</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"n\">cut_neg</span> <span class=\"o\">{</span><span class=\"n\">A</span> <span class=\"n\">i</span> <span class=\"n\">j</span><span class=\"o\">}</span>          <span class=\"o\">:</span> <span class=\"n\">premise</span> <span class=\"o\">(</span><span class=\"bp\">~</span><span class=\"n\">A</span><span class=\"o\">,</span><span class=\"n\">j</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">Link.cut</span> <span class=\"n\">i</span> <span class=\"n\">j</span> <span class=\"n\">A</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"n\">tensor_left</span> <span class=\"o\">{</span><span class=\"n\">A</span> <span class=\"n\">B</span> <span class=\"n\">i</span> <span class=\"n\">j</span> <span class=\"n\">k</span><span class=\"o\">}</span>  <span class=\"o\">:</span> <span class=\"n\">premise</span> <span class=\"o\">(</span><span class=\"n\">A</span><span class=\"o\">,</span><span class=\"n\">i</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">Link.tensor</span> <span class=\"n\">i</span> <span class=\"n\">j</span> <span class=\"n\">k</span> <span class=\"n\">A</span> <span class=\"n\">B</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"n\">tensor_right</span> <span class=\"o\">{</span><span class=\"n\">A</span> <span class=\"n\">B</span> <span class=\"n\">i</span> <span class=\"n\">j</span> <span class=\"n\">k</span><span class=\"o\">}</span> <span class=\"o\">:</span> <span class=\"n\">premise</span> <span class=\"o\">(</span><span class=\"n\">B</span><span class=\"o\">,</span><span class=\"n\">j</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">Link.tensor</span> <span class=\"n\">i</span> <span class=\"n\">j</span> <span class=\"n\">k</span> <span class=\"n\">A</span> <span class=\"n\">B</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"n\">par_left</span> <span class=\"o\">{</span><span class=\"n\">A</span> <span class=\"n\">B</span> <span class=\"n\">i</span> <span class=\"n\">j</span> <span class=\"n\">k</span><span class=\"o\">}</span>     <span class=\"o\">:</span> <span class=\"n\">premise</span> <span class=\"o\">(</span><span class=\"n\">A</span><span class=\"o\">,</span><span class=\"n\">i</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">Link.par</span> <span class=\"n\">i</span> <span class=\"n\">j</span> <span class=\"n\">k</span> <span class=\"n\">A</span> <span class=\"n\">B</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"n\">par_right</span> <span class=\"o\">{</span><span class=\"n\">A</span> <span class=\"n\">B</span> <span class=\"n\">i</span> <span class=\"n\">j</span> <span class=\"n\">k</span><span class=\"o\">}</span>    <span class=\"o\">:</span> <span class=\"n\">premise</span> <span class=\"o\">(</span><span class=\"n\">B</span><span class=\"o\">,</span><span class=\"n\">j</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">Link.par</span> <span class=\"n\">i</span> <span class=\"n\">j</span> <span class=\"n\">k</span> <span class=\"n\">A</span> <span class=\"n\">B</span><span class=\"o\">)</span>\n\n<span class=\"kd\">inductive</span> <span class=\"n\">conclusion</span> <span class=\"o\">:</span> <span class=\"n\">Form_occ</span> <span class=\"bp\">→</span> <span class=\"n\">Link</span> <span class=\"bp\">→</span> <span class=\"kt\">Prop</span>\n<span class=\"bp\">|</span> <span class=\"n\">ax_pos</span> <span class=\"o\">{</span><span class=\"n\">A</span> <span class=\"n\">i</span> <span class=\"n\">j</span><span class=\"o\">}</span>     <span class=\"o\">:</span> <span class=\"n\">conclusion</span> <span class=\"o\">(</span><span class=\"n\">A</span><span class=\"o\">,</span><span class=\"n\">i</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">Link.ax</span> <span class=\"n\">i</span> <span class=\"n\">j</span> <span class=\"n\">A</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"n\">ax_neg</span> <span class=\"o\">{</span><span class=\"n\">A</span> <span class=\"n\">i</span> <span class=\"n\">j</span><span class=\"o\">}</span>     <span class=\"o\">:</span> <span class=\"n\">conclusion</span> <span class=\"o\">(</span><span class=\"bp\">~</span><span class=\"n\">A</span><span class=\"o\">,</span><span class=\"n\">j</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">Link.ax</span> <span class=\"n\">i</span> <span class=\"n\">j</span> <span class=\"n\">A</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"n\">tensor</span> <span class=\"o\">{</span><span class=\"n\">A</span> <span class=\"n\">B</span> <span class=\"n\">i</span> <span class=\"n\">j</span> <span class=\"n\">k</span><span class=\"o\">}</span> <span class=\"o\">:</span> <span class=\"n\">conclusion</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"bp\">⊗</span> <span class=\"n\">B</span><span class=\"o\">,</span><span class=\"n\">k</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">Link.tensor</span> <span class=\"n\">i</span> <span class=\"n\">j</span> <span class=\"n\">k</span> <span class=\"n\">A</span> <span class=\"n\">B</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"n\">par</span> <span class=\"o\">{</span><span class=\"n\">A</span> <span class=\"n\">B</span> <span class=\"n\">i</span> <span class=\"n\">j</span> <span class=\"n\">k</span><span class=\"o\">}</span>    <span class=\"o\">:</span> <span class=\"n\">conclusion</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"n\">⅋</span> <span class=\"n\">B</span><span class=\"o\">,</span><span class=\"n\">k</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">Link.par</span> <span class=\"n\">i</span> <span class=\"n\">j</span> <span class=\"n\">k</span> <span class=\"n\">A</span> <span class=\"n\">B</span><span class=\"o\">)</span>\n\n<span class=\"kd\">inductive</span> <span class=\"n\">mem_Link</span> <span class=\"o\">(</span><span class=\"n\">Ai</span> <span class=\"o\">:</span> <span class=\"n\">Form_occ</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">l</span> <span class=\"o\">:</span> <span class=\"n\">Link</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"kt\">Prop</span>\n<span class=\"bp\">|</span> <span class=\"n\">prem</span> <span class=\"o\">:</span> <span class=\"n\">premise</span> <span class=\"n\">Ai</span> <span class=\"n\">l</span> <span class=\"bp\">→</span> <span class=\"n\">mem_Link</span>\n<span class=\"bp\">|</span> <span class=\"n\">con</span> <span class=\"o\">:</span> <span class=\"n\">conclusion</span> <span class=\"n\">Ai</span> <span class=\"n\">l</span> <span class=\"bp\">→</span> <span class=\"n\">mem_Link</span>\n\n<span class=\"kd\">instance</span> <span class=\"o\">:</span> <span class=\"n\">has_mem</span> <span class=\"n\">Form_occ</span> <span class=\"n\">Link</span> <span class=\"o\">:=</span> <span class=\"o\">⟨</span><span class=\"n\">mem_Link</span><span class=\"o\">⟩</span>\n\n<span class=\"kd\">inductive</span> <span class=\"n\">valid_link</span> <span class=\"o\">:</span> <span class=\"n\">Link</span> <span class=\"bp\">→</span> <span class=\"kt\">Prop</span>\n<span class=\"bp\">|</span> <span class=\"n\">ax</span>  <span class=\"o\">{</span><span class=\"n\">i</span> <span class=\"n\">j</span> <span class=\"n\">A</span><span class=\"o\">}</span> <span class=\"o\">:</span> <span class=\"n\">valid_link</span> <span class=\"o\">(</span><span class=\"n\">Link.ax</span> <span class=\"n\">i</span> <span class=\"n\">j</span> <span class=\"n\">A</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"n\">cut</span> <span class=\"o\">{</span><span class=\"n\">i</span> <span class=\"n\">j</span> <span class=\"n\">A</span><span class=\"o\">}</span> <span class=\"o\">:</span> <span class=\"n\">valid_link</span> <span class=\"o\">(</span><span class=\"n\">Link.cut</span> <span class=\"n\">i</span> <span class=\"n\">j</span> <span class=\"n\">A</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"n\">tensor</span> <span class=\"o\">{</span><span class=\"n\">i</span> <span class=\"n\">j</span> <span class=\"n\">k</span> <span class=\"n\">A</span> <span class=\"n\">B</span><span class=\"o\">}</span> <span class=\"o\">:</span> <span class=\"o\">(</span><span class=\"n\">A</span><span class=\"o\">,</span><span class=\"n\">i</span><span class=\"o\">)</span> <span class=\"bp\">≠</span> <span class=\"o\">(</span><span class=\"n\">B</span><span class=\"o\">,</span><span class=\"n\">j</span><span class=\"o\">)</span> <span class=\"bp\">→</span> <span class=\"n\">valid_link</span> <span class=\"o\">(</span><span class=\"n\">Link.tensor</span> <span class=\"n\">i</span> <span class=\"n\">j</span> <span class=\"n\">k</span> <span class=\"n\">A</span> <span class=\"n\">B</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"n\">par</span> <span class=\"o\">{</span><span class=\"n\">i</span> <span class=\"n\">j</span> <span class=\"n\">k</span> <span class=\"n\">A</span> <span class=\"n\">B</span><span class=\"o\">}</span> <span class=\"o\">:</span> <span class=\"o\">(</span><span class=\"n\">A</span><span class=\"o\">,</span><span class=\"n\">i</span><span class=\"o\">)</span> <span class=\"bp\">≠</span> <span class=\"o\">(</span><span class=\"n\">B</span><span class=\"o\">,</span><span class=\"n\">j</span><span class=\"o\">)</span> <span class=\"bp\">→</span> <span class=\"n\">valid_link</span> <span class=\"o\">(</span><span class=\"n\">Link.par</span> <span class=\"n\">i</span> <span class=\"n\">j</span> <span class=\"n\">k</span> <span class=\"n\">A</span> <span class=\"n\">B</span><span class=\"o\">)</span>\n\n<span class=\"kd\">structure</span> <span class=\"n\">proof_structure</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span> <span class=\"o\">:=</span>\n<span class=\"o\">(</span><span class=\"n\">links</span> <span class=\"o\">:</span> <span class=\"n\">set</span> <span class=\"n\">Link</span><span class=\"o\">)</span>\n<span class=\"o\">(</span><span class=\"n\">valid</span> <span class=\"o\">:</span> <span class=\"bp\">∀</span> <span class=\"n\">l</span> <span class=\"bp\">∈</span> <span class=\"n\">links</span><span class=\"o\">,</span> <span class=\"n\">valid_link</span> <span class=\"n\">l</span><span class=\"o\">)</span>\n<span class=\"o\">(</span><span class=\"n\">prem_unique</span> <span class=\"o\">:</span> <span class=\"bp\">∀</span> <span class=\"n\">Ai</span> <span class=\"o\">:</span> <span class=\"n\">Form_occ</span><span class=\"o\">,</span> <span class=\"bp\">∀</span> <span class=\"n\">l₁</span> <span class=\"n\">l₂</span> <span class=\"bp\">∈</span> <span class=\"n\">links</span><span class=\"o\">,</span> <span class=\"n\">premise</span> <span class=\"n\">Ai</span> <span class=\"n\">l₁</span> <span class=\"bp\">→</span> <span class=\"n\">premise</span> <span class=\"n\">Ai</span> <span class=\"n\">l₂</span> <span class=\"bp\">→</span> <span class=\"n\">l₁</span> <span class=\"bp\">=</span> <span class=\"n\">l₂</span><span class=\"o\">)</span>\n<span class=\"o\">(</span><span class=\"n\">con_unique</span> <span class=\"o\">:</span> <span class=\"bp\">∀</span> <span class=\"n\">Ai</span> <span class=\"o\">:</span> <span class=\"n\">Form_occ</span><span class=\"o\">,</span> <span class=\"bp\">∀</span> <span class=\"n\">l₁</span> <span class=\"n\">l₂</span> <span class=\"bp\">∈</span> <span class=\"n\">links</span><span class=\"o\">,</span> <span class=\"n\">conclusion</span> <span class=\"n\">Ai</span> <span class=\"n\">l₁</span> <span class=\"bp\">→</span> <span class=\"n\">conclusion</span> <span class=\"n\">Ai</span> <span class=\"n\">l₂</span> <span class=\"bp\">→</span> <span class=\"n\">l₁</span> <span class=\"bp\">=</span> <span class=\"n\">l₂</span><span class=\"o\">)</span>\n\n<span class=\"kd\">inductive</span> <span class=\"n\">mem_Form_occ_ps</span> <span class=\"o\">(</span><span class=\"n\">Ai</span> <span class=\"o\">:</span> <span class=\"n\">Form_occ</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">ps</span> <span class=\"o\">:</span> <span class=\"n\">proof_structure</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"kt\">Prop</span>\n<span class=\"bp\">|</span> <span class=\"n\">mk</span> <span class=\"o\">{</span><span class=\"n\">l</span><span class=\"o\">}</span> <span class=\"o\">:</span> <span class=\"n\">l</span> <span class=\"bp\">∈</span> <span class=\"n\">ps.links</span> <span class=\"bp\">→</span> <span class=\"n\">Ai</span> <span class=\"bp\">∈</span> <span class=\"n\">l</span> <span class=\"bp\">→</span> <span class=\"n\">mem_Form_occ_ps</span>\n\n<span class=\"kd\">instance</span> <span class=\"o\">:</span> <span class=\"n\">has_mem</span> <span class=\"n\">Form_occ</span> <span class=\"n\">proof_structure</span> <span class=\"o\">:=</span> <span class=\"o\">⟨</span><span class=\"n\">mem_Form_occ_ps</span><span class=\"o\">⟩</span>\n\n<span class=\"kd\">def</span> <span class=\"n\">sequent</span> <span class=\"o\">:=</span> <span class=\"n\">list</span> <span class=\"n\">Form</span>\n\n<span class=\"kd\">instance</span> <span class=\"o\">:</span> <span class=\"n\">has_append</span> <span class=\"n\">sequent</span> <span class=\"o\">:=</span> <span class=\"o\">⟨</span><span class=\"n\">list.append</span><span class=\"o\">⟩</span>\n<span class=\"kd\">instance</span> <span class=\"o\">:</span> <span class=\"n\">has_mem</span> <span class=\"n\">Form</span> <span class=\"n\">sequent</span> <span class=\"o\">:=</span> <span class=\"o\">⟨</span><span class=\"n\">list.mem</span><span class=\"o\">⟩</span>\n\n<span class=\"kd\">inductive</span> <span class=\"n\">proof</span> <span class=\"o\">:</span> <span class=\"n\">sequent</span> <span class=\"bp\">→</span> <span class=\"kt\">Type</span>\n<span class=\"bp\">|</span> <span class=\"n\">ax</span> <span class=\"o\">(</span><span class=\"n\">A</span><span class=\"o\">)</span>                   <span class=\"o\">:</span> <span class=\"n\">proof</span> <span class=\"o\">[</span><span class=\"bp\">~</span><span class=\"n\">A</span><span class=\"o\">,</span> <span class=\"n\">A</span><span class=\"o\">]</span>\n<span class=\"bp\">|</span> <span class=\"n\">cut</span> <span class=\"o\">(</span><span class=\"n\">A</span><span class=\"o\">)</span> <span class=\"o\">{</span><span class=\"bp\">Γ</span> <span class=\"bp\">Γ'</span> <span class=\"bp\">Δ</span> <span class=\"bp\">Δ'</span><span class=\"o\">}</span>      <span class=\"o\">:</span> <span class=\"n\">proof</span> <span class=\"o\">(</span><span class=\"bp\">Γ</span> <span class=\"bp\">++</span> <span class=\"o\">[</span><span class=\"n\">A</span><span class=\"o\">]</span> <span class=\"bp\">++</span> <span class=\"bp\">Γ'</span><span class=\"o\">)</span> <span class=\"bp\">→</span> <span class=\"n\">proof</span> <span class=\"o\">(</span><span class=\"bp\">Δ</span> <span class=\"bp\">++</span> <span class=\"o\">[</span><span class=\"bp\">~</span><span class=\"n\">A</span><span class=\"o\">]</span> <span class=\"bp\">++</span> <span class=\"bp\">Δ'</span><span class=\"o\">)</span> <span class=\"bp\">→</span> <span class=\"n\">proof</span> <span class=\"o\">(</span><span class=\"bp\">Γ++Γ'++Δ++Δ'</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"n\">tensor</span> <span class=\"o\">{</span><span class=\"n\">A</span> <span class=\"n\">B</span><span class=\"o\">}</span> <span class=\"o\">{</span><span class=\"bp\">Γ</span> <span class=\"bp\">Γ'</span> <span class=\"bp\">Δ</span> <span class=\"bp\">Δ'</span><span class=\"o\">}</span> <span class=\"o\">:</span> <span class=\"n\">proof</span> <span class=\"o\">(</span><span class=\"bp\">Γ</span> <span class=\"bp\">++</span> <span class=\"o\">[</span><span class=\"n\">A</span><span class=\"o\">]</span> <span class=\"bp\">++</span> <span class=\"bp\">Γ'</span><span class=\"o\">)</span> <span class=\"bp\">→</span> <span class=\"n\">proof</span> <span class=\"o\">(</span><span class=\"bp\">Δ</span> <span class=\"bp\">++</span> <span class=\"o\">[</span><span class=\"n\">B</span><span class=\"o\">]</span> <span class=\"bp\">++</span> <span class=\"bp\">Δ'</span><span class=\"o\">)</span> <span class=\"bp\">→</span> <span class=\"n\">proof</span> <span class=\"o\">(</span><span class=\"bp\">Γ++Γ'++</span> <span class=\"o\">[</span><span class=\"n\">A</span> <span class=\"bp\">⊗</span> <span class=\"n\">B</span><span class=\"o\">]</span> <span class=\"bp\">++Δ++Δ'</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"n\">par</span> <span class=\"o\">{</span><span class=\"n\">A</span> <span class=\"n\">B</span><span class=\"o\">}</span> <span class=\"o\">{</span><span class=\"bp\">Γ</span> <span class=\"bp\">Γ'</span><span class=\"o\">}</span>         <span class=\"o\">:</span> <span class=\"n\">proof</span> <span class=\"o\">(</span><span class=\"bp\">Γ</span> <span class=\"bp\">++</span> <span class=\"o\">[</span><span class=\"n\">A</span><span class=\"o\">,</span><span class=\"n\">B</span><span class=\"o\">]</span> <span class=\"bp\">++</span> <span class=\"bp\">Γ'</span><span class=\"o\">)</span> <span class=\"bp\">→</span> <span class=\"n\">proof</span> <span class=\"o\">(</span><span class=\"bp\">Γ</span> <span class=\"bp\">++</span> <span class=\"o\">[</span><span class=\"n\">A</span> <span class=\"n\">⅋</span> <span class=\"n\">B</span><span class=\"o\">]</span> <span class=\"bp\">++</span> <span class=\"bp\">Γ'</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"n\">ex</span> <span class=\"o\">{</span><span class=\"n\">A</span> <span class=\"n\">B</span><span class=\"o\">}</span> <span class=\"o\">{</span><span class=\"bp\">Γ</span> <span class=\"bp\">Γ'</span><span class=\"o\">}</span>          <span class=\"o\">:</span> <span class=\"n\">proof</span> <span class=\"o\">(</span><span class=\"bp\">Γ</span> <span class=\"bp\">++</span> <span class=\"o\">[</span><span class=\"n\">A</span><span class=\"o\">,</span><span class=\"n\">B</span><span class=\"o\">]</span> <span class=\"bp\">++</span> <span class=\"bp\">Γ'</span><span class=\"o\">)</span> <span class=\"bp\">→</span> <span class=\"n\">proof</span> <span class=\"o\">(</span><span class=\"bp\">Γ</span> <span class=\"bp\">++</span> <span class=\"o\">[</span><span class=\"n\">B</span><span class=\"o\">,</span><span class=\"n\">A</span><span class=\"o\">]</span> <span class=\"bp\">++</span> <span class=\"bp\">Γ'</span><span class=\"o\">)</span>\n\n<span class=\"kd\">inductive</span> <span class=\"n\">proof_net</span> <span class=\"o\">:</span> <span class=\"n\">sequent</span> <span class=\"bp\">→</span> <span class=\"kt\">Type</span>\n<span class=\"bp\">|</span> <span class=\"n\">mk</span> <span class=\"o\">{</span><span class=\"bp\">Γ</span> <span class=\"o\">:</span> <span class=\"n\">sequent</span><span class=\"o\">}</span> <span class=\"o\">(</span><span class=\"n\">ps</span> <span class=\"o\">:</span> <span class=\"n\">proof_structure</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"o\">(</span><span class=\"bp\">∀</span> <span class=\"n\">A</span> <span class=\"bp\">∈</span> <span class=\"bp\">Γ</span><span class=\"o\">,</span> <span class=\"bp\">∃</span> <span class=\"n\">i</span><span class=\"o\">,</span> <span class=\"bp\">∃</span> <span class=\"bp\">Δ</span> <span class=\"bp\">∈</span> <span class=\"n\">ps.links</span><span class=\"o\">,</span> <span class=\"n\">conclusion</span> <span class=\"o\">(</span><span class=\"n\">A</span><span class=\"o\">,</span><span class=\"n\">i</span><span class=\"o\">)</span> <span class=\"bp\">Δ</span> <span class=\"bp\">∧</span> <span class=\"bp\">∀</span> <span class=\"bp\">Δ'</span> <span class=\"bp\">∈</span> <span class=\"n\">ps.links</span><span class=\"o\">,</span> <span class=\"bp\">¬</span><span class=\"n\">premise</span> <span class=\"o\">(</span><span class=\"n\">A</span><span class=\"o\">,</span><span class=\"n\">i</span><span class=\"o\">)</span> <span class=\"bp\">Δ'</span><span class=\"o\">)</span> <span class=\"bp\">→</span> <span class=\"n\">proof_net</span> <span class=\"bp\">Γ</span>\n\n<span class=\"kd\">instance</span> <span class=\"o\">{</span><span class=\"bp\">Γ</span> <span class=\"o\">:</span> <span class=\"n\">sequent</span><span class=\"o\">}</span> <span class=\"o\">:</span> <span class=\"n\">has_coe</span> <span class=\"o\">(</span><span class=\"n\">proof_net</span> <span class=\"bp\">Γ</span><span class=\"o\">)</span> <span class=\"n\">proof_structure</span> <span class=\"o\">:=</span> <span class=\"o\">⟨</span><span class=\"kd\">by</span> <span class=\"n\">rintro</span> <span class=\"o\">⟨</span><span class=\"bp\">Γ</span><span class=\"o\">,</span><span class=\"n\">ps</span><span class=\"o\">,</span><span class=\"n\">_</span><span class=\"o\">⟩</span><span class=\"bp\">;</span> <span class=\"n\">exact</span> <span class=\"n\">ps</span><span class=\"o\">⟩</span>\n\n<span class=\"kd\">def</span> <span class=\"n\">relabel_Link</span> <span class=\"o\">(</span><span class=\"n\">f</span> <span class=\"o\">:</span> <span class=\"n\">ℕ</span> <span class=\"bp\">→</span> <span class=\"n\">ℕ</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">Link</span> <span class=\"bp\">→</span> <span class=\"n\">Link</span>\n<span class=\"bp\">|</span> <span class=\"o\">(</span><span class=\"n\">Link.ax</span> <span class=\"n\">pi</span> <span class=\"n\">ni</span> <span class=\"n\">A</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"n\">Link.ax</span> <span class=\"o\">(</span><span class=\"n\">f</span> <span class=\"n\">pi</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">f</span> <span class=\"n\">ni</span><span class=\"o\">)</span> <span class=\"n\">A</span>\n<span class=\"bp\">|</span> <span class=\"o\">(</span><span class=\"n\">Link.cut</span> <span class=\"n\">pi</span> <span class=\"n\">ni</span> <span class=\"n\">A</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"n\">Link.cut</span> <span class=\"o\">(</span><span class=\"n\">f</span> <span class=\"n\">pi</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">f</span> <span class=\"n\">ni</span><span class=\"o\">)</span> <span class=\"n\">A</span>\n<span class=\"bp\">|</span> <span class=\"o\">(</span><span class=\"n\">Link.tensor</span> <span class=\"n\">ai</span> <span class=\"n\">bi</span> <span class=\"n\">ci</span> <span class=\"n\">A</span> <span class=\"n\">B</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"n\">Link.tensor</span> <span class=\"o\">(</span><span class=\"n\">f</span> <span class=\"n\">ai</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">f</span> <span class=\"n\">bi</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">f</span> <span class=\"n\">ci</span><span class=\"o\">)</span> <span class=\"n\">A</span> <span class=\"n\">B</span>\n<span class=\"bp\">|</span> <span class=\"o\">(</span><span class=\"n\">Link.par</span> <span class=\"n\">ai</span> <span class=\"n\">bi</span> <span class=\"n\">ci</span> <span class=\"n\">A</span> <span class=\"n\">B</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"n\">Link.par</span> <span class=\"o\">(</span><span class=\"n\">f</span> <span class=\"n\">ai</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">f</span> <span class=\"n\">bi</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">f</span> <span class=\"n\">ci</span><span class=\"o\">)</span> <span class=\"n\">A</span> <span class=\"n\">B</span>\n\n<span class=\"kd\">def</span> <span class=\"n\">proof_structure.relabel</span> <span class=\"o\">(</span><span class=\"n\">ps</span> <span class=\"o\">:</span> <span class=\"n\">proof_structure</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">f</span> <span class=\"o\">:</span> <span class=\"n\">ℕ</span> <span class=\"bp\">→</span> <span class=\"n\">ℕ</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">hf</span> <span class=\"o\">:</span> <span class=\"n\">function.injective</span> <span class=\"n\">f</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">proof_structure</span> <span class=\"o\">:=</span>\n<span class=\"o\">⟨</span><span class=\"n\">set.image</span> <span class=\"o\">(</span><span class=\"n\">relabel_Link</span> <span class=\"n\">f</span><span class=\"o\">)</span> <span class=\"n\">ps.links</span><span class=\"o\">,</span> <span class=\"gr\">sorry</span><span class=\"o\">,</span> <span class=\"gr\">sorry</span><span class=\"o\">,</span> <span class=\"gr\">sorry</span><span class=\"o\">⟩</span>\n\n<span class=\"kd\">def</span> <span class=\"n\">separators</span> <span class=\"o\">{</span><span class=\"n\">α</span> <span class=\"n\">β</span><span class=\"o\">}</span> <span class=\"o\">(</span><span class=\"n\">f</span> <span class=\"n\">g</span> <span class=\"o\">:</span> <span class=\"n\">α</span> <span class=\"bp\">→</span> <span class=\"n\">β</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"kt\">Prop</span> <span class=\"o\">:=</span> <span class=\"bp\">∀</span> <span class=\"n\">x</span> <span class=\"n\">y</span><span class=\"o\">,</span> <span class=\"n\">f</span> <span class=\"n\">x</span> <span class=\"bp\">≠</span> <span class=\"n\">g</span> <span class=\"n\">y</span>\n\n<span class=\"kd\">lemma</span> <span class=\"n\">sep_even_odd</span> <span class=\"o\">:</span> <span class=\"n\">separators</span> <span class=\"o\">(</span><span class=\"bp\">λ</span> <span class=\"n\">x</span><span class=\"o\">,</span> <span class=\"mi\">2</span> <span class=\"bp\">*</span> <span class=\"n\">x</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"bp\">λ</span> <span class=\"n\">x</span><span class=\"o\">,</span> <span class=\"mi\">2</span> <span class=\"bp\">*</span> <span class=\"n\">x</span> <span class=\"bp\">+</span> <span class=\"mi\">1</span><span class=\"o\">)</span> <span class=\"o\">:=</span>\n  <span class=\"bp\">λ</span> <span class=\"n\">x</span> <span class=\"n\">y</span><span class=\"o\">,</span> <span class=\"n\">nat.two_mul_ne_two_mul_add_one</span>\n\n<span class=\"kd\">def</span> <span class=\"n\">disjoint_of_separators</span> <span class=\"o\">{</span><span class=\"n\">ps₁</span> <span class=\"n\">ps₂</span> <span class=\"o\">:</span> <span class=\"n\">proof_structure</span><span class=\"o\">}</span> <span class=\"o\">{</span><span class=\"n\">f</span> <span class=\"n\">g</span><span class=\"o\">}</span> <span class=\"o\">(</span><span class=\"n\">hf</span> <span class=\"n\">hg</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">separators</span> <span class=\"n\">f</span> <span class=\"n\">g</span> <span class=\"bp\">→</span> <span class=\"n\">disjoint</span> <span class=\"o\">{</span> <span class=\"n\">Ai</span> <span class=\"bp\">|</span> <span class=\"n\">Ai</span> <span class=\"bp\">∈</span> <span class=\"o\">(</span><span class=\"n\">ps₁.relabel</span> <span class=\"n\">f</span> <span class=\"n\">hf</span><span class=\"o\">)</span> <span class=\"o\">}</span> <span class=\"o\">{</span> <span class=\"n\">Ai</span> <span class=\"bp\">|</span> <span class=\"n\">Ai</span> <span class=\"bp\">∈</span> <span class=\"o\">(</span><span class=\"n\">ps₂.relabel</span> <span class=\"n\">g</span> <span class=\"n\">hg</span><span class=\"o\">)</span> <span class=\"o\">}</span> <span class=\"o\">:=</span>\n <span class=\"kd\">by</span> <span class=\"gr\">sorry</span>\n\n<span class=\"kd\">def</span> <span class=\"n\">proof_net.disjoint</span> <span class=\"o\">{</span><span class=\"bp\">Γ</span> <span class=\"bp\">Δ</span><span class=\"o\">}</span> <span class=\"o\">:</span> <span class=\"n\">proof_net</span> <span class=\"bp\">Γ</span> <span class=\"bp\">→</span> <span class=\"n\">proof_net</span> <span class=\"bp\">Δ</span> <span class=\"bp\">→</span> <span class=\"kt\">Prop</span> <span class=\"o\">:=</span>\n  <span class=\"kd\">by</span> <span class=\"n\">rintro</span> <span class=\"o\">⟨</span><span class=\"n\">_</span><span class=\"o\">,</span><span class=\"n\">ps₁</span><span class=\"o\">,</span><span class=\"n\">_</span><span class=\"o\">⟩</span> <span class=\"o\">⟨</span><span class=\"n\">_</span><span class=\"o\">,</span><span class=\"n\">ps₂</span><span class=\"o\">,</span><span class=\"n\">_</span><span class=\"o\">⟩</span><span class=\"bp\">;</span> <span class=\"n\">exact</span> <span class=\"n\">disjoint</span> <span class=\"o\">{</span><span class=\"n\">Ai</span> <span class=\"bp\">|</span> <span class=\"n\">Ai</span> <span class=\"bp\">∈</span> <span class=\"n\">ps₁</span><span class=\"o\">}</span> <span class=\"o\">{</span><span class=\"n\">Ai</span> <span class=\"bp\">|</span> <span class=\"n\">Ai</span> <span class=\"bp\">∈</span> <span class=\"n\">ps₂</span><span class=\"o\">}</span>\n\n<span class=\"kd\">def</span> <span class=\"n\">net_links_ax</span> <span class=\"o\">(</span><span class=\"n\">pi</span> <span class=\"n\">ni</span> <span class=\"n\">A</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">set</span> <span class=\"n\">Link</span> <span class=\"o\">:=</span>\n  <span class=\"o\">{</span><span class=\"n\">Link.ax</span> <span class=\"n\">pi</span> <span class=\"n\">ni</span> <span class=\"n\">A</span><span class=\"o\">}</span>\n\n<span class=\"kd\">def</span> <span class=\"n\">net_links_tensor</span> <span class=\"o\">(</span><span class=\"n\">ai</span> <span class=\"n\">bi</span> <span class=\"n\">ci</span> <span class=\"n\">A</span> <span class=\"n\">B</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">sA</span> <span class=\"n\">sB</span> <span class=\"o\">:</span> <span class=\"n\">set</span> <span class=\"n\">Link</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">set</span> <span class=\"n\">Link</span> <span class=\"o\">:=</span>\n  <span class=\"o\">{</span><span class=\"n\">Link.tensor</span> <span class=\"n\">ai</span> <span class=\"n\">bi</span> <span class=\"n\">ci</span> <span class=\"n\">A</span> <span class=\"n\">B</span><span class=\"o\">}</span> <span class=\"bp\">∪</span> <span class=\"n\">sA</span> <span class=\"bp\">∪</span> <span class=\"n\">sB</span>\n\n<span class=\"kd\">def</span> <span class=\"n\">net_links_par</span> <span class=\"o\">(</span><span class=\"n\">ai</span> <span class=\"n\">bi</span> <span class=\"n\">ci</span> <span class=\"n\">A</span> <span class=\"n\">B</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">s</span> <span class=\"o\">:</span> <span class=\"n\">set</span> <span class=\"n\">Link</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">set</span> <span class=\"n\">Link</span> <span class=\"o\">:=</span>\n  <span class=\"o\">{</span><span class=\"n\">Link.par</span> <span class=\"n\">ai</span> <span class=\"n\">bi</span> <span class=\"n\">ci</span> <span class=\"n\">A</span> <span class=\"n\">B</span><span class=\"o\">}</span> <span class=\"bp\">∪</span> <span class=\"n\">s</span>\n\n<span class=\"kd\">def</span> <span class=\"n\">net_links_cut</span> <span class=\"o\">(</span><span class=\"n\">pi</span> <span class=\"n\">ni</span> <span class=\"n\">A</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">sA</span> <span class=\"n\">snA</span> <span class=\"o\">:</span> <span class=\"n\">set</span> <span class=\"n\">Link</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">set</span> <span class=\"n\">Link</span> <span class=\"o\">:=</span>\n  <span class=\"o\">{</span><span class=\"n\">Link.cut</span> <span class=\"n\">pi</span> <span class=\"n\">ni</span> <span class=\"n\">A</span><span class=\"o\">}</span> <span class=\"bp\">∪</span> <span class=\"n\">sA</span> <span class=\"bp\">∪</span> <span class=\"n\">snA</span>\n\n<span class=\"kd\">def</span> <span class=\"n\">proof_net_ax</span> <span class=\"o\">(</span><span class=\"n\">A</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">proof_net</span> <span class=\"o\">[</span><span class=\"bp\">~</span><span class=\"n\">A</span><span class=\"o\">,</span><span class=\"n\">A</span><span class=\"o\">]</span> <span class=\"o\">:=</span>\n<span class=\"o\">⟨</span>\n  <span class=\"o\">⟨{</span><span class=\"n\">Link.ax</span> <span class=\"mi\">0</span> <span class=\"mi\">0</span> <span class=\"n\">A</span><span class=\"o\">},</span>\n  <span class=\"kd\">by</span> <span class=\"n\">rintro</span> <span class=\"n\">l</span> <span class=\"o\">⟨</span><span class=\"n\">h</span><span class=\"o\">⟩</span><span class=\"bp\">;</span> <span class=\"n\">exact</span> <span class=\"n\">valid_link.ax</span><span class=\"o\">,</span>\n  <span class=\"kd\">by</span> <span class=\"n\">rintro</span> <span class=\"n\">Ai</span> <span class=\"bp\">Δ₁</span> <span class=\"bp\">Δ₂</span> <span class=\"o\">⟨</span><span class=\"n\">_</span><span class=\"o\">⟩</span> <span class=\"o\">⟨</span><span class=\"n\">_</span><span class=\"o\">⟩</span><span class=\"bp\">;</span> <span class=\"n\">finish</span><span class=\"o\">,</span>\n  <span class=\"kd\">by</span> <span class=\"n\">rintro</span> <span class=\"n\">Ai</span> <span class=\"bp\">Δ₁</span> <span class=\"bp\">Δ₂</span> <span class=\"o\">⟨</span><span class=\"n\">_</span><span class=\"o\">⟩</span> <span class=\"o\">⟨</span><span class=\"n\">_</span><span class=\"o\">⟩</span><span class=\"bp\">;</span> <span class=\"n\">finish</span> <span class=\"o\">⟩</span>\n<span class=\"o\">,</span>\n  <span class=\"kd\">begin</span>\n    <span class=\"n\">rintro</span> <span class=\"n\">B</span> <span class=\"o\">⟨⟨</span><span class=\"n\">_</span><span class=\"o\">⟩⟩,</span>\n      <span class=\"n\">refine</span> <span class=\"o\">⟨</span><span class=\"mi\">0</span><span class=\"o\">,</span><span class=\"n\">Link.ax</span> <span class=\"mi\">0</span> <span class=\"mi\">0</span> <span class=\"n\">A</span><span class=\"o\">,</span><span class=\"kd\">by</span> <span class=\"n\">simp</span><span class=\"o\">,</span><span class=\"n\">conclusion.ax_neg</span><span class=\"o\">,</span><span class=\"n\">_</span><span class=\"o\">⟩,</span> <span class=\"n\">rintro</span> <span class=\"bp\">Δ'</span> <span class=\"o\">⟨</span><span class=\"n\">_</span><span class=\"o\">⟩</span> <span class=\"o\">⟨</span><span class=\"n\">_</span><span class=\"o\">⟩,</span>\n    <span class=\"n\">rcases</span> <span class=\"n\">H</span> <span class=\"k\">with</span> <span class=\"o\">⟨⟨</span><span class=\"n\">_</span><span class=\"o\">⟩⟩,</span>\n      <span class=\"n\">refine</span> <span class=\"o\">⟨</span><span class=\"mi\">0</span><span class=\"o\">,</span><span class=\"n\">Link.ax</span> <span class=\"mi\">0</span> <span class=\"mi\">0</span> <span class=\"n\">A</span><span class=\"o\">,</span><span class=\"kd\">by</span> <span class=\"n\">simp</span><span class=\"o\">,</span><span class=\"n\">conclusion.ax_pos</span><span class=\"o\">,</span><span class=\"n\">_</span><span class=\"o\">⟩,</span> <span class=\"n\">rintro</span> <span class=\"bp\">Δ'</span> <span class=\"o\">⟨</span><span class=\"n\">_</span><span class=\"o\">⟩</span> <span class=\"o\">⟨</span><span class=\"n\">_</span><span class=\"o\">⟩,</span>\n    <span class=\"n\">cases</span> <span class=\"n\">H</span><span class=\"o\">,</span>\n  <span class=\"kd\">end</span>\n<span class=\"o\">⟩</span>\n\n<span class=\"kd\">def</span> <span class=\"n\">proof_net_tensor</span> <span class=\"o\">{</span><span class=\"bp\">Γ</span> <span class=\"bp\">Γ'</span> <span class=\"n\">A</span> <span class=\"n\">B</span> <span class=\"bp\">Δ</span> <span class=\"bp\">Δ'</span><span class=\"o\">}</span> <span class=\"o\">(</span><span class=\"n\">pnA</span> <span class=\"o\">:</span> <span class=\"n\">proof_net</span> <span class=\"o\">(</span><span class=\"bp\">Γ</span> <span class=\"bp\">++</span> <span class=\"o\">[</span><span class=\"n\">A</span><span class=\"o\">]</span> <span class=\"bp\">++</span> <span class=\"bp\">Γ'</span><span class=\"o\">))</span> <span class=\"o\">(</span><span class=\"n\">pnB</span> <span class=\"o\">:</span> <span class=\"n\">proof_net</span> <span class=\"o\">(</span><span class=\"bp\">Δ</span> <span class=\"bp\">++</span> <span class=\"o\">[</span><span class=\"n\">B</span><span class=\"o\">]</span> <span class=\"bp\">++</span> <span class=\"bp\">Δ'</span><span class=\"o\">))</span> <span class=\"o\">:</span>\n  <span class=\"n\">pnA.disjoint</span> <span class=\"n\">pnB</span> <span class=\"bp\">→</span> <span class=\"n\">proof_net</span> <span class=\"o\">(</span><span class=\"bp\">Γ</span> <span class=\"bp\">++</span> <span class=\"bp\">Γ'</span> <span class=\"bp\">++</span> <span class=\"o\">[</span><span class=\"n\">A</span> <span class=\"bp\">⊗</span> <span class=\"n\">B</span><span class=\"o\">]</span> <span class=\"bp\">++</span> <span class=\"bp\">Δ</span> <span class=\"bp\">++</span> <span class=\"bp\">Δ'</span><span class=\"o\">)</span> <span class=\"o\">:=</span>\n<span class=\"kd\">begin</span>\n  <span class=\"n\">rcases</span> <span class=\"n\">pnA</span> <span class=\"k\">with</span> <span class=\"o\">⟨</span><span class=\"n\">_</span><span class=\"o\">,</span><span class=\"n\">psA</span><span class=\"o\">,</span> <span class=\"n\">hA</span><span class=\"o\">⟩,</span>\n  <span class=\"n\">rcases</span> <span class=\"n\">pnB</span> <span class=\"k\">with</span> <span class=\"o\">⟨</span><span class=\"n\">_</span><span class=\"o\">,</span><span class=\"n\">psB</span><span class=\"o\">,</span> <span class=\"n\">hB</span><span class=\"o\">⟩,</span>\n  <span class=\"n\">intro</span> <span class=\"n\">dAB</span><span class=\"o\">,</span>\n  <span class=\"n\">specialize</span> <span class=\"n\">hA</span> <span class=\"n\">A</span> <span class=\"o\">(</span><span class=\"kd\">by</span> <span class=\"n\">exact</span> <span class=\"n\">list.mem_append_left</span> <span class=\"n\">_</span> <span class=\"o\">(</span><span class=\"n\">list.mem_append_right</span> <span class=\"n\">_</span> <span class=\"o\">(</span><span class=\"n\">list.mem_cons_self</span> <span class=\"n\">A</span> <span class=\"n\">list.nil</span><span class=\"o\">))),</span>\n  <span class=\"n\">specialize</span> <span class=\"n\">hB</span> <span class=\"n\">B</span> <span class=\"o\">(</span><span class=\"kd\">by</span> <span class=\"n\">exact</span> <span class=\"n\">list.mem_append_left</span> <span class=\"n\">_</span> <span class=\"o\">(</span><span class=\"n\">list.mem_append_right</span> <span class=\"n\">_</span> <span class=\"o\">(</span><span class=\"n\">list.mem_cons_self</span> <span class=\"n\">B</span> <span class=\"n\">list.nil</span><span class=\"o\">))),</span>\n  <span class=\"n\">cases</span> <span class=\"n\">hA</span> <span class=\"k\">with</span> <span class=\"n\">ai</span> <span class=\"bp\">Δ</span><span class=\"n\">A</span> <span class=\"n\">hA</span><span class=\"o\">,</span>\n\n<span class=\"kd\">end</span>\n</code></pre></div>",
        "id": 244238152,
        "sender_full_name": "Billy Price",
        "timestamp": 1624948127
    },
    {
        "content": "<p>Do you care about computability? If not, you could get the <code>i</code> and the <code>\\Delta</code> noncomputably using choice.</p>",
        "id": 244242594,
        "sender_full_name": "Horatiu Cheval",
        "timestamp": 1624951794
    },
    {
        "content": "<p>If that's not good, maybe you could work with subsets or Sigma-types instead of exists? </p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kd\">inductive</span> <span class=\"n\">proof_net</span> <span class=\"o\">:</span> <span class=\"n\">sequent</span> <span class=\"bp\">→</span> <span class=\"kt\">Type</span>\n<span class=\"bp\">|</span> <span class=\"n\">mk</span> <span class=\"o\">{</span><span class=\"bp\">Γ</span> <span class=\"o\">:</span> <span class=\"n\">sequent</span><span class=\"o\">}</span> <span class=\"o\">(</span><span class=\"n\">ps</span> <span class=\"o\">:</span> <span class=\"n\">proof_structure</span><span class=\"o\">)</span> <span class=\"o\">:</span>\n  <span class=\"o\">(</span><span class=\"bp\">Π</span> <span class=\"n\">A</span> <span class=\"bp\">∈</span> <span class=\"bp\">Γ</span><span class=\"o\">,</span> <span class=\"o\">{</span><span class=\"n\">i</span><span class=\"bp\">Δ</span> <span class=\"o\">:</span> <span class=\"o\">(</span><span class=\"n\">ℕ</span> <span class=\"bp\">×</span> <span class=\"n\">Link</span><span class=\"o\">)</span> <span class=\"bp\">//</span> <span class=\"n\">i</span><span class=\"bp\">Δ.</span><span class=\"mi\">2</span> <span class=\"bp\">∈</span> <span class=\"n\">ps.links</span> <span class=\"bp\">∧</span> <span class=\"n\">conclusion</span> <span class=\"o\">(</span><span class=\"n\">A</span><span class=\"o\">,</span><span class=\"n\">i</span><span class=\"bp\">Δ.</span><span class=\"mi\">1</span><span class=\"o\">)</span> <span class=\"n\">i</span><span class=\"bp\">Δ.</span><span class=\"mi\">2</span> <span class=\"bp\">∧</span>\n   <span class=\"bp\">∀</span> <span class=\"bp\">Δ'</span> <span class=\"bp\">∈</span> <span class=\"n\">ps.links</span><span class=\"o\">,</span> <span class=\"bp\">¬</span><span class=\"n\">premise</span> <span class=\"o\">(</span><span class=\"n\">A</span><span class=\"o\">,</span><span class=\"n\">i</span><span class=\"bp\">Δ.</span><span class=\"mi\">1</span><span class=\"o\">)</span> <span class=\"bp\">Δ'</span><span class=\"o\">})</span> <span class=\"bp\">→</span> <span class=\"n\">proof_net</span> <span class=\"bp\">Γ</span>\n</code></pre></div>\n<p>and then </p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"n\">rcases</span> <span class=\"n\">hA</span> <span class=\"k\">with</span> <span class=\"o\">⟨⟨</span><span class=\"n\">i</span><span class=\"o\">,</span> <span class=\"bp\">Δ</span><span class=\"o\">⟩,</span> <span class=\"n\">hA</span><span class=\"o\">⟩,</span>\n</code></pre></div>\n<p>will work in your last proof.</p>",
        "id": 244242967,
        "sender_full_name": "Horatiu Cheval",
        "timestamp": 1624952005
    },
    {
        "content": "<p>This change might require changes also in other areas of your code though</p>",
        "id": 244243155,
        "sender_full_name": "Horatiu Cheval",
        "timestamp": 1624952151
    },
    {
        "content": "<p>I think I care about computability simply because it would be absurd to think of it as not computable. Everything involved in the construction of the proof structure is finite. This is just a construction of a finite set of Links. I just want to be able to produce a set of links inductively that has the property of forming a proof structure, since all the constructions along the way are proof structures with the right formulas available to be linked.</p>",
        "id": 244262885,
        "sender_full_name": "Billy Price",
        "timestamp": 1624964162
    },
    {
        "content": "<p>Maybe I can define <code>proof_net Γ -&gt; set Link</code> and then lift it to <code>proof_structure</code> after the fact</p>",
        "id": 244262991,
        "sender_full_name": "Billy Price",
        "timestamp": 1624964220
    },
    {
        "content": "<p>That being said, what is this? <code>{iΔ : (ℕ × Link) // </code></p>",
        "id": 244263040,
        "sender_full_name": "Billy Price",
        "timestamp": 1624964259
    },
    {
        "content": "<p>the <code>//</code></p>",
        "id": 244263048,
        "sender_full_name": "Billy Price",
        "timestamp": 1624964264
    },
    {
        "content": "<p>Its is the notation for <a href=\"https://leanprover-community.github.io/mathlib_docs/find/subtype\">docs#subtype</a>.</p>",
        "id": 244263759,
        "sender_full_name": "Alex J. Best",
        "timestamp": 1624964677
    },
    {
        "content": "<p>Yes, sorry, I meant to say subtype, not subset in my answer. <code>{x : a // p x}</code> is the subtype of those <code>x</code> satisfying <code>p</code> which is very similar to <code>∃ x : a, p x</code>, except this is a <code>Type</code> and not a <code>Prop</code>, so you can (computably) eliminate it into any sort.</p>",
        "id": 244264469,
        "sender_full_name": "Horatiu Cheval",
        "timestamp": 1624965195
    },
    {
        "content": "<p>Alright, now i'm running into the problem that I can't eliminate <code>B ∈ [~A,A]</code> into that subtype.</p>",
        "id": 244265433,
        "sender_full_name": "Billy Price",
        "timestamp": 1624965938
    },
    {
        "content": "<p>I mean in this instance I can get away with not eliminating it because the i is the same for both formulas, but in general that's a little annoying</p>",
        "id": 244265544,
        "sender_full_name": "Billy Price",
        "timestamp": 1624965997
    },
    {
        "content": "<p>Okay I just realised that the same formula <code>A</code> could appear in the sequent <code>Γ</code> multiple times, and if so there will be multiple distinct <code>i</code> such that <code>(A,i)</code> appears in some link in the proof structure. This is a little annoying. A further detail that I think is implicit in the thing I'm trying to formalise, is that the <code>i</code> chosen for each <code>A</code> in the sequent should be the exact one that corresponds to the introduction of that <code>A</code> in the construction of the sequent.</p>",
        "id": 244266747,
        "sender_full_name": "Billy Price",
        "timestamp": 1624966875
    },
    {
        "content": "<blockquote>\n<p>Alright, now i'm running into the problem that I can't eliminate <code>B ∈ [~A,A]</code> into that subtype.</p>\n</blockquote>\n<p>If you mean that you can't get that <code>B</code> is either <code>~A</code> or <code>A</code> by casing on the list membership, that's true, but I'm sure it's possible to obtain that and write your definition in terms of those cases without needing to eliminate a <code>Prop</code> (like with an <code>if then else</code> or <code>by_cases</code> or something)</p>",
        "id": 244268445,
        "sender_full_name": "Horatiu Cheval",
        "timestamp": 1624967881
    },
    {
        "content": "<p>Sorry, I don't think I can give opinions on the larger design because I don't really understand what you're doing, I'm not familiar with these things :) I was just trying to help with the more specific Lean-related technical problems</p>",
        "id": 244268864,
        "sender_full_name": "Horatiu Cheval",
        "timestamp": 1624968096
    },
    {
        "content": "<p>That's okay, could you explain how I would change things here to use <code>if then else</code> or <code>by_cases</code>?</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kd\">def</span> <span class=\"n\">proof_net_ax</span> <span class=\"o\">(</span><span class=\"n\">A</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">proof_net</span> <span class=\"o\">[</span><span class=\"bp\">~</span><span class=\"n\">A</span><span class=\"o\">,</span><span class=\"n\">A</span><span class=\"o\">]</span> <span class=\"o\">:=</span>\n<span class=\"o\">⟨</span>\n  <span class=\"o\">⟨{</span><span class=\"n\">Link.ax</span> <span class=\"mi\">0</span> <span class=\"mi\">0</span> <span class=\"n\">A</span><span class=\"o\">},</span>\n  <span class=\"kd\">by</span> <span class=\"n\">rintro</span> <span class=\"n\">l</span> <span class=\"o\">⟨</span><span class=\"n\">h</span><span class=\"o\">⟩</span><span class=\"bp\">;</span> <span class=\"n\">exact</span> <span class=\"n\">valid_link.ax</span><span class=\"o\">,</span>\n  <span class=\"kd\">by</span> <span class=\"n\">rintro</span> <span class=\"n\">Ai</span> <span class=\"bp\">Δ₁</span> <span class=\"bp\">Δ₂</span> <span class=\"o\">⟨</span><span class=\"n\">_</span><span class=\"o\">⟩</span> <span class=\"o\">⟨</span><span class=\"n\">_</span><span class=\"o\">⟩</span><span class=\"bp\">;</span> <span class=\"n\">finish</span><span class=\"o\">,</span>\n  <span class=\"kd\">by</span> <span class=\"n\">rintro</span> <span class=\"n\">Ai</span> <span class=\"bp\">Δ₁</span> <span class=\"bp\">Δ₂</span> <span class=\"o\">⟨</span><span class=\"n\">_</span><span class=\"o\">⟩</span> <span class=\"o\">⟨</span><span class=\"n\">_</span><span class=\"o\">⟩</span><span class=\"bp\">;</span> <span class=\"n\">finish</span> <span class=\"o\">⟩</span>\n<span class=\"o\">,</span>\n  <span class=\"kd\">begin</span>\n    <span class=\"n\">rintro</span> <span class=\"n\">B</span> <span class=\"n\">Bmem</span><span class=\"o\">,</span>\n    <span class=\"n\">cases</span> <span class=\"n\">Bmem</span><span class=\"o\">,</span>\n      <span class=\"n\">exact</span> <span class=\"o\">⟨</span><span class=\"mi\">0</span><span class=\"o\">,</span><span class=\"n\">Link.ax</span> <span class=\"mi\">0</span> <span class=\"mi\">0</span> <span class=\"n\">A</span><span class=\"o\">,</span><span class=\"kd\">by</span> <span class=\"n\">simp</span><span class=\"o\">,</span><span class=\"n\">conclusion.ax_neg</span><span class=\"o\">,</span><span class=\"n\">_</span><span class=\"o\">⟩,</span> <span class=\"n\">rintro</span> <span class=\"bp\">Δ'</span> <span class=\"o\">⟨</span><span class=\"n\">_</span><span class=\"o\">⟩</span> <span class=\"o\">⟨</span><span class=\"n\">_</span><span class=\"o\">⟩,</span>\n    <span class=\"n\">rcases</span> <span class=\"n\">H</span> <span class=\"k\">with</span> <span class=\"o\">⟨⟨</span><span class=\"n\">_</span><span class=\"o\">⟩⟩,</span>\n      <span class=\"n\">exact</span> <span class=\"o\">⟨</span><span class=\"mi\">0</span><span class=\"o\">,</span><span class=\"n\">Link.ax</span> <span class=\"mi\">0</span> <span class=\"mi\">0</span> <span class=\"n\">A</span><span class=\"o\">,</span><span class=\"kd\">by</span> <span class=\"n\">simp</span><span class=\"o\">,</span><span class=\"n\">conclusion.ax_pos</span><span class=\"o\">,</span><span class=\"n\">_</span><span class=\"o\">⟩,</span> <span class=\"n\">rintro</span> <span class=\"bp\">Δ'</span> <span class=\"o\">⟨</span><span class=\"n\">_</span><span class=\"o\">⟩</span> <span class=\"o\">⟨</span><span class=\"n\">_</span><span class=\"o\">⟩,</span>\n    <span class=\"n\">cases</span> <span class=\"n\">H</span><span class=\"o\">,</span>\n  <span class=\"kd\">end</span>\n<span class=\"o\">⟩</span>\n</code></pre></div>",
        "id": 244269373,
        "sender_full_name": "Billy Price",
        "timestamp": 1624968330
    },
    {
        "content": "<p>actually the stuff after <code>cases Bmem</code> is outdated, but i can't \"go in and fix it\" until i get past <code>cases Bmem</code></p>",
        "id": 244269734,
        "sender_full_name": "Billy Price",
        "timestamp": 1624968488
    },
    {
        "content": "<p>I suppose, as I mentioned before, it doesn't matter here because <code>i</code> is <code>0</code> in both. hmm</p>",
        "id": 244270404,
        "sender_full_name": "Billy Price",
        "timestamp": 1624968844
    },
    {
        "content": "<p>This shouls work if I understand correctly what you need here </p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kd\">def</span> <span class=\"n\">proof_net_ax</span> <span class=\"o\">(</span><span class=\"n\">A</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">proof_net</span> <span class=\"o\">[</span><span class=\"bp\">~</span><span class=\"n\">A</span><span class=\"o\">,</span><span class=\"n\">A</span><span class=\"o\">]</span> <span class=\"o\">:=</span>\n<span class=\"o\">⟨</span>\n  <span class=\"o\">⟨{</span><span class=\"n\">Link.ax</span> <span class=\"mi\">0</span> <span class=\"mi\">0</span> <span class=\"n\">A</span><span class=\"o\">},</span>\n  <span class=\"kd\">by</span> <span class=\"n\">rintro</span> <span class=\"n\">l</span> <span class=\"o\">⟨</span><span class=\"n\">h</span><span class=\"o\">⟩</span><span class=\"bp\">;</span> <span class=\"n\">exact</span> <span class=\"n\">valid_link.ax</span><span class=\"o\">,</span>\n  <span class=\"kd\">by</span> <span class=\"n\">rintro</span> <span class=\"n\">Ai</span> <span class=\"bp\">Δ₁</span> <span class=\"bp\">Δ₂</span> <span class=\"o\">⟨</span><span class=\"n\">_</span><span class=\"o\">⟩</span> <span class=\"o\">⟨</span><span class=\"n\">_</span><span class=\"o\">⟩</span><span class=\"bp\">;</span> <span class=\"n\">finish</span><span class=\"o\">,</span>\n  <span class=\"kd\">by</span> <span class=\"n\">rintro</span> <span class=\"n\">Ai</span> <span class=\"bp\">Δ₁</span> <span class=\"bp\">Δ₂</span> <span class=\"o\">⟨</span><span class=\"n\">_</span><span class=\"o\">⟩</span> <span class=\"o\">⟨</span><span class=\"n\">_</span><span class=\"o\">⟩</span><span class=\"bp\">;</span> <span class=\"n\">finish</span> <span class=\"o\">⟩</span>\n<span class=\"o\">,</span>\n  <span class=\"kd\">begin</span>\n    <span class=\"n\">rintro</span> <span class=\"n\">B</span> <span class=\"n\">_</span><span class=\"o\">,</span>\n    <span class=\"n\">simp</span> <span class=\"n\">at</span> <span class=\"n\">H</span><span class=\"o\">,</span>\n    <span class=\"n\">by_cases</span> <span class=\"n\">hBA</span> <span class=\"o\">:</span> <span class=\"n\">B</span> <span class=\"bp\">=</span> <span class=\"n\">A</span><span class=\"o\">,</span>\n    <span class=\"o\">{</span>\n      <span class=\"c1\">-- hre you have</span>\n      <span class=\"c1\">-- hBA : B = A</span>\n      <span class=\"gr\">sorry</span><span class=\"o\">,</span>\n    <span class=\"o\">},</span>\n    <span class=\"o\">{</span>\n      <span class=\"k\">have</span> <span class=\"o\">:</span> <span class=\"n\">B</span> <span class=\"bp\">=</span> <span class=\"bp\">~</span><span class=\"n\">A</span> <span class=\"o\">:=</span> <span class=\"kd\">by</span> <span class=\"o\">{</span>\n        <span class=\"n\">cases</span> <span class=\"n\">H</span><span class=\"o\">,</span>\n        <span class=\"o\">{</span> <span class=\"n\">assumption</span> <span class=\"o\">},</span>\n        <span class=\"o\">{</span> <span class=\"n\">contradiction</span><span class=\"o\">,</span> <span class=\"o\">}</span>\n      <span class=\"o\">},</span>\n      <span class=\"gr\">sorry</span><span class=\"o\">,</span>\n      <span class=\"c1\">-- here you have</span>\n      <span class=\"c1\">-- this : B = ~A</span>\n    <span class=\"o\">},</span>\n  <span class=\"kd\">end</span>\n<span class=\"o\">⟩</span>\n</code></pre></div>",
        "id": 244270588,
        "sender_full_name": "Horatiu Cheval",
        "timestamp": 1624968960
    },
    {
        "content": "<p>It's quite ugly I think, I'm sure it could be done more elegantly, but just as an example</p>",
        "id": 244270821,
        "sender_full_name": "Horatiu Cheval",
        "timestamp": 1624969083
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"255481\">Billy Price</span> <a href=\"#narrow/stream/236446-Type-theory/topic/Linear.20Logic/near/244266747\">said</a>:</p>\n<blockquote>\n<p>Okay I just realised that the same formula <code>A</code> could appear in the sequent <code>Γ</code> multiple times, and if so there will be multiple distinct <code>i</code> such that <code>(A,i)</code> appears in some link in the proof structure. This is a little annoying. A further detail that I think is implicit in the thing I'm trying to formalise, is that the <code>i</code> chosen for each <code>A</code> in the sequent should be the exact one that corresponds to the introduction of that <code>A</code> in the construction of the sequent.</p>\n</blockquote>\n<p>It's very common for informal texts to gloss over stuff like this. The carefully written ones at least have a sentence somewhere saying, \"actually our contexts are multisets but we're not going to talk about it\". If so, you need to either adjust your context definition or make sure that your other definitions can deal with reordering and/or duplicates.</p>",
        "id": 244271281,
        "sender_full_name": "Jannis Limperg",
        "timestamp": 1624969353
    },
    {
        "content": "<p>I'm using <code>∈</code> but my sequent's are in fact lists, not sets. I think this stems from a purism about what sequents are, but for my purpose the identity of a sequent is less important than the idea that a proof/derivation of a sequent corresponds precisely to a construction of a proof net, and that construction is blind to exchange rules.</p>",
        "id": 244272526,
        "sender_full_name": "Billy Price",
        "timestamp": 1624970012
    },
    {
        "content": "<p>The moral being I don't think the sequent, as a list or multiset, has enough information to identify a canonical occurrence in a proof structure for each formula in the sequent, because any derivation can just finish with a bunch of exchange rules. It's really the whole proof structure you need to identify which formula corresponds to which.</p>",
        "id": 244273837,
        "sender_full_name": "Billy Price",
        "timestamp": 1624970656
    },
    {
        "content": "<p>I guess the reason a sequent is a list is really because a point of the proof net is to identify distinct proofs that differ only by exchange rules.</p>",
        "id": 244274999,
        "sender_full_name": "Billy Price",
        "timestamp": 1624971174
    },
    {
        "content": "<p>that being said, I don't even believe that now, because a use of exchange on identical formulas before a logical rule can change how you should construct the proof net. For example if you tensor two proofs with sequents [A] and [B,B] to get [A \\ox B, B], the construction of the proof net is different if you exchange the B's first.</p>",
        "id": 244275501,
        "sender_full_name": "Billy Price",
        "timestamp": 1624971403
    },
    {
        "content": "<p>Use <a href=\"https://leanprover-community.github.io/mathlib_docs/find/list.nth_le_of_mem\">docs#list.nth_le_of_mem</a>. Then you have a finite number of specified indices to check.</p>",
        "id": 244277289,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1624972159
    }
]