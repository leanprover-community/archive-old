[
    {
        "content": "<p>My current inductive definition of a term can produce ill-formed terms, for example if <code>A : type</code> is a type that is not <code>Ω</code> , then <code>all A (var 0 Ω)</code> is trying to bind an <code>Ω</code> variable to a <code>A</code> type binder.</p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"kn\">inductive</span> <span class=\"n\">type</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span>\n<span class=\"bp\">|</span> <span class=\"n\">One</span> <span class=\"bp\">|</span> <span class=\"n\">Omega</span> <span class=\"bp\">|</span> <span class=\"n\">Prod</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"n\">B</span> <span class=\"o\">:</span> <span class=\"n\">type</span><span class=\"o\">)</span><span class=\"bp\">|</span> <span class=\"n\">Pow</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"o\">:</span> <span class=\"n\">type</span><span class=\"o\">)</span>\n\n<span class=\"kn\">notation</span> <span class=\"bp\">`</span><span class=\"err\">Ω</span><span class=\"bp\">`</span> <span class=\"o\">:=</span> <span class=\"n\">type</span><span class=\"bp\">.</span><span class=\"n\">Omega</span>\n<span class=\"kn\">notation</span> <span class=\"bp\">`</span><span class=\"mi\">𝟙</span><span class=\"bp\">`</span> <span class=\"o\">:=</span> <span class=\"n\">type</span><span class=\"bp\">.</span><span class=\"n\">One</span>\n<span class=\"kn\">infix</span> <span class=\"bp\">`××`</span> <span class=\"o\">:</span><span class=\"mi\">100</span> <span class=\"o\">:=</span> <span class=\"n\">type</span><span class=\"bp\">.</span><span class=\"n\">Prod</span>\n<span class=\"kn\">prefix</span> <span class=\"err\">𝒫</span> <span class=\"o\">:</span><span class=\"mi\">101</span> <span class=\"o\">:=</span> <span class=\"n\">type</span><span class=\"bp\">.</span><span class=\"n\">Pow</span>\n\n<span class=\"kn\">inductive</span> <span class=\"n\">term</span> <span class=\"o\">:</span> <span class=\"n\">type</span> <span class=\"bp\">→</span> <span class=\"kt\">Type</span>\n<span class=\"bp\">|</span> <span class=\"n\">var</span>  <span class=\"o\">:</span> <span class=\"bp\">ℕ</span> <span class=\"bp\">→</span> <span class=\"bp\">Π</span> <span class=\"n\">A</span> <span class=\"o\">:</span> <span class=\"n\">type</span><span class=\"o\">,</span> <span class=\"n\">term</span> <span class=\"n\">A</span>\n<span class=\"bp\">|</span> <span class=\"n\">star</span> <span class=\"o\">:</span> <span class=\"n\">term</span> <span class=\"mi\">𝟙</span>\n<span class=\"bp\">|</span> <span class=\"n\">top</span>  <span class=\"o\">:</span> <span class=\"n\">term</span> <span class=\"err\">Ω</span>\n<span class=\"bp\">|</span> <span class=\"n\">bot</span>  <span class=\"o\">:</span> <span class=\"n\">term</span> <span class=\"err\">Ω</span>\n<span class=\"bp\">|</span> <span class=\"n\">prod</span> <span class=\"o\">:</span> <span class=\"bp\">Π</span> <span class=\"o\">{</span><span class=\"n\">A</span> <span class=\"n\">B</span> <span class=\"o\">:</span> <span class=\"n\">type</span><span class=\"o\">},</span> <span class=\"n\">term</span> <span class=\"n\">A</span> <span class=\"bp\">→</span> <span class=\"n\">term</span> <span class=\"n\">B</span> <span class=\"bp\">→</span> <span class=\"n\">term</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"bp\">××</span> <span class=\"n\">B</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"n\">elem</span> <span class=\"o\">:</span> <span class=\"bp\">Π</span> <span class=\"o\">{</span><span class=\"n\">A</span> <span class=\"o\">:</span> <span class=\"n\">type</span><span class=\"o\">},</span> <span class=\"n\">term</span> <span class=\"n\">A</span> <span class=\"bp\">→</span> <span class=\"n\">term</span> <span class=\"o\">(</span><span class=\"err\">𝒫</span> <span class=\"n\">A</span><span class=\"o\">)</span> <span class=\"bp\">→</span> <span class=\"n\">term</span> <span class=\"err\">Ω</span>\n<span class=\"bp\">|</span> <span class=\"n\">comp</span> <span class=\"o\">:</span> <span class=\"bp\">Π</span> <span class=\"n\">A</span> <span class=\"o\">:</span> <span class=\"n\">type</span><span class=\"o\">,</span> <span class=\"n\">term</span> <span class=\"err\">Ω</span> <span class=\"bp\">→</span> <span class=\"n\">term</span> <span class=\"o\">(</span><span class=\"err\">𝒫</span> <span class=\"n\">A</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"n\">and</span>  <span class=\"o\">:</span> <span class=\"n\">term</span> <span class=\"err\">Ω</span> <span class=\"bp\">→</span> <span class=\"n\">term</span> <span class=\"err\">Ω</span> <span class=\"bp\">→</span> <span class=\"n\">term</span> <span class=\"err\">Ω</span>\n<span class=\"bp\">|</span> <span class=\"n\">or</span>   <span class=\"o\">:</span> <span class=\"n\">term</span> <span class=\"err\">Ω</span> <span class=\"bp\">→</span> <span class=\"n\">term</span> <span class=\"err\">Ω</span> <span class=\"bp\">→</span> <span class=\"n\">term</span> <span class=\"err\">Ω</span>\n<span class=\"bp\">|</span> <span class=\"n\">imp</span>  <span class=\"o\">:</span> <span class=\"n\">term</span> <span class=\"err\">Ω</span> <span class=\"bp\">→</span> <span class=\"n\">term</span> <span class=\"err\">Ω</span> <span class=\"bp\">→</span> <span class=\"n\">term</span> <span class=\"err\">Ω</span>\n<span class=\"bp\">|</span> <span class=\"n\">all</span>  <span class=\"o\">:</span> <span class=\"bp\">Π</span> <span class=\"n\">A</span> <span class=\"o\">:</span> <span class=\"n\">type</span><span class=\"o\">,</span> <span class=\"n\">term</span> <span class=\"err\">Ω</span> <span class=\"bp\">→</span> <span class=\"n\">term</span> <span class=\"err\">Ω</span>\n<span class=\"bp\">|</span> <span class=\"n\">ex</span>   <span class=\"o\">:</span> <span class=\"bp\">Π</span> <span class=\"n\">A</span> <span class=\"o\">:</span> <span class=\"n\">type</span><span class=\"o\">,</span> <span class=\"n\">term</span> <span class=\"err\">Ω</span> <span class=\"bp\">→</span> <span class=\"n\">term</span> <span class=\"err\">Ω</span>\n</code></pre></div>\n\n\n<p>I'm guessing in Lean you cannot enforce conditions on the creation of inductive terms (like trying to say you can only make an <code>all A φ</code> expression  if <code>φ</code> has only <code>var 0 A</code> and no <code>var 0 B</code>).</p>\n<p>My next best idea is introducing the context on terms which is a mapping of free variables to types. Here's my start on that, though I am not that familiar with using <code>fin</code>. Should I use array, vector, list? Or is there a more direct approach to only creating well-defined terms?</p>",
        "id": 195563859,
        "sender_full_name": "Billy Price",
        "timestamp": 1588080605
    },
    {
        "content": "<p>I guess what I would like to be able to say is that a variable can be any term, and it's really only defined by its number, and when we bind it to a binder, it then has an associated type.</p>",
        "id": 195564055,
        "sender_full_name": "Billy Price",
        "timestamp": 1588080688
    },
    {
        "content": "<blockquote>\n<p>I'm guessing in Lean you cannot enforce conditions on the creation of inductive terms (like trying to say you can only make an all A φ expression if φ has only var 0 A and no var 0 B).</p>\n</blockquote>\n<p>You can, but it's a pain because you are still in the middle of the definition so you can't easily use recursive functions at the same time</p>",
        "id": 195564501,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1588080845
    },
    {
        "content": "<p>I would recommend keeping the term syntax as context free as possible, and have a well typing condition afterward that can have whatever dependencies it wants</p>",
        "id": 195564583,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1588080894
    },
    {
        "content": "<p>Hmm okay I'll take your advice. I was looking at flypitch documentation and they seem to do without a well-formedness predicate. Is that just because their terms are all the same type?</p>",
        "id": 195565429,
        "sender_full_name": "Billy Price",
        "timestamp": 1588081296
    },
    {
        "content": "<p>It's easier for them because it's only one type, yes. You end up having to carry around a lot of \"type state\" in real type theories, and it becomes hard to get all the definitional equalities you want</p>",
        "id": 195565908,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1588081548
    },
    {
        "content": "<p>But they have a clearly distinct step for proofs, which I think should be the analogue of type checking for you</p>",
        "id": 195566085,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1588081613
    },
    {
        "content": "<p>Sorry what step are you referring to?</p>",
        "id": 195566880,
        "sender_full_name": "Billy Price",
        "timestamp": 1588081961
    },
    {
        "content": "<p>step in the construction</p>",
        "id": 195567152,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1588082069
    },
    {
        "content": "<p>I would separate the grammar from the syntax rules</p>",
        "id": 195567199,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1588082098
    },
    {
        "content": "<p>If you want terms that embed typing information, so that only well-typed terms can be constructed, the usual approach is to index it not only by a type, but also by a context containing the types of free variables. Thus, you would have something like this:</p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"kn\">inductive</span> <span class=\"n\">type</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span>\n<span class=\"bp\">|</span> <span class=\"n\">One</span> <span class=\"bp\">|</span> <span class=\"n\">Omega</span> <span class=\"bp\">|</span> <span class=\"n\">Prod</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"n\">B</span> <span class=\"o\">:</span> <span class=\"n\">type</span><span class=\"o\">)</span><span class=\"bp\">|</span> <span class=\"n\">Pow</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"o\">:</span> <span class=\"n\">type</span><span class=\"o\">)</span> <span class=\"bp\">|</span> <span class=\"n\">Fun</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"n\">B</span> <span class=\"o\">:</span> <span class=\"n\">type</span><span class=\"o\">)</span>\n\n<span class=\"kn\">open</span> <span class=\"n\">type</span>\n\n<span class=\"n\">def</span> <span class=\"kn\">context</span> <span class=\"o\">:=</span> <span class=\"n\">list</span> <span class=\"n\">type</span>\n\n<span class=\"kn\">inductive</span> <span class=\"n\">var</span> <span class=\"o\">:</span> <span class=\"kn\">context</span> <span class=\"bp\">→</span> <span class=\"n\">type</span> <span class=\"bp\">→</span> <span class=\"kt\">Type</span>\n<span class=\"bp\">|</span> <span class=\"n\">var0</span> <span class=\"o\">(</span><span class=\"n\">α</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">var</span> <span class=\"o\">[</span><span class=\"n\">α</span><span class=\"o\">]</span> <span class=\"n\">α</span>\n<span class=\"bp\">|</span> <span class=\"n\">varsucc</span> <span class=\"o\">{</span><span class=\"err\">Γ</span> <span class=\"n\">α</span> <span class=\"n\">β</span><span class=\"o\">}</span> <span class=\"o\">:</span> <span class=\"n\">var</span> <span class=\"err\">Γ</span> <span class=\"n\">α</span> <span class=\"bp\">→</span> <span class=\"n\">var</span> <span class=\"o\">(</span><span class=\"n\">β</span> <span class=\"bp\">::</span> <span class=\"err\">Γ</span><span class=\"o\">)</span> <span class=\"n\">β</span>\n\n<span class=\"c1\">-- This is the simply-typed lambda calculus with a unit type and products.</span>\n<span class=\"kn\">inductive</span> <span class=\"n\">term</span> <span class=\"o\">:</span> <span class=\"kn\">context</span> <span class=\"bp\">→</span> <span class=\"n\">type</span> <span class=\"bp\">→</span> <span class=\"kt\">Type</span>\n<span class=\"bp\">|</span> <span class=\"n\">var</span> <span class=\"o\">{</span><span class=\"err\">Γ</span> <span class=\"n\">α</span><span class=\"o\">}</span> <span class=\"o\">:</span> <span class=\"n\">var</span> <span class=\"err\">Γ</span> <span class=\"n\">α</span> <span class=\"bp\">→</span> <span class=\"n\">term</span> <span class=\"err\">Γ</span> <span class=\"n\">α</span>\n<span class=\"bp\">|</span> <span class=\"n\">lam</span> <span class=\"o\">{</span><span class=\"err\">Γ</span> <span class=\"n\">α</span> <span class=\"n\">β</span><span class=\"o\">}</span> <span class=\"o\">:</span> <span class=\"n\">term</span> <span class=\"o\">(</span><span class=\"n\">α</span> <span class=\"bp\">::</span> <span class=\"err\">Γ</span><span class=\"o\">)</span> <span class=\"n\">β</span> <span class=\"bp\">→</span> <span class=\"n\">term</span> <span class=\"err\">Γ</span> <span class=\"o\">(</span><span class=\"n\">Fun</span> <span class=\"n\">α</span> <span class=\"n\">β</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"n\">prod</span> <span class=\"o\">{</span><span class=\"err\">Γ</span> <span class=\"n\">α</span> <span class=\"n\">β</span><span class=\"o\">}</span> <span class=\"o\">:</span> <span class=\"n\">term</span> <span class=\"err\">Γ</span> <span class=\"n\">α</span> <span class=\"bp\">→</span> <span class=\"n\">term</span> <span class=\"err\">Γ</span> <span class=\"n\">β</span> <span class=\"bp\">→</span> <span class=\"n\">term</span> <span class=\"err\">Γ</span> <span class=\"o\">(</span><span class=\"n\">Prod</span> <span class=\"n\">α</span> <span class=\"n\">β</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"n\">unit</span> <span class=\"o\">{</span><span class=\"err\">Γ</span><span class=\"o\">}</span> <span class=\"o\">:</span> <span class=\"n\">term</span> <span class=\"err\">Γ</span> <span class=\"n\">One</span>\n</code></pre></div>\n\n\n<p>This approach works fine and makes the development a little easier if (a) you don't have dependencies in your types (but I guess your <code>all</code> and <code>ex</code> are supposed to be quantifiers?) and (b) Lean properly supports indexed families (which I don't know). Mario's suggested approach -- keeping the syntax simple and putting a type predicate on top -- requires some additional boilerplate, but has the distinct advantage that it'll work regardless of what object theory you want to encode.</p>",
        "id": 195567247,
        "sender_full_name": "Jannis Limperg",
        "timestamp": 1588082125
    },
    {
        "content": "<p>Lean's support for indexed families is fine</p>",
        "id": 195567396,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1588082187
    },
    {
        "content": "<p>mutual is not fine</p>",
        "id": 195567406,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1588082194
    },
    {
        "content": "<p>While I agree with you up to a point, I find that once you get down to proving theorems about these terms, you might want to e.g. prove something by induction on the context from the other end, and then it enters DTT hell</p>",
        "id": 195567538,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1588082256
    },
    {
        "content": "<p>Yeah I'm a little turned off by the fact that my sequents will also have a context, and I'd have to marry them properly.</p>",
        "id": 195568076,
        "sender_full_name": "Billy Price",
        "timestamp": 1588082488
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"110049\">@Mario Carneiro</span> I can see how that proof might be tricky. I've also become more skeptical of intrinsically typed syntax lately -- it's nice when it works, but when it breaks, it sure breaks.</p>",
        "id": 195568381,
        "sender_full_name": "Jannis Limperg",
        "timestamp": 1588082614
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"255481\">@Billy Price</span> I don't know exactly what your sequents look like, but you will probably have two contexts, one for the types and one for the hypotheses (as is customary in HOL)</p>",
        "id": 195568805,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1588082780
    },
    {
        "content": "<p>the hypotheses are nondependent so it's not such a big deal</p>",
        "id": 195568843,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1588082795
    },
    {
        "content": "<p>The hypotheses in my sequents are just a single <code>term Ω</code>.</p>",
        "id": 195569469,
        "sender_full_name": "Billy Price",
        "timestamp": 1588083066
    },
    {
        "content": "<p>I'm having a little trouble stating the well-foundedness condition - am I on the right track?</p>\n<p>It also seems like there's two level's of well-foundedness - that every bound variable has the correct type, and that any free variables can be bound to a single type.</p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"n\">def</span> <span class=\"n\">FV_have_type</span> <span class=\"o\">(</span><span class=\"n\">Z</span> <span class=\"o\">:</span> <span class=\"n\">type</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"bp\">ℕ</span> <span class=\"bp\">→</span> <span class=\"bp\">Π</span> <span class=\"o\">{</span><span class=\"n\">A</span> <span class=\"o\">:</span> <span class=\"n\">type</span><span class=\"o\">},</span> <span class=\"n\">term</span> <span class=\"n\">A</span> <span class=\"bp\">→</span> <span class=\"kt\">Prop</span>\n<span class=\"bp\">|</span> <span class=\"n\">v</span> <span class=\"bp\">_</span> <span class=\"o\">(</span><span class=\"n\">var</span> <span class=\"n\">n</span> <span class=\"n\">A</span><span class=\"o\">)</span>  <span class=\"o\">:=</span> <span class=\"n\">v</span><span class=\"bp\">=</span><span class=\"n\">n</span> <span class=\"bp\">∧</span> <span class=\"n\">Z</span><span class=\"bp\">=</span><span class=\"n\">A</span>\n<span class=\"bp\">|</span> <span class=\"n\">v</span> <span class=\"bp\">_</span> <span class=\"o\">(</span><span class=\"n\">comp</span> <span class=\"n\">A</span> <span class=\"n\">φ</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"n\">FV_have_type</span> <span class=\"o\">(</span><span class=\"n\">v</span><span class=\"bp\">+</span><span class=\"mi\">1</span><span class=\"o\">)</span> <span class=\"n\">φ</span>\n<span class=\"bp\">|</span> <span class=\"n\">v</span> <span class=\"bp\">_</span> <span class=\"o\">(</span><span class=\"bp\">∀</span><span class=\"err\">&#39;</span> <span class=\"n\">A</span> <span class=\"n\">φ</span><span class=\"o\">)</span>   <span class=\"o\">:=</span> <span class=\"n\">FV_have_type</span> <span class=\"o\">(</span><span class=\"n\">v</span><span class=\"bp\">+</span><span class=\"mi\">1</span><span class=\"o\">)</span> <span class=\"n\">φ</span>\n<span class=\"bp\">|</span> <span class=\"n\">v</span> <span class=\"bp\">_</span> <span class=\"o\">(</span><span class=\"bp\">∃</span><span class=\"err\">&#39;</span> <span class=\"n\">A</span> <span class=\"n\">φ</span><span class=\"o\">)</span>   <span class=\"o\">:=</span> <span class=\"n\">FV_have_type</span> <span class=\"o\">(</span><span class=\"n\">v</span><span class=\"bp\">+</span><span class=\"mi\">1</span><span class=\"o\">)</span> <span class=\"n\">φ</span>\n<span class=\"bp\">|</span> <span class=\"n\">v</span> <span class=\"bp\">_</span> <span class=\"err\">⁎</span>          <span class=\"o\">:=</span> <span class=\"n\">true</span>\n<span class=\"bp\">|</span> <span class=\"n\">v</span> <span class=\"bp\">_</span> <span class=\"n\">top</span>        <span class=\"o\">:=</span> <span class=\"n\">true</span>\n<span class=\"bp\">|</span> <span class=\"n\">v</span> <span class=\"bp\">_</span> <span class=\"n\">bot</span>        <span class=\"o\">:=</span> <span class=\"n\">true</span>\n<span class=\"bp\">|</span> <span class=\"n\">v</span> <span class=\"bp\">_</span> <span class=\"o\">(</span><span class=\"n\">prod</span> <span class=\"n\">a</span> <span class=\"n\">b</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"n\">FV_have_type</span> <span class=\"n\">v</span> <span class=\"n\">a</span> <span class=\"bp\">∧</span> <span class=\"n\">FV_have_type</span> <span class=\"n\">v</span> <span class=\"n\">b</span>\n<span class=\"bp\">|</span> <span class=\"n\">v</span> <span class=\"bp\">_</span> <span class=\"o\">(</span><span class=\"n\">a</span> <span class=\"err\">∈</span> <span class=\"n\">α</span><span class=\"o\">)</span>    <span class=\"o\">:=</span> <span class=\"n\">FV_have_type</span> <span class=\"n\">v</span> <span class=\"n\">a</span> <span class=\"bp\">∧</span> <span class=\"n\">FV_have_type</span> <span class=\"n\">v</span> <span class=\"n\">α</span>\n<span class=\"bp\">|</span> <span class=\"n\">v</span> <span class=\"bp\">_</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"bp\">∧</span><span class=\"err\">&#39;</span> <span class=\"n\">q</span><span class=\"o\">)</span>   <span class=\"o\">:=</span> <span class=\"n\">FV_have_type</span> <span class=\"n\">v</span> <span class=\"n\">p</span> <span class=\"bp\">∧</span> <span class=\"n\">FV_have_type</span> <span class=\"n\">v</span> <span class=\"n\">q</span>\n<span class=\"bp\">|</span> <span class=\"n\">v</span> <span class=\"bp\">_</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"bp\">∨</span><span class=\"err\">&#39;</span> <span class=\"n\">q</span><span class=\"o\">)</span>   <span class=\"o\">:=</span> <span class=\"n\">FV_have_type</span> <span class=\"n\">v</span> <span class=\"n\">p</span> <span class=\"bp\">∧</span> <span class=\"n\">FV_have_type</span> <span class=\"n\">v</span> <span class=\"n\">q</span>\n<span class=\"bp\">|</span> <span class=\"n\">v</span> <span class=\"bp\">_</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"err\">⟹</span> <span class=\"n\">q</span><span class=\"o\">)</span>  <span class=\"o\">:=</span> <span class=\"n\">FV_have_type</span> <span class=\"n\">v</span> <span class=\"n\">p</span> <span class=\"bp\">∧</span> <span class=\"n\">FV_have_type</span> <span class=\"n\">v</span> <span class=\"n\">q</span>\n\n<span class=\"n\">def</span> <span class=\"n\">well_formed</span> <span class=\"o\">{</span><span class=\"n\">A</span> <span class=\"o\">:</span> <span class=\"n\">type</span><span class=\"o\">}</span> <span class=\"o\">(</span><span class=\"n\">φ</span> <span class=\"o\">:</span> <span class=\"n\">term</span> <span class=\"n\">A</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"kt\">Prop</span> <span class=\"o\">:=</span> <span class=\"n\">sorry</span>\n</code></pre></div>",
        "id": 195574629,
        "sender_full_name": "Billy Price",
        "timestamp": 1588085208
    },
    {
        "content": "<p>Do you mean <code>v = n -&gt; Z = A</code>? in other words saying that all occurrences of variable <code>n</code> are used at type <code>Z</code>?</p>",
        "id": 195574849,
        "sender_full_name": "Reid Barton",
        "timestamp": 1588085313
    },
    {
        "content": "<p>Ah yes</p>",
        "id": 195575132,
        "sender_full_name": "Billy Price",
        "timestamp": 1588085454
    },
    {
        "content": "<p>I think it isn't the traditional presentation, but I'm pretty sure it is better to only have the notion \"<code>φ : term A</code> is well-formed in <code>Γ : context</code>\"</p>",
        "id": 195576900,
        "sender_full_name": "Reid Barton",
        "timestamp": 1588086142
    },
    {
        "content": "<p>rather than having only <code>term</code>s with no context and trying to guess the free variables and their types by inspecting the term</p>",
        "id": 195577003,
        "sender_full_name": "Reid Barton",
        "timestamp": 1588086189
    },
    {
        "content": "<p>I started working on a calculus of constructions in Lean à few weeks ago, maybe you find it helpful: <a href=\"https://github.com/anfelor/coc-lean\" title=\"https://github.com/anfelor/coc-lean\">https://github.com/anfelor/coc-lean</a> Feel free to contact me if you have any questions.</p>",
        "id": 195665323,
        "sender_full_name": "Anton Lorenzen",
        "timestamp": 1588141494
    },
    {
        "content": "<p>Awesome! thanks I'll take a look</p>",
        "id": 195698879,
        "sender_full_name": "Billy Price",
        "timestamp": 1588162497
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"110032\">@Reid Barton</span> WF means the types of the free variables of <code>term A</code> match the context.</p>",
        "id": 195709049,
        "sender_full_name": "Billy Price",
        "timestamp": 1588167249
    },
    {
        "content": "<p>More specifically?</p>",
        "id": 195709072,
        "sender_full_name": "Reid Barton",
        "timestamp": 1588167258
    },
    {
        "content": "<p>What is the English translation of what you wrote?</p>",
        "id": 195709096,
        "sender_full_name": "Reid Barton",
        "timestamp": 1588167268
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span><code><span class=\"n\">def</span> <span class=\"n\">WF</span> <span class=\"o\">:</span> <span class=\"bp\">Π</span> <span class=\"n\">A</span> <span class=\"o\">:</span> <span class=\"n\">type</span><span class=\"o\">,</span> <span class=\"n\">term</span> <span class=\"n\">A</span> <span class=\"bp\">→</span> <span class=\"kn\">context</span> <span class=\"bp\">→</span>  <span class=\"kt\">Prop</span>\n<span class=\"bp\">|</span> <span class=\"bp\">_</span> <span class=\"o\">(</span><span class=\"n\">var</span> <span class=\"n\">n</span> <span class=\"n\">A</span><span class=\"o\">)</span> <span class=\"err\">Γ</span>  <span class=\"o\">:=</span> <span class=\"bp\">∀</span> <span class=\"n\">a</span> <span class=\"o\">:</span> <span class=\"n\">n</span> <span class=\"bp\">&lt;</span> <span class=\"err\">Γ</span><span class=\"bp\">.</span><span class=\"n\">length</span><span class=\"o\">,</span> <span class=\"o\">(</span><span class=\"err\">Γ</span><span class=\"bp\">.</span><span class=\"n\">nth_le</span> <span class=\"n\">n</span> <span class=\"n\">a</span> <span class=\"bp\">=</span> <span class=\"n\">A</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"bp\">_</span> <span class=\"o\">(</span><span class=\"n\">comp</span> <span class=\"n\">A</span> <span class=\"n\">φ</span><span class=\"o\">)</span> <span class=\"err\">Γ</span> <span class=\"o\">:=</span> <span class=\"n\">WF</span> <span class=\"err\">Ω</span> <span class=\"n\">φ</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"bp\">::</span> <span class=\"err\">Γ</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"bp\">_</span> <span class=\"o\">(</span><span class=\"bp\">∀</span><span class=\"err\">&#39;</span> <span class=\"n\">A</span> <span class=\"n\">φ</span><span class=\"o\">)</span> <span class=\"err\">Γ</span>  <span class=\"o\">:=</span> <span class=\"n\">WF</span> <span class=\"err\">Ω</span> <span class=\"n\">φ</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"bp\">::</span> <span class=\"err\">Γ</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"bp\">_</span> <span class=\"o\">(</span><span class=\"bp\">∃</span><span class=\"err\">&#39;</span> <span class=\"n\">A</span> <span class=\"n\">φ</span><span class=\"o\">)</span> <span class=\"err\">Γ</span>  <span class=\"o\">:=</span> <span class=\"n\">WF</span> <span class=\"err\">Ω</span> <span class=\"n\">φ</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"bp\">::</span> <span class=\"err\">Γ</span><span class=\"o\">)</span>\n</code></pre></div>",
        "id": 195709139,
        "sender_full_name": "Billy Price",
        "timestamp": 1588167292
    },
    {
        "content": "<p>Hang on let me paste my term definition</p>",
        "id": 195709173,
        "sender_full_name": "Billy Price",
        "timestamp": 1588167304
    },
    {
        "content": "<p>Also that WF definition is incomplete, there are more terms but they are less interesting to WF</p>",
        "id": 195709219,
        "sender_full_name": "Billy Price",
        "timestamp": 1588167323
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"255481\">Billy Price</span> <a href=\"#narrow/stream/236446-Type-theory/topic/Modelling.20a.20Type.20Theory.20in.20Lean/near/195563859\" title=\"#narrow/stream/236446-Type-theory/topic/Modelling.20a.20Type.20Theory.20in.20Lean/near/195563859\">said</a>:</p>\n<blockquote>\n<p>My current inductive definition of a term can produce ill-formed terms, for example if <code>A : type</code> is a type that is not <code>Ω</code> , then <code>all A (var 0 Ω)</code> is trying to bind an <code>Ω</code> variable to a <code>A</code> type binder.</p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"kn\">inductive</span> <span class=\"n\">type</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span>\n<span class=\"bp\">|</span> <span class=\"n\">One</span> <span class=\"bp\">|</span> <span class=\"n\">Omega</span> <span class=\"bp\">|</span> <span class=\"n\">Prod</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"n\">B</span> <span class=\"o\">:</span> <span class=\"n\">type</span><span class=\"o\">)</span><span class=\"bp\">|</span> <span class=\"n\">Pow</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"o\">:</span> <span class=\"n\">type</span><span class=\"o\">)</span>\n\n<span class=\"kn\">notation</span> <span class=\"bp\">`</span><span class=\"err\">Ω</span><span class=\"bp\">`</span> <span class=\"o\">:=</span> <span class=\"n\">type</span><span class=\"bp\">.</span><span class=\"n\">Omega</span>\n<span class=\"kn\">notation</span> <span class=\"bp\">`</span><span class=\"mi\">𝟙</span><span class=\"bp\">`</span> <span class=\"o\">:=</span> <span class=\"n\">type</span><span class=\"bp\">.</span><span class=\"n\">One</span>\n<span class=\"kn\">infix</span> <span class=\"bp\">`××`</span> <span class=\"o\">:</span><span class=\"mi\">100</span> <span class=\"o\">:=</span> <span class=\"n\">type</span><span class=\"bp\">.</span><span class=\"n\">Prod</span>\n<span class=\"kn\">prefix</span> <span class=\"err\">𝒫</span> <span class=\"o\">:</span><span class=\"mi\">101</span> <span class=\"o\">:=</span> <span class=\"n\">type</span><span class=\"bp\">.</span><span class=\"n\">Pow</span>\n\n<span class=\"kn\">inductive</span> <span class=\"n\">term</span> <span class=\"o\">:</span> <span class=\"n\">type</span> <span class=\"bp\">→</span> <span class=\"kt\">Type</span>\n<span class=\"bp\">|</span> <span class=\"n\">var</span>  <span class=\"o\">:</span> <span class=\"bp\">ℕ</span> <span class=\"bp\">→</span> <span class=\"bp\">Π</span> <span class=\"n\">A</span> <span class=\"o\">:</span> <span class=\"n\">type</span><span class=\"o\">,</span> <span class=\"n\">term</span> <span class=\"n\">A</span>\n<span class=\"bp\">|</span> <span class=\"n\">star</span> <span class=\"o\">:</span> <span class=\"n\">term</span> <span class=\"mi\">𝟙</span>\n<span class=\"bp\">|</span> <span class=\"n\">top</span>  <span class=\"o\">:</span> <span class=\"n\">term</span> <span class=\"err\">Ω</span>\n<span class=\"bp\">|</span> <span class=\"n\">bot</span>  <span class=\"o\">:</span> <span class=\"n\">term</span> <span class=\"err\">Ω</span>\n<span class=\"bp\">|</span> <span class=\"n\">prod</span> <span class=\"o\">:</span> <span class=\"bp\">Π</span> <span class=\"o\">{</span><span class=\"n\">A</span> <span class=\"n\">B</span> <span class=\"o\">:</span> <span class=\"n\">type</span><span class=\"o\">},</span> <span class=\"n\">term</span> <span class=\"n\">A</span> <span class=\"bp\">→</span> <span class=\"n\">term</span> <span class=\"n\">B</span> <span class=\"bp\">→</span> <span class=\"n\">term</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"bp\">××</span> <span class=\"n\">B</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"n\">elem</span> <span class=\"o\">:</span> <span class=\"bp\">Π</span> <span class=\"o\">{</span><span class=\"n\">A</span> <span class=\"o\">:</span> <span class=\"n\">type</span><span class=\"o\">},</span> <span class=\"n\">term</span> <span class=\"n\">A</span> <span class=\"bp\">→</span> <span class=\"n\">term</span> <span class=\"o\">(</span><span class=\"err\">𝒫</span> <span class=\"n\">A</span><span class=\"o\">)</span> <span class=\"bp\">→</span> <span class=\"n\">term</span> <span class=\"err\">Ω</span>\n<span class=\"bp\">|</span> <span class=\"n\">comp</span> <span class=\"o\">:</span> <span class=\"bp\">Π</span> <span class=\"n\">A</span> <span class=\"o\">:</span> <span class=\"n\">type</span><span class=\"o\">,</span> <span class=\"n\">term</span> <span class=\"err\">Ω</span> <span class=\"bp\">→</span> <span class=\"n\">term</span> <span class=\"o\">(</span><span class=\"err\">𝒫</span> <span class=\"n\">A</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"n\">and</span>  <span class=\"o\">:</span> <span class=\"n\">term</span> <span class=\"err\">Ω</span> <span class=\"bp\">→</span> <span class=\"n\">term</span> <span class=\"err\">Ω</span> <span class=\"bp\">→</span> <span class=\"n\">term</span> <span class=\"err\">Ω</span>\n<span class=\"bp\">|</span> <span class=\"n\">or</span>   <span class=\"o\">:</span> <span class=\"n\">term</span> <span class=\"err\">Ω</span> <span class=\"bp\">→</span> <span class=\"n\">term</span> <span class=\"err\">Ω</span> <span class=\"bp\">→</span> <span class=\"n\">term</span> <span class=\"err\">Ω</span>\n<span class=\"bp\">|</span> <span class=\"n\">imp</span>  <span class=\"o\">:</span> <span class=\"n\">term</span> <span class=\"err\">Ω</span> <span class=\"bp\">→</span> <span class=\"n\">term</span> <span class=\"err\">Ω</span> <span class=\"bp\">→</span> <span class=\"n\">term</span> <span class=\"err\">Ω</span>\n<span class=\"bp\">|</span> <span class=\"n\">all</span>  <span class=\"o\">:</span> <span class=\"bp\">Π</span> <span class=\"n\">A</span> <span class=\"o\">:</span> <span class=\"n\">type</span><span class=\"o\">,</span> <span class=\"n\">term</span> <span class=\"err\">Ω</span> <span class=\"bp\">→</span> <span class=\"n\">term</span> <span class=\"err\">Ω</span>\n<span class=\"bp\">|</span> <span class=\"n\">ex</span>   <span class=\"o\">:</span> <span class=\"bp\">Π</span> <span class=\"n\">A</span> <span class=\"o\">:</span> <span class=\"n\">type</span><span class=\"o\">,</span> <span class=\"n\">term</span> <span class=\"err\">Ω</span> <span class=\"bp\">→</span> <span class=\"n\">term</span> <span class=\"err\">Ω</span>\n</code></pre></div>\n\n\n<p>I'm guessing in Lean you cannot enforce conditions on the creation of inductive terms (like trying to say you can only make an <code>all A φ</code> expression  if <code>φ</code> has only <code>var 0 A</code> and no <code>var 0 B</code>).</p>\n<p>My next best idea is introducing the context on terms which is a mapping of free variables to types. Here's my start on that, though I am not that familiar with using <code>fin</code>. Should I use array, vector, list? Or is there a more direct approach to only creating well-defined terms?</p>\n</blockquote>",
        "id": 195709304,
        "sender_full_name": "Billy Price",
        "timestamp": 1588167362
    },
    {
        "content": "<p>Say the context is empty but you have a variable. Is that well-formed?</p>",
        "id": 195709460,
        "sender_full_name": "Reid Barton",
        "timestamp": 1588167440
    },
    {
        "content": "<p>Ah sorry I just realised it was you I was discussing this with earlier. I'm not sure specifically what I should clarify more about <code>WF</code>, given the definition there</p>",
        "id": 195709467,
        "sender_full_name": "Billy Price",
        "timestamp": 1588167447
    },
    {
        "content": "<p>Inductively defined propositions:</p>\n<ol>\n<li><a href=\"https://leanprover.github.io/theorem_proving_in_lean/inductive_types.html#inductively-defined-propositions\" title=\"https://leanprover.github.io/theorem_proving_in_lean/inductive_types.html#inductively-defined-propositions\">TPIL</a></li>\n<li><a href=\"https://www.codewars.com/kata/5cc47f8c4b8fea001de6d226\" title=\"https://www.codewars.com/kata/5cc47f8c4b8fea001de6d226\">Codewars: Multiples of 3, you say?</a></li>\n<li><a href=\"https://www.codewars.com/kata/5e59626530e9d00028bbe569\" title=\"https://www.codewars.com/kata/5e59626530e9d00028bbe569\">Codewars: Times Three, Plus Five</a></li>\n</ol>",
        "id": 195709613,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1588167495
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"110032\">@Reid Barton</span> Yeah I thought about that and I'm not sure how to fix that. For my use I think I can just allow those terms to exist?</p>",
        "id": 195709755,
        "sender_full_name": "Billy Price",
        "timestamp": 1588167562
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"110064\">@Kenny Lau</span> Even though I use the keyword <code>def</code>, I'm still defining it inductively on the inductive type <code>term A</code> right?</p>",
        "id": 195710127,
        "sender_full_name": "Billy Price",
        "timestamp": 1588167718
    },
    {
        "content": "<p>yes, but <code>inductive</code> might be better for this case</p>",
        "id": 195710205,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1588167741
    },
    {
        "content": "<p>Hmm, is that because it allows me to name the axioms for well-formedness on each of the term A's? I'm not sure I see the difference/benefit.</p>",
        "id": 195710496,
        "sender_full_name": "Billy Price",
        "timestamp": 1588167882
    },
    {
        "content": "<p>it allows you to \"inject\" things</p>",
        "id": 195710600,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1588167938
    },
    {
        "content": "<p>and you don't need to go through every case</p>",
        "id": 195710631,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1588167956
    },
    {
        "content": "<p>(cases you haven't gone through are automatically \"false\")</p>",
        "id": 195710684,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1588167966
    },
    {
        "content": "<p>I'm pretty sure Reid is hinting at this, but more directly: you don't want <code>∀ a : n &lt; Γ.length, (Γ.nth_le n a = A)</code>, you want <code>∃ a : n &lt; Γ.length, (Γ.nth_le n a = A)</code>. The former says that either the type is correct or it's out of range, while the latter says that it is in range and the type is correct. Better yet, skip the hypothesis and use <code>Γ.nth n = some A</code></p>",
        "id": 195711420,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1588168249
    },
    {
        "content": "<p>Beautiful, thank you.</p>",
        "id": 195711855,
        "sender_full_name": "Billy Price",
        "timestamp": 1588168398
    },
    {
        "content": "<p>Here's what I've got now (it compiles). I'm still not understanding the suggestion to use <code>inductive</code>. </p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"n\">def</span> <span class=\"n\">WF</span> <span class=\"o\">:</span> <span class=\"bp\">Π</span> <span class=\"n\">A</span> <span class=\"o\">:</span> <span class=\"n\">type</span><span class=\"o\">,</span> <span class=\"n\">term</span> <span class=\"n\">A</span> <span class=\"bp\">→</span> <span class=\"kn\">context</span> <span class=\"bp\">→</span> <span class=\"kt\">Prop</span>\n<span class=\"bp\">|</span> <span class=\"bp\">_</span> <span class=\"o\">(</span><span class=\"n\">var</span> <span class=\"n\">n</span> <span class=\"n\">A</span><span class=\"o\">)</span> <span class=\"err\">Γ</span>  <span class=\"o\">:=</span> <span class=\"err\">Γ</span><span class=\"bp\">.</span><span class=\"n\">nth</span> <span class=\"n\">n</span> <span class=\"bp\">=</span> <span class=\"n\">some</span> <span class=\"n\">A</span>\n<span class=\"bp\">|</span> <span class=\"bp\">_</span> <span class=\"o\">(</span><span class=\"n\">comp</span> <span class=\"n\">A</span> <span class=\"n\">φ</span><span class=\"o\">)</span> <span class=\"err\">Γ</span> <span class=\"o\">:=</span> <span class=\"n\">WF</span> <span class=\"err\">Ω</span> <span class=\"n\">φ</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"bp\">::</span> <span class=\"err\">Γ</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"bp\">_</span> <span class=\"o\">(</span><span class=\"bp\">∀</span><span class=\"err\">&#39;</span> <span class=\"n\">A</span> <span class=\"n\">φ</span><span class=\"o\">)</span> <span class=\"err\">Γ</span>   <span class=\"o\">:=</span> <span class=\"n\">WF</span> <span class=\"err\">Ω</span> <span class=\"n\">φ</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"bp\">::</span> <span class=\"err\">Γ</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"bp\">_</span> <span class=\"o\">(</span><span class=\"bp\">∃</span><span class=\"err\">&#39;</span> <span class=\"n\">A</span> <span class=\"n\">φ</span><span class=\"o\">)</span> <span class=\"err\">Γ</span>   <span class=\"o\">:=</span> <span class=\"n\">WF</span> <span class=\"err\">Ω</span> <span class=\"n\">φ</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"bp\">::</span> <span class=\"err\">Γ</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"bp\">_</span> <span class=\"err\">⁎</span> <span class=\"err\">Γ</span>          <span class=\"o\">:=</span> <span class=\"n\">true</span>\n<span class=\"bp\">|</span> <span class=\"bp\">_</span> <span class=\"n\">top</span> <span class=\"err\">Γ</span>        <span class=\"o\">:=</span> <span class=\"n\">true</span>\n<span class=\"bp\">|</span> <span class=\"bp\">_</span> <span class=\"n\">bot</span> <span class=\"err\">Γ</span>        <span class=\"o\">:=</span> <span class=\"n\">true</span>\n<span class=\"bp\">|</span> <span class=\"bp\">_</span> <span class=\"o\">(</span><span class=\"n\">prod</span> <span class=\"n\">a</span> <span class=\"n\">b</span><span class=\"o\">)</span> <span class=\"err\">Γ</span> <span class=\"o\">:=</span> <span class=\"n\">WF</span> <span class=\"bp\">_</span> <span class=\"n\">a</span> <span class=\"err\">Γ</span> <span class=\"bp\">∧</span> <span class=\"n\">WF</span> <span class=\"bp\">_</span> <span class=\"n\">b</span> <span class=\"err\">Γ</span>\n<span class=\"bp\">|</span> <span class=\"bp\">_</span> <span class=\"o\">(</span><span class=\"n\">a</span> <span class=\"err\">∈</span> <span class=\"n\">α</span><span class=\"o\">)</span> <span class=\"err\">Γ</span>    <span class=\"o\">:=</span> <span class=\"n\">WF</span> <span class=\"bp\">_</span> <span class=\"n\">a</span> <span class=\"err\">Γ</span> <span class=\"bp\">∧</span> <span class=\"n\">WF</span> <span class=\"bp\">_</span> <span class=\"n\">α</span> <span class=\"err\">Γ</span>\n<span class=\"bp\">|</span> <span class=\"bp\">_</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"bp\">∧</span><span class=\"err\">&#39;</span> <span class=\"n\">q</span><span class=\"o\">)</span> <span class=\"err\">Γ</span>   <span class=\"o\">:=</span> <span class=\"n\">WF</span> <span class=\"bp\">_</span> <span class=\"n\">p</span> <span class=\"err\">Γ</span> <span class=\"bp\">∧</span> <span class=\"n\">WF</span> <span class=\"bp\">_</span> <span class=\"n\">q</span> <span class=\"err\">Γ</span>\n<span class=\"bp\">|</span> <span class=\"bp\">_</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"bp\">∨</span><span class=\"err\">&#39;</span> <span class=\"n\">q</span><span class=\"o\">)</span> <span class=\"err\">Γ</span>   <span class=\"o\">:=</span> <span class=\"n\">WF</span> <span class=\"bp\">_</span> <span class=\"n\">p</span> <span class=\"err\">Γ</span> <span class=\"bp\">∧</span> <span class=\"n\">WF</span> <span class=\"bp\">_</span> <span class=\"n\">q</span> <span class=\"err\">Γ</span>\n<span class=\"bp\">|</span> <span class=\"bp\">_</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"err\">⟹</span> <span class=\"n\">q</span><span class=\"o\">)</span> <span class=\"err\">Γ</span>  <span class=\"o\">:=</span> <span class=\"n\">WF</span> <span class=\"bp\">_</span> <span class=\"n\">p</span> <span class=\"err\">Γ</span> <span class=\"bp\">∧</span> <span class=\"n\">WF</span> <span class=\"bp\">_</span> <span class=\"n\">q</span> <span class=\"err\">Γ</span>\n</code></pre></div>",
        "id": 195713258,
        "sender_full_name": "Billy Price",
        "timestamp": 1588168901
    },
    {
        "content": "<p>Surely if I use inductive, I can only talking about creating un-named elements of <code>Prop</code>, and I can't actually define which proposition they are right?</p>",
        "id": 195715381,
        "sender_full_name": "Billy Price",
        "timestamp": 1588169605
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110064\">Kenny Lau</span> <a href=\"#narrow/stream/236446-Type-theory/topic/Modelling.20a.20Type.20Theory.20in.20Lean/near/195709613\" title=\"#narrow/stream/236446-Type-theory/topic/Modelling.20a.20Type.20Theory.20in.20Lean/near/195709613\">said</a>:</p>\n<blockquote>\n<p>Inductively defined propositions:</p>\n<ol>\n<li><a href=\"https://leanprover.github.io/theorem_proving_in_lean/inductive_types.html#inductively-defined-propositions\" title=\"https://leanprover.github.io/theorem_proving_in_lean/inductive_types.html#inductively-defined-propositions\">TPIL</a></li>\n<li><a href=\"https://www.codewars.com/kata/5cc47f8c4b8fea001de6d226\" title=\"https://www.codewars.com/kata/5cc47f8c4b8fea001de6d226\">Codewars: Multiples of 3, you say?</a></li>\n<li><a href=\"https://www.codewars.com/kata/5e59626530e9d00028bbe569\" title=\"https://www.codewars.com/kata/5e59626530e9d00028bbe569\">Codewars: Times Three, Plus Five</a></li>\n</ol>\n</blockquote>",
        "id": 195715636,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1588169700
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"255481\">Billy Price</span> <a href=\"#narrow/stream/236446-Type-theory/topic/Modelling.20a.20Type.20Theory.20in.20Lean/near/195710496\" title=\"#narrow/stream/236446-Type-theory/topic/Modelling.20a.20Type.20Theory.20in.20Lean/near/195710496\">said</a>:</p>\n<blockquote>\n<p>Hmm, is that because it allows me to name the axioms for well-formedness on each of the term A's? I'm not sure I see the difference/benefit.</p>\n</blockquote>\n<p>Benefits of an inductive type for well-formedness (or any similar predicate):</p>\n<ul>\n<li>You can do \"rule induction\", i.e. induction on the derivation of a well-formedness proof. If you define the predicate by recursion over terms instead, you can't directly eliminate a hypothesis <code>WF t</code>; you'll have to eliminate <code>t</code> first until the <code>WF</code> reduces. (In your case, there's little difference in this regard because the structure of your well-formedness predicate is very close to the structure of your terms.)</li>\n<li>Recursive definitions must pass the termination checker; inductive definitions are generally more liberal. (Also not a concern in your case because you don't need a complicated recursive structure.)</li>\n<li>Lean may make the recursive definition extra cumbersome to use because it's picky about reducing definitional equalities (though that might not be a problem in practice; I haven't experimented with this). Maybe mark the <code>WF</code> def as <code>@[reducible]</code>.</li>\n</ul>\n<p>Benefits of a recursive definition of well-formedness:</p>\n<ul>\n<li>It may be a little clearer what's going on I guess?</li>\n</ul>\n<p><span class=\"user-mention silent\" data-user-id=\"255481\">Billy Price</span> <a href=\"#narrow/stream/236446-Type-theory/topic/Modelling.20a.20Type.20Theory.20in.20Lean/near/195715381\" title=\"#narrow/stream/236446-Type-theory/topic/Modelling.20a.20Type.20Theory.20in.20Lean/near/195715381\">said</a>:</p>\n<blockquote>\n<p>Surely if I use inductive, I can only talking about creating un-named elements of <code>Prop</code>, and I can't actually define which proposition they are right?</p>\n</blockquote>\n<p>Sorry, I don't understand your concern; could you rephrase?</p>",
        "id": 195715726,
        "sender_full_name": "Jannis Limperg",
        "timestamp": 1588169744
    },
    {
        "content": "<p>Hmm, I'm feeling pretty confused. I definitely need to go back an practice more basic lean.</p>",
        "id": 195717605,
        "sender_full_name": "Billy Price",
        "timestamp": 1588170531
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"110064\">@Kenny Lau</span>  thanks for the resource, I think I understand it in that context but I'm struggling to translate to my case.</p>",
        "id": 195718293,
        "sender_full_name": "Billy Price",
        "timestamp": 1588170772
    },
    {
        "content": "<p>Think of it in terms of what rules build up well-formed formulas into bigger ones, rather than how do you break down a formula to check whether it is well-formed.</p>",
        "id": 195718415,
        "sender_full_name": "Reid Barton",
        "timestamp": 1588170823
    },
    {
        "content": "<p>Actually, it's exactly like an inductive type except it's a proposition.</p>",
        "id": 195718440,
        "sender_full_name": "Reid Barton",
        "timestamp": 1588170831
    },
    {
        "content": "<p>Hmm - aren't I then just redefining <code>term A</code>?</p>",
        "id": 195718538,
        "sender_full_name": "Billy Price",
        "timestamp": 1588170854
    },
    {
        "content": "<p>Basically, yes</p>",
        "id": 195718580,
        "sender_full_name": "Reid Barton",
        "timestamp": 1588170872
    },
    {
        "content": "<p>But you still have <code>term</code> also, so you aren't restricted to only ever considering well-formed terms</p>",
        "id": 195718676,
        "sender_full_name": "Reid Barton",
        "timestamp": 1588170905
    },
    {
        "content": "<p>Also, in general, you might have a more interesting notion of well-formedness which isn't directly defined by recursion on the term, but I think that doesn't happen here.</p>",
        "id": 195718760,
        "sender_full_name": "Reid Barton",
        "timestamp": 1588170949
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110049\">Mario Carneiro</span> <a href=\"#narrow/stream/236446-Type-theory/topic/Modelling.20a.20Type.20Theory.20in.20Lean/near/195564583\" title=\"#narrow/stream/236446-Type-theory/topic/Modelling.20a.20Type.20Theory.20in.20Lean/near/195564583\">said</a>:</p>\n<blockquote>\n<p>I would recommend keeping the term syntax as context free as possible, and have a well typing condition afterward that can have whatever dependencies it wants</p>\n</blockquote>\n<p>This is the advice I am trying to follow at the moment</p>",
        "id": 195718852,
        "sender_full_name": "Billy Price",
        "timestamp": 1588170973
    },
    {
        "content": "<p>Both your recursive function and an inductive well-formedness predicate fall into this category, I think.</p>",
        "id": 195718913,
        "sender_full_name": "Reid Barton",
        "timestamp": 1588171004
    },
    {
        "content": "<p>I mean, your <code>WF</code> function also basically contains a complete definition of <code>term</code>, in the sense that all the constructors are listed</p>",
        "id": 195719093,
        "sender_full_name": "Reid Barton",
        "timestamp": 1588171075
    },
    {
        "content": "<p>Good point</p>",
        "id": 195719203,
        "sender_full_name": "Billy Price",
        "timestamp": 1588171106
    },
    {
        "content": "<p>So are you suggesting keeping the inductive term, and making an inductive WF with a context, or put the context into the term from the start so every term is well-formed (by forcing the binders and var to follow the context)?</p>",
        "id": 195719474,
        "sender_full_name": "Billy Price",
        "timestamp": 1588171233
    },
    {
        "content": "<p>Those are two options. Another is the recursive <code>WF</code> function you already have.<br>\nThe recursive <code>WF</code> function and the inductive well-formedness predicate are basically equivalent in terms of what you can express easily. (The main difference is that the inductive predicate gives you the ability to induct on the proof of well-formedness, but here it looks basically equivalent to inducting on the term itself; the recursive function is more like an algorithm for computing whether something is well-formed and it lets you directly prove, for example, that if <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>φ</mi><mo>∧</mo><mi>ψ</mi></mrow><annotation encoding=\"application/x-tex\">\\varphi \\wedge \\psi</annotation></semantics></math></span><span aria-hidden=\"true\" class=\"katex-html\"><span class=\"base\"><span class=\"strut\" style=\"height:0.75em;vertical-align:-0.19444em;\"></span><span class=\"mord mathdefault\">φ</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">∧</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8888799999999999em;vertical-align:-0.19444em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.03588em;\">ψ</span></span></span></span> is well-formed then the components <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>φ</mi></mrow><annotation encoding=\"application/x-tex\">\\varphi</annotation></semantics></math></span><span aria-hidden=\"true\" class=\"katex-html\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.19444em;\"></span><span class=\"mord mathdefault\">φ</span></span></span></span> and <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>ψ</mi></mrow><annotation encoding=\"application/x-tex\">\\psi</annotation></semantics></math></span><span aria-hidden=\"true\" class=\"katex-html\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8888799999999999em;vertical-align:-0.19444em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.03588em;\">ψ</span></span></span></span> are well-formed, which needs a case analysis if using the inductive predicate.)<br>\nPutting the context into the term from the start is not really equivalent, since it means you only have the vocabulary to ever talk about well-formed terms.</p>",
        "id": 195720456,
        "sender_full_name": "Reid Barton",
        "timestamp": 1588171640
    },
    {
        "content": "<p>I'm going with the well-typed-from-the-start approach for now, and I've coming up with a <code>var</code> constructer which sandwiches a given type <code>A</code> between the context of terms of about to be bound <code>\\Gamma</code> and those which will be bound after this variable, <code>\\Delta</code>. To be clear, in any context, the type of the 0th de-bruijn index variable is at the head of the list-context.</p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"n\">def</span> <span class=\"kn\">context</span> <span class=\"o\">:=</span> <span class=\"n\">list</span> <span class=\"n\">type</span>\n\n<span class=\"kn\">inductive</span> <span class=\"n\">term</span> <span class=\"o\">:</span> <span class=\"kn\">context</span> <span class=\"bp\">→</span> <span class=\"n\">type</span> <span class=\"bp\">→</span> <span class=\"kt\">Type</span>\n<span class=\"bp\">|</span> <span class=\"n\">var</span> <span class=\"o\">(</span><span class=\"err\">Γ</span> <span class=\"n\">A</span> <span class=\"err\">Δ</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">term</span> <span class=\"o\">(</span><span class=\"n\">list</span><span class=\"bp\">.</span><span class=\"n\">append</span> <span class=\"err\">Γ</span> <span class=\"o\">(</span><span class=\"n\">A</span><span class=\"bp\">::</span><span class=\"err\">Δ</span><span class=\"o\">))</span> <span class=\"n\">A</span>\n<span class=\"bp\">|</span> <span class=\"n\">comp</span> <span class=\"o\">{</span><span class=\"err\">Γ</span><span class=\"o\">}</span> <span class=\"o\">:</span> <span class=\"bp\">Π</span> <span class=\"n\">A</span> <span class=\"o\">:</span> <span class=\"n\">type</span><span class=\"o\">,</span> <span class=\"n\">term</span> <span class=\"o\">(</span><span class=\"n\">A</span><span class=\"bp\">::</span><span class=\"err\">Γ</span><span class=\"o\">)</span> <span class=\"err\">Ω</span> <span class=\"bp\">→</span> <span class=\"n\">term</span> <span class=\"err\">Γ</span> <span class=\"o\">(</span><span class=\"err\">𝒫</span> <span class=\"n\">A</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"n\">all</span>  <span class=\"o\">{</span><span class=\"err\">Γ</span><span class=\"o\">}</span> <span class=\"o\">:</span> <span class=\"bp\">Π</span> <span class=\"n\">A</span> <span class=\"o\">:</span> <span class=\"n\">type</span><span class=\"o\">,</span> <span class=\"n\">term</span> <span class=\"o\">(</span><span class=\"n\">A</span><span class=\"bp\">::</span><span class=\"err\">Γ</span><span class=\"o\">)</span> <span class=\"err\">Ω</span> <span class=\"bp\">→</span> <span class=\"n\">term</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span>\n<span class=\"bp\">|</span> <span class=\"n\">ex</span>   <span class=\"o\">{</span><span class=\"err\">Γ</span><span class=\"o\">}</span> <span class=\"o\">:</span> <span class=\"bp\">Π</span> <span class=\"n\">A</span> <span class=\"o\">:</span> <span class=\"n\">type</span><span class=\"o\">,</span> <span class=\"n\">term</span> <span class=\"o\">(</span><span class=\"n\">A</span><span class=\"bp\">::</span><span class=\"err\">Γ</span><span class=\"o\">)</span> <span class=\"err\">Ω</span> <span class=\"bp\">→</span> <span class=\"n\">term</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span>\n<span class=\"bp\">|</span> <span class=\"n\">star</span> <span class=\"o\">{</span><span class=\"err\">Γ</span><span class=\"o\">}</span> <span class=\"o\">:</span> <span class=\"n\">term</span> <span class=\"err\">Γ</span> <span class=\"mi\">𝟙</span>\n<span class=\"bp\">|</span> <span class=\"n\">top</span>  <span class=\"o\">{</span><span class=\"err\">Γ</span><span class=\"o\">}</span> <span class=\"o\">:</span> <span class=\"n\">term</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span>\n<span class=\"bp\">|</span> <span class=\"n\">bot</span>  <span class=\"o\">{</span><span class=\"err\">Γ</span><span class=\"o\">}</span> <span class=\"o\">:</span> <span class=\"n\">term</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span>\n<span class=\"bp\">|</span> <span class=\"n\">prod</span> <span class=\"o\">{</span><span class=\"err\">Γ</span><span class=\"o\">}</span> <span class=\"o\">:</span> <span class=\"bp\">Π</span> <span class=\"o\">{</span><span class=\"n\">A</span> <span class=\"n\">B</span> <span class=\"o\">:</span> <span class=\"n\">type</span><span class=\"o\">},</span> <span class=\"n\">term</span> <span class=\"err\">Γ</span> <span class=\"n\">A</span> <span class=\"bp\">→</span> <span class=\"n\">term</span> <span class=\"err\">Γ</span> <span class=\"n\">B</span> <span class=\"bp\">→</span> <span class=\"n\">term</span> <span class=\"err\">Γ</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"bp\">××</span> <span class=\"n\">B</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"n\">elem</span> <span class=\"o\">{</span><span class=\"err\">Γ</span><span class=\"o\">}</span> <span class=\"o\">:</span> <span class=\"bp\">Π</span> <span class=\"o\">{</span><span class=\"n\">A</span> <span class=\"o\">:</span> <span class=\"n\">type</span><span class=\"o\">},</span> <span class=\"n\">term</span> <span class=\"err\">Γ</span> <span class=\"n\">A</span> <span class=\"bp\">→</span> <span class=\"n\">term</span> <span class=\"err\">Γ</span> <span class=\"o\">(</span><span class=\"err\">𝒫</span> <span class=\"n\">A</span><span class=\"o\">)</span> <span class=\"bp\">→</span> <span class=\"n\">term</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span>\n<span class=\"bp\">|</span> <span class=\"n\">and</span>  <span class=\"o\">{</span><span class=\"err\">Γ</span><span class=\"o\">}</span> <span class=\"o\">:</span> <span class=\"n\">term</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"bp\">→</span> <span class=\"n\">term</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"bp\">→</span> <span class=\"n\">term</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span>\n<span class=\"bp\">|</span> <span class=\"n\">or</span>   <span class=\"o\">{</span><span class=\"err\">Γ</span><span class=\"o\">}</span> <span class=\"o\">:</span> <span class=\"n\">term</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"bp\">→</span> <span class=\"n\">term</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"bp\">→</span> <span class=\"n\">term</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span>\n<span class=\"bp\">|</span> <span class=\"n\">imp</span>  <span class=\"o\">{</span><span class=\"err\">Γ</span><span class=\"o\">}</span> <span class=\"o\">:</span> <span class=\"n\">term</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"bp\">→</span> <span class=\"n\">term</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"bp\">→</span> <span class=\"n\">term</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span>\n</code></pre></div>\n\n\n<p>As the terms currently exist, to construct a big term inductively from smaller terms, you need to know the whole context of the big term to construct and use the variables of the small terms. Obviously this is unsustainable, so I think I need to create a function for modifying contexts. I don't think there's many restrictions on the kind of context modification you can do, which includes adding more context to the end of the context, lifting the context and inserting other context before it, and also any reordering of types in the existing context. Perhaps there's some general pattern there, but I'm struggling to even define a simple case. If I mention <code>A</code> more than once between then <code>|</code> and the <code>:=</code>, it tells me <code>A already appears in this pattern</code>. I understand why that's an error, but I'm not sure what I'm supposed to do instead. I haven't been able to write the other cases for similar reasons.</p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"n\">def</span> <span class=\"n\">add_junk</span> <span class=\"o\">(</span><span class=\"n\">β</span> <span class=\"o\">:</span> <span class=\"kn\">context</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"bp\">Π</span> <span class=\"o\">(</span><span class=\"err\">Γ</span><span class=\"o\">:</span> <span class=\"kn\">context</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">A</span><span class=\"o\">:</span> <span class=\"n\">type</span><span class=\"o\">),</span> <span class=\"n\">term</span> <span class=\"err\">Γ</span> <span class=\"n\">A</span> <span class=\"bp\">→</span> <span class=\"n\">term</span> <span class=\"o\">(</span><span class=\"n\">list</span><span class=\"bp\">.</span><span class=\"n\">append</span> <span class=\"err\">Γ</span> <span class=\"n\">β</span><span class=\"o\">)</span> <span class=\"n\">A</span>\n<span class=\"bp\">|</span> <span class=\"o\">(</span><span class=\"n\">list</span><span class=\"bp\">.</span><span class=\"n\">append</span> <span class=\"err\">Γ</span> <span class=\"o\">(</span><span class=\"n\">A</span><span class=\"bp\">::</span><span class=\"err\">Δ</span><span class=\"o\">))</span> <span class=\"o\">(</span><span class=\"n\">A</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">var</span> <span class=\"err\">Γ</span> <span class=\"n\">A</span> <span class=\"err\">Δ</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"n\">var</span> <span class=\"err\">Γ</span> <span class=\"n\">A</span> <span class=\"o\">(</span><span class=\"n\">list</span><span class=\"bp\">.</span><span class=\"n\">append</span> <span class=\"err\">Δ</span> <span class=\"n\">β</span><span class=\"o\">)</span>\n</code></pre></div>",
        "id": 196264720,
        "sender_full_name": "Billy Price",
        "timestamp": 1588649870
    },
    {
        "content": "<p>You should leave the first two arguments blank, they are inferred from the third</p>",
        "id": 196293916,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1588677175
    },
    {
        "content": "<p>Alternatively you should be able to put a dot before them like</p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"n\">def</span> <span class=\"n\">add_junk</span> <span class=\"o\">(</span><span class=\"n\">β</span> <span class=\"o\">:</span> <span class=\"kn\">context</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"bp\">Π</span> <span class=\"o\">(</span><span class=\"err\">Γ</span><span class=\"o\">:</span> <span class=\"kn\">context</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">A</span><span class=\"o\">:</span> <span class=\"n\">type</span><span class=\"o\">),</span> <span class=\"n\">term</span> <span class=\"err\">Γ</span> <span class=\"n\">A</span> <span class=\"bp\">→</span> <span class=\"n\">term</span> <span class=\"o\">(</span><span class=\"n\">list</span><span class=\"bp\">.</span><span class=\"n\">append</span> <span class=\"err\">Γ</span> <span class=\"n\">β</span><span class=\"o\">)</span> <span class=\"n\">A</span>\n<span class=\"bp\">|</span> <span class=\"bp\">.</span><span class=\"o\">(</span><span class=\"n\">list</span><span class=\"bp\">.</span><span class=\"n\">append</span> <span class=\"err\">Γ</span> <span class=\"o\">(</span><span class=\"n\">A</span><span class=\"bp\">::</span><span class=\"err\">Δ</span><span class=\"o\">))</span> <span class=\"bp\">.</span><span class=\"o\">(</span><span class=\"n\">A</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">var</span> <span class=\"err\">Γ</span> <span class=\"n\">A</span> <span class=\"err\">Δ</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"n\">var</span> <span class=\"err\">Γ</span> <span class=\"n\">A</span> <span class=\"o\">(</span><span class=\"n\">list</span><span class=\"bp\">.</span><span class=\"n\">append</span> <span class=\"err\">Δ</span> <span class=\"n\">β</span><span class=\"o\">)</span>\n</code></pre></div>\n\n\n<p>and it will mark those positions as \"inacessible\" meaning that it won't try to split on the first argument and figure out why <code>list.append Γ (A::Δ)</code> is a constructor (because it's not)</p>",
        "id": 196294018,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1588677270
    },
    {
        "content": "<p>That results in this error</p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"n\">equation</span> <span class=\"n\">type</span> <span class=\"n\">mismatch</span><span class=\"o\">,</span> <span class=\"n\">term</span>\n  <span class=\"n\">var</span> <span class=\"err\">Γ</span> <span class=\"n\">A</span> <span class=\"o\">(</span><span class=\"n\">list</span><span class=\"bp\">.</span><span class=\"n\">append</span> <span class=\"err\">Δ</span> <span class=\"n\">β</span><span class=\"o\">)</span>\n<span class=\"n\">has</span> <span class=\"n\">type</span>\n  <span class=\"n\">term</span> <span class=\"o\">(</span><span class=\"n\">list</span><span class=\"bp\">.</span><span class=\"n\">append</span> <span class=\"err\">Γ</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"bp\">::</span> <span class=\"n\">list</span><span class=\"bp\">.</span><span class=\"n\">append</span> <span class=\"err\">Δ</span> <span class=\"n\">β</span><span class=\"o\">))</span> <span class=\"n\">A</span>\n<span class=\"n\">but</span> <span class=\"n\">is</span> <span class=\"n\">expected</span> <span class=\"n\">to</span> <span class=\"k\">have</span> <span class=\"n\">type</span>\n  <span class=\"n\">term</span> <span class=\"o\">(</span><span class=\"n\">list</span><span class=\"bp\">.</span><span class=\"n\">append</span> <span class=\"bp\">.</span> <span class=\"o\">(</span><span class=\"n\">list</span><span class=\"bp\">.</span><span class=\"n\">append</span> <span class=\"err\">Γ</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"bp\">::</span> <span class=\"err\">Δ</span><span class=\"o\">))</span> <span class=\"n\">β</span><span class=\"o\">)</span> <span class=\"bp\">.</span><span class=\"n\">A</span>\n</code></pre></div>",
        "id": 196297051,
        "sender_full_name": "Billy Price",
        "timestamp": 1588679519
    },
    {
        "content": "<p>Also what is the . syntax called so I can find it in the documentation?</p>",
        "id": 196297202,
        "sender_full_name": "Billy Price",
        "timestamp": 1588679598
    },
    {
        "content": "<p>It's called an inaccessible pattern. It is almost never used in lean/mathlib because in basically every case you can use <code>_</code> instead</p>",
        "id": 196300768,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1588681864
    },
    {
        "content": "<p>If you want to name the parameters, you should do so in the constructor <code>var Γ A Δ</code>, possibly using <code>@var more names Γ A Δ</code></p>",
        "id": 196300838,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1588681908
    },
    {
        "content": "<p>Anyway, you've just hit DTT hell in that error there</p>",
        "id": 196300929,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1588681946
    },
    {
        "content": "<p>You should definitely not have this constructor</p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"bp\">|</span> <span class=\"n\">var</span> <span class=\"o\">(</span><span class=\"err\">Γ</span> <span class=\"n\">A</span> <span class=\"err\">Δ</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">term</span> <span class=\"o\">(</span><span class=\"n\">list</span><span class=\"bp\">.</span><span class=\"n\">append</span> <span class=\"err\">Γ</span> <span class=\"o\">(</span><span class=\"n\">A</span><span class=\"bp\">::</span><span class=\"err\">Δ</span><span class=\"o\">))</span> <span class=\"n\">A</span>\n</code></pre></div>\n\n\n<p>because the term will usually not have this form</p>",
        "id": 196300982,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1588681977
    },
    {
        "content": "<p>Instead you can use <code>| var (Γ A) : A \\in Γ -&gt; term Γ A</code></p>",
        "id": 196301015,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1588682003
    },
    {
        "content": "<p>But then how can I possibly tell which type in the context list my var is constructing?</p>",
        "id": 196301127,
        "sender_full_name": "Billy Price",
        "timestamp": 1588682057
    },
    {
        "content": "<p>or <code>| var {Γ i A} : list.nth Γ i = some A -&gt; term Γ A</code></p>",
        "id": 196301141,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1588682065
    },
    {
        "content": "<p>that one gives you a de bruijn index</p>",
        "id": 196301170,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1588682091
    },
    {
        "content": "<p>Am I not achieving the same thing by stacking a context below and a context above <code>A</code> in <code>var \\Gamma A \\Delta</code>?</p>",
        "id": 196301243,
        "sender_full_name": "Billy Price",
        "timestamp": 1588682150
    },
    {
        "content": "<p>\"the same thing\" up to equality but not up to defeq</p>",
        "id": 196301302,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1588682165
    },
    {
        "content": "<p>and the reason defeq is coming up is because you have a dependent type</p>",
        "id": 196301338,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1588682195
    },
    {
        "content": "<p>defeq meaning definitional equality?</p>",
        "id": 196301376,
        "sender_full_name": "Billy Price",
        "timestamp": 1588682236
    },
    {
        "content": "<p><code>term (list.append Γ (A :: list.append Δ β)) A</code> and <code>term (list.append (list.append Γ (A :: Δ)) β) A</code> are distinct types, so you have to insert a cast between them and this will make everything harder</p>",
        "id": 196301387,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1588682243
    },
    {
        "content": "<p>(this is the issue I was predicting when I originally recommended to use a weakly typed <code>term</code> syntax + a well formedness judgment)</p>",
        "id": 196301478,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1588682306
    },
    {
        "content": "<p>ooh that's odd, I would have expected them to reduce to the same thing by unwrapping the definition of list.append?</p>",
        "id": 196301480,
        "sender_full_name": "Billy Price",
        "timestamp": 1588682307
    },
    {
        "content": "<p>You can't because <code>Γ</code> is a variable</p>",
        "id": 196301493,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1588682324
    },
    {
        "content": "<p>For every concrete term for <code>Γ</code> these two are defeq, but for variable <code>Γ</code> you have to prove it by induction</p>",
        "id": 196301521,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1588682352
    },
    {
        "content": "<p>that's pretty interesting</p>",
        "id": 196301562,
        "sender_full_name": "Billy Price",
        "timestamp": 1588682386
    },
    {
        "content": "<p>Obviously you should use a difference list for your context <em>flees</em></p>",
        "id": 196301632,
        "sender_full_name": "Reid Barton",
        "timestamp": 1588682419
    },
    {
        "content": "<p>You might have seen before I was trying to go with your original suggestion, but was struggling  to define the well-formedness predicate and was kinda lead back into well-typing it from the start.</p>",
        "id": 196301805,
        "sender_full_name": "Billy Price",
        "timestamp": 1588682540
    },
    {
        "content": "<p>The well formedness predicate can be done with either <code>inductive</code> or <code>def</code>. <a href=\"#narrow/stream/236446-Type-theory/topic/Modelling.20a.20Type.20Theory.20in.20Lean/near/195713258\" title=\"#narrow/stream/236446-Type-theory/topic/Modelling.20a.20Type.20Theory.20in.20Lean/near/195713258\">https://leanprover.zulipchat.com/#narrow/stream/236446-Type-theory/topic/Modelling.20a.20Type.20Theory.20in.20Lean/near/195713258</a> &lt;- this looks okay</p>",
        "id": 196301876,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1588682603
    },
    {
        "content": "<p><code>inductive</code> gives you a bit more freedom to not be strictly recursive</p>",
        "id": 196301920,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1588682639
    },
    {
        "content": "<p>it's also more natural when proving theorems by induction on well formed terms, so the sort of thing that the dependent type would give you</p>",
        "id": 196302102,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1588682757
    },
    {
        "content": "<p>the <code>def</code> is what you would want for implementing a type checker, or a proof that the typing judgment is decidable</p>",
        "id": 196302198,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1588682797
    },
    {
        "content": "<p>but you can have both versions and prove equivalence so there isn't a loss in picking one method over the other at first</p>",
        "id": 196302262,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1588682847
    },
    {
        "content": "<p>I see the issues with using my non-defeq context-terms, but given your constructor<code> | var {Γ i A} : list.nth Γ i = some A -&gt; term Γ A</code>, would that suffer from similar issues?</p>",
        "id": 196302406,
        "sender_full_name": "Billy Price",
        "timestamp": 1588682917
    },
    {
        "content": "<p>that will solve the problem you have with unifying the context, because <code>var</code> can have any context, and the content is shifted to the hypothesis, which is a Prop and hence has no issues with defeq</p>",
        "id": 196302557,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1588682997
    },
    {
        "content": "<p>your original <code>var</code> constructor only supports contexts of the form <code>Γ ++ A :: Δ</code></p>",
        "id": 196302653,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1588683032
    },
    {
        "content": "<p>Yep, but given that improvement, am I naive to think that fixes everything and using a WF predicate on weakly-typed terms is overly complicated?</p>",
        "id": 196302878,
        "sender_full_name": "Billy Price",
        "timestamp": 1588683167
    },
    {
        "content": "<p>With the inductive version you can set it up so that it looks almost the same. It's only about twice as long because you have two definitions instead of one (the terms, and the well formedness inductive type)</p>",
        "id": 196303010,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1588683242
    },
    {
        "content": "<p>but feel free to continue with dependent types, I've hopefully unstuck you on that issue and there are fixes or workarounds for most of the other problems that will arise</p>",
        "id": 196303088,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1588683297
    },
    {
        "content": "<p>I really appreciate the help in getting me started.</p>",
        "id": 196303162,
        "sender_full_name": "Billy Price",
        "timestamp": 1588683347
    },
    {
        "content": "<p>Here's the inductive-ification of the <a href=\"#narrow/stream/236446-Type-theory/topic/Modelling.20a.20Type.20Theory.20in.20Lean/near/196264720\" title=\"#narrow/stream/236446-Type-theory/topic/Modelling.20a.20Type.20Theory.20in.20Lean/near/196264720\">original dependent type</a>:</p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"kn\">inductive</span> <span class=\"n\">term</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span>\n<span class=\"bp\">|</span> <span class=\"n\">var</span> <span class=\"o\">:</span> <span class=\"bp\">ℕ</span> <span class=\"bp\">→</span> <span class=\"n\">term</span>\n<span class=\"bp\">|</span> <span class=\"n\">comp</span> <span class=\"o\">:</span> <span class=\"n\">type</span> <span class=\"bp\">→</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">term</span>\n<span class=\"bp\">|</span> <span class=\"n\">all</span>  <span class=\"o\">:</span> <span class=\"n\">type</span> <span class=\"bp\">→</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">term</span>\n<span class=\"bp\">|</span> <span class=\"n\">ex</span>   <span class=\"o\">:</span> <span class=\"n\">type</span> <span class=\"bp\">→</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">term</span>\n<span class=\"bp\">|</span> <span class=\"n\">star</span> <span class=\"o\">:</span> <span class=\"n\">term</span>\n<span class=\"bp\">|</span> <span class=\"n\">top</span>  <span class=\"o\">:</span> <span class=\"n\">term</span>\n<span class=\"bp\">|</span> <span class=\"n\">bot</span>  <span class=\"o\">:</span> <span class=\"n\">term</span>\n<span class=\"bp\">|</span> <span class=\"n\">prod</span> <span class=\"o\">:</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">term</span>\n<span class=\"bp\">|</span> <span class=\"n\">elem</span> <span class=\"o\">:</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">term</span>\n<span class=\"bp\">|</span> <span class=\"n\">and</span>  <span class=\"o\">:</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">term</span>\n<span class=\"bp\">|</span> <span class=\"n\">or</span>   <span class=\"o\">:</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">term</span>\n<span class=\"bp\">|</span> <span class=\"n\">imp</span>  <span class=\"o\">:</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">term</span>\n\n\n<span class=\"kn\">inductive</span> <span class=\"n\">WF</span> <span class=\"o\">:</span> <span class=\"kn\">context</span> <span class=\"bp\">→</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">type</span> <span class=\"bp\">→</span> <span class=\"kt\">Prop</span>\n<span class=\"bp\">|</span> <span class=\"n\">var</span> <span class=\"o\">(</span><span class=\"err\">Γ</span> <span class=\"n\">A</span> <span class=\"err\">Δ</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"o\">(</span><span class=\"n\">list</span><span class=\"bp\">.</span><span class=\"n\">append</span> <span class=\"err\">Γ</span> <span class=\"o\">(</span><span class=\"n\">A</span><span class=\"bp\">::</span><span class=\"err\">Δ</span><span class=\"o\">))</span> <span class=\"o\">(</span><span class=\"n\">term</span><span class=\"bp\">.</span><span class=\"n\">var</span> <span class=\"o\">(</span><span class=\"n\">list</span><span class=\"bp\">.</span><span class=\"n\">length</span> <span class=\"err\">Γ</span><span class=\"o\">))</span> <span class=\"n\">A</span>\n<span class=\"bp\">|</span> <span class=\"n\">comp</span> <span class=\"o\">{</span><span class=\"err\">Γ</span> <span class=\"n\">e</span><span class=\"o\">}</span> <span class=\"o\">:</span> <span class=\"bp\">Π</span> <span class=\"n\">A</span> <span class=\"o\">:</span> <span class=\"n\">type</span><span class=\"o\">,</span> <span class=\"n\">WF</span> <span class=\"o\">(</span><span class=\"n\">A</span><span class=\"bp\">::</span><span class=\"err\">Γ</span><span class=\"o\">)</span> <span class=\"n\">e</span> <span class=\"err\">Ω</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"o\">(</span><span class=\"n\">term</span><span class=\"bp\">.</span><span class=\"n\">comp</span> <span class=\"n\">A</span> <span class=\"n\">e</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"err\">𝒫</span> <span class=\"n\">A</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"n\">all</span>  <span class=\"o\">{</span><span class=\"err\">Γ</span> <span class=\"n\">e</span><span class=\"o\">}</span> <span class=\"o\">:</span> <span class=\"bp\">Π</span> <span class=\"n\">A</span> <span class=\"o\">:</span> <span class=\"n\">type</span><span class=\"o\">,</span> <span class=\"n\">WF</span> <span class=\"o\">(</span><span class=\"n\">A</span><span class=\"bp\">::</span><span class=\"err\">Γ</span><span class=\"o\">)</span> <span class=\"n\">e</span> <span class=\"err\">Ω</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"o\">(</span><span class=\"n\">term</span><span class=\"bp\">.</span><span class=\"n\">all</span> <span class=\"n\">A</span> <span class=\"n\">e</span><span class=\"o\">)</span> <span class=\"err\">Ω</span>\n<span class=\"bp\">|</span> <span class=\"n\">ex</span>   <span class=\"o\">{</span><span class=\"err\">Γ</span> <span class=\"n\">e</span><span class=\"o\">}</span> <span class=\"o\">:</span> <span class=\"bp\">Π</span> <span class=\"n\">A</span> <span class=\"o\">:</span> <span class=\"n\">type</span><span class=\"o\">,</span> <span class=\"n\">WF</span> <span class=\"o\">(</span><span class=\"n\">A</span><span class=\"bp\">::</span><span class=\"err\">Γ</span><span class=\"o\">)</span> <span class=\"n\">e</span> <span class=\"err\">Ω</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"o\">(</span><span class=\"n\">term</span><span class=\"bp\">.</span><span class=\"n\">all</span> <span class=\"n\">A</span> <span class=\"n\">e</span><span class=\"o\">)</span> <span class=\"err\">Ω</span>\n<span class=\"bp\">|</span> <span class=\"n\">star</span> <span class=\"o\">{</span><span class=\"err\">Γ</span><span class=\"o\">}</span> <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"n\">term</span><span class=\"bp\">.</span><span class=\"n\">star</span> <span class=\"mi\">𝟙</span>\n<span class=\"bp\">|</span> <span class=\"n\">top</span>  <span class=\"o\">{</span><span class=\"err\">Γ</span><span class=\"o\">}</span> <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"n\">term</span><span class=\"bp\">.</span><span class=\"n\">top</span> <span class=\"err\">Ω</span>\n<span class=\"bp\">|</span> <span class=\"n\">bot</span>  <span class=\"o\">{</span><span class=\"err\">Γ</span><span class=\"o\">}</span> <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"n\">term</span><span class=\"bp\">.</span><span class=\"n\">bot</span> <span class=\"err\">Ω</span>\n<span class=\"bp\">|</span> <span class=\"n\">prod</span> <span class=\"o\">{</span><span class=\"err\">Γ</span> <span class=\"n\">e₁</span> <span class=\"n\">e₂</span><span class=\"o\">}</span> <span class=\"o\">:</span> <span class=\"bp\">Π</span> <span class=\"o\">{</span><span class=\"n\">A</span> <span class=\"n\">B</span> <span class=\"o\">:</span> <span class=\"n\">type</span><span class=\"o\">},</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"n\">e₁</span> <span class=\"n\">A</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"n\">e₂</span> <span class=\"n\">B</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"o\">(</span><span class=\"n\">term</span><span class=\"bp\">.</span><span class=\"n\">prod</span> <span class=\"n\">e₁</span> <span class=\"n\">e₂</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"bp\">××</span> <span class=\"n\">B</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"n\">elem</span> <span class=\"o\">{</span><span class=\"err\">Γ</span> <span class=\"n\">e₁</span> <span class=\"n\">e₂</span><span class=\"o\">}</span> <span class=\"o\">:</span> <span class=\"bp\">Π</span> <span class=\"o\">{</span><span class=\"n\">A</span> <span class=\"o\">:</span> <span class=\"n\">type</span><span class=\"o\">},</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"n\">e₁</span> <span class=\"n\">A</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"n\">e₂</span> <span class=\"o\">(</span><span class=\"err\">𝒫</span> <span class=\"n\">A</span><span class=\"o\">)</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"o\">(</span><span class=\"n\">term</span><span class=\"bp\">.</span><span class=\"n\">elem</span> <span class=\"n\">e₁</span> <span class=\"n\">e₂</span><span class=\"o\">)</span> <span class=\"err\">Ω</span>\n<span class=\"bp\">|</span> <span class=\"n\">and</span>  <span class=\"o\">{</span><span class=\"err\">Γ</span> <span class=\"n\">e₁</span> <span class=\"n\">e₂</span><span class=\"o\">}</span> <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"n\">e₁</span> <span class=\"err\">Ω</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"n\">e₁</span> <span class=\"err\">Ω</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"o\">(</span><span class=\"n\">term</span><span class=\"bp\">.</span><span class=\"n\">and</span> <span class=\"n\">e₁</span> <span class=\"n\">e₂</span><span class=\"o\">)</span> <span class=\"err\">Ω</span>\n<span class=\"bp\">|</span> <span class=\"n\">or</span>   <span class=\"o\">{</span><span class=\"err\">Γ</span> <span class=\"n\">e₁</span> <span class=\"n\">e₂</span><span class=\"o\">}</span> <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"n\">e₁</span> <span class=\"err\">Ω</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"n\">e₁</span> <span class=\"err\">Ω</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"o\">(</span><span class=\"n\">term</span><span class=\"bp\">.</span><span class=\"n\">or</span> <span class=\"n\">e₁</span> <span class=\"n\">e₂</span><span class=\"o\">)</span> <span class=\"err\">Ω</span>\n<span class=\"bp\">|</span> <span class=\"n\">imp</span>  <span class=\"o\">{</span><span class=\"err\">Γ</span> <span class=\"n\">e₁</span> <span class=\"n\">e₂</span><span class=\"o\">}</span> <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"n\">e₁</span> <span class=\"err\">Ω</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"n\">e₁</span> <span class=\"err\">Ω</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"o\">(</span><span class=\"n\">term</span><span class=\"bp\">.</span><span class=\"n\">imp</span> <span class=\"n\">e₁</span> <span class=\"n\">e₂</span><span class=\"o\">)</span> <span class=\"err\">Ω</span>\n</code></pre></div>\n\n\n<p>there is actually an algorithm to perform these sort of translations, although I took the liberty of using a nat for the variable and otherwise removing unnecessary arguments from <code>term</code>, which is not obvious to the straightforward algorithm.</p>",
        "id": 196304258,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1588683865
    },
    {
        "content": "<p>Wow that was definitely non-obvious to me that you could take the types off term's as well. From then on, as I understand, instead of talking about terms, you'd talk about proofs that terms are well-formed? (as if its the term itself)</p>",
        "id": 196305815,
        "sender_full_name": "Billy Price",
        "timestamp": 1588684636
    },
    {
        "content": "<p>So a sequent is constructed from two WF's proofs, rather than from two terms?</p>",
        "id": 196305984,
        "sender_full_name": "Billy Price",
        "timestamp": 1588684706
    },
    {
        "content": "<p>No, a sequent is still just two terms</p>",
        "id": 196306020,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1588684729
    },
    {
        "content": "<p>But the inductive defining the proof relation will contain WF hypotheses</p>",
        "id": 196306072,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1588684757
    },
    {
        "content": "<p>Ah, I just wrote down the type and realised of course you must introduce the term objects themselves to talk about their WF'ness<br>\n<code>inductive proof : Π {Γ:context} {φ: term} {ψ : term}, WF Γ φ Ω  → WF Γ ψ Ω → Type</code></p>",
        "id": 196307014,
        "sender_full_name": "Billy Price",
        "timestamp": 1588685207
    },
    {
        "content": "<p>In what sense did you mean a proof/sequent is just two terms?</p>",
        "id": 196307359,
        "sender_full_name": "Billy Price",
        "timestamp": 1588685370
    },
    {
        "content": "<p>You can write the <code>proof : context -&gt; term -&gt; term -&gt; Prop</code> relation such that <code>proof Γ φ ψ -&gt;  WF Γ φ Ω  /\\ WF Γ ψ Ω</code>, although I would actually suggest <code>WF Γ φ Ω -&gt; proof Γ φ ψ -&gt;  WF Γ ψ Ω</code> instead</p>",
        "id": 196307375,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1588685379
    },
    {
        "content": "<p>Been working on this lately and oh boy - I need to understand tactics better.</p>",
        "id": 198401551,
        "sender_full_name": "Billy Price",
        "timestamp": 1590115700
    },
    {
        "content": "<p>What tactics do you you expect to be relevant to me? So far I'm familiar with the basic ones (apply, exact, cases, induction, simp). Since I have my own equality - would I need to write my own version of rewrite?</p>",
        "id": 198401743,
        "sender_full_name": "Billy Price",
        "timestamp": 1590116038
    },
    {
        "content": "<p>Also with those tactics - I'm finding that whenever I apply cases or induction, Lean comes up with really ugly local-context names for each case, and I need to manually name up to 10 things manually so they have sensible names. This is the current state of my tactic proof - any suggestions for controlling the growth here?</p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"kn\">lemma</span> <span class=\"n\">proof_WF</span> <span class=\"o\">{</span><span class=\"err\">Γ</span> <span class=\"o\">:</span> <span class=\"kn\">context</span><span class=\"o\">}</span> <span class=\"o\">{</span><span class=\"n\">φ</span> <span class=\"n\">ψ</span><span class=\"o\">:</span> <span class=\"n\">term</span><span class=\"o\">}</span> <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"n\">φ</span> <span class=\"err\">Ω</span> <span class=\"bp\">→</span> <span class=\"k\">proof</span> <span class=\"err\">Γ</span> <span class=\"n\">φ</span> <span class=\"n\">ψ</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"n\">ψ</span> <span class=\"err\">Ω</span> <span class=\"o\">:=</span>\n<span class=\"k\">begin</span>\n<span class=\"n\">intros</span> <span class=\"n\">wf_φ</span> <span class=\"n\">prf_φ_ψ</span><span class=\"o\">,</span>\n<span class=\"n\">induction</span> <span class=\"n\">prf_φ_ψ</span><span class=\"o\">,</span>\n  <span class=\"n\">case</span> <span class=\"k\">proof</span><span class=\"bp\">.</span><span class=\"n\">axm</span> <span class=\"o\">:</span> <span class=\"o\">{</span><span class=\"n\">assumption</span><span class=\"o\">},</span>\n  <span class=\"n\">case</span> <span class=\"k\">proof</span><span class=\"bp\">.</span><span class=\"n\">abs</span> <span class=\"o\">:</span> <span class=\"o\">{</span><span class=\"n\">assumption</span><span class=\"o\">},</span>\n  <span class=\"n\">case</span> <span class=\"k\">proof</span><span class=\"bp\">.</span><span class=\"n\">vac</span> <span class=\"o\">:</span> <span class=\"o\">{</span><span class=\"n\">exact</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">top</span><span class=\"o\">},</span>\n  <span class=\"n\">case</span> <span class=\"k\">proof</span><span class=\"bp\">.</span><span class=\"n\">cut</span> <span class=\"o\">:</span> <span class=\"err\">Γ</span> <span class=\"n\">P</span> <span class=\"n\">Q</span> <span class=\"n\">R</span> <span class=\"n\">prf_PQ</span> <span class=\"n\">prf_QR</span> <span class=\"n\">h₁</span> <span class=\"n\">h₂</span>\n    <span class=\"o\">{</span><span class=\"n\">exact</span> <span class=\"n\">h₂</span> <span class=\"o\">(</span><span class=\"n\">h₁</span> <span class=\"n\">wf_φ</span><span class=\"o\">)},</span>\n  <span class=\"n\">case</span> <span class=\"k\">proof</span><span class=\"bp\">.</span><span class=\"n\">and_intro</span> <span class=\"o\">:</span> <span class=\"err\">Γ</span> <span class=\"n\">p</span> <span class=\"n\">q</span> <span class=\"n\">r</span> <span class=\"n\">prf_pq</span> <span class=\"n\">prf_pr</span> <span class=\"n\">h₁</span> <span class=\"n\">h₂</span> <span class=\"n\">h₃</span>\n    <span class=\"o\">{</span><span class=\"n\">apply</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">and</span><span class=\"o\">,</span> <span class=\"n\">exact</span> <span class=\"n\">h₁</span> <span class=\"n\">h₃</span><span class=\"o\">,</span> <span class=\"n\">exact</span> <span class=\"n\">h₂</span> <span class=\"n\">h₃</span><span class=\"o\">},</span>\n  <span class=\"n\">case</span> <span class=\"k\">proof</span><span class=\"bp\">.</span><span class=\"n\">and_left</span> <span class=\"o\">:</span> <span class=\"err\">Γ</span> <span class=\"n\">p</span> <span class=\"n\">q</span> <span class=\"n\">r</span> <span class=\"n\">h₁</span> <span class=\"n\">h₂</span> <span class=\"o\">{</span><span class=\"n\">apply</span> <span class=\"n\">WF_and_left</span><span class=\"o\">,</span> <span class=\"n\">exact</span> <span class=\"n\">h₂</span> <span class=\"n\">wf_φ</span><span class=\"o\">},</span>\n  <span class=\"n\">case</span> <span class=\"k\">proof</span><span class=\"bp\">.</span><span class=\"n\">and_right</span> <span class=\"o\">:</span> <span class=\"err\">Γ</span> <span class=\"n\">p</span> <span class=\"n\">q</span> <span class=\"n\">r</span> <span class=\"n\">h₁</span> <span class=\"n\">h₂</span> <span class=\"o\">{</span><span class=\"n\">apply</span> <span class=\"n\">WF_and_right</span><span class=\"o\">,</span> <span class=\"n\">exact</span> <span class=\"n\">h₂</span> <span class=\"n\">wf_φ</span><span class=\"o\">},</span>\n  <span class=\"n\">case</span> <span class=\"k\">proof</span><span class=\"bp\">.</span><span class=\"n\">or_intro</span> <span class=\"o\">:</span> <span class=\"err\">Γ</span> <span class=\"n\">p</span> <span class=\"n\">q</span> <span class=\"n\">r</span> <span class=\"n\">prf_pr</span> <span class=\"n\">prf_qr</span> <span class=\"n\">h₁</span> <span class=\"n\">h₂</span> <span class=\"n\">h₃</span>\n    <span class=\"o\">{</span><span class=\"n\">apply</span> <span class=\"n\">h₁</span><span class=\"o\">,</span> <span class=\"n\">apply</span> <span class=\"n\">WF_or_left</span><span class=\"o\">,</span> <span class=\"n\">exact</span> <span class=\"n\">h₃</span><span class=\"o\">},</span>\n  <span class=\"n\">case</span> <span class=\"k\">proof</span><span class=\"bp\">.</span><span class=\"n\">comp</span> <span class=\"o\">:</span> <span class=\"err\">Γ</span> <span class=\"n\">p</span> <span class=\"n\">A</span> <span class=\"n\">h</span>\n    <span class=\"o\">{</span><span class=\"n\">apply</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">all</span><span class=\"o\">,</span>\n      <span class=\"n\">apply</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">and</span><span class=\"o\">,</span>\n      <span class=\"n\">apply</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">imp</span><span class=\"o\">,</span>\n      <span class=\"n\">apply</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">elem</span><span class=\"o\">,</span>\n      <span class=\"k\">show</span> <span class=\"n\">type</span><span class=\"o\">,</span> <span class=\"n\">exact</span> <span class=\"n\">A</span><span class=\"o\">,</span>\n      <span class=\"k\">show</span> <span class=\"n\">type</span><span class=\"o\">,</span> <span class=\"n\">exact</span> <span class=\"n\">A</span><span class=\"o\">,</span>\n      <span class=\"n\">apply</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">var</span><span class=\"o\">,</span>\n        <span class=\"n\">simp</span><span class=\"o\">,</span>\n      <span class=\"n\">apply</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">comp</span><span class=\"o\">,</span>\n        <span class=\"n\">assumption</span><span class=\"o\">,</span>\n      <span class=\"n\">simp</span><span class=\"o\">,</span>\n      <span class=\"n\">induction</span> <span class=\"n\">h</span><span class=\"o\">,</span>\n        <span class=\"n\">case</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">top</span> <span class=\"o\">:</span> <span class=\"o\">{</span><span class=\"n\">simp</span><span class=\"o\">,</span> <span class=\"n\">exact</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">top</span><span class=\"o\">},</span>\n        <span class=\"n\">case</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">bot</span> <span class=\"o\">:</span> <span class=\"o\">{</span><span class=\"n\">simp</span><span class=\"o\">,</span> <span class=\"n\">exact</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">bot</span><span class=\"o\">},</span>\n        <span class=\"n\">case</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">star</span> <span class=\"o\">:</span> <span class=\"o\">{</span><span class=\"n\">simp</span><span class=\"o\">,</span> <span class=\"n\">exact</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">star</span><span class=\"o\">},</span>\n        <span class=\"n\">case</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">and</span> <span class=\"o\">:</span> <span class=\"err\">Γ</span> <span class=\"n\">p</span> <span class=\"n\">q</span> <span class=\"n\">wf_p</span> <span class=\"n\">wf_q</span> <span class=\"n\">ih₁</span> <span class=\"n\">ih₂</span>\n          <span class=\"o\">{</span><span class=\"n\">simp</span><span class=\"o\">,</span> <span class=\"n\">apply</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">and</span><span class=\"o\">,</span> <span class=\"n\">exact</span> <span class=\"n\">ih₁</span> <span class=\"n\">wf_φ</span><span class=\"o\">,</span> <span class=\"n\">exact</span> <span class=\"n\">ih₂</span> <span class=\"n\">wf_φ</span><span class=\"o\">},</span>\n        <span class=\"n\">case</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">or</span> <span class=\"o\">:</span> <span class=\"err\">Γ</span> <span class=\"n\">p</span> <span class=\"n\">q</span> <span class=\"n\">wf_p</span> <span class=\"n\">wf_q</span> <span class=\"n\">ih₁</span> <span class=\"n\">ih₂</span>\n          <span class=\"o\">{</span><span class=\"n\">simp</span><span class=\"o\">,</span> <span class=\"n\">apply</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">or</span><span class=\"o\">,</span> <span class=\"n\">exact</span> <span class=\"n\">ih₁</span> <span class=\"n\">wf_φ</span><span class=\"o\">,</span> <span class=\"n\">exact</span> <span class=\"n\">ih₂</span> <span class=\"n\">wf_φ</span><span class=\"o\">},</span>\n        <span class=\"n\">case</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">imp</span> <span class=\"o\">:</span> <span class=\"err\">Γ</span> <span class=\"n\">p</span> <span class=\"n\">q</span> <span class=\"n\">wf_p</span> <span class=\"n\">wf_q</span> <span class=\"n\">ih₁</span> <span class=\"n\">ih₂</span>\n          <span class=\"o\">{</span><span class=\"n\">simp</span><span class=\"o\">,</span> <span class=\"n\">apply</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">imp</span><span class=\"o\">,</span> <span class=\"n\">exact</span> <span class=\"n\">ih₁</span> <span class=\"n\">wf_φ</span><span class=\"o\">,</span> <span class=\"n\">exact</span> <span class=\"n\">ih₂</span> <span class=\"n\">wf_φ</span><span class=\"o\">},</span>\n        <span class=\"n\">case</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">var</span> <span class=\"o\">:</span> <span class=\"err\">Γ</span> <span class=\"n\">n</span> <span class=\"n\">A</span> <span class=\"n\">h₁</span> <span class=\"o\">{</span><span class=\"n\">simp</span><span class=\"o\">,</span> <span class=\"n\">split_ifs</span> <span class=\"k\">with</span> <span class=\"n\">h₂</span><span class=\"o\">,</span> <span class=\"n\">apply</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">var</span><span class=\"o\">,</span> <span class=\"n\">simp</span><span class=\"o\">,</span> <span class=\"n\">sorry</span><span class=\"o\">,</span> <span class=\"n\">sorry</span><span class=\"o\">},</span>\n        <span class=\"n\">repeat</span> <span class=\"o\">{</span><span class=\"n\">sorry</span><span class=\"o\">},</span>\n    <span class=\"o\">},</span>\n  <span class=\"n\">repeat</span> <span class=\"o\">{</span><span class=\"n\">sorry</span><span class=\"o\">},</span>\n<span class=\"kn\">end</span>\n</code></pre></div>",
        "id": 198402030,
        "sender_full_name": "Billy Price",
        "timestamp": 1590116516
    },
    {
        "content": "<p>can you make that a <a href=\"https://github.com/leanprover-community/mathlib/wiki/Minimum-Working-Example-&#40;MWE&#41;\">#mwe</a>?</p>",
        "id": 198402144,
        "sender_full_name": "Jalex Stark",
        "timestamp": 1590116702
    },
    {
        "content": "<p>(I'm not asking you to remove anything, just add imports and definitions so that if I copy-paste it into my VSCode it compiles)</p>",
        "id": 198402176,
        "sender_full_name": "Jalex Stark",
        "timestamp": 1590116738
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"255481\">Billy Price</span> <a href=\"#narrow/stream/236446-Type-theory/topic/Modelling.20a.20Type.20Theory.20in.20Lean/near/198402030\">said</a>:</p>\n<blockquote>\n<p>Also with those tactics - I'm finding that whenever I apply cases or induction, Lean comes up with really ugly local-context names for each case, and I need to manually name up to 10 things manually so they have sensible names.</p>\n</blockquote>\n<p>I'm currently working on an alternative <code>induction</code> tactic that would hopefully give you better names (among other things). It's not quite ready yet though. For now, manual renaming is your best option.</p>\n<p>In general, your proof looks okay to me. You could probably automate/prettify some of this stuff, but that's a rabbit hole and a half. I'd recommend you just slog through it; these sorts of proofs are always lengthy.</p>",
        "id": 198402550,
        "sender_full_name": "Jannis Limperg",
        "timestamp": 1590117249
    },
    {
        "content": "<p>in this part</p>\n<div class=\"codehilite\"><pre><span></span><code>  <span class=\"n\">case</span> <span class=\"k\">proof</span><span class=\"bp\">.</span><span class=\"n\">cut</span> <span class=\"o\">:</span> <span class=\"err\">Γ</span> <span class=\"n\">P</span> <span class=\"n\">Q</span> <span class=\"n\">R</span> <span class=\"n\">prf_PQ</span> <span class=\"n\">prf_QR</span> <span class=\"n\">h₁</span> <span class=\"n\">h₂</span>\n    <span class=\"o\">{</span><span class=\"n\">exact</span> <span class=\"n\">h₂</span> <span class=\"o\">(</span><span class=\"n\">h₁</span> <span class=\"n\">wf_φ</span><span class=\"o\">)},</span>\n</code></pre></div>\n\n\n<p>does it instead work to write the following? (I could answer this question myself if i had a mwe)</p>\n<div class=\"codehilite\"><pre><span></span><code>  <span class=\"n\">case</span> <span class=\"k\">proof</span><span class=\"bp\">.</span><span class=\"n\">cut</span> <span class=\"o\">:</span> <span class=\"bp\">_</span> <span class=\"bp\">_</span> <span class=\"bp\">_</span> <span class=\"bp\">_</span> <span class=\"bp\">_</span> <span class=\"bp\">_</span> <span class=\"n\">h₁</span> <span class=\"n\">h₂</span>\n    <span class=\"o\">{</span><span class=\"n\">exact</span> <span class=\"n\">h₂</span> <span class=\"o\">(</span><span class=\"n\">h₁</span> <span class=\"n\">wf_φ</span><span class=\"o\">)},</span>\n</code></pre></div>",
        "id": 198402660,
        "sender_full_name": "Jalex Stark",
        "timestamp": 1590117450
    },
    {
        "content": "<p>Only issue is the mwe is pretty large. I'll attach the file for now - basically everything is needed.</p>\n<p><a href=\"/user_uploads/3121/nVDisP0SERw2ocpHxljnmtSx/TL_zulip.lean\">TL_zulip.lean</a></p>",
        "id": 198402726,
        "sender_full_name": "Billy Price",
        "timestamp": 1590117560
    },
    {
        "content": "<p>why not paste it into a message?</p>",
        "id": 198402782,
        "sender_full_name": "Jalex Stark",
        "timestamp": 1590117620
    },
    {
        "content": "<p>that's probably much easier for both of us</p>",
        "id": 198402786,
        "sender_full_name": "Jalex Stark",
        "timestamp": 1590117634
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span><code><span class=\"kn\">import</span> <span class=\"n\">data</span><span class=\"bp\">.</span><span class=\"n\">finset</span>\n<span class=\"kn\">namespace</span> <span class=\"n\">TT</span>\n\n<span class=\"kn\">inductive</span> <span class=\"n\">type</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span>\n<span class=\"bp\">|</span> <span class=\"n\">One</span> <span class=\"bp\">|</span> <span class=\"n\">Omega</span> <span class=\"bp\">|</span> <span class=\"n\">Prod</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"n\">B</span> <span class=\"o\">:</span> <span class=\"n\">type</span><span class=\"o\">)</span><span class=\"bp\">|</span> <span class=\"n\">Pow</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"o\">:</span> <span class=\"n\">type</span><span class=\"o\">)</span>\n\n<span class=\"kn\">notation</span> <span class=\"bp\">`</span><span class=\"err\">Ω</span><span class=\"bp\">`</span> <span class=\"o\">:=</span> <span class=\"n\">type</span><span class=\"bp\">.</span><span class=\"n\">Omega</span>\n<span class=\"kn\">notation</span> <span class=\"bp\">`</span><span class=\"mi\">𝟙</span><span class=\"bp\">`</span> <span class=\"o\">:=</span> <span class=\"n\">type</span><span class=\"bp\">.</span><span class=\"n\">One</span>\n<span class=\"kn\">infix</span> <span class=\"bp\">`××`</span><span class=\"o\">:</span><span class=\"n\">max</span> <span class=\"o\">:=</span> <span class=\"n\">type</span><span class=\"bp\">.</span><span class=\"n\">Prod</span>\n<span class=\"kn\">prefix</span> <span class=\"err\">𝒫</span> <span class=\"o\">:</span><span class=\"n\">max</span> <span class=\"o\">:=</span> <span class=\"n\">type</span><span class=\"bp\">.</span><span class=\"n\">Pow</span>\n\n<span class=\"n\">def</span> <span class=\"kn\">context</span> <span class=\"o\">:=</span> <span class=\"n\">list</span> <span class=\"n\">type</span>\n\n<span class=\"kn\">inductive</span> <span class=\"n\">term</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span>\n<span class=\"bp\">|</span> <span class=\"n\">star</span> <span class=\"o\">:</span> <span class=\"n\">term</span>\n<span class=\"bp\">|</span> <span class=\"n\">top</span>  <span class=\"o\">:</span> <span class=\"n\">term</span>\n<span class=\"bp\">|</span> <span class=\"n\">bot</span>  <span class=\"o\">:</span> <span class=\"n\">term</span>\n<span class=\"bp\">|</span> <span class=\"n\">and</span>  <span class=\"o\">:</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">term</span>\n<span class=\"bp\">|</span> <span class=\"n\">or</span>   <span class=\"o\">:</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">term</span>\n<span class=\"bp\">|</span> <span class=\"n\">imp</span>  <span class=\"o\">:</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">term</span>\n<span class=\"bp\">|</span> <span class=\"n\">var</span>  <span class=\"o\">:</span> <span class=\"bp\">ℕ</span> <span class=\"bp\">→</span> <span class=\"n\">term</span>\n<span class=\"bp\">|</span> <span class=\"n\">comp</span> <span class=\"o\">:</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">term</span>\n<span class=\"bp\">|</span> <span class=\"n\">all</span>  <span class=\"o\">:</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">term</span>\n<span class=\"bp\">|</span> <span class=\"n\">ex</span>   <span class=\"o\">:</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">term</span>\n<span class=\"bp\">|</span> <span class=\"n\">elem</span> <span class=\"o\">:</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">term</span>\n<span class=\"bp\">|</span> <span class=\"n\">prod</span> <span class=\"o\">:</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">term</span>\n\n<span class=\"kn\">open</span> <span class=\"n\">term</span>\n\n\n\n<span class=\"c1\">-- * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *</span>\n<span class=\"c1\">-- Notation and derived operators</span>\n<span class=\"c1\">-- * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *</span>\n\n<span class=\"kn\">notation</span> <span class=\"bp\">`&lt;</span><span class=\"mi\">0</span><span class=\"bp\">&gt;`</span> <span class=\"o\">:=</span> <span class=\"n\">var</span> <span class=\"mi\">0</span>\n<span class=\"kn\">notation</span> <span class=\"bp\">`&lt;</span><span class=\"mi\">1</span><span class=\"bp\">&gt;`</span> <span class=\"o\">:=</span> <span class=\"n\">var</span> <span class=\"mi\">1</span>\n<span class=\"kn\">notation</span> <span class=\"bp\">`&lt;</span><span class=\"mi\">2</span><span class=\"bp\">&gt;`</span> <span class=\"o\">:=</span> <span class=\"n\">var</span> <span class=\"mi\">2</span>\n<span class=\"kn\">notation</span> <span class=\"bp\">`&lt;</span><span class=\"mi\">3</span><span class=\"bp\">&gt;`</span> <span class=\"o\">:=</span> <span class=\"n\">var</span> <span class=\"mi\">3</span>\n<span class=\"kn\">notation</span> <span class=\"bp\">`&lt;</span><span class=\"mi\">4</span><span class=\"bp\">&gt;`</span> <span class=\"o\">:=</span> <span class=\"n\">var</span> <span class=\"mi\">4</span>\n<span class=\"kn\">notation</span> <span class=\"bp\">`&lt;</span><span class=\"mi\">5</span><span class=\"bp\">&gt;`</span> <span class=\"o\">:=</span> <span class=\"n\">var</span> <span class=\"mi\">5</span>\n<span class=\"kn\">notation</span> <span class=\"bp\">`&lt;</span><span class=\"mi\">6</span><span class=\"bp\">&gt;`</span> <span class=\"o\">:=</span> <span class=\"n\">var</span> <span class=\"mi\">6</span>\n<span class=\"kn\">notation</span> <span class=\"bp\">`&lt;</span><span class=\"mi\">7</span><span class=\"bp\">&gt;`</span> <span class=\"o\">:=</span> <span class=\"n\">var</span> <span class=\"mi\">7</span>\n<span class=\"kn\">notation</span> <span class=\"bp\">`&lt;</span><span class=\"mi\">8</span><span class=\"bp\">&gt;`</span> <span class=\"o\">:=</span> <span class=\"n\">var</span> <span class=\"mi\">8</span>\n<span class=\"kn\">notation</span> <span class=\"bp\">`&lt;</span><span class=\"mi\">9</span><span class=\"bp\">&gt;`</span> <span class=\"o\">:=</span> <span class=\"n\">var</span> <span class=\"mi\">9</span>\n\n<span class=\"kn\">notation</span> <span class=\"bp\">`</span><span class=\"err\">⁎</span><span class=\"bp\">`</span> <span class=\"o\">:=</span> <span class=\"n\">star</span>    <span class=\"c1\">-- input \\asterisk</span>\n<span class=\"kn\">notation</span> <span class=\"bp\">`</span><span class=\"err\">⊤</span><span class=\"bp\">`</span> <span class=\"o\">:=</span> <span class=\"n\">top</span>     <span class=\"c1\">--       \\top</span>\n<span class=\"kn\">notation</span> <span class=\"bp\">`</span><span class=\"err\">⊥</span><span class=\"bp\">`</span> <span class=\"o\">:=</span> <span class=\"n\">bot</span>     <span class=\"c1\">-- input \\bot</span>\n<span class=\"kn\">infixr</span> <span class=\"bp\">`</span> <span class=\"err\">⟹</span> <span class=\"bp\">`</span><span class=\"o\">:</span><span class=\"mi\">60</span> <span class=\"o\">:=</span> <span class=\"n\">imp</span> <span class=\"c1\">-- input \\==&gt;</span>\n<span class=\"kn\">infixr</span> <span class=\"bp\">`</span> <span class=\"err\">⋀</span> <span class=\"bp\">`</span> <span class=\"o\">:</span><span class=\"mi\">70</span> <span class=\"o\">:=</span> <span class=\"n\">and</span> <span class=\"c1\">-- input \\And or \\bigwedge</span>\n<span class=\"kn\">infixr</span> <span class=\"bp\">`</span> <span class=\"err\">⋁</span> <span class=\"bp\">`</span> <span class=\"o\">:</span><span class=\"mi\">59</span> <span class=\"o\">:=</span> <span class=\"n\">or</span>  <span class=\"c1\">-- input \\Or or \\bigvee</span>\n\n<span class=\"n\">def</span> <span class=\"n\">not</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"o\">:</span> <span class=\"n\">term</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"n\">p</span> <span class=\"err\">⟹</span> <span class=\"err\">⊥</span>\n<span class=\"kn\">prefix</span> <span class=\"bp\">`</span><span class=\"err\">∼</span><span class=\"bp\">`</span><span class=\"o\">:</span><span class=\"n\">max</span> <span class=\"o\">:=</span> <span class=\"n\">not</span> <span class=\"c1\">-- input \\~, the ASCII character ~ has too low precedence</span>\n\n<span class=\"n\">def</span> <span class=\"n\">biimp</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"n\">q</span><span class=\"o\">:</span> <span class=\"n\">term</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"err\">⟹</span> <span class=\"n\">q</span><span class=\"o\">)</span> <span class=\"err\">⋀</span> <span class=\"o\">(</span><span class=\"n\">q</span> <span class=\"err\">⟹</span> <span class=\"n\">p</span><span class=\"o\">)</span>\n<span class=\"kn\">infix</span> <span class=\"bp\">`</span> <span class=\"err\">⇔</span> <span class=\"bp\">`</span><span class=\"o\">:</span><span class=\"mi\">60</span> <span class=\"o\">:=</span> <span class=\"n\">biimp</span> <span class=\"c1\">-- input \\&lt;=&gt;</span>\n\n<span class=\"kn\">infix</span> <span class=\"err\">∈</span> <span class=\"o\">:=</span> <span class=\"n\">elem</span>\n<span class=\"kn\">infix</span> <span class=\"err\">∉</span> <span class=\"o\">:=</span> <span class=\"bp\">λ</span> <span class=\"n\">a</span><span class=\"o\">,</span> <span class=\"bp\">λ</span> <span class=\"n\">α</span><span class=\"o\">,</span> <span class=\"n\">not</span> <span class=\"o\">(</span><span class=\"n\">elem</span> <span class=\"n\">a</span> <span class=\"n\">α</span><span class=\"o\">)</span>\n<span class=\"kn\">notation</span> <span class=\"bp\">`</span><span class=\"err\">⟦</span><span class=\"bp\">`</span> <span class=\"n\">φ</span> <span class=\"bp\">`</span><span class=\"err\">⟧</span><span class=\"bp\">`</span> <span class=\"o\">:=</span> <span class=\"n\">comp</span> <span class=\"n\">φ</span>\n\n<span class=\"kn\">prefix</span> <span class=\"bp\">`∀</span><span class=\"err\">&#39;</span><span class=\"bp\">`</span><span class=\"o\">:</span><span class=\"mi\">1</span> <span class=\"o\">:=</span> <span class=\"n\">all</span>\n<span class=\"kn\">prefix</span> <span class=\"bp\">`∃</span><span class=\"err\">&#39;</span><span class=\"bp\">`</span><span class=\"o\">:</span><span class=\"mi\">2</span> <span class=\"o\">:=</span> <span class=\"n\">ex</span>\n\n<span class=\"n\">def</span> <span class=\"n\">eq</span> <span class=\"o\">(</span><span class=\"n\">a</span> <span class=\"o\">:</span> <span class=\"n\">term</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">a&#39;</span> <span class=\"o\">:</span> <span class=\"n\">term</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">term</span> <span class=\"o\">:=</span> <span class=\"bp\">∀</span><span class=\"err\">&#39;</span> <span class=\"o\">(</span><span class=\"n\">a</span> <span class=\"err\">∈</span> <span class=\"bp\">&lt;</span><span class=\"mi\">0</span><span class=\"bp\">&gt;</span><span class=\"o\">)</span> <span class=\"err\">⇔</span> <span class=\"o\">(</span><span class=\"n\">a&#39;</span> <span class=\"err\">∈</span> <span class=\"bp\">&lt;</span><span class=\"mi\">0</span><span class=\"bp\">&gt;</span><span class=\"o\">)</span>\n<span class=\"kn\">infix</span> <span class=\"bp\">`</span><span class=\"err\">≃</span><span class=\"bp\">`</span> <span class=\"o\">:</span><span class=\"mi\">50</span> <span class=\"o\">:=</span> <span class=\"n\">eq</span>\n\n<span class=\"n\">def</span> <span class=\"n\">singleton</span> <span class=\"o\">(</span><span class=\"n\">a</span> <span class=\"o\">:</span> <span class=\"n\">term</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"err\">⟦</span><span class=\"n\">a</span> <span class=\"err\">≃</span> <span class=\"o\">(</span><span class=\"bp\">&lt;</span><span class=\"mi\">0</span><span class=\"bp\">&gt;</span><span class=\"o\">)</span><span class=\"err\">⟧</span>\n\n<span class=\"n\">def</span> <span class=\"n\">ex_unique</span> <span class=\"o\">(</span><span class=\"n\">φ</span> <span class=\"o\">:</span> <span class=\"n\">term</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">term</span> <span class=\"o\">:=</span>\n  <span class=\"bp\">∃</span><span class=\"err\">&#39;</span> <span class=\"err\">⟦</span><span class=\"n\">φ</span><span class=\"err\">⟧</span> <span class=\"err\">≃</span> <span class=\"n\">singleton</span> <span class=\"o\">(</span><span class=\"bp\">&lt;</span><span class=\"mi\">3</span><span class=\"bp\">&gt;</span><span class=\"o\">)</span>\n<span class=\"kn\">prefix</span> <span class=\"bp\">`∃!</span><span class=\"err\">&#39;</span><span class=\"bp\">`</span><span class=\"o\">:</span><span class=\"mi\">2</span> <span class=\"o\">:=</span> <span class=\"n\">ex_unique</span>\n\n<span class=\"n\">def</span> <span class=\"n\">subseteq</span> <span class=\"o\">(</span><span class=\"n\">α</span> <span class=\"o\">:</span> <span class=\"n\">term</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">β</span> <span class=\"o\">:</span> <span class=\"n\">term</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">term</span> <span class=\"o\">:=</span>\n  <span class=\"bp\">∀</span><span class=\"err\">&#39;</span> <span class=\"o\">(</span><span class=\"bp\">&lt;</span><span class=\"mi\">0</span><span class=\"bp\">&gt;</span> <span class=\"err\">∈</span> <span class=\"n\">α</span><span class=\"o\">)</span> <span class=\"err\">⟹</span> <span class=\"o\">(</span><span class=\"bp\">&lt;</span><span class=\"mi\">0</span><span class=\"bp\">&gt;</span> <span class=\"err\">∈</span> <span class=\"n\">β</span><span class=\"o\">)</span>\n<span class=\"kn\">infix</span> <span class=\"err\">⊆</span> <span class=\"o\">:=</span> <span class=\"n\">subseteq</span>\n\n<span class=\"c1\">-- * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *</span>\n\n<span class=\"kn\">inductive</span> <span class=\"n\">WF</span> <span class=\"o\">:</span> <span class=\"kn\">context</span> <span class=\"bp\">→</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">type</span> <span class=\"bp\">→</span> <span class=\"kt\">Prop</span>\n<span class=\"bp\">|</span> <span class=\"n\">star</span> <span class=\"o\">{</span><span class=\"err\">Γ</span><span class=\"o\">}</span>         <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"n\">term</span><span class=\"bp\">.</span><span class=\"n\">star</span> <span class=\"mi\">𝟙</span>\n<span class=\"bp\">|</span> <span class=\"n\">top</span>  <span class=\"o\">{</span><span class=\"err\">Γ</span><span class=\"o\">}</span>         <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"n\">term</span><span class=\"bp\">.</span><span class=\"n\">top</span> <span class=\"err\">Ω</span>\n<span class=\"bp\">|</span> <span class=\"n\">bot</span>  <span class=\"o\">{</span><span class=\"err\">Γ</span><span class=\"o\">}</span>         <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"n\">term</span><span class=\"bp\">.</span><span class=\"n\">bot</span> <span class=\"err\">Ω</span>\n<span class=\"bp\">|</span> <span class=\"n\">and</span>  <span class=\"o\">{</span><span class=\"err\">Γ</span> <span class=\"n\">p</span> <span class=\"n\">q</span><span class=\"o\">}</span>     <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"n\">p</span> <span class=\"err\">Ω</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"n\">q</span> <span class=\"err\">Ω</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"err\">⋀</span> <span class=\"n\">q</span><span class=\"o\">)</span> <span class=\"err\">Ω</span>\n<span class=\"bp\">|</span> <span class=\"n\">or</span>   <span class=\"o\">{</span><span class=\"err\">Γ</span> <span class=\"n\">p</span> <span class=\"n\">q</span><span class=\"o\">}</span>     <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"n\">p</span> <span class=\"err\">Ω</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"n\">q</span> <span class=\"err\">Ω</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"err\">⋁</span> <span class=\"n\">q</span><span class=\"o\">)</span> <span class=\"err\">Ω</span>\n<span class=\"bp\">|</span> <span class=\"n\">imp</span>  <span class=\"o\">{</span><span class=\"err\">Γ</span> <span class=\"n\">p</span> <span class=\"n\">q</span><span class=\"o\">}</span>     <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"n\">p</span> <span class=\"err\">Ω</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"n\">q</span> <span class=\"err\">Ω</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"err\">⟹</span> <span class=\"n\">q</span><span class=\"o\">)</span> <span class=\"err\">Ω</span>\n<span class=\"bp\">|</span> <span class=\"n\">var</span>  <span class=\"o\">{</span><span class=\"err\">Γ</span> <span class=\"n\">n</span> <span class=\"n\">A</span><span class=\"o\">}</span>     <span class=\"o\">:</span> <span class=\"n\">list</span><span class=\"bp\">.</span><span class=\"n\">nth</span> <span class=\"err\">Γ</span> <span class=\"n\">n</span> <span class=\"bp\">=</span> <span class=\"n\">some</span> <span class=\"n\">A</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"o\">(</span><span class=\"n\">var</span> <span class=\"n\">n</span><span class=\"o\">)</span> <span class=\"n\">A</span>\n<span class=\"bp\">|</span> <span class=\"n\">comp</span> <span class=\"o\">{</span><span class=\"err\">Γ</span> <span class=\"n\">φ</span> <span class=\"n\">A</span><span class=\"o\">}</span>     <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"o\">(</span><span class=\"n\">A</span><span class=\"bp\">::</span><span class=\"err\">Γ</span><span class=\"o\">)</span> <span class=\"n\">φ</span> <span class=\"err\">Ω</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">⟦</span><span class=\"n\">φ</span><span class=\"err\">⟧</span> <span class=\"o\">(</span><span class=\"err\">𝒫</span> <span class=\"n\">A</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"n\">all</span>  <span class=\"o\">{</span><span class=\"err\">Γ</span> <span class=\"n\">φ</span> <span class=\"n\">A</span><span class=\"o\">}</span>     <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"o\">(</span><span class=\"n\">A</span><span class=\"bp\">::</span><span class=\"err\">Γ</span><span class=\"o\">)</span> <span class=\"n\">φ</span> <span class=\"err\">Ω</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"o\">(</span><span class=\"bp\">∀</span><span class=\"err\">&#39;</span> <span class=\"n\">φ</span><span class=\"o\">)</span> <span class=\"err\">Ω</span>\n<span class=\"bp\">|</span> <span class=\"n\">ex</span>   <span class=\"o\">{</span><span class=\"err\">Γ</span> <span class=\"n\">φ</span> <span class=\"n\">A</span><span class=\"o\">}</span>     <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"o\">(</span><span class=\"n\">A</span><span class=\"bp\">::</span><span class=\"err\">Γ</span><span class=\"o\">)</span> <span class=\"n\">φ</span> <span class=\"err\">Ω</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"o\">(</span><span class=\"bp\">∃</span><span class=\"err\">&#39;</span> <span class=\"n\">φ</span><span class=\"o\">)</span> <span class=\"err\">Ω</span>\n<span class=\"bp\">|</span> <span class=\"n\">elem</span> <span class=\"o\">{</span><span class=\"err\">Γ</span> <span class=\"n\">a</span> <span class=\"n\">α</span> <span class=\"n\">A</span><span class=\"o\">}</span>   <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"n\">a</span> <span class=\"n\">A</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"n\">α</span> <span class=\"o\">(</span><span class=\"err\">𝒫</span> <span class=\"n\">A</span><span class=\"o\">)</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"o\">(</span><span class=\"n\">a</span> <span class=\"err\">∈</span> <span class=\"n\">α</span><span class=\"o\">)</span> <span class=\"err\">Ω</span>\n<span class=\"bp\">|</span> <span class=\"n\">prod</span> <span class=\"o\">{</span><span class=\"err\">Γ</span> <span class=\"n\">a</span> <span class=\"n\">b</span> <span class=\"n\">A</span> <span class=\"n\">B</span><span class=\"o\">}</span> <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"n\">a</span> <span class=\"n\">A</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"n\">b</span> <span class=\"n\">B</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"o\">(</span><span class=\"n\">prod</span> <span class=\"n\">a</span> <span class=\"n\">b</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"bp\">××</span> <span class=\"n\">B</span><span class=\"o\">)</span>\n\n<span class=\"kn\">variable</span> <span class=\"err\">Γ</span> <span class=\"o\">:</span> <span class=\"kn\">context</span>\n<span class=\"kn\">variables</span> <span class=\"n\">p</span> <span class=\"n\">q</span> <span class=\"n\">r</span> <span class=\"n\">φ</span> <span class=\"n\">a</span> <span class=\"n\">b</span> <span class=\"n\">α</span> <span class=\"o\">:</span> <span class=\"n\">term</span>\n<span class=\"kn\">variables</span> <span class=\"n\">A</span> <span class=\"n\">B</span> <span class=\"o\">:</span> <span class=\"n\">type</span>\n\n<span class=\"kn\">lemma</span> <span class=\"n\">WF_and_left</span>   <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"err\">⋀</span> <span class=\"n\">q</span><span class=\"o\">)</span> <span class=\"err\">Ω</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"n\">p</span> <span class=\"err\">Ω</span> <span class=\"o\">:=</span> <span class=\"k\">by</span> <span class=\"o\">{</span><span class=\"n\">intro</span> <span class=\"n\">h</span><span class=\"o\">,</span> <span class=\"n\">cases</span> <span class=\"n\">h</span><span class=\"o\">,</span> <span class=\"n\">assumption</span><span class=\"o\">}</span>\n<span class=\"kn\">lemma</span> <span class=\"n\">WF_and_right</span>  <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"err\">⋀</span> <span class=\"n\">q</span><span class=\"o\">)</span> <span class=\"err\">Ω</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"n\">q</span> <span class=\"err\">Ω</span> <span class=\"o\">:=</span> <span class=\"k\">by</span> <span class=\"o\">{</span><span class=\"n\">intro</span> <span class=\"n\">h</span><span class=\"o\">,</span> <span class=\"n\">cases</span> <span class=\"n\">h</span><span class=\"o\">,</span> <span class=\"n\">assumption</span><span class=\"o\">}</span>\n<span class=\"kn\">lemma</span> <span class=\"n\">WF_or_left</span>    <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"err\">⋁</span> <span class=\"n\">q</span><span class=\"o\">)</span> <span class=\"err\">Ω</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"n\">p</span> <span class=\"err\">Ω</span> <span class=\"o\">:=</span> <span class=\"k\">by</span> <span class=\"o\">{</span><span class=\"n\">intro</span> <span class=\"n\">h</span><span class=\"o\">,</span> <span class=\"n\">cases</span> <span class=\"n\">h</span><span class=\"o\">,</span> <span class=\"n\">assumption</span><span class=\"o\">}</span>\n<span class=\"kn\">lemma</span> <span class=\"n\">WF_or_right</span>   <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"err\">⋁</span> <span class=\"n\">q</span><span class=\"o\">)</span> <span class=\"err\">Ω</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"n\">q</span> <span class=\"err\">Ω</span> <span class=\"o\">:=</span> <span class=\"k\">by</span> <span class=\"o\">{</span><span class=\"n\">intro</span> <span class=\"n\">h</span><span class=\"o\">,</span> <span class=\"n\">cases</span> <span class=\"n\">h</span><span class=\"o\">,</span> <span class=\"n\">assumption</span><span class=\"o\">}</span>\n<span class=\"kn\">lemma</span> <span class=\"n\">WF_imp_left</span>   <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"err\">⟹</span> <span class=\"n\">q</span><span class=\"o\">)</span> <span class=\"err\">Ω</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"n\">p</span> <span class=\"err\">Ω</span> <span class=\"o\">:=</span> <span class=\"k\">by</span> <span class=\"o\">{</span><span class=\"n\">intro</span> <span class=\"n\">h</span><span class=\"o\">,</span> <span class=\"n\">cases</span> <span class=\"n\">h</span><span class=\"o\">,</span> <span class=\"n\">assumption</span><span class=\"o\">}</span>\n<span class=\"kn\">lemma</span> <span class=\"n\">WF_imp_right</span>  <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"err\">⟹</span> <span class=\"n\">q</span><span class=\"o\">)</span> <span class=\"err\">Ω</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"n\">q</span> <span class=\"err\">Ω</span> <span class=\"o\">:=</span> <span class=\"k\">by</span> <span class=\"o\">{</span><span class=\"n\">intro</span> <span class=\"n\">h</span><span class=\"o\">,</span> <span class=\"n\">cases</span> <span class=\"n\">h</span><span class=\"o\">,</span> <span class=\"n\">assumption</span><span class=\"o\">}</span>\n<span class=\"kn\">lemma</span> <span class=\"n\">WF_prod_left</span>  <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"o\">(</span><span class=\"n\">prod</span> <span class=\"n\">a</span> <span class=\"n\">b</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"bp\">××</span> <span class=\"n\">B</span><span class=\"o\">)</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"n\">a</span> <span class=\"n\">A</span> <span class=\"o\">:=</span> <span class=\"k\">by</span> <span class=\"o\">{</span><span class=\"n\">intro</span> <span class=\"n\">h</span><span class=\"o\">,</span> <span class=\"n\">cases</span> <span class=\"n\">h</span><span class=\"o\">,</span> <span class=\"n\">assumption</span><span class=\"o\">}</span>\n<span class=\"kn\">lemma</span> <span class=\"n\">WF_prod_right</span> <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"o\">(</span><span class=\"n\">prod</span> <span class=\"n\">a</span> <span class=\"n\">b</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"bp\">××</span> <span class=\"n\">B</span><span class=\"o\">)</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"n\">b</span> <span class=\"n\">B</span> <span class=\"o\">:=</span> <span class=\"k\">by</span> <span class=\"o\">{</span><span class=\"n\">intro</span> <span class=\"n\">h</span><span class=\"o\">,</span> <span class=\"n\">cases</span> <span class=\"n\">h</span><span class=\"o\">,</span> <span class=\"n\">assumption</span><span class=\"o\">}</span>\n<span class=\"kn\">lemma</span> <span class=\"n\">WF_comp_elim</span>  <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"o\">(</span><span class=\"err\">⟦</span><span class=\"n\">φ</span><span class=\"err\">⟧</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"err\">𝒫</span> <span class=\"n\">A</span><span class=\"o\">)</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"o\">(</span><span class=\"n\">A</span><span class=\"bp\">::</span><span class=\"err\">Γ</span><span class=\"o\">)</span> <span class=\"n\">φ</span> <span class=\"err\">Ω</span> <span class=\"o\">:=</span> <span class=\"k\">by</span> <span class=\"o\">{</span><span class=\"n\">intro</span> <span class=\"n\">h</span><span class=\"o\">,</span> <span class=\"n\">cases</span> <span class=\"n\">h</span><span class=\"o\">,</span> <span class=\"n\">assumption</span><span class=\"o\">}</span>\n<span class=\"kn\">lemma</span> <span class=\"n\">WF_all_elim</span>   <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"o\">(</span><span class=\"bp\">∀</span><span class=\"err\">&#39;</span> <span class=\"n\">φ</span><span class=\"o\">)</span> <span class=\"err\">Ω</span> <span class=\"bp\">→</span> <span class=\"bp\">∃</span> <span class=\"n\">A</span><span class=\"o\">:</span><span class=\"n\">type</span><span class=\"o\">,</span> <span class=\"n\">WF</span> <span class=\"o\">(</span><span class=\"n\">A</span><span class=\"bp\">::</span><span class=\"err\">Γ</span><span class=\"o\">)</span> <span class=\"n\">φ</span> <span class=\"err\">Ω</span> <span class=\"o\">:=</span> <span class=\"k\">by</span> <span class=\"o\">{</span><span class=\"n\">intro</span> <span class=\"n\">h</span><span class=\"o\">,</span> <span class=\"n\">cases</span> <span class=\"n\">h</span><span class=\"o\">,</span> <span class=\"n\">constructor</span><span class=\"o\">,</span> <span class=\"n\">assumption</span><span class=\"o\">}</span>\n<span class=\"kn\">lemma</span> <span class=\"n\">WF_ex_elim</span>    <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"o\">(</span><span class=\"bp\">∀</span><span class=\"err\">&#39;</span> <span class=\"n\">φ</span><span class=\"o\">)</span> <span class=\"err\">Ω</span> <span class=\"bp\">→</span> <span class=\"bp\">∃</span> <span class=\"n\">A</span><span class=\"o\">:</span><span class=\"n\">type</span><span class=\"o\">,</span> <span class=\"n\">WF</span> <span class=\"o\">(</span><span class=\"n\">A</span><span class=\"bp\">::</span><span class=\"err\">Γ</span><span class=\"o\">)</span> <span class=\"n\">φ</span> <span class=\"err\">Ω</span> <span class=\"o\">:=</span> <span class=\"k\">by</span> <span class=\"o\">{</span><span class=\"n\">intro</span> <span class=\"n\">h</span><span class=\"o\">,</span> <span class=\"n\">cases</span> <span class=\"n\">h</span><span class=\"o\">,</span> <span class=\"n\">constructor</span><span class=\"o\">,</span> <span class=\"n\">assumption</span><span class=\"o\">}</span>\n\n<span class=\"n\">def</span> <span class=\"n\">lift</span> <span class=\"o\">(</span><span class=\"n\">d</span> <span class=\"o\">:</span> <span class=\"bp\">ℕ</span><span class=\"o\">):</span> <span class=\"bp\">ℕ</span> <span class=\"bp\">→</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">term</span>\n<span class=\"bp\">|</span> <span class=\"n\">k</span> <span class=\"n\">star</span>       <span class=\"o\">:=</span> <span class=\"n\">star</span>\n<span class=\"bp\">|</span> <span class=\"n\">k</span> <span class=\"n\">top</span>        <span class=\"o\">:=</span> <span class=\"n\">top</span>\n<span class=\"bp\">|</span> <span class=\"n\">k</span> <span class=\"n\">bot</span>        <span class=\"o\">:=</span> <span class=\"n\">bot</span>\n<span class=\"bp\">|</span> <span class=\"n\">k</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"err\">⋀</span> <span class=\"n\">q</span><span class=\"o\">)</span>    <span class=\"o\">:=</span> <span class=\"o\">(</span><span class=\"n\">lift</span> <span class=\"n\">k</span> <span class=\"n\">p</span><span class=\"o\">)</span> <span class=\"err\">⋀</span> <span class=\"o\">(</span><span class=\"n\">lift</span> <span class=\"n\">k</span> <span class=\"n\">q</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"n\">k</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"err\">⋁</span> <span class=\"n\">q</span><span class=\"o\">)</span>    <span class=\"o\">:=</span> <span class=\"o\">(</span><span class=\"n\">lift</span> <span class=\"n\">k</span> <span class=\"n\">p</span><span class=\"o\">)</span> <span class=\"err\">⋁</span> <span class=\"o\">(</span><span class=\"n\">lift</span> <span class=\"n\">k</span> <span class=\"n\">q</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"n\">k</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"err\">⟹</span> <span class=\"n\">q</span><span class=\"o\">)</span>    <span class=\"o\">:=</span> <span class=\"o\">(</span><span class=\"n\">lift</span> <span class=\"n\">k</span> <span class=\"n\">p</span><span class=\"o\">)</span> <span class=\"err\">⟹</span> <span class=\"o\">(</span><span class=\"n\">lift</span> <span class=\"n\">k</span> <span class=\"n\">q</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"n\">k</span> <span class=\"o\">(</span><span class=\"n\">var</span> <span class=\"n\">m</span><span class=\"o\">)</span>    <span class=\"o\">:=</span> <span class=\"k\">if</span> <span class=\"n\">m</span><span class=\"bp\">≥</span><span class=\"n\">k</span> <span class=\"k\">then</span> <span class=\"n\">var</span> <span class=\"o\">(</span><span class=\"n\">m</span><span class=\"bp\">+</span><span class=\"n\">d</span><span class=\"o\">)</span> <span class=\"k\">else</span> <span class=\"n\">var</span> <span class=\"n\">m</span>\n<span class=\"bp\">|</span> <span class=\"n\">k</span> <span class=\"err\">⟦</span><span class=\"n\">φ</span><span class=\"err\">⟧</span>         <span class=\"o\">:=</span>    <span class=\"err\">⟦</span><span class=\"n\">lift</span> <span class=\"o\">(</span><span class=\"n\">k</span><span class=\"bp\">+</span><span class=\"mi\">1</span><span class=\"o\">)</span> <span class=\"n\">φ</span><span class=\"err\">⟧</span>\n<span class=\"bp\">|</span> <span class=\"n\">k</span> <span class=\"o\">(</span><span class=\"bp\">∀</span><span class=\"err\">&#39;</span> <span class=\"n\">φ</span><span class=\"o\">)</span>     <span class=\"o\">:=</span> <span class=\"bp\">∀</span><span class=\"err\">&#39;</span> <span class=\"n\">lift</span> <span class=\"o\">(</span><span class=\"n\">k</span><span class=\"bp\">+</span><span class=\"mi\">1</span><span class=\"o\">)</span> <span class=\"n\">φ</span>\n<span class=\"bp\">|</span> <span class=\"n\">k</span> <span class=\"o\">(</span><span class=\"bp\">∃</span><span class=\"err\">&#39;</span> <span class=\"n\">φ</span><span class=\"o\">)</span>     <span class=\"o\">:=</span> <span class=\"bp\">∃</span><span class=\"err\">&#39;</span> <span class=\"n\">lift</span> <span class=\"o\">(</span><span class=\"n\">k</span><span class=\"bp\">+</span><span class=\"mi\">1</span><span class=\"o\">)</span> <span class=\"n\">φ</span>\n<span class=\"bp\">|</span> <span class=\"n\">k</span> <span class=\"o\">(</span><span class=\"n\">a</span> <span class=\"err\">∈</span> <span class=\"n\">α</span><span class=\"o\">)</span>    <span class=\"o\">:=</span> <span class=\"o\">(</span><span class=\"n\">lift</span> <span class=\"n\">k</span> <span class=\"n\">a</span><span class=\"o\">)</span> <span class=\"err\">∈</span> <span class=\"o\">(</span><span class=\"n\">lift</span> <span class=\"n\">k</span> <span class=\"n\">α</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"n\">k</span> <span class=\"o\">(</span><span class=\"n\">prod</span> <span class=\"n\">a</span> <span class=\"n\">b</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"n\">prod</span> <span class=\"o\">(</span><span class=\"n\">lift</span> <span class=\"n\">k</span> <span class=\"n\">a</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">lift</span> <span class=\"n\">k</span> <span class=\"n\">b</span><span class=\"o\">)</span>\n\n<span class=\"bp\">@</span><span class=\"o\">[</span><span class=\"n\">simp</span><span class=\"o\">]</span>\n<span class=\"n\">def</span> <span class=\"n\">subst_nth</span> <span class=\"o\">:</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"bp\">ℕ</span> <span class=\"bp\">→</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">term</span>\n<span class=\"bp\">|</span> <span class=\"n\">b</span> <span class=\"n\">n</span> <span class=\"n\">star</span>       <span class=\"o\">:=</span> <span class=\"n\">star</span>\n<span class=\"bp\">|</span> <span class=\"n\">b</span> <span class=\"n\">n</span> <span class=\"n\">top</span>        <span class=\"o\">:=</span> <span class=\"n\">top</span>\n<span class=\"bp\">|</span> <span class=\"n\">b</span> <span class=\"n\">n</span> <span class=\"n\">bot</span>        <span class=\"o\">:=</span> <span class=\"n\">bot</span>\n<span class=\"bp\">|</span> <span class=\"n\">b</span> <span class=\"n\">n</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"err\">⋀</span> <span class=\"n\">q</span><span class=\"o\">)</span>    <span class=\"o\">:=</span> <span class=\"o\">(</span><span class=\"n\">subst_nth</span> <span class=\"n\">b</span> <span class=\"n\">n</span> <span class=\"n\">p</span><span class=\"o\">)</span> <span class=\"err\">⋀</span> <span class=\"o\">(</span><span class=\"n\">subst_nth</span> <span class=\"n\">b</span> <span class=\"n\">n</span> <span class=\"n\">q</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"n\">b</span> <span class=\"n\">n</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"err\">⋁</span> <span class=\"n\">q</span><span class=\"o\">)</span>    <span class=\"o\">:=</span> <span class=\"o\">(</span><span class=\"n\">subst_nth</span> <span class=\"n\">b</span> <span class=\"n\">n</span> <span class=\"n\">p</span><span class=\"o\">)</span> <span class=\"err\">⋁</span> <span class=\"o\">(</span><span class=\"n\">subst_nth</span> <span class=\"n\">b</span> <span class=\"n\">n</span> <span class=\"n\">q</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"n\">b</span> <span class=\"n\">n</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"err\">⟹</span> <span class=\"n\">q</span><span class=\"o\">)</span>  <span class=\"o\">:=</span> <span class=\"o\">(</span><span class=\"n\">subst_nth</span> <span class=\"n\">b</span> <span class=\"n\">n</span> <span class=\"n\">p</span><span class=\"o\">)</span> <span class=\"err\">⟹</span> <span class=\"o\">(</span><span class=\"n\">subst_nth</span> <span class=\"n\">b</span> <span class=\"n\">n</span> <span class=\"n\">q</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"n\">b</span> <span class=\"n\">n</span> <span class=\"o\">(</span><span class=\"n\">var</span> <span class=\"n\">m</span><span class=\"o\">)</span>    <span class=\"o\">:=</span> <span class=\"k\">if</span> <span class=\"n\">n</span><span class=\"bp\">=</span><span class=\"n\">m</span> <span class=\"k\">then</span> <span class=\"n\">b</span> <span class=\"k\">else</span> <span class=\"n\">var</span> <span class=\"n\">m</span>\n<span class=\"bp\">|</span> <span class=\"n\">b</span> <span class=\"n\">n</span> <span class=\"err\">⟦</span><span class=\"n\">φ</span><span class=\"err\">⟧</span>        <span class=\"o\">:=</span>     <span class=\"err\">⟦</span><span class=\"n\">subst_nth</span> <span class=\"o\">(</span><span class=\"n\">lift</span> <span class=\"mi\">1</span> <span class=\"mi\">0</span> <span class=\"n\">b</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">n</span><span class=\"bp\">+</span><span class=\"mi\">1</span><span class=\"o\">)</span> <span class=\"n\">φ</span><span class=\"err\">⟧</span>\n<span class=\"bp\">|</span> <span class=\"n\">b</span> <span class=\"n\">n</span> <span class=\"o\">(</span><span class=\"bp\">∀</span><span class=\"err\">&#39;</span> <span class=\"n\">φ</span><span class=\"o\">)</span>     <span class=\"o\">:=</span> <span class=\"bp\">∀</span><span class=\"err\">&#39;</span> <span class=\"o\">(</span><span class=\"n\">subst_nth</span> <span class=\"o\">(</span><span class=\"n\">lift</span> <span class=\"mi\">1</span> <span class=\"mi\">0</span> <span class=\"n\">b</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">n</span><span class=\"bp\">+</span><span class=\"mi\">1</span><span class=\"o\">)</span> <span class=\"n\">φ</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"n\">b</span> <span class=\"n\">n</span> <span class=\"o\">(</span><span class=\"bp\">∃</span><span class=\"err\">&#39;</span> <span class=\"n\">φ</span><span class=\"o\">)</span>     <span class=\"o\">:=</span> <span class=\"bp\">∃</span><span class=\"err\">&#39;</span> <span class=\"o\">(</span><span class=\"n\">subst_nth</span> <span class=\"o\">(</span><span class=\"n\">lift</span> <span class=\"mi\">1</span> <span class=\"mi\">0</span> <span class=\"n\">b</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">n</span><span class=\"bp\">+</span><span class=\"mi\">1</span><span class=\"o\">)</span> <span class=\"n\">φ</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"n\">b</span> <span class=\"n\">n</span> <span class=\"o\">(</span><span class=\"n\">a</span> <span class=\"err\">∈</span> <span class=\"n\">α</span><span class=\"o\">)</span>    <span class=\"o\">:=</span> <span class=\"o\">(</span><span class=\"n\">subst_nth</span> <span class=\"n\">b</span> <span class=\"n\">n</span> <span class=\"n\">a</span><span class=\"o\">)</span> <span class=\"err\">∈</span> <span class=\"o\">(</span><span class=\"n\">subst_nth</span> <span class=\"n\">b</span> <span class=\"n\">n</span> <span class=\"n\">α</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"n\">b</span> <span class=\"n\">n</span> <span class=\"o\">(</span><span class=\"n\">prod</span> <span class=\"n\">a</span> <span class=\"n\">c</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"n\">prod</span> <span class=\"o\">(</span><span class=\"n\">subst_nth</span> <span class=\"n\">b</span> <span class=\"n\">n</span> <span class=\"n\">a</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">subst_nth</span> <span class=\"n\">b</span> <span class=\"n\">n</span> <span class=\"n\">c</span><span class=\"o\">)</span>\n\n<span class=\"bp\">@</span><span class=\"o\">[</span><span class=\"n\">simp</span><span class=\"o\">]</span>\n<span class=\"n\">def</span> <span class=\"n\">subst</span> <span class=\"o\">(</span><span class=\"n\">b</span><span class=\"o\">:</span><span class=\"n\">term</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"n\">subst_nth</span> <span class=\"n\">b</span> <span class=\"mi\">0</span>\n\n\n<span class=\"kn\">inductive</span> <span class=\"k\">proof</span> <span class=\"o\">:</span> <span class=\"kn\">context</span> <span class=\"bp\">→</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"kt\">Prop</span>\n<span class=\"bp\">|</span> <span class=\"n\">axm</span>        <span class=\"o\">{</span><span class=\"err\">Γ</span> <span class=\"n\">φ</span><span class=\"o\">}</span>     <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"n\">φ</span> <span class=\"err\">Ω</span> <span class=\"bp\">→</span> <span class=\"k\">proof</span> <span class=\"err\">Γ</span> <span class=\"n\">φ</span> <span class=\"n\">φ</span>\n<span class=\"bp\">|</span> <span class=\"n\">vac</span>        <span class=\"o\">{</span><span class=\"err\">Γ</span> <span class=\"n\">φ</span><span class=\"o\">}</span>     <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"n\">φ</span> <span class=\"err\">Ω</span> <span class=\"bp\">→</span> <span class=\"k\">proof</span> <span class=\"err\">Γ</span> <span class=\"n\">φ</span> <span class=\"n\">term</span><span class=\"bp\">.</span><span class=\"n\">top</span>\n<span class=\"bp\">|</span> <span class=\"n\">abs</span>        <span class=\"o\">{</span><span class=\"err\">Γ</span> <span class=\"n\">φ</span><span class=\"o\">}</span>     <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"n\">φ</span> <span class=\"err\">Ω</span> <span class=\"bp\">→</span> <span class=\"k\">proof</span> <span class=\"err\">Γ</span> <span class=\"n\">term</span><span class=\"bp\">.</span><span class=\"n\">bot</span> <span class=\"n\">φ</span>\n<span class=\"bp\">|</span> <span class=\"n\">cut</span>        <span class=\"o\">{</span><span class=\"err\">Γ</span> <span class=\"n\">φ</span> <span class=\"n\">ψ</span> <span class=\"n\">γ</span><span class=\"o\">}</span> <span class=\"o\">:</span> <span class=\"k\">proof</span> <span class=\"err\">Γ</span> <span class=\"n\">φ</span> <span class=\"n\">ψ</span> <span class=\"bp\">→</span> <span class=\"k\">proof</span> <span class=\"err\">Γ</span> <span class=\"n\">ψ</span> <span class=\"n\">γ</span> <span class=\"bp\">→</span> <span class=\"k\">proof</span> <span class=\"err\">Γ</span> <span class=\"n\">φ</span> <span class=\"n\">γ</span>\n<span class=\"bp\">|</span> <span class=\"n\">and_intro</span>  <span class=\"o\">{</span><span class=\"err\">Γ</span> <span class=\"n\">p</span> <span class=\"n\">q</span> <span class=\"n\">r</span><span class=\"o\">}</span> <span class=\"o\">:</span> <span class=\"k\">proof</span> <span class=\"err\">Γ</span> <span class=\"n\">p</span> <span class=\"n\">q</span> <span class=\"bp\">→</span> <span class=\"k\">proof</span> <span class=\"err\">Γ</span> <span class=\"n\">p</span> <span class=\"n\">r</span> <span class=\"bp\">→</span> <span class=\"k\">proof</span> <span class=\"err\">Γ</span> <span class=\"n\">p</span> <span class=\"o\">(</span><span class=\"n\">q</span> <span class=\"err\">⋀</span> <span class=\"n\">r</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"n\">and_left</span>   <span class=\"o\">{</span><span class=\"err\">Γ</span> <span class=\"n\">p</span> <span class=\"n\">q</span> <span class=\"n\">r</span><span class=\"o\">}</span> <span class=\"o\">:</span> <span class=\"k\">proof</span> <span class=\"err\">Γ</span> <span class=\"n\">p</span> <span class=\"o\">(</span><span class=\"n\">q</span> <span class=\"err\">⋀</span> <span class=\"n\">r</span><span class=\"o\">)</span> <span class=\"bp\">→</span> <span class=\"k\">proof</span> <span class=\"err\">Γ</span> <span class=\"n\">p</span> <span class=\"n\">q</span>\n<span class=\"bp\">|</span> <span class=\"n\">and_right</span>  <span class=\"o\">{</span><span class=\"err\">Γ</span> <span class=\"n\">p</span> <span class=\"n\">q</span> <span class=\"n\">r</span><span class=\"o\">}</span> <span class=\"o\">:</span> <span class=\"k\">proof</span> <span class=\"err\">Γ</span> <span class=\"n\">p</span> <span class=\"o\">(</span><span class=\"n\">q</span> <span class=\"err\">⋀</span> <span class=\"n\">r</span><span class=\"o\">)</span> <span class=\"bp\">→</span> <span class=\"k\">proof</span> <span class=\"err\">Γ</span> <span class=\"n\">p</span> <span class=\"n\">r</span>\n<span class=\"bp\">|</span> <span class=\"n\">or_intro</span>   <span class=\"o\">{</span><span class=\"err\">Γ</span> <span class=\"n\">p</span> <span class=\"n\">q</span> <span class=\"n\">r</span><span class=\"o\">}</span> <span class=\"o\">:</span> <span class=\"k\">proof</span> <span class=\"err\">Γ</span> <span class=\"n\">p</span> <span class=\"n\">r</span> <span class=\"bp\">→</span> <span class=\"k\">proof</span> <span class=\"err\">Γ</span> <span class=\"n\">q</span> <span class=\"n\">r</span> <span class=\"bp\">→</span> <span class=\"k\">proof</span> <span class=\"err\">Γ</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"err\">⋁</span> <span class=\"n\">q</span><span class=\"o\">)</span> <span class=\"n\">r</span>\n<span class=\"bp\">|</span> <span class=\"n\">or_left</span>    <span class=\"o\">{</span><span class=\"err\">Γ</span> <span class=\"n\">p</span> <span class=\"n\">q</span> <span class=\"n\">r</span><span class=\"o\">}</span> <span class=\"o\">:</span> <span class=\"k\">proof</span> <span class=\"err\">Γ</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"err\">⋁</span> <span class=\"n\">q</span><span class=\"o\">)</span> <span class=\"n\">r</span> <span class=\"bp\">→</span> <span class=\"k\">proof</span> <span class=\"err\">Γ</span> <span class=\"n\">p</span> <span class=\"n\">r</span>\n<span class=\"bp\">|</span> <span class=\"n\">or_right</span>   <span class=\"o\">{</span><span class=\"err\">Γ</span> <span class=\"n\">p</span> <span class=\"n\">q</span> <span class=\"n\">r</span><span class=\"o\">}</span> <span class=\"o\">:</span> <span class=\"k\">proof</span> <span class=\"err\">Γ</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"err\">⋁</span> <span class=\"n\">q</span><span class=\"o\">)</span> <span class=\"n\">r</span> <span class=\"bp\">→</span> <span class=\"k\">proof</span> <span class=\"err\">Γ</span> <span class=\"n\">q</span> <span class=\"n\">r</span>\n<span class=\"bp\">|</span> <span class=\"n\">imp_to_and</span> <span class=\"o\">{</span><span class=\"err\">Γ</span> <span class=\"n\">p</span> <span class=\"n\">q</span> <span class=\"n\">r</span><span class=\"o\">}</span> <span class=\"o\">:</span> <span class=\"k\">proof</span> <span class=\"err\">Γ</span> <span class=\"n\">p</span> <span class=\"o\">(</span><span class=\"n\">q</span> <span class=\"err\">⟹</span> <span class=\"n\">r</span><span class=\"o\">)</span> <span class=\"bp\">→</span> <span class=\"k\">proof</span> <span class=\"err\">Γ</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"err\">⋀</span> <span class=\"n\">q</span><span class=\"o\">)</span> <span class=\"n\">r</span>\n<span class=\"bp\">|</span> <span class=\"n\">and_to_imp</span> <span class=\"o\">{</span><span class=\"err\">Γ</span> <span class=\"n\">p</span> <span class=\"n\">q</span> <span class=\"n\">r</span><span class=\"o\">}</span> <span class=\"o\">:</span> <span class=\"k\">proof</span> <span class=\"err\">Γ</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"err\">⋀</span> <span class=\"n\">q</span><span class=\"o\">)</span> <span class=\"n\">r</span> <span class=\"bp\">→</span> <span class=\"k\">proof</span> <span class=\"err\">Γ</span> <span class=\"n\">p</span> <span class=\"o\">(</span><span class=\"n\">q</span> <span class=\"err\">⟹</span> <span class=\"n\">r</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"n\">add_var</span>    <span class=\"o\">{</span><span class=\"err\">Γ</span> <span class=\"n\">φ</span> <span class=\"n\">ψ</span> <span class=\"n\">B</span><span class=\"o\">}</span> <span class=\"o\">:</span> <span class=\"k\">proof</span> <span class=\"err\">Γ</span> <span class=\"n\">φ</span> <span class=\"n\">ψ</span> <span class=\"bp\">→</span> <span class=\"k\">proof</span> <span class=\"o\">(</span><span class=\"n\">B</span> <span class=\"bp\">::</span> <span class=\"err\">Γ</span><span class=\"o\">)</span> <span class=\"n\">φ</span> <span class=\"n\">ψ</span>\n\n<span class=\"bp\">|</span> <span class=\"n\">apply</span>    <span class=\"o\">{</span><span class=\"err\">Γ</span> <span class=\"n\">φ</span> <span class=\"n\">ψ</span> <span class=\"n\">b</span> <span class=\"n\">B</span><span class=\"o\">}</span> <span class=\"o\">:</span>\n    <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"n\">b</span> <span class=\"n\">B</span>\n    <span class=\"bp\">→</span> <span class=\"k\">proof</span> <span class=\"o\">(</span><span class=\"n\">B</span><span class=\"bp\">::</span><span class=\"err\">Γ</span><span class=\"o\">)</span> <span class=\"n\">φ</span> <span class=\"n\">ψ</span>\n    <span class=\"bp\">→</span> <span class=\"k\">proof</span> <span class=\"err\">Γ</span> <span class=\"o\">(</span><span class=\"n\">subst</span> <span class=\"n\">b</span> <span class=\"n\">φ</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">subst</span> <span class=\"n\">b</span> <span class=\"n\">ψ</span><span class=\"o\">)</span>\n\n<span class=\"bp\">|</span> <span class=\"n\">all_elim</span>   <span class=\"o\">{</span><span class=\"err\">Γ</span> <span class=\"n\">p</span> <span class=\"n\">φ</span> <span class=\"n\">B</span><span class=\"o\">}</span> <span class=\"o\">:</span> <span class=\"k\">proof</span> <span class=\"err\">Γ</span> <span class=\"n\">p</span> <span class=\"o\">(</span><span class=\"bp\">∀</span><span class=\"err\">&#39;</span> <span class=\"n\">φ</span><span class=\"o\">)</span> <span class=\"bp\">→</span> <span class=\"k\">proof</span> <span class=\"o\">(</span><span class=\"n\">B</span><span class=\"bp\">::</span><span class=\"err\">Γ</span><span class=\"o\">)</span> <span class=\"n\">p</span> <span class=\"n\">φ</span>\n<span class=\"bp\">|</span> <span class=\"n\">all_intro</span>  <span class=\"o\">{</span><span class=\"err\">Γ</span> <span class=\"n\">p</span> <span class=\"n\">φ</span> <span class=\"n\">B</span><span class=\"o\">}</span> <span class=\"o\">:</span> <span class=\"k\">proof</span> <span class=\"o\">(</span><span class=\"n\">B</span><span class=\"bp\">::</span><span class=\"err\">Γ</span><span class=\"o\">)</span> <span class=\"n\">p</span> <span class=\"n\">φ</span> <span class=\"bp\">→</span> <span class=\"k\">proof</span> <span class=\"err\">Γ</span> <span class=\"n\">p</span> <span class=\"o\">(</span><span class=\"bp\">∀</span><span class=\"err\">&#39;</span> <span class=\"n\">φ</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"n\">ex_elim</span>    <span class=\"o\">{</span><span class=\"err\">Γ</span> <span class=\"n\">p</span> <span class=\"n\">φ</span> <span class=\"n\">B</span><span class=\"o\">}</span> <span class=\"o\">:</span> <span class=\"k\">proof</span> <span class=\"err\">Γ</span> <span class=\"n\">p</span> <span class=\"o\">(</span><span class=\"bp\">∃</span><span class=\"err\">&#39;</span> <span class=\"n\">φ</span><span class=\"o\">)</span> <span class=\"bp\">→</span> <span class=\"k\">proof</span> <span class=\"o\">(</span><span class=\"n\">B</span><span class=\"bp\">::</span><span class=\"err\">Γ</span><span class=\"o\">)</span> <span class=\"n\">p</span> <span class=\"n\">φ</span>\n<span class=\"bp\">|</span> <span class=\"n\">ex_intro</span>   <span class=\"o\">{</span><span class=\"err\">Γ</span> <span class=\"n\">p</span> <span class=\"n\">φ</span> <span class=\"n\">B</span><span class=\"o\">}</span> <span class=\"o\">:</span> <span class=\"k\">proof</span> <span class=\"o\">(</span><span class=\"n\">B</span><span class=\"bp\">::</span><span class=\"err\">Γ</span><span class=\"o\">)</span> <span class=\"n\">p</span> <span class=\"n\">φ</span> <span class=\"bp\">→</span> <span class=\"k\">proof</span> <span class=\"err\">Γ</span> <span class=\"n\">p</span> <span class=\"o\">(</span><span class=\"bp\">∃</span><span class=\"err\">&#39;</span> <span class=\"n\">φ</span><span class=\"o\">)</span>\n\n<span class=\"bp\">|</span> <span class=\"n\">comp</span>       <span class=\"o\">{</span><span class=\"err\">Γ</span> <span class=\"n\">φ</span> <span class=\"n\">A</span><span class=\"o\">}</span>   <span class=\"o\">:</span>\n    <span class=\"n\">WF</span> <span class=\"o\">(</span><span class=\"n\">A</span><span class=\"bp\">::</span><span class=\"n\">A</span><span class=\"bp\">::</span><span class=\"err\">Γ</span><span class=\"o\">)</span> <span class=\"n\">φ</span> <span class=\"err\">Ω</span>\n    <span class=\"bp\">→</span> <span class=\"k\">proof</span> <span class=\"err\">Γ</span> <span class=\"err\">⊤</span>\n      <span class=\"o\">(</span><span class=\"bp\">∀</span><span class=\"err\">&#39;</span> <span class=\"o\">(</span><span class=\"bp\">&lt;</span><span class=\"mi\">0</span><span class=\"bp\">&gt;</span> <span class=\"err\">∈</span> <span class=\"err\">⟦</span><span class=\"n\">φ</span><span class=\"err\">⟧</span><span class=\"o\">)</span> <span class=\"err\">⇔</span> <span class=\"o\">(</span><span class=\"n\">subst</span> <span class=\"bp\">&lt;</span><span class=\"mi\">0</span><span class=\"bp\">&gt;</span> <span class=\"n\">φ</span><span class=\"o\">))</span>\n\n<span class=\"bp\">|</span> <span class=\"n\">ext</span>                  <span class=\"o\">:</span>\n    <span class=\"k\">proof</span> <span class=\"o\">[]</span> <span class=\"err\">⊤</span> <span class=\"err\">$</span>\n      <span class=\"bp\">∀</span><span class=\"err\">&#39;</span> <span class=\"bp\">∀</span><span class=\"err\">&#39;</span> <span class=\"o\">(</span><span class=\"bp\">∀</span><span class=\"err\">&#39;</span> <span class=\"o\">(</span><span class=\"bp\">&lt;</span><span class=\"mi\">0</span><span class=\"bp\">&gt;</span> <span class=\"err\">∈</span> <span class=\"bp\">&lt;</span><span class=\"mi\">2</span><span class=\"bp\">&gt;</span><span class=\"o\">)</span> <span class=\"err\">⇔</span> <span class=\"o\">(</span><span class=\"bp\">&lt;</span><span class=\"mi\">0</span><span class=\"bp\">&gt;</span> <span class=\"err\">∈</span> <span class=\"bp\">&lt;</span><span class=\"mi\">1</span><span class=\"bp\">&gt;</span><span class=\"o\">))</span> <span class=\"err\">⟹</span> <span class=\"o\">(</span><span class=\"bp\">&lt;</span><span class=\"mi\">1</span><span class=\"bp\">&gt;</span> <span class=\"err\">≃</span> <span class=\"bp\">&lt;</span><span class=\"mi\">0</span><span class=\"bp\">&gt;</span><span class=\"o\">)</span>\n\n<span class=\"bp\">|</span> <span class=\"n\">prop_ext</span>             <span class=\"o\">:</span> <span class=\"k\">proof</span> <span class=\"o\">[]</span> <span class=\"err\">⊤</span> <span class=\"bp\">∀</span><span class=\"err\">&#39;</span> <span class=\"bp\">∀</span><span class=\"err\">&#39;</span> <span class=\"o\">(</span><span class=\"bp\">&lt;</span><span class=\"mi\">1</span><span class=\"bp\">&gt;</span> <span class=\"err\">⇔</span> <span class=\"bp\">&lt;</span><span class=\"mi\">0</span><span class=\"bp\">&gt;</span><span class=\"o\">)</span> <span class=\"err\">⟹</span> <span class=\"o\">(</span><span class=\"bp\">&lt;</span><span class=\"mi\">1</span><span class=\"bp\">&gt;</span> <span class=\"err\">≃</span> <span class=\"bp\">&lt;</span><span class=\"mi\">0</span><span class=\"bp\">&gt;</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"n\">star_unique</span>          <span class=\"o\">:</span> <span class=\"k\">proof</span> <span class=\"o\">[]</span> <span class=\"err\">⊤</span> <span class=\"bp\">∀</span><span class=\"err\">&#39;</span> <span class=\"o\">(</span><span class=\"bp\">&lt;</span><span class=\"mi\">0</span><span class=\"bp\">&gt;</span> <span class=\"err\">≃</span> <span class=\"err\">⁎</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"n\">prod_exists_rep</span>      <span class=\"o\">:</span> <span class=\"k\">proof</span> <span class=\"o\">[]</span> <span class=\"err\">⊤</span> <span class=\"bp\">∀</span><span class=\"err\">&#39;</span> <span class=\"bp\">∃</span><span class=\"err\">&#39;</span> <span class=\"bp\">∃</span><span class=\"err\">&#39;</span> <span class=\"o\">(</span><span class=\"bp\">&lt;</span><span class=\"mi\">2</span><span class=\"bp\">&gt;</span> <span class=\"err\">≃</span> <span class=\"o\">(</span><span class=\"n\">prod</span> <span class=\"bp\">&lt;</span><span class=\"mi\">1</span><span class=\"bp\">&gt;</span> <span class=\"bp\">&lt;</span><span class=\"mi\">0</span><span class=\"bp\">&gt;</span><span class=\"o\">))</span>\n\n<span class=\"bp\">|</span> <span class=\"n\">prod_distinct_rep</span>    <span class=\"o\">:</span>\n    <span class=\"k\">proof</span> <span class=\"o\">[]</span> <span class=\"err\">⊤</span>\n      <span class=\"bp\">∀</span><span class=\"err\">&#39;</span> <span class=\"bp\">∀</span><span class=\"err\">&#39;</span> <span class=\"bp\">∀</span><span class=\"err\">&#39;</span> <span class=\"bp\">∀</span><span class=\"err\">&#39;</span> <span class=\"o\">(</span><span class=\"n\">prod</span> <span class=\"bp\">&lt;</span><span class=\"mi\">3</span><span class=\"bp\">&gt;</span> <span class=\"bp\">&lt;</span><span class=\"mi\">1</span><span class=\"bp\">&gt;</span> <span class=\"err\">≃</span> <span class=\"n\">prod</span> <span class=\"bp\">&lt;</span><span class=\"mi\">2</span><span class=\"bp\">&gt;</span> <span class=\"bp\">&lt;</span><span class=\"mi\">0</span><span class=\"bp\">&gt;</span><span class=\"o\">)</span> <span class=\"err\">⟹</span> <span class=\"o\">(</span><span class=\"bp\">&lt;</span><span class=\"mi\">3</span><span class=\"bp\">&gt;</span> <span class=\"err\">≃</span> <span class=\"bp\">&lt;</span><span class=\"mi\">2</span><span class=\"bp\">&gt;</span> <span class=\"err\">⋀</span> <span class=\"bp\">&lt;</span><span class=\"mi\">1</span><span class=\"bp\">&gt;</span> <span class=\"err\">≃</span> <span class=\"bp\">&lt;</span><span class=\"mi\">0</span><span class=\"bp\">&gt;</span><span class=\"o\">)</span>\n\n<span class=\"kn\">example</span> <span class=\"o\">:</span> <span class=\"k\">proof</span> <span class=\"o\">[]</span> <span class=\"err\">⊤</span> <span class=\"err\">⊤</span> <span class=\"o\">:=</span> <span class=\"k\">proof</span><span class=\"bp\">.</span><span class=\"n\">axm</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">top</span>\n\n\n<span class=\"kn\">lemma</span> <span class=\"n\">proof_WF</span> <span class=\"o\">{</span><span class=\"err\">Γ</span> <span class=\"o\">:</span> <span class=\"kn\">context</span><span class=\"o\">}</span> <span class=\"o\">{</span><span class=\"n\">φ</span> <span class=\"n\">ψ</span><span class=\"o\">:</span> <span class=\"n\">term</span><span class=\"o\">}</span> <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"n\">φ</span> <span class=\"err\">Ω</span> <span class=\"bp\">→</span> <span class=\"k\">proof</span> <span class=\"err\">Γ</span> <span class=\"n\">φ</span> <span class=\"n\">ψ</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"n\">ψ</span> <span class=\"err\">Ω</span> <span class=\"o\">:=</span>\n<span class=\"k\">begin</span>\n<span class=\"n\">intros</span> <span class=\"n\">wf_φ</span> <span class=\"n\">prf_φ_ψ</span><span class=\"o\">,</span>\n<span class=\"n\">induction</span> <span class=\"n\">prf_φ_ψ</span><span class=\"o\">,</span>\n  <span class=\"n\">case</span> <span class=\"k\">proof</span><span class=\"bp\">.</span><span class=\"n\">axm</span> <span class=\"o\">:</span> <span class=\"o\">{</span><span class=\"n\">assumption</span><span class=\"o\">},</span>\n  <span class=\"n\">case</span> <span class=\"k\">proof</span><span class=\"bp\">.</span><span class=\"n\">abs</span> <span class=\"o\">:</span> <span class=\"o\">{</span><span class=\"n\">assumption</span><span class=\"o\">},</span>\n  <span class=\"n\">case</span> <span class=\"k\">proof</span><span class=\"bp\">.</span><span class=\"n\">vac</span> <span class=\"o\">:</span> <span class=\"o\">{</span><span class=\"n\">exact</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">top</span><span class=\"o\">},</span>\n  <span class=\"n\">case</span> <span class=\"k\">proof</span><span class=\"bp\">.</span><span class=\"n\">cut</span> <span class=\"o\">:</span> <span class=\"err\">Γ</span> <span class=\"n\">P</span> <span class=\"n\">Q</span> <span class=\"n\">R</span> <span class=\"n\">prf_PQ</span> <span class=\"n\">prf_QR</span> <span class=\"n\">h₁</span> <span class=\"n\">h₂</span>\n    <span class=\"o\">{</span><span class=\"n\">exact</span> <span class=\"n\">h₂</span> <span class=\"o\">(</span><span class=\"n\">h₁</span> <span class=\"n\">wf_φ</span><span class=\"o\">)},</span>\n  <span class=\"n\">case</span> <span class=\"k\">proof</span><span class=\"bp\">.</span><span class=\"n\">and_intro</span> <span class=\"o\">:</span> <span class=\"err\">Γ</span> <span class=\"n\">p</span> <span class=\"n\">q</span> <span class=\"n\">r</span> <span class=\"n\">prf_pq</span> <span class=\"n\">prf_pr</span> <span class=\"n\">h₁</span> <span class=\"n\">h₂</span> <span class=\"n\">h₃</span>\n    <span class=\"o\">{</span><span class=\"n\">apply</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">and</span><span class=\"o\">,</span> <span class=\"n\">exact</span> <span class=\"n\">h₁</span> <span class=\"n\">h₃</span><span class=\"o\">,</span> <span class=\"n\">exact</span> <span class=\"n\">h₂</span> <span class=\"n\">h₃</span><span class=\"o\">},</span>\n  <span class=\"n\">case</span> <span class=\"k\">proof</span><span class=\"bp\">.</span><span class=\"n\">and_left</span> <span class=\"o\">:</span> <span class=\"err\">Γ</span> <span class=\"n\">p</span> <span class=\"n\">q</span> <span class=\"n\">r</span> <span class=\"n\">h₁</span> <span class=\"n\">h₂</span> <span class=\"o\">{</span><span class=\"n\">apply</span> <span class=\"n\">WF_and_left</span><span class=\"o\">,</span> <span class=\"n\">exact</span> <span class=\"n\">h₂</span> <span class=\"n\">wf_φ</span><span class=\"o\">},</span>\n  <span class=\"n\">case</span> <span class=\"k\">proof</span><span class=\"bp\">.</span><span class=\"n\">and_right</span> <span class=\"o\">:</span> <span class=\"err\">Γ</span> <span class=\"n\">p</span> <span class=\"n\">q</span> <span class=\"n\">r</span> <span class=\"n\">h₁</span> <span class=\"n\">h₂</span> <span class=\"o\">{</span><span class=\"n\">apply</span> <span class=\"n\">WF_and_right</span><span class=\"o\">,</span> <span class=\"n\">exact</span> <span class=\"n\">h₂</span> <span class=\"n\">wf_φ</span><span class=\"o\">},</span>\n  <span class=\"n\">case</span> <span class=\"k\">proof</span><span class=\"bp\">.</span><span class=\"n\">or_intro</span> <span class=\"o\">:</span> <span class=\"err\">Γ</span> <span class=\"n\">p</span> <span class=\"n\">q</span> <span class=\"n\">r</span> <span class=\"n\">prf_pr</span> <span class=\"n\">prf_qr</span> <span class=\"n\">h₁</span> <span class=\"n\">h₂</span> <span class=\"n\">h₃</span>\n    <span class=\"o\">{</span><span class=\"n\">apply</span> <span class=\"n\">h₁</span><span class=\"o\">,</span> <span class=\"n\">apply</span> <span class=\"n\">WF_or_left</span><span class=\"o\">,</span> <span class=\"n\">exact</span> <span class=\"n\">h₃</span><span class=\"o\">},</span>\n  <span class=\"n\">case</span> <span class=\"k\">proof</span><span class=\"bp\">.</span><span class=\"n\">comp</span> <span class=\"o\">:</span> <span class=\"err\">Γ</span> <span class=\"n\">p</span> <span class=\"n\">A</span> <span class=\"n\">h</span>\n    <span class=\"o\">{</span><span class=\"n\">apply</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">all</span><span class=\"o\">,</span>\n      <span class=\"n\">apply</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">and</span><span class=\"o\">,</span>\n      <span class=\"n\">apply</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">imp</span><span class=\"o\">,</span>\n      <span class=\"n\">apply</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">elem</span><span class=\"o\">,</span>\n      <span class=\"k\">show</span> <span class=\"n\">type</span><span class=\"o\">,</span> <span class=\"n\">exact</span> <span class=\"n\">A</span><span class=\"o\">,</span>\n      <span class=\"k\">show</span> <span class=\"n\">type</span><span class=\"o\">,</span> <span class=\"n\">exact</span> <span class=\"n\">A</span><span class=\"o\">,</span>\n      <span class=\"n\">apply</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">var</span><span class=\"o\">,</span>\n        <span class=\"n\">simp</span><span class=\"o\">,</span>\n      <span class=\"n\">apply</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">comp</span><span class=\"o\">,</span>\n        <span class=\"n\">assumption</span><span class=\"o\">,</span>\n      <span class=\"n\">simp</span><span class=\"o\">,</span>\n      <span class=\"n\">induction</span> <span class=\"n\">h</span><span class=\"o\">,</span>\n        <span class=\"n\">case</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">top</span> <span class=\"o\">:</span> <span class=\"o\">{</span><span class=\"n\">simp</span><span class=\"o\">,</span> <span class=\"n\">exact</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">top</span><span class=\"o\">},</span>\n        <span class=\"n\">case</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">bot</span> <span class=\"o\">:</span> <span class=\"o\">{</span><span class=\"n\">simp</span><span class=\"o\">,</span> <span class=\"n\">exact</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">bot</span><span class=\"o\">},</span>\n        <span class=\"n\">case</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">star</span> <span class=\"o\">:</span> <span class=\"o\">{</span><span class=\"n\">simp</span><span class=\"o\">,</span> <span class=\"n\">exact</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">star</span><span class=\"o\">},</span>\n        <span class=\"n\">case</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">and</span> <span class=\"o\">:</span> <span class=\"err\">Γ</span> <span class=\"n\">p</span> <span class=\"n\">q</span> <span class=\"n\">wf_p</span> <span class=\"n\">wf_q</span> <span class=\"n\">ih₁</span> <span class=\"n\">ih₂</span>\n          <span class=\"o\">{</span><span class=\"n\">simp</span><span class=\"o\">,</span> <span class=\"n\">apply</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">and</span><span class=\"o\">,</span> <span class=\"n\">exact</span> <span class=\"n\">ih₁</span> <span class=\"n\">wf_φ</span><span class=\"o\">,</span> <span class=\"n\">exact</span> <span class=\"n\">ih₂</span> <span class=\"n\">wf_φ</span><span class=\"o\">},</span>\n        <span class=\"n\">case</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">or</span> <span class=\"o\">:</span> <span class=\"err\">Γ</span> <span class=\"n\">p</span> <span class=\"n\">q</span> <span class=\"n\">wf_p</span> <span class=\"n\">wf_q</span> <span class=\"n\">ih₁</span> <span class=\"n\">ih₂</span>\n          <span class=\"o\">{</span><span class=\"n\">simp</span><span class=\"o\">,</span> <span class=\"n\">apply</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">or</span><span class=\"o\">,</span> <span class=\"n\">exact</span> <span class=\"n\">ih₁</span> <span class=\"n\">wf_φ</span><span class=\"o\">,</span> <span class=\"n\">exact</span> <span class=\"n\">ih₂</span> <span class=\"n\">wf_φ</span><span class=\"o\">},</span>\n        <span class=\"n\">case</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">imp</span> <span class=\"o\">:</span> <span class=\"err\">Γ</span> <span class=\"n\">p</span> <span class=\"n\">q</span> <span class=\"n\">wf_p</span> <span class=\"n\">wf_q</span> <span class=\"n\">ih₁</span> <span class=\"n\">ih₂</span>\n          <span class=\"o\">{</span><span class=\"n\">simp</span><span class=\"o\">,</span> <span class=\"n\">apply</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">imp</span><span class=\"o\">,</span> <span class=\"n\">exact</span> <span class=\"n\">ih₁</span> <span class=\"n\">wf_φ</span><span class=\"o\">,</span> <span class=\"n\">exact</span> <span class=\"n\">ih₂</span> <span class=\"n\">wf_φ</span><span class=\"o\">},</span>\n        <span class=\"n\">case</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">var</span> <span class=\"o\">:</span> <span class=\"err\">Γ</span> <span class=\"n\">n</span> <span class=\"n\">A</span> <span class=\"n\">h₁</span> <span class=\"o\">{</span><span class=\"n\">simp</span><span class=\"o\">,</span> <span class=\"n\">split_ifs</span> <span class=\"k\">with</span> <span class=\"n\">h₂</span><span class=\"o\">,</span> <span class=\"n\">apply</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">var</span><span class=\"o\">,</span> <span class=\"n\">simp</span><span class=\"o\">,</span> <span class=\"n\">sorry</span><span class=\"o\">,</span> <span class=\"n\">sorry</span><span class=\"o\">},</span>\n        <span class=\"n\">repeat</span> <span class=\"o\">{</span><span class=\"n\">sorry</span><span class=\"o\">},</span>\n    <span class=\"o\">},</span>\n  <span class=\"n\">repeat</span> <span class=\"o\">{</span><span class=\"n\">sorry</span><span class=\"o\">},</span>\n<span class=\"kn\">end</span>\n\n<span class=\"kn\">end</span> <span class=\"n\">TT</span>\n</code></pre></div>",
        "id": 198402800,
        "sender_full_name": "Jalex Stark",
        "timestamp": 1590117665
    },
    {
        "content": "<p>so yes, you can replace the unused variable names with <code>_</code></p>",
        "id": 198402864,
        "sender_full_name": "Jalex Stark",
        "timestamp": 1590117763
    },
    {
        "content": "<p>Yep I see. As I am naming them (or not naming them) I don't really know what I've named until I move my cursor inside the <code>{}</code>, and each time I do that - it's not clear which \"ugly\" name is going to become the next variable name I tack on. Is trial and error the only way there?</p>",
        "id": 198402945,
        "sender_full_name": "Billy Price",
        "timestamp": 1590117923
    },
    {
        "content": "<p>i think in your tactic state, the autogenerated variable names appear in the order they're generated</p>",
        "id": 198403023,
        "sender_full_name": "Jalex Stark",
        "timestamp": 1590118006
    },
    {
        "content": "<p>Actually you're right - I think they just reappear in a different order once I've named them for some reason.</p>",
        "id": 198403037,
        "sender_full_name": "Billy Price",
        "timestamp": 1590118064
    },
    {
        "content": "<p>Can I avoid re-introducing <code>Γ</code> every time I do a case?</p>",
        "id": 198403078,
        "sender_full_name": "Billy Price",
        "timestamp": 1590118098
    },
    {
        "content": "<p>a mostly-not-serious suggestion is to redefine things so that the arguments that you're introducing come first</p>",
        "id": 198403174,
        "sender_full_name": "Jalex Stark",
        "timestamp": 1590118298
    },
    {
        "content": "<p>in the proof.comp case you do a lot of work tracking down metavariables</p>",
        "id": 198403176,
        "sender_full_name": "Jalex Stark",
        "timestamp": 1590118317
    },
    {
        "content": "<p><code>apply @WF.all _ _ A,</code> seems like a better thing to write for the first line than <code>apply WF.all</code></p>",
        "id": 198403214,
        "sender_full_name": "Jalex Stark",
        "timestamp": 1590118323
    },
    {
        "content": "<p>similarly <code>apply @WF.elem _ _ _ A,</code> a few lines later</p>",
        "id": 198403236,
        "sender_full_name": "Jalex Stark",
        "timestamp": 1590118420
    },
    {
        "content": "<p>Sorry could you explain what that's achieving?</p>",
        "id": 198403293,
        "sender_full_name": "Billy Price",
        "timestamp": 1590118485
    },
    {
        "content": "<p>well as it's written you get a metavariable and a goal that's just <code>type</code></p>",
        "id": 198403319,
        "sender_full_name": "Jalex Stark",
        "timestamp": 1590118539
    },
    {
        "content": "<p>and then later you close that goal by supplying <code>A</code></p>",
        "id": 198403325,
        "sender_full_name": "Jalex Stark",
        "timestamp": 1590118548
    },
    {
        "content": "<p>here we're feeding it A right when it's needed, instead of making lean ask us for it</p>",
        "id": 198403365,
        "sender_full_name": "Jalex Stark",
        "timestamp": 1590118567
    },
    {
        "content": "<p>I think you should abstract out the hard cases like <code>proof.comp</code> as lemmas</p>",
        "id": 198403389,
        "sender_full_name": "Jalex Stark",
        "timestamp": 1590118656
    },
    {
        "content": "<p>that way when you prove the theorem you're \"just\" listing all 24 cases together with either their short proofs or a call to the external lemma</p>",
        "id": 198403434,
        "sender_full_name": "Jalex Stark",
        "timestamp": 1590118695
    },
    {
        "content": "<p>I understand. Is that an indication I should change the WF.all to put the type first? And should I have the other arguments explicit or implicit? I thought making them implicit would save me from having to state them but I seems I have to do it anyway with this proof.</p>",
        "id": 198403441,
        "sender_full_name": "Billy Price",
        "timestamp": 1590118731
    },
    {
        "content": "<p>Yeah if in fact you end up always stating A explicitly then probably you want A to be an explicit argument</p>",
        "id": 198403456,
        "sender_full_name": "Jalex Stark",
        "timestamp": 1590118784
    },
    {
        "content": "<p>the first three implicit arguments get dealt with just fine</p>",
        "id": 198403459,
        "sender_full_name": "Jalex Stark",
        "timestamp": 1590118796
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"252300\">Jalex Stark</span> <a href=\"#narrow/stream/236446-Type-theory/topic/Modelling.20a.20Type.20Theory.20in.20Lean/near/198403434\">said</a>:</p>\n<blockquote>\n<p>that way when you prove the theorem you're \"just\" listing all 24 cases together with either their short proofs or a call to the external lemma</p>\n</blockquote>\n<p>If I'm doing it by induction though - do those lemmas need an appropriate hypothesis related to the induction?</p>",
        "id": 198403501,
        "sender_full_name": "Billy Price",
        "timestamp": 1590118808
    },
    {
        "content": "<p>the tactic state looks like this</p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"err\">Γ</span> <span class=\"o\">:</span> <span class=\"kn\">context</span><span class=\"o\">,</span>\n<span class=\"n\">φ</span> <span class=\"n\">ψ</span> <span class=\"o\">:</span> <span class=\"n\">term</span><span class=\"o\">,</span>\n<span class=\"err\">Γ</span> <span class=\"o\">:</span> <span class=\"n\">list</span> <span class=\"n\">type</span><span class=\"o\">,</span>\n<span class=\"n\">wf_φ</span> <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">⊤</span> <span class=\"err\">Ω</span><span class=\"o\">,</span>\n<span class=\"n\">p</span> <span class=\"o\">:</span> <span class=\"n\">term</span><span class=\"o\">,</span>\n<span class=\"n\">A</span> <span class=\"o\">:</span> <span class=\"n\">type</span><span class=\"o\">,</span>\n<span class=\"n\">h</span> <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"bp\">::</span> <span class=\"n\">A</span> <span class=\"bp\">::</span> <span class=\"err\">Γ</span><span class=\"o\">)</span> <span class=\"n\">p</span> <span class=\"err\">Ω</span>\n<span class=\"err\">⊢</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"o\">(</span><span class=\"bp\">∀</span><span class=\"err\">&#39;</span><span class=\"o\">(</span><span class=\"n\">var</span> <span class=\"mi\">0</span> <span class=\"err\">∈</span> <span class=\"err\">⟦</span><span class=\"n\">p</span><span class=\"err\">⟧</span><span class=\"o\">)</span> <span class=\"err\">⇔</span> <span class=\"n\">subst</span> <span class=\"o\">(</span><span class=\"n\">var</span> <span class=\"mi\">0</span><span class=\"o\">)</span> <span class=\"n\">p</span><span class=\"o\">)</span> <span class=\"err\">Ω</span>\n</code></pre></div>",
        "id": 198403511,
        "sender_full_name": "Jalex Stark",
        "timestamp": 1590118856
    },
    {
        "content": "<p>you could have a lemma whose type signature is this tactic state</p>",
        "id": 198403516,
        "sender_full_name": "Jalex Stark",
        "timestamp": 1590118870
    },
    {
        "content": "<p>That's a nice way to go about it. That reminds me, what's up with the multiple Gammas?</p>",
        "id": 198403574,
        "sender_full_name": "Billy Price",
        "timestamp": 1590118934
    },
    {
        "content": "<p>Shouldn't they be unified or something?</p>",
        "id": 198403578,
        "sender_full_name": "Billy Price",
        "timestamp": 1590118953
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span><code><span class=\"kn\">lemma</span> <span class=\"n\">case_proof_comp</span>\n<span class=\"o\">(</span><span class=\"err\">Γ</span> <span class=\"o\">:</span> <span class=\"kn\">context</span><span class=\"o\">)</span>\n<span class=\"o\">(</span><span class=\"n\">φ</span> <span class=\"n\">ψ</span> <span class=\"o\">:</span> <span class=\"n\">term</span><span class=\"o\">)</span>\n<span class=\"o\">(</span><span class=\"err\">Γ</span> <span class=\"o\">:</span> <span class=\"n\">list</span> <span class=\"n\">type</span><span class=\"o\">)</span>\n<span class=\"o\">(</span><span class=\"n\">wf_φ</span> <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">⊤</span> <span class=\"err\">Ω</span><span class=\"o\">)</span>\n<span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"o\">:</span> <span class=\"n\">term</span><span class=\"o\">)</span>\n<span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"o\">:</span> <span class=\"n\">type</span><span class=\"o\">)</span>\n<span class=\"o\">(</span><span class=\"n\">h</span> <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"bp\">::</span> <span class=\"n\">A</span> <span class=\"bp\">::</span> <span class=\"err\">Γ</span><span class=\"o\">)</span> <span class=\"n\">p</span> <span class=\"err\">Ω</span><span class=\"o\">)</span> <span class=\"o\">:</span>\n <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"o\">(</span><span class=\"bp\">∀</span><span class=\"err\">&#39;</span><span class=\"o\">(</span><span class=\"n\">var</span> <span class=\"mi\">0</span> <span class=\"err\">∈</span> <span class=\"err\">⟦</span><span class=\"n\">p</span><span class=\"err\">⟧</span><span class=\"o\">)</span> <span class=\"err\">⇔</span> <span class=\"n\">subst</span> <span class=\"o\">(</span><span class=\"n\">var</span> <span class=\"mi\">0</span><span class=\"o\">)</span> <span class=\"n\">p</span><span class=\"o\">)</span> <span class=\"err\">Ω</span> <span class=\"o\">:=</span> <span class=\"n\">sorry</span>\n</code></pre></div>",
        "id": 198403585,
        "sender_full_name": "Jalex Stark",
        "timestamp": 1590118970
    },
    {
        "content": "<p>unified?</p>",
        "id": 198403590,
        "sender_full_name": "Jalex Stark",
        "timestamp": 1590119000
    },
    {
        "content": "<p>they have different types</p>",
        "id": 198403591,
        "sender_full_name": "Jalex Stark",
        "timestamp": 1590119005
    },
    {
        "content": "<p><code>context</code> is <code>list type</code></p>",
        "id": 198403636,
        "sender_full_name": "Billy Price",
        "timestamp": 1590119050
    },
    {
        "content": "<p>depends on what you mean by is</p>",
        "id": 198403647,
        "sender_full_name": "Jalex Stark",
        "timestamp": 1590119066
    },
    {
        "content": "<p>Definitional is? I'm not even sure why one of them became <code>list type</code></p>",
        "id": 198403682,
        "sender_full_name": "Billy Price",
        "timestamp": 1590119146
    },
    {
        "content": "<p><code>context</code> is defeq to <code>list type</code></p>",
        "id": 198403687,
        "sender_full_name": "Jalex Stark",
        "timestamp": 1590119149
    },
    {
        "content": "<p>but defeq is weaker than syntactic equality</p>",
        "id": 198403731,
        "sender_full_name": "Jalex Stark",
        "timestamp": 1590119167
    },
    {
        "content": "<p>and some things (I don't know which ones, really) only work up to syntactic equality</p>",
        "id": 198403739,
        "sender_full_name": "Jalex Stark",
        "timestamp": 1590119185
    },
    {
        "content": "<p>i do share some of your confusion</p>",
        "id": 198403824,
        "sender_full_name": "Jalex Stark",
        "timestamp": 1590119310
    },
    {
        "content": "<p>So when I do some case - I wanna say \"use the same context here\"</p>",
        "id": 198403845,
        "sender_full_name": "Billy Price",
        "timestamp": 1590119376
    },
    {
        "content": "<p>hmm why do you write </p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"kn\">inductive</span> <span class=\"k\">proof</span> <span class=\"o\">:</span> <span class=\"kn\">context</span> <span class=\"bp\">→</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"kt\">Prop</span>\n</code></pre></div>\n\n\n<p>instead of e.g. </p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"kn\">inductive</span> <span class=\"k\">proof</span>  <span class=\"o\">(</span><span class=\"err\">\\</span><span class=\"n\">G</span> <span class=\"o\">:</span> <span class=\"kn\">context</span><span class=\"o\">)</span>  <span class=\"o\">(</span><span class=\"err\">\\</span><span class=\"n\">phi</span> <span class=\"o\">:</span> <span class=\"n\">term</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"err\">\\</span><span class=\"n\">psi</span> <span class=\"o\">:</span> <span class=\"n\">term</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"kt\">Prop</span>\n</code></pre></div>",
        "id": 198403906,
        "sender_full_name": "Jalex Stark",
        "timestamp": 1590119421
    },
    {
        "content": "<p>I was under the impression I need to do the first, since my understanding of the second is that it locks in those variables globally to the rest of the inductive definitions.</p>",
        "id": 198403990,
        "sender_full_name": "Billy Price",
        "timestamp": 1590119591
    },
    {
        "content": "<p>Whereas I need to unpack all the different cases for the context and terms</p>",
        "id": 198403997,
        "sender_full_name": "Billy Price",
        "timestamp": 1590119620
    },
    {
        "content": "<p>okay, I don't understand but vaguely believe you</p>",
        "id": 198404000,
        "sender_full_name": "Jalex Stark",
        "timestamp": 1590119636
    },
    {
        "content": "<p>also i'm gonna go sleep now</p>",
        "id": 198404039,
        "sender_full_name": "Jalex Stark",
        "timestamp": 1590119643
    },
    {
        "content": "<p>uh I guess to go back to one of your first questions</p>",
        "id": 198404046,
        "sender_full_name": "Jalex Stark",
        "timestamp": 1590119680
    },
    {
        "content": "<p>if you want more automation you could tag things with the simp attribute</p>",
        "id": 198404049,
        "sender_full_name": "Jalex Stark",
        "timestamp": 1590119690
    },
    {
        "content": "<p>and I think that the <code>tidy</code> tactic knows how to do some of the proofs you're doing</p>",
        "id": 198404054,
        "sender_full_name": "Jalex Stark",
        "timestamp": 1590119709
    },
    {
        "content": "<p>Goodnight :) That sounds cool and I need to read up on attributes and how that all works. I just put @[simp] next to subst and subst_nth because I had a guess at what it does.</p>",
        "id": 198404129,
        "sender_full_name": "Billy Price",
        "timestamp": 1590119773
    },
    {
        "content": "<p><a href=\"https://leanprover-community.github.io/mathlib_docs/tactics.html#tidy\">tactic#tidy</a></p>",
        "id": 198404130,
        "sender_full_name": "Jalex Stark",
        "timestamp": 1590119775
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"255481\">Billy Price</span> <a href=\"#narrow/stream/236446-Type-theory/topic/Modelling.20a.20Type.20Theory.20in.20Lean/near/198403574\">said</a>:</p>\n<blockquote>\n<p>That reminds me, what's up with the multiple Gammas?</p>\n</blockquote>\n<p>These are different hypotheses; they just have the same name. You can use <code>dedup</code> to give them different names. The first one may be unnecessary (if nothing in the goal refers to it); if so, you can <code>clear</code> it after the <code>dedup</code>.</p>",
        "id": 198404280,
        "sender_full_name": "Jannis Limperg",
        "timestamp": 1590120101
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"255481\">Billy Price</span> <a href=\"#narrow/stream/236446-Type-theory/topic/Modelling.20a.20Type.20Theory.20in.20Lean/near/198402945\">said</a>:</p>\n<blockquote>\n<p>Yep I see. As I am naming them (or not naming them) I don't really know what I've named until I move my cursor inside the <code>{}</code>, and each time I do that - it's not clear which \"ugly\" name is going to become the next variable name I tack on. Is trial and error the only way there?</p>\n</blockquote>\n<p>This is what I used to do, but the new \"sticky position\" vscode feature helps a lot with this. You put the marker inside the body of the <code>case</code>, then you start writing names in the <code>case</code> statement and push underscores until the name lines up with the variable you want</p>",
        "id": 198406083,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1590123183
    },
    {
        "content": "<p>To add to what Jannis said about the multiple gammas, the first one is probably the input to the theorem before the <code>induction</code> line. It can be removed, assuming you have generalized all the relevant hypotheses about it.</p>",
        "id": 198406153,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1590123359
    },
    {
        "content": "<p>It can also be ignored</p>",
        "id": 198406195,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1590123373
    },
    {
        "content": "<p>Not sure what you mean by sticky position. Like multiple cursors?</p>",
        "id": 198411103,
        "sender_full_name": "Billy Price",
        "timestamp": 1590130805
    },
    {
        "content": "<p>When you have an editor with Lean code focused, you should see a button that looks like a pin near the top right of that editor. If you press that, or hit ctrl+P and search for \"toggle sticky position\", then the current position of the text cursor will get a blue mark. Now you can move your text cursor elsewhere, and the info view will continue to display the messages coming from the blue spot in the file. To turn it off, you can hit the button or call the command again.</p>",
        "id": 198411727,
        "sender_full_name": "Bryan Gin-ge Chen",
        "timestamp": 1590131514
    },
    {
        "content": "<p>How can I be more eco-friendly and solve 10 different lemmas at the same time? (they all compile with the same proof)</p>",
        "id": 198412417,
        "sender_full_name": "Billy Price",
        "timestamp": 1590132233
    },
    {
        "content": "<p>if they are only cases in one bigger proof and not meaningful as separate lemmas, you could use <code>any_goals {proof}</code>. i've also read something on here about a tactic that allows you to select a specific set of goals, but i don't remember what it's called or whether it exists in mathlib.</p>",
        "id": 198412836,
        "sender_full_name": "Marc Huisinga",
        "timestamp": 1590132600
    },
    {
        "content": "<p>They just deconstruct well-formedness - so I'm predicting using them in various places</p>\n<p>All of those lemmas should be solved by the first one's proof</p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"kn\">inductive</span> <span class=\"n\">WF</span> <span class=\"o\">:</span> <span class=\"kn\">context</span> <span class=\"bp\">→</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">type</span> <span class=\"bp\">→</span> <span class=\"kt\">Prop</span>\n<span class=\"bp\">|</span> <span class=\"n\">star</span> <span class=\"o\">{</span><span class=\"err\">Γ</span><span class=\"o\">}</span>         <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"n\">term</span><span class=\"bp\">.</span><span class=\"n\">star</span> <span class=\"mi\">𝟙</span>\n<span class=\"bp\">|</span> <span class=\"n\">top</span>  <span class=\"o\">{</span><span class=\"err\">Γ</span><span class=\"o\">}</span>         <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"n\">term</span><span class=\"bp\">.</span><span class=\"n\">top</span> <span class=\"err\">Ω</span>\n<span class=\"bp\">|</span> <span class=\"n\">bot</span>  <span class=\"o\">{</span><span class=\"err\">Γ</span><span class=\"o\">}</span>         <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"n\">term</span><span class=\"bp\">.</span><span class=\"n\">bot</span> <span class=\"err\">Ω</span>\n<span class=\"bp\">|</span> <span class=\"n\">and</span>  <span class=\"o\">{</span><span class=\"err\">Γ</span> <span class=\"n\">p</span> <span class=\"n\">q</span><span class=\"o\">}</span>     <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"n\">p</span> <span class=\"err\">Ω</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"n\">q</span> <span class=\"err\">Ω</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"err\">⋀</span> <span class=\"n\">q</span><span class=\"o\">)</span> <span class=\"err\">Ω</span>\n<span class=\"bp\">|</span> <span class=\"n\">or</span>   <span class=\"o\">{</span><span class=\"err\">Γ</span> <span class=\"n\">p</span> <span class=\"n\">q</span><span class=\"o\">}</span>     <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"n\">p</span> <span class=\"err\">Ω</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"n\">q</span> <span class=\"err\">Ω</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"err\">⋁</span> <span class=\"n\">q</span><span class=\"o\">)</span> <span class=\"err\">Ω</span>\n<span class=\"bp\">|</span> <span class=\"n\">imp</span>  <span class=\"o\">{</span><span class=\"err\">Γ</span> <span class=\"n\">p</span> <span class=\"n\">q</span><span class=\"o\">}</span>     <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"n\">p</span> <span class=\"err\">Ω</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"n\">q</span> <span class=\"err\">Ω</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"err\">⟹</span> <span class=\"n\">q</span><span class=\"o\">)</span> <span class=\"err\">Ω</span>\n<span class=\"bp\">|</span> <span class=\"n\">var</span>  <span class=\"o\">{</span><span class=\"err\">Γ</span> <span class=\"n\">n</span><span class=\"o\">}</span> <span class=\"o\">(</span><span class=\"n\">A</span><span class=\"o\">)</span>   <span class=\"o\">:</span> <span class=\"n\">list</span><span class=\"bp\">.</span><span class=\"n\">nth</span> <span class=\"err\">Γ</span> <span class=\"n\">n</span> <span class=\"bp\">=</span> <span class=\"n\">some</span> <span class=\"n\">A</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"o\">(</span><span class=\"n\">var</span> <span class=\"n\">n</span><span class=\"o\">)</span> <span class=\"n\">A</span>\n<span class=\"bp\">|</span> <span class=\"n\">comp</span> <span class=\"o\">{</span><span class=\"err\">Γ</span> <span class=\"n\">φ</span><span class=\"o\">}</span> <span class=\"o\">(</span><span class=\"n\">A</span><span class=\"o\">)</span>   <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"o\">(</span><span class=\"n\">A</span><span class=\"bp\">::</span><span class=\"err\">Γ</span><span class=\"o\">)</span> <span class=\"n\">φ</span> <span class=\"err\">Ω</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">⟦</span><span class=\"n\">φ</span><span class=\"err\">⟧</span> <span class=\"o\">(</span><span class=\"err\">𝒫</span> <span class=\"n\">A</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"n\">all</span>  <span class=\"o\">{</span><span class=\"err\">Γ</span> <span class=\"n\">φ</span><span class=\"o\">}</span> <span class=\"o\">(</span><span class=\"n\">A</span><span class=\"o\">)</span>   <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"o\">(</span><span class=\"n\">A</span><span class=\"bp\">::</span><span class=\"err\">Γ</span><span class=\"o\">)</span> <span class=\"n\">φ</span> <span class=\"err\">Ω</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"o\">(</span><span class=\"bp\">∀</span><span class=\"err\">&#39;</span> <span class=\"n\">φ</span><span class=\"o\">)</span> <span class=\"err\">Ω</span>\n<span class=\"bp\">|</span> <span class=\"n\">ex</span>   <span class=\"o\">{</span><span class=\"err\">Γ</span> <span class=\"n\">φ</span><span class=\"o\">}</span> <span class=\"o\">(</span><span class=\"n\">A</span><span class=\"o\">)</span>   <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"o\">(</span><span class=\"n\">A</span><span class=\"bp\">::</span><span class=\"err\">Γ</span><span class=\"o\">)</span> <span class=\"n\">φ</span> <span class=\"err\">Ω</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"o\">(</span><span class=\"bp\">∃</span><span class=\"err\">&#39;</span> <span class=\"n\">φ</span><span class=\"o\">)</span> <span class=\"err\">Ω</span>\n<span class=\"bp\">|</span> <span class=\"n\">elem</span> <span class=\"o\">{</span><span class=\"err\">Γ</span> <span class=\"n\">a</span> <span class=\"n\">α</span><span class=\"o\">}</span> <span class=\"o\">(</span><span class=\"n\">A</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"n\">a</span> <span class=\"n\">A</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"n\">α</span> <span class=\"o\">(</span><span class=\"err\">𝒫</span> <span class=\"n\">A</span><span class=\"o\">)</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"o\">(</span><span class=\"n\">a</span> <span class=\"err\">∈</span> <span class=\"n\">α</span><span class=\"o\">)</span> <span class=\"err\">Ω</span>\n<span class=\"bp\">|</span> <span class=\"n\">prod</span> <span class=\"o\">{</span><span class=\"err\">Γ</span> <span class=\"n\">a</span> <span class=\"n\">b</span> <span class=\"n\">A</span> <span class=\"n\">B</span><span class=\"o\">}</span> <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"n\">a</span> <span class=\"n\">A</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"n\">b</span> <span class=\"n\">B</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"o\">(</span><span class=\"n\">prod</span> <span class=\"n\">a</span> <span class=\"n\">b</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"bp\">××</span> <span class=\"n\">B</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"n\">mod</span>  <span class=\"o\">{</span><span class=\"err\">Γ</span> <span class=\"n\">a</span> <span class=\"n\">A</span><span class=\"o\">}</span> <span class=\"o\">(</span><span class=\"n\">B</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"n\">a</span> <span class=\"n\">A</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"o\">(</span><span class=\"n\">B</span><span class=\"bp\">::</span><span class=\"err\">Γ</span><span class=\"o\">)</span> <span class=\"n\">a</span> <span class=\"n\">A</span>\n\n<span class=\"kn\">variable</span> <span class=\"err\">Γ</span> <span class=\"o\">:</span> <span class=\"kn\">context</span>\n<span class=\"kn\">variables</span> <span class=\"n\">p</span> <span class=\"n\">q</span> <span class=\"n\">r</span> <span class=\"n\">φ</span> <span class=\"n\">a</span> <span class=\"n\">b</span> <span class=\"n\">α</span> <span class=\"o\">:</span> <span class=\"n\">term</span>\n<span class=\"kn\">variables</span> <span class=\"n\">A</span> <span class=\"n\">B</span> <span class=\"o\">:</span> <span class=\"n\">type</span>\n\n<span class=\"kn\">lemma</span> <span class=\"n\">WF_and_left</span>   <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"err\">⋀</span> <span class=\"n\">q</span><span class=\"o\">)</span> <span class=\"err\">Ω</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"n\">p</span> <span class=\"err\">Ω</span> <span class=\"o\">:=</span>\n<span class=\"k\">begin</span>\n<span class=\"n\">intro</span> <span class=\"n\">h</span><span class=\"o\">,</span>\n<span class=\"n\">induction</span> <span class=\"err\">Γ</span><span class=\"o\">,</span>\n  <span class=\"n\">case</span> <span class=\"n\">list</span><span class=\"bp\">.</span><span class=\"n\">nil</span> <span class=\"o\">:</span> <span class=\"o\">{</span><span class=\"n\">cases</span> <span class=\"n\">h</span><span class=\"o\">,</span> <span class=\"n\">assumption</span><span class=\"o\">},</span>\n  <span class=\"n\">case</span> <span class=\"n\">list</span><span class=\"bp\">.</span><span class=\"n\">cons</span> <span class=\"o\">:</span> <span class=\"n\">B</span> <span class=\"err\">Δ</span> <span class=\"n\">ih</span> <span class=\"o\">{</span><span class=\"n\">cases</span> <span class=\"n\">h</span><span class=\"o\">,</span> <span class=\"n\">assumption</span><span class=\"o\">,</span> <span class=\"n\">apply</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">mod</span><span class=\"o\">,</span> <span class=\"n\">apply</span> <span class=\"n\">ih</span><span class=\"o\">,</span> <span class=\"n\">assumption</span><span class=\"o\">},</span>\n<span class=\"kn\">end</span>\n<span class=\"kn\">lemma</span> <span class=\"n\">WF_and_right</span>  <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"err\">⋀</span> <span class=\"n\">q</span><span class=\"o\">)</span> <span class=\"err\">Ω</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"n\">q</span> <span class=\"err\">Ω</span> <span class=\"o\">:=</span>\n<span class=\"kn\">lemma</span> <span class=\"n\">WF_or_left</span>    <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"err\">⋁</span> <span class=\"n\">q</span><span class=\"o\">)</span> <span class=\"err\">Ω</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"n\">p</span> <span class=\"err\">Ω</span> <span class=\"o\">:=</span>\n<span class=\"kn\">lemma</span> <span class=\"n\">WF_or_right</span>   <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"err\">⋁</span> <span class=\"n\">q</span><span class=\"o\">)</span> <span class=\"err\">Ω</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"n\">q</span> <span class=\"err\">Ω</span> <span class=\"o\">:=</span>\n<span class=\"kn\">lemma</span> <span class=\"n\">WF_imp_left</span>   <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"err\">⟹</span> <span class=\"n\">q</span><span class=\"o\">)</span> <span class=\"err\">Ω</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"n\">p</span> <span class=\"err\">Ω</span> <span class=\"o\">:=</span>\n<span class=\"kn\">lemma</span> <span class=\"n\">WF_imp_right</span>  <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"err\">⟹</span> <span class=\"n\">q</span><span class=\"o\">)</span> <span class=\"err\">Ω</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"n\">q</span> <span class=\"err\">Ω</span> <span class=\"o\">:=</span>\n<span class=\"kn\">lemma</span> <span class=\"n\">WF_prod_left</span>  <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"o\">(</span><span class=\"n\">prod</span> <span class=\"n\">a</span> <span class=\"n\">b</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"bp\">××</span> <span class=\"n\">B</span><span class=\"o\">)</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"n\">a</span> <span class=\"n\">A</span> <span class=\"o\">:=</span>\n<span class=\"kn\">lemma</span> <span class=\"n\">WF_prod_right</span> <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"o\">(</span><span class=\"n\">prod</span> <span class=\"n\">a</span> <span class=\"n\">b</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"bp\">××</span> <span class=\"n\">B</span><span class=\"o\">)</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"n\">b</span> <span class=\"n\">B</span> <span class=\"o\">:=</span>\n<span class=\"kn\">lemma</span> <span class=\"n\">WF_comp_elim</span>  <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"o\">(</span><span class=\"err\">⟦</span><span class=\"n\">φ</span><span class=\"err\">⟧</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"err\">𝒫</span> <span class=\"n\">A</span><span class=\"o\">)</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"o\">(</span><span class=\"n\">A</span><span class=\"bp\">::</span><span class=\"err\">Γ</span><span class=\"o\">)</span> <span class=\"n\">φ</span> <span class=\"err\">Ω</span> <span class=\"o\">:=</span>\n</code></pre></div>",
        "id": 198413162,
        "sender_full_name": "Billy Price",
        "timestamp": 1590132946
    },
    {
        "content": "<p>Whoops, my new \"mod\" constructor for Well-formedness was not supposed to put the new variable at the start of the list (should go at the end). Regardless - my original question is still relevant.</p>",
        "id": 198414572,
        "sender_full_name": "Billy Price",
        "timestamp": 1590134198
    },
    {
        "content": "<p>Here's my new definition of mod : <code>| mod  {Γ a A} (B) : WF Γ a A → WF (list.concat Γ B) a A</code>. I am having trouble with the following proof</p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"kn\">lemma</span> <span class=\"n\">WF_and_left</span>   <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"err\">⋀</span> <span class=\"n\">q</span><span class=\"o\">)</span> <span class=\"err\">Ω</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"n\">p</span> <span class=\"err\">Ω</span> <span class=\"o\">:=</span>\n<span class=\"k\">begin</span>\n<span class=\"n\">intro</span> <span class=\"n\">h</span><span class=\"o\">,</span>\n<span class=\"n\">induction</span> <span class=\"err\">Γ</span><span class=\"o\">,</span>\n  <span class=\"n\">case</span> <span class=\"n\">list</span><span class=\"bp\">.</span><span class=\"n\">nil</span> <span class=\"o\">:</span> <span class=\"o\">{</span><span class=\"n\">cases</span> <span class=\"n\">h</span><span class=\"o\">,</span> <span class=\"n\">sorry</span><span class=\"o\">},</span>\n  <span class=\"n\">case</span> <span class=\"n\">list</span><span class=\"bp\">.</span><span class=\"n\">cons</span> <span class=\"o\">:</span> <span class=\"o\">{</span><span class=\"n\">sorry</span><span class=\"o\">}</span>\n<span class=\"kn\">end</span>\n</code></pre></div>\n\n\n<p>Lean is unhappy with \"cases h\", I think because it tries to unify the <code>(list.concat Γ B)</code> with <code>list.nil</code> to do the WF.mod case. Shouldn't it recognise this as an irrelevant case?</p>\n<p>This is the error message</p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"n\">cases</span> <span class=\"n\">tactic</span> <span class=\"n\">failed</span><span class=\"o\">,</span> <span class=\"n\">unsupported</span> <span class=\"n\">equality</span> <span class=\"n\">between</span> <span class=\"n\">type</span> <span class=\"n\">and</span> <span class=\"n\">constructor</span> <span class=\"n\">indices</span>\n<span class=\"o\">(</span><span class=\"n\">only</span> <span class=\"n\">equalities</span> <span class=\"n\">between</span> <span class=\"n\">constructors</span> <span class=\"n\">and</span><span class=\"bp\">/</span><span class=\"n\">or</span> <span class=\"kn\">variables</span> <span class=\"n\">are</span> <span class=\"n\">supported</span><span class=\"o\">,</span> <span class=\"n\">try</span> <span class=\"n\">cases</span> <span class=\"n\">on</span> <span class=\"n\">the</span> <span class=\"n\">indices</span><span class=\"o\">):</span>\n<span class=\"n\">list</span><span class=\"bp\">.</span><span class=\"n\">nil</span> <span class=\"bp\">=</span> <span class=\"n\">list</span><span class=\"bp\">.</span><span class=\"n\">concat</span> <span class=\"n\">h_</span><span class=\"err\">Γ</span> <span class=\"n\">h_B</span>\n\n<span class=\"n\">state</span><span class=\"o\">:</span>\n<span class=\"n\">p</span> <span class=\"n\">q</span> <span class=\"o\">:</span> <span class=\"n\">term</span><span class=\"o\">,</span>\n<span class=\"n\">h</span> <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"n\">list</span><span class=\"bp\">.</span><span class=\"n\">nil</span> <span class=\"o\">(</span><span class=\"n\">and</span> <span class=\"n\">p</span> <span class=\"n\">q</span><span class=\"o\">)</span> <span class=\"err\">Ω</span><span class=\"o\">,</span>\n<span class=\"n\">h_</span><span class=\"err\">Γ</span> <span class=\"o\">:</span> <span class=\"kn\">context</span><span class=\"o\">,</span>\n<span class=\"n\">h_a</span> <span class=\"o\">:</span> <span class=\"n\">term</span><span class=\"o\">,</span>\n<span class=\"n\">h_A</span> <span class=\"n\">h_B</span> <span class=\"o\">:</span> <span class=\"n\">type</span><span class=\"o\">,</span>\n<span class=\"n\">h_a_1</span> <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"n\">h_</span><span class=\"err\">Γ</span> <span class=\"n\">h_a</span> <span class=\"n\">h_A</span>\n<span class=\"err\">⊢</span> <span class=\"n\">list</span><span class=\"bp\">.</span><span class=\"n\">nil</span> <span class=\"bp\">=</span> <span class=\"n\">list</span><span class=\"bp\">.</span><span class=\"n\">concat</span> <span class=\"n\">h_</span><span class=\"err\">Γ</span> <span class=\"n\">h_B</span> <span class=\"bp\">→</span> <span class=\"n\">and</span> <span class=\"n\">p</span> <span class=\"n\">q</span> <span class=\"bp\">=</span> <span class=\"n\">h_a</span> <span class=\"bp\">→</span> <span class=\"err\">Ω</span> <span class=\"bp\">=</span> <span class=\"n\">h_A</span> <span class=\"bp\">→</span> <span class=\"n\">h</span> <span class=\"bp\">==</span> <span class=\"bp\">_</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"n\">list</span><span class=\"bp\">.</span><span class=\"n\">nil</span> <span class=\"n\">p</span> <span class=\"err\">Ω</span>\n</code></pre></div>\n\n\n<p>a similar thing happens with <code>case list.cons {cases h, }</code></p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"n\">cases</span> <span class=\"n\">tactic</span> <span class=\"n\">failed</span><span class=\"o\">,</span> <span class=\"n\">unsupported</span> <span class=\"n\">equality</span> <span class=\"n\">between</span> <span class=\"n\">type</span> <span class=\"n\">and</span> <span class=\"n\">constructor</span> <span class=\"n\">indices</span>\n<span class=\"o\">(</span><span class=\"n\">only</span> <span class=\"n\">equalities</span> <span class=\"n\">between</span> <span class=\"n\">constructors</span> <span class=\"n\">and</span><span class=\"bp\">/</span><span class=\"n\">or</span> <span class=\"kn\">variables</span> <span class=\"n\">are</span> <span class=\"n\">supported</span><span class=\"o\">,</span> <span class=\"n\">try</span> <span class=\"n\">cases</span> <span class=\"n\">on</span> <span class=\"n\">the</span> <span class=\"n\">indices</span><span class=\"o\">):</span>\n<span class=\"err\">Γ</span><span class=\"bp\">_</span><span class=\"n\">hd</span> <span class=\"bp\">::</span> <span class=\"err\">Γ</span><span class=\"bp\">_</span><span class=\"n\">tl</span> <span class=\"bp\">=</span> <span class=\"n\">list</span><span class=\"bp\">.</span><span class=\"n\">concat</span> <span class=\"n\">h_</span><span class=\"err\">Γ</span> <span class=\"n\">h_B</span>\n\n<span class=\"n\">state</span><span class=\"o\">:</span>\n<span class=\"n\">p</span> <span class=\"n\">q</span> <span class=\"o\">:</span> <span class=\"n\">term</span><span class=\"o\">,</span>\n<span class=\"err\">Γ</span><span class=\"bp\">_</span><span class=\"n\">hd</span> <span class=\"o\">:</span> <span class=\"n\">type</span><span class=\"o\">,</span>\n<span class=\"err\">Γ</span><span class=\"bp\">_</span><span class=\"n\">tl</span> <span class=\"o\">:</span> <span class=\"n\">list</span> <span class=\"n\">type</span><span class=\"o\">,</span>\n<span class=\"err\">Γ</span><span class=\"bp\">_</span><span class=\"n\">ih</span> <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span><span class=\"bp\">_</span><span class=\"n\">tl</span> <span class=\"o\">(</span><span class=\"n\">and</span> <span class=\"n\">p</span> <span class=\"n\">q</span><span class=\"o\">)</span> <span class=\"err\">Ω</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span><span class=\"bp\">_</span><span class=\"n\">tl</span> <span class=\"n\">p</span> <span class=\"err\">Ω</span><span class=\"o\">,</span>\n<span class=\"n\">h</span> <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"o\">(</span><span class=\"err\">Γ</span><span class=\"bp\">_</span><span class=\"n\">hd</span> <span class=\"bp\">::</span> <span class=\"err\">Γ</span><span class=\"bp\">_</span><span class=\"n\">tl</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">and</span> <span class=\"n\">p</span> <span class=\"n\">q</span><span class=\"o\">)</span> <span class=\"err\">Ω</span><span class=\"o\">,</span>\n<span class=\"n\">h_</span><span class=\"err\">Γ</span> <span class=\"o\">:</span> <span class=\"kn\">context</span><span class=\"o\">,</span>\n<span class=\"n\">h_a</span> <span class=\"o\">:</span> <span class=\"n\">term</span><span class=\"o\">,</span>\n<span class=\"n\">h_A</span> <span class=\"n\">h_B</span> <span class=\"o\">:</span> <span class=\"n\">type</span><span class=\"o\">,</span>\n<span class=\"n\">h_a_1</span> <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"n\">h_</span><span class=\"err\">Γ</span> <span class=\"n\">h_a</span> <span class=\"n\">h_A</span>\n<span class=\"err\">⊢</span> <span class=\"err\">Γ</span><span class=\"bp\">_</span><span class=\"n\">hd</span> <span class=\"bp\">::</span> <span class=\"err\">Γ</span><span class=\"bp\">_</span><span class=\"n\">tl</span> <span class=\"bp\">=</span> <span class=\"n\">list</span><span class=\"bp\">.</span><span class=\"n\">concat</span> <span class=\"n\">h_</span><span class=\"err\">Γ</span> <span class=\"n\">h_B</span> <span class=\"bp\">→</span> <span class=\"n\">and</span> <span class=\"n\">p</span> <span class=\"n\">q</span> <span class=\"bp\">=</span> <span class=\"n\">h_a</span> <span class=\"bp\">→</span> <span class=\"err\">Ω</span> <span class=\"bp\">=</span> <span class=\"n\">h_A</span> <span class=\"bp\">→</span> <span class=\"n\">h</span> <span class=\"bp\">==</span> <span class=\"bp\">_</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"o\">(</span><span class=\"err\">Γ</span><span class=\"bp\">_</span><span class=\"n\">hd</span> <span class=\"bp\">::</span> <span class=\"err\">Γ</span><span class=\"bp\">_</span><span class=\"n\">tl</span><span class=\"o\">)</span> <span class=\"n\">p</span> <span class=\"err\">Ω</span>\n</code></pre></div>",
        "id": 198416027,
        "sender_full_name": "Billy Price",
        "timestamp": 1590135373
    },
    {
        "content": "<p><code>list.concat</code> isn't a constructor, and indeed the result of <code>list.concat</code> could even be <code>list.nil</code>.</p>",
        "id": 198423511,
        "sender_full_name": "Reid Barton",
        "timestamp": 1590141019
    },
    {
        "content": "<p>I would ditch the induction on <code>Γ</code>, and induct on <code>h</code> instead</p>",
        "id": 198423830,
        "sender_full_name": "Reid Barton",
        "timestamp": 1590141318
    },
    {
        "content": "<p>What is <code>mod</code> supposed to represent?</p>",
        "id": 198423873,
        "sender_full_name": "Reid Barton",
        "timestamp": 1590141335
    },
    {
        "content": "<p>Oh whoops, <code>list.concat</code> doesn't mean what it means in every other language. Nevertheless, the first point remains.</p>",
        "id": 198426221,
        "sender_full_name": "Reid Barton",
        "timestamp": 1590143147
    },
    {
        "content": "<p>haha yeah, also <code>list.append</code> is what I first thought <code>list.concat</code> would be</p>",
        "id": 198430001,
        "sender_full_name": "Billy Price",
        "timestamp": 1590146189
    },
    {
        "content": "<p><code>mod</code> adds a single junk type to the back of the context of a well-formed term</p>",
        "id": 198430085,
        "sender_full_name": "Billy Price",
        "timestamp": 1590146264
    },
    {
        "content": "<p>If I do <code>induction h</code> - I don't know how to deal with all of the irrelevant cases that could not construct the given term. For example the first case want me to show <code>WF Δ p 𝟙</code></p>",
        "id": 198430291,
        "sender_full_name": "Billy Price",
        "timestamp": 1590146419
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"255481\">Billy Price</span> <a href=\"#narrow/stream/236446-Type-theory/topic/Modelling.20a.20Type.20Theory.20in.20Lean/near/198412417\">said</a>:</p>\n<blockquote>\n<p>How can I be more eco-friendly and solve 10 different lemmas at the same time? (they all compile with the same proof)</p>\n</blockquote>\n<p>You can make a simple tactic like so:</p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"n\">meta</span> <span class=\"n\">def</span> <span class=\"n\">billy_tac</span> <span class=\"o\">:</span> <span class=\"n\">tactic</span> <span class=\"n\">unit</span> <span class=\"o\">:=</span> <span class=\"n\">do</span>\n<span class=\"bp\">`</span><span class=\"o\">[</span>\n<span class=\"n\">intro</span> <span class=\"n\">h</span><span class=\"o\">,</span>\n<span class=\"n\">induction</span> <span class=\"err\">Γ</span><span class=\"o\">,</span>\n  <span class=\"n\">case</span> <span class=\"n\">list</span><span class=\"bp\">.</span><span class=\"n\">nil</span> <span class=\"o\">:</span> <span class=\"o\">{</span><span class=\"n\">cases</span> <span class=\"n\">h</span><span class=\"o\">,</span> <span class=\"n\">assumption</span><span class=\"o\">},</span>\n  <span class=\"n\">case</span> <span class=\"n\">list</span><span class=\"bp\">.</span><span class=\"n\">cons</span> <span class=\"o\">:</span> <span class=\"n\">B</span> <span class=\"err\">Δ</span> <span class=\"n\">ih</span> <span class=\"o\">{</span><span class=\"n\">cases</span> <span class=\"n\">h</span><span class=\"o\">,</span> <span class=\"n\">assumption</span><span class=\"o\">,</span> <span class=\"n\">apply</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">mod</span><span class=\"o\">,</span> <span class=\"n\">apply</span> <span class=\"n\">ih</span><span class=\"o\">,</span> <span class=\"n\">assumption</span><span class=\"o\">},]</span>\n</code></pre></div>",
        "id": 198430453,
        "sender_full_name": "Alex J. Best",
        "timestamp": 1590146535
    },
    {
        "content": "<p>What does <code>mod</code> stand for then?</p>",
        "id": 198431945,
        "sender_full_name": "Reid Barton",
        "timestamp": 1590147795
    },
    {
        "content": "<p>I would have thought <code>WF</code> already has this property, am I missing something?</p>",
        "id": 198432027,
        "sender_full_name": "Reid Barton",
        "timestamp": 1590147848
    },
    {
        "content": "<p>Oh no, I was proving something else and thought I didn't have that - and then added this mod thing (modify context) and that complicated things</p>",
        "id": 198432870,
        "sender_full_name": "Billy Price",
        "timestamp": 1590148579
    },
    {
        "content": "<p>I think the <code>mod</code> constructor should be a theorem (usually called \"weakening\")</p>",
        "id": 198482667,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1590174726
    },
    {
        "content": "<p>I think I need quotients now to find the objects of my category - where can I find good examples of quotient types?</p>",
        "id": 198999237,
        "sender_full_name": "Billy Price",
        "timestamp": 1590657501
    },
    {
        "content": "<p><code>git grep quotient</code>?</p>",
        "id": 198999616,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1590657782
    },
    {
        "content": "<p>That didn't work but I have been searching - just found Zmod37.lean - perfect!</p>",
        "id": 199003821,
        "sender_full_name": "Billy Price",
        "timestamp": 1590660668
    },
    {
        "content": "<p>Just to comment that that file using <code>quotient</code>, which finds the equivalence relation using type class search, but there is also <code>quotient'</code>, which finds it via unification.</p>",
        "id": 199006032,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1590662321
    },
    {
        "content": "<p>What happens when you form a quotient type using a relation that's not an equivalence relation?</p>",
        "id": 199006477,
        "sender_full_name": "Billy Price",
        "timestamp": 1590662670
    },
    {
        "content": "<p>How does one lift a function <code>a -&gt; a -&gt; a -&gt; b</code> to a function <code>quotient r a -&gt; quotient r a -&gt; quotient r a -&gt; b</code> in a controlled way? I'm away of quot.lift - does this generalise in a manageable way?</p>",
        "id": 199477115,
        "sender_full_name": "Billy Price",
        "timestamp": 1591096928
    },
    {
        "content": "<p>There should be <code>quotient.lift\\3</code></p>",
        "id": 199477248,
        "sender_full_name": "Reid Barton",
        "timestamp": 1591097043
    },
    {
        "content": "<p>There isn't :(</p>",
        "id": 199479218,
        "sender_full_name": "Billy Price",
        "timestamp": 1591098371
    },
    {
        "content": "<p>Add it!</p>",
        "id": 199479535,
        "sender_full_name": "Reid Barton",
        "timestamp": 1591098559
    },
    {
        "content": "<p><span aria-label=\"grimacing\" class=\"emoji emoji-1f62c\" role=\"img\" title=\"grimacing\">:grimacing:</span> I'll try when I have time :(</p>",
        "id": 199480251,
        "sender_full_name": "Billy Price",
        "timestamp": 1591099049
    },
    {
        "content": "<p>Look at the proof of <code>lift2</code> and copy it</p>",
        "id": 199481644,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1591099963
    },
    {
        "content": "<p>or just use <code>lift</code> three times. It's not even a much worse proof obligation, it just has you vary one argument at a time instead of all three in one go</p>",
        "id": 199481899,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1591100099
    },
    {
        "content": "<p>I'm working with equivalence classes of provably equal closed terms, and I'm trying to define proofs about terms given some such equivalence classes - hence the need for lifting - but now I'm realising I maybe I should show \"if you have provably equal terms, you can interchange them in any proof\", then I could just apply that a bunch of times. But then I'm guessing I'd need to work in all of the constructors for terms - do I really need to repeat myself about every little thing for terms, but now about equivalence classes of terms?</p>",
        "id": 199487930,
        "sender_full_name": "Billy Price",
        "timestamp": 1591103209
    },
    {
        "content": "<p>Perhaps that was a bit rambly - here's what I have so far in two files, the second file is where I'm trying to do stuff with the equivalence classes of closed terms - which are called <code>tset A</code> for any <code>A  : type</code> (an abbreviation for \"type theory set\"). I feel like I should be able to coerce my tset's into closed_terms (which coerce into terms), so I can talk about <code>proof</code>'s about tsets - without having to quotient.lift everything each time. Is that possible?</p>",
        "id": 199492249,
        "sender_full_name": "Billy Price",
        "timestamp": 1591105348
    },
    {
        "content": "<p>TT.lean</p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"c\">/-</span><span class=\"cm\"></span>\n<span class=\"cm\">Definitions of a type theory</span>\n\n<span class=\"cm\">Author: Billy Price</span>\n<span class=\"cm\">-/</span>\n\n<span class=\"kn\">import</span> <span class=\"n\">data</span><span class=\"bp\">.</span><span class=\"n\">finset</span>\n<span class=\"kn\">namespace</span> <span class=\"n\">TT</span>\n\n<span class=\"kn\">inductive</span> <span class=\"n\">type</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span>\n<span class=\"bp\">|</span> <span class=\"n\">Unit</span> <span class=\"bp\">|</span> <span class=\"n\">Omega</span> <span class=\"bp\">|</span> <span class=\"n\">Prod</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"n\">B</span> <span class=\"o\">:</span> <span class=\"n\">type</span><span class=\"o\">)</span><span class=\"bp\">|</span> <span class=\"n\">Pow</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"o\">:</span> <span class=\"n\">type</span><span class=\"o\">)</span>\n\n<span class=\"kn\">notation</span> <span class=\"bp\">`</span><span class=\"err\">Ω</span><span class=\"bp\">`</span> <span class=\"o\">:=</span> <span class=\"n\">type</span><span class=\"bp\">.</span><span class=\"n\">Omega</span>\n<span class=\"n\">def</span> <span class=\"n\">Unit</span> <span class=\"o\">:=</span> <span class=\"n\">type</span><span class=\"bp\">.</span><span class=\"n\">Unit</span>\n<span class=\"kn\">infix</span> <span class=\"bp\">`××`</span><span class=\"o\">:</span><span class=\"n\">max</span> <span class=\"o\">:=</span> <span class=\"n\">type</span><span class=\"bp\">.</span><span class=\"n\">Prod</span>\n<span class=\"kn\">prefix</span> <span class=\"err\">𝒫</span> <span class=\"o\">:</span><span class=\"n\">max</span> <span class=\"o\">:=</span> <span class=\"n\">type</span><span class=\"bp\">.</span><span class=\"n\">Pow</span>\n\n<span class=\"n\">def</span> <span class=\"kn\">context</span> <span class=\"o\">:=</span> <span class=\"n\">list</span> <span class=\"n\">type</span>\n\n<span class=\"kn\">inductive</span> <span class=\"n\">term</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span>\n<span class=\"bp\">|</span> <span class=\"n\">star</span> <span class=\"o\">:</span> <span class=\"n\">term</span>\n<span class=\"bp\">|</span> <span class=\"n\">top</span>  <span class=\"o\">:</span> <span class=\"n\">term</span>\n<span class=\"bp\">|</span> <span class=\"n\">bot</span>  <span class=\"o\">:</span> <span class=\"n\">term</span>\n<span class=\"bp\">|</span> <span class=\"n\">and</span>  <span class=\"o\">:</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">term</span>\n<span class=\"bp\">|</span> <span class=\"n\">or</span>   <span class=\"o\">:</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">term</span>\n<span class=\"bp\">|</span> <span class=\"n\">imp</span>  <span class=\"o\">:</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">term</span>\n<span class=\"bp\">|</span> <span class=\"n\">elem</span> <span class=\"o\">:</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">term</span>\n<span class=\"bp\">|</span> <span class=\"n\">pair</span> <span class=\"o\">:</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">term</span>\n<span class=\"bp\">|</span> <span class=\"n\">var</span>  <span class=\"o\">:</span> <span class=\"bp\">ℕ</span> <span class=\"bp\">→</span> <span class=\"n\">term</span>\n<span class=\"bp\">|</span> <span class=\"n\">comp</span> <span class=\"o\">:</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">term</span>\n<span class=\"bp\">|</span> <span class=\"n\">all</span>  <span class=\"o\">:</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">term</span>\n<span class=\"bp\">|</span> <span class=\"n\">ex</span>   <span class=\"o\">:</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">term</span>\n\n<span class=\"c1\">-- * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *</span>\n<span class=\"c1\">-- Notation and derived operators</span>\n<span class=\"c1\">-- * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *</span>\n\n<span class=\"kn\">notation</span> <span class=\"bp\">`</span><span class=\"mi\">𝟘</span><span class=\"bp\">`</span> <span class=\"o\">:=</span> <span class=\"n\">term</span><span class=\"bp\">.</span><span class=\"n\">var</span> <span class=\"mi\">0</span>\n<span class=\"kn\">notation</span> <span class=\"bp\">`</span><span class=\"mi\">𝟙</span><span class=\"bp\">`</span> <span class=\"o\">:=</span> <span class=\"n\">term</span><span class=\"bp\">.</span><span class=\"n\">var</span> <span class=\"mi\">1</span>\n<span class=\"kn\">notation</span> <span class=\"bp\">`</span><span class=\"mi\">𝟚</span><span class=\"bp\">`</span> <span class=\"o\">:=</span> <span class=\"n\">term</span><span class=\"bp\">.</span><span class=\"n\">var</span> <span class=\"mi\">2</span>\n<span class=\"kn\">notation</span> <span class=\"bp\">`</span><span class=\"mi\">𝟛</span><span class=\"bp\">`</span> <span class=\"o\">:=</span> <span class=\"n\">term</span><span class=\"bp\">.</span><span class=\"n\">var</span> <span class=\"mi\">3</span>\n<span class=\"kn\">notation</span> <span class=\"bp\">`</span><span class=\"mi\">𝟜</span><span class=\"bp\">`</span> <span class=\"o\">:=</span> <span class=\"n\">term</span><span class=\"bp\">.</span><span class=\"n\">var</span> <span class=\"mi\">4</span>\n<span class=\"kn\">notation</span> <span class=\"bp\">`</span><span class=\"mi\">𝟝</span><span class=\"bp\">`</span> <span class=\"o\">:=</span> <span class=\"n\">term</span><span class=\"bp\">.</span><span class=\"n\">var</span> <span class=\"mi\">5</span>\n\n<span class=\"kn\">notation</span> <span class=\"bp\">`</span><span class=\"err\">⁎</span><span class=\"bp\">`</span> <span class=\"o\">:=</span> <span class=\"n\">term</span><span class=\"bp\">.</span><span class=\"n\">star</span>    <span class=\"c1\">-- input \\asterisk</span>\n<span class=\"kn\">notation</span> <span class=\"bp\">`</span><span class=\"err\">⊤</span><span class=\"bp\">`</span> <span class=\"o\">:=</span> <span class=\"n\">term</span><span class=\"bp\">.</span><span class=\"n\">top</span>     <span class=\"c1\">--       \\top</span>\n<span class=\"kn\">notation</span> <span class=\"bp\">`</span><span class=\"err\">⊥</span><span class=\"bp\">`</span> <span class=\"o\">:=</span> <span class=\"n\">term</span><span class=\"bp\">.</span><span class=\"n\">bot</span>     <span class=\"c1\">-- input \\bot</span>\n<span class=\"kn\">infixr</span> <span class=\"bp\">`</span> <span class=\"err\">⟹</span> <span class=\"bp\">`</span><span class=\"o\">:</span><span class=\"mi\">60</span> <span class=\"o\">:=</span> <span class=\"n\">term</span><span class=\"bp\">.</span><span class=\"n\">imp</span> <span class=\"c1\">-- input \\==&gt;</span>\n<span class=\"kn\">infixr</span> <span class=\"bp\">`</span> <span class=\"err\">⋀</span> <span class=\"bp\">`</span> <span class=\"o\">:</span><span class=\"mi\">70</span> <span class=\"o\">:=</span> <span class=\"n\">term</span><span class=\"bp\">.</span><span class=\"n\">and</span> <span class=\"c1\">-- input \\And or \\bigwedge</span>\n<span class=\"kn\">infixr</span> <span class=\"bp\">`</span> <span class=\"err\">⋁</span> <span class=\"bp\">`</span> <span class=\"o\">:</span><span class=\"mi\">59</span> <span class=\"o\">:=</span> <span class=\"n\">term</span><span class=\"bp\">.</span><span class=\"n\">or</span>  <span class=\"c1\">-- input \\Or or \\bigvee</span>\n\n<span class=\"n\">def</span> <span class=\"n\">not</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"o\">:</span> <span class=\"n\">term</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"n\">p</span> <span class=\"err\">⟹</span> <span class=\"err\">⊥</span>\n<span class=\"kn\">prefix</span> <span class=\"bp\">`</span><span class=\"err\">∼</span><span class=\"bp\">`</span><span class=\"o\">:</span><span class=\"n\">max</span> <span class=\"o\">:=</span> <span class=\"n\">not</span> <span class=\"c1\">-- input \\~</span>\n\n<span class=\"n\">def</span> <span class=\"n\">iff</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"n\">q</span><span class=\"o\">:</span> <span class=\"n\">term</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"err\">⟹</span> <span class=\"n\">q</span><span class=\"o\">)</span> <span class=\"err\">⋀</span> <span class=\"o\">(</span><span class=\"n\">q</span> <span class=\"err\">⟹</span> <span class=\"n\">p</span><span class=\"o\">)</span>\n<span class=\"kn\">infix</span> <span class=\"bp\">`</span> <span class=\"err\">⇔</span> <span class=\"bp\">`</span><span class=\"o\">:</span><span class=\"mi\">60</span> <span class=\"o\">:=</span> <span class=\"n\">iff</span> <span class=\"c1\">-- input \\&lt;=&gt;</span>\n\n<span class=\"kn\">infix</span> <span class=\"err\">∈</span> <span class=\"o\">:=</span> <span class=\"n\">term</span><span class=\"bp\">.</span><span class=\"n\">elem</span>\n<span class=\"kn\">infix</span> <span class=\"err\">∉</span> <span class=\"o\">:=</span> <span class=\"bp\">λ</span> <span class=\"n\">a</span> <span class=\"n\">α</span><span class=\"o\">,</span> <span class=\"n\">not</span> <span class=\"o\">(</span><span class=\"n\">term</span><span class=\"bp\">.</span><span class=\"n\">elem</span> <span class=\"n\">a</span> <span class=\"n\">α</span><span class=\"o\">)</span>\n<span class=\"kn\">notation</span> <span class=\"bp\">`</span><span class=\"err\">⟦</span><span class=\"bp\">`</span> <span class=\"n\">φ</span> <span class=\"bp\">`</span><span class=\"err\">⟧</span><span class=\"bp\">`</span> <span class=\"o\">:=</span> <span class=\"n\">term</span><span class=\"bp\">.</span><span class=\"n\">comp</span> <span class=\"n\">φ</span>\n\n<span class=\"kn\">notation</span> <span class=\"bp\">`</span><span class=\"err\">⟪</span><span class=\"bp\">`</span> <span class=\"n\">a</span> <span class=\"bp\">`</span><span class=\"o\">,</span><span class=\"bp\">`</span> <span class=\"n\">b</span> <span class=\"bp\">`</span><span class=\"err\">⟫</span><span class=\"bp\">`</span> <span class=\"o\">:=</span> <span class=\"n\">term</span><span class=\"bp\">.</span><span class=\"n\">pair</span> <span class=\"n\">a</span> <span class=\"n\">b</span>\n\n<span class=\"kn\">prefix</span> <span class=\"bp\">`∀</span><span class=\"err\">&#39;</span><span class=\"bp\">`</span><span class=\"o\">:</span><span class=\"mi\">1</span> <span class=\"o\">:=</span> <span class=\"n\">term</span><span class=\"bp\">.</span><span class=\"n\">all</span>\n<span class=\"kn\">prefix</span> <span class=\"bp\">`∃</span><span class=\"err\">&#39;</span><span class=\"bp\">`</span><span class=\"o\">:</span><span class=\"mi\">2</span> <span class=\"o\">:=</span> <span class=\"n\">term</span><span class=\"bp\">.</span><span class=\"n\">ex</span>\n\n<span class=\"n\">def</span> <span class=\"n\">eq</span> <span class=\"o\">(</span><span class=\"n\">a₁</span> <span class=\"n\">a₂</span> <span class=\"o\">:</span> <span class=\"n\">term</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">term</span> <span class=\"o\">:=</span> <span class=\"bp\">∀</span><span class=\"err\">&#39;</span> <span class=\"o\">(</span><span class=\"n\">a₁</span> <span class=\"err\">∈</span> <span class=\"mi\">𝟘</span><span class=\"o\">)</span> <span class=\"err\">⇔</span> <span class=\"o\">(</span><span class=\"n\">a₂</span> <span class=\"err\">∈</span> <span class=\"mi\">𝟘</span><span class=\"o\">)</span>\n<span class=\"kn\">infix</span> <span class=\"bp\">`</span><span class=\"err\">≃</span><span class=\"bp\">`</span> <span class=\"o\">:</span><span class=\"mi\">50</span> <span class=\"o\">:=</span> <span class=\"n\">eq</span>\n\n<span class=\"n\">def</span> <span class=\"n\">singleton</span> <span class=\"o\">(</span><span class=\"n\">a</span> <span class=\"o\">:</span> <span class=\"n\">term</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"err\">⟦</span><span class=\"n\">a</span> <span class=\"err\">≃</span> <span class=\"o\">(</span><span class=\"mi\">𝟘</span><span class=\"o\">)</span><span class=\"err\">⟧</span>\n\n<span class=\"n\">def</span> <span class=\"n\">ex_unique</span> <span class=\"o\">(</span><span class=\"n\">φ</span> <span class=\"o\">:</span> <span class=\"n\">term</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">term</span> <span class=\"o\">:=</span>\n  <span class=\"bp\">∃</span><span class=\"err\">&#39;</span> <span class=\"err\">⟦</span><span class=\"n\">φ</span><span class=\"err\">⟧</span> <span class=\"err\">≃</span> <span class=\"n\">singleton</span> <span class=\"o\">(</span><span class=\"mi\">𝟛</span><span class=\"o\">)</span>\n<span class=\"kn\">prefix</span> <span class=\"bp\">`∃!</span><span class=\"err\">&#39;</span><span class=\"bp\">`</span><span class=\"o\">:</span><span class=\"mi\">2</span> <span class=\"o\">:=</span> <span class=\"n\">ex_unique</span>\n\n<span class=\"n\">def</span> <span class=\"n\">subseteq</span> <span class=\"o\">(</span><span class=\"n\">α</span> <span class=\"o\">:</span> <span class=\"n\">term</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">β</span> <span class=\"o\">:</span> <span class=\"n\">term</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">term</span> <span class=\"o\">:=</span>\n  <span class=\"bp\">∀</span><span class=\"err\">&#39;</span> <span class=\"o\">(</span><span class=\"mi\">𝟘</span> <span class=\"err\">∈</span> <span class=\"n\">α</span><span class=\"o\">)</span> <span class=\"err\">⟹</span> <span class=\"o\">(</span><span class=\"mi\">𝟘</span> <span class=\"err\">∈</span> <span class=\"n\">β</span><span class=\"o\">)</span>\n<span class=\"kn\">infix</span> <span class=\"err\">⊆</span> <span class=\"o\">:=</span> <span class=\"n\">subseteq</span>\n\n<span class=\"n\">def</span> <span class=\"n\">set_prod</span> <span class=\"o\">{</span><span class=\"n\">A</span> <span class=\"n\">B</span> <span class=\"o\">:</span> <span class=\"n\">type</span><span class=\"o\">}</span> <span class=\"o\">(</span><span class=\"n\">α</span> <span class=\"n\">β</span> <span class=\"o\">:</span> <span class=\"n\">term</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">term</span> <span class=\"o\">:=</span>\n  <span class=\"err\">⟦</span><span class=\"bp\">∃</span><span class=\"err\">&#39;</span> <span class=\"bp\">∃</span><span class=\"err\">&#39;</span> <span class=\"o\">(</span><span class=\"mi\">𝟙</span> <span class=\"err\">∈</span> <span class=\"n\">α</span><span class=\"o\">)</span> <span class=\"err\">⋀</span> <span class=\"o\">(</span><span class=\"mi\">𝟘</span> <span class=\"err\">∈</span> <span class=\"n\">β</span><span class=\"o\">)</span> <span class=\"err\">⋀</span> <span class=\"o\">(</span><span class=\"mi\">𝟛</span> <span class=\"err\">≃</span> <span class=\"err\">⟪</span><span class=\"mi\">𝟚</span><span class=\"o\">,</span><span class=\"mi\">𝟙</span><span class=\"err\">⟫</span><span class=\"o\">)</span><span class=\"err\">⟧</span>\n\n<span class=\"c1\">-- * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *</span>\n<span class=\"kn\">open</span> <span class=\"n\">term</span>\n\n\n<span class=\"kn\">section</span> <span class=\"n\">wellformedness</span>\n\n  <span class=\"kn\">inductive</span> <span class=\"n\">WF</span> <span class=\"o\">:</span> <span class=\"kn\">context</span> <span class=\"bp\">→</span> <span class=\"n\">type</span> <span class=\"bp\">→</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"kt\">Prop</span>\n  <span class=\"bp\">|</span> <span class=\"n\">star</span> <span class=\"o\">{</span><span class=\"err\">Γ</span><span class=\"o\">}</span>         <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"n\">Unit</span> <span class=\"err\">⁎</span>\n  <span class=\"bp\">|</span> <span class=\"n\">top</span>  <span class=\"o\">{</span><span class=\"err\">Γ</span><span class=\"o\">}</span>         <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"err\">⊤</span>\n  <span class=\"bp\">|</span> <span class=\"n\">bot</span>  <span class=\"o\">{</span><span class=\"err\">Γ</span><span class=\"o\">}</span>         <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"err\">⊥</span>\n  <span class=\"bp\">|</span> <span class=\"n\">and</span>  <span class=\"o\">{</span><span class=\"err\">Γ</span> <span class=\"n\">p</span> <span class=\"n\">q</span><span class=\"o\">}</span>     <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"n\">p</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"n\">q</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"err\">⋀</span> <span class=\"n\">q</span><span class=\"o\">)</span>\n  <span class=\"bp\">|</span> <span class=\"n\">or</span>   <span class=\"o\">{</span><span class=\"err\">Γ</span> <span class=\"n\">p</span> <span class=\"n\">q</span><span class=\"o\">}</span>     <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"n\">p</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"n\">q</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"err\">⋁</span> <span class=\"n\">q</span><span class=\"o\">)</span>\n  <span class=\"bp\">|</span> <span class=\"n\">imp</span>  <span class=\"o\">{</span><span class=\"err\">Γ</span> <span class=\"n\">p</span> <span class=\"n\">q</span><span class=\"o\">}</span>     <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"n\">p</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"n\">q</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"err\">⟹</span> <span class=\"n\">q</span><span class=\"o\">)</span>\n  <span class=\"bp\">|</span> <span class=\"n\">elem</span> <span class=\"o\">{</span><span class=\"err\">Γ</span> <span class=\"n\">A</span> <span class=\"n\">a</span> <span class=\"n\">α</span><span class=\"o\">}</span>   <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"n\">A</span> <span class=\"n\">a</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"o\">(</span><span class=\"err\">𝒫</span> <span class=\"n\">A</span><span class=\"o\">)</span> <span class=\"n\">α</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"o\">(</span><span class=\"n\">a</span> <span class=\"err\">∈</span> <span class=\"n\">α</span><span class=\"o\">)</span>\n  <span class=\"bp\">|</span> <span class=\"n\">pair</span> <span class=\"o\">{</span><span class=\"err\">Γ</span> <span class=\"n\">A</span> <span class=\"n\">B</span> <span class=\"n\">a</span> <span class=\"n\">b</span><span class=\"o\">}</span> <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"n\">A</span> <span class=\"n\">a</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"n\">B</span> <span class=\"n\">b</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"bp\">××</span> <span class=\"n\">B</span><span class=\"o\">)</span> <span class=\"err\">⟪</span><span class=\"n\">a</span><span class=\"o\">,</span><span class=\"n\">b</span><span class=\"err\">⟫</span>\n  <span class=\"bp\">|</span> <span class=\"n\">var</span>  <span class=\"o\">{</span><span class=\"err\">Γ</span> <span class=\"n\">A</span> <span class=\"n\">n</span><span class=\"o\">}</span>     <span class=\"o\">:</span> <span class=\"n\">list</span><span class=\"bp\">.</span><span class=\"n\">nth</span> <span class=\"err\">Γ</span> <span class=\"n\">n</span> <span class=\"bp\">=</span> <span class=\"n\">some</span> <span class=\"n\">A</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"n\">A</span> <span class=\"o\">(</span><span class=\"n\">var</span> <span class=\"n\">n</span><span class=\"o\">)</span>\n  <span class=\"bp\">|</span> <span class=\"n\">comp</span> <span class=\"o\">{</span><span class=\"err\">Γ</span> <span class=\"n\">A</span> <span class=\"n\">φ</span><span class=\"o\">}</span>     <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"o\">(</span><span class=\"n\">A</span><span class=\"bp\">::</span><span class=\"err\">Γ</span><span class=\"o\">)</span> <span class=\"err\">Ω</span> <span class=\"n\">φ</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"o\">(</span><span class=\"err\">𝒫</span> <span class=\"n\">A</span><span class=\"o\">)</span> <span class=\"err\">⟦</span><span class=\"n\">φ</span><span class=\"err\">⟧</span>\n  <span class=\"bp\">|</span> <span class=\"n\">all</span>  <span class=\"o\">{</span><span class=\"err\">Γ</span> <span class=\"n\">A</span> <span class=\"n\">φ</span><span class=\"o\">}</span>     <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"o\">(</span><span class=\"n\">A</span><span class=\"bp\">::</span><span class=\"err\">Γ</span><span class=\"o\">)</span> <span class=\"err\">Ω</span> <span class=\"n\">φ</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"o\">(</span><span class=\"bp\">∀</span><span class=\"err\">&#39;</span> <span class=\"n\">φ</span><span class=\"o\">)</span>\n  <span class=\"bp\">|</span> <span class=\"n\">ex</span>   <span class=\"o\">{</span><span class=\"err\">Γ</span> <span class=\"n\">A</span> <span class=\"n\">φ</span><span class=\"o\">}</span>     <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"o\">(</span><span class=\"n\">A</span><span class=\"bp\">::</span><span class=\"err\">Γ</span><span class=\"o\">)</span> <span class=\"err\">Ω</span> <span class=\"n\">φ</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"o\">(</span><span class=\"bp\">∃</span><span class=\"err\">&#39;</span> <span class=\"n\">φ</span><span class=\"o\">)</span>\n\n\n  <span class=\"kn\">variable</span> <span class=\"o\">{</span><span class=\"err\">Γ</span> <span class=\"o\">:</span> <span class=\"kn\">context</span><span class=\"o\">}</span>\n  <span class=\"kn\">variables</span> <span class=\"n\">p</span> <span class=\"n\">q</span> <span class=\"n\">r</span> <span class=\"n\">φ</span> <span class=\"n\">a</span> <span class=\"n\">b</span> <span class=\"n\">α</span> <span class=\"o\">:</span> <span class=\"n\">term</span>\n  <span class=\"kn\">variables</span> <span class=\"o\">{</span><span class=\"n\">A</span> <span class=\"n\">B</span> <span class=\"err\">Ω&#39;</span> <span class=\"o\">:</span> <span class=\"n\">type</span><span class=\"o\">}</span>\n  <span class=\"c1\">-- Ω&#39; is just a fake/variable version of Ω so we don&#39;t need to bother proving</span>\n  <span class=\"c1\">-- that it must be Ω itself.</span>\n\n  <span class=\"n\">local</span> <span class=\"kn\">notation</span> <span class=\"bp\">`</span><span class=\"n\">ez</span><span class=\"bp\">`</span> <span class=\"o\">:=</span> <span class=\"k\">by</span> <span class=\"o\">{</span><span class=\"n\">intro</span> <span class=\"n\">h</span><span class=\"o\">,</span> <span class=\"n\">cases</span> <span class=\"n\">h</span><span class=\"o\">,</span> <span class=\"n\">assumption</span><span class=\"o\">}</span>\n  <span class=\"kn\">lemma</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">and_left</span>   <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω&#39;</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"err\">⋀</span> <span class=\"n\">q</span><span class=\"o\">)</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω&#39;</span> <span class=\"n\">p</span>               <span class=\"o\">:=</span> <span class=\"n\">ez</span>\n  <span class=\"kn\">lemma</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">and_right</span>  <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω&#39;</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"err\">⋀</span> <span class=\"n\">q</span><span class=\"o\">)</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω&#39;</span> <span class=\"n\">q</span>               <span class=\"o\">:=</span> <span class=\"n\">ez</span>\n  <span class=\"kn\">lemma</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">or_left</span>    <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω&#39;</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"err\">⋁</span> <span class=\"n\">q</span><span class=\"o\">)</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω&#39;</span> <span class=\"n\">p</span>               <span class=\"o\">:=</span> <span class=\"n\">ez</span>\n  <span class=\"kn\">lemma</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">or_right</span>   <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω&#39;</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"err\">⋁</span> <span class=\"n\">q</span><span class=\"o\">)</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω&#39;</span> <span class=\"n\">q</span>               <span class=\"o\">:=</span> <span class=\"n\">ez</span>\n  <span class=\"kn\">lemma</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">imp_left</span>   <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω&#39;</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"err\">⟹</span> <span class=\"n\">q</span><span class=\"o\">)</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω&#39;</span> <span class=\"n\">p</span>             <span class=\"o\">:=</span> <span class=\"n\">ez</span>\n  <span class=\"kn\">lemma</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">imp_right</span>  <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω&#39;</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"err\">⟹</span> <span class=\"n\">q</span><span class=\"o\">)</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω&#39;</span> <span class=\"n\">q</span>             <span class=\"o\">:=</span> <span class=\"n\">ez</span>\n  <span class=\"kn\">lemma</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">pair_left</span>  <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"bp\">××</span> <span class=\"n\">B</span><span class=\"o\">)</span> <span class=\"err\">⟪</span><span class=\"n\">a</span><span class=\"o\">,</span><span class=\"n\">b</span><span class=\"err\">⟫</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"n\">A</span> <span class=\"n\">a</span>            <span class=\"o\">:=</span> <span class=\"n\">ez</span>\n  <span class=\"kn\">lemma</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">pair_right</span> <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"bp\">××</span> <span class=\"n\">B</span><span class=\"o\">)</span> <span class=\"err\">⟪</span><span class=\"n\">a</span><span class=\"o\">,</span><span class=\"n\">b</span><span class=\"err\">⟫</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"n\">B</span> <span class=\"n\">b</span>            <span class=\"o\">:=</span> <span class=\"n\">ez</span>\n  <span class=\"kn\">lemma</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">comp_elim</span>  <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"o\">(</span><span class=\"err\">𝒫</span> <span class=\"n\">A</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"err\">⟦</span><span class=\"n\">φ</span><span class=\"err\">⟧</span><span class=\"o\">)</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"o\">(</span><span class=\"n\">A</span><span class=\"bp\">::</span><span class=\"err\">Γ</span><span class=\"o\">)</span> <span class=\"err\">Ω</span> <span class=\"n\">φ</span>          <span class=\"o\">:=</span> <span class=\"n\">ez</span>\n  <span class=\"kn\">lemma</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">all_elim</span>   <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω&#39;</span> <span class=\"o\">(</span><span class=\"bp\">∀</span><span class=\"err\">&#39;</span> <span class=\"n\">φ</span><span class=\"o\">)</span> <span class=\"bp\">→</span> <span class=\"bp\">∃</span> <span class=\"n\">A</span><span class=\"o\">:</span><span class=\"n\">type</span><span class=\"o\">,</span> <span class=\"n\">WF</span> <span class=\"o\">(</span><span class=\"n\">A</span><span class=\"bp\">::</span><span class=\"err\">Γ</span><span class=\"o\">)</span> <span class=\"err\">Ω&#39;</span> <span class=\"n\">φ</span> <span class=\"o\">:=</span>\n    <span class=\"k\">by</span> <span class=\"o\">{</span><span class=\"n\">intro</span> <span class=\"n\">h</span><span class=\"o\">,</span> <span class=\"n\">cases</span> <span class=\"n\">h</span><span class=\"o\">,</span> <span class=\"n\">constructor</span><span class=\"o\">,</span> <span class=\"n\">assumption</span><span class=\"o\">}</span>\n  <span class=\"kn\">lemma</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">ex_elim</span>    <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω&#39;</span> <span class=\"o\">(</span><span class=\"bp\">∀</span><span class=\"err\">&#39;</span> <span class=\"n\">φ</span><span class=\"o\">)</span> <span class=\"bp\">→</span> <span class=\"bp\">∃</span> <span class=\"n\">A</span><span class=\"o\">:</span><span class=\"n\">type</span><span class=\"o\">,</span> <span class=\"n\">WF</span> <span class=\"o\">(</span><span class=\"n\">A</span><span class=\"bp\">::</span><span class=\"err\">Γ</span><span class=\"o\">)</span> <span class=\"err\">Ω&#39;</span> <span class=\"n\">φ</span> <span class=\"o\">:=</span>\n    <span class=\"k\">by</span> <span class=\"o\">{</span><span class=\"n\">intro</span> <span class=\"n\">h</span><span class=\"o\">,</span> <span class=\"n\">cases</span> <span class=\"n\">h</span><span class=\"o\">,</span> <span class=\"n\">constructor</span><span class=\"o\">,</span> <span class=\"n\">assumption</span><span class=\"o\">}</span>\n  <span class=\"kn\">lemma</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">iff_intro</span> <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"n\">p</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"n\">q</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"err\">⇔</span> <span class=\"n\">q</span><span class=\"o\">)</span> <span class=\"o\">:=</span>\n    <span class=\"k\">by</span> <span class=\"o\">{</span><span class=\"n\">intros</span> <span class=\"n\">h₁</span> <span class=\"n\">h₂</span><span class=\"o\">,</span> <span class=\"n\">apply</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">and</span><span class=\"o\">,</span> <span class=\"n\">all_goals</span> <span class=\"o\">{</span><span class=\"n\">apply</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">imp</span><span class=\"o\">,</span> <span class=\"n\">assumption</span><span class=\"o\">,</span> <span class=\"n\">assumption</span><span class=\"o\">}}</span>\n  <span class=\"kn\">lemma</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">iff_elim</span> <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω&#39;</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"err\">⇔</span> <span class=\"n\">q</span><span class=\"o\">)</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω&#39;</span> <span class=\"n\">p</span> <span class=\"bp\">∧</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω&#39;</span> <span class=\"n\">q</span> <span class=\"o\">:=</span>\n    <span class=\"k\">by</span> <span class=\"o\">{</span><span class=\"n\">intro</span> <span class=\"n\">h</span><span class=\"o\">,</span> <span class=\"n\">apply</span> <span class=\"n\">and</span><span class=\"bp\">.</span><span class=\"n\">intro</span><span class=\"o\">,</span> <span class=\"n\">all_goals</span> <span class=\"o\">{</span><span class=\"n\">cases</span> <span class=\"n\">h</span><span class=\"o\">,</span> <span class=\"n\">cases</span> <span class=\"n\">h_a</span><span class=\"o\">,</span> <span class=\"n\">assumption</span><span class=\"o\">}}</span>\n  <span class=\"kn\">lemma</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">eq_intro</span> <span class=\"o\">{</span><span class=\"err\">Γ</span><span class=\"o\">}</span> <span class=\"o\">{</span><span class=\"n\">a₁</span> <span class=\"n\">a₂</span><span class=\"o\">}</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"o\">:</span> <span class=\"n\">type</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"o\">((</span><span class=\"err\">𝒫</span> <span class=\"n\">A</span><span class=\"o\">)</span> <span class=\"bp\">::</span> <span class=\"err\">Γ</span><span class=\"o\">)</span> <span class=\"n\">A</span> <span class=\"n\">a₁</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"o\">((</span><span class=\"err\">𝒫</span> <span class=\"n\">A</span><span class=\"o\">)</span> <span class=\"bp\">::</span> <span class=\"err\">Γ</span><span class=\"o\">)</span> <span class=\"n\">A</span> <span class=\"n\">a₂</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"o\">(</span><span class=\"n\">a₁</span> <span class=\"err\">≃</span> <span class=\"n\">a₂</span><span class=\"o\">)</span> <span class=\"o\">:=</span>\n    <span class=\"k\">by</span> <span class=\"o\">{</span><span class=\"n\">intros</span> <span class=\"n\">h₁</span> <span class=\"n\">h₂</span><span class=\"o\">,</span> <span class=\"n\">apply</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">all</span><span class=\"o\">,</span> <span class=\"n\">apply</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">iff_intro</span><span class=\"o\">,</span> <span class=\"n\">all_goals</span> <span class=\"o\">{</span><span class=\"n\">apply</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">elem</span><span class=\"o\">,</span> <span class=\"n\">assumption</span><span class=\"o\">,</span> <span class=\"n\">apply</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">var</span><span class=\"o\">,</span> <span class=\"n\">simp</span><span class=\"o\">}}</span>\n\n<span class=\"kn\">end</span> <span class=\"n\">wellformedness</span>\n\n<span class=\"kn\">section</span> <span class=\"n\">substitution</span>\n\n  <span class=\"n\">def</span> <span class=\"n\">lift</span> <span class=\"o\">(</span><span class=\"n\">d</span> <span class=\"o\">:</span> <span class=\"bp\">ℕ</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"bp\">ℕ</span> <span class=\"bp\">→</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">term</span>\n  <span class=\"bp\">|</span> <span class=\"n\">k</span> <span class=\"err\">⁎</span>          <span class=\"o\">:=</span> <span class=\"err\">⁎</span>\n  <span class=\"bp\">|</span> <span class=\"n\">k</span> <span class=\"err\">⊤</span>          <span class=\"o\">:=</span> <span class=\"err\">⊤</span>\n  <span class=\"bp\">|</span> <span class=\"n\">k</span> <span class=\"err\">⊥</span>          <span class=\"o\">:=</span> <span class=\"err\">⊥</span>\n  <span class=\"bp\">|</span> <span class=\"n\">k</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"err\">⋀</span> <span class=\"n\">q</span><span class=\"o\">)</span>    <span class=\"o\">:=</span> <span class=\"o\">(</span><span class=\"n\">lift</span> <span class=\"n\">k</span> <span class=\"n\">p</span><span class=\"o\">)</span> <span class=\"err\">⋀</span> <span class=\"o\">(</span><span class=\"n\">lift</span> <span class=\"n\">k</span> <span class=\"n\">q</span><span class=\"o\">)</span>\n  <span class=\"bp\">|</span> <span class=\"n\">k</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"err\">⋁</span> <span class=\"n\">q</span><span class=\"o\">)</span>    <span class=\"o\">:=</span> <span class=\"o\">(</span><span class=\"n\">lift</span> <span class=\"n\">k</span> <span class=\"n\">p</span><span class=\"o\">)</span> <span class=\"err\">⋁</span> <span class=\"o\">(</span><span class=\"n\">lift</span> <span class=\"n\">k</span> <span class=\"n\">q</span><span class=\"o\">)</span>\n  <span class=\"bp\">|</span> <span class=\"n\">k</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"err\">⟹</span> <span class=\"n\">q</span><span class=\"o\">)</span>   <span class=\"o\">:=</span> <span class=\"o\">(</span><span class=\"n\">lift</span> <span class=\"n\">k</span> <span class=\"n\">p</span><span class=\"o\">)</span> <span class=\"err\">⟹</span> <span class=\"o\">(</span><span class=\"n\">lift</span> <span class=\"n\">k</span> <span class=\"n\">q</span><span class=\"o\">)</span>\n  <span class=\"bp\">|</span> <span class=\"n\">k</span> <span class=\"o\">(</span><span class=\"n\">a</span> <span class=\"err\">∈</span> <span class=\"n\">α</span><span class=\"o\">)</span>    <span class=\"o\">:=</span> <span class=\"o\">(</span><span class=\"n\">lift</span> <span class=\"n\">k</span> <span class=\"n\">a</span><span class=\"o\">)</span> <span class=\"err\">∈</span> <span class=\"o\">(</span><span class=\"n\">lift</span> <span class=\"n\">k</span> <span class=\"n\">α</span><span class=\"o\">)</span>\n  <span class=\"bp\">|</span> <span class=\"n\">k</span> <span class=\"err\">⟪</span><span class=\"n\">a</span><span class=\"o\">,</span><span class=\"n\">b</span><span class=\"err\">⟫</span>      <span class=\"o\">:=</span> <span class=\"err\">⟪</span><span class=\"n\">lift</span> <span class=\"n\">k</span> <span class=\"n\">a</span><span class=\"o\">,</span> <span class=\"n\">lift</span> <span class=\"n\">k</span> <span class=\"n\">b</span><span class=\"err\">⟫</span>\n  <span class=\"bp\">|</span> <span class=\"n\">k</span> <span class=\"o\">(</span><span class=\"n\">var</span> <span class=\"n\">m</span><span class=\"o\">)</span>    <span class=\"o\">:=</span> <span class=\"k\">if</span> <span class=\"n\">m</span><span class=\"bp\">≥</span><span class=\"n\">k</span> <span class=\"k\">then</span> <span class=\"n\">var</span> <span class=\"o\">(</span><span class=\"n\">m</span><span class=\"bp\">+</span><span class=\"n\">d</span><span class=\"o\">)</span> <span class=\"k\">else</span> <span class=\"n\">var</span> <span class=\"n\">m</span>\n  <span class=\"bp\">|</span> <span class=\"n\">k</span> <span class=\"err\">⟦</span><span class=\"n\">φ</span><span class=\"err\">⟧</span>         <span class=\"o\">:=</span>    <span class=\"err\">⟦</span><span class=\"n\">lift</span> <span class=\"o\">(</span><span class=\"n\">k</span><span class=\"bp\">+</span><span class=\"mi\">1</span><span class=\"o\">)</span> <span class=\"n\">φ</span><span class=\"err\">⟧</span>\n  <span class=\"bp\">|</span> <span class=\"n\">k</span> <span class=\"o\">(</span><span class=\"bp\">∀</span><span class=\"err\">&#39;</span> <span class=\"n\">φ</span><span class=\"o\">)</span>     <span class=\"o\">:=</span> <span class=\"bp\">∀</span><span class=\"err\">&#39;</span> <span class=\"n\">lift</span> <span class=\"o\">(</span><span class=\"n\">k</span><span class=\"bp\">+</span><span class=\"mi\">1</span><span class=\"o\">)</span> <span class=\"n\">φ</span>\n  <span class=\"bp\">|</span> <span class=\"n\">k</span> <span class=\"o\">(</span><span class=\"bp\">∃</span><span class=\"err\">&#39;</span> <span class=\"n\">φ</span><span class=\"o\">)</span>     <span class=\"o\">:=</span> <span class=\"bp\">∃</span><span class=\"err\">&#39;</span> <span class=\"n\">lift</span> <span class=\"o\">(</span><span class=\"n\">k</span><span class=\"bp\">+</span><span class=\"mi\">1</span><span class=\"o\">)</span> <span class=\"n\">φ</span>\n\n  <span class=\"n\">def</span> <span class=\"n\">subst_nth</span> <span class=\"o\">:</span> <span class=\"bp\">ℕ</span> <span class=\"bp\">→</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">term</span>\n  <span class=\"bp\">|</span> <span class=\"n\">n</span> <span class=\"n\">x</span> <span class=\"err\">⁎</span>          <span class=\"o\">:=</span> <span class=\"err\">⁎</span>\n  <span class=\"bp\">|</span> <span class=\"n\">n</span> <span class=\"n\">x</span> <span class=\"err\">⊤</span>          <span class=\"o\">:=</span> <span class=\"err\">⊤</span>\n  <span class=\"bp\">|</span> <span class=\"n\">n</span> <span class=\"n\">x</span> <span class=\"err\">⊥</span>          <span class=\"o\">:=</span> <span class=\"err\">⊥</span>\n  <span class=\"bp\">|</span> <span class=\"n\">n</span> <span class=\"n\">x</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"err\">⋀</span> <span class=\"n\">q</span><span class=\"o\">)</span>    <span class=\"o\">:=</span> <span class=\"o\">(</span><span class=\"n\">subst_nth</span> <span class=\"n\">n</span> <span class=\"n\">x</span> <span class=\"n\">p</span><span class=\"o\">)</span> <span class=\"err\">⋀</span> <span class=\"o\">(</span><span class=\"n\">subst_nth</span> <span class=\"n\">n</span> <span class=\"n\">x</span> <span class=\"n\">q</span><span class=\"o\">)</span>\n  <span class=\"bp\">|</span> <span class=\"n\">n</span> <span class=\"n\">x</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"err\">⋁</span> <span class=\"n\">q</span><span class=\"o\">)</span>    <span class=\"o\">:=</span> <span class=\"o\">(</span><span class=\"n\">subst_nth</span> <span class=\"n\">n</span> <span class=\"n\">x</span> <span class=\"n\">p</span><span class=\"o\">)</span> <span class=\"err\">⋁</span> <span class=\"o\">(</span><span class=\"n\">subst_nth</span> <span class=\"n\">n</span> <span class=\"n\">x</span> <span class=\"n\">q</span><span class=\"o\">)</span>\n  <span class=\"bp\">|</span> <span class=\"n\">n</span> <span class=\"n\">x</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"err\">⟹</span> <span class=\"n\">q</span><span class=\"o\">)</span>  <span class=\"o\">:=</span> <span class=\"o\">(</span><span class=\"n\">subst_nth</span> <span class=\"n\">n</span> <span class=\"n\">x</span> <span class=\"n\">p</span><span class=\"o\">)</span> <span class=\"err\">⟹</span> <span class=\"o\">(</span><span class=\"n\">subst_nth</span> <span class=\"n\">n</span> <span class=\"n\">x</span> <span class=\"n\">q</span><span class=\"o\">)</span>\n  <span class=\"bp\">|</span> <span class=\"n\">n</span> <span class=\"n\">x</span> <span class=\"o\">(</span><span class=\"n\">a</span> <span class=\"err\">∈</span> <span class=\"n\">α</span><span class=\"o\">)</span>    <span class=\"o\">:=</span> <span class=\"o\">(</span><span class=\"n\">subst_nth</span> <span class=\"n\">n</span> <span class=\"n\">x</span> <span class=\"n\">a</span><span class=\"o\">)</span> <span class=\"err\">∈</span> <span class=\"o\">(</span><span class=\"n\">subst_nth</span> <span class=\"n\">n</span> <span class=\"n\">x</span> <span class=\"n\">α</span><span class=\"o\">)</span>\n  <span class=\"bp\">|</span> <span class=\"n\">n</span> <span class=\"n\">x</span> <span class=\"err\">⟪</span><span class=\"n\">a</span><span class=\"o\">,</span><span class=\"n\">c</span><span class=\"err\">⟫</span>      <span class=\"o\">:=</span> <span class=\"err\">⟪</span><span class=\"n\">subst_nth</span> <span class=\"n\">n</span> <span class=\"n\">x</span> <span class=\"n\">a</span><span class=\"o\">,</span> <span class=\"n\">subst_nth</span> <span class=\"n\">n</span> <span class=\"n\">x</span> <span class=\"n\">c</span><span class=\"err\">⟫</span>\n  <span class=\"bp\">|</span> <span class=\"n\">n</span> <span class=\"n\">x</span> <span class=\"o\">(</span><span class=\"n\">var</span> <span class=\"n\">m</span><span class=\"o\">)</span>    <span class=\"o\">:=</span> <span class=\"k\">if</span> <span class=\"n\">n</span><span class=\"bp\">=</span><span class=\"n\">m</span> <span class=\"k\">then</span> <span class=\"n\">x</span> <span class=\"k\">else</span> <span class=\"n\">var</span> <span class=\"n\">m</span>\n  <span class=\"bp\">|</span> <span class=\"n\">n</span> <span class=\"n\">x</span> <span class=\"err\">⟦</span><span class=\"n\">φ</span><span class=\"err\">⟧</span>         <span class=\"o\">:=</span>    <span class=\"err\">⟦</span><span class=\"n\">subst_nth</span> <span class=\"o\">(</span><span class=\"n\">n</span><span class=\"bp\">+</span><span class=\"mi\">1</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">lift</span> <span class=\"mi\">1</span> <span class=\"mi\">0</span> <span class=\"n\">x</span><span class=\"o\">)</span> <span class=\"n\">φ</span><span class=\"err\">⟧</span>\n  <span class=\"bp\">|</span> <span class=\"n\">n</span> <span class=\"n\">x</span> <span class=\"o\">(</span><span class=\"bp\">∀</span><span class=\"err\">&#39;</span> <span class=\"n\">φ</span><span class=\"o\">)</span>     <span class=\"o\">:=</span> <span class=\"bp\">∀</span><span class=\"err\">&#39;</span> <span class=\"o\">(</span><span class=\"n\">subst_nth</span> <span class=\"o\">(</span><span class=\"n\">n</span><span class=\"bp\">+</span><span class=\"mi\">1</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">lift</span> <span class=\"mi\">1</span> <span class=\"mi\">0</span> <span class=\"n\">x</span><span class=\"o\">)</span> <span class=\"n\">φ</span><span class=\"o\">)</span>\n  <span class=\"bp\">|</span> <span class=\"n\">n</span> <span class=\"n\">x</span> <span class=\"o\">(</span><span class=\"bp\">∃</span><span class=\"err\">&#39;</span> <span class=\"n\">φ</span><span class=\"o\">)</span>     <span class=\"o\">:=</span> <span class=\"bp\">∃</span><span class=\"err\">&#39;</span> <span class=\"o\">(</span><span class=\"n\">subst_nth</span> <span class=\"o\">(</span><span class=\"n\">n</span><span class=\"bp\">+</span><span class=\"mi\">1</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">lift</span> <span class=\"mi\">1</span> <span class=\"mi\">0</span> <span class=\"n\">x</span><span class=\"o\">)</span> <span class=\"n\">φ</span><span class=\"o\">)</span>\n\n  <span class=\"n\">def</span> <span class=\"n\">subst</span> <span class=\"o\">:=</span> <span class=\"n\">subst_nth</span> <span class=\"mi\">0</span>\n\n  <span class=\"kn\">notation</span>  <span class=\"n\">φ</span> <span class=\"bp\">`</span><span class=\"err\">⁅</span><span class=\"bp\">`</span> <span class=\"n\">b</span> <span class=\"bp\">`</span><span class=\"err\">⁆</span><span class=\"bp\">`</span> <span class=\"o\">:=</span> <span class=\"n\">subst</span> <span class=\"n\">b</span> <span class=\"n\">φ</span>\n\n  <span class=\"bp\">#</span><span class=\"n\">reduce</span> <span class=\"mi\">𝟘</span><span class=\"err\">⁅⊤</span> <span class=\"err\">⋀</span> <span class=\"err\">⊥⁆</span>\n  <span class=\"bp\">#</span><span class=\"n\">reduce</span> <span class=\"mi\">𝟙</span><span class=\"err\">⁅⊤</span> <span class=\"err\">⋀</span> <span class=\"err\">⊥⁆</span>\n\n<span class=\"kn\">end</span> <span class=\"n\">substitution</span>\n\n<span class=\"kn\">section</span> <span class=\"n\">proofs</span>\n\n  <span class=\"kn\">inductive</span> <span class=\"k\">proof</span> <span class=\"o\">:</span> <span class=\"kn\">context</span> <span class=\"bp\">→</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"kt\">Prop</span>\n  <span class=\"bp\">|</span> <span class=\"n\">axm</span>        <span class=\"o\">{</span><span class=\"err\">Γ</span> <span class=\"n\">φ</span><span class=\"o\">}</span>         <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"n\">φ</span> <span class=\"bp\">→</span> <span class=\"k\">proof</span> <span class=\"err\">Γ</span> <span class=\"n\">φ</span> <span class=\"n\">φ</span>\n  <span class=\"bp\">|</span> <span class=\"n\">vac</span>        <span class=\"o\">{</span><span class=\"err\">Γ</span> <span class=\"n\">φ</span><span class=\"o\">}</span>         <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"n\">φ</span> <span class=\"bp\">→</span> <span class=\"k\">proof</span> <span class=\"err\">Γ</span> <span class=\"n\">φ</span> <span class=\"err\">⊤</span>\n  <span class=\"bp\">|</span> <span class=\"n\">abs</span>        <span class=\"o\">{</span><span class=\"err\">Γ</span> <span class=\"n\">φ</span><span class=\"o\">}</span>         <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"n\">φ</span> <span class=\"bp\">→</span> <span class=\"k\">proof</span> <span class=\"err\">Γ</span> <span class=\"err\">⊥</span> <span class=\"n\">φ</span>\n  <span class=\"bp\">|</span> <span class=\"n\">and_intro</span>  <span class=\"o\">{</span><span class=\"err\">Γ</span> <span class=\"n\">p</span> <span class=\"n\">q</span> <span class=\"n\">r</span><span class=\"o\">}</span>     <span class=\"o\">:</span> <span class=\"k\">proof</span> <span class=\"err\">Γ</span> <span class=\"n\">p</span> <span class=\"n\">q</span> <span class=\"bp\">→</span> <span class=\"k\">proof</span> <span class=\"err\">Γ</span> <span class=\"n\">p</span> <span class=\"n\">r</span> <span class=\"bp\">→</span> <span class=\"k\">proof</span> <span class=\"err\">Γ</span> <span class=\"n\">p</span> <span class=\"o\">(</span><span class=\"n\">q</span> <span class=\"err\">⋀</span> <span class=\"n\">r</span><span class=\"o\">)</span>\n  <span class=\"bp\">|</span> <span class=\"n\">and_left</span>   <span class=\"o\">{</span><span class=\"err\">Γ</span><span class=\"o\">}</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"n\">q</span> <span class=\"n\">r</span><span class=\"o\">)</span>   <span class=\"o\">:</span> <span class=\"k\">proof</span> <span class=\"err\">Γ</span> <span class=\"n\">p</span> <span class=\"o\">(</span><span class=\"n\">q</span> <span class=\"err\">⋀</span> <span class=\"n\">r</span><span class=\"o\">)</span> <span class=\"bp\">→</span> <span class=\"k\">proof</span> <span class=\"err\">Γ</span> <span class=\"n\">p</span> <span class=\"n\">q</span>\n  <span class=\"bp\">|</span> <span class=\"n\">and_right</span>  <span class=\"o\">{</span><span class=\"err\">Γ</span><span class=\"o\">}</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"n\">q</span> <span class=\"n\">r</span><span class=\"o\">)</span>   <span class=\"o\">:</span> <span class=\"k\">proof</span> <span class=\"err\">Γ</span> <span class=\"n\">p</span> <span class=\"o\">(</span><span class=\"n\">q</span> <span class=\"err\">⋀</span> <span class=\"n\">r</span><span class=\"o\">)</span> <span class=\"bp\">→</span> <span class=\"k\">proof</span> <span class=\"err\">Γ</span> <span class=\"n\">p</span> <span class=\"n\">r</span>\n  <span class=\"bp\">|</span> <span class=\"n\">or_intro</span>   <span class=\"o\">{</span><span class=\"err\">Γ</span> <span class=\"n\">p</span> <span class=\"n\">q</span> <span class=\"n\">r</span><span class=\"o\">}</span>     <span class=\"o\">:</span> <span class=\"k\">proof</span> <span class=\"err\">Γ</span> <span class=\"n\">p</span> <span class=\"n\">r</span> <span class=\"bp\">→</span> <span class=\"k\">proof</span> <span class=\"err\">Γ</span> <span class=\"n\">q</span> <span class=\"n\">r</span> <span class=\"bp\">→</span> <span class=\"k\">proof</span> <span class=\"err\">Γ</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"err\">⋁</span> <span class=\"n\">q</span><span class=\"o\">)</span> <span class=\"n\">r</span>\n  <span class=\"bp\">|</span> <span class=\"n\">or_left</span>    <span class=\"o\">{</span><span class=\"err\">Γ</span><span class=\"o\">}</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"n\">q</span> <span class=\"n\">r</span><span class=\"o\">)</span>   <span class=\"o\">:</span> <span class=\"k\">proof</span> <span class=\"err\">Γ</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"err\">⋁</span> <span class=\"n\">q</span><span class=\"o\">)</span> <span class=\"n\">r</span> <span class=\"bp\">→</span> <span class=\"k\">proof</span> <span class=\"err\">Γ</span> <span class=\"n\">p</span> <span class=\"n\">r</span>\n  <span class=\"bp\">|</span> <span class=\"n\">or_right</span>   <span class=\"o\">{</span><span class=\"err\">Γ</span><span class=\"o\">}</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"n\">q</span> <span class=\"n\">r</span><span class=\"o\">)</span>   <span class=\"o\">:</span> <span class=\"k\">proof</span> <span class=\"err\">Γ</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"err\">⋁</span> <span class=\"n\">q</span><span class=\"o\">)</span> <span class=\"n\">r</span> <span class=\"bp\">→</span> <span class=\"k\">proof</span> <span class=\"err\">Γ</span> <span class=\"n\">q</span> <span class=\"n\">r</span>\n  <span class=\"bp\">|</span> <span class=\"n\">imp_to_and</span> <span class=\"o\">{</span><span class=\"err\">Γ</span> <span class=\"n\">p</span> <span class=\"n\">q</span> <span class=\"n\">r</span><span class=\"o\">}</span>     <span class=\"o\">:</span> <span class=\"k\">proof</span> <span class=\"err\">Γ</span> <span class=\"n\">p</span> <span class=\"o\">(</span><span class=\"n\">q</span> <span class=\"err\">⟹</span> <span class=\"n\">r</span><span class=\"o\">)</span> <span class=\"bp\">→</span> <span class=\"k\">proof</span> <span class=\"err\">Γ</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"err\">⋀</span> <span class=\"n\">q</span><span class=\"o\">)</span> <span class=\"n\">r</span>\n  <span class=\"bp\">|</span> <span class=\"n\">and_to_imp</span> <span class=\"o\">{</span><span class=\"err\">Γ</span> <span class=\"n\">p</span> <span class=\"n\">q</span> <span class=\"n\">r</span><span class=\"o\">}</span>     <span class=\"o\">:</span> <span class=\"k\">proof</span> <span class=\"err\">Γ</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"err\">⋀</span> <span class=\"n\">q</span><span class=\"o\">)</span> <span class=\"n\">r</span> <span class=\"bp\">→</span> <span class=\"k\">proof</span> <span class=\"err\">Γ</span> <span class=\"n\">p</span> <span class=\"o\">(</span><span class=\"n\">q</span> <span class=\"err\">⟹</span> <span class=\"n\">r</span><span class=\"o\">)</span>\n  <span class=\"bp\">|</span> <span class=\"n\">weakening</span>  <span class=\"o\">{</span><span class=\"err\">Γ</span> <span class=\"n\">φ</span> <span class=\"n\">ψ</span> <span class=\"n\">B</span><span class=\"o\">}</span>     <span class=\"o\">:</span> <span class=\"k\">proof</span> <span class=\"err\">Γ</span> <span class=\"n\">φ</span> <span class=\"n\">ψ</span> <span class=\"bp\">→</span> <span class=\"k\">proof</span> <span class=\"o\">(</span><span class=\"n\">list</span><span class=\"bp\">.</span><span class=\"n\">concat</span> <span class=\"err\">Γ</span> <span class=\"n\">B</span><span class=\"o\">)</span> <span class=\"n\">φ</span> <span class=\"n\">ψ</span>\n  <span class=\"bp\">|</span> <span class=\"n\">cut</span>        <span class=\"o\">{</span><span class=\"err\">Γ</span><span class=\"o\">}</span> <span class=\"o\">(</span><span class=\"n\">φ</span> <span class=\"n\">c</span> <span class=\"n\">ψ</span><span class=\"o\">)</span>   <span class=\"o\">:</span> <span class=\"k\">proof</span> <span class=\"err\">Γ</span> <span class=\"n\">φ</span> <span class=\"n\">c</span> <span class=\"bp\">→</span> <span class=\"k\">proof</span> <span class=\"err\">Γ</span> <span class=\"n\">c</span> <span class=\"n\">ψ</span> <span class=\"bp\">→</span> <span class=\"k\">proof</span> <span class=\"err\">Γ</span> <span class=\"n\">φ</span> <span class=\"n\">ψ</span>\n  <span class=\"bp\">|</span> <span class=\"n\">all_elim</span>   <span class=\"o\">{</span><span class=\"err\">Γ</span> <span class=\"n\">p</span> <span class=\"n\">φ</span> <span class=\"n\">B</span><span class=\"o\">}</span>     <span class=\"o\">:</span> <span class=\"k\">proof</span> <span class=\"err\">Γ</span> <span class=\"n\">p</span> <span class=\"o\">(</span><span class=\"bp\">∀</span><span class=\"err\">&#39;</span> <span class=\"n\">φ</span><span class=\"o\">)</span> <span class=\"bp\">→</span> <span class=\"k\">proof</span> <span class=\"o\">(</span><span class=\"n\">B</span><span class=\"bp\">::</span><span class=\"err\">Γ</span><span class=\"o\">)</span> <span class=\"n\">p</span> <span class=\"n\">φ</span>\n  <span class=\"bp\">|</span> <span class=\"n\">all_intro</span>  <span class=\"o\">{</span><span class=\"err\">Γ</span> <span class=\"n\">p</span> <span class=\"n\">φ</span><span class=\"o\">}</span> <span class=\"o\">(</span><span class=\"n\">B</span><span class=\"o\">)</span>   <span class=\"o\">:</span> <span class=\"k\">proof</span> <span class=\"o\">(</span><span class=\"n\">B</span><span class=\"bp\">::</span><span class=\"err\">Γ</span><span class=\"o\">)</span> <span class=\"n\">p</span> <span class=\"n\">φ</span> <span class=\"bp\">→</span> <span class=\"k\">proof</span> <span class=\"err\">Γ</span> <span class=\"n\">p</span> <span class=\"o\">(</span><span class=\"bp\">∀</span><span class=\"err\">&#39;</span> <span class=\"n\">φ</span><span class=\"o\">)</span>\n  <span class=\"bp\">|</span> <span class=\"n\">ex_elim</span>    <span class=\"o\">{</span><span class=\"err\">Γ</span> <span class=\"n\">p</span> <span class=\"n\">φ</span> <span class=\"n\">B</span><span class=\"o\">}</span>     <span class=\"o\">:</span> <span class=\"k\">proof</span> <span class=\"err\">Γ</span> <span class=\"n\">p</span> <span class=\"o\">(</span><span class=\"bp\">∃</span><span class=\"err\">&#39;</span> <span class=\"n\">φ</span><span class=\"o\">)</span> <span class=\"bp\">→</span> <span class=\"k\">proof</span> <span class=\"o\">(</span><span class=\"n\">B</span><span class=\"bp\">::</span><span class=\"err\">Γ</span><span class=\"o\">)</span> <span class=\"n\">p</span> <span class=\"n\">φ</span>\n  <span class=\"bp\">|</span> <span class=\"n\">ex_intro</span>   <span class=\"o\">{</span><span class=\"err\">Γ</span> <span class=\"n\">p</span> <span class=\"n\">φ</span> <span class=\"n\">B</span><span class=\"o\">}</span>     <span class=\"o\">:</span> <span class=\"k\">proof</span> <span class=\"o\">(</span><span class=\"n\">B</span><span class=\"bp\">::</span><span class=\"err\">Γ</span><span class=\"o\">)</span> <span class=\"n\">p</span> <span class=\"n\">φ</span> <span class=\"bp\">→</span> <span class=\"k\">proof</span> <span class=\"err\">Γ</span> <span class=\"n\">p</span> <span class=\"o\">(</span><span class=\"bp\">∃</span><span class=\"err\">&#39;</span> <span class=\"n\">φ</span><span class=\"o\">)</span>\n  <span class=\"bp\">|</span> <span class=\"n\">ext</span>                      <span class=\"o\">:</span> <span class=\"k\">proof</span> <span class=\"o\">[]</span> <span class=\"err\">⊤</span> <span class=\"err\">$</span> <span class=\"bp\">∀</span><span class=\"err\">&#39;</span> <span class=\"bp\">∀</span><span class=\"err\">&#39;</span> <span class=\"o\">(</span><span class=\"bp\">∀</span><span class=\"err\">&#39;</span> <span class=\"o\">(</span><span class=\"mi\">𝟘</span> <span class=\"err\">∈</span> <span class=\"mi\">𝟚</span><span class=\"o\">)</span> <span class=\"err\">⇔</span> <span class=\"o\">(</span><span class=\"mi\">𝟘</span> <span class=\"err\">∈</span> <span class=\"mi\">𝟙</span><span class=\"o\">))</span> <span class=\"err\">⟹</span> <span class=\"o\">(</span><span class=\"mi\">𝟙</span> <span class=\"err\">≃</span> <span class=\"mi\">𝟘</span><span class=\"o\">)</span>\n  <span class=\"bp\">|</span> <span class=\"n\">prop_ext</span>                 <span class=\"o\">:</span> <span class=\"k\">proof</span> <span class=\"o\">[]</span> <span class=\"err\">⊤</span> <span class=\"bp\">∀</span><span class=\"err\">&#39;</span> <span class=\"bp\">∀</span><span class=\"err\">&#39;</span> <span class=\"o\">(</span><span class=\"mi\">𝟙</span> <span class=\"err\">⇔</span> <span class=\"mi\">𝟘</span><span class=\"o\">)</span> <span class=\"err\">⟹</span> <span class=\"o\">(</span><span class=\"mi\">𝟚</span> <span class=\"err\">≃</span> <span class=\"mi\">𝟙</span><span class=\"o\">)</span>\n  <span class=\"bp\">|</span> <span class=\"n\">star_unique</span>              <span class=\"o\">:</span> <span class=\"k\">proof</span> <span class=\"o\">[]</span> <span class=\"err\">⊤</span> <span class=\"bp\">∀</span><span class=\"err\">&#39;</span> <span class=\"o\">(</span><span class=\"mi\">𝟙</span> <span class=\"err\">≃</span> <span class=\"err\">⁎</span><span class=\"o\">)</span>\n  <span class=\"bp\">|</span> <span class=\"n\">pair_exists_rep</span>          <span class=\"o\">:</span> <span class=\"k\">proof</span> <span class=\"o\">[]</span> <span class=\"err\">⊤</span> <span class=\"bp\">∀</span><span class=\"err\">&#39;</span> <span class=\"bp\">∃</span><span class=\"err\">&#39;</span> <span class=\"bp\">∃</span><span class=\"err\">&#39;</span> <span class=\"mi\">𝟚</span> <span class=\"err\">≃</span> <span class=\"err\">⟪</span><span class=\"mi\">𝟙</span><span class=\"o\">,</span><span class=\"mi\">𝟘</span><span class=\"err\">⟫</span>\n  <span class=\"bp\">|</span> <span class=\"n\">pair_distinct_rep</span>        <span class=\"o\">:</span> <span class=\"k\">proof</span> <span class=\"o\">[]</span> <span class=\"err\">⊤</span> <span class=\"bp\">∀</span><span class=\"err\">&#39;</span> <span class=\"bp\">∀</span><span class=\"err\">&#39;</span> <span class=\"bp\">∀</span><span class=\"err\">&#39;</span> <span class=\"bp\">∀</span><span class=\"err\">&#39;</span> <span class=\"o\">(</span><span class=\"err\">⟪</span><span class=\"mi\">𝟜</span><span class=\"o\">,</span><span class=\"mi\">𝟚</span><span class=\"err\">⟫</span> <span class=\"err\">≃</span> <span class=\"err\">⟪</span><span class=\"mi\">𝟛</span><span class=\"o\">,</span><span class=\"mi\">𝟙</span><span class=\"err\">⟫</span><span class=\"o\">)</span> <span class=\"err\">⟹</span> <span class=\"o\">(</span><span class=\"mi\">𝟜</span> <span class=\"err\">≃</span> <span class=\"mi\">𝟛</span> <span class=\"err\">⋀</span> <span class=\"mi\">𝟚</span> <span class=\"err\">≃</span> <span class=\"mi\">𝟙</span><span class=\"o\">)</span>\n  <span class=\"bp\">|</span> <span class=\"n\">apply</span>      <span class=\"o\">{</span><span class=\"err\">Γ</span> <span class=\"n\">B</span><span class=\"o\">}</span> <span class=\"o\">(</span><span class=\"n\">φ</span> <span class=\"n\">ψ</span> <span class=\"n\">b</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"n\">B</span> <span class=\"n\">b</span> <span class=\"bp\">→</span> <span class=\"k\">proof</span> <span class=\"o\">(</span><span class=\"n\">B</span><span class=\"bp\">::</span><span class=\"err\">Γ</span><span class=\"o\">)</span> <span class=\"n\">φ</span> <span class=\"n\">ψ</span> <span class=\"bp\">→</span> <span class=\"k\">proof</span> <span class=\"err\">Γ</span> <span class=\"o\">(</span><span class=\"n\">φ</span><span class=\"err\">⁅</span><span class=\"n\">b</span><span class=\"err\">⁆</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">ψ</span><span class=\"err\">⁅</span><span class=\"n\">b</span><span class=\"err\">⁆</span><span class=\"o\">)</span>\n  <span class=\"bp\">|</span> <span class=\"n\">comp</span>       <span class=\"o\">{</span><span class=\"err\">Γ</span> <span class=\"n\">φ</span> <span class=\"n\">A</span><span class=\"o\">}</span>       <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"o\">(</span><span class=\"n\">A</span><span class=\"bp\">::</span><span class=\"n\">A</span><span class=\"bp\">::</span><span class=\"err\">Γ</span><span class=\"o\">)</span> <span class=\"err\">Ω</span> <span class=\"n\">φ</span> <span class=\"bp\">→</span> <span class=\"k\">proof</span> <span class=\"err\">Γ</span> <span class=\"err\">⊤</span> <span class=\"o\">(</span><span class=\"bp\">∀</span><span class=\"err\">&#39;</span> <span class=\"o\">(</span><span class=\"mi\">𝟘</span> <span class=\"err\">∈</span> <span class=\"err\">⟦</span><span class=\"n\">φ</span><span class=\"err\">⟧</span><span class=\"o\">)</span> <span class=\"err\">⇔</span> <span class=\"o\">(</span><span class=\"n\">φ</span><span class=\"err\">⁅</span><span class=\"mi\">𝟙</span><span class=\"err\">⁆</span><span class=\"o\">))</span>\n\n  <span class=\"kn\">prefix</span> <span class=\"err\">⊢</span> <span class=\"o\">:=</span> <span class=\"k\">proof</span> <span class=\"o\">[]</span> <span class=\"err\">⊤</span>\n  <span class=\"kn\">infix</span> <span class=\"bp\">`</span> <span class=\"err\">⊢</span> <span class=\"bp\">`</span><span class=\"o\">:</span><span class=\"mi\">50</span> <span class=\"o\">:=</span> <span class=\"k\">proof</span> <span class=\"o\">[]</span>\n  <span class=\"kn\">notation</span> <span class=\"n\">φ</span> <span class=\"bp\">`</span> <span class=\"err\">⊢</span><span class=\"o\">[</span><span class=\"bp\">`</span> <span class=\"err\">Γ</span><span class=\"o\">:(</span><span class=\"n\">foldr</span> <span class=\"bp\">`</span><span class=\"o\">,</span><span class=\"bp\">`</span> <span class=\"o\">(</span><span class=\"n\">h</span> <span class=\"n\">t</span><span class=\"o\">,</span> <span class=\"n\">list</span><span class=\"bp\">.</span><span class=\"n\">cons</span> <span class=\"n\">h</span> <span class=\"n\">t</span><span class=\"o\">)</span> <span class=\"n\">list</span><span class=\"bp\">.</span><span class=\"n\">nil</span><span class=\"o\">)</span> <span class=\"bp\">`</span><span class=\"o\">]</span> <span class=\"bp\">`</span> <span class=\"n\">ψ</span> <span class=\"o\">:=</span> <span class=\"k\">proof</span> <span class=\"err\">Γ</span> <span class=\"n\">φ</span> <span class=\"n\">ψ</span>\n  <span class=\"kn\">notation</span> <span class=\"bp\">`</span><span class=\"err\">⊢</span><span class=\"o\">[</span><span class=\"bp\">`</span> <span class=\"err\">Γ</span><span class=\"o\">:(</span><span class=\"n\">foldr</span> <span class=\"bp\">`</span><span class=\"o\">,</span><span class=\"bp\">`</span> <span class=\"o\">(</span><span class=\"n\">h</span> <span class=\"n\">t</span><span class=\"o\">,</span> <span class=\"n\">list</span><span class=\"bp\">.</span><span class=\"n\">cons</span> <span class=\"n\">h</span> <span class=\"n\">t</span><span class=\"o\">)</span> <span class=\"n\">list</span><span class=\"bp\">.</span><span class=\"n\">nil</span><span class=\"o\">)</span> <span class=\"bp\">`</span><span class=\"o\">]</span> <span class=\"bp\">`</span> <span class=\"n\">ψ</span> <span class=\"o\">:=</span> <span class=\"k\">proof</span> <span class=\"err\">Γ</span> <span class=\"err\">⊤</span> <span class=\"n\">ψ</span>\n\n  <span class=\"kn\">variables</span> <span class=\"n\">p</span> <span class=\"n\">q</span> <span class=\"o\">:</span> <span class=\"n\">term</span>\n\n  <span class=\"bp\">#</span><span class=\"n\">reduce</span>   <span class=\"err\">⊢</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"err\">⋁</span> <span class=\"err\">∼</span><span class=\"n\">p</span><span class=\"o\">)</span>  <span class=\"c1\">-- proof [] ⊤ (or p (imp p ⊥))</span>\n  <span class=\"bp\">#</span><span class=\"n\">reduce</span> <span class=\"n\">q</span> <span class=\"err\">⊢</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"err\">⋁</span> <span class=\"err\">∼</span><span class=\"n\">p</span><span class=\"o\">)</span>  <span class=\"c1\">-- proof [] q (or p (imp p ⊥))</span>\n  <span class=\"bp\">#</span><span class=\"n\">reduce</span>   <span class=\"err\">⊢</span><span class=\"o\">[</span><span class=\"err\">Ω</span><span class=\"o\">,</span><span class=\"n\">Unit</span><span class=\"o\">]</span> <span class=\"n\">p</span> <span class=\"c1\">-- proof [Ω,Unit] ⊤ p</span>\n  <span class=\"bp\">#</span><span class=\"n\">reduce</span> <span class=\"n\">q</span> <span class=\"err\">⊢</span><span class=\"o\">[</span><span class=\"err\">Ω</span><span class=\"o\">,</span><span class=\"n\">Unit</span><span class=\"o\">]</span> <span class=\"n\">p</span> <span class=\"c1\">-- proof [Ω,Unit] q p</span>\n\n  <span class=\"kn\">variable</span> <span class=\"o\">{</span><span class=\"err\">Γ</span> <span class=\"o\">:</span> <span class=\"kn\">context</span><span class=\"o\">}</span>\n  <span class=\"kn\">variables</span> <span class=\"n\">φ</span> <span class=\"n\">ψ</span> <span class=\"o\">:</span> <span class=\"n\">term</span>\n\n  <span class=\"kn\">lemma</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">proof_left</span>  <span class=\"o\">:</span> <span class=\"k\">proof</span> <span class=\"err\">Γ</span> <span class=\"n\">φ</span> <span class=\"n\">ψ</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"n\">φ</span> <span class=\"o\">:=</span> <span class=\"n\">sorry</span>\n  <span class=\"kn\">lemma</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">proof_right</span> <span class=\"o\">:</span> <span class=\"k\">proof</span> <span class=\"err\">Γ</span> <span class=\"n\">φ</span> <span class=\"n\">ψ</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"n\">ψ</span> <span class=\"o\">:=</span> <span class=\"n\">sorry</span>\n\n<span class=\"kn\">end</span> <span class=\"n\">proofs</span>\n\n<span class=\"kn\">end</span> <span class=\"n\">TT</span>\n</code></pre></div>",
        "id": 199492282,
        "sender_full_name": "Billy Price",
        "timestamp": 1591105369
    },
    {
        "content": "<p>category.lean</p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"c\">/-</span><span class=\"cm\"></span>\n<span class=\"cm\">The associated category of a type theory</span>\n\n<span class=\"cm\">Author: Billy Price</span>\n<span class=\"cm\">-/</span>\n<span class=\"kn\">import</span> <span class=\"n\">category_theory</span><span class=\"bp\">.</span><span class=\"n\">category</span>\n<span class=\"kn\">import</span> <span class=\"n\">TT</span>\n\n<span class=\"kn\">namespace</span> <span class=\"n\">TT</span>\n\n<span class=\"kn\">section</span>\n  <span class=\"kn\">variable</span> <span class=\"n\">A</span> <span class=\"o\">:</span> <span class=\"n\">type</span>\n\n  <span class=\"n\">def</span> <span class=\"n\">closed</span> <span class=\"o\">:</span> <span class=\"n\">type</span> <span class=\"bp\">→</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"kt\">Prop</span> <span class=\"o\">:=</span> <span class=\"n\">WF</span> <span class=\"o\">[]</span>\n\n  <span class=\"n\">def</span> <span class=\"n\">closed_term</span> <span class=\"o\">:=</span> <span class=\"o\">{</span><span class=\"n\">a</span> <span class=\"o\">:</span> <span class=\"n\">term</span> <span class=\"bp\">//</span> <span class=\"n\">closed</span> <span class=\"n\">A</span> <span class=\"n\">a</span><span class=\"o\">}</span>\n\n  <span class=\"n\">def</span> <span class=\"n\">closed_term</span><span class=\"bp\">.</span><span class=\"n\">mk</span> <span class=\"o\">(</span><span class=\"n\">a</span> <span class=\"o\">:</span> <span class=\"n\">term</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">closed</span> <span class=\"n\">A</span> <span class=\"n\">a</span> <span class=\"bp\">→</span> <span class=\"n\">closed_term</span> <span class=\"n\">A</span><span class=\"o\">:=</span> <span class=\"n\">subtype</span><span class=\"bp\">.</span><span class=\"n\">mk</span> <span class=\"n\">a</span>\n\n  <span class=\"kn\">instance</span> <span class=\"n\">closed_term_has_coe</span> <span class=\"o\">:</span> <span class=\"n\">has_coe</span> <span class=\"o\">(</span><span class=\"n\">closed_term</span> <span class=\"n\">A</span><span class=\"o\">)</span> <span class=\"n\">term</span> <span class=\"o\">:=</span> <span class=\"n\">coe_subtype</span>\n\n  <span class=\"n\">def</span> <span class=\"n\">proof_eq</span> <span class=\"o\">(</span><span class=\"n\">a₁</span> <span class=\"n\">a₂</span> <span class=\"o\">:</span> <span class=\"n\">closed_term</span> <span class=\"n\">A</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"err\">⊢</span> <span class=\"o\">(</span><span class=\"n\">a₁</span> <span class=\"err\">≃</span> <span class=\"n\">a₂</span><span class=\"o\">)</span>\n\n  <span class=\"kn\">section</span> <span class=\"n\">equivalence_relation</span>\n\n  <span class=\"kn\">lemma</span> <span class=\"n\">proof_to_imp</span> <span class=\"o\">{</span><span class=\"err\">Γ</span> <span class=\"o\">:</span> <span class=\"kn\">context</span><span class=\"o\">}</span> <span class=\"o\">(</span><span class=\"n\">q</span> <span class=\"n\">r</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"k\">proof</span> <span class=\"err\">Γ</span> <span class=\"n\">q</span> <span class=\"n\">r</span> <span class=\"bp\">→</span> <span class=\"k\">proof</span> <span class=\"err\">Γ</span> <span class=\"err\">⊤</span> <span class=\"o\">(</span><span class=\"n\">q</span> <span class=\"err\">⟹</span> <span class=\"n\">r</span><span class=\"o\">)</span> <span class=\"o\">:=</span>\n  <span class=\"k\">begin</span>\n    <span class=\"n\">intro</span> <span class=\"n\">h₁</span><span class=\"o\">,</span>\n    <span class=\"n\">apply</span> <span class=\"k\">proof</span><span class=\"bp\">.</span><span class=\"n\">and_to_imp</span><span class=\"o\">,</span>\n    <span class=\"n\">apply</span> <span class=\"k\">proof</span><span class=\"bp\">.</span><span class=\"n\">cut</span> <span class=\"bp\">_</span> <span class=\"n\">q</span> <span class=\"bp\">_</span><span class=\"o\">,</span>\n    <span class=\"n\">apply</span> <span class=\"k\">proof</span><span class=\"bp\">.</span><span class=\"n\">and_right</span> <span class=\"bp\">_</span> <span class=\"err\">⊤</span> <span class=\"bp\">_</span><span class=\"o\">,</span>\n    <span class=\"n\">apply</span> <span class=\"k\">proof</span><span class=\"bp\">.</span><span class=\"n\">axm</span><span class=\"o\">,</span>\n    <span class=\"n\">apply</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">and</span><span class=\"o\">,</span>\n    <span class=\"n\">exact</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">top</span><span class=\"o\">,</span>\n    <span class=\"n\">apply</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">proof_left</span> <span class=\"n\">q</span> <span class=\"n\">r</span><span class=\"o\">,</span>\n    <span class=\"n\">tidy</span>\n  <span class=\"kn\">end</span>\n\n  <span class=\"kn\">theorem</span> <span class=\"n\">proof_eq_refl</span> <span class=\"o\">:</span> <span class=\"n\">reflexive</span> <span class=\"o\">(</span><span class=\"n\">proof_eq</span> <span class=\"n\">A</span><span class=\"o\">)</span> <span class=\"o\">:=</span>\n  <span class=\"k\">begin</span>\n    <span class=\"n\">intro</span> <span class=\"n\">a</span><span class=\"o\">,</span>\n    <span class=\"n\">unfold</span> <span class=\"n\">proof_eq</span><span class=\"o\">,</span>\n    <span class=\"n\">apply</span> <span class=\"k\">proof</span><span class=\"bp\">.</span><span class=\"n\">all_intro</span> <span class=\"err\">𝒫</span> <span class=\"n\">A</span><span class=\"o\">,</span>\n    <span class=\"n\">apply</span> <span class=\"k\">proof</span><span class=\"bp\">.</span><span class=\"n\">and_intro</span><span class=\"o\">,</span>\n    <span class=\"n\">all_goals</span>\n      <span class=\"o\">{</span>\n        <span class=\"n\">apply</span> <span class=\"n\">proof_to_imp</span><span class=\"o\">,</span>\n        <span class=\"n\">apply</span> <span class=\"k\">proof</span><span class=\"bp\">.</span><span class=\"n\">axm</span><span class=\"o\">,</span>\n        <span class=\"n\">apply</span> <span class=\"bp\">@</span><span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">elem</span> <span class=\"bp\">_</span> <span class=\"n\">A</span><span class=\"o\">,</span>\n        <span class=\"n\">sorry</span><span class=\"o\">,</span>\n        <span class=\"n\">apply</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">var</span><span class=\"o\">,</span>\n        <span class=\"n\">simp</span>\n      <span class=\"o\">}</span>\n  <span class=\"kn\">end</span>\n\n  <span class=\"kn\">theorem</span> <span class=\"n\">proof_eq_symm</span> <span class=\"o\">:</span> <span class=\"n\">symmetric</span> <span class=\"o\">(</span><span class=\"n\">proof_eq</span> <span class=\"n\">A</span><span class=\"o\">)</span> <span class=\"o\">:=</span>\n  <span class=\"k\">begin</span>\n    <span class=\"n\">intros</span> <span class=\"n\">a₁</span> <span class=\"n\">a₂</span> <span class=\"n\">H</span><span class=\"o\">,</span>\n    <span class=\"n\">apply</span> <span class=\"k\">proof</span><span class=\"bp\">.</span><span class=\"n\">all_intro</span> <span class=\"err\">𝒫</span> <span class=\"n\">A</span><span class=\"o\">,</span>\n    <span class=\"n\">apply</span> <span class=\"k\">proof</span><span class=\"bp\">.</span><span class=\"n\">and_intro</span><span class=\"o\">,</span>\n    <span class=\"n\">apply</span> <span class=\"k\">proof</span><span class=\"bp\">.</span><span class=\"n\">and_right</span> <span class=\"bp\">_</span> <span class=\"o\">((</span><span class=\"err\">↑</span><span class=\"n\">a₁</span> <span class=\"err\">∈</span> <span class=\"mi\">𝟘</span><span class=\"o\">)</span> <span class=\"err\">⟹</span> <span class=\"o\">(</span><span class=\"err\">↑</span><span class=\"n\">a₂</span> <span class=\"err\">∈</span> <span class=\"mi\">𝟘</span><span class=\"o\">))</span> <span class=\"bp\">_</span><span class=\"o\">,</span>\n    <span class=\"n\">apply</span> <span class=\"k\">proof</span><span class=\"bp\">.</span><span class=\"n\">all_elim</span><span class=\"o\">,</span>\n    <span class=\"n\">exact</span> <span class=\"n\">H</span><span class=\"o\">,</span>\n    <span class=\"n\">apply</span> <span class=\"k\">proof</span><span class=\"bp\">.</span><span class=\"n\">and_left</span> <span class=\"bp\">_</span> <span class=\"bp\">_</span> <span class=\"o\">((</span><span class=\"err\">↑</span><span class=\"n\">a₂</span> <span class=\"err\">∈</span> <span class=\"mi\">𝟘</span><span class=\"o\">)</span> <span class=\"err\">⟹</span> <span class=\"o\">(</span><span class=\"err\">↑</span><span class=\"n\">a₁</span> <span class=\"err\">∈</span> <span class=\"mi\">𝟘</span><span class=\"o\">)),</span>\n    <span class=\"n\">apply</span> <span class=\"k\">proof</span><span class=\"bp\">.</span><span class=\"n\">all_elim</span><span class=\"o\">,</span>\n    <span class=\"n\">exact</span> <span class=\"n\">H</span><span class=\"o\">,</span>\n  <span class=\"kn\">end</span>\n\n  <span class=\"kn\">theorem</span> <span class=\"n\">proof_eq_trans</span> <span class=\"o\">:</span> <span class=\"n\">transitive</span> <span class=\"o\">(</span><span class=\"n\">proof_eq</span> <span class=\"n\">A</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"n\">sorry</span>\n\n  <span class=\"kn\">theorem</span> <span class=\"n\">proof_eq_equiv</span> <span class=\"o\">:</span> <span class=\"n\">equivalence</span> <span class=\"o\">(</span><span class=\"n\">proof_eq</span> <span class=\"n\">A</span><span class=\"o\">)</span> <span class=\"o\">:=</span>\n    <span class=\"bp\">⟨</span><span class=\"n\">proof_eq_refl</span> <span class=\"n\">A</span><span class=\"o\">,</span> <span class=\"n\">proof_eq_symm</span> <span class=\"n\">A</span><span class=\"o\">,</span> <span class=\"n\">proof_eq_trans</span> <span class=\"n\">A</span><span class=\"bp\">⟩</span>\n\n  <span class=\"kn\">end</span> <span class=\"n\">equivalence_relation</span>\n\n  <span class=\"kn\">definition</span> <span class=\"n\">TT</span><span class=\"bp\">.</span><span class=\"n\">setoid</span> <span class=\"o\">:</span> <span class=\"n\">setoid</span> <span class=\"o\">(</span><span class=\"n\">closed_term</span> <span class=\"n\">A</span><span class=\"o\">)</span> <span class=\"o\">:=</span>\n    <span class=\"o\">{</span><span class=\"n\">r</span> <span class=\"o\">:=</span> <span class=\"n\">proof_eq</span> <span class=\"n\">A</span><span class=\"o\">,</span> <span class=\"n\">iseqv</span> <span class=\"o\">:=</span> <span class=\"n\">proof_eq_equiv</span> <span class=\"n\">A</span><span class=\"o\">}</span>\n\n  <span class=\"bp\">#</span><span class=\"kn\">check</span> <span class=\"n\">TT</span><span class=\"bp\">.</span><span class=\"n\">setoid</span>\n\n  <span class=\"n\">local</span> <span class=\"n\">attribute</span> <span class=\"o\">[</span><span class=\"kn\">instance</span><span class=\"o\">]</span> <span class=\"n\">TT</span><span class=\"bp\">.</span><span class=\"n\">setoid</span>\n\n\n  <span class=\"n\">def</span> <span class=\"n\">tset</span> <span class=\"o\">:=</span> <span class=\"n\">quotient</span> <span class=\"o\">(</span><span class=\"n\">TT</span><span class=\"bp\">.</span><span class=\"n\">setoid</span> <span class=\"n\">A</span><span class=\"o\">)</span>\n\n  <span class=\"n\">def</span> <span class=\"n\">to_tset</span> <span class=\"o\">:=</span> <span class=\"n\">quot</span><span class=\"bp\">.</span><span class=\"n\">mk</span> <span class=\"o\">(</span><span class=\"n\">proof_eq</span> <span class=\"n\">A</span><span class=\"o\">)</span>\n\n  <span class=\"n\">def</span> <span class=\"n\">coe_term_tset</span> <span class=\"o\">:</span> <span class=\"n\">has_coe</span> <span class=\"o\">(</span><span class=\"n\">closed_term</span> <span class=\"n\">A</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">tset</span> <span class=\"n\">A</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"bp\">⟨</span><span class=\"n\">to_tset</span> <span class=\"n\">A</span><span class=\"bp\">⟩</span>\n\n  <span class=\"n\">local</span> <span class=\"n\">attribute</span> <span class=\"o\">[</span><span class=\"kn\">instance</span><span class=\"o\">]</span> <span class=\"n\">coe_term_tset</span>\n\n  <span class=\"n\">def</span> <span class=\"n\">tset</span><span class=\"bp\">.</span><span class=\"n\">star</span> <span class=\"o\">:</span> <span class=\"n\">tset</span> <span class=\"n\">Unit</span> <span class=\"o\">:=</span>\n    <span class=\"k\">by</span> <span class=\"o\">{</span><span class=\"n\">apply</span> <span class=\"n\">to_tset</span><span class=\"o\">,</span> <span class=\"n\">apply</span> <span class=\"n\">closed_term</span><span class=\"bp\">.</span><span class=\"n\">mk</span> <span class=\"bp\">_</span> <span class=\"err\">⁎</span><span class=\"o\">,</span> <span class=\"n\">exact</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">star</span><span class=\"o\">}</span>\n\n<span class=\"kn\">end</span>\n\n<span class=\"kn\">section</span>\n\n  <span class=\"kn\">variables</span> <span class=\"o\">{</span><span class=\"n\">A</span> <span class=\"n\">B</span> <span class=\"o\">:</span> <span class=\"n\">type</span><span class=\"o\">}</span>\n\n  <span class=\"n\">def</span> <span class=\"n\">term_is_subset</span> <span class=\"o\">{</span><span class=\"n\">A</span> <span class=\"n\">B</span> <span class=\"o\">:</span> <span class=\"n\">type</span><span class=\"o\">}</span> <span class=\"o\">(</span><span class=\"n\">α</span> <span class=\"o\">:</span> <span class=\"n\">closed_term</span> <span class=\"n\">A</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">β</span> <span class=\"o\">:</span> <span class=\"n\">closed_term</span> <span class=\"n\">B</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">F</span> <span class=\"o\">:</span> <span class=\"n\">closed_term</span> <span class=\"err\">𝒫</span> <span class=\"o\">(</span><span class=\"n\">A</span><span class=\"bp\">××</span><span class=\"n\">B</span><span class=\"o\">))</span> <span class=\"o\">:</span> <span class=\"kt\">Prop</span> <span class=\"o\">:=</span>\n    <span class=\"err\">⊢</span> <span class=\"n\">F</span> <span class=\"err\">⊆</span> <span class=\"o\">(</span><span class=\"bp\">@</span><span class=\"n\">set_prod</span> <span class=\"n\">A</span> <span class=\"n\">B</span> <span class=\"n\">α</span> <span class=\"n\">β</span><span class=\"o\">)</span>\n\n  <span class=\"n\">def</span> <span class=\"n\">is_subset</span> <span class=\"o\">{</span><span class=\"n\">A</span> <span class=\"n\">B</span> <span class=\"o\">:</span> <span class=\"n\">type</span><span class=\"o\">}</span> <span class=\"o\">:</span> <span class=\"n\">tset</span> <span class=\"n\">A</span> <span class=\"bp\">→</span> <span class=\"n\">tset</span> <span class=\"n\">B</span> <span class=\"bp\">→</span> <span class=\"n\">tset</span> <span class=\"err\">𝒫</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"bp\">××</span> <span class=\"n\">B</span><span class=\"o\">)</span> <span class=\"bp\">→</span> <span class=\"kt\">Prop</span> <span class=\"o\">:=</span> <span class=\"n\">sorry</span>\n\n  <span class=\"n\">def</span> <span class=\"n\">term_is_graph</span> <span class=\"o\">{</span><span class=\"n\">A</span> <span class=\"n\">B</span><span class=\"o\">:</span> <span class=\"n\">type</span><span class=\"o\">}</span> <span class=\"o\">(</span><span class=\"n\">F</span> <span class=\"o\">:</span> <span class=\"n\">closed_term</span> <span class=\"err\">𝒫</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"bp\">××</span> <span class=\"n\">B</span><span class=\"o\">))</span> <span class=\"o\">(</span><span class=\"n\">α</span> <span class=\"o\">:</span> <span class=\"n\">closed_term</span> <span class=\"n\">A</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">β</span> <span class=\"o\">:</span> <span class=\"n\">closed_term</span> <span class=\"n\">B</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"kt\">Prop</span> <span class=\"o\">:=</span>\n    <span class=\"err\">⊢</span> <span class=\"bp\">∀</span><span class=\"err\">&#39;</span> <span class=\"o\">((</span><span class=\"mi\">𝟘</span> <span class=\"err\">∈</span> <span class=\"n\">α</span><span class=\"o\">)</span> <span class=\"err\">⟹</span> <span class=\"o\">(</span><span class=\"bp\">∃!</span><span class=\"err\">&#39;</span> <span class=\"err\">⟪</span><span class=\"mi\">𝟙</span><span class=\"o\">,</span><span class=\"mi\">𝟘</span><span class=\"err\">⟫</span> <span class=\"err\">∈</span> <span class=\"n\">F</span><span class=\"o\">))</span>\n\n  <span class=\"n\">def</span> <span class=\"n\">is_graph</span> <span class=\"o\">{</span><span class=\"n\">A</span> <span class=\"n\">B</span><span class=\"o\">:</span> <span class=\"n\">type</span><span class=\"o\">}</span> <span class=\"o\">:</span> <span class=\"n\">tset</span> <span class=\"n\">A</span> <span class=\"bp\">→</span> <span class=\"n\">tset</span> <span class=\"n\">B</span> <span class=\"bp\">→</span> <span class=\"n\">tset</span> <span class=\"err\">𝒫</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"bp\">××</span> <span class=\"n\">B</span><span class=\"o\">)</span> <span class=\"bp\">→</span> <span class=\"kt\">Prop</span> <span class=\"o\">:=</span> <span class=\"n\">sorry</span>\n\n<span class=\"kn\">end</span>\n\n<span class=\"kn\">end</span> <span class=\"n\">TT</span>\n\n<span class=\"kn\">namespace</span> <span class=\"n\">category_theory</span>\n\n  <span class=\"kn\">namespace</span> <span class=\"n\">TT</span>\n\n  <span class=\"kn\">open</span> <span class=\"n\">TT</span>\n\n  <span class=\"kn\">instance</span> <span class=\"n\">category</span> <span class=\"o\">:</span> <span class=\"n\">small_category</span> <span class=\"o\">(</span><span class=\"n\">tset</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"n\">sorry</span> <span class=\"c1\">-- lean unhappy with tset : type → Type : Type 1</span>\n\n  <span class=\"kn\">end</span> <span class=\"n\">TT</span>\n\n<span class=\"kn\">end</span> <span class=\"n\">category_theory</span>\n</code></pre></div>",
        "id": 199492351,
        "sender_full_name": "Billy Price",
        "timestamp": 1591105404
    },
    {
        "content": "<p>Now that I've explicitly type-parametrised <code>term.all</code>, I can't define my notation for equality. Any tips for that? I've done it with a placeholder but I don't think it will ever get inferred.</p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"n\">def</span> <span class=\"n\">leibniz_equal</span> <span class=\"o\">(</span><span class=\"n\">A</span><span class=\"o\">:</span><span class=\"n\">type</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">a₁</span> <span class=\"n\">a₂</span> <span class=\"o\">:</span> <span class=\"n\">term</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">term</span> <span class=\"o\">:=</span> <span class=\"bp\">∀</span><span class=\"err\">&#39;</span> <span class=\"n\">A</span> <span class=\"o\">((</span><span class=\"n\">lift</span> <span class=\"mi\">1</span> <span class=\"mi\">0</span> <span class=\"n\">a₁</span><span class=\"o\">)</span> <span class=\"err\">∈</span> <span class=\"mi\">𝟘</span><span class=\"o\">)</span> <span class=\"err\">⇔</span> <span class=\"o\">((</span><span class=\"n\">lift</span> <span class=\"mi\">1</span> <span class=\"mi\">0</span> <span class=\"n\">a₂</span><span class=\"o\">)</span> <span class=\"err\">∈</span> <span class=\"mi\">𝟘</span><span class=\"o\">)</span>\n<span class=\"kn\">infix</span> <span class=\"err\">≃</span> <span class=\"o\">:</span><span class=\"mi\">50</span> <span class=\"o\">:=</span> <span class=\"n\">leibniz_equal</span> <span class=\"bp\">_</span>\n</code></pre></div>",
        "id": 200207194,
        "sender_full_name": "Billy Price",
        "timestamp": 1591699774
    },
    {
        "content": "<p>To be fair this is exactly what equality in lean looks like</p>",
        "id": 200207771,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1591700197
    },
    {
        "content": "<p>If you want to omit it you will probably have to make it a builtin</p>",
        "id": 200207793,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1591700224
    },
    {
        "content": "<p>Your embedded language isn't going to get type inference so you should get used to ugly terms unless you start writing a deeply embedded proof assistant</p>",
        "id": 200207913,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1591700355
    },
    {
        "content": "<p>However there are ways to make use of tactics to allow reflecting lean exprs into your target language to make things a bit easier</p>",
        "id": 200207961,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1591700397
    },
    {
        "content": "<p>If the struggle is only with the use of <code>infix</code>, a reasonable workaround is to use something like</p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"kn\">notation</span> <span class=\"n\">a</span> <span class=\"bp\">`</span> <span class=\"err\">≃</span><span class=\"o\">[</span><span class=\"bp\">`</span><span class=\"o\">:</span><span class=\"n\">max</span> <span class=\"n\">A</span> <span class=\"bp\">`</span><span class=\"o\">]</span> <span class=\"bp\">`</span><span class=\"o\">:</span><span class=\"mi\">0</span> <span class=\"n\">b</span> <span class=\"o\">:=</span> <span class=\"n\">leibniz_equal</span> <span class=\"n\">A</span> <span class=\"n\">a</span> <span class=\"n\">b</span>\n</code></pre></div>",
        "id": 200208326,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1591700639
    },
    {
        "content": "<p>Cool thanks, I was just trying to design something like that.</p>",
        "id": 200209416,
        "sender_full_name": "Billy Price",
        "timestamp": 1591701420
    },
    {
        "content": "<p>I can't get my predefined <code>WF_rules</code> to work with <code>apply_rules</code> in the bottom lemma here. Note I have commented out <code>apply_rules [WF.and, WF.imp]</code>, which solves it, and those rules are part of WF_rules, so what's the issue? I get <code>no matching rule</code> on the line <code>apply_rules WF_rules</code>.</p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"c\">/-</span><span class=\"cm\"></span>\n<span class=\"cm\">Definitions of a type theory</span>\n\n<span class=\"cm\">Author: Billy Price</span>\n<span class=\"cm\">-/</span>\n\n<span class=\"kn\">import</span> <span class=\"n\">data</span><span class=\"bp\">.</span><span class=\"n\">finset</span>\n<span class=\"kn\">namespace</span> <span class=\"n\">TT</span>\n\n<span class=\"kn\">inductive</span> <span class=\"n\">type</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span>\n<span class=\"bp\">|</span> <span class=\"n\">Unit</span> <span class=\"bp\">|</span> <span class=\"n\">Omega</span> <span class=\"bp\">|</span> <span class=\"n\">Prod</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"n\">B</span> <span class=\"o\">:</span> <span class=\"n\">type</span><span class=\"o\">)</span><span class=\"bp\">|</span> <span class=\"n\">Pow</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"o\">:</span> <span class=\"n\">type</span><span class=\"o\">)</span>\n\n<span class=\"kn\">notation</span> <span class=\"bp\">`</span><span class=\"err\">Ω</span><span class=\"bp\">`</span> <span class=\"o\">:=</span> <span class=\"n\">type</span><span class=\"bp\">.</span><span class=\"n\">Omega</span>\n<span class=\"n\">def</span> <span class=\"n\">Unit</span> <span class=\"o\">:=</span> <span class=\"n\">type</span><span class=\"bp\">.</span><span class=\"n\">Unit</span>\n<span class=\"kn\">infix</span> <span class=\"bp\">`××`</span><span class=\"o\">:</span><span class=\"n\">max</span> <span class=\"o\">:=</span> <span class=\"n\">type</span><span class=\"bp\">.</span><span class=\"n\">Prod</span>\n<span class=\"kn\">notation</span> <span class=\"bp\">`</span><span class=\"err\">𝒫</span><span class=\"bp\">`</span><span class=\"n\">A</span> <span class=\"o\">:</span><span class=\"n\">max</span> <span class=\"o\">:=</span> <span class=\"n\">type</span><span class=\"bp\">.</span><span class=\"n\">Pow</span> <span class=\"n\">A</span>\n\n<span class=\"n\">def</span> <span class=\"kn\">context</span> <span class=\"o\">:=</span> <span class=\"n\">list</span> <span class=\"n\">type</span>\n\n<span class=\"kn\">inductive</span> <span class=\"n\">term</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span>\n<span class=\"bp\">|</span> <span class=\"n\">star</span> <span class=\"o\">:</span> <span class=\"n\">term</span>\n<span class=\"bp\">|</span> <span class=\"n\">top</span>  <span class=\"o\">:</span> <span class=\"n\">term</span>\n<span class=\"bp\">|</span> <span class=\"n\">bot</span>  <span class=\"o\">:</span> <span class=\"n\">term</span>\n<span class=\"bp\">|</span> <span class=\"n\">and</span>  <span class=\"o\">:</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">term</span>\n<span class=\"bp\">|</span> <span class=\"n\">or</span>   <span class=\"o\">:</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">term</span>\n<span class=\"bp\">|</span> <span class=\"n\">imp</span>  <span class=\"o\">:</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">term</span>\n<span class=\"bp\">|</span> <span class=\"n\">elem</span> <span class=\"o\">:</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">term</span>\n<span class=\"bp\">|</span> <span class=\"n\">pair</span> <span class=\"o\">:</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">term</span>\n<span class=\"bp\">|</span> <span class=\"n\">var</span>  <span class=\"o\">:</span> <span class=\"bp\">ℕ</span> <span class=\"bp\">→</span> <span class=\"n\">term</span>\n<span class=\"bp\">|</span> <span class=\"n\">comp</span> <span class=\"o\">:</span> <span class=\"n\">type</span> <span class=\"bp\">→</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">term</span>\n<span class=\"bp\">|</span> <span class=\"n\">all</span>  <span class=\"o\">:</span> <span class=\"n\">type</span> <span class=\"bp\">→</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">term</span>\n<span class=\"bp\">|</span> <span class=\"n\">ex</span>   <span class=\"o\">:</span> <span class=\"n\">type</span> <span class=\"bp\">→</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">term</span>\n\n<span class=\"kn\">open</span> <span class=\"n\">term</span>\n\n<span class=\"c1\">-- * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *</span>\n<span class=\"c1\">-- Notation and derived operators</span>\n<span class=\"c1\">-- * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *</span>\n\n<span class=\"kn\">notation</span> <span class=\"bp\">`</span><span class=\"mi\">𝟘</span><span class=\"bp\">`</span> <span class=\"o\">:=</span> <span class=\"n\">term</span><span class=\"bp\">.</span><span class=\"n\">var</span> <span class=\"mi\">0</span>\n<span class=\"kn\">notation</span> <span class=\"bp\">`</span><span class=\"mi\">𝟙</span><span class=\"bp\">`</span> <span class=\"o\">:=</span> <span class=\"n\">term</span><span class=\"bp\">.</span><span class=\"n\">var</span> <span class=\"mi\">1</span>\n<span class=\"kn\">notation</span> <span class=\"bp\">`</span><span class=\"mi\">𝟚</span><span class=\"bp\">`</span> <span class=\"o\">:=</span> <span class=\"n\">term</span><span class=\"bp\">.</span><span class=\"n\">var</span> <span class=\"mi\">2</span>\n<span class=\"kn\">notation</span> <span class=\"bp\">`</span><span class=\"mi\">𝟛</span><span class=\"bp\">`</span> <span class=\"o\">:=</span> <span class=\"n\">term</span><span class=\"bp\">.</span><span class=\"n\">var</span> <span class=\"mi\">3</span>\n<span class=\"kn\">notation</span> <span class=\"bp\">`</span><span class=\"mi\">𝟜</span><span class=\"bp\">`</span> <span class=\"o\">:=</span> <span class=\"n\">term</span><span class=\"bp\">.</span><span class=\"n\">var</span> <span class=\"mi\">4</span>\n<span class=\"kn\">notation</span> <span class=\"bp\">`</span><span class=\"mi\">𝟝</span><span class=\"bp\">`</span> <span class=\"o\">:=</span> <span class=\"n\">term</span><span class=\"bp\">.</span><span class=\"n\">var</span> <span class=\"mi\">5</span>\n\n<span class=\"kn\">notation</span> <span class=\"bp\">`</span><span class=\"err\">⁎</span><span class=\"bp\">`</span> <span class=\"o\">:=</span> <span class=\"n\">term</span><span class=\"bp\">.</span><span class=\"n\">star</span>    <span class=\"c1\">-- input \\asterisk</span>\n<span class=\"kn\">notation</span> <span class=\"bp\">`</span><span class=\"err\">⊤</span><span class=\"bp\">`</span> <span class=\"o\">:=</span> <span class=\"n\">term</span><span class=\"bp\">.</span><span class=\"n\">top</span>     <span class=\"c1\">--       \\top</span>\n<span class=\"kn\">notation</span> <span class=\"bp\">`</span><span class=\"err\">⊥</span><span class=\"bp\">`</span> <span class=\"o\">:=</span> <span class=\"n\">term</span><span class=\"bp\">.</span><span class=\"n\">bot</span>     <span class=\"c1\">-- input \\bot</span>\n<span class=\"kn\">infixr</span> <span class=\"bp\">`</span> <span class=\"err\">⟹</span> <span class=\"bp\">`</span><span class=\"o\">:</span><span class=\"mi\">60</span> <span class=\"o\">:=</span> <span class=\"n\">term</span><span class=\"bp\">.</span><span class=\"n\">imp</span> <span class=\"c1\">-- input \\==&gt;</span>\n<span class=\"kn\">infixr</span> <span class=\"bp\">`</span> <span class=\"err\">⋀</span> <span class=\"bp\">`</span> <span class=\"o\">:</span><span class=\"mi\">70</span> <span class=\"o\">:=</span> <span class=\"n\">term</span><span class=\"bp\">.</span><span class=\"n\">and</span> <span class=\"c1\">-- input \\And or \\bigwedge</span>\n<span class=\"kn\">infixr</span> <span class=\"bp\">`</span> <span class=\"err\">⋁</span> <span class=\"bp\">`</span> <span class=\"o\">:</span><span class=\"mi\">59</span> <span class=\"o\">:=</span> <span class=\"n\">term</span><span class=\"bp\">.</span><span class=\"n\">or</span>  <span class=\"c1\">-- input \\Or or \\bigvee</span>\n\n<span class=\"n\">def</span> <span class=\"n\">not</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"o\">:</span> <span class=\"n\">term</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"n\">p</span> <span class=\"err\">⟹</span> <span class=\"err\">⊥</span>\n<span class=\"kn\">prefix</span> <span class=\"bp\">`</span><span class=\"err\">∼</span><span class=\"bp\">`</span><span class=\"o\">:</span><span class=\"n\">max</span> <span class=\"o\">:=</span> <span class=\"n\">not</span> <span class=\"c1\">-- input \\~</span>\n\n<span class=\"n\">def</span> <span class=\"n\">iff</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"n\">q</span><span class=\"o\">:</span> <span class=\"n\">term</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"err\">⟹</span> <span class=\"n\">q</span><span class=\"o\">)</span> <span class=\"err\">⋀</span> <span class=\"o\">(</span><span class=\"n\">q</span> <span class=\"err\">⟹</span> <span class=\"n\">p</span><span class=\"o\">)</span>\n<span class=\"kn\">infix</span> <span class=\"bp\">`</span> <span class=\"err\">⇔</span> <span class=\"bp\">`</span><span class=\"o\">:</span><span class=\"mi\">60</span> <span class=\"o\">:=</span> <span class=\"n\">iff</span> <span class=\"c1\">-- input \\&lt;=&gt;</span>\n\n<span class=\"kn\">infix</span> <span class=\"err\">∈</span> <span class=\"o\">:=</span> <span class=\"n\">term</span><span class=\"bp\">.</span><span class=\"n\">elem</span>\n<span class=\"kn\">infix</span> <span class=\"err\">∉</span> <span class=\"o\">:=</span> <span class=\"bp\">λ</span> <span class=\"n\">a</span> <span class=\"n\">α</span><span class=\"o\">,</span> <span class=\"n\">not</span> <span class=\"o\">(</span><span class=\"n\">term</span><span class=\"bp\">.</span><span class=\"n\">elem</span> <span class=\"n\">a</span> <span class=\"n\">α</span><span class=\"o\">)</span>\n<span class=\"kn\">notation</span> <span class=\"bp\">`</span><span class=\"err\">⟦</span> <span class=\"bp\">`</span> <span class=\"n\">A</span> <span class=\"bp\">`</span> <span class=\"bp\">|</span> <span class=\"bp\">`</span> <span class=\"n\">φ</span> <span class=\"bp\">`</span> <span class=\"err\">⟧</span><span class=\"bp\">`</span> <span class=\"o\">:=</span> <span class=\"n\">term</span><span class=\"bp\">.</span><span class=\"n\">comp</span> <span class=\"n\">A</span> <span class=\"n\">φ</span>\n\n<span class=\"kn\">notation</span> <span class=\"bp\">`</span><span class=\"err\">⟪</span><span class=\"bp\">`</span> <span class=\"n\">a</span> <span class=\"bp\">`</span><span class=\"o\">,</span><span class=\"bp\">`</span> <span class=\"n\">b</span> <span class=\"bp\">`</span><span class=\"err\">⟫</span><span class=\"bp\">`</span> <span class=\"o\">:=</span> <span class=\"n\">term</span><span class=\"bp\">.</span><span class=\"n\">pair</span> <span class=\"n\">a</span> <span class=\"n\">b</span>\n\n<span class=\"kn\">notation</span> <span class=\"bp\">`∀</span><span class=\"err\">&#39;</span><span class=\"bp\">`</span> <span class=\"o\">:=</span> <span class=\"n\">term</span><span class=\"bp\">.</span><span class=\"n\">all</span>\n<span class=\"kn\">notation</span> <span class=\"bp\">`∃</span><span class=\"err\">&#39;</span><span class=\"bp\">`</span> <span class=\"o\">:=</span> <span class=\"n\">term</span><span class=\"bp\">.</span><span class=\"n\">ex</span>\n\n\n<span class=\"kn\">section</span> <span class=\"n\">substitution</span>\n\n  <span class=\"bp\">@</span><span class=\"o\">[</span><span class=\"n\">simp</span><span class=\"o\">]</span>\n  <span class=\"n\">def</span> <span class=\"n\">lift_d</span> <span class=\"o\">(</span><span class=\"n\">d</span> <span class=\"o\">:</span> <span class=\"bp\">ℕ</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"bp\">ℕ</span> <span class=\"bp\">→</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">term</span>\n  <span class=\"bp\">|</span> <span class=\"n\">k</span> <span class=\"err\">⁎</span>          <span class=\"o\">:=</span> <span class=\"err\">⁎</span>\n  <span class=\"bp\">|</span> <span class=\"n\">k</span> <span class=\"err\">⊤</span>          <span class=\"o\">:=</span> <span class=\"err\">⊤</span>\n  <span class=\"bp\">|</span> <span class=\"n\">k</span> <span class=\"err\">⊥</span>          <span class=\"o\">:=</span> <span class=\"err\">⊥</span>\n  <span class=\"bp\">|</span> <span class=\"n\">k</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"err\">⋀</span> <span class=\"n\">q</span><span class=\"o\">)</span>    <span class=\"o\">:=</span> <span class=\"o\">(</span><span class=\"n\">lift_d</span> <span class=\"n\">k</span> <span class=\"n\">p</span><span class=\"o\">)</span> <span class=\"err\">⋀</span> <span class=\"o\">(</span><span class=\"n\">lift_d</span> <span class=\"n\">k</span> <span class=\"n\">q</span><span class=\"o\">)</span>\n  <span class=\"bp\">|</span> <span class=\"n\">k</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"err\">⋁</span> <span class=\"n\">q</span><span class=\"o\">)</span>    <span class=\"o\">:=</span> <span class=\"o\">(</span><span class=\"n\">lift_d</span> <span class=\"n\">k</span> <span class=\"n\">p</span><span class=\"o\">)</span> <span class=\"err\">⋁</span> <span class=\"o\">(</span><span class=\"n\">lift_d</span> <span class=\"n\">k</span> <span class=\"n\">q</span><span class=\"o\">)</span>\n  <span class=\"bp\">|</span> <span class=\"n\">k</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"err\">⟹</span> <span class=\"n\">q</span><span class=\"o\">)</span>   <span class=\"o\">:=</span> <span class=\"o\">(</span><span class=\"n\">lift_d</span> <span class=\"n\">k</span> <span class=\"n\">p</span><span class=\"o\">)</span> <span class=\"err\">⟹</span> <span class=\"o\">(</span><span class=\"n\">lift_d</span> <span class=\"n\">k</span> <span class=\"n\">q</span><span class=\"o\">)</span>\n  <span class=\"bp\">|</span> <span class=\"n\">k</span> <span class=\"o\">(</span><span class=\"n\">a</span> <span class=\"err\">∈</span> <span class=\"n\">α</span><span class=\"o\">)</span>    <span class=\"o\">:=</span> <span class=\"o\">(</span><span class=\"n\">lift_d</span> <span class=\"n\">k</span> <span class=\"n\">a</span><span class=\"o\">)</span> <span class=\"err\">∈</span> <span class=\"o\">(</span><span class=\"n\">lift_d</span> <span class=\"n\">k</span> <span class=\"n\">α</span><span class=\"o\">)</span>\n  <span class=\"bp\">|</span> <span class=\"n\">k</span> <span class=\"err\">⟪</span><span class=\"n\">a</span><span class=\"o\">,</span><span class=\"n\">b</span><span class=\"err\">⟫</span>      <span class=\"o\">:=</span> <span class=\"err\">⟪</span><span class=\"n\">lift_d</span> <span class=\"n\">k</span> <span class=\"n\">a</span><span class=\"o\">,</span> <span class=\"n\">lift_d</span> <span class=\"n\">k</span> <span class=\"n\">b</span><span class=\"err\">⟫</span>\n  <span class=\"bp\">|</span> <span class=\"n\">k</span> <span class=\"o\">(</span><span class=\"n\">var</span> <span class=\"n\">m</span><span class=\"o\">)</span>    <span class=\"o\">:=</span> <span class=\"k\">if</span> <span class=\"n\">m</span><span class=\"bp\">≥</span><span class=\"n\">k</span> <span class=\"k\">then</span> <span class=\"n\">var</span> <span class=\"o\">(</span><span class=\"n\">m</span><span class=\"bp\">+</span><span class=\"n\">d</span><span class=\"o\">)</span> <span class=\"k\">else</span> <span class=\"n\">var</span> <span class=\"n\">m</span>\n  <span class=\"bp\">|</span> <span class=\"n\">k</span> <span class=\"err\">⟦</span><span class=\"n\">A</span> <span class=\"bp\">|</span> <span class=\"n\">φ</span><span class=\"err\">⟧</span>     <span class=\"o\">:=</span>    <span class=\"err\">⟦</span><span class=\"n\">A</span> <span class=\"bp\">|</span> <span class=\"n\">lift_d</span> <span class=\"o\">(</span><span class=\"n\">k</span><span class=\"bp\">+</span><span class=\"mi\">1</span><span class=\"o\">)</span> <span class=\"n\">φ</span><span class=\"err\">⟧</span>\n  <span class=\"bp\">|</span> <span class=\"n\">k</span> <span class=\"o\">(</span><span class=\"bp\">∀</span><span class=\"err\">&#39;</span> <span class=\"n\">A</span> <span class=\"n\">φ</span><span class=\"o\">)</span>   <span class=\"o\">:=</span> <span class=\"bp\">∀</span><span class=\"err\">&#39;</span> <span class=\"n\">A</span> <span class=\"err\">$</span> <span class=\"n\">lift_d</span> <span class=\"o\">(</span><span class=\"n\">k</span><span class=\"bp\">+</span><span class=\"mi\">1</span><span class=\"o\">)</span> <span class=\"n\">φ</span>\n  <span class=\"bp\">|</span> <span class=\"n\">k</span> <span class=\"o\">(</span><span class=\"bp\">∃</span><span class=\"err\">&#39;</span> <span class=\"n\">A</span> <span class=\"n\">φ</span><span class=\"o\">)</span>   <span class=\"o\">:=</span> <span class=\"bp\">∃</span><span class=\"err\">&#39;</span> <span class=\"n\">A</span> <span class=\"err\">$</span> <span class=\"n\">lift_d</span> <span class=\"o\">(</span><span class=\"n\">k</span><span class=\"bp\">+</span><span class=\"mi\">1</span><span class=\"o\">)</span> <span class=\"n\">φ</span>\n\n  <span class=\"bp\">@</span><span class=\"o\">[</span><span class=\"n\">simp</span><span class=\"o\">]</span>\n  <span class=\"n\">def</span> <span class=\"n\">lift</span> <span class=\"o\">:=</span> <span class=\"n\">lift_d</span> <span class=\"mi\">1</span> <span class=\"mi\">0</span>\n\n  <span class=\"bp\">@</span><span class=\"o\">[</span><span class=\"n\">simp</span><span class=\"o\">]</span>\n  <span class=\"n\">def</span> <span class=\"n\">subst</span> <span class=\"o\">:</span> <span class=\"bp\">ℕ</span> <span class=\"bp\">→</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">term</span>\n  <span class=\"bp\">|</span> <span class=\"n\">n</span> <span class=\"n\">x</span> <span class=\"err\">⁎</span>          <span class=\"o\">:=</span> <span class=\"err\">⁎</span>\n  <span class=\"bp\">|</span> <span class=\"n\">n</span> <span class=\"n\">x</span> <span class=\"err\">⊤</span>          <span class=\"o\">:=</span> <span class=\"err\">⊤</span>\n  <span class=\"bp\">|</span> <span class=\"n\">n</span> <span class=\"n\">x</span> <span class=\"err\">⊥</span>          <span class=\"o\">:=</span> <span class=\"err\">⊥</span>\n  <span class=\"bp\">|</span> <span class=\"n\">n</span> <span class=\"n\">x</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"err\">⋀</span> <span class=\"n\">q</span><span class=\"o\">)</span>    <span class=\"o\">:=</span> <span class=\"o\">(</span><span class=\"n\">subst</span> <span class=\"n\">n</span> <span class=\"n\">x</span> <span class=\"n\">p</span><span class=\"o\">)</span> <span class=\"err\">⋀</span> <span class=\"o\">(</span><span class=\"n\">subst</span> <span class=\"n\">n</span> <span class=\"n\">x</span> <span class=\"n\">q</span><span class=\"o\">)</span>\n  <span class=\"bp\">|</span> <span class=\"n\">n</span> <span class=\"n\">x</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"err\">⋁</span> <span class=\"n\">q</span><span class=\"o\">)</span>    <span class=\"o\">:=</span> <span class=\"o\">(</span><span class=\"n\">subst</span> <span class=\"n\">n</span> <span class=\"n\">x</span> <span class=\"n\">p</span><span class=\"o\">)</span> <span class=\"err\">⋁</span> <span class=\"o\">(</span><span class=\"n\">subst</span> <span class=\"n\">n</span> <span class=\"n\">x</span> <span class=\"n\">q</span><span class=\"o\">)</span>\n  <span class=\"bp\">|</span> <span class=\"n\">n</span> <span class=\"n\">x</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"err\">⟹</span> <span class=\"n\">q</span><span class=\"o\">)</span>  <span class=\"o\">:=</span> <span class=\"o\">(</span><span class=\"n\">subst</span> <span class=\"n\">n</span> <span class=\"n\">x</span> <span class=\"n\">p</span><span class=\"o\">)</span> <span class=\"err\">⟹</span> <span class=\"o\">(</span><span class=\"n\">subst</span> <span class=\"n\">n</span> <span class=\"n\">x</span> <span class=\"n\">q</span><span class=\"o\">)</span>\n  <span class=\"bp\">|</span> <span class=\"n\">n</span> <span class=\"n\">x</span> <span class=\"o\">(</span><span class=\"n\">a</span> <span class=\"err\">∈</span> <span class=\"n\">α</span><span class=\"o\">)</span>    <span class=\"o\">:=</span> <span class=\"o\">(</span><span class=\"n\">subst</span> <span class=\"n\">n</span> <span class=\"n\">x</span> <span class=\"n\">a</span><span class=\"o\">)</span> <span class=\"err\">∈</span> <span class=\"o\">(</span><span class=\"n\">subst</span> <span class=\"n\">n</span> <span class=\"n\">x</span> <span class=\"n\">α</span><span class=\"o\">)</span>\n  <span class=\"bp\">|</span> <span class=\"n\">n</span> <span class=\"n\">x</span> <span class=\"err\">⟪</span><span class=\"n\">a</span><span class=\"o\">,</span><span class=\"n\">c</span><span class=\"err\">⟫</span>      <span class=\"o\">:=</span> <span class=\"err\">⟪</span><span class=\"n\">subst</span> <span class=\"n\">n</span> <span class=\"n\">x</span> <span class=\"n\">a</span><span class=\"o\">,</span> <span class=\"n\">subst</span> <span class=\"n\">n</span> <span class=\"n\">x</span> <span class=\"n\">c</span><span class=\"err\">⟫</span>\n  <span class=\"bp\">|</span> <span class=\"n\">n</span> <span class=\"n\">x</span> <span class=\"o\">(</span><span class=\"n\">var</span> <span class=\"n\">m</span><span class=\"o\">)</span>    <span class=\"o\">:=</span> <span class=\"k\">if</span> <span class=\"n\">n</span><span class=\"bp\">=</span><span class=\"n\">m</span> <span class=\"k\">then</span> <span class=\"n\">x</span> <span class=\"k\">else</span> <span class=\"n\">var</span> <span class=\"n\">m</span>\n  <span class=\"bp\">|</span> <span class=\"n\">n</span> <span class=\"n\">x</span> <span class=\"err\">⟦</span> <span class=\"n\">A</span> <span class=\"bp\">|</span> <span class=\"n\">φ</span> <span class=\"err\">⟧</span>   <span class=\"o\">:=</span>    <span class=\"err\">⟦</span><span class=\"n\">A</span> <span class=\"bp\">|</span> <span class=\"n\">subst</span> <span class=\"o\">(</span><span class=\"n\">n</span><span class=\"bp\">+</span><span class=\"mi\">1</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">lift</span> <span class=\"n\">x</span><span class=\"o\">)</span> <span class=\"n\">φ</span><span class=\"err\">⟧</span>\n  <span class=\"bp\">|</span> <span class=\"n\">n</span> <span class=\"n\">x</span> <span class=\"o\">(</span><span class=\"bp\">∀</span><span class=\"err\">&#39;</span> <span class=\"n\">A</span> <span class=\"n\">φ</span><span class=\"o\">)</span>     <span class=\"o\">:=</span> <span class=\"bp\">∀</span><span class=\"err\">&#39;</span> <span class=\"n\">A</span> <span class=\"o\">(</span><span class=\"n\">subst</span> <span class=\"o\">(</span><span class=\"n\">n</span><span class=\"bp\">+</span><span class=\"mi\">1</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">lift</span> <span class=\"n\">x</span><span class=\"o\">)</span> <span class=\"n\">φ</span><span class=\"o\">)</span>\n  <span class=\"bp\">|</span> <span class=\"n\">n</span> <span class=\"n\">x</span> <span class=\"o\">(</span><span class=\"bp\">∃</span><span class=\"err\">&#39;</span> <span class=\"n\">A</span> <span class=\"n\">φ</span><span class=\"o\">)</span>     <span class=\"o\">:=</span> <span class=\"bp\">∃</span><span class=\"err\">&#39;</span> <span class=\"n\">A</span> <span class=\"o\">(</span><span class=\"n\">subst</span> <span class=\"o\">(</span><span class=\"n\">n</span><span class=\"bp\">+</span><span class=\"mi\">1</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">lift</span> <span class=\"n\">x</span><span class=\"o\">)</span> <span class=\"n\">φ</span><span class=\"o\">)</span>\n\n  <span class=\"kn\">notation</span>  <span class=\"bp\">`</span><span class=\"err\">⁅</span><span class=\"bp\">`</span> <span class=\"n\">φ</span> <span class=\"bp\">`</span> <span class=\"bp\">//</span> <span class=\"bp\">`</span>  <span class=\"n\">b</span> <span class=\"bp\">`</span><span class=\"err\">⁆</span><span class=\"bp\">`</span> <span class=\"o\">:=</span> <span class=\"n\">subst</span> <span class=\"mi\">0</span> <span class=\"n\">b</span> <span class=\"n\">φ</span>\n\n  <span class=\"bp\">#</span><span class=\"n\">reduce</span> <span class=\"err\">⁅</span><span class=\"mi\">𝟘</span> <span class=\"bp\">//</span> <span class=\"err\">⊤</span> <span class=\"err\">⋀</span> <span class=\"err\">⊥⁆</span>\n  <span class=\"bp\">#</span><span class=\"n\">reduce</span> <span class=\"err\">⁅</span> <span class=\"mi\">𝟙</span> <span class=\"bp\">//</span> <span class=\"err\">⊤</span> <span class=\"err\">⋀</span> <span class=\"err\">⊥⁆</span>\n\n<span class=\"kn\">end</span> <span class=\"n\">substitution</span>\n\n<span class=\"n\">def</span> <span class=\"n\">eq</span> <span class=\"o\">(</span><span class=\"n\">A</span><span class=\"o\">:</span><span class=\"n\">type</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">a₁</span> <span class=\"n\">a₂</span> <span class=\"o\">:</span> <span class=\"n\">term</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">term</span> <span class=\"o\">:=</span> <span class=\"bp\">∀</span><span class=\"err\">&#39;</span> <span class=\"o\">(</span><span class=\"err\">𝒫</span> <span class=\"n\">A</span><span class=\"o\">)</span> <span class=\"err\">$</span> <span class=\"o\">((</span><span class=\"n\">lift</span> <span class=\"n\">a₁</span><span class=\"o\">)</span> <span class=\"err\">∈</span> <span class=\"mi\">𝟘</span><span class=\"o\">)</span> <span class=\"err\">⇔</span> <span class=\"o\">((</span><span class=\"n\">lift</span> <span class=\"n\">a₂</span><span class=\"o\">)</span> <span class=\"err\">∈</span> <span class=\"mi\">𝟘</span><span class=\"o\">)</span>\n<span class=\"kn\">notation</span> <span class=\"n\">a</span> <span class=\"bp\">`</span> <span class=\"err\">≃</span><span class=\"o\">[</span><span class=\"bp\">`</span><span class=\"o\">:</span><span class=\"n\">max</span> <span class=\"n\">A</span> <span class=\"bp\">`</span><span class=\"o\">]</span> <span class=\"bp\">`</span><span class=\"o\">:</span><span class=\"mi\">0</span> <span class=\"n\">b</span> <span class=\"o\">:=</span> <span class=\"n\">eq</span> <span class=\"n\">A</span> <span class=\"n\">a</span> <span class=\"n\">b</span>\n\n<span class=\"bp\">#</span><span class=\"kn\">check</span> <span class=\"n\">eq</span> <span class=\"n\">Unit</span> <span class=\"mi\">𝟘</span> <span class=\"mi\">𝟘</span>\n\n<span class=\"n\">def</span> <span class=\"n\">singleton</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"o\">:</span> <span class=\"n\">type</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">a</span> <span class=\"o\">:</span> <span class=\"n\">term</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"err\">⟦</span><span class=\"n\">A</span> <span class=\"bp\">|</span> <span class=\"o\">(</span><span class=\"n\">lift</span> <span class=\"n\">a</span><span class=\"o\">)</span> <span class=\"err\">≃</span><span class=\"o\">[</span><span class=\"n\">A</span><span class=\"o\">]</span> <span class=\"mi\">𝟘</span><span class=\"err\">⟧</span>\n\n<span class=\"n\">def</span> <span class=\"n\">ex_unique</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"o\">:</span> <span class=\"n\">type</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">φ</span> <span class=\"o\">:</span> <span class=\"n\">term</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">term</span> <span class=\"o\">:=</span>\n  <span class=\"bp\">∃</span><span class=\"err\">&#39;</span> <span class=\"n\">A</span> <span class=\"o\">(</span><span class=\"err\">⟦</span><span class=\"n\">A</span> <span class=\"bp\">|</span> <span class=\"n\">φ</span><span class=\"err\">⟧</span> <span class=\"err\">≃</span><span class=\"o\">[</span><span class=\"err\">𝒫</span> <span class=\"n\">A</span><span class=\"o\">]</span> <span class=\"o\">(</span><span class=\"n\">singleton</span> <span class=\"n\">A</span> <span class=\"mi\">𝟘</span><span class=\"o\">))</span>\n<span class=\"kn\">prefix</span> <span class=\"bp\">`∃!</span><span class=\"err\">&#39;</span><span class=\"bp\">`</span><span class=\"o\">:</span><span class=\"mi\">2</span> <span class=\"o\">:=</span> <span class=\"n\">ex_unique</span>\n\n<span class=\"n\">def</span> <span class=\"n\">subseteq</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"o\">:</span> <span class=\"n\">type</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">α</span> <span class=\"o\">:</span> <span class=\"n\">term</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">β</span> <span class=\"o\">:</span> <span class=\"n\">term</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">term</span> <span class=\"o\">:=</span>\n  <span class=\"bp\">∀</span><span class=\"err\">&#39;</span> <span class=\"n\">A</span> <span class=\"o\">(</span><span class=\"mi\">𝟘</span> <span class=\"err\">∈</span> <span class=\"n\">α</span><span class=\"o\">)</span> <span class=\"err\">⟹</span> <span class=\"o\">(</span><span class=\"mi\">𝟘</span> <span class=\"err\">∈</span> <span class=\"n\">β</span><span class=\"o\">)</span>\n<span class=\"kn\">notation</span> <span class=\"n\">a</span> <span class=\"bp\">`</span> <span class=\"err\">⊆</span><span class=\"o\">[</span><span class=\"bp\">`</span><span class=\"o\">:</span><span class=\"n\">max</span> <span class=\"n\">A</span> <span class=\"bp\">`</span><span class=\"o\">]</span> <span class=\"bp\">`</span><span class=\"o\">:</span><span class=\"mi\">0</span> <span class=\"n\">b</span> <span class=\"o\">:=</span> <span class=\"n\">subseteq</span> <span class=\"n\">A</span> <span class=\"n\">a</span> <span class=\"n\">b</span>\n\n<span class=\"n\">def</span> <span class=\"n\">term_prod</span> <span class=\"o\">{</span><span class=\"n\">A</span> <span class=\"n\">B</span> <span class=\"o\">:</span> <span class=\"n\">type</span><span class=\"o\">}</span> <span class=\"o\">(</span><span class=\"n\">α</span> <span class=\"n\">β</span> <span class=\"o\">:</span> <span class=\"n\">term</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">term</span> <span class=\"o\">:=</span>\n  <span class=\"err\">⟦</span> <span class=\"n\">A</span> <span class=\"bp\">××</span> <span class=\"n\">B</span> <span class=\"bp\">|</span> <span class=\"bp\">∃</span><span class=\"err\">&#39;</span> <span class=\"n\">A</span> <span class=\"o\">(</span><span class=\"bp\">∃</span><span class=\"err\">&#39;</span> <span class=\"n\">B</span> <span class=\"o\">((</span><span class=\"mi\">𝟙</span> <span class=\"err\">∈</span> <span class=\"n\">α</span><span class=\"o\">)</span> <span class=\"err\">⋀</span> <span class=\"o\">(</span><span class=\"mi\">𝟘</span> <span class=\"err\">∈</span> <span class=\"n\">β</span><span class=\"o\">)</span> <span class=\"err\">⋀</span> <span class=\"o\">(</span><span class=\"n\">eq</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"bp\">××</span> <span class=\"n\">B</span><span class=\"o\">)</span> <span class=\"mi\">𝟚</span> <span class=\"err\">⟪</span><span class=\"mi\">𝟙</span><span class=\"o\">,</span><span class=\"mi\">𝟘</span><span class=\"err\">⟫</span><span class=\"o\">)))</span><span class=\"err\">⟧</span>\n<span class=\"kn\">notation</span> <span class=\"n\">α</span> <span class=\"bp\">`</span> <span class=\"bp\">×</span><span class=\"n\">x</span><span class=\"o\">[</span><span class=\"bp\">`</span><span class=\"o\">:</span><span class=\"n\">max</span> <span class=\"n\">A</span> <span class=\"bp\">`</span><span class=\"o\">]</span> <span class=\"bp\">`</span><span class=\"o\">:</span><span class=\"mi\">0</span> <span class=\"n\">β</span> <span class=\"o\">:=</span> <span class=\"n\">term_prod</span> <span class=\"n\">A</span> <span class=\"n\">α</span> <span class=\"n\">β</span>\n\n<span class=\"c1\">-- * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *</span>\n<span class=\"kn\">open</span> <span class=\"n\">term</span>\n\n<span class=\"bp\">@</span><span class=\"o\">[</span><span class=\"n\">user_attribute</span><span class=\"o\">]</span>\n<span class=\"n\">meta</span> <span class=\"n\">def</span> <span class=\"n\">WF_rules</span> <span class=\"o\">:</span> <span class=\"n\">user_attribute</span> <span class=\"o\">:=</span>\n<span class=\"o\">{</span> <span class=\"n\">name</span> <span class=\"o\">:=</span> <span class=\"bp\">`</span><span class=\"n\">WF_rules</span><span class=\"o\">,</span>\n  <span class=\"n\">descr</span> <span class=\"o\">:=</span> <span class=\"s2\">&quot;lemmas usable to prove Well Formedness&quot;</span> <span class=\"o\">}</span>\n\n<span class=\"kn\">inductive</span> <span class=\"n\">WF</span> <span class=\"o\">:</span> <span class=\"kn\">context</span> <span class=\"bp\">→</span> <span class=\"n\">type</span> <span class=\"bp\">→</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"kt\">Prop</span>\n<span class=\"bp\">|</span> <span class=\"n\">star</span> <span class=\"o\">{</span><span class=\"err\">Γ</span><span class=\"o\">}</span>         <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"n\">Unit</span> <span class=\"err\">⁎</span>\n<span class=\"bp\">|</span> <span class=\"n\">top</span>  <span class=\"o\">{</span><span class=\"err\">Γ</span><span class=\"o\">}</span>         <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"err\">⊤</span>\n<span class=\"bp\">|</span> <span class=\"n\">bot</span>  <span class=\"o\">{</span><span class=\"err\">Γ</span><span class=\"o\">}</span>         <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"err\">⊥</span>\n<span class=\"bp\">|</span> <span class=\"n\">and</span>  <span class=\"o\">{</span><span class=\"err\">Γ</span> <span class=\"n\">p</span> <span class=\"n\">q</span><span class=\"o\">}</span>     <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"n\">p</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"n\">q</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"err\">⋀</span> <span class=\"n\">q</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"n\">or</span>   <span class=\"o\">{</span><span class=\"err\">Γ</span> <span class=\"n\">p</span> <span class=\"n\">q</span><span class=\"o\">}</span>     <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"n\">p</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"n\">q</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"err\">⋁</span> <span class=\"n\">q</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"n\">imp</span>  <span class=\"o\">{</span><span class=\"err\">Γ</span> <span class=\"n\">p</span> <span class=\"n\">q</span><span class=\"o\">}</span>     <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"n\">p</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"n\">q</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"err\">⟹</span> <span class=\"n\">q</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"n\">elem</span> <span class=\"o\">{</span><span class=\"err\">Γ</span> <span class=\"n\">A</span> <span class=\"n\">a</span> <span class=\"n\">α</span><span class=\"o\">}</span>   <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"n\">A</span> <span class=\"n\">a</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"o\">(</span><span class=\"err\">𝒫</span> <span class=\"n\">A</span><span class=\"o\">)</span> <span class=\"n\">α</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"o\">(</span><span class=\"n\">a</span> <span class=\"err\">∈</span> <span class=\"n\">α</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"n\">pair</span> <span class=\"o\">{</span><span class=\"err\">Γ</span> <span class=\"n\">A</span> <span class=\"n\">B</span> <span class=\"n\">a</span> <span class=\"n\">b</span><span class=\"o\">}</span> <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"n\">A</span> <span class=\"n\">a</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"n\">B</span> <span class=\"n\">b</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"bp\">××</span> <span class=\"n\">B</span><span class=\"o\">)</span> <span class=\"err\">⟪</span><span class=\"n\">a</span><span class=\"o\">,</span><span class=\"n\">b</span><span class=\"err\">⟫</span>\n<span class=\"bp\">|</span> <span class=\"n\">var</span>  <span class=\"o\">{</span><span class=\"err\">Γ</span> <span class=\"n\">A</span> <span class=\"n\">n</span><span class=\"o\">}</span>     <span class=\"o\">:</span> <span class=\"n\">list</span><span class=\"bp\">.</span><span class=\"n\">nth</span> <span class=\"err\">Γ</span> <span class=\"n\">n</span> <span class=\"bp\">=</span> <span class=\"n\">some</span> <span class=\"n\">A</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"n\">A</span> <span class=\"o\">(</span><span class=\"n\">var</span> <span class=\"n\">n</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"n\">comp</span> <span class=\"o\">{</span><span class=\"err\">Γ</span> <span class=\"n\">A</span> <span class=\"n\">φ</span><span class=\"o\">}</span>     <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"o\">(</span><span class=\"n\">A</span><span class=\"bp\">::</span><span class=\"err\">Γ</span><span class=\"o\">)</span> <span class=\"err\">Ω</span> <span class=\"n\">φ</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"o\">(</span><span class=\"err\">𝒫</span> <span class=\"n\">A</span><span class=\"o\">)</span> <span class=\"err\">⟦</span><span class=\"n\">A</span> <span class=\"bp\">|</span> <span class=\"n\">φ</span><span class=\"err\">⟧</span>\n<span class=\"bp\">|</span> <span class=\"n\">all</span>  <span class=\"o\">{</span><span class=\"err\">Γ</span> <span class=\"n\">A</span> <span class=\"n\">φ</span><span class=\"o\">}</span>     <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"o\">(</span><span class=\"n\">A</span><span class=\"bp\">::</span><span class=\"err\">Γ</span><span class=\"o\">)</span> <span class=\"err\">Ω</span> <span class=\"n\">φ</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"o\">(</span><span class=\"bp\">∀</span><span class=\"err\">&#39;</span> <span class=\"n\">A</span> <span class=\"n\">φ</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"n\">ex</span>   <span class=\"o\">{</span><span class=\"err\">Γ</span> <span class=\"n\">A</span> <span class=\"n\">φ</span><span class=\"o\">}</span>     <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"o\">(</span><span class=\"n\">A</span><span class=\"bp\">::</span><span class=\"err\">Γ</span><span class=\"o\">)</span> <span class=\"err\">Ω</span> <span class=\"n\">φ</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"o\">(</span><span class=\"bp\">∃</span><span class=\"err\">&#39;</span> <span class=\"n\">A</span> <span class=\"n\">φ</span><span class=\"o\">)</span>\n\n<span class=\"n\">attribute</span> <span class=\"o\">[</span><span class=\"n\">WF_rules</span><span class=\"o\">]</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">star</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">top</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">bot</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">and</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">or</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">imp</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">elem</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">pair</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">var</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">comp</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">all</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">ex</span>\n\n<span class=\"kn\">section</span>\n\n<span class=\"kn\">variable</span> <span class=\"err\">Γ</span> <span class=\"o\">:</span> <span class=\"kn\">context</span>\n<span class=\"kn\">variables</span> <span class=\"n\">p</span> <span class=\"n\">q</span> <span class=\"n\">r</span> <span class=\"n\">φ</span> <span class=\"n\">a</span> <span class=\"n\">b</span> <span class=\"n\">α</span> <span class=\"o\">:</span> <span class=\"n\">term</span>\n<span class=\"kn\">variables</span> <span class=\"o\">{</span><span class=\"n\">A</span> <span class=\"n\">B</span> <span class=\"err\">Ω&#39;</span> <span class=\"o\">:</span> <span class=\"n\">type</span><span class=\"o\">}</span>\n<span class=\"c1\">-- Ω&#39; is just a fake/variable version of Ω so we don&#39;t need to bother proving</span>\n<span class=\"c1\">-- that it must be Ω itself.&#39;</span>\n\n<span class=\"n\">meta</span> <span class=\"n\">def</span> <span class=\"n\">WF_prover</span> <span class=\"o\">:</span> <span class=\"n\">tactic</span> <span class=\"n\">unit</span> <span class=\"o\">:=</span> <span class=\"n\">do</span> <span class=\"bp\">`</span><span class=\"o\">[</span><span class=\"n\">intro</span> <span class=\"n\">h</span><span class=\"o\">,</span> <span class=\"n\">cases</span> <span class=\"n\">h</span><span class=\"o\">,</span> <span class=\"n\">assumption</span><span class=\"o\">]</span>\n\n<span class=\"bp\">@</span><span class=\"o\">[</span><span class=\"n\">WF_rules</span><span class=\"o\">]</span> <span class=\"kn\">lemma</span> <span class=\"n\">and_left</span>   <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω&#39;</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"err\">⋀</span> <span class=\"n\">q</span><span class=\"o\">)</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω&#39;</span> <span class=\"n\">p</span> <span class=\"o\">:=</span> <span class=\"k\">by</span> <span class=\"n\">WF_prover</span>\n<span class=\"bp\">@</span><span class=\"o\">[</span><span class=\"n\">WF_rules</span><span class=\"o\">]</span> <span class=\"kn\">lemma</span> <span class=\"n\">and_right</span>  <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω&#39;</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"err\">⋀</span> <span class=\"n\">q</span><span class=\"o\">)</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω&#39;</span> <span class=\"n\">q</span> <span class=\"o\">:=</span> <span class=\"k\">by</span> <span class=\"n\">WF_prover</span>\n<span class=\"bp\">@</span><span class=\"o\">[</span><span class=\"n\">WF_rules</span><span class=\"o\">]</span> <span class=\"kn\">lemma</span> <span class=\"n\">or_left</span>    <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω&#39;</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"err\">⋁</span> <span class=\"n\">q</span><span class=\"o\">)</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω&#39;</span> <span class=\"n\">p</span> <span class=\"o\">:=</span> <span class=\"k\">by</span> <span class=\"n\">WF_prover</span>\n<span class=\"bp\">@</span><span class=\"o\">[</span><span class=\"n\">WF_rules</span><span class=\"o\">]</span> <span class=\"kn\">lemma</span> <span class=\"n\">or_right</span>   <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω&#39;</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"err\">⋁</span> <span class=\"n\">q</span><span class=\"o\">)</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω&#39;</span> <span class=\"n\">q</span> <span class=\"o\">:=</span> <span class=\"k\">by</span> <span class=\"n\">WF_prover</span>\n<span class=\"bp\">@</span><span class=\"o\">[</span><span class=\"n\">WF_rules</span><span class=\"o\">]</span> <span class=\"kn\">lemma</span> <span class=\"n\">imp_left</span>   <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω&#39;</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"err\">⟹</span> <span class=\"n\">q</span><span class=\"o\">)</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω&#39;</span> <span class=\"n\">p</span> <span class=\"o\">:=</span> <span class=\"k\">by</span> <span class=\"n\">WF_prover</span>\n<span class=\"bp\">@</span><span class=\"o\">[</span><span class=\"n\">WF_rules</span><span class=\"o\">]</span> <span class=\"kn\">lemma</span> <span class=\"n\">imp_right</span>  <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω&#39;</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"err\">⟹</span> <span class=\"n\">q</span><span class=\"o\">)</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω&#39;</span> <span class=\"n\">q</span> <span class=\"o\">:=</span> <span class=\"k\">by</span> <span class=\"n\">WF_prover</span>\n<span class=\"bp\">@</span><span class=\"o\">[</span><span class=\"n\">WF_rules</span><span class=\"o\">]</span> <span class=\"kn\">lemma</span> <span class=\"n\">pair_left</span>  <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"bp\">××</span> <span class=\"n\">B</span><span class=\"o\">)</span> <span class=\"err\">⟪</span><span class=\"n\">a</span><span class=\"o\">,</span><span class=\"n\">b</span><span class=\"err\">⟫</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"n\">A</span> <span class=\"n\">a</span> <span class=\"o\">:=</span> <span class=\"k\">by</span> <span class=\"n\">WF_prover</span>\n<span class=\"bp\">@</span><span class=\"o\">[</span><span class=\"n\">WF_rules</span><span class=\"o\">]</span> <span class=\"kn\">lemma</span> <span class=\"n\">pair_right</span> <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"bp\">××</span> <span class=\"n\">B</span><span class=\"o\">)</span> <span class=\"err\">⟪</span><span class=\"n\">a</span><span class=\"o\">,</span><span class=\"n\">b</span><span class=\"err\">⟫</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"n\">B</span> <span class=\"n\">b</span> <span class=\"o\">:=</span> <span class=\"k\">by</span> <span class=\"n\">WF_prover</span>\n<span class=\"bp\">@</span><span class=\"o\">[</span><span class=\"n\">WF_rules</span><span class=\"o\">]</span> <span class=\"kn\">lemma</span> <span class=\"n\">comp_elim</span>  <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"o\">(</span><span class=\"err\">𝒫</span> <span class=\"n\">A</span><span class=\"o\">)</span> <span class=\"err\">⟦</span><span class=\"n\">A</span> <span class=\"bp\">|</span> <span class=\"n\">φ</span><span class=\"err\">⟧</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"o\">(</span><span class=\"n\">A</span><span class=\"bp\">::</span><span class=\"err\">Γ</span><span class=\"o\">)</span> <span class=\"err\">Ω</span> <span class=\"n\">φ</span> <span class=\"o\">:=</span> <span class=\"k\">by</span> <span class=\"n\">WF_prover</span>\n<span class=\"bp\">@</span><span class=\"o\">[</span><span class=\"n\">WF_rules</span><span class=\"o\">]</span> <span class=\"kn\">lemma</span> <span class=\"n\">all_elim</span>   <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω&#39;</span> <span class=\"o\">(</span><span class=\"bp\">∀</span><span class=\"err\">&#39;</span> <span class=\"n\">A</span> <span class=\"n\">φ</span><span class=\"o\">)</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"o\">(</span><span class=\"n\">A</span><span class=\"bp\">::</span><span class=\"err\">Γ</span><span class=\"o\">)</span> <span class=\"err\">Ω&#39;</span> <span class=\"n\">φ</span> <span class=\"o\">:=</span> <span class=\"k\">by</span> <span class=\"n\">WF_prover</span>\n<span class=\"bp\">@</span><span class=\"o\">[</span><span class=\"n\">WF_rules</span><span class=\"o\">]</span> <span class=\"kn\">lemma</span> <span class=\"n\">ex_elim</span>    <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω&#39;</span> <span class=\"o\">(</span><span class=\"bp\">∀</span><span class=\"err\">&#39;</span> <span class=\"n\">A</span> <span class=\"n\">φ</span><span class=\"o\">)</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"o\">(</span><span class=\"n\">A</span><span class=\"bp\">::</span><span class=\"err\">Γ</span><span class=\"o\">)</span> <span class=\"err\">Ω&#39;</span> <span class=\"n\">φ</span> <span class=\"o\">:=</span> <span class=\"k\">by</span> <span class=\"n\">WF_prover</span>\n<span class=\"bp\">@</span><span class=\"o\">[</span><span class=\"n\">WF_rules</span><span class=\"o\">]</span> <span class=\"kn\">lemma</span> <span class=\"n\">iff_intro</span> <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"n\">p</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"n\">q</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"err\">⇔</span> <span class=\"n\">q</span><span class=\"o\">)</span> <span class=\"o\">:=</span>\n<span class=\"k\">begin</span>\n  <span class=\"n\">intros</span><span class=\"o\">,</span>\n  <span class=\"n\">apply_rules</span> <span class=\"n\">WF_rules</span><span class=\"o\">,</span>\n  <span class=\"c1\">-- apply_rules [WF.and, WF.imp],</span>\n<span class=\"kn\">end</span>\n\n<span class=\"kn\">end</span>\n\n<span class=\"kn\">end</span> <span class=\"n\">TT</span>\n</code></pre></div>",
        "id": 200402900,
        "sender_full_name": "Billy Price",
        "timestamp": 1591787483
    },
    {
        "content": "<p>Most or all of your second set of rules (starting with <code>and_left</code>) shouldn't be used with <code>apply_rules</code>.</p>",
        "id": 200403159,
        "sender_full_name": "Reid Barton",
        "timestamp": 1591787650
    },
    {
        "content": "<p>Ah good point, they would generate infinite possibilities for derivation right?</p>",
        "id": 200403205,
        "sender_full_name": "Billy Price",
        "timestamp": 1591787704
    },
    {
        "content": "<p>right, they are possibly suitable for forwards reasoning, but not for backwards reasoning</p>",
        "id": 200403306,
        "sender_full_name": "Reid Barton",
        "timestamp": 1591787771
    },
    {
        "content": "<p>oh, you just have a namespace problem actually</p>",
        "id": 200403360,
        "sender_full_name": "Reid Barton",
        "timestamp": 1591787850
    },
    {
        "content": "<p>I'm not sure what the right way to fix it is, but I would just move the attribute to the root namespace</p>",
        "id": 200403438,
        "sender_full_name": "Reid Barton",
        "timestamp": 1591787885
    },
    {
        "content": "<p>outside <code>namespace TT</code>?</p>",
        "id": 200403452,
        "sender_full_name": "Billy Price",
        "timestamp": 1591787909
    },
    {
        "content": "<p>right. Alternatively, call it <code>TT.WF_rules</code> everywhere</p>",
        "id": 200403478,
        "sender_full_name": "Reid Barton",
        "timestamp": 1591787936
    },
    {
        "content": "<p>Everywhere except the definition?</p>",
        "id": 200403523,
        "sender_full_name": "Billy Price",
        "timestamp": 1591787990
    },
    {
        "content": "<p>right, not literally in <code>meta def WF_rules</code> but everywhere else</p>",
        "id": 200403631,
        "sender_full_name": "Reid Barton",
        "timestamp": 1591788081
    },
    {
        "content": "<p>probably it's optional in <code> `WF_rules </code>, I forget how the backticked names work exactly</p>",
        "id": 200403648,
        "sender_full_name": "Reid Barton",
        "timestamp": 1591788100
    },
    {
        "content": "<p>I can't add <code>TT.</code> to any of the other <code>WF_rules</code> without red-lines \"unknown attribute [TT.WF_rules]\"</p>",
        "id": 200404040,
        "sender_full_name": "Billy Price",
        "timestamp": 1591788375
    },
    {
        "content": "<p>Not optional with <code>`WF_rules</code> but you should be using <code>``WF_rules</code> and there it is optional</p>",
        "id": 200404067,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1591788403
    },
    {
        "content": "<p>For reference: <code> ``name </code> goes through name resolution and is checked at tactic compile time, while <code>`name</code> is used as is (and so is generally checked at run time)</p>",
        "id": 200404172,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1591788508
    },
    {
        "content": "<p>I'm not sure I understand the relevance. Is the name checking time relevant to whether a <code>TT.</code> is needed?</p>",
        "id": 200404319,
        "sender_full_name": "Billy Price",
        "timestamp": 1591788672
    },
    {
        "content": "<p>By the way <code>apply_rules WF_rules</code> and <code>apply_rules TT.WF_rules</code> both give \"no matching rule\", and <code>apply_rules hsdfsfj</code> gives <code>unknown identifier hsdfsfj </code>, so it seems to be recognising the object</p>",
        "id": 200404456,
        "sender_full_name": "Billy Price",
        "timestamp": 1591788794
    },
    {
        "content": "<p>maybe you have no matching rule</p>",
        "id": 200404499,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1591788842
    },
    {
        "content": "<p>Weird. It works for me when I change all occurrences of <code>WF_rules</code> to <code>TT.WF_rules</code> except the one in <code>meta def WF_rules</code></p>",
        "id": 200404551,
        "sender_full_name": "Reid Barton",
        "timestamp": 1591788857
    },
    {
        "content": "<p>name resolution means that it inserts namespaces based on the current context</p>",
        "id": 200404566,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1591788871
    },
    {
        "content": "<p>and once I comment out all the bad rules</p>",
        "id": 200404567,
        "sender_full_name": "Reid Barton",
        "timestamp": 1591788872
    },
    {
        "content": "<p>so <code> ``WF_rules </code> is equivalent to <code> `TT.WF_rules</code> except that it will give an error if <code>WF_rules</code> can't be found</p>",
        "id": 200404612,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1591788916
    },
    {
        "content": "<p>I can't get anything working here's the most updated version of what I've got, as soon as I change any instances of WF_rules to TT.WF_rules it doesn't recognise it, and the usage in the actual proof is ambilavent to <code>TT.</code>. However <code>apply_rules [WF.and, WF.imp]</code> works fine.</p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"c\">/-</span><span class=\"cm\"></span>\n<span class=\"cm\">Definitions of a type theory</span>\n\n<span class=\"cm\">Author: Billy Price</span>\n<span class=\"cm\">-/</span>\n\n<span class=\"kn\">import</span> <span class=\"n\">data</span><span class=\"bp\">.</span><span class=\"n\">finset</span>\n<span class=\"kn\">namespace</span> <span class=\"n\">TT</span>\n\n<span class=\"kn\">inductive</span> <span class=\"n\">type</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span>\n<span class=\"bp\">|</span> <span class=\"n\">Unit</span> <span class=\"bp\">|</span> <span class=\"n\">Omega</span> <span class=\"bp\">|</span> <span class=\"n\">Prod</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"n\">B</span> <span class=\"o\">:</span> <span class=\"n\">type</span><span class=\"o\">)</span><span class=\"bp\">|</span> <span class=\"n\">Pow</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"o\">:</span> <span class=\"n\">type</span><span class=\"o\">)</span>\n\n<span class=\"kn\">notation</span> <span class=\"bp\">`</span><span class=\"err\">Ω</span><span class=\"bp\">`</span> <span class=\"o\">:=</span> <span class=\"n\">type</span><span class=\"bp\">.</span><span class=\"n\">Omega</span>\n<span class=\"n\">def</span> <span class=\"n\">Unit</span> <span class=\"o\">:=</span> <span class=\"n\">type</span><span class=\"bp\">.</span><span class=\"n\">Unit</span>\n<span class=\"kn\">infix</span> <span class=\"bp\">`××`</span><span class=\"o\">:</span><span class=\"n\">max</span> <span class=\"o\">:=</span> <span class=\"n\">type</span><span class=\"bp\">.</span><span class=\"n\">Prod</span>\n<span class=\"kn\">notation</span> <span class=\"bp\">`</span><span class=\"err\">𝒫</span><span class=\"bp\">`</span><span class=\"n\">A</span> <span class=\"o\">:</span><span class=\"n\">max</span> <span class=\"o\">:=</span> <span class=\"n\">type</span><span class=\"bp\">.</span><span class=\"n\">Pow</span> <span class=\"n\">A</span>\n\n<span class=\"n\">def</span> <span class=\"kn\">context</span> <span class=\"o\">:=</span> <span class=\"n\">list</span> <span class=\"n\">type</span>\n\n<span class=\"kn\">inductive</span> <span class=\"n\">term</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span>\n<span class=\"bp\">|</span> <span class=\"n\">star</span> <span class=\"o\">:</span> <span class=\"n\">term</span>\n<span class=\"bp\">|</span> <span class=\"n\">top</span>  <span class=\"o\">:</span> <span class=\"n\">term</span>\n<span class=\"bp\">|</span> <span class=\"n\">bot</span>  <span class=\"o\">:</span> <span class=\"n\">term</span>\n<span class=\"bp\">|</span> <span class=\"n\">and</span>  <span class=\"o\">:</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">term</span>\n<span class=\"bp\">|</span> <span class=\"n\">or</span>   <span class=\"o\">:</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">term</span>\n<span class=\"bp\">|</span> <span class=\"n\">imp</span>  <span class=\"o\">:</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">term</span>\n<span class=\"bp\">|</span> <span class=\"n\">elem</span> <span class=\"o\">:</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">term</span>\n<span class=\"bp\">|</span> <span class=\"n\">pair</span> <span class=\"o\">:</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">term</span>\n<span class=\"bp\">|</span> <span class=\"n\">var</span>  <span class=\"o\">:</span> <span class=\"bp\">ℕ</span> <span class=\"bp\">→</span> <span class=\"n\">term</span>\n<span class=\"bp\">|</span> <span class=\"n\">comp</span> <span class=\"o\">:</span> <span class=\"n\">type</span> <span class=\"bp\">→</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">term</span>\n<span class=\"bp\">|</span> <span class=\"n\">all</span>  <span class=\"o\">:</span> <span class=\"n\">type</span> <span class=\"bp\">→</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">term</span>\n<span class=\"bp\">|</span> <span class=\"n\">ex</span>   <span class=\"o\">:</span> <span class=\"n\">type</span> <span class=\"bp\">→</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">term</span>\n\n<span class=\"kn\">open</span> <span class=\"n\">term</span>\n\n<span class=\"c1\">-- * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *</span>\n<span class=\"c1\">-- Notation and derived operators</span>\n<span class=\"c1\">-- * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *</span>\n\n<span class=\"kn\">notation</span> <span class=\"bp\">`</span><span class=\"mi\">𝟘</span><span class=\"bp\">`</span> <span class=\"o\">:=</span> <span class=\"n\">term</span><span class=\"bp\">.</span><span class=\"n\">var</span> <span class=\"mi\">0</span>\n<span class=\"kn\">notation</span> <span class=\"bp\">`</span><span class=\"mi\">𝟙</span><span class=\"bp\">`</span> <span class=\"o\">:=</span> <span class=\"n\">term</span><span class=\"bp\">.</span><span class=\"n\">var</span> <span class=\"mi\">1</span>\n<span class=\"kn\">notation</span> <span class=\"bp\">`</span><span class=\"mi\">𝟚</span><span class=\"bp\">`</span> <span class=\"o\">:=</span> <span class=\"n\">term</span><span class=\"bp\">.</span><span class=\"n\">var</span> <span class=\"mi\">2</span>\n<span class=\"kn\">notation</span> <span class=\"bp\">`</span><span class=\"mi\">𝟛</span><span class=\"bp\">`</span> <span class=\"o\">:=</span> <span class=\"n\">term</span><span class=\"bp\">.</span><span class=\"n\">var</span> <span class=\"mi\">3</span>\n<span class=\"kn\">notation</span> <span class=\"bp\">`</span><span class=\"mi\">𝟜</span><span class=\"bp\">`</span> <span class=\"o\">:=</span> <span class=\"n\">term</span><span class=\"bp\">.</span><span class=\"n\">var</span> <span class=\"mi\">4</span>\n<span class=\"kn\">notation</span> <span class=\"bp\">`</span><span class=\"mi\">𝟝</span><span class=\"bp\">`</span> <span class=\"o\">:=</span> <span class=\"n\">term</span><span class=\"bp\">.</span><span class=\"n\">var</span> <span class=\"mi\">5</span>\n\n<span class=\"kn\">notation</span> <span class=\"bp\">`</span><span class=\"err\">⁎</span><span class=\"bp\">`</span> <span class=\"o\">:=</span> <span class=\"n\">term</span><span class=\"bp\">.</span><span class=\"n\">star</span>    <span class=\"c1\">-- input \\asterisk</span>\n<span class=\"kn\">notation</span> <span class=\"bp\">`</span><span class=\"err\">⊤</span><span class=\"bp\">`</span> <span class=\"o\">:=</span> <span class=\"n\">term</span><span class=\"bp\">.</span><span class=\"n\">top</span>     <span class=\"c1\">--       \\top</span>\n<span class=\"kn\">notation</span> <span class=\"bp\">`</span><span class=\"err\">⊥</span><span class=\"bp\">`</span> <span class=\"o\">:=</span> <span class=\"n\">term</span><span class=\"bp\">.</span><span class=\"n\">bot</span>     <span class=\"c1\">-- input \\bot</span>\n<span class=\"kn\">infixr</span> <span class=\"bp\">`</span> <span class=\"err\">⟹</span> <span class=\"bp\">`</span><span class=\"o\">:</span><span class=\"mi\">60</span> <span class=\"o\">:=</span> <span class=\"n\">term</span><span class=\"bp\">.</span><span class=\"n\">imp</span> <span class=\"c1\">-- input \\==&gt;</span>\n<span class=\"kn\">infixr</span> <span class=\"bp\">`</span> <span class=\"err\">⋀</span> <span class=\"bp\">`</span> <span class=\"o\">:</span><span class=\"mi\">70</span> <span class=\"o\">:=</span> <span class=\"n\">term</span><span class=\"bp\">.</span><span class=\"n\">and</span> <span class=\"c1\">-- input \\And or \\bigwedge</span>\n<span class=\"kn\">infixr</span> <span class=\"bp\">`</span> <span class=\"err\">⋁</span> <span class=\"bp\">`</span> <span class=\"o\">:</span><span class=\"mi\">59</span> <span class=\"o\">:=</span> <span class=\"n\">term</span><span class=\"bp\">.</span><span class=\"n\">or</span>  <span class=\"c1\">-- input \\Or or \\bigvee</span>\n\n<span class=\"n\">def</span> <span class=\"n\">not</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"o\">:</span> <span class=\"n\">term</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"n\">p</span> <span class=\"err\">⟹</span> <span class=\"err\">⊥</span>\n<span class=\"kn\">prefix</span> <span class=\"bp\">`</span><span class=\"err\">∼</span><span class=\"bp\">`</span><span class=\"o\">:</span><span class=\"n\">max</span> <span class=\"o\">:=</span> <span class=\"n\">not</span> <span class=\"c1\">-- input \\~</span>\n\n<span class=\"n\">def</span> <span class=\"n\">iff</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"n\">q</span><span class=\"o\">:</span> <span class=\"n\">term</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"err\">⟹</span> <span class=\"n\">q</span><span class=\"o\">)</span> <span class=\"err\">⋀</span> <span class=\"o\">(</span><span class=\"n\">q</span> <span class=\"err\">⟹</span> <span class=\"n\">p</span><span class=\"o\">)</span>\n<span class=\"kn\">infix</span> <span class=\"bp\">`</span> <span class=\"err\">⇔</span> <span class=\"bp\">`</span><span class=\"o\">:</span><span class=\"mi\">60</span> <span class=\"o\">:=</span> <span class=\"n\">iff</span> <span class=\"c1\">-- input \\&lt;=&gt;</span>\n\n<span class=\"kn\">infix</span> <span class=\"err\">∈</span> <span class=\"o\">:=</span> <span class=\"n\">term</span><span class=\"bp\">.</span><span class=\"n\">elem</span>\n<span class=\"kn\">infix</span> <span class=\"err\">∉</span> <span class=\"o\">:=</span> <span class=\"bp\">λ</span> <span class=\"n\">a</span> <span class=\"n\">α</span><span class=\"o\">,</span> <span class=\"n\">not</span> <span class=\"o\">(</span><span class=\"n\">term</span><span class=\"bp\">.</span><span class=\"n\">elem</span> <span class=\"n\">a</span> <span class=\"n\">α</span><span class=\"o\">)</span>\n<span class=\"kn\">notation</span> <span class=\"bp\">`</span><span class=\"err\">⟦</span> <span class=\"bp\">`</span> <span class=\"n\">A</span> <span class=\"bp\">`</span> <span class=\"bp\">|</span> <span class=\"bp\">`</span> <span class=\"n\">φ</span> <span class=\"bp\">`</span> <span class=\"err\">⟧</span><span class=\"bp\">`</span> <span class=\"o\">:=</span> <span class=\"n\">term</span><span class=\"bp\">.</span><span class=\"n\">comp</span> <span class=\"n\">A</span> <span class=\"n\">φ</span>\n\n<span class=\"kn\">notation</span> <span class=\"bp\">`</span><span class=\"err\">⟪</span><span class=\"bp\">`</span> <span class=\"n\">a</span> <span class=\"bp\">`</span><span class=\"o\">,</span><span class=\"bp\">`</span> <span class=\"n\">b</span> <span class=\"bp\">`</span><span class=\"err\">⟫</span><span class=\"bp\">`</span> <span class=\"o\">:=</span> <span class=\"n\">term</span><span class=\"bp\">.</span><span class=\"n\">pair</span> <span class=\"n\">a</span> <span class=\"n\">b</span>\n\n<span class=\"kn\">notation</span> <span class=\"bp\">`∀</span><span class=\"err\">&#39;</span><span class=\"bp\">`</span> <span class=\"o\">:=</span> <span class=\"n\">term</span><span class=\"bp\">.</span><span class=\"n\">all</span>\n<span class=\"kn\">notation</span> <span class=\"bp\">`∃</span><span class=\"err\">&#39;</span><span class=\"bp\">`</span> <span class=\"o\">:=</span> <span class=\"n\">term</span><span class=\"bp\">.</span><span class=\"n\">ex</span>\n\n\n<span class=\"kn\">section</span> <span class=\"n\">substitution</span>\n\n  <span class=\"bp\">@</span><span class=\"o\">[</span><span class=\"n\">simp</span><span class=\"o\">]</span>\n  <span class=\"n\">def</span> <span class=\"n\">lift_d</span> <span class=\"o\">(</span><span class=\"n\">d</span> <span class=\"o\">:</span> <span class=\"bp\">ℕ</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"bp\">ℕ</span> <span class=\"bp\">→</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">term</span>\n  <span class=\"bp\">|</span> <span class=\"n\">k</span> <span class=\"err\">⁎</span>          <span class=\"o\">:=</span> <span class=\"err\">⁎</span>\n  <span class=\"bp\">|</span> <span class=\"n\">k</span> <span class=\"err\">⊤</span>          <span class=\"o\">:=</span> <span class=\"err\">⊤</span>\n  <span class=\"bp\">|</span> <span class=\"n\">k</span> <span class=\"err\">⊥</span>          <span class=\"o\">:=</span> <span class=\"err\">⊥</span>\n  <span class=\"bp\">|</span> <span class=\"n\">k</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"err\">⋀</span> <span class=\"n\">q</span><span class=\"o\">)</span>    <span class=\"o\">:=</span> <span class=\"o\">(</span><span class=\"n\">lift_d</span> <span class=\"n\">k</span> <span class=\"n\">p</span><span class=\"o\">)</span> <span class=\"err\">⋀</span> <span class=\"o\">(</span><span class=\"n\">lift_d</span> <span class=\"n\">k</span> <span class=\"n\">q</span><span class=\"o\">)</span>\n  <span class=\"bp\">|</span> <span class=\"n\">k</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"err\">⋁</span> <span class=\"n\">q</span><span class=\"o\">)</span>    <span class=\"o\">:=</span> <span class=\"o\">(</span><span class=\"n\">lift_d</span> <span class=\"n\">k</span> <span class=\"n\">p</span><span class=\"o\">)</span> <span class=\"err\">⋁</span> <span class=\"o\">(</span><span class=\"n\">lift_d</span> <span class=\"n\">k</span> <span class=\"n\">q</span><span class=\"o\">)</span>\n  <span class=\"bp\">|</span> <span class=\"n\">k</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"err\">⟹</span> <span class=\"n\">q</span><span class=\"o\">)</span>   <span class=\"o\">:=</span> <span class=\"o\">(</span><span class=\"n\">lift_d</span> <span class=\"n\">k</span> <span class=\"n\">p</span><span class=\"o\">)</span> <span class=\"err\">⟹</span> <span class=\"o\">(</span><span class=\"n\">lift_d</span> <span class=\"n\">k</span> <span class=\"n\">q</span><span class=\"o\">)</span>\n  <span class=\"bp\">|</span> <span class=\"n\">k</span> <span class=\"o\">(</span><span class=\"n\">a</span> <span class=\"err\">∈</span> <span class=\"n\">α</span><span class=\"o\">)</span>    <span class=\"o\">:=</span> <span class=\"o\">(</span><span class=\"n\">lift_d</span> <span class=\"n\">k</span> <span class=\"n\">a</span><span class=\"o\">)</span> <span class=\"err\">∈</span> <span class=\"o\">(</span><span class=\"n\">lift_d</span> <span class=\"n\">k</span> <span class=\"n\">α</span><span class=\"o\">)</span>\n  <span class=\"bp\">|</span> <span class=\"n\">k</span> <span class=\"err\">⟪</span><span class=\"n\">a</span><span class=\"o\">,</span><span class=\"n\">b</span><span class=\"err\">⟫</span>      <span class=\"o\">:=</span> <span class=\"err\">⟪</span><span class=\"n\">lift_d</span> <span class=\"n\">k</span> <span class=\"n\">a</span><span class=\"o\">,</span> <span class=\"n\">lift_d</span> <span class=\"n\">k</span> <span class=\"n\">b</span><span class=\"err\">⟫</span>\n  <span class=\"bp\">|</span> <span class=\"n\">k</span> <span class=\"o\">(</span><span class=\"n\">var</span> <span class=\"n\">m</span><span class=\"o\">)</span>    <span class=\"o\">:=</span> <span class=\"k\">if</span> <span class=\"n\">m</span><span class=\"bp\">≥</span><span class=\"n\">k</span> <span class=\"k\">then</span> <span class=\"n\">var</span> <span class=\"o\">(</span><span class=\"n\">m</span><span class=\"bp\">+</span><span class=\"n\">d</span><span class=\"o\">)</span> <span class=\"k\">else</span> <span class=\"n\">var</span> <span class=\"n\">m</span>\n  <span class=\"bp\">|</span> <span class=\"n\">k</span> <span class=\"err\">⟦</span><span class=\"n\">A</span> <span class=\"bp\">|</span> <span class=\"n\">φ</span><span class=\"err\">⟧</span>     <span class=\"o\">:=</span>    <span class=\"err\">⟦</span><span class=\"n\">A</span> <span class=\"bp\">|</span> <span class=\"n\">lift_d</span> <span class=\"o\">(</span><span class=\"n\">k</span><span class=\"bp\">+</span><span class=\"mi\">1</span><span class=\"o\">)</span> <span class=\"n\">φ</span><span class=\"err\">⟧</span>\n  <span class=\"bp\">|</span> <span class=\"n\">k</span> <span class=\"o\">(</span><span class=\"bp\">∀</span><span class=\"err\">&#39;</span> <span class=\"n\">A</span> <span class=\"n\">φ</span><span class=\"o\">)</span>   <span class=\"o\">:=</span> <span class=\"bp\">∀</span><span class=\"err\">&#39;</span> <span class=\"n\">A</span> <span class=\"err\">$</span> <span class=\"n\">lift_d</span> <span class=\"o\">(</span><span class=\"n\">k</span><span class=\"bp\">+</span><span class=\"mi\">1</span><span class=\"o\">)</span> <span class=\"n\">φ</span>\n  <span class=\"bp\">|</span> <span class=\"n\">k</span> <span class=\"o\">(</span><span class=\"bp\">∃</span><span class=\"err\">&#39;</span> <span class=\"n\">A</span> <span class=\"n\">φ</span><span class=\"o\">)</span>   <span class=\"o\">:=</span> <span class=\"bp\">∃</span><span class=\"err\">&#39;</span> <span class=\"n\">A</span> <span class=\"err\">$</span> <span class=\"n\">lift_d</span> <span class=\"o\">(</span><span class=\"n\">k</span><span class=\"bp\">+</span><span class=\"mi\">1</span><span class=\"o\">)</span> <span class=\"n\">φ</span>\n\n  <span class=\"bp\">@</span><span class=\"o\">[</span><span class=\"n\">simp</span><span class=\"o\">]</span>\n  <span class=\"n\">def</span> <span class=\"n\">lift</span> <span class=\"o\">:=</span> <span class=\"n\">lift_d</span> <span class=\"mi\">1</span> <span class=\"mi\">0</span>\n\n  <span class=\"bp\">@</span><span class=\"o\">[</span><span class=\"n\">simp</span><span class=\"o\">]</span>\n  <span class=\"n\">def</span> <span class=\"n\">subst</span> <span class=\"o\">:</span> <span class=\"bp\">ℕ</span> <span class=\"bp\">→</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">term</span>\n  <span class=\"bp\">|</span> <span class=\"n\">n</span> <span class=\"n\">x</span> <span class=\"err\">⁎</span>          <span class=\"o\">:=</span> <span class=\"err\">⁎</span>\n  <span class=\"bp\">|</span> <span class=\"n\">n</span> <span class=\"n\">x</span> <span class=\"err\">⊤</span>          <span class=\"o\">:=</span> <span class=\"err\">⊤</span>\n  <span class=\"bp\">|</span> <span class=\"n\">n</span> <span class=\"n\">x</span> <span class=\"err\">⊥</span>          <span class=\"o\">:=</span> <span class=\"err\">⊥</span>\n  <span class=\"bp\">|</span> <span class=\"n\">n</span> <span class=\"n\">x</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"err\">⋀</span> <span class=\"n\">q</span><span class=\"o\">)</span>    <span class=\"o\">:=</span> <span class=\"o\">(</span><span class=\"n\">subst</span> <span class=\"n\">n</span> <span class=\"n\">x</span> <span class=\"n\">p</span><span class=\"o\">)</span> <span class=\"err\">⋀</span> <span class=\"o\">(</span><span class=\"n\">subst</span> <span class=\"n\">n</span> <span class=\"n\">x</span> <span class=\"n\">q</span><span class=\"o\">)</span>\n  <span class=\"bp\">|</span> <span class=\"n\">n</span> <span class=\"n\">x</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"err\">⋁</span> <span class=\"n\">q</span><span class=\"o\">)</span>    <span class=\"o\">:=</span> <span class=\"o\">(</span><span class=\"n\">subst</span> <span class=\"n\">n</span> <span class=\"n\">x</span> <span class=\"n\">p</span><span class=\"o\">)</span> <span class=\"err\">⋁</span> <span class=\"o\">(</span><span class=\"n\">subst</span> <span class=\"n\">n</span> <span class=\"n\">x</span> <span class=\"n\">q</span><span class=\"o\">)</span>\n  <span class=\"bp\">|</span> <span class=\"n\">n</span> <span class=\"n\">x</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"err\">⟹</span> <span class=\"n\">q</span><span class=\"o\">)</span>  <span class=\"o\">:=</span> <span class=\"o\">(</span><span class=\"n\">subst</span> <span class=\"n\">n</span> <span class=\"n\">x</span> <span class=\"n\">p</span><span class=\"o\">)</span> <span class=\"err\">⟹</span> <span class=\"o\">(</span><span class=\"n\">subst</span> <span class=\"n\">n</span> <span class=\"n\">x</span> <span class=\"n\">q</span><span class=\"o\">)</span>\n  <span class=\"bp\">|</span> <span class=\"n\">n</span> <span class=\"n\">x</span> <span class=\"o\">(</span><span class=\"n\">a</span> <span class=\"err\">∈</span> <span class=\"n\">α</span><span class=\"o\">)</span>    <span class=\"o\">:=</span> <span class=\"o\">(</span><span class=\"n\">subst</span> <span class=\"n\">n</span> <span class=\"n\">x</span> <span class=\"n\">a</span><span class=\"o\">)</span> <span class=\"err\">∈</span> <span class=\"o\">(</span><span class=\"n\">subst</span> <span class=\"n\">n</span> <span class=\"n\">x</span> <span class=\"n\">α</span><span class=\"o\">)</span>\n  <span class=\"bp\">|</span> <span class=\"n\">n</span> <span class=\"n\">x</span> <span class=\"err\">⟪</span><span class=\"n\">a</span><span class=\"o\">,</span><span class=\"n\">c</span><span class=\"err\">⟫</span>      <span class=\"o\">:=</span> <span class=\"err\">⟪</span><span class=\"n\">subst</span> <span class=\"n\">n</span> <span class=\"n\">x</span> <span class=\"n\">a</span><span class=\"o\">,</span> <span class=\"n\">subst</span> <span class=\"n\">n</span> <span class=\"n\">x</span> <span class=\"n\">c</span><span class=\"err\">⟫</span>\n  <span class=\"bp\">|</span> <span class=\"n\">n</span> <span class=\"n\">x</span> <span class=\"o\">(</span><span class=\"n\">var</span> <span class=\"n\">m</span><span class=\"o\">)</span>    <span class=\"o\">:=</span> <span class=\"k\">if</span> <span class=\"n\">n</span><span class=\"bp\">=</span><span class=\"n\">m</span> <span class=\"k\">then</span> <span class=\"n\">x</span> <span class=\"k\">else</span> <span class=\"n\">var</span> <span class=\"n\">m</span>\n  <span class=\"bp\">|</span> <span class=\"n\">n</span> <span class=\"n\">x</span> <span class=\"err\">⟦</span> <span class=\"n\">A</span> <span class=\"bp\">|</span> <span class=\"n\">φ</span> <span class=\"err\">⟧</span>   <span class=\"o\">:=</span>    <span class=\"err\">⟦</span><span class=\"n\">A</span> <span class=\"bp\">|</span> <span class=\"n\">subst</span> <span class=\"o\">(</span><span class=\"n\">n</span><span class=\"bp\">+</span><span class=\"mi\">1</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">lift</span> <span class=\"n\">x</span><span class=\"o\">)</span> <span class=\"n\">φ</span><span class=\"err\">⟧</span>\n  <span class=\"bp\">|</span> <span class=\"n\">n</span> <span class=\"n\">x</span> <span class=\"o\">(</span><span class=\"bp\">∀</span><span class=\"err\">&#39;</span> <span class=\"n\">A</span> <span class=\"n\">φ</span><span class=\"o\">)</span>     <span class=\"o\">:=</span> <span class=\"bp\">∀</span><span class=\"err\">&#39;</span> <span class=\"n\">A</span> <span class=\"o\">(</span><span class=\"n\">subst</span> <span class=\"o\">(</span><span class=\"n\">n</span><span class=\"bp\">+</span><span class=\"mi\">1</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">lift</span> <span class=\"n\">x</span><span class=\"o\">)</span> <span class=\"n\">φ</span><span class=\"o\">)</span>\n  <span class=\"bp\">|</span> <span class=\"n\">n</span> <span class=\"n\">x</span> <span class=\"o\">(</span><span class=\"bp\">∃</span><span class=\"err\">&#39;</span> <span class=\"n\">A</span> <span class=\"n\">φ</span><span class=\"o\">)</span>     <span class=\"o\">:=</span> <span class=\"bp\">∃</span><span class=\"err\">&#39;</span> <span class=\"n\">A</span> <span class=\"o\">(</span><span class=\"n\">subst</span> <span class=\"o\">(</span><span class=\"n\">n</span><span class=\"bp\">+</span><span class=\"mi\">1</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">lift</span> <span class=\"n\">x</span><span class=\"o\">)</span> <span class=\"n\">φ</span><span class=\"o\">)</span>\n\n  <span class=\"kn\">notation</span>  <span class=\"bp\">`</span><span class=\"err\">⁅</span><span class=\"bp\">`</span> <span class=\"n\">φ</span> <span class=\"bp\">`</span> <span class=\"bp\">//</span> <span class=\"bp\">`</span>  <span class=\"n\">b</span> <span class=\"bp\">`</span><span class=\"err\">⁆</span><span class=\"bp\">`</span> <span class=\"o\">:=</span> <span class=\"n\">subst</span> <span class=\"mi\">0</span> <span class=\"n\">b</span> <span class=\"n\">φ</span>\n\n  <span class=\"bp\">#</span><span class=\"n\">reduce</span> <span class=\"err\">⁅</span><span class=\"mi\">𝟘</span> <span class=\"bp\">//</span> <span class=\"err\">⊤</span> <span class=\"err\">⋀</span> <span class=\"err\">⊥⁆</span>\n  <span class=\"bp\">#</span><span class=\"n\">reduce</span> <span class=\"err\">⁅</span> <span class=\"mi\">𝟙</span> <span class=\"bp\">//</span> <span class=\"err\">⊤</span> <span class=\"err\">⋀</span> <span class=\"err\">⊥⁆</span>\n\n<span class=\"kn\">end</span> <span class=\"n\">substitution</span>\n\n<span class=\"n\">def</span> <span class=\"n\">eq</span> <span class=\"o\">(</span><span class=\"n\">A</span><span class=\"o\">:</span><span class=\"n\">type</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">a₁</span> <span class=\"n\">a₂</span> <span class=\"o\">:</span> <span class=\"n\">term</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">term</span> <span class=\"o\">:=</span> <span class=\"bp\">∀</span><span class=\"err\">&#39;</span> <span class=\"o\">(</span><span class=\"err\">𝒫</span> <span class=\"n\">A</span><span class=\"o\">)</span> <span class=\"err\">$</span> <span class=\"o\">((</span><span class=\"n\">lift</span> <span class=\"n\">a₁</span><span class=\"o\">)</span> <span class=\"err\">∈</span> <span class=\"mi\">𝟘</span><span class=\"o\">)</span> <span class=\"err\">⇔</span> <span class=\"o\">((</span><span class=\"n\">lift</span> <span class=\"n\">a₂</span><span class=\"o\">)</span> <span class=\"err\">∈</span> <span class=\"mi\">𝟘</span><span class=\"o\">)</span>\n<span class=\"kn\">notation</span> <span class=\"n\">a</span> <span class=\"bp\">`</span> <span class=\"err\">≃</span><span class=\"o\">[</span><span class=\"bp\">`</span><span class=\"o\">:</span><span class=\"n\">max</span> <span class=\"n\">A</span> <span class=\"bp\">`</span><span class=\"o\">]</span> <span class=\"bp\">`</span><span class=\"o\">:</span><span class=\"mi\">0</span> <span class=\"n\">b</span> <span class=\"o\">:=</span> <span class=\"n\">eq</span> <span class=\"n\">A</span> <span class=\"n\">a</span> <span class=\"n\">b</span>\n\n<span class=\"bp\">#</span><span class=\"kn\">check</span> <span class=\"n\">eq</span> <span class=\"n\">Unit</span> <span class=\"mi\">𝟘</span> <span class=\"mi\">𝟘</span>\n\n<span class=\"n\">def</span> <span class=\"n\">singleton</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"o\">:</span> <span class=\"n\">type</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">a</span> <span class=\"o\">:</span> <span class=\"n\">term</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"err\">⟦</span><span class=\"n\">A</span> <span class=\"bp\">|</span> <span class=\"o\">(</span><span class=\"n\">lift</span> <span class=\"n\">a</span><span class=\"o\">)</span> <span class=\"err\">≃</span><span class=\"o\">[</span><span class=\"n\">A</span><span class=\"o\">]</span> <span class=\"mi\">𝟘</span><span class=\"err\">⟧</span>\n\n<span class=\"n\">def</span> <span class=\"n\">ex_unique</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"o\">:</span> <span class=\"n\">type</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">φ</span> <span class=\"o\">:</span> <span class=\"n\">term</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">term</span> <span class=\"o\">:=</span>\n  <span class=\"bp\">∃</span><span class=\"err\">&#39;</span> <span class=\"n\">A</span> <span class=\"o\">(</span><span class=\"err\">⟦</span><span class=\"n\">A</span> <span class=\"bp\">|</span> <span class=\"n\">φ</span><span class=\"err\">⟧</span> <span class=\"err\">≃</span><span class=\"o\">[</span><span class=\"err\">𝒫</span> <span class=\"n\">A</span><span class=\"o\">]</span> <span class=\"o\">(</span><span class=\"n\">singleton</span> <span class=\"n\">A</span> <span class=\"mi\">𝟘</span><span class=\"o\">))</span>\n<span class=\"kn\">prefix</span> <span class=\"bp\">`∃!</span><span class=\"err\">&#39;</span><span class=\"bp\">`</span><span class=\"o\">:</span><span class=\"mi\">2</span> <span class=\"o\">:=</span> <span class=\"n\">ex_unique</span>\n\n<span class=\"n\">def</span> <span class=\"n\">subseteq</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"o\">:</span> <span class=\"n\">type</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">α</span> <span class=\"o\">:</span> <span class=\"n\">term</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">β</span> <span class=\"o\">:</span> <span class=\"n\">term</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">term</span> <span class=\"o\">:=</span>\n  <span class=\"bp\">∀</span><span class=\"err\">&#39;</span> <span class=\"n\">A</span> <span class=\"o\">(</span><span class=\"mi\">𝟘</span> <span class=\"err\">∈</span> <span class=\"n\">α</span><span class=\"o\">)</span> <span class=\"err\">⟹</span> <span class=\"o\">(</span><span class=\"mi\">𝟘</span> <span class=\"err\">∈</span> <span class=\"n\">β</span><span class=\"o\">)</span>\n<span class=\"kn\">notation</span> <span class=\"n\">a</span> <span class=\"bp\">`</span> <span class=\"err\">⊆</span><span class=\"o\">[</span><span class=\"bp\">`</span><span class=\"o\">:</span><span class=\"n\">max</span> <span class=\"n\">A</span> <span class=\"bp\">`</span><span class=\"o\">]</span> <span class=\"bp\">`</span><span class=\"o\">:</span><span class=\"mi\">0</span> <span class=\"n\">b</span> <span class=\"o\">:=</span> <span class=\"n\">subseteq</span> <span class=\"n\">A</span> <span class=\"n\">a</span> <span class=\"n\">b</span>\n\n<span class=\"n\">def</span> <span class=\"n\">term_prod</span> <span class=\"o\">{</span><span class=\"n\">A</span> <span class=\"n\">B</span> <span class=\"o\">:</span> <span class=\"n\">type</span><span class=\"o\">}</span> <span class=\"o\">(</span><span class=\"n\">α</span> <span class=\"n\">β</span> <span class=\"o\">:</span> <span class=\"n\">term</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">term</span> <span class=\"o\">:=</span>\n  <span class=\"err\">⟦</span> <span class=\"n\">A</span> <span class=\"bp\">××</span> <span class=\"n\">B</span> <span class=\"bp\">|</span> <span class=\"bp\">∃</span><span class=\"err\">&#39;</span> <span class=\"n\">A</span> <span class=\"o\">(</span><span class=\"bp\">∃</span><span class=\"err\">&#39;</span> <span class=\"n\">B</span> <span class=\"o\">((</span><span class=\"mi\">𝟙</span> <span class=\"err\">∈</span> <span class=\"n\">α</span><span class=\"o\">)</span> <span class=\"err\">⋀</span> <span class=\"o\">(</span><span class=\"mi\">𝟘</span> <span class=\"err\">∈</span> <span class=\"n\">β</span><span class=\"o\">)</span> <span class=\"err\">⋀</span> <span class=\"o\">(</span><span class=\"n\">eq</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"bp\">××</span> <span class=\"n\">B</span><span class=\"o\">)</span> <span class=\"mi\">𝟚</span> <span class=\"err\">⟪</span><span class=\"mi\">𝟙</span><span class=\"o\">,</span><span class=\"mi\">𝟘</span><span class=\"err\">⟫</span><span class=\"o\">)))</span><span class=\"err\">⟧</span>\n<span class=\"kn\">notation</span> <span class=\"n\">α</span> <span class=\"bp\">`</span> <span class=\"bp\">×</span><span class=\"n\">x</span><span class=\"o\">[</span><span class=\"bp\">`</span><span class=\"o\">:</span><span class=\"n\">max</span> <span class=\"n\">A</span> <span class=\"bp\">`</span><span class=\"o\">]</span> <span class=\"bp\">`</span><span class=\"o\">:</span><span class=\"mi\">0</span> <span class=\"n\">β</span> <span class=\"o\">:=</span> <span class=\"n\">term_prod</span> <span class=\"n\">A</span> <span class=\"n\">α</span> <span class=\"n\">β</span>\n\n<span class=\"c1\">-- * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *</span>\n<span class=\"kn\">open</span> <span class=\"n\">term</span>\n\n<span class=\"kn\">inductive</span> <span class=\"n\">WF</span> <span class=\"o\">:</span> <span class=\"kn\">context</span> <span class=\"bp\">→</span> <span class=\"n\">type</span> <span class=\"bp\">→</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"kt\">Prop</span>\n<span class=\"bp\">|</span> <span class=\"n\">star</span> <span class=\"o\">{</span><span class=\"err\">Γ</span><span class=\"o\">}</span>         <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"n\">Unit</span> <span class=\"err\">⁎</span>\n<span class=\"bp\">|</span> <span class=\"n\">top</span>  <span class=\"o\">{</span><span class=\"err\">Γ</span><span class=\"o\">}</span>         <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"err\">⊤</span>\n<span class=\"bp\">|</span> <span class=\"n\">bot</span>  <span class=\"o\">{</span><span class=\"err\">Γ</span><span class=\"o\">}</span>         <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"err\">⊥</span>\n<span class=\"bp\">|</span> <span class=\"n\">and</span>  <span class=\"o\">{</span><span class=\"err\">Γ</span> <span class=\"n\">p</span> <span class=\"n\">q</span><span class=\"o\">}</span>     <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"n\">p</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"n\">q</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"err\">⋀</span> <span class=\"n\">q</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"n\">or</span>   <span class=\"o\">{</span><span class=\"err\">Γ</span> <span class=\"n\">p</span> <span class=\"n\">q</span><span class=\"o\">}</span>     <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"n\">p</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"n\">q</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"err\">⋁</span> <span class=\"n\">q</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"n\">imp</span>  <span class=\"o\">{</span><span class=\"err\">Γ</span> <span class=\"n\">p</span> <span class=\"n\">q</span><span class=\"o\">}</span>     <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"n\">p</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"n\">q</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"err\">⟹</span> <span class=\"n\">q</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"n\">elem</span> <span class=\"o\">{</span><span class=\"err\">Γ</span> <span class=\"n\">A</span> <span class=\"n\">a</span> <span class=\"n\">α</span><span class=\"o\">}</span>   <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"n\">A</span> <span class=\"n\">a</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"o\">(</span><span class=\"err\">𝒫</span> <span class=\"n\">A</span><span class=\"o\">)</span> <span class=\"n\">α</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"o\">(</span><span class=\"n\">a</span> <span class=\"err\">∈</span> <span class=\"n\">α</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"n\">pair</span> <span class=\"o\">{</span><span class=\"err\">Γ</span> <span class=\"n\">A</span> <span class=\"n\">B</span> <span class=\"n\">a</span> <span class=\"n\">b</span><span class=\"o\">}</span> <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"n\">A</span> <span class=\"n\">a</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"n\">B</span> <span class=\"n\">b</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"bp\">××</span> <span class=\"n\">B</span><span class=\"o\">)</span> <span class=\"err\">⟪</span><span class=\"n\">a</span><span class=\"o\">,</span><span class=\"n\">b</span><span class=\"err\">⟫</span>\n<span class=\"bp\">|</span> <span class=\"n\">var</span>  <span class=\"o\">{</span><span class=\"err\">Γ</span> <span class=\"n\">A</span> <span class=\"n\">n</span><span class=\"o\">}</span>     <span class=\"o\">:</span> <span class=\"n\">list</span><span class=\"bp\">.</span><span class=\"n\">nth</span> <span class=\"err\">Γ</span> <span class=\"n\">n</span> <span class=\"bp\">=</span> <span class=\"n\">some</span> <span class=\"n\">A</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"n\">A</span> <span class=\"o\">(</span><span class=\"n\">var</span> <span class=\"n\">n</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"n\">comp</span> <span class=\"o\">{</span><span class=\"err\">Γ</span> <span class=\"n\">A</span> <span class=\"n\">φ</span><span class=\"o\">}</span>     <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"o\">(</span><span class=\"n\">A</span><span class=\"bp\">::</span><span class=\"err\">Γ</span><span class=\"o\">)</span> <span class=\"err\">Ω</span> <span class=\"n\">φ</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"o\">(</span><span class=\"err\">𝒫</span> <span class=\"n\">A</span><span class=\"o\">)</span> <span class=\"err\">⟦</span><span class=\"n\">A</span> <span class=\"bp\">|</span> <span class=\"n\">φ</span><span class=\"err\">⟧</span>\n<span class=\"bp\">|</span> <span class=\"n\">all</span>  <span class=\"o\">{</span><span class=\"err\">Γ</span> <span class=\"n\">A</span> <span class=\"n\">φ</span><span class=\"o\">}</span>     <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"o\">(</span><span class=\"n\">A</span><span class=\"bp\">::</span><span class=\"err\">Γ</span><span class=\"o\">)</span> <span class=\"err\">Ω</span> <span class=\"n\">φ</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"o\">(</span><span class=\"bp\">∀</span><span class=\"err\">&#39;</span> <span class=\"n\">A</span> <span class=\"n\">φ</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"n\">ex</span>   <span class=\"o\">{</span><span class=\"err\">Γ</span> <span class=\"n\">A</span> <span class=\"n\">φ</span><span class=\"o\">}</span>     <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"o\">(</span><span class=\"n\">A</span><span class=\"bp\">::</span><span class=\"err\">Γ</span><span class=\"o\">)</span> <span class=\"err\">Ω</span> <span class=\"n\">φ</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"o\">(</span><span class=\"bp\">∃</span><span class=\"err\">&#39;</span> <span class=\"n\">A</span> <span class=\"n\">φ</span><span class=\"o\">)</span>\n\n\n\n<span class=\"bp\">@</span><span class=\"o\">[</span><span class=\"n\">user_attribute</span><span class=\"o\">]</span>\n<span class=\"n\">meta</span> <span class=\"n\">def</span> <span class=\"n\">WF_rules</span> <span class=\"o\">:</span> <span class=\"n\">user_attribute</span> <span class=\"o\">:=</span>\n<span class=\"o\">{</span> <span class=\"n\">name</span> <span class=\"o\">:=</span> <span class=\"bp\">`</span><span class=\"n\">WF_rules</span><span class=\"o\">,</span>\n  <span class=\"n\">descr</span> <span class=\"o\">:=</span> <span class=\"s2\">&quot;lemmas usable to prove Well Formedness&quot;</span> <span class=\"o\">}</span>\n\n<span class=\"n\">attribute</span> <span class=\"o\">[</span><span class=\"n\">WF_rules</span><span class=\"o\">]</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">star</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">top</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">bot</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">and</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">or</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">imp</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">elem</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">pair</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">var</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">comp</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">all</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">ex</span>\n\n\n<span class=\"kn\">section</span>\n\n<span class=\"kn\">variable</span> <span class=\"err\">Γ</span> <span class=\"o\">:</span> <span class=\"kn\">context</span>\n<span class=\"kn\">variables</span> <span class=\"n\">p</span> <span class=\"n\">q</span> <span class=\"n\">r</span> <span class=\"n\">φ</span> <span class=\"n\">a</span> <span class=\"n\">b</span> <span class=\"n\">α</span> <span class=\"o\">:</span> <span class=\"n\">term</span>\n<span class=\"kn\">variables</span> <span class=\"o\">{</span><span class=\"n\">A</span> <span class=\"n\">B</span> <span class=\"err\">Ω&#39;</span> <span class=\"o\">:</span> <span class=\"n\">type</span><span class=\"o\">}</span>\n<span class=\"c1\">-- Ω&#39; is just a fake/variable version of Ω so we don&#39;t need to bother proving</span>\n<span class=\"c1\">-- that it must be Ω itself.&#39;</span>\n\n<span class=\"n\">meta</span> <span class=\"n\">def</span> <span class=\"n\">WF_prover</span> <span class=\"o\">:</span> <span class=\"n\">tactic</span> <span class=\"n\">unit</span> <span class=\"o\">:=</span> <span class=\"n\">do</span> <span class=\"bp\">`</span><span class=\"o\">[</span><span class=\"n\">intro</span> <span class=\"n\">h</span><span class=\"o\">,</span> <span class=\"n\">cases</span> <span class=\"n\">h</span><span class=\"o\">,</span> <span class=\"n\">assumption</span><span class=\"o\">]</span>\n\n<span class=\"kn\">lemma</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">and_left</span>   <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω&#39;</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"err\">⋀</span> <span class=\"n\">q</span><span class=\"o\">)</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω&#39;</span> <span class=\"n\">p</span> <span class=\"o\">:=</span> <span class=\"k\">by</span> <span class=\"n\">WF_prover</span>\n<span class=\"kn\">lemma</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">and_right</span>  <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω&#39;</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"err\">⋀</span> <span class=\"n\">q</span><span class=\"o\">)</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω&#39;</span> <span class=\"n\">q</span> <span class=\"o\">:=</span> <span class=\"k\">by</span> <span class=\"n\">WF_prover</span>\n<span class=\"kn\">lemma</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">or_left</span>    <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω&#39;</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"err\">⋁</span> <span class=\"n\">q</span><span class=\"o\">)</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω&#39;</span> <span class=\"n\">p</span> <span class=\"o\">:=</span> <span class=\"k\">by</span> <span class=\"n\">WF_prover</span>\n<span class=\"kn\">lemma</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">or_right</span>   <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω&#39;</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"err\">⋁</span> <span class=\"n\">q</span><span class=\"o\">)</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω&#39;</span> <span class=\"n\">q</span> <span class=\"o\">:=</span> <span class=\"k\">by</span> <span class=\"n\">WF_prover</span>\n<span class=\"kn\">lemma</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">imp_left</span>   <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω&#39;</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"err\">⟹</span> <span class=\"n\">q</span><span class=\"o\">)</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω&#39;</span> <span class=\"n\">p</span> <span class=\"o\">:=</span> <span class=\"k\">by</span> <span class=\"n\">WF_prover</span>\n<span class=\"kn\">lemma</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">imp_right</span>  <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω&#39;</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"err\">⟹</span> <span class=\"n\">q</span><span class=\"o\">)</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω&#39;</span> <span class=\"n\">q</span> <span class=\"o\">:=</span> <span class=\"k\">by</span> <span class=\"n\">WF_prover</span>\n<span class=\"kn\">lemma</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">pair_left</span>  <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"bp\">××</span> <span class=\"n\">B</span><span class=\"o\">)</span> <span class=\"err\">⟪</span><span class=\"n\">a</span><span class=\"o\">,</span><span class=\"n\">b</span><span class=\"err\">⟫</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"n\">A</span> <span class=\"n\">a</span> <span class=\"o\">:=</span> <span class=\"k\">by</span> <span class=\"n\">WF_prover</span>\n<span class=\"kn\">lemma</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">pair_right</span> <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"bp\">××</span> <span class=\"n\">B</span><span class=\"o\">)</span> <span class=\"err\">⟪</span><span class=\"n\">a</span><span class=\"o\">,</span><span class=\"n\">b</span><span class=\"err\">⟫</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"n\">B</span> <span class=\"n\">b</span> <span class=\"o\">:=</span> <span class=\"k\">by</span> <span class=\"n\">WF_prover</span>\n<span class=\"kn\">lemma</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">comp_elim</span>  <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"o\">(</span><span class=\"err\">𝒫</span> <span class=\"n\">A</span><span class=\"o\">)</span> <span class=\"err\">⟦</span><span class=\"n\">A</span> <span class=\"bp\">|</span> <span class=\"n\">φ</span><span class=\"err\">⟧</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"o\">(</span><span class=\"n\">A</span><span class=\"bp\">::</span><span class=\"err\">Γ</span><span class=\"o\">)</span> <span class=\"err\">Ω</span> <span class=\"n\">φ</span> <span class=\"o\">:=</span> <span class=\"k\">by</span> <span class=\"n\">WF_prover</span>\n<span class=\"kn\">lemma</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">all_elim</span>   <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω&#39;</span> <span class=\"o\">(</span><span class=\"bp\">∀</span><span class=\"err\">&#39;</span> <span class=\"n\">A</span> <span class=\"n\">φ</span><span class=\"o\">)</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"o\">(</span><span class=\"n\">A</span><span class=\"bp\">::</span><span class=\"err\">Γ</span><span class=\"o\">)</span> <span class=\"err\">Ω&#39;</span> <span class=\"n\">φ</span> <span class=\"o\">:=</span> <span class=\"k\">by</span> <span class=\"n\">WF_prover</span>\n<span class=\"kn\">lemma</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">ex_elim</span>    <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω&#39;</span> <span class=\"o\">(</span><span class=\"bp\">∀</span><span class=\"err\">&#39;</span> <span class=\"n\">A</span> <span class=\"n\">φ</span><span class=\"o\">)</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"o\">(</span><span class=\"n\">A</span><span class=\"bp\">::</span><span class=\"err\">Γ</span><span class=\"o\">)</span> <span class=\"err\">Ω&#39;</span> <span class=\"n\">φ</span> <span class=\"o\">:=</span> <span class=\"k\">by</span> <span class=\"n\">WF_prover</span>\n<span class=\"bp\">@</span><span class=\"o\">[</span><span class=\"n\">WF_rules</span><span class=\"o\">]</span> <span class=\"kn\">lemma</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">iff_intro</span> <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"n\">p</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"n\">q</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"err\">⇔</span> <span class=\"n\">q</span><span class=\"o\">)</span> <span class=\"o\">:=</span>\n<span class=\"k\">begin</span>\n  <span class=\"n\">intros</span><span class=\"o\">,</span>\n  <span class=\"n\">apply_rules</span> <span class=\"n\">WF_rules</span><span class=\"o\">,</span>\n  <span class=\"c1\">-- apply_rules [WF.and, WF.imp],</span>\n<span class=\"kn\">end</span>\n\n<span class=\"kn\">end</span>\n\n<span class=\"kn\">end</span> <span class=\"n\">TT</span>\n</code></pre></div>",
        "id": 200405009,
        "sender_full_name": "Billy Price",
        "timestamp": 1591789261
    },
    {
        "content": "<p>Could you paste what you got working <span class=\"user-mention\" data-user-id=\"110032\">@Reid Barton</span> ?</p>",
        "id": 200405027,
        "sender_full_name": "Billy Price",
        "timestamp": 1591789278
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span><code><span class=\"c\">/-</span><span class=\"cm\"></span>\n<span class=\"cm\">Definitions of a type theory</span>\n\n<span class=\"cm\">Author: Billy Price</span>\n<span class=\"cm\">-/</span>\n\n<span class=\"kn\">import</span> <span class=\"n\">data</span><span class=\"bp\">.</span><span class=\"n\">finset</span>\n<span class=\"kn\">namespace</span> <span class=\"n\">TT</span>\n\n<span class=\"kn\">inductive</span> <span class=\"n\">type</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span>\n<span class=\"bp\">|</span> <span class=\"n\">Unit</span> <span class=\"bp\">|</span> <span class=\"n\">Omega</span> <span class=\"bp\">|</span> <span class=\"n\">Prod</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"n\">B</span> <span class=\"o\">:</span> <span class=\"n\">type</span><span class=\"o\">)</span><span class=\"bp\">|</span> <span class=\"n\">Pow</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"o\">:</span> <span class=\"n\">type</span><span class=\"o\">)</span>\n\n<span class=\"kn\">notation</span> <span class=\"bp\">`</span><span class=\"err\">Ω</span><span class=\"bp\">`</span> <span class=\"o\">:=</span> <span class=\"n\">type</span><span class=\"bp\">.</span><span class=\"n\">Omega</span>\n<span class=\"n\">def</span> <span class=\"n\">Unit</span> <span class=\"o\">:=</span> <span class=\"n\">type</span><span class=\"bp\">.</span><span class=\"n\">Unit</span>\n<span class=\"kn\">infix</span> <span class=\"bp\">`××`</span><span class=\"o\">:</span><span class=\"n\">max</span> <span class=\"o\">:=</span> <span class=\"n\">type</span><span class=\"bp\">.</span><span class=\"n\">Prod</span>\n<span class=\"kn\">notation</span> <span class=\"bp\">`</span><span class=\"err\">𝒫</span><span class=\"bp\">`</span><span class=\"n\">A</span> <span class=\"o\">:</span><span class=\"n\">max</span> <span class=\"o\">:=</span> <span class=\"n\">type</span><span class=\"bp\">.</span><span class=\"n\">Pow</span> <span class=\"n\">A</span>\n\n<span class=\"n\">def</span> <span class=\"kn\">context</span> <span class=\"o\">:=</span> <span class=\"n\">list</span> <span class=\"n\">type</span>\n\n<span class=\"kn\">inductive</span> <span class=\"n\">term</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span>\n<span class=\"bp\">|</span> <span class=\"n\">star</span> <span class=\"o\">:</span> <span class=\"n\">term</span>\n<span class=\"bp\">|</span> <span class=\"n\">top</span>  <span class=\"o\">:</span> <span class=\"n\">term</span>\n<span class=\"bp\">|</span> <span class=\"n\">bot</span>  <span class=\"o\">:</span> <span class=\"n\">term</span>\n<span class=\"bp\">|</span> <span class=\"n\">and</span>  <span class=\"o\">:</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">term</span>\n<span class=\"bp\">|</span> <span class=\"n\">or</span>   <span class=\"o\">:</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">term</span>\n<span class=\"bp\">|</span> <span class=\"n\">imp</span>  <span class=\"o\">:</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">term</span>\n<span class=\"bp\">|</span> <span class=\"n\">elem</span> <span class=\"o\">:</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">term</span>\n<span class=\"bp\">|</span> <span class=\"n\">pair</span> <span class=\"o\">:</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">term</span>\n<span class=\"bp\">|</span> <span class=\"n\">var</span>  <span class=\"o\">:</span> <span class=\"bp\">ℕ</span> <span class=\"bp\">→</span> <span class=\"n\">term</span>\n<span class=\"bp\">|</span> <span class=\"n\">comp</span> <span class=\"o\">:</span> <span class=\"n\">type</span> <span class=\"bp\">→</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">term</span>\n<span class=\"bp\">|</span> <span class=\"n\">all</span>  <span class=\"o\">:</span> <span class=\"n\">type</span> <span class=\"bp\">→</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">term</span>\n<span class=\"bp\">|</span> <span class=\"n\">ex</span>   <span class=\"o\">:</span> <span class=\"n\">type</span> <span class=\"bp\">→</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">term</span>\n\n<span class=\"kn\">open</span> <span class=\"n\">term</span>\n\n<span class=\"c1\">-- * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *</span>\n<span class=\"c1\">-- Notation and derived operators</span>\n<span class=\"c1\">-- * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *</span>\n\n<span class=\"kn\">notation</span> <span class=\"bp\">`</span><span class=\"mi\">𝟘</span><span class=\"bp\">`</span> <span class=\"o\">:=</span> <span class=\"n\">term</span><span class=\"bp\">.</span><span class=\"n\">var</span> <span class=\"mi\">0</span>\n<span class=\"kn\">notation</span> <span class=\"bp\">`</span><span class=\"mi\">𝟙</span><span class=\"bp\">`</span> <span class=\"o\">:=</span> <span class=\"n\">term</span><span class=\"bp\">.</span><span class=\"n\">var</span> <span class=\"mi\">1</span>\n<span class=\"kn\">notation</span> <span class=\"bp\">`</span><span class=\"mi\">𝟚</span><span class=\"bp\">`</span> <span class=\"o\">:=</span> <span class=\"n\">term</span><span class=\"bp\">.</span><span class=\"n\">var</span> <span class=\"mi\">2</span>\n<span class=\"kn\">notation</span> <span class=\"bp\">`</span><span class=\"mi\">𝟛</span><span class=\"bp\">`</span> <span class=\"o\">:=</span> <span class=\"n\">term</span><span class=\"bp\">.</span><span class=\"n\">var</span> <span class=\"mi\">3</span>\n<span class=\"kn\">notation</span> <span class=\"bp\">`</span><span class=\"mi\">𝟜</span><span class=\"bp\">`</span> <span class=\"o\">:=</span> <span class=\"n\">term</span><span class=\"bp\">.</span><span class=\"n\">var</span> <span class=\"mi\">4</span>\n<span class=\"kn\">notation</span> <span class=\"bp\">`</span><span class=\"mi\">𝟝</span><span class=\"bp\">`</span> <span class=\"o\">:=</span> <span class=\"n\">term</span><span class=\"bp\">.</span><span class=\"n\">var</span> <span class=\"mi\">5</span>\n\n<span class=\"kn\">notation</span> <span class=\"bp\">`</span><span class=\"err\">⁎</span><span class=\"bp\">`</span> <span class=\"o\">:=</span> <span class=\"n\">term</span><span class=\"bp\">.</span><span class=\"n\">star</span>    <span class=\"c1\">-- input \\asterisk</span>\n<span class=\"kn\">notation</span> <span class=\"bp\">`</span><span class=\"err\">⊤</span><span class=\"bp\">`</span> <span class=\"o\">:=</span> <span class=\"n\">term</span><span class=\"bp\">.</span><span class=\"n\">top</span>     <span class=\"c1\">--       \\top</span>\n<span class=\"kn\">notation</span> <span class=\"bp\">`</span><span class=\"err\">⊥</span><span class=\"bp\">`</span> <span class=\"o\">:=</span> <span class=\"n\">term</span><span class=\"bp\">.</span><span class=\"n\">bot</span>     <span class=\"c1\">-- input \\bot</span>\n<span class=\"kn\">infixr</span> <span class=\"bp\">`</span> <span class=\"err\">⟹</span> <span class=\"bp\">`</span><span class=\"o\">:</span><span class=\"mi\">60</span> <span class=\"o\">:=</span> <span class=\"n\">term</span><span class=\"bp\">.</span><span class=\"n\">imp</span> <span class=\"c1\">-- input \\==&gt;</span>\n<span class=\"kn\">infixr</span> <span class=\"bp\">`</span> <span class=\"err\">⋀</span> <span class=\"bp\">`</span> <span class=\"o\">:</span><span class=\"mi\">70</span> <span class=\"o\">:=</span> <span class=\"n\">term</span><span class=\"bp\">.</span><span class=\"n\">and</span> <span class=\"c1\">-- input \\And or \\bigwedge</span>\n<span class=\"kn\">infixr</span> <span class=\"bp\">`</span> <span class=\"err\">⋁</span> <span class=\"bp\">`</span> <span class=\"o\">:</span><span class=\"mi\">59</span> <span class=\"o\">:=</span> <span class=\"n\">term</span><span class=\"bp\">.</span><span class=\"n\">or</span>  <span class=\"c1\">-- input \\Or or \\bigvee</span>\n\n<span class=\"n\">def</span> <span class=\"n\">not</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"o\">:</span> <span class=\"n\">term</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"n\">p</span> <span class=\"err\">⟹</span> <span class=\"err\">⊥</span>\n<span class=\"kn\">prefix</span> <span class=\"bp\">`</span><span class=\"err\">∼</span><span class=\"bp\">`</span><span class=\"o\">:</span><span class=\"n\">max</span> <span class=\"o\">:=</span> <span class=\"n\">not</span> <span class=\"c1\">-- input \\~</span>\n\n<span class=\"n\">def</span> <span class=\"n\">iff</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"n\">q</span><span class=\"o\">:</span> <span class=\"n\">term</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"err\">⟹</span> <span class=\"n\">q</span><span class=\"o\">)</span> <span class=\"err\">⋀</span> <span class=\"o\">(</span><span class=\"n\">q</span> <span class=\"err\">⟹</span> <span class=\"n\">p</span><span class=\"o\">)</span>\n<span class=\"kn\">infix</span> <span class=\"bp\">`</span> <span class=\"err\">⇔</span> <span class=\"bp\">`</span><span class=\"o\">:</span><span class=\"mi\">60</span> <span class=\"o\">:=</span> <span class=\"n\">iff</span> <span class=\"c1\">-- input \\&lt;=&gt;</span>\n\n<span class=\"kn\">infix</span> <span class=\"err\">∈</span> <span class=\"o\">:=</span> <span class=\"n\">term</span><span class=\"bp\">.</span><span class=\"n\">elem</span>\n<span class=\"kn\">infix</span> <span class=\"err\">∉</span> <span class=\"o\">:=</span> <span class=\"bp\">λ</span> <span class=\"n\">a</span> <span class=\"n\">α</span><span class=\"o\">,</span> <span class=\"n\">not</span> <span class=\"o\">(</span><span class=\"n\">term</span><span class=\"bp\">.</span><span class=\"n\">elem</span> <span class=\"n\">a</span> <span class=\"n\">α</span><span class=\"o\">)</span>\n<span class=\"kn\">notation</span> <span class=\"bp\">`</span><span class=\"err\">⟦</span> <span class=\"bp\">`</span> <span class=\"n\">A</span> <span class=\"bp\">`</span> <span class=\"bp\">|</span> <span class=\"bp\">`</span> <span class=\"n\">φ</span> <span class=\"bp\">`</span> <span class=\"err\">⟧</span><span class=\"bp\">`</span> <span class=\"o\">:=</span> <span class=\"n\">term</span><span class=\"bp\">.</span><span class=\"n\">comp</span> <span class=\"n\">A</span> <span class=\"n\">φ</span>\n\n<span class=\"kn\">notation</span> <span class=\"bp\">`</span><span class=\"err\">⟪</span><span class=\"bp\">`</span> <span class=\"n\">a</span> <span class=\"bp\">`</span><span class=\"o\">,</span><span class=\"bp\">`</span> <span class=\"n\">b</span> <span class=\"bp\">`</span><span class=\"err\">⟫</span><span class=\"bp\">`</span> <span class=\"o\">:=</span> <span class=\"n\">term</span><span class=\"bp\">.</span><span class=\"n\">pair</span> <span class=\"n\">a</span> <span class=\"n\">b</span>\n\n<span class=\"kn\">notation</span> <span class=\"bp\">`∀</span><span class=\"err\">&#39;</span><span class=\"bp\">`</span> <span class=\"o\">:=</span> <span class=\"n\">term</span><span class=\"bp\">.</span><span class=\"n\">all</span>\n<span class=\"kn\">notation</span> <span class=\"bp\">`∃</span><span class=\"err\">&#39;</span><span class=\"bp\">`</span> <span class=\"o\">:=</span> <span class=\"n\">term</span><span class=\"bp\">.</span><span class=\"n\">ex</span>\n\n\n<span class=\"kn\">section</span> <span class=\"n\">substitution</span>\n\n  <span class=\"bp\">@</span><span class=\"o\">[</span><span class=\"n\">simp</span><span class=\"o\">]</span>\n  <span class=\"n\">def</span> <span class=\"n\">lift_d</span> <span class=\"o\">(</span><span class=\"n\">d</span> <span class=\"o\">:</span> <span class=\"bp\">ℕ</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"bp\">ℕ</span> <span class=\"bp\">→</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">term</span>\n  <span class=\"bp\">|</span> <span class=\"n\">k</span> <span class=\"err\">⁎</span>          <span class=\"o\">:=</span> <span class=\"err\">⁎</span>\n  <span class=\"bp\">|</span> <span class=\"n\">k</span> <span class=\"err\">⊤</span>          <span class=\"o\">:=</span> <span class=\"err\">⊤</span>\n  <span class=\"bp\">|</span> <span class=\"n\">k</span> <span class=\"err\">⊥</span>          <span class=\"o\">:=</span> <span class=\"err\">⊥</span>\n  <span class=\"bp\">|</span> <span class=\"n\">k</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"err\">⋀</span> <span class=\"n\">q</span><span class=\"o\">)</span>    <span class=\"o\">:=</span> <span class=\"o\">(</span><span class=\"n\">lift_d</span> <span class=\"n\">k</span> <span class=\"n\">p</span><span class=\"o\">)</span> <span class=\"err\">⋀</span> <span class=\"o\">(</span><span class=\"n\">lift_d</span> <span class=\"n\">k</span> <span class=\"n\">q</span><span class=\"o\">)</span>\n  <span class=\"bp\">|</span> <span class=\"n\">k</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"err\">⋁</span> <span class=\"n\">q</span><span class=\"o\">)</span>    <span class=\"o\">:=</span> <span class=\"o\">(</span><span class=\"n\">lift_d</span> <span class=\"n\">k</span> <span class=\"n\">p</span><span class=\"o\">)</span> <span class=\"err\">⋁</span> <span class=\"o\">(</span><span class=\"n\">lift_d</span> <span class=\"n\">k</span> <span class=\"n\">q</span><span class=\"o\">)</span>\n  <span class=\"bp\">|</span> <span class=\"n\">k</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"err\">⟹</span> <span class=\"n\">q</span><span class=\"o\">)</span>   <span class=\"o\">:=</span> <span class=\"o\">(</span><span class=\"n\">lift_d</span> <span class=\"n\">k</span> <span class=\"n\">p</span><span class=\"o\">)</span> <span class=\"err\">⟹</span> <span class=\"o\">(</span><span class=\"n\">lift_d</span> <span class=\"n\">k</span> <span class=\"n\">q</span><span class=\"o\">)</span>\n  <span class=\"bp\">|</span> <span class=\"n\">k</span> <span class=\"o\">(</span><span class=\"n\">a</span> <span class=\"err\">∈</span> <span class=\"n\">α</span><span class=\"o\">)</span>    <span class=\"o\">:=</span> <span class=\"o\">(</span><span class=\"n\">lift_d</span> <span class=\"n\">k</span> <span class=\"n\">a</span><span class=\"o\">)</span> <span class=\"err\">∈</span> <span class=\"o\">(</span><span class=\"n\">lift_d</span> <span class=\"n\">k</span> <span class=\"n\">α</span><span class=\"o\">)</span>\n  <span class=\"bp\">|</span> <span class=\"n\">k</span> <span class=\"err\">⟪</span><span class=\"n\">a</span><span class=\"o\">,</span><span class=\"n\">b</span><span class=\"err\">⟫</span>      <span class=\"o\">:=</span> <span class=\"err\">⟪</span><span class=\"n\">lift_d</span> <span class=\"n\">k</span> <span class=\"n\">a</span><span class=\"o\">,</span> <span class=\"n\">lift_d</span> <span class=\"n\">k</span> <span class=\"n\">b</span><span class=\"err\">⟫</span>\n  <span class=\"bp\">|</span> <span class=\"n\">k</span> <span class=\"o\">(</span><span class=\"n\">var</span> <span class=\"n\">m</span><span class=\"o\">)</span>    <span class=\"o\">:=</span> <span class=\"k\">if</span> <span class=\"n\">m</span><span class=\"bp\">≥</span><span class=\"n\">k</span> <span class=\"k\">then</span> <span class=\"n\">var</span> <span class=\"o\">(</span><span class=\"n\">m</span><span class=\"bp\">+</span><span class=\"n\">d</span><span class=\"o\">)</span> <span class=\"k\">else</span> <span class=\"n\">var</span> <span class=\"n\">m</span>\n  <span class=\"bp\">|</span> <span class=\"n\">k</span> <span class=\"err\">⟦</span><span class=\"n\">A</span> <span class=\"bp\">|</span> <span class=\"n\">φ</span><span class=\"err\">⟧</span>     <span class=\"o\">:=</span>    <span class=\"err\">⟦</span><span class=\"n\">A</span> <span class=\"bp\">|</span> <span class=\"n\">lift_d</span> <span class=\"o\">(</span><span class=\"n\">k</span><span class=\"bp\">+</span><span class=\"mi\">1</span><span class=\"o\">)</span> <span class=\"n\">φ</span><span class=\"err\">⟧</span>\n  <span class=\"bp\">|</span> <span class=\"n\">k</span> <span class=\"o\">(</span><span class=\"bp\">∀</span><span class=\"err\">&#39;</span> <span class=\"n\">A</span> <span class=\"n\">φ</span><span class=\"o\">)</span>   <span class=\"o\">:=</span> <span class=\"bp\">∀</span><span class=\"err\">&#39;</span> <span class=\"n\">A</span> <span class=\"err\">$</span> <span class=\"n\">lift_d</span> <span class=\"o\">(</span><span class=\"n\">k</span><span class=\"bp\">+</span><span class=\"mi\">1</span><span class=\"o\">)</span> <span class=\"n\">φ</span>\n  <span class=\"bp\">|</span> <span class=\"n\">k</span> <span class=\"o\">(</span><span class=\"bp\">∃</span><span class=\"err\">&#39;</span> <span class=\"n\">A</span> <span class=\"n\">φ</span><span class=\"o\">)</span>   <span class=\"o\">:=</span> <span class=\"bp\">∃</span><span class=\"err\">&#39;</span> <span class=\"n\">A</span> <span class=\"err\">$</span> <span class=\"n\">lift_d</span> <span class=\"o\">(</span><span class=\"n\">k</span><span class=\"bp\">+</span><span class=\"mi\">1</span><span class=\"o\">)</span> <span class=\"n\">φ</span>\n\n  <span class=\"bp\">@</span><span class=\"o\">[</span><span class=\"n\">simp</span><span class=\"o\">]</span>\n  <span class=\"n\">def</span> <span class=\"n\">lift</span> <span class=\"o\">:=</span> <span class=\"n\">lift_d</span> <span class=\"mi\">1</span> <span class=\"mi\">0</span>\n\n  <span class=\"bp\">@</span><span class=\"o\">[</span><span class=\"n\">simp</span><span class=\"o\">]</span>\n  <span class=\"n\">def</span> <span class=\"n\">subst</span> <span class=\"o\">:</span> <span class=\"bp\">ℕ</span> <span class=\"bp\">→</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">term</span>\n  <span class=\"bp\">|</span> <span class=\"n\">n</span> <span class=\"n\">x</span> <span class=\"err\">⁎</span>          <span class=\"o\">:=</span> <span class=\"err\">⁎</span>\n  <span class=\"bp\">|</span> <span class=\"n\">n</span> <span class=\"n\">x</span> <span class=\"err\">⊤</span>          <span class=\"o\">:=</span> <span class=\"err\">⊤</span>\n  <span class=\"bp\">|</span> <span class=\"n\">n</span> <span class=\"n\">x</span> <span class=\"err\">⊥</span>          <span class=\"o\">:=</span> <span class=\"err\">⊥</span>\n  <span class=\"bp\">|</span> <span class=\"n\">n</span> <span class=\"n\">x</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"err\">⋀</span> <span class=\"n\">q</span><span class=\"o\">)</span>    <span class=\"o\">:=</span> <span class=\"o\">(</span><span class=\"n\">subst</span> <span class=\"n\">n</span> <span class=\"n\">x</span> <span class=\"n\">p</span><span class=\"o\">)</span> <span class=\"err\">⋀</span> <span class=\"o\">(</span><span class=\"n\">subst</span> <span class=\"n\">n</span> <span class=\"n\">x</span> <span class=\"n\">q</span><span class=\"o\">)</span>\n  <span class=\"bp\">|</span> <span class=\"n\">n</span> <span class=\"n\">x</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"err\">⋁</span> <span class=\"n\">q</span><span class=\"o\">)</span>    <span class=\"o\">:=</span> <span class=\"o\">(</span><span class=\"n\">subst</span> <span class=\"n\">n</span> <span class=\"n\">x</span> <span class=\"n\">p</span><span class=\"o\">)</span> <span class=\"err\">⋁</span> <span class=\"o\">(</span><span class=\"n\">subst</span> <span class=\"n\">n</span> <span class=\"n\">x</span> <span class=\"n\">q</span><span class=\"o\">)</span>\n  <span class=\"bp\">|</span> <span class=\"n\">n</span> <span class=\"n\">x</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"err\">⟹</span> <span class=\"n\">q</span><span class=\"o\">)</span>  <span class=\"o\">:=</span> <span class=\"o\">(</span><span class=\"n\">subst</span> <span class=\"n\">n</span> <span class=\"n\">x</span> <span class=\"n\">p</span><span class=\"o\">)</span> <span class=\"err\">⟹</span> <span class=\"o\">(</span><span class=\"n\">subst</span> <span class=\"n\">n</span> <span class=\"n\">x</span> <span class=\"n\">q</span><span class=\"o\">)</span>\n  <span class=\"bp\">|</span> <span class=\"n\">n</span> <span class=\"n\">x</span> <span class=\"o\">(</span><span class=\"n\">a</span> <span class=\"err\">∈</span> <span class=\"n\">α</span><span class=\"o\">)</span>    <span class=\"o\">:=</span> <span class=\"o\">(</span><span class=\"n\">subst</span> <span class=\"n\">n</span> <span class=\"n\">x</span> <span class=\"n\">a</span><span class=\"o\">)</span> <span class=\"err\">∈</span> <span class=\"o\">(</span><span class=\"n\">subst</span> <span class=\"n\">n</span> <span class=\"n\">x</span> <span class=\"n\">α</span><span class=\"o\">)</span>\n  <span class=\"bp\">|</span> <span class=\"n\">n</span> <span class=\"n\">x</span> <span class=\"err\">⟪</span><span class=\"n\">a</span><span class=\"o\">,</span><span class=\"n\">c</span><span class=\"err\">⟫</span>      <span class=\"o\">:=</span> <span class=\"err\">⟪</span><span class=\"n\">subst</span> <span class=\"n\">n</span> <span class=\"n\">x</span> <span class=\"n\">a</span><span class=\"o\">,</span> <span class=\"n\">subst</span> <span class=\"n\">n</span> <span class=\"n\">x</span> <span class=\"n\">c</span><span class=\"err\">⟫</span>\n  <span class=\"bp\">|</span> <span class=\"n\">n</span> <span class=\"n\">x</span> <span class=\"o\">(</span><span class=\"n\">var</span> <span class=\"n\">m</span><span class=\"o\">)</span>    <span class=\"o\">:=</span> <span class=\"k\">if</span> <span class=\"n\">n</span><span class=\"bp\">=</span><span class=\"n\">m</span> <span class=\"k\">then</span> <span class=\"n\">x</span> <span class=\"k\">else</span> <span class=\"n\">var</span> <span class=\"n\">m</span>\n  <span class=\"bp\">|</span> <span class=\"n\">n</span> <span class=\"n\">x</span> <span class=\"err\">⟦</span> <span class=\"n\">A</span> <span class=\"bp\">|</span> <span class=\"n\">φ</span> <span class=\"err\">⟧</span>   <span class=\"o\">:=</span>    <span class=\"err\">⟦</span><span class=\"n\">A</span> <span class=\"bp\">|</span> <span class=\"n\">subst</span> <span class=\"o\">(</span><span class=\"n\">n</span><span class=\"bp\">+</span><span class=\"mi\">1</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">lift</span> <span class=\"n\">x</span><span class=\"o\">)</span> <span class=\"n\">φ</span><span class=\"err\">⟧</span>\n  <span class=\"bp\">|</span> <span class=\"n\">n</span> <span class=\"n\">x</span> <span class=\"o\">(</span><span class=\"bp\">∀</span><span class=\"err\">&#39;</span> <span class=\"n\">A</span> <span class=\"n\">φ</span><span class=\"o\">)</span>     <span class=\"o\">:=</span> <span class=\"bp\">∀</span><span class=\"err\">&#39;</span> <span class=\"n\">A</span> <span class=\"o\">(</span><span class=\"n\">subst</span> <span class=\"o\">(</span><span class=\"n\">n</span><span class=\"bp\">+</span><span class=\"mi\">1</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">lift</span> <span class=\"n\">x</span><span class=\"o\">)</span> <span class=\"n\">φ</span><span class=\"o\">)</span>\n  <span class=\"bp\">|</span> <span class=\"n\">n</span> <span class=\"n\">x</span> <span class=\"o\">(</span><span class=\"bp\">∃</span><span class=\"err\">&#39;</span> <span class=\"n\">A</span> <span class=\"n\">φ</span><span class=\"o\">)</span>     <span class=\"o\">:=</span> <span class=\"bp\">∃</span><span class=\"err\">&#39;</span> <span class=\"n\">A</span> <span class=\"o\">(</span><span class=\"n\">subst</span> <span class=\"o\">(</span><span class=\"n\">n</span><span class=\"bp\">+</span><span class=\"mi\">1</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">lift</span> <span class=\"n\">x</span><span class=\"o\">)</span> <span class=\"n\">φ</span><span class=\"o\">)</span>\n\n  <span class=\"kn\">notation</span>  <span class=\"bp\">`</span><span class=\"err\">⁅</span><span class=\"bp\">`</span> <span class=\"n\">φ</span> <span class=\"bp\">`</span> <span class=\"bp\">//</span> <span class=\"bp\">`</span>  <span class=\"n\">b</span> <span class=\"bp\">`</span><span class=\"err\">⁆</span><span class=\"bp\">`</span> <span class=\"o\">:=</span> <span class=\"n\">subst</span> <span class=\"mi\">0</span> <span class=\"n\">b</span> <span class=\"n\">φ</span>\n\n  <span class=\"bp\">#</span><span class=\"n\">reduce</span> <span class=\"err\">⁅</span><span class=\"mi\">𝟘</span> <span class=\"bp\">//</span> <span class=\"err\">⊤</span> <span class=\"err\">⋀</span> <span class=\"err\">⊥⁆</span>\n  <span class=\"bp\">#</span><span class=\"n\">reduce</span> <span class=\"err\">⁅</span> <span class=\"mi\">𝟙</span> <span class=\"bp\">//</span> <span class=\"err\">⊤</span> <span class=\"err\">⋀</span> <span class=\"err\">⊥⁆</span>\n\n<span class=\"kn\">end</span> <span class=\"n\">substitution</span>\n\n<span class=\"n\">def</span> <span class=\"n\">eq</span> <span class=\"o\">(</span><span class=\"n\">A</span><span class=\"o\">:</span><span class=\"n\">type</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">a₁</span> <span class=\"n\">a₂</span> <span class=\"o\">:</span> <span class=\"n\">term</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">term</span> <span class=\"o\">:=</span> <span class=\"bp\">∀</span><span class=\"err\">&#39;</span> <span class=\"o\">(</span><span class=\"err\">𝒫</span> <span class=\"n\">A</span><span class=\"o\">)</span> <span class=\"err\">$</span> <span class=\"o\">((</span><span class=\"n\">lift</span> <span class=\"n\">a₁</span><span class=\"o\">)</span> <span class=\"err\">∈</span> <span class=\"mi\">𝟘</span><span class=\"o\">)</span> <span class=\"err\">⇔</span> <span class=\"o\">((</span><span class=\"n\">lift</span> <span class=\"n\">a₂</span><span class=\"o\">)</span> <span class=\"err\">∈</span> <span class=\"mi\">𝟘</span><span class=\"o\">)</span>\n<span class=\"kn\">notation</span> <span class=\"n\">a</span> <span class=\"bp\">`</span> <span class=\"err\">≃</span><span class=\"o\">[</span><span class=\"bp\">`</span><span class=\"o\">:</span><span class=\"n\">max</span> <span class=\"n\">A</span> <span class=\"bp\">`</span><span class=\"o\">]</span> <span class=\"bp\">`</span><span class=\"o\">:</span><span class=\"mi\">0</span> <span class=\"n\">b</span> <span class=\"o\">:=</span> <span class=\"n\">eq</span> <span class=\"n\">A</span> <span class=\"n\">a</span> <span class=\"n\">b</span>\n\n<span class=\"bp\">#</span><span class=\"kn\">check</span> <span class=\"n\">eq</span> <span class=\"n\">Unit</span> <span class=\"mi\">𝟘</span> <span class=\"mi\">𝟘</span>\n\n<span class=\"n\">def</span> <span class=\"n\">singleton</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"o\">:</span> <span class=\"n\">type</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">a</span> <span class=\"o\">:</span> <span class=\"n\">term</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"err\">⟦</span><span class=\"n\">A</span> <span class=\"bp\">|</span> <span class=\"o\">(</span><span class=\"n\">lift</span> <span class=\"n\">a</span><span class=\"o\">)</span> <span class=\"err\">≃</span><span class=\"o\">[</span><span class=\"n\">A</span><span class=\"o\">]</span> <span class=\"mi\">𝟘</span><span class=\"err\">⟧</span>\n\n<span class=\"n\">def</span> <span class=\"n\">ex_unique</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"o\">:</span> <span class=\"n\">type</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">φ</span> <span class=\"o\">:</span> <span class=\"n\">term</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">term</span> <span class=\"o\">:=</span>\n  <span class=\"bp\">∃</span><span class=\"err\">&#39;</span> <span class=\"n\">A</span> <span class=\"o\">(</span><span class=\"err\">⟦</span><span class=\"n\">A</span> <span class=\"bp\">|</span> <span class=\"n\">φ</span><span class=\"err\">⟧</span> <span class=\"err\">≃</span><span class=\"o\">[</span><span class=\"err\">𝒫</span> <span class=\"n\">A</span><span class=\"o\">]</span> <span class=\"o\">(</span><span class=\"n\">singleton</span> <span class=\"n\">A</span> <span class=\"mi\">𝟘</span><span class=\"o\">))</span>\n<span class=\"kn\">prefix</span> <span class=\"bp\">`∃!</span><span class=\"err\">&#39;</span><span class=\"bp\">`</span><span class=\"o\">:</span><span class=\"mi\">2</span> <span class=\"o\">:=</span> <span class=\"n\">ex_unique</span>\n\n<span class=\"n\">def</span> <span class=\"n\">subseteq</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"o\">:</span> <span class=\"n\">type</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">α</span> <span class=\"o\">:</span> <span class=\"n\">term</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">β</span> <span class=\"o\">:</span> <span class=\"n\">term</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">term</span> <span class=\"o\">:=</span>\n  <span class=\"bp\">∀</span><span class=\"err\">&#39;</span> <span class=\"n\">A</span> <span class=\"o\">(</span><span class=\"mi\">𝟘</span> <span class=\"err\">∈</span> <span class=\"n\">α</span><span class=\"o\">)</span> <span class=\"err\">⟹</span> <span class=\"o\">(</span><span class=\"mi\">𝟘</span> <span class=\"err\">∈</span> <span class=\"n\">β</span><span class=\"o\">)</span>\n<span class=\"kn\">notation</span> <span class=\"n\">a</span> <span class=\"bp\">`</span> <span class=\"err\">⊆</span><span class=\"o\">[</span><span class=\"bp\">`</span><span class=\"o\">:</span><span class=\"n\">max</span> <span class=\"n\">A</span> <span class=\"bp\">`</span><span class=\"o\">]</span> <span class=\"bp\">`</span><span class=\"o\">:</span><span class=\"mi\">0</span> <span class=\"n\">b</span> <span class=\"o\">:=</span> <span class=\"n\">subseteq</span> <span class=\"n\">A</span> <span class=\"n\">a</span> <span class=\"n\">b</span>\n\n<span class=\"n\">def</span> <span class=\"n\">term_prod</span> <span class=\"o\">{</span><span class=\"n\">A</span> <span class=\"n\">B</span> <span class=\"o\">:</span> <span class=\"n\">type</span><span class=\"o\">}</span> <span class=\"o\">(</span><span class=\"n\">α</span> <span class=\"n\">β</span> <span class=\"o\">:</span> <span class=\"n\">term</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">term</span> <span class=\"o\">:=</span>\n  <span class=\"err\">⟦</span> <span class=\"n\">A</span> <span class=\"bp\">××</span> <span class=\"n\">B</span> <span class=\"bp\">|</span> <span class=\"bp\">∃</span><span class=\"err\">&#39;</span> <span class=\"n\">A</span> <span class=\"o\">(</span><span class=\"bp\">∃</span><span class=\"err\">&#39;</span> <span class=\"n\">B</span> <span class=\"o\">((</span><span class=\"mi\">𝟙</span> <span class=\"err\">∈</span> <span class=\"n\">α</span><span class=\"o\">)</span> <span class=\"err\">⋀</span> <span class=\"o\">(</span><span class=\"mi\">𝟘</span> <span class=\"err\">∈</span> <span class=\"n\">β</span><span class=\"o\">)</span> <span class=\"err\">⋀</span> <span class=\"o\">(</span><span class=\"n\">eq</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"bp\">××</span> <span class=\"n\">B</span><span class=\"o\">)</span> <span class=\"mi\">𝟚</span> <span class=\"err\">⟪</span><span class=\"mi\">𝟙</span><span class=\"o\">,</span><span class=\"mi\">𝟘</span><span class=\"err\">⟫</span><span class=\"o\">)))</span><span class=\"err\">⟧</span>\n<span class=\"kn\">notation</span> <span class=\"n\">α</span> <span class=\"bp\">`</span> <span class=\"bp\">×</span><span class=\"n\">x</span><span class=\"o\">[</span><span class=\"bp\">`</span><span class=\"o\">:</span><span class=\"n\">max</span> <span class=\"n\">A</span> <span class=\"bp\">`</span><span class=\"o\">]</span> <span class=\"bp\">`</span><span class=\"o\">:</span><span class=\"mi\">0</span> <span class=\"n\">β</span> <span class=\"o\">:=</span> <span class=\"n\">term_prod</span> <span class=\"n\">A</span> <span class=\"n\">α</span> <span class=\"n\">β</span>\n\n<span class=\"c1\">-- * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *</span>\n<span class=\"kn\">open</span> <span class=\"n\">term</span>\n\n<span class=\"bp\">@</span><span class=\"o\">[</span><span class=\"n\">user_attribute</span><span class=\"o\">]</span>\n<span class=\"n\">meta</span> <span class=\"n\">def</span> <span class=\"n\">WF_rules</span> <span class=\"o\">:</span> <span class=\"n\">user_attribute</span> <span class=\"o\">:=</span>\n<span class=\"o\">{</span> <span class=\"n\">name</span> <span class=\"o\">:=</span> <span class=\"bp\">`</span><span class=\"n\">TT</span><span class=\"bp\">.</span><span class=\"n\">WF_rules</span><span class=\"o\">,</span>\n  <span class=\"n\">descr</span> <span class=\"o\">:=</span> <span class=\"s2\">&quot;lemmas usable to prove Well Formedness&quot;</span> <span class=\"o\">}</span>\n\n<span class=\"kn\">inductive</span> <span class=\"n\">WF</span> <span class=\"o\">:</span> <span class=\"kn\">context</span> <span class=\"bp\">→</span> <span class=\"n\">type</span> <span class=\"bp\">→</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"kt\">Prop</span>\n<span class=\"bp\">|</span> <span class=\"n\">star</span> <span class=\"o\">{</span><span class=\"err\">Γ</span><span class=\"o\">}</span>         <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"n\">Unit</span> <span class=\"err\">⁎</span>\n<span class=\"bp\">|</span> <span class=\"n\">top</span>  <span class=\"o\">{</span><span class=\"err\">Γ</span><span class=\"o\">}</span>         <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"err\">⊤</span>\n<span class=\"bp\">|</span> <span class=\"n\">bot</span>  <span class=\"o\">{</span><span class=\"err\">Γ</span><span class=\"o\">}</span>         <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"err\">⊥</span>\n<span class=\"bp\">|</span> <span class=\"n\">and</span>  <span class=\"o\">{</span><span class=\"err\">Γ</span> <span class=\"n\">p</span> <span class=\"n\">q</span><span class=\"o\">}</span>     <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"n\">p</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"n\">q</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"err\">⋀</span> <span class=\"n\">q</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"n\">or</span>   <span class=\"o\">{</span><span class=\"err\">Γ</span> <span class=\"n\">p</span> <span class=\"n\">q</span><span class=\"o\">}</span>     <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"n\">p</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"n\">q</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"err\">⋁</span> <span class=\"n\">q</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"n\">imp</span>  <span class=\"o\">{</span><span class=\"err\">Γ</span> <span class=\"n\">p</span> <span class=\"n\">q</span><span class=\"o\">}</span>     <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"n\">p</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"n\">q</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"err\">⟹</span> <span class=\"n\">q</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"n\">elem</span> <span class=\"o\">{</span><span class=\"err\">Γ</span> <span class=\"n\">A</span> <span class=\"n\">a</span> <span class=\"n\">α</span><span class=\"o\">}</span>   <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"n\">A</span> <span class=\"n\">a</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"o\">(</span><span class=\"err\">𝒫</span> <span class=\"n\">A</span><span class=\"o\">)</span> <span class=\"n\">α</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"o\">(</span><span class=\"n\">a</span> <span class=\"err\">∈</span> <span class=\"n\">α</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"n\">pair</span> <span class=\"o\">{</span><span class=\"err\">Γ</span> <span class=\"n\">A</span> <span class=\"n\">B</span> <span class=\"n\">a</span> <span class=\"n\">b</span><span class=\"o\">}</span> <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"n\">A</span> <span class=\"n\">a</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"n\">B</span> <span class=\"n\">b</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"bp\">××</span> <span class=\"n\">B</span><span class=\"o\">)</span> <span class=\"err\">⟪</span><span class=\"n\">a</span><span class=\"o\">,</span><span class=\"n\">b</span><span class=\"err\">⟫</span>\n<span class=\"bp\">|</span> <span class=\"n\">var</span>  <span class=\"o\">{</span><span class=\"err\">Γ</span> <span class=\"n\">A</span> <span class=\"n\">n</span><span class=\"o\">}</span>     <span class=\"o\">:</span> <span class=\"n\">list</span><span class=\"bp\">.</span><span class=\"n\">nth</span> <span class=\"err\">Γ</span> <span class=\"n\">n</span> <span class=\"bp\">=</span> <span class=\"n\">some</span> <span class=\"n\">A</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"n\">A</span> <span class=\"o\">(</span><span class=\"n\">var</span> <span class=\"n\">n</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"n\">comp</span> <span class=\"o\">{</span><span class=\"err\">Γ</span> <span class=\"n\">A</span> <span class=\"n\">φ</span><span class=\"o\">}</span>     <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"o\">(</span><span class=\"n\">A</span><span class=\"bp\">::</span><span class=\"err\">Γ</span><span class=\"o\">)</span> <span class=\"err\">Ω</span> <span class=\"n\">φ</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"o\">(</span><span class=\"err\">𝒫</span> <span class=\"n\">A</span><span class=\"o\">)</span> <span class=\"err\">⟦</span><span class=\"n\">A</span> <span class=\"bp\">|</span> <span class=\"n\">φ</span><span class=\"err\">⟧</span>\n<span class=\"bp\">|</span> <span class=\"n\">all</span>  <span class=\"o\">{</span><span class=\"err\">Γ</span> <span class=\"n\">A</span> <span class=\"n\">φ</span><span class=\"o\">}</span>     <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"o\">(</span><span class=\"n\">A</span><span class=\"bp\">::</span><span class=\"err\">Γ</span><span class=\"o\">)</span> <span class=\"err\">Ω</span> <span class=\"n\">φ</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"o\">(</span><span class=\"bp\">∀</span><span class=\"err\">&#39;</span> <span class=\"n\">A</span> <span class=\"n\">φ</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"n\">ex</span>   <span class=\"o\">{</span><span class=\"err\">Γ</span> <span class=\"n\">A</span> <span class=\"n\">φ</span><span class=\"o\">}</span>     <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"o\">(</span><span class=\"n\">A</span><span class=\"bp\">::</span><span class=\"err\">Γ</span><span class=\"o\">)</span> <span class=\"err\">Ω</span> <span class=\"n\">φ</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"o\">(</span><span class=\"bp\">∃</span><span class=\"err\">&#39;</span> <span class=\"n\">A</span> <span class=\"n\">φ</span><span class=\"o\">)</span>\n\n<span class=\"n\">attribute</span> <span class=\"o\">[</span><span class=\"n\">TT</span><span class=\"bp\">.</span><span class=\"n\">WF_rules</span><span class=\"o\">]</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">star</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">top</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">bot</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">and</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">or</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">imp</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">elem</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">pair</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">var</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">comp</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">all</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">ex</span>\n\n<span class=\"kn\">section</span>\n\n<span class=\"kn\">variable</span> <span class=\"err\">Γ</span> <span class=\"o\">:</span> <span class=\"kn\">context</span>\n<span class=\"kn\">variables</span> <span class=\"n\">p</span> <span class=\"n\">q</span> <span class=\"n\">r</span> <span class=\"n\">φ</span> <span class=\"n\">a</span> <span class=\"n\">b</span> <span class=\"n\">α</span> <span class=\"o\">:</span> <span class=\"n\">term</span>\n<span class=\"kn\">variables</span> <span class=\"o\">{</span><span class=\"n\">A</span> <span class=\"n\">B</span> <span class=\"err\">Ω&#39;</span> <span class=\"o\">:</span> <span class=\"n\">type</span><span class=\"o\">}</span>\n<span class=\"c1\">-- Ω&#39; is just a fake/variable version of Ω so we don&#39;t need to bother proving</span>\n<span class=\"c1\">-- that it must be Ω itself.&#39;</span>\n\n<span class=\"n\">meta</span> <span class=\"n\">def</span> <span class=\"n\">WF_prover</span> <span class=\"o\">:</span> <span class=\"n\">tactic</span> <span class=\"n\">unit</span> <span class=\"o\">:=</span> <span class=\"n\">do</span> <span class=\"bp\">`</span><span class=\"o\">[</span><span class=\"n\">intro</span> <span class=\"n\">h</span><span class=\"o\">,</span> <span class=\"n\">cases</span> <span class=\"n\">h</span><span class=\"o\">,</span> <span class=\"n\">assumption</span><span class=\"o\">]</span>\n\n<span class=\"c\">/-</span><span class=\"cm\"></span>\n<span class=\"cm\">@[TT.WF_rules] lemma and_left   : WF Γ Ω&#39; (p ⋀ q) → WF Γ Ω&#39; p := by WF_prover</span>\n<span class=\"cm\">@[TT.WF_rules] lemma and_right  : WF Γ Ω&#39; (p ⋀ q) → WF Γ Ω&#39; q := by WF_prover</span>\n<span class=\"cm\">@[TT.WF_rules] lemma or_left    : WF Γ Ω&#39; (p ⋁ q) → WF Γ Ω&#39; p := by WF_prover</span>\n<span class=\"cm\">@[TT.WF_rules] lemma or_right   : WF Γ Ω&#39; (p ⋁ q) → WF Γ Ω&#39; q := by WF_prover</span>\n<span class=\"cm\">@[TT.WF_rules] lemma imp_left   : WF Γ Ω&#39; (p ⟹ q) → WF Γ Ω&#39; p := by WF_prover</span>\n<span class=\"cm\">@[TT.WF_rules] lemma imp_right  : WF Γ Ω&#39; (p ⟹ q) → WF Γ Ω&#39; q := by WF_prover</span>\n<span class=\"cm\">@[TT.WF_rules] lemma pair_left  : WF Γ (A ×× B) ⟪a,b⟫ → WF Γ A a := by WF_prover</span>\n<span class=\"cm\">@[TT.WF_rules] lemma pair_right : WF Γ (A ×× B) ⟪a,b⟫ → WF Γ B b := by WF_prover</span>\n<span class=\"cm\">@[TT.WF_rules] lemma comp_elim  : WF Γ (𝒫 A) ⟦A | φ⟧ → WF (A::Γ) Ω φ := by WF_prover</span>\n<span class=\"cm\">@[TT.WF_rules] lemma all_elim   : WF Γ Ω&#39; (∀&#39; A φ) → WF (A::Γ) Ω&#39; φ := by WF_prover</span>\n<span class=\"cm\">@[TT.WF_rules] lemma ex_elim    : WF Γ Ω&#39; (∀&#39; A φ) → WF (A::Γ) Ω&#39; φ := by WF_prover</span>\n<span class=\"cm\">-/</span>\n<span class=\"bp\">@</span><span class=\"o\">[</span><span class=\"n\">TT</span><span class=\"bp\">.</span><span class=\"n\">WF_rules</span><span class=\"o\">]</span> <span class=\"kn\">lemma</span> <span class=\"n\">iff_intro</span> <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"n\">p</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"n\">q</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"err\">⇔</span> <span class=\"n\">q</span><span class=\"o\">)</span> <span class=\"o\">:=</span>\n<span class=\"k\">begin</span>\n  <span class=\"n\">intros</span><span class=\"o\">,</span>\n  <span class=\"n\">apply_rules</span> <span class=\"n\">TT</span><span class=\"bp\">.</span><span class=\"n\">WF_rules</span><span class=\"o\">,</span>\n  <span class=\"c1\">-- apply_rules [WF.and, WF.imp],</span>\n<span class=\"kn\">end</span>\n\n<span class=\"kn\">end</span>\n\n<span class=\"kn\">end</span> <span class=\"n\">TT</span>\n</code></pre></div>",
        "id": 200405293,
        "sender_full_name": "Reid Barton",
        "timestamp": 1591789489
    },
    {
        "content": "<p>Oh you change the name too</p>",
        "id": 200405340,
        "sender_full_name": "Billy Price",
        "timestamp": 1591789534
    },
    {
        "content": "<p>By the way, I noticed earlier that the interactive parser for <code>apply_rules</code> is a little weird--it expects an identifier, but it doesn't actually use it as an identifier, it uses it as an attribute name.</p>",
        "id": 200405407,
        "sender_full_name": "Reid Barton",
        "timestamp": 1591789580
    },
    {
        "content": "<p>It gets weird if the attribute name is not the same as the identifier that introduces the attribute itself.</p>",
        "id": 200405438,
        "sender_full_name": "Reid Barton",
        "timestamp": 1591789618
    },
    {
        "content": "<p>Yes, sorry. I literally meant \"in the string <code>meta def WF_rules</code>\"</p>",
        "id": 200405463,
        "sender_full_name": "Reid Barton",
        "timestamp": 1591789645
    },
    {
        "content": "<p>I'm now trying to prove you can lift all the variables in a term up by 1 and shove a new type at the start of the context, but it's unclear how to prove it in the quantified cases (WF.all, WF.ex, WF.comp), It looks like I need to do more induction - but doesn't that produce the same problem again?</p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"bp\">@</span><span class=\"o\">[</span><span class=\"n\">TT</span><span class=\"bp\">.</span><span class=\"n\">WF_rules</span><span class=\"o\">]</span> <span class=\"kn\">lemma</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">lift</span> <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"n\">A</span> <span class=\"n\">a</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"o\">(</span><span class=\"n\">B</span><span class=\"bp\">::</span><span class=\"err\">Γ</span><span class=\"o\">)</span> <span class=\"n\">A</span> <span class=\"o\">(</span><span class=\"n\">lift</span> <span class=\"n\">a</span><span class=\"o\">)</span> <span class=\"o\">:=</span>\n<span class=\"k\">begin</span>\n  <span class=\"n\">intro</span> <span class=\"n\">wfa</span><span class=\"o\">,</span>\n  <span class=\"n\">induction</span> <span class=\"n\">wfa</span><span class=\"o\">,</span>\n  <span class=\"n\">case</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">all</span> <span class=\"o\">:</span> <span class=\"err\">Δ</span> <span class=\"n\">A</span> <span class=\"n\">ψ</span> <span class=\"n\">wfψ</span> <span class=\"n\">ih</span> <span class=\"o\">{</span><span class=\"n\">simp</span><span class=\"o\">,</span> <span class=\"n\">apply_rules</span> <span class=\"n\">WF_rules</span><span class=\"o\">,</span> <span class=\"n\">sorry</span><span class=\"o\">},</span>\n  <span class=\"n\">case</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">ex</span> <span class=\"o\">:</span> <span class=\"err\">Δ</span> <span class=\"n\">A</span> <span class=\"n\">ψ</span> <span class=\"n\">wfψ</span> <span class=\"n\">ih</span> <span class=\"o\">{</span><span class=\"n\">simp</span><span class=\"o\">,</span> <span class=\"n\">apply_rules</span> <span class=\"n\">WF_rules</span><span class=\"o\">,</span> <span class=\"n\">sorry</span><span class=\"o\">},</span>\n  <span class=\"n\">case</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">comp</span> <span class=\"o\">:</span> <span class=\"err\">Δ</span> <span class=\"n\">A</span> <span class=\"n\">ψ</span> <span class=\"n\">wfψ</span> <span class=\"n\">ih</span> <span class=\"o\">{</span><span class=\"n\">simp</span><span class=\"o\">,</span> <span class=\"n\">apply_rules</span> <span class=\"n\">WF_rules</span><span class=\"o\">,</span> <span class=\"n\">sorry</span><span class=\"o\">},</span>\n  <span class=\"n\">all_goals</span> <span class=\"o\">{</span><span class=\"n\">unfold</span> <span class=\"n\">lift</span><span class=\"o\">,</span> <span class=\"n\">unfold</span> <span class=\"n\">lift_d</span><span class=\"o\">,</span> <span class=\"n\">apply_rules</span> <span class=\"n\">WF_rules</span><span class=\"o\">},</span>\n<span class=\"kn\">end</span>\n</code></pre></div>\n\n\n<p>Here's the state at the first <code>sorry</code>.</p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"mi\">1</span> <span class=\"n\">goal</span>\n<span class=\"n\">B</span> <span class=\"o\">:</span> <span class=\"n\">type</span><span class=\"o\">,</span>\n<span class=\"err\">Γ</span> <span class=\"o\">:</span> <span class=\"kn\">context</span><span class=\"o\">,</span>\n<span class=\"n\">A</span> <span class=\"o\">:</span> <span class=\"n\">type</span><span class=\"o\">,</span>\n<span class=\"n\">a</span> <span class=\"o\">:</span> <span class=\"n\">term</span><span class=\"o\">,</span>\n<span class=\"err\">Δ</span> <span class=\"o\">:</span> <span class=\"n\">list</span> <span class=\"n\">type</span><span class=\"o\">,</span>\n<span class=\"n\">A</span> <span class=\"o\">:</span> <span class=\"n\">type</span><span class=\"o\">,</span>\n<span class=\"n\">ψ</span> <span class=\"o\">:</span> <span class=\"n\">term</span><span class=\"o\">,</span>\n<span class=\"n\">wfψ</span> <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"bp\">::</span> <span class=\"err\">Δ</span><span class=\"o\">)</span> <span class=\"err\">Ω</span> <span class=\"n\">ψ</span><span class=\"o\">,</span>\n<span class=\"n\">ih</span> <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"o\">(</span><span class=\"n\">B</span> <span class=\"bp\">::</span> <span class=\"n\">A</span> <span class=\"bp\">::</span> <span class=\"err\">Δ</span><span class=\"o\">)</span> <span class=\"err\">Ω</span> <span class=\"o\">(</span><span class=\"n\">lift</span> <span class=\"n\">ψ</span><span class=\"o\">)</span>\n<span class=\"err\">⊢</span> <span class=\"n\">WF</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"bp\">::</span> <span class=\"n\">B</span> <span class=\"bp\">::</span> <span class=\"err\">Δ</span><span class=\"o\">)</span> <span class=\"err\">Ω</span> <span class=\"o\">(</span><span class=\"n\">lift_d</span> <span class=\"mi\">1</span> <span class=\"mi\">1</span> <span class=\"n\">ψ</span><span class=\"o\">)</span>\n</code></pre></div>",
        "id": 200409037,
        "sender_full_name": "Billy Price",
        "timestamp": 1591792213
    },
    {
        "content": "<p>That's right, this is why <code>lift</code> is not good enough</p>",
        "id": 200409115,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1591792272
    },
    {
        "content": "<p>you have to prove the analogous theorem for <code>lift_d</code></p>",
        "id": 200409132,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1591792283
    },
    {
        "content": "<p>Hmm okay, so prepending some list of types of length <code>d</code> in the <code>lift_d d</code> case?</p>",
        "id": 200409411,
        "sender_full_name": "Billy Price",
        "timestamp": 1591792458
    },
    {
        "content": "<p>Since you are holding <code>d</code> fixed in the definition of <code>lift_d</code>, you can probably prove it in the special case <code>d = 1</code></p>",
        "id": 200409462,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1591792489
    },
    {
        "content": "<p>but you definitely have to generalize <code>k</code></p>",
        "id": 200409490,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1591792505
    },
    {
        "content": "<p>Then again, the general theorem is not much harder and may come in useful</p>",
        "id": 200409570,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1591792556
    },
    {
        "content": "<p>Ah okay, so splitting the original context at the <code>k</code>th position and shoving <code>d</code> variables in there.</p>",
        "id": 200409788,
        "sender_full_name": "Billy Price",
        "timestamp": 1591792673
    },
    {
        "content": "<p>I think it looks something like this:</p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"kn\">lemma</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">lift_d</span> <span class=\"o\">:</span> <span class=\"bp\">∀</span> <span class=\"n\">K</span> <span class=\"n\">D</span> <span class=\"err\">Γ</span> <span class=\"n\">A</span> <span class=\"n\">a</span><span class=\"o\">,</span> <span class=\"n\">length</span> <span class=\"n\">K</span> <span class=\"bp\">=</span> <span class=\"n\">k</span> <span class=\"bp\">→</span> <span class=\"n\">length</span> <span class=\"n\">D</span> <span class=\"bp\">=</span> <span class=\"n\">d</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"o\">(</span><span class=\"n\">K</span> <span class=\"bp\">++</span> <span class=\"err\">Γ</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">A</span><span class=\"o\">)</span> <span class=\"n\">a</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"o\">(</span><span class=\"n\">K</span> <span class=\"bp\">++</span> <span class=\"n\">D</span> <span class=\"bp\">++</span> <span class=\"err\">Γ</span><span class=\"o\">)</span> <span class=\"n\">A</span> <span class=\"o\">(</span><span class=\"n\">lift_d</span> <span class=\"n\">d</span> <span class=\"n\">k</span> <span class=\"n\">a</span><span class=\"o\">)</span> <span class=\"o\">:=</span>\n<span class=\"n\">sorry</span>\n</code></pre></div>",
        "id": 200409939,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1591792751
    },
    {
        "content": "<p>since you aren't inducting on <code>k</code> or <code>d</code> you can also simplify this to</p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"kn\">lemma</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">lift_d</span> <span class=\"o\">:</span> <span class=\"bp\">∀</span> <span class=\"n\">K</span> <span class=\"n\">D</span> <span class=\"err\">Γ</span> <span class=\"n\">A</span> <span class=\"n\">a</span><span class=\"o\">,</span> <span class=\"n\">WF</span> <span class=\"o\">(</span><span class=\"n\">K</span> <span class=\"bp\">++</span> <span class=\"err\">Γ</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">A</span><span class=\"o\">)</span> <span class=\"n\">a</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"o\">(</span><span class=\"n\">K</span> <span class=\"bp\">++</span> <span class=\"n\">D</span> <span class=\"bp\">++</span> <span class=\"err\">Γ</span><span class=\"o\">)</span> <span class=\"n\">A</span> <span class=\"o\">(</span><span class=\"n\">lift_d</span> <span class=\"o\">(</span><span class=\"n\">length</span> <span class=\"n\">D</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">length</span> <span class=\"n\">K</span><span class=\"o\">)</span> <span class=\"n\">a</span><span class=\"o\">)</span> <span class=\"o\">:=</span>\n<span class=\"n\">sorry</span>\n</code></pre></div>",
        "id": 200410097,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1591792857
    },
    {
        "content": "<p>Yep that makes sense to me</p>",
        "id": 200410535,
        "sender_full_name": "Billy Price",
        "timestamp": 1591793119
    },
    {
        "content": "<p>This state looks equally difficult to solve - am I missing something?</p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"mi\">1</span> <span class=\"n\">goal</span>\n<span class=\"n\">K</span> <span class=\"err\">Δ</span> <span class=\"err\">Γ</span> <span class=\"o\">:</span> <span class=\"kn\">context</span><span class=\"o\">,</span>\n<span class=\"n\">A</span> <span class=\"o\">:</span> <span class=\"n\">type</span><span class=\"o\">,</span>\n<span class=\"n\">a</span> <span class=\"o\">:</span> <span class=\"n\">term</span><span class=\"o\">,</span>\n<span class=\"err\">Δ</span> <span class=\"o\">:</span> <span class=\"n\">list</span> <span class=\"n\">type</span><span class=\"o\">,</span>\n<span class=\"n\">B</span> <span class=\"o\">:</span> <span class=\"n\">type</span><span class=\"o\">,</span>\n<span class=\"n\">ψ</span> <span class=\"o\">:</span> <span class=\"n\">term</span><span class=\"o\">,</span>\n<span class=\"n\">wfψ</span> <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"o\">(</span><span class=\"n\">B</span> <span class=\"bp\">::</span> <span class=\"err\">Δ</span><span class=\"o\">)</span> <span class=\"err\">Ω</span> <span class=\"n\">ψ</span><span class=\"o\">,</span>\n<span class=\"n\">ih</span> <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"o\">(</span><span class=\"n\">K</span> <span class=\"bp\">++</span> <span class=\"err\">Δ</span> <span class=\"bp\">++</span> <span class=\"err\">Γ</span><span class=\"o\">)</span> <span class=\"err\">Ω</span> <span class=\"o\">(</span><span class=\"n\">lift_d</span> <span class=\"o\">(</span><span class=\"n\">length</span> <span class=\"err\">Δ</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">length</span> <span class=\"n\">K</span><span class=\"o\">)</span> <span class=\"n\">ψ</span><span class=\"o\">)</span>\n<span class=\"err\">⊢</span> <span class=\"n\">WF</span> <span class=\"o\">(</span><span class=\"n\">B</span> <span class=\"bp\">::</span> <span class=\"o\">(</span><span class=\"n\">K</span> <span class=\"bp\">++</span> <span class=\"err\">Δ</span> <span class=\"bp\">++</span> <span class=\"err\">Γ</span><span class=\"o\">))</span> <span class=\"err\">Ω</span> <span class=\"o\">(</span><span class=\"n\">lift_d</span> <span class=\"o\">(</span><span class=\"n\">length</span> <span class=\"err\">Δ</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">length</span> <span class=\"n\">K</span> <span class=\"bp\">+</span> <span class=\"mi\">1</span><span class=\"o\">)</span> <span class=\"n\">ψ</span><span class=\"o\">)</span>\n</code></pre></div>",
        "id": 200411475,
        "sender_full_name": "Billy Price",
        "timestamp": 1591793633
    },
    {
        "content": "<p>How did you start the proof?</p>",
        "id": 200411556,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1591793669
    },
    {
        "content": "<p>You need <code>generalizing K</code> at least</p>",
        "id": 200411584,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1591793687
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span><code><span class=\"bp\">@</span><span class=\"o\">[</span><span class=\"n\">TT</span><span class=\"bp\">.</span><span class=\"n\">WF_rules</span><span class=\"o\">]</span> <span class=\"kn\">lemma</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">lift_d</span> <span class=\"o\">(</span><span class=\"n\">K</span> <span class=\"err\">Δ</span> <span class=\"err\">Γ</span> <span class=\"o\">:</span> <span class=\"kn\">context</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"o\">(</span><span class=\"n\">K</span> <span class=\"bp\">++</span> <span class=\"err\">Γ</span><span class=\"o\">)</span> <span class=\"n\">A</span> <span class=\"n\">a</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"o\">(</span><span class=\"n\">K</span> <span class=\"bp\">++</span> <span class=\"err\">Δ</span> <span class=\"bp\">++</span> <span class=\"err\">Γ</span><span class=\"o\">)</span> <span class=\"n\">A</span> <span class=\"o\">(</span><span class=\"n\">lift_d</span> <span class=\"o\">(</span><span class=\"n\">length</span> <span class=\"err\">Δ</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">length</span> <span class=\"n\">K</span><span class=\"o\">)</span> <span class=\"n\">a</span><span class=\"o\">)</span> <span class=\"o\">:=</span>\n<span class=\"k\">begin</span>\n  <span class=\"n\">intro</span> <span class=\"n\">wfa</span><span class=\"o\">,</span>\n  <span class=\"n\">induction</span> <span class=\"n\">wfa</span><span class=\"o\">,</span>\n  <span class=\"n\">case</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">all</span> <span class=\"o\">:</span> <span class=\"err\">Δ</span> <span class=\"n\">B</span> <span class=\"n\">ψ</span> <span class=\"n\">wfψ</span> <span class=\"n\">ih</span> <span class=\"o\">{</span><span class=\"n\">apply</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">all</span><span class=\"o\">,</span><span class=\"n\">sorry</span><span class=\"o\">},</span>\n  <span class=\"n\">case</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">ex</span> <span class=\"o\">:</span> <span class=\"err\">Δ</span> <span class=\"n\">B</span> <span class=\"n\">ψ</span> <span class=\"n\">wfψ</span> <span class=\"n\">ih</span> <span class=\"o\">{</span><span class=\"n\">apply</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">ex</span><span class=\"o\">,</span> <span class=\"n\">sorry</span><span class=\"o\">},</span>\n  <span class=\"n\">case</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">comp</span> <span class=\"o\">:</span> <span class=\"err\">Δ</span> <span class=\"n\">B</span> <span class=\"n\">ψ</span> <span class=\"n\">wfψ</span> <span class=\"n\">ih</span> <span class=\"o\">{</span><span class=\"n\">apply</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">comp</span><span class=\"o\">,</span> <span class=\"n\">sorry</span><span class=\"o\">},</span>\n  <span class=\"n\">any_goals</span> <span class=\"o\">{</span><span class=\"n\">unfold</span> <span class=\"n\">lift_d</span><span class=\"o\">,</span> <span class=\"n\">apply_rules</span> <span class=\"n\">WF_rules</span><span class=\"o\">},</span>\n<span class=\"kn\">end</span>\n</code></pre></div>",
        "id": 200411586,
        "sender_full_name": "Billy Price",
        "timestamp": 1591793688
    },
    {
        "content": "<p>You also need to generalize <code>generalize e : K ++ Γ = Γ'</code> before the induction</p>",
        "id": 200411741,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1591793768
    },
    {
        "content": "<p>You should also be able to use <code>constructor</code> instead of <code>apply_rules</code> for an inductive proof like this</p>",
        "id": 200411816,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1591793823
    },
    {
        "content": "<p>I don't understand what generalizing K does? What does more general mean here?</p>",
        "id": 200412036,
        "sender_full_name": "Billy Price",
        "timestamp": 1591793925
    },
    {
        "content": "<p><code>K</code> needs to be forall-quantified in the inductive hypothesis</p>",
        "id": 200412078,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1591793949
    },
    {
        "content": "<p>That was the problem with your stuck goal, if <code>K</code> was generalized in <code>ih</code> then you could have instantiated <code>K</code> to <code>B :: K</code></p>",
        "id": 200412130,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1591793982
    },
    {
        "content": "<p>Another way to put it is, we expect that <code>K</code> will change over the course of the induction, while <code>Δ</code> and <code>Γ</code> for instance don't need to change</p>",
        "id": 200412355,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1591794072
    },
    {
        "content": "<p><code>A</code> and <code>a</code> also need to change over the induction but since they are indices to the inductive family this is automatic and you don't need to specify <code>generalizing A a</code></p>",
        "id": 200412462,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1591794116
    },
    {
        "content": "<p>That makes so much sense thank you. I've seen \"indices\" before - what does it mean to be an index to an inductive family?</p>",
        "id": 200412692,
        "sender_full_name": "Billy Price",
        "timestamp": 1591794220
    },
    {
        "content": "<p>right of the colon in the <code>inductive</code> statement</p>",
        "id": 200412710,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1591794236
    },
    {
        "content": "<p>In <code>WF</code> there are no parameters (left of the colon) and three indices</p>",
        "id": 200412807,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1591794269
    },
    {
        "content": "<p>yep, context, type and term?</p>",
        "id": 200412886,
        "sender_full_name": "Billy Price",
        "timestamp": 1591794316
    },
    {
        "content": "<p>right</p>",
        "id": 200412891,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1591794323
    },
    {
        "content": "<p>K appears in the context of <code>wfa</code> - why does that not automatically generalise?</p>",
        "id": 200413040,
        "sender_full_name": "Billy Price",
        "timestamp": 1591794406
    },
    {
        "content": "<p>Because the context is an append of two contexts?</p>",
        "id": 200413080,
        "sender_full_name": "Billy Price",
        "timestamp": 1591794429
    },
    {
        "content": "<p>So it can't do it?</p>",
        "id": 200413098,
        "sender_full_name": "Billy Price",
        "timestamp": 1591794435
    },
    {
        "content": "<p>If you leave a composed expression in an index when you do <code>induction</code>, it will silently generalize it, losing the connection to the original expression</p>",
        "id": 200413243,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1591794487
    },
    {
        "content": "<p>That is, it tries to prove <code>WF Γ' A a → WF (K ++ Δ ++ Γ) A (lift_d (length Δ) (length K) a)</code>, which won't be provable because <code>K</code> is gone from the left side</p>",
        "id": 200413339,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1591794542
    },
    {
        "content": "<p>If you do <code>generalize e : K ++ Γ = Γ'</code> then it is instead proving <code>WF Γ' A a → \\forall K, K ++ Γ = Γ' -&gt; WF (K ++ Δ ++ Γ) A (lift_d (length Δ) (length K) a)</code> which is okay</p>",
        "id": 200413446,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1591794601
    },
    {
        "content": "<p>(technically indices aren't generalized in the sense of <code>generalizing</code>, they are handled specially because they participate directly in the statement of the recursor)</p>",
        "id": 200413664,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1591794695
    },
    {
        "content": "<p>Hmm, I'm not sure if this is the right setup. Also what's the reason for the duplicate K's and A's (which I've rename with apostrophe's).</p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"bp\">@</span><span class=\"o\">[</span><span class=\"n\">TT</span><span class=\"bp\">.</span><span class=\"n\">WF_rules</span><span class=\"o\">]</span> <span class=\"kn\">lemma</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">lift_d</span> <span class=\"o\">(</span><span class=\"n\">K</span> <span class=\"err\">Δ</span> <span class=\"err\">Γ</span> <span class=\"o\">:</span> <span class=\"kn\">context</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"o\">(</span><span class=\"n\">K</span> <span class=\"bp\">++</span> <span class=\"err\">Γ</span><span class=\"o\">)</span> <span class=\"n\">A</span> <span class=\"n\">a</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"o\">(</span><span class=\"n\">K</span> <span class=\"bp\">++</span> <span class=\"err\">Δ</span> <span class=\"bp\">++</span> <span class=\"err\">Γ</span><span class=\"o\">)</span> <span class=\"n\">A</span> <span class=\"o\">(</span><span class=\"n\">lift_d</span> <span class=\"o\">(</span><span class=\"n\">length</span> <span class=\"err\">Δ</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">length</span> <span class=\"n\">K</span><span class=\"o\">)</span> <span class=\"n\">a</span><span class=\"o\">)</span> <span class=\"o\">:=</span>\n<span class=\"k\">begin</span>\n  <span class=\"n\">intro</span> <span class=\"n\">wfa</span><span class=\"o\">,</span>\n  <span class=\"n\">generalize</span> <span class=\"n\">e</span> <span class=\"o\">:</span> <span class=\"n\">K</span> <span class=\"bp\">++</span> <span class=\"err\">Γ</span> <span class=\"bp\">=</span> <span class=\"err\">Γ&#39;</span><span class=\"o\">,</span>\n  <span class=\"n\">induction</span> <span class=\"n\">wfa</span> <span class=\"n\">generalizing</span> <span class=\"n\">K</span><span class=\"o\">,</span>\n  <span class=\"n\">case</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">all</span> <span class=\"o\">:</span> <span class=\"n\">K&#39;</span> <span class=\"n\">A&#39;</span> <span class=\"n\">ψ</span> <span class=\"n\">wfψ</span> <span class=\"n\">ih</span> <span class=\"o\">{</span><span class=\"n\">constructor</span><span class=\"o\">,</span> <span class=\"n\">sorry</span><span class=\"o\">},</span>\n  <span class=\"n\">case</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">ex</span> <span class=\"o\">:</span> <span class=\"n\">K&#39;</span> <span class=\"n\">A&#39;</span> <span class=\"n\">ψ</span> <span class=\"n\">wfψ</span> <span class=\"n\">ih</span> <span class=\"o\">{</span><span class=\"n\">constructor</span><span class=\"o\">,</span> <span class=\"n\">sorry</span><span class=\"o\">},</span>\n  <span class=\"n\">case</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">comp</span> <span class=\"o\">:</span> <span class=\"n\">K&#39;</span> <span class=\"n\">A&#39;</span> <span class=\"n\">ψ</span> <span class=\"n\">wfψ</span> <span class=\"n\">ih</span> <span class=\"o\">{</span><span class=\"n\">constructor</span><span class=\"o\">,</span> <span class=\"n\">sorry</span><span class=\"o\">},</span>\n  <span class=\"n\">any_goals</span> <span class=\"o\">{</span><span class=\"n\">unfold</span> <span class=\"n\">lift_d</span><span class=\"o\">,</span> <span class=\"n\">apply_rules</span> <span class=\"n\">WF_rules</span><span class=\"o\">},</span>\n<span class=\"kn\">end</span>\n</code></pre></div>\n\n\n<p>this is my state for the first sorry</p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"mi\">1</span> <span class=\"n\">goal</span>\n<span class=\"err\">Δ</span> <span class=\"err\">Γ</span> <span class=\"o\">:</span> <span class=\"kn\">context</span><span class=\"o\">,</span>\n<span class=\"err\">Γ&#39;</span> <span class=\"o\">:</span> <span class=\"n\">list</span> <span class=\"n\">type</span><span class=\"o\">,</span>\n<span class=\"n\">A</span> <span class=\"o\">:</span> <span class=\"n\">type</span><span class=\"o\">,</span>\n<span class=\"n\">a</span> <span class=\"o\">:</span> <span class=\"n\">term</span><span class=\"o\">,</span>\n<span class=\"n\">K</span> <span class=\"o\">:</span> <span class=\"kn\">context</span><span class=\"o\">,</span>\n<span class=\"n\">K&#39;</span> <span class=\"o\">:</span> <span class=\"n\">list</span> <span class=\"n\">type</span><span class=\"o\">,</span>\n<span class=\"n\">e</span> <span class=\"o\">:</span> <span class=\"n\">K&#39;</span> <span class=\"bp\">=</span> <span class=\"err\">Γ&#39;</span><span class=\"o\">,</span>\n<span class=\"n\">A&#39;</span> <span class=\"o\">:</span> <span class=\"n\">type</span><span class=\"o\">,</span>\n<span class=\"n\">ψ</span> <span class=\"o\">:</span> <span class=\"n\">term</span><span class=\"o\">,</span>\n<span class=\"n\">wfψ</span> <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"o\">(</span><span class=\"n\">A&#39;</span> <span class=\"bp\">::</span> <span class=\"n\">K&#39;</span><span class=\"o\">)</span> <span class=\"err\">Ω</span> <span class=\"n\">ψ</span><span class=\"o\">,</span>\n<span class=\"n\">ih</span> <span class=\"o\">:</span> <span class=\"n\">A&#39;</span> <span class=\"bp\">::</span> <span class=\"n\">K&#39;</span> <span class=\"bp\">=</span> <span class=\"err\">Γ&#39;</span> <span class=\"bp\">→</span> <span class=\"bp\">∀</span> <span class=\"o\">(</span><span class=\"n\">K</span> <span class=\"o\">:</span> <span class=\"kn\">context</span><span class=\"o\">),</span> <span class=\"n\">WF</span> <span class=\"o\">(</span><span class=\"n\">K</span> <span class=\"bp\">++</span> <span class=\"err\">Δ</span> <span class=\"bp\">++</span> <span class=\"err\">Γ</span><span class=\"o\">)</span> <span class=\"err\">Ω</span> <span class=\"o\">(</span><span class=\"n\">lift_d</span> <span class=\"o\">(</span><span class=\"n\">length</span> <span class=\"err\">Δ</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">length</span> <span class=\"n\">K</span><span class=\"o\">)</span> <span class=\"n\">ψ</span><span class=\"o\">)</span>\n<span class=\"err\">⊢</span> <span class=\"n\">WF</span> <span class=\"o\">(</span><span class=\"n\">A&#39;</span> <span class=\"bp\">::</span> <span class=\"o\">(</span><span class=\"n\">K</span> <span class=\"bp\">++</span> <span class=\"err\">Δ</span> <span class=\"bp\">++</span> <span class=\"err\">Γ</span><span class=\"o\">))</span> <span class=\"err\">Ω</span> <span class=\"o\">(</span><span class=\"n\">lift_d</span> <span class=\"o\">(</span><span class=\"n\">length</span> <span class=\"err\">Δ</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">length</span> <span class=\"n\">K</span> <span class=\"bp\">+</span> <span class=\"mi\">1</span><span class=\"o\">)</span> <span class=\"n\">ψ</span><span class=\"o\">)</span>\n</code></pre></div>",
        "id": 200414272,
        "sender_full_name": "Billy Price",
        "timestamp": 1591795003
    },
    {
        "content": "<p>I think I should have <code>length K'</code> appearing in <code>ih</code>, not <code>length K</code></p>",
        "id": 200414434,
        "sender_full_name": "Billy Price",
        "timestamp": 1591795079
    },
    {
        "content": "<p>You can simplify this by eliminating the equality immediately using <code>induction wfa generalizing K; subst e,</code></p>",
        "id": 200414643,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1591795189
    },
    {
        "content": "<p><code>K'</code> is just <code>Γ'</code></p>",
        "id": 200414736,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1591795221
    },
    {
        "content": "<p>but that inductive hypothesis does look like bad news</p>",
        "id": 200414805,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1591795261
    },
    {
        "content": "<p>Oh right I got the renaming wrong.</p>",
        "id": 200414849,
        "sender_full_name": "Billy Price",
        "timestamp": 1591795286
    },
    {
        "content": "<p>what is the state before <code>induction</code></p>",
        "id": 200414869,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1591795299
    },
    {
        "content": "<p>Ah, I think I know what happened; <code>wfa</code> is in the context so <code>generalize</code> won't hit it and it is useless (it just adds a useless equality to the context)</p>",
        "id": 200415087,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1591795398
    },
    {
        "content": "<p>Use <code>generalize_hyp e : K ++ Γ = Γ' at wfa,</code></p>",
        "id": 200415104,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1591795412
    },
    {
        "content": "<p>the idea here is that immediately before the induction <code>wfa</code> should have variables in all the indices, no composed expressions</p>",
        "id": 200415198,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1591795453
    },
    {
        "content": "<p>Yep that makes sense</p>",
        "id": 200415235,
        "sender_full_name": "Billy Price",
        "timestamp": 1591795485
    },
    {
        "content": "<p>Now we're here</p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"bp\">@</span><span class=\"o\">[</span><span class=\"n\">TT</span><span class=\"bp\">.</span><span class=\"n\">WF_rules</span><span class=\"o\">]</span> <span class=\"kn\">lemma</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">lift_d</span> <span class=\"o\">(</span><span class=\"n\">K</span> <span class=\"err\">Δ</span> <span class=\"err\">Γ</span> <span class=\"o\">:</span> <span class=\"kn\">context</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"o\">(</span><span class=\"n\">K</span> <span class=\"bp\">++</span> <span class=\"err\">Γ</span><span class=\"o\">)</span> <span class=\"n\">A</span> <span class=\"n\">a</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"o\">(</span><span class=\"n\">K</span> <span class=\"bp\">++</span> <span class=\"err\">Δ</span> <span class=\"bp\">++</span> <span class=\"err\">Γ</span><span class=\"o\">)</span> <span class=\"n\">A</span> <span class=\"o\">(</span><span class=\"n\">lift_d</span> <span class=\"o\">(</span><span class=\"n\">length</span> <span class=\"err\">Δ</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">length</span> <span class=\"n\">K</span><span class=\"o\">)</span> <span class=\"n\">a</span><span class=\"o\">)</span> <span class=\"o\">:=</span>\n<span class=\"k\">begin</span>\n  <span class=\"n\">intro</span> <span class=\"n\">wfa</span><span class=\"o\">,</span>\n  <span class=\"n\">generalize_hyp</span> <span class=\"n\">e</span> <span class=\"o\">:</span> <span class=\"n\">K</span> <span class=\"bp\">++</span> <span class=\"err\">Γ</span> <span class=\"bp\">=</span> <span class=\"err\">Γ&#39;</span> <span class=\"n\">at</span> <span class=\"n\">wfa</span><span class=\"o\">,</span>\n  <span class=\"n\">induction</span> <span class=\"n\">wfa</span> <span class=\"n\">generalizing</span> <span class=\"n\">K</span><span class=\"o\">,</span>\n  <span class=\"n\">case</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">all</span> <span class=\"o\">:</span> <span class=\"err\">Γ&#39;</span> <span class=\"n\">A&#39;</span> <span class=\"n\">ψ</span> <span class=\"n\">wfψ</span> <span class=\"n\">ih</span> <span class=\"o\">{</span><span class=\"n\">subst</span> <span class=\"n\">e</span><span class=\"o\">,</span> <span class=\"n\">constructor</span><span class=\"o\">,},</span>\n  <span class=\"n\">case</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">ex</span> <span class=\"o\">:</span> <span class=\"err\">Γ&#39;</span> <span class=\"n\">A&#39;</span> <span class=\"n\">ψ</span> <span class=\"n\">wfψ</span> <span class=\"n\">ih</span> <span class=\"o\">{</span><span class=\"n\">constructor</span><span class=\"o\">,</span> <span class=\"n\">sorry</span><span class=\"o\">},</span>\n  <span class=\"n\">case</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">comp</span> <span class=\"o\">:</span> <span class=\"err\">Γ&#39;</span> <span class=\"n\">A&#39;</span> <span class=\"n\">ψ</span> <span class=\"n\">wfψ</span> <span class=\"n\">ih</span> <span class=\"o\">{</span><span class=\"n\">constructor</span><span class=\"o\">,</span> <span class=\"n\">sorry</span><span class=\"o\">},</span>\n  <span class=\"n\">any_goals</span> <span class=\"o\">{</span><span class=\"n\">unfold</span> <span class=\"n\">lift_d</span><span class=\"o\">,</span> <span class=\"n\">apply_rules</span> <span class=\"n\">WF_rules</span><span class=\"o\">},</span>\n<span class=\"kn\">end</span>\n</code></pre></div>\n\n\n<div class=\"codehilite\"><pre><span></span><code><span class=\"mi\">1</span> <span class=\"n\">goal</span>\n<span class=\"err\">Δ</span> <span class=\"err\">Γ</span> <span class=\"o\">:</span> <span class=\"kn\">context</span><span class=\"o\">,</span>\n<span class=\"err\">Γ&#39;</span> <span class=\"o\">:</span> <span class=\"n\">list</span> <span class=\"n\">type</span><span class=\"o\">,</span>\n<span class=\"n\">A</span> <span class=\"o\">:</span> <span class=\"n\">type</span><span class=\"o\">,</span>\n<span class=\"n\">a</span> <span class=\"o\">:</span> <span class=\"n\">term</span><span class=\"o\">,</span>\n<span class=\"n\">K</span> <span class=\"o\">:</span> <span class=\"kn\">context</span><span class=\"o\">,</span>\n<span class=\"n\">A&#39;</span> <span class=\"o\">:</span> <span class=\"n\">type</span><span class=\"o\">,</span>\n<span class=\"n\">ψ</span> <span class=\"o\">:</span> <span class=\"n\">term</span><span class=\"o\">,</span>\n<span class=\"n\">wfψ</span> <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"o\">(</span><span class=\"n\">A&#39;</span> <span class=\"bp\">::</span> <span class=\"o\">(</span><span class=\"n\">K</span> <span class=\"bp\">++</span> <span class=\"err\">Γ</span><span class=\"o\">))</span> <span class=\"err\">Ω</span> <span class=\"n\">ψ</span><span class=\"o\">,</span>\n<span class=\"n\">ih</span> <span class=\"o\">:</span> <span class=\"bp\">∀</span> <span class=\"o\">(</span><span class=\"n\">K_1</span> <span class=\"o\">:</span> <span class=\"kn\">context</span><span class=\"o\">),</span> <span class=\"n\">K_1</span> <span class=\"bp\">++</span> <span class=\"err\">Γ</span> <span class=\"bp\">=</span> <span class=\"n\">A&#39;</span> <span class=\"bp\">::</span> <span class=\"o\">(</span><span class=\"n\">K</span> <span class=\"bp\">++</span> <span class=\"err\">Γ</span><span class=\"o\">)</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"o\">(</span><span class=\"n\">K_1</span> <span class=\"bp\">++</span> <span class=\"err\">Δ</span> <span class=\"bp\">++</span> <span class=\"err\">Γ</span><span class=\"o\">)</span> <span class=\"err\">Ω</span> <span class=\"o\">(</span><span class=\"n\">lift_d</span> <span class=\"o\">(</span><span class=\"n\">length</span> <span class=\"err\">Δ</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">length</span> <span class=\"n\">K_1</span><span class=\"o\">)</span> <span class=\"n\">ψ</span><span class=\"o\">)</span>\n<span class=\"err\">⊢</span> <span class=\"n\">WF</span> <span class=\"o\">(</span><span class=\"n\">A&#39;</span> <span class=\"bp\">::</span> <span class=\"o\">(</span><span class=\"n\">K</span> <span class=\"bp\">++</span> <span class=\"err\">Δ</span> <span class=\"bp\">++</span> <span class=\"err\">Γ</span><span class=\"o\">))</span> <span class=\"err\">Ω</span> <span class=\"o\">(</span><span class=\"n\">lift_d</span> <span class=\"o\">(</span><span class=\"n\">length</span> <span class=\"err\">Δ</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">length</span> <span class=\"n\">K</span> <span class=\"bp\">+</span> <span class=\"mi\">1</span><span class=\"o\">)</span> <span class=\"n\">ψ</span><span class=\"o\">)</span>\n</code></pre></div>",
        "id": 200415730,
        "sender_full_name": "Billy Price",
        "timestamp": 1591795745
    },
    {
        "content": "<p>That's the state after <code>constructor,</code>. I put the <code>subst e</code>, inside the case because applying it do all the inductive cases via <code>induction wfa generalizing K; subst e</code> anonymised the goals so I couldn't name a case anymore.</p>",
        "id": 200415891,
        "sender_full_name": "Billy Price",
        "timestamp": 1591795824
    },
    {
        "content": "<p>The hypothesis seems good to me - is it just failing to see how to unify the lists because of associativity or something? This is what I get when I try to <code>apply ih</code></p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"n\">invalid</span> <span class=\"n\">apply</span> <span class=\"n\">tactic</span><span class=\"o\">,</span> <span class=\"n\">failed</span> <span class=\"n\">to</span> <span class=\"n\">unify</span>\n  <span class=\"n\">WF</span> <span class=\"o\">(</span><span class=\"n\">A&#39;</span> <span class=\"bp\">::</span> <span class=\"o\">(</span><span class=\"n\">K</span> <span class=\"bp\">++</span> <span class=\"err\">Δ</span> <span class=\"bp\">++</span> <span class=\"err\">Γ</span><span class=\"o\">))</span> <span class=\"err\">Ω</span> <span class=\"o\">(</span><span class=\"n\">lift_d</span> <span class=\"o\">(</span><span class=\"n\">length</span> <span class=\"err\">Δ</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">length</span> <span class=\"n\">K</span> <span class=\"bp\">+</span> <span class=\"mi\">1</span><span class=\"o\">)</span> <span class=\"n\">ψ</span><span class=\"o\">)</span>\n<span class=\"k\">with</span>\n  <span class=\"n\">WF</span> <span class=\"o\">(</span><span class=\"err\">?</span><span class=\"n\">m_1</span> <span class=\"bp\">++</span> <span class=\"err\">Δ</span> <span class=\"bp\">++</span> <span class=\"err\">Γ</span><span class=\"o\">)</span> <span class=\"err\">Ω</span> <span class=\"o\">(</span><span class=\"n\">lift_d</span> <span class=\"o\">(</span><span class=\"n\">length</span> <span class=\"err\">Δ</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">length</span> <span class=\"err\">?</span><span class=\"n\">m_1</span><span class=\"o\">)</span> <span class=\"n\">ψ</span><span class=\"o\">)</span>\n</code></pre></div>",
        "id": 200416267,
        "sender_full_name": "Billy Price",
        "timestamp": 1591796039
    },
    {
        "content": "<p>you have to explicitly specify <code>ih (A' :: K)</code>, but it looks defeq modulo that</p>",
        "id": 200416969,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1591796383
    },
    {
        "content": "<p>(you should get out of the habit of using <code>apply</code>; <code>refine</code> and <code>exact</code> are better because they have the expected type)</p>",
        "id": 200417135,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1591796477
    },
    {
        "content": "<p>oh okay, I was aware of <code>exact</code> but not <code>refine</code>. Though reading it now I don't quite see the importance - what do you mean by \"they have the expected type\"?</p>",
        "id": 200417829,
        "sender_full_name": "Billy Price",
        "timestamp": 1591796857
    },
    {
        "content": "<p>whaaat <code>refine</code> is the best tactic</p>",
        "id": 200417876,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1591796882
    },
    {
        "content": "<p>the argument of <code>refine e</code> or <code>exact e</code> is typechecked using the goal as the target type</p>",
        "id": 200417972,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1591796924
    },
    {
        "content": "<p>the argument of <code>apply e</code> is typechecked with no expected type, and then the result is unified against the target type after counting the number of pis to eliminate</p>",
        "id": 200418069,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1591796974
    },
    {
        "content": "<p>Is there a minimal situation in which that makes a difference?</p>",
        "id": 200418433,
        "sender_full_name": "Billy Price",
        "timestamp": 1591797125
    },
    {
        "content": "<p>anything using structure constructor brackets for example</p>",
        "id": 200418507,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1591797171
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span><code><span class=\"kn\">example</span> <span class=\"o\">:</span> <span class=\"n\">true</span> <span class=\"bp\">∧</span> <span class=\"n\">true</span> <span class=\"bp\">∧</span> <span class=\"n\">true</span> <span class=\"o\">:=</span>\n<span class=\"k\">begin</span>\n  <span class=\"n\">refine</span> <span class=\"bp\">⟨⟨⟩</span><span class=\"o\">,</span> <span class=\"bp\">_⟩</span><span class=\"o\">,</span> <span class=\"c1\">-- works</span>\n  <span class=\"n\">exact</span> <span class=\"bp\">⟨⟨⟩</span><span class=\"o\">,</span> <span class=\"bp\">⟨⟩⟩</span><span class=\"o\">,</span> <span class=\"c1\">-- works</span>\n<span class=\"kn\">end</span>\n<span class=\"kn\">example</span> <span class=\"o\">:</span> <span class=\"n\">true</span> <span class=\"bp\">∧</span> <span class=\"n\">true</span> <span class=\"bp\">∧</span> <span class=\"n\">true</span> <span class=\"o\">:=</span>\n<span class=\"k\">begin</span>\n  <span class=\"n\">apply</span> <span class=\"bp\">⟨⟨⟩</span><span class=\"o\">,</span> <span class=\"bp\">_⟩</span><span class=\"o\">,</span> <span class=\"c1\">-- invalid constructor ⟨...⟩, expected type must be known</span>\n<span class=\"kn\">end</span>\n</code></pre></div>",
        "id": 200418706,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1591797255
    },
    {
        "content": "<p>refine is great for compact and powerful combinations of <code>existsi</code>, <code>intro</code>  and simple proof terms like <code>refine ⟨x, easy_lemma, λ t, _⟩,</code></p>",
        "id": 200419035,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1591797405
    },
    {
        "content": "<p>Ah I see, I think you mean <code>exact ⟨⟨⟩, ⟨⟩,⟨⟩⟩</code> though</p>",
        "id": 200419042,
        "sender_full_name": "Billy Price",
        "timestamp": 1591797411
    },
    {
        "content": "<p>no, I wrote what I meant</p>",
        "id": 200419074,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1591797427
    },
    {
        "content": "<p>that is, <code>apply</code> isn't replacing <code>refine</code> in this example</p>",
        "id": 200419105,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1591797442
    },
    {
        "content": "<p>of course you can also try to give the whole proof term at once as well, making <code>apply</code> act like <code>exact</code></p>",
        "id": 200419160,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1591797468
    },
    {
        "content": "<p>and it would still fail</p>",
        "id": 200419223,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1591797485
    },
    {
        "content": "<p>Oh sorry I interpreted it wrong</p>",
        "id": 200419271,
        "sender_full_name": "Billy Price",
        "timestamp": 1591797504
    },
    {
        "content": "<p>Can I undo the generalizing of <code>K</code> to simplify my other inductive cases?</p>",
        "id": 200419682,
        "sender_full_name": "Billy Price",
        "timestamp": 1591797698
    },
    {
        "content": "<p>You can use <code>exact ih K</code></p>",
        "id": 200419803,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1591797753
    },
    {
        "content": "<p>or <code>apply ih</code> if it works</p>",
        "id": 200419818,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1591797762
    },
    {
        "content": "<p>You could use <code>specialize ih K</code> but it's probably not worth the characters it takes to say</p>",
        "id": 200419892,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1591797802
    },
    {
        "content": "<p>Some of them have multiple inductive hypotheses</p>",
        "id": 200419903,
        "sender_full_name": "Billy Price",
        "timestamp": 1591797805
    },
    {
        "content": "<p>I would do something like <code>iterate 4 { constructor, exact ih_1 K, exact ih_2 K }</code></p>",
        "id": 200420077,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1591797878
    },
    {
        "content": "<p>or <code>try { ... }</code></p>",
        "id": 200420131,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1591797909
    },
    {
        "content": "<p>probably some higher level thing like <code>solve_by_elim</code> works too</p>",
        "id": 200420206,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1591797947
    },
    {
        "content": "<p>But how would I name the inductive hypotheses like that?</p>",
        "id": 200420417,
        "sender_full_name": "Billy Price",
        "timestamp": 1591798032
    },
    {
        "content": "<p>They all have gross names and I need to open a single case to name them</p>",
        "id": 200420479,
        "sender_full_name": "Billy Price",
        "timestamp": 1591798071
    },
    {
        "content": "<p>I'm now proving an equality using <code>list.nth</code>, and I want to use theorems that talk about <code>list.nth_le</code>. I haven't seen any theorems converting between the two.</p>",
        "id": 200426313,
        "sender_full_name": "Billy Price",
        "timestamp": 1591800573
    },
    {
        "content": "<p>I'll try write one myself but just wondering if it's already there somewhere (I couldn't find it)</p>",
        "id": 200426942,
        "sender_full_name": "Billy Price",
        "timestamp": 1591800826
    },
    {
        "content": "<p>An MSc student of mine found a lot of missing lemmas about <code>nth</code> and <code>nth_le</code>. Her repo is now public so maybe there is some stuff here <a href=\"https://github.com/ImperialCollegeLondon/dots_and_boxes/tree/master/src/list/lemmas\">https://github.com/ImperialCollegeLondon/dots_and_boxes/tree/master/src/list/lemmas</a> which is of some use. Note that the repo uses Lean 3.4.2.</p>",
        "id": 200428316,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1591801372
    },
    {
        "content": "<p>There is one key theorem called something like <code>nth_le_nth</code></p>",
        "id": 200429147,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1591801746
    },
    {
        "content": "<p>^ that</p>",
        "id": 200429189,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1591801771
    },
    {
        "content": "<p>also <code>nth_eq_some</code></p>",
        "id": 200429225,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1591801788
    },
    {
        "content": "<p>My student needed some <code>nth_le_append</code> lemmas</p>",
        "id": 200429235,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1591801791
    },
    {
        "content": "<p>We never managed to formalise what <code>nth_le_bind</code> was but fortunately we were only glueing two lists together at that point</p>",
        "id": 200429330,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1591801818
    },
    {
        "content": "<p>I see <code>nth_le_append</code> and <code>nth_le_append_right</code></p>",
        "id": 200429357,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1591801834
    },
    {
        "content": "<p>I wouldn't bother with <code>nth_le_bind</code>, the expression is not any better than what you get by induction</p>",
        "id": 200429496,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1591801893
    },
    {
        "content": "<p>They weren't in mathlib when the project started, and the student never bothered keeping up to date with mathlib</p>",
        "id": 200429612,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1591801947
    },
    {
        "content": "<p>Thanks for the help, I'm gonna bookmark that proof for now. I have a thing called <code>tset : type -&gt; Type</code>, so if <code>A : type</code>, then <code>tset A</code> is basically a closed term of type <code>PA</code>, and I'd like to form a category of all such tsets of all types. But if I say <code>instance category : small_category (Π A : type, tset A)</code> are the objects in that category elements of Type <code>tset A</code> for some <code>A</code>, or are they indexed families of tsets, which are indexed by the elements of <code>type</code>?</p>",
        "id": 200514209,
        "sender_full_name": "Billy Price",
        "timestamp": 1591861847
    },
    {
        "content": "<p>I understand that I need to actually define the structure of that category, but I'm just trying to get the Type right for now</p>",
        "id": 200514245,
        "sender_full_name": "Billy Price",
        "timestamp": 1591861900
    },
    {
        "content": "<p>To strip away all the unnecessary context here,  if I have</p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"n\">def</span> <span class=\"n\">foo</span><span class=\"o\">:</span> <span class=\"kt\">Type</span>\n<span class=\"n\">def</span> <span class=\"n\">bar</span> <span class=\"o\">:</span> <span class=\"bp\">ℕ</span> <span class=\"bp\">-&gt;</span> <span class=\"n\">foo</span>\n<span class=\"n\">def</span> <span class=\"n\">baz</span> <span class=\"o\">:=</span> <span class=\"bp\">Π</span> <span class=\"n\">n</span> <span class=\"o\">:</span> <span class=\"bp\">ℕ</span><span class=\"o\">,</span> <span class=\"n\">bar</span> <span class=\"n\">n</span>\n</code></pre></div>\n\n\n<p>what <em>is</em> an <code>f : baz</code>? Is it an indexed family of <code>foo</code>'s (via <code>bar</code>) or is it a <code>bar n : foo</code> for some  <code>n</code>? What is the type of all <code>bar n</code> for any <code>n</code>? My best idea is a subtype of <code>foo</code> where any <code>a</code> in the subtype has <code>∃ n : ℕ, bar n == a</code>, but that seems too implicit. I'd like to say maybe pairs of the form <code>&lt;n,bar n&gt;</code>?</p>",
        "id": 200515274,
        "sender_full_name": "Billy Price",
        "timestamp": 1591862710
    },
    {
        "content": "<p>I think I just figured out that this is what the sigma construction is for lol.</p>",
        "id": 200515884,
        "sender_full_name": "Billy Price",
        "timestamp": 1591863168
    },
    {
        "content": "<p>An element of <code>\\Sigma A : type, tset A</code> would be a \"pointed type\" - - are these really the objects you want for your category?</p>",
        "id": 200516260,
        "sender_full_name": "David Wärn",
        "timestamp": 1591863418
    },
    {
        "content": "<p>In <code>category C</code>, C is just the type of \"abstract objects\". An element of C does not need to have any internal structure - - it is just a label. Maybe here you want C to be just <code>type</code>? Then you can define Hom-sets however you like</p>",
        "id": 200516298,
        "sender_full_name": "David Wärn",
        "timestamp": 1591863458
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"255481\">@Billy Price</span>  what you wrote about bar doesn't typecheck.</p>",
        "id": 200517695,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1591864552
    },
    {
        "content": "<p><code>baz</code> doesn't make sense. It looks like it's going to be a function which eats a natural <code>n</code> and returns a term of type <code>bar n</code>, but <code>bar n</code> isn't a type.</p>",
        "id": 200517789,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1591864613
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span><code><span class=\"n\">def</span> <span class=\"n\">foo</span><span class=\"o\">:</span> <span class=\"kt\">Type</span> <span class=\"o\">:=</span> <span class=\"n\">sorry</span>\n<span class=\"n\">def</span> <span class=\"n\">bar</span> <span class=\"o\">:</span> <span class=\"bp\">ℕ</span> <span class=\"bp\">-&gt;</span> <span class=\"n\">foo</span> <span class=\"o\">:=</span> <span class=\"n\">sorry</span>\n<span class=\"n\">def</span> <span class=\"n\">baz</span> <span class=\"o\">:=</span> <span class=\"bp\">Π</span> <span class=\"n\">n</span> <span class=\"o\">:</span> <span class=\"bp\">ℕ</span><span class=\"o\">,</span> <span class=\"n\">bar</span> <span class=\"n\">n</span> <span class=\"c1\">-- error -- type expected at bar n</span>\n</code></pre></div>",
        "id": 200517843,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1591864660
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"130377\">David Wärn</span> <a href=\"#narrow/stream/236446-Type-theory/topic/Modelling.20a.20Type.20Theory.20in.20Lean/near/200516260\">said</a>:</p>\n<blockquote>\n<p>An element of <code>\\Sigma A : type, tset A</code> would be a \"pointed type\" - - are these really the objects you want for your category?</p>\n</blockquote>\n<p>Yep, I'm not forming the typical category of types. Closer to the category of sets. My objects are terms <code>α : term</code> such that <code>WF [] (P A) α</code>, that is, <code>α</code> is a well-formed term in the empty context (it's closed) \"of type (P A)\", where <code>P: type -&gt; type</code> is thought of as the powerset of a type. My morphisms are terms which look like the graph of a function between two such \"subsets of a type\".</p>\n<p><span class=\"user-mention\" data-user-id=\"110038\">@Kevin Buzzard</span> I must have confused myself in translating to that example. I might reattempt, but I think <code>Σ A : type, tset A</code> is what I was looking for, where <code>tset</code> is defined like this</p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"n\">def</span> <span class=\"n\">tset</span> <span class=\"o\">(</span><span class=\"n\">A</span><span class=\"o\">:</span> <span class=\"n\">type</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"o\">{</span><span class=\"n\">α</span> <span class=\"o\">:</span> <span class=\"n\">term</span> <span class=\"bp\">//</span> <span class=\"n\">WF</span> <span class=\"o\">[]</span> <span class=\"o\">(</span><span class=\"err\">𝒫</span> <span class=\"n\">A</span><span class=\"o\">)</span> <span class=\"n\">α</span><span class=\"o\">}</span>\n</code></pre></div>\n\n\n<p>The related definitions to what I'm doing appear here<br>\n<a href=\"#narrow/stream/236446-Type-theory/topic/Modelling.20a.20Type.20Theory.20in.20Lean/near/200405009\">https://leanprover.zulipchat.com/#narrow/stream/236446-Type-theory/topic/Modelling.20a.20Type.20Theory.20in.20Lean/near/200405009</a></p>",
        "id": 200518371,
        "sender_full_name": "Billy Price",
        "timestamp": 1591864978
    },
    {
        "content": "<p>Pi's are types of dependent functions and Sigma's are types of dependent pairs</p>",
        "id": 200518534,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1591865089
    },
    {
        "content": "<p>I actually want to form equivalence classes of \"provably equal\" such terms, but it's becoming difficult to prove the lifting properties, so I'm just ignoring that for now. It definitely doesn't form a category without doing this, since associativity will never hold (composition produces ugly terms which are \"provably equal\" to simpler terms). Btw, \"Provably equal\" is its own thing my type theory.</p>",
        "id": 200519356,
        "sender_full_name": "Billy Price",
        "timestamp": 1591865684
    },
    {
        "content": "<p>How come <code>cases</code> recognises whenever a constructor couldn't possibly produce the target, but <code>induction</code> doesn't? I always end up with absurd cases to prove with induction.</p>",
        "id": 200531435,
        "sender_full_name": "Billy Price",
        "timestamp": 1591874765
    },
    {
        "content": "<p>because properties if the input may not hold of the inductive subcases</p>",
        "id": 200531532,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1591874875
    },
    {
        "content": "<p>But shouldn't the result of those constructors fail to unify with the target?</p>",
        "id": 200531854,
        "sender_full_name": "Billy Price",
        "timestamp": 1591875069
    },
    {
        "content": "<p>If <code>induction</code> used the same motive as <code>cases</code>, the inductive hypothesis would be guaranteed useless</p>",
        "id": 200531900,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1591875075
    },
    {
        "content": "<p>the point is that just because you are inducting on <code>foo (C1 t)</code>, doesn't mean that every subterm of <code>C1 t</code> is also of the form <code>C1 t</code></p>",
        "id": 200531934,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1591875117
    },
    {
        "content": "<p>so although you may be able to eliminate case <code>C2</code> at the top level, when you go around the recursion once you won't be able to skip the <code>C2</code> case anymore</p>",
        "id": 200532016,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1591875172
    },
    {
        "content": "<p>Hmm lemme make a simple example that I don't understand</p>",
        "id": 200532077,
        "sender_full_name": "Billy Price",
        "timestamp": 1591875237
    },
    {
        "content": "<p>If you want to explicitly say that an index is fixed, for example you are proving something about terms in the empty context and don't mind that the inductive hypothesis of <code>WF.all</code> doesn't apply, then you can explicitly generalize it before and eliminate it after using <code>generalize_hyp e : Gamma = [] at wf, induction wf; cases e,</code></p>",
        "id": 200532162,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1591875286
    },
    {
        "content": "<p>Oh okay I do have more questions about what's going on here in this example so I'll paste it anyway</p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"kn\">inductive</span> <span class=\"n\">type</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span>\n<span class=\"bp\">|</span> <span class=\"n\">Unit</span> <span class=\"bp\">|</span> <span class=\"n\">Omega</span> <span class=\"bp\">|</span> <span class=\"n\">Prod</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"n\">B</span> <span class=\"o\">:</span> <span class=\"n\">type</span><span class=\"o\">)</span><span class=\"bp\">|</span> <span class=\"n\">Pow</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"o\">:</span> <span class=\"n\">type</span><span class=\"o\">)</span>\n\n<span class=\"kn\">notation</span> <span class=\"bp\">`</span><span class=\"err\">Ω</span><span class=\"bp\">`</span> <span class=\"o\">:=</span> <span class=\"n\">type</span><span class=\"bp\">.</span><span class=\"n\">Omega</span>\n<span class=\"n\">def</span> <span class=\"n\">Unit</span> <span class=\"o\">:=</span> <span class=\"n\">type</span><span class=\"bp\">.</span><span class=\"n\">Unit</span>\n<span class=\"kn\">infix</span> <span class=\"bp\">`××`</span><span class=\"o\">:</span><span class=\"n\">max</span> <span class=\"o\">:=</span> <span class=\"n\">type</span><span class=\"bp\">.</span><span class=\"n\">Prod</span>\n<span class=\"kn\">notation</span> <span class=\"bp\">`</span><span class=\"err\">𝒫</span><span class=\"bp\">`</span><span class=\"n\">A</span> <span class=\"o\">:</span><span class=\"n\">max</span> <span class=\"o\">:=</span> <span class=\"n\">type</span><span class=\"bp\">.</span><span class=\"n\">Pow</span> <span class=\"n\">A</span>\n\n<span class=\"n\">def</span> <span class=\"kn\">context</span> <span class=\"o\">:=</span> <span class=\"n\">list</span> <span class=\"n\">type</span>\n\n<span class=\"kn\">inductive</span> <span class=\"n\">term</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span>\n<span class=\"bp\">|</span> <span class=\"n\">star</span> <span class=\"o\">:</span> <span class=\"n\">term</span>\n<span class=\"bp\">|</span> <span class=\"n\">top</span>  <span class=\"o\">:</span> <span class=\"n\">term</span>\n<span class=\"bp\">|</span> <span class=\"n\">bot</span>  <span class=\"o\">:</span> <span class=\"n\">term</span>\n<span class=\"bp\">|</span> <span class=\"n\">and</span>  <span class=\"o\">:</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">term</span>\n<span class=\"bp\">|</span> <span class=\"n\">or</span>   <span class=\"o\">:</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">term</span>\n<span class=\"bp\">|</span> <span class=\"n\">imp</span>  <span class=\"o\">:</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">term</span>\n<span class=\"bp\">|</span> <span class=\"n\">elem</span> <span class=\"o\">:</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">term</span>\n<span class=\"bp\">|</span> <span class=\"n\">pair</span> <span class=\"o\">:</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">term</span>\n<span class=\"bp\">|</span> <span class=\"n\">var</span>  <span class=\"o\">:</span> <span class=\"bp\">ℕ</span> <span class=\"bp\">→</span> <span class=\"n\">term</span>\n<span class=\"bp\">|</span> <span class=\"n\">comp</span> <span class=\"o\">:</span> <span class=\"n\">type</span> <span class=\"bp\">→</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">term</span>\n<span class=\"bp\">|</span> <span class=\"n\">all</span>  <span class=\"o\">:</span> <span class=\"n\">type</span> <span class=\"bp\">→</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">term</span>\n<span class=\"bp\">|</span> <span class=\"n\">ex</span>   <span class=\"o\">:</span> <span class=\"n\">type</span> <span class=\"bp\">→</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">term</span>\n\n<span class=\"kn\">open</span> <span class=\"n\">term</span>\n\n<span class=\"kn\">notation</span> <span class=\"bp\">`</span><span class=\"mi\">𝟘</span><span class=\"bp\">`</span> <span class=\"o\">:=</span> <span class=\"n\">term</span><span class=\"bp\">.</span><span class=\"n\">var</span> <span class=\"mi\">0</span>\n<span class=\"kn\">notation</span> <span class=\"bp\">`</span><span class=\"mi\">𝟙</span><span class=\"bp\">`</span> <span class=\"o\">:=</span> <span class=\"n\">term</span><span class=\"bp\">.</span><span class=\"n\">var</span> <span class=\"mi\">1</span>\n<span class=\"kn\">notation</span> <span class=\"bp\">`</span><span class=\"mi\">𝟚</span><span class=\"bp\">`</span> <span class=\"o\">:=</span> <span class=\"n\">term</span><span class=\"bp\">.</span><span class=\"n\">var</span> <span class=\"mi\">2</span>\n<span class=\"kn\">notation</span> <span class=\"bp\">`</span><span class=\"mi\">𝟛</span><span class=\"bp\">`</span> <span class=\"o\">:=</span> <span class=\"n\">term</span><span class=\"bp\">.</span><span class=\"n\">var</span> <span class=\"mi\">3</span>\n<span class=\"kn\">notation</span> <span class=\"bp\">`</span><span class=\"mi\">𝟜</span><span class=\"bp\">`</span> <span class=\"o\">:=</span> <span class=\"n\">term</span><span class=\"bp\">.</span><span class=\"n\">var</span> <span class=\"mi\">4</span>\n<span class=\"kn\">notation</span> <span class=\"bp\">`</span><span class=\"mi\">𝟝</span><span class=\"bp\">`</span> <span class=\"o\">:=</span> <span class=\"n\">term</span><span class=\"bp\">.</span><span class=\"n\">var</span> <span class=\"mi\">5</span>\n\n<span class=\"kn\">notation</span> <span class=\"bp\">`</span><span class=\"err\">⁎</span><span class=\"bp\">`</span> <span class=\"o\">:=</span> <span class=\"n\">term</span><span class=\"bp\">.</span><span class=\"n\">star</span>    <span class=\"c1\">-- input \\asterisk</span>\n<span class=\"kn\">notation</span> <span class=\"bp\">`</span><span class=\"err\">⊤</span><span class=\"bp\">`</span> <span class=\"o\">:=</span> <span class=\"n\">term</span><span class=\"bp\">.</span><span class=\"n\">top</span>     <span class=\"c1\">--       \\top</span>\n<span class=\"kn\">notation</span> <span class=\"bp\">`</span><span class=\"err\">⊥</span><span class=\"bp\">`</span> <span class=\"o\">:=</span> <span class=\"n\">term</span><span class=\"bp\">.</span><span class=\"n\">bot</span>     <span class=\"c1\">-- input \\bot</span>\n<span class=\"kn\">infixr</span> <span class=\"bp\">`</span> <span class=\"err\">⟹</span> <span class=\"bp\">`</span><span class=\"o\">:</span><span class=\"mi\">60</span> <span class=\"o\">:=</span> <span class=\"n\">term</span><span class=\"bp\">.</span><span class=\"n\">imp</span> <span class=\"c1\">-- input \\==&gt;</span>\n<span class=\"kn\">infixr</span> <span class=\"bp\">`</span> <span class=\"err\">⋀</span> <span class=\"bp\">`</span> <span class=\"o\">:</span><span class=\"mi\">70</span> <span class=\"o\">:=</span> <span class=\"n\">term</span><span class=\"bp\">.</span><span class=\"n\">and</span> <span class=\"c1\">-- input \\And or \\bigwedge</span>\n<span class=\"kn\">infixr</span> <span class=\"bp\">`</span> <span class=\"err\">⋁</span> <span class=\"bp\">`</span> <span class=\"o\">:</span><span class=\"mi\">59</span> <span class=\"o\">:=</span> <span class=\"n\">term</span><span class=\"bp\">.</span><span class=\"n\">or</span>  <span class=\"c1\">-- input \\Or or \\bigvee</span>\n\n<span class=\"kn\">infix</span> <span class=\"err\">∈</span> <span class=\"o\">:=</span> <span class=\"n\">term</span><span class=\"bp\">.</span><span class=\"n\">elem</span>\n<span class=\"kn\">infix</span> <span class=\"err\">∉</span> <span class=\"o\">:=</span> <span class=\"bp\">λ</span> <span class=\"n\">a</span> <span class=\"n\">α</span><span class=\"o\">,</span> <span class=\"n\">not</span> <span class=\"o\">(</span><span class=\"n\">term</span><span class=\"bp\">.</span><span class=\"n\">elem</span> <span class=\"n\">a</span> <span class=\"n\">α</span><span class=\"o\">)</span>\n<span class=\"kn\">notation</span> <span class=\"bp\">`</span><span class=\"err\">⟦</span> <span class=\"bp\">`</span> <span class=\"n\">A</span> <span class=\"bp\">`</span> <span class=\"bp\">|</span> <span class=\"bp\">`</span> <span class=\"n\">φ</span> <span class=\"bp\">`</span> <span class=\"err\">⟧</span><span class=\"bp\">`</span> <span class=\"o\">:=</span> <span class=\"n\">term</span><span class=\"bp\">.</span><span class=\"n\">comp</span> <span class=\"n\">A</span> <span class=\"n\">φ</span>\n\n<span class=\"kn\">notation</span> <span class=\"bp\">`</span><span class=\"err\">⟪</span><span class=\"bp\">`</span> <span class=\"n\">a</span> <span class=\"bp\">`</span><span class=\"o\">,</span><span class=\"bp\">`</span> <span class=\"n\">b</span> <span class=\"bp\">`</span><span class=\"err\">⟫</span><span class=\"bp\">`</span> <span class=\"o\">:=</span> <span class=\"n\">term</span><span class=\"bp\">.</span><span class=\"n\">pair</span> <span class=\"n\">a</span> <span class=\"n\">b</span>\n\n<span class=\"kn\">notation</span> <span class=\"bp\">`∀</span><span class=\"err\">&#39;</span><span class=\"bp\">`</span> <span class=\"o\">:=</span> <span class=\"n\">term</span><span class=\"bp\">.</span><span class=\"n\">all</span>\n<span class=\"kn\">notation</span> <span class=\"bp\">`∃</span><span class=\"err\">&#39;</span><span class=\"bp\">`</span> <span class=\"o\">:=</span> <span class=\"n\">term</span><span class=\"bp\">.</span><span class=\"n\">ex</span>\n\n<span class=\"kn\">inductive</span> <span class=\"n\">WF</span> <span class=\"o\">:</span> <span class=\"kn\">context</span> <span class=\"bp\">→</span> <span class=\"n\">type</span> <span class=\"bp\">→</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"kt\">Prop</span>\n<span class=\"bp\">|</span> <span class=\"n\">star</span> <span class=\"o\">{</span><span class=\"err\">Γ</span><span class=\"o\">}</span>         <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"n\">Unit</span> <span class=\"err\">⁎</span>\n<span class=\"bp\">|</span> <span class=\"n\">top</span>  <span class=\"o\">{</span><span class=\"err\">Γ</span><span class=\"o\">}</span>         <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"err\">⊤</span>\n<span class=\"bp\">|</span> <span class=\"n\">bot</span>  <span class=\"o\">{</span><span class=\"err\">Γ</span><span class=\"o\">}</span>         <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"err\">⊥</span>\n<span class=\"bp\">|</span> <span class=\"n\">and</span>  <span class=\"o\">{</span><span class=\"err\">Γ</span> <span class=\"n\">p</span> <span class=\"n\">q</span><span class=\"o\">}</span>     <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"n\">p</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"n\">q</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"err\">⋀</span> <span class=\"n\">q</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"n\">or</span>   <span class=\"o\">{</span><span class=\"err\">Γ</span> <span class=\"n\">p</span> <span class=\"n\">q</span><span class=\"o\">}</span>     <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"n\">p</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"n\">q</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"err\">⋁</span> <span class=\"n\">q</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"n\">imp</span>  <span class=\"o\">{</span><span class=\"err\">Γ</span> <span class=\"n\">p</span> <span class=\"n\">q</span><span class=\"o\">}</span>     <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"n\">p</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"n\">q</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"err\">⟹</span> <span class=\"n\">q</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"n\">elem</span> <span class=\"o\">{</span><span class=\"err\">Γ</span> <span class=\"n\">A</span> <span class=\"n\">a</span> <span class=\"n\">α</span><span class=\"o\">}</span>   <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"n\">A</span> <span class=\"n\">a</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"o\">(</span><span class=\"err\">𝒫</span> <span class=\"n\">A</span><span class=\"o\">)</span> <span class=\"n\">α</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"o\">(</span><span class=\"n\">a</span> <span class=\"err\">∈</span> <span class=\"n\">α</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"n\">pair</span> <span class=\"o\">{</span><span class=\"err\">Γ</span> <span class=\"n\">A</span> <span class=\"n\">B</span> <span class=\"n\">a</span> <span class=\"n\">b</span><span class=\"o\">}</span> <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"n\">A</span> <span class=\"n\">a</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"n\">B</span> <span class=\"n\">b</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"bp\">××</span> <span class=\"n\">B</span><span class=\"o\">)</span> <span class=\"err\">⟪</span><span class=\"n\">a</span><span class=\"o\">,</span><span class=\"n\">b</span><span class=\"err\">⟫</span>\n<span class=\"bp\">|</span> <span class=\"n\">var</span>  <span class=\"o\">{</span><span class=\"err\">Γ</span> <span class=\"n\">A</span> <span class=\"n\">n</span><span class=\"o\">}</span>     <span class=\"o\">:</span> <span class=\"n\">list</span><span class=\"bp\">.</span><span class=\"n\">nth</span> <span class=\"err\">Γ</span> <span class=\"n\">n</span> <span class=\"bp\">=</span> <span class=\"n\">some</span> <span class=\"n\">A</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"n\">A</span> <span class=\"o\">(</span><span class=\"n\">var</span> <span class=\"n\">n</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"n\">comp</span> <span class=\"o\">{</span><span class=\"err\">Γ</span> <span class=\"n\">A</span> <span class=\"n\">φ</span><span class=\"o\">}</span>     <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"o\">(</span><span class=\"n\">A</span><span class=\"bp\">::</span><span class=\"err\">Γ</span><span class=\"o\">)</span> <span class=\"err\">Ω</span> <span class=\"n\">φ</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"o\">(</span><span class=\"err\">𝒫</span> <span class=\"n\">A</span><span class=\"o\">)</span> <span class=\"err\">⟦</span><span class=\"n\">A</span> <span class=\"bp\">|</span> <span class=\"n\">φ</span><span class=\"err\">⟧</span>\n<span class=\"bp\">|</span> <span class=\"n\">all</span>  <span class=\"o\">{</span><span class=\"err\">Γ</span> <span class=\"n\">A</span> <span class=\"n\">φ</span><span class=\"o\">}</span>     <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"o\">(</span><span class=\"n\">A</span><span class=\"bp\">::</span><span class=\"err\">Γ</span><span class=\"o\">)</span> <span class=\"err\">Ω</span> <span class=\"n\">φ</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"o\">(</span><span class=\"bp\">∀</span><span class=\"err\">&#39;</span> <span class=\"n\">A</span> <span class=\"n\">φ</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"n\">ex</span>   <span class=\"o\">{</span><span class=\"err\">Γ</span> <span class=\"n\">A</span> <span class=\"n\">φ</span><span class=\"o\">}</span>     <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"o\">(</span><span class=\"n\">A</span><span class=\"bp\">::</span><span class=\"err\">Γ</span><span class=\"o\">)</span> <span class=\"err\">Ω</span> <span class=\"n\">φ</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"o\">(</span><span class=\"bp\">∃</span><span class=\"err\">&#39;</span> <span class=\"n\">A</span> <span class=\"n\">φ</span><span class=\"o\">)</span>\n\n<span class=\"kn\">example</span> <span class=\"o\">{</span><span class=\"n\">p</span> <span class=\"n\">q</span><span class=\"o\">}</span> <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"o\">[]</span> <span class=\"err\">Ω</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"err\">⋀</span> <span class=\"n\">q</span><span class=\"o\">)</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"o\">[]</span> <span class=\"err\">Ω</span> <span class=\"n\">p</span> <span class=\"o\">:=</span>\n<span class=\"k\">begin</span>\n  <span class=\"n\">intro</span> <span class=\"n\">wf</span><span class=\"o\">,</span>\n  <span class=\"n\">induction</span> <span class=\"n\">wf</span><span class=\"o\">,</span>\n\n<span class=\"kn\">end</span>\n</code></pre></div>",
        "id": 200532353,
        "sender_full_name": "Billy Price",
        "timestamp": 1591875436
    },
    {
        "content": "<p>The recent <code>generalizes</code> tactic by <span class=\"user-mention\" data-user-id=\"256311\">@Jannis Limperg</span> should help with this in the dependent case. I believe that is part of a larger induction tactic but that hasn't been merged AFAIK</p>",
        "id": 200532368,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1591875454
    },
    {
        "content": "<p>Firstly, why does the variable <code>wf</code> become a context in the states?</p>",
        "id": 200532378,
        "sender_full_name": "Billy Price",
        "timestamp": 1591875470
    },
    {
        "content": "<p>that's just a <code>cases</code> proof</p>",
        "id": 200532386,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1591875479
    },
    {
        "content": "<p>no need for induction</p>",
        "id": 200532425,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1591875483
    },
    {
        "content": "<p>Yeah I know I've done this proof before, it's just a simpler example for me to understand</p>",
        "id": 200532466,
        "sender_full_name": "Billy Price",
        "timestamp": 1591875520
    },
    {
        "content": "<blockquote>\n<p>Firstly, why does the variable wf become a context in the states?</p>\n</blockquote>\n<p>The induction variables need names, and these names are derived from the input variable when possible</p>",
        "id": 200532470,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1591875521
    },
    {
        "content": "<p>If you at all care, or if you need to refer to the variables, you should use <code>induction with</code> or <code>case</code> to name the variables</p>",
        "id": 200532528,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1591875564
    },
    {
        "content": "<p>Does it get the same name because there's only one inductive variable, hence no need for the <code>wf_</code> form variables?</p>",
        "id": 200532563,
        "sender_full_name": "Billy Price",
        "timestamp": 1591875589
    },
    {
        "content": "<p>yes</p>",
        "id": 200532573,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1591875595
    },
    {
        "content": "<p>Here's how you can prove that theorem using <code>induction</code> instead of <code>cases</code>:</p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"kn\">example</span> <span class=\"o\">{</span><span class=\"n\">p</span> <span class=\"n\">q</span><span class=\"o\">}</span> <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"o\">[]</span> <span class=\"err\">Ω</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"err\">⋀</span> <span class=\"n\">q</span><span class=\"o\">)</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"o\">[]</span> <span class=\"err\">Ω</span> <span class=\"n\">p</span> <span class=\"o\">:=</span>\n<span class=\"k\">begin</span>\n  <span class=\"n\">generalize</span> <span class=\"n\">e1</span> <span class=\"o\">:</span> <span class=\"o\">[]</span> <span class=\"bp\">=</span> <span class=\"err\">Γ</span><span class=\"o\">,</span>\n  <span class=\"n\">generalize</span> <span class=\"n\">e2</span> <span class=\"o\">:</span> <span class=\"n\">p</span> <span class=\"err\">⋀</span> <span class=\"n\">q</span> <span class=\"bp\">=</span> <span class=\"n\">a</span><span class=\"o\">,</span>\n  <span class=\"n\">intro</span> <span class=\"n\">wf</span><span class=\"o\">,</span>\n  <span class=\"n\">induction</span> <span class=\"n\">wf</span><span class=\"bp\">;</span> <span class=\"n\">cases</span> <span class=\"n\">e1</span><span class=\"bp\">;</span> <span class=\"n\">cases</span> <span class=\"n\">e2</span><span class=\"o\">,</span>\n  <span class=\"n\">assumption</span>\n<span class=\"kn\">end</span>\n</code></pre></div>",
        "id": 200532719,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1591875703
    },
    {
        "content": "<p>Note that this process of generalizing and casing on the equality cuts down on the cases to prove, but does so at the cost of making the induction hypotheses useless:</p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"bp\">...</span>\n<span class=\"n\">wf_ih_a</span> <span class=\"o\">:</span> <span class=\"n\">list</span><span class=\"bp\">.</span><span class=\"n\">nil</span> <span class=\"bp\">=</span> <span class=\"n\">list</span><span class=\"bp\">.</span><span class=\"n\">nil</span> <span class=\"bp\">→</span> <span class=\"n\">p</span> <span class=\"err\">⋀</span> <span class=\"n\">q</span> <span class=\"bp\">=</span> <span class=\"n\">p</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"n\">list</span><span class=\"bp\">.</span><span class=\"n\">nil</span> <span class=\"err\">Ω</span> <span class=\"n\">p</span><span class=\"o\">,</span>\n<span class=\"n\">wf_ih_a_1</span> <span class=\"o\">:</span> <span class=\"n\">list</span><span class=\"bp\">.</span><span class=\"n\">nil</span> <span class=\"bp\">=</span> <span class=\"n\">list</span><span class=\"bp\">.</span><span class=\"n\">nil</span> <span class=\"bp\">→</span> <span class=\"n\">p</span> <span class=\"err\">⋀</span> <span class=\"n\">q</span> <span class=\"bp\">=</span> <span class=\"n\">q</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"n\">list</span><span class=\"bp\">.</span><span class=\"n\">nil</span> <span class=\"err\">Ω</span> <span class=\"n\">p</span><span class=\"o\">,</span>\n</code></pre></div>",
        "id": 200532851,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1591875784
    },
    {
        "content": "<p>I don't quite see what ties the <code>[]</code> or the <code>Γ</code> in <code>e1</code> to anything that appears in the inductive state.</p>",
        "id": 200532973,
        "sender_full_name": "Billy Price",
        "timestamp": 1591875910
    },
    {
        "content": "<p>this is why <code>cases</code> and <code>induction</code> use different default motives even though they both boil down to an application of the recursor. In <code>cases</code> you are saying explicitly that you don't care about induction hypotheses so we can add as many assumptions as we like to the induction motive to say that we are only inducting on something equal to the input, and so kill all the unnecessary cases. In <code>induction</code> we want to generalize the induction hypothesis so we just suck in all assumptions from the context and generalize arguments as specified by <code>generalizing</code></p>",
        "id": 200532981,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1591875922
    },
    {
        "content": "<p>What we are doing is proving <code>WF Γ Ω a → ([] = Γ → p ⋀ q = a → WF Γ Ω p)</code> by induction</p>",
        "id": 200533080,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1591875977
    },
    {
        "content": "<p>How are the Gammas the same Gamma in both appearances there?</p>",
        "id": 200533117,
        "sender_full_name": "Billy Price",
        "timestamp": 1591876019
    },
    {
        "content": "<p>that is, the motive is <code>λ Γ A a, [] = Γ → p ⋀ q = a → WF Γ A p</code></p>",
        "id": 200533135,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1591876039
    },
    {
        "content": "<p>Oh is it because <code>generalize e1 : [] = Γ</code> looks at the target and looks for instances of <code>[]</code>?</p>",
        "id": 200533271,
        "sender_full_name": "Billy Price",
        "timestamp": 1591876140
    },
    {
        "content": "<p>Remember what the recursor says. You are proving that <code>\\forall Γ A a, WF Γ A a -&gt; C Γ A a</code> and this is how we are picking <code>C</code></p>",
        "id": 200533287,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1591876156
    },
    {
        "content": "<p>Yes, <code>generalize</code> automatically replaces instances of <code>[]</code> with <code>Γ</code></p>",
        "id": 200533314,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1591876186
    },
    {
        "content": "<p>You can also state this explicitly, which I do sometimes when getting the exact induction hypothesis right is more difficult</p>",
        "id": 200533384,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1591876215
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span><code><span class=\"kn\">example</span> <span class=\"o\">{</span><span class=\"n\">p</span> <span class=\"n\">q</span><span class=\"o\">}</span> <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"o\">[]</span> <span class=\"err\">Ω</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"err\">⋀</span> <span class=\"n\">q</span><span class=\"o\">)</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"o\">[]</span> <span class=\"err\">Ω</span> <span class=\"n\">p</span> <span class=\"o\">:=</span>\n<span class=\"k\">begin</span>\n  <span class=\"n\">suffices</span> <span class=\"o\">:</span> <span class=\"bp\">∀</span> <span class=\"err\">Γ</span> <span class=\"n\">A</span> <span class=\"n\">a</span><span class=\"o\">,</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"n\">A</span> <span class=\"n\">a</span> <span class=\"bp\">→</span> <span class=\"n\">p</span> <span class=\"err\">⋀</span> <span class=\"n\">q</span> <span class=\"bp\">=</span> <span class=\"n\">a</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"n\">A</span> <span class=\"n\">p</span><span class=\"o\">,</span>\n  <span class=\"o\">{</span> <span class=\"n\">exact</span> <span class=\"bp\">λ</span> <span class=\"n\">wf</span><span class=\"o\">,</span> <span class=\"n\">this</span> <span class=\"bp\">_</span> <span class=\"bp\">_</span> <span class=\"bp\">_</span> <span class=\"n\">wf</span> <span class=\"n\">rfl</span> <span class=\"o\">},</span>\n  <span class=\"n\">intros</span> <span class=\"err\">Γ</span> <span class=\"n\">A</span> <span class=\"n\">a</span> <span class=\"n\">wf</span><span class=\"o\">,</span>\n  <span class=\"n\">induction</span> <span class=\"n\">wf</span><span class=\"bp\">;</span> <span class=\"n\">rintro</span> <span class=\"bp\">⟨⟩</span><span class=\"o\">,</span>\n  <span class=\"n\">assumption</span>\n<span class=\"kn\">end</span>\n</code></pre></div>",
        "id": 200533565,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1591876342
    },
    {
        "content": "<p>this is the most general and powerful form of induction since you can state the induction hypothesis however you wish</p>",
        "id": 200533664,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1591876421
    },
    {
        "content": "<p>For example in my recent proof <a href=\"https://github.com/leanprover-community/mathlib/blob/5129aed/src/computability/tm_to_partrec.lean\">tm_to_partrec.lean</a> if you search for <code>induction</code> you will find a significant fraction of them are preceded by a <code>suffices</code>, for example in <a href=\"https://leanprover-community.github.io/mathlib_docs/find/turing.partrec_to_TM2.succ_ok/src\">src#turing.partrec_to_TM2.succ_ok</a></p>",
        "id": 200534084,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1591876701
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib/blob/5129aed/src/computability/tm_to_partrec.lean#L224-L235\">Here's</a> another good example</p>",
        "id": 200534176,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1591876790
    },
    {
        "content": "<p>the <code>∀ a b, a + b = n → ...</code> is hard for lean to guess automatically. (Without going into details, we are proving a fact about <code>P n 0</code> by induction given <code>P 0 n</code> and <code>P a b -&gt; P (a+1) (b-1)</code>.)</p>",
        "id": 200534489,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1591876967
    },
    {
        "content": "<p>Cool that looks like a useful practice.</p>",
        "id": 200535193,
        "sender_full_name": "Billy Price",
        "timestamp": 1591877404
    },
    {
        "content": "<p>This bottom lemma is what I'm actually trying to prove - I should be able to prove all cases at once, but there's an \"list.nil = list.nil -&gt;\" in front of all of my inductive hypotheses - can I eliminate them all in one go?</p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"kn\">import</span> <span class=\"n\">tactic</span><span class=\"bp\">.</span><span class=\"n\">interactive</span>\n\n<span class=\"kn\">namespace</span> <span class=\"n\">TT</span>\n<span class=\"kn\">inductive</span> <span class=\"n\">type</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span>\n<span class=\"bp\">|</span> <span class=\"n\">Unit</span> <span class=\"bp\">|</span> <span class=\"n\">Omega</span> <span class=\"bp\">|</span> <span class=\"n\">Prod</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"n\">B</span> <span class=\"o\">:</span> <span class=\"n\">type</span><span class=\"o\">)</span><span class=\"bp\">|</span> <span class=\"n\">Pow</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"o\">:</span> <span class=\"n\">type</span><span class=\"o\">)</span>\n\n<span class=\"kn\">notation</span> <span class=\"bp\">`</span><span class=\"err\">Ω</span><span class=\"bp\">`</span> <span class=\"o\">:=</span> <span class=\"n\">type</span><span class=\"bp\">.</span><span class=\"n\">Omega</span>\n<span class=\"n\">def</span> <span class=\"n\">Unit</span> <span class=\"o\">:=</span> <span class=\"n\">type</span><span class=\"bp\">.</span><span class=\"n\">Unit</span>\n<span class=\"kn\">infix</span> <span class=\"bp\">`××`</span><span class=\"o\">:</span><span class=\"n\">max</span> <span class=\"o\">:=</span> <span class=\"n\">type</span><span class=\"bp\">.</span><span class=\"n\">Prod</span>\n<span class=\"kn\">notation</span> <span class=\"bp\">`</span><span class=\"err\">𝒫</span><span class=\"bp\">`</span><span class=\"n\">A</span> <span class=\"o\">:</span><span class=\"n\">max</span> <span class=\"o\">:=</span> <span class=\"n\">type</span><span class=\"bp\">.</span><span class=\"n\">Pow</span> <span class=\"n\">A</span>\n\n<span class=\"n\">def</span> <span class=\"kn\">context</span> <span class=\"o\">:=</span> <span class=\"n\">list</span> <span class=\"n\">type</span>\n\n<span class=\"kn\">inductive</span> <span class=\"n\">term</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span>\n<span class=\"bp\">|</span> <span class=\"n\">star</span> <span class=\"o\">:</span> <span class=\"n\">term</span>\n<span class=\"bp\">|</span> <span class=\"n\">top</span>  <span class=\"o\">:</span> <span class=\"n\">term</span>\n<span class=\"bp\">|</span> <span class=\"n\">bot</span>  <span class=\"o\">:</span> <span class=\"n\">term</span>\n<span class=\"bp\">|</span> <span class=\"n\">and</span>  <span class=\"o\">:</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">term</span>\n<span class=\"bp\">|</span> <span class=\"n\">or</span>   <span class=\"o\">:</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">term</span>\n<span class=\"bp\">|</span> <span class=\"n\">imp</span>  <span class=\"o\">:</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">term</span>\n<span class=\"bp\">|</span> <span class=\"n\">elem</span> <span class=\"o\">:</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">term</span>\n<span class=\"bp\">|</span> <span class=\"n\">pair</span> <span class=\"o\">:</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">term</span>\n<span class=\"bp\">|</span> <span class=\"n\">var</span>  <span class=\"o\">:</span> <span class=\"bp\">ℕ</span> <span class=\"bp\">→</span> <span class=\"n\">term</span>\n<span class=\"bp\">|</span> <span class=\"n\">comp</span> <span class=\"o\">:</span> <span class=\"n\">type</span> <span class=\"bp\">→</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">term</span>\n<span class=\"bp\">|</span> <span class=\"n\">all</span>  <span class=\"o\">:</span> <span class=\"n\">type</span> <span class=\"bp\">→</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">term</span>\n<span class=\"bp\">|</span> <span class=\"n\">ex</span>   <span class=\"o\">:</span> <span class=\"n\">type</span> <span class=\"bp\">→</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">term</span>\n\n<span class=\"kn\">open</span> <span class=\"n\">term</span>\n\n<span class=\"kn\">notation</span> <span class=\"bp\">`</span><span class=\"mi\">𝟘</span><span class=\"bp\">`</span> <span class=\"o\">:=</span> <span class=\"n\">term</span><span class=\"bp\">.</span><span class=\"n\">var</span> <span class=\"mi\">0</span>\n<span class=\"kn\">notation</span> <span class=\"bp\">`</span><span class=\"mi\">𝟙</span><span class=\"bp\">`</span> <span class=\"o\">:=</span> <span class=\"n\">term</span><span class=\"bp\">.</span><span class=\"n\">var</span> <span class=\"mi\">1</span>\n<span class=\"kn\">notation</span> <span class=\"bp\">`</span><span class=\"mi\">𝟚</span><span class=\"bp\">`</span> <span class=\"o\">:=</span> <span class=\"n\">term</span><span class=\"bp\">.</span><span class=\"n\">var</span> <span class=\"mi\">2</span>\n<span class=\"kn\">notation</span> <span class=\"bp\">`</span><span class=\"mi\">𝟛</span><span class=\"bp\">`</span> <span class=\"o\">:=</span> <span class=\"n\">term</span><span class=\"bp\">.</span><span class=\"n\">var</span> <span class=\"mi\">3</span>\n<span class=\"kn\">notation</span> <span class=\"bp\">`</span><span class=\"mi\">𝟜</span><span class=\"bp\">`</span> <span class=\"o\">:=</span> <span class=\"n\">term</span><span class=\"bp\">.</span><span class=\"n\">var</span> <span class=\"mi\">4</span>\n<span class=\"kn\">notation</span> <span class=\"bp\">`</span><span class=\"mi\">𝟝</span><span class=\"bp\">`</span> <span class=\"o\">:=</span> <span class=\"n\">term</span><span class=\"bp\">.</span><span class=\"n\">var</span> <span class=\"mi\">5</span>\n\n<span class=\"kn\">notation</span> <span class=\"bp\">`</span><span class=\"err\">⁎</span><span class=\"bp\">`</span> <span class=\"o\">:=</span> <span class=\"n\">term</span><span class=\"bp\">.</span><span class=\"n\">star</span>    <span class=\"c1\">-- input \\asterisk</span>\n<span class=\"kn\">notation</span> <span class=\"bp\">`</span><span class=\"err\">⊤</span><span class=\"bp\">`</span> <span class=\"o\">:=</span> <span class=\"n\">term</span><span class=\"bp\">.</span><span class=\"n\">top</span>     <span class=\"c1\">--       \\top</span>\n<span class=\"kn\">notation</span> <span class=\"bp\">`</span><span class=\"err\">⊥</span><span class=\"bp\">`</span> <span class=\"o\">:=</span> <span class=\"n\">term</span><span class=\"bp\">.</span><span class=\"n\">bot</span>     <span class=\"c1\">-- input \\bot</span>\n<span class=\"kn\">infixr</span> <span class=\"bp\">`</span> <span class=\"err\">⟹</span> <span class=\"bp\">`</span><span class=\"o\">:</span><span class=\"mi\">60</span> <span class=\"o\">:=</span> <span class=\"n\">term</span><span class=\"bp\">.</span><span class=\"n\">imp</span> <span class=\"c1\">-- input \\==&gt;</span>\n<span class=\"kn\">infixr</span> <span class=\"bp\">`</span> <span class=\"err\">⋀</span> <span class=\"bp\">`</span> <span class=\"o\">:</span><span class=\"mi\">70</span> <span class=\"o\">:=</span> <span class=\"n\">term</span><span class=\"bp\">.</span><span class=\"n\">and</span> <span class=\"c1\">-- input \\And or \\bigwedge</span>\n<span class=\"kn\">infixr</span> <span class=\"bp\">`</span> <span class=\"err\">⋁</span> <span class=\"bp\">`</span> <span class=\"o\">:</span><span class=\"mi\">59</span> <span class=\"o\">:=</span> <span class=\"n\">term</span><span class=\"bp\">.</span><span class=\"n\">or</span>  <span class=\"c1\">-- input \\Or or \\bigvee</span>\n\n<span class=\"kn\">infix</span> <span class=\"err\">∈</span> <span class=\"o\">:=</span> <span class=\"n\">term</span><span class=\"bp\">.</span><span class=\"n\">elem</span>\n<span class=\"kn\">infix</span> <span class=\"err\">∉</span> <span class=\"o\">:=</span> <span class=\"bp\">λ</span> <span class=\"n\">a</span> <span class=\"n\">α</span><span class=\"o\">,</span> <span class=\"n\">not</span> <span class=\"o\">(</span><span class=\"n\">term</span><span class=\"bp\">.</span><span class=\"n\">elem</span> <span class=\"n\">a</span> <span class=\"n\">α</span><span class=\"o\">)</span>\n<span class=\"kn\">notation</span> <span class=\"bp\">`</span><span class=\"err\">⟦</span> <span class=\"bp\">`</span> <span class=\"n\">A</span> <span class=\"bp\">`</span> <span class=\"bp\">|</span> <span class=\"bp\">`</span> <span class=\"n\">φ</span> <span class=\"bp\">`</span> <span class=\"err\">⟧</span><span class=\"bp\">`</span> <span class=\"o\">:=</span> <span class=\"n\">term</span><span class=\"bp\">.</span><span class=\"n\">comp</span> <span class=\"n\">A</span> <span class=\"n\">φ</span>\n\n<span class=\"kn\">notation</span> <span class=\"bp\">`</span><span class=\"err\">⟪</span><span class=\"bp\">`</span> <span class=\"n\">a</span> <span class=\"bp\">`</span><span class=\"o\">,</span><span class=\"bp\">`</span> <span class=\"n\">b</span> <span class=\"bp\">`</span><span class=\"err\">⟫</span><span class=\"bp\">`</span> <span class=\"o\">:=</span> <span class=\"n\">term</span><span class=\"bp\">.</span><span class=\"n\">pair</span> <span class=\"n\">a</span> <span class=\"n\">b</span>\n\n<span class=\"kn\">notation</span> <span class=\"bp\">`∀</span><span class=\"err\">&#39;</span><span class=\"bp\">`</span> <span class=\"o\">:=</span> <span class=\"n\">term</span><span class=\"bp\">.</span><span class=\"n\">all</span>\n<span class=\"kn\">notation</span> <span class=\"bp\">`∃</span><span class=\"err\">&#39;</span><span class=\"bp\">`</span> <span class=\"o\">:=</span> <span class=\"n\">term</span><span class=\"bp\">.</span><span class=\"n\">ex</span>\n\n<span class=\"kn\">inductive</span> <span class=\"n\">WF</span> <span class=\"o\">:</span> <span class=\"kn\">context</span> <span class=\"bp\">→</span> <span class=\"n\">type</span> <span class=\"bp\">→</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"kt\">Prop</span>\n<span class=\"bp\">|</span> <span class=\"n\">star</span> <span class=\"o\">{</span><span class=\"err\">Γ</span><span class=\"o\">}</span>         <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"n\">Unit</span> <span class=\"err\">⁎</span>\n<span class=\"bp\">|</span> <span class=\"n\">top</span>  <span class=\"o\">{</span><span class=\"err\">Γ</span><span class=\"o\">}</span>         <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"err\">⊤</span>\n<span class=\"bp\">|</span> <span class=\"n\">bot</span>  <span class=\"o\">{</span><span class=\"err\">Γ</span><span class=\"o\">}</span>         <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"err\">⊥</span>\n<span class=\"bp\">|</span> <span class=\"n\">and</span>  <span class=\"o\">{</span><span class=\"err\">Γ</span> <span class=\"n\">p</span> <span class=\"n\">q</span><span class=\"o\">}</span>     <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"n\">p</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"n\">q</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"err\">⋀</span> <span class=\"n\">q</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"n\">or</span>   <span class=\"o\">{</span><span class=\"err\">Γ</span> <span class=\"n\">p</span> <span class=\"n\">q</span><span class=\"o\">}</span>     <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"n\">p</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"n\">q</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"err\">⋁</span> <span class=\"n\">q</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"n\">imp</span>  <span class=\"o\">{</span><span class=\"err\">Γ</span> <span class=\"n\">p</span> <span class=\"n\">q</span><span class=\"o\">}</span>     <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"n\">p</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"n\">q</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"err\">⟹</span> <span class=\"n\">q</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"n\">elem</span> <span class=\"o\">{</span><span class=\"err\">Γ</span> <span class=\"n\">A</span> <span class=\"n\">a</span> <span class=\"n\">α</span><span class=\"o\">}</span>   <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"n\">A</span> <span class=\"n\">a</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"o\">(</span><span class=\"err\">𝒫</span> <span class=\"n\">A</span><span class=\"o\">)</span> <span class=\"n\">α</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"o\">(</span><span class=\"n\">a</span> <span class=\"err\">∈</span> <span class=\"n\">α</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"n\">pair</span> <span class=\"o\">{</span><span class=\"err\">Γ</span> <span class=\"n\">A</span> <span class=\"n\">B</span> <span class=\"n\">a</span> <span class=\"n\">b</span><span class=\"o\">}</span> <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"n\">A</span> <span class=\"n\">a</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"n\">B</span> <span class=\"n\">b</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"bp\">××</span> <span class=\"n\">B</span><span class=\"o\">)</span> <span class=\"err\">⟪</span><span class=\"n\">a</span><span class=\"o\">,</span><span class=\"n\">b</span><span class=\"err\">⟫</span>\n<span class=\"bp\">|</span> <span class=\"n\">var</span>  <span class=\"o\">{</span><span class=\"err\">Γ</span> <span class=\"n\">A</span> <span class=\"n\">n</span><span class=\"o\">}</span>     <span class=\"o\">:</span> <span class=\"n\">list</span><span class=\"bp\">.</span><span class=\"n\">nth</span> <span class=\"err\">Γ</span> <span class=\"n\">n</span> <span class=\"bp\">=</span> <span class=\"n\">some</span> <span class=\"n\">A</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"n\">A</span> <span class=\"o\">(</span><span class=\"n\">var</span> <span class=\"n\">n</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"n\">comp</span> <span class=\"o\">{</span><span class=\"err\">Γ</span> <span class=\"n\">A</span> <span class=\"n\">φ</span><span class=\"o\">}</span>     <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"o\">(</span><span class=\"n\">A</span><span class=\"bp\">::</span><span class=\"err\">Γ</span><span class=\"o\">)</span> <span class=\"err\">Ω</span> <span class=\"n\">φ</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"o\">(</span><span class=\"err\">𝒫</span> <span class=\"n\">A</span><span class=\"o\">)</span> <span class=\"err\">⟦</span><span class=\"n\">A</span> <span class=\"bp\">|</span> <span class=\"n\">φ</span><span class=\"err\">⟧</span>\n<span class=\"bp\">|</span> <span class=\"n\">all</span>  <span class=\"o\">{</span><span class=\"err\">Γ</span> <span class=\"n\">A</span> <span class=\"n\">φ</span><span class=\"o\">}</span>     <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"o\">(</span><span class=\"n\">A</span><span class=\"bp\">::</span><span class=\"err\">Γ</span><span class=\"o\">)</span> <span class=\"err\">Ω</span> <span class=\"n\">φ</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"o\">(</span><span class=\"bp\">∀</span><span class=\"err\">&#39;</span> <span class=\"n\">A</span> <span class=\"n\">φ</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"n\">ex</span>   <span class=\"o\">{</span><span class=\"err\">Γ</span> <span class=\"n\">A</span> <span class=\"n\">φ</span><span class=\"o\">}</span>     <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"o\">(</span><span class=\"n\">A</span><span class=\"bp\">::</span><span class=\"err\">Γ</span><span class=\"o\">)</span> <span class=\"err\">Ω</span> <span class=\"n\">φ</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"o\">(</span><span class=\"bp\">∃</span><span class=\"err\">&#39;</span> <span class=\"n\">A</span> <span class=\"n\">φ</span><span class=\"o\">)</span>\n\n<span class=\"kn\">section</span> <span class=\"n\">substitution</span>\n\n  <span class=\"bp\">@</span><span class=\"o\">[</span><span class=\"n\">simp</span><span class=\"o\">]</span>\n  <span class=\"n\">def</span> <span class=\"n\">lift_d</span> <span class=\"o\">(</span><span class=\"n\">d</span> <span class=\"o\">:</span> <span class=\"bp\">ℕ</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"bp\">ℕ</span> <span class=\"bp\">→</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">term</span>\n  <span class=\"bp\">|</span> <span class=\"n\">k</span> <span class=\"err\">⁎</span>          <span class=\"o\">:=</span> <span class=\"err\">⁎</span>\n  <span class=\"bp\">|</span> <span class=\"n\">k</span> <span class=\"err\">⊤</span>          <span class=\"o\">:=</span> <span class=\"err\">⊤</span>\n  <span class=\"bp\">|</span> <span class=\"n\">k</span> <span class=\"err\">⊥</span>          <span class=\"o\">:=</span> <span class=\"err\">⊥</span>\n  <span class=\"bp\">|</span> <span class=\"n\">k</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"err\">⋀</span> <span class=\"n\">q</span><span class=\"o\">)</span>    <span class=\"o\">:=</span> <span class=\"o\">(</span><span class=\"n\">lift_d</span> <span class=\"n\">k</span> <span class=\"n\">p</span><span class=\"o\">)</span> <span class=\"err\">⋀</span> <span class=\"o\">(</span><span class=\"n\">lift_d</span> <span class=\"n\">k</span> <span class=\"n\">q</span><span class=\"o\">)</span>\n  <span class=\"bp\">|</span> <span class=\"n\">k</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"err\">⋁</span> <span class=\"n\">q</span><span class=\"o\">)</span>    <span class=\"o\">:=</span> <span class=\"o\">(</span><span class=\"n\">lift_d</span> <span class=\"n\">k</span> <span class=\"n\">p</span><span class=\"o\">)</span> <span class=\"err\">⋁</span> <span class=\"o\">(</span><span class=\"n\">lift_d</span> <span class=\"n\">k</span> <span class=\"n\">q</span><span class=\"o\">)</span>\n  <span class=\"bp\">|</span> <span class=\"n\">k</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"err\">⟹</span> <span class=\"n\">q</span><span class=\"o\">)</span>   <span class=\"o\">:=</span> <span class=\"o\">(</span><span class=\"n\">lift_d</span> <span class=\"n\">k</span> <span class=\"n\">p</span><span class=\"o\">)</span> <span class=\"err\">⟹</span> <span class=\"o\">(</span><span class=\"n\">lift_d</span> <span class=\"n\">k</span> <span class=\"n\">q</span><span class=\"o\">)</span>\n  <span class=\"bp\">|</span> <span class=\"n\">k</span> <span class=\"o\">(</span><span class=\"n\">a</span> <span class=\"err\">∈</span> <span class=\"n\">α</span><span class=\"o\">)</span>    <span class=\"o\">:=</span> <span class=\"o\">(</span><span class=\"n\">lift_d</span> <span class=\"n\">k</span> <span class=\"n\">a</span><span class=\"o\">)</span> <span class=\"err\">∈</span> <span class=\"o\">(</span><span class=\"n\">lift_d</span> <span class=\"n\">k</span> <span class=\"n\">α</span><span class=\"o\">)</span>\n  <span class=\"bp\">|</span> <span class=\"n\">k</span> <span class=\"err\">⟪</span><span class=\"n\">a</span><span class=\"o\">,</span><span class=\"n\">b</span><span class=\"err\">⟫</span>      <span class=\"o\">:=</span> <span class=\"err\">⟪</span><span class=\"n\">lift_d</span> <span class=\"n\">k</span> <span class=\"n\">a</span><span class=\"o\">,</span> <span class=\"n\">lift_d</span> <span class=\"n\">k</span> <span class=\"n\">b</span><span class=\"err\">⟫</span>\n  <span class=\"bp\">|</span> <span class=\"n\">k</span> <span class=\"o\">(</span><span class=\"n\">var</span> <span class=\"n\">m</span><span class=\"o\">)</span>    <span class=\"o\">:=</span> <span class=\"k\">if</span> <span class=\"n\">m</span><span class=\"bp\">≥</span><span class=\"n\">k</span> <span class=\"k\">then</span> <span class=\"n\">var</span> <span class=\"o\">(</span><span class=\"n\">m</span><span class=\"bp\">+</span><span class=\"n\">d</span><span class=\"o\">)</span> <span class=\"k\">else</span> <span class=\"n\">var</span> <span class=\"n\">m</span>\n  <span class=\"bp\">|</span> <span class=\"n\">k</span> <span class=\"err\">⟦</span><span class=\"n\">A</span> <span class=\"bp\">|</span> <span class=\"n\">φ</span><span class=\"err\">⟧</span>     <span class=\"o\">:=</span>   <span class=\"err\">⟦</span><span class=\"n\">A</span> <span class=\"bp\">|</span> <span class=\"n\">lift_d</span> <span class=\"o\">(</span><span class=\"n\">k</span><span class=\"bp\">+</span><span class=\"mi\">1</span><span class=\"o\">)</span> <span class=\"n\">φ</span><span class=\"err\">⟧</span>\n  <span class=\"bp\">|</span> <span class=\"n\">k</span> <span class=\"o\">(</span><span class=\"bp\">∀</span><span class=\"err\">&#39;</span> <span class=\"n\">A</span> <span class=\"n\">φ</span><span class=\"o\">)</span>   <span class=\"o\">:=</span> <span class=\"bp\">∀</span><span class=\"err\">&#39;</span> <span class=\"n\">A</span> <span class=\"err\">$</span> <span class=\"n\">lift_d</span> <span class=\"o\">(</span><span class=\"n\">k</span><span class=\"bp\">+</span><span class=\"mi\">1</span><span class=\"o\">)</span> <span class=\"n\">φ</span>\n  <span class=\"bp\">|</span> <span class=\"n\">k</span> <span class=\"o\">(</span><span class=\"bp\">∃</span><span class=\"err\">&#39;</span> <span class=\"n\">A</span> <span class=\"n\">φ</span><span class=\"o\">)</span>   <span class=\"o\">:=</span> <span class=\"bp\">∃</span><span class=\"err\">&#39;</span> <span class=\"n\">A</span> <span class=\"err\">$</span> <span class=\"n\">lift_d</span> <span class=\"o\">(</span><span class=\"n\">k</span><span class=\"bp\">+</span><span class=\"mi\">1</span><span class=\"o\">)</span> <span class=\"n\">φ</span>\n\n  <span class=\"bp\">@</span><span class=\"o\">[</span><span class=\"n\">simp</span><span class=\"o\">]</span>\n  <span class=\"n\">def</span> <span class=\"n\">lift</span> <span class=\"o\">:=</span> <span class=\"n\">lift_d</span> <span class=\"mi\">1</span> <span class=\"mi\">0</span>\n\n  <span class=\"bp\">@</span><span class=\"o\">[</span><span class=\"n\">simp</span><span class=\"o\">]</span>\n  <span class=\"n\">def</span> <span class=\"n\">subst</span> <span class=\"o\">:</span> <span class=\"bp\">ℕ</span> <span class=\"bp\">→</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">term</span>\n  <span class=\"bp\">|</span> <span class=\"n\">n</span> <span class=\"n\">x</span> <span class=\"err\">⁎</span>          <span class=\"o\">:=</span> <span class=\"err\">⁎</span>\n  <span class=\"bp\">|</span> <span class=\"n\">n</span> <span class=\"n\">x</span> <span class=\"err\">⊤</span>          <span class=\"o\">:=</span> <span class=\"err\">⊤</span>\n  <span class=\"bp\">|</span> <span class=\"n\">n</span> <span class=\"n\">x</span> <span class=\"err\">⊥</span>          <span class=\"o\">:=</span> <span class=\"err\">⊥</span>\n  <span class=\"bp\">|</span> <span class=\"n\">n</span> <span class=\"n\">x</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"err\">⋀</span> <span class=\"n\">q</span><span class=\"o\">)</span>    <span class=\"o\">:=</span> <span class=\"o\">(</span><span class=\"n\">subst</span> <span class=\"n\">n</span> <span class=\"n\">x</span> <span class=\"n\">p</span><span class=\"o\">)</span> <span class=\"err\">⋀</span> <span class=\"o\">(</span><span class=\"n\">subst</span> <span class=\"n\">n</span> <span class=\"n\">x</span> <span class=\"n\">q</span><span class=\"o\">)</span>\n  <span class=\"bp\">|</span> <span class=\"n\">n</span> <span class=\"n\">x</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"err\">⋁</span> <span class=\"n\">q</span><span class=\"o\">)</span>    <span class=\"o\">:=</span> <span class=\"o\">(</span><span class=\"n\">subst</span> <span class=\"n\">n</span> <span class=\"n\">x</span> <span class=\"n\">p</span><span class=\"o\">)</span> <span class=\"err\">⋁</span> <span class=\"o\">(</span><span class=\"n\">subst</span> <span class=\"n\">n</span> <span class=\"n\">x</span> <span class=\"n\">q</span><span class=\"o\">)</span>\n  <span class=\"bp\">|</span> <span class=\"n\">n</span> <span class=\"n\">x</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"err\">⟹</span> <span class=\"n\">q</span><span class=\"o\">)</span>  <span class=\"o\">:=</span> <span class=\"o\">(</span><span class=\"n\">subst</span> <span class=\"n\">n</span> <span class=\"n\">x</span> <span class=\"n\">p</span><span class=\"o\">)</span> <span class=\"err\">⟹</span> <span class=\"o\">(</span><span class=\"n\">subst</span> <span class=\"n\">n</span> <span class=\"n\">x</span> <span class=\"n\">q</span><span class=\"o\">)</span>\n  <span class=\"bp\">|</span> <span class=\"n\">n</span> <span class=\"n\">x</span> <span class=\"o\">(</span><span class=\"n\">a</span> <span class=\"err\">∈</span> <span class=\"n\">α</span><span class=\"o\">)</span>    <span class=\"o\">:=</span> <span class=\"o\">(</span><span class=\"n\">subst</span> <span class=\"n\">n</span> <span class=\"n\">x</span> <span class=\"n\">a</span><span class=\"o\">)</span> <span class=\"err\">∈</span> <span class=\"o\">(</span><span class=\"n\">subst</span> <span class=\"n\">n</span> <span class=\"n\">x</span> <span class=\"n\">α</span><span class=\"o\">)</span>\n  <span class=\"bp\">|</span> <span class=\"n\">n</span> <span class=\"n\">x</span> <span class=\"err\">⟪</span><span class=\"n\">a</span><span class=\"o\">,</span><span class=\"n\">c</span><span class=\"err\">⟫</span>      <span class=\"o\">:=</span> <span class=\"err\">⟪</span><span class=\"n\">subst</span> <span class=\"n\">n</span> <span class=\"n\">x</span> <span class=\"n\">a</span><span class=\"o\">,</span> <span class=\"n\">subst</span> <span class=\"n\">n</span> <span class=\"n\">x</span> <span class=\"n\">c</span><span class=\"err\">⟫</span>\n  <span class=\"bp\">|</span> <span class=\"n\">n</span> <span class=\"n\">x</span> <span class=\"o\">(</span><span class=\"n\">var</span> <span class=\"n\">m</span><span class=\"o\">)</span>    <span class=\"o\">:=</span> <span class=\"k\">if</span> <span class=\"n\">n</span><span class=\"bp\">=</span><span class=\"n\">m</span> <span class=\"k\">then</span> <span class=\"n\">x</span> <span class=\"k\">else</span> <span class=\"n\">var</span> <span class=\"n\">m</span>\n  <span class=\"bp\">|</span> <span class=\"n\">n</span> <span class=\"n\">x</span> <span class=\"err\">⟦</span> <span class=\"n\">A</span> <span class=\"bp\">|</span> <span class=\"n\">φ</span> <span class=\"err\">⟧</span>   <span class=\"o\">:=</span>    <span class=\"err\">⟦</span><span class=\"n\">A</span> <span class=\"bp\">|</span> <span class=\"n\">subst</span> <span class=\"o\">(</span><span class=\"n\">n</span><span class=\"bp\">+</span><span class=\"mi\">1</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">lift</span> <span class=\"n\">x</span><span class=\"o\">)</span> <span class=\"n\">φ</span><span class=\"err\">⟧</span>\n  <span class=\"bp\">|</span> <span class=\"n\">n</span> <span class=\"n\">x</span> <span class=\"o\">(</span><span class=\"bp\">∀</span><span class=\"err\">&#39;</span> <span class=\"n\">A</span> <span class=\"n\">φ</span><span class=\"o\">)</span>     <span class=\"o\">:=</span> <span class=\"bp\">∀</span><span class=\"err\">&#39;</span> <span class=\"n\">A</span> <span class=\"o\">(</span><span class=\"n\">subst</span> <span class=\"o\">(</span><span class=\"n\">n</span><span class=\"bp\">+</span><span class=\"mi\">1</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">lift</span> <span class=\"n\">x</span><span class=\"o\">)</span> <span class=\"n\">φ</span><span class=\"o\">)</span>\n  <span class=\"bp\">|</span> <span class=\"n\">n</span> <span class=\"n\">x</span> <span class=\"o\">(</span><span class=\"bp\">∃</span><span class=\"err\">&#39;</span> <span class=\"n\">A</span> <span class=\"n\">φ</span><span class=\"o\">)</span>     <span class=\"o\">:=</span> <span class=\"bp\">∃</span><span class=\"err\">&#39;</span> <span class=\"n\">A</span> <span class=\"o\">(</span><span class=\"n\">subst</span> <span class=\"o\">(</span><span class=\"n\">n</span><span class=\"bp\">+</span><span class=\"mi\">1</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">lift</span> <span class=\"n\">x</span><span class=\"o\">)</span> <span class=\"n\">φ</span><span class=\"o\">)</span>\n\n  <span class=\"kn\">notation</span>  <span class=\"bp\">`</span><span class=\"err\">⁅</span><span class=\"bp\">`</span> <span class=\"n\">φ</span> <span class=\"bp\">`</span> <span class=\"bp\">//</span> <span class=\"bp\">`</span>  <span class=\"n\">b</span> <span class=\"bp\">`</span><span class=\"err\">⁆</span><span class=\"bp\">`</span> <span class=\"o\">:=</span> <span class=\"n\">subst</span> <span class=\"mi\">0</span> <span class=\"n\">b</span> <span class=\"n\">φ</span>\n\n  <span class=\"bp\">#</span><span class=\"n\">reduce</span> <span class=\"err\">⁅</span><span class=\"mi\">𝟘</span> <span class=\"bp\">//</span> <span class=\"err\">⊤</span> <span class=\"err\">⋀</span> <span class=\"err\">⊥⁆</span>\n  <span class=\"bp\">#</span><span class=\"n\">reduce</span> <span class=\"err\">⁅</span> <span class=\"mi\">𝟙</span> <span class=\"bp\">//</span> <span class=\"err\">⊤</span> <span class=\"err\">⋀</span> <span class=\"err\">⊥⁆</span>\n\n<span class=\"kn\">end</span> <span class=\"n\">substitution</span>\n\n<span class=\"kn\">lemma</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">lift_closed</span> <span class=\"o\">{</span><span class=\"n\">a</span> <span class=\"n\">A</span><span class=\"o\">}</span> <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"o\">[]</span> <span class=\"n\">A</span> <span class=\"n\">a</span> <span class=\"bp\">→</span> <span class=\"n\">a</span> <span class=\"bp\">=</span> <span class=\"n\">lift</span> <span class=\"n\">a</span> <span class=\"o\">:=</span>\n<span class=\"k\">begin</span>\n  <span class=\"n\">generalize_hyp</span> <span class=\"n\">e</span> <span class=\"o\">:</span> <span class=\"o\">[]</span> <span class=\"bp\">=</span> <span class=\"err\">Γ</span><span class=\"o\">,</span>\n  <span class=\"n\">intro</span> <span class=\"n\">wf</span><span class=\"o\">,</span>\n  <span class=\"n\">induction</span> <span class=\"n\">wf</span><span class=\"bp\">;</span><span class=\"n\">cases</span> <span class=\"n\">e</span><span class=\"bp\">;</span><span class=\"n\">simp</span><span class=\"o\">,</span>\n<span class=\"kn\">end</span>\n\n<span class=\"kn\">end</span> <span class=\"n\">TT</span>\n</code></pre></div>",
        "id": 200535749,
        "sender_full_name": "Billy Price",
        "timestamp": 1591877775
    },
    {
        "content": "<p>You will need a stronger inductive hypothesis</p>",
        "id": 200536221,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1591878099
    },
    {
        "content": "<p><code>simp</code> will do a lot of the work here, although it doesn't like that you wrote the equality the wrong way around</p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"kn\">lemma</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">lift_closed</span> <span class=\"o\">{</span><span class=\"n\">a</span> <span class=\"n\">A</span><span class=\"o\">}</span> <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"o\">[]</span> <span class=\"n\">A</span> <span class=\"n\">a</span> <span class=\"bp\">→</span> <span class=\"n\">lift</span> <span class=\"n\">a</span> <span class=\"bp\">=</span> <span class=\"n\">a</span> <span class=\"o\">:=</span>\n<span class=\"k\">begin</span>\n  <span class=\"n\">generalize_hyp</span> <span class=\"n\">e</span> <span class=\"o\">:</span> <span class=\"o\">[]</span> <span class=\"bp\">=</span> <span class=\"err\">Γ</span><span class=\"o\">,</span>\n  <span class=\"n\">intro</span> <span class=\"n\">wf</span><span class=\"o\">,</span>\n  <span class=\"n\">induction</span> <span class=\"n\">wf</span><span class=\"bp\">;</span><span class=\"n\">cases</span> <span class=\"n\">e</span><span class=\"bp\">;</span><span class=\"n\">simp</span> <span class=\"bp\">*</span> <span class=\"n\">at</span> <span class=\"bp\">*</span><span class=\"o\">,</span>\n\n<span class=\"kn\">end</span>\n</code></pre></div>",
        "id": 200536468,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1591878245
    },
    {
        "content": "<p>What do the stars do?</p>",
        "id": 200536604,
        "sender_full_name": "Billy Price",
        "timestamp": 1591878336
    },
    {
        "content": "<p>they make the sky more beautiful</p>",
        "id": 200536668,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1591878363
    },
    {
        "content": "<p>Hahaha, oh I found the docs explaining what they are too</p>",
        "id": 200536760,
        "sender_full_name": "Billy Price",
        "timestamp": 1591878407
    },
    {
        "content": "<p>Lemme guess, I need to be proving the strong lemma which says \"if the highest free variable is below the lift-cutoff, then <code>lift a = a</code>\"</p>",
        "id": 200537029,
        "sender_full_name": "Billy Price",
        "timestamp": 1591878553
    },
    {
        "content": "<p>Indeed. I believe the most similar statement to what you have here that will do the job is <code>WF G A a → length G &lt;= k -&gt; lift_d 1 k a = a</code></p>",
        "id": 200537202,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1591878644
    },
    {
        "content": "<p>This is an interesting pattern - the most \"appropriately general\" statement of a theorem is typically easier to prove than specialisations of that theorem. Is this specific to inductive proofs or formal proofs in general?</p>",
        "id": 200537737,
        "sender_full_name": "Billy Price",
        "timestamp": 1591878964
    },
    {
        "content": "<p>this is pretty common of inductive proofs</p>",
        "id": 200538007,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1591879144
    },
    {
        "content": "<p>the examples I showed earlier were also of that form - I said that I wanted to prove something about <code>P n 0</code> but the obvious inductive proof would try to show <code>P 0 0</code> and <code>P a 0 -&gt; P (a+1) 0</code> which doesn't work</p>",
        "id": 200538180,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1591879228
    },
    {
        "content": "<p>induction proofs can vary a lot in their dependency structure, so the easiest reliable way to make lean do what you want is to say what you want</p>",
        "id": 200538278,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1591879279
    },
    {
        "content": "<p>(unfortunately this is also quite verbose so I usually use it as a last resort when basic <code>induction</code> doesn't do the right thing)</p>",
        "id": 200538330,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1591879317
    },
    {
        "content": "<p>You're referring to the suffices pattern?</p>",
        "id": 200538331,
        "sender_full_name": "Billy Price",
        "timestamp": 1591879318
    },
    {
        "content": "<p>yes</p>",
        "id": 200538344,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1591879321
    },
    {
        "content": "<p>You could use it here too</p>",
        "id": 200538390,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1591879327
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span><code><span class=\"kn\">lemma</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">lift_closed</span> <span class=\"o\">{</span><span class=\"n\">a</span> <span class=\"n\">A</span><span class=\"o\">}</span> <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"o\">[]</span> <span class=\"n\">A</span> <span class=\"n\">a</span> <span class=\"bp\">→</span> <span class=\"n\">lift</span> <span class=\"n\">a</span> <span class=\"bp\">=</span> <span class=\"n\">a</span> <span class=\"o\">:=</span>\n<span class=\"k\">begin</span>\n  <span class=\"n\">suffices</span> <span class=\"o\">:</span> <span class=\"bp\">∀</span> <span class=\"n\">G</span> <span class=\"n\">A</span> <span class=\"n\">a</span><span class=\"o\">,</span> <span class=\"n\">WF</span> <span class=\"n\">G</span> <span class=\"n\">A</span> <span class=\"n\">a</span> <span class=\"bp\">→</span> <span class=\"n\">lift_d</span> <span class=\"mi\">1</span> <span class=\"o\">(</span><span class=\"n\">list</span><span class=\"bp\">.</span><span class=\"n\">length</span> <span class=\"n\">G</span><span class=\"o\">)</span> <span class=\"n\">a</span> <span class=\"bp\">=</span> <span class=\"n\">a</span><span class=\"o\">,</span>\n  <span class=\"o\">{</span> <span class=\"n\">exact</span> <span class=\"n\">this</span> <span class=\"bp\">_</span> <span class=\"bp\">_</span> <span class=\"bp\">_</span> <span class=\"o\">},</span>\n  <span class=\"n\">introv</span> <span class=\"n\">wf</span><span class=\"o\">,</span>\n  <span class=\"n\">induction</span> <span class=\"n\">wf</span><span class=\"bp\">;</span> <span class=\"n\">simp</span> <span class=\"bp\">*</span> <span class=\"n\">at</span> <span class=\"bp\">*</span><span class=\"o\">,</span>\n  <span class=\"n\">exact</span> <span class=\"n\">if_neg</span> <span class=\"o\">(</span><span class=\"n\">not_le_of_gt</span> <span class=\"o\">(</span><span class=\"n\">list</span><span class=\"bp\">.</span><span class=\"n\">nth_eq_some</span><span class=\"bp\">.</span><span class=\"mi\">1</span> <span class=\"n\">wf_a</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">fst</span><span class=\"o\">)</span>\n<span class=\"kn\">end</span>\n</code></pre></div>",
        "id": 200538704,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1591879514
    },
    {
        "content": "<p>So I've been doing all of this stuff for a 1 semester project (I convinced a mathematician at my uni to supervise me for a project in Lean), and I'm going to be ending it on \"here's a statement in Lean that says this type theory forms a category\". Once the semester is over (very soon) I want to go back to the basics of Lean so I'm better equipped to actual prove all the theorems</p>\n<p>From what you've seen from me, is there any particular ways you'd recommend learning the relevant intricacies of Lean I need to understand how to do my proofs? Do the mathematics tutorials (NNG, Real Number Game etc) cover the same stuff but on different topics? Should I keep posting \"how do I do this proof\" whenever I get to a new roadblock? Usually the easiest answer (like this time) is just \"here's the proof\" and I feel bad that I'm just constantly getting other people to do my work for me. Thoughts?</p>",
        "id": 200540330,
        "sender_full_name": "Billy Price",
        "timestamp": 1591880423
    },
    {
        "content": "<p>the point isn't \"here's the proof\", it is \"here's a technique for solving problems of this kind\"</p>",
        "id": 200541640,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1591881078
    },
    {
        "content": "<p>don't worry about my having \"stolen\" a proof from you, trust me there are more than enough proof obligations to go around</p>",
        "id": 200541695,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1591881118
    },
    {
        "content": "<p>For a type theory category, I suggest jumping into the formalization and asking questions when you don't know how to express something</p>",
        "id": 200541978,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1591881245
    },
    {
        "content": "<p>My sense is that it should not be too difficult to write something down that vaguely resembles your goal statement. There will then be some rearranging and fixing of the definition to make it amenable to proof stuff</p>",
        "id": 200542088,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1591881303
    },
    {
        "content": "<p>For the first pass, figure out what a category is: if you intend to use mathlib categories, then study the mathlib definition of a category, or if you plan to write your own then figure out how to make that definition. You said something about quotienting by equivalence, so figure out how to write down a quotient and specify functions on quotients. Don't concern yourself with proofs too much, but try not to write something that you know is false</p>",
        "id": 200542334,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1591881441
    },
    {
        "content": "<p>I think the best way to learn about intricacies of lean is to trip over them on your way to getting something done</p>",
        "id": 200542453,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1591881507
    },
    {
        "content": "<p>Thanks, that's good to hear. My concern is less about intellectual property (though that's important), and more about using up your time!</p>\n<p>At a basic level, I do understand how to define a math lib category and I feel somewhat comfortable with quotient stuff (I've followed the Zmod37 example and created my own quotient type), but one of my roadblocks there is how to say the following theorem (which I hope is true), \"If I have a <code>proof Γ p q</code> and either of <code>p</code> or <code>q</code> contains some <code>a : term</code> which is well-formed of type A (<code>WF Γ A a</code>), and <code>a</code> is provably equal to <code>a'</code> (I can show <code>proof Γ ⊤ a ≃[A] a'</code>), then I can swap out occurrences of <code>a</code> with <code>a'</code>. I think that would help me a lot with lifting things to the quotients.</p>",
        "id": 200543320,
        "sender_full_name": "Billy Price",
        "timestamp": 1591881974
    },
    {
        "content": "<p>ah whoops sent too soon, I'll edit it (done)</p>",
        "id": 200543348,
        "sender_full_name": "Billy Price",
        "timestamp": 1591881991
    },
    {
        "content": "<p>Here's an attempt which I'm worried is too general and false.</p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"kn\">theorem</span> <span class=\"n\">eq_sound</span> <span class=\"o\">{</span><span class=\"err\">Γ</span><span class=\"o\">}</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"o\">:</span> <span class=\"n\">type</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">a₁</span> <span class=\"n\">a₂</span> <span class=\"o\">:</span> <span class=\"n\">term</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">eq</span> <span class=\"o\">:</span> <span class=\"k\">proof</span> <span class=\"err\">Γ</span> <span class=\"err\">⊤</span> <span class=\"o\">(</span><span class=\"n\">a₁</span> <span class=\"err\">≃</span><span class=\"o\">[</span><span class=\"n\">A</span><span class=\"o\">]</span> <span class=\"n\">a₂</span><span class=\"o\">))</span> <span class=\"o\">(</span><span class=\"n\">f</span> <span class=\"n\">g</span> <span class=\"o\">:</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">term</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"k\">proof</span> <span class=\"err\">Γ</span> <span class=\"o\">(</span><span class=\"n\">f</span> <span class=\"n\">a₁</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">g</span> <span class=\"n\">a₁</span><span class=\"o\">)</span> <span class=\"bp\">→</span> <span class=\"k\">proof</span> <span class=\"err\">Γ</span> <span class=\"o\">(</span><span class=\"n\">f</span> <span class=\"n\">a₂</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">g</span> <span class=\"n\">a₂</span><span class=\"o\">)</span>\n</code></pre></div>\n\n\n<p>(made it a <code>theorem</code> because wew, it looks powerful.)</p>",
        "id": 200544707,
        "sender_full_name": "Billy Price",
        "timestamp": 1591882640
    },
    {
        "content": "<p>yeah that version is false</p>",
        "id": 200544907,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1591882714
    },
    {
        "content": "<p>Good to know</p>",
        "id": 200545001,
        "sender_full_name": "Billy Price",
        "timestamp": 1591882753
    },
    {
        "content": "<p>Do you have a substitution operator? If so you can express that <code>t[a1/x] = t[a2/x]</code> is provable</p>",
        "id": 200545035,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1591882771
    },
    {
        "content": "<p>You can also define a subset of functions <code>term -&gt; term</code> according to whether they respect equality. The theorem holds for such functions more or less by definition, but the interesting observation is that all the term constructors are examples of such functions</p>",
        "id": 200545555,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1591883028
    },
    {
        "content": "<p>I actually tried that substitution method but I found it difficult to apply it. Thinking about the second option - that sounds like you could inductively define all such functions based on the term constructors?</p>",
        "id": 200546839,
        "sender_full_name": "Billy Price",
        "timestamp": 1591883626
    },
    {
        "content": "<p>How would one say \"a function which is just some composition of the term constructors?\"</p>",
        "id": 200547019,
        "sender_full_name": "Billy Price",
        "timestamp": 1591883715
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"255481\">@Billy Price</span> I'd be very happy if you could try the current version of my induction tactic. It should take care of all the generalising for you and give less scary names as a bonus. The current draft is at <a href=\"https://github.com/leanprover-community/mathlib/tree/induction\">the induction branch</a>. When you have that, you should be able to <code>import tactic.induction</code> and use <code>induction'</code> instead of the <code>generalize ..., induction</code> dance. I'll gladly fix any bugs you find.</p>",
        "id": 200547215,
        "sender_full_name": "Jannis Limperg",
        "timestamp": 1591883794
    },
    {
        "content": "<p>Oh cool! I will gladly do so :)</p>",
        "id": 200547659,
        "sender_full_name": "Billy Price",
        "timestamp": 1591883978
    },
    {
        "content": "<blockquote>\n<p>How would one say \"a function which is just some composition of the term constructors?\"</p>\n</blockquote>\n<p>Of course the import of the substitution operator is that it is a way to represent such functions using terms</p>",
        "id": 200548231,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1591884216
    },
    {
        "content": "<p>The simpler alternative is just to prove in each individual case that a concretely given function satisfies the equality property by applying equality axioms using e.g. <code>apply_rules</code></p>",
        "id": 200548505,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1591884342
    },
    {
        "content": "<p>What do you mean by the equality axioms?</p>",
        "id": 200549542,
        "sender_full_name": "Billy Price",
        "timestamp": 1591884780
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"255481\">@Billy Price</span> the way to learn the intricacies of Lean is to have a healthy source of projects in your area of interest and then just keep formalising and ask whenever you get stuck. After a few months (maybe it took me a year but I am old and have no CS background) you find that you're asking fewer questions and are in fact now answering them.</p>",
        "id": 200612610,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1591912824
    },
    {
        "content": "<p>Tada I did a proof, I think I better understand the idea of generalising hypotheses in induction now. <span class=\"user-mention\" data-user-id=\"256311\">@Jannis Limperg</span>  I haven't yet switched to the induction branch to try your tactic - how do I do that?</p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"kn\">lemma</span> <span class=\"n\">lift_zero_does_nothing</span> <span class=\"o\">{</span><span class=\"n\">k</span><span class=\"o\">}</span> <span class=\"o\">{</span><span class=\"n\">a</span> <span class=\"o\">:</span> <span class=\"n\">term</span><span class=\"o\">}</span> <span class=\"o\">:</span> <span class=\"n\">lift_d</span> <span class=\"mi\">0</span> <span class=\"n\">k</span> <span class=\"n\">a</span> <span class=\"bp\">=</span> <span class=\"n\">a</span> <span class=\"o\">:=</span>\n<span class=\"k\">begin</span>\n  <span class=\"n\">suffices</span> <span class=\"o\">:</span> <span class=\"bp\">∀</span> <span class=\"n\">k</span><span class=\"o\">,</span> <span class=\"n\">lift_d</span> <span class=\"mi\">0</span> <span class=\"n\">k</span> <span class=\"n\">a</span> <span class=\"bp\">=</span> <span class=\"n\">a</span><span class=\"o\">,</span> <span class=\"o\">{</span> <span class=\"n\">exact</span> <span class=\"n\">this</span> <span class=\"bp\">_</span> <span class=\"o\">},</span>\n  <span class=\"n\">induction</span> <span class=\"n\">a</span><span class=\"bp\">;</span><span class=\"n\">simp</span> <span class=\"bp\">*</span> <span class=\"n\">at</span> <span class=\"bp\">*</span><span class=\"o\">,</span>\n<span class=\"kn\">end</span>\n</code></pre></div>\n\n\n<p>Let me phrase some subtlety I was overlooking before (lemme know if this is the wrong way of thinking about it): Although <code>k</code> is an arbitrary hypothesis to the lemma, within the goal state, it's thought of as fixed. It's a 'given' number. So without the suffices line, the inductive cases must be proved for that fixed <code>k</code>. This seems to highlight the subtle difference between <code>example (k : nat) : P k</code> and <code>example :  ∀ k : nat, P k</code>.</p>",
        "id": 200629225,
        "sender_full_name": "Billy Price",
        "timestamp": 1591928712
    },
    {
        "content": "<p>I could make my original lemma <code>lemma lift_zero_does_nothing {a : term} : ∀ k, lift_d 0 k a = a</code>, but that would make it less usable right?</p>",
        "id": 200629316,
        "sender_full_name": "Billy Price",
        "timestamp": 1591928820
    },
    {
        "content": "<p>More succinct</p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"kn\">lemma</span> <span class=\"n\">lift_zero_does_nothing</span> <span class=\"o\">{</span><span class=\"n\">k</span><span class=\"o\">}</span> <span class=\"o\">{</span><span class=\"n\">a</span> <span class=\"o\">:</span> <span class=\"n\">term</span><span class=\"o\">}</span> <span class=\"o\">:</span> <span class=\"n\">lift_d</span> <span class=\"mi\">0</span> <span class=\"n\">k</span> <span class=\"n\">a</span> <span class=\"bp\">=</span> <span class=\"n\">a</span> <span class=\"o\">:=</span>\n  <span class=\"k\">by</span> <span class=\"n\">induction</span> <span class=\"n\">a</span> <span class=\"n\">generalizing</span> <span class=\"n\">k</span><span class=\"bp\">;</span><span class=\"n\">simp</span> <span class=\"bp\">*</span>\n</code></pre></div>",
        "id": 200629396,
        "sender_full_name": "Billy Price",
        "timestamp": 1591928972
    },
    {
        "content": "<blockquote>\n<p>Although k is an arbitrary hypothesis to the lemma, within the goal state, it's thought of as fixed. It's a 'given' number. So without the suffices line, the inductive cases must be proved for that fixed k. </p>\n</blockquote>\n<p>Yes and no. The <code>induction</code> tactic will generalize the variable <code>k</code>, ignoring the initial value that it had. It's just that when the input was a variable to start with this is no loss (but you will see <code>k</code> hanging around uselessly in the inductive subcases)</p>",
        "id": 200629673,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1591929318
    },
    {
        "content": "<blockquote>\n<p>I could make my original lemma <code>lemma lift_zero_does_nothing {a : term} : ∀ k, lift_d 0 k a = a</code>, but that would make it less usable right?</p>\n</blockquote>\n<p>Externally these are indistinguishable, except that you reordered the two variables and made <code>k</code> explicit in this version</p>",
        "id": 200629755,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1591929408
    },
    {
        "content": "<p>In tactic mode you will always end up intro'ing all variables before the induction, so it makes no difference what is \"right of the colon\". This does affect inductive proofs performed using the equation compiler though (you will not be able to use the equation compiler with the first version)</p>",
        "id": 200629820,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1591929519
    },
    {
        "content": "<p>Oh, correction: since you are doing induction on <code>term</code> in this case, there are no indices and so <code>k</code> will be held fixed unless you explicitly use <code>generalizing</code> to indicate that you want it to change</p>",
        "id": 200629901,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1591929647
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"255481\">Billy Price</span> <a href=\"#narrow/stream/236446-Type-theory/topic/Modelling.20a.20Type.20Theory.20in.20Lean/near/200629225\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"256311\">Jannis Limperg</span>  I haven't yet switched to the induction branch to try your tactic - how do I do that?</p>\n</blockquote>\n<p>Could you post your leanpkg.toml? Alternatively put your project on Github or something, then I'll see what needs to be changed.</p>",
        "id": 200666618,
        "sender_full_name": "Jannis Limperg",
        "timestamp": 1591966807
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"255481\">@Billy Price</span> the answer depends on whether you're working in mathlib or working on your own project and have mathlib as a dependency. If you have mathlib as a dependency then you probably have to edit your project's <code>leanpkg.toml</code>. <span class=\"user-mention\" data-user-id=\"256311\">@Jannis Limperg</span> 's branch is here <a href=\"https://github.com/leanprover-community/mathlib/commits/induction\">https://github.com/leanprover-community/mathlib/commits/induction</a> and the most recent commit is <code>52c995b6ee3ed40c6c962043e8bdd37176a942e3</code> so you want to change your mathlib <code>rev</code> to that commit hash and then do <code>leanproject get-mathlib-cache</code> in the root directory of your project, and it should then all work by magic.</p>",
        "id": 200699109,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1591982743
    },
    {
        "content": "<p>If you're working in mathlib directory then you might be able to just checkout the induction branch and then do <code>leanproject up</code>.</p>",
        "id": 200699306,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1591982837
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110049\">Mario Carneiro</span> <a href=\"#narrow/stream/236446-Type-theory/topic/Modelling.20a.20Type.20Theory.20in.20Lean/near/195564583\">said</a>:</p>\n<blockquote>\n<p>I would recommend keeping the term syntax as context free as possible, and have a well typing condition afterward that can have whatever dependencies it wants</p>\n</blockquote>\n<p>I'm currently reflecting on the decisions I made for the definitions in my type theory, and I'm trying to justify why terms and Well-formedness are defined separately - it seemed that I had to do a lot of work later regarding lemmas to prove well-formedness. Would this have not gone away if I defined only well-formed terms? Are there more obvious reasons why keeping terms context free is valuable?</p>",
        "id": 201230382,
        "sender_full_name": "Billy Price",
        "timestamp": 1592459676
    },
    {
        "content": "<p>If you find yourself manually constructing terms with a proof of well formedness a lot (for example if you are acting like a typechecker and have some concrete terms of interest), then one thing you can do is construct a sigma type of a term and a proof of its well foundedness, and then the construction of the term will be carried out in parallel with the proof of well foundedness. Here a separate WF proof is not particularly helpful. (This is done in the flypitch formalization, for example.)</p>\n<p>The advantage comes when you are doing metatheory, which is usually what people want to do with defined type theories such as this inside lean. (If you just want a typechecker, it is often simpler to just write one directly in a standard programming language, as the many proof assistants for HoTT-based type theories can attest.) Here you really want to be able to do things like reassociate contexts or do other non-defeq manipulations inside the indices to the <code>WF</code> inductive, and then if <code>WF</code> is not a <code>Prop</code> but is rather a dependent type of well formed terms, this will cause no end of headaches due to the induced cast.</p>",
        "id": 201238475,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1592467457
    },
    {
        "content": "<p>I think you've interpreted my question as \"I'm sick of the separation of terms and Well-formedness, so how can I remedy that in the current setup (thanks for the suggestions), but I'm interested in what are the downsides of doing it all in one with <code>term : context -&gt; type -&gt; Type</code>. I think you were answering that in this reply - but could you explain what you mean here about carrying around type state, and what definitional equalities are hard to get?</p>\n<p><span class=\"user-mention silent\" data-user-id=\"110049\">Mario Carneiro</span> <a href=\"#narrow/stream/236446-Type-theory/topic/Modelling.20a.20Type.20Theory.20in.20Lean/near/195565908\">said</a>:</p>\n<blockquote>\n<p>It's easier for them because it's only one type, yes. You end up having to carry around a lot of \"type state\" in real type theories, and it becomes hard to get all the definitional equalities you want</p>\n</blockquote>",
        "id": 201346025,
        "sender_full_name": "Billy Price",
        "timestamp": 1592532624
    },
    {
        "content": "<p>I mean the context and the type</p>",
        "id": 201347368,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1592534823
    },
    {
        "content": "<p>Hard to get definitional equalities are things like <code>Gamma ++ a :: Delta = (Gamma ++ [a]) ++ Delta</code> that come up in proofs</p>",
        "id": 201347422,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1592534884
    },
    {
        "content": "<p>it's even worse when <code>Gamma</code> itself has sequential dependencies as in dependent type theory</p>",
        "id": 201347438,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1592534931
    },
    {
        "content": "<p>If you have a term <code>Gamma ++ a :: Delta |- e : A</code> and want the same term <code>(Gamma ++ [a]) ++ Delta |- e : A</code> you can't do the obvious thing. Instead you have to cast <code>e</code> to the new context, and now it's not a constructor so you can't pattern match on it, and things sort of go downhill from there</p>",
        "id": 201347532,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1592535064
    },
    {
        "content": "<p>It's certainly possible to construct things so that everything beautifully meshes together. But this is like a sudoku puzzle, a quite mind bending exercise that has little relation to the original problem you set out to solve</p>",
        "id": 201347584,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1592535127
    },
    {
        "content": "<p>If you like that sort of thing it's possible to build a career on it but you might find that you've left your original problem behind. (I would argue this is what happened to Voevodsky with HoTT)</p>",
        "id": 201347651,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1592535251
    },
    {
        "content": "<p>If you have extrinsic typing, then you can transport terms to new contexts without apology. All the ugliness is encapsulated in proofs that don't interfere with later statements because of proof irrelevance</p>",
        "id": 201347727,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1592535385
    },
    {
        "content": "<p>Ah okay I think I follow. If we dump the context from the constructor, is the remaining problem just that it's hard to define the <code>var</code> constructor with no context? Or are there still downsides without the var problem?</p>",
        "id": 201348053,
        "sender_full_name": "Billy Price",
        "timestamp": 1592535946
    },
    {
        "content": "<p>I like to think about indices to dependent types as \"rigid variables\". Variables in these positions can only be manipulated in very restrictive ways, essentially by applying constructors and pattern matching. Using functions defined by induction is a no-no</p>",
        "id": 201348174,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1592536158
    },
    {
        "content": "<p>This mostly matches the way we treat types in <em>simple</em> type theory</p>",
        "id": 201348188,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1592536195
    },
    {
        "content": "<p>for example a <code>list A</code> is not the same as a <code>list A'</code> even if <code>A</code>  and <code>A'</code> are extensionally equivalent (have the same elements or some other synthetic notion of equality)</p>",
        "id": 201348245,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1592536243
    },
    {
        "content": "<p>I get what you're saying but I don't see the relevance</p>",
        "id": 201348357,
        "sender_full_name": "Billy Price",
        "timestamp": 1592536428
    },
    {
        "content": "<p>If you take the context out of a term, it just has a type, and presumably the inductive type <code>type</code> is a simple inductive. So this is plausible. But variables have a weird type in this context: you didn't do this but a classically reasonable alternative type for the <code>var</code> constructor would have been <code>var (i : fin (length G)) : term G (G.nth' i)</code> but this is a bad idea in DTT</p>",
        "id": 201348407,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1592536490
    },
    {
        "content": "<p>because it uses inductive functions in rigid positions twice: once in <code>fin (length G)</code> and once in <code>term G (G.nth' i)</code></p>",
        "id": 201348428,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1592536559
    },
    {
        "content": "<p>That's still <code>term : context -&gt; type -&gt; Type</code> though?</p>",
        "id": 201348629,
        "sender_full_name": "Billy Price",
        "timestamp": 1592536882
    },
    {
        "content": "<p>well you can't write <code>var</code> at all without a context</p>",
        "id": 201348698,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1592536979
    },
    {
        "content": "<p>it could be a parameter though</p>",
        "id": 201348701,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1592536989
    },
    {
        "content": "<p>as long as you don't also have binders</p>",
        "id": 201348705,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1592537003
    },
    {
        "content": "<p>parameters to inductive types are also rigid variables, but you usually don't have as pressing a need to change them in the middle of a proof</p>",
        "id": 201348751,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1592537066
    },
    {
        "content": "<p>What do you mean by parameter as opposed to a rigid variable?</p>",
        "id": 201348827,
        "sender_full_name": "Billy Price",
        "timestamp": 1592537200
    },
    {
        "content": "<p>parameters to inductive types meaning left of the colon</p>",
        "id": 201348836,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1592537223
    },
    {
        "content": "<p><code>inductive term (G : context) : type -&gt; Type</code></p>",
        "id": 201348841,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1592537237
    },
    {
        "content": "<p>Then the <code>G</code> in <code>term G A</code> is a rigid variable</p>",
        "id": 201348847,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1592537264
    },
    {
        "content": "<p>One way to conceptualize rigid variables are as terms about which it is common to have equalities, like <code>list.append_assoc</code>, but for which <code>simp</code> refuses to touch and <code>rw</code> gives <code>motive is not type correct</code> when you try to use those equalities</p>",
        "id": 201348914,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1592537377
    },
    {
        "content": "<p>as long as you only ever do syntactic or defeq matching in rigid positions there are no problems</p>",
        "id": 201349029,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1592537528
    },
    {
        "content": "<p>Okay.</p>",
        "id": 201353396,
        "sender_full_name": "Billy Price",
        "timestamp": 1592543912
    },
    {
        "content": "<p>By the way, my type theory as it is, is the \"pure\" version, which is supposed to be extensible. How would I go about defining a type theory which has at least everything I've defined, but maybe more types, more terms, more deduction rules etc? For example, if I wanted to throw in a <code>mynat : type</code> and corresponding terms which are <code>WF [] mynat</code>? I imagine doing so would ruin all the lemmas I've proved. All my lemmas just talk about stuff in the pure type theory, so they should hold in any extension (I imagine there are pathological counterexamples depending on the generality of the lemma).</p>",
        "id": 201353679,
        "sender_full_name": "Billy Price",
        "timestamp": 1592544332
    },
    {
        "content": "<p>Just an idea that probably doesn't work because of cardinality.</p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"kn\">variable</span> <span class=\"err\">\\</span><span class=\"n\">alpha</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span>\n\n<span class=\"kn\">inductive</span> <span class=\"n\">type</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span>\n<span class=\"bp\">|</span> <span class=\"n\">special</span> <span class=\"o\">(</span><span class=\"err\">\\</span><span class=\"n\">alpha</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span><span class=\"o\">)</span> <span class=\"bp\">|</span> <span class=\"n\">Unit</span> <span class=\"bp\">|</span> <span class=\"n\">Omega</span> <span class=\"bp\">|</span> <span class=\"n\">Pow</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"o\">:</span> <span class=\"n\">type</span><span class=\"o\">)</span> <span class=\"bp\">|</span> <span class=\"n\">Prod</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"n\">B</span> <span class=\"o\">:</span> <span class=\"n\">type</span><span class=\"o\">)</span>\n</code></pre></div>",
        "id": 201354093,
        "sender_full_name": "Billy Price",
        "timestamp": 1592544910
    },
    {
        "content": "<p>That works fine</p>",
        "id": 201355255,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1592546334
    },
    {
        "content": "<p>you have to parameterize the whole theory over alpha which is kind of annoying but otherwise it works well</p>",
        "id": 201355279,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1592546369
    },
    {
        "content": "<p>It's also not very pleasant to actually instantiate and get this nested inductive type of types with more types inside</p>",
        "id": 201355296,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1592546401
    },
    {
        "content": "<p>Since you are wondering about universe issues: note that <code>alpha</code> will usually be a small type, for example <code>inductive base_types | nat | bool | real | extra_special (beta : Type)</code> where perhaps beta is yet another parameter</p>",
        "id": 201355523,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1592546651
    },
    {
        "content": "<p>Ah whoops I made \\alpha a variable and a parameter at the same time. I have two possible ideas below, both of which I think are ugly - is there not a more natural way to do this? Instead of taking some other variable Type and incorporating it into my definition, I just say to the user \"give me a Type of things which I will think of as types in my theory, as long Unit, Omega are of that type and the Pow, Prod constructors make new types out of old ones\". I am somewhat ambivalent to whether Unit and Omega are naturally a part of the type of types that the user creates or if they are just tacked on.</p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"kn\">variable</span> <span class=\"err\">\\</span><span class=\"n\">alpha</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span>\n\n<span class=\"kn\">inductive</span> <span class=\"n\">type</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span>\n<span class=\"bp\">|</span> <span class=\"n\">special</span> <span class=\"o\">(</span><span class=\"n\">X</span> <span class=\"o\">:</span> <span class=\"err\">\\</span><span class=\"n\">alpha</span><span class=\"o\">)</span> <span class=\"bp\">|</span> <span class=\"n\">Unit</span> <span class=\"bp\">|</span> <span class=\"n\">Omega</span> <span class=\"bp\">|</span> <span class=\"n\">Pow</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"o\">:</span> <span class=\"n\">type</span><span class=\"o\">)</span> <span class=\"bp\">|</span> <span class=\"n\">Prod</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"n\">B</span> <span class=\"o\">:</span> <span class=\"n\">type</span><span class=\"o\">)</span>\n</code></pre></div>\n\n\n<div class=\"codehilite\"><pre><span></span><code><span class=\"kn\">inductive</span> <span class=\"n\">type</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span>\n<span class=\"bp\">|</span> <span class=\"n\">special</span> <span class=\"o\">(</span><span class=\"n\">X</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span><span class=\"o\">)</span> <span class=\"bp\">|</span> <span class=\"n\">Unit</span> <span class=\"bp\">|</span> <span class=\"n\">Omega</span> <span class=\"bp\">|</span> <span class=\"n\">Pow</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"o\">:</span> <span class=\"n\">type</span><span class=\"o\">)</span> <span class=\"bp\">|</span> <span class=\"n\">Prod</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"n\">B</span> <span class=\"o\">:</span> <span class=\"n\">type</span><span class=\"o\">)</span>\n</code></pre></div>",
        "id": 201357426,
        "sender_full_name": "Billy Price",
        "timestamp": 1592549187
    },
    {
        "content": "<p>Regarding my 2 ideas, I have a feeling the second one is fundamentally different (perhaps the wrong idea).</p>",
        "id": 201357459,
        "sender_full_name": "Billy Price",
        "timestamp": 1592549258
    },
    {
        "content": "<p>Perhaps my \"give me..\" idea is more in the spirit of a type class?</p>",
        "id": 201357533,
        "sender_full_name": "Billy Price",
        "timestamp": 1592549335
    },
    {
        "content": "<p>the second one should not typecheck</p>",
        "id": 201358699,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1592550683
    },
    {
        "content": "<p>because there is a universe issue</p>",
        "id": 201358701,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1592550689
    },
    {
        "content": "<p>You want the first one</p>",
        "id": 201358761,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1592550723
    },
    {
        "content": "<blockquote>\n<p>I just say to the user \"give me a Type of things which I will think of as types in my theory, as long Unit, Omega are of that type and the Pow, Prod constructors make new types out of old ones\".</p>\n</blockquote>\n<p><span aria-label=\"point up\" class=\"emoji emoji-1f446\" role=\"img\" title=\"point up\">:point_up:</span> this</p>",
        "id": 201358774,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1592550744
    },
    {
        "content": "<p>oh wait you mean it's not an inductive type at all</p>",
        "id": 201358803,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1592550787
    },
    {
        "content": "<p>you can do that, and the interface will be nicer, but you will not be able to prove theorems about the PTS by induction anymore</p>",
        "id": 201358816,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1592550822
    },
    {
        "content": "<p>You could prove theorems relative to a partial recursor that the user also provides, but then every theorem is going to come with side conditions saying that the theorem already holds in some way for all the types the PTS doesn't know about</p>",
        "id": 201358905,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1592550923
    },
    {
        "content": "<p>Good to know, I think I'll stick with my pure type theory for now.</p>",
        "id": 201371137,
        "sender_full_name": "Billy Price",
        "timestamp": 1592560601
    },
    {
        "content": "<p>I just realised I could do this</p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"kn\">instance</span> <span class=\"n\">nat_coe_var</span> <span class=\"o\">:</span> <span class=\"n\">has_coe</span> <span class=\"bp\">ℕ</span> <span class=\"n\">term</span> <span class=\"o\">:=</span> <span class=\"bp\">⟨</span><span class=\"n\">term</span><span class=\"bp\">.</span><span class=\"n\">var</span><span class=\"bp\">⟩</span>\n</code></pre></div>\n\n\n<p>instead of this</p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"kn\">notation</span> <span class=\"bp\">`</span><span class=\"mi\">𝟘</span><span class=\"bp\">`</span> <span class=\"o\">:=</span> <span class=\"n\">term</span><span class=\"bp\">.</span><span class=\"n\">var</span> <span class=\"mi\">0</span>\n<span class=\"kn\">notation</span> <span class=\"bp\">`</span><span class=\"mi\">𝟙</span><span class=\"bp\">`</span> <span class=\"o\">:=</span> <span class=\"n\">term</span><span class=\"bp\">.</span><span class=\"n\">var</span> <span class=\"mi\">1</span>\n<span class=\"kn\">notation</span> <span class=\"bp\">`</span><span class=\"mi\">𝟚</span><span class=\"bp\">`</span> <span class=\"o\">:=</span> <span class=\"n\">term</span><span class=\"bp\">.</span><span class=\"n\">var</span> <span class=\"mi\">2</span>\n<span class=\"kn\">notation</span> <span class=\"bp\">`</span><span class=\"mi\">𝟛</span><span class=\"bp\">`</span> <span class=\"o\">:=</span> <span class=\"n\">term</span><span class=\"bp\">.</span><span class=\"n\">var</span> <span class=\"mi\">3</span>\n<span class=\"kn\">notation</span> <span class=\"bp\">`</span><span class=\"mi\">𝟜</span><span class=\"bp\">`</span> <span class=\"o\">:=</span> <span class=\"n\">term</span><span class=\"bp\">.</span><span class=\"n\">var</span> <span class=\"mi\">4</span>\n<span class=\"kn\">notation</span> <span class=\"bp\">`</span><span class=\"mi\">𝟝</span><span class=\"bp\">`</span> <span class=\"o\">:=</span> <span class=\"n\">term</span><span class=\"bp\">.</span><span class=\"n\">var</span> <span class=\"mi\">5</span>\n</code></pre></div>\n\n\n<p>is the coercion one a bad idea?</p>",
        "id": 201371730,
        "sender_full_name": "Billy Price",
        "timestamp": 1592561055
    },
    {
        "content": "<p>Or is there any way I can do a unique term construction like <code>⟨0⟩</code> since there's only one term constructor that takes a single (nat) argument?</p>",
        "id": 201371878,
        "sender_full_name": "Billy Price",
        "timestamp": 1592561181
    },
    {
        "content": "<p>It doesn't work out of the box, because it expects term to only have one term constructor.</p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"kn\">inductive</span> <span class=\"n\">term</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span>\n<span class=\"bp\">|</span> <span class=\"n\">star</span> <span class=\"o\">:</span> <span class=\"n\">term</span>\n<span class=\"bp\">|</span> <span class=\"n\">top</span>  <span class=\"o\">:</span> <span class=\"n\">term</span>\n<span class=\"bp\">|</span> <span class=\"n\">bot</span>  <span class=\"o\">:</span> <span class=\"n\">term</span>\n<span class=\"bp\">|</span> <span class=\"n\">and</span>  <span class=\"o\">:</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">term</span>\n<span class=\"bp\">|</span> <span class=\"n\">or</span>   <span class=\"o\">:</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">term</span>\n<span class=\"bp\">|</span> <span class=\"n\">imp</span>  <span class=\"o\">:</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">term</span>\n<span class=\"bp\">|</span> <span class=\"n\">elem</span> <span class=\"o\">:</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">term</span>\n<span class=\"bp\">|</span> <span class=\"n\">pair</span> <span class=\"o\">:</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">term</span>\n<span class=\"bp\">|</span> <span class=\"n\">var</span>  <span class=\"o\">:</span> <span class=\"bp\">ℕ</span> <span class=\"bp\">→</span> <span class=\"n\">term</span>\n<span class=\"bp\">|</span> <span class=\"n\">comp</span> <span class=\"o\">:</span> <span class=\"n\">type</span> <span class=\"bp\">→</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">term</span>\n<span class=\"bp\">|</span> <span class=\"n\">all</span>  <span class=\"o\">:</span> <span class=\"n\">type</span> <span class=\"bp\">→</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">term</span>\n<span class=\"bp\">|</span> <span class=\"n\">ex</span>   <span class=\"o\">:</span> <span class=\"n\">type</span> <span class=\"bp\">→</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">term</span>\n</code></pre></div>",
        "id": 201371919,
        "sender_full_name": "Billy Price",
        "timestamp": 1592561237
    },
    {
        "content": "<p>I mean it's fine, but it will never be particularly nice to write terms with de bruijn variables</p>",
        "id": 201417617,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1592586844
    },
    {
        "content": "<p>Why does this happen? I write <code>rw append_nil Γ</code> in this state and it tells me</p>\n<p><code>rewrite tactic failed, did not find instance of the pattern in the target expression\n  Γ ++ nil</code></p>\n<p>¿que?</p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"mi\">2</span> <span class=\"n\">goals</span>\n<span class=\"n\">case</span> <span class=\"n\">list</span><span class=\"bp\">.</span><span class=\"n\">nil</span>\n<span class=\"err\">Γ</span> <span class=\"o\">:</span> <span class=\"kn\">context</span><span class=\"o\">,</span>\n<span class=\"n\">A</span> <span class=\"o\">:</span> <span class=\"n\">type</span><span class=\"o\">,</span>\n<span class=\"n\">n</span> <span class=\"o\">:</span> <span class=\"bp\">ℕ</span><span class=\"o\">,</span>\n<span class=\"n\">h</span> <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"n\">A</span> <span class=\"o\">(</span><span class=\"n\">var</span> <span class=\"n\">n</span><span class=\"o\">),</span>\n<span class=\"n\">eq</span> <span class=\"o\">:</span> <span class=\"n\">nth</span> <span class=\"err\">Γ</span> <span class=\"n\">n</span> <span class=\"bp\">=</span> <span class=\"n\">some</span> <span class=\"n\">A</span>\n<span class=\"err\">⊢</span> <span class=\"n\">WF</span> <span class=\"o\">(</span><span class=\"err\">Γ</span> <span class=\"bp\">++</span> <span class=\"n\">nil</span><span class=\"o\">)</span> <span class=\"n\">A</span> <span class=\"o\">(</span><span class=\"n\">var</span> <span class=\"n\">n</span><span class=\"o\">)</span>\n</code></pre></div>",
        "id": 201463189,
        "sender_full_name": "Billy Price",
        "timestamp": 1592630801
    },
    {
        "content": "<p>Also how would I do <code>apply_rules</code> on all of the hypotheses? (to extract more hypotheses) Or on one hypothesis? Something like <code>simp at *</code></p>\n<p>(Not for this goal state)</p>",
        "id": 201464178,
        "sender_full_name": "Billy Price",
        "timestamp": 1592632869
    },
    {
        "content": "<p>I can't say offhand why that would fail. <a href=\"https://leanprover-community.github.io/mwe.html\">#mwe</a></p>",
        "id": 201466023,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1592636795
    },
    {
        "content": "<p>I'll come back to this one.</p>",
        "id": 201516521,
        "sender_full_name": "Billy Price",
        "timestamp": 1592714469
    },
    {
        "content": "<p>Is there any practical difference between these two code blocks? I'd like to treat <code>WF.foo : Prop</code> just like the inductively defined lemmas.</p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"kn\">inductive</span> <span class=\"n\">WF</span> <span class=\"o\">:</span> <span class=\"kn\">context</span> <span class=\"bp\">→</span> <span class=\"n\">type</span> <span class=\"bp\">→</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"kt\">Prop</span>\n<span class=\"bp\">|</span> <span class=\"n\">star</span> <span class=\"o\">{</span><span class=\"err\">Γ</span><span class=\"o\">}</span>         <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"mi\">𝟙</span> <span class=\"err\">⁎</span>\n<span class=\"bp\">|</span> <span class=\"n\">top</span>  <span class=\"o\">{</span><span class=\"err\">Γ</span><span class=\"o\">}</span>         <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"err\">⊤</span>\n<span class=\"bp\">|</span> <span class=\"n\">bot</span>  <span class=\"o\">{</span><span class=\"err\">Γ</span><span class=\"o\">}</span>         <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"err\">⊥</span>\n<span class=\"bp\">|</span> <span class=\"n\">and</span>  <span class=\"o\">{</span><span class=\"err\">Γ</span> <span class=\"n\">p</span> <span class=\"n\">q</span><span class=\"o\">}</span>     <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"n\">p</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"n\">q</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"err\">⋀</span> <span class=\"n\">q</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"n\">or</span>   <span class=\"o\">{</span><span class=\"err\">Γ</span> <span class=\"n\">p</span> <span class=\"n\">q</span><span class=\"o\">}</span>     <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"n\">p</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"n\">q</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"err\">⋁</span> <span class=\"n\">q</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"n\">imp</span>  <span class=\"o\">{</span><span class=\"err\">Γ</span> <span class=\"n\">p</span> <span class=\"n\">q</span><span class=\"o\">}</span>     <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"n\">p</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"n\">q</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"err\">⟹</span> <span class=\"n\">q</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"n\">elem</span> <span class=\"o\">{</span><span class=\"err\">Γ</span> <span class=\"n\">A</span> <span class=\"n\">a</span> <span class=\"n\">α</span><span class=\"o\">}</span>   <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"n\">A</span> <span class=\"n\">a</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"o\">(</span><span class=\"err\">𝒫</span> <span class=\"n\">A</span><span class=\"o\">)</span> <span class=\"n\">α</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"o\">(</span><span class=\"n\">a</span> <span class=\"err\">∈</span> <span class=\"n\">α</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"n\">pair</span> <span class=\"o\">{</span><span class=\"err\">Γ</span> <span class=\"n\">A</span> <span class=\"n\">B</span> <span class=\"n\">a</span> <span class=\"n\">b</span><span class=\"o\">}</span> <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"n\">A</span> <span class=\"n\">a</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"n\">B</span> <span class=\"n\">b</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"err\">𝕏</span> <span class=\"n\">B</span><span class=\"o\">)</span> <span class=\"err\">⟪</span><span class=\"n\">a</span><span class=\"o\">,</span><span class=\"n\">b</span><span class=\"err\">⟫</span>\n<span class=\"bp\">|</span> <span class=\"n\">var</span>  <span class=\"o\">{</span><span class=\"err\">Γ</span> <span class=\"n\">A</span> <span class=\"n\">n</span><span class=\"o\">}</span>     <span class=\"o\">:</span> <span class=\"n\">list</span><span class=\"bp\">.</span><span class=\"n\">nth</span> <span class=\"err\">Γ</span> <span class=\"n\">n</span> <span class=\"bp\">=</span> <span class=\"n\">some</span> <span class=\"n\">A</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"n\">A</span> <span class=\"o\">(</span><span class=\"n\">var</span> <span class=\"n\">n</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"n\">comp</span> <span class=\"o\">{</span><span class=\"err\">Γ</span> <span class=\"n\">A</span> <span class=\"n\">φ</span><span class=\"o\">}</span>     <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"o\">(</span><span class=\"n\">A</span><span class=\"bp\">::</span><span class=\"err\">Γ</span><span class=\"o\">)</span> <span class=\"err\">Ω</span> <span class=\"n\">φ</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"o\">(</span><span class=\"err\">𝒫</span> <span class=\"n\">A</span><span class=\"o\">)</span> <span class=\"err\">⟦</span><span class=\"n\">A</span> <span class=\"bp\">|</span> <span class=\"n\">φ</span><span class=\"err\">⟧</span>\n<span class=\"bp\">|</span> <span class=\"n\">all</span>  <span class=\"o\">{</span><span class=\"err\">Γ</span> <span class=\"n\">A</span> <span class=\"n\">φ</span><span class=\"o\">}</span>     <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"o\">(</span><span class=\"n\">A</span><span class=\"bp\">::</span><span class=\"err\">Γ</span><span class=\"o\">)</span> <span class=\"err\">Ω</span> <span class=\"n\">φ</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"o\">(</span><span class=\"bp\">∀</span><span class=\"err\">&#39;</span> <span class=\"n\">A</span> <span class=\"n\">φ</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"n\">ex</span>   <span class=\"o\">{</span><span class=\"err\">Γ</span> <span class=\"n\">A</span> <span class=\"n\">φ</span><span class=\"o\">}</span>     <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"o\">(</span><span class=\"n\">A</span><span class=\"bp\">::</span><span class=\"err\">Γ</span><span class=\"o\">)</span> <span class=\"err\">Ω</span> <span class=\"n\">φ</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"o\">(</span><span class=\"bp\">∃</span><span class=\"err\">&#39;</span> <span class=\"n\">A</span> <span class=\"n\">φ</span><span class=\"o\">)</span>\n\n<span class=\"kn\">namespace</span> <span class=\"n\">WF</span>\n\n<span class=\"kn\">lemma</span> <span class=\"n\">foo</span> <span class=\"o\">:</span> <span class=\"kt\">Prop</span>\n\n<span class=\"kn\">end</span>\n</code></pre></div>\n\n\n<div class=\"codehilite\"><pre><span></span><code><span class=\"kn\">inductive</span> <span class=\"n\">WF</span> <span class=\"o\">:</span> <span class=\"kn\">context</span> <span class=\"bp\">→</span> <span class=\"n\">type</span> <span class=\"bp\">→</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"kt\">Prop</span>\n<span class=\"bp\">|</span> <span class=\"n\">star</span> <span class=\"o\">{</span><span class=\"err\">Γ</span><span class=\"o\">}</span>         <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"mi\">𝟙</span> <span class=\"err\">⁎</span>\n<span class=\"bp\">|</span> <span class=\"n\">top</span>  <span class=\"o\">{</span><span class=\"err\">Γ</span><span class=\"o\">}</span>         <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"err\">⊤</span>\n<span class=\"bp\">|</span> <span class=\"n\">bot</span>  <span class=\"o\">{</span><span class=\"err\">Γ</span><span class=\"o\">}</span>         <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"err\">⊥</span>\n<span class=\"bp\">|</span> <span class=\"n\">and</span>  <span class=\"o\">{</span><span class=\"err\">Γ</span> <span class=\"n\">p</span> <span class=\"n\">q</span><span class=\"o\">}</span>     <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"n\">p</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"n\">q</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"err\">⋀</span> <span class=\"n\">q</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"n\">or</span>   <span class=\"o\">{</span><span class=\"err\">Γ</span> <span class=\"n\">p</span> <span class=\"n\">q</span><span class=\"o\">}</span>     <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"n\">p</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"n\">q</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"err\">⋁</span> <span class=\"n\">q</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"n\">imp</span>  <span class=\"o\">{</span><span class=\"err\">Γ</span> <span class=\"n\">p</span> <span class=\"n\">q</span><span class=\"o\">}</span>     <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"n\">p</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"n\">q</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"err\">⟹</span> <span class=\"n\">q</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"n\">elem</span> <span class=\"o\">{</span><span class=\"err\">Γ</span> <span class=\"n\">A</span> <span class=\"n\">a</span> <span class=\"n\">α</span><span class=\"o\">}</span>   <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"n\">A</span> <span class=\"n\">a</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"o\">(</span><span class=\"err\">𝒫</span> <span class=\"n\">A</span><span class=\"o\">)</span> <span class=\"n\">α</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"o\">(</span><span class=\"n\">a</span> <span class=\"err\">∈</span> <span class=\"n\">α</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"n\">pair</span> <span class=\"o\">{</span><span class=\"err\">Γ</span> <span class=\"n\">A</span> <span class=\"n\">B</span> <span class=\"n\">a</span> <span class=\"n\">b</span><span class=\"o\">}</span> <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"n\">A</span> <span class=\"n\">a</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"n\">B</span> <span class=\"n\">b</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"err\">𝕏</span> <span class=\"n\">B</span><span class=\"o\">)</span> <span class=\"err\">⟪</span><span class=\"n\">a</span><span class=\"o\">,</span><span class=\"n\">b</span><span class=\"err\">⟫</span>\n<span class=\"bp\">|</span> <span class=\"n\">var</span>  <span class=\"o\">{</span><span class=\"err\">Γ</span> <span class=\"n\">A</span> <span class=\"n\">n</span><span class=\"o\">}</span>     <span class=\"o\">:</span> <span class=\"n\">list</span><span class=\"bp\">.</span><span class=\"n\">nth</span> <span class=\"err\">Γ</span> <span class=\"n\">n</span> <span class=\"bp\">=</span> <span class=\"n\">some</span> <span class=\"n\">A</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"n\">A</span> <span class=\"o\">(</span><span class=\"n\">var</span> <span class=\"n\">n</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"n\">comp</span> <span class=\"o\">{</span><span class=\"err\">Γ</span> <span class=\"n\">A</span> <span class=\"n\">φ</span><span class=\"o\">}</span>     <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"o\">(</span><span class=\"n\">A</span><span class=\"bp\">::</span><span class=\"err\">Γ</span><span class=\"o\">)</span> <span class=\"err\">Ω</span> <span class=\"n\">φ</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"o\">(</span><span class=\"err\">𝒫</span> <span class=\"n\">A</span><span class=\"o\">)</span> <span class=\"err\">⟦</span><span class=\"n\">A</span> <span class=\"bp\">|</span> <span class=\"n\">φ</span><span class=\"err\">⟧</span>\n<span class=\"bp\">|</span> <span class=\"n\">all</span>  <span class=\"o\">{</span><span class=\"err\">Γ</span> <span class=\"n\">A</span> <span class=\"n\">φ</span><span class=\"o\">}</span>     <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"o\">(</span><span class=\"n\">A</span><span class=\"bp\">::</span><span class=\"err\">Γ</span><span class=\"o\">)</span> <span class=\"err\">Ω</span> <span class=\"n\">φ</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"o\">(</span><span class=\"bp\">∀</span><span class=\"err\">&#39;</span> <span class=\"n\">A</span> <span class=\"n\">φ</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"n\">ex</span>   <span class=\"o\">{</span><span class=\"err\">Γ</span> <span class=\"n\">A</span> <span class=\"n\">φ</span><span class=\"o\">}</span>     <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"o\">(</span><span class=\"n\">A</span><span class=\"bp\">::</span><span class=\"err\">Γ</span><span class=\"o\">)</span> <span class=\"err\">Ω</span> <span class=\"n\">φ</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"o\">(</span><span class=\"bp\">∃</span><span class=\"err\">&#39;</span> <span class=\"n\">A</span> <span class=\"n\">φ</span><span class=\"o\">)</span>\n\n<span class=\"kn\">lemma</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">foo</span> <span class=\"o\">:</span> <span class=\"kt\">Prop</span>\n</code></pre></div>",
        "id": 201516685,
        "sender_full_name": "Billy Price",
        "timestamp": 1592714801
    },
    {
        "content": "<p>Related question - is <code>WF</code> a namespace in <code>WF.star</code>?</p>",
        "id": 201516697,
        "sender_full_name": "Billy Price",
        "timestamp": 1592714856
    },
    {
        "content": "<p>In the same way that <code>WF</code> is a namespace in <code>WF.foo</code> in the first code block</p>",
        "id": 201516700,
        "sender_full_name": "Billy Price",
        "timestamp": 1592714879
    },
    {
        "content": "<p>no difference, yes it is a namespace</p>",
        "id": 201516748,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1592714943
    },
    {
        "content": "<p>one difference is that the <code>WF</code> namespace is open inside the proof of <code>foo</code> in the first case but not the second</p>",
        "id": 201516752,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1592714984
    },
    {
        "content": "<p>Is there a proper way to write this meta definition? I'll do my best to render the backticks properly. <code>meta def WF_prover : tactic unit:= do `[apply_rules WF_rules]</code>.</p>\n<p>It works for the most part but where I could previously do <code>apply_rules WF_rules; refl</code>, I cannot now do <code>WF_prover; refl</code>, with this error resulting.</p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"n\">type</span> <span class=\"n\">mismatch</span> <span class=\"n\">at</span> <span class=\"n\">application</span>\n  <span class=\"n\">WF_prover</span><span class=\"bp\">;</span> <span class=\"n\">refl</span>\n<span class=\"n\">term</span>\n  <span class=\"n\">refl</span>\n<span class=\"n\">has</span> <span class=\"n\">type</span>\n  <span class=\"bp\">∀</span> <span class=\"o\">(</span><span class=\"n\">a</span> <span class=\"o\">:</span> <span class=\"err\">?</span><span class=\"n\">m_1</span><span class=\"o\">),</span> <span class=\"err\">?</span><span class=\"n\">m_2</span> <span class=\"n\">a</span> <span class=\"n\">a</span> <span class=\"o\">:</span> <span class=\"kt\">Prop</span>\n<span class=\"n\">but</span> <span class=\"n\">is</span> <span class=\"n\">expected</span> <span class=\"n\">to</span> <span class=\"k\">have</span> <span class=\"n\">type</span>\n  <span class=\"err\">?</span><span class=\"n\">m_1</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span> <span class=\"err\">?</span>\n</code></pre></div>\n\n\n<p>I have to do <code>WF_prover, all_goals {refl}</code> (which works).</p>\n<p>I'm guessing it's because I derived that meta definition from another one which sequenced several tactics, and I'm now just trying to rename one tactic.</p>",
        "id": 201606364,
        "sender_full_name": "Billy Price",
        "timestamp": 1592833156
    },
    {
        "content": "<p>Here's a related <a href=\"https://leanprover-community.github.io/mwe.html\">#mwe</a> (more like #mnwe)</p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"n\">meta</span> <span class=\"n\">def</span> <span class=\"n\">my_split</span> <span class=\"o\">:</span> <span class=\"n\">tactic</span> <span class=\"n\">unit</span><span class=\"o\">:=</span> <span class=\"n\">do</span> <span class=\"bp\">`</span><span class=\"o\">[</span><span class=\"n\">split</span><span class=\"o\">]</span>\n\n<span class=\"kn\">example</span> <span class=\"o\">{</span><span class=\"n\">p</span> <span class=\"n\">q</span><span class=\"o\">}</span> <span class=\"o\">:</span> <span class=\"n\">p</span> <span class=\"bp\">→</span> <span class=\"n\">q</span> <span class=\"bp\">→</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"bp\">∧</span> <span class=\"n\">q</span><span class=\"o\">)</span> <span class=\"o\">:=</span>\n<span class=\"k\">begin</span>\n  <span class=\"n\">intros</span><span class=\"o\">,</span>\n  <span class=\"n\">split</span><span class=\"bp\">;</span><span class=\"n\">assumption</span><span class=\"o\">,</span>\n<span class=\"kn\">end</span>\n\n<span class=\"kn\">example</span> <span class=\"o\">{</span><span class=\"n\">p</span> <span class=\"n\">q</span><span class=\"o\">}</span> <span class=\"o\">:</span> <span class=\"n\">p</span> <span class=\"bp\">→</span> <span class=\"n\">q</span> <span class=\"bp\">→</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"bp\">∧</span> <span class=\"n\">q</span><span class=\"o\">)</span> <span class=\"o\">:=</span>\n<span class=\"k\">begin</span>\n  <span class=\"n\">intros</span><span class=\"o\">,</span>\n  <span class=\"n\">my_split</span><span class=\"bp\">;</span><span class=\"n\">assumption</span> <span class=\"c1\">-- doesn&#39;t work</span>\n<span class=\"kn\">end</span>\n</code></pre></div>",
        "id": 201607079,
        "sender_full_name": "Billy Price",
        "timestamp": 1592833527
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span><code><span class=\"n\">meta</span> <span class=\"n\">def</span> <span class=\"n\">tactic</span><span class=\"bp\">.</span><span class=\"n\">interactive</span><span class=\"bp\">.</span><span class=\"n\">my_split</span> <span class=\"o\">:</span> <span class=\"n\">tactic</span> <span class=\"n\">unit</span><span class=\"o\">:=</span> <span class=\"n\">do</span> <span class=\"bp\">`</span><span class=\"o\">[</span><span class=\"n\">split</span><span class=\"o\">]</span>\n</code></pre></div>",
        "id": 201607485,
        "sender_full_name": "Reid Barton",
        "timestamp": 1592833706
    },
    {
        "content": "<p>I don't have a more minimal <a href=\"https://leanprover-community.github.io/mwe.html\">#mwe</a> for this, but the very last line here, it doesn't recognise <code>WF_prover</code></p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"c\">/-</span><span class=\"cm\"></span>\n<span class=\"cm\">Definitions of a type theory</span>\n\n<span class=\"cm\">Author: Billy Price</span>\n<span class=\"cm\">-/</span>\n\n<span class=\"kn\">import</span> <span class=\"n\">data</span><span class=\"bp\">.</span><span class=\"n\">finset</span>\n<span class=\"kn\">import</span> <span class=\"n\">tactic</span><span class=\"bp\">.</span><span class=\"n\">tidy</span>\n<span class=\"kn\">namespace</span> <span class=\"n\">TT</span>\n\n<span class=\"kn\">inductive</span> <span class=\"n\">type</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span>\n<span class=\"bp\">|</span> <span class=\"n\">Unit</span> <span class=\"bp\">|</span> <span class=\"n\">Omega</span> <span class=\"bp\">|</span> <span class=\"n\">Prod</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"n\">B</span> <span class=\"o\">:</span> <span class=\"n\">type</span><span class=\"o\">)</span><span class=\"bp\">|</span> <span class=\"n\">Pow</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"o\">:</span> <span class=\"n\">type</span><span class=\"o\">)</span>\n\n<span class=\"kn\">notation</span> <span class=\"bp\">`</span><span class=\"err\">Ω</span><span class=\"bp\">`</span> <span class=\"o\">:=</span> <span class=\"n\">type</span><span class=\"bp\">.</span><span class=\"n\">Omega</span>\n<span class=\"kn\">notation</span> <span class=\"bp\">`</span><span class=\"mi\">𝟙</span><span class=\"bp\">`</span> <span class=\"o\">:=</span> <span class=\"n\">type</span><span class=\"bp\">.</span><span class=\"n\">Unit</span>\n<span class=\"kn\">infix</span> <span class=\"bp\">`</span><span class=\"err\">𝕏</span><span class=\"bp\">`</span><span class=\"o\">:</span><span class=\"n\">max</span> <span class=\"o\">:=</span> <span class=\"n\">type</span><span class=\"bp\">.</span><span class=\"n\">Prod</span>\n<span class=\"kn\">notation</span> <span class=\"bp\">`</span><span class=\"err\">𝒫</span><span class=\"bp\">`</span><span class=\"n\">A</span> <span class=\"o\">:</span><span class=\"n\">max</span> <span class=\"o\">:=</span> <span class=\"n\">type</span><span class=\"bp\">.</span><span class=\"n\">Pow</span> <span class=\"n\">A</span>\n\n\n<span class=\"kn\">inductive</span> <span class=\"n\">term</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span>\n<span class=\"bp\">|</span> <span class=\"n\">star</span> <span class=\"o\">:</span> <span class=\"n\">term</span>\n<span class=\"bp\">|</span> <span class=\"n\">top</span>  <span class=\"o\">:</span> <span class=\"n\">term</span>\n<span class=\"bp\">|</span> <span class=\"n\">bot</span>  <span class=\"o\">:</span> <span class=\"n\">term</span>\n<span class=\"bp\">|</span> <span class=\"n\">and</span>  <span class=\"o\">:</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">term</span>\n<span class=\"bp\">|</span> <span class=\"n\">or</span>   <span class=\"o\">:</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">term</span>\n<span class=\"bp\">|</span> <span class=\"n\">imp</span>  <span class=\"o\">:</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">term</span>\n<span class=\"bp\">|</span> <span class=\"n\">elem</span> <span class=\"o\">:</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">term</span>\n<span class=\"bp\">|</span> <span class=\"n\">pair</span> <span class=\"o\">:</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">term</span>\n<span class=\"bp\">|</span> <span class=\"n\">var</span>  <span class=\"o\">:</span> <span class=\"bp\">ℕ</span> <span class=\"bp\">→</span> <span class=\"n\">term</span>\n<span class=\"bp\">|</span> <span class=\"n\">comp</span> <span class=\"o\">:</span> <span class=\"n\">type</span> <span class=\"bp\">→</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">term</span>\n<span class=\"bp\">|</span> <span class=\"n\">all</span>  <span class=\"o\">:</span> <span class=\"n\">type</span> <span class=\"bp\">→</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">term</span>\n<span class=\"bp\">|</span> <span class=\"n\">ex</span>   <span class=\"o\">:</span> <span class=\"n\">type</span> <span class=\"bp\">→</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">term</span>\n\n<span class=\"kn\">open</span> <span class=\"n\">term</span>\n\n<span class=\"c1\">-- * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *</span>\n<span class=\"c1\">-- Notation and derived operators</span>\n<span class=\"c1\">-- * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *</span>\n\n<span class=\"n\">def</span> <span class=\"n\">nat_coe_var</span> <span class=\"o\">:</span> <span class=\"n\">has_coe</span> <span class=\"bp\">ℕ</span> <span class=\"n\">term</span> <span class=\"o\">:=</span> <span class=\"bp\">⟨</span><span class=\"n\">term</span><span class=\"bp\">.</span><span class=\"n\">var</span><span class=\"bp\">⟩</span>\n\n<span class=\"n\">local</span> <span class=\"n\">attribute</span> <span class=\"o\">[</span><span class=\"kn\">instance</span><span class=\"o\">]</span> <span class=\"n\">nat_coe_var</span>\n\n<span class=\"kn\">notation</span> <span class=\"bp\">`</span><span class=\"err\">⁎</span><span class=\"bp\">`</span> <span class=\"o\">:=</span> <span class=\"n\">term</span><span class=\"bp\">.</span><span class=\"n\">star</span>    <span class=\"c1\">-- input \\asterisk</span>\n<span class=\"kn\">notation</span> <span class=\"bp\">`</span><span class=\"err\">⊤</span><span class=\"bp\">`</span> <span class=\"o\">:=</span> <span class=\"n\">term</span><span class=\"bp\">.</span><span class=\"n\">top</span>     <span class=\"c1\">--       \\top</span>\n<span class=\"kn\">notation</span> <span class=\"bp\">`</span><span class=\"err\">⊥</span><span class=\"bp\">`</span> <span class=\"o\">:=</span> <span class=\"n\">term</span><span class=\"bp\">.</span><span class=\"n\">bot</span>     <span class=\"c1\">-- input \\bot</span>\n<span class=\"kn\">infixr</span> <span class=\"bp\">`</span> <span class=\"err\">⟹</span> <span class=\"bp\">`</span><span class=\"o\">:</span><span class=\"mi\">60</span> <span class=\"o\">:=</span> <span class=\"n\">term</span><span class=\"bp\">.</span><span class=\"n\">imp</span> <span class=\"c1\">-- input \\==&gt;</span>\n<span class=\"kn\">infixr</span> <span class=\"bp\">`</span> <span class=\"err\">⋀</span> <span class=\"bp\">`</span> <span class=\"o\">:</span><span class=\"mi\">70</span> <span class=\"o\">:=</span> <span class=\"n\">term</span><span class=\"bp\">.</span><span class=\"n\">and</span> <span class=\"c1\">-- input \\And or \\bigwedge</span>\n<span class=\"kn\">infixr</span> <span class=\"bp\">`</span> <span class=\"err\">⋁</span> <span class=\"bp\">`</span> <span class=\"o\">:</span><span class=\"mi\">59</span> <span class=\"o\">:=</span> <span class=\"n\">term</span><span class=\"bp\">.</span><span class=\"n\">or</span>  <span class=\"c1\">-- input \\Or or \\bigvee</span>\n\n<span class=\"n\">def</span> <span class=\"n\">not</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"o\">:</span> <span class=\"n\">term</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"n\">p</span> <span class=\"err\">⟹</span> <span class=\"err\">⊥</span>\n<span class=\"kn\">prefix</span> <span class=\"bp\">`</span><span class=\"err\">∼</span><span class=\"bp\">`</span><span class=\"o\">:</span><span class=\"n\">max</span> <span class=\"o\">:=</span> <span class=\"n\">not</span> <span class=\"c1\">-- input \\~</span>\n\n<span class=\"n\">def</span> <span class=\"n\">iff</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"n\">q</span><span class=\"o\">:</span> <span class=\"n\">term</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"err\">⟹</span> <span class=\"n\">q</span><span class=\"o\">)</span> <span class=\"err\">⋀</span> <span class=\"o\">(</span><span class=\"n\">q</span> <span class=\"err\">⟹</span> <span class=\"n\">p</span><span class=\"o\">)</span>\n<span class=\"kn\">infix</span> <span class=\"bp\">`</span> <span class=\"err\">⇔</span> <span class=\"bp\">`</span><span class=\"o\">:</span><span class=\"mi\">60</span> <span class=\"o\">:=</span> <span class=\"n\">iff</span> <span class=\"c1\">-- input \\&lt;=&gt;</span>\n\n<span class=\"kn\">infix</span> <span class=\"err\">∈</span> <span class=\"o\">:=</span> <span class=\"n\">term</span><span class=\"bp\">.</span><span class=\"n\">elem</span>\n<span class=\"kn\">infix</span> <span class=\"err\">∉</span> <span class=\"o\">:=</span> <span class=\"bp\">λ</span> <span class=\"n\">a</span> <span class=\"n\">α</span><span class=\"o\">,</span> <span class=\"n\">not</span> <span class=\"o\">(</span><span class=\"n\">term</span><span class=\"bp\">.</span><span class=\"n\">elem</span> <span class=\"n\">a</span> <span class=\"n\">α</span><span class=\"o\">)</span>\n<span class=\"kn\">notation</span> <span class=\"bp\">`</span><span class=\"o\">{{</span> <span class=\"bp\">`</span> <span class=\"n\">A</span> <span class=\"bp\">`</span> <span class=\"bp\">|</span> <span class=\"bp\">`</span> <span class=\"n\">φ</span> <span class=\"bp\">`</span> <span class=\"o\">}}</span><span class=\"bp\">`</span> <span class=\"o\">:=</span> <span class=\"n\">term</span><span class=\"bp\">.</span><span class=\"n\">comp</span> <span class=\"n\">A</span> <span class=\"n\">φ</span>\n\n<span class=\"kn\">notation</span> <span class=\"bp\">`</span><span class=\"err\">⟪</span><span class=\"bp\">`</span> <span class=\"n\">a</span> <span class=\"bp\">`</span><span class=\"o\">,</span><span class=\"bp\">`</span> <span class=\"n\">b</span> <span class=\"bp\">`</span><span class=\"err\">⟫</span><span class=\"bp\">`</span> <span class=\"o\">:=</span> <span class=\"n\">term</span><span class=\"bp\">.</span><span class=\"n\">pair</span> <span class=\"n\">a</span> <span class=\"n\">b</span>\n\n<span class=\"kn\">notation</span> <span class=\"bp\">`∀</span><span class=\"err\">&#39;</span><span class=\"bp\">`</span> <span class=\"o\">:=</span> <span class=\"n\">term</span><span class=\"bp\">.</span><span class=\"n\">all</span>\n<span class=\"kn\">notation</span> <span class=\"bp\">`∃</span><span class=\"err\">&#39;</span><span class=\"bp\">`</span> <span class=\"o\">:=</span> <span class=\"n\">term</span><span class=\"bp\">.</span><span class=\"n\">ex</span>\n\n<span class=\"n\">def</span> <span class=\"n\">term</span><span class=\"bp\">.</span><span class=\"n\">all_chain</span> <span class=\"o\">(</span><span class=\"err\">Γ</span> <span class=\"o\">:</span> <span class=\"n\">list</span> <span class=\"n\">type</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">term</span> <span class=\"o\">:=</span> <span class=\"n\">flip</span> <span class=\"o\">(</span><span class=\"n\">list</span><span class=\"bp\">.</span><span class=\"n\">foldr</span> <span class=\"o\">(</span><span class=\"bp\">λ</span> <span class=\"n\">A</span> <span class=\"n\">ψ</span><span class=\"o\">,</span> <span class=\"n\">term</span><span class=\"bp\">.</span><span class=\"n\">all</span> <span class=\"n\">A</span> <span class=\"n\">ψ</span><span class=\"o\">))</span> <span class=\"err\">Γ</span>\n<span class=\"n\">def</span> <span class=\"n\">term</span><span class=\"bp\">.</span><span class=\"n\">ex_chain</span>  <span class=\"o\">(</span><span class=\"err\">Γ</span> <span class=\"o\">:</span> <span class=\"n\">list</span> <span class=\"n\">type</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">term</span> <span class=\"o\">:=</span> <span class=\"n\">flip</span> <span class=\"o\">(</span><span class=\"n\">list</span><span class=\"bp\">.</span><span class=\"n\">foldr</span> <span class=\"o\">(</span><span class=\"bp\">λ</span> <span class=\"n\">A</span> <span class=\"n\">ψ</span><span class=\"o\">,</span> <span class=\"n\">term</span><span class=\"bp\">.</span><span class=\"n\">ex</span> <span class=\"n\">A</span> <span class=\"n\">ψ</span><span class=\"o\">))</span> <span class=\"err\">Γ</span>\n\n<span class=\"bp\">@</span><span class=\"o\">[</span><span class=\"n\">simp</span><span class=\"o\">]</span> <span class=\"kn\">lemma</span> <span class=\"n\">term</span><span class=\"bp\">.</span><span class=\"n\">unfold_all_chain</span> <span class=\"o\">{</span><span class=\"n\">A</span> <span class=\"err\">Γ</span> <span class=\"n\">φ</span><span class=\"o\">}</span> <span class=\"o\">:</span> <span class=\"n\">term</span><span class=\"bp\">.</span><span class=\"n\">all_chain</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"bp\">::</span> <span class=\"err\">Γ</span><span class=\"o\">)</span> <span class=\"n\">φ</span> <span class=\"bp\">=</span> <span class=\"bp\">∀</span><span class=\"err\">&#39;</span> <span class=\"n\">A</span> <span class=\"o\">(</span><span class=\"n\">term</span><span class=\"bp\">.</span><span class=\"n\">all_chain</span> <span class=\"err\">Γ</span> <span class=\"n\">φ</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"n\">rfl</span>\n<span class=\"bp\">@</span><span class=\"o\">[</span><span class=\"n\">simp</span><span class=\"o\">]</span> <span class=\"kn\">lemma</span> <span class=\"n\">term</span><span class=\"bp\">.</span><span class=\"n\">unfold_ex_chain</span> <span class=\"o\">{</span><span class=\"n\">A</span> <span class=\"err\">Γ</span> <span class=\"n\">φ</span><span class=\"o\">}</span> <span class=\"o\">:</span> <span class=\"n\">term</span><span class=\"bp\">.</span><span class=\"n\">ex_chain</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"bp\">::</span> <span class=\"err\">Γ</span><span class=\"o\">)</span> <span class=\"n\">φ</span> <span class=\"bp\">=</span> <span class=\"bp\">∃</span><span class=\"err\">&#39;</span> <span class=\"n\">A</span> <span class=\"o\">(</span><span class=\"n\">term</span><span class=\"bp\">.</span><span class=\"n\">ex_chain</span> <span class=\"err\">Γ</span> <span class=\"n\">φ</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"n\">rfl</span>\n\n<span class=\"kn\">notation</span> <span class=\"bp\">`∀</span><span class=\"o\">[</span><span class=\"bp\">`</span> <span class=\"err\">Γ</span><span class=\"o\">:(</span><span class=\"n\">foldr</span> <span class=\"bp\">`</span><span class=\"o\">,</span><span class=\"bp\">`</span> <span class=\"o\">(</span><span class=\"n\">h</span> <span class=\"n\">t</span><span class=\"o\">,</span> <span class=\"n\">list</span><span class=\"bp\">.</span><span class=\"n\">cons</span> <span class=\"n\">h</span> <span class=\"n\">t</span><span class=\"o\">)</span> <span class=\"n\">list</span><span class=\"bp\">.</span><span class=\"n\">nil</span><span class=\"o\">)</span> <span class=\"bp\">`</span><span class=\"o\">]</span><span class=\"bp\">`</span> <span class=\"o\">:=</span> <span class=\"n\">term</span><span class=\"bp\">.</span><span class=\"n\">all_chain</span> <span class=\"err\">Γ</span>\n<span class=\"kn\">notation</span> <span class=\"bp\">`∃</span><span class=\"o\">[</span><span class=\"bp\">`</span> <span class=\"err\">Γ</span><span class=\"o\">:(</span><span class=\"n\">foldr</span> <span class=\"bp\">`</span><span class=\"o\">,</span><span class=\"bp\">`</span> <span class=\"o\">(</span><span class=\"n\">h</span> <span class=\"n\">t</span><span class=\"o\">,</span> <span class=\"n\">list</span><span class=\"bp\">.</span><span class=\"n\">cons</span> <span class=\"n\">h</span> <span class=\"n\">t</span><span class=\"o\">)</span> <span class=\"n\">list</span><span class=\"bp\">.</span><span class=\"n\">nil</span><span class=\"o\">)</span> <span class=\"bp\">`</span><span class=\"o\">]</span><span class=\"bp\">`</span> <span class=\"o\">:=</span> <span class=\"n\">term</span><span class=\"bp\">.</span><span class=\"n\">ex_chain</span> <span class=\"err\">Γ</span>\n\n<span class=\"kn\">section</span> <span class=\"n\">substitution</span>\n\n  <span class=\"bp\">@</span><span class=\"o\">[</span><span class=\"n\">simp</span><span class=\"o\">]</span>\n  <span class=\"n\">def</span> <span class=\"n\">lift_d</span> <span class=\"o\">(</span><span class=\"n\">d</span> <span class=\"o\">:</span> <span class=\"bp\">ℕ</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"bp\">ℕ</span> <span class=\"bp\">→</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">term</span>\n  <span class=\"bp\">|</span> <span class=\"n\">k</span> <span class=\"err\">⁎</span>          <span class=\"o\">:=</span> <span class=\"err\">⁎</span>\n  <span class=\"bp\">|</span> <span class=\"n\">k</span> <span class=\"err\">⊤</span>          <span class=\"o\">:=</span> <span class=\"err\">⊤</span>\n  <span class=\"bp\">|</span> <span class=\"n\">k</span> <span class=\"err\">⊥</span>          <span class=\"o\">:=</span> <span class=\"err\">⊥</span>\n  <span class=\"bp\">|</span> <span class=\"n\">k</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"err\">⋀</span> <span class=\"n\">q</span><span class=\"o\">)</span>    <span class=\"o\">:=</span> <span class=\"o\">(</span><span class=\"n\">lift_d</span> <span class=\"n\">k</span> <span class=\"n\">p</span><span class=\"o\">)</span> <span class=\"err\">⋀</span> <span class=\"o\">(</span><span class=\"n\">lift_d</span> <span class=\"n\">k</span> <span class=\"n\">q</span><span class=\"o\">)</span>\n  <span class=\"bp\">|</span> <span class=\"n\">k</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"err\">⋁</span> <span class=\"n\">q</span><span class=\"o\">)</span>    <span class=\"o\">:=</span> <span class=\"o\">(</span><span class=\"n\">lift_d</span> <span class=\"n\">k</span> <span class=\"n\">p</span><span class=\"o\">)</span> <span class=\"err\">⋁</span> <span class=\"o\">(</span><span class=\"n\">lift_d</span> <span class=\"n\">k</span> <span class=\"n\">q</span><span class=\"o\">)</span>\n  <span class=\"bp\">|</span> <span class=\"n\">k</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"err\">⟹</span> <span class=\"n\">q</span><span class=\"o\">)</span>   <span class=\"o\">:=</span> <span class=\"o\">(</span><span class=\"n\">lift_d</span> <span class=\"n\">k</span> <span class=\"n\">p</span><span class=\"o\">)</span> <span class=\"err\">⟹</span> <span class=\"o\">(</span><span class=\"n\">lift_d</span> <span class=\"n\">k</span> <span class=\"n\">q</span><span class=\"o\">)</span>\n  <span class=\"bp\">|</span> <span class=\"n\">k</span> <span class=\"o\">(</span><span class=\"n\">a</span> <span class=\"err\">∈</span> <span class=\"n\">α</span><span class=\"o\">)</span>    <span class=\"o\">:=</span> <span class=\"o\">(</span><span class=\"n\">lift_d</span> <span class=\"n\">k</span> <span class=\"n\">a</span><span class=\"o\">)</span> <span class=\"err\">∈</span> <span class=\"o\">(</span><span class=\"n\">lift_d</span> <span class=\"n\">k</span> <span class=\"n\">α</span><span class=\"o\">)</span>\n  <span class=\"bp\">|</span> <span class=\"n\">k</span> <span class=\"err\">⟪</span><span class=\"n\">a</span><span class=\"o\">,</span><span class=\"n\">b</span><span class=\"err\">⟫</span>      <span class=\"o\">:=</span> <span class=\"err\">⟪</span><span class=\"n\">lift_d</span> <span class=\"n\">k</span> <span class=\"n\">a</span><span class=\"o\">,</span> <span class=\"n\">lift_d</span> <span class=\"n\">k</span> <span class=\"n\">b</span><span class=\"err\">⟫</span>\n  <span class=\"bp\">|</span> <span class=\"n\">k</span> <span class=\"o\">(</span><span class=\"n\">var</span> <span class=\"n\">m</span><span class=\"o\">)</span>    <span class=\"o\">:=</span> <span class=\"k\">if</span> <span class=\"n\">m</span><span class=\"bp\">≥</span><span class=\"n\">k</span> <span class=\"k\">then</span> <span class=\"n\">var</span> <span class=\"o\">(</span><span class=\"n\">m</span><span class=\"bp\">+</span><span class=\"n\">d</span><span class=\"o\">)</span> <span class=\"k\">else</span> <span class=\"n\">var</span> <span class=\"n\">m</span>\n  <span class=\"bp\">|</span> <span class=\"n\">k</span> <span class=\"o\">{{</span><span class=\"n\">A</span> <span class=\"bp\">|</span> <span class=\"n\">φ</span><span class=\"o\">}}</span>     <span class=\"o\">:=</span>   <span class=\"o\">{{</span><span class=\"n\">A</span> <span class=\"bp\">|</span> <span class=\"n\">lift_d</span> <span class=\"o\">(</span><span class=\"n\">k</span><span class=\"bp\">+</span><span class=\"mi\">1</span><span class=\"o\">)</span> <span class=\"n\">φ</span><span class=\"o\">}}</span>\n  <span class=\"bp\">|</span> <span class=\"n\">k</span> <span class=\"o\">(</span><span class=\"bp\">∀</span><span class=\"err\">&#39;</span> <span class=\"n\">A</span> <span class=\"n\">φ</span><span class=\"o\">)</span>   <span class=\"o\">:=</span> <span class=\"bp\">∀</span><span class=\"err\">&#39;</span> <span class=\"n\">A</span> <span class=\"err\">$</span> <span class=\"n\">lift_d</span> <span class=\"o\">(</span><span class=\"n\">k</span><span class=\"bp\">+</span><span class=\"mi\">1</span><span class=\"o\">)</span> <span class=\"n\">φ</span>\n  <span class=\"bp\">|</span> <span class=\"n\">k</span> <span class=\"o\">(</span><span class=\"bp\">∃</span><span class=\"err\">&#39;</span> <span class=\"n\">A</span> <span class=\"n\">φ</span><span class=\"o\">)</span>   <span class=\"o\">:=</span> <span class=\"bp\">∃</span><span class=\"err\">&#39;</span> <span class=\"n\">A</span> <span class=\"err\">$</span> <span class=\"n\">lift_d</span> <span class=\"o\">(</span><span class=\"n\">k</span><span class=\"bp\">+</span><span class=\"mi\">1</span><span class=\"o\">)</span> <span class=\"n\">φ</span>\n\n  <span class=\"kn\">notation</span> <span class=\"bp\">`^`</span> <span class=\"o\">:=</span> <span class=\"n\">lift_d</span> <span class=\"mi\">1</span> <span class=\"mi\">0</span>\n\n  <span class=\"bp\">@</span><span class=\"o\">[</span><span class=\"n\">simp</span><span class=\"o\">]</span>\n  <span class=\"n\">def</span> <span class=\"n\">subst</span> <span class=\"o\">:</span> <span class=\"bp\">ℕ</span> <span class=\"bp\">→</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">term</span>\n  <span class=\"bp\">|</span> <span class=\"n\">n</span> <span class=\"n\">x</span> <span class=\"err\">⁎</span>          <span class=\"o\">:=</span> <span class=\"err\">⁎</span>\n  <span class=\"bp\">|</span> <span class=\"n\">n</span> <span class=\"n\">x</span> <span class=\"err\">⊤</span>          <span class=\"o\">:=</span> <span class=\"err\">⊤</span>\n  <span class=\"bp\">|</span> <span class=\"n\">n</span> <span class=\"n\">x</span> <span class=\"err\">⊥</span>          <span class=\"o\">:=</span> <span class=\"err\">⊥</span>\n  <span class=\"bp\">|</span> <span class=\"n\">n</span> <span class=\"n\">x</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"err\">⋀</span> <span class=\"n\">q</span><span class=\"o\">)</span>    <span class=\"o\">:=</span> <span class=\"o\">(</span><span class=\"n\">subst</span> <span class=\"n\">n</span> <span class=\"n\">x</span> <span class=\"n\">p</span><span class=\"o\">)</span> <span class=\"err\">⋀</span> <span class=\"o\">(</span><span class=\"n\">subst</span> <span class=\"n\">n</span> <span class=\"n\">x</span> <span class=\"n\">q</span><span class=\"o\">)</span>\n  <span class=\"bp\">|</span> <span class=\"n\">n</span> <span class=\"n\">x</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"err\">⋁</span> <span class=\"n\">q</span><span class=\"o\">)</span>    <span class=\"o\">:=</span> <span class=\"o\">(</span><span class=\"n\">subst</span> <span class=\"n\">n</span> <span class=\"n\">x</span> <span class=\"n\">p</span><span class=\"o\">)</span> <span class=\"err\">⋁</span> <span class=\"o\">(</span><span class=\"n\">subst</span> <span class=\"n\">n</span> <span class=\"n\">x</span> <span class=\"n\">q</span><span class=\"o\">)</span>\n  <span class=\"bp\">|</span> <span class=\"n\">n</span> <span class=\"n\">x</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"err\">⟹</span> <span class=\"n\">q</span><span class=\"o\">)</span>  <span class=\"o\">:=</span> <span class=\"o\">(</span><span class=\"n\">subst</span> <span class=\"n\">n</span> <span class=\"n\">x</span> <span class=\"n\">p</span><span class=\"o\">)</span> <span class=\"err\">⟹</span> <span class=\"o\">(</span><span class=\"n\">subst</span> <span class=\"n\">n</span> <span class=\"n\">x</span> <span class=\"n\">q</span><span class=\"o\">)</span>\n  <span class=\"bp\">|</span> <span class=\"n\">n</span> <span class=\"n\">x</span> <span class=\"o\">(</span><span class=\"n\">a</span> <span class=\"err\">∈</span> <span class=\"n\">α</span><span class=\"o\">)</span>    <span class=\"o\">:=</span> <span class=\"o\">(</span><span class=\"n\">subst</span> <span class=\"n\">n</span> <span class=\"n\">x</span> <span class=\"n\">a</span><span class=\"o\">)</span> <span class=\"err\">∈</span> <span class=\"o\">(</span><span class=\"n\">subst</span> <span class=\"n\">n</span> <span class=\"n\">x</span> <span class=\"n\">α</span><span class=\"o\">)</span>\n  <span class=\"bp\">|</span> <span class=\"n\">n</span> <span class=\"n\">x</span> <span class=\"err\">⟪</span><span class=\"n\">a</span><span class=\"o\">,</span><span class=\"n\">c</span><span class=\"err\">⟫</span>      <span class=\"o\">:=</span> <span class=\"err\">⟪</span><span class=\"n\">subst</span> <span class=\"n\">n</span> <span class=\"n\">x</span> <span class=\"n\">a</span><span class=\"o\">,</span> <span class=\"n\">subst</span> <span class=\"n\">n</span> <span class=\"n\">x</span> <span class=\"n\">c</span><span class=\"err\">⟫</span>\n  <span class=\"bp\">|</span> <span class=\"n\">n</span> <span class=\"n\">x</span> <span class=\"o\">(</span><span class=\"n\">var</span> <span class=\"n\">m</span><span class=\"o\">)</span>    <span class=\"o\">:=</span> <span class=\"k\">if</span> <span class=\"n\">n</span><span class=\"bp\">=</span><span class=\"n\">m</span> <span class=\"k\">then</span> <span class=\"n\">x</span> <span class=\"k\">else</span> <span class=\"n\">var</span> <span class=\"n\">m</span>\n  <span class=\"bp\">|</span> <span class=\"n\">n</span> <span class=\"n\">x</span> <span class=\"o\">{{</span> <span class=\"n\">A</span> <span class=\"bp\">|</span> <span class=\"n\">φ</span> <span class=\"o\">}}</span>   <span class=\"o\">:=</span>    <span class=\"o\">{{</span><span class=\"n\">A</span> <span class=\"bp\">|</span> <span class=\"n\">subst</span> <span class=\"o\">(</span><span class=\"n\">n</span><span class=\"bp\">+</span><span class=\"mi\">1</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"bp\">^</span> <span class=\"n\">x</span><span class=\"o\">)</span> <span class=\"n\">φ</span><span class=\"o\">}}</span>\n  <span class=\"bp\">|</span> <span class=\"n\">n</span> <span class=\"n\">x</span> <span class=\"o\">(</span><span class=\"bp\">∀</span><span class=\"err\">&#39;</span> <span class=\"n\">A</span> <span class=\"n\">φ</span><span class=\"o\">)</span>   <span class=\"o\">:=</span> <span class=\"bp\">∀</span><span class=\"err\">&#39;</span> <span class=\"n\">A</span> <span class=\"o\">(</span><span class=\"n\">subst</span> <span class=\"o\">(</span><span class=\"n\">n</span><span class=\"bp\">+</span><span class=\"mi\">1</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"bp\">^</span> <span class=\"n\">x</span><span class=\"o\">)</span> <span class=\"n\">φ</span><span class=\"o\">)</span>\n  <span class=\"bp\">|</span> <span class=\"n\">n</span> <span class=\"n\">x</span> <span class=\"o\">(</span><span class=\"bp\">∃</span><span class=\"err\">&#39;</span> <span class=\"n\">A</span> <span class=\"n\">φ</span><span class=\"o\">)</span>   <span class=\"o\">:=</span> <span class=\"bp\">∃</span><span class=\"err\">&#39;</span> <span class=\"n\">A</span> <span class=\"o\">(</span><span class=\"n\">subst</span> <span class=\"o\">(</span><span class=\"n\">n</span><span class=\"bp\">+</span><span class=\"mi\">1</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"bp\">^</span> <span class=\"n\">x</span><span class=\"o\">)</span> <span class=\"n\">φ</span><span class=\"o\">)</span>\n\n  <span class=\"kn\">notation</span>  <span class=\"bp\">`</span><span class=\"err\">⁅</span><span class=\"bp\">`</span> <span class=\"n\">φ</span> <span class=\"bp\">`</span> <span class=\"bp\">//</span> <span class=\"bp\">`</span>  <span class=\"n\">b</span> <span class=\"bp\">`</span><span class=\"err\">⁆</span><span class=\"bp\">`</span> <span class=\"o\">:=</span> <span class=\"n\">subst</span> <span class=\"mi\">0</span> <span class=\"n\">b</span> <span class=\"n\">φ</span>\n\n  <span class=\"bp\">#</span><span class=\"n\">reduce</span> <span class=\"err\">⁅</span> <span class=\"err\">↑</span><span class=\"mi\">0</span> <span class=\"bp\">//</span> <span class=\"err\">⊤</span> <span class=\"err\">⋀</span> <span class=\"err\">⊥⁆</span>\n  <span class=\"bp\">#</span><span class=\"n\">reduce</span> <span class=\"err\">⁅</span> <span class=\"err\">↑</span><span class=\"mi\">1</span> <span class=\"bp\">//</span> <span class=\"err\">⊤</span> <span class=\"err\">⋀</span> <span class=\"err\">⊥⁆</span>\n\n  <span class=\"n\">def</span> <span class=\"n\">FV</span> <span class=\"o\">:</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">finset</span> <span class=\"bp\">ℕ</span>\n  <span class=\"bp\">|</span> <span class=\"err\">⁎</span>          <span class=\"o\">:=</span> <span class=\"err\">∅</span>\n  <span class=\"bp\">|</span> <span class=\"err\">⊤</span>          <span class=\"o\">:=</span> <span class=\"err\">∅</span>\n  <span class=\"bp\">|</span> <span class=\"err\">⊥</span>          <span class=\"o\">:=</span> <span class=\"err\">∅</span>\n  <span class=\"bp\">|</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"err\">⋀</span> <span class=\"n\">q</span><span class=\"o\">)</span>    <span class=\"o\">:=</span> <span class=\"n\">FV</span> <span class=\"n\">p</span> <span class=\"err\">∪</span> <span class=\"n\">FV</span> <span class=\"n\">q</span>\n  <span class=\"bp\">|</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"err\">⋁</span> <span class=\"n\">q</span><span class=\"o\">)</span>    <span class=\"o\">:=</span> <span class=\"n\">FV</span> <span class=\"n\">p</span> <span class=\"err\">∪</span> <span class=\"n\">FV</span> <span class=\"n\">q</span>\n  <span class=\"bp\">|</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"err\">⟹</span> <span class=\"n\">q</span><span class=\"o\">)</span>  <span class=\"o\">:=</span> <span class=\"n\">FV</span> <span class=\"n\">p</span> <span class=\"err\">∪</span> <span class=\"n\">FV</span> <span class=\"n\">q</span>\n  <span class=\"bp\">|</span> <span class=\"o\">(</span><span class=\"n\">a</span> <span class=\"err\">∈</span> <span class=\"n\">α</span><span class=\"o\">)</span>    <span class=\"o\">:=</span> <span class=\"n\">FV</span> <span class=\"n\">a</span> <span class=\"err\">∪</span> <span class=\"n\">FV</span> <span class=\"n\">α</span>\n  <span class=\"bp\">|</span> <span class=\"err\">⟪</span><span class=\"n\">a</span><span class=\"o\">,</span><span class=\"n\">b</span><span class=\"err\">⟫</span>      <span class=\"o\">:=</span> <span class=\"n\">FV</span> <span class=\"n\">a</span> <span class=\"err\">∪</span> <span class=\"n\">FV</span> <span class=\"n\">b</span>\n  <span class=\"bp\">|</span> <span class=\"o\">(</span><span class=\"n\">var</span> <span class=\"n\">m</span><span class=\"o\">)</span>    <span class=\"o\">:=</span> <span class=\"n\">finset</span><span class=\"bp\">.</span><span class=\"n\">singleton</span> <span class=\"n\">m</span>\n  <span class=\"bp\">|</span> <span class=\"o\">{{</span> <span class=\"n\">A</span> <span class=\"bp\">|</span> <span class=\"n\">φ</span> <span class=\"o\">}}</span>   <span class=\"o\">:=</span> <span class=\"o\">((</span><span class=\"n\">FV</span> <span class=\"n\">φ</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">erase</span> <span class=\"mi\">0</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">image</span> <span class=\"n\">nat</span><span class=\"bp\">.</span><span class=\"n\">pred</span>\n  <span class=\"bp\">|</span> <span class=\"o\">(</span><span class=\"bp\">∀</span><span class=\"err\">&#39;</span> <span class=\"n\">A</span> <span class=\"n\">φ</span><span class=\"o\">)</span>   <span class=\"o\">:=</span> <span class=\"o\">((</span><span class=\"n\">FV</span> <span class=\"n\">φ</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">erase</span> <span class=\"mi\">0</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">image</span> <span class=\"n\">nat</span><span class=\"bp\">.</span><span class=\"n\">pred</span>\n  <span class=\"bp\">|</span> <span class=\"o\">(</span><span class=\"bp\">∃</span><span class=\"err\">&#39;</span> <span class=\"n\">A</span> <span class=\"n\">φ</span><span class=\"o\">)</span>   <span class=\"o\">:=</span> <span class=\"o\">((</span><span class=\"n\">FV</span> <span class=\"n\">φ</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">erase</span> <span class=\"mi\">0</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">image</span> <span class=\"n\">nat</span><span class=\"bp\">.</span><span class=\"n\">pred</span>\n\n\n<span class=\"kn\">end</span> <span class=\"n\">substitution</span>\n\n\n\n<span class=\"n\">def</span> <span class=\"n\">eq</span> <span class=\"o\">(</span><span class=\"n\">A</span><span class=\"o\">:</span><span class=\"n\">type</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">a₁</span> <span class=\"n\">a₂</span> <span class=\"o\">:</span> <span class=\"n\">term</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">term</span> <span class=\"o\">:=</span> <span class=\"bp\">∀</span><span class=\"err\">&#39;</span> <span class=\"o\">(</span><span class=\"err\">𝒫</span> <span class=\"n\">A</span><span class=\"o\">)</span> <span class=\"err\">$</span> <span class=\"o\">((</span><span class=\"bp\">^</span> <span class=\"n\">a₁</span><span class=\"o\">)</span> <span class=\"err\">∈</span> <span class=\"err\">↑</span><span class=\"mi\">0</span><span class=\"o\">)</span> <span class=\"err\">⇔</span> <span class=\"o\">((</span><span class=\"bp\">^</span> <span class=\"n\">a₂</span><span class=\"o\">)</span> <span class=\"err\">∈</span> <span class=\"err\">↑</span><span class=\"mi\">0</span><span class=\"o\">)</span>\n<span class=\"kn\">notation</span> <span class=\"n\">a</span> <span class=\"bp\">`</span> <span class=\"err\">≃</span><span class=\"o\">[</span><span class=\"bp\">`</span><span class=\"o\">:</span><span class=\"n\">max</span> <span class=\"n\">A</span> <span class=\"bp\">`</span><span class=\"o\">]</span> <span class=\"bp\">`</span><span class=\"o\">:</span><span class=\"mi\">0</span> <span class=\"n\">b</span> <span class=\"o\">:=</span> <span class=\"n\">eq</span> <span class=\"n\">A</span> <span class=\"n\">a</span> <span class=\"n\">b</span>\n\n<span class=\"bp\">#</span><span class=\"kn\">check</span> <span class=\"n\">eq</span> <span class=\"mi\">𝟙</span> <span class=\"err\">↑</span><span class=\"mi\">0</span> <span class=\"err\">↑</span><span class=\"mi\">0</span>\n\n<span class=\"n\">def</span> <span class=\"n\">singleton</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"o\">:</span> <span class=\"n\">type</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">a</span> <span class=\"o\">:</span> <span class=\"n\">term</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"o\">{{</span><span class=\"n\">A</span> <span class=\"bp\">|</span> <span class=\"o\">(</span><span class=\"bp\">^</span> <span class=\"n\">a</span><span class=\"o\">)</span> <span class=\"err\">≃</span><span class=\"o\">[</span><span class=\"n\">A</span><span class=\"o\">]</span> <span class=\"err\">↑</span><span class=\"mi\">0</span><span class=\"o\">}}</span>\n\n<span class=\"n\">def</span> <span class=\"n\">ex_unique</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"o\">:</span> <span class=\"n\">type</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">φ</span> <span class=\"o\">:</span> <span class=\"n\">term</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">term</span> <span class=\"o\">:=</span>\n  <span class=\"bp\">∃</span><span class=\"err\">&#39;</span> <span class=\"n\">A</span> <span class=\"o\">({{</span> <span class=\"n\">A</span> <span class=\"bp\">|</span> <span class=\"n\">φ</span> <span class=\"o\">}}</span> <span class=\"err\">≃</span><span class=\"o\">[</span><span class=\"err\">𝒫</span> <span class=\"n\">A</span><span class=\"o\">]</span> <span class=\"o\">(</span><span class=\"n\">singleton</span> <span class=\"n\">A</span> <span class=\"err\">↑</span><span class=\"mi\">0</span><span class=\"o\">))</span>\n<span class=\"kn\">prefix</span> <span class=\"bp\">`∃!</span><span class=\"err\">&#39;</span><span class=\"bp\">`</span><span class=\"o\">:</span><span class=\"mi\">2</span> <span class=\"o\">:=</span> <span class=\"n\">ex_unique</span>\n\n<span class=\"n\">def</span> <span class=\"n\">subseteq</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"o\">:</span> <span class=\"n\">type</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">α</span> <span class=\"o\">:</span> <span class=\"n\">term</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">β</span> <span class=\"o\">:</span> <span class=\"n\">term</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">term</span> <span class=\"o\">:=</span>\n  <span class=\"bp\">∀</span><span class=\"err\">&#39;</span> <span class=\"n\">A</span> <span class=\"o\">(</span><span class=\"err\">↑</span><span class=\"mi\">0</span> <span class=\"err\">∈</span> <span class=\"o\">(</span><span class=\"bp\">^</span> <span class=\"n\">α</span><span class=\"o\">))</span> <span class=\"err\">⟹</span> <span class=\"o\">(</span><span class=\"err\">↑</span><span class=\"mi\">0</span> <span class=\"err\">∈</span> <span class=\"o\">(</span><span class=\"bp\">^</span> <span class=\"n\">β</span><span class=\"o\">))</span>\n<span class=\"kn\">notation</span> <span class=\"n\">a</span> <span class=\"bp\">`</span> <span class=\"err\">⊆</span><span class=\"o\">[</span><span class=\"bp\">`</span><span class=\"o\">:</span><span class=\"n\">max</span> <span class=\"n\">A</span> <span class=\"bp\">`</span><span class=\"o\">]</span> <span class=\"bp\">`</span><span class=\"o\">:</span><span class=\"mi\">0</span> <span class=\"n\">b</span> <span class=\"o\">:=</span> <span class=\"n\">subseteq</span> <span class=\"n\">A</span> <span class=\"n\">a</span> <span class=\"n\">b</span>\n\n<span class=\"n\">def</span> <span class=\"n\">term_prod</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"n\">B</span> <span class=\"o\">:</span> <span class=\"n\">type</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">α</span> <span class=\"n\">β</span> <span class=\"o\">:</span> <span class=\"n\">term</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">term</span> <span class=\"o\">:=</span>\n  <span class=\"o\">{{</span> <span class=\"n\">A</span> <span class=\"err\">𝕏</span> <span class=\"n\">B</span> <span class=\"bp\">|</span> <span class=\"bp\">∃</span><span class=\"err\">&#39;</span> <span class=\"n\">A</span> <span class=\"o\">(</span><span class=\"bp\">∃</span><span class=\"err\">&#39;</span> <span class=\"n\">B</span> <span class=\"o\">((</span><span class=\"err\">↑</span><span class=\"mi\">1</span> <span class=\"err\">∈</span> <span class=\"n\">α</span><span class=\"o\">)</span> <span class=\"err\">⋀</span> <span class=\"o\">(</span><span class=\"err\">↑</span><span class=\"mi\">0</span> <span class=\"err\">∈</span> <span class=\"n\">β</span><span class=\"o\">)</span> <span class=\"err\">⋀</span> <span class=\"o\">(</span><span class=\"err\">↑</span><span class=\"mi\">2</span> <span class=\"err\">≃</span><span class=\"o\">[</span><span class=\"n\">A</span> <span class=\"err\">𝕏</span> <span class=\"n\">B</span><span class=\"o\">]</span> <span class=\"err\">⟪↑</span><span class=\"mi\">1</span><span class=\"o\">,</span><span class=\"err\">↑</span><span class=\"mi\">0</span><span class=\"err\">⟫</span><span class=\"o\">)))}}</span>\n<span class=\"c1\">-- notation α ` 𝕏[`:max A,B `] `:0 β := term_prod A B α β</span>\n\n<span class=\"kn\">section</span>\n  <span class=\"kn\">variables</span> <span class=\"n\">p</span> <span class=\"n\">q</span> <span class=\"n\">r</span> <span class=\"o\">:</span> <span class=\"n\">term</span>\n\n  <span class=\"bp\">#</span><span class=\"kn\">check</span> <span class=\"n\">p</span> <span class=\"err\">⋀</span> <span class=\"o\">(</span><span class=\"n\">q</span> <span class=\"err\">⋁</span> <span class=\"n\">r</span><span class=\"o\">)</span>\n  <span class=\"bp\">#</span><span class=\"kn\">check</span> <span class=\"bp\">∃</span><span class=\"err\">&#39;</span> <span class=\"mi\">𝟙</span> <span class=\"o\">(</span><span class=\"bp\">∀</span><span class=\"err\">&#39;</span> <span class=\"mi\">𝟙</span> <span class=\"o\">(</span><span class=\"bp\">∀</span><span class=\"err\">&#39;</span> <span class=\"o\">(</span><span class=\"err\">𝒫</span> <span class=\"mi\">𝟙</span><span class=\"o\">)</span> <span class=\"o\">((</span><span class=\"n\">var</span> <span class=\"mi\">2</span><span class=\"o\">)</span> <span class=\"err\">∈</span> <span class=\"o\">(</span><span class=\"n\">var</span> <span class=\"mi\">0</span><span class=\"o\">)</span> <span class=\"err\">⇔</span> <span class=\"o\">(</span><span class=\"n\">var</span> <span class=\"mi\">1</span><span class=\"o\">)</span> <span class=\"err\">∈</span> <span class=\"o\">(</span><span class=\"n\">var</span> <span class=\"mi\">0</span><span class=\"o\">))))</span>\n<span class=\"kn\">end</span>\n\n\n<span class=\"bp\">@</span><span class=\"o\">[</span><span class=\"n\">simp</span><span class=\"o\">]</span>\n<span class=\"kn\">lemma</span> <span class=\"n\">subst</span><span class=\"bp\">.</span><span class=\"n\">subseteq</span> <span class=\"o\">{</span><span class=\"n\">x</span> <span class=\"n\">n</span> <span class=\"n\">α</span> <span class=\"n\">β</span> <span class=\"n\">A</span><span class=\"o\">}:</span> <span class=\"n\">subst</span> <span class=\"n\">n</span> <span class=\"n\">x</span> <span class=\"o\">(</span><span class=\"n\">α</span> <span class=\"err\">⊆</span><span class=\"o\">[</span><span class=\"n\">A</span><span class=\"o\">]</span> <span class=\"n\">β</span><span class=\"o\">)</span> <span class=\"bp\">=</span> <span class=\"o\">(</span><span class=\"n\">subst</span> <span class=\"n\">n</span> <span class=\"n\">x</span> <span class=\"n\">α</span><span class=\"o\">)</span> <span class=\"err\">⊆</span><span class=\"o\">[</span><span class=\"n\">A</span><span class=\"o\">]</span> <span class=\"o\">(</span><span class=\"n\">subst</span> <span class=\"n\">n</span> <span class=\"n\">x</span> <span class=\"n\">β</span><span class=\"o\">)</span> <span class=\"o\">:=</span>\n  <span class=\"n\">sorry</span>\n\n<span class=\"c1\">-- * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *</span>\n<span class=\"kn\">section</span> <span class=\"n\">WellFormedness</span>\n\n<span class=\"kn\">open</span> <span class=\"n\">term</span>\n<span class=\"kn\">open</span> <span class=\"n\">list</span>\n<span class=\"n\">local</span> <span class=\"kn\">notation</span> <span class=\"n\">l₁</span> <span class=\"bp\">++</span> <span class=\"n\">l₂</span> <span class=\"o\">:=</span> <span class=\"n\">list</span><span class=\"bp\">.</span><span class=\"n\">append</span> <span class=\"n\">l₁</span> <span class=\"n\">l₂</span>\n\n<span class=\"n\">def</span> <span class=\"kn\">context</span> <span class=\"o\">:=</span> <span class=\"n\">list</span> <span class=\"n\">type</span>\n\n<span class=\"kn\">variables</span> <span class=\"o\">{</span><span class=\"err\">Γ</span> <span class=\"err\">Δ</span> <span class=\"o\">:</span> <span class=\"kn\">context</span><span class=\"o\">}</span>\n<span class=\"kn\">variables</span> <span class=\"o\">{</span><span class=\"n\">p</span> <span class=\"n\">q</span> <span class=\"n\">r</span> <span class=\"n\">φ</span> <span class=\"n\">a</span> <span class=\"n\">b</span> <span class=\"n\">α</span> <span class=\"o\">:</span> <span class=\"n\">term</span><span class=\"o\">}</span>\n<span class=\"kn\">variables</span> <span class=\"o\">{</span><span class=\"n\">A</span> <span class=\"n\">B</span> <span class=\"err\">Ω&#39;</span> <span class=\"o\">:</span> <span class=\"n\">type</span><span class=\"o\">}</span>\n\n<span class=\"bp\">@</span><span class=\"o\">[</span><span class=\"n\">user_attribute</span><span class=\"o\">]</span>\n<span class=\"n\">meta</span> <span class=\"n\">def</span> <span class=\"n\">WF_rules</span> <span class=\"o\">:</span> <span class=\"n\">user_attribute</span> <span class=\"o\">:=</span>\n<span class=\"o\">{</span> <span class=\"n\">name</span> <span class=\"o\">:=</span> <span class=\"bp\">`</span><span class=\"n\">TT</span><span class=\"bp\">.</span><span class=\"n\">WF_rules</span><span class=\"o\">,</span>\n  <span class=\"n\">descr</span> <span class=\"o\">:=</span> <span class=\"s2\">&quot;lemmas usable to prove Well Formedness&quot;</span> <span class=\"o\">}</span>\n\n<span class=\"n\">meta</span> <span class=\"n\">def</span> <span class=\"n\">tactic</span><span class=\"bp\">.</span><span class=\"n\">interactive</span><span class=\"bp\">.</span><span class=\"n\">WF_prover</span> <span class=\"o\">:</span> <span class=\"n\">tactic</span> <span class=\"n\">unit</span><span class=\"o\">:=</span> <span class=\"n\">do</span> <span class=\"bp\">`</span><span class=\"o\">[</span><span class=\"n\">apply_rules</span> <span class=\"n\">WF_rules</span><span class=\"o\">,</span> <span class=\"n\">any_goals</span> <span class=\"o\">{</span><span class=\"n\">refl</span><span class=\"o\">}]</span>\n\n<span class=\"kn\">inductive</span> <span class=\"n\">WF</span> <span class=\"o\">:</span> <span class=\"kn\">context</span> <span class=\"bp\">→</span> <span class=\"n\">type</span> <span class=\"bp\">→</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"kt\">Prop</span>\n<span class=\"bp\">|</span> <span class=\"n\">star</span> <span class=\"o\">{</span><span class=\"err\">Γ</span><span class=\"o\">}</span>         <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"mi\">𝟙</span> <span class=\"err\">⁎</span>\n<span class=\"bp\">|</span> <span class=\"n\">top</span>  <span class=\"o\">{</span><span class=\"err\">Γ</span><span class=\"o\">}</span>         <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"err\">⊤</span>\n<span class=\"bp\">|</span> <span class=\"n\">bot</span>  <span class=\"o\">{</span><span class=\"err\">Γ</span><span class=\"o\">}</span>         <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"err\">⊥</span>\n<span class=\"bp\">|</span> <span class=\"n\">and</span>  <span class=\"o\">{</span><span class=\"err\">Γ</span> <span class=\"n\">p</span> <span class=\"n\">q</span><span class=\"o\">}</span>     <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"n\">p</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"n\">q</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"err\">⋀</span> <span class=\"n\">q</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"n\">or</span>   <span class=\"o\">{</span><span class=\"err\">Γ</span> <span class=\"n\">p</span> <span class=\"n\">q</span><span class=\"o\">}</span>     <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"n\">p</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"n\">q</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"err\">⋁</span> <span class=\"n\">q</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"n\">imp</span>  <span class=\"o\">{</span><span class=\"err\">Γ</span> <span class=\"n\">p</span> <span class=\"n\">q</span><span class=\"o\">}</span>     <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"n\">p</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"n\">q</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"err\">⟹</span> <span class=\"n\">q</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"n\">elem</span> <span class=\"o\">{</span><span class=\"err\">Γ</span> <span class=\"n\">A</span> <span class=\"n\">a</span> <span class=\"n\">α</span><span class=\"o\">}</span>   <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"n\">A</span> <span class=\"n\">a</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"o\">(</span><span class=\"err\">𝒫</span> <span class=\"n\">A</span><span class=\"o\">)</span> <span class=\"n\">α</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"o\">(</span><span class=\"n\">a</span> <span class=\"err\">∈</span> <span class=\"n\">α</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"n\">pair</span> <span class=\"o\">{</span><span class=\"err\">Γ</span> <span class=\"n\">A</span> <span class=\"n\">B</span> <span class=\"n\">a</span> <span class=\"n\">b</span><span class=\"o\">}</span> <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"n\">A</span> <span class=\"n\">a</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"n\">B</span> <span class=\"n\">b</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"err\">𝕏</span> <span class=\"n\">B</span><span class=\"o\">)</span> <span class=\"err\">⟪</span><span class=\"n\">a</span><span class=\"o\">,</span><span class=\"n\">b</span><span class=\"err\">⟫</span>\n<span class=\"bp\">|</span> <span class=\"n\">var</span>  <span class=\"o\">{</span><span class=\"err\">Γ</span> <span class=\"n\">A</span> <span class=\"n\">n</span><span class=\"o\">}</span>     <span class=\"o\">:</span> <span class=\"n\">list</span><span class=\"bp\">.</span><span class=\"n\">nth</span> <span class=\"err\">Γ</span> <span class=\"n\">n</span> <span class=\"bp\">=</span> <span class=\"n\">some</span> <span class=\"n\">A</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"n\">A</span> <span class=\"o\">(</span><span class=\"n\">var</span> <span class=\"n\">n</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"n\">comp</span> <span class=\"o\">{</span><span class=\"err\">Γ</span> <span class=\"n\">A</span> <span class=\"n\">φ</span><span class=\"o\">}</span>     <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"o\">(</span><span class=\"n\">A</span><span class=\"bp\">::</span><span class=\"err\">Γ</span><span class=\"o\">)</span> <span class=\"err\">Ω</span> <span class=\"n\">φ</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"o\">(</span><span class=\"err\">𝒫</span> <span class=\"n\">A</span><span class=\"o\">)</span> <span class=\"o\">{{</span><span class=\"n\">A</span> <span class=\"bp\">|</span> <span class=\"n\">φ</span><span class=\"o\">}}</span>\n<span class=\"bp\">|</span> <span class=\"n\">all</span>  <span class=\"o\">{</span><span class=\"err\">Γ</span> <span class=\"n\">A</span> <span class=\"n\">φ</span><span class=\"o\">}</span>     <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"o\">(</span><span class=\"n\">A</span><span class=\"bp\">::</span><span class=\"err\">Γ</span><span class=\"o\">)</span> <span class=\"err\">Ω</span> <span class=\"n\">φ</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"o\">(</span><span class=\"bp\">∀</span><span class=\"err\">&#39;</span> <span class=\"n\">A</span> <span class=\"n\">φ</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"n\">ex</span>   <span class=\"o\">{</span><span class=\"err\">Γ</span> <span class=\"n\">A</span> <span class=\"n\">φ</span><span class=\"o\">}</span>     <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"o\">(</span><span class=\"n\">A</span><span class=\"bp\">::</span><span class=\"err\">Γ</span><span class=\"o\">)</span> <span class=\"err\">Ω</span> <span class=\"n\">φ</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"o\">(</span><span class=\"bp\">∃</span><span class=\"err\">&#39;</span> <span class=\"n\">A</span> <span class=\"n\">φ</span><span class=\"o\">)</span>\n\n<span class=\"n\">attribute</span> <span class=\"o\">[</span><span class=\"n\">TT</span><span class=\"bp\">.</span><span class=\"n\">WF_rules</span><span class=\"o\">]</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">star</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">top</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">bot</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">and</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">or</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">imp</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">elem</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">pair</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">var</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">comp</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">all</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">ex</span>\n\n\n<span class=\"c1\">-- Ω&#39; is just a fake/variable version of Ω so we don&#39;t need to bother proving</span>\n<span class=\"c1\">-- that it must be Ω itself.&#39;</span>\n\n<span class=\"n\">meta</span> <span class=\"n\">def</span> <span class=\"n\">WF_cases</span> <span class=\"o\">:</span> <span class=\"n\">tactic</span> <span class=\"n\">unit</span> <span class=\"o\">:=</span> <span class=\"n\">do</span> <span class=\"bp\">`</span><span class=\"o\">[</span><span class=\"n\">intro</span> <span class=\"n\">h</span><span class=\"o\">,</span> <span class=\"n\">cases</span> <span class=\"n\">h</span><span class=\"o\">,</span> <span class=\"n\">assumption</span><span class=\"o\">]</span>\n\n<span class=\"kn\">lemma</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">and_left</span>   <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω&#39;</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"err\">⋀</span> <span class=\"n\">q</span><span class=\"o\">)</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω&#39;</span> <span class=\"n\">p</span> <span class=\"o\">:=</span> <span class=\"k\">by</span> <span class=\"n\">WF_cases</span>\n<span class=\"kn\">lemma</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">and_right</span>  <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω&#39;</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"err\">⋀</span> <span class=\"n\">q</span><span class=\"o\">)</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω&#39;</span> <span class=\"n\">q</span> <span class=\"o\">:=</span> <span class=\"k\">by</span> <span class=\"n\">WF_cases</span>\n<span class=\"kn\">lemma</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">or_left</span>    <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω&#39;</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"err\">⋁</span> <span class=\"n\">q</span><span class=\"o\">)</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω&#39;</span> <span class=\"n\">p</span> <span class=\"o\">:=</span> <span class=\"k\">by</span> <span class=\"n\">WF_cases</span>\n<span class=\"kn\">lemma</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">or_right</span>   <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω&#39;</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"err\">⋁</span> <span class=\"n\">q</span><span class=\"o\">)</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω&#39;</span> <span class=\"n\">q</span> <span class=\"o\">:=</span> <span class=\"k\">by</span> <span class=\"n\">WF_cases</span>\n<span class=\"kn\">lemma</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">imp_left</span>   <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω&#39;</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"err\">⟹</span> <span class=\"n\">q</span><span class=\"o\">)</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω&#39;</span> <span class=\"n\">p</span> <span class=\"o\">:=</span> <span class=\"k\">by</span> <span class=\"n\">WF_cases</span>\n<span class=\"kn\">lemma</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">imp_right</span>  <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω&#39;</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"err\">⟹</span> <span class=\"n\">q</span><span class=\"o\">)</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω&#39;</span> <span class=\"n\">q</span> <span class=\"o\">:=</span> <span class=\"k\">by</span> <span class=\"n\">WF_cases</span>\n<span class=\"kn\">lemma</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">pair_left</span>  <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"err\">𝕏</span> <span class=\"n\">B</span><span class=\"o\">)</span> <span class=\"err\">⟪</span><span class=\"n\">a</span><span class=\"o\">,</span><span class=\"n\">b</span><span class=\"err\">⟫</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"n\">A</span> <span class=\"n\">a</span> <span class=\"o\">:=</span> <span class=\"k\">by</span> <span class=\"n\">WF_cases</span>\n<span class=\"kn\">lemma</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">pair_right</span> <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"err\">𝕏</span> <span class=\"n\">B</span><span class=\"o\">)</span> <span class=\"err\">⟪</span><span class=\"n\">a</span><span class=\"o\">,</span><span class=\"n\">b</span><span class=\"err\">⟫</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"n\">B</span> <span class=\"n\">b</span> <span class=\"o\">:=</span> <span class=\"k\">by</span> <span class=\"n\">WF_cases</span>\n<span class=\"kn\">lemma</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">comp_elim</span>  <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"o\">(</span><span class=\"err\">𝒫</span> <span class=\"n\">A</span><span class=\"o\">)</span> <span class=\"o\">{{</span><span class=\"n\">A</span> <span class=\"bp\">|</span> <span class=\"n\">φ</span><span class=\"o\">}}</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"o\">(</span><span class=\"n\">A</span><span class=\"bp\">::</span><span class=\"err\">Γ</span><span class=\"o\">)</span> <span class=\"err\">Ω</span> <span class=\"n\">φ</span> <span class=\"o\">:=</span> <span class=\"k\">by</span> <span class=\"n\">WF_cases</span>\n<span class=\"kn\">lemma</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">all_elim</span>   <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω&#39;</span> <span class=\"o\">(</span><span class=\"bp\">∀</span><span class=\"err\">&#39;</span> <span class=\"n\">A</span> <span class=\"n\">φ</span><span class=\"o\">)</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"o\">(</span><span class=\"n\">A</span><span class=\"bp\">::</span><span class=\"err\">Γ</span><span class=\"o\">)</span> <span class=\"err\">Ω&#39;</span> <span class=\"n\">φ</span> <span class=\"o\">:=</span> <span class=\"k\">by</span> <span class=\"n\">WF_cases</span>\n<span class=\"kn\">lemma</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">ex_elim</span>    <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω&#39;</span> <span class=\"o\">(</span><span class=\"bp\">∃</span><span class=\"err\">&#39;</span> <span class=\"n\">A</span> <span class=\"n\">φ</span><span class=\"o\">)</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"o\">(</span><span class=\"n\">A</span><span class=\"bp\">::</span><span class=\"err\">Γ</span><span class=\"o\">)</span> <span class=\"err\">Ω&#39;</span> <span class=\"n\">φ</span> <span class=\"o\">:=</span> <span class=\"k\">by</span> <span class=\"n\">WF_cases</span>\n<span class=\"bp\">@</span><span class=\"o\">[</span><span class=\"n\">TT</span><span class=\"bp\">.</span><span class=\"n\">WF_rules</span><span class=\"o\">]</span> <span class=\"kn\">lemma</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">iff</span> <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"n\">p</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"n\">q</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"err\">⇔</span> <span class=\"n\">q</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"k\">by</span> <span class=\"o\">{</span><span class=\"n\">intros</span><span class=\"o\">,</span> <span class=\"n\">WF_prover</span><span class=\"o\">}</span>\n</code></pre></div>",
        "id": 201608502,
        "sender_full_name": "Billy Price",
        "timestamp": 1592834231
    },
    {
        "content": "<p>probably because you're in another namespace when you defined <code>WF_prover</code>?</p>",
        "id": 201610099,
        "sender_full_name": "Reid Barton",
        "timestamp": 1592835007
    },
    {
        "content": "<p>it's long and hard to tell</p>",
        "id": 201610109,
        "sender_full_name": "Reid Barton",
        "timestamp": 1592835012
    },
    {
        "content": "<p>that is, if you're inside <code>namespace TT</code> then <code>def foo.bar</code> defined <code>TT.foo.bar</code></p>",
        "id": 201610667,
        "sender_full_name": "Reid Barton",
        "timestamp": 1592835351
    },
    {
        "content": "<p><code>#where</code> will tell you which namespace you're in at a given point in a file (and also what variables you have defined, what you have open...)</p>",
        "id": 201610993,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1592835490
    },
    {
        "content": "<p>I'm failing to deconstruct the arguments to <code>comp</code> in this category definition - I think it's because the first 3 arguments are implicit in <code>comp</code> unlike in <code>hom</code>. The constants are there in place of actual things I've defined.</p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"kn\">import</span> <span class=\"n\">category_theory</span><span class=\"bp\">.</span><span class=\"n\">category</span>\n\n<span class=\"kn\">namespace</span> <span class=\"n\">category_theory</span>\n\n<span class=\"kn\">constant</span> <span class=\"n\">type</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span>\n<span class=\"kn\">constant</span> <span class=\"n\">tset</span> <span class=\"o\">:</span> <span class=\"n\">type</span> <span class=\"bp\">→</span> <span class=\"kt\">Type</span>\n\n<span class=\"kn\">constant</span> <span class=\"n\">graph</span> <span class=\"o\">{</span><span class=\"n\">A</span> <span class=\"n\">B</span><span class=\"o\">}</span> <span class=\"o\">(</span><span class=\"n\">α</span> <span class=\"o\">:</span> <span class=\"n\">tset</span> <span class=\"n\">A</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">β</span> <span class=\"o\">:</span> <span class=\"n\">tset</span> <span class=\"n\">B</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span>\n\n<span class=\"kn\">constant</span> <span class=\"n\">id_graph</span> <span class=\"o\">{</span><span class=\"n\">A</span><span class=\"o\">}</span> <span class=\"o\">(</span><span class=\"n\">α</span> <span class=\"o\">:</span> <span class=\"n\">tset</span> <span class=\"n\">A</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">graph</span> <span class=\"n\">α</span> <span class=\"n\">α</span>\n\n<span class=\"kn\">constant</span> <span class=\"n\">composition</span> <span class=\"o\">{</span><span class=\"n\">A</span> <span class=\"n\">B</span> <span class=\"n\">C</span><span class=\"o\">}</span> <span class=\"o\">{</span><span class=\"n\">α</span> <span class=\"o\">:</span> <span class=\"n\">tset</span> <span class=\"n\">A</span><span class=\"o\">}</span> <span class=\"o\">{</span><span class=\"n\">β</span> <span class=\"o\">:</span> <span class=\"n\">tset</span> <span class=\"n\">B</span><span class=\"o\">}</span> <span class=\"o\">{</span><span class=\"n\">η</span> <span class=\"o\">:</span> <span class=\"n\">tset</span> <span class=\"n\">C</span><span class=\"o\">}</span> <span class=\"o\">(</span><span class=\"n\">F</span> <span class=\"o\">:</span> <span class=\"n\">graph</span> <span class=\"n\">α</span> <span class=\"n\">β</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">G</span> <span class=\"o\">:</span> <span class=\"n\">graph</span> <span class=\"n\">β</span> <span class=\"n\">η</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">graph</span> <span class=\"n\">α</span> <span class=\"n\">η</span>\n\n<span class=\"kn\">instance</span> <span class=\"n\">category</span> <span class=\"o\">:</span> <span class=\"n\">small_category</span> <span class=\"o\">(</span><span class=\"err\">Σ</span> <span class=\"n\">A</span> <span class=\"o\">:</span> <span class=\"n\">type</span><span class=\"o\">,</span> <span class=\"n\">tset</span> <span class=\"n\">A</span><span class=\"o\">)</span> <span class=\"o\">:=</span>\n<span class=\"o\">{</span> <span class=\"n\">hom</span> <span class=\"o\">:=</span> <span class=\"bp\">λ</span> <span class=\"bp\">⟨</span><span class=\"n\">A</span><span class=\"o\">,</span><span class=\"n\">α</span><span class=\"bp\">⟩</span> <span class=\"bp\">⟨</span><span class=\"n\">B</span><span class=\"o\">,</span><span class=\"n\">β</span><span class=\"bp\">⟩</span><span class=\"o\">,</span> <span class=\"n\">graph</span> <span class=\"n\">α</span> <span class=\"n\">β</span><span class=\"o\">,</span>\n  <span class=\"n\">id</span> <span class=\"o\">:=</span> <span class=\"bp\">λ</span> <span class=\"bp\">⟨</span><span class=\"n\">A</span><span class=\"o\">,</span><span class=\"n\">α</span><span class=\"bp\">⟩</span><span class=\"o\">,</span> <span class=\"n\">id_graph</span> <span class=\"n\">α</span><span class=\"o\">,</span>\n  <span class=\"n\">comp</span> <span class=\"o\">:=</span> <span class=\"bp\">λ</span> <span class=\"bp\">⟨</span><span class=\"n\">A</span><span class=\"o\">,</span><span class=\"n\">α</span><span class=\"bp\">⟩</span> <span class=\"bp\">⟨</span><span class=\"n\">B</span><span class=\"o\">,</span><span class=\"n\">β</span><span class=\"bp\">⟩</span> <span class=\"bp\">⟨</span><span class=\"n\">C</span><span class=\"o\">,</span><span class=\"n\">η</span><span class=\"bp\">⟩</span> <span class=\"n\">F</span> <span class=\"n\">G</span><span class=\"o\">,</span> <span class=\"n\">composition</span> <span class=\"n\">F</span> <span class=\"n\">G</span><span class=\"o\">,</span>\n  <span class=\"n\">id_comp&#39;</span> <span class=\"o\">:=</span> <span class=\"n\">sorry</span><span class=\"o\">,</span>\n  <span class=\"n\">comp_id&#39;</span> <span class=\"o\">:=</span> <span class=\"n\">sorry</span><span class=\"o\">,</span>\n  <span class=\"n\">assoc&#39;</span> <span class=\"o\">:=</span> <span class=\"n\">sorry</span>\n<span class=\"o\">}</span>\n\n<span class=\"kn\">end</span> <span class=\"n\">category_theory</span>\n</code></pre></div>\n\n\n<p>I thought it compile, even if I had underscores for the first three arguments - but I get this error.</p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"n\">type</span> <span class=\"n\">mismatch</span> <span class=\"n\">at</span> <span class=\"n\">application</span>\n  <span class=\"n\">composition</span> <span class=\"n\">F</span>\n<span class=\"n\">term</span>\n  <span class=\"n\">F</span>\n<span class=\"n\">has</span> <span class=\"n\">type</span>\n  <span class=\"bp\">_</span><span class=\"n\">x</span> <span class=\"err\">⟶</span> <span class=\"bp\">_</span><span class=\"n\">x_1</span>\n<span class=\"n\">but</span> <span class=\"n\">is</span> <span class=\"n\">expected</span> <span class=\"n\">to</span> <span class=\"k\">have</span> <span class=\"n\">type</span>\n  <span class=\"n\">graph</span> <span class=\"err\">?</span><span class=\"n\">m_3</span> <span class=\"err\">?</span><span class=\"n\">m_4</span>\n</code></pre></div>\n\n\n<p>Evidently <code>composition</code> doesn't know that the hom-type is exactly the graph type it wants.</p>",
        "id": 201716534,
        "sender_full_name": "Billy Price",
        "timestamp": 1592914128
    },
    {
        "content": "<p>You should write the instance this way:</p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"kn\">instance</span> <span class=\"n\">category</span> <span class=\"o\">:</span> <span class=\"n\">small_category</span> <span class=\"o\">(</span><span class=\"err\">Σ</span> <span class=\"n\">A</span> <span class=\"o\">:</span> <span class=\"n\">type</span><span class=\"o\">,</span> <span class=\"n\">tset</span> <span class=\"n\">A</span><span class=\"o\">)</span> <span class=\"o\">:=</span>\n<span class=\"o\">{</span> <span class=\"n\">hom</span> <span class=\"o\">:=</span> <span class=\"bp\">λ</span> <span class=\"n\">A</span> <span class=\"n\">B</span><span class=\"o\">,</span> <span class=\"n\">graph</span> <span class=\"n\">A</span><span class=\"bp\">.</span><span class=\"mi\">2</span> <span class=\"n\">B</span><span class=\"bp\">.</span><span class=\"mi\">2</span><span class=\"o\">,</span>\n  <span class=\"n\">id</span> <span class=\"o\">:=</span> <span class=\"bp\">λ</span> <span class=\"n\">A</span><span class=\"o\">,</span> <span class=\"n\">id_graph</span> <span class=\"n\">A</span><span class=\"bp\">.</span><span class=\"mi\">2</span><span class=\"o\">,</span>\n  <span class=\"n\">comp</span> <span class=\"o\">:=</span> <span class=\"bp\">λ</span> <span class=\"bp\">_</span> <span class=\"bp\">_</span> <span class=\"bp\">_</span> <span class=\"n\">F</span> <span class=\"n\">G</span><span class=\"o\">,</span> <span class=\"n\">composition</span> <span class=\"n\">F</span> <span class=\"n\">G</span><span class=\"o\">,</span>\n  <span class=\"n\">id_comp&#39;</span> <span class=\"o\">:=</span> <span class=\"n\">sorry</span><span class=\"o\">,</span>\n  <span class=\"n\">comp_id&#39;</span> <span class=\"o\">:=</span> <span class=\"n\">sorry</span><span class=\"o\">,</span>\n  <span class=\"n\">assoc&#39;</span> <span class=\"o\">:=</span> <span class=\"n\">sorry</span>\n<span class=\"o\">}</span>\n</code></pre></div>",
        "id": 201718236,
        "sender_full_name": "Reid Barton",
        "timestamp": 1592915305
    },
    {
        "content": "<p>In general, avoid <code>λ ⟨A,α⟩</code> except for proofs</p>",
        "id": 201718497,
        "sender_full_name": "Reid Barton",
        "timestamp": 1592915509
    },
    {
        "content": "<p>Cool thanks!</p>\n<p>I would also like to know how to do deconstruction of terms in this way for hypotheses in a goal state. Something like this but for tactic mode?</p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"kn\">variables</span> <span class=\"o\">(</span><span class=\"n\">α</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"n\">q</span> <span class=\"o\">:</span> <span class=\"n\">α</span> <span class=\"bp\">→</span> <span class=\"kt\">Prop</span><span class=\"o\">)</span>\n\n<span class=\"kn\">example</span> <span class=\"o\">(</span><span class=\"n\">h</span> <span class=\"o\">:</span> <span class=\"bp\">∃</span> <span class=\"n\">x</span><span class=\"o\">,</span> <span class=\"n\">p</span> <span class=\"n\">x</span> <span class=\"bp\">∧</span> <span class=\"n\">q</span> <span class=\"n\">x</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"bp\">∃</span> <span class=\"n\">x</span><span class=\"o\">,</span> <span class=\"n\">q</span> <span class=\"n\">x</span> <span class=\"bp\">∧</span> <span class=\"n\">p</span> <span class=\"n\">x</span> <span class=\"o\">:=</span>\n<span class=\"k\">match</span> <span class=\"n\">h</span> <span class=\"k\">with</span> <span class=\"bp\">⟨</span><span class=\"n\">w</span><span class=\"o\">,</span> <span class=\"n\">hw</span><span class=\"bp\">⟩</span> <span class=\"o\">:=</span>\n  <span class=\"bp\">⟨</span><span class=\"n\">w</span><span class=\"o\">,</span> <span class=\"n\">hw</span><span class=\"bp\">.</span><span class=\"n\">right</span><span class=\"o\">,</span> <span class=\"n\">hw</span><span class=\"bp\">.</span><span class=\"n\">left</span><span class=\"bp\">⟩</span>\n<span class=\"kn\">end</span>\n</code></pre></div>",
        "id": 201718642,
        "sender_full_name": "Billy Price",
        "timestamp": 1592915612
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span><code><span class=\"kn\">example</span> <span class=\"o\">(</span><span class=\"n\">h</span> <span class=\"o\">:</span> <span class=\"bp\">∃</span> <span class=\"n\">x</span><span class=\"o\">,</span> <span class=\"n\">p</span> <span class=\"n\">x</span> <span class=\"bp\">∧</span> <span class=\"n\">q</span> <span class=\"n\">x</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"bp\">∃</span> <span class=\"n\">x</span><span class=\"o\">,</span> <span class=\"n\">q</span> <span class=\"n\">x</span> <span class=\"bp\">∧</span> <span class=\"n\">p</span> <span class=\"n\">x</span> <span class=\"o\">:=</span>\n<span class=\"k\">begin</span>\n  <span class=\"k\">obtain</span> <span class=\"bp\">⟨</span><span class=\"n\">w</span><span class=\"o\">,</span> <span class=\"n\">hw₁</span><span class=\"o\">,</span> <span class=\"n\">hw₂</span><span class=\"bp\">⟩</span> <span class=\"o\">:=</span> <span class=\"n\">h</span><span class=\"o\">,</span> <span class=\"c1\">-- or rcases h with ⟨w, hw₁, hw₂⟩,</span>\n  <span class=\"n\">exact</span> <span class=\"bp\">⟨</span><span class=\"n\">w</span><span class=\"o\">,</span> <span class=\"n\">hw₂</span><span class=\"o\">,</span> <span class=\"n\">hw₁</span><span class=\"bp\">⟩</span>\n<span class=\"kn\">end</span>\n</code></pre></div>",
        "id": 201718981,
        "sender_full_name": "Reid Barton",
        "timestamp": 1592915813
    },
    {
        "content": "<p>Ah awesome, does the <code>r</code> in <code>rcases</code> and <code>rintros</code> refer to the deconstruction of the hypothesis being vaguely recursive?</p>",
        "id": 201719358,
        "sender_full_name": "Billy Price",
        "timestamp": 1592916019
    },
    {
        "content": "<p>Yes, <code>rcases</code> = \"recursive cases\"</p>",
        "id": 201719761,
        "sender_full_name": "Reid Barton",
        "timestamp": 1592916224
    },
    {
        "content": "<p><code>rintro</code> = “recursive intro”</p>",
        "id": 201719886,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1592916284
    },
    {
        "content": "<p>Is it possible to print all definitions/lemmas using sorry?</p>",
        "id": 201720266,
        "sender_full_name": "Billy Price",
        "timestamp": 1592916497
    },
    {
        "content": "<p>Here's something interesting, the first of these is very easy to prove,  but I don't know where to start on the second (I hope I'm not missing something obvious). I feel like perhaps I need to invoke classical reasoning, since I don't actually have anything to work with. I have a suspicion that it's just not true.</p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"kn\">lemma</span> <span class=\"n\">ent_to_meta</span> <span class=\"o\">:</span> <span class=\"n\">entails</span> <span class=\"err\">Γ</span> <span class=\"n\">φ</span> <span class=\"n\">ψ</span>  <span class=\"bp\">→</span> <span class=\"n\">entails</span> <span class=\"err\">Γ</span> <span class=\"err\">⊤</span> <span class=\"n\">φ</span> <span class=\"bp\">→</span> <span class=\"n\">entails</span> <span class=\"err\">Γ</span> <span class=\"err\">⊤</span> <span class=\"n\">ψ</span> <span class=\"o\">:=</span>\n  <span class=\"bp\">λ</span> <span class=\"bp\">_</span> <span class=\"bp\">_</span><span class=\"o\">,</span> <span class=\"o\">(</span><span class=\"k\">by</span> <span class=\"o\">{</span><span class=\"n\">apply</span> <span class=\"n\">entails</span><span class=\"bp\">.</span><span class=\"n\">cut</span> <span class=\"bp\">_</span> <span class=\"n\">φ</span> <span class=\"bp\">_</span><span class=\"o\">,</span> <span class=\"n\">tidy</span><span class=\"o\">})</span>\n\n<span class=\"kn\">lemma</span> <span class=\"n\">meta_to_ent</span> <span class=\"o\">(</span><span class=\"n\">wfφ</span> <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"n\">φ</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">wfψ</span> <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"n\">ψ</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"o\">(</span><span class=\"n\">entails</span> <span class=\"err\">Γ</span> <span class=\"err\">⊤</span> <span class=\"n\">φ</span> <span class=\"bp\">→</span> <span class=\"n\">entails</span> <span class=\"err\">Γ</span> <span class=\"err\">⊤</span> <span class=\"n\">ψ</span><span class=\"o\">)</span> <span class=\"bp\">→</span> <span class=\"n\">entails</span> <span class=\"err\">Γ</span> <span class=\"n\">φ</span> <span class=\"n\">ψ</span> <span class=\"o\">:=</span>\n<span class=\"k\">begin</span>\n  <span class=\"n\">intro</span> <span class=\"n\">h</span><span class=\"o\">,</span>\n  <span class=\"n\">sorry</span>\n<span class=\"kn\">end</span>\n</code></pre></div>",
        "id": 202076800,
        "sender_full_name": "Billy Price",
        "timestamp": 1593169639
    },
    {
        "content": "<p>Here's what <code>entails</code> is.</p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"kn\">inductive</span> <span class=\"n\">entails</span> <span class=\"o\">:</span> <span class=\"kn\">context</span> <span class=\"bp\">→</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"kt\">Prop</span>\n<span class=\"bp\">|</span> <span class=\"n\">axm</span>        <span class=\"o\">{</span><span class=\"err\">Γ</span><span class=\"o\">}</span> <span class=\"o\">{</span><span class=\"n\">p</span><span class=\"o\">}</span>       <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"n\">p</span> <span class=\"bp\">→</span> <span class=\"n\">entails</span> <span class=\"err\">Γ</span> <span class=\"n\">p</span> <span class=\"n\">p</span>\n<span class=\"bp\">|</span> <span class=\"n\">vac</span>        <span class=\"o\">{</span><span class=\"err\">Γ</span><span class=\"o\">}</span> <span class=\"o\">{</span><span class=\"n\">p</span><span class=\"o\">}</span>       <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"n\">p</span> <span class=\"bp\">→</span> <span class=\"n\">entails</span> <span class=\"err\">Γ</span> <span class=\"n\">p</span> <span class=\"err\">⊤</span>\n<span class=\"bp\">|</span> <span class=\"n\">abs</span>        <span class=\"o\">{</span><span class=\"err\">Γ</span><span class=\"o\">}</span> <span class=\"o\">{</span><span class=\"n\">p</span><span class=\"o\">}</span>       <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"n\">p</span> <span class=\"bp\">→</span> <span class=\"n\">entails</span> <span class=\"err\">Γ</span> <span class=\"err\">⊥</span> <span class=\"n\">p</span>\n<span class=\"bp\">|</span> <span class=\"n\">and_intro</span>  <span class=\"o\">{</span><span class=\"err\">Γ</span><span class=\"o\">}</span> <span class=\"o\">{</span><span class=\"n\">p</span> <span class=\"n\">q</span> <span class=\"n\">r</span><span class=\"o\">}</span>   <span class=\"o\">:</span> <span class=\"n\">entails</span> <span class=\"err\">Γ</span> <span class=\"n\">p</span> <span class=\"n\">q</span> <span class=\"bp\">→</span> <span class=\"n\">entails</span> <span class=\"err\">Γ</span> <span class=\"n\">p</span> <span class=\"n\">r</span> <span class=\"bp\">→</span> <span class=\"n\">entails</span> <span class=\"err\">Γ</span> <span class=\"n\">p</span> <span class=\"o\">(</span><span class=\"n\">q</span> <span class=\"err\">⋀</span> <span class=\"n\">r</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"n\">and_left</span>   <span class=\"o\">{</span><span class=\"err\">Γ</span><span class=\"o\">}</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"n\">q</span> <span class=\"n\">r</span><span class=\"o\">)</span>   <span class=\"o\">:</span> <span class=\"n\">entails</span> <span class=\"err\">Γ</span> <span class=\"n\">p</span> <span class=\"o\">(</span><span class=\"n\">q</span> <span class=\"err\">⋀</span> <span class=\"n\">r</span><span class=\"o\">)</span> <span class=\"bp\">→</span> <span class=\"n\">entails</span> <span class=\"err\">Γ</span> <span class=\"n\">p</span> <span class=\"n\">q</span>\n<span class=\"bp\">|</span> <span class=\"n\">and_right</span>  <span class=\"o\">{</span><span class=\"err\">Γ</span><span class=\"o\">}</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"n\">q</span> <span class=\"n\">r</span><span class=\"o\">)</span>   <span class=\"o\">:</span> <span class=\"n\">entails</span> <span class=\"err\">Γ</span> <span class=\"n\">p</span> <span class=\"o\">(</span><span class=\"n\">q</span> <span class=\"err\">⋀</span> <span class=\"n\">r</span><span class=\"o\">)</span> <span class=\"bp\">→</span> <span class=\"n\">entails</span> <span class=\"err\">Γ</span> <span class=\"n\">p</span> <span class=\"n\">r</span>\n<span class=\"bp\">|</span> <span class=\"n\">or_intro</span>   <span class=\"o\">{</span><span class=\"err\">Γ</span><span class=\"o\">}</span> <span class=\"o\">{</span><span class=\"n\">p</span> <span class=\"n\">q</span> <span class=\"n\">r</span><span class=\"o\">}</span>   <span class=\"o\">:</span> <span class=\"n\">entails</span> <span class=\"err\">Γ</span> <span class=\"n\">p</span> <span class=\"n\">r</span> <span class=\"bp\">→</span> <span class=\"n\">entails</span> <span class=\"err\">Γ</span> <span class=\"n\">q</span> <span class=\"n\">r</span> <span class=\"bp\">→</span> <span class=\"n\">entails</span> <span class=\"err\">Γ</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"err\">⋁</span> <span class=\"n\">q</span><span class=\"o\">)</span> <span class=\"n\">r</span>\n<span class=\"bp\">|</span> <span class=\"n\">or_left</span>    <span class=\"o\">{</span><span class=\"err\">Γ</span><span class=\"o\">}</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"n\">q</span> <span class=\"n\">r</span><span class=\"o\">)</span>   <span class=\"o\">:</span> <span class=\"n\">entails</span> <span class=\"err\">Γ</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"err\">⋁</span> <span class=\"n\">q</span><span class=\"o\">)</span> <span class=\"n\">r</span> <span class=\"bp\">→</span> <span class=\"n\">entails</span> <span class=\"err\">Γ</span> <span class=\"n\">p</span> <span class=\"n\">r</span>\n<span class=\"bp\">|</span> <span class=\"n\">or_right</span>   <span class=\"o\">{</span><span class=\"err\">Γ</span><span class=\"o\">}</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"n\">q</span> <span class=\"n\">r</span><span class=\"o\">)</span>   <span class=\"o\">:</span> <span class=\"n\">entails</span> <span class=\"err\">Γ</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"err\">⋁</span> <span class=\"n\">q</span><span class=\"o\">)</span> <span class=\"n\">r</span> <span class=\"bp\">→</span> <span class=\"n\">entails</span> <span class=\"err\">Γ</span> <span class=\"n\">q</span> <span class=\"n\">r</span>\n<span class=\"bp\">|</span> <span class=\"n\">imp_to_and</span> <span class=\"o\">{</span><span class=\"err\">Γ</span><span class=\"o\">}</span> <span class=\"o\">{</span><span class=\"n\">p</span> <span class=\"n\">q</span> <span class=\"n\">r</span><span class=\"o\">}</span>   <span class=\"o\">:</span> <span class=\"n\">entails</span> <span class=\"err\">Γ</span> <span class=\"n\">p</span> <span class=\"o\">(</span><span class=\"n\">q</span> <span class=\"err\">⟹</span> <span class=\"n\">r</span><span class=\"o\">)</span> <span class=\"bp\">→</span> <span class=\"n\">entails</span> <span class=\"err\">Γ</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"err\">⋀</span> <span class=\"n\">q</span><span class=\"o\">)</span> <span class=\"n\">r</span>\n<span class=\"bp\">|</span> <span class=\"n\">and_to_imp</span> <span class=\"o\">{</span><span class=\"err\">Γ</span><span class=\"o\">}</span> <span class=\"o\">{</span><span class=\"n\">p</span> <span class=\"n\">q</span> <span class=\"n\">r</span><span class=\"o\">}</span>   <span class=\"o\">:</span> <span class=\"n\">entails</span> <span class=\"err\">Γ</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"err\">⋀</span> <span class=\"n\">q</span><span class=\"o\">)</span> <span class=\"n\">r</span> <span class=\"bp\">→</span> <span class=\"n\">entails</span> <span class=\"err\">Γ</span> <span class=\"n\">p</span> <span class=\"o\">(</span><span class=\"n\">q</span> <span class=\"err\">⟹</span> <span class=\"n\">r</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"n\">weakening</span>  <span class=\"o\">{</span><span class=\"err\">Γ</span><span class=\"o\">}</span> <span class=\"o\">{</span><span class=\"n\">p</span> <span class=\"n\">q</span><span class=\"o\">}</span> <span class=\"o\">(</span><span class=\"err\">Δ</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">entails</span> <span class=\"err\">Γ</span> <span class=\"n\">p</span> <span class=\"n\">q</span> <span class=\"bp\">→</span> <span class=\"n\">entails</span> <span class=\"o\">(</span><span class=\"n\">list</span><span class=\"bp\">.</span><span class=\"n\">append</span> <span class=\"err\">Γ</span> <span class=\"err\">Δ</span><span class=\"o\">)</span> <span class=\"n\">p</span> <span class=\"n\">q</span>\n<span class=\"bp\">|</span> <span class=\"n\">cut</span>        <span class=\"o\">{</span><span class=\"err\">Γ</span><span class=\"o\">}</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"n\">c</span> <span class=\"n\">q</span><span class=\"o\">)</span>   <span class=\"o\">:</span> <span class=\"n\">entails</span> <span class=\"err\">Γ</span> <span class=\"n\">p</span> <span class=\"n\">c</span> <span class=\"bp\">→</span> <span class=\"n\">entails</span> <span class=\"err\">Γ</span> <span class=\"n\">c</span> <span class=\"n\">q</span> <span class=\"bp\">→</span> <span class=\"n\">entails</span> <span class=\"err\">Γ</span> <span class=\"n\">p</span> <span class=\"n\">q</span>\n<span class=\"bp\">|</span> <span class=\"n\">all_elim</span>   <span class=\"o\">{</span><span class=\"err\">Γ</span><span class=\"o\">}</span> <span class=\"o\">{</span><span class=\"n\">p</span> <span class=\"n\">φ</span> <span class=\"n\">A</span><span class=\"o\">}</span>   <span class=\"o\">:</span> <span class=\"n\">entails</span> <span class=\"err\">Γ</span> <span class=\"n\">p</span> <span class=\"o\">(</span><span class=\"bp\">∀</span><span class=\"o\">[</span><span class=\"n\">A</span><span class=\"o\">]</span> <span class=\"n\">φ</span><span class=\"o\">)</span> <span class=\"bp\">→</span> <span class=\"n\">entails</span> <span class=\"o\">(</span><span class=\"n\">A</span><span class=\"bp\">::</span><span class=\"err\">Γ</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"bp\">^</span> <span class=\"n\">p</span><span class=\"o\">)</span> <span class=\"n\">φ</span>\n<span class=\"bp\">|</span> <span class=\"n\">all_intro</span>  <span class=\"o\">{</span><span class=\"err\">Γ</span><span class=\"o\">}</span> <span class=\"o\">{</span><span class=\"n\">p</span> <span class=\"n\">φ</span><span class=\"o\">}</span> <span class=\"o\">(</span><span class=\"n\">A</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">entails</span> <span class=\"o\">(</span><span class=\"n\">A</span><span class=\"bp\">::</span><span class=\"err\">Γ</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"bp\">^</span> <span class=\"n\">p</span><span class=\"o\">)</span> <span class=\"n\">φ</span> <span class=\"bp\">→</span> <span class=\"n\">entails</span> <span class=\"err\">Γ</span> <span class=\"n\">p</span> <span class=\"o\">(</span><span class=\"bp\">∀</span><span class=\"o\">[</span><span class=\"n\">A</span><span class=\"o\">]</span> <span class=\"n\">φ</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"n\">ex_elim</span>    <span class=\"o\">{</span><span class=\"err\">Γ</span><span class=\"o\">}</span> <span class=\"o\">{</span><span class=\"n\">p</span> <span class=\"n\">φ</span> <span class=\"n\">A</span><span class=\"o\">}</span>   <span class=\"o\">:</span> <span class=\"n\">entails</span> <span class=\"err\">Γ</span> <span class=\"n\">p</span> <span class=\"o\">(</span><span class=\"bp\">∃</span><span class=\"o\">[</span><span class=\"n\">A</span><span class=\"o\">]</span> <span class=\"n\">φ</span><span class=\"o\">)</span> <span class=\"bp\">→</span> <span class=\"n\">entails</span> <span class=\"o\">(</span><span class=\"n\">A</span><span class=\"bp\">::</span><span class=\"err\">Γ</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"bp\">^</span> <span class=\"n\">p</span><span class=\"o\">)</span> <span class=\"n\">φ</span>\n<span class=\"bp\">|</span> <span class=\"n\">ex_intro</span>   <span class=\"o\">{</span><span class=\"err\">Γ</span><span class=\"o\">}</span> <span class=\"o\">{</span><span class=\"n\">p</span> <span class=\"n\">φ</span><span class=\"o\">}</span> <span class=\"o\">(</span><span class=\"n\">A</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">entails</span> <span class=\"o\">(</span><span class=\"n\">A</span><span class=\"bp\">::</span><span class=\"err\">Γ</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"bp\">^</span> <span class=\"n\">p</span><span class=\"o\">)</span> <span class=\"n\">φ</span> <span class=\"bp\">→</span> <span class=\"n\">entails</span> <span class=\"err\">Γ</span> <span class=\"n\">p</span> <span class=\"o\">(</span><span class=\"bp\">∃</span><span class=\"o\">[</span><span class=\"n\">A</span><span class=\"o\">]</span> <span class=\"n\">φ</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"n\">extensionality</span> <span class=\"o\">{</span><span class=\"n\">A</span><span class=\"o\">}</span>       <span class=\"o\">:</span> <span class=\"n\">entails</span> <span class=\"o\">[]</span> <span class=\"err\">⊤</span> <span class=\"err\">$</span> <span class=\"bp\">∀</span><span class=\"o\">[</span><span class=\"err\">𝒫</span> <span class=\"n\">A</span><span class=\"o\">,</span> <span class=\"err\">𝒫</span> <span class=\"n\">A</span><span class=\"o\">]</span> <span class=\"err\">$</span> <span class=\"o\">(</span><span class=\"bp\">∀</span><span class=\"err\">&#39;</span> <span class=\"n\">A</span> <span class=\"err\">$</span> <span class=\"o\">(</span><span class=\"err\">↑</span><span class=\"mi\">0</span> <span class=\"err\">∈</span> <span class=\"err\">↑</span><span class=\"mi\">2</span><span class=\"o\">)</span> <span class=\"err\">⇔</span> <span class=\"o\">(</span><span class=\"err\">↑</span><span class=\"mi\">0</span> <span class=\"err\">∈</span> <span class=\"err\">↑</span><span class=\"mi\">1</span><span class=\"o\">))</span> <span class=\"err\">⟹</span> <span class=\"o\">(</span><span class=\"err\">↑</span><span class=\"mi\">1</span> <span class=\"err\">≃</span><span class=\"o\">[</span><span class=\"err\">𝒫</span> <span class=\"n\">A</span><span class=\"o\">]</span> <span class=\"err\">↑</span><span class=\"mi\">0</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"n\">prop_ext</span>                 <span class=\"o\">:</span> <span class=\"n\">entails</span> <span class=\"o\">[]</span> <span class=\"err\">⊤</span> <span class=\"err\">$</span> <span class=\"bp\">∀</span><span class=\"o\">[</span><span class=\"err\">Ω</span><span class=\"o\">,</span><span class=\"err\">Ω</span><span class=\"o\">]</span> <span class=\"err\">$</span> <span class=\"o\">(</span><span class=\"err\">↑</span><span class=\"mi\">1</span> <span class=\"err\">⇔</span> <span class=\"err\">↑</span><span class=\"mi\">0</span><span class=\"o\">)</span> <span class=\"err\">⟹</span> <span class=\"o\">(</span><span class=\"err\">↑</span><span class=\"mi\">1</span> <span class=\"err\">≃</span><span class=\"o\">[</span><span class=\"err\">Ω</span><span class=\"o\">]</span> <span class=\"err\">↑</span><span class=\"mi\">0</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"n\">star_unique</span>              <span class=\"o\">:</span> <span class=\"n\">entails</span> <span class=\"o\">[]</span> <span class=\"err\">⊤</span> <span class=\"err\">$</span> <span class=\"bp\">∀</span><span class=\"o\">[</span><span class=\"mi\">𝟙</span><span class=\"o\">]</span> <span class=\"o\">(</span><span class=\"err\">↑</span><span class=\"mi\">0</span> <span class=\"err\">≃</span><span class=\"o\">[</span><span class=\"mi\">𝟙</span><span class=\"o\">]</span> <span class=\"err\">⁎</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"n\">pair_rep</span>      <span class=\"o\">{</span><span class=\"n\">A</span> <span class=\"n\">B</span><span class=\"o\">}</span>      <span class=\"o\">:</span> <span class=\"n\">entails</span> <span class=\"o\">[]</span> <span class=\"err\">⊤</span> <span class=\"err\">$</span> <span class=\"bp\">∀</span><span class=\"o\">[</span><span class=\"n\">A</span> <span class=\"err\">𝕏</span> <span class=\"n\">B</span><span class=\"o\">]</span> <span class=\"err\">$</span> <span class=\"bp\">∃</span><span class=\"o\">[</span><span class=\"n\">A</span><span class=\"o\">,</span><span class=\"n\">B</span><span class=\"o\">]</span> <span class=\"err\">$</span> <span class=\"err\">↑</span><span class=\"mi\">2</span> <span class=\"err\">≃</span><span class=\"o\">[</span><span class=\"n\">A</span> <span class=\"err\">𝕏</span> <span class=\"n\">B</span><span class=\"o\">]</span> <span class=\"err\">⟪↑</span><span class=\"mi\">1</span><span class=\"o\">,</span><span class=\"err\">↑</span><span class=\"mi\">0</span><span class=\"err\">⟫</span>\n<span class=\"bp\">|</span> <span class=\"n\">pair_distinct</span> <span class=\"o\">{</span><span class=\"n\">A</span> <span class=\"n\">B</span><span class=\"o\">}</span>      <span class=\"o\">:</span> <span class=\"n\">entails</span> <span class=\"o\">[]</span> <span class=\"err\">⊤</span> <span class=\"err\">$</span> <span class=\"bp\">∀</span><span class=\"o\">[</span><span class=\"n\">A</span><span class=\"o\">,</span><span class=\"n\">B</span><span class=\"o\">,</span><span class=\"n\">A</span><span class=\"o\">,</span><span class=\"n\">B</span><span class=\"o\">]</span> <span class=\"err\">$</span> <span class=\"o\">(</span><span class=\"err\">⟪↑</span><span class=\"mi\">3</span><span class=\"o\">,</span><span class=\"err\">↑</span><span class=\"mi\">2</span><span class=\"err\">⟫</span> <span class=\"err\">≃</span><span class=\"o\">[</span><span class=\"n\">A</span> <span class=\"err\">𝕏</span> <span class=\"n\">B</span><span class=\"o\">]</span> <span class=\"err\">⟪↑</span><span class=\"mi\">1</span><span class=\"o\">,</span><span class=\"err\">↑</span><span class=\"mi\">0</span><span class=\"err\">⟫</span><span class=\"o\">)</span> <span class=\"err\">⟹</span> <span class=\"o\">((</span><span class=\"err\">↑</span><span class=\"mi\">3</span> <span class=\"err\">≃</span><span class=\"o\">[</span><span class=\"n\">A</span><span class=\"o\">]</span> <span class=\"err\">↑</span><span class=\"mi\">1</span><span class=\"o\">)</span> <span class=\"err\">⋀</span> <span class=\"o\">(</span><span class=\"err\">↑</span><span class=\"mi\">2</span> <span class=\"err\">≃</span><span class=\"o\">[</span><span class=\"n\">B</span><span class=\"o\">]</span> <span class=\"err\">↑</span><span class=\"mi\">0</span><span class=\"o\">))</span>\n<span class=\"bp\">|</span> <span class=\"n\">sub</span>      <span class=\"o\">{</span><span class=\"err\">Γ</span><span class=\"o\">}</span> <span class=\"o\">(</span><span class=\"n\">B</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">b</span> <span class=\"n\">p</span> <span class=\"n\">q</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"n\">B</span> <span class=\"n\">b</span> <span class=\"bp\">→</span> <span class=\"n\">entails</span> <span class=\"o\">(</span><span class=\"n\">B</span><span class=\"bp\">::</span><span class=\"err\">Γ</span><span class=\"o\">)</span> <span class=\"n\">p</span> <span class=\"n\">q</span> <span class=\"bp\">→</span> <span class=\"n\">entails</span> <span class=\"err\">Γ</span> <span class=\"o\">(</span><span class=\"err\">⁅</span><span class=\"n\">p</span> <span class=\"bp\">//</span> <span class=\"n\">b</span><span class=\"err\">⁆</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"err\">⁅</span><span class=\"n\">q</span> <span class=\"bp\">//</span> <span class=\"n\">b</span><span class=\"err\">⁆</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"n\">comp</span>     <span class=\"o\">{</span><span class=\"err\">Γ</span><span class=\"o\">}</span> <span class=\"o\">(</span><span class=\"n\">A</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">φ</span><span class=\"o\">)</span>     <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"o\">(</span><span class=\"n\">A</span><span class=\"bp\">::</span><span class=\"err\">Γ</span><span class=\"o\">)</span> <span class=\"err\">Ω</span> <span class=\"n\">φ</span> <span class=\"bp\">→</span> <span class=\"n\">entails</span> <span class=\"err\">Γ</span> <span class=\"err\">⊤</span> <span class=\"o\">(</span><span class=\"bp\">∀</span><span class=\"err\">&#39;</span> <span class=\"n\">A</span> <span class=\"err\">$</span> <span class=\"o\">(</span><span class=\"err\">↑</span><span class=\"mi\">0</span> <span class=\"err\">∈</span> <span class=\"o\">(</span><span class=\"bp\">^</span> <span class=\"err\">⟦</span><span class=\"n\">A</span> <span class=\"bp\">|</span> <span class=\"n\">φ</span><span class=\"err\">⟧</span><span class=\"o\">))</span> <span class=\"err\">⇔</span> <span class=\"n\">φ</span><span class=\"o\">)</span>\n</code></pre></div>",
        "id": 202076965,
        "sender_full_name": "Billy Price",
        "timestamp": 1593169765
    },
    {
        "content": "<p>It's not true</p>",
        "id": 202079129,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1593171346
    },
    {
        "content": "<p>for example with <code>phi = p</code>, a variable of type Omega, and <code>psi = ⊥</code>, then the antecedent is true because <code>entails [p:Ω] ⊤ p</code> is false, but <code>entails [p:Ω] ⊤ (p -&gt; ⊥)</code> is also false</p>",
        "id": 202079269,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1593171467
    },
    {
        "content": "<p>If you generalize the meta assumption to contexts extending Gamma then it is true</p>",
        "id": 202079369,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1593171545
    },
    {
        "content": "<p>because then you can just instantiate it with context <code>(φ::Γ)</code> to derive <code>entails (φ::Γ) ⊤ ψ</code>, after which you can use imp intro to derive <code>entails Γ ⊤ (φ -&gt; ψ)</code></p>",
        "id": 202079482,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1593171657
    },
    {
        "content": "<p>wait, where is your imp intro?</p>",
        "id": 202079489,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1593171667
    },
    {
        "content": "<p>I suppose you could generalize the <code>⊤</code> in the antecedent instead, but it's kind of trivial at that point using axm</p>",
        "id": 202079541,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1593171721
    },
    {
        "content": "<p>Oh I see, hypotheses don't go in the context like in DTT because this is a HOL like system</p>",
        "id": 202079629,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1593171800
    },
    {
        "content": "<p>I think whatever you mean by imp intro is derivable. One of these?</p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"kn\">lemma</span> <span class=\"n\">from_imp</span> <span class=\"o\">{</span><span class=\"err\">Γ</span> <span class=\"o\">:</span> <span class=\"kn\">context</span><span class=\"o\">}</span> <span class=\"o\">:</span> <span class=\"n\">entails</span> <span class=\"err\">Γ</span> <span class=\"err\">⊤</span> <span class=\"o\">(</span><span class=\"n\">q</span> <span class=\"err\">⟹</span> <span class=\"n\">r</span><span class=\"o\">)</span> <span class=\"bp\">→</span> <span class=\"n\">entails</span> <span class=\"err\">Γ</span> <span class=\"n\">q</span> <span class=\"n\">r</span> <span class=\"o\">:=</span>\n<span class=\"k\">begin</span>\n  <span class=\"n\">intro</span> <span class=\"n\">h₁</span><span class=\"o\">,</span>\n  <span class=\"n\">apply</span> <span class=\"n\">entails</span><span class=\"bp\">.</span><span class=\"n\">cut</span> <span class=\"bp\">_</span> <span class=\"o\">(</span><span class=\"err\">⊤</span> <span class=\"err\">⋀</span> <span class=\"n\">q</span><span class=\"o\">)</span> <span class=\"bp\">_</span><span class=\"o\">,</span>\n  <span class=\"n\">apply_rules</span> <span class=\"o\">[</span><span class=\"n\">entails</span><span class=\"bp\">.</span><span class=\"n\">and_intro</span><span class=\"o\">,</span> <span class=\"n\">entails</span><span class=\"bp\">.</span><span class=\"n\">vac</span><span class=\"o\">,</span> <span class=\"n\">entails</span><span class=\"bp\">.</span><span class=\"n\">axm</span><span class=\"o\">]</span><span class=\"bp\">;</span>\n    <span class=\"o\">{</span> <span class=\"n\">apply</span> <span class=\"bp\">@</span><span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">imp_left</span> <span class=\"bp\">_</span> <span class=\"n\">q</span> <span class=\"n\">r</span><span class=\"o\">,</span>\n      <span class=\"n\">exact</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">proof_right</span> <span class=\"n\">h₁</span>\n    <span class=\"o\">},</span>\n  <span class=\"n\">exact</span> <span class=\"n\">entails</span><span class=\"bp\">.</span><span class=\"n\">imp_to_and</span> <span class=\"n\">h₁</span><span class=\"o\">,</span>\n<span class=\"kn\">end</span>\n\n<span class=\"kn\">lemma</span> <span class=\"n\">to_imp</span> <span class=\"o\">{</span><span class=\"err\">Γ</span> <span class=\"o\">:</span> <span class=\"kn\">context</span><span class=\"o\">}</span> <span class=\"o\">:</span> <span class=\"n\">entails</span> <span class=\"err\">Γ</span> <span class=\"n\">q</span> <span class=\"n\">r</span> <span class=\"bp\">→</span> <span class=\"n\">entails</span> <span class=\"err\">Γ</span> <span class=\"err\">⊤</span> <span class=\"o\">(</span><span class=\"n\">q</span> <span class=\"err\">⟹</span> <span class=\"n\">r</span><span class=\"o\">)</span> <span class=\"o\">:=</span>\n<span class=\"k\">begin</span>\n  <span class=\"n\">intro</span> <span class=\"n\">h₁</span><span class=\"o\">,</span>\n  <span class=\"n\">apply_rules</span> <span class=\"o\">[</span><span class=\"n\">entails</span><span class=\"bp\">.</span><span class=\"n\">and_to_imp</span><span class=\"o\">,</span> <span class=\"n\">entails</span><span class=\"bp\">.</span><span class=\"n\">cut</span> <span class=\"bp\">_</span> <span class=\"n\">q</span> <span class=\"bp\">_</span><span class=\"o\">,</span> <span class=\"n\">entails</span><span class=\"bp\">.</span><span class=\"n\">and_right</span> <span class=\"bp\">_</span> <span class=\"err\">⊤</span> <span class=\"bp\">_</span><span class=\"o\">,</span> <span class=\"n\">entails</span><span class=\"bp\">.</span><span class=\"n\">axm</span><span class=\"o\">],</span>\n  <span class=\"n\">WF_prover</span><span class=\"o\">,</span>\n  <span class=\"n\">apply</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">proof_left</span> <span class=\"n\">h₁</span><span class=\"o\">,</span>\n<span class=\"kn\">end</span>\n</code></pre></div>",
        "id": 202079647,
        "sender_full_name": "Billy Price",
        "timestamp": 1593171821
    },
    {
        "content": "<p>So yeah you have to have the assumption <code>\\all p, entails Γ p φ → entails Γ p ψ</code> at which point the theorem is trivial</p>",
        "id": 202079713,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1593171849
    },
    {
        "content": "<p>Yeah this is from Lambek and Scott, Introduction to Higher Order Logic, (but really via these notes <a href=\"http://therisingsea.org/notes/ch2018-lecture9.pdf\">http://therisingsea.org/notes/ch2018-lecture9.pdf</a>)</p>",
        "id": 202079735,
        "sender_full_name": "Billy Price",
        "timestamp": 1593171894
    },
    {
        "content": "<p>Ah that makes sense, it's strengthening the hypotheses to ensure that the function <code>entails Γ p φ → entails Γ p ψ</code> doesn't just just rely on <code>entails Γ p φ</code> being false.</p>",
        "id": 202079915,
        "sender_full_name": "Billy Price",
        "timestamp": 1593172072
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"256311\">@Jannis Limperg</span> I switched to your induction branch by changing my mathlib <code>rev</code> and then I did <code>leanproject get-mathlib-cache</code>. Then when I tried to <code>import tactic.induction</code>, I get this message. <code>invalid import: control.basic\ninvalid object declaration, environment already has an object named 'simp_attr.functor_norm'</code></p>\n<p>I then tried running <code>leanpkg configure</code>, after which I get this output. Any ideas? <a href=\"/user_uploads/3121/hidIuTJF5-WxxRbB0ZZ5nsVZ/output.txt\">output.txt</a></p>",
        "id": 202528039,
        "sender_full_name": "Billy Price",
        "timestamp": 1593574878
    },
    {
        "content": "<p>I just delete _target and start again when I get into situations like this, but I'm afraid I am a luddite (a busy one).</p>",
        "id": 202535841,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1593585993
    },
    {
        "content": "<p>Wait -- are you working on mathlib or in a repo with mathlib as a dependency?</p>",
        "id": 202535868,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1593586055
    },
    {
        "content": "<p>the latter</p>",
        "id": 202555932,
        "sender_full_name": "Billy Price",
        "timestamp": 1593601580
    },
    {
        "content": "<p>Hmm - now when I redo <code>leanpkg configure</code>, I have a massive stream of warnings saying basically every file coming from mathlib uses sorry. My mathlib rev is this commit is <a href=\"https://github.com/leanprover-community/mathlib/commit/d05800077970a187c948f6e3e316aea2beac4e92\">https://github.com/leanprover-community/mathlib/commit/d05800077970a187c948f6e3e316aea2beac4e92</a></p>",
        "id": 202556432,
        "sender_full_name": "Billy Price",
        "timestamp": 1593602061
    },
    {
        "content": "<p>Do you use <code>elan</code>?</p>",
        "id": 202556454,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1593602099
    },
    {
        "content": "<p>I suggest using <code>leanproject</code> instead of <code>leanpkg</code></p>",
        "id": 202556469,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1593602114
    },
    {
        "content": "<p>Ah okay - I thought they were different tools because <code>leanproject configure</code> isn't a command</p>",
        "id": 202556741,
        "sender_full_name": "Billy Price",
        "timestamp": 1593602306
    },
    {
        "content": "<p>What do I do instead of <code>leanpkg configure</code> with <code>leanproject</code>?</p>",
        "id": 202556761,
        "sender_full_name": "Billy Price",
        "timestamp": 1593602324
    },
    {
        "content": "<p>Just straight to <code>leanproject build</code>?</p>",
        "id": 202557109,
        "sender_full_name": "Billy Price",
        "timestamp": 1593602662
    },
    {
        "content": "<p>If I do so - I get the same errors. Namely lines like this</p>\n<p><code>/Users/billy/gits/TL/_target/deps/mathlib/src/algebra/field.lean:173:6: error: invalid definition, a declaration named 'div_eq_one_iff_eq' has already been declared</code></p>\n<p>and this</p>\n<p><code>/Users/billy/gits/TL/_target/deps/mathlib/src/data/nat/pairing.lean:8:0: warning: imported file '/Users/billy/gits/TL/_target/deps/mathlib/src/tactic/doc_commands.lean' uses sorry</code></p>\n<p>and this</p>\n<p><code>/Users/billy/gits/TL/_target/deps/mathlib/src/data/list/intervals.lean:146:45: error: type mismatch at application\n  lt_of_lt_of_le (mem.mp hk).right\nterm\n  (mem.mp hk).right\nhas type\n  k &lt; m\nbut is expected to have type\n  ?m_3 &lt; ?m_4</code></p>\n<p>Is this a problem with the commit?</p>",
        "id": 202557285,
        "sender_full_name": "Billy Price",
        "timestamp": 1593602854
    },
    {
        "content": "<p>Okay I figured out how to retrieve the pre-compiled oleans with <code>get-mathlib-cache</code>, and now I'm back at my original problem. When I <code>import tactic.induction</code>, I get</p>\n<p><code>invalid import: control.basic\ninvalid object declaration, environment already has an object named 'simp_attr.functor_norm'Lean</code></p>",
        "id": 202557562,
        "sender_full_name": "Billy Price",
        "timestamp": 1593603037
    },
    {
        "content": "<p>Also <code>src/tactic/induction.lean</code> seems to be mostly commented out? Is this an unstable commit <span class=\"user-mention\" data-user-id=\"256311\">@Jannis Limperg</span> ? Is there another commit I should be using?</p>",
        "id": 202560064,
        "sender_full_name": "Billy Price",
        "timestamp": 1593605025
    },
    {
        "content": "<p>Make sure your project's <code>leanpkg.toml</code> file specifies the same version of Lean as the mathlib version you're using (<code>\"leanprover-community/lean:3.16.3\"</code>)</p>",
        "id": 202569883,
        "sender_full_name": "Reid Barton",
        "timestamp": 1593610857
    },
    {
        "content": "<p>What Reid said. This recipe should work:</p>\n<ul>\n<li>Delete <code>_target</code>.</li>\n<li>Put in your <code>leanpkg.toml</code>:<ul>\n<li>Mathlib commit: f5d662fd391b7aa737506a490da11fd7467c0934</li>\n<li>Lean version: leanprover-community/lean:3.16.5</li>\n</ul>\n</li>\n<li><code>leanpkg configure</code></li>\n<li><code>leanproject get-mathlib-cache</code></li>\n</ul>\n<p>The Lean update may require minor changes to your code.</p>",
        "id": 202571917,
        "sender_full_name": "Jannis Limperg",
        "timestamp": 1593612020
    },
    {
        "content": "<p>I didn't look through the history carefully enough to be confident that this is the issue, it's just something easy to mess up and easy to check.</p>",
        "id": 202572171,
        "sender_full_name": "Reid Barton",
        "timestamp": 1593612153
    },
    {
        "content": "<p>Aren't olean files versioned to a specific Lean release though? Or do we not always bump that?</p>",
        "id": 202572233,
        "sender_full_name": "Reid Barton",
        "timestamp": 1593612192
    },
    {
        "content": "<p>Hmm I'm guessing I just had the wrong version of lean or something? Here's my current <code>leanpkg.toml</code> before making any changes</p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"o\">[</span><span class=\"n\">package</span><span class=\"o\">]</span>\n<span class=\"n\">name</span> <span class=\"bp\">=</span> <span class=\"s2\">&quot;TL&quot;</span>\n<span class=\"n\">version</span> <span class=\"bp\">=</span> <span class=\"s2\">&quot;0.1&quot;</span>\n<span class=\"n\">lean_version</span> <span class=\"bp\">=</span> <span class=\"s2\">&quot;leanprover-community/lean:3.9.0&quot;</span>\n<span class=\"n\">path</span> <span class=\"bp\">=</span> <span class=\"s2\">&quot;src&quot;</span>\n\n<span class=\"o\">[</span><span class=\"n\">dependencies</span><span class=\"o\">]</span>\n<span class=\"n\">mathlib</span> <span class=\"bp\">=</span> <span class=\"o\">{</span><span class=\"n\">git</span> <span class=\"bp\">=</span> <span class=\"s2\">&quot;https://github.com/leanprover-community/mathlib&quot;</span><span class=\"o\">,</span> <span class=\"n\">rev</span> <span class=\"bp\">=</span> <span class=\"s2\">&quot;d05800077970a187c948f6e3e316aea2beac4e92&quot;</span><span class=\"o\">}</span>\n</code></pre></div>",
        "id": 202638809,
        "sender_full_name": "Billy Price",
        "timestamp": 1593649162
    },
    {
        "content": "<p>Oh I just saw Reid's first reply</p>",
        "id": 202638905,
        "sender_full_name": "Billy Price",
        "timestamp": 1593649244
    },
    {
        "content": "<p>I have a lot of questions to ask, and a lot of them might be easiest to answer with a mwe. However many questions genuinely need my whole project (or at least 80% of it) to either compile or give context. What's the best way to go about this? It feels wrong to paste all my code in every post (especially since I now have multiple files). I have a git repo - though I'm not sure about committing half-cooked code every time I need to ask a question - (also the need for others to clone/copy/pull changes). Is there a better option than that or would using git be feasible? How do you guys work around this?</p>",
        "id": 203063893,
        "sender_full_name": "Billy Price",
        "timestamp": 1594092384
    },
    {
        "content": "<p>You could commit half cooked code to a different branch, then give people a oneliner to run with leanproject to get that branch on their computer like <code>leanproject get githubname/repo:branch</code> (or whatever the syntax is).</p>",
        "id": 203064263,
        "sender_full_name": "Alex J. Best",
        "timestamp": 1594093177
    },
    {
        "content": "<p>Thanks for the suggestion - I'll look into that.</p>",
        "id": 203064526,
        "sender_full_name": "Billy Price",
        "timestamp": 1594093691
    },
    {
        "content": "<p>(deleted)</p>",
        "id": 203376748,
        "sender_full_name": "Billy Price",
        "timestamp": 1594295927
    },
    {
        "content": "<p>The work-in-progress branch of my project can be grabbed here <code>leanproject get https://github.com/billy-price/TL.git:WIP</code>. Definitions and syntax are in <code>src/definitions.lean</code> - but most of it should be readable or just ask me. Stuff mentioned in this question are in <code>src/entails.lean</code></p>\n<p>The second half of the deduction rules and axioms of entailment in my type theory are quite unusable in their current state, so I'm trying to develop some more usable rules, for example I'm guessing I'd need something like this</p>\n<p><code>lemma all_sub {A φ a} : WF (A :: Γ) Ω φ → entails (A::Γ) (^ (∀' A φ)) (φ⁅a⁆)</code></p>\n<p>(the <code>^</code> means <code>lift 1 0</code>).</p>\n<p>My guess is that would be much more usable than the current axioms relating to universal quantification, which are</p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"bp\">|</span> <span class=\"n\">all_elim</span>   <span class=\"o\">{</span><span class=\"err\">Γ</span><span class=\"o\">}</span> <span class=\"o\">{</span><span class=\"n\">p</span> <span class=\"n\">φ</span> <span class=\"n\">A</span><span class=\"o\">}</span>   <span class=\"o\">:</span> <span class=\"n\">entails</span> <span class=\"err\">Γ</span> <span class=\"n\">p</span> <span class=\"o\">(</span><span class=\"bp\">∀</span><span class=\"err\">&#39;</span> <span class=\"n\">A</span> <span class=\"n\">φ</span><span class=\"o\">)</span> <span class=\"bp\">→</span> <span class=\"n\">entails</span> <span class=\"o\">(</span><span class=\"n\">A</span><span class=\"bp\">::</span><span class=\"err\">Γ</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"bp\">^</span> <span class=\"n\">p</span><span class=\"o\">)</span> <span class=\"n\">φ</span>\n<span class=\"bp\">|</span> <span class=\"n\">all_intro</span>  <span class=\"o\">{</span><span class=\"err\">Γ</span><span class=\"o\">}</span> <span class=\"o\">{</span><span class=\"n\">p</span> <span class=\"n\">φ</span><span class=\"o\">}</span> <span class=\"o\">(</span><span class=\"n\">A</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">entails</span> <span class=\"o\">(</span><span class=\"n\">A</span><span class=\"bp\">::</span><span class=\"err\">Γ</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"bp\">^</span> <span class=\"n\">p</span><span class=\"o\">)</span> <span class=\"n\">φ</span> <span class=\"bp\">→</span> <span class=\"n\">entails</span> <span class=\"err\">Γ</span> <span class=\"n\">p</span> <span class=\"o\">(</span><span class=\"bp\">∀</span><span class=\"err\">&#39;</span> <span class=\"n\">A</span> <span class=\"n\">φ</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"n\">sub</span>      <span class=\"o\">{</span><span class=\"err\">Γ</span><span class=\"o\">}</span> <span class=\"o\">{</span><span class=\"n\">p</span> <span class=\"n\">q</span><span class=\"o\">}</span> <span class=\"o\">(</span><span class=\"n\">B</span> <span class=\"n\">b</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"n\">B</span> <span class=\"n\">b</span> <span class=\"bp\">→</span> <span class=\"n\">entails</span> <span class=\"o\">(</span><span class=\"n\">B</span><span class=\"bp\">::</span><span class=\"err\">Γ</span><span class=\"o\">)</span> <span class=\"n\">p</span> <span class=\"n\">q</span> <span class=\"bp\">→</span> <span class=\"n\">entails</span> <span class=\"err\">Γ</span> <span class=\"o\">(</span><span class=\"n\">p</span><span class=\"err\">⁅</span><span class=\"n\">b</span><span class=\"err\">⁆</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">q</span><span class=\"err\">⁅</span><span class=\"n\">b</span><span class=\"err\">⁆</span><span class=\"o\">)</span>\n</code></pre></div>\n\n\n<p>This is the proof so far,</p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"k\">begin</span>\n  <span class=\"n\">intro</span> <span class=\"n\">wf</span><span class=\"o\">,</span>\n  <span class=\"n\">apply</span> <span class=\"n\">cut</span> <span class=\"n\">φ</span><span class=\"o\">,</span>\n    <span class=\"o\">{</span> <span class=\"n\">apply_rules</span> <span class=\"o\">[</span><span class=\"n\">all_elim</span><span class=\"o\">,</span> <span class=\"n\">axm</span><span class=\"o\">],</span> <span class=\"n\">WF_prover</span> <span class=\"o\">},</span>\n    <span class=\"o\">{</span>\n      <span class=\"n\">sorry</span>\n     <span class=\"o\">}</span>\n<span class=\"kn\">end</span>\n</code></pre></div>\n\n\n<p>I've managed to reduce it to this goal state, which seems closer to applying <code>sub</code> somewhere, but doesn't quite match</p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"mi\">1</span> <span class=\"n\">goal</span>\n<span class=\"err\">Γ</span><span class=\"o\">:</span> <span class=\"kn\">context</span>\n<span class=\"n\">A</span><span class=\"o\">:</span> <span class=\"n\">type</span>\n<span class=\"n\">φa</span><span class=\"o\">:</span> <span class=\"n\">term</span>\n<span class=\"n\">wf</span><span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"bp\">::</span> <span class=\"err\">Γ</span><span class=\"o\">)</span> <span class=\"err\">Ω</span> <span class=\"n\">φ</span>\n<span class=\"err\">⊢</span> <span class=\"n\">entails</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"bp\">::</span> <span class=\"err\">Γ</span><span class=\"o\">)</span> <span class=\"n\">φ</span> <span class=\"n\">φ</span><span class=\"err\">⁅</span><span class=\"n\">a</span><span class=\"bp\">//</span><span class=\"mi\">0</span><span class=\"err\">⁆</span>\n</code></pre></div>\n\n\n<p>It was possible to prove a slight variation of this here</p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"kn\">lemma</span> <span class=\"n\">meta_all_sub</span> <span class=\"o\">{</span><span class=\"n\">A</span> <span class=\"n\">φ</span> <span class=\"n\">a</span><span class=\"o\">}</span> <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"n\">A</span> <span class=\"n\">a</span> <span class=\"bp\">→</span> <span class=\"n\">entails</span> <span class=\"err\">Γ</span> <span class=\"err\">⊤</span> <span class=\"o\">(</span><span class=\"bp\">∀</span><span class=\"err\">&#39;</span> <span class=\"n\">A</span> <span class=\"n\">φ</span><span class=\"o\">)</span> <span class=\"bp\">→</span> <span class=\"n\">entails</span> <span class=\"err\">Γ</span> <span class=\"err\">⊤</span> <span class=\"o\">(</span><span class=\"n\">φ</span><span class=\"err\">⁅</span><span class=\"n\">a</span><span class=\"err\">⁆</span><span class=\"o\">)</span> <span class=\"o\">:=</span>\n<span class=\"k\">begin</span>\n  <span class=\"n\">intros</span> <span class=\"n\">wfa</span> <span class=\"n\">ent_all</span><span class=\"o\">,</span>\n  <span class=\"k\">have</span> <span class=\"o\">:</span> <span class=\"o\">(</span><span class=\"err\">⊤</span> <span class=\"o\">:</span> <span class=\"n\">term</span><span class=\"o\">)</span> <span class=\"bp\">=</span>  <span class=\"err\">⊤⁅</span><span class=\"n\">a</span><span class=\"err\">⁆</span><span class=\"o\">,</span> <span class=\"k\">by</span> <span class=\"n\">refl</span><span class=\"o\">,</span> <span class=\"n\">rw</span> <span class=\"n\">this</span><span class=\"o\">,</span>\n  <span class=\"n\">apply</span> <span class=\"n\">sub</span> <span class=\"bp\">_</span> <span class=\"bp\">_</span> <span class=\"n\">wfa</span><span class=\"o\">,</span>\n  <span class=\"k\">have</span> <span class=\"o\">:</span> <span class=\"o\">(</span><span class=\"err\">⊤</span> <span class=\"o\">:</span> <span class=\"n\">term</span><span class=\"o\">)</span> <span class=\"bp\">=</span> <span class=\"bp\">^</span> <span class=\"err\">⊤</span><span class=\"o\">,</span> <span class=\"k\">by</span> <span class=\"n\">refl</span><span class=\"o\">,</span> <span class=\"n\">rw</span> <span class=\"n\">this</span><span class=\"o\">,</span>\n  <span class=\"n\">exact</span> <span class=\"n\">all_elim</span> <span class=\"n\">ent_all</span>\n<span class=\"kn\">end</span>\n</code></pre></div>\n\n\n<p>but I don't believe this is equivalent, I'd have to prove it for all hypotheses on both entailments, not just <code>⊤</code>, which is just as difficult</p>",
        "id": 203377885,
        "sender_full_name": "Billy Price",
        "timestamp": 1594296792
    },
    {
        "content": "<p>what's the theorem?</p>",
        "id": 203378275,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1594297100
    },
    {
        "content": "<p><code>lemma all_sub {A φ a} : WF (A :: Γ) Ω φ → entails (A::Γ) (^ (∀' A φ)) (φ⁅a⁆)</code></p>",
        "id": 203378300,
        "sender_full_name": "Billy Price",
        "timestamp": 1594297130
    },
    {
        "content": "<p>You need <code>a</code> to be well typed, right? Why not</p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"kn\">lemma</span> <span class=\"n\">all_sub</span> <span class=\"o\">{</span><span class=\"n\">A</span> <span class=\"n\">φ</span> <span class=\"n\">a</span><span class=\"o\">}</span> <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"n\">a</span> <span class=\"n\">A</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"bp\">::</span> <span class=\"err\">Γ</span><span class=\"o\">)</span> <span class=\"err\">Ω</span> <span class=\"n\">φ</span> <span class=\"bp\">→</span> <span class=\"n\">entails</span> <span class=\"err\">Γ</span> <span class=\"o\">(</span><span class=\"bp\">∀</span><span class=\"err\">&#39;</span> <span class=\"n\">A</span> <span class=\"n\">φ</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">φ</span><span class=\"err\">⁅</span><span class=\"n\">a</span><span class=\"err\">⁆</span><span class=\"o\">)</span>\n</code></pre></div>",
        "id": 203378440,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1594297234
    },
    {
        "content": "<p>Yep that's an oversight</p>",
        "id": 203378469,
        "sender_full_name": "Billy Price",
        "timestamp": 1594297257
    },
    {
        "content": "<p>It should be provable without induction</p>",
        "id": 203378504,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1594297288
    },
    {
        "content": "<p>Do you agree that <code>all_elim, all_intro, sub</code> are the main relevant deduction rules or am I missing one?</p>",
        "id": 203378767,
        "sender_full_name": "Billy Price",
        "timestamp": 1594297471
    },
    {
        "content": "<p>(those are all <code>entails.*</code>)</p>",
        "id": 203378813,
        "sender_full_name": "Billy Price",
        "timestamp": 1594297510
    },
    {
        "content": "<p>From all_elim and identity, you have <code>(^ (all A ph)) -&gt; ph</code>, and from <code>sub</code> you get <code>(^ (all A ph))[a] -&gt; ph[a]</code>, which simplifies to <code>(all A ph) -&gt; ph[a]</code></p>",
        "id": 203378826,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1594297533
    },
    {
        "content": "<p>Thank you, that seems like a general pattern to think about for other proofs. Here's my implementation - I kinda think the <code>have</code> line sucks. I'm finding myself going through a lot of effort to dress up my entailments to something that I can apply an entailment rule too. How do I make this easier?</p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"kn\">lemma</span> <span class=\"n\">all_sub</span> <span class=\"o\">{</span><span class=\"n\">A</span> <span class=\"n\">φ</span> <span class=\"n\">a</span><span class=\"o\">}</span> <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"n\">A</span> <span class=\"n\">a</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"bp\">::</span> <span class=\"err\">Γ</span><span class=\"o\">)</span> <span class=\"err\">Ω</span> <span class=\"n\">φ</span> <span class=\"bp\">→</span> <span class=\"n\">entails</span> <span class=\"o\">(</span><span class=\"n\">A</span><span class=\"bp\">::</span><span class=\"err\">Γ</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"bp\">^</span> <span class=\"o\">(</span><span class=\"bp\">∀</span><span class=\"err\">&#39;</span> <span class=\"n\">A</span> <span class=\"n\">φ</span><span class=\"o\">))</span> <span class=\"o\">(</span><span class=\"n\">φ</span><span class=\"err\">⁅</span><span class=\"n\">a</span><span class=\"err\">⁆</span><span class=\"o\">)</span> <span class=\"o\">:=</span>\n<span class=\"k\">begin</span>\n  <span class=\"n\">intros</span> <span class=\"n\">wfa</span> <span class=\"n\">wfφ</span><span class=\"o\">,</span>\n  <span class=\"k\">have</span> <span class=\"o\">:</span> <span class=\"o\">(</span><span class=\"bp\">^</span> <span class=\"o\">(</span><span class=\"bp\">∀</span><span class=\"err\">&#39;</span> <span class=\"n\">A</span> <span class=\"n\">φ</span><span class=\"o\">))</span> <span class=\"bp\">=</span> <span class=\"o\">(</span><span class=\"bp\">^</span> <span class=\"o\">(</span><span class=\"bp\">∀</span><span class=\"err\">&#39;</span> <span class=\"n\">A</span> <span class=\"n\">φ</span><span class=\"o\">))</span><span class=\"err\">⁅</span><span class=\"n\">a</span><span class=\"err\">⁆</span><span class=\"o\">,</span> <span class=\"k\">by</span> <span class=\"n\">sorry</span><span class=\"o\">,</span>\n  <span class=\"n\">rw</span> <span class=\"n\">this</span><span class=\"o\">,</span>\n  <span class=\"n\">refine</span> <span class=\"n\">sub</span> <span class=\"bp\">_</span> <span class=\"bp\">_</span> <span class=\"n\">wfa</span> <span class=\"bp\">_</span><span class=\"o\">,</span>\n  <span class=\"n\">refine</span> <span class=\"n\">all_elim</span> <span class=\"bp\">_</span><span class=\"o\">,</span>\n  <span class=\"n\">refine</span> <span class=\"n\">axm</span> <span class=\"bp\">_</span><span class=\"o\">,</span>\n  <span class=\"n\">WF_prover</span>\n<span class=\"kn\">end</span>\n</code></pre></div>",
        "id": 203380703,
        "sender_full_name": "Billy Price",
        "timestamp": 1594298864
    },
    {
        "content": "<p>the have line should be <code>(^ (∀' A φ))⁅a⁆ = (∀' A φ)</code></p>",
        "id": 203452000,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1594335109
    },
    {
        "content": "<p>which is a special case of the theorem <code>(^ e)⁅a⁆ = e</code></p>",
        "id": 203452082,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1594335143
    },
    {
        "content": "<p>I got the contexts wrong and that led me to the wrong equality, though isn't the theorem <code>(^ e)⁅a⁆ = ^ e</code>?</p>",
        "id": 203463581,
        "sender_full_name": "Billy Price",
        "timestamp": 1594348100
    },
    {
        "content": "<p>No, <code>p⁅a⁆</code> lives in context <code>Γ</code> if <code>p</code> is in context <code>A :: Γ</code> and <code>a : A</code></p>",
        "id": 203463763,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1594348337
    },
    {
        "content": "<p>At least the way it's usually defined, substitution on de bruijn terms substitutes variable 0 and reduces all other variables by 1</p>",
        "id": 203463792,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1594348402
    },
    {
        "content": "<p>Oh lol, I didn't define it like that and that might need some refactoring</p>",
        "id": 203464767,
        "sender_full_name": "Billy Price",
        "timestamp": 1594349741
    },
    {
        "content": "<p>In non-de bruijn world I would expect something like phi[x:=x] = phi, and that's clearly ruled out in de-bruijn world according to what you just said</p>",
        "id": 203464895,
        "sender_full_name": "Billy Price",
        "timestamp": 1594349921
    },
    {
        "content": "<p>no, that's not a thing with de bruijn because the x:=x part is not well scoped</p>",
        "id": 203467471,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1594353735
    },
    {
        "content": "<p>the nearest equivalent is something like <code>(lift phi 1 1)[0] = phi</code></p>",
        "id": 203467482,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1594353800
    },
    {
        "content": "<p>Tada here's my proof (of an appropriate generalization), was scratching my head for a while wondering why I couldn't use <code>add_sub (a b c) : a + (b-c) = a+b-c</code>, it's not true for naturals! </p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"bp\">@</span><span class=\"o\">[</span><span class=\"n\">simp</span><span class=\"o\">]</span>\n<span class=\"kn\">lemma</span> <span class=\"n\">sub_lift</span> <span class=\"o\">{</span><span class=\"n\">d</span> <span class=\"n\">k</span><span class=\"o\">}</span> <span class=\"o\">{</span><span class=\"n\">a</span> <span class=\"n\">b</span> <span class=\"o\">:</span> <span class=\"n\">term</span><span class=\"o\">}</span> <span class=\"o\">{</span><span class=\"n\">hd</span> <span class=\"o\">:</span> <span class=\"n\">d</span> <span class=\"bp\">≥</span> <span class=\"mi\">1</span><span class=\"o\">}</span> <span class=\"o\">:</span> <span class=\"o\">(</span><span class=\"n\">lift</span> <span class=\"n\">d</span> <span class=\"n\">k</span> <span class=\"n\">a</span><span class=\"o\">)</span><span class=\"err\">⁅</span><span class=\"n\">b</span> <span class=\"bp\">//</span> <span class=\"n\">k</span><span class=\"err\">⁆</span> <span class=\"bp\">=</span> <span class=\"n\">lift</span> <span class=\"o\">(</span><span class=\"n\">d</span><span class=\"bp\">-</span><span class=\"mi\">1</span><span class=\"o\">)</span> <span class=\"n\">k</span> <span class=\"n\">a</span> <span class=\"o\">:=</span>\n<span class=\"k\">begin</span>\n  <span class=\"n\">induction&#39;</span> <span class=\"n\">a</span><span class=\"bp\">;</span> <span class=\"n\">simp</span><span class=\"o\">,</span>\n  <span class=\"n\">any_goals</span> <span class=\"o\">{</span><span class=\"n\">tidy</span><span class=\"o\">},</span>\n  <span class=\"n\">case</span> <span class=\"n\">var</span> <span class=\"o\">:</span>\n    <span class=\"o\">{</span> <span class=\"n\">split_ifs</span><span class=\"bp\">;</span> <span class=\"n\">simp</span><span class=\"o\">,</span>\n        <span class=\"o\">{</span> <span class=\"n\">rw</span> <span class=\"o\">[</span><span class=\"n\">if_neg</span><span class=\"o\">,</span> <span class=\"n\">if_pos</span><span class=\"o\">]</span><span class=\"bp\">;</span> <span class=\"o\">{</span><span class=\"n\">linarith</span> <span class=\"bp\">&lt;|&gt;</span> <span class=\"o\">{</span><span class=\"n\">cases</span> <span class=\"n\">hd</span><span class=\"bp\">;</span><span class=\"n\">refl</span><span class=\"o\">}}</span> <span class=\"o\">},</span>\n        <span class=\"o\">{</span> <span class=\"n\">rw</span> <span class=\"n\">if_neg</span><span class=\"o\">,</span> <span class=\"n\">rw</span> <span class=\"n\">if_neg</span><span class=\"o\">,</span> <span class=\"n\">linarith</span><span class=\"o\">,</span> <span class=\"n\">linarith</span><span class=\"o\">}</span> <span class=\"o\">}</span>\n<span class=\"kn\">end</span>\n</code></pre></div>",
        "id": 203471418,
        "sender_full_name": "Billy Price",
        "timestamp": 1594360016
    },
    {
        "content": "<p>is there a direct term or tactic equivalent to <code>cases h with x, exact x</code>?  Assuming h has one possible case?</p>",
        "id": 203471789,
        "sender_full_name": "Billy Price",
        "timestamp": 1594360512
    },
    {
        "content": "<p>(Unrelated to the proof i just posted)</p>",
        "id": 203471794,
        "sender_full_name": "Billy Price",
        "timestamp": 1594360533
    },
    {
        "content": "<p>Only if <code>h</code> is a structure</p>",
        "id": 203472258,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1594361147
    },
    {
        "content": "<p><code>match h with | (foo x) := x end</code></p>",
        "id": 203472318,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1594361216
    },
    {
        "content": "<p><code>let \\&lt;x\\&gt; := h in x</code></p>",
        "id": 203472333,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1594361230
    },
    {
        "content": "<p>Usually, if that proof works, it should be a structure field, in which case you can write <code>foo.out h</code> or the like</p>",
        "id": 203472385,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1594361297
    },
    {
        "content": "<p>However it's also possible that your <code>h</code> has a type with many constructors, and the others are being excluded for being impossible. In that case the <code>match</code> proof of Kenny's will work but the <code>let</code> will not and the field also will not</p>",
        "id": 203472416,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1594361385
    },
    {
        "content": "<p>Thanks, it's the inductive WF type so I don't think this applies.</p>",
        "id": 203473877,
        "sender_full_name": "Billy Price",
        "timestamp": 1594363192
    },
    {
        "content": "<p>In light of the new substitution rule, does my axiom of comprehension still make sense? <br>\n<code>| comp     {Γ} (A) (φ)     : WF (A::Γ) Ω φ → entails Γ ⊤ (∀' A $ (↑0 ∈ (^ ⟦A | φ⟧)) ⇔ φ)</code></p>\n<p>I'm lifting the set in order to prevent Russell's paradox and the like, but then when I try and prove this lemma I run into trouble</p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"kn\">lemma</span> <span class=\"n\">elem_comp</span> <span class=\"o\">{</span><span class=\"n\">H</span><span class=\"o\">}</span> <span class=\"o\">{</span><span class=\"n\">A</span> <span class=\"n\">φ</span> <span class=\"n\">a</span><span class=\"o\">}</span> <span class=\"o\">:</span> <span class=\"n\">entails</span> <span class=\"err\">Γ</span> <span class=\"n\">H</span> <span class=\"o\">(</span><span class=\"n\">a</span> <span class=\"err\">∈</span> <span class=\"o\">(</span><span class=\"bp\">^</span> <span class=\"o\">(</span><span class=\"err\">⟦</span><span class=\"n\">A</span> <span class=\"bp\">|</span> <span class=\"n\">φ</span><span class=\"err\">⟧</span><span class=\"o\">)))</span> <span class=\"bp\">→</span> <span class=\"n\">entails</span> <span class=\"err\">Γ</span> <span class=\"n\">H</span> <span class=\"o\">(</span><span class=\"n\">φ</span><span class=\"err\">⁅</span><span class=\"n\">a</span><span class=\"err\">⁆</span><span class=\"o\">)</span> <span class=\"o\">:=</span>\n<span class=\"k\">begin</span>\n  <span class=\"n\">intro</span> <span class=\"n\">ent_elem</span><span class=\"o\">,</span>\n  <span class=\"n\">apply</span> <span class=\"n\">cut</span> <span class=\"bp\">_</span> <span class=\"n\">ent_elem</span><span class=\"o\">,</span>\n  <span class=\"n\">apply</span> <span class=\"n\">from_imp</span><span class=\"o\">,</span>\n  <span class=\"k\">have</span> <span class=\"o\">:</span> <span class=\"o\">((</span><span class=\"n\">a</span> <span class=\"err\">∈</span> <span class=\"bp\">^</span> <span class=\"o\">(</span><span class=\"err\">⟦</span> <span class=\"n\">A</span> <span class=\"bp\">|</span> <span class=\"n\">φ</span> <span class=\"err\">⟧</span><span class=\"o\">))</span> <span class=\"err\">⟹</span> <span class=\"n\">φ</span><span class=\"err\">⁅</span><span class=\"n\">a</span><span class=\"bp\">//</span><span class=\"mi\">0</span><span class=\"err\">⁆</span><span class=\"o\">)</span> <span class=\"bp\">=</span> <span class=\"o\">((</span><span class=\"err\">↑</span><span class=\"mi\">0</span> <span class=\"err\">∈</span> <span class=\"bp\">^</span> <span class=\"o\">(</span><span class=\"err\">⟦</span> <span class=\"n\">A</span> <span class=\"bp\">|</span> <span class=\"n\">φ</span> <span class=\"err\">⟧</span><span class=\"o\">))</span> <span class=\"err\">⟹</span> <span class=\"n\">φ</span><span class=\"o\">)</span><span class=\"err\">⁅</span><span class=\"n\">a</span><span class=\"err\">⁆</span><span class=\"o\">,</span> <span class=\"n\">simp</span><span class=\"o\">,</span> <span class=\"n\">sorry</span><span class=\"o\">,</span>\n  <span class=\"n\">sorry</span>\n<span class=\"kn\">end</span>\n</code></pre></div>\n\n\n<p>the state before the first sorry is, in which the right conjunct isn't true. </p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"err\">Γ</span><span class=\"o\">:</span> <span class=\"kn\">context</span>\n<span class=\"n\">H</span><span class=\"o\">:</span> <span class=\"n\">term</span>\n<span class=\"n\">A</span><span class=\"o\">:</span> <span class=\"n\">type</span>\n<span class=\"n\">φa</span><span class=\"o\">:</span> <span class=\"n\">term</span>\n<span class=\"n\">ent_elem</span><span class=\"o\">:</span> <span class=\"n\">entails</span> <span class=\"err\">Γ</span> <span class=\"n\">H</span> <span class=\"o\">(</span><span class=\"n\">a</span> <span class=\"err\">∈</span> <span class=\"n\">lift</span> <span class=\"mi\">1</span> <span class=\"mi\">0</span> <span class=\"err\">⟦</span> <span class=\"n\">A</span> <span class=\"bp\">|</span> <span class=\"n\">φ</span> <span class=\"err\">⟧</span><span class=\"o\">)</span>\n<span class=\"err\">⊢</span> <span class=\"n\">a</span> <span class=\"bp\">=</span> <span class=\"err\">↑</span><span class=\"mi\">0</span><span class=\"err\">⁅</span><span class=\"n\">a</span><span class=\"bp\">//</span><span class=\"mi\">0</span><span class=\"err\">⁆</span> <span class=\"bp\">∧</span> <span class=\"n\">lift</span> <span class=\"mi\">1</span> <span class=\"mi\">1</span> <span class=\"n\">φ</span> <span class=\"bp\">=</span> <span class=\"n\">φ</span>\n</code></pre></div>\n\n\n<p>Do I just need to change <code>comp</code> to this? (lifting the last phi)<br>\n<code>| comp     {Γ} (A) (φ)     : WF (A::Γ) Ω φ → entails Γ ⊤ (∀' A $ (↑0 ∈ (^ ⟦A | φ⟧)) ⇔ (lift 1 1 φ))</code></p>\n<p>or is there a better alternative?</p>",
        "id": 203474685,
        "sender_full_name": "Billy Price",
        "timestamp": 1594364101
    },
    {
        "content": "<p>What does <code>⟦A | φ⟧</code> mean?</p>",
        "id": 203544182,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1594406998
    },
    {
        "content": "<p>oh I see it's your comprehension operator, i.e <code>{x : A | φ}</code></p>",
        "id": 203544342,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1594407060
    },
    {
        "content": "<p>your <code>elem_comp</code> is missing <code>WF</code> assumptions again. I suggest you put them in because it makes it clearer where to put the lifts</p>",
        "id": 203544665,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1594407223
    },
    {
        "content": "<p>In this case <code>a</code>, <code>A</code> and live in context <code>Γ</code> and  <code>φ</code> is in context <code>A::Γ</code> so <code>a</code> and <code>⟦A | φ⟧</code> live in the same context and no lifting is necessary</p>",
        "id": 203544832,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1594407315
    },
    {
        "content": "<p>I did end up figuring that out! I was thinking I'd need to lift in order to match with the comprehension axiom, but that is taken care of by reducing all the higher indices during substitution!</p>\n<p>I can actually pull the well-formedness of <code>a</code> and <code>phi</code> out of the hypothesis <code>entails Γ H (a ∈ (^ ⟦A | φ⟧))</code>, however I did put them in  because I changed it to an if and only if lemma and you can't pull well-formedness out of the other entailment.</p>",
        "id": 203580072,
        "sender_full_name": "Billy Price",
        "timestamp": 1594441773
    },
    {
        "content": "<p>I've been doing a bunch of lemmas relating to compositions of lift and substitution operations, and it reminds me of order preserving maps. Specifically I've come across the simplex category of finite ordinals and order preserving maps, and I remember a theorem stating any order preserving map can be decomposed into a composition of these two classes of maps.<br>\n<a href=\"/user_uploads/3121/5MFpW5AaRWQ4FvX4Scr3-d8Q/image.png\">image.png</a> </p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/5MFpW5AaRWQ4FvX4Scr3-d8Q/image.png\" title=\"image.png\"><img src=\"/user_uploads/3121/5MFpW5AaRWQ4FvX4Scr3-d8Q/image.png\"></a></div><p>These are just like how <code>lift 1 i</code> and <code>subst i (var i)</code> act on de-bruijn indices/vars. <code>lift</code> and <code>subst</code> are defined like this</p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"n\">def</span> <span class=\"n\">lift</span> <span class=\"o\">(</span><span class=\"n\">d</span> <span class=\"o\">:</span> <span class=\"bp\">ℕ</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"bp\">ℕ</span> <span class=\"bp\">→</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">term</span>\n<span class=\"bp\">|</span> <span class=\"n\">k</span> <span class=\"err\">⁎</span>          <span class=\"o\">:=</span> <span class=\"err\">⁎</span>\n<span class=\"bp\">|</span> <span class=\"n\">k</span> <span class=\"err\">⊤</span>          <span class=\"o\">:=</span> <span class=\"err\">⊤</span>\n<span class=\"bp\">|</span> <span class=\"n\">k</span> <span class=\"err\">⊥</span>          <span class=\"o\">:=</span> <span class=\"err\">⊥</span>\n<span class=\"bp\">|</span> <span class=\"n\">k</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"err\">⋀</span> <span class=\"n\">q</span><span class=\"o\">)</span>    <span class=\"o\">:=</span> <span class=\"o\">(</span><span class=\"n\">lift</span> <span class=\"n\">k</span> <span class=\"n\">p</span><span class=\"o\">)</span> <span class=\"err\">⋀</span> <span class=\"o\">(</span><span class=\"n\">lift</span> <span class=\"n\">k</span> <span class=\"n\">q</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"n\">k</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"err\">⋁</span> <span class=\"n\">q</span><span class=\"o\">)</span>    <span class=\"o\">:=</span> <span class=\"o\">(</span><span class=\"n\">lift</span> <span class=\"n\">k</span> <span class=\"n\">p</span><span class=\"o\">)</span> <span class=\"err\">⋁</span> <span class=\"o\">(</span><span class=\"n\">lift</span> <span class=\"n\">k</span> <span class=\"n\">q</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"n\">k</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"err\">⟹</span> <span class=\"n\">q</span><span class=\"o\">)</span>   <span class=\"o\">:=</span> <span class=\"o\">(</span><span class=\"n\">lift</span> <span class=\"n\">k</span> <span class=\"n\">p</span><span class=\"o\">)</span> <span class=\"err\">⟹</span> <span class=\"o\">(</span><span class=\"n\">lift</span> <span class=\"n\">k</span> <span class=\"n\">q</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"n\">k</span> <span class=\"o\">(</span><span class=\"n\">a</span> <span class=\"err\">∈</span> <span class=\"n\">α</span><span class=\"o\">)</span>    <span class=\"o\">:=</span> <span class=\"o\">(</span><span class=\"n\">lift</span> <span class=\"n\">k</span> <span class=\"n\">a</span><span class=\"o\">)</span> <span class=\"err\">∈</span> <span class=\"o\">(</span><span class=\"n\">lift</span> <span class=\"n\">k</span> <span class=\"n\">α</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"n\">k</span> <span class=\"err\">⟪</span><span class=\"n\">a</span><span class=\"o\">,</span><span class=\"n\">b</span><span class=\"err\">⟫</span>      <span class=\"o\">:=</span> <span class=\"err\">⟪</span><span class=\"n\">lift</span> <span class=\"n\">k</span> <span class=\"n\">a</span><span class=\"o\">,</span> <span class=\"n\">lift</span> <span class=\"n\">k</span> <span class=\"n\">b</span><span class=\"err\">⟫</span>\n<span class=\"bp\">|</span> <span class=\"n\">k</span> <span class=\"o\">(</span><span class=\"n\">var</span> <span class=\"n\">m</span><span class=\"o\">)</span>    <span class=\"o\">:=</span> <span class=\"k\">if</span> <span class=\"n\">m</span><span class=\"bp\">≥</span><span class=\"n\">k</span> <span class=\"k\">then</span> <span class=\"n\">var</span> <span class=\"o\">(</span><span class=\"n\">m</span><span class=\"bp\">+</span><span class=\"n\">d</span><span class=\"o\">)</span> <span class=\"k\">else</span> <span class=\"n\">var</span> <span class=\"n\">m</span>\n<span class=\"bp\">|</span> <span class=\"n\">k</span> <span class=\"err\">⟦</span><span class=\"n\">A</span> <span class=\"bp\">|</span> <span class=\"n\">φ</span><span class=\"err\">⟧</span>  <span class=\"o\">:=</span>   <span class=\"err\">⟦</span><span class=\"n\">A</span> <span class=\"bp\">|</span> <span class=\"n\">lift</span> <span class=\"o\">(</span><span class=\"n\">k</span><span class=\"bp\">+</span><span class=\"mi\">1</span><span class=\"o\">)</span> <span class=\"n\">φ</span><span class=\"err\">⟧</span>\n<span class=\"bp\">|</span> <span class=\"n\">k</span> <span class=\"o\">(</span><span class=\"bp\">∀</span><span class=\"err\">&#39;</span> <span class=\"n\">A</span> <span class=\"n\">φ</span><span class=\"o\">)</span>   <span class=\"o\">:=</span> <span class=\"bp\">∀</span><span class=\"err\">&#39;</span> <span class=\"n\">A</span> <span class=\"err\">$</span> <span class=\"n\">lift</span> <span class=\"o\">(</span><span class=\"n\">k</span><span class=\"bp\">+</span><span class=\"mi\">1</span><span class=\"o\">)</span> <span class=\"n\">φ</span>\n<span class=\"bp\">|</span> <span class=\"n\">k</span> <span class=\"o\">(</span><span class=\"bp\">∃</span><span class=\"err\">&#39;</span> <span class=\"n\">A</span> <span class=\"n\">φ</span><span class=\"o\">)</span>   <span class=\"o\">:=</span> <span class=\"bp\">∃</span><span class=\"err\">&#39;</span> <span class=\"n\">A</span> <span class=\"err\">$</span> <span class=\"n\">lift</span> <span class=\"o\">(</span><span class=\"n\">k</span><span class=\"bp\">+</span><span class=\"mi\">1</span><span class=\"o\">)</span> <span class=\"n\">φ</span>\n\n<span class=\"n\">def</span> <span class=\"n\">subst</span> <span class=\"o\">:</span> <span class=\"bp\">ℕ</span> <span class=\"bp\">→</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">term</span>\n<span class=\"bp\">|</span> <span class=\"n\">n</span> <span class=\"n\">x</span> <span class=\"err\">⁎</span>          <span class=\"o\">:=</span> <span class=\"err\">⁎</span>\n<span class=\"bp\">|</span> <span class=\"n\">n</span> <span class=\"n\">x</span> <span class=\"err\">⊤</span>          <span class=\"o\">:=</span> <span class=\"err\">⊤</span>\n<span class=\"bp\">|</span> <span class=\"n\">n</span> <span class=\"n\">x</span> <span class=\"err\">⊥</span>          <span class=\"o\">:=</span> <span class=\"err\">⊥</span>\n<span class=\"bp\">|</span> <span class=\"n\">n</span> <span class=\"n\">x</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"err\">⋀</span> <span class=\"n\">q</span><span class=\"o\">)</span>    <span class=\"o\">:=</span> <span class=\"o\">(</span><span class=\"n\">subst</span> <span class=\"n\">n</span> <span class=\"n\">x</span> <span class=\"n\">p</span><span class=\"o\">)</span> <span class=\"err\">⋀</span> <span class=\"o\">(</span><span class=\"n\">subst</span> <span class=\"n\">n</span> <span class=\"n\">x</span> <span class=\"n\">q</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"n\">n</span> <span class=\"n\">x</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"err\">⋁</span> <span class=\"n\">q</span><span class=\"o\">)</span>    <span class=\"o\">:=</span> <span class=\"o\">(</span><span class=\"n\">subst</span> <span class=\"n\">n</span> <span class=\"n\">x</span> <span class=\"n\">p</span><span class=\"o\">)</span> <span class=\"err\">⋁</span> <span class=\"o\">(</span><span class=\"n\">subst</span> <span class=\"n\">n</span> <span class=\"n\">x</span> <span class=\"n\">q</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"n\">n</span> <span class=\"n\">x</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"err\">⟹</span> <span class=\"n\">q</span><span class=\"o\">)</span>  <span class=\"o\">:=</span> <span class=\"o\">(</span><span class=\"n\">subst</span> <span class=\"n\">n</span> <span class=\"n\">x</span> <span class=\"n\">p</span><span class=\"o\">)</span> <span class=\"err\">⟹</span> <span class=\"o\">(</span><span class=\"n\">subst</span> <span class=\"n\">n</span> <span class=\"n\">x</span> <span class=\"n\">q</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"n\">n</span> <span class=\"n\">x</span> <span class=\"o\">(</span><span class=\"n\">a</span> <span class=\"err\">∈</span> <span class=\"n\">α</span><span class=\"o\">)</span>    <span class=\"o\">:=</span> <span class=\"o\">(</span><span class=\"n\">subst</span> <span class=\"n\">n</span> <span class=\"n\">x</span> <span class=\"n\">a</span><span class=\"o\">)</span> <span class=\"err\">∈</span> <span class=\"o\">(</span><span class=\"n\">subst</span> <span class=\"n\">n</span> <span class=\"n\">x</span> <span class=\"n\">α</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"n\">n</span> <span class=\"n\">x</span> <span class=\"err\">⟪</span><span class=\"n\">a</span><span class=\"o\">,</span><span class=\"n\">b</span><span class=\"err\">⟫</span>      <span class=\"o\">:=</span> <span class=\"err\">⟪</span><span class=\"n\">subst</span> <span class=\"n\">n</span> <span class=\"n\">x</span> <span class=\"n\">a</span><span class=\"o\">,</span> <span class=\"n\">subst</span> <span class=\"n\">n</span> <span class=\"n\">x</span> <span class=\"n\">b</span><span class=\"err\">⟫</span>\n<span class=\"bp\">|</span> <span class=\"n\">n</span> <span class=\"n\">x</span> <span class=\"o\">(</span><span class=\"n\">var</span> <span class=\"n\">m</span><span class=\"o\">)</span>    <span class=\"o\">:=</span> <span class=\"k\">if</span> <span class=\"n\">n</span><span class=\"bp\">=</span><span class=\"n\">m</span> <span class=\"k\">then</span> <span class=\"n\">x</span> <span class=\"k\">else</span> <span class=\"o\">(</span><span class=\"k\">if</span> <span class=\"n\">m</span> <span class=\"bp\">&gt;</span> <span class=\"n\">n</span> <span class=\"k\">then</span> <span class=\"n\">var</span> <span class=\"o\">(</span><span class=\"n\">m</span><span class=\"bp\">-</span><span class=\"mi\">1</span><span class=\"o\">)</span> <span class=\"k\">else</span> <span class=\"n\">var</span> <span class=\"n\">m</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"n\">n</span> <span class=\"n\">x</span> <span class=\"err\">⟦</span> <span class=\"n\">A</span> <span class=\"bp\">|</span> <span class=\"n\">φ</span> <span class=\"err\">⟧</span>   <span class=\"o\">:=</span> <span class=\"err\">⟦</span><span class=\"n\">A</span> <span class=\"bp\">|</span> <span class=\"n\">subst</span> <span class=\"o\">(</span><span class=\"n\">n</span><span class=\"bp\">+</span><span class=\"mi\">1</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"bp\">^</span> <span class=\"n\">x</span><span class=\"o\">)</span> <span class=\"n\">φ</span><span class=\"err\">⟧</span>\n<span class=\"bp\">|</span> <span class=\"n\">n</span> <span class=\"n\">x</span> <span class=\"o\">(</span><span class=\"bp\">∀</span><span class=\"err\">&#39;</span> <span class=\"n\">A</span> <span class=\"n\">φ</span><span class=\"o\">)</span>   <span class=\"o\">:=</span> <span class=\"bp\">∀</span><span class=\"err\">&#39;</span> <span class=\"n\">A</span> <span class=\"o\">(</span><span class=\"n\">subst</span> <span class=\"o\">(</span><span class=\"n\">n</span><span class=\"bp\">+</span><span class=\"mi\">1</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"bp\">^</span> <span class=\"n\">x</span><span class=\"o\">)</span> <span class=\"n\">φ</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"n\">n</span> <span class=\"n\">x</span> <span class=\"o\">(</span><span class=\"bp\">∃</span><span class=\"err\">&#39;</span> <span class=\"n\">A</span> <span class=\"n\">φ</span><span class=\"o\">)</span>   <span class=\"o\">:=</span> <span class=\"bp\">∃</span><span class=\"err\">&#39;</span> <span class=\"n\">A</span> <span class=\"o\">(</span><span class=\"n\">subst</span> <span class=\"o\">(</span><span class=\"n\">n</span><span class=\"bp\">+</span><span class=\"mi\">1</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"bp\">^</span> <span class=\"n\">x</span><span class=\"o\">)</span> <span class=\"n\">φ</span><span class=\"o\">)</span>\n</code></pre></div>\n\n\n<p>So far I've found it difficult to visualise compositions of <code>lift</code> and <code>subst</code> and come up with the right lemmas to prove, so maybe some practice in the theory of finite order-preserving maps will help. Is this a known connection?</p>",
        "id": 203580819,
        "sender_full_name": "Billy Price",
        "timestamp": 1594443163
    },
    {
        "content": "<p>I believe that the semantics of type theories leads to the structure of <a href=\"https://ncatlab.org/nlab/show/categorical+model+of+dependent+types#contextual_categories_or_csystems\">contextual categories</a>. If you simplify away the types, so that contexts are basically <code>list unit</code> (which is just <code>nat</code>), as in untyped (but well scoped) lambda calculus, then I think you can use the simplex category to represent the contexts.</p>",
        "id": 203581794,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1594445244
    },
    {
        "content": "<p>Very interesting, thanks :)</p>",
        "id": 203596104,
        "sender_full_name": "Billy Price",
        "timestamp": 1594473108
    },
    {
        "content": "<p>I've proved <code>@[simp] lemma sub_lift {d n k} {a b : term} {hd : d ≥ 1} {hn : n &lt; d} : (lift d k a)⁅b // n+k⁆ = lift (d-1) k a</code> and I'd like to show the following as a simple corollary, since <code>simp</code> won't recognise the first case when <code>n</code> is <code>0</code>,  <code>@[simp] lemma sub_lift' {d k} {a b : term} {hd : d ≥ 1} : (lift d k a)⁅b // k⁆ = lift (d-1) k a</code></p>\n<p>However I can't use <code>rw &lt;-zero_add k</code>, since it will rewrite both <code>k</code> to <code>0+k</code>, and I just want the second one to be <code>0+k</code>.</p>",
        "id": 203634580,
        "sender_full_name": "Billy Price",
        "timestamp": 1594543625
    },
    {
        "content": "<p>Try the conv mode docs?</p>",
        "id": 203635159,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1594544882
    },
    {
        "content": "<p><a href=\"https://leanprover-community.github.io/extras/conv.html\">https://leanprover-community.github.io/extras/conv.html</a></p>",
        "id": 203635202,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1594544989
    },
    {
        "content": "<p>I have a compactness theorem (for a different theory) that looks like this <code>theorem compactness {X : set Form} {A : Form} : (X ⊢I A) → ∃ X' ⊆ X, X'.finite ∧ (X' ⊢I A)</code>, but the proof is entirely constructive. Am I correct in understanding that I won't be able to recover the finite set X' from the exists? I tried to change it to sigma in the hopes of making it recoverable, but it looks like the sigma type doesn't want the second thing to be a proposition?</p>",
        "id": 205316352,
        "sender_full_name": "Billy Price",
        "timestamp": 1595995490
    },
    {
        "content": "<p>constructive exists is called subtype (<code>{ x // p x }</code>)</p>",
        "id": 205326259,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1596008256
    },
    {
        "content": "<p>and I wouldn't call that theorem compactness?</p>",
        "id": 205326329,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1596008298
    },
    {
        "content": "<p>I'm not quite sure how to utilise subtype in my situation I have the following types/props</p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"kn\">inductive</span> <span class=\"n\">deduction</span> <span class=\"o\">:</span> <span class=\"n\">set</span> <span class=\"n\">Form</span> <span class=\"bp\">→</span> <span class=\"n\">Form</span> <span class=\"bp\">→</span> <span class=\"kt\">Type</span>\n\n<span class=\"kn\">inductive</span> <span class=\"n\">provable</span> <span class=\"o\">(</span><span class=\"n\">X</span> <span class=\"o\">:</span> <span class=\"n\">set</span> <span class=\"n\">Form</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"o\">:</span> <span class=\"n\">Form</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"kt\">Prop</span>\n<span class=\"bp\">|</span> <span class=\"n\">mk</span> <span class=\"o\">:</span> <span class=\"n\">deduction</span> <span class=\"n\">X</span> <span class=\"n\">A</span> <span class=\"bp\">→</span> <span class=\"n\">provable</span>\n</code></pre></div>\n\n\n<p>There's are the three potential subtypes I thought of, but it's not clear how to state the theorem using them, since there's no subset constraint.</p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"n\">def</span> <span class=\"n\">fin_deduction</span> <span class=\"o\">(</span><span class=\"n\">X</span> <span class=\"o\">:</span> <span class=\"n\">set</span> <span class=\"n\">Form</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"o\">:</span> <span class=\"n\">Form</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span> <span class=\"o\">:=</span> <span class=\"o\">{</span> <span class=\"n\">d</span> <span class=\"o\">:</span> <span class=\"n\">deduction</span> <span class=\"n\">X</span> <span class=\"n\">A</span> <span class=\"bp\">//</span> <span class=\"n\">X</span><span class=\"bp\">.</span><span class=\"n\">finite</span> <span class=\"o\">}</span>\n\n<span class=\"kn\">inductive</span> <span class=\"n\">fin_provable</span> <span class=\"o\">(</span><span class=\"n\">X</span> <span class=\"o\">:</span> <span class=\"n\">set</span> <span class=\"n\">Form</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"o\">:</span> <span class=\"n\">Form</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"kt\">Prop</span>\n<span class=\"bp\">|</span> <span class=\"n\">mk</span> <span class=\"o\">:</span> <span class=\"n\">fin_deduction</span> <span class=\"n\">X</span> <span class=\"n\">A</span> <span class=\"bp\">→</span> <span class=\"n\">fin_provable</span>\n\n<span class=\"kn\">inductive</span> <span class=\"n\">fin_provable&#39;</span> <span class=\"o\">(</span><span class=\"n\">X</span> <span class=\"o\">:</span> <span class=\"n\">set</span> <span class=\"n\">Form</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"o\">:</span> <span class=\"n\">Form</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"kt\">Prop</span>\n<span class=\"bp\">|</span> <span class=\"n\">mk</span> <span class=\"o\">:</span> <span class=\"n\">provable</span> <span class=\"n\">X</span> <span class=\"n\">A</span> <span class=\"bp\">→</span> <span class=\"n\">X</span><span class=\"bp\">.</span><span class=\"n\">finite</span> <span class=\"bp\">→</span> <span class=\"n\">fin_provable&#39;</span>\n</code></pre></div>\n\n\n<p>Also the comment about the name compactness, is that just because compactness is about models, not provability? I'm just formalising the natural deduction section of the class I'm taking, and this theorem appeared in the textbook.</p>",
        "id": 205449334,
        "sender_full_name": "Billy Price",
        "timestamp": 1596094641
    },
    {
        "content": "<p>the thing is, you can't go from Prop to data</p>",
        "id": 205449459,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1596094740
    },
    {
        "content": "<p>so from a <code>deduction</code> you can produce a finite <code>set Form</code></p>",
        "id": 205449480,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1596094751
    },
    {
        "content": "<p>but once you go to <code>provable</code>, you can't go back to data</p>",
        "id": 205449489,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1596094761
    },
    {
        "content": "<p>so you can produce:</p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"n\">def</span> <span class=\"n\">axioms_used</span> <span class=\"o\">:</span> <span class=\"n\">deduction</span> <span class=\"n\">X</span> <span class=\"n\">A</span> <span class=\"bp\">→</span> <span class=\"o\">{</span> <span class=\"n\">X&#39;</span> <span class=\"o\">:</span> <span class=\"n\">set</span> <span class=\"n\">Form</span> <span class=\"bp\">//</span> <span class=\"n\">X&#39;</span><span class=\"bp\">.</span><span class=\"n\">finite</span> <span class=\"o\">}</span>\n</code></pre></div>",
        "id": 205449689,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1596094898
    },
    {
        "content": "<p>of course, the actual signature depends on your implementation and usage etc</p>",
        "id": 205449769,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1596094945
    },
    {
        "content": "<p>for example you might want to generalize <code>A</code>, i.e. put <code>A</code> after the colon</p>",
        "id": 205449782,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1596094962
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span><code><span class=\"n\">def</span> <span class=\"n\">extract_axioms</span> <span class=\"o\">:</span> <span class=\"bp\">Π</span> <span class=\"o\">{</span><span class=\"n\">A</span> <span class=\"o\">:</span> <span class=\"n\">Form</span><span class=\"o\">},</span> <span class=\"n\">deduction</span> <span class=\"n\">X</span> <span class=\"n\">A</span> <span class=\"bp\">→</span> <span class=\"o\">{</span> <span class=\"n\">X&#39;</span> <span class=\"o\">:</span> <span class=\"n\">set</span> <span class=\"n\">Form</span> <span class=\"bp\">//</span> <span class=\"n\">X&#39;</span><span class=\"bp\">.</span><span class=\"n\">finite</span> <span class=\"bp\">∧</span> <span class=\"n\">X&#39;</span> <span class=\"err\">⊆</span> <span class=\"n\">X</span> <span class=\"bp\">∧</span> <span class=\"n\">deduction</span> <span class=\"n\">X&#39;</span> <span class=\"n\">A</span> <span class=\"o\">}</span>\n</code></pre></div>",
        "id": 205449832,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1596095013
    },
    {
        "content": "<p>why not use <code>finset</code>?</p>",
        "id": 205449903,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1596095056
    },
    {
        "content": "<p>You can probably define a function from <code>deduction X A</code> to <code>{ X' : finset Form // X' \\sub X }</code>, based on my guess of how <code>deduction</code> is defined</p>",
        "id": 205457920,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1596101237
    },
    {
        "content": "<p>And therefore you can also go from <code>provable X A</code> to <code>\\ex X' : finset Form, X' \\sub X</code></p>",
        "id": 205458007,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1596101301
    },
    {
        "content": "<p>I didn't use <code>finset</code> because subset doesn't seem to work between <code>finset</code> and <code>set</code>. Also could you explain what putting the <code>A</code> after the colon does? Why does that generalise it?</p>",
        "id": 205473184,
        "sender_full_name": "Billy Price",
        "timestamp": 1596113000
    },
    {
        "content": "<p>You can cast the finset to a set</p>",
        "id": 205475891,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1596114579
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"255481\">@Billy Price</span> I think Kenny means that if you put the <code>A</code> after the colon then in the recursive definition you can change <code>A</code></p>",
        "id": 205476075,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1596114676
    },
    {
        "content": "<p>I see, not sure if I need that but maybe</p>",
        "id": 205477769,
        "sender_full_name": "Billy Price",
        "timestamp": 1596115502
    },
    {
        "content": "<p>What does this error mean? The line that triggered it is <code>use XA' ∪ XB'</code></p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"n\">failed</span> <span class=\"n\">to</span> <span class=\"n\">instantiate</span> <span class=\"n\">goal</span> <span class=\"k\">with</span> <span class=\"o\">(</span><span class=\"n\">frozen_name</span> <span class=\"n\">has_union</span><span class=\"bp\">.</span><span class=\"n\">union</span><span class=\"o\">)</span> <span class=\"n\">XA&#39;</span> <span class=\"n\">XB&#39;</span>\n<span class=\"n\">state</span><span class=\"o\">:</span>\n<span class=\"n\">X</span> <span class=\"o\">:</span> <span class=\"n\">set</span> <span class=\"n\">Form</span><span class=\"o\">,</span>\n<span class=\"n\">A</span> <span class=\"n\">B</span> <span class=\"o\">:</span> <span class=\"n\">Form</span><span class=\"o\">,</span>\n<span class=\"n\">dXA</span> <span class=\"o\">:</span> <span class=\"n\">X</span> <span class=\"err\">≻</span> <span class=\"n\">A</span><span class=\"o\">,</span>\n<span class=\"n\">dXB</span> <span class=\"o\">:</span> <span class=\"n\">X</span> <span class=\"err\">≻</span> <span class=\"n\">B</span><span class=\"o\">,</span>\n<span class=\"n\">XA&#39;</span> <span class=\"o\">:</span> <span class=\"n\">finset</span> <span class=\"n\">Form</span><span class=\"o\">,</span>\n<span class=\"n\">AsubX</span> <span class=\"o\">:</span> <span class=\"err\">↑</span><span class=\"n\">XA&#39;</span> <span class=\"err\">⊆</span> <span class=\"n\">X</span><span class=\"o\">,</span>\n<span class=\"n\">XA&#39;A</span> <span class=\"o\">:</span> <span class=\"err\">↑</span><span class=\"n\">XA&#39;</span> <span class=\"err\">⊢</span><span class=\"n\">I</span> <span class=\"n\">A</span><span class=\"o\">,</span>\n<span class=\"n\">XB&#39;</span> <span class=\"o\">:</span> <span class=\"n\">finset</span> <span class=\"n\">Form</span><span class=\"o\">,</span>\n<span class=\"n\">BsubX</span> <span class=\"o\">:</span> <span class=\"err\">↑</span><span class=\"n\">XB&#39;</span> <span class=\"err\">⊆</span> <span class=\"n\">X</span><span class=\"o\">,</span>\n<span class=\"n\">XB&#39;B</span> <span class=\"o\">:</span> <span class=\"err\">↑</span><span class=\"n\">XB&#39;</span> <span class=\"err\">⊢</span><span class=\"n\">I</span> <span class=\"n\">B</span>\n<span class=\"err\">⊢</span> <span class=\"o\">{</span><span class=\"n\">X&#39;</span> <span class=\"bp\">//</span> <span class=\"err\">↑</span><span class=\"n\">X&#39;</span> <span class=\"err\">⊆</span> <span class=\"n\">X</span> <span class=\"bp\">∧</span> <span class=\"err\">↑</span><span class=\"n\">X&#39;</span> <span class=\"err\">⊢</span><span class=\"n\">I</span> <span class=\"n\">A</span> <span class=\"err\">⋀</span> <span class=\"n\">B</span><span class=\"o\">}</span>\n</code></pre></div>",
        "id": 205477826,
        "sender_full_name": "Billy Price",
        "timestamp": 1596115535
    },
    {
        "content": "<p>try <code>existsi</code></p>",
        "id": 205478468,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1596115904
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span><code><span class=\"n\">failed</span> <span class=\"n\">to</span> <span class=\"n\">synthesize</span> <span class=\"n\">type</span> <span class=\"n\">class</span> <span class=\"kn\">instance</span> <span class=\"n\">for</span>\n<span class=\"n\">X</span> <span class=\"o\">:</span> <span class=\"n\">set</span> <span class=\"n\">Form</span><span class=\"o\">,</span>\n<span class=\"n\">A</span> <span class=\"n\">B</span> <span class=\"o\">:</span> <span class=\"n\">Form</span><span class=\"o\">,</span>\n<span class=\"n\">dXA</span> <span class=\"o\">:</span> <span class=\"n\">X</span> <span class=\"err\">≻</span> <span class=\"n\">A</span><span class=\"o\">,</span>\n<span class=\"n\">dXB</span> <span class=\"o\">:</span> <span class=\"n\">X</span> <span class=\"err\">≻</span> <span class=\"n\">B</span><span class=\"o\">,</span>\n<span class=\"n\">XA&#39;</span> <span class=\"o\">:</span> <span class=\"n\">finset</span> <span class=\"n\">Form</span><span class=\"o\">,</span>\n<span class=\"n\">AsubX</span> <span class=\"o\">:</span> <span class=\"err\">↑</span><span class=\"n\">XA&#39;</span> <span class=\"err\">⊆</span> <span class=\"n\">X</span><span class=\"o\">,</span>\n<span class=\"n\">XA&#39;A</span> <span class=\"o\">:</span> <span class=\"err\">↑</span><span class=\"n\">XA&#39;</span> <span class=\"err\">⊢</span><span class=\"n\">I</span> <span class=\"n\">A</span><span class=\"o\">,</span>\n<span class=\"n\">XB&#39;</span> <span class=\"o\">:</span> <span class=\"n\">finset</span> <span class=\"n\">Form</span><span class=\"o\">,</span>\n<span class=\"n\">BsubX</span> <span class=\"o\">:</span> <span class=\"err\">↑</span><span class=\"n\">XB&#39;</span> <span class=\"err\">⊆</span> <span class=\"n\">X</span><span class=\"o\">,</span>\n<span class=\"n\">XB&#39;B</span> <span class=\"o\">:</span> <span class=\"err\">↑</span><span class=\"n\">XB&#39;</span> <span class=\"err\">⊢</span><span class=\"n\">I</span> <span class=\"n\">B</span>\n<span class=\"err\">⊢</span> <span class=\"n\">has_union</span> <span class=\"o\">(</span><span class=\"n\">finset</span> <span class=\"n\">Form</span><span class=\"o\">)</span>\n<span class=\"n\">state</span><span class=\"o\">:</span>\n<span class=\"n\">X</span> <span class=\"o\">:</span> <span class=\"n\">set</span> <span class=\"n\">Form</span><span class=\"o\">,</span>\n<span class=\"n\">A</span> <span class=\"n\">B</span> <span class=\"o\">:</span> <span class=\"n\">Form</span><span class=\"o\">,</span>\n<span class=\"n\">dXA</span> <span class=\"o\">:</span> <span class=\"n\">X</span> <span class=\"err\">≻</span> <span class=\"n\">A</span><span class=\"o\">,</span>\n<span class=\"n\">dXB</span> <span class=\"o\">:</span> <span class=\"n\">X</span> <span class=\"err\">≻</span> <span class=\"n\">B</span><span class=\"o\">,</span>\n<span class=\"n\">XA&#39;</span> <span class=\"o\">:</span> <span class=\"n\">finset</span> <span class=\"n\">Form</span><span class=\"o\">,</span>\n<span class=\"n\">AsubX</span> <span class=\"o\">:</span> <span class=\"err\">↑</span><span class=\"n\">XA&#39;</span> <span class=\"err\">⊆</span> <span class=\"n\">X</span><span class=\"o\">,</span>\n<span class=\"n\">XA&#39;A</span> <span class=\"o\">:</span> <span class=\"err\">↑</span><span class=\"n\">XA&#39;</span> <span class=\"err\">⊢</span><span class=\"n\">I</span> <span class=\"n\">A</span><span class=\"o\">,</span>\n<span class=\"n\">XB&#39;</span> <span class=\"o\">:</span> <span class=\"n\">finset</span> <span class=\"n\">Form</span><span class=\"o\">,</span>\n<span class=\"n\">BsubX</span> <span class=\"o\">:</span> <span class=\"err\">↑</span><span class=\"n\">XB&#39;</span> <span class=\"err\">⊆</span> <span class=\"n\">X</span><span class=\"o\">,</span>\n<span class=\"n\">XB&#39;B</span> <span class=\"o\">:</span> <span class=\"err\">↑</span><span class=\"n\">XB&#39;</span> <span class=\"err\">⊢</span><span class=\"n\">I</span> <span class=\"n\">B</span>\n<span class=\"err\">⊢</span> <span class=\"o\">{</span><span class=\"n\">X&#39;</span> <span class=\"bp\">//</span> <span class=\"err\">↑</span><span class=\"n\">X&#39;</span> <span class=\"err\">⊆</span> <span class=\"n\">X</span> <span class=\"bp\">∧</span> <span class=\"err\">↑</span><span class=\"n\">X&#39;</span> <span class=\"err\">⊢</span><span class=\"n\">I</span> <span class=\"n\">A</span> <span class=\"err\">⋀</span> <span class=\"n\">B</span><span class=\"o\">}</span>\n</code></pre></div>",
        "id": 205478670,
        "sender_full_name": "Billy Price",
        "timestamp": 1596116011
    },
    {
        "content": "<p>Same thing also happens with <code>constructor, swap, exact XA' ∪ XB',</code></p>",
        "id": 205479944,
        "sender_full_name": "Billy Price",
        "timestamp": 1596116711
    },
    {
        "content": "<p>Here's a mwe</p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"kn\">import</span> <span class=\"n\">data</span><span class=\"bp\">.</span><span class=\"n\">finset</span>\n<span class=\"kn\">import</span> <span class=\"n\">tactic</span>\n<span class=\"kn\">import</span> <span class=\"n\">tactic</span><span class=\"bp\">.</span><span class=\"n\">induction</span>\n\n<span class=\"kn\">namespace</span> <span class=\"n\">nat_deduction</span>\n\n<span class=\"c\">/-</span><span class=\"cm\">- The type of Formulas, defined inductively</span>\n<span class=\"cm\">-/</span>\n<span class=\"kn\">inductive</span> <span class=\"n\">Form</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span>\n<span class=\"c1\">-- Atomic Formulas are introduced via natural numbers (atom 0, atom 1, atom 2)</span>\n<span class=\"bp\">|</span> <span class=\"n\">atom</span> <span class=\"o\">:</span> <span class=\"bp\">ℕ</span> <span class=\"bp\">→</span> <span class=\"n\">Form</span>\n<span class=\"c1\">-- conjunction</span>\n<span class=\"bp\">|</span> <span class=\"n\">and</span> <span class=\"o\">:</span> <span class=\"n\">Form</span> <span class=\"bp\">→</span> <span class=\"n\">Form</span> <span class=\"bp\">→</span> <span class=\"n\">Form</span>\n<span class=\"c1\">-- disjunction</span>\n<span class=\"bp\">|</span> <span class=\"n\">or</span>  <span class=\"o\">:</span> <span class=\"n\">Form</span> <span class=\"bp\">→</span> <span class=\"n\">Form</span> <span class=\"bp\">→</span> <span class=\"n\">Form</span>\n<span class=\"c1\">-- implication</span>\n<span class=\"bp\">|</span> <span class=\"n\">imp</span> <span class=\"o\">:</span> <span class=\"n\">Form</span> <span class=\"bp\">→</span> <span class=\"n\">Form</span> <span class=\"bp\">→</span> <span class=\"n\">Form</span>\n\n<span class=\"c1\">-- ⊥ is atom 0</span>\n<span class=\"n\">def</span> <span class=\"n\">Form</span><span class=\"bp\">.</span><span class=\"n\">bot</span> <span class=\"o\">:</span> <span class=\"n\">Form</span> <span class=\"o\">:=</span> <span class=\"n\">Form</span><span class=\"bp\">.</span><span class=\"n\">atom</span> <span class=\"mi\">0</span>\n<span class=\"c1\">-- we define `¬A` as `A ⟹ ⊥`</span>\n<span class=\"n\">def</span> <span class=\"n\">Form</span><span class=\"bp\">.</span><span class=\"n\">neg</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"o\">:</span> <span class=\"n\">Form</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">Form</span> <span class=\"o\">:=</span> <span class=\"n\">Form</span><span class=\"bp\">.</span><span class=\"n\">imp</span> <span class=\"n\">A</span> <span class=\"err\">$</span> <span class=\"n\">Form</span><span class=\"bp\">.</span><span class=\"n\">atom</span> <span class=\"mi\">0</span>\n\n<span class=\"c\">/-</span><span class=\"cm\">-</span>\n<span class=\"cm\">We now define notation and coercions for nicer looking formulas</span>\n<span class=\"cm\">-/</span>\n\n<span class=\"c1\">-- Coerce natural numbers to Formulas as atoms</span>\n<span class=\"c1\">-- Given p : ℕ, just write `p` or `↑p` instead of `atom p`</span>\n<span class=\"c1\">-- (`↑p` forces the coercion)</span>\n<span class=\"kn\">instance</span> <span class=\"n\">nat_coe_Form</span> <span class=\"o\">:</span> <span class=\"n\">has_coe</span> <span class=\"bp\">ℕ</span> <span class=\"n\">Form</span> <span class=\"o\">:=</span> <span class=\"bp\">⟨</span><span class=\"n\">Form</span><span class=\"bp\">.</span><span class=\"n\">atom</span><span class=\"bp\">⟩</span>\n\n<span class=\"kn\">infix</span> <span class=\"bp\">`</span> <span class=\"err\">⋀</span> <span class=\"bp\">`</span><span class=\"o\">:</span><span class=\"mi\">75</span> <span class=\"o\">:=</span> <span class=\"n\">Form</span><span class=\"bp\">.</span><span class=\"n\">and</span>\n<span class=\"kn\">infix</span> <span class=\"bp\">`</span> <span class=\"err\">⋁</span> <span class=\"bp\">`</span><span class=\"o\">:</span><span class=\"mi\">74</span> <span class=\"o\">:=</span> <span class=\"n\">Form</span><span class=\"bp\">.</span><span class=\"n\">or</span>\n<span class=\"kn\">infix</span> <span class=\"bp\">`</span> <span class=\"err\">⟹</span> <span class=\"bp\">`</span><span class=\"o\">:</span><span class=\"mi\">75</span> <span class=\"o\">:=</span> <span class=\"n\">Form</span><span class=\"bp\">.</span><span class=\"n\">imp</span>\n<span class=\"kn\">notation</span> <span class=\"bp\">`</span><span class=\"err\">⊥</span><span class=\"bp\">`</span> <span class=\"o\">:=</span> <span class=\"n\">Form</span><span class=\"bp\">.</span><span class=\"n\">atom</span> <span class=\"mi\">0</span>\n<span class=\"kn\">prefix</span> <span class=\"bp\">`¬`</span> <span class=\"o\">:=</span> <span class=\"bp\">λ</span> <span class=\"n\">A</span><span class=\"o\">,</span> <span class=\"n\">Form</span><span class=\"bp\">.</span><span class=\"n\">imp</span> <span class=\"n\">A</span> <span class=\"err\">⊥</span>\n<span class=\"kn\">notation</span> <span class=\"bp\">`</span><span class=\"err\">⊤</span><span class=\"bp\">`</span> <span class=\"o\">:=</span> <span class=\"bp\">¬</span><span class=\"err\">⊥</span> <span class=\"c1\">-- the simplest tautology</span>\n\n<span class=\"kn\">open</span> <span class=\"n\">Form</span>\n\n<span class=\"c\">/-</span><span class=\"cm\">- Inductive definition of a deduction X ≻ A (argument) from a set of Formulas X</span>\n<span class=\"cm\">to a Formula A. This is equivalent to the usual proof tree presentation, however,</span>\n<span class=\"cm\">there is no need to &quot;discharge&quot; Formulas - we just choose to keep them as assumptions</span>\n<span class=\"cm\">or not. This forces us to add a weakening rule to the usual collection of rules.</span>\n<span class=\"cm\">-/</span>\n<span class=\"kn\">inductive</span> <span class=\"n\">deduction</span> <span class=\"o\">:</span> <span class=\"n\">set</span> <span class=\"n\">Form</span> <span class=\"bp\">→</span> <span class=\"n\">Form</span> <span class=\"bp\">→</span> <span class=\"kt\">Type</span>\n<span class=\"bp\">|</span> <span class=\"n\">weakening</span>  <span class=\"o\">{</span><span class=\"n\">X</span><span class=\"o\">}</span> <span class=\"o\">{</span><span class=\"n\">A</span> <span class=\"n\">Y</span><span class=\"o\">}</span>     <span class=\"o\">:</span> <span class=\"n\">deduction</span> <span class=\"n\">X</span> <span class=\"n\">A</span> <span class=\"bp\">→</span> <span class=\"n\">deduction</span> <span class=\"o\">(</span><span class=\"n\">X</span> <span class=\"err\">∪</span> <span class=\"n\">Y</span><span class=\"o\">)</span> <span class=\"n\">A</span>\n<span class=\"bp\">|</span> <span class=\"n\">assumption</span> <span class=\"o\">{</span><span class=\"n\">X</span><span class=\"o\">}</span> <span class=\"o\">(</span><span class=\"n\">A</span><span class=\"o\">)</span>       <span class=\"o\">:</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"err\">∈</span> <span class=\"n\">X</span><span class=\"o\">)</span> <span class=\"bp\">→</span> <span class=\"n\">deduction</span> <span class=\"n\">X</span> <span class=\"n\">A</span>\n<span class=\"bp\">|</span> <span class=\"n\">and_intro</span>  <span class=\"o\">{</span><span class=\"n\">X</span><span class=\"o\">}</span> <span class=\"o\">{</span><span class=\"n\">A</span> <span class=\"n\">B</span><span class=\"o\">}</span>     <span class=\"o\">:</span> <span class=\"n\">deduction</span> <span class=\"n\">X</span> <span class=\"n\">A</span> <span class=\"bp\">→</span> <span class=\"n\">deduction</span> <span class=\"n\">X</span> <span class=\"n\">B</span> <span class=\"bp\">→</span> <span class=\"n\">deduction</span> <span class=\"n\">X</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"err\">⋀</span> <span class=\"n\">B</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"n\">and_left</span>   <span class=\"o\">{</span><span class=\"n\">X</span><span class=\"o\">}</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"n\">B</span><span class=\"o\">)</span>     <span class=\"o\">:</span> <span class=\"n\">deduction</span> <span class=\"n\">X</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"err\">⋀</span> <span class=\"n\">B</span><span class=\"o\">)</span> <span class=\"bp\">→</span> <span class=\"n\">deduction</span> <span class=\"n\">X</span> <span class=\"n\">A</span>\n<span class=\"bp\">|</span> <span class=\"n\">and_right</span>  <span class=\"o\">{</span><span class=\"n\">X</span><span class=\"o\">}</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"n\">B</span><span class=\"o\">)</span>     <span class=\"o\">:</span> <span class=\"n\">deduction</span> <span class=\"n\">X</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"err\">⋀</span> <span class=\"n\">B</span><span class=\"o\">)</span> <span class=\"bp\">→</span> <span class=\"n\">deduction</span> <span class=\"n\">X</span> <span class=\"n\">B</span>\n<span class=\"c1\">-- note X may or may not contain A, which corresponds to the ability to</span>\n<span class=\"c1\">-- discharge formulas which are no longer assumptions (or not).</span>\n<span class=\"bp\">|</span> <span class=\"n\">imp_intro</span>  <span class=\"o\">{</span><span class=\"n\">X</span><span class=\"o\">}</span> <span class=\"o\">{</span><span class=\"n\">A</span> <span class=\"n\">B</span><span class=\"o\">}</span>     <span class=\"o\">:</span> <span class=\"n\">deduction</span> <span class=\"o\">(</span><span class=\"n\">X</span> <span class=\"err\">∪</span> <span class=\"o\">{</span><span class=\"n\">A</span><span class=\"o\">})</span> <span class=\"n\">B</span> <span class=\"bp\">→</span> <span class=\"n\">deduction</span> <span class=\"n\">X</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"err\">⟹</span> <span class=\"n\">B</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"n\">imp_elim</span>   <span class=\"o\">{</span><span class=\"n\">X</span><span class=\"o\">}</span> <span class=\"o\">(</span><span class=\"n\">A</span><span class=\"o\">)</span> <span class=\"o\">{</span><span class=\"n\">B</span><span class=\"o\">}</span>   <span class=\"o\">:</span> <span class=\"n\">deduction</span> <span class=\"n\">X</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"err\">⟹</span> <span class=\"n\">B</span><span class=\"o\">)</span> <span class=\"bp\">→</span> <span class=\"n\">deduction</span> <span class=\"n\">X</span> <span class=\"n\">A</span> <span class=\"bp\">→</span> <span class=\"n\">deduction</span> <span class=\"n\">X</span> <span class=\"n\">B</span>\n<span class=\"bp\">|</span> <span class=\"n\">or_left</span>    <span class=\"o\">{</span><span class=\"n\">X</span><span class=\"o\">}</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"n\">B</span><span class=\"o\">)</span>     <span class=\"o\">:</span> <span class=\"n\">deduction</span> <span class=\"n\">X</span> <span class=\"n\">A</span> <span class=\"bp\">→</span> <span class=\"n\">deduction</span> <span class=\"n\">X</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"err\">⋁</span> <span class=\"n\">B</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"n\">or_right</span>   <span class=\"o\">{</span><span class=\"n\">X</span><span class=\"o\">}</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"n\">B</span><span class=\"o\">)</span>     <span class=\"o\">:</span> <span class=\"n\">deduction</span> <span class=\"n\">X</span> <span class=\"n\">B</span> <span class=\"bp\">→</span> <span class=\"n\">deduction</span> <span class=\"n\">X</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"err\">⋁</span> <span class=\"n\">B</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"n\">or_elim</span>    <span class=\"o\">{</span><span class=\"n\">X</span><span class=\"o\">}</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"n\">B</span><span class=\"o\">)</span> <span class=\"o\">{</span><span class=\"n\">C</span><span class=\"o\">}</span> <span class=\"o\">:</span> <span class=\"n\">deduction</span> <span class=\"n\">X</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"err\">⋁</span> <span class=\"n\">B</span><span class=\"o\">)</span> <span class=\"bp\">→</span> <span class=\"n\">deduction</span> <span class=\"o\">(</span><span class=\"n\">X</span> <span class=\"err\">∪</span> <span class=\"o\">{</span><span class=\"n\">A</span><span class=\"o\">})</span> <span class=\"n\">C</span> <span class=\"bp\">→</span> <span class=\"n\">deduction</span> <span class=\"o\">(</span><span class=\"n\">X</span> <span class=\"err\">∪</span> <span class=\"o\">{</span><span class=\"n\">B</span><span class=\"o\">})</span> <span class=\"n\">C</span> <span class=\"bp\">→</span> <span class=\"n\">deduction</span> <span class=\"n\">X</span> <span class=\"n\">C</span>\n<span class=\"bp\">|</span> <span class=\"n\">falsum</span>     <span class=\"o\">{</span><span class=\"n\">X</span><span class=\"o\">}</span> <span class=\"o\">{</span><span class=\"n\">A</span><span class=\"o\">}</span>       <span class=\"o\">:</span> <span class=\"n\">deduction</span> <span class=\"n\">X</span> <span class=\"err\">⊥</span> <span class=\"bp\">→</span> <span class=\"n\">deduction</span> <span class=\"n\">X</span> <span class=\"n\">A</span>\n\n<span class=\"kn\">infix</span> <span class=\"bp\">`</span> <span class=\"err\">≻</span> <span class=\"bp\">`</span><span class=\"o\">:</span><span class=\"mi\">60</span> <span class=\"o\">:=</span> <span class=\"n\">deduction</span>\n\n<span class=\"kn\">end</span> <span class=\"n\">nat_deduction</span>\n\n<span class=\"c\">/-</span><span class=\"cm\">- A tactic to produce a deduction of something like `X ∪ {A} ≻ A`,</span>\n<span class=\"cm\">via the assumption rule and an automated proof of `A ∈ X ∪ {A}`</span>\n<span class=\"cm\">-/</span>\n<span class=\"n\">meta</span> <span class=\"n\">def</span> <span class=\"n\">tactic</span><span class=\"bp\">.</span><span class=\"n\">interactive</span><span class=\"bp\">.</span><span class=\"n\">assump</span> <span class=\"o\">:</span> <span class=\"n\">tactic</span> <span class=\"n\">unit</span> <span class=\"o\">:=</span>\n  <span class=\"n\">do</span> <span class=\"bp\">`</span><span class=\"o\">[</span><span class=\"n\">apply</span> <span class=\"n\">nat_deduction</span><span class=\"bp\">.</span><span class=\"n\">deduction</span><span class=\"bp\">.</span><span class=\"n\">assumption</span> <span class=\"bp\">_;</span> <span class=\"n\">obviously</span><span class=\"o\">]</span>\n\n<span class=\"kn\">namespace</span> <span class=\"n\">nat_deduction</span>\n\n<span class=\"kn\">inductive</span> <span class=\"n\">provable</span> <span class=\"o\">(</span><span class=\"n\">X</span> <span class=\"o\">:</span> <span class=\"n\">set</span> <span class=\"n\">Form</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"o\">:</span> <span class=\"n\">Form</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"kt\">Prop</span>\n<span class=\"bp\">|</span> <span class=\"n\">mk</span> <span class=\"o\">:</span> <span class=\"n\">X</span> <span class=\"err\">≻</span> <span class=\"n\">A</span> <span class=\"bp\">→</span> <span class=\"n\">provable</span>\n\n<span class=\"kn\">infix</span> <span class=\"bp\">`</span> <span class=\"err\">⊢</span><span class=\"n\">I</span> <span class=\"bp\">`</span><span class=\"o\">:</span><span class=\"mi\">60</span> <span class=\"o\">:=</span> <span class=\"n\">provable</span>\n\n<span class=\"n\">def</span> <span class=\"n\">compactify</span> <span class=\"o\">{</span><span class=\"n\">X</span> <span class=\"n\">A</span><span class=\"o\">}</span> <span class=\"o\">:</span> <span class=\"n\">X</span> <span class=\"err\">≻</span> <span class=\"n\">A</span> <span class=\"bp\">→</span> <span class=\"o\">{</span><span class=\"n\">X&#39;</span> <span class=\"o\">:</span> <span class=\"n\">finset</span> <span class=\"n\">Form</span> <span class=\"bp\">//</span> <span class=\"err\">↑</span><span class=\"n\">X&#39;</span> <span class=\"err\">⊆</span> <span class=\"n\">X</span> <span class=\"bp\">∧</span> <span class=\"err\">↑</span><span class=\"n\">X&#39;</span> <span class=\"err\">⊢</span><span class=\"n\">I</span> <span class=\"n\">A</span> <span class=\"o\">}</span> <span class=\"o\">:=</span>\n<span class=\"k\">begin</span>\n  <span class=\"n\">intro</span> <span class=\"n\">dXA</span><span class=\"o\">,</span>\n  <span class=\"n\">induction&#39;</span> <span class=\"n\">dXA</span><span class=\"o\">,</span>\n  <span class=\"n\">case</span> <span class=\"n\">weakening</span> <span class=\"o\">:</span>\n    <span class=\"o\">{</span> <span class=\"n\">rcases</span> <span class=\"n\">ih</span> <span class=\"k\">with</span> <span class=\"bp\">⟨</span><span class=\"n\">X&#39;</span><span class=\"o\">,</span> <span class=\"n\">subX</span><span class=\"o\">,</span> <span class=\"n\">X&#39;pA</span><span class=\"bp\">⟩</span><span class=\"o\">,</span>\n      <span class=\"n\">use</span> <span class=\"n\">X&#39;</span><span class=\"o\">,</span>\n      <span class=\"n\">split</span><span class=\"o\">,</span> <span class=\"n\">apply</span> <span class=\"n\">set</span><span class=\"bp\">.</span><span class=\"n\">subset_union_of_subset_left</span><span class=\"o\">,</span>\n      <span class=\"n\">tidy</span> <span class=\"o\">},</span>\n  <span class=\"n\">case</span> <span class=\"n\">assumption</span> <span class=\"o\">:</span>\n    <span class=\"o\">{</span> <span class=\"n\">use</span> <span class=\"o\">{</span><span class=\"n\">A</span><span class=\"o\">},</span> <span class=\"n\">tidy</span><span class=\"o\">,</span>\n      <span class=\"n\">assump</span> <span class=\"o\">},</span>\n  <span class=\"n\">case</span> <span class=\"n\">and_intro</span> <span class=\"o\">:</span> <span class=\"n\">X</span> <span class=\"n\">A</span> <span class=\"n\">B</span> <span class=\"n\">dXA</span> <span class=\"n\">dXB</span> <span class=\"n\">ih₁</span> <span class=\"n\">ih₂</span>\n    <span class=\"o\">{</span> <span class=\"n\">rcases</span> <span class=\"n\">ih₁</span> <span class=\"k\">with</span> <span class=\"bp\">⟨</span><span class=\"n\">XA&#39;</span><span class=\"o\">,</span> <span class=\"n\">AsubX</span><span class=\"o\">,</span> <span class=\"n\">XA&#39;pA</span><span class=\"bp\">⟩</span><span class=\"o\">,</span>\n      <span class=\"n\">rcases</span> <span class=\"n\">ih₂</span> <span class=\"k\">with</span> <span class=\"bp\">⟨</span><span class=\"n\">XB&#39;</span><span class=\"o\">,</span> <span class=\"n\">BsubX</span><span class=\"o\">,</span> <span class=\"n\">XB&#39;pB</span><span class=\"bp\">⟩</span><span class=\"o\">,</span>\n      <span class=\"n\">existsi</span> <span class=\"n\">XA&#39;</span> <span class=\"err\">∪</span> <span class=\"n\">XB&#39;</span><span class=\"o\">,</span>\n      <span class=\"n\">sorry</span> <span class=\"o\">}</span>\n\n<span class=\"kn\">end</span>\n</code></pre></div>",
        "id": 205480740,
        "sender_full_name": "Billy Price",
        "timestamp": 1596117150
    },
    {
        "content": "<p>Ah, you forgot to prove <code>decidable_eq Form</code></p>",
        "id": 205487112,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1596120204
    },
    {
        "content": "<p>use <code>@[derive decidable_eq]</code></p>",
        "id": 205489064,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1596121040
    },
    {
        "content": "<p>Interesting, how do I know when I need to show decidable equality?</p>",
        "id": 205547761,
        "sender_full_name": "Billy Price",
        "timestamp": 1596155839
    },
    {
        "content": "<p>Also when defining an inductive type, is it possible to have a constructor whose target type is a product of the inductive type?<br>\nFor example,</p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"kn\">inductive</span> <span class=\"n\">deduction</span> <span class=\"o\">:</span> <span class=\"n\">set</span> <span class=\"n\">Form</span> <span class=\"bp\">→</span> <span class=\"n\">Form</span> <span class=\"bp\">→</span> <span class=\"kt\">Type</span>\n<span class=\"bp\">|</span> <span class=\"n\">and_elim</span>   <span class=\"o\">{</span><span class=\"n\">X</span><span class=\"o\">}</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"n\">B</span><span class=\"o\">)</span>     <span class=\"o\">:</span> <span class=\"n\">deduction</span> <span class=\"n\">X</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"err\">⋀</span> <span class=\"n\">B</span><span class=\"o\">)</span> <span class=\"bp\">→</span> <span class=\"n\">deduction</span> <span class=\"n\">X</span> <span class=\"n\">A</span> <span class=\"err\">⨯</span> <span class=\"n\">deduction</span> <span class=\"n\">X</span> <span class=\"n\">B</span>\n</code></pre></div>",
        "id": 205547850,
        "sender_full_name": "Billy Price",
        "timestamp": 1596155992
    },
    {
        "content": "<p>This gives me <code>unexpected token</code> on the <code>\\times</code></p>",
        "id": 205547906,
        "sender_full_name": "Billy Price",
        "timestamp": 1596156025
    },
    {
        "content": "<p>No, each constructor must produce a <code>deduction</code>. For this example you need <code>and_left</code> and <code>and_right</code>.</p>",
        "id": 205563307,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1596178764
    },
    {
        "content": "<p>Yeah that's what I had, just trying to invest in less cases for the inductive proofs to follow. Could this be added to the functionality of <code>inductive</code>? (where in the background, it just splits it into two constructors). I had the same thought about and <code>\\iff</code> kind of constructor for inductive propositions.</p>",
        "id": 205592807,
        "sender_full_name": "Billy Price",
        "timestamp": 1596203941
    },
    {
        "content": "<p>Even if <code>inductive</code> had this functionality, how would this reduce the number of cases for induction proofs? What induction step do you think you would get from the constructor <code>and_elim</code>?</p>",
        "id": 205614208,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1596214440
    },
    {
        "content": "<p>I suppose it wouldn't make sense to collect an <code>\\iff</code> induction into single case, since there's different inductive hypotheses for each direction, but for the <code>\\times</code> situation like <code>and_elim</code> it would just be like <code>and_left</code> and <code>and_right</code>, and you just produce both within the same case.</p>",
        "id": 205659279,
        "sender_full_name": "Billy Price",
        "timestamp": 1596248314
    },
    {
        "content": "<p>you can of course write these induction principles if you want to use them</p>",
        "id": 205659610,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1596248917
    },
    {
        "content": "<p>I assumed that something <code>inductive</code> would be core and untouchable?</p>",
        "id": 205659713,
        "sender_full_name": "Billy Price",
        "timestamp": 1596249117
    },
    {
        "content": "<p>This is my attempt at formalising boolean models (this code is self contained). I had to add the <code>reducible</code> tag to <code>Model</code> otherwise it didn't understand <code>n ∈ M</code>, and it wouldn't recognise <code>{p,q}</code> as a <code>Model</code>. I did some reading on <code>reducible</code> <code>semireducible</code> and <code>irreducible</code> but I'm not sure if this is the correct usage - why do I need any tag at all? Isn't it obvious that a model satisfies <code>has_elem</code> and all the other properties of <code>finset Form</code>?</p>\n<p>My main question however is that my use of <code>finset.fold</code> does not work properly when I use variable atoms. Specifically the first <code>#reduce</code> command successfully evaluates to <code>tt</code>, but the second is some giant mess with lots of <code>decidable.rec</code>. I do understand somewhat why this relates to decidability, but I have no idea how to fix it.</p>\n<p>I am open to suggestions of betters ways of formalising models in Lean, I just did it this way because its very concise to state a model (just declare the set of true atoms). I tried looking through the flypitch project but I didn't find anything I could recognise as a model.</p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"kn\">import</span> <span class=\"n\">data</span><span class=\"bp\">.</span><span class=\"n\">finset</span>\n\n<span class=\"bp\">@</span><span class=\"o\">[</span><span class=\"n\">derive</span> <span class=\"n\">decidable_eq</span><span class=\"o\">]</span>\n<span class=\"kn\">inductive</span> <span class=\"n\">Form</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span>\n<span class=\"bp\">|</span> <span class=\"n\">bot</span> <span class=\"o\">:</span> <span class=\"n\">Form</span>\n<span class=\"bp\">|</span> <span class=\"n\">atom</span> <span class=\"o\">:</span> <span class=\"bp\">ℕ</span> <span class=\"bp\">→</span> <span class=\"n\">Form</span>\n<span class=\"bp\">|</span> <span class=\"n\">and</span> <span class=\"o\">:</span> <span class=\"n\">Form</span> <span class=\"bp\">→</span> <span class=\"n\">Form</span> <span class=\"bp\">→</span> <span class=\"n\">Form</span>\n<span class=\"bp\">|</span> <span class=\"n\">or</span>  <span class=\"o\">:</span> <span class=\"n\">Form</span> <span class=\"bp\">→</span> <span class=\"n\">Form</span> <span class=\"bp\">→</span> <span class=\"n\">Form</span>\n<span class=\"bp\">|</span> <span class=\"n\">imp</span> <span class=\"o\">:</span> <span class=\"n\">Form</span> <span class=\"bp\">→</span> <span class=\"n\">Form</span> <span class=\"bp\">→</span> <span class=\"n\">Form</span>\n\n<span class=\"kn\">infix</span> <span class=\"bp\">`</span> <span class=\"err\">⋀</span> <span class=\"bp\">`</span><span class=\"o\">:</span><span class=\"mi\">75</span> <span class=\"o\">:=</span> <span class=\"n\">Form</span><span class=\"bp\">.</span><span class=\"n\">and</span>\n<span class=\"kn\">infix</span> <span class=\"bp\">`</span> <span class=\"err\">⋁</span> <span class=\"bp\">`</span><span class=\"o\">:</span><span class=\"mi\">74</span> <span class=\"o\">:=</span> <span class=\"n\">Form</span><span class=\"bp\">.</span><span class=\"n\">or</span>\n<span class=\"kn\">infix</span> <span class=\"bp\">`</span> <span class=\"err\">⟹</span> <span class=\"bp\">`</span><span class=\"o\">:</span><span class=\"mi\">75</span> <span class=\"o\">:=</span> <span class=\"n\">Form</span><span class=\"bp\">.</span><span class=\"n\">imp</span>\n<span class=\"kn\">notation</span> <span class=\"bp\">`</span><span class=\"err\">⊥</span><span class=\"bp\">`</span> <span class=\"o\">:=</span> <span class=\"n\">Form</span><span class=\"bp\">.</span><span class=\"n\">bot</span>\n\n<span class=\"kn\">instance</span> <span class=\"n\">nat_coe_Form</span> <span class=\"o\">:</span> <span class=\"n\">has_coe</span> <span class=\"bp\">ℕ</span> <span class=\"n\">Form</span> <span class=\"o\">:=</span> <span class=\"bp\">⟨</span><span class=\"n\">Form</span><span class=\"bp\">.</span><span class=\"n\">atom</span><span class=\"bp\">⟩</span>\n\n<span class=\"bp\">@</span><span class=\"o\">[</span><span class=\"kn\">reducible</span><span class=\"o\">]</span>\n<span class=\"n\">def</span> <span class=\"n\">Model</span> <span class=\"o\">:=</span> <span class=\"n\">finset</span> <span class=\"bp\">ℕ</span>\n\n<span class=\"n\">def</span> <span class=\"n\">Form</span><span class=\"bp\">.</span><span class=\"n\">eval_model</span> <span class=\"o\">(</span><span class=\"n\">M</span> <span class=\"o\">:</span> <span class=\"n\">Model</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">Form</span> <span class=\"bp\">→</span> <span class=\"n\">bool</span>\n<span class=\"bp\">|</span> <span class=\"err\">⊥</span>       <span class=\"o\">:=</span> <span class=\"n\">ff</span>\n<span class=\"bp\">|</span> <span class=\"o\">(</span><span class=\"n\">n</span> <span class=\"o\">:</span> <span class=\"bp\">ℕ</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"o\">(</span><span class=\"n\">n</span> <span class=\"err\">∈</span> <span class=\"n\">M</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"err\">⋀</span> <span class=\"n\">B</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"n\">Form</span><span class=\"bp\">.</span><span class=\"n\">eval_model</span> <span class=\"n\">A</span> <span class=\"bp\">&amp;&amp;</span> <span class=\"n\">Form</span><span class=\"bp\">.</span><span class=\"n\">eval_model</span> <span class=\"n\">B</span>\n<span class=\"bp\">|</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"err\">⋁</span> <span class=\"n\">B</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"n\">Form</span><span class=\"bp\">.</span><span class=\"n\">eval_model</span> <span class=\"n\">A</span> <span class=\"bp\">||</span> <span class=\"n\">Form</span><span class=\"bp\">.</span><span class=\"n\">eval_model</span> <span class=\"n\">B</span>\n<span class=\"bp\">|</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"err\">⟹</span> <span class=\"n\">B</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"o\">(</span><span class=\"n\">bnot</span> <span class=\"err\">$</span> <span class=\"n\">Form</span><span class=\"bp\">.</span><span class=\"n\">eval_model</span> <span class=\"n\">A</span><span class=\"o\">)</span> <span class=\"bp\">||</span> <span class=\"n\">Form</span><span class=\"bp\">.</span><span class=\"n\">eval_model</span> <span class=\"n\">B</span>\n\n<span class=\"kn\">instance</span> <span class=\"o\">:</span> <span class=\"n\">is_commutative</span> <span class=\"n\">bool</span> <span class=\"n\">band</span> <span class=\"o\">:=</span> <span class=\"bp\">⟨λ</span> <span class=\"n\">a</span> <span class=\"n\">b</span><span class=\"o\">,</span>   <span class=\"k\">by</span> <span class=\"o\">{</span> <span class=\"n\">cases</span> <span class=\"n\">a</span><span class=\"bp\">;</span> <span class=\"n\">simp</span> <span class=\"o\">}</span><span class=\"bp\">⟩</span>\n<span class=\"kn\">instance</span> <span class=\"o\">:</span> <span class=\"n\">is_associative</span> <span class=\"n\">bool</span> <span class=\"n\">band</span> <span class=\"o\">:=</span> <span class=\"bp\">⟨λ</span> <span class=\"n\">a</span> <span class=\"n\">b</span> <span class=\"n\">c</span><span class=\"o\">,</span> <span class=\"k\">by</span> <span class=\"o\">{</span> <span class=\"n\">cases</span> <span class=\"n\">a</span><span class=\"bp\">;</span> <span class=\"n\">simp</span> <span class=\"o\">}</span><span class=\"bp\">⟩</span>\n\n<span class=\"n\">def</span> <span class=\"n\">eval_model</span> <span class=\"o\">(</span><span class=\"n\">M</span> <span class=\"o\">:</span> <span class=\"n\">Model</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">finset</span> <span class=\"n\">Form</span> <span class=\"bp\">→</span> <span class=\"n\">bool</span> <span class=\"o\">:=</span> <span class=\"n\">finset</span><span class=\"bp\">.</span><span class=\"n\">fold</span> <span class=\"n\">band</span> <span class=\"n\">tt</span> <span class=\"o\">(</span><span class=\"n\">Form</span><span class=\"bp\">.</span><span class=\"n\">eval_model</span> <span class=\"n\">M</span><span class=\"o\">)</span>\n\n<span class=\"kn\">variables</span> <span class=\"n\">p</span> <span class=\"n\">q</span> <span class=\"o\">:</span> <span class=\"bp\">ℕ</span>\n\n<span class=\"bp\">#</span><span class=\"n\">reduce</span> <span class=\"n\">eval_model</span> <span class=\"o\">{</span><span class=\"mi\">0</span><span class=\"o\">,</span><span class=\"mi\">1</span><span class=\"o\">}</span> <span class=\"o\">{</span><span class=\"err\">↑</span><span class=\"mi\">0</span> <span class=\"err\">⋁</span> <span class=\"err\">↑</span><span class=\"mi\">1</span><span class=\"o\">,</span> <span class=\"err\">↑</span><span class=\"mi\">1</span><span class=\"o\">}</span>\n<span class=\"bp\">#</span><span class=\"n\">reduce</span> <span class=\"n\">eval_model</span> <span class=\"o\">{</span><span class=\"n\">p</span><span class=\"o\">,</span><span class=\"n\">q</span><span class=\"o\">}</span> <span class=\"o\">{</span><span class=\"n\">p</span> <span class=\"err\">⋁</span> <span class=\"n\">q</span><span class=\"o\">,</span> <span class=\"n\">q</span><span class=\"o\">}</span>\n</code></pre></div>",
        "id": 205660745,
        "sender_full_name": "Billy Price",
        "timestamp": 1596251003
    },
    {
        "content": "<p>I've attempted to simplify my question, but this simpler version now gives <code>deterministic timeout</code> on the last line. I know in general it probably isn't possible to \"compute\" elementhood for any set, but surely it's possible to do so with finite sets and natural numbers, which have decidable equality.</p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"kn\">import</span> <span class=\"n\">data</span><span class=\"bp\">.</span><span class=\"n\">finset</span>\n\n<span class=\"kn\">instance</span> <span class=\"o\">:</span> <span class=\"n\">is_commutative</span> <span class=\"n\">bool</span> <span class=\"n\">band</span> <span class=\"o\">:=</span> <span class=\"bp\">⟨λ</span> <span class=\"n\">a</span> <span class=\"n\">b</span><span class=\"o\">,</span>   <span class=\"k\">by</span> <span class=\"o\">{</span> <span class=\"n\">cases</span> <span class=\"n\">a</span><span class=\"bp\">;</span> <span class=\"n\">simp</span> <span class=\"o\">}</span><span class=\"bp\">⟩</span>\n<span class=\"kn\">instance</span> <span class=\"o\">:</span> <span class=\"n\">is_associative</span> <span class=\"n\">bool</span> <span class=\"n\">band</span> <span class=\"o\">:=</span> <span class=\"bp\">⟨λ</span> <span class=\"n\">a</span> <span class=\"n\">b</span> <span class=\"n\">c</span><span class=\"o\">,</span> <span class=\"k\">by</span> <span class=\"o\">{</span> <span class=\"n\">cases</span> <span class=\"n\">a</span><span class=\"bp\">;</span> <span class=\"n\">simp</span> <span class=\"o\">}</span><span class=\"bp\">⟩</span>\n\n<span class=\"kn\">variables</span> <span class=\"o\">{</span><span class=\"n\">p</span> <span class=\"n\">q</span> <span class=\"n\">r</span> <span class=\"o\">:</span> <span class=\"bp\">ℕ</span><span class=\"o\">}</span>\n\n<span class=\"n\">def</span> <span class=\"n\">A</span> <span class=\"o\">:</span> <span class=\"n\">finset</span> <span class=\"bp\">ℕ</span> <span class=\"o\">:=</span> <span class=\"o\">{</span><span class=\"mi\">0</span><span class=\"o\">,</span> <span class=\"mi\">1</span><span class=\"o\">,</span> <span class=\"mi\">2</span><span class=\"o\">}</span>\n<span class=\"n\">def</span> <span class=\"n\">B</span> <span class=\"o\">:</span> <span class=\"n\">finset</span> <span class=\"bp\">ℕ</span> <span class=\"o\">:=</span> <span class=\"o\">{</span><span class=\"n\">p</span><span class=\"o\">,</span> <span class=\"n\">q</span><span class=\"o\">,</span> <span class=\"n\">r</span><span class=\"o\">}</span>\n\n<span class=\"bp\">#</span><span class=\"n\">reduce</span> <span class=\"n\">finset</span><span class=\"bp\">.</span><span class=\"n\">fold</span> <span class=\"n\">band</span> <span class=\"n\">tt</span> <span class=\"o\">(</span><span class=\"bp\">λ</span> <span class=\"n\">n</span><span class=\"o\">,</span> <span class=\"n\">n</span> <span class=\"err\">∈</span> <span class=\"n\">A</span><span class=\"o\">)</span> <span class=\"o\">{</span><span class=\"mi\">0</span><span class=\"o\">,</span> <span class=\"mi\">1</span><span class=\"o\">}</span>\n<span class=\"bp\">#</span><span class=\"n\">reduce</span> <span class=\"n\">finset</span><span class=\"bp\">.</span><span class=\"n\">fold</span> <span class=\"n\">band</span> <span class=\"n\">tt</span> <span class=\"o\">(</span><span class=\"bp\">λ</span> <span class=\"n\">n</span><span class=\"o\">,</span> <span class=\"n\">n</span> <span class=\"err\">∈</span> <span class=\"n\">B</span><span class=\"o\">)</span> <span class=\"o\">{</span><span class=\"n\">p</span><span class=\"o\">,</span> <span class=\"n\">q</span><span class=\"o\">}</span>\n</code></pre></div>",
        "id": 205751648,
        "sender_full_name": "Billy Price",
        "timestamp": 1596416884
    },
    {
        "content": "<p>The last line involves open terms--I'm not sure what you're expecting to happen here?</p>",
        "id": 205751736,
        "sender_full_name": "Reid Barton",
        "timestamp": 1596417033
    },
    {
        "content": "<p>It will probably generate something pretty big before getting stuck.</p>",
        "id": 205751757,
        "sender_full_name": "Reid Barton",
        "timestamp": 1596417100
    },
    {
        "content": "<p>Well the answer is <code>tt</code> right?</p>",
        "id": 205751953,
        "sender_full_name": "Billy Price",
        "timestamp": 1596417405
    },
    {
        "content": "<p>nope!</p>",
        "id": 205751957,
        "sender_full_name": "Reid Barton",
        "timestamp": 1596417423
    },
    {
        "content": "<p>Is that because something like <code>p \\in {p}</code> isn't definitionally equal to <code>true</code> or something? Even though it's logically equivalent?</p>",
        "id": 205752026,
        "sender_full_name": "Billy Price",
        "timestamp": 1596417534
    },
    {
        "content": "<p>yes, that is a simpler example</p>",
        "id": 205752042,
        "sender_full_name": "Reid Barton",
        "timestamp": 1596417593
    },
    {
        "content": "<p><code>p \\in {p}</code> is definitionally equal to something like <code>p = p</code> I guess</p>",
        "id": 205752088,
        "sender_full_name": "Reid Barton",
        "timestamp": 1596417616
    },
    {
        "content": "<p>but this isn't definitionally equal to <code>true</code>, you need an axiom for that</p>",
        "id": 205752097,
        "sender_full_name": "Reid Barton",
        "timestamp": 1596417639
    },
    {
        "content": "<p>similarly, to know what <code>{p, q}</code> even means (which controls the structure of the computation of <code>finset.fold</code>), you need to know whether <code>p</code> equals <code>q</code></p>",
        "id": 205752169,
        "sender_full_name": "Reid Barton",
        "timestamp": 1596417768
    },
    {
        "content": "<p>so you'll get stuck on that front fairly quickly</p>",
        "id": 205752171,
        "sender_full_name": "Reid Barton",
        "timestamp": 1596417777
    },
    {
        "content": "<p>there is an algorithm for computing <code>{p, q}</code>, which uses the decision procedure for equality on <code>nat</code>, which will try to apply induction to the variable <code>p</code> (or <code>q</code>) and get stuck there</p>",
        "id": 205752228,
        "sender_full_name": "Reid Barton",
        "timestamp": 1596417872
    },
    {
        "content": "<p>How do workaround this, so that I can apply a model to a set of formulas, and have it separate into a bunch of facts about the valuations of each formula. For example take the model <code>v(p)=1, v(q)=0</code> (and everything other atom gets <code>0</code>) (represented however), then on this set of formulas <code>{p, p V q, p &amp; q}</code> I want to automatically introduce these facts into the goal state: <code>v(p)=1, v(p V q) = 1, v(p &amp; q) = 0</code>.</p>",
        "id": 205752508,
        "sender_full_name": "Billy Price",
        "timestamp": 1596418427
    },
    {
        "content": "<p>Whoops instead of 0 and 1 I mean <code>ff</code> and <code>tt</code></p>",
        "id": 205752555,
        "sender_full_name": "Billy Price",
        "timestamp": 1596418454
    },
    {
        "content": "<p>Sorry I just realised this is different since I'm not <code>band</code>ing the results all together, but both of these are objectives of mine</p>",
        "id": 205752692,
        "sender_full_name": "Billy Price",
        "timestamp": 1596418691
    },
    {
        "content": "<p>Oh wait I should just do <code>\\forall A \\in {p,q}, &lt;model assigns tt to A&gt;</code> right?</p>",
        "id": 205752724,
        "sender_full_name": "Billy Price",
        "timestamp": 1596418767
    },
    {
        "content": "<p>definitional equality is overrated</p>",
        "id": 205753368,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1596419624
    },
    {
        "content": "<p>just use a bunch of simp lemmas</p>",
        "id": 205753371,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1596419627
    },
    {
        "content": "<p>yes that will work</p>",
        "id": 205753420,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1596419652
    },
    {
        "content": "<p>Is there a <code>simp</code> lemma that would convert <code>\\forall A \\in {p,q,r}, P A</code> to <code>P p \\and  \\forall A \\in {q,r}</code> (where repeated application would yield the conjunction <code>P p \\and P q \\and P r</code>) ? I'm guessing this would come down to how that finset notation is defined, but I couldn't find anything in the finset folder.</p>",
        "id": 205754959,
        "sender_full_name": "Billy Price",
        "timestamp": 1596421919
    },
    {
        "content": "<p><code>rw mem_insert_iff</code>  then something about <code>forall_or</code>?</p>",
        "id": 205755683,
        "sender_full_name": "Alex J. Best",
        "timestamp": 1596423111
    },
    {
        "content": "<p><code>finset.forall_mem_insert</code>. (not <code>@[simp]</code> btw)</p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"kn\">import</span> <span class=\"n\">data</span><span class=\"bp\">.</span><span class=\"n\">finset</span>\n\n<span class=\"kn\">variables</span> <span class=\"o\">(</span><span class=\"n\">α</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"n\">q</span> <span class=\"n\">r</span> <span class=\"o\">:</span> <span class=\"n\">α</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">P</span> <span class=\"o\">:</span> <span class=\"n\">α</span> <span class=\"bp\">→</span> <span class=\"kt\">Prop</span><span class=\"o\">)</span> <span class=\"o\">[</span><span class=\"n\">decidable_eq</span> <span class=\"n\">α</span><span class=\"o\">]</span>\n\n<span class=\"kn\">example</span> <span class=\"o\">:</span> <span class=\"o\">(</span><span class=\"bp\">∀</span> <span class=\"n\">A</span> <span class=\"err\">∈</span> <span class=\"o\">({</span><span class=\"n\">p</span><span class=\"o\">,</span> <span class=\"n\">q</span><span class=\"o\">,</span> <span class=\"n\">r</span><span class=\"o\">}</span> <span class=\"o\">:</span> <span class=\"n\">finset</span> <span class=\"n\">α</span><span class=\"o\">),</span> <span class=\"n\">P</span> <span class=\"n\">A</span><span class=\"o\">)</span> <span class=\"bp\">↔</span> <span class=\"o\">(</span><span class=\"n\">P</span> <span class=\"n\">p</span> <span class=\"bp\">∧</span> <span class=\"bp\">∀</span> <span class=\"n\">A</span> <span class=\"err\">∈</span> <span class=\"o\">({</span><span class=\"n\">q</span><span class=\"o\">,</span> <span class=\"n\">r</span><span class=\"o\">}</span> <span class=\"o\">:</span> <span class=\"n\">finset</span> <span class=\"n\">α</span><span class=\"o\">),</span> <span class=\"n\">P</span> <span class=\"n\">A</span><span class=\"o\">)</span> <span class=\"o\">:=</span>\n<span class=\"k\">by</span> <span class=\"n\">rw</span> <span class=\"n\">finset</span><span class=\"bp\">.</span><span class=\"n\">forall_mem_insert</span>\n</code></pre></div>",
        "id": 205755745,
        "sender_full_name": "Shing Tak Lam",
        "timestamp": 1596423214
    },
    {
        "content": "<p>and your example yielding a conjunction:</p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"kn\">example</span> <span class=\"o\">:</span> <span class=\"o\">(</span><span class=\"bp\">∀</span> <span class=\"n\">A</span> <span class=\"err\">∈</span> <span class=\"o\">({</span><span class=\"n\">p</span><span class=\"o\">,</span> <span class=\"n\">q</span><span class=\"o\">,</span> <span class=\"n\">r</span><span class=\"o\">}</span> <span class=\"o\">:</span> <span class=\"n\">finset</span> <span class=\"n\">α</span><span class=\"o\">),</span> <span class=\"n\">P</span> <span class=\"n\">A</span><span class=\"o\">)</span> <span class=\"bp\">↔</span> <span class=\"n\">P</span> <span class=\"n\">p</span> <span class=\"bp\">∧</span> <span class=\"n\">P</span> <span class=\"n\">q</span> <span class=\"bp\">∧</span> <span class=\"n\">P</span> <span class=\"n\">r</span> <span class=\"o\">:=</span>\n<span class=\"k\">by</span> <span class=\"n\">simp</span> <span class=\"n\">only</span> <span class=\"o\">[</span><span class=\"n\">finset</span><span class=\"bp\">.</span><span class=\"n\">forall_mem_insert</span><span class=\"o\">,</span> <span class=\"n\">forall_eq</span><span class=\"o\">,</span> <span class=\"n\">finset</span><span class=\"bp\">.</span><span class=\"n\">mem_singleton</span><span class=\"o\">]</span>\n</code></pre></div>",
        "id": 205755807,
        "sender_full_name": "Shing Tak Lam",
        "timestamp": 1596423307
    },
    {
        "content": "<p>Cool! Thanks for that :)</p>",
        "id": 205755917,
        "sender_full_name": "Billy Price",
        "timestamp": 1596423483
    },
    {
        "content": "<p>Why isn't this a <code>set</code> theorem?</p>",
        "id": 205759820,
        "sender_full_name": "Billy Price",
        "timestamp": 1596430212
    },
    {
        "content": "<p>Because it's not true for some subtle reason I'm missing or it just hasn't been written yet?</p>",
        "id": 205759897,
        "sender_full_name": "Billy Price",
        "timestamp": 1596430394
    },
    {
        "content": "<p>Oh nevermind it's called <code>ball_insert_iff</code></p>",
        "id": 205760539,
        "sender_full_name": "Billy Price",
        "timestamp": 1596431553
    },
    {
        "content": "<p>Why does notation not work properly in the goal-view for <code>𝕏</code> but it works as expected for <code>𝕐</code>?</p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"kn\">inductive</span> <span class=\"n\">foo</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span>\n<span class=\"bp\">|</span> <span class=\"n\">bar</span> <span class=\"o\">:</span> <span class=\"bp\">ℕ</span> <span class=\"bp\">→</span> <span class=\"n\">foo</span>\n<span class=\"bp\">|</span> <span class=\"n\">baz</span> <span class=\"o\">:</span> <span class=\"n\">foo</span>\n\n<span class=\"kn\">notation</span> <span class=\"bp\">`</span><span class=\"err\">𝕏</span><span class=\"bp\">`</span> <span class=\"o\">:=</span> <span class=\"n\">foo</span><span class=\"bp\">.</span><span class=\"n\">bar</span> <span class=\"mi\">0</span>\n<span class=\"kn\">notation</span> <span class=\"bp\">`</span><span class=\"err\">𝕐</span><span class=\"bp\">`</span> <span class=\"o\">:=</span> <span class=\"n\">foo</span><span class=\"bp\">.</span><span class=\"n\">baz</span>\n\n<span class=\"bp\">#</span><span class=\"kn\">check</span> <span class=\"err\">𝕏</span> <span class=\"c1\">-- foo.bar 0 : foo</span>\n<span class=\"bp\">#</span><span class=\"kn\">check</span> <span class=\"err\">𝕐</span> <span class=\"c1\">-- 𝕐 : foo</span>\n</code></pre></div>",
        "id": 206217756,
        "sender_full_name": "Billy Price",
        "timestamp": 1596765882
    },
    {
        "content": "<p>Is it because the there's no general notation for <code>foo.bar n</code>?</p>",
        "id": 206257439,
        "sender_full_name": "Billy Price",
        "timestamp": 1596807556
    },
    {
        "content": "<p>Lean has to have an \"unparser\" to be able to do printing like this, and apparently it only works on constants, not composite terms</p>",
        "id": 206259193,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1596808530
    },
    {
        "content": "<p>:(</p>",
        "id": 206259434,
        "sender_full_name": "Billy Price",
        "timestamp": 1596808637
    },
    {
        "content": "<p>Ah I see how to fix it, </p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"n\">def</span> <span class=\"n\">zero_bar</span> <span class=\"o\">:=</span> <span class=\"n\">foo</span><span class=\"bp\">.</span><span class=\"n\">bar</span> <span class=\"mi\">0</span>\n<span class=\"kn\">notation</span> <span class=\"bp\">`</span><span class=\"err\">𝕏</span><span class=\"bp\">`</span> <span class=\"o\">:=</span> <span class=\"n\">zero_bar</span>\n</code></pre></div>",
        "id": 206259869,
        "sender_full_name": "Billy Price",
        "timestamp": 1596808847
    }
]