[
    {
        "content": "<p>Someone at Xena just asked me how to define addition on the following data structure:</p>",
        "id": 187019277,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1580411081
    },
    {
        "content": "<p><a href=\"/user_uploads/3121/DvyBQEk4heHMyfrEPMefa9hZ/IMG_20200130_190334916.jpg\" target=\"_blank\" title=\"IMG_20200130_190334916.jpg\">IMG_20200130_190334916.jpg</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/DvyBQEk4heHMyfrEPMefa9hZ/IMG_20200130_190334916.jpg\" target=\"_blank\" title=\"IMG_20200130_190334916.jpg\"><img src=\"/user_uploads/3121/DvyBQEk4heHMyfrEPMefa9hZ/IMG_20200130_190334916.jpg\"></a></div>",
        "id": 187019360,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1580411125
    },
    {
        "content": "<p>In some sense, this is already in mathlib, as (particular terms in)<code>pgame</code>.</p>",
        "id": 187021005,
        "sender_full_name": "Scott Morrison",
        "timestamp": 1580412165
    },
    {
        "content": "<p>Yes, but to actually define addition on the data structure one needs some kind of reduction algorithm to turn the non-standard form of the number back into a number :-/</p>",
        "id": 187021979,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1580412737
    },
    {
        "content": "<p>In some sense, this is already in mathlib, because mathlib has localisations and so it has <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"double-struck\">Z</mi><mo stretchy=\"false\">[</mo><mn>1</mn><mi mathvariant=\"normal\">/</mi><mn>2</mn><mo stretchy=\"false\">]</mo></mrow><annotation encoding=\"application/x-tex\">\\mathbb{Z}[1/2]</annotation></semantics></math></span><span aria-hidden=\"true\" class=\"katex-html\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\"><span class=\"mord mathbb\">Z</span></span><span class=\"mopen\">[</span><span class=\"mord\">1</span><span class=\"mord\">/</span><span class=\"mord\">2</span><span class=\"mclose\">]</span></span></span></span> :P</p>",
        "id": 187022035,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1580412769
    },
    {
        "content": "<p>first things first, can you define the map from trees to real?</p>",
        "id": 187022257,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1580412937
    },
    {
        "content": "<p>ha yeah, that took us a while :-)</p>",
        "id": 187022290,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1580412956
    },
    {
        "content": "<p>You have to rewrite the tree as the integers with a tree hanging off each integer</p>",
        "id": 187022374,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1580412986
    },
    {
        "content": "<p>and the moment you step off the integers then you're just adding or subtracting 2^{-n}</p>",
        "id": 187022398,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1580413014
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span><span class=\"kn\">import</span> <span class=\"n\">data</span><span class=\"bp\">.</span><span class=\"n\">real</span><span class=\"bp\">.</span><span class=\"n\">basic</span>\n\n<span class=\"kn\">inductive</span> <span class=\"n\">treenum</span>\n<span class=\"bp\">|</span> <span class=\"n\">leaf</span>\n<span class=\"bp\">|</span> <span class=\"n\">left</span> <span class=\"o\">(</span><span class=\"bp\">_</span><span class=\"o\">:</span> <span class=\"n\">treenum</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"n\">right</span> <span class=\"o\">(</span><span class=\"bp\">_</span><span class=\"o\">:</span> <span class=\"n\">treenum</span><span class=\"o\">)</span>\n\n<span class=\"kn\">inductive</span> <span class=\"n\">treepos</span>\n<span class=\"bp\">|</span> <span class=\"n\">start</span> <span class=\"o\">:</span> <span class=\"n\">treepos</span>\n<span class=\"bp\">|</span> <span class=\"n\">left</span> <span class=\"o\">:</span> <span class=\"n\">treepos</span>\n<span class=\"bp\">|</span> <span class=\"n\">right</span> <span class=\"o\">:</span> <span class=\"n\">treepos</span>\n<span class=\"bp\">|</span> <span class=\"n\">inner</span> <span class=\"o\">(</span><span class=\"n\">n</span> <span class=\"o\">:</span> <span class=\"bp\">ℕ</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">treepos</span>\n\n<span class=\"n\">noncomputable</span> <span class=\"n\">def</span> <span class=\"n\">to_real_aux</span> <span class=\"o\">:</span> <span class=\"n\">treenum</span> <span class=\"bp\">→</span> <span class=\"n\">treepos</span> <span class=\"bp\">→</span> <span class=\"n\">ℝ</span> <span class=\"bp\">→</span> <span class=\"n\">ℝ</span>\n<span class=\"bp\">|</span> <span class=\"n\">treenum</span><span class=\"bp\">.</span><span class=\"n\">leaf</span>      <span class=\"bp\">_</span>                 <span class=\"n\">r</span> <span class=\"o\">:=</span> <span class=\"n\">r</span>\n<span class=\"bp\">|</span> <span class=\"o\">(</span><span class=\"n\">treenum</span><span class=\"bp\">.</span><span class=\"n\">left</span> <span class=\"n\">i</span><span class=\"o\">)</span>  <span class=\"n\">treepos</span><span class=\"bp\">.</span><span class=\"n\">start</span>     <span class=\"n\">r</span> <span class=\"o\">:=</span> <span class=\"n\">to_real_aux</span> <span class=\"n\">i</span> <span class=\"n\">treepos</span><span class=\"bp\">.</span><span class=\"n\">left</span> <span class=\"o\">(</span><span class=\"n\">r</span> <span class=\"bp\">-</span> <span class=\"mi\">1</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"o\">(</span><span class=\"n\">treenum</span><span class=\"bp\">.</span><span class=\"n\">left</span> <span class=\"n\">i</span><span class=\"o\">)</span>  <span class=\"n\">treepos</span><span class=\"bp\">.</span><span class=\"n\">left</span>      <span class=\"n\">r</span> <span class=\"o\">:=</span> <span class=\"n\">to_real_aux</span> <span class=\"n\">i</span> <span class=\"n\">treepos</span><span class=\"bp\">.</span><span class=\"n\">left</span> <span class=\"o\">(</span><span class=\"n\">r</span> <span class=\"bp\">-</span> <span class=\"mi\">1</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"o\">(</span><span class=\"n\">treenum</span><span class=\"bp\">.</span><span class=\"n\">left</span> <span class=\"n\">i</span><span class=\"o\">)</span>  <span class=\"n\">treepos</span><span class=\"bp\">.</span><span class=\"n\">right</span>     <span class=\"n\">r</span> <span class=\"o\">:=</span> <span class=\"n\">to_real_aux</span> <span class=\"n\">i</span> <span class=\"o\">(</span><span class=\"n\">treepos</span><span class=\"bp\">.</span><span class=\"n\">inner</span> <span class=\"mi\">2</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">r</span> <span class=\"bp\">-</span> <span class=\"mi\">1</span> <span class=\"bp\">/</span> <span class=\"mi\">2</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"o\">(</span><span class=\"n\">treenum</span><span class=\"bp\">.</span><span class=\"n\">left</span> <span class=\"n\">i</span><span class=\"o\">)</span>  <span class=\"o\">(</span><span class=\"n\">treepos</span><span class=\"bp\">.</span><span class=\"n\">inner</span> <span class=\"n\">n</span><span class=\"o\">)</span> <span class=\"n\">r</span> <span class=\"o\">:=</span> <span class=\"n\">to_real_aux</span> <span class=\"n\">i</span> <span class=\"o\">(</span><span class=\"n\">treepos</span><span class=\"bp\">.</span><span class=\"n\">inner</span> <span class=\"o\">(</span><span class=\"n\">n</span><span class=\"bp\">+</span><span class=\"mi\">1</span><span class=\"o\">))</span> <span class=\"o\">(</span><span class=\"n\">r</span> <span class=\"bp\">-</span> <span class=\"mi\">1</span> <span class=\"bp\">/</span> <span class=\"mi\">2</span> <span class=\"err\">^</span> <span class=\"n\">n</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"o\">(</span><span class=\"n\">treenum</span><span class=\"bp\">.</span><span class=\"n\">right</span> <span class=\"n\">i</span><span class=\"o\">)</span> <span class=\"n\">treepos</span><span class=\"bp\">.</span><span class=\"n\">start</span>     <span class=\"n\">r</span> <span class=\"o\">:=</span> <span class=\"n\">to_real_aux</span> <span class=\"n\">i</span> <span class=\"n\">treepos</span><span class=\"bp\">.</span><span class=\"n\">right</span> <span class=\"o\">(</span><span class=\"n\">r</span> <span class=\"bp\">+</span> <span class=\"mi\">1</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"o\">(</span><span class=\"n\">treenum</span><span class=\"bp\">.</span><span class=\"n\">right</span> <span class=\"n\">i</span><span class=\"o\">)</span> <span class=\"n\">treepos</span><span class=\"bp\">.</span><span class=\"n\">left</span>      <span class=\"n\">r</span> <span class=\"o\">:=</span> <span class=\"n\">to_real_aux</span> <span class=\"n\">i</span> <span class=\"o\">(</span><span class=\"n\">treepos</span><span class=\"bp\">.</span><span class=\"n\">inner</span> <span class=\"mi\">2</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">r</span> <span class=\"bp\">+</span> <span class=\"mi\">1</span> <span class=\"bp\">/</span> <span class=\"mi\">2</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"o\">(</span><span class=\"n\">treenum</span><span class=\"bp\">.</span><span class=\"n\">right</span> <span class=\"n\">i</span><span class=\"o\">)</span> <span class=\"n\">treepos</span><span class=\"bp\">.</span><span class=\"n\">right</span>     <span class=\"n\">r</span> <span class=\"o\">:=</span> <span class=\"n\">to_real_aux</span> <span class=\"n\">i</span> <span class=\"n\">treepos</span><span class=\"bp\">.</span><span class=\"n\">right</span> <span class=\"o\">(</span><span class=\"n\">r</span> <span class=\"bp\">+</span> <span class=\"mi\">1</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"o\">(</span><span class=\"n\">treenum</span><span class=\"bp\">.</span><span class=\"n\">right</span> <span class=\"n\">i</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">treepos</span><span class=\"bp\">.</span><span class=\"n\">inner</span> <span class=\"n\">n</span><span class=\"o\">)</span> <span class=\"n\">r</span> <span class=\"o\">:=</span> <span class=\"n\">to_real_aux</span> <span class=\"n\">i</span> <span class=\"o\">(</span><span class=\"n\">treepos</span><span class=\"bp\">.</span><span class=\"n\">inner</span> <span class=\"o\">(</span><span class=\"n\">n</span><span class=\"bp\">+</span><span class=\"mi\">1</span><span class=\"o\">))</span> <span class=\"o\">(</span><span class=\"n\">r</span> <span class=\"bp\">+</span> <span class=\"mi\">1</span> <span class=\"bp\">/</span> <span class=\"mi\">2</span> <span class=\"err\">^</span> <span class=\"n\">n</span><span class=\"o\">)</span>\n\n<span class=\"n\">noncomputable</span> <span class=\"n\">def</span> <span class=\"n\">treenum</span><span class=\"bp\">.</span><span class=\"n\">to_real</span> <span class=\"o\">(</span><span class=\"n\">t</span> <span class=\"o\">:</span> <span class=\"n\">treenum</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">ℝ</span> <span class=\"o\">:=</span> <span class=\"n\">to_real_aux</span> <span class=\"n\">t</span> <span class=\"n\">treepos</span><span class=\"bp\">.</span><span class=\"n\">start</span> <span class=\"mi\">0</span>\n\n<span class=\"kn\">instance</span> <span class=\"o\">:</span> <span class=\"n\">inhabited</span> <span class=\"n\">treenum</span> <span class=\"o\">:=</span> <span class=\"bp\">⟨</span><span class=\"n\">treenum</span><span class=\"bp\">.</span><span class=\"n\">leaf</span><span class=\"bp\">⟩</span>\n\n<span class=\"n\">noncomputable</span> <span class=\"n\">def</span> <span class=\"n\">treenum</span><span class=\"bp\">.</span><span class=\"n\">add</span> <span class=\"o\">(</span><span class=\"n\">t₁</span> <span class=\"n\">t₂</span> <span class=\"o\">:</span> <span class=\"n\">treenum</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">treenum</span> <span class=\"o\">:=</span>\n<span class=\"n\">classical</span><span class=\"bp\">.</span><span class=\"n\">epsilon</span> <span class=\"err\">$</span> <span class=\"bp\">λ</span> <span class=\"n\">t&#39;</span><span class=\"o\">,</span> <span class=\"n\">t&#39;</span><span class=\"bp\">.</span><span class=\"n\">to_real</span> <span class=\"bp\">=</span> <span class=\"n\">t₁</span><span class=\"bp\">.</span><span class=\"n\">to_real</span> <span class=\"bp\">+</span> <span class=\"n\">t₂</span><span class=\"bp\">.</span><span class=\"n\">to_real</span>\n</pre></div>",
        "id": 187025158,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1580414659
    },
    {
        "content": "<p>it's a cheat, of course</p>",
        "id": 187025264,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1580414721
    }
]