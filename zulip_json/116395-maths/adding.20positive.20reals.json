[
    {
        "content": "<div class=\"codehilite\"><pre><span></span><span class=\"n\">def</span> <span class=\"n\">nzreal</span> <span class=\"o\">:=</span> <span class=\"o\">{</span><span class=\"n\">r</span> <span class=\"o\">:</span> <span class=\"n\">ℝ</span> <span class=\"bp\">//</span> <span class=\"n\">r</span> <span class=\"bp\">≠</span> <span class=\"mi\">0</span><span class=\"o\">}</span>\n<span class=\"kn\">notation</span> <span class=\"bp\">`</span><span class=\"n\">ℝ</span><span class=\"bp\">*`</span> <span class=\"o\">:=</span> <span class=\"n\">nzreal</span>\n<span class=\"kn\">constants</span> <span class=\"n\">nzc</span> <span class=\"n\">nzd</span> <span class=\"o\">:</span> <span class=\"n\">nzreal</span>\n<span class=\"bp\">#</span><span class=\"kn\">check</span> <span class=\"n\">nzc</span><span class=\"bp\">+</span><span class=\"n\">nzd</span>\n</pre></div>\n\n\n<blockquote>\n<p>failed to synthesize type class instance for<br>\n⊢ has_add ℝ*</p>\n</blockquote>\n<p>Is this a place to use the canonical structures that Assia and Cyril told us about in Amsterdam?  Seems to me like the kind of thing that would be a match for that sort of thinking. </p>\n<p>Oh, that's <code>nzreal</code>s but it's more or less the same question for <code>posreal</code>s.</p>",
        "id": 156936354,
        "sender_full_name": "Joseph Corneli",
        "timestamp": 1548528072
    },
    {
        "content": "<p>Well, you just defined a new type. So you will have to explain what addition should mean. Also, what should <code>x + -x</code> be?</p>",
        "id": 156937069,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1548529276
    },
    {
        "content": "<p>If I have learned correctly it should be 37</p>",
        "id": 156937125,
        "sender_full_name": "Joseph Corneli",
        "timestamp": 1548529379
    },
    {
        "content": "<p>actually a moderately useful idea in this setting</p>",
        "id": 156937136,
        "sender_full_name": "Joseph Corneli",
        "timestamp": 1548529400
    },
    {
        "content": "<p>though I suspect there are some downsides...</p>",
        "id": 156937138,
        "sender_full_name": "Joseph Corneli",
        "timestamp": 1548529414
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span><span class=\"kn\">namespace</span> <span class=\"n\">nzreal</span>\n\n<span class=\"n\">def</span> <span class=\"n\">nzreal</span> <span class=\"o\">:=</span> <span class=\"o\">{</span><span class=\"n\">r</span> <span class=\"o\">:</span> <span class=\"n\">ℝ</span> <span class=\"bp\">//</span> <span class=\"n\">r</span> <span class=\"bp\">≠</span> <span class=\"mi\">0</span><span class=\"o\">}</span>\n<span class=\"kn\">notation</span> <span class=\"bp\">`</span><span class=\"n\">ℝ</span><span class=\"bp\">*`</span> <span class=\"o\">:=</span> <span class=\"n\">nzreal</span>\n<span class=\"kn\">constants</span> <span class=\"n\">nzc</span> <span class=\"n\">nzd</span> <span class=\"o\">:</span> <span class=\"n\">nzreal</span>\n<span class=\"bp\">#</span><span class=\"kn\">check</span> <span class=\"n\">nzc</span><span class=\"bp\">+</span><span class=\"n\">nzd</span>\n\n<span class=\"n\">def</span> <span class=\"n\">add</span> <span class=\"o\">:</span> <span class=\"n\">nzreal</span> <span class=\"bp\">→</span> <span class=\"n\">nzreal</span> <span class=\"bp\">→</span> <span class=\"n\">ℝ</span>\n<span class=\"bp\">|</span> <span class=\"n\">x</span> <span class=\"n\">y</span> <span class=\"o\">:=</span> <span class=\"n\">subtype</span><span class=\"bp\">.</span><span class=\"n\">val</span> <span class=\"n\">x</span> <span class=\"bp\">+</span> <span class=\"n\">subtype</span><span class=\"bp\">.</span><span class=\"n\">val</span> <span class=\"n\">y</span>\n\n<span class=\"c1\">-- except this doesn&#39;t work</span>\n<span class=\"kn\">instance</span> <span class=\"o\">:</span> <span class=\"n\">has_add</span> <span class=\"n\">nzreal</span> <span class=\"o\">:=</span> <span class=\"bp\">⟨</span><span class=\"n\">nzreal</span><span class=\"bp\">.</span><span class=\"n\">add</span><span class=\"bp\">⟩</span>\n<span class=\"kn\">end</span> <span class=\"n\">nzreal</span>\n</pre></div>",
        "id": 156937336,
        "sender_full_name": "Joseph Corneli",
        "timestamp": 1548529794
    },
    {
        "content": "<p>The following works:</p>\n<div class=\"codehilite\"><pre><span></span><span class=\"kn\">import</span> <span class=\"n\">data</span><span class=\"bp\">.</span><span class=\"n\">rat</span> <span class=\"n\">data</span><span class=\"bp\">.</span><span class=\"n\">real</span><span class=\"bp\">.</span><span class=\"n\">basic</span>\n\n<span class=\"n\">def</span> <span class=\"n\">pos_rat</span> <span class=\"o\">:=</span> <span class=\"o\">{</span> <span class=\"n\">q</span> <span class=\"o\">:</span> <span class=\"n\">ℚ</span> <span class=\"bp\">//</span> <span class=\"n\">q</span> <span class=\"bp\">&gt;</span> <span class=\"mi\">0</span><span class=\"o\">}</span>\n\n<span class=\"kn\">instance</span> <span class=\"n\">pos_rat</span><span class=\"bp\">.</span><span class=\"n\">add</span> <span class=\"o\">:</span> <span class=\"n\">has_add</span> <span class=\"n\">pos_rat</span> <span class=\"o\">:=</span>\n <span class=\"bp\">⟨λ</span> <span class=\"n\">q</span> <span class=\"n\">r</span><span class=\"o\">,</span><span class=\"bp\">⟨</span><span class=\"n\">q</span><span class=\"bp\">.</span><span class=\"n\">val</span> <span class=\"bp\">+</span> <span class=\"n\">r</span><span class=\"bp\">.</span><span class=\"n\">val</span><span class=\"o\">,</span><span class=\"n\">add_lt_add</span> <span class=\"n\">q</span><span class=\"bp\">.</span><span class=\"n\">property</span> <span class=\"n\">r</span><span class=\"bp\">.</span><span class=\"n\">property</span><span class=\"bp\">⟩⟩</span>\n\n<span class=\"n\">def</span> <span class=\"n\">pos_real</span> <span class=\"o\">:=</span> <span class=\"o\">{</span> <span class=\"n\">q</span> <span class=\"o\">:</span> <span class=\"n\">ℝ</span> <span class=\"bp\">//</span> <span class=\"n\">q</span> <span class=\"bp\">&gt;</span> <span class=\"mi\">0</span><span class=\"o\">}</span>\n\n<span class=\"kn\">instance</span> <span class=\"n\">pos_real</span><span class=\"bp\">.</span><span class=\"n\">add</span> <span class=\"o\">:</span> <span class=\"n\">has_add</span> <span class=\"n\">pos_real</span> <span class=\"o\">:=</span>\n <span class=\"bp\">⟨λ</span> <span class=\"n\">q</span> <span class=\"n\">r</span><span class=\"o\">,</span><span class=\"bp\">⟨</span><span class=\"n\">q</span><span class=\"bp\">.</span><span class=\"n\">val</span> <span class=\"bp\">+</span> <span class=\"n\">r</span><span class=\"bp\">.</span><span class=\"n\">val</span><span class=\"o\">,</span>\n  <span class=\"bp\">@</span><span class=\"n\">eq</span><span class=\"bp\">.</span><span class=\"n\">subst</span> <span class=\"n\">ℝ</span> <span class=\"o\">(</span><span class=\"bp\">λ</span> <span class=\"n\">z</span><span class=\"o\">,</span> <span class=\"n\">z</span> <span class=\"bp\">&lt;</span> <span class=\"n\">q</span><span class=\"bp\">.</span><span class=\"n\">val</span> <span class=\"bp\">+</span> <span class=\"n\">r</span><span class=\"bp\">.</span><span class=\"n\">val</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"mi\">0</span> <span class=\"bp\">+</span> <span class=\"mi\">0</span><span class=\"o\">)</span> <span class=\"mi\">0</span> <span class=\"o\">(</span><span class=\"n\">zero_add</span> <span class=\"mi\">0</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">add_lt_add</span> <span class=\"n\">q</span><span class=\"bp\">.</span><span class=\"n\">property</span> <span class=\"n\">r</span><span class=\"bp\">.</span><span class=\"n\">property</span><span class=\"o\">)</span><span class=\"bp\">⟩⟩</span>\n</pre></div>\n\n\n<p>I am sure that the version for <code>ℝ</code> is suboptimal;  I hope that someone more expert will clean it up.</p>",
        "id": 156937385,
        "sender_full_name": "Neil Strickland",
        "timestamp": 1548529835
    },
    {
        "content": "<blockquote>\n<div class=\"codehilite\"><pre><span></span><span class=\"c1\">-- except this doesn&#39;t work</span>\n<span class=\"kn\">instance</span> <span class=\"o\">:</span> <span class=\"n\">has_add</span> <span class=\"n\">nzreal</span> <span class=\"o\">:=</span> <span class=\"bp\">⟨</span><span class=\"n\">nzreal</span><span class=\"bp\">.</span><span class=\"n\">add</span><span class=\"bp\">⟩</span>\n</pre></div>\n\n\n</blockquote>\n<p>This doesn't work because to make an instance of <code>has_add X</code> you have to supply a map <code>X -&gt; X -&gt; X</code>, and your map <code>nzreal.add</code> has type <code>nzreal -&gt; nzreal -&gt; real</code>.</p>",
        "id": 156937452,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1548529943
    },
    {
        "content": "<p>yeah, so this one isn't going to work without partial functions</p>",
        "id": 156937466,
        "sender_full_name": "Joseph Corneli",
        "timestamp": 1548530005
    },
    {
        "content": "<p>positives should be OK per <span class=\"user-mention\" data-user-id=\"130308\">@Neil Strickland</span> (I will have to take some time to understand that code)</p>",
        "id": 156937542,
        "sender_full_name": "Joseph Corneli",
        "timestamp": 1548530115
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"130308\">@Neil Strickland</span> you need <code>a &gt; 0 -&gt; b &gt; 0 -&gt; a + b &gt; 0</code>. My instinct now (which was not at all my instinct a year ago) is that this result should be in any reasonable API for totally ordered abelian groups.</p>",
        "id": 156937546,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1548530124
    },
    {
        "content": "<p>So the issue is finding the result. And until we have better search the best way to find the result is to guess the name. I guessed <code>add_pos</code> and <code>pos_add</code> and I hit tab a few times, and eventually I found it.</p>",
        "id": 156937585,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1548530163
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span><span class=\"kn\">instance</span> <span class=\"n\">pos_real</span><span class=\"bp\">.</span><span class=\"n\">add</span> <span class=\"o\">:</span> <span class=\"n\">has_add</span> <span class=\"n\">pos_real</span> <span class=\"o\">:=</span>\n <span class=\"bp\">⟨λ</span> <span class=\"n\">q</span> <span class=\"n\">r</span><span class=\"o\">,</span><span class=\"bp\">⟨</span><span class=\"n\">q</span><span class=\"bp\">.</span><span class=\"n\">val</span> <span class=\"bp\">+</span> <span class=\"n\">r</span><span class=\"bp\">.</span><span class=\"n\">val</span><span class=\"o\">,</span><span class=\"n\">add_pos</span> <span class=\"n\">q</span><span class=\"bp\">.</span><span class=\"n\">property</span> <span class=\"n\">r</span><span class=\"bp\">.</span><span class=\"n\">property</span><span class=\"bp\">⟩⟩</span>\n</pre></div>\n\n\n<p>The reason you get away with this for the rationals, I suspect, is that <code>0 + 0</code> is definitionally equal to <code>0</code>, but perhaps not for the reals.</p>",
        "id": 156937607,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1548530215
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span><span class=\"kn\">example</span> <span class=\"o\">:</span> <span class=\"o\">(</span><span class=\"mi\">0</span> <span class=\"o\">:</span> <span class=\"n\">ℚ</span><span class=\"o\">)</span> <span class=\"bp\">+</span> <span class=\"mi\">0</span> <span class=\"bp\">=</span> <span class=\"mi\">0</span> <span class=\"o\">:=</span> <span class=\"n\">rfl</span> <span class=\"c1\">-- works</span>\n<span class=\"kn\">example</span> <span class=\"o\">:</span> <span class=\"o\">(</span><span class=\"mi\">0</span> <span class=\"o\">:</span> <span class=\"n\">ℝ</span><span class=\"o\">)</span> <span class=\"bp\">+</span> <span class=\"mi\">0</span> <span class=\"bp\">=</span> <span class=\"mi\">0</span> <span class=\"o\">:=</span> <span class=\"n\">rfl</span> <span class=\"c1\">-- fails</span>\n</pre></div>",
        "id": 156937623,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1548530259
    },
    {
        "content": "<p>The joys of decidable equality.</p>",
        "id": 156937625,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1548530269
    },
    {
        "content": "<p>So when I was solving my first year undergraduate example sheets just over a year ago, I would run into things like this and think \"oh I need to prove a,b&gt;0 implies a+b&gt;0, I know about <code>add_lt_add</code>, and I can definitely do it from there, so let's go\" and I would write code like yours. Since then I have understood Mario's philosophy for mathlib, which perhaps came from his extensive use of metamath beforehand, which is that libraries should be <em>really thorough</em>. Anything which looks like a standard thing which a mathematician would assume without comment -- such a thing should be in the library already. Once you realise this, you stop trying to prove stuff for yourself and start looking for it instead.</p>",
        "id": 156937754,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1548530411
    },
    {
        "content": "<p>Thanks for these pointers.  This seems to be a very sensible philosophy.</p>",
        "id": 156937898,
        "sender_full_name": "Joseph Corneli",
        "timestamp": 1548530690
    },
    {
        "content": "<p>That makes sense, thanks.  But I'm also interested in whether there is a better way to deal with the <code>eq.subst</code> thing.  The following seems quite mysterious to me:</p>\n<div class=\"codehilite\"><pre><span></span><span class=\"n\">def</span> <span class=\"n\">pos_real</span> <span class=\"o\">:=</span> <span class=\"o\">{</span> <span class=\"n\">q</span> <span class=\"o\">:</span> <span class=\"n\">ℝ</span> <span class=\"bp\">//</span> <span class=\"mi\">0</span> <span class=\"bp\">&lt;</span> <span class=\"n\">q</span><span class=\"o\">}</span>\n\n<span class=\"kn\">instance</span> <span class=\"n\">pos_real</span><span class=\"bp\">.</span><span class=\"n\">add</span> <span class=\"o\">:</span> <span class=\"n\">has_add</span> <span class=\"n\">pos_real</span> <span class=\"o\">:=</span>\n <span class=\"bp\">⟨λ</span> <span class=\"n\">q</span> <span class=\"n\">r</span><span class=\"o\">,</span><span class=\"bp\">⟨</span><span class=\"n\">q</span><span class=\"bp\">.</span><span class=\"n\">val</span> <span class=\"bp\">+</span> <span class=\"n\">r</span><span class=\"bp\">.</span><span class=\"n\">val</span><span class=\"o\">,</span>\n  <span class=\"k\">begin</span>\n   <span class=\"k\">let</span> <span class=\"n\">h0</span> <span class=\"o\">:=</span> <span class=\"n\">zero_add</span> <span class=\"o\">(</span><span class=\"mi\">0</span> <span class=\"o\">:</span> <span class=\"n\">ℝ</span><span class=\"o\">),</span>\n   <span class=\"k\">let</span> <span class=\"n\">h1</span> <span class=\"o\">:=</span> <span class=\"o\">(</span><span class=\"n\">add_lt_add</span> <span class=\"n\">q</span><span class=\"bp\">.</span><span class=\"n\">property</span> <span class=\"n\">r</span><span class=\"bp\">.</span><span class=\"n\">property</span><span class=\"o\">),</span>\n   <span class=\"k\">let</span> <span class=\"n\">h2</span> <span class=\"o\">:</span> <span class=\"mi\">0</span> <span class=\"bp\">&lt;</span> <span class=\"n\">q</span><span class=\"bp\">.</span><span class=\"n\">val</span> <span class=\"bp\">+</span> <span class=\"n\">r</span><span class=\"bp\">.</span><span class=\"n\">val</span> <span class=\"o\">:=</span> <span class=\"n\">eq</span><span class=\"bp\">.</span><span class=\"n\">subst</span> <span class=\"n\">h0</span> <span class=\"n\">h1</span><span class=\"o\">,</span>\n   <span class=\"k\">let</span> <span class=\"n\">h3</span> <span class=\"o\">:</span> <span class=\"mi\">0</span> <span class=\"bp\">&lt;</span> <span class=\"n\">q</span><span class=\"bp\">.</span><span class=\"n\">val</span> <span class=\"bp\">+</span> <span class=\"n\">r</span><span class=\"bp\">.</span><span class=\"n\">val</span> <span class=\"o\">:=</span> <span class=\"n\">eq</span><span class=\"bp\">.</span><span class=\"n\">subst</span> <span class=\"n\">h0</span> <span class=\"o\">(</span><span class=\"n\">add_lt_add</span> <span class=\"n\">q</span><span class=\"bp\">.</span><span class=\"n\">property</span> <span class=\"n\">r</span><span class=\"bp\">.</span><span class=\"n\">property</span><span class=\"o\">),</span>\n   <span class=\"n\">exact</span> <span class=\"n\">h3</span><span class=\"o\">,</span>\n  <span class=\"kn\">end</span>\n  <span class=\"bp\">⟩⟩</span>\n</pre></div>\n\n\n<p>Note that I changed <code>q &gt; 0</code> to <code>0 &lt; q</code>, which eliminates some issues.  But still Lean accepts <code>h2</code> and rejects <code>h3</code>, even though <code>h3</code> is just the result of inlining the definition of <code>h1</code> in <code>h2</code>.  The error message says:</p>\n<div class=\"codehilite\"><pre><span></span><span class=\"n\">term</span>\n  <span class=\"n\">q</span><span class=\"bp\">.</span><span class=\"n\">property</span>\n<span class=\"n\">has</span> <span class=\"n\">type</span>\n  <span class=\"mi\">0</span> <span class=\"bp\">&lt;</span> <span class=\"bp\">@</span><span class=\"n\">subtype</span><span class=\"bp\">.</span><span class=\"n\">val</span> <span class=\"n\">ℝ</span> <span class=\"o\">(</span><span class=\"bp\">λ</span> <span class=\"o\">(</span><span class=\"n\">q</span> <span class=\"o\">:</span> <span class=\"n\">ℝ</span><span class=\"o\">),</span> <span class=\"mi\">0</span> <span class=\"bp\">&lt;</span> <span class=\"n\">q</span><span class=\"o\">)</span> <span class=\"n\">q</span>\n<span class=\"n\">but</span> <span class=\"n\">is</span> <span class=\"n\">expected</span> <span class=\"n\">to</span> <span class=\"k\">have</span> <span class=\"n\">type</span>\n  <span class=\"mi\">0</span> <span class=\"bp\">&lt;</span> <span class=\"bp\">@</span><span class=\"n\">subtype</span><span class=\"bp\">.</span><span class=\"n\">val</span> <span class=\"n\">ℝ</span> <span class=\"o\">(</span><span class=\"bp\">λ</span> <span class=\"o\">(</span><span class=\"n\">q</span> <span class=\"o\">:</span> <span class=\"n\">ℝ</span><span class=\"o\">),</span> <span class=\"mi\">0</span> <span class=\"bp\">+</span> <span class=\"mi\">0</span> <span class=\"bp\">&lt;</span> <span class=\"n\">q</span><span class=\"o\">)</span> <span class=\"n\">q</span>\n</pre></div>\n\n\n<p>I guess I could probably work out why that arises if I really had to.  But I would be more interested to hear about any general strategies to avoid this kind of thing.</p>",
        "id": 156938744,
        "sender_full_name": "Neil Strickland",
        "timestamp": 1548532186
    },
    {
        "content": "<p>It's also interesting that Lean has no problem with this:</p>\n<div class=\"codehilite\"><pre><span></span><span class=\"kn\">lemma</span> <span class=\"n\">real_add_pos</span> <span class=\"o\">{</span><span class=\"n\">q</span> <span class=\"n\">r</span> <span class=\"o\">:</span> <span class=\"n\">ℝ</span><span class=\"o\">}</span> <span class=\"o\">(</span><span class=\"n\">hq</span> <span class=\"o\">:</span> <span class=\"n\">q</span> <span class=\"bp\">&gt;</span> <span class=\"mi\">0</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">hr</span> <span class=\"o\">:</span> <span class=\"n\">r</span> <span class=\"bp\">&gt;</span> <span class=\"mi\">0</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">q</span> <span class=\"bp\">+</span> <span class=\"n\">r</span> <span class=\"bp\">&gt;</span> <span class=\"mi\">0</span> <span class=\"o\">:=</span>\n <span class=\"n\">eq</span><span class=\"bp\">.</span><span class=\"n\">subst</span> <span class=\"o\">(</span><span class=\"n\">add_zero</span> <span class=\"o\">(</span><span class=\"mi\">0</span> <span class=\"o\">:</span> <span class=\"n\">ℝ</span><span class=\"o\">))</span> <span class=\"o\">(</span><span class=\"n\">add_lt_add</span> <span class=\"n\">hq</span> <span class=\"n\">hr</span><span class=\"o\">)</span>\n</pre></div>\n\n\n<p>So I guess that the problem with my <code>pos_real.add</code> is just with the implicit arguments to <code>subtype.val</code>, somehow.</p>",
        "id": 156939239,
        "sender_full_name": "Neil Strickland",
        "timestamp": 1548532993
    },
    {
        "content": "<p>You should basically always use <code>rw</code> to write <code>eq.subst</code> terms like this</p>",
        "id": 156939423,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1548533340
    },
    {
        "content": "<p>the motive making is too messy to do by hand unless absolutely necessary</p>",
        "id": 156939439,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1548533397
    },
    {
        "content": "<p>The rule of thumb is: \"eq.subst never works\".</p>",
        "id": 156939504,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1548533488
    },
    {
        "content": "<p>There are countless threads with me moaning about the stupid triangle, which is <code>▸</code>, or <code>\\t</code>, the notation for <code>eq.subst</code>. I can never get it to work.</p>",
        "id": 156939553,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1548533550
    },
    {
        "content": "<p>That's why they wrote <code>rw</code>, which works great.</p>",
        "id": 156939567,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1548533583
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span><span class=\"n\">universes</span> <span class=\"n\">u</span>\n\n<span class=\"n\">def</span> <span class=\"n\">pos_of</span> <span class=\"o\">(</span><span class=\"n\">α</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span> <span class=\"n\">u</span><span class=\"o\">)</span> <span class=\"o\">[</span><span class=\"n\">has_lt</span> <span class=\"n\">α</span><span class=\"o\">]</span> <span class=\"o\">[</span><span class=\"n\">has_zero</span> <span class=\"n\">α</span><span class=\"o\">]</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span> <span class=\"n\">u</span> <span class=\"o\">:=</span>\n<span class=\"o\">{</span> <span class=\"n\">x</span> <span class=\"o\">:</span> <span class=\"n\">α</span> <span class=\"bp\">//</span> <span class=\"mi\">0</span> <span class=\"bp\">&lt;</span> <span class=\"n\">x</span> <span class=\"o\">}</span>\n\n<span class=\"kn\">namespace</span> <span class=\"n\">pos_of</span>\n\n<span class=\"kn\">variables</span> <span class=\"o\">(</span><span class=\"n\">α</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span> <span class=\"n\">u</span><span class=\"o\">)</span>\n\n<span class=\"kn\">instance</span> <span class=\"o\">[</span><span class=\"n\">ordered_cancel_comm_monoid</span> <span class=\"n\">α</span><span class=\"o\">]</span> <span class=\"o\">:</span> <span class=\"n\">add_semigroup</span> <span class=\"o\">(</span><span class=\"n\">pos_of</span> <span class=\"n\">α</span><span class=\"o\">)</span> <span class=\"o\">:=</span>\n<span class=\"o\">{</span> <span class=\"n\">add</span> <span class=\"o\">:=</span> <span class=\"bp\">λ</span> <span class=\"n\">x</span> <span class=\"n\">y</span><span class=\"o\">,</span> <span class=\"bp\">⟨</span><span class=\"n\">x</span><span class=\"bp\">.</span><span class=\"mi\">1</span> <span class=\"bp\">+</span> <span class=\"n\">y</span><span class=\"bp\">.</span><span class=\"mi\">1</span><span class=\"o\">,</span> <span class=\"n\">add_pos</span> <span class=\"n\">x</span><span class=\"bp\">.</span><span class=\"mi\">2</span> <span class=\"n\">y</span><span class=\"bp\">.</span><span class=\"mi\">2</span><span class=\"bp\">⟩</span><span class=\"o\">,</span>\n  <span class=\"n\">add_assoc</span> <span class=\"o\">:=</span> <span class=\"bp\">λ</span> <span class=\"n\">x</span> <span class=\"n\">y</span> <span class=\"n\">z</span><span class=\"o\">,</span> <span class=\"n\">subtype</span><span class=\"bp\">.</span><span class=\"n\">eq</span> <span class=\"err\">$</span> <span class=\"n\">add_assoc</span> <span class=\"bp\">_</span> <span class=\"bp\">_</span> <span class=\"bp\">_</span> <span class=\"o\">}</span>\n\n<span class=\"kn\">instance</span> <span class=\"o\">[</span><span class=\"n\">ordered_semiring</span> <span class=\"n\">α</span><span class=\"o\">]</span> <span class=\"o\">:</span> <span class=\"n\">semigroup</span> <span class=\"o\">(</span><span class=\"n\">pos_of</span> <span class=\"n\">α</span><span class=\"o\">)</span> <span class=\"o\">:=</span>\n<span class=\"o\">{</span> <span class=\"n\">mul</span> <span class=\"o\">:=</span> <span class=\"bp\">λ</span> <span class=\"n\">x</span> <span class=\"n\">y</span><span class=\"o\">,</span> <span class=\"bp\">⟨</span><span class=\"n\">x</span><span class=\"bp\">.</span><span class=\"mi\">1</span> <span class=\"bp\">*</span> <span class=\"n\">y</span><span class=\"bp\">.</span><span class=\"mi\">1</span><span class=\"o\">,</span> <span class=\"n\">mul_pos</span> <span class=\"n\">x</span><span class=\"bp\">.</span><span class=\"mi\">2</span> <span class=\"n\">y</span><span class=\"bp\">.</span><span class=\"mi\">2</span><span class=\"bp\">⟩</span><span class=\"o\">,</span>\n  <span class=\"n\">mul_assoc</span> <span class=\"o\">:=</span> <span class=\"bp\">λ</span> <span class=\"n\">x</span> <span class=\"n\">y</span> <span class=\"n\">z</span><span class=\"o\">,</span> <span class=\"n\">subtype</span><span class=\"bp\">.</span><span class=\"n\">eq</span> <span class=\"err\">$</span> <span class=\"n\">mul_assoc</span> <span class=\"bp\">_</span> <span class=\"bp\">_</span> <span class=\"bp\">_</span> <span class=\"o\">}</span>\n\n<span class=\"kn\">instance</span> <span class=\"o\">[</span><span class=\"n\">linear_ordered_semiring</span> <span class=\"n\">α</span><span class=\"o\">]</span> <span class=\"o\">:</span> <span class=\"n\">monoid</span> <span class=\"o\">(</span><span class=\"n\">pos_of</span> <span class=\"n\">α</span><span class=\"o\">)</span> <span class=\"o\">:=</span>\n<span class=\"o\">{</span> <span class=\"n\">one</span> <span class=\"o\">:=</span> <span class=\"bp\">⟨</span><span class=\"mi\">1</span><span class=\"o\">,</span> <span class=\"n\">zero_lt_one</span><span class=\"bp\">⟩</span><span class=\"o\">,</span>\n  <span class=\"n\">one_mul</span> <span class=\"o\">:=</span> <span class=\"bp\">λ</span> <span class=\"n\">x</span><span class=\"o\">,</span> <span class=\"n\">subtype</span><span class=\"bp\">.</span><span class=\"n\">eq</span> <span class=\"err\">$</span> <span class=\"n\">one_mul</span> <span class=\"bp\">_</span><span class=\"o\">,</span>\n  <span class=\"n\">mul_one</span> <span class=\"o\">:=</span> <span class=\"bp\">λ</span> <span class=\"n\">x</span><span class=\"o\">,</span> <span class=\"n\">subtype</span><span class=\"bp\">.</span><span class=\"n\">eq</span> <span class=\"err\">$</span> <span class=\"n\">mul_one</span> <span class=\"bp\">_</span><span class=\"o\">,</span>\n  <span class=\"bp\">..</span> <span class=\"n\">pos_of</span><span class=\"bp\">.</span><span class=\"n\">semigroup</span> <span class=\"n\">α</span> <span class=\"o\">}</span>\n\n<span class=\"kn\">end</span> <span class=\"n\">pos_of</span>\n</pre></div>",
        "id": 156939788,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1548533959
    },
    {
        "content": "<p>Kenny can you see why Neil gets that weird error?</p>",
        "id": 156939792,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1548533974
    },
    {
        "content": "<p>Mario said it already</p>",
        "id": 156939840,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1548534013
    },
    {
        "content": "<p>\"Mario Carneiro: the motive making is too messy to do by hand unless absolutely necessary\"</p>",
        "id": 156939841,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1548534022
    },
    {
        "content": "<p>What's a motive?</p>",
        "id": 156939842,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1548534035
    },
    {
        "content": "<p>I literally can't see the difference between his h2 and h3 strategies</p>",
        "id": 156939844,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1548534057
    },
    {
        "content": "<p>Lean needs to guess what you are substituting with</p>",
        "id": 156939853,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1548534099
    },
    {
        "content": "<p>sure, but they are literally the same</p>",
        "id": 156939858,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1548534113
    },
    {
        "content": "<p>anyway see my mathlib-grade <span aria-label=\"tm\" class=\"emoji emoji-2122\" role=\"img\" title=\"tm\">:tm:</span> revamp</p>",
        "id": 156939859,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1548534121
    },
    {
        "content": "<p>yes but you cheated, you used <code>add_pos</code></p>",
        "id": 156939905,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1548534168
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span><span class=\"n\">universes</span> <span class=\"n\">u</span>\n\n<span class=\"n\">def</span> <span class=\"n\">pos_of</span> <span class=\"o\">(</span><span class=\"n\">α</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span> <span class=\"n\">u</span><span class=\"o\">)</span> <span class=\"o\">[</span><span class=\"n\">has_lt</span> <span class=\"n\">α</span><span class=\"o\">]</span> <span class=\"o\">[</span><span class=\"n\">has_zero</span> <span class=\"n\">α</span><span class=\"o\">]</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span> <span class=\"n\">u</span> <span class=\"o\">:=</span>\n<span class=\"o\">{</span> <span class=\"n\">x</span> <span class=\"o\">:</span> <span class=\"n\">α</span> <span class=\"bp\">//</span> <span class=\"mi\">0</span> <span class=\"bp\">&lt;</span> <span class=\"n\">x</span> <span class=\"o\">}</span>\n\n<span class=\"kn\">namespace</span> <span class=\"n\">pos_of</span>\n\n<span class=\"kn\">variables</span> <span class=\"o\">(</span><span class=\"n\">α</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span> <span class=\"n\">u</span><span class=\"o\">)</span>\n\n<span class=\"kn\">instance</span> <span class=\"o\">[</span><span class=\"n\">ordered_cancel_comm_monoid</span> <span class=\"n\">α</span><span class=\"o\">]</span> <span class=\"o\">:</span> <span class=\"n\">add_semigroup</span> <span class=\"o\">(</span><span class=\"n\">pos_of</span> <span class=\"n\">α</span><span class=\"o\">)</span> <span class=\"o\">:=</span>\n<span class=\"o\">{</span> <span class=\"n\">add</span> <span class=\"o\">:=</span> <span class=\"bp\">λ</span> <span class=\"n\">x</span> <span class=\"n\">y</span><span class=\"o\">,</span> <span class=\"bp\">⟨</span><span class=\"n\">x</span><span class=\"bp\">.</span><span class=\"mi\">1</span> <span class=\"bp\">+</span> <span class=\"n\">y</span><span class=\"bp\">.</span><span class=\"mi\">1</span><span class=\"o\">,</span> <span class=\"n\">add_pos</span> <span class=\"n\">x</span><span class=\"bp\">.</span><span class=\"mi\">2</span> <span class=\"n\">y</span><span class=\"bp\">.</span><span class=\"mi\">2</span><span class=\"bp\">⟩</span><span class=\"o\">,</span>\n  <span class=\"n\">add_assoc</span> <span class=\"o\">:=</span> <span class=\"bp\">λ</span> <span class=\"n\">x</span> <span class=\"n\">y</span> <span class=\"n\">z</span><span class=\"o\">,</span> <span class=\"n\">subtype</span><span class=\"bp\">.</span><span class=\"n\">eq</span> <span class=\"err\">$</span> <span class=\"n\">add_assoc</span> <span class=\"bp\">_</span> <span class=\"bp\">_</span> <span class=\"bp\">_</span> <span class=\"o\">}</span>\n\n<span class=\"kn\">instance</span> <span class=\"o\">[</span><span class=\"n\">ordered_semiring</span> <span class=\"n\">α</span><span class=\"o\">]</span> <span class=\"o\">:</span> <span class=\"n\">semigroup</span> <span class=\"o\">(</span><span class=\"n\">pos_of</span> <span class=\"n\">α</span><span class=\"o\">)</span> <span class=\"o\">:=</span>\n<span class=\"o\">{</span> <span class=\"n\">mul</span> <span class=\"o\">:=</span> <span class=\"bp\">λ</span> <span class=\"n\">x</span> <span class=\"n\">y</span><span class=\"o\">,</span> <span class=\"bp\">⟨</span><span class=\"n\">x</span><span class=\"bp\">.</span><span class=\"mi\">1</span> <span class=\"bp\">*</span> <span class=\"n\">y</span><span class=\"bp\">.</span><span class=\"mi\">1</span><span class=\"o\">,</span> <span class=\"n\">mul_pos</span> <span class=\"n\">x</span><span class=\"bp\">.</span><span class=\"mi\">2</span> <span class=\"n\">y</span><span class=\"bp\">.</span><span class=\"mi\">2</span><span class=\"bp\">⟩</span><span class=\"o\">,</span>\n  <span class=\"n\">mul_assoc</span> <span class=\"o\">:=</span> <span class=\"bp\">λ</span> <span class=\"n\">x</span> <span class=\"n\">y</span> <span class=\"n\">z</span><span class=\"o\">,</span> <span class=\"n\">subtype</span><span class=\"bp\">.</span><span class=\"n\">eq</span> <span class=\"err\">$</span> <span class=\"n\">mul_assoc</span> <span class=\"bp\">_</span> <span class=\"bp\">_</span> <span class=\"bp\">_</span> <span class=\"o\">}</span>\n\n<span class=\"kn\">instance</span> <span class=\"o\">[</span><span class=\"n\">linear_ordered_semiring</span> <span class=\"n\">α</span><span class=\"o\">]</span> <span class=\"o\">:</span> <span class=\"n\">monoid</span> <span class=\"o\">(</span><span class=\"n\">pos_of</span> <span class=\"n\">α</span><span class=\"o\">)</span> <span class=\"o\">:=</span>\n<span class=\"o\">{</span> <span class=\"n\">one</span> <span class=\"o\">:=</span> <span class=\"bp\">⟨</span><span class=\"mi\">1</span><span class=\"o\">,</span> <span class=\"n\">zero_lt_one</span><span class=\"bp\">⟩</span><span class=\"o\">,</span>\n  <span class=\"n\">one_mul</span> <span class=\"o\">:=</span> <span class=\"bp\">λ</span> <span class=\"n\">x</span><span class=\"o\">,</span> <span class=\"n\">subtype</span><span class=\"bp\">.</span><span class=\"n\">eq</span> <span class=\"err\">$</span> <span class=\"n\">one_mul</span> <span class=\"bp\">_</span><span class=\"o\">,</span>\n  <span class=\"n\">mul_one</span> <span class=\"o\">:=</span> <span class=\"bp\">λ</span> <span class=\"n\">x</span><span class=\"o\">,</span> <span class=\"n\">subtype</span><span class=\"bp\">.</span><span class=\"n\">eq</span> <span class=\"err\">$</span> <span class=\"n\">mul_one</span> <span class=\"bp\">_</span><span class=\"o\">,</span>\n  <span class=\"bp\">..</span> <span class=\"n\">pos_of</span><span class=\"bp\">.</span><span class=\"n\">semigroup</span> <span class=\"n\">α</span> <span class=\"o\">}</span>\n\n<span class=\"kn\">instance</span> <span class=\"o\">[</span><span class=\"n\">linear_ordered_field</span> <span class=\"n\">α</span><span class=\"o\">]</span> <span class=\"o\">:</span> <span class=\"n\">group</span> <span class=\"o\">(</span><span class=\"n\">pos_of</span> <span class=\"n\">α</span><span class=\"o\">)</span> <span class=\"o\">:=</span>\n<span class=\"o\">{</span> <span class=\"n\">inv</span> <span class=\"o\">:=</span> <span class=\"bp\">λ</span> <span class=\"n\">x</span><span class=\"o\">,</span> <span class=\"bp\">⟨</span><span class=\"n\">x</span><span class=\"bp\">.</span><span class=\"mi\">1</span><span class=\"bp\">⁻¹</span><span class=\"o\">,</span> <span class=\"o\">(</span><span class=\"n\">inv_eq_one_div</span> <span class=\"n\">x</span><span class=\"bp\">.</span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">symm</span> <span class=\"bp\">▸</span> <span class=\"n\">one_div_pos_of_pos</span> <span class=\"n\">x</span><span class=\"bp\">.</span><span class=\"mi\">2</span><span class=\"bp\">⟩</span><span class=\"o\">,</span>\n  <span class=\"n\">mul_left_inv</span> <span class=\"o\">:=</span> <span class=\"bp\">λ</span> <span class=\"n\">x</span><span class=\"o\">,</span> <span class=\"n\">subtype</span><span class=\"bp\">.</span><span class=\"n\">eq</span> <span class=\"err\">$</span> <span class=\"n\">inv_mul_cancel</span> <span class=\"err\">$</span> <span class=\"n\">ne_of_gt</span> <span class=\"n\">x</span><span class=\"bp\">.</span><span class=\"mi\">2</span><span class=\"o\">,</span>\n  <span class=\"bp\">..</span> <span class=\"n\">pos_of</span><span class=\"bp\">.</span><span class=\"n\">monoid</span> <span class=\"n\">α</span> <span class=\"o\">}</span>\n\n<span class=\"kn\">end</span> <span class=\"n\">pos_of</span>\n</pre></div>",
        "id": 156939998,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1548534318
    },
    {
        "content": "<p>why can't I use add_pos?</p>",
        "id": 156939999,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1548534321
    },
    {
        "content": "<p>because this whole thread started because Neil didn't know about <code>add_pos</code> and we're still stuck trying to work around it.</p>",
        "id": 156940039,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1548534364
    },
    {
        "content": "<p>just copy the proof of add_pos then</p>",
        "id": 156940043,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1548534374
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span><span class=\"kn\">import</span> <span class=\"n\">data</span><span class=\"bp\">.</span><span class=\"n\">real</span><span class=\"bp\">.</span><span class=\"n\">basic</span>\n\n<span class=\"n\">def</span> <span class=\"n\">pos_real</span> <span class=\"o\">:=</span> <span class=\"o\">{</span> <span class=\"n\">q</span> <span class=\"o\">:</span> <span class=\"n\">ℝ</span> <span class=\"bp\">//</span> <span class=\"mi\">0</span> <span class=\"bp\">&lt;</span> <span class=\"n\">q</span><span class=\"o\">}</span>\n\n<span class=\"kn\">instance</span> <span class=\"n\">pos_real</span><span class=\"bp\">.</span><span class=\"n\">add</span> <span class=\"o\">:</span> <span class=\"n\">has_add</span> <span class=\"n\">pos_real</span> <span class=\"o\">:=</span>\n <span class=\"bp\">⟨λ</span> <span class=\"n\">q</span> <span class=\"n\">r</span><span class=\"o\">,</span><span class=\"bp\">⟨</span><span class=\"n\">q</span><span class=\"bp\">.</span><span class=\"n\">val</span> <span class=\"bp\">+</span> <span class=\"n\">r</span><span class=\"bp\">.</span><span class=\"n\">val</span><span class=\"o\">,</span>\n  <span class=\"k\">begin</span>\n   <span class=\"k\">let</span> <span class=\"n\">h0</span> <span class=\"o\">:=</span> <span class=\"n\">zero_add</span> <span class=\"o\">(</span><span class=\"mi\">0</span> <span class=\"o\">:</span> <span class=\"n\">ℝ</span><span class=\"o\">),</span>\n   <span class=\"n\">exact</span> <span class=\"o\">(</span><span class=\"n\">eq</span><span class=\"bp\">.</span><span class=\"n\">subst</span> <span class=\"n\">h0</span> <span class=\"o\">(</span><span class=\"n\">add_lt_add</span> <span class=\"n\">q</span><span class=\"bp\">.</span><span class=\"n\">property</span> <span class=\"n\">r</span><span class=\"bp\">.</span><span class=\"n\">property</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"mi\">0</span> <span class=\"bp\">&lt;</span> <span class=\"n\">q</span><span class=\"bp\">.</span><span class=\"n\">val</span> <span class=\"bp\">+</span> <span class=\"n\">r</span><span class=\"bp\">.</span><span class=\"n\">val</span><span class=\"o\">),</span> <span class=\"c1\">-- stupid triangle doesn&#39;t work</span>\n  <span class=\"kn\">end</span>\n  <span class=\"bp\">⟩⟩</span>\n</pre></div>",
        "id": 156940047,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1548534396
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span><span class=\"n\">universes</span> <span class=\"n\">u</span>\n<span class=\"kn\">example</span> <span class=\"o\">(</span><span class=\"n\">α</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span> <span class=\"n\">u</span><span class=\"o\">)</span> <span class=\"o\">[</span><span class=\"n\">ordered_cancel_comm_monoid</span> <span class=\"n\">α</span><span class=\"o\">]</span> <span class=\"o\">{</span><span class=\"n\">x</span> <span class=\"n\">y</span> <span class=\"o\">:</span> <span class=\"n\">α</span><span class=\"o\">}</span> <span class=\"o\">(</span><span class=\"n\">hx</span> <span class=\"o\">:</span> <span class=\"mi\">0</span> <span class=\"bp\">&lt;</span> <span class=\"n\">x</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">hy</span> <span class=\"o\">:</span> <span class=\"mi\">0</span> <span class=\"bp\">&lt;</span> <span class=\"n\">y</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"mi\">0</span> <span class=\"bp\">&lt;</span> <span class=\"n\">x</span> <span class=\"bp\">+</span> <span class=\"n\">y</span> <span class=\"o\">:=</span>\n<span class=\"n\">zero_add</span> <span class=\"o\">(</span><span class=\"mi\">0</span><span class=\"o\">:</span><span class=\"n\">α</span><span class=\"o\">)</span> <span class=\"bp\">▸</span> <span class=\"n\">add_lt_add</span> <span class=\"n\">hx</span> <span class=\"n\">hy</span>\n</pre></div>",
        "id": 156940116,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1548534534
    },
    {
        "content": "<p>Right, so Neil got it to work with h2, the question is why what I wrote doesn't work.</p>",
        "id": 156940129,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1548534573
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span><span class=\"n\">universes</span> <span class=\"n\">u</span>\n<span class=\"kn\">example</span> <span class=\"o\">(</span><span class=\"n\">α</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span> <span class=\"n\">u</span><span class=\"o\">)</span> <span class=\"o\">[</span><span class=\"n\">ordered_cancel_comm_monoid</span> <span class=\"n\">α</span><span class=\"o\">]</span> <span class=\"o\">{</span><span class=\"n\">x</span> <span class=\"n\">y</span> <span class=\"o\">:</span> <span class=\"n\">α</span><span class=\"o\">}</span> <span class=\"o\">(</span><span class=\"n\">hx</span> <span class=\"o\">:</span> <span class=\"mi\">0</span> <span class=\"bp\">&lt;</span> <span class=\"n\">x</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">hy</span> <span class=\"o\">:</span> <span class=\"mi\">0</span> <span class=\"bp\">&lt;</span> <span class=\"n\">y</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"mi\">0</span> <span class=\"bp\">&lt;</span> <span class=\"n\">x</span> <span class=\"bp\">+</span> <span class=\"n\">y</span> <span class=\"o\">:=</span>\n<span class=\"k\">have</span> <span class=\"n\">h0</span> <span class=\"o\">:</span> <span class=\"bp\">_</span> <span class=\"o\">:=</span> <span class=\"n\">zero_add</span> <span class=\"o\">(</span><span class=\"mi\">0</span><span class=\"o\">:</span><span class=\"n\">α</span><span class=\"o\">),</span>\n<span class=\"n\">eq</span><span class=\"bp\">.</span><span class=\"n\">subst</span> <span class=\"n\">h0</span> <span class=\"err\">$</span> <span class=\"n\">add_lt_add</span> <span class=\"n\">hx</span> <span class=\"n\">hy</span>\n</pre></div>",
        "id": 156940180,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1548534633
    },
    {
        "content": "<p>this works</p>",
        "id": 156940181,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1548534634
    },
    {
        "content": "<p>just follow standard procedures and you won't get into trouble :P</p>",
        "id": 156940261,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1548534807
    },
    {
        "content": "<p>Maybe it's just some higher order unification issue. Oh, I just remembered what a motive is. Oh so in fact that's exactly what Mario said.</p>",
        "id": 156940306,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1548534856
    },
    {
        "content": "<p>Neil -- the issue with <code>eq.subst</code> is that Lean has to guess this implicit argument <code>P</code> which in general is impossible. Oh Ok so in fact I'm now there.</p>",
        "id": 156940327,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1548534942
    },
    {
        "content": "<p>The library <code>add_pos</code> is just the obvious generalisation of my <code>real_add_pos</code>, so it is just a tiny proof term.  The only issues are (a) why the elaborater gets confused in the subtype context, but not if we write <code>add_pos</code> as a separate definition, and (b) how should you find <code>add_pos</code> if you do not already know about it?</p>\n<p>For (b), I tried <code>#print ordered_semiring</code> and <code>#print ordered_ring</code> and <code>#print prefix ordered_semiring</code> and <code>#print ordered_monoid</code> (but <code>ordered_monoid</code> does not exist).  I did not try <code>#find</code> or <code>#print ordered_group</code>.  I don't know if one can learn anything from that history.</p>",
        "id": 156940331,
        "sender_full_name": "Neil Strickland",
        "timestamp": 1548534948
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"110038\">@Kevin Buzzard</span> we all know that a motive is a smooth projective variety with extra structures :P</p>",
        "id": 156940378,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1548534982
    },
    {
        "content": "<p>You're saying \"I want the answer to be something like <code>0 &lt; x -&gt; 0 &lt; y -&gt; 0 &lt; x + y</code> and I want it to be this after we've taken all the <code>0+0</code>'s and replaced them with <code>0</code>s. Now guess <code>P</code>.\"</p>",
        "id": 156940393,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1548535021
    },
    {
        "content": "<p>And Lean guesses <code>0 + 0 &lt; x -&gt; 0 + 0 &lt; y -&gt; 0 + 0 &lt; x + y</code> because that's one of many valid guesses.</p>",
        "id": 156940407,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1548535049
    },
    {
        "content": "<p>and then it checks that <code>q.property</code> is <code>0 + 0 &lt; q.val</code> and it isn't, so it gives up. I think the CS guys call this \"higher order unification\" and they've proved that the general problem is undecidable. So Leo has to write some algorithm which works in as many simple cases as possible, but it can't be perfect.</p>",
        "id": 156940461,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1548535125
    },
    {
        "content": "<p>Kenny, it's the cohomology of a smooth projective variety.</p>",
        "id": 156940472,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1548535167
    },
    {
        "content": "<p>[NB by <code>P</code> I mean the <code>P</code> in <code>#check @eq.subst</code>]</p>",
        "id": 156940526,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1548535239
    },
    {
        "content": "<p>and CS people call <code>P</code> the motive.</p>",
        "id": 156940544,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1548535282
    },
    {
        "content": "<p><a href=\"https://leanprover.github.io/theorem_proving_in_lean/interacting_with_lean.html#elaboration-hints\" target=\"_blank\" title=\"https://leanprover.github.io/theorem_proving_in_lean/interacting_with_lean.html#elaboration-hints\">https://leanprover.github.io/theorem_proving_in_lean/interacting_with_lean.html#elaboration-hints</a></p>",
        "id": 156940595,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1548535356
    },
    {
        "content": "<p>I think this stuff is hard to do well.</p>",
        "id": 156940605,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1548535395
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span><span class=\"kn\">import</span> <span class=\"n\">data</span><span class=\"bp\">.</span><span class=\"n\">real</span><span class=\"bp\">.</span><span class=\"n\">basic</span>\n\n<span class=\"n\">def</span> <span class=\"n\">pos_real</span> <span class=\"o\">:=</span> <span class=\"o\">{</span> <span class=\"n\">q</span> <span class=\"o\">:</span> <span class=\"n\">ℝ</span> <span class=\"bp\">//</span> <span class=\"mi\">0</span> <span class=\"bp\">&lt;</span> <span class=\"n\">q</span><span class=\"o\">}</span>\n\n<span class=\"kn\">instance</span> <span class=\"n\">pos_real</span><span class=\"bp\">.</span><span class=\"n\">add</span> <span class=\"o\">:</span> <span class=\"n\">has_add</span> <span class=\"n\">pos_real</span> <span class=\"o\">:=</span>\n <span class=\"bp\">⟨λ</span> <span class=\"n\">q</span> <span class=\"n\">r</span><span class=\"o\">,</span><span class=\"bp\">⟨</span><span class=\"n\">q</span><span class=\"bp\">.</span><span class=\"n\">val</span> <span class=\"bp\">+</span> <span class=\"n\">r</span><span class=\"bp\">.</span><span class=\"n\">val</span><span class=\"o\">,</span>\n  <span class=\"k\">begin</span>\n   <span class=\"k\">let</span> <span class=\"n\">h0</span> <span class=\"o\">:=</span> <span class=\"n\">zero_add</span> <span class=\"o\">(</span><span class=\"mi\">0</span> <span class=\"o\">:</span> <span class=\"n\">ℝ</span><span class=\"o\">),</span>\n   <span class=\"n\">exact</span> <span class=\"bp\">@</span><span class=\"n\">eq</span><span class=\"bp\">.</span><span class=\"n\">subst</span> <span class=\"n\">ℝ</span> <span class=\"o\">(</span><span class=\"bp\">λ</span> <span class=\"n\">x</span><span class=\"o\">,</span> <span class=\"n\">x</span> <span class=\"bp\">&lt;</span> <span class=\"n\">q</span><span class=\"bp\">.</span><span class=\"n\">val</span> <span class=\"bp\">+</span> <span class=\"n\">r</span><span class=\"bp\">.</span><span class=\"n\">val</span><span class=\"o\">)</span> <span class=\"bp\">_</span> <span class=\"bp\">_</span> <span class=\"n\">h0</span> <span class=\"o\">(</span><span class=\"n\">add_lt_add</span> <span class=\"n\">q</span><span class=\"bp\">.</span><span class=\"n\">property</span> <span class=\"n\">r</span><span class=\"bp\">.</span><span class=\"n\">property</span><span class=\"o\">)</span>\n  <span class=\"kn\">end</span>\n  <span class=\"bp\">⟩⟩</span>\n</pre></div>\n\n\n<p>There's how to do with <code>eq.subst</code>. I had to tell it <code>P</code> explicitly, because it has an algorithm which produces a <code>P</code> and it produces the wrong <code>P</code> and now you're doomed. Elaboration and unification are thorny issues -- there was a thread about them yesterday. I can't tell you why one works and another doesn't. Lean has to solve a puzzle -- \"fill in all the <code>{ ... }</code> stuff\" -- and this is harder than it looks, I don't understand the arguments they use, and in higher order situations like this it's not surprising that they sometimes fail.</p>",
        "id": 156940900,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1548535943
    },
    {
        "content": "<p>Neil -- the best way to find lemmas is to learn the knack. I found this very frustrating at first, but the algorithm is first to learn all the three letter acronyms for everything eg add, sub, div, dvd, neg, pos, lt, nonneg etc (ok so they're not all three letters) and all the tricks like symm, comm, antisymm etc, then guess what your lemma is called, or at least part of it, then make sure you've imported the file where the lemma might be if necessary, then type in the parts of the name that you guessed and then mash <del>tab</del>ctrl-space and esc (at least in VS Code) and hope you find it in the list that appears (press ctrl-space to expand the definitions of the theorems which appear in the list).</p>",
        "id": 156941555,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1548537148
    },
    {
        "content": "<p>The lemma should be called <code>add_pos_of_pos_of_pos</code> but for things that come up a lot they tend to abbreviate them.</p>",
        "id": 156941570,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1548537239
    },
    {
        "content": "<p>For example, the triangle inequality is called <code>abs_add</code>.</p>",
        "id": 156947546,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1548547968
    },
    {
        "content": "<p>and the binomial theorem is called <code>add_pow</code> :-)</p>",
        "id": 156947559,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1548548035
    },
    {
        "content": "<blockquote>\n<p>anyway see my mathlib-grade <span aria-label=\"tm\" class=\"emoji emoji-2122\" role=\"img\" title=\"tm\">:tm:</span> revamp</p>\n</blockquote>\n<p><span class=\"user-mention\" data-user-id=\"110064\">@Kenny Lau</span> that looks great but I'm not sure how to use it properly.  Would you please tell me how I should adjust my example below to use your definitions?</p>\n<div class=\"codehilite\"><pre><span></span><span class=\"c1\">-- ...</span>\n<span class=\"kn\">open</span> <span class=\"n\">pos_of</span>\n\n<span class=\"n\">def</span> <span class=\"n\">posreal</span> <span class=\"o\">:=</span> <span class=\"n\">pos_of</span> <span class=\"n\">ℝ</span>\n\n<span class=\"kn\">notation</span> <span class=\"bp\">`</span><span class=\"n\">ℝ</span><span class=\"err\">₊</span><span class=\"bp\">`</span> <span class=\"o\">:=</span> <span class=\"n\">posreal</span>\n\n<span class=\"c1\">-- the following `instance` proofs seem superfluous given the definitions you created in the pos_of namespace, but how can I use your definitions?</span>\n<span class=\"kn\">instance</span> <span class=\"n\">posreal</span><span class=\"bp\">.</span><span class=\"n\">add</span> <span class=\"o\">:</span> <span class=\"n\">has_add</span> <span class=\"n\">posreal</span> <span class=\"o\">:=</span>\n <span class=\"bp\">⟨λ</span> <span class=\"n\">q</span> <span class=\"n\">r</span><span class=\"o\">,</span> <span class=\"bp\">⟨</span><span class=\"n\">q</span><span class=\"bp\">.</span><span class=\"n\">val</span> <span class=\"bp\">+</span> <span class=\"n\">r</span><span class=\"bp\">.</span><span class=\"n\">val</span><span class=\"o\">,</span> <span class=\"n\">add_pos</span> <span class=\"n\">q</span><span class=\"bp\">.</span><span class=\"n\">property</span> <span class=\"n\">r</span><span class=\"bp\">.</span><span class=\"n\">property</span><span class=\"bp\">⟩⟩</span>\n\n<span class=\"kn\">instance</span> <span class=\"n\">posreal</span><span class=\"bp\">.</span><span class=\"n\">one</span> <span class=\"o\">:</span> <span class=\"n\">has_one</span> <span class=\"n\">posreal</span> <span class=\"o\">:=</span> <span class=\"bp\">⟨⟨</span><span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">),</span> <span class=\"n\">zero_lt_one</span><span class=\"bp\">⟩⟩</span>\n\n<span class=\"kn\">example</span> <span class=\"o\">:</span> <span class=\"n\">ℝ</span><span class=\"err\">₊</span> <span class=\"o\">:=</span> <span class=\"o\">(</span><span class=\"mi\">2</span> <span class=\"o\">:</span> <span class=\"n\">ℝ</span><span class=\"err\">₊</span><span class=\"o\">)</span> <span class=\"bp\">+</span> <span class=\"o\">(</span><span class=\"mi\">3</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"err\">₊</span><span class=\"o\">)</span>\n</pre></div>",
        "id": 157024710,
        "sender_full_name": "Joseph Corneli",
        "timestamp": 1548682145
    },
    {
        "content": "<p>by unfold posreal; apply_instance</p>",
        "id": 157024787,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1548682212
    },
    {
        "content": "<p>thanks!</p>",
        "id": 157025062,
        "sender_full_name": "Joseph Corneli",
        "timestamp": 1548682490
    }
]