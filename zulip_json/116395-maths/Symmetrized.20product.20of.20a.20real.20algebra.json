[
    {
        "content": "<p>Hello,</p>\n<p>I've defined a non-unital, non-associative ring as:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kd\">@[protect_proj, ancestor add_comm_group non_unital_non_assoc_semiring ]</span>\n<span class=\"kd\">class</span> <span class=\"n\">non_unital_non_assoc_ring</span> <span class=\"o\">(</span><span class=\"n\">α</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">)</span> <span class=\"kd\">extends</span>\n  <span class=\"n\">add_comm_group</span> <span class=\"n\">α</span><span class=\"o\">,</span> <span class=\"n\">non_unital_non_assoc_semiring</span> <span class=\"n\">α</span>\n</code></pre></div>\n<p>Given an algebra <code>α</code> over <code>ℝ</code>, I'm trying to show that <code>α</code> is am instance of <code>non_unital_non_assoc_ring</code> (forgetting about the unit) under symmetrized product:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"n\">a</span><span class=\"bp\">∘</span><span class=\"n\">b</span> <span class=\"bp\">=</span> <span class=\"mi\">1</span><span class=\"bp\">/</span><span class=\"mi\">2</span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"bp\">*</span><span class=\"n\">b</span><span class=\"bp\">+</span><span class=\"n\">b</span><span class=\"bp\">*</span><span class=\"n\">a</span><span class=\"o\">)</span><span class=\"bp\">.</span>\n</code></pre></div>\n<p>Inspired by how mathlib implements the opposite multiplication (<code>algebra.opposites</code>) I've defined:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kd\">def</span> <span class=\"n\">sym_alg</span> <span class=\"o\">(</span><span class=\"n\">α</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span><span class=\"bp\">*</span> <span class=\"o\">:=</span> <span class=\"n\">α</span>\n\n<span class=\"kd\">postfix</span> <span class=\"bp\">`ˢʸᵐ`</span><span class=\"o\">:</span><span class=\"n\">std.prec.max_plus</span> <span class=\"o\">:=</span> <span class=\"n\">sym_alg</span>\n</code></pre></div>\n<p>It's then possible to show</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kd\">noncomputable</span> <span class=\"kd\">instance</span> <span class=\"o\">(</span><span class=\"n\">α</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">)</span> <span class=\"o\">[</span><span class=\"n\">semiring</span> <span class=\"n\">α</span><span class=\"o\">]</span> <span class=\"o\">[</span><span class=\"n\">algebra</span> <span class=\"n\">ℝ</span> <span class=\"n\">α</span><span class=\"o\">]</span> <span class=\"o\">:</span> <span class=\"n\">non_unital_non_assoc_ring</span> <span class=\"o\">(</span><span class=\"n\">sym_alg</span>  <span class=\"n\">α</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>except that two fields that are tripping me up are <code>neg</code> and <code>add_left_neg</code> as α is a semiring not a ring (alternatively, if I make <code>α</code> a ring, then I can't prove <code>left_distrib</code> and <code>right_distrib</code>).</p>\n<p>It's easy to show that if <code>α</code> is a <code>add_comm_group</code> then so is <code>αˢʸᵐ</code>:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kd\">instance</span> <span class=\"o\">{</span><span class=\"n\">α</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span> <span class=\"o\">[</span><span class=\"n\">add_comm_group</span> <span class=\"n\">α</span><span class=\"o\">]</span> <span class=\"o\">:</span> <span class=\"n\">add_comm_group</span> <span class=\"o\">(</span><span class=\"n\">α</span><span class=\"bp\">ˢʸᵐ</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"o\">{</span>\n  <span class=\"n\">zero</span> <span class=\"o\">:=</span> <span class=\"n\">sym</span> <span class=\"mi\">0</span><span class=\"o\">,</span>\n  <span class=\"n\">add</span> <span class=\"o\">:=</span> <span class=\"bp\">λ</span> <span class=\"n\">a</span> <span class=\"n\">b</span><span class=\"o\">,</span> <span class=\"n\">a</span><span class=\"bp\">+</span><span class=\"n\">b</span><span class=\"o\">,</span>\n  <span class=\"n\">add_assoc</span> <span class=\"o\">:=</span> <span class=\"bp\">λ</span> <span class=\"n\">a</span> <span class=\"n\">b</span> <span class=\"n\">c</span> <span class=\"o\">:</span> <span class=\"n\">α</span><span class=\"o\">,</span> <span class=\"n\">add_assoc</span> <span class=\"n\">a</span> <span class=\"n\">b</span> <span class=\"n\">c</span><span class=\"o\">,</span>\n  <span class=\"n\">add_comm</span> <span class=\"o\">:=</span> <span class=\"bp\">λ</span> <span class=\"n\">a</span> <span class=\"n\">b</span> <span class=\"o\">:</span> <span class=\"n\">α</span><span class=\"o\">,</span> <span class=\"n\">add_comm</span> <span class=\"n\">a</span> <span class=\"n\">b</span><span class=\"o\">,</span>\n  <span class=\"n\">zero_add</span> <span class=\"o\">:=</span> <span class=\"bp\">λ</span> <span class=\"n\">a</span><span class=\"o\">,</span> <span class=\"n\">zero_add</span> <span class=\"o\">(</span><span class=\"n\">unsym</span> <span class=\"n\">a</span><span class=\"o\">),</span>\n  <span class=\"n\">add_zero</span> <span class=\"o\">:=</span> <span class=\"bp\">λ</span> <span class=\"n\">a</span><span class=\"o\">,</span> <span class=\"n\">add_zero</span> <span class=\"o\">(</span><span class=\"n\">unsym</span> <span class=\"n\">a</span><span class=\"o\">),</span>\n  <span class=\"n\">neg</span> <span class=\"o\">:=</span> <span class=\"bp\">λ</span> <span class=\"n\">a</span><span class=\"o\">,</span> <span class=\"n\">sym</span> <span class=\"o\">(</span> <span class=\"bp\">-</span><span class=\"o\">(</span><span class=\"n\">unsym</span> <span class=\"n\">a</span><span class=\"o\">)),</span>\n  <span class=\"n\">add_left_neg</span> <span class=\"o\">:=</span> <span class=\"bp\">λ</span> <span class=\"n\">a</span><span class=\"o\">,</span> <span class=\"n\">add_left_neg</span> <span class=\"o\">(</span><span class=\"n\">unsym</span> <span class=\"n\">a</span><span class=\"o\">),</span>\n<span class=\"o\">}</span>\n</code></pre></div>\n<p>I know that <code>module.add_comm_monoid_to_add_comm_group</code> exists, but I've been warned off doing</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kd\">instance</span>  <span class=\"n\">ring_module_has_add_comm_group</span> <span class=\"o\">:</span> <span class=\"n\">add_comm_group</span> <span class=\"n\">α</span> <span class=\"o\">:=</span> <span class=\"n\">module.add_comm_monoid_to_add_comm_group</span> <span class=\"n\">R</span>\n</code></pre></div>\n<p>as it <a href=\"#narrow/stream/116395-maths/topic/C*-algebras/near/264824324\">leads to diamonds</a>.</p>\n<p>I can write:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"k\">#check</span> <span class=\"o\">(</span><span class=\"n\">module.add_comm_monoid_to_add_comm_group</span> <span class=\"n\">ℝ</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">neg</span> <span class=\"c1\">-- add_comm_group.neg : ?M_1 → ?M_1</span>\n</code></pre></div>\n<p>But not:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kd\">variables</span> <span class=\"o\">[</span><span class=\"n\">semiring</span> <span class=\"n\">α</span><span class=\"o\">]</span> <span class=\"o\">[</span><span class=\"n\">algebra</span> <span class=\"n\">ℝ</span> <span class=\"n\">α</span><span class=\"o\">]</span>\n\n<span class=\"kd\">variables</span> <span class=\"o\">(</span><span class=\"n\">a</span><span class=\"o\">:</span><span class=\"n\">α</span><span class=\"o\">)</span>\n\n<span class=\"k\">#check</span> <span class=\"o\">(</span><span class=\"n\">module.add_comm_monoid_to_add_comm_group</span> <span class=\"n\">ℝ</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">neg</span> <span class=\"n\">a</span> <span class=\"c1\">-- invalid field notation, function 'add_comm_group.neg' does not have explicit argument with type (add_comm_group ...)</span>\n</code></pre></div>\n<p>I've run out of ideas about how to proceed at this point. Any suggestions?</p>\n<p>Thanks,</p>\n<p>Christopher</p>",
        "id": 265618226,
        "sender_full_name": "Christopher Hoskin",
        "timestamp": 1640035951
    },
    {
        "content": "<p>Can you post a MWE of your original question with everything other than the neg and add_left_neg thrown in? My guess is that you can just define <code>neg x</code> to be <code>(-1) \\bub x</code>. I'm just a bit confused about what the question is though, because if alpha is an add_comm_group then you already have neg. This is why I'm asking for something where I can see exactly what is being assumed.</p>",
        "id": 265623160,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1640039134
    },
    {
        "content": "<p>Trying to do that... but now <code>left_distrib</code> has stopped working. I'm sure  it was working earlier. I must have changed something, but I can't figure out what.</p>",
        "id": 265623707,
        "sender_full_name": "Christopher Hoskin",
        "timestamp": 1640039530
    },
    {
        "content": "<p>Maybe post what you have with sorried problems? But just one piece of code rather than all the fragments above.</p>",
        "id": 265623859,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1640039648
    },
    {
        "content": "<p>I did try defining <code>neg</code> as you suggest, but got in a hopeless tangle trying to prove <code>add_left_neg</code>.</p>",
        "id": 265623959,
        "sender_full_name": "Christopher Hoskin",
        "timestamp": 1640039751
    },
    {
        "content": "<p>This is the best I can do at the moment:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kn\">import</span> <span class=\"n\">algebra.ring.basic</span>\n<span class=\"kn\">import</span> <span class=\"n\">algebra.lie.of_associative</span>\n<span class=\"kn\">import</span> <span class=\"n\">data.real.basic</span>\n<span class=\"kd\">set_option</span> <span class=\"n\">old_structure_cmd</span> <span class=\"n\">true</span>\n\n<span class=\"sd\">/-- A not-necessarily-unital, not-necessarily-associative ring. -/</span>\n<span class=\"kd\">@[protect_proj, ancestor add_comm_group non_unital_non_assoc_semiring ]</span>\n<span class=\"kd\">class</span> <span class=\"n\">non_unital_non_assoc_ring</span> <span class=\"o\">(</span><span class=\"n\">α</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">)</span> <span class=\"kd\">extends</span>\n  <span class=\"n\">add_comm_group</span> <span class=\"n\">α</span><span class=\"o\">,</span> <span class=\"n\">non_unital_non_assoc_semiring</span> <span class=\"n\">α</span>\n\n<span class=\"kd\">variables</span> <span class=\"o\">{</span><span class=\"n\">A</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span>\n\n<span class=\"kd\">def</span> <span class=\"n\">sym_alg</span> <span class=\"o\">(</span><span class=\"n\">α</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span><span class=\"bp\">*</span> <span class=\"o\">:=</span> <span class=\"n\">α</span>\n\n<span class=\"kd\">postfix</span> <span class=\"bp\">`ˢʸᵐ`</span><span class=\"o\">:</span><span class=\"n\">std.prec.max_plus</span> <span class=\"o\">:=</span> <span class=\"n\">sym_alg</span>\n\n<span class=\"kn\">namespace</span> <span class=\"n\">sym_alg</span>\n\n<span class=\"kd\">variables</span> <span class=\"o\">{</span><span class=\"n\">α</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span>\n\n<span class=\"sd\">/-- The element of `sym_alg α` that represents `a : α`. -/</span>\n<span class=\"kd\">@[pp_nodot]</span>\n<span class=\"kd\">def</span> <span class=\"n\">sym</span> <span class=\"o\">:</span> <span class=\"n\">α</span> <span class=\"bp\">→</span> <span class=\"n\">α</span><span class=\"bp\">ˢʸᵐ</span> <span class=\"o\">:=</span> <span class=\"n\">id</span>\n\n<span class=\"sd\">/-- The element of `α` represented by `x : αᵐᵒᵖ`. -/</span>\n<span class=\"kd\">@[pp_nodot]</span>\n<span class=\"kd\">def</span> <span class=\"n\">unsym</span> <span class=\"o\">:</span> <span class=\"n\">α</span><span class=\"bp\">ˢʸᵐ</span> <span class=\"bp\">→</span> <span class=\"n\">α</span> <span class=\"o\">:=</span> <span class=\"n\">id</span>\n\n<span class=\"kd\">@[simp]</span> <span class=\"kd\">lemma</span> <span class=\"n\">unsym_sym</span> <span class=\"o\">(</span><span class=\"n\">x</span> <span class=\"o\">:</span> <span class=\"n\">α</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">unsym</span> <span class=\"o\">(</span><span class=\"n\">sym</span> <span class=\"n\">x</span><span class=\"o\">)</span> <span class=\"bp\">=</span> <span class=\"n\">x</span> <span class=\"o\">:=</span> <span class=\"n\">rfl</span>\n<span class=\"kd\">@[simp]</span> <span class=\"kd\">lemma</span> <span class=\"n\">sym_unsym</span> <span class=\"o\">(</span><span class=\"n\">x</span> <span class=\"o\">:</span> <span class=\"n\">α</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">sym</span> <span class=\"o\">(</span><span class=\"n\">unsym</span> <span class=\"n\">x</span><span class=\"o\">)</span> <span class=\"bp\">=</span> <span class=\"n\">x</span> <span class=\"o\">:=</span> <span class=\"n\">rfl</span>\n\n\n<span class=\"kd\">instance</span> <span class=\"o\">[</span><span class=\"n\">has_add</span> <span class=\"n\">α</span><span class=\"o\">]</span> <span class=\"o\">:</span> <span class=\"n\">has_add</span> <span class=\"n\">α</span><span class=\"bp\">ˢʸᵐ</span> <span class=\"o\">:=</span>\n<span class=\"o\">{</span> <span class=\"n\">add</span> <span class=\"o\">:=</span> <span class=\"bp\">λ</span> <span class=\"n\">a</span> <span class=\"n\">b</span><span class=\"o\">,</span> <span class=\"n\">sym</span> <span class=\"o\">(</span><span class=\"n\">unsym</span> <span class=\"n\">a</span> <span class=\"bp\">+</span> <span class=\"n\">unsym</span> <span class=\"n\">b</span><span class=\"o\">)</span> <span class=\"o\">}</span>\n\n<span class=\"kd\">@[simp]</span> <span class=\"kd\">lemma</span> <span class=\"n\">sym_add</span> <span class=\"o\">[</span><span class=\"n\">has_add</span> <span class=\"n\">α</span><span class=\"o\">]</span> <span class=\"o\">(</span><span class=\"n\">a</span> <span class=\"n\">b</span> <span class=\"o\">:</span> <span class=\"n\">α</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">sym</span> <span class=\"o\">(</span><span class=\"n\">a</span> <span class=\"bp\">+</span> <span class=\"n\">b</span><span class=\"o\">)</span> <span class=\"bp\">=</span> <span class=\"n\">sym</span> <span class=\"n\">a</span> <span class=\"bp\">+</span> <span class=\"n\">sym</span> <span class=\"n\">b</span> <span class=\"o\">:=</span> <span class=\"n\">rfl</span>\n<span class=\"kd\">@[simp]</span> <span class=\"kd\">lemma</span> <span class=\"n\">unsym_add</span> <span class=\"o\">[</span><span class=\"n\">has_add</span> <span class=\"n\">α</span><span class=\"o\">]</span> <span class=\"o\">(</span><span class=\"n\">x</span> <span class=\"n\">y</span> <span class=\"o\">:</span> <span class=\"n\">α</span><span class=\"bp\">ˢʸᵐ</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">unsym</span> <span class=\"o\">(</span><span class=\"n\">x</span> <span class=\"bp\">+</span> <span class=\"n\">y</span><span class=\"o\">)</span> <span class=\"bp\">=</span> <span class=\"n\">unsym</span> <span class=\"n\">x</span> <span class=\"bp\">+</span> <span class=\"n\">unsym</span> <span class=\"n\">y</span> <span class=\"o\">:=</span> <span class=\"n\">rfl</span>\n\n\n<span class=\"kd\">instance</span> <span class=\"o\">[</span><span class=\"n\">has_neg</span> <span class=\"n\">α</span><span class=\"o\">]</span> <span class=\"o\">:</span> <span class=\"n\">has_neg</span> <span class=\"n\">α</span><span class=\"bp\">ˢʸᵐ</span> <span class=\"o\">:=</span>\n<span class=\"o\">{</span> <span class=\"n\">neg</span> <span class=\"o\">:=</span> <span class=\"bp\">λ</span> <span class=\"n\">a</span><span class=\"o\">,</span> <span class=\"n\">sym</span> <span class=\"o\">(</span> <span class=\"bp\">-</span><span class=\"o\">(</span><span class=\"n\">unsym</span> <span class=\"n\">a</span><span class=\"o\">))</span> <span class=\"o\">}</span>\n\n<span class=\"kd\">instance</span> <span class=\"o\">{</span><span class=\"n\">R</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span> <span class=\"o\">[</span><span class=\"n\">has_scalar</span> <span class=\"n\">R</span> <span class=\"n\">α</span><span class=\"o\">]</span> <span class=\"o\">:</span> <span class=\"n\">has_scalar</span> <span class=\"n\">R</span> <span class=\"n\">α</span><span class=\"bp\">ˢʸᵐ</span> <span class=\"o\">:=</span> <span class=\"o\">{</span>\n  <span class=\"n\">smul</span> <span class=\"o\">:=</span> <span class=\"bp\">λ</span> <span class=\"n\">r</span> <span class=\"n\">a</span><span class=\"o\">,</span> <span class=\"n\">sym</span> <span class=\"o\">(</span><span class=\"n\">r</span><span class=\"bp\">•</span><span class=\"o\">(</span><span class=\"n\">unsym</span> <span class=\"n\">a</span><span class=\"o\">))</span>\n<span class=\"o\">}</span>\n\n\n<span class=\"kd\">@[simp]</span> <span class=\"kd\">lemma</span> <span class=\"n\">sym_smul</span> <span class=\"o\">{</span><span class=\"n\">R</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span> <span class=\"o\">[</span><span class=\"n\">has_scalar</span> <span class=\"n\">R</span> <span class=\"n\">α</span><span class=\"o\">]</span> <span class=\"o\">(</span><span class=\"n\">c</span> <span class=\"o\">:</span> <span class=\"n\">R</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">a</span> <span class=\"o\">:</span> <span class=\"n\">α</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">sym</span> <span class=\"o\">(</span><span class=\"n\">c</span> <span class=\"bp\">•</span> <span class=\"n\">a</span><span class=\"o\">)</span> <span class=\"bp\">=</span> <span class=\"n\">c</span> <span class=\"bp\">•</span> <span class=\"n\">sym</span> <span class=\"n\">a</span> <span class=\"o\">:=</span> <span class=\"n\">rfl</span>\n\n<span class=\"kd\">lemma</span> <span class=\"n\">add_smul</span> <span class=\"o\">(</span><span class=\"n\">α</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">)</span> <span class=\"o\">[</span><span class=\"n\">ring</span> <span class=\"n\">α</span><span class=\"o\">]</span> <span class=\"o\">[</span><span class=\"n\">algebra</span> <span class=\"n\">ℝ</span> <span class=\"n\">α</span><span class=\"o\">]</span> <span class=\"o\">(</span><span class=\"n\">a</span><span class=\"o\">:</span><span class=\"n\">α</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">r</span> <span class=\"n\">s</span> <span class=\"o\">:</span> <span class=\"n\">ℝ</span><span class=\"o\">):</span> <span class=\"o\">(</span><span class=\"n\">r</span><span class=\"bp\">+</span><span class=\"n\">s</span><span class=\"o\">)</span><span class=\"bp\">•</span><span class=\"n\">a</span> <span class=\"bp\">=</span> <span class=\"o\">(</span><span class=\"n\">r</span><span class=\"bp\">•</span><span class=\"n\">a</span> <span class=\"bp\">+</span><span class=\"n\">s</span><span class=\"bp\">•</span><span class=\"n\">a</span><span class=\"o\">)</span>   <span class=\"o\">:=</span>\n<span class=\"kd\">begin</span>\n  <span class=\"n\">unfold</span> <span class=\"n\">algebra.smul_def'</span><span class=\"o\">,</span>\n  <span class=\"n\">rw</span> <span class=\"bp\">←</span> <span class=\"n\">add_mul</span><span class=\"o\">,</span>\n  <span class=\"n\">simp</span> <span class=\"n\">only</span> <span class=\"o\">[</span><span class=\"n\">map_add</span><span class=\"o\">,</span> <span class=\"n\">ring_hom.to_fun_eq_coe</span><span class=\"o\">],</span>\n<span class=\"kd\">end</span>\n\n<span class=\"kd\">lemma</span> <span class=\"n\">smul_add'</span> <span class=\"o\">(</span><span class=\"n\">α</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">)</span> <span class=\"o\">[</span><span class=\"n\">ring</span> <span class=\"n\">α</span><span class=\"o\">]</span> <span class=\"o\">[</span><span class=\"n\">algebra</span> <span class=\"n\">ℝ</span> <span class=\"n\">α</span><span class=\"o\">]</span> <span class=\"o\">(</span><span class=\"n\">a</span> <span class=\"n\">b</span><span class=\"o\">:</span><span class=\"n\">α</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">r</span> <span class=\"o\">:</span> <span class=\"n\">ℝ</span><span class=\"o\">):</span> <span class=\"n\">r</span><span class=\"bp\">•</span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"bp\">+</span><span class=\"n\">b</span><span class=\"o\">)</span> <span class=\"bp\">=</span> <span class=\"n\">r</span><span class=\"bp\">•</span><span class=\"n\">a</span> <span class=\"bp\">+</span> <span class=\"n\">r</span><span class=\"bp\">•</span><span class=\"n\">b</span>   <span class=\"o\">:=</span>\n<span class=\"kd\">begin</span>\n  <span class=\"n\">unfold</span> <span class=\"n\">algebra.smul_def'</span><span class=\"o\">,</span>\n  <span class=\"n\">rw</span> <span class=\"bp\">←</span> <span class=\"n\">mul_add</span><span class=\"o\">,</span>\n<span class=\"kd\">end</span>\n\n\n<span class=\"kd\">instance</span> <span class=\"o\">{</span><span class=\"n\">α</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span> <span class=\"o\">[</span><span class=\"n\">add_comm_group</span> <span class=\"n\">α</span><span class=\"o\">]</span> <span class=\"o\">:</span> <span class=\"n\">add_comm_group</span> <span class=\"o\">(</span><span class=\"n\">α</span><span class=\"bp\">ˢʸᵐ</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"o\">{</span>\n  <span class=\"n\">zero</span> <span class=\"o\">:=</span> <span class=\"n\">sym</span> <span class=\"mi\">0</span><span class=\"o\">,</span>\n  <span class=\"n\">add</span> <span class=\"o\">:=</span> <span class=\"bp\">λ</span> <span class=\"n\">a</span> <span class=\"n\">b</span><span class=\"o\">,</span> <span class=\"n\">a</span><span class=\"bp\">+</span><span class=\"n\">b</span><span class=\"o\">,</span>\n  <span class=\"n\">add_assoc</span> <span class=\"o\">:=</span> <span class=\"bp\">λ</span> <span class=\"n\">a</span> <span class=\"n\">b</span> <span class=\"n\">c</span> <span class=\"o\">:</span> <span class=\"n\">α</span><span class=\"o\">,</span> <span class=\"n\">add_assoc</span> <span class=\"n\">a</span> <span class=\"n\">b</span> <span class=\"n\">c</span><span class=\"o\">,</span>\n  <span class=\"n\">add_comm</span> <span class=\"o\">:=</span> <span class=\"bp\">λ</span> <span class=\"n\">a</span> <span class=\"n\">b</span> <span class=\"o\">:</span> <span class=\"n\">α</span><span class=\"o\">,</span> <span class=\"n\">add_comm</span> <span class=\"n\">a</span> <span class=\"n\">b</span><span class=\"o\">,</span>\n  <span class=\"n\">zero_add</span> <span class=\"o\">:=</span> <span class=\"bp\">λ</span> <span class=\"n\">a</span><span class=\"o\">,</span> <span class=\"n\">zero_add</span> <span class=\"o\">(</span><span class=\"n\">unsym</span> <span class=\"n\">a</span><span class=\"o\">),</span>\n  <span class=\"n\">add_zero</span> <span class=\"o\">:=</span> <span class=\"bp\">λ</span> <span class=\"n\">a</span><span class=\"o\">,</span> <span class=\"n\">add_zero</span> <span class=\"o\">(</span><span class=\"n\">unsym</span> <span class=\"n\">a</span><span class=\"o\">),</span>\n  <span class=\"n\">neg</span> <span class=\"o\">:=</span> <span class=\"bp\">λ</span> <span class=\"n\">a</span><span class=\"o\">,</span> <span class=\"n\">sym</span> <span class=\"o\">(</span> <span class=\"bp\">-</span><span class=\"o\">(</span><span class=\"n\">unsym</span> <span class=\"n\">a</span><span class=\"o\">)),</span>\n  <span class=\"n\">add_left_neg</span> <span class=\"o\">:=</span> <span class=\"bp\">λ</span> <span class=\"n\">a</span><span class=\"o\">,</span> <span class=\"n\">add_left_neg</span> <span class=\"o\">(</span><span class=\"n\">unsym</span> <span class=\"n\">a</span><span class=\"o\">),</span>\n<span class=\"o\">}</span>\n\n\n<span class=\"kd\">noncomputable</span> <span class=\"kd\">instance</span> <span class=\"o\">(</span><span class=\"n\">α</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">)</span> <span class=\"o\">[</span><span class=\"n\">semiring</span> <span class=\"n\">α</span><span class=\"o\">]</span> <span class=\"o\">[</span><span class=\"n\">algebra</span> <span class=\"n\">ℝ</span> <span class=\"n\">α</span><span class=\"o\">]</span> <span class=\"o\">:</span> <span class=\"n\">non_unital_non_assoc_ring</span> <span class=\"o\">(</span><span class=\"n\">α</span><span class=\"bp\">ˢʸᵐ</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"o\">{</span>\n  <span class=\"n\">zero</span> <span class=\"o\">:=</span> <span class=\"n\">sym</span> <span class=\"mi\">0</span><span class=\"o\">,</span>\n  <span class=\"n\">add</span> <span class=\"o\">:=</span> <span class=\"bp\">λ</span> <span class=\"n\">a</span> <span class=\"n\">b</span><span class=\"o\">,</span> <span class=\"n\">a</span><span class=\"bp\">+</span><span class=\"n\">b</span><span class=\"o\">,</span>\n  <span class=\"n\">add_assoc</span> <span class=\"o\">:=</span> <span class=\"bp\">λ</span> <span class=\"n\">a</span> <span class=\"n\">b</span> <span class=\"n\">c</span> <span class=\"o\">:</span> <span class=\"n\">α</span><span class=\"o\">,</span> <span class=\"n\">add_assoc</span> <span class=\"n\">a</span> <span class=\"n\">b</span> <span class=\"n\">c</span><span class=\"o\">,</span>\n  <span class=\"n\">add_comm</span> <span class=\"o\">:=</span> <span class=\"bp\">λ</span> <span class=\"n\">a</span> <span class=\"n\">b</span> <span class=\"o\">:</span> <span class=\"n\">α</span><span class=\"o\">,</span> <span class=\"n\">add_comm</span> <span class=\"n\">a</span> <span class=\"n\">b</span><span class=\"o\">,</span>\n  <span class=\"n\">zero_add</span> <span class=\"o\">:=</span> <span class=\"bp\">λ</span> <span class=\"n\">a</span><span class=\"o\">,</span> <span class=\"n\">zero_add</span> <span class=\"o\">(</span><span class=\"n\">unsym</span> <span class=\"n\">a</span><span class=\"o\">),</span>\n  <span class=\"n\">add_zero</span> <span class=\"o\">:=</span> <span class=\"bp\">λ</span> <span class=\"n\">a</span><span class=\"o\">,</span> <span class=\"n\">add_zero</span> <span class=\"o\">(</span><span class=\"n\">unsym</span> <span class=\"n\">a</span><span class=\"o\">),</span>\n  <span class=\"n\">neg</span> <span class=\"o\">:=</span> <span class=\"bp\">λ</span> <span class=\"n\">a</span><span class=\"o\">,</span> <span class=\"gr\">sorry</span><span class=\"o\">,</span>\n  <span class=\"n\">add_left_neg</span> <span class=\"o\">:=</span> <span class=\"bp\">λ</span> <span class=\"n\">a</span><span class=\"o\">,</span> <span class=\"gr\">sorry</span><span class=\"o\">,</span>\n  <span class=\"n\">mul</span> <span class=\"o\">:=</span> <span class=\"bp\">λ</span> <span class=\"n\">a</span> <span class=\"n\">b</span><span class=\"o\">,</span> <span class=\"o\">(</span><span class=\"n\">sym</span> <span class=\"o\">((</span><span class=\"mi\">1</span><span class=\"bp\">/</span><span class=\"mi\">2</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">)</span><span class=\"bp\">•</span><span class=\"o\">(</span><span class=\"n\">unsym</span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"o\">)</span><span class=\"bp\">*</span><span class=\"n\">unsym</span><span class=\"o\">(</span><span class=\"n\">b</span><span class=\"o\">)</span><span class=\"bp\">+</span><span class=\"n\">unsym</span><span class=\"o\">(</span><span class=\"n\">b</span><span class=\"o\">)</span><span class=\"bp\">*</span><span class=\"n\">unsym</span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"o\">)))),</span>\n  <span class=\"n\">zero_mul</span> <span class=\"o\">:=</span> <span class=\"bp\">λ</span> <span class=\"n\">_</span><span class=\"o\">,</span> <span class=\"kd\">by</span> <span class=\"n\">simp</span><span class=\"o\">,</span>\n  <span class=\"n\">mul_zero</span> <span class=\"o\">:=</span>  <span class=\"bp\">λ</span> <span class=\"n\">_</span><span class=\"o\">,</span> <span class=\"kd\">by</span> <span class=\"n\">simp</span><span class=\"o\">,</span>\n  <span class=\"n\">left_distrib</span> <span class=\"o\">:=</span> <span class=\"bp\">λ</span> <span class=\"n\">a</span> <span class=\"n\">b</span> <span class=\"n\">c</span><span class=\"o\">,</span> <span class=\"gr\">sorry</span><span class=\"o\">,</span>\n  <span class=\"n\">right_distrib</span> <span class=\"o\">:=</span> <span class=\"bp\">λ</span> <span class=\"n\">a</span> <span class=\"n\">b</span> <span class=\"n\">c</span><span class=\"o\">,</span> <span class=\"gr\">sorry</span><span class=\"o\">,</span>\n<span class=\"o\">}</span>\n\n\n\n<span class=\"kd\">end</span> <span class=\"n\">sym_alg</span>\n</code></pre></div>",
        "id": 265624185,
        "sender_full_name": "Christopher Hoskin",
        "timestamp": 1640039884
    },
    {
        "content": "<p>This is awful, but it seems to work (assuming <code>ring</code> rather than <code>semiring</code>).</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kd\">noncomputable</span> <span class=\"kd\">instance</span> <span class=\"o\">(</span><span class=\"n\">α</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">)</span> <span class=\"o\">[</span><span class=\"n\">ring</span> <span class=\"n\">α</span><span class=\"o\">]</span> <span class=\"o\">[</span><span class=\"n\">algebra</span> <span class=\"n\">ℝ</span> <span class=\"n\">α</span><span class=\"o\">]</span> <span class=\"o\">:</span> <span class=\"n\">non_unital_non_assoc_ring</span> <span class=\"o\">(</span><span class=\"n\">α</span><span class=\"bp\">ˢʸᵐ</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"o\">{</span>\n  <span class=\"n\">zero</span> <span class=\"o\">:=</span> <span class=\"n\">sym</span> <span class=\"mi\">0</span><span class=\"o\">,</span>\n  <span class=\"n\">add</span> <span class=\"o\">:=</span> <span class=\"bp\">λ</span> <span class=\"n\">a</span> <span class=\"n\">b</span><span class=\"o\">,</span> <span class=\"n\">a</span><span class=\"bp\">+</span><span class=\"n\">b</span><span class=\"o\">,</span>\n  <span class=\"n\">add_assoc</span> <span class=\"o\">:=</span> <span class=\"bp\">λ</span> <span class=\"n\">a</span> <span class=\"n\">b</span> <span class=\"n\">c</span> <span class=\"o\">:</span> <span class=\"n\">α</span><span class=\"o\">,</span> <span class=\"n\">add_assoc</span> <span class=\"n\">a</span> <span class=\"n\">b</span> <span class=\"n\">c</span><span class=\"o\">,</span>\n  <span class=\"n\">add_comm</span> <span class=\"o\">:=</span> <span class=\"bp\">λ</span> <span class=\"n\">a</span> <span class=\"n\">b</span> <span class=\"o\">:</span> <span class=\"n\">α</span><span class=\"o\">,</span> <span class=\"n\">add_comm</span> <span class=\"n\">a</span> <span class=\"n\">b</span><span class=\"o\">,</span>\n  <span class=\"n\">zero_add</span> <span class=\"o\">:=</span> <span class=\"bp\">λ</span> <span class=\"n\">a</span><span class=\"o\">,</span> <span class=\"n\">zero_add</span> <span class=\"o\">(</span><span class=\"n\">unsym</span> <span class=\"n\">a</span><span class=\"o\">),</span>\n  <span class=\"n\">add_zero</span> <span class=\"o\">:=</span> <span class=\"bp\">λ</span> <span class=\"n\">a</span><span class=\"o\">,</span> <span class=\"n\">add_zero</span> <span class=\"o\">(</span><span class=\"n\">unsym</span> <span class=\"n\">a</span><span class=\"o\">),</span>\n  <span class=\"n\">neg</span> <span class=\"o\">:=</span> <span class=\"bp\">λ</span> <span class=\"n\">a</span><span class=\"o\">,</span> <span class=\"bp\">-</span><span class=\"n\">a</span><span class=\"o\">,</span>\n  <span class=\"n\">add_left_neg</span> <span class=\"o\">:=</span> <span class=\"bp\">λ</span> <span class=\"n\">a</span><span class=\"o\">,</span> <span class=\"n\">add_left_neg</span> <span class=\"o\">(</span><span class=\"n\">unsym</span> <span class=\"n\">a</span><span class=\"o\">),</span>\n  <span class=\"n\">mul</span> <span class=\"o\">:=</span> <span class=\"bp\">λ</span> <span class=\"n\">a</span> <span class=\"n\">b</span><span class=\"o\">,</span> <span class=\"o\">(</span><span class=\"n\">sym</span> <span class=\"o\">((</span><span class=\"mi\">1</span><span class=\"bp\">/</span><span class=\"mi\">2</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">)</span><span class=\"bp\">•</span><span class=\"o\">(</span><span class=\"n\">unsym</span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"o\">)</span><span class=\"bp\">*</span><span class=\"n\">unsym</span><span class=\"o\">(</span><span class=\"n\">b</span><span class=\"o\">)</span><span class=\"bp\">+</span><span class=\"n\">unsym</span><span class=\"o\">(</span><span class=\"n\">b</span><span class=\"o\">)</span><span class=\"bp\">*</span><span class=\"n\">unsym</span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"o\">)))),</span>\n  <span class=\"n\">zero_mul</span> <span class=\"o\">:=</span> <span class=\"bp\">λ</span> <span class=\"n\">_</span><span class=\"o\">,</span> <span class=\"kd\">by</span> <span class=\"n\">simp</span><span class=\"o\">,</span>\n  <span class=\"n\">mul_zero</span> <span class=\"o\">:=</span>  <span class=\"bp\">λ</span> <span class=\"n\">_</span><span class=\"o\">,</span> <span class=\"kd\">by</span> <span class=\"n\">simp</span><span class=\"o\">,</span>\n  <span class=\"n\">left_distrib</span> <span class=\"o\">:=</span> <span class=\"bp\">λ</span> <span class=\"n\">a</span> <span class=\"n\">b</span> <span class=\"n\">c</span><span class=\"o\">,</span> <span class=\"kd\">begin</span>\n    <span class=\"n\">change</span> <span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"bp\">/</span><span class=\"mi\">2</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">)</span><span class=\"bp\">•</span><span class=\"o\">(</span><span class=\"n\">unsym</span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"o\">)</span><span class=\"bp\">*</span><span class=\"o\">(</span><span class=\"n\">unsym</span><span class=\"o\">(</span><span class=\"n\">b</span><span class=\"o\">)</span><span class=\"bp\">+</span><span class=\"n\">unsym</span><span class=\"o\">(</span><span class=\"n\">c</span><span class=\"o\">))</span><span class=\"bp\">+</span><span class=\"o\">(</span><span class=\"n\">unsym</span><span class=\"o\">(</span><span class=\"n\">b</span><span class=\"o\">)</span><span class=\"bp\">+</span><span class=\"n\">unsym</span><span class=\"o\">(</span><span class=\"n\">c</span><span class=\"o\">))</span><span class=\"bp\">*</span><span class=\"n\">unsym</span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"o\">))</span> <span class=\"bp\">=</span>\n      <span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"bp\">/</span><span class=\"mi\">2</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">)</span><span class=\"bp\">•</span><span class=\"o\">(</span><span class=\"n\">unsym</span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"o\">)</span><span class=\"bp\">*</span><span class=\"n\">unsym</span><span class=\"o\">(</span><span class=\"n\">b</span><span class=\"o\">)</span><span class=\"bp\">+</span><span class=\"n\">unsym</span><span class=\"o\">(</span><span class=\"n\">b</span><span class=\"o\">)</span><span class=\"bp\">*</span><span class=\"n\">unsym</span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"o\">))</span><span class=\"bp\">+</span><span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"bp\">/</span><span class=\"mi\">2</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">)</span><span class=\"bp\">•</span><span class=\"o\">(</span><span class=\"n\">unsym</span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"o\">)</span><span class=\"bp\">*</span><span class=\"n\">unsym</span><span class=\"o\">(</span><span class=\"n\">c</span><span class=\"o\">)</span><span class=\"bp\">+</span><span class=\"n\">unsym</span><span class=\"o\">(</span><span class=\"n\">c</span><span class=\"o\">)</span><span class=\"bp\">*</span><span class=\"n\">unsym</span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"o\">)),</span>\n    <span class=\"n\">rw</span> <span class=\"o\">[</span><span class=\"n\">mul_add</span><span class=\"o\">,</span> <span class=\"n\">add_mul</span><span class=\"o\">,</span> <span class=\"n\">smul_add</span><span class=\"o\">,</span> <span class=\"n\">smul_add</span><span class=\"o\">,</span> <span class=\"n\">smul_add</span><span class=\"o\">,</span> <span class=\"n\">smul_add</span><span class=\"o\">,</span> <span class=\"n\">smul_add</span><span class=\"o\">],</span>\n    <span class=\"n\">abel</span><span class=\"o\">,</span>\n  <span class=\"kd\">end</span><span class=\"o\">,</span>\n  <span class=\"n\">right_distrib</span> <span class=\"o\">:=</span> <span class=\"bp\">λ</span> <span class=\"n\">a</span> <span class=\"n\">b</span> <span class=\"n\">c</span><span class=\"o\">,</span> <span class=\"kd\">begin</span>\n    <span class=\"n\">change</span> <span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"bp\">/</span><span class=\"mi\">2</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">)</span><span class=\"bp\">•</span><span class=\"o\">((</span><span class=\"n\">unsym</span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"o\">)</span><span class=\"bp\">+</span><span class=\"n\">unsym</span><span class=\"o\">(</span><span class=\"n\">b</span><span class=\"o\">))</span><span class=\"bp\">*</span><span class=\"n\">unsym</span><span class=\"o\">(</span><span class=\"n\">c</span><span class=\"o\">)</span><span class=\"bp\">+</span><span class=\"n\">unsym</span><span class=\"o\">(</span><span class=\"n\">c</span><span class=\"o\">)</span><span class=\"bp\">*</span><span class=\"o\">(</span><span class=\"n\">unsym</span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"o\">)</span><span class=\"bp\">+</span><span class=\"n\">unsym</span><span class=\"o\">(</span><span class=\"n\">b</span><span class=\"o\">)))</span> <span class=\"bp\">=</span>\n      <span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"bp\">/</span><span class=\"mi\">2</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">)</span><span class=\"bp\">•</span><span class=\"o\">(</span><span class=\"n\">unsym</span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"o\">)</span><span class=\"bp\">*</span><span class=\"n\">unsym</span><span class=\"o\">(</span><span class=\"n\">c</span><span class=\"o\">)</span><span class=\"bp\">+</span><span class=\"n\">unsym</span><span class=\"o\">(</span><span class=\"n\">c</span><span class=\"o\">)</span><span class=\"bp\">*</span><span class=\"n\">unsym</span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"o\">))</span><span class=\"bp\">+</span><span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"bp\">/</span><span class=\"mi\">2</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">)</span><span class=\"bp\">•</span><span class=\"o\">(</span><span class=\"n\">unsym</span><span class=\"o\">(</span><span class=\"n\">b</span><span class=\"o\">)</span><span class=\"bp\">*</span><span class=\"n\">unsym</span><span class=\"o\">(</span><span class=\"n\">c</span><span class=\"o\">)</span><span class=\"bp\">+</span><span class=\"n\">unsym</span><span class=\"o\">(</span><span class=\"n\">c</span><span class=\"o\">)</span><span class=\"bp\">*</span><span class=\"n\">unsym</span><span class=\"o\">(</span><span class=\"n\">b</span><span class=\"o\">)),</span>\n    <span class=\"n\">rw</span> <span class=\"o\">[</span><span class=\"n\">mul_add</span><span class=\"o\">,</span> <span class=\"n\">add_mul</span><span class=\"o\">,</span> <span class=\"n\">smul_add</span><span class=\"o\">,</span> <span class=\"n\">smul_add</span><span class=\"o\">,</span> <span class=\"n\">smul_add</span><span class=\"o\">,</span> <span class=\"n\">smul_add</span><span class=\"o\">,</span> <span class=\"n\">smul_add</span><span class=\"o\">],</span>\n    <span class=\"n\">abel</span><span class=\"o\">,</span>\n  <span class=\"kd\">end</span><span class=\"o\">,</span>\n<span class=\"o\">}</span>\n</code></pre></div>",
        "id": 265625581,
        "sender_full_name": "Thomas Browning",
        "timestamp": 1640040858
    },
    {
        "content": "<p>My guess is that a semiring which is an \\R-algebra is a ring</p>",
        "id": 265625670,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1640040929
    },
    {
        "content": "<p>Yes, that's true. We have <code>module.add_comm_monoid_to_add_comm_group</code>, but how to use it?</p>",
        "id": 265625808,
        "sender_full_name": "Christopher Hoskin",
        "timestamp": 1640041034
    },
    {
        "content": "<p>Here's one way:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kd\">noncomputable</span> <span class=\"kd\">instance</span> <span class=\"o\">(</span><span class=\"n\">α</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">)</span> <span class=\"o\">[</span><span class=\"n\">semiring</span> <span class=\"n\">α</span><span class=\"o\">]</span> <span class=\"o\">[</span><span class=\"n\">algebra</span> <span class=\"n\">ℝ</span> <span class=\"n\">α</span><span class=\"o\">]</span> <span class=\"o\">:</span> <span class=\"n\">non_unital_non_assoc_ring</span> <span class=\"o\">(</span><span class=\"n\">α</span><span class=\"bp\">ˢʸᵐ</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"o\">{</span>\n  <span class=\"n\">zero</span> <span class=\"o\">:=</span> <span class=\"n\">sym</span> <span class=\"mi\">0</span><span class=\"o\">,</span>\n  <span class=\"n\">add</span> <span class=\"o\">:=</span> <span class=\"bp\">λ</span> <span class=\"n\">a</span> <span class=\"n\">b</span><span class=\"o\">,</span> <span class=\"n\">a</span><span class=\"bp\">+</span><span class=\"n\">b</span><span class=\"o\">,</span>\n  <span class=\"n\">add_assoc</span> <span class=\"o\">:=</span> <span class=\"bp\">λ</span> <span class=\"n\">a</span> <span class=\"n\">b</span> <span class=\"n\">c</span> <span class=\"o\">:</span> <span class=\"n\">α</span><span class=\"o\">,</span> <span class=\"n\">add_assoc</span> <span class=\"n\">a</span> <span class=\"n\">b</span> <span class=\"n\">c</span><span class=\"o\">,</span>\n  <span class=\"n\">add_comm</span> <span class=\"o\">:=</span> <span class=\"bp\">λ</span> <span class=\"n\">a</span> <span class=\"n\">b</span> <span class=\"o\">:</span> <span class=\"n\">α</span><span class=\"o\">,</span> <span class=\"n\">add_comm</span> <span class=\"n\">a</span> <span class=\"n\">b</span><span class=\"o\">,</span>\n  <span class=\"n\">zero_add</span> <span class=\"o\">:=</span> <span class=\"bp\">λ</span> <span class=\"n\">a</span><span class=\"o\">,</span> <span class=\"n\">zero_add</span> <span class=\"o\">(</span><span class=\"n\">unsym</span> <span class=\"n\">a</span><span class=\"o\">),</span>\n  <span class=\"n\">add_zero</span> <span class=\"o\">:=</span> <span class=\"bp\">λ</span> <span class=\"n\">a</span><span class=\"o\">,</span> <span class=\"n\">add_zero</span> <span class=\"o\">(</span><span class=\"n\">unsym</span> <span class=\"n\">a</span><span class=\"o\">),</span>\n  <span class=\"n\">neg</span> <span class=\"o\">:=</span> <span class=\"bp\">λ</span> <span class=\"n\">a</span><span class=\"o\">,</span> <span class=\"o\">(</span><span class=\"bp\">-</span><span class=\"mi\">1</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">)</span><span class=\"bp\">•</span><span class=\"n\">unsym</span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"o\">),</span>\n  <span class=\"n\">add_left_neg</span> <span class=\"o\">:=</span> <span class=\"bp\">λ</span> <span class=\"n\">a</span><span class=\"o\">,</span>\n  <span class=\"k\">calc</span> <span class=\"o\">(</span><span class=\"bp\">-</span><span class=\"mi\">1</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">)</span><span class=\"bp\">•</span><span class=\"n\">unsym</span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"o\">)</span><span class=\"bp\">+</span><span class=\"n\">unsym</span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"o\">)</span> <span class=\"bp\">=</span> <span class=\"o\">(</span><span class=\"bp\">-</span><span class=\"mi\">1</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">)</span><span class=\"bp\">•</span><span class=\"n\">unsym</span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"o\">)</span><span class=\"bp\">+</span><span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">)</span><span class=\"bp\">•</span><span class=\"o\">(</span><span class=\"n\">unsym</span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"o\">))</span> <span class=\"o\">:</span> <span class=\"kd\">by</span> <span class=\"n\">rw</span> <span class=\"n\">one_smul</span>\n    <span class=\"bp\">...</span> <span class=\"bp\">=</span> <span class=\"o\">((</span><span class=\"bp\">-</span><span class=\"mi\">1</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">)</span><span class=\"bp\">+</span><span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">))</span><span class=\"bp\">•</span><span class=\"n\">unsym</span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"kd\">by</span> <span class=\"n\">rw</span> <span class=\"n\">_root_.add_smul</span>\n    <span class=\"bp\">...</span> <span class=\"bp\">=</span> <span class=\"o\">(</span><span class=\"mi\">0</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">)</span><span class=\"bp\">•</span><span class=\"n\">unsym</span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"kd\">by</span> <span class=\"n\">rw</span> <span class=\"n\">neg_add_self</span>\n    <span class=\"bp\">...</span> <span class=\"bp\">=</span> <span class=\"mi\">0</span> <span class=\"o\">:</span> <span class=\"kd\">by</span> <span class=\"n\">rw</span> <span class=\"n\">zero_smul</span><span class=\"o\">,</span>\n  <span class=\"n\">mul</span> <span class=\"o\">:=</span> <span class=\"bp\">λ</span> <span class=\"n\">a</span> <span class=\"n\">b</span><span class=\"o\">,</span> <span class=\"o\">(</span><span class=\"n\">sym</span> <span class=\"o\">((</span><span class=\"mi\">1</span><span class=\"bp\">/</span><span class=\"mi\">2</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">)</span><span class=\"bp\">•</span><span class=\"o\">(</span><span class=\"n\">unsym</span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"o\">)</span><span class=\"bp\">*</span><span class=\"n\">unsym</span><span class=\"o\">(</span><span class=\"n\">b</span><span class=\"o\">)</span><span class=\"bp\">+</span><span class=\"n\">unsym</span><span class=\"o\">(</span><span class=\"n\">b</span><span class=\"o\">)</span><span class=\"bp\">*</span><span class=\"n\">unsym</span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"o\">)))),</span>\n  <span class=\"n\">zero_mul</span> <span class=\"o\">:=</span> <span class=\"bp\">λ</span> <span class=\"n\">_</span><span class=\"o\">,</span> <span class=\"kd\">by</span> <span class=\"n\">simp</span><span class=\"o\">,</span>\n  <span class=\"n\">mul_zero</span> <span class=\"o\">:=</span>  <span class=\"bp\">λ</span> <span class=\"n\">_</span><span class=\"o\">,</span> <span class=\"kd\">by</span> <span class=\"n\">simp</span><span class=\"o\">,</span>\n  <span class=\"n\">left_distrib</span> <span class=\"o\">:=</span> <span class=\"bp\">λ</span> <span class=\"n\">a</span> <span class=\"n\">b</span> <span class=\"n\">c</span><span class=\"o\">,</span> <span class=\"kd\">begin</span>\n    <span class=\"n\">change</span> <span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"bp\">/</span><span class=\"mi\">2</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">)</span><span class=\"bp\">•</span><span class=\"o\">(</span><span class=\"n\">unsym</span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"o\">)</span><span class=\"bp\">*</span><span class=\"o\">(</span><span class=\"n\">unsym</span><span class=\"o\">(</span><span class=\"n\">b</span><span class=\"o\">)</span><span class=\"bp\">+</span><span class=\"n\">unsym</span><span class=\"o\">(</span><span class=\"n\">c</span><span class=\"o\">))</span><span class=\"bp\">+</span><span class=\"o\">(</span><span class=\"n\">unsym</span><span class=\"o\">(</span><span class=\"n\">b</span><span class=\"o\">)</span><span class=\"bp\">+</span><span class=\"n\">unsym</span><span class=\"o\">(</span><span class=\"n\">c</span><span class=\"o\">))</span><span class=\"bp\">*</span><span class=\"n\">unsym</span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"o\">))</span> <span class=\"bp\">=</span>\n      <span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"bp\">/</span><span class=\"mi\">2</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">)</span><span class=\"bp\">•</span><span class=\"o\">(</span><span class=\"n\">unsym</span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"o\">)</span><span class=\"bp\">*</span><span class=\"n\">unsym</span><span class=\"o\">(</span><span class=\"n\">b</span><span class=\"o\">)</span><span class=\"bp\">+</span><span class=\"n\">unsym</span><span class=\"o\">(</span><span class=\"n\">b</span><span class=\"o\">)</span><span class=\"bp\">*</span><span class=\"n\">unsym</span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"o\">))</span><span class=\"bp\">+</span><span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"bp\">/</span><span class=\"mi\">2</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">)</span><span class=\"bp\">•</span><span class=\"o\">(</span><span class=\"n\">unsym</span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"o\">)</span><span class=\"bp\">*</span><span class=\"n\">unsym</span><span class=\"o\">(</span><span class=\"n\">c</span><span class=\"o\">)</span><span class=\"bp\">+</span><span class=\"n\">unsym</span><span class=\"o\">(</span><span class=\"n\">c</span><span class=\"o\">)</span><span class=\"bp\">*</span><span class=\"n\">unsym</span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"o\">)),</span>\n    <span class=\"n\">rw</span> <span class=\"o\">[</span><span class=\"n\">mul_add</span><span class=\"o\">,</span> <span class=\"n\">add_mul</span><span class=\"o\">,</span> <span class=\"n\">smul_add</span><span class=\"o\">,</span> <span class=\"n\">smul_add</span><span class=\"o\">,</span> <span class=\"n\">smul_add</span><span class=\"o\">,</span> <span class=\"n\">smul_add</span><span class=\"o\">,</span> <span class=\"n\">smul_add</span><span class=\"o\">],</span>\n    <span class=\"n\">abel</span><span class=\"o\">,</span>\n  <span class=\"kd\">end</span><span class=\"o\">,</span>\n  <span class=\"n\">right_distrib</span> <span class=\"o\">:=</span> <span class=\"bp\">λ</span> <span class=\"n\">a</span> <span class=\"n\">b</span> <span class=\"n\">c</span><span class=\"o\">,</span> <span class=\"kd\">begin</span>\n    <span class=\"n\">change</span> <span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"bp\">/</span><span class=\"mi\">2</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">)</span><span class=\"bp\">•</span><span class=\"o\">((</span><span class=\"n\">unsym</span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"o\">)</span><span class=\"bp\">+</span><span class=\"n\">unsym</span><span class=\"o\">(</span><span class=\"n\">b</span><span class=\"o\">))</span><span class=\"bp\">*</span><span class=\"n\">unsym</span><span class=\"o\">(</span><span class=\"n\">c</span><span class=\"o\">)</span><span class=\"bp\">+</span><span class=\"n\">unsym</span><span class=\"o\">(</span><span class=\"n\">c</span><span class=\"o\">)</span><span class=\"bp\">*</span><span class=\"o\">(</span><span class=\"n\">unsym</span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"o\">)</span><span class=\"bp\">+</span><span class=\"n\">unsym</span><span class=\"o\">(</span><span class=\"n\">b</span><span class=\"o\">)))</span> <span class=\"bp\">=</span>\n      <span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"bp\">/</span><span class=\"mi\">2</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">)</span><span class=\"bp\">•</span><span class=\"o\">(</span><span class=\"n\">unsym</span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"o\">)</span><span class=\"bp\">*</span><span class=\"n\">unsym</span><span class=\"o\">(</span><span class=\"n\">c</span><span class=\"o\">)</span><span class=\"bp\">+</span><span class=\"n\">unsym</span><span class=\"o\">(</span><span class=\"n\">c</span><span class=\"o\">)</span><span class=\"bp\">*</span><span class=\"n\">unsym</span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"o\">))</span><span class=\"bp\">+</span><span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"bp\">/</span><span class=\"mi\">2</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">)</span><span class=\"bp\">•</span><span class=\"o\">(</span><span class=\"n\">unsym</span><span class=\"o\">(</span><span class=\"n\">b</span><span class=\"o\">)</span><span class=\"bp\">*</span><span class=\"n\">unsym</span><span class=\"o\">(</span><span class=\"n\">c</span><span class=\"o\">)</span><span class=\"bp\">+</span><span class=\"n\">unsym</span><span class=\"o\">(</span><span class=\"n\">c</span><span class=\"o\">)</span><span class=\"bp\">*</span><span class=\"n\">unsym</span><span class=\"o\">(</span><span class=\"n\">b</span><span class=\"o\">)),</span>\n    <span class=\"n\">rw</span> <span class=\"o\">[</span><span class=\"n\">mul_add</span><span class=\"o\">,</span> <span class=\"n\">add_mul</span><span class=\"o\">,</span> <span class=\"n\">smul_add</span><span class=\"o\">,</span> <span class=\"n\">smul_add</span><span class=\"o\">,</span> <span class=\"n\">smul_add</span><span class=\"o\">,</span> <span class=\"n\">smul_add</span><span class=\"o\">,</span> <span class=\"n\">smul_add</span><span class=\"o\">],</span>\n    <span class=\"n\">abel</span><span class=\"o\">,</span>\n  <span class=\"kd\">end</span><span class=\"o\">,</span>\n<span class=\"o\">}</span>\n</code></pre></div>",
        "id": 265626350,
        "sender_full_name": "Thomas Browning",
        "timestamp": 1640041350
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"373192\">Christopher Hoskin</span> <a href=\"#narrow/stream/116395-maths/topic/Symmetrized.20product.20of.20a.20real.20algebra/near/265625808\">said</a>:</p>\n<blockquote>\n<p>Yes, that's true. We have <code>module.add_comm_monoid_to_add_comm_group</code>, but how to use it?</p>\n</blockquote>\n<p>I can't help feeling this is an <a href=\"https://en.wikipedia.org/wiki/XY_problem\">#xy</a> problem - why do you want this vs the</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kd\">noncomputable</span> <span class=\"kd\">instance</span> <span class=\"o\">(</span><span class=\"n\">α</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">)</span> <span class=\"o\">[</span><span class=\"n\">ring</span> <span class=\"n\">α</span><span class=\"o\">]</span> <span class=\"o\">[</span><span class=\"n\">algebra</span> <span class=\"n\">ℝ</span> <span class=\"n\">α</span><span class=\"o\">]</span> <span class=\"o\">:</span> <span class=\"n\">non_unital_non_assoc_ring</span> <span class=\"o\">(</span><span class=\"n\">α</span><span class=\"bp\">ˢʸᵐ</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>instance that was suggested above?</p>",
        "id": 265626728,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1640041661
    },
    {
        "content": "<p>One advantage to assuming <code>[ring α] [algebra ℝ α]</code> (which isn't weaker, since it is implied by <code>[semiring α] [algebra ℝ α]</code>) is that negation on <code>αˢʸᵐ</code> is defeq to negation on <code>α</code>.</p>",
        "id": 265627086,
        "sender_full_name": "Thomas Browning",
        "timestamp": 1640041889
    },
    {
        "content": "<p><code>[ring α]</code> is fine with me - it's a more natural way of thinking about it. I just couldn't get it to work before, but <span class=\"user-mention\" data-user-id=\"253861\">@Thomas Browning</span>  has shown that it can be done. Thanks!</p>",
        "id": 265627202,
        "sender_full_name": "Christopher Hoskin",
        "timestamp": 1640041971
    },
    {
        "content": "<p>I'd also recommend starting with:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kd\">instance</span> <span class=\"o\">[</span><span class=\"n\">has_zero</span> <span class=\"n\">α</span><span class=\"o\">]</span> <span class=\"o\">:</span> <span class=\"n\">has_zero</span> <span class=\"o\">(</span><span class=\"n\">α</span><span class=\"bp\">ˢʸᵐ</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"o\">{</span> <span class=\"n\">zero</span> <span class=\"o\">:=</span> <span class=\"n\">sym</span> <span class=\"mi\">0</span> <span class=\"o\">}</span>\n<span class=\"kd\">instance</span> <span class=\"o\">[</span><span class=\"n\">has_add</span> <span class=\"n\">α</span><span class=\"o\">]</span> <span class=\"o\">:</span> <span class=\"n\">has_add</span> <span class=\"n\">α</span><span class=\"bp\">ˢʸᵐ</span> <span class=\"o\">:=</span> <span class=\"o\">{</span> <span class=\"n\">add</span> <span class=\"o\">:=</span> <span class=\"bp\">λ</span> <span class=\"n\">a</span> <span class=\"n\">b</span><span class=\"o\">,</span> <span class=\"n\">sym</span> <span class=\"o\">(</span><span class=\"n\">unsym</span> <span class=\"n\">a</span> <span class=\"bp\">+</span> <span class=\"n\">unsym</span> <span class=\"n\">b</span><span class=\"o\">)</span> <span class=\"o\">}</span>\n<span class=\"kd\">instance</span> <span class=\"o\">[</span><span class=\"n\">has_sub</span> <span class=\"n\">α</span><span class=\"o\">]</span> <span class=\"o\">:</span> <span class=\"n\">has_sub</span> <span class=\"n\">α</span><span class=\"bp\">ˢʸᵐ</span> <span class=\"o\">:=</span> <span class=\"o\">{</span> <span class=\"n\">sub</span> <span class=\"o\">:=</span> <span class=\"bp\">λ</span> <span class=\"n\">a</span> <span class=\"n\">b</span><span class=\"o\">,</span> <span class=\"n\">sym</span> <span class=\"o\">(</span><span class=\"n\">unsym</span> <span class=\"n\">a</span> <span class=\"bp\">-</span> <span class=\"n\">unsym</span> <span class=\"n\">b</span><span class=\"o\">)</span> <span class=\"o\">}</span>\n<span class=\"kd\">instance</span> <span class=\"o\">[</span><span class=\"n\">has_neg</span> <span class=\"n\">α</span><span class=\"o\">]</span> <span class=\"o\">:</span> <span class=\"n\">has_neg</span> <span class=\"n\">α</span><span class=\"bp\">ˢʸᵐ</span> <span class=\"o\">:=</span> <span class=\"o\">{</span> <span class=\"n\">neg</span> <span class=\"o\">:=</span> <span class=\"bp\">λ</span> <span class=\"n\">a</span><span class=\"o\">,</span> <span class=\"n\">sym</span> <span class=\"o\">(</span><span class=\"bp\">-</span><span class=\"n\">unsym</span> <span class=\"n\">a</span><span class=\"o\">)</span> <span class=\"o\">}</span>\n<span class=\"kd\">instance</span> <span class=\"o\">[</span><span class=\"n\">has_scalar</span> <span class=\"n\">R</span> <span class=\"n\">α</span><span class=\"o\">]</span> <span class=\"o\">:</span> <span class=\"n\">has_scalar</span> <span class=\"n\">R</span> <span class=\"n\">α</span><span class=\"bp\">ˢʸᵐ</span> <span class=\"o\">:=</span> <span class=\"o\">{</span> <span class=\"n\">smul</span> <span class=\"o\">:=</span> <span class=\"bp\">λ</span> <span class=\"n\">r</span> <span class=\"n\">a</span><span class=\"o\">,</span> <span class=\"n\">sym</span> <span class=\"o\">(</span><span class=\"n\">r</span><span class=\"bp\">•</span><span class=\"o\">(</span><span class=\"n\">unsym</span> <span class=\"n\">a</span><span class=\"o\">))</span> <span class=\"o\">}</span>\n\n<span class=\"c1\">-- add all the `sym_add` etc lemmas you already have here</span>\n\n<span class=\"kd\">lemma</span> <span class=\"n\">unsym_injective</span> <span class=\"o\">:</span> <span class=\"n\">function.injective</span> <span class=\"o\">(</span><span class=\"bp\">@</span><span class=\"n\">unsym</span> <span class=\"n\">α</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"bp\">λ</span> <span class=\"n\">_</span> <span class=\"n\">_</span><span class=\"o\">,</span> <span class=\"n\">id</span>\n\n<span class=\"c1\">-- build up all the proof structures:</span>\n<span class=\"kd\">instance</span> <span class=\"o\">[</span><span class=\"n\">add_comm_semigroup</span> <span class=\"n\">α</span><span class=\"o\">]</span> <span class=\"o\">:</span> <span class=\"n\">add_comm_semigroup</span> <span class=\"o\">(</span><span class=\"n\">α</span><span class=\"bp\">ˢʸᵐ</span><span class=\"o\">)</span> <span class=\"o\">:=</span>\n<span class=\"n\">unsym_injective.add_comm_semigroup</span> <span class=\"n\">_</span> <span class=\"o\">(</span><span class=\"bp\">λ</span> <span class=\"n\">_</span> <span class=\"n\">_</span><span class=\"o\">,</span> <span class=\"n\">rfl</span><span class=\"o\">)</span>\n\n<span class=\"kd\">instance</span> <span class=\"o\">[</span><span class=\"n\">add_monoid</span> <span class=\"n\">α</span><span class=\"o\">]</span> <span class=\"o\">:</span> <span class=\"n\">add_monoid</span> <span class=\"o\">(</span><span class=\"n\">α</span><span class=\"bp\">ˢʸᵐ</span><span class=\"o\">)</span> <span class=\"o\">:=</span>\n<span class=\"n\">unsym_injective.add_monoid_smul</span> <span class=\"n\">_</span> <span class=\"n\">rfl</span> <span class=\"o\">(</span><span class=\"bp\">λ</span> <span class=\"n\">_</span> <span class=\"n\">_</span><span class=\"o\">,</span> <span class=\"n\">rfl</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"bp\">λ</span> <span class=\"n\">_</span> <span class=\"n\">_</span><span class=\"o\">,</span> <span class=\"n\">rfl</span><span class=\"o\">)</span>\n\n<span class=\"kd\">instance</span> <span class=\"o\">[</span><span class=\"n\">add_group</span> <span class=\"n\">α</span><span class=\"o\">]</span> <span class=\"o\">:</span> <span class=\"n\">add_group</span> <span class=\"o\">(</span><span class=\"n\">α</span><span class=\"bp\">ˢʸᵐ</span><span class=\"o\">)</span> <span class=\"o\">:=</span>\n<span class=\"n\">unsym_injective.add_group_smul</span> <span class=\"n\">_</span> <span class=\"n\">rfl</span>\n  <span class=\"o\">(</span><span class=\"bp\">λ</span> <span class=\"n\">_</span> <span class=\"n\">_</span><span class=\"o\">,</span> <span class=\"n\">rfl</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"bp\">λ</span> <span class=\"n\">_</span><span class=\"o\">,</span> <span class=\"n\">rfl</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"bp\">λ</span> <span class=\"n\">_</span> <span class=\"n\">_</span><span class=\"o\">,</span> <span class=\"n\">rfl</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"bp\">λ</span> <span class=\"n\">_</span> <span class=\"n\">_</span><span class=\"o\">,</span> <span class=\"n\">rfl</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"bp\">λ</span> <span class=\"n\">_</span> <span class=\"n\">_</span><span class=\"o\">,</span> <span class=\"n\">rfl</span><span class=\"o\">)</span>\n\n<span class=\"kd\">instance</span> <span class=\"o\">[</span><span class=\"n\">add_comm_monoid</span> <span class=\"n\">α</span><span class=\"o\">]</span> <span class=\"o\">:</span> <span class=\"n\">add_comm_monoid</span> <span class=\"o\">(</span><span class=\"n\">α</span><span class=\"bp\">ˢʸᵐ</span><span class=\"o\">)</span> <span class=\"o\">:=</span>\n<span class=\"o\">{</span> <span class=\"bp\">..</span><span class=\"n\">sym_alg.add_comm_semigroup</span><span class=\"o\">,</span> <span class=\"bp\">..</span><span class=\"n\">sym_alg.add_monoid</span> <span class=\"o\">}</span>\n\n<span class=\"kd\">instance</span> <span class=\"o\">[</span><span class=\"n\">add_comm_group</span> <span class=\"n\">α</span><span class=\"o\">]</span> <span class=\"o\">:</span> <span class=\"n\">add_comm_group</span> <span class=\"o\">(</span><span class=\"n\">α</span><span class=\"bp\">ˢʸᵐ</span><span class=\"o\">)</span> <span class=\"o\">:=</span>\n<span class=\"o\">{</span> <span class=\"bp\">..</span><span class=\"n\">sym_alg.add_comm_monoid</span><span class=\"o\">,</span> <span class=\"bp\">..</span><span class=\"n\">sym_alg.add_group</span> <span class=\"o\">}</span>\n\n<span class=\"kd\">instance</span> <span class=\"o\">[</span><span class=\"n\">semiring</span> <span class=\"n\">R</span><span class=\"o\">]</span> <span class=\"o\">[</span><span class=\"n\">add_comm_monoid</span> <span class=\"n\">α</span><span class=\"o\">]</span> <span class=\"o\">[</span><span class=\"n\">module</span> <span class=\"n\">R</span> <span class=\"n\">α</span><span class=\"o\">]</span> <span class=\"o\">:</span> <span class=\"n\">module</span> <span class=\"n\">R</span> <span class=\"n\">α</span><span class=\"bp\">ˢʸᵐ</span> <span class=\"o\">:=</span>\n<span class=\"n\">function.injective.module</span> <span class=\"n\">R</span> <span class=\"o\">⟨</span><span class=\"n\">unsym</span><span class=\"o\">,</span> <span class=\"n\">rfl</span><span class=\"o\">,</span> <span class=\"bp\">λ</span> <span class=\"n\">_</span> <span class=\"n\">_</span><span class=\"o\">,</span> <span class=\"n\">rfl</span><span class=\"o\">⟩</span> <span class=\"o\">(</span><span class=\"bp\">λ</span> <span class=\"n\">_</span> <span class=\"n\">_</span><span class=\"o\">,</span> <span class=\"n\">id</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"bp\">λ</span> <span class=\"n\">_</span> <span class=\"n\">_</span><span class=\"o\">,</span> <span class=\"n\">rfl</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>This will avoid ugly instance diamonds later, and also means you don't need your own <code>add_smul</code> and <code>smul_add'</code> lemmas.</p>",
        "id": 265627506,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1640042206
    },
    {
        "content": "<p>Thanks. I'm now stuck trying to show that the squares of both multiplications coincide (up to identification):</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kd\">lemma</span> <span class=\"n\">powers</span> <span class=\"o\">[</span><span class=\"n\">ring</span> <span class=\"n\">α</span><span class=\"o\">]</span> <span class=\"o\">[</span><span class=\"n\">algebra</span> <span class=\"n\">ℝ</span> <span class=\"n\">α</span><span class=\"o\">]</span> <span class=\"o\">(</span><span class=\"n\">a</span><span class=\"o\">:</span> <span class=\"n\">α</span><span class=\"bp\">ˢʸᵐ</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">unsym</span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"bp\">*</span><span class=\"n\">a</span><span class=\"o\">)</span> <span class=\"bp\">=</span> <span class=\"n\">unsym</span> <span class=\"n\">a</span> <span class=\"bp\">*</span> <span class=\"n\">unsym</span> <span class=\"n\">a</span> <span class=\"o\">:=</span>\n<span class=\"kd\">begin</span>\n  <span class=\"n\">change</span> <span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"bp\">/</span><span class=\"mi\">2</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">)</span><span class=\"bp\">•</span><span class=\"o\">(</span><span class=\"n\">unsym</span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"o\">)</span><span class=\"bp\">*</span><span class=\"n\">unsym</span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"o\">)</span><span class=\"bp\">+</span><span class=\"n\">unsym</span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"o\">)</span><span class=\"bp\">*</span><span class=\"n\">unsym</span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"o\">))</span> <span class=\"bp\">=</span> <span class=\"n\">unsym</span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"o\">)</span><span class=\"bp\">*</span><span class=\"n\">unsym</span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"o\">),</span>\n      <span class=\"n\">abel</span><span class=\"o\">,</span>\n      <span class=\"c1\">--rw smul_smul,</span>\n      <span class=\"n\">unfold</span> <span class=\"n\">algebra.smul_def'</span><span class=\"o\">,</span>\n      <span class=\"n\">rw</span> <span class=\"bp\">←</span> <span class=\"n\">mul_assoc</span><span class=\"o\">,</span>\n      <span class=\"c1\">--rw ← map_mul,</span>\n      <span class=\"c1\">--rw ← algebra.to_ring_hom.map_mul' (1/2:ℝ) (2:ℤ),</span>\n      <span class=\"c1\">--rw ← (algebra_map ℝ α).map_mul' (1/2:ℝ) (2:ℤ),</span>\n      <span class=\"c1\">--rw ← mul_hom.map_mul' algebra.to_ring_hom,</span>\n      <span class=\"c1\">--rw ← map_mul algebra.to_ring_hom.to_fun (1/2:ℝ) (2:ℤ),</span>\n      <span class=\"gr\">sorry</span><span class=\"o\">,</span>\n<span class=\"kd\">end</span>\n</code></pre></div>\n<p>I get to</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"bp\">⊢</span> <span class=\"n\">algebra.to_ring_hom.to_fun</span> <span class=\"o\">(</span><span class=\"mi\">1</span> <span class=\"bp\">/</span> <span class=\"mi\">2</span><span class=\"o\">)</span> <span class=\"bp\">*</span> <span class=\"n\">algebra.to_ring_hom.to_fun</span> <span class=\"mi\">2</span> <span class=\"bp\">*</span> <span class=\"o\">(</span><span class=\"n\">unsym</span> <span class=\"n\">a</span> <span class=\"bp\">*</span> <span class=\"n\">unsym</span> <span class=\"n\">a</span><span class=\"o\">)</span> <span class=\"bp\">=</span> <span class=\"n\">unsym</span> <span class=\"n\">a</span> <span class=\"bp\">*</span> <span class=\"n\">unsym</span> <span class=\"n\">a</span>\n</code></pre></div>\n<p>But then can't find the correct incantation to bring the <code>2</code> and <code>1/2</code> together so that they cancel out.</p>\n<p>Christopher</p>",
        "id": 266101454,
        "sender_full_name": "Christopher Hoskin",
        "timestamp": 1640511842
    },
    {
        "content": "<p>At the point you introduced <code>to_fun</code> into the goal you made a wrong turn</p>",
        "id": 266101869,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1640512543
    },
    {
        "content": "<p>Yes, the problem is I don't know how to convert the (2:ℤ) that <code>abel</code> gives me into <code>(2:ℝ)</code> so that I can invoke <code>smul_smul</code>.</p>\n<p>Okay:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kd\">lemma</span> <span class=\"n\">test2</span> <span class=\"o\">[</span><span class=\"n\">ring</span> <span class=\"n\">α</span><span class=\"o\">]</span> <span class=\"o\">[</span><span class=\"n\">algebra</span> <span class=\"n\">ℝ</span> <span class=\"n\">α</span><span class=\"o\">]</span> <span class=\"o\">(</span><span class=\"n\">r</span> <span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">s</span><span class=\"o\">:</span> <span class=\"n\">ℝ</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">a</span><span class=\"o\">:</span><span class=\"n\">α</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">r</span><span class=\"bp\">•</span><span class=\"o\">(</span><span class=\"n\">s</span><span class=\"bp\">•</span><span class=\"n\">a</span><span class=\"o\">)</span> <span class=\"bp\">=</span> <span class=\"o\">(</span><span class=\"n\">r</span><span class=\"bp\">*</span><span class=\"n\">s</span><span class=\"o\">)</span><span class=\"bp\">•</span><span class=\"n\">a</span> <span class=\"o\">:=</span>\n<span class=\"kd\">begin</span>\n  <span class=\"n\">rw</span> <span class=\"n\">smul_smul</span> <span class=\"n\">r</span> <span class=\"n\">s</span> <span class=\"n\">a</span><span class=\"o\">,</span>\n<span class=\"kd\">end</span>\n</code></pre></div>\n<p>Fails:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kd\">lemma</span> <span class=\"n\">test2</span> <span class=\"o\">[</span><span class=\"n\">ring</span> <span class=\"n\">α</span><span class=\"o\">]</span> <span class=\"o\">[</span><span class=\"n\">algebra</span> <span class=\"n\">ℝ</span> <span class=\"n\">α</span><span class=\"o\">]</span> <span class=\"o\">(</span><span class=\"n\">r</span> <span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">s</span><span class=\"o\">:</span> <span class=\"n\">ℤ</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">a</span><span class=\"o\">:</span><span class=\"n\">α</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">r</span><span class=\"bp\">•</span><span class=\"o\">(</span><span class=\"n\">s</span><span class=\"bp\">•</span><span class=\"n\">a</span><span class=\"o\">)</span> <span class=\"bp\">=</span> <span class=\"o\">(</span><span class=\"n\">r</span><span class=\"bp\">*</span><span class=\"n\">s</span><span class=\"o\">)</span><span class=\"bp\">•</span><span class=\"n\">a</span> <span class=\"o\">:=</span>\n<span class=\"kd\">begin</span>\n  <span class=\"n\">rw</span> <span class=\"n\">smul_smul</span> <span class=\"n\">r</span> <span class=\"n\">s</span> <span class=\"n\">a</span><span class=\"o\">,</span>\n<span class=\"kd\">end</span>\n</code></pre></div>",
        "id": 266106740,
        "sender_full_name": "Christopher Hoskin",
        "timestamp": 1640520234
    },
    {
        "content": "<p><code>norm_cast</code>, <code>norm_num</code> or <a href=\"https://leanprover-community.github.io/mathlib_docs/find/int.cast_two\">docs#int.cast_two</a> should all do the job.</p>",
        "id": 266106791,
        "sender_full_name": "Yaël Dillies",
        "timestamp": 1640520302
    },
    {
        "content": "<p><a href=\"https://leanprover-community.github.io/mathlib_docs/find/smul_assoc\">docs#smul_assoc</a> should apply there</p>",
        "id": 266107634,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1640521822
    },
    {
        "content": "<p>Finally got there with:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kd\">theorem</span> <span class=\"n\">two_rmul</span> <span class=\"o\">[</span><span class=\"n\">ring</span> <span class=\"n\">α</span><span class=\"o\">]</span> <span class=\"o\">[</span><span class=\"n\">algebra</span> <span class=\"n\">ℝ</span> <span class=\"n\">α</span><span class=\"o\">]</span>  <span class=\"o\">(</span><span class=\"n\">x</span><span class=\"o\">:</span><span class=\"n\">α</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"o\">(</span><span class=\"mi\">2</span> <span class=\"o\">:</span> <span class=\"n\">ℝ</span><span class=\"o\">)</span> <span class=\"bp\">•</span> <span class=\"n\">x</span> <span class=\"bp\">=</span> <span class=\"n\">x</span> <span class=\"bp\">+</span> <span class=\"n\">x</span> <span class=\"o\">:=</span>\n<span class=\"kd\">begin</span>\n   <span class=\"n\">rw</span> <span class=\"o\">[</span><span class=\"n\">bit0</span><span class=\"o\">,</span> <span class=\"n\">add_smul</span><span class=\"o\">,</span> <span class=\"n\">one_smul</span><span class=\"o\">],</span>\n<span class=\"kd\">end</span>\n\n<span class=\"kd\">lemma</span> <span class=\"n\">powers</span> <span class=\"o\">[</span><span class=\"n\">ring</span> <span class=\"n\">α</span><span class=\"o\">]</span> <span class=\"o\">[</span><span class=\"n\">algebra</span> <span class=\"n\">ℝ</span> <span class=\"n\">α</span><span class=\"o\">]</span> <span class=\"o\">(</span><span class=\"n\">a</span><span class=\"o\">:</span> <span class=\"n\">α</span><span class=\"bp\">ˢʸᵐ</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">unsym</span><span class=\"o\">(</span><span class=\"n\">a</span><span class=\"bp\">*</span><span class=\"n\">a</span><span class=\"o\">)</span> <span class=\"bp\">=</span> <span class=\"n\">unsym</span> <span class=\"n\">a</span> <span class=\"bp\">*</span> <span class=\"n\">unsym</span> <span class=\"n\">a</span> <span class=\"o\">:=</span>\n<span class=\"kd\">begin</span>\n  <span class=\"n\">rw</span> <span class=\"n\">mul_def</span><span class=\"o\">,</span>\n  <span class=\"n\">rw</span> <span class=\"n\">unsym_sym</span><span class=\"o\">,</span>\n  <span class=\"n\">rw</span> <span class=\"bp\">←</span> <span class=\"n\">two_rmul</span><span class=\"o\">,</span>\n  <span class=\"n\">rw</span> <span class=\"bp\">←</span> <span class=\"n\">smul_assoc</span><span class=\"o\">,</span>\n  <span class=\"n\">simp</span><span class=\"o\">,</span>\n<span class=\"kd\">end</span>\n</code></pre></div>",
        "id": 266119888,
        "sender_full_name": "Christopher Hoskin",
        "timestamp": 1640541634
    },
    {
        "content": "<p>Isn't that first lemma just <a href=\"https://leanprover-community.github.io/mathlib_docs/find/two_smul\">docs#two_smul</a>?</p>",
        "id": 266130426,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1640557052
    },
    {
        "content": "<p>Catching up on this thread (and the corresponding PR <a href=\"https://github.com/leanprover-community/mathlib/pull/11073\">#11073</a>) I have a question: is there a Jordan equivalent of Poisson algebras? More precisely, is it ever necessary to be able to regard a type _simultaneously_ as a Jordan ring and an associative ring?</p>",
        "id": 266251312,
        "sender_full_name": "Oliver Nash",
        "timestamp": 1640690165
    },
    {
        "content": "<p>I couldn't quite figure out what right compatibility between the two structures would be but if these structures do arise then the proposed setup might be awkward because both operations are trying to own <code>has_mul</code>.</p>",
        "id": 266251469,
        "sender_full_name": "Oliver Nash",
        "timestamp": 1640690345
    }
]