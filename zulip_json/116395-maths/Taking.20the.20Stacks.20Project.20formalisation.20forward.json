[
    {
        "content": "<p>I formalised the definition of a scheme -- in theory at least. I proved that an affine scheme was a scheme which gave me some sort of hope that I'd formalised the definition correctly. The files are a mess, some people were never happy with the names of the theorems or the names of the lean files, the whole thing needs a tidy. I have a Masters student who <em>might</em> be interested. What are the priorities here? He'd like to prove some more lemmas about schemes (and indeed we as a department would like to see some original material). But maybe I could use this as impetus to tidy the whole thing up. Does anyone have any ideas about what could be priorities here? <span class=\"user-mention\" data-user-id=\"110031\">@Patrick Massot</span> and <span class=\"user-mention\" data-user-id=\"112680\">@Johan Commelin</span> you probably both have clearer ideas than me about where this project should be going.</p>",
        "id": 135477612,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1539098749
    },
    {
        "content": "<p>It should be going into mathlib</p>",
        "id": 135477722,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1539098841
    },
    {
        "content": "<p>with mathlib quality</p>",
        "id": 135477729,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1539098858
    },
    {
        "content": "<p>I thought you'd say that.</p>",
        "id": 135478190,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1539099280
    },
    {
        "content": "<p>And we also need progress by <span class=\"user-mention\" data-user-id=\"110087\">@Scott Morrison</span> on sheaves</p>",
        "id": 135478389,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1539099473
    },
    {
        "content": "<p>A big question here is what to do with the sheaf theory. I defined a sheaf of rings and a presheaf of sets and a sheaf of sets on a basis of a topological space and blah blah blah; do we just sit and wait for more category theory stuff or use the fact that everything is a typeclass so the low-level approach is fine? How long will it be before mathlib contains all the machinery necessary to write \"let F be a presheaf of rings on the topological space X\" in a category-theory-like manner, so I don't have to also define morphisms of presheaves?</p>",
        "id": 135478391,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1539099475
    },
    {
        "content": "<p>two minds with a single thought :-)</p>",
        "id": 135478435,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1539099484
    },
    {
        "content": "<p>This is blocking for the perfectoid project as well (also blocked by ring completions, subring issue, etc...)</p>",
        "id": 135478531,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1539099599
    },
    {
        "content": "<p>Right. I think those presheaves are pretty close. As soon as <span class=\"user-mention\" data-user-id=\"110087\">@Scott Morrison</span>'s coauthors stop being grumpy, we will get <code>backwards_reasoning</code> and then all sorts of limits. After that a bunch of stuff about sheaves will be within reach.</p>",
        "id": 135481011,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1539101918
    },
    {
        "content": "<p>I managed just fine in the schemes project with no category theory. Part of me is scared that using the category theory stuff will actually make things more complicated! And unfortunately I must be completely honest and say that I have not been paying careful attention to exactly what is there and what is not there. I know that Scott's work seems to rely on a bunch of automation and I know that these things are very complicated to get right and that I know essentially nothing which would help. I would like to contribute to Scott's work by actually trying it out in some basic cases and then asking for advice when I can't get it to work.</p>\n<p>Perhaps going back to the stacks project and doing it all again using the category-theoretic tools that we either have already or will have soon would be a good test case for this category theory stuff. I think that in particular getting the parts of category theory working which are used widely outside of pure category theory would be an important project.</p>",
        "id": 135481109,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1539102007
    },
    {
        "content": "<p>Golly so we need backwards reasoning and then limits and _then_ sheaves? Because the sheaf axiom says that some map to a limit is an isomorphism?</p>",
        "id": 135481135,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1539102047
    },
    {
        "content": "<p>Right, we need someone totally unrelated to GRU to visit Scott's collaborators towns for tourism</p>",
        "id": 135481163,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1539102100
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"110038\">@Kevin Buzzard</span> I think we should certainly try to take advantage of category theory. After all, we want étale cohomology next, and then you don't want to have live in a parallel universe where you have no category theory available...</p>",
        "id": 135481415,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1539102403
    },
    {
        "content": "<p>Johan, I cannot allow you to bad mouth Bourbaki</p>",
        "id": 135481438,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1539102466
    },
    {
        "content": "<p>What did I say wrong? <span class=\"emoji emoji-1f630\" title=\"cold sweat\">:cold_sweat:</span></p>",
        "id": 135481489,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1539102493
    },
    {
        "content": "<p>You don't like living in a parallel universe without category theory</p>",
        "id": 135481497,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1539102528
    },
    {
        "content": "<p>Bourbaki never wrote a volume on étale cohomology.</p>",
        "id": 135481512,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1539102574
    },
    {
        "content": "<p>Oh, I just received an email from Bourbaki</p>",
        "id": 135481575,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1539102605
    },
    {
        "content": "<p>But it's not about category theory</p>",
        "id": 135481614,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1539102656
    },
    {
        "content": "<blockquote>\n<p>Oh, I just received an email from Bourbaki</p>\n</blockquote>\n<p>He invites you to give a seminar talk about interactive theorem proving?</p>",
        "id": 135481632,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1539102672
    },
    {
        "content": "<p>He wants another seminar talk</p>",
        "id": 135481634,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1539102673
    },
    {
        "content": "<blockquote>\n<p>He wants another seminar talk</p>\n</blockquote>\n<p>Congratulations!</p>",
        "id": 135481640,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1539102692
    },
    {
        "content": "<p>No, unfortunately it's another topic</p>",
        "id": 135481645,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1539102696
    },
    {
        "content": "<p>Hales gave a Bourbaki seminar on proof assistants not so long ago</p>",
        "id": 135481714,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1539102744
    },
    {
        "content": "<p>so I don't think they'll want another one before seeing real progress here</p>",
        "id": 135481720,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1539102763
    },
    {
        "content": "<p><a href=\"http://www.bourbaki.ens.fr/seminaires/2014/Prog_juin14.html\" target=\"_blank\" title=\"http://www.bourbaki.ens.fr/seminaires/2014/Prog_juin14.html\">http://www.bourbaki.ens.fr/seminaires/2014/Prog_juin14.html</a></p>",
        "id": 135481745,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1539102796
    },
    {
        "content": "<p>What's funny is I wanted to write Bourbaki an email asking whether he currently think he left a gap about that completion map thing or whether he claims this is only an ellipsis</p>",
        "id": 135481892,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1539102964
    },
    {
        "content": "<p>Of course there is a risk he doesn't remember</p>",
        "id": 135481916,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1539103005
    },
    {
        "content": "<p>he wrote that GT book in 1971</p>",
        "id": 135481945,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1539103052
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"110038\">@Kevin Buzzard</span> What does \"original\" mean for a masters project? Is computing an example enough? Or do we need a new lemma? Because that will be extremely hard to do in Lean.</p>",
        "id": 135482138,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1539103227
    },
    {
        "content": "<p>Proving some basic lemmas about schemes and completely fixing up the schemes code is definitely enough.</p>",
        "id": 135482981,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1539104134
    },
    {
        "content": "<p>Oh talking of schemes, you're not going to believe this: I've been asked to give a talk on them!</p>",
        "id": 135482985,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1539104142
    },
    {
        "content": "<p><a href=\"http://aitp-conference.org/2019/\" target=\"_blank\" title=\"http://aitp-conference.org/2019/\">http://aitp-conference.org/2019/</a> :D</p>",
        "id": 135483047,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1539104208
    },
    {
        "content": "<p>So it needs to be fixed up by then!</p>",
        "id": 135483058,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1539104224
    },
    {
        "content": "<p>That's nice!</p>",
        "id": 135483616,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1539104769
    },
    {
        "content": "<p>So I suggest that this master student turns it into a project to get schemes into mathlib. And then prove the Gamma_Spec adjunction.</p>",
        "id": 135483634,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1539104809
    },
    {
        "content": "<p>Alternatively, define smooth morphisms. Or something like that.</p>",
        "id": 135483666,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1539104848
    },
    {
        "content": "<p>I'd forgotten about gamma spec adjunction! That's an excellent project</p>",
        "id": 135484086,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1539105311
    },
    {
        "content": "<p>I never even did locally ringed spaces</p>",
        "id": 135484098,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1539105332
    },
    {
        "content": "<p>Because spec of a ring is automatically locally ringed and I never defined a morphism of schemes :-)</p>",
        "id": 135484202,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1539105396
    },
    {
        "content": "<p>Right, so we need some category theory (-;</p>",
        "id": 135484402,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1539105609
    },
    {
        "content": "<p>Another non-trivial but fundamental thing: fibre products of schemes.</p>",
        "id": 135484434,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1539105640
    },
    {
        "content": "<blockquote>\n<p>\"let F be a presheaf of rings on the topological space X\"</p>\n</blockquote>\n<p>As it happens, we have this specific thing already. Not sure how far that will actually get you though.</p>\n<div class=\"codehilite\"><pre><span></span><span class=\"kn\">import</span> <span class=\"n\">category_theory</span><span class=\"bp\">.</span><span class=\"n\">opposites</span>\n<span class=\"kn\">import</span> <span class=\"n\">category_theory</span><span class=\"bp\">.</span><span class=\"n\">examples</span><span class=\"bp\">.</span><span class=\"n\">topological_spaces</span>\n<span class=\"kn\">import</span> <span class=\"n\">category_theory</span><span class=\"bp\">.</span><span class=\"n\">examples</span><span class=\"bp\">.</span><span class=\"n\">rings</span>\n\n<span class=\"kn\">open</span> <span class=\"n\">category_theory</span> <span class=\"n\">category_theory</span><span class=\"bp\">.</span><span class=\"n\">examples</span>\n\n<span class=\"kn\">variables</span> <span class=\"o\">{</span><span class=\"n\">X</span> <span class=\"o\">:</span> <span class=\"n\">Top</span><span class=\"o\">}</span> <span class=\"o\">{</span><span class=\"n\">F</span> <span class=\"o\">:</span> <span class=\"o\">(</span><span class=\"n\">open_set</span> <span class=\"n\">X</span><span class=\"o\">)</span><span class=\"err\">ᵒᵖ</span> <span class=\"err\">⥤</span> <span class=\"n\">Ring</span><span class=\"o\">}</span>\n</pre></div>",
        "id": 135488955,
        "sender_full_name": "Reid Barton",
        "timestamp": 1539110030
    },
    {
        "content": "<p>But we can't look at its stalks, right?</p>",
        "id": 135489039,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1539110081
    },
    {
        "content": "<p>except it looks like <code>open_set</code> already has the order reversed for some reason</p>",
        "id": 135489043,
        "sender_full_name": "Reid Barton",
        "timestamp": 1539110085
    },
    {
        "content": "<p>Right, basically anything past this involves either limits or colimits of some kind.</p>",
        "id": 135489065,
        "sender_full_name": "Reid Barton",
        "timestamp": 1539110105
    },
    {
        "content": "<p>I'm listening. :-) I've tried once or twice to just make my code on limits not need backwards_reasoning, but it felt pretty painful to me. <code>backwards_reasoning</code> \\ <code>back</code> is actually quite close. Simon has ideas to make it efficient, but hopefully an inefficient PR can make it into mathlib if there's a promise we know how to make it fast, later.</p>",
        "id": 135500370,
        "sender_full_name": "Scott Morrison",
        "timestamp": 1539120468
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"110032\">@Reid Barton</span>, Should I revert <code>open_set</code> to the usual definition? I guess I was just thinking \"no one ever uses the forward direction, just the opposite category, lets just cut out the middleman\".</p>",
        "id": 135500456,
        "sender_full_name": "Scott Morrison",
        "timestamp": 1539120536
    },
    {
        "content": "<p>(Perhaps the explicit opposites were causing some pain, but I don't think so.)</p>",
        "id": 135500470,
        "sender_full_name": "Scott Morrison",
        "timestamp": 1539120555
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"110087\">@Scott Morrison</span>, if the many different shapes of limit are causing some difficulty, I know that I would find it already very helpful to have just general (co)limits. Perhaps it would even be possible to do a version of these before <code>back</code> is merged (I might take another shot at this in a couple of days--I tried to set up a branch with all the limit types but it turned into too much work).</p>",
        "id": 135501687,
        "sender_full_name": "Reid Barton",
        "timestamp": 1539121998
    },
    {
        "content": "<p>Basically everything I want to formalize for locally presentable categories and model categories involves some kind of limits or colimits but a large fraction of it only needs general (co)limits (some other parts do need specific shapes like pushouts).</p>",
        "id": 135501770,
        "sender_full_name": "Reid Barton",
        "timestamp": 1539122061
    },
    {
        "content": "<p>I guess the situation for perfectoid spaces may be similar</p>",
        "id": 135501785,
        "sender_full_name": "Reid Barton",
        "timestamp": 1539122079
    },
    {
        "content": "<p>Ok, I'll keep that in mind. There are a few missing sections on equalizers and pullbacks, but I was intending to leave those out at first anyway. Really the only thing to do for the PR is deal with the dependency on <code>back</code>.</p>",
        "id": 135502648,
        "sender_full_name": "Scott Morrison",
        "timestamp": 1539123025
    },
    {
        "content": "<p>getting closer. The new <code>back</code> works fine in my limits code, now it's just a matter of copying and pasting all the sequences of rewrites <code>rewrite_search</code> finds into the source code... :-(</p>",
        "id": 135534437,
        "sender_full_name": "Scott Morrison",
        "timestamp": 1539170501
    },
    {
        "content": "<p>It's not like <code>rewrite_search</code> is going to be merged anytime soon. :-)</p>",
        "id": 135534445,
        "sender_full_name": "Scott Morrison",
        "timestamp": 1539170518
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"110087\">@Scott Morrison</span> This copy-pasting should/can be automated.</p>",
        "id": 135534730,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1539170895
    },
    {
        "content": "<p>Meh... it should be made unnecessary. :-)</p>",
        "id": 135534746,
        "sender_full_name": "Scott Morrison",
        "timestamp": 1539170917
    },
    {
        "content": "<p>Anyway, I'm really glad to hear that <code>back</code> is converging to mathlib.</p>",
        "id": 135534748,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1539170923
    },
    {
        "content": "<p>But okay, I agree.</p>",
        "id": 135534750,
        "sender_full_name": "Scott Morrison",
        "timestamp": 1539170925
    },
    {
        "content": "<p>I wrote a substitution script that takes coordinates and replacement text and patches up your file.</p>",
        "id": 135534765,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1539170952
    },
    {
        "content": "<p>We need to learn how to have tactics talk directly to VS Code.</p>",
        "id": 135534766,
        "sender_full_name": "Scott Morrison",
        "timestamp": 1539170955
    },
    {
        "content": "<p>It is a sort of poor man's diff-patch.</p>",
        "id": 135534770,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1539170963
    },
    {
        "content": "<p>command line scripts are too messy</p>",
        "id": 135534771,
        "sender_full_name": "Scott Morrison",
        "timestamp": 1539170966
    },
    {
        "content": "<p>I think Gabriel and Mario were talking about exactly this</p>",
        "id": 135534779,
        "sender_full_name": "Scott Morrison",
        "timestamp": 1539170992
    },
    {
        "content": "<p>Could <span class=\"user-mention\" data-user-id=\"110087\">@Scott Morrison</span> or someone explain why limits are difficult to formalize or require <code>back</code>? Seems like the basics are just more definitions, and everyone I have seen talking about (co)limits don't seem to expect more than that</p>",
        "id": 135560201,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1539196990
    },
    {
        "content": "<p>I think it is mostly to make <code>obviously</code> do the right thing as auto_param.</p>",
        "id": 135560302,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1539197082
    },
    {
        "content": "<p>But I'm only guessing.</p>",
        "id": 135560330,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1539197104
    },
    {
        "content": "<p>Yeah, it is mostly me being lame, and not wanting to give up my automation. Sorry for making everyone wait. I made <code>limits.lean</code> itself mathlib ready last night, and as it turned out removing the dependency on <code>rewrite_search</code> was much more painful than removing <code>back</code> would have been.</p>",
        "id": 135571576,
        "sender_full_name": "Scott Morrison",
        "timestamp": 1539209604
    },
    {
        "content": "<p>I am doing a review of the stacks project code, because this is far more interesting than all the crappy reference letter requests I have piling up and I can now legitimately claim that is part of a work project, because I have an MSc student who is going to work on it and I am speaking about it at AITP 2019.</p>",
        "id": 135727023,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1539426868
    },
    {
        "content": "<p>Are open immersions of topological spaces in mathlib?</p>",
        "id": 135727025,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1539426884
    },
    {
        "content": "<p>Basic things such as composition of two open immersions is an open immersion, that sort of thing.</p>",
        "id": 135727035,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1539426926
    },
    {
        "content": "<p>The closest that we almost have is <a href=\"https://github.com/leanprover-community/mathlib/blob/9d743bbb864234821c4ec881d4dc930ac3631838/analysis/topology/continuity.lean#L401\" target=\"_blank\" title=\"https://github.com/leanprover-community/mathlib/blob/9d743bbb864234821c4ec881d4dc930ac3631838/analysis/topology/continuity.lean#L401\">https://github.com/leanprover-community/mathlib/blob/9d743bbb864234821c4ec881d4dc930ac3631838/analysis/topology/continuity.lean#L401</a></p>",
        "id": 135727250,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1539427410
    },
    {
        "content": "<p>I want to define a locally ringed space in Lean (or rather get a student to define it). So this is a topological space plus a sheaf of rings plus an axiom about some direct limits (see <a href=\"https://stacks.math.columbia.edu/tag/01HA\" target=\"_blank\" title=\"https://stacks.math.columbia.edu/tag/01HA\">stacks project</a> for more info). I don't see that we have to wait for categories for this to happen. But when categories arrive, will this work somehow be wasted? I am assuming not. I didn't ever define a locally ringed space in the schemes repo, I dodged it, but I think I want to do things more properly this time.</p>",
        "id": 135906728,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1539703059
    },
    {
        "content": "<p>Well, what work is there? Certainly the bits to do with defining local rings and local ring maps will not be made redundant.</p>",
        "id": 135910198,
        "sender_full_name": "Reid Barton",
        "timestamp": 1539706200
    },
    {
        "content": "<p>We already have all the ingredients for presheaves of rings in mathlib.</p>",
        "id": 135910259,
        "sender_full_name": "Reid Barton",
        "timestamp": 1539706226
    },
    {
        "content": "<p>There is an oper PR which includes equalizers and products and another WIP one which constructs them for rings, so then you can define sheaves in that language. Johan seemed interested in defining sites for the perfectoid space project, and that seems like a reasonably small amount of effort to \"future-proof\" sheaves for the zariski topology</p>",
        "id": 135910412,
        "sender_full_name": "Reid Barton",
        "timestamp": 1539706400
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"110038\">@Kevin Buzzard</span> I think all the category theory will be there before your student has learned enough Lean to start working on this project.</p>",
        "id": 135910505,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1539706512
    },
    {
        "content": "<p>I think the remaining bit is to construct directed colimits of rings. Here you probably cannot avoid spending some effort which, eventually, could be superseded by some general machinery on finitary algebraic theories</p>",
        "id": 135910520,
        "sender_full_name": "Reid Barton",
        "timestamp": 1539706538
    },
    {
        "content": "<p>My student is a 4th year joint maths and computing student that spent the summer working with Coq</p>",
        "id": 135910526,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1539706548
    },
    {
        "content": "<p>The issue is that he has to learn some commutative algebra</p>",
        "id": 135910571,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1539706563
    },
    {
        "content": "<blockquote>\n<p>We already have all the ingredients for presheaves of rings in mathlib.</p>\n</blockquote>\n<p>So what does the definition of a locally ringed space look like now? It's going to be a structure consisting of a topological space, and then a presheaf of rings -- but I shouldn't define this by hand myself now? And then some lemma about a direct limit being local.</p>",
        "id": 135910634,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1539706668
    },
    {
        "content": "<p>Well, stalks are also done by Scott. This should land within a couple of weeks (at most).</p>",
        "id": 135910706,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1539706712
    },
    {
        "content": "<p>So you have to define a ring structure on the stalk. Local rings are already in mathlib.</p>",
        "id": 135910719,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1539706732
    },
    {
        "content": "<p>Stalks for sheaves of sets I guess?</p>",
        "id": 135910833,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1539706805
    },
    {
        "content": "<p>or types in this case</p>",
        "id": 135910842,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1539706809
    },
    {
        "content": "<p>Yes, exactly. That's what I meant with \"you have to define a ring structure on the stalk\". I really think that this project should try to make schemes mathlib-ready. And as corollary, use all the machinery that is (almost) available.</p>",
        "id": 135911308,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1539707270
    },
    {
        "content": "<p>And the fact that you can define a ring structure on the stalk clearly has very little to do with the specific definition of a ring.</p>",
        "id": 135912622,
        "sender_full_name": "Reid Barton",
        "timestamp": 1539708556
    },
    {
        "content": "<p>So if you do it for rings in particular, then in the long run that particular effort is \"wasted\" (in some sense)</p>",
        "id": 135912651,
        "sender_full_name": "Reid Barton",
        "timestamp": 1539708591
    },
    {
        "content": "<p>I have no idea what compiles here, but<br>\n<a href=\"https://github.com/semorrison/lean-category-theory/blob/working/src/category_theory/presheaves/locally_ringed.lean\" target=\"_blank\" title=\"https://github.com/semorrison/lean-category-theory/blob/working/src/category_theory/presheaves/locally_ringed.lean\">https://github.com/semorrison/lean-category-theory/blob/working/src/category_theory/presheaves/locally_ringed.lean</a></p>",
        "id": 135944821,
        "sender_full_name": "Scott Morrison",
        "timestamp": 1539743281
    },
    {
        "content": "<p>Certainly filtered colimits of rings is not done yet, and should be. Your student, Kevin, should do this!</p>",
        "id": 135945243,
        "sender_full_name": "Scott Morrison",
        "timestamp": 1539743922
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"110038\">@Kevin Buzzard</span> I think that it would be best to do this with categories. Now that they are there, they should be put to some use! I recall you using this as an argument in favor of category theory last time this came up</p>",
        "id": 135948225,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1539749523
    },
    {
        "content": "<p>I think that when I was trying to write the code last Feb I would just keep saying \"look these things are a category\" without ever really thinking about what advantage this would actually give me. Here's a concrete question. A locally ringed space is a topological space, a functor from the category of open sets to the category of rings, an axiom about this functor (a statement about the values of the functor on open covers of open sets -- some kernel equals some image) and another axiom about this functor (about direct limits of rings which are values of the functor being local rings). I can write all of that without ever mentioning categories, but the language (functors, direct limits) is everywhere. I am still unclear about what the modern way to define this structure is (independent of my usual confusion about what should be bundled).</p>",
        "id": 135954315,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1539759984
    },
    {
        "content": "<p>Kevin, you saw that I could extend a presheaf from a basis in 10 lines. Otoh now I'm struggling with topological bases, and it's a real pain.</p>",
        "id": 135954380,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1539760159
    },
    {
        "content": "<p>I am not reading these technical threads carefully right now, I am really snowed under. I write in the beginner threads because those are the only ones where I can understand what's going on easily and quickly. I do remember your post though. And you can do this because you defined a presheaf to be a functor?</p>",
        "id": 135954459,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1539760311
    },
    {
        "content": "<p>I can do this because of all Scott's magic. The automation takes care of a lot of painful noise.</p>",
        "id": 135954738,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1539760790
    },
    {
        "content": "<p><a href=\"#narrow/stream/116395-maths/subject/extend.20presheaf.20from.20basis/near/135546628\" title=\"#narrow/stream/116395-maths/subject/extend.20presheaf.20from.20basis/near/135546628\">https://leanprover.zulipchat.com/#narrow/stream/116395-maths/subject/extend.20presheaf.20from.20basis/near/135546628</a> (for my own reference)</p>",
        "id": 135955243,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1539761522
    },
    {
        "content": "<p><a href=\"#narrow/stream/116395-maths/subject/extend.20presheaf.20from.20basis/near/135546628\" title=\"#narrow/stream/116395-maths/subject/extend.20presheaf.20from.20basis/near/135546628\">presheaf stuff</a></p>",
        "id": 136274105,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1540221629
    },
    {
        "content": "<p>(deleted)</p>",
        "id": 136274134,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1540221660
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"112680\">@Johan Commelin</span> it's time that the people at Imperial College began to understand how presheaves work now. <span class=\"user-mention\" data-user-id=\"132858\">@Ramon Fernandez Mir</span> is hopefully going to be formalising a locally ringed space soon.</p>",
        "id": 136274294,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1540221832
    },
    {
        "content": "<p>Hello, I'm Ramon. I'm doing my Master's project with Kevin and we'll be formalising more parts of the Stacks project. As he said, I'm currently trying to formalise a locally ringed space. I was wondering where I could find the</p>\n<blockquote>\n<p><a href=\"#narrow/stream/116395-maths/subject/extend.20presheaf.20from.20basis/near/135546628\" title=\"#narrow/stream/116395-maths/subject/extend.20presheaf.20from.20basis/near/135546628\">presheaf stuff</a></p>\n</blockquote>\n<p><span class=\"user-mention\" data-user-id=\"112680\">@Johan Commelin</span></p>",
        "id": 136274857,
        "sender_full_name": "Ramon Fernandez Mir",
        "timestamp": 1540222257
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"132858\">@Ramon Fernandez Mir</span> Hi, nice to meet you! I'm pretty busy until next week Wednesday (2 guests are visiting), but after that I hope to return to this stuff. In the mean time I'll keep an I on these threads.</p>",
        "id": 136279420,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1540226784
    },
    {
        "content": "<p>So to do locally ringed spaces we need that stalks are local, so we need colimits in the category of commutative rings. If we were doing this in a category free way then I'd know what to do. How does this all work within the category theory framework? This would be a colimit over the set of all open sets containing a fixed point <code>a</code> in a topological space <code>X</code>.</p>",
        "id": 136343084,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1540307641
    },
    {
        "content": "<p>I assume you also want a specific explicit description of the stalk. So under the current/near future state of category theory in mathlib, I would suggest just doing the \"category-free\" construction, and then if it seems useful or interesting, also show that what you built is actually a colimit, i.e., fits in a cocone with the expected universal property.</p>",
        "id": 136343514,
        "sender_full_name": "Reid Barton",
        "timestamp": 1540308040
    },
    {
        "content": "<p>I guess proving that the stalk is a colimit should help you prove that a morphism of ringed spaces does induce maps on stalks, for example.</p>",
        "id": 136343663,
        "sender_full_name": "Reid Barton",
        "timestamp": 1540308186
    },
    {
        "content": "<p>But given the state of limits right now, \"should\" in that sentence is more of a design criterion for limits, not an assertion.</p>",
        "id": 136343856,
        "sender_full_name": "Reid Barton",
        "timestamp": 1540308314
    },
    {
        "content": "<p>Ah, but the <em>input</em> to the construction of a filtered (or directed) colimit of rings should already be in the category theory language.</p>",
        "id": 136345079,
        "sender_full_name": "Reid Barton",
        "timestamp": 1540309200
    },
    {
        "content": "<p>Let me check what is actually in mathlib so far...</p>",
        "id": 136345498,
        "sender_full_name": "Reid Barton",
        "timestamp": 1540309489
    },
    {
        "content": "<p>I suggest starting from here</p>\n<div class=\"codehilite\"><pre><span></span><span class=\"kn\">import</span> <span class=\"n\">category_theory</span><span class=\"bp\">.</span><span class=\"n\">functor</span>\n<span class=\"kn\">import</span> <span class=\"n\">category_theory</span><span class=\"bp\">.</span><span class=\"n\">examples</span><span class=\"bp\">.</span><span class=\"n\">rings</span>\n\n<span class=\"kn\">universe</span> <span class=\"n\">u</span>\n\n<span class=\"c\">/-</span><span class=\"cm\"> Copied from https://github.com/semorrison/lean-category-theory/blob/master/src/category_theory/filtered.lean -/</span>\n<span class=\"c\">/-</span><span class=\"cm\"> Name collides with mathlib `directed`... -/</span>\n<span class=\"n\">class</span> <span class=\"n\">directed_preorder</span> <span class=\"o\">(</span><span class=\"n\">α</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span> <span class=\"n\">u</span><span class=\"o\">)</span> <span class=\"o\">[</span><span class=\"n\">preorder</span> <span class=\"n\">α</span><span class=\"o\">]</span> <span class=\"o\">:=</span>\n<span class=\"o\">(</span><span class=\"n\">bound</span> <span class=\"o\">(</span><span class=\"n\">x₁</span> <span class=\"n\">x₂</span> <span class=\"o\">:</span> <span class=\"n\">α</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">α</span><span class=\"o\">)</span>\n<span class=\"o\">(</span><span class=\"n\">i₁</span> <span class=\"o\">(</span><span class=\"n\">x₁</span> <span class=\"n\">x₂</span> <span class=\"o\">:</span> <span class=\"n\">α</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">x₁</span> <span class=\"bp\">≤</span> <span class=\"n\">bound</span> <span class=\"n\">x₁</span> <span class=\"n\">x₂</span><span class=\"o\">)</span>\n<span class=\"o\">(</span><span class=\"n\">i₂</span> <span class=\"o\">(</span><span class=\"n\">x₁</span> <span class=\"n\">x₂</span> <span class=\"o\">:</span> <span class=\"n\">α</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">x₂</span> <span class=\"bp\">≤</span> <span class=\"n\">bound</span> <span class=\"n\">x₁</span> <span class=\"n\">x₂</span><span class=\"o\">)</span>\n\n<span class=\"kn\">open</span> <span class=\"n\">category_theory</span><span class=\"bp\">.</span><span class=\"n\">examples</span>\n\n<span class=\"n\">def</span> <span class=\"n\">directed_colimit_of_rings</span> <span class=\"o\">{</span><span class=\"n\">J</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span> <span class=\"n\">u</span><span class=\"o\">}</span> <span class=\"o\">[</span><span class=\"n\">preorder</span> <span class=\"n\">J</span><span class=\"o\">]</span> <span class=\"o\">[</span><span class=\"n\">directed_preorder</span> <span class=\"n\">J</span><span class=\"o\">]</span>\n  <span class=\"o\">(</span><span class=\"n\">F</span> <span class=\"o\">:</span> <span class=\"n\">J</span> <span class=\"err\">⥤</span> <span class=\"n\">Ring</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">Ring</span> <span class=\"o\">:=</span>\n<span class=\"n\">sorry</span>\n</pre></div>",
        "id": 136345838,
        "sender_full_name": "Reid Barton",
        "timestamp": 1540309782
    },
    {
        "content": "<p>and then also constructing morphisms in <code>Ring</code> from <code>F j</code> to <code>directed_colimit_of_rings F</code>, and checking that these are compatible with the diagram maps <code>F j -&gt; F k</code>, and then also that <code>directed_colimit_of_rings F</code> has the universal property</p>",
        "id": 136346013,
        "sender_full_name": "Reid Barton",
        "timestamp": 1540309918
    },
    {
        "content": "<p>(and possibly you want to do filtered colimits instead, though directed ones would be enough for Zariski)</p>",
        "id": 136346088,
        "sender_full_name": "Reid Barton",
        "timestamp": 1540309971
    },
    {
        "content": "<p>Then, I would suggest building the indexing category for the colimit \"opens containing <code>x</code>\" by hand, or possibly using <code>full_subcategory</code>, and check that its opposite category is filtered, and then define <code>stalk x F</code> as the <code>directed_colimit_of_rings</code> of <code>F</code> composed with the inclusion of \"opens containing <code>x</code>\" in <code>opens X</code></p>",
        "id": 136346609,
        "sender_full_name": "Reid Barton",
        "timestamp": 1540310409
    },
    {
        "content": "<p>Oh, I see that that <code>directed_preorder</code> is missing the <code>inhabited</code> constraint</p>",
        "id": 136346750,
        "sender_full_name": "Reid Barton",
        "timestamp": 1540310550
    },
    {
        "content": "<p>(I'm also not sure that <code>directed_preorder</code> should really contain data, rather than being a Prop or subsingleton)</p>",
        "id": 136346863,
        "sender_full_name": "Reid Barton",
        "timestamp": 1540310660
    },
    {
        "content": "<p>Oh thanks a lot Reid! This is all for <span class=\"user-mention\" data-user-id=\"132858\">@Ramon Fernandez Mir</span> who knows a bunch of Coq but is just starting with Lean.</p>",
        "id": 136348068,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1540311769
    },
    {
        "content": "<p>Should it be <code>H : scheme S</code> or <code>S : scheme</code>? In CS language I think this is asking whether schemes should be bundled or unbundled.</p>\n<p>Any seasoned algebraic geometer will tell you that whilst the set underlying a scheme is of key technical importance, it does not play a completely central role, unlike the set underlying a group. For example, the set underlying a scheme has a topology on it, but the topology is grotesque -- on an irreducible scheme every non-empty open set is dense, there are typically many non-closed points and so on. One essentially never uses standard useful results from topology on this topological space, a standard way to prove things about schemes is to reduce them to questions about commutative rings and then do some commutative ring theory.</p>\n<p>To give another example -- the category of schemes has products, but the underlying set of <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>S</mi><mo>×</mo><mi>T</mi></mrow><annotation encoding=\"application/x-tex\">S\\times T</annotation></semantics></math></span><span aria-hidden=\"true\" class=\"katex-html\"><span class=\"strut\" style=\"height:0.68333em;\"></span><span class=\"strut bottom\" style=\"height:0.76666em;vertical-align:-0.08333em;\"></span><span class=\"base\"><span class=\"mord mathit\" style=\"margin-right:0.05764em;\">S</span><span class=\"mbin\">×</span><span class=\"mord mathit\" style=\"margin-right:0.13889em;\">T</span></span></span></span> is essentially never the product of the underlying sets of <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>S</mi></mrow><annotation encoding=\"application/x-tex\">S</annotation></semantics></math></span><span aria-hidden=\"true\" class=\"katex-html\"><span class=\"strut\" style=\"height:0.68333em;\"></span><span class=\"strut bottom\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"base\"><span class=\"mord mathit\" style=\"margin-right:0.05764em;\">S</span></span></span></span> and <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>T</mi></mrow><annotation encoding=\"application/x-tex\">T</annotation></semantics></math></span><span aria-hidden=\"true\" class=\"katex-html\"><span class=\"strut\" style=\"height:0.68333em;\"></span><span class=\"strut bottom\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"base\"><span class=\"mord mathit\" style=\"margin-right:0.13889em;\">T</span></span></span></span>. So the kind of typeclass inference instances one sees for products of groups (<code>group G</code> and <code>group H</code> to <code>group (G x H)</code> ) is not correct for schemes.</p>\n<p>Is this evidence that schemes should be bundled? I hope I got this the right way round -- I mean put the underlying topological space as a carrier and just have a structure called <code>scheme</code>? Or is the bundle/unbundle issue about other things?</p>\n<p>We don't have much bundled stuff in mathlib. My naive understanding of what Cyril and Assia were telling us in Amsterdam was that perhaps if we did then we would begin to understand the power of unification hints. I am still very unclear about the general arguments for and against bundling, my impression is that when I ask a question of this nature the answer is often \"try both and see which works best\". But if we are to move forward with categories we'd better get the hang of bundling, right?</p>",
        "id": 156927907,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1548513738
    },
    {
        "content": "<p>I would definitely recommend \"bundled\" (<code>S : scheme</code>)</p>",
        "id": 156928424,
        "sender_full_name": "Reid Barton",
        "timestamp": 1548514759
    },
    {
        "content": "<p>The underlying set of a scheme is basically never going to have any interesting kind of structure other than that which comes from being a scheme (this is related to the underlying set not commuting with products, so that the underlying set of a group scheme is not a group, etc.)</p>",
        "id": 156928606,
        "sender_full_name": "Reid Barton",
        "timestamp": 1548515059
    },
    {
        "content": "<p>You can give <code>scheme</code> a <code>has_coe_to_sort</code> instance and write an instance for <code>(S : scheme) : topological_space S</code> so that you can still write <code>p : S</code>, <code>is_open U</code> where <code>U : set S</code>, etc.</p>",
        "id": 156928672,
        "sender_full_name": "Reid Barton",
        "timestamp": 1548515212
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"132858\">@Ramon Fernandez Mir</span> the way I set it up in my schemes repo is perhaps a bad idea. Let's bundle!</p>",
        "id": 156928876,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1548515637
    },
    {
        "content": "<p>What do we think about:</p>\n<div class=\"codehilite\"><pre><span></span><span class=\"kn\">structure</span> <span class=\"n\">scheme</span> <span class=\"o\">(</span><span class=\"n\">X</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span> <span class=\"n\">u</span><span class=\"o\">)</span> <span class=\"o\">[</span><span class=\"n\">topological_space</span> <span class=\"n\">X</span><span class=\"o\">]</span> <span class=\"o\">:=</span>\n<span class=\"o\">(</span><span class=\"n\">carrier</span>    <span class=\"o\">:</span> <span class=\"n\">locally_ringed_space</span> <span class=\"n\">X</span><span class=\"o\">)</span>\n<span class=\"o\">(</span><span class=\"n\">Haffinecov</span> <span class=\"o\">:</span>\n  <span class=\"bp\">∀</span> <span class=\"n\">x</span><span class=\"o\">,</span> <span class=\"bp\">∃</span> <span class=\"n\">U</span> <span class=\"o\">:</span> <span class=\"n\">opens</span> <span class=\"n\">X</span><span class=\"o\">,</span>\n      <span class=\"n\">x</span> <span class=\"err\">∈</span> <span class=\"n\">U</span>\n    <span class=\"bp\">∧</span> <span class=\"bp\">∃</span> <span class=\"n\">R</span> <span class=\"o\">[</span><span class=\"n\">comm_ring</span> <span class=\"n\">R</span><span class=\"o\">]</span> <span class=\"o\">(</span><span class=\"n\">OSpecR</span> <span class=\"o\">:</span> <span class=\"n\">locally_ringed_space</span> <span class=\"o\">(</span><span class=\"n\">Spec</span> <span class=\"n\">R</span><span class=\"o\">)),</span>\n      <span class=\"o\">(</span><span class=\"n\">res</span> <span class=\"n\">U</span> <span class=\"n\">carrier</span><span class=\"o\">)</span> <span class=\"err\">≅</span> <span class=\"n\">OSpecR</span><span class=\"o\">)</span>\n</pre></div>\n\n\n<p>Here <code>res</code> follows from what I was saying in <a href=\"#narrow/stream/116395-maths/topic/Subspaces.20and.20opens\" title=\"#narrow/stream/116395-maths/topic/Subspaces.20and.20opens\">https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Subspaces.20and.20opens</a> and is the only bit missing. <code>≅</code> is an isomorphism of locally ringed spaces.</p>",
        "id": 160308244,
        "sender_full_name": "Ramon Fernandez Mir",
        "timestamp": 1552066344
    },
    {
        "content": "<p>It's great to see this progressing!</p>",
        "id": 160308401,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1552066510
    },
    {
        "content": "<p>I'm a bit confused by <code>(OSpecR : locally_ringed_space (Spec R))</code></p>",
        "id": 160308436,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1552066543
    },
    {
        "content": "<p>Anyway, congrats for getting this far! Are you planning to PR stuff to mathlib?</p>",
        "id": 160308592,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1552066662
    },
    {
        "content": "<p>Does this help?</p>\n<div class=\"codehilite\"><pre><span></span><span class=\"kn\">structure</span> <span class=\"n\">locally_ringed_space</span> <span class=\"o\">(</span><span class=\"n\">X</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span> <span class=\"n\">u</span><span class=\"o\">)</span> <span class=\"o\">[</span><span class=\"n\">topological_space</span> <span class=\"n\">X</span><span class=\"o\">]</span> <span class=\"o\">:=</span>\n<span class=\"o\">(</span><span class=\"n\">OX</span>      <span class=\"o\">:</span> <span class=\"n\">sheaf_of_rings</span> <span class=\"n\">X</span><span class=\"o\">)</span>\n<span class=\"o\">(</span><span class=\"n\">Hstalks</span> <span class=\"o\">:</span> <span class=\"bp\">∀</span> <span class=\"n\">x</span><span class=\"o\">,</span> <span class=\"n\">is_local_ring</span> <span class=\"o\">(</span><span class=\"n\">stalk_of_rings</span> <span class=\"n\">OX</span><span class=\"bp\">.</span><span class=\"n\">F</span> <span class=\"n\">x</span><span class=\"o\">))</span>\n</pre></div>",
        "id": 160308601,
        "sender_full_name": "Ramon Fernandez Mir",
        "timestamp": 1552066677
    },
    {
        "content": "<p>You are asking for the existence of a locally_ringed_space structure on <code>Spec R</code>. But you don't just want that something exists...</p>",
        "id": 160308723,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1552066763
    },
    {
        "content": "<p>You want to use a carefully constructed one.</p>",
        "id": 160308736,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1552066773
    },
    {
        "content": "<p>Somewhere you must have some definition</p>\n<div class=\"codehilite\"><pre><span></span><span class=\"n\">def</span> <span class=\"n\">blah</span> <span class=\"o\">(</span><span class=\"n\">R</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span> <span class=\"n\">u</span><span class=\"o\">)</span> <span class=\"o\">[</span><span class=\"n\">comm_ring</span> <span class=\"n\">R</span><span class=\"o\">]</span> <span class=\"o\">:</span> <span class=\"n\">locally_ringed_space</span> <span class=\"o\">(</span><span class=\"n\">Spec</span> <span class=\"n\">R</span><span class=\"o\">)</span>\n</pre></div>",
        "id": 160308879,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1552066849
    },
    {
        "content": "<p>You want to use that definition here.</p>",
        "id": 160308924,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1552066869
    },
    {
        "content": "<p>Did you already formalise isomorphisms of locally ringed spaces? (Maybe even morphisms??)</p>",
        "id": 160309251,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1552067110
    },
    {
        "content": "<p>That's what I initially thought and I'm working on that definition. I thought this definition was correct though? Or is it a usability problem? Maybe my mistake is that I was just thinking about proving that an affine scheme is a scheme, which I think I can do with this definition.</p>",
        "id": 160309281,
        "sender_full_name": "Ramon Fernandez Mir",
        "timestamp": 1552067141
    },
    {
        "content": "<p>No, this definition is not correct</p>",
        "id": 160309345,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1552067173
    },
    {
        "content": "<p>It is almost correct (-;</p>",
        "id": 160309358,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1552067187
    },
    {
        "content": "<p>Also, I'm surprised Lean would be happy with <code>\\exists blabla, X \\iso Y</code></p>",
        "id": 160309384,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1552067211
    },
    {
        "content": "<p>Because <code>X \\iso Y</code> is not a <code>Prop</code>.</p>",
        "id": 160309402,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1552067223
    },
    {
        "content": "<p>So you will probably want to wrap that in a <code>nonempty</code>, or you save the isomorphism for later use, but then you can't use <code>\\exists</code>.</p>",
        "id": 160309509,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1552067286
    },
    {
        "content": "<p>That is actually my own local notation for isomorphism of locally ringed spaces. Probably should be using a different symbol, or simply <code>are_isomorphic</code>.</p>",
        "id": 160309524,
        "sender_full_name": "Ramon Fernandez Mir",
        "timestamp": 1552067301
    },
    {
        "content": "<p>The notation is fine. Just write <code>nonempty ((res _ _) \\iso (Spec R))</code></p>",
        "id": 160309614,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1552067384
    },
    {
        "content": "<p>I see I see, very useful advice. I'm glad I asked!</p>",
        "id": 160309967,
        "sender_full_name": "Ramon Fernandez Mir",
        "timestamp": 1552067609
    },
    {
        "content": "<p>But the bigger problem is the one I mentioned at the start.</p>",
        "id": 160310205,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1552067770
    },
    {
        "content": "<p>Because that one wouldn't be caught by the type checker.</p>",
        "id": 160310218,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1552067790
    },
    {
        "content": "<p>Can you prove that affine schemes are schemes?</p>",
        "id": 160310231,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1552067812
    },
    {
        "content": "<p>Where is your proof that <code>Spec R</code> is a locally ringed space?</p>",
        "id": 160310247,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1552067834
    },
    {
        "content": "<p>I am hoping to be able to prove it soon. I have been working on the machinery to do so. Of course I need the right definition of a scheme first.</p>",
        "id": 160310597,
        "sender_full_name": "Ramon Fernandez Mir",
        "timestamp": 1552068111
    },
    {
        "content": "<p>I mean that affine schemes are schemes.</p>",
        "id": 160310654,
        "sender_full_name": "Ramon Fernandez Mir",
        "timestamp": 1552068131
    },
    {
        "content": "<p>Can you prove that <code>Spec R</code> is a locally ringed space?</p>",
        "id": 160310909,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1552068362
    },
    {
        "content": "<p>I have a couple of bits missing but I should be able to. Now I think I fully understand the issue with my definition, I tried to be smart and skip a step and instead I did something dumb. In fact, proving that <code>Spec R</code> is a locally ringed space has just moved to the top of my TODO list.</p>",
        "id": 160311175,
        "sender_full_name": "Ramon Fernandez Mir",
        "timestamp": 1552068566
    },
    {
        "content": "<p>Great!</p>",
        "id": 160311633,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1552068916
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"110087\">@Scott Morrison</span> Perhaps this is the place for the discussion about using categories. I discouraged Ramon from using them because this is an MSc project with a hard deadline so we couldn't afford to be waiting for PRs or becoming involved in technical design implementation decisions -- we needed everything to be done by around now. However if we forget about this and start taking the longer view then in principle I think it's natural to want to use the category theory language going forward.</p>",
        "id": 163066733,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1554953303
    },
    {
        "content": "<p>One reason I am beginning to think that this approach has its advantages is that as you know I've had questions over the last few days of the form \"does Lean know that the category of topological rings has  limits?\" If there was a topological ring category then I could just check the predicate and see where it leads me</p>",
        "id": 163066831,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1554953462
    },
    {
        "content": "<p>I think there's a lot of duplication that is happening because of not using the category theory library, as well as lots of missing generality.</p>",
        "id": 163068246,
        "sender_full_name": "Scott Morrison",
        "timestamp": 1554955546
    },
    {
        "content": "<p>There does not need to be a proliferation of <code>equiv</code>s, and one can do (pre)sheaves of Xs for all Xs at once without any effort. Both are already problems in this definition of schemes.</p>",
        "id": 163068301,
        "sender_full_name": "Scott Morrison",
        "timestamp": 1554955599
    },
    {
        "content": "<p>I think the right way forward here is to start PRing all the zariski topology and localisation related stuff into mathlib, and as soon as general presheaves land in mathlib someone can start refactoring the (relatively small part) of the schemes code to use that style.</p>",
        "id": 163068326,
        "sender_full_name": "Scott Morrison",
        "timestamp": 1554955668
    },
    {
        "content": "<p>(I've actually just been looking through the <code>for_mathlib</code> directory of the perfectoid project... There's a lot to catch up on there!)</p>",
        "id": 163068377,
        "sender_full_name": "Scott Morrison",
        "timestamp": 1554955697
    },
    {
        "content": "<p>The reason there's a lot of stuff in there is there is that a lot of development happened recently when PRs were being slow so we made a decision to let it pile up there for now and get to the definition</p>",
        "id": 163068903,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1554956489
    },
    {
        "content": "<p>Yes.</p>",
        "id": 163068958,
        "sender_full_name": "Scott Morrison",
        "timestamp": 1554956546
    },
    {
        "content": "<p>There's a lot of infrastructure work needs doing in the perfectoid project.Tthere is also a <code>for_mathlib</code> directory in Ramon's schemes project but it's much more manageable</p>",
        "id": 163068975,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1554956587
    },
    {
        "content": "<p>I mean, everything in the schemes project should be in <code>for_mathlib</code>... :-)</p>",
        "id": 163068998,
        "sender_full_name": "Scott Morrison",
        "timestamp": 1554956622
    },
    {
        "content": "<p>Ha ha</p>",
        "id": 163069000,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1554956631
    },
    {
        "content": "<p>No. I'm completely serious.</p>",
        "id": 163069002,
        "sender_full_name": "Scott Morrison",
        "timestamp": 1554956641
    },
    {
        "content": "<p>In the (not so) long run anything that doesn't make it to mathlib will rot.</p>",
        "id": 163069051,
        "sender_full_name": "Scott Morrison",
        "timestamp": 1554956668
    },
    {
        "content": "<p>Now it's been done in the correct generality I think there's a much more powerful argument for this .</p>",
        "id": 163069054,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1554956677
    },
    {
        "content": "<p>I think <code>for_mathlib</code> directories should be used to mean \"ready for mathlib\" (I just need to find some time to cut some PRs).</p>",
        "id": 163069083,
        "sender_full_name": "Scott Morrison",
        "timestamp": 1554956716
    },
    {
        "content": "<p>We cut corners initially; starting again from scratch enabled me to ensure that things were constructed properly this time</p>",
        "id": 163069098,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1554956747
    },
    {
        "content": "<p>And everything else is \"not ready for mathlib\" rather than \"not intended for mathlib\".</p>",
        "id": 163069104,
        "sender_full_name": "Scott Morrison",
        "timestamp": 1554956759
    },
    {
        "content": "<p>For example we have locally ringed spaces</p>",
        "id": 163069111,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1554956762
    },
    {
        "content": "<p>The development is done in a much more mathlibby style</p>",
        "id": 163069157,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1554956802
    },
    {
        "content": "<p>The correct objects are defined rather than corners being cut</p>",
        "id": 163069169,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1554956839
    },
    {
        "content": "<p>In stark contrast to the perfectoid project :P</p>",
        "id": 163069181,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1554956873
    },
    {
        "content": "<p>Hi, sorry I didn't reply on the other thread. I won't be able to do much in the following month or so as I have exams. However, I agree with <span class=\"user-mention\" data-user-id=\"110087\">@Scott Morrison</span> that in order to eventually have schemes in the mathlib we need to use <a href=\"https://github.com/leanprover-community/mathlib/pull/886\" target=\"_blank\" title=\"https://github.com/leanprover-community/mathlib/pull/886\">#886</a> and related. Since there are still a few pieces missing and I have to submit everything in two months, I don't think it's a good idea for me to start refactoring sheaves but I quite like the idea of PRing everything else and making the schemes repository as small as possible.</p>",
        "id": 163200175,
        "sender_full_name": "Ramon Fernandez Mir",
        "timestamp": 1555082683
    },
    {
        "content": "<p>That sounds like a reasonable plan.</p>",
        "id": 163203231,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1555084844
    },
    {
        "content": "<p>OK so over the last day or two I had a good look at what Ramon has done. One reason I did this was that we need sheaves for the perfectoid project, and I really wanted to use categories, but I find it very hard to make them work because of (a) universe issues (b) the fact that much of the relevant stuff is not yet in mathlib (which breaks update-mathlib which breaks my workflow). Talking about this to Johan (who has had more experience using the category theory repo than me) he says that I'm trying to use it too quickly, and getting a solid API is even more crucial than when using non-category theory Lean.  </p>\n<p>I have come to the conclusion that I shouldn't be running before I can walk. So <span class=\"user-mention\" data-user-id=\"110087\">@Scott Morrison</span> <span class=\"user-mention\" data-user-id=\"112680\">@Johan Commelin</span> <span class=\"user-mention\" data-user-id=\"110032\">@Reid Barton</span> <span class=\"user-mention\" data-user-id=\"110049\">@Mario Carneiro</span> here is my current proposal. <span class=\"user-mention\" data-user-id=\"132858\">@Ramon Fernandez Mir</span> has made what looks to me like a very solid repo</p>\n<p><a href=\"https://github.com/ramonfmir/lean-scheme\" target=\"_blank\" title=\"https://github.com/ramonfmir/lean-scheme\">https://github.com/ramonfmir/lean-scheme</a></p>\n<p>where he defines schemes and locally ringed spaces, and proves that an affine scheme is a scheme. He did not use category theory stuff at all. The code is an order of magnitude better than the code that Chris Kenny and I wrote when we were beginners. Most or all of my poor design decisions have been fixed. A crucial role is played by <span class=\"user-mention\" data-user-id=\"130308\">@Neil Strickland</span> 's localisation predicate (which Ramon has now turned into a proper API, because he has had to use it extensively in the code). </p>\n<p>The \"next\" results in the development of schemes are: to define a morphism of locally ringed spaces, and to prove that Spec: comm_ring -&gt; locally ringed spaces and Gamma: locally ringed spaces -&gt; comm_ring are adjoint functors. I am confident that Ramon's code will be good enough to make a non-category-theory proof of this. But the very statement of this is more naturally expressed in category theory language.</p>\n<p>So it seems to me that a <em>better</em> test than the perfectoid repo, for seeing if categories are, or could be, made usable in Lean in the future (and I am optimistic that they can be), is to see if we can do some or all of the following things:</p>\n<p>1) prove the Gamma-Spec adjunction within the language of category theory, in Lean.</p>\n<p>2) replace Ramon's \"hand-coded\" sheaves of types and rings with category sheaves of types and rings</p>\n<p>3) replace Ramon's \"sheaf on a basis\" with a category-theoretical approach</p>\n<p>This to me looks like a substantial task. However what I am <em>hoping</em> is that actually rather than having to completely refactor the repo, we can actually incrementally build upon it, replacing definitions one by one. Doing this will show us actually whether things like total code length is going down or up when the category theory language is used. </p>\n<p>I am wondering whether the fact that the code is already there in non-categorified form will somehow make experiments here easier than having to develop the theory from first principles. This is what my interpretation of Johan's API comment is. Johan -- if we have made all the definitions and proved all the theorems already, how easy will it be to make new definitions and prove new theorems using the category theory language? I think this will be a good test for the category theory stuff.</p>\n<p>I am in no hurry to do this project, and Ramon now has to worry about other things such as passing his exams and writing up a pdf document about his project. But it seems to me to be a good practical application of all this category theory language and it might shed some light on things like design decisions. For example it occurred to me when trying to use categories within perfectoids that I really had lost all sight of the reason that I was trying to be maximally universe polymorphic. I had objects living in universe u and morphism sets Hom(X,Y) living in universe v. Why? I have no idea. All the other people using perfectoid spaces have objects living in Type and morphisms living in Type. Every example of a perfectoid space we will ever make, will live in Type, as far as I can see. At the very least Scott and I realised that perhaps we should have objects in <code>Obj : Type u+1</code> and morphisms in <code>Hom X Y : Type u</code> (have I got this the right way round?). These \"large categories\" (if I've got it right) might make universes more manageable. The way I have started to think about them is like this: imagine I'm doing this stuff in ZFC (which was the way I always used to think about them). Where do the objects live there? Now call the ZFC universe u and see what happens. In particular I am suggesting that, just like the way Lean defines the reals to be a term of type Type rather than Type u, we define \"concrete\" categories such as the category of perfectoid spaces or the category of locally ringed spaces to only have one free universe variable rather than two. Even the category of sheaves of rings on a topological space -- I am now arguing that the rings should be in the same universe as the topological space, because that's how it actually works in maths and for the categories that come up in regular maths this doesn't seem to be an issue. I wish I knew more about e.g. Lurie's work on (infinity,1) categories to know whether this will be an issue. Reid do you have any comments on this?</p>",
        "id": 163580117,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1555520436
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"110087\">@Scott Morrison</span> <span class=\"user-mention\" data-user-id=\"132858\">@Ramon Fernandez Mir</span> <span class=\"user-mention\" data-user-id=\"110032\">@Reid Barton</span> <span class=\"user-mention\" data-user-id=\"110064\">@Kenny Lau</span>  <span class=\"user-mention\" data-user-id=\"110044\">@Chris Hughes</span>  I finally understand branches. Here is the challenge. Ramon has made a <a href=\"https://github.com/ramonfmir/lean-scheme\" target=\"_blank\" title=\"https://github.com/ramonfmir/lean-scheme\">schemes repository</a> which defines schemes and locally ringed spaces, and has proved that affine schemes are schemes. There are I think two interesting coding challenges with taking this project forward:</p>\n<p>1) Prove that projective 1-space is a scheme. This would be our first non-affine scheme. Kenny -- this might be a neat project after exams. <br>\n2) Completely rip out Ramon's sheaves code and replace it with Scott's category theory code. Scott -- let's make your code work as well as we can, to solve real world problems in pure maths formalization.</p>\n<p>I finally understand now that we should be doing something like -- first figuring out how to host such a project, and then just running with our own branch of mathlib -- or fork, or whatever the terminology is.</p>\n<p><span class=\"user-mention\" data-user-id=\"110172\">@Assia Mahboubi</span> <span class=\"user-mention\" data-user-id=\"110193\">@Cyril Cohen</span> <br>\nHas anyone ever defined schemes in Coq? If so, did they use category theory or not? Do we have anything to learn from any Coq experiences in these areas?</p>\n<p>PS Does it matter in which order one tries (1) and (2)?</p>",
        "id": 163824060,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1555802863
    },
    {
        "content": "<p>The two developments could run in parallel and we could see which worked best.</p>",
        "id": 163824327,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1555803294
    },
    {
        "content": "<p>The goal would be to define the category of locally ringed spaces in a way which looked presentable to a mathematician.</p>",
        "id": 163824347,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1555803341
    },
    {
        "content": "<p>And I personally would be fine if its type were just <code>Type</code> or <code>Type 3</code> or however high you have to go to make my life easy.</p>",
        "id": 163824401,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1555803397
    },
    {
        "content": "<p>I don't care about universes</p>",
        "id": 163824402,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1555803408
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"132858\">@Ramon Fernandez Mir</span> can you get your objects and morphisms all defined within <code>Type</code>?  I should just try it myself -- I'm compiling.</p>",
        "id": 163824793,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1555804166
    },
    {
        "content": "<p>Hey, I still need to clean up the repository a bit to make it properly usable but should be ready soon. I still haven't looked into the potential universe issues we talked about. My impression is that they should be manageable. Is everything within one universe what we want?</p>\n<p>Also, my ideal is to PR a fair amount of it to the mathlib, mainly the localization predicate and basic facts about Spec(R) (where should these go btw?).</p>\n<p>Regarding the projective line, I'd really like to have it there before my deadline. We currently have two examples: the empty scheme :-))) and affine schemes. But I feel like three is a much nicer number. How hard do we think it'll be? Hopefully reasonably easy, right? I'd be happy to do it with you Kenny if it's something you'd be interested in.</p>",
        "id": 163826218,
        "sender_full_name": "Ramon Fernandez Mir",
        "timestamp": 1555806656
    },
    {
        "content": "<p>I know for sure that in the category of ZFC locally ringed spaces, the objects are all topological spaces equipped with some extra structure and hence the objects of the ZFC category form a proper class, which is the ZFC version of <code>Obj : Type 1</code>. However for any two objects <code>X</code> and <code>Y</code> of the category, <code>Mor X Y</code> has is a set, so <code>\\Pi (X Y : Obj),Mor X Y : Type</code>.  I would be perfectly happy to make the category of locally ringed spaces in these restricted universe situations using either Scott's or Ramon's development. I have still not seen a convincing argument for why I as a pure mathematician should care about universes so I would like to push this until I do.</p>",
        "id": 163826343,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1555806866
    },
    {
        "content": "<p>I'm really excited about these developments. <span class=\"user-mention\" data-user-id=\"132858\">@Ramon Fernandez Mir</span> I'm looking forward to a boatload of PRs from your side (-;<br>\nConcerning stress tests: I think the Gamma-Spec adjunction should be at the top of the list. Once we have that one under our belt, I think that constructing P^n (via charts, or maybe via Proj) is a good second step. After that we should prove that P^n is proper over the base scheme. Once we have those, I think it is safe to say that \"we can start doing algebraic geometry\".</p>",
        "id": 163964998,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1555999943
    },
    {
        "content": "<p>Everything has gone really quiet here. <span class=\"user-mention\" data-user-id=\"132858\">@Ramon Fernandez Mir</span> the last commit was 2 months ago. I'm sorry, I've been really busy. Did you see this <a href=\"https://twitter.com/AnthonyBordg/status/1168865159374393345?s=20\" target=\"_blank\" title=\"https://twitter.com/AnthonyBordg/status/1168865159374393345?s=20\">https://twitter.com/AnthonyBordg/status/1168865159374393345?s=20</a> ? Affine schemes were done in Coq in 2003.</p>\n<div class=\"inline-preview-twitter\"><div class=\"twitter-tweet\"><a href=\"https://twitter.com/AnthonyBordg/status/1168865159374393345?s=20\" target=\"_blank\"><img class=\"twitter-avatar\" src=\"https://pbs.twimg.com/profile_images/942154166667014145/mGdwn2br_normal.jpg\"></a><p><a href=\"https://twitter.com/XenaProject\" target=\"_blank\" title=\"https://twitter.com/XenaProject\">@XenaProject</a> Dear Xena,\n\nsheaves and affine schemes were formalized using Coq in Laurent Chicli's PhD thesis defended in 2003.\n<a href=\"https://t.co/wEmguD5Iev\" target=\"_blank\" title=\"https://t.co/wEmguD5Iev\">http://www-sop.inria.fr/lemme/Laurent.Chicli/index.html</a></p><span>- Anthony Bordg (@AnthonyBordg)</span></div></div>",
        "id": 174851092,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1567572448
    },
    {
        "content": "<p>There seems to be quite a lot of stuff here: <a href=\"https://www-sop.inria.fr/lemme/personnel/Laurent.Chicli/FrCoq.html\" target=\"_blank\" title=\"https://www-sop.inria.fr/lemme/personnel/Laurent.Chicli/FrCoq.html\">https://www-sop.inria.fr/lemme/personnel/Laurent.Chicli/FrCoq.html</a></p>",
        "id": 174853904,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1567577042
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"110031\">@Patrick Massot</span> at a glance, do they have anything we don't have?</p>",
        "id": 174853954,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1567577091
    },
    {
        "content": "<p>They seem to have sheaves on sites...</p>",
        "id": 174853975,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1567577109
    },
    {
        "content": "<p>It's annoying that the underlined thingies aren't actually hyperlinks</p>",
        "id": 174854054,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1567577165
    },
    {
        "content": "<p>This page kind of suggest he formalized some Grothendieck topology (he mentions \"cribles\") although I don't see how that's relevant to the definition of Spec.</p>",
        "id": 174859185,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1567583562
    },
    {
        "content": "<p>What is much clearer is has been abandoned software since 2002. The author left academia and his work is not even on <a href=\"https://coq.inria.fr/opam/www/\" target=\"_blank\" title=\"https://coq.inria.fr/opam/www/\">https://coq.inria.fr/opam/www/</a></p>",
        "id": 174859213,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1567583627
    },
    {
        "content": "<p>Actually I can't find those files anywhere on the internet. I think this is yet another example yelling at us: <span class=\"user-mention\" data-user-id=\"132858\">@Ramon Fernandez Mir</span> should PR his work to mathlib!</p>",
        "id": 174859310,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1567583734
    }
]