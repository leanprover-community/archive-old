[
    {
        "content": "<p>Hi everyone. I am hoping to prove something about a problem I have concerning financial contagion (more prosaically interbank debt valuation). In particular I would like to prove that given my set-up a solution exists and is unique. I have managed to convince myself that it's true but the argument is pretty messy. What I'd like to ask is whether there is some mathlib theory currently unknown to me in which it could all be expressed (and resolved) more nicely. Or if not, what such a theory  might look like.</p>\n<p>For example, in my initial attempts I have expressed continuity of a function using definitions from topology.basic. But it looks as if there are other ways to posit a continuous function in mathlib (or even a function which, like this one, solves a PDE). Perhaps one of them might be more appropriate? I'll post some code now.</p>",
        "id": 203492812,
        "sender_full_name": "Alistair Tucker",
        "timestamp": 1594377915
    },
    {
        "content": "<p>The set of banks I call β. Goings-on in the real economy are communicated as a path in 'asset space' X. Various chunks of debt may have various maturities τ up to some final time T. Given ψ specifying the set of surviving banks as a function of asset space, we construct the full solution using induction and the PDE-solving operator ℋ.</p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"kn\">import</span> <span class=\"n\">topology</span><span class=\"bp\">.</span><span class=\"n\">instances</span><span class=\"bp\">.</span><span class=\"n\">real</span>\n\n<span class=\"bp\">@</span><span class=\"o\">[</span><span class=\"n\">derive</span> <span class=\"n\">decidable_eq</span><span class=\"o\">]</span> <span class=\"kn\">inductive</span> <span class=\"n\">β</span> <span class=\"bp\">|</span><span class=\"n\">BARC</span> <span class=\"bp\">|</span><span class=\"n\">HSBC</span> <span class=\"bp\">|</span><span class=\"n\">LLOY</span> <span class=\"bp\">|</span><span class=\"n\">NATW</span> <span class=\"bp\">|</span><span class=\"n\">RBSG</span> <span class=\"bp\">|</span><span class=\"n\">SANT</span> <span class=\"bp\">|</span><span class=\"n\">STDCH</span>\n\n<span class=\"n\">def</span> <span class=\"n\">X</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span> <span class=\"o\">:=</span> <span class=\"n\">β</span> <span class=\"bp\">→</span> <span class=\"n\">ℝ</span>\n<span class=\"kn\">instance</span> <span class=\"o\">:</span> <span class=\"n\">has_add</span> <span class=\"n\">X</span> <span class=\"o\">:=</span> <span class=\"k\">by</span> <span class=\"o\">{</span> <span class=\"n\">dunfold</span> <span class=\"n\">X</span><span class=\"o\">,</span> <span class=\"n\">apply_instance</span><span class=\"o\">,</span> <span class=\"o\">}</span>\n<span class=\"kn\">instance</span> <span class=\"o\">:</span> <span class=\"n\">has_coe</span> <span class=\"n\">ℝ</span> <span class=\"n\">X</span> <span class=\"o\">:=</span> <span class=\"bp\">⟨λ</span> <span class=\"n\">r</span> <span class=\"n\">i</span><span class=\"o\">,</span> <span class=\"n\">r</span><span class=\"bp\">⟩</span>\n<span class=\"n\">noncomputable</span> <span class=\"kn\">instance</span> <span class=\"o\">:</span> <span class=\"n\">topological_space</span> <span class=\"n\">X</span> <span class=\"o\">:=</span> <span class=\"k\">by</span> <span class=\"o\">{</span> <span class=\"n\">dunfold</span> <span class=\"n\">X</span><span class=\"o\">,</span> <span class=\"n\">apply_instance</span><span class=\"o\">,</span> <span class=\"o\">}</span>\n\n<span class=\"n\">def</span> <span class=\"n\">Tt</span> <span class=\"o\">(</span><span class=\"n\">T</span> <span class=\"o\">:</span> <span class=\"n\">with_top</span> <span class=\"n\">ℝ</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">set</span> <span class=\"n\">ℝ</span> <span class=\"o\">:=</span> <span class=\"o\">{</span><span class=\"n\">t</span> <span class=\"o\">:</span> <span class=\"n\">ℝ</span> <span class=\"bp\">|</span> <span class=\"mi\">0</span> <span class=\"bp\">≤</span> <span class=\"n\">t</span> <span class=\"bp\">∧</span> <span class=\"o\">(</span><span class=\"n\">t</span> <span class=\"o\">:</span> <span class=\"n\">with_top</span> <span class=\"n\">ℝ</span><span class=\"o\">)</span> <span class=\"bp\">&lt;</span> <span class=\"n\">T</span><span class=\"o\">}</span>\n<span class=\"n\">def</span> <span class=\"n\">Tτ</span> <span class=\"o\">{</span><span class=\"n\">T</span> <span class=\"o\">:</span> <span class=\"n\">with_top</span> <span class=\"n\">ℝ</span><span class=\"o\">}</span> <span class=\"o\">(</span><span class=\"n\">t</span> <span class=\"o\">:</span> <span class=\"n\">Tt</span> <span class=\"n\">T</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">set</span> <span class=\"n\">ℝ</span> <span class=\"o\">:=</span> <span class=\"o\">{</span><span class=\"n\">τ</span> <span class=\"o\">:</span> <span class=\"n\">ℝ</span> <span class=\"bp\">|</span> <span class=\"n\">t</span><span class=\"bp\">.</span><span class=\"mi\">1</span> <span class=\"bp\">&lt;</span> <span class=\"n\">τ</span> <span class=\"bp\">∧</span> <span class=\"o\">(</span><span class=\"n\">τ</span> <span class=\"o\">:</span> <span class=\"n\">with_top</span> <span class=\"n\">ℝ</span><span class=\"o\">)</span> <span class=\"bp\">≤</span> <span class=\"n\">T</span><span class=\"o\">}</span>\n\n<span class=\"n\">def</span> <span class=\"n\">debt_fn</span> <span class=\"o\">(</span><span class=\"n\">T</span> <span class=\"o\">:</span> <span class=\"n\">with_top</span> <span class=\"n\">ℝ</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span><span class=\"bp\">*</span> <span class=\"o\">:=</span> <span class=\"bp\">Π</span> <span class=\"o\">(</span><span class=\"n\">t</span> <span class=\"o\">:</span> <span class=\"n\">Tt</span> <span class=\"n\">T</span><span class=\"o\">),</span> <span class=\"n\">X</span> <span class=\"bp\">→</span> <span class=\"n\">β</span> <span class=\"bp\">→</span> <span class=\"n\">Tτ</span> <span class=\"n\">t</span> <span class=\"bp\">→</span> <span class=\"n\">ℝ</span>\n\n<span class=\"kn\">open</span> <span class=\"n\">pfun</span>\n\n<span class=\"kn\">variable</span> <span class=\"o\">{</span><span class=\"n\">T</span> <span class=\"o\">:</span> <span class=\"n\">with_top</span> <span class=\"n\">ℝ</span><span class=\"o\">}</span>\n<span class=\"kn\">variable</span> <span class=\"n\">ℋ</span> <span class=\"o\">:</span> <span class=\"o\">(</span><span class=\"bp\">Π</span> <span class=\"n\">t</span> <span class=\"o\">:</span> <span class=\"n\">Tt</span> <span class=\"n\">T</span><span class=\"o\">,</span> <span class=\"n\">X</span> <span class=\"bp\">→.</span> <span class=\"n\">Tτ</span> <span class=\"n\">t</span> <span class=\"bp\">→</span> <span class=\"n\">ℝ</span><span class=\"o\">)</span> <span class=\"bp\">→</span> <span class=\"o\">(</span><span class=\"bp\">Π</span> <span class=\"n\">t</span> <span class=\"o\">:</span> <span class=\"n\">Tt</span> <span class=\"n\">T</span><span class=\"o\">,</span> <span class=\"n\">X</span> <span class=\"bp\">→</span> <span class=\"n\">Tτ</span> <span class=\"n\">t</span> <span class=\"bp\">→</span> <span class=\"n\">ℝ</span><span class=\"o\">)</span>\n\n<span class=\"n\">def</span> <span class=\"n\">v_mk</span> <span class=\"o\">(</span><span class=\"n\">b</span> <span class=\"o\">:</span> <span class=\"n\">finset</span> <span class=\"n\">β</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">ψb</span> <span class=\"o\">:</span> <span class=\"n\">Tt</span> <span class=\"n\">T</span> <span class=\"bp\">→</span> <span class=\"n\">X</span> <span class=\"bp\">→</span> <span class=\"n\">finset</span> <span class=\"n\">β</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">v</span> <span class=\"o\">:</span> <span class=\"bp\">Π</span> <span class=\"n\">c</span> <span class=\"bp\">&lt;</span> <span class=\"n\">b</span><span class=\"o\">,</span> <span class=\"n\">debt_fn</span> <span class=\"n\">T</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">debt_fn</span> <span class=\"n\">T</span> <span class=\"o\">:=</span>\n<span class=\"bp\">λ</span> <span class=\"n\">t</span> <span class=\"n\">y</span> <span class=\"n\">i</span><span class=\"o\">,</span> <span class=\"n\">ite</span> <span class=\"o\">(</span><span class=\"n\">i</span> <span class=\"err\">∈</span> <span class=\"n\">b</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">ℋ</span> <span class=\"o\">(</span><span class=\"bp\">λ</span> <span class=\"n\">s</span> <span class=\"n\">x</span><span class=\"o\">,</span> <span class=\"bp\">⟨</span><span class=\"n\">ψb</span> <span class=\"n\">s</span> <span class=\"n\">x</span> <span class=\"bp\">&lt;</span> <span class=\"n\">b</span><span class=\"o\">,</span> <span class=\"o\">(</span><span class=\"bp\">λ</span> <span class=\"n\">h</span><span class=\"o\">,</span> <span class=\"n\">v</span> <span class=\"o\">(</span><span class=\"n\">ψb</span> <span class=\"n\">s</span> <span class=\"n\">x</span><span class=\"o\">)</span> <span class=\"n\">h</span> <span class=\"n\">s</span> <span class=\"n\">x</span> <span class=\"n\">i</span><span class=\"o\">)</span><span class=\"bp\">⟩</span><span class=\"o\">)</span> <span class=\"n\">t</span> <span class=\"n\">y</span><span class=\"o\">)</span> <span class=\"mi\">0</span>\n\n<span class=\"n\">def</span> <span class=\"n\">v</span> <span class=\"o\">(</span><span class=\"n\">ψ</span> <span class=\"o\">:</span> <span class=\"n\">finset</span> <span class=\"n\">β</span> <span class=\"bp\">→</span> <span class=\"n\">Tt</span> <span class=\"n\">T</span> <span class=\"bp\">→</span> <span class=\"n\">X</span> <span class=\"bp\">→</span> <span class=\"n\">finset</span> <span class=\"n\">β</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">finset</span> <span class=\"n\">β</span> <span class=\"bp\">→</span> <span class=\"n\">debt_fn</span> <span class=\"n\">T</span> <span class=\"o\">:=</span>\n<span class=\"bp\">λ</span> <span class=\"n\">a</span><span class=\"o\">,</span> <span class=\"n\">finset</span><span class=\"bp\">.</span><span class=\"n\">strong_induction_on</span> <span class=\"n\">a</span> <span class=\"o\">(</span><span class=\"bp\">λ</span> <span class=\"n\">b</span> <span class=\"n\">v</span><span class=\"o\">,</span> <span class=\"n\">v_mk</span> <span class=\"n\">ℋ</span> <span class=\"n\">b</span> <span class=\"o\">(</span><span class=\"n\">ψ</span> <span class=\"n\">b</span><span class=\"o\">)</span> <span class=\"n\">v</span><span class=\"o\">)</span>\n</code></pre></div>",
        "id": 203492849,
        "sender_full_name": "Alistair Tucker",
        "timestamp": 1594377961
    },
    {
        "content": "<p>These are the properties of ℋ that I believe to be relevant. The first argument v' to ℋ communicates boundary conditions. In fact I have defined it not only at the boundary but over the whole of the complement of the PDE's domain. I also make use of an 'equity valuation function' E^* taking the set of debt valuations as an argument. The idea is that where one of its components falls below zero a bank will have failed.</p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"n\">class</span> <span class=\"n\">well_behaved_soln</span> <span class=\"o\">:</span> <span class=\"kt\">Prop</span> <span class=\"o\">:=</span>\n<span class=\"o\">(</span><span class=\"n\">matches_on_complement</span> <span class=\"o\">(</span><span class=\"n\">v&#39;</span> <span class=\"o\">:</span> <span class=\"bp\">Π</span> <span class=\"n\">t</span><span class=\"o\">,</span> <span class=\"n\">X</span> <span class=\"bp\">→.</span> <span class=\"n\">Tτ</span> <span class=\"n\">t</span> <span class=\"bp\">→</span> <span class=\"n\">ℝ</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"bp\">∀</span> <span class=\"n\">t</span> <span class=\"n\">y</span> <span class=\"n\">h</span><span class=\"o\">,</span> <span class=\"n\">ℋ</span> <span class=\"n\">v&#39;</span> <span class=\"n\">t</span> <span class=\"n\">y</span> <span class=\"bp\">=</span> <span class=\"n\">fn</span> <span class=\"o\">(</span><span class=\"n\">v&#39;</span> <span class=\"n\">t</span><span class=\"o\">)</span> <span class=\"n\">y</span> <span class=\"n\">h</span><span class=\"o\">)</span>\n<span class=\"o\">(</span><span class=\"n\">positivity_preserving</span> <span class=\"o\">(</span><span class=\"n\">v&#39;</span> <span class=\"o\">:</span> <span class=\"bp\">Π</span> <span class=\"n\">t</span><span class=\"o\">,</span> <span class=\"n\">X</span> <span class=\"bp\">→.</span> <span class=\"n\">Tτ</span> <span class=\"n\">t</span> <span class=\"bp\">→</span> <span class=\"n\">ℝ</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"o\">(</span><span class=\"bp\">∀</span> <span class=\"n\">t</span> <span class=\"n\">y</span> <span class=\"n\">h</span><span class=\"o\">,</span> <span class=\"mi\">0</span> <span class=\"bp\">≤</span> <span class=\"n\">fn</span> <span class=\"o\">(</span><span class=\"n\">v&#39;</span> <span class=\"n\">t</span><span class=\"o\">)</span> <span class=\"n\">y</span> <span class=\"n\">h</span><span class=\"o\">)</span> <span class=\"bp\">→</span> <span class=\"mi\">0</span> <span class=\"bp\">≤</span> <span class=\"n\">ℋ</span> <span class=\"n\">v&#39;</span><span class=\"o\">)</span>\n<span class=\"o\">(</span><span class=\"n\">continuity_preserving</span> <span class=\"o\">(</span><span class=\"n\">v&#39;</span> <span class=\"o\">:</span> <span class=\"bp\">Π</span> <span class=\"n\">t</span><span class=\"o\">,</span> <span class=\"n\">X</span> <span class=\"bp\">→.</span> <span class=\"n\">Tτ</span> <span class=\"n\">t</span> <span class=\"bp\">→</span> <span class=\"n\">ℝ</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"bp\">∀</span> <span class=\"n\">t</span><span class=\"o\">,</span> <span class=\"n\">pcontinuous</span> <span class=\"o\">(</span><span class=\"n\">v&#39;</span> <span class=\"n\">t</span><span class=\"o\">)</span> <span class=\"bp\">→</span> <span class=\"n\">continuous</span> <span class=\"o\">(</span><span class=\"n\">ℋ</span> <span class=\"n\">v&#39;</span> <span class=\"n\">t</span><span class=\"o\">))</span>\n<span class=\"o\">(</span><span class=\"n\">translation_invariant</span> <span class=\"o\">(</span><span class=\"n\">v&#39;</span> <span class=\"o\">:</span> <span class=\"bp\">Π</span> <span class=\"n\">t</span><span class=\"o\">,</span> <span class=\"n\">X</span> <span class=\"bp\">→.</span> <span class=\"n\">Tτ</span> <span class=\"n\">t</span> <span class=\"bp\">→</span> <span class=\"n\">ℝ</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">o</span> <span class=\"o\">:</span> <span class=\"n\">β</span> <span class=\"bp\">→</span> <span class=\"n\">ℝ</span><span class=\"o\">)</span> <span class=\"o\">:</span>\n  <span class=\"bp\">∀</span> <span class=\"n\">t</span> <span class=\"n\">y</span><span class=\"o\">,</span> <span class=\"n\">ℋ</span> <span class=\"n\">v&#39;</span> <span class=\"n\">t</span> <span class=\"o\">(</span><span class=\"n\">y</span> <span class=\"bp\">+</span> <span class=\"n\">o</span><span class=\"o\">)</span> <span class=\"bp\">=</span> <span class=\"n\">ℋ</span> <span class=\"o\">(</span><span class=\"bp\">λ</span> <span class=\"n\">s</span> <span class=\"n\">x</span><span class=\"o\">,</span> <span class=\"bp\">⟨</span><span class=\"n\">x</span> <span class=\"bp\">+</span> <span class=\"n\">o</span> <span class=\"err\">∈</span> <span class=\"n\">dom</span> <span class=\"o\">(</span><span class=\"n\">v&#39;</span> <span class=\"n\">s</span><span class=\"o\">),</span> <span class=\"o\">(</span><span class=\"bp\">λ</span> <span class=\"n\">h</span><span class=\"o\">,</span> <span class=\"n\">fn</span> <span class=\"o\">(</span><span class=\"n\">v&#39;</span> <span class=\"n\">s</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">x</span> <span class=\"bp\">+</span> <span class=\"n\">o</span><span class=\"o\">)</span> <span class=\"n\">h</span><span class=\"o\">)</span><span class=\"bp\">⟩</span><span class=\"o\">)</span> <span class=\"n\">t</span> <span class=\"n\">y</span><span class=\"o\">)</span>\n<span class=\"o\">(</span><span class=\"n\">compatible_on_subsets</span> <span class=\"o\">(</span><span class=\"n\">v&#39;</span> <span class=\"o\">:</span> <span class=\"bp\">Π</span> <span class=\"n\">t</span><span class=\"o\">,</span> <span class=\"n\">X</span> <span class=\"bp\">→.</span> <span class=\"n\">Tτ</span> <span class=\"n\">t</span> <span class=\"bp\">→</span> <span class=\"n\">ℝ</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">V</span> <span class=\"o\">:</span> <span class=\"n\">Tt</span> <span class=\"n\">T</span> <span class=\"bp\">→</span> <span class=\"n\">set</span> <span class=\"n\">X</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">hs</span> <span class=\"o\">:</span> <span class=\"bp\">∀</span> <span class=\"n\">t</span><span class=\"o\">,</span> <span class=\"n\">V</span> <span class=\"n\">t</span> <span class=\"err\">⊆</span> <span class=\"bp\">-</span><span class=\"n\">dom</span> <span class=\"o\">(</span><span class=\"n\">v&#39;</span> <span class=\"n\">t</span><span class=\"o\">))</span> <span class=\"o\">:</span>\n  <span class=\"bp\">∀</span> <span class=\"n\">t</span> <span class=\"n\">y</span><span class=\"o\">,</span> <span class=\"n\">ℋ</span> <span class=\"n\">v&#39;</span> <span class=\"n\">t</span> <span class=\"n\">y</span> <span class=\"bp\">=</span> <span class=\"n\">ℋ</span> <span class=\"o\">(</span><span class=\"bp\">λ</span> <span class=\"n\">s</span> <span class=\"n\">x</span><span class=\"o\">,</span> <span class=\"bp\">⟨</span><span class=\"n\">x</span> <span class=\"err\">∉</span> <span class=\"n\">V</span> <span class=\"n\">s</span><span class=\"o\">,</span> <span class=\"o\">(</span><span class=\"bp\">λ</span> <span class=\"n\">h</span><span class=\"o\">,</span> <span class=\"n\">ℋ</span> <span class=\"n\">v&#39;</span> <span class=\"n\">s</span> <span class=\"n\">x</span><span class=\"o\">)</span><span class=\"bp\">⟩</span><span class=\"o\">)</span> <span class=\"n\">t</span> <span class=\"n\">y</span><span class=\"o\">)</span>\n<span class=\"o\">(</span><span class=\"n\">mono_wrt_val_on_compl</span> <span class=\"o\">(</span><span class=\"n\">v₁</span> <span class=\"n\">v₂</span> <span class=\"o\">:</span> <span class=\"bp\">Π</span> <span class=\"n\">t</span><span class=\"o\">,</span> <span class=\"n\">X</span> <span class=\"bp\">→.</span> <span class=\"n\">Tτ</span> <span class=\"n\">t</span> <span class=\"bp\">→</span> <span class=\"n\">ℝ</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">hd</span> <span class=\"o\">:</span> <span class=\"bp\">∀</span> <span class=\"n\">t</span> <span class=\"n\">y</span><span class=\"o\">,</span> <span class=\"n\">y</span> <span class=\"err\">∈</span> <span class=\"n\">dom</span> <span class=\"o\">(</span><span class=\"n\">v₁</span> <span class=\"n\">t</span><span class=\"o\">)</span> <span class=\"bp\">↔</span> <span class=\"n\">y</span> <span class=\"err\">∈</span> <span class=\"n\">dom</span> <span class=\"o\">(</span><span class=\"n\">v₂</span> <span class=\"n\">t</span><span class=\"o\">))</span> <span class=\"o\">:</span>\n  <span class=\"o\">(</span><span class=\"bp\">∀</span> <span class=\"n\">t</span> <span class=\"n\">y</span> <span class=\"o\">(</span><span class=\"n\">h</span> <span class=\"o\">:</span> <span class=\"n\">y</span> <span class=\"err\">∈</span> <span class=\"n\">dom</span> <span class=\"o\">(</span><span class=\"n\">v₁</span> <span class=\"n\">t</span><span class=\"o\">)),</span> <span class=\"n\">fn</span> <span class=\"o\">(</span><span class=\"n\">v₁</span> <span class=\"n\">t</span><span class=\"o\">)</span> <span class=\"n\">y</span> <span class=\"n\">h</span> <span class=\"bp\">≤</span> <span class=\"n\">fn</span> <span class=\"o\">(</span><span class=\"n\">v₂</span> <span class=\"n\">t</span><span class=\"o\">)</span> <span class=\"n\">y</span> <span class=\"o\">((</span><span class=\"n\">hd</span> <span class=\"n\">t</span> <span class=\"n\">y</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"mi\">1</span> <span class=\"n\">h</span><span class=\"o\">))</span> <span class=\"bp\">→</span> <span class=\"n\">ℋ</span> <span class=\"n\">v₁</span> <span class=\"bp\">≤</span> <span class=\"n\">ℋ</span> <span class=\"n\">v₂</span><span class=\"o\">)</span>\n\n<span class=\"kn\">variable</span> <span class=\"o\">[</span><span class=\"n\">well_behaved_soln</span> <span class=\"n\">ℋ</span><span class=\"o\">]</span>\n\n<span class=\"kn\">variable</span> <span class=\"n\">ℰ</span> <span class=\"o\">(</span><span class=\"n\">t</span> <span class=\"o\">:</span> <span class=\"n\">Tt</span> <span class=\"n\">T</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">y</span> <span class=\"o\">:</span> <span class=\"n\">X</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">υ</span> <span class=\"o\">:</span> <span class=\"n\">β</span> <span class=\"bp\">→</span> <span class=\"n\">Tτ</span> <span class=\"n\">t</span> <span class=\"bp\">→</span> <span class=\"n\">ℝ</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">β</span> <span class=\"bp\">→</span> <span class=\"n\">ℝ</span>\n<span class=\"n\">def</span> <span class=\"n\">E_star</span> <span class=\"o\">(</span><span class=\"n\">v</span> <span class=\"o\">:</span> <span class=\"n\">debt_fn</span> <span class=\"n\">T</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">t</span> <span class=\"o\">:</span> <span class=\"n\">Tt</span> <span class=\"n\">T</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">y</span> <span class=\"o\">:</span> <span class=\"n\">X</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">β</span> <span class=\"bp\">→</span> <span class=\"n\">ℝ</span> <span class=\"o\">:=</span> <span class=\"n\">ℰ</span> <span class=\"n\">t</span> <span class=\"n\">y</span> <span class=\"o\">(</span><span class=\"n\">v</span> <span class=\"n\">t</span> <span class=\"n\">y</span><span class=\"o\">)</span>\n\n<span class=\"n\">def</span> <span class=\"n\">mono_wrt_assets</span> <span class=\"o\">(</span><span class=\"n\">u</span> <span class=\"o\">:</span> <span class=\"n\">debt_fn</span> <span class=\"n\">T</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"kt\">Prop</span> <span class=\"o\">:=</span>\n<span class=\"bp\">∀</span> <span class=\"o\">(</span><span class=\"n\">r</span> <span class=\"o\">:</span> <span class=\"n\">ℝ</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">hr</span> <span class=\"o\">:</span> <span class=\"mi\">0</span> <span class=\"bp\">≤</span> <span class=\"n\">r</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">t</span> <span class=\"o\">:</span> <span class=\"n\">Tt</span> <span class=\"n\">T</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">y</span> <span class=\"o\">:</span> <span class=\"n\">X</span><span class=\"o\">),</span> <span class=\"n\">u</span> <span class=\"n\">t</span> <span class=\"n\">y</span> <span class=\"bp\">≤</span> <span class=\"n\">u</span> <span class=\"n\">t</span> <span class=\"o\">(</span><span class=\"n\">y</span> <span class=\"bp\">+</span> <span class=\"n\">r</span><span class=\"o\">)</span>\n\n<span class=\"n\">def</span> <span class=\"n\">strict_mono_wrt_assets</span> <span class=\"o\">(</span><span class=\"n\">E</span> <span class=\"o\">:</span> <span class=\"n\">Tt</span> <span class=\"n\">T</span> <span class=\"bp\">→</span> <span class=\"n\">X</span> <span class=\"bp\">→</span> <span class=\"n\">β</span> <span class=\"bp\">→</span> <span class=\"n\">ℝ</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"kt\">Prop</span> <span class=\"o\">:=</span>\n<span class=\"bp\">∀</span> <span class=\"o\">(</span><span class=\"n\">r</span> <span class=\"o\">:</span> <span class=\"n\">ℝ</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">hr</span> <span class=\"o\">:</span> <span class=\"mi\">0</span> <span class=\"bp\">&lt;</span> <span class=\"n\">r</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">t</span> <span class=\"o\">:</span> <span class=\"n\">Tt</span> <span class=\"n\">T</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">y</span> <span class=\"o\">:</span> <span class=\"n\">X</span><span class=\"o\">),</span> <span class=\"n\">E</span> <span class=\"n\">t</span> <span class=\"n\">y</span> <span class=\"bp\">&lt;</span> <span class=\"n\">E</span> <span class=\"n\">t</span> <span class=\"o\">(</span><span class=\"n\">y</span> <span class=\"bp\">+</span> <span class=\"n\">r</span><span class=\"o\">)</span>\n\n<span class=\"n\">class</span> <span class=\"n\">equity_function</span> <span class=\"o\">:</span> <span class=\"kt\">Prop</span> <span class=\"o\">:=</span>\n<span class=\"o\">(</span><span class=\"n\">mono_wrt_debt_valuation</span> <span class=\"o\">{</span><span class=\"n\">t</span> <span class=\"o\">:</span> <span class=\"n\">Tt</span> <span class=\"n\">T</span><span class=\"o\">}</span> <span class=\"o\">{</span><span class=\"n\">y</span> <span class=\"o\">:</span> <span class=\"n\">X</span><span class=\"o\">}</span> <span class=\"o\">{</span><span class=\"n\">υ₁</span> <span class=\"n\">υ₂</span> <span class=\"o\">:</span> <span class=\"n\">β</span> <span class=\"bp\">→</span> <span class=\"n\">Tτ</span> <span class=\"n\">t</span> <span class=\"bp\">→</span> <span class=\"n\">ℝ</span><span class=\"o\">}</span> <span class=\"o\">:</span> <span class=\"n\">υ₁</span> <span class=\"bp\">≤</span> <span class=\"n\">υ₂</span> <span class=\"bp\">→</span> <span class=\"n\">ℰ</span> <span class=\"n\">t</span> <span class=\"n\">y</span> <span class=\"n\">υ₁</span> <span class=\"bp\">≤</span> <span class=\"n\">ℰ</span> <span class=\"n\">t</span> <span class=\"n\">y</span> <span class=\"n\">υ₂</span><span class=\"o\">)</span>\n<span class=\"o\">(</span><span class=\"n\">preserves_mono_wrt_assets</span> <span class=\"o\">{</span><span class=\"n\">u</span> <span class=\"o\">:</span> <span class=\"n\">debt_fn</span> <span class=\"n\">T</span><span class=\"o\">}</span> <span class=\"o\">:</span> <span class=\"n\">mono_wrt_assets</span> <span class=\"n\">u</span> <span class=\"bp\">→</span> <span class=\"n\">strict_mono_wrt_assets</span> <span class=\"o\">(</span><span class=\"n\">E_star</span> <span class=\"n\">ℰ</span> <span class=\"n\">u</span><span class=\"o\">))</span>\n\n<span class=\"kn\">variable</span> <span class=\"o\">[</span><span class=\"n\">equity_function</span> <span class=\"n\">ℰ</span><span class=\"o\">]</span>\n</code></pre></div>",
        "id": 203492950,
        "sender_full_name": "Alistair Tucker",
        "timestamp": 1594378040
    },
    {
        "content": "<p>Now this is what I want to prove: the existence and uniqueness of a 'survivors' function φ having the following properties.</p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"n\">def</span> <span class=\"n\">V</span> <span class=\"o\">(</span><span class=\"n\">ψ</span> <span class=\"o\">:</span> <span class=\"n\">finset</span> <span class=\"n\">β</span> <span class=\"bp\">→</span> <span class=\"n\">Tt</span> <span class=\"n\">T</span> <span class=\"bp\">→</span> <span class=\"n\">X</span> <span class=\"bp\">→</span> <span class=\"n\">finset</span> <span class=\"n\">β</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">a</span> <span class=\"o\">:</span> <span class=\"n\">finset</span> <span class=\"n\">β</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">Tt</span> <span class=\"n\">T</span> <span class=\"bp\">→</span> <span class=\"n\">set</span> <span class=\"n\">X</span> <span class=\"o\">:=</span>\n<span class=\"bp\">λ</span> <span class=\"n\">t</span> <span class=\"n\">y</span><span class=\"o\">,</span> <span class=\"n\">ψ</span> <span class=\"n\">a</span> <span class=\"n\">t</span> <span class=\"n\">y</span> <span class=\"bp\">=</span> <span class=\"n\">a</span>\n\n<span class=\"n\">class</span> <span class=\"n\">surviving_set</span> <span class=\"o\">(</span><span class=\"n\">ψ</span> <span class=\"o\">:</span> <span class=\"n\">finset</span> <span class=\"n\">β</span> <span class=\"bp\">→</span> <span class=\"n\">Tt</span> <span class=\"n\">T</span> <span class=\"bp\">→</span> <span class=\"n\">X</span> <span class=\"bp\">→</span> <span class=\"n\">finset</span> <span class=\"n\">β</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"kt\">Prop</span> <span class=\"o\">:=</span>\n<span class=\"o\">(</span><span class=\"n\">only_fail</span> <span class=\"o\">:</span> <span class=\"bp\">∀</span> <span class=\"n\">a</span> <span class=\"n\">t</span> <span class=\"n\">y</span><span class=\"o\">,</span> <span class=\"n\">ψ</span> <span class=\"n\">a</span> <span class=\"n\">t</span> <span class=\"n\">y</span> <span class=\"bp\">≤</span> <span class=\"n\">a</span><span class=\"o\">)</span>\n<span class=\"o\">(</span><span class=\"n\">idempotent</span> <span class=\"o\">:</span> <span class=\"bp\">∀</span> <span class=\"n\">a</span> <span class=\"n\">t</span> <span class=\"n\">y</span><span class=\"o\">,</span> <span class=\"n\">y</span> <span class=\"err\">∈</span> <span class=\"n\">V</span> <span class=\"n\">ψ</span> <span class=\"o\">(</span><span class=\"n\">ψ</span> <span class=\"n\">a</span> <span class=\"n\">t</span> <span class=\"n\">y</span><span class=\"o\">)</span> <span class=\"n\">t</span><span class=\"o\">)</span>\n<span class=\"o\">(</span><span class=\"n\">maximal</span> <span class=\"o\">:</span> <span class=\"bp\">∀</span> <span class=\"n\">a</span> <span class=\"n\">t</span> <span class=\"n\">y</span><span class=\"o\">,</span> <span class=\"bp\">∀</span> <span class=\"n\">b</span> <span class=\"bp\">≤</span> <span class=\"n\">a</span><span class=\"o\">,</span> <span class=\"n\">ψ</span> <span class=\"n\">a</span> <span class=\"n\">t</span> <span class=\"n\">y</span> <span class=\"bp\">&lt;</span> <span class=\"n\">b</span> <span class=\"bp\">→</span> <span class=\"n\">y</span> <span class=\"err\">∉</span> <span class=\"n\">V</span> <span class=\"n\">ψ</span> <span class=\"n\">b</span> <span class=\"n\">t</span><span class=\"o\">)</span>\n<span class=\"o\">(</span><span class=\"n\">consistent</span> <span class=\"o\">:</span> <span class=\"bp\">∀</span> <span class=\"n\">a</span> <span class=\"n\">t</span> <span class=\"n\">y</span><span class=\"o\">,</span> <span class=\"n\">y</span> <span class=\"err\">∈</span> <span class=\"n\">V</span> <span class=\"n\">ψ</span> <span class=\"n\">a</span> <span class=\"n\">t</span> <span class=\"bp\">↔</span> <span class=\"bp\">∀</span> <span class=\"n\">i</span> <span class=\"err\">∈</span> <span class=\"n\">a</span><span class=\"o\">,</span> <span class=\"mi\">0</span> <span class=\"bp\">&lt;</span> <span class=\"n\">E_star</span> <span class=\"n\">ℰ</span> <span class=\"o\">(</span><span class=\"n\">v</span> <span class=\"n\">ℋ</span> <span class=\"n\">ψ</span> <span class=\"n\">a</span><span class=\"o\">)</span> <span class=\"n\">t</span> <span class=\"n\">y</span> <span class=\"n\">i</span><span class=\"o\">)</span>\n<span class=\"o\">(</span><span class=\"n\">supported</span> <span class=\"o\">:</span> <span class=\"bp\">∀</span> <span class=\"n\">a</span> <span class=\"n\">t</span> <span class=\"n\">y</span><span class=\"o\">,</span> <span class=\"o\">(</span><span class=\"bp\">∃</span> <span class=\"n\">b</span> <span class=\"bp\">&lt;</span> <span class=\"n\">a</span><span class=\"o\">,</span> <span class=\"bp\">∀</span> <span class=\"n\">i</span> <span class=\"err\">∈</span> <span class=\"n\">a</span><span class=\"o\">,</span> <span class=\"mi\">0</span> <span class=\"bp\">&lt;</span> <span class=\"n\">E_star</span> <span class=\"n\">ℰ</span> <span class=\"o\">(</span><span class=\"n\">v</span> <span class=\"n\">ℋ</span> <span class=\"n\">ψ</span> <span class=\"n\">b</span><span class=\"o\">)</span> <span class=\"n\">t</span> <span class=\"n\">y</span> <span class=\"n\">i</span><span class=\"o\">)</span> <span class=\"bp\">→</span> <span class=\"n\">y</span> <span class=\"err\">∈</span> <span class=\"n\">V</span> <span class=\"n\">ψ</span> <span class=\"n\">a</span> <span class=\"n\">t</span><span class=\"o\">)</span>\n  <span class=\"c1\">-- I&#39;m not fond of this last condition. Perhaps I can lose it or replace it.</span>\n\n<span class=\"kn\">theorem</span> <span class=\"n\">exists_unique_soln</span> <span class=\"o\">:</span> <span class=\"bp\">∃!</span> <span class=\"n\">ψ</span><span class=\"o\">,</span> <span class=\"n\">surviving_set</span> <span class=\"n\">ℋ</span> <span class=\"n\">ℰ</span> <span class=\"n\">ψ</span> <span class=\"o\">:=</span>\n<span class=\"n\">sorry</span>\n</code></pre></div>",
        "id": 203493060,
        "sender_full_name": "Alistair Tucker",
        "timestamp": 1594378123
    },
    {
        "content": "<p>oops I also need</p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"n\">class</span> <span class=\"n\">equity_function</span> <span class=\"o\">:</span> <span class=\"kt\">Prop</span> <span class=\"o\">:=</span>\n<span class=\"bp\">...</span>\n<span class=\"o\">(</span><span class=\"n\">continuity_preserving</span> <span class=\"o\">(</span><span class=\"n\">υ</span> <span class=\"o\">:</span> <span class=\"n\">debt_fn</span> <span class=\"n\">T</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"bp\">∀</span> <span class=\"n\">t</span><span class=\"o\">,</span> <span class=\"n\">continuous</span> <span class=\"o\">(</span><span class=\"n\">υ</span> <span class=\"n\">t</span><span class=\"o\">)</span> <span class=\"bp\">→</span> <span class=\"n\">continuous</span> <span class=\"o\">(</span><span class=\"n\">E_star</span> <span class=\"n\">ℰ</span> <span class=\"n\">υ</span> <span class=\"n\">t</span><span class=\"o\">))</span>\n</code></pre></div>",
        "id": 203508176,
        "sender_full_name": "Alistair Tucker",
        "timestamp": 1594388875
    }
]