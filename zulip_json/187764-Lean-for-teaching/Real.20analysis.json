[
    {
        "content": "<p>If I understand correctly, <span class=\"user-mention\" data-user-id=\"210574\">@Patrick Massot</span> has taught a whole real analysis course in Lean.  I would like to do this someday, but as a test last semester I had two real analysis students do some optional exercises:</p>",
        "id": 196926248,
        "sender_full_name": "Heather Macbeth",
        "timestamp": 1588959332
    },
    {
        "content": "<p>(By the way, since it was just two students, I could give just a few more difficult problems, rather than working up to them with large numbers of easier problems.)</p>",
        "id": 196926471,
        "sender_full_name": "Heather Macbeth",
        "timestamp": 1588959446
    },
    {
        "content": "<p>This is not quite the situation. Students have a whole real analysis course during the first semester with zero Lean (or any proof assistant). They see epsilons during lectures, but the exams are 100% about calculating stuff. During the second semester they have twelve weeks with me, doing two hours of Lean with me. What we cover in those 12 weeks is a strict subset of the first semester course.</p>",
        "id": 196926594,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1588959493
    },
    {
        "content": "<p>project 1:  I wrote a proof that</p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"n\">Lemma</span> <span class=\"n\">limitX</span> <span class=\"o\">:</span> <span class=\"n\">limit</span> <span class=\"o\">(</span><span class=\"k\">fun</span> <span class=\"o\">(</span><span class=\"n\">n</span><span class=\"o\">:</span><span class=\"n\">nat</span><span class=\"o\">)</span> <span class=\"bp\">=&gt;</span>  <span class=\"o\">((</span><span class=\"bp\">-</span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"bp\">^</span><span class=\"n\">n</span> <span class=\"bp\">*</span> <span class=\"o\">(</span><span class=\"n\">INR</span> <span class=\"n\">n</span><span class=\"o\">)</span> <span class=\"bp\">+</span> <span class=\"mi\">5</span><span class=\"o\">)</span> <span class=\"bp\">/</span> <span class=\"o\">((</span><span class=\"n\">INR</span> <span class=\"n\">n</span><span class=\"o\">)</span><span class=\"bp\">^</span><span class=\"mi\">4</span> <span class=\"bp\">-</span> <span class=\"mi\">3</span> <span class=\"bp\">*</span> <span class=\"o\">(</span><span class=\"n\">INR</span> <span class=\"n\">n</span><span class=\"o\">)</span> <span class=\"bp\">+</span> <span class=\"mi\">3</span> <span class=\"o\">))</span> <span class=\"mi\">0</span><span class=\"bp\">.</span>\n</code></pre></div>\n\n\n<p>and had them adapt it to a proof that </p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"n\">Lemma</span> <span class=\"n\">limitX</span> <span class=\"o\">:</span> <span class=\"n\">limit</span> <span class=\"o\">(</span><span class=\"k\">fun</span> <span class=\"o\">(</span><span class=\"n\">n</span><span class=\"o\">:</span><span class=\"n\">nat</span><span class=\"o\">)</span> <span class=\"bp\">=&gt;</span>  <span class=\"o\">(</span><span class=\"mi\">1</span> <span class=\"bp\">+</span> <span class=\"o\">(</span><span class=\"mi\">3</span><span class=\"bp\">*</span><span class=\"n\">INR</span> <span class=\"n\">n</span><span class=\"bp\">^</span><span class=\"mi\">2</span> <span class=\"bp\">+</span> <span class=\"n\">INR</span> <span class=\"n\">n</span><span class=\"o\">)</span> <span class=\"bp\">/</span> <span class=\"o\">(</span><span class=\"mi\">2</span><span class=\"bp\">*</span><span class=\"n\">INR</span> <span class=\"n\">n</span><span class=\"bp\">^</span><span class=\"mi\">2</span> <span class=\"bp\">-</span><span class=\"mi\">1</span><span class=\"o\">)))</span> <span class=\"o\">(</span><span class=\"mi\">5</span><span class=\"bp\">/</span><span class=\"mi\">2</span><span class=\"o\">)</span><span class=\"bp\">.</span>\n</code></pre></div>",
        "id": 196926867,
        "sender_full_name": "Heather Macbeth",
        "timestamp": 1588959619
    },
    {
        "content": "<p>project 2: I wrote a proof that</p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"n\">Lemma</span> <span class=\"n\">limit_plus</span> <span class=\"o\">:</span>  <span class=\"k\">forall</span> <span class=\"o\">(</span><span class=\"n\">Xn</span> <span class=\"n\">Yn</span><span class=\"o\">:</span><span class=\"n\">nat</span> <span class=\"bp\">-&gt;</span> <span class=\"n\">R</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">x</span> <span class=\"n\">y</span><span class=\"o\">:</span><span class=\"n\">R</span><span class=\"o\">),</span> <span class=\"n\">limit</span> <span class=\"n\">Xn</span> <span class=\"n\">x</span> <span class=\"bp\">-&gt;</span> <span class=\"n\">limit</span> <span class=\"n\">Yn</span> <span class=\"n\">y</span> <span class=\"bp\">-&gt;</span> <span class=\"n\">limit</span> <span class=\"o\">(</span><span class=\"k\">fun</span> <span class=\"n\">n</span><span class=\"o\">:</span><span class=\"n\">nat</span> <span class=\"bp\">=&gt;</span> <span class=\"n\">Xn</span> <span class=\"n\">n</span> <span class=\"bp\">+</span> <span class=\"n\">Yn</span> <span class=\"n\">n</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">x</span> <span class=\"bp\">+</span> <span class=\"n\">y</span><span class=\"o\">)</span><span class=\"bp\">.</span>\n</code></pre></div>\n\n\n<p>and had them adapt it to a proof that</p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"n\">Lemma</span> <span class=\"n\">limit_mult</span> <span class=\"o\">:</span> <span class=\"k\">forall</span> <span class=\"o\">(</span><span class=\"n\">Xn</span> <span class=\"n\">Yn</span><span class=\"o\">:</span><span class=\"n\">nat</span> <span class=\"bp\">-&gt;</span> <span class=\"n\">R</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">x</span> <span class=\"n\">y</span><span class=\"o\">:</span><span class=\"n\">R</span><span class=\"o\">),</span> <span class=\"n\">limit</span> <span class=\"n\">Xn</span> <span class=\"n\">x</span> <span class=\"bp\">-&gt;</span> <span class=\"n\">limit</span> <span class=\"n\">Yn</span> <span class=\"n\">y</span> <span class=\"bp\">-&gt;</span> <span class=\"n\">limit</span> <span class=\"o\">(</span><span class=\"k\">fun</span> <span class=\"n\">n</span><span class=\"o\">:</span><span class=\"n\">nat</span> <span class=\"bp\">=&gt;</span> <span class=\"o\">(</span><span class=\"n\">Xn</span> <span class=\"n\">n</span><span class=\"o\">)</span> <span class=\"bp\">*</span> <span class=\"o\">(</span><span class=\"n\">Yn</span> <span class=\"n\">n</span><span class=\"o\">))</span> <span class=\"o\">(</span><span class=\"n\">x</span> <span class=\"bp\">*</span> <span class=\"n\">y</span><span class=\"o\">)</span><span class=\"bp\">.</span>\n</code></pre></div>",
        "id": 196927168,
        "sender_full_name": "Heather Macbeth",
        "timestamp": 1588959777
    },
    {
        "content": "<p>project 3: I indicated this section of the textbook and had them formalize it themselves:</p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"n\">Definition</span> <span class=\"n\">monotone_incr</span> <span class=\"o\">(</span><span class=\"n\">Xn</span><span class=\"o\">:</span><span class=\"n\">nat</span> <span class=\"bp\">-&gt;</span> <span class=\"n\">R</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"k\">forall</span> <span class=\"n\">n</span><span class=\"o\">:</span><span class=\"n\">nat</span><span class=\"o\">,</span> <span class=\"o\">(</span><span class=\"n\">Xn</span> <span class=\"n\">n</span><span class=\"o\">)</span> <span class=\"bp\">&lt;=</span> <span class=\"o\">(</span><span class=\"n\">Xn</span> <span class=\"o\">(</span><span class=\"n\">S</span> <span class=\"n\">n</span><span class=\"o\">))</span><span class=\"bp\">.</span>\n\n<span class=\"n\">Lemma</span> <span class=\"n\">monotone_conv</span> <span class=\"o\">:</span> <span class=\"k\">forall</span> <span class=\"o\">(</span><span class=\"n\">Xn</span><span class=\"o\">:</span><span class=\"n\">nat</span> <span class=\"bp\">-&gt;</span> <span class=\"n\">R</span><span class=\"o\">),</span> <span class=\"n\">monotone_incr</span> <span class=\"n\">Xn</span> <span class=\"bp\">-&gt;</span> <span class=\"n\">bound</span> <span class=\"o\">(</span><span class=\"k\">fun</span> <span class=\"n\">y</span><span class=\"o\">:</span><span class=\"n\">R</span> <span class=\"bp\">=&gt;</span> <span class=\"o\">(</span><span class=\"n\">exists</span> <span class=\"n\">n</span><span class=\"o\">:</span><span class=\"n\">nat</span><span class=\"o\">,</span> <span class=\"n\">Xn</span> <span class=\"n\">n</span> <span class=\"bp\">=</span> <span class=\"n\">y</span><span class=\"o\">))</span> <span class=\"bp\">-&gt;</span> <span class=\"n\">exists</span> <span class=\"n\">x</span><span class=\"o\">:</span><span class=\"n\">R</span><span class=\"o\">,</span> <span class=\"n\">limit</span> <span class=\"n\">Xn</span> <span class=\"n\">x</span><span class=\"bp\">.</span>\n</code></pre></div>",
        "id": 196927487,
        "sender_full_name": "Heather Macbeth",
        "timestamp": 1588959934
    },
    {
        "content": "<p><code>INR n</code> is the real number corresponding to the natural number <code>n</code>?</p>",
        "id": 196927510,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1588959945
    },
    {
        "content": "<p>Yes. (For those new to the thread, this is Coq, not Lean.)</p>",
        "id": 196927617,
        "sender_full_name": "Heather Macbeth",
        "timestamp": 1588959979
    },
    {
        "content": "<p>I am sure there is a clever way to do type conversions in Coq, but since I was new to it myself, I only knew the clunky way.</p>",
        "id": 196927658,
        "sender_full_name": "Heather Macbeth",
        "timestamp": 1588960005
    },
    {
        "content": "<p>I am new to Lean but I have already discovered that it has nice type conversion commands!</p>",
        "id": 196927794,
        "sender_full_name": "Heather Macbeth",
        "timestamp": 1588960075
    },
    {
        "content": "<p>You can just coerce in Lean: given <code>n : ℕ</code> you can just talk about <code>n : ℝ</code>. It's great that you're showing mathematicians formal proof verification systems! I use Lean in my undergraduate lectures but it's 100% optional; I run a club on Thursday evenings where people can talk to me about it.</p>",
        "id": 196928147,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1588960251
    },
    {
        "content": "<p>Did anyone manage to do project 3? It looks pretty tough. Are there good introductions to mathematics in Coq? We're frantically trying to make Lean teaching materials for mathematicians.</p>",
        "id": 196928211,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1588960298
    },
    {
        "content": "<p>It was a good experience and the students seemed to learn a lot from it (as did I).  I think real analysis is a very good playground for formalized proof:  the proof structures are complicated (all those for-alls and there-exists), but also more or less the same every time, so the students can get the hang of it fast.</p>",
        "id": 196928292,
        "sender_full_name": "Heather Macbeth",
        "timestamp": 1588960325
    },
    {
        "content": "<p>Yes, they did all 3 projects!  I spent a <em>lot</em> of time helping, but they took the big steps themselves.</p>",
        "id": 196928376,
        "sender_full_name": "Heather Macbeth",
        "timestamp": 1588960372
    },
    {
        "content": "<p>I guess I can prove these things in Lean but I have no idea how these things would look like in Coq. Are there specialised tools for solving this sort of thing? For the first lemma I would just show that for n sufficiently large the abs value of the numerator was at most 2n and the abs value of the denominator was at least 1/2*n^4, which would be a bit of a kerfuffle</p>",
        "id": 196928484,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1588960425
    },
    {
        "content": "<p>For me, the mess of absolute values and epsilons is the point -- I think this is what introductory real analysis course should teach them :)</p>",
        "id": 196928684,
        "sender_full_name": "Heather Macbeth",
        "timestamp": 1588960512
    },
    {
        "content": "<p>I hesitate to say \"Coq can't do this or that\", because I am also fairly new to Coq -- but I do not know how to do the analogue of a <code>calc</code> proof or <code>library_search</code> in Coq.</p>",
        "id": 196928847,
        "sender_full_name": "Heather Macbeth",
        "timestamp": 1588960583
    },
    {
        "content": "<p>These are both great features of Lean, which make it more natural.  I plan to switch to Lean if/when I do this again.</p>",
        "id": 196928901,
        "sender_full_name": "Heather Macbeth",
        "timestamp": 1588960609
    },
    {
        "content": "<p>But conversely you could envisage a more conceptual proof along the lines of \"by a tactic, <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo stretchy=\"false\">(</mo><msup><mi>n</mi><mn>4</mn></msup><mo>−</mo><mn>3</mn><mi>n</mi><mo>+</mo><mn>3</mn><mo stretchy=\"false\">)</mo><mi mathvariant=\"normal\">/</mi><msup><mi>n</mi><mn>4</mn></msup></mrow><annotation encoding=\"application/x-tex\">(n^4-3n+3)/n^4</annotation></semantics></math></span><span aria-hidden=\"true\" class=\"katex-html\"><span class=\"base\"><span class=\"strut\" style=\"height:1.064108em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathdefault\">n</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">4</span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.72777em;vertical-align:-0.08333em;\"></span><span class=\"mord\">3</span><span class=\"mord mathdefault\">n</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.064108em;vertical-align:-0.25em;\"></span><span class=\"mord\">3</span><span class=\"mclose\">)</span><span class=\"mord\">/</span><span class=\"mord\"><span class=\"mord mathdefault\">n</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">4</span></span></span></span></span></span></span></span></span></span></span> tends to 1, so by a theorem we can replace the denominator by <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mi>n</mi><mn>4</mn></msup></mrow><annotation encoding=\"application/x-tex\">n^4</annotation></semantics></math></span><span aria-hidden=\"true\" class=\"katex-html\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8141079999999999em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">n</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">4</span></span></span></span></span></span></span></span></span></span></span> etc</p>",
        "id": 196928922,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1588960617
    },
    {
        "content": "<p>But such a tactic doesn't exist in Lean (although the theorem does) so one would have to work in a more low-level manner. It would not surprise me if one could solve all these questions with a tactic in Isabelle/HOL</p>",
        "id": 196929031,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1588960670
    },
    {
        "content": "<p>But on the other hand, did you say you were a differential geometer? Trying to define tangent bundles in Isabelle/HOL would be a nightmare, that's why I am using a system with dependent types</p>",
        "id": 196929152,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1588960714
    },
    {
        "content": "<p>Indeed, it would be possible to write tactics to do all these problems.  But I think the experience of doing them \"on paper\" as a beginning analysis student is better replicated by typing out the proofs by hand, rather than by invoking a tactic.  My dream is to set a homework assignment full of epsilon-delta problems, and have the computer grade it!</p>",
        "id": 196929444,
        "sender_full_name": "Heather Macbeth",
        "timestamp": 1588960846
    },
    {
        "content": "<p>It would take some guts to do this sort of thing in a differential geometry course though :-) I taught algebraic geometry last term and I formalised about 1/3 of the course but then I got bogged down by the Nullstellensatz and eventually got so far behind that I put the entire thing on hold</p>",
        "id": 196929467,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1588960855
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"260507\">Heather Macbeth</span> <a href=\"#narrow/stream/187764-Lean-for.20teaching/topic/Real.20analysis/near/196929444\" title=\"#narrow/stream/187764-Lean-for.20teaching/topic/Real.20analysis/near/196929444\">said</a>:</p>\n<blockquote>\n<p>My dream is to set a homework assignment full of epsilon-delta problems, and have the computer grade it!</p>\n</blockquote>\n<p>Right! The problem is that I don't think my university would at this point buy the idea of forcing 1st years to learn a system such as this. Course they're doing this sort of thing in computer science departments everywhere!</p>",
        "id": 196929594,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1588960916
    },
    {
        "content": "<p>Though Coq does have one lower-level tactic that helps with these -- it's called <code>nra</code>, \"nonlinear real arithmetic\", and it's a (limited) nonlinear version of Lean's <code>linarith</code>. Great for inequalities.</p>",
        "id": 196929703,
        "sender_full_name": "Heather Macbeth",
        "timestamp": 1588960957
    },
    {
        "content": "<p>I spent some time today grading Richard Thomas' 1st year analysis exam, and in Q2 he divides by zero! If he'd formalised his solutions in Lean he would have noticed :-)</p>",
        "id": 196929782,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1588960996
    },
    {
        "content": "<p>So it's not just the teachers who get a better deal if the students are formalising solutions in Lean, the students would also not have to deal with annoying typos in an exam situation</p>",
        "id": 196929868,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1588961039
    },
    {
        "content": "<p>\"2(b): For <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>n</mi><mo>≥</mo><mn>0</mn></mrow><annotation encoding=\"application/x-tex\">n\\geq0</annotation></semantics></math></span><span aria-hidden=\"true\" class=\"katex-html\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7719400000000001em;vertical-align:-0.13597em;\"></span><span class=\"mord mathdefault\">n</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≥</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">0</span></span></span></span> show that <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msqrt><mrow><mi>n</mi><mo>+</mo><mn>1</mn></mrow></msqrt><mo>−</mo><msqrt><mi>n</mi></msqrt><mo>≤</mo><mfrac><mn>1</mn><mrow><mn>2</mn><msqrt><mi>n</mi></msqrt></mrow></mfrac></mrow><annotation encoding=\"application/x-tex\">\\sqrt{n+1}-\\sqrt{n}\\leq\\frac{1}{2\\sqrt{n}}</annotation></semantics></math></span><span aria-hidden=\"true\" class=\"katex-html\"><span class=\"base\"><span class=\"strut\" style=\"height:1.04em;vertical-align:-0.17444499999999996em;\"></span><span class=\"mord sqrt\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8655550000000001em;\"><span class=\"svg-align\" style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\" style=\"padding-left:0.833em;\"><span class=\"mord mathdefault\">n</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord\">1</span></span></span><span style=\"top:-2.825555em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"hide-tail\" style=\"min-width:0.853em;height:1.08em;\"><svg height=\"1.08em\" preserveAspectRatio=\"xMinYMin slice\" viewBox=\"0 0 400000 1080\" width=\"400em\"><path d=\"M95,702 c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14 c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54 c44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10 s173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429 c69,-144,104.5,-217.7,106.5,-221 l0 -0 c5.3,-9.3,12,-14,20,-14 H400000v40H845.2724 s-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7 c-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47z M834 80h400000v40h-400000z\"></path></svg></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.17444499999999996em;\"><span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.04em;vertical-align:-0.23972em;\"></span><span class=\"mord sqrt\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8002800000000001em;\"><span class=\"svg-align\" style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\" style=\"padding-left:0.833em;\"><span class=\"mord mathdefault\">n</span></span></span><span style=\"top:-2.76028em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"hide-tail\" style=\"min-width:0.853em;height:1.08em;\"><svg height=\"1.08em\" preserveAspectRatio=\"xMinYMin slice\" viewBox=\"0 0 400000 1080\" width=\"400em\"><path d=\"M95,702 c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14 c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54 c44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10 s173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429 c69,-144,104.5,-217.7,106.5,-221 l0 -0 c5.3,-9.3,12,-14,20,-14 H400000v40H845.2724 s-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7 c-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47z M834 80h400000v40h-400000z\"></path></svg></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.23972em;\"><span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.383108em;vertical-align:-0.538em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.845108em;\"><span style=\"top:-2.6258665em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">2</span><span class=\"mord sqrt mtight\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8059050000000001em;\"><span class=\"svg-align\" style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord mtight\" style=\"padding-left:0.833em;\"><span class=\"mord mathdefault mtight\">n</span></span></span><span style=\"top:-2.765905em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"hide-tail mtight\" style=\"min-width:0.853em;height:1.08em;\"><svg height=\"1.08em\" preserveAspectRatio=\"xMinYMin slice\" viewBox=\"0 0 400000 1080\" width=\"400em\"><path d=\"M95,702 c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14 c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54 c44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10 s173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429 c69,-144,104.5,-217.7,106.5,-221 l0 -0 c5.3,-9.3,12,-14,20,-14 H400000v40H845.2724 s-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7 c-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47z M834 80h400000v40h-400000z\"></path></svg></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.234095em;\"><span></span></span></span></span></span></span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.394em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">1</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.538em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span></span></span></span>\"</p>",
        "id": 196929942,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1588961068
    },
    {
        "content": "<p>Fortunately I was marking Q3 so I don't get to see what the students thought of that...</p>",
        "id": 196929986,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1588961086
    },
    {
        "content": "<p>In Lean 1/0=0 so the question is actually false :-)</p>",
        "id": 196930012,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1588961101
    },
    {
        "content": "<p>One more lower-level tactic that does not exist in Coq, so far as I know, but would be great:  something like <code>ring</code> or <code>linarith</code> but which also manipulates absolute values (at least <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"normal\">∣</mi><mi>a</mi><mi>b</mi><mi mathvariant=\"normal\">∣</mi><mo>=</mo><mi mathvariant=\"normal\">∣</mi><mi>a</mi><mi mathvariant=\"normal\">∣</mi><mi mathvariant=\"normal\">∣</mi><mi>b</mi><mi mathvariant=\"normal\">∣</mi></mrow><annotation encoding=\"application/x-tex\">|ab|=|a||b|</annotation></semantics></math></span><span aria-hidden=\"true\" class=\"katex-html\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">∣</span><span class=\"mord mathdefault\">a</span><span class=\"mord mathdefault\">b</span><span class=\"mord\">∣</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">∣</span><span class=\"mord mathdefault\">a</span><span class=\"mord\">∣</span><span class=\"mord\">∣</span><span class=\"mord mathdefault\">b</span><span class=\"mord\">∣</span></span></span></span>, but maybe also <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"normal\">∣</mi><mi>a</mi><mo>+</mo><mi>b</mi><mi mathvariant=\"normal\">∣</mi><mo>≤</mo><mi mathvariant=\"normal\">∣</mi><mi>a</mi><mi mathvariant=\"normal\">∣</mi><mo>+</mo><mi mathvariant=\"normal\">∣</mi><mi>b</mi><mi mathvariant=\"normal\">∣</mi></mrow><annotation encoding=\"application/x-tex\">|a+b|\\leq |a|+|b|</annotation></semantics></math></span><span aria-hidden=\"true\" class=\"katex-html\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">∣</span><span class=\"mord mathdefault\">a</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathdefault\">b</span><span class=\"mord\">∣</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">∣</span><span class=\"mord mathdefault\">a</span><span class=\"mord\">∣</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">∣</span><span class=\"mord mathdefault\">b</span><span class=\"mord\">∣</span></span></span></span>).  Maybe Lean's <code>simp</code> does this?</p>",
        "id": 196930039,
        "sender_full_name": "Heather Macbeth",
        "timestamp": 1588961112
    },
    {
        "content": "<p>I formalised my exam! But I am a bit of an extremist...</p>",
        "id": 196930065,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1588961122
    },
    {
        "content": "<p><code>simp</code> only rewrites equalities, so it won't use the triangle inequality</p>",
        "id": 196930121,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1588961149
    },
    {
        "content": "<p>Oh dear.  That hits close to home, I just corrected an in-progress exam (we are teaching remotely and asynchronously) with a sign error.</p>",
        "id": 196930225,
        "sender_full_name": "Heather Macbeth",
        "timestamp": 1588961182
    },
    {
        "content": "<p>and I don't think <code>linarith</code> uses the triangle inequality either. But I've formalised a bunch of stuff like this in Lean (and got students to formalise more at my club) and the trick is that there are lemmas called things like <code>abs_le</code> and you rewrite those first</p>",
        "id": 196930276,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1588961213
    },
    {
        "content": "<p>You replace <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"normal\">∣</mi><mi>x</mi><mi mathvariant=\"normal\">∣</mi><mo>≤</mo><mi>a</mi></mrow><annotation encoding=\"application/x-tex\">|x|\\leq a</annotation></semantics></math></span><span aria-hidden=\"true\" class=\"katex-html\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">∣</span><span class=\"mord mathdefault\">x</span><span class=\"mord\">∣</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">a</span></span></span></span> by <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo>−</mo><mi>a</mi><mo>≤</mo><mi>x</mi><mo>≤</mo><mi>a</mi></mrow><annotation encoding=\"application/x-tex\">-a\\leq x\\leq a</annotation></semantics></math></span><span aria-hidden=\"true\" class=\"katex-html\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7719400000000001em;vertical-align:-0.13597em;\"></span><span class=\"mord\">−</span><span class=\"mord mathdefault\">a</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7719400000000001em;vertical-align:-0.13597em;\"></span><span class=\"mord mathdefault\">x</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">a</span></span></span></span> and then <code>linarith</code> can do its magic</p>",
        "id": 196930323,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1588961243
    },
    {
        "content": "<p>One of my undergraduates got quite into it and made <a href=\"https://github.com/JasonKYi/M4000x_LEAN_formalisation\" title=\"https://github.com/JasonKYi/M4000x_LEAN_formalisation\">this</a></p>",
        "id": 196930481,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1588961312
    },
    {
        "content": "<p>!!!</p>",
        "id": 196930627,
        "sender_full_name": "Heather Macbeth",
        "timestamp": 1588961392
    },
    {
        "content": "<p>It's pretty cool what undergraduates can do if you encourage them; he's doing basic stuff with differentiability and continuity in Lean, just formalising the lectures himself -- I taught him Lean and he just decided to go for it. There is a bunch of elementary analysis there.</p>",
        "id": 196930631,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1588961394
    },
    {
        "content": "<p>It's things like this that make me think that this has a real role to play in education.</p>",
        "id": 196930703,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1588961423
    },
    {
        "content": "<p>and you probably saw the same sort of things too, some students just get good. This place is a really good place for beginners to ask Lean questions, it's a lot more efficient than googling</p>",
        "id": 196930758,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1588961463
    },
    {
        "content": "<p>Yes, indeed.</p>",
        "id": 196931235,
        "sender_full_name": "Heather Macbeth",
        "timestamp": 1588961700
    },
    {
        "content": "<p>Did some of the students manage to do the exercises? How hard is it to get Coq up and running? The community have tried to make it really easy to install Lean but it's still a fair amount of work for an 18 year old Windows user who is not used to having to type commands into the command line.</p>",
        "id": 196931431,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1588961801
    },
    {
        "content": "<p>This was just a couple of students, who volunteered to be my guinea pigs.  They did all 3 projects, but I spent a <em>lot</em> of time helping, everything from installation help onwards.</p>",
        "id": 196931905,
        "sender_full_name": "Heather Macbeth",
        "timestamp": 1588962058
    },
    {
        "content": "<p>Yeah that's how it is until you reach some basic minimum of competent users.</p>",
        "id": 196931960,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1588962088
    },
    {
        "content": "<p>The first year I ran my Thursday evening club it was hard work and I lost a lot of people early on. The second time I had a bunch of competent 2nd years and it went much better.</p>",
        "id": 196932065,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1588962126
    },
    {
        "content": "<p>But I see that Patrick Massot set up his exercises so they run in a <a href=\"https://www.imo.universite-paris-saclay.fr/~pmassot/enseignement/math114/leanweb/#url=https%3A%2F%2Fwww.imo.universite-paris-saclay.fr%2F~pmassot%2Fenseignement%2Fmath114%2Fleanweb%2F01_egalites.lean\" title=\"https://www.imo.universite-paris-saclay.fr/~pmassot/enseignement/math114/leanweb/#url=https%3A%2F%2Fwww.imo.universite-paris-saclay.fr%2F~pmassot%2Fenseignement%2Fmath114%2Fleanweb%2F01_egalites.lean\">browser</a>; I plan to try that next time.</p>",
        "id": 196932215,
        "sender_full_name": "Heather Macbeth",
        "timestamp": 1588962221
    },
    {
        "content": "<p>Yeah, he also wrote tools which mix well-typeset mathematics and Lean, e.g. <a href=\"http://wwwf.imperial.ac.uk/~buzzard/docs/lean/sandwich.html\" title=\"http://wwwf.imperial.ac.uk/~buzzard/docs/lean/sandwich.html\">here</a></p>",
        "id": 196932360,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1588962313
    },
    {
        "content": "<p>you can click on a line in a proof and then on a grey rectangle to see Lean's tactic state.</p>",
        "id": 196932392,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1588962336
    },
    {
        "content": "<p>That's great!</p>",
        "id": 196932424,
        "sender_full_name": "Heather Macbeth",
        "timestamp": 1588962356
    },
    {
        "content": "<p>I think there is huge potential here, for crazy formalised books etc</p>",
        "id": 196932433,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1588962361
    },
    {
        "content": "<p>I just have no idea why software like this has been around for 30+ years but mathematicians haven't adopted it for teaching.</p>",
        "id": 196932507,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1588962389
    },
    {
        "content": "<p>It would be interesting to re-do the proofs you gave your students in Lean to see if they're more or less painful</p>",
        "id": 196932642,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1588962470
    },
    {
        "content": "<p>I'm pretty sure they'll be less painful.  My naive understanding is that Lean has better type conversion, and it has unicode and <code>calc</code> proofs and <code>library_search</code>, and these more than make up for the loss of <code>nra</code>.</p>",
        "id": 196932968,
        "sender_full_name": "Heather Macbeth",
        "timestamp": 1588962616
    },
    {
        "content": "<p>Anyway, yes, this is the future of teaching!  But it's not quite clear when the future will really arrive.</p>",
        "id": 196933204,
        "sender_full_name": "Heather Macbeth",
        "timestamp": 1588962740
    },
    {
        "content": "<p>I want <code>nra</code> anyway. What does it do? The trick is to persuade one of the CS people to write it :-)</p>",
        "id": 196933520,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1588962920
    },
    {
        "content": "<p><code>nra</code> : all I know is <a href=\"https://coq.inria.fr/refman/addendum/micromega.html#coq:tacn.nra\" title=\"https://coq.inria.fr/refman/addendum/micromega.html#coq:tacn.nra\">this</a> (1 paragraph of documentation) plus <a href=\"https://github.com/coq/coq/tree/master/theories/micromega\" title=\"https://github.com/coq/coq/tree/master/theories/micromega\">this</a> (source code).  The documentation says it's experimental, but it works well!</p>",
        "id": 196934179,
        "sender_full_name": "Heather Macbeth",
        "timestamp": 1588963280
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"260507\">@Heather Macbeth</span> thanks a lot for your explanations. I'm sorry I had to leave for family duty while you were chatting with Kevin.</p>",
        "id": 196941091,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1588966743
    },
    {
        "content": "<p>About the Coq/Lean comparison: for that kind of mathematics there is clearly no foundational difference at all. It's all about being less user unfriendly (you cannot really hope for the general tool to be really user-friendly) and the surrounding tooling.</p>",
        "id": 196941263,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1588966814
    },
    {
        "content": "<p>I think that unicode + absence of iron curtain is already a big advantage for students. And ongoing work will make things even more friendly. This include Ed Ayers's tactic state widget efforts and of course the whole Lean 4 project. For instance I really look forward to customizable pretty-printing.</p>",
        "id": 196941403,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1588966914
    },
    {
        "content": "<p>My students used Lean is pretty diverse setups. Before the lock-down they had access to computer rooms running Lean + VScode locally. Since the beginning they also have bundle like what I link to at the beginning of <a href=\"https://www.imo.universite-paris-saclay.fr/~pmassot/enseignement/\" title=\"https://www.imo.universite-paris-saclay.fr/~pmassot/enseignement/\">this page</a> (first three links). These are single zip file having everything in one folder (Lean+VScode+extension+library, everything) but without any flexibility to create project or update Lean or mathlib. They also used Lean i the browser as you saw, and Lean on CoCalc.</p>",
        "id": 196941690,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1588967070
    },
    {
        "content": "<p>My work also involved very very careful choice of exercises to make sure students see almost only the best parts of dependent types. For instance your first project is the opposite of what I did, because it mixes natural number with real numbers. My only exception to this is the sequence <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>1</mn><mi mathvariant=\"normal\">/</mi><mo stretchy=\"false\">(</mo><mi>n</mi><mo>+</mo><mn>1</mn><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">1/(n+1)</annotation></semantics></math></span><span aria-hidden=\"true\" class=\"katex-html\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">1</span><span class=\"mord\">/</span><span class=\"mopen\">(</span><span class=\"mord mathdefault\">n</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">1</span><span class=\"mclose\">)</span></span></span></span> that is used in several places, but I give all required lemmas about it. My student didn't even prove it goes to zero.</p>",
        "id": 196942005,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1588967252
    },
    {
        "content": "<p>Your projects 2 to 4 are in my course.</p>",
        "id": 196942027,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1588967267
    },
    {
        "content": "<p>Thanks!  CoCalc looks like another good option.  Do you have an institutional subscription?  I may try to get one.</p>",
        "id": 196942148,
        "sender_full_name": "Heather Macbeth",
        "timestamp": 1588967328
    },
    {
        "content": "<p>Regarding project 1:  I agree, the switching back and forth between <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"double-struck\">N</mi></mrow><annotation encoding=\"application/x-tex\">\\mathbb{N}</annotation></semantics></math></span><span aria-hidden=\"true\" class=\"katex-html\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68889em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathbb\">N</span></span></span></span></span> and <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"double-struck\">R</mi></mrow><annotation encoding=\"application/x-tex\">\\mathbb{R}</annotation></semantics></math></span><span aria-hidden=\"true\" class=\"katex-html\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68889em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathbb\">R</span></span></span></span></span> is very painful.  I had already decided that if I were to give the same projects again, I would reverse the order of (1) and (2).</p>",
        "id": 196942367,
        "sender_full_name": "Heather Macbeth",
        "timestamp": 1588967412
    },
    {
        "content": "<p>Luckily we now have <code>norm_cast</code> and <code>push_cast</code></p>",
        "id": 196942435,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1588967459
    },
    {
        "content": "<p>I know we have <code>norm_cast</code>, and this would be a very important part of a course about learning Lean. But I wanted to avoid it at all cost in a course about regular maths using a proof assistant as a tool only.</p>",
        "id": 196942621,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1588967540
    },
    {
        "content": "<p>I guess, I think that doing exercises like project 1 (on paper) is really pedagogically very useful for beginning students.  I set exams that mostly consist of such problems!</p>",
        "id": 196942754,
        "sender_full_name": "Heather Macbeth",
        "timestamp": 1588967603
    },
    {
        "content": "<p>If you want to know more about the big picture here, it's probably useful to know that proof assistants don't have to make limit computation difficult.  You can watch <span class=\"user-mention\" data-user-id=\"233634\">@Manuel Eberl</span> 's <a href=\"https://www.youtube.com/watch?v=jMjNAhfUpSs&amp;list=PLlF-CfQhukNkWwZt45vkNfWfuO-tBBqPN&amp;index=3&amp;t=0s\" title=\"https://www.youtube.com/watch?v=jMjNAhfUpSs&amp;list=PLlF-CfQhukNkWwZt45vkNfWfuO-tBBqPN&amp;index=3&amp;t=0s\">great talk</a> about computing limits in Isabelle.</p>\n<div class=\"youtube-video message_inline_image\"><a data-id=\"jMjNAhfUpSs\" href=\"https://www.youtube.com/watch?v=jMjNAhfUpSs&amp;list=PLlF-CfQhukNkWwZt45vkNfWfuO-tBBqPN&amp;index=3&amp;t=0s\" title=\"https://www.youtube.com/watch?v=jMjNAhfUpSs&amp;list=PLlF-CfQhukNkWwZt45vkNfWfuO-tBBqPN&amp;index=3&amp;t=0s\"><img src=\"https://i.ytimg.com/vi/jMjNAhfUpSs/default.jpg\"></a></div>",
        "id": 196943094,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1588967775
    },
    {
        "content": "<p>For such tasks mathlib is currently light years behind the automation available in Isabelle. In this case there is no fundamental reason. You only need someone with Manuel's skills and enough motivation. One major problem is that those people are academics so they need papers. The first people doing such a thing can get a paper about it. But then the people porting it to other proof assistants still have a lot of work to do without having a paper. I'm exaggerating a bit, but this is a very real issue. Sometimes the solution is to get a MSc student porting things, and learning along the way, but sometimes it's too hard (or there aren't enough students).</p>",
        "id": 196943477,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1588967962
    },
    {
        "content": "<p>This is very interesting to me, though maybe it's a separate discussion ... Yes, I had seen this work of Manuel Eberl.  But when I do analysis (in research), I really do flail around with inequalities, until some quantity is bounded in some Banach space norm.  It feels much closer to \"by-hand\" epsilon-delta analysis than to big-O notation.</p>",
        "id": 196943489,
        "sender_full_name": "Heather Macbeth",
        "timestamp": 1588967971
    },
    {
        "content": "<p>Yes, it's a completely separate discussion.</p>",
        "id": 196943513,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1588967985
    },
    {
        "content": "<p>For me, I am more excited about tools to manipulate inequalities (see the discussion with Kevin above about <code>nra</code> and my <a href=\"#narrow/stream/187764-Lean-for.20teaching/topic/Real.20analysis/near/196930039\" title=\"#narrow/stream/187764-Lean-for.20teaching/topic/Real.20analysis/near/196930039\">imagined tactic</a> for the absolute value) than about tools which spit out the limit of any of a specialized class of sequences.</p>",
        "id": 196943659,
        "sender_full_name": "Heather Macbeth",
        "timestamp": 1588968051
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110031\">Patrick Massot</span> <a href=\"#narrow/stream/187764-Lean-for.20teaching/topic/Real.20analysis/near/196943477\" title=\"#narrow/stream/187764-Lean-for.20teaching/topic/Real.20analysis/near/196943477\">said</a>:</p>\n<blockquote>\n<p>For such tasks mathlib is currently light years beyond the automation available in Isabelle.</p>\n</blockquote>\n<p>You mean \"behind\", I guess</p>",
        "id": 196943732,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1588968087
    },
    {
        "content": "<p>But probably I am not understanding the full scope of Eberl's work.</p>",
        "id": 196943752,
        "sender_full_name": "Heather Macbeth",
        "timestamp": 1588968101
    },
    {
        "content": "<p>Yes, my English is crappy. Let me edit my post so that less people will be confused.</p>",
        "id": 196943791,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1588968121
    },
    {
        "content": "<p>What a silly idea to have those opposite words so close alphabetically</p>",
        "id": 196943934,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1588968179
    },
    {
        "content": "<p>As I wrote on the general stream, the nra tactic seems like one hour of work by someone knowing how to do that kind of things. What would you want the absolute value tactic to do?</p>",
        "id": 196945299,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1588968959
    },
    {
        "content": "<p>Wow, I did not know that this chat room was \"ask and you shall receive\" :)</p>",
        "id": 196945866,
        "sender_full_name": "Heather Macbeth",
        "timestamp": 1588969265
    },
    {
        "content": "<p>Sometimes it works surprisingly well</p>",
        "id": 196946132,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1588969412
    },
    {
        "content": "<p>Sometimes it fails completely</p>",
        "id": 196946138,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1588969417
    },
    {
        "content": "<p>I would like a tactic that works in (say) normed spaces, that will verify facts of the form <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo stretchy=\"false\">∥</mo><mn>2</mn><mi>a</mi><mo>+</mo><mi>b</mi><mo stretchy=\"false\">∥</mo><mo>≤</mo><mn>3</mn><mo stretchy=\"false\">∥</mo><mi>a</mi><mo stretchy=\"false\">∥</mo><mo>+</mo><mo stretchy=\"false\">∥</mo><mi>b</mi><mo>−</mo><mi>a</mi><mo stretchy=\"false\">∥</mo></mrow><annotation encoding=\"application/x-tex\">\\lVert 2a + b\\rVert\\leq 3\\lVert a\\rVert +  \\lVert b-a\\rVert</annotation></semantics></math></span><span aria-hidden=\"true\" class=\"katex-html\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">∥</span><span class=\"mord\">2</span><span class=\"mord mathdefault\">a</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathdefault\">b</span><span class=\"mclose\">∥</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">3</span><span class=\"mopen\">∥</span><span class=\"mord mathdefault\">a</span><span class=\"mclose\">∥</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">∥</span><span class=\"mord mathdefault\">b</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathdefault\">a</span><span class=\"mclose\">∥</span></span></span></span>.</p>",
        "id": 196946153,
        "sender_full_name": "Heather Macbeth",
        "timestamp": 1588969424
    },
    {
        "content": "<p>Do I have two wishes left?</p>",
        "id": 196946179,
        "sender_full_name": "Heather Macbeth",
        "timestamp": 1588969440
    },
    {
        "content": "<p>So, combining features of <code>ring</code> and <code>nra</code>, but also dealing with norms.</p>",
        "id": 196946314,
        "sender_full_name": "Heather Macbeth",
        "timestamp": 1588969507
    },
    {
        "content": "<p>It needs quite a bit more cleverness than <code>ring</code> and <code>nra</code>, unless I'm missing a trick here.</p>",
        "id": 196946775,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1588969793
    },
    {
        "content": "<p>You need to have the idea of rewriting <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>2</mn><mi>a</mi><mo>+</mo><mi>b</mi><mo>=</mo><mn>3</mn><mi>a</mi><mo>+</mo><mo stretchy=\"false\">(</mo><mi>b</mi><mo>−</mo><mi>a</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">2a+ b = 3a + (b-a)</annotation></semantics></math></span><span aria-hidden=\"true\" class=\"katex-html\"><span class=\"base\"><span class=\"strut\" style=\"height:0.72777em;vertical-align:-0.08333em;\"></span><span class=\"mord\">2</span><span class=\"mord mathdefault\">a</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">b</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.72777em;vertical-align:-0.08333em;\"></span><span class=\"mord\">3</span><span class=\"mord mathdefault\">a</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord mathdefault\">b</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathdefault\">a</span><span class=\"mclose\">)</span></span></span></span>. <code>ring</code> doesn't require any idea</p>",
        "id": 196946884,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1588969834
    },
    {
        "content": "<p><code>ring</code>can check this identity, but not come up with the statement</p>",
        "id": 196946911,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1588969852
    },
    {
        "content": "<p>I think that's right -- I thought about it briefly a while back, couldn't see a deterministic algorithm, so it has to be a matter of writing a good, tailored search.</p>",
        "id": 196946960,
        "sender_full_name": "Heather Macbeth",
        "timestamp": 1588969870
    },
    {
        "content": "<p>Of course we can specifically detect goals of the form <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"normal\">∥</mi><mi mathvariant=\"normal\">∣</mi><mi>x</mi><mi mathvariant=\"normal\">∥</mi><mi mathvariant=\"normal\">∣</mi><mo>≤</mo><mi>λ</mi><mi mathvariant=\"normal\">∥</mi><mi mathvariant=\"normal\">∣</mi><mi>y</mi><mi mathvariant=\"normal\">∥</mi><mi mathvariant=\"normal\">∣</mi><mo>+</mo><mi>μ</mi><mi mathvariant=\"normal\">∥</mi><mi mathvariant=\"normal\">∣</mi><mi>z</mi><mi mathvariant=\"normal\">∥</mi><mi mathvariant=\"normal\">∣</mi></mrow><annotation encoding=\"application/x-tex\">\\|| x \\|| \\le \\lambda \\||y\\|| + \\mu \\||z\\||</annotation></semantics></math></span><span aria-hidden=\"true\" class=\"katex-html\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">∥</span><span class=\"mord\">∣</span><span class=\"mord mathdefault\">x</span><span class=\"mord\">∥</span><span class=\"mord\">∣</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathdefault\">λ</span><span class=\"mord\">∥</span><span class=\"mord\">∣</span><span class=\"mord mathdefault\" style=\"margin-right:0.03588em;\">y</span><span class=\"mord\">∥</span><span class=\"mord\">∣</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathdefault\">μ</span><span class=\"mord\">∥</span><span class=\"mord\">∣</span><span class=\"mord mathdefault\" style=\"margin-right:0.04398em;\">z</span><span class=\"mord\">∥</span><span class=\"mord\">∣</span></span></span></span>, but that would be a really specialized tactic</p>",
        "id": 196947121,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1588969930
    },
    {
        "content": "<p>and not good for teaching IMO, since I want students to come up with the idea, and Lean to do automatically things that we wouldn't write on paper.</p>",
        "id": 196947196,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1588969965
    },
    {
        "content": "<p>From that point of view linarith is already too smart sometimes. It closes goals that students would have a hard time doing on paper, especially when there are many inequalities floating around</p>",
        "id": 196947252,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1588970005
    },
    {
        "content": "<p>On the other hand I'd love a Groebner basis tactic and that would definitely prove things which non-puzzle-minded undergraduates would find tricky. Sometimes you just want to get on though</p>",
        "id": 196951122,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1588972243
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110031\">Patrick Massot</span> <a href=\"#narrow/stream/187764-Lean-for.20teaching/topic/Real.20analysis/near/196947196\" title=\"#narrow/stream/187764-Lean-for.20teaching/topic/Real.20analysis/near/196947196\">said</a>:</p>\n<blockquote>\n<p>and not good for teaching IMO, since I want students to come up with the idea, and Lean to do automatically things that we wouldn't write on paper.<br>\nFrom that point of view linarith is already too smart sometimes. It closes goals that students would have a hard time doing on paper, especially when there are many inequalities floating around</p>\n</blockquote>\n<p>Thank you for writing this, I had been thinking this but had not quite put it into words.  For <strong>teaching</strong>, I would like to have a set of tactics, which automate everything that the undergraduate finds obvious (let's say, chains of 3 combinations of the field axioms, the ordering axioms, and <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"normal\">∣</mi><mi>a</mi><mi>b</mi><mi mathvariant=\"normal\">∣</mi><mo>=</mo><mi mathvariant=\"normal\">∣</mi><mi>a</mi><mi mathvariant=\"normal\">∣</mi><mi mathvariant=\"normal\">∣</mi><mi>b</mi><mi mathvariant=\"normal\">∣</mi></mrow><annotation encoding=\"application/x-tex\">|ab|=|a||b|</annotation></semantics></math></span><span aria-hidden=\"true\" class=\"katex-html\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">∣</span><span class=\"mord mathdefault\">a</span><span class=\"mord mathdefault\">b</span><span class=\"mord\">∣</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">∣</span><span class=\"mord mathdefault\">a</span><span class=\"mord\">∣</span><span class=\"mord\">∣</span><span class=\"mord mathdefault\">b</span><span class=\"mord\">∣</span></span></span></span>), and nothing else.</p>",
        "id": 196951498,
        "sender_full_name": "Heather Macbeth",
        "timestamp": 1588972446
    },
    {
        "content": "<p>Back to this point ...</p>\n<p><span class=\"user-mention silent\" data-user-id=\"260507\">Heather Macbeth</span> <a href=\"#narrow/stream/187764-Lean-for.20teaching/topic/Real.20analysis/near/196946153\" title=\"#narrow/stream/187764-Lean-for.20teaching/topic/Real.20analysis/near/196946153\">said</a>:</p>\n<blockquote>\n<p>I would like a tactic that works in (say) normed spaces, that will verify facts of the form <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo stretchy=\"false\">∥</mo><mn>2</mn><mi>a</mi><mo>+</mo><mi>b</mi><mo stretchy=\"false\">∥</mo><mo>≤</mo><mn>3</mn><mo stretchy=\"false\">∥</mo><mi>a</mi><mo stretchy=\"false\">∥</mo><mo>+</mo><mo stretchy=\"false\">∥</mo><mi>b</mi><mo>−</mo><mi>a</mi><mo stretchy=\"false\">∥</mo></mrow><annotation encoding=\"application/x-tex\">\\lVert 2a + b\\rVert\\leq 3\\lVert a\\rVert +  \\lVert b-a\\rVert</annotation></semantics></math></span><span aria-hidden=\"true\" class=\"katex-html\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">∥</span><span class=\"mord\">2</span><span class=\"mord mathdefault\">a</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathdefault\">b</span><span class=\"mclose\">∥</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">3</span><span class=\"mopen\">∥</span><span class=\"mord mathdefault\">a</span><span class=\"mclose\">∥</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">∥</span><span class=\"mord mathdefault\">b</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathdefault\">a</span><span class=\"mclose\">∥</span></span></span></span>.</p>\n</blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"110031\">Patrick Massot</span> <a href=\"#narrow/stream/187764-Lean-for.20teaching/topic/Real.20analysis/near/196947121\" title=\"#narrow/stream/187764-Lean-for.20teaching/topic/Real.20analysis/near/196947121\">said</a>:</p>\n<blockquote>\n<p>Of course we can specifically detect goals of the form <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"normal\">∥</mi><mi mathvariant=\"normal\">∣</mi><mi>x</mi><mi mathvariant=\"normal\">∥</mi><mi mathvariant=\"normal\">∣</mi><mo>≤</mo><mi>λ</mi><mi mathvariant=\"normal\">∥</mi><mi mathvariant=\"normal\">∣</mi><mi>y</mi><mi mathvariant=\"normal\">∥</mi><mi mathvariant=\"normal\">∣</mi><mo>+</mo><mi>μ</mi><mi mathvariant=\"normal\">∥</mi><mi mathvariant=\"normal\">∣</mi><mi>z</mi><mi mathvariant=\"normal\">∥</mi><mi mathvariant=\"normal\">∣</mi></mrow><annotation encoding=\"application/x-tex\">\\|| x \\|| \\le \\lambda \\||y\\|| + \\mu \\||z\\||</annotation></semantics></math></span><span aria-hidden=\"true\" class=\"katex-html\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">∥</span><span class=\"mord\">∣</span><span class=\"mord mathdefault\">x</span><span class=\"mord\">∥</span><span class=\"mord\">∣</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathdefault\">λ</span><span class=\"mord\">∥</span><span class=\"mord\">∣</span><span class=\"mord mathdefault\" style=\"margin-right:0.03588em;\">y</span><span class=\"mord\">∥</span><span class=\"mord\">∣</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathdefault\">μ</span><span class=\"mord\">∥</span><span class=\"mord\">∣</span><span class=\"mord mathdefault\" style=\"margin-right:0.04398em;\">z</span><span class=\"mord\">∥</span><span class=\"mord\">∣</span></span></span></span>, but that would be a really specialized tactic</p>\n</blockquote>\n<p>I think you understood what I meant (you are an analyst too), but my dream tactic would not just verify that <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo stretchy=\"false\">∥</mo><mn>2</mn><mi>a</mi><mo>+</mo><mi>b</mi><mo stretchy=\"false\">∥</mo><mo>≤</mo><mn>3</mn><mo stretchy=\"false\">∥</mo><mi>a</mi><mo stretchy=\"false\">∥</mo><mo>+</mo><mo stretchy=\"false\">∥</mo><mi>b</mi><mo>−</mo><mi>a</mi><mo stretchy=\"false\">∥</mo></mrow><annotation encoding=\"application/x-tex\">\\lVert 2a + b\\rVert\\leq 3\\lVert a\\rVert +  \\lVert b-a\\rVert</annotation></semantics></math></span><span aria-hidden=\"true\" class=\"katex-html\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">∥</span><span class=\"mord\">2</span><span class=\"mord mathdefault\">a</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathdefault\">b</span><span class=\"mclose\">∥</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">3</span><span class=\"mopen\">∥</span><span class=\"mord mathdefault\">a</span><span class=\"mclose\">∥</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">∥</span><span class=\"mord mathdefault\">b</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathdefault\">a</span><span class=\"mclose\">∥</span></span></span></span>, but would invent that fact itself, when faced with hypotheses <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo stretchy=\"false\">∥</mo><mi>c</mi><mo stretchy=\"false\">∥</mo><mo>≤</mo><mo stretchy=\"false\">∥</mo><mn>2</mn><mi>a</mi><mo>+</mo><mi>b</mi><mo stretchy=\"false\">∥</mo></mrow><annotation encoding=\"application/x-tex\">\\lVert c\\rVert \\leq \\lVert 2a + b\\rVert</annotation></semantics></math></span><span aria-hidden=\"true\" class=\"katex-html\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">∥</span><span class=\"mord mathdefault\">c</span><span class=\"mclose\">∥</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">∥</span><span class=\"mord\">2</span><span class=\"mord mathdefault\">a</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathdefault\">b</span><span class=\"mclose\">∥</span></span></span></span> and <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo stretchy=\"false\">∥</mo><mi>a</mi><mo stretchy=\"false\">∥</mo><mo>≤</mo><mo stretchy=\"false\">∥</mo><mi>e</mi><mi>f</mi><mo stretchy=\"false\">∥</mo></mrow><annotation encoding=\"application/x-tex\">\\lVert a\\rVert\\leq \\lVert ef\\rVert</annotation></semantics></math></span><span aria-hidden=\"true\" class=\"katex-html\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">∥</span><span class=\"mord mathdefault\">a</span><span class=\"mclose\">∥</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">∥</span><span class=\"mord mathdefault\">e</span><span class=\"mord mathdefault\" style=\"margin-right:0.10764em;\">f</span><span class=\"mclose\">∥</span></span></span></span> (let's say we're in a normed algebra), in order to prove the goal <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo stretchy=\"false\">∥</mo><mi>c</mi><mo stretchy=\"false\">∥</mo><mo>≤</mo><mn>3</mn><mo stretchy=\"false\">∥</mo><mi>e</mi><mo stretchy=\"false\">∥</mo><mo stretchy=\"false\">∥</mo><mi>f</mi><mo stretchy=\"false\">∥</mo><mo>+</mo><mo stretchy=\"false\">∥</mo><mi>b</mi><mo>−</mo><mi>a</mi><mo stretchy=\"false\">∥</mo></mrow><annotation encoding=\"application/x-tex\">\\lVert c\\rVert \\leq 3\\lVert e\\rVert\\lVert f\\rVert + \\lVert b-a\\rVert</annotation></semantics></math></span><span aria-hidden=\"true\" class=\"katex-html\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">∥</span><span class=\"mord mathdefault\">c</span><span class=\"mclose\">∥</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">3</span><span class=\"mopen\">∥</span><span class=\"mord mathdefault\">e</span><span class=\"mclose\">∥</span><span class=\"mopen\">∥</span><span class=\"mord mathdefault\" style=\"margin-right:0.10764em;\">f</span><span class=\"mclose\">∥</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">∥</span><span class=\"mord mathdefault\">b</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathdefault\">a</span><span class=\"mclose\">∥</span></span></span></span>.  But I know there is no algorithm for this.</p>",
        "id": 196952420,
        "sender_full_name": "Heather Macbeth",
        "timestamp": 1588973089
    },
    {
        "content": "<p>I think that a mix of <code>simp</code>, <code>norm_num</code>, <code>linarith</code> and <code>rewrite_search</code> (not yet in mathlib) would get quite far with such a goal. But it would also be slow.</p>",
        "id": 196952778,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1588973387
    },
    {
        "content": "<p>The nice thing is that some of these tactics can print a tactic script that is longer and less elegant, but faster.</p>",
        "id": 196952858,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1588973424
    },
    {
        "content": "<p>This very nice paper may be of interest: <a href=\"https://arxiv.org/abs/0904.3482\" title=\"https://arxiv.org/abs/0904.3482\">https://arxiv.org/abs/0904.3482</a>.</p>",
        "id": 196953463,
        "sender_full_name": "Jeremy Avigad",
        "timestamp": 1588973863
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"110865\">@Jeremy Avigad</span>, thank you for the link.  I am not used to reading logic papers, but is this paper saying that there exists an algorithm which determines the truth of statements like<br>\n<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"normal\">∀</mi><mi>a</mi><mo separator=\"true\">,</mo><mi>b</mi><mo separator=\"true\">,</mo><mi>c</mi><mo separator=\"true\">,</mo><mi>d</mi><mo>∈</mo><mi>V</mi><mo separator=\"true\">,</mo><mo stretchy=\"false\">(</mo><mo stretchy=\"false\">∥</mo><mi>c</mi><mo stretchy=\"false\">∥</mo><mo>≤</mo><mo stretchy=\"false\">∥</mo><mn>2</mn><mi>a</mi><mo>+</mo><mi>b</mi><mo stretchy=\"false\">∥</mo><mo>∧</mo><mo stretchy=\"false\">∥</mo><mi>a</mi><mo stretchy=\"false\">∥</mo><mo>≤</mo><mo stretchy=\"false\">∥</mo><mi>d</mi><mo stretchy=\"false\">∥</mo><mo stretchy=\"false\">)</mo><mo>⇒</mo><mo stretchy=\"false\">(</mo><mo stretchy=\"false\">∥</mo><mi>c</mi><mo stretchy=\"false\">∥</mo><mo>≤</mo><mn>3</mn><mo stretchy=\"false\">∥</mo><mi>d</mi><mo stretchy=\"false\">∥</mo><mo>+</mo><mo stretchy=\"false\">∥</mo><mi>b</mi><mo>−</mo><mi>a</mi><mo stretchy=\"false\">∥</mo><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">\\forall a,b,c,d\\in V,(\\lVert c\\rVert \\leq \\lVert 2a+b\\rVert\\land\\lVert a\\rVert\\leq \\lVert d\\rVert )\\Rightarrow (\\lVert c\\rVert\\leq 3\\lVert d\\rVert +\\lVert b-a\\rVert)</annotation></semantics></math></span><span aria-hidden=\"true\" class=\"katex-html\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8888799999999999em;vertical-align:-0.19444em;\"></span><span class=\"mord\">∀</span><span class=\"mord mathdefault\">a</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathdefault\">b</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathdefault\">c</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathdefault\">d</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">∈</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.22222em;\">V</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mopen\">(</span><span class=\"mopen\">∥</span><span class=\"mord mathdefault\">c</span><span class=\"mclose\">∥</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">∥</span><span class=\"mord\">2</span><span class=\"mord mathdefault\">a</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathdefault\">b</span><span class=\"mclose\">∥</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">∧</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">∥</span><span class=\"mord mathdefault\">a</span><span class=\"mclose\">∥</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">∥</span><span class=\"mord mathdefault\">d</span><span class=\"mclose\">∥</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">⇒</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mopen\">∥</span><span class=\"mord mathdefault\">c</span><span class=\"mclose\">∥</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">3</span><span class=\"mopen\">∥</span><span class=\"mord mathdefault\">d</span><span class=\"mclose\">∥</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">∥</span><span class=\"mord mathdefault\">b</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathdefault\">a</span><span class=\"mclose\">∥</span><span class=\"mclose\">)</span></span></span></span><br>\n?  If so that's everything I asked for except the extension from vector spaces to algebras.</p>",
        "id": 196954791,
        "sender_full_name": "Heather Macbeth",
        "timestamp": 1588974809
    },
    {
        "content": "<p>I think it does suggest that, but it reduces it to the theory of real closed fields, and this is a highly non trivial thing to implement.</p>",
        "id": 196962060,
        "sender_full_name": "Chris Hughes",
        "timestamp": 1588980951
    },
    {
        "content": "<p>In addition to being hard to implement, it's also like doubly exponentially slow, right?</p>",
        "id": 196964823,
        "sender_full_name": "Jalex Stark",
        "timestamp": 1588984373
    },
    {
        "content": "<p>(on the topic of proving inequalities, <a href=\"http://theory.stanford.edu/~valiant/papers/instanceOpt.pdf\" title=\"http://theory.stanford.edu/~valiant/papers/instanceOpt.pdf\">this paper</a> has a nice algorithm for a broad class of cauchy-schwartz-like inequalities)</p>",
        "id": 196964911,
        "sender_full_name": "Jalex Stark",
        "timestamp": 1588984469
    },
    {
        "content": "<p>Yeah, but e^e^3 still isn't very big, and the examples in practice are only that big.</p>",
        "id": 196964915,
        "sender_full_name": "Chris Hughes",
        "timestamp": 1588984492
    },
    {
        "content": "<p>I don't think humans are any better than double exponential.</p>",
        "id": 196964926,
        "sender_full_name": "Chris Hughes",
        "timestamp": 1588984511
    },
    {
        "content": "<p>I think it would be magical (and I don't see any limitation other than engineer hours, which is to say it's not happening anytime soon) to have a server that runs an expensive algorithm like this and memorizes all the queries it's received together with a witness that is much cheaper to check than running the algorithm</p>",
        "id": 196965006,
        "sender_full_name": "Jalex Stark",
        "timestamp": 1588984643
    },
    {
        "content": "<p>Instructive, thanks!</p>",
        "id": 196965965,
        "sender_full_name": "Heather Macbeth",
        "timestamp": 1588986129
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"252300\">@Jalex Stark</span> Are there good witnesses for real closed fields? If you use terms to inhabit the existentials, you can probably bring it down to the quantifier free part but I think it's still pretty hard from there</p>",
        "id": 196974327,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1589001126
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110031\">Patrick Massot</span> <a href=\"#narrow/stream/187764-Lean-for.20teaching/topic/Real.20analysis/near/196946132\" title=\"#narrow/stream/187764-Lean-for.20teaching/topic/Real.20analysis/near/196946132\">said</a>:</p>\n<blockquote>\n<blockquote>\n<p>Wow, I did not know that this chat room was \"ask and you shall receive\" :)</p>\n</blockquote>\n<p>Sometimes it works surprisingly well</p>\n</blockquote>\n<p><a href=\"https://github.com/leanprover-community/mathlib/issues/2637\" title=\"https://github.com/leanprover-community/mathlib/issues/2637\">https://github.com/leanprover-community/mathlib/issues/2637</a></p>",
        "id": 196986598,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1589023068
    },
    {
        "content": "<p>(deleted)</p>",
        "id": 196986648,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1589023109
    },
    {
        "content": "<p>hmm. I guess I come from a world where every proof can be made exponentially shorter by using a PCP. <br>\nbut I guess we need deterministic proofs, and  I don't have any particular ideas here.</p>",
        "id": 196988216,
        "sender_full_name": "Jalex Stark",
        "timestamp": 1589025345
    },
    {
        "content": "<p>I like nondeterministic proofs</p>",
        "id": 196988374,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1589025525
    },
    {
        "content": "<p>To put it another way, I'm specifically interested in whether there is an NP algorithm for real closed fields that is faster than double exponential</p>",
        "id": 196988435,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1589025605
    },
    {
        "content": "<p>Okay, so we have a doubly-exponential NP-type proof, which is just a transcript of the deterministic algorithm. Standard pcp machinery can give us a pcp of the same length. That's a doubly-exponentially long proof string such that if the theorem is false, then you can find a hole with constant probability by checking only a constant number of random locations. Of course, checking a random location in a doubly-exponentially long string requires exponentially much randomness.</p>",
        "id": 196989628,
        "sender_full_name": "Jalex Stark",
        "timestamp": 1589027568
    },
    {
        "content": "<p>what does pcp stand for here? I thought it was post correspondence problem but I don't see the relation</p>",
        "id": 196989702,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1589027649
    },
    {
        "content": "<p>Probabilistically checkable proof</p>",
        "id": 196989726,
        "sender_full_name": "Jalex Stark",
        "timestamp": 1589027756
    },
    {
        "content": "<p>I edited out the false thing above, which makes the already-not-good-enough thing a bit worse</p>",
        "id": 196989772,
        "sender_full_name": "Jalex Stark",
        "timestamp": 1589027790
    },
    {
        "content": "<p>Oh I see. I think these aren't good enough for lean, even with an oracle (the human, or mathematica, etc)</p>",
        "id": 196989779,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1589027822
    },
    {
        "content": "<p>okay, that's sad but also what I expected</p>",
        "id": 196990683,
        "sender_full_name": "Jalex Stark",
        "timestamp": 1589029313
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110031\">Patrick Massot</span> <a href=\"#narrow/stream/187764-Lean-for.20teaching/topic/Real.20analysis/near/196986598\" title=\"#narrow/stream/187764-Lean-for.20teaching/topic/Real.20analysis/near/196986598\">said</a>:</p>\n<blockquote>\n<blockquote>\n<blockquote>\n<p>Wow, I did not know that this chat room was \"ask and you shall receive\" :)</p>\n</blockquote>\n<p>Sometimes it works surprisingly well</p>\n</blockquote>\n<p><a href=\"https://github.com/leanprover-community/mathlib/issues/2637\" title=\"https://github.com/leanprover-community/mathlib/issues/2637\">https://github.com/leanprover-community/mathlib/issues/2637</a></p>\n</blockquote>\n<p>So cool, thank you!!</p>",
        "id": 197002571,
        "sender_full_name": "Heather Macbeth",
        "timestamp": 1589045330
    },
    {
        "content": "<p>I keep meaning to do these Coq projects in Lean but marking keeps getting in the way :-(. I think the way I would do the first one would be to prove that the limit of <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mfrac><mrow><msup><mi>n</mi><mn>4</mn></msup><mo>−</mo><mn>3</mn><mi>n</mi><mo>+</mo><mn>3</mn></mrow><msup><mi>n</mi><mn>4</mn></msup></mfrac></mrow><annotation encoding=\"application/x-tex\">\\frac{n^4-3n+3}{n^4}</annotation></semantics></math></span><span aria-hidden=\"true\" class=\"katex-html\"><span class=\"base\"><span class=\"strut\" style=\"height:1.36292em;vertical-align:-0.345em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.01792em;\"><span style=\"top:-2.6550000000000002em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\"><span class=\"mord mathdefault mtight\">n</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7463142857142857em;\"><span style=\"top:-2.786em;margin-right:0.07142857142857144em;\"><span class=\"pstrut\" style=\"height:2.5em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mtight\">4</span></span></span></span></span></span></span></span></span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.394em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\"><span class=\"mord mathdefault mtight\">n</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8913142857142857em;\"><span style=\"top:-2.931em;margin-right:0.07142857142857144em;\"><span class=\"pstrut\" style=\"height:2.5em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mtight\">4</span></span></span></span></span></span></span></span><span class=\"mbin mtight\">−</span><span class=\"mord mtight\">3</span><span class=\"mord mathdefault mtight\">n</span><span class=\"mbin mtight\">+</span><span class=\"mord mtight\">3</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.345em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span></span></span></span> is 1 and then use the calculus of limits to reduce the question to finding the limit of <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mfrac><mrow><mo stretchy=\"false\">(</mo><mo>−</mo><mn>1</mn><msup><mo stretchy=\"false\">)</mo><mi>n</mi></msup><mi>n</mi><mo>+</mo><mn>5</mn></mrow><msup><mi>n</mi><mn>4</mn></msup></mfrac></mrow><annotation encoding=\"application/x-tex\">\\frac{(-1)^nn+5}{n^4}</annotation></semantics></math></span><span aria-hidden=\"true\" class=\"katex-html\"><span class=\"base\"><span class=\"strut\" style=\"height:1.355em;vertical-align:-0.345em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.01em;\"><span style=\"top:-2.6550000000000002em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\"><span class=\"mord mathdefault mtight\">n</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7463142857142857em;\"><span style=\"top:-2.786em;margin-right:0.07142857142857144em;\"><span class=\"pstrut\" style=\"height:2.5em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mtight\">4</span></span></span></span></span></span></span></span></span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.485em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mopen mtight\">(</span><span class=\"mord mtight\">−</span><span class=\"mord mtight\">1</span><span class=\"mclose mtight\"><span class=\"mclose mtight\">)</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7385428571428572em;\"><span style=\"top:-2.931em;margin-right:0.07142857142857144em;\"><span class=\"pstrut\" style=\"height:2.5em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mathdefault mtight\">n</span></span></span></span></span></span></span></span><span class=\"mord mathdefault mtight\">n</span><span class=\"mbin mtight\">+</span><span class=\"mord mtight\">5</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.345em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span></span></span></span>. In general I think I would want a lemma saying that if <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>p</mi><mo stretchy=\"false\">(</mo><mi>x</mi><mo stretchy=\"false\">)</mo><mo>∈</mo><mi mathvariant=\"double-struck\">R</mi><mo stretchy=\"false\">[</mo><mi>x</mi><mo stretchy=\"false\">]</mo></mrow><annotation encoding=\"application/x-tex\">p(x)\\in\\R[x]</annotation></semantics></math></span><span aria-hidden=\"true\" class=\"katex-html\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathdefault\">p</span><span class=\"mopen\">(</span><span class=\"mord mathdefault\">x</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">∈</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\"><span class=\"mord mathbb\">R</span></span><span class=\"mopen\">[</span><span class=\"mord mathdefault\">x</span><span class=\"mclose\">]</span></span></span></span> has degree <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>d</mi></mrow><annotation encoding=\"application/x-tex\">d</annotation></semantics></math></span><span aria-hidden=\"true\" class=\"katex-html\"><span class=\"base\"><span class=\"strut\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">d</span></span></span></span> then the limit of <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mfrac><mrow><mi>p</mi><mo stretchy=\"false\">(</mo><mi>n</mi><mo stretchy=\"false\">)</mo></mrow><msup><mi>n</mi><mi>d</mi></msup></mfrac></mrow><annotation encoding=\"application/x-tex\">\\frac{p(n)}{n^d}</annotation></semantics></math></span><span aria-hidden=\"true\" class=\"katex-html\"><span class=\"base\"><span class=\"strut\" style=\"height:1.3674199999999999em;vertical-align:-0.3574199999999999em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.01em;\"><span style=\"top:-2.64258em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\"><span class=\"mord mathdefault mtight\">n</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7820285714285713em;\"><span style=\"top:-2.786em;margin-right:0.07142857142857144em;\"><span class=\"pstrut\" style=\"height:2.5em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mathdefault mtight\">d</span></span></span></span></span></span></span></span></span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.485em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathdefault mtight\">p</span><span class=\"mopen mtight\">(</span><span class=\"mord mathdefault mtight\">n</span><span class=\"mclose mtight\">)</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3574199999999999em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span></span></span></span> is the leading term of <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>p</mi></mrow><annotation encoding=\"application/x-tex\">p</annotation></semantics></math></span><span aria-hidden=\"true\" class=\"katex-html\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.19444em;\"></span><span class=\"mord mathdefault\">p</span></span></span></span>. If these things aren't in the library I'm going to have to start getting my hands dirty. But this seems to be a nice way to a \"conceptual\" proof of the projects.</p>",
        "id": 197061677,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1589124711
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"110064\">@Kenny Lau</span> how would you do this <a href=\"#narrow/stream/187764-Lean-for.20teaching/topic/Real.20analysis/near/196926867\" title=\"#narrow/stream/187764-Lean-for.20teaching/topic/Real.20analysis/near/196926867\">https://leanprover.zulipchat.com/#narrow/stream/187764-Lean-for.20teaching/topic/Real.20analysis/near/196926867</a> in Lean?</p>",
        "id": 197061730,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1589124761
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"260507\">Heather Macbeth</span> <a href=\"#narrow/stream/187764-Lean-for.20teaching/topic/Real.20analysis/near/197002571\">said</a>:</p>\n<blockquote>\n<blockquote>\n<p><a href=\"https://github.com/leanprover-community/mathlib/issues/2637\">https://github.com/leanprover-community/mathlib/issues/2637</a></p>\n</blockquote>\n<p>So cool, thank you!!</p>\n</blockquote>\n<p>It would be nice if you could give us a list of half a dozen goals the Coq version can solve (and you find useful if possible) so they can be added as tests to the Lean version.</p>",
        "id": 197258593,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1589280581
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"110031\">@Patrick Massot</span> , how is this for a start?  Adapted from my student's proof that products preserve limits.  Let me know if the tests should be more or less focused than this (eg is it useful to have irrelevant hypotheses, random function applications that the parser has to treat as blocks, etc?  Or should the examples be truly minimal?)</p>\n<p>In Coq, using <code>nra</code>, I can do</p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"n\">Lemma</span> <span class=\"n\">test</span> <span class=\"o\">(</span><span class=\"n\">u</span> <span class=\"n\">v</span> <span class=\"n\">x</span> <span class=\"n\">y</span> <span class=\"n\">A</span> <span class=\"n\">B</span> <span class=\"o\">:</span> <span class=\"n\">R</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"o\">(</span><span class=\"mi\">0</span> <span class=\"bp\">&lt;</span> <span class=\"n\">A</span><span class=\"o\">)</span> <span class=\"bp\">-&gt;</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"bp\">&lt;=</span> <span class=\"mi\">1</span><span class=\"o\">)</span> <span class=\"bp\">-&gt;</span> <span class=\"o\">(</span><span class=\"mi\">1</span> <span class=\"bp\">&lt;=</span> <span class=\"n\">B</span><span class=\"o\">)</span>\n<span class=\"bp\">-&gt;</span> <span class=\"o\">(</span><span class=\"n\">x</span> <span class=\"bp\">&lt;=</span> <span class=\"n\">B</span><span class=\"o\">)</span> <span class=\"bp\">-&gt;</span> <span class=\"o\">(</span> <span class=\"n\">y</span> <span class=\"bp\">&lt;=</span> <span class=\"n\">B</span><span class=\"o\">)</span>\n<span class=\"bp\">-&gt;</span> <span class=\"o\">(</span><span class=\"mi\">0</span> <span class=\"bp\">&lt;=</span> <span class=\"n\">u</span> <span class=\"o\">)</span> <span class=\"bp\">-&gt;</span> <span class=\"o\">(</span><span class=\"mi\">0</span> <span class=\"bp\">&lt;=</span> <span class=\"n\">v</span> <span class=\"o\">)</span>\n<span class=\"bp\">-&gt;</span> <span class=\"o\">(</span><span class=\"n\">u</span> <span class=\"bp\">&lt;</span> <span class=\"n\">A</span><span class=\"o\">)</span> <span class=\"bp\">-&gt;</span> <span class=\"o\">(</span> <span class=\"n\">v</span> <span class=\"bp\">&lt;</span> <span class=\"n\">A</span><span class=\"o\">)</span>\n<span class=\"bp\">-&gt;</span> <span class=\"o\">(</span><span class=\"n\">u</span> <span class=\"bp\">*</span> <span class=\"n\">y</span> <span class=\"bp\">+</span> <span class=\"n\">v</span> <span class=\"bp\">*</span> <span class=\"n\">x</span> <span class=\"bp\">+</span> <span class=\"n\">u</span> <span class=\"bp\">*</span> <span class=\"n\">v</span> <span class=\"bp\">&lt;</span> <span class=\"mi\">3</span> <span class=\"bp\">*</span> <span class=\"n\">A</span> <span class=\"bp\">*</span> <span class=\"n\">B</span><span class=\"o\">)</span><span class=\"bp\">.</span>\n<span class=\"n\">Proof</span><span class=\"bp\">.</span>\n  <span class=\"n\">nra</span><span class=\"bp\">.</span>\n<span class=\"n\">Qed</span><span class=\"bp\">.</span>\n</code></pre></div>\n\n\n<p>The best I can figure out in Lean (without the new <code>nlinarith</code>) is</p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"kn\">example</span> <span class=\"o\">(</span><span class=\"n\">u</span> <span class=\"n\">v</span> <span class=\"n\">x</span> <span class=\"n\">y</span> <span class=\"n\">A</span> <span class=\"n\">B</span> <span class=\"o\">:</span> <span class=\"n\">ℝ</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"o\">(</span><span class=\"mi\">0</span> <span class=\"bp\">&lt;</span> <span class=\"n\">A</span><span class=\"o\">)</span> <span class=\"bp\">→</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"bp\">≤</span> <span class=\"mi\">1</span><span class=\"o\">)</span> <span class=\"bp\">→</span> <span class=\"o\">(</span><span class=\"mi\">1</span> <span class=\"bp\">≤</span> <span class=\"n\">B</span><span class=\"o\">)</span>\n<span class=\"bp\">→</span> <span class=\"o\">(</span><span class=\"n\">x</span> <span class=\"bp\">≤</span> <span class=\"n\">B</span><span class=\"o\">)</span> <span class=\"bp\">→</span> <span class=\"o\">(</span> <span class=\"n\">y</span> <span class=\"bp\">≤</span> <span class=\"n\">B</span><span class=\"o\">)</span>\n<span class=\"bp\">→</span> <span class=\"o\">(</span><span class=\"mi\">0</span> <span class=\"bp\">≤</span> <span class=\"n\">u</span> <span class=\"o\">)</span> <span class=\"bp\">→</span> <span class=\"o\">(</span><span class=\"mi\">0</span> <span class=\"bp\">≤</span> <span class=\"n\">v</span> <span class=\"o\">)</span>\n<span class=\"bp\">→</span> <span class=\"o\">(</span><span class=\"n\">u</span> <span class=\"bp\">&lt;</span> <span class=\"n\">A</span><span class=\"o\">)</span> <span class=\"bp\">→</span> <span class=\"o\">(</span> <span class=\"n\">v</span> <span class=\"bp\">&lt;</span> <span class=\"n\">A</span><span class=\"o\">)</span>\n<span class=\"bp\">→</span> <span class=\"o\">(</span><span class=\"n\">u</span> <span class=\"bp\">*</span> <span class=\"n\">y</span> <span class=\"bp\">+</span> <span class=\"n\">v</span> <span class=\"bp\">*</span> <span class=\"n\">x</span> <span class=\"bp\">+</span> <span class=\"n\">u</span> <span class=\"bp\">*</span> <span class=\"n\">v</span> <span class=\"bp\">&lt;</span> <span class=\"mi\">3</span> <span class=\"bp\">*</span> <span class=\"n\">A</span> <span class=\"bp\">*</span> <span class=\"n\">B</span><span class=\"o\">)</span> <span class=\"o\">:=</span>\n<span class=\"k\">begin</span>\n  <span class=\"n\">intros</span><span class=\"o\">,</span>\n  <span class=\"k\">have</span> <span class=\"n\">h1</span> <span class=\"o\">:</span> <span class=\"mi\">0</span> <span class=\"bp\">≤</span> <span class=\"n\">B</span> <span class=\"o\">:=</span> <span class=\"k\">by</span> <span class=\"n\">linarith</span><span class=\"o\">,</span>\n  <span class=\"k\">have</span> <span class=\"n\">h2</span> <span class=\"o\">:</span> <span class=\"mi\">0</span> <span class=\"bp\">≤</span> <span class=\"n\">A</span> <span class=\"o\">:=</span> <span class=\"k\">by</span> <span class=\"n\">linarith</span><span class=\"o\">,</span>\n  <span class=\"k\">calc</span> <span class=\"n\">u</span> <span class=\"bp\">*</span> <span class=\"n\">y</span> <span class=\"bp\">+</span> <span class=\"n\">v</span> <span class=\"bp\">*</span> <span class=\"n\">x</span> <span class=\"bp\">+</span> <span class=\"n\">u</span> <span class=\"bp\">*</span> <span class=\"n\">v</span>\n    <span class=\"bp\">=</span> <span class=\"n\">u</span> <span class=\"bp\">*</span> <span class=\"n\">y</span> <span class=\"bp\">+</span> <span class=\"o\">(</span> <span class=\"n\">v</span> <span class=\"bp\">*</span> <span class=\"n\">x</span> <span class=\"bp\">+</span> <span class=\"n\">u</span> <span class=\"bp\">*</span> <span class=\"n\">v</span> <span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"k\">by</span> <span class=\"n\">ring</span>\n  <span class=\"bp\">...</span> <span class=\"bp\">≤</span> <span class=\"n\">u</span> <span class=\"bp\">*</span> <span class=\"n\">B</span> <span class=\"bp\">+</span> <span class=\"o\">(</span> <span class=\"n\">v</span> <span class=\"bp\">*</span> <span class=\"n\">x</span> <span class=\"bp\">+</span> <span class=\"n\">u</span> <span class=\"bp\">*</span> <span class=\"n\">v</span> <span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">add_le_add_right&#39;</span> <span class=\"o\">(</span><span class=\"n\">mul_le_mul_of_nonneg_left</span> <span class=\"n\">a_4</span> <span class=\"n\">a_5</span><span class=\"o\">)</span>\n  <span class=\"bp\">...</span> <span class=\"bp\">≤</span> <span class=\"n\">A</span> <span class=\"bp\">*</span> <span class=\"n\">B</span> <span class=\"bp\">+</span> <span class=\"o\">(</span> <span class=\"n\">v</span> <span class=\"bp\">*</span> <span class=\"n\">x</span> <span class=\"bp\">+</span> <span class=\"n\">u</span> <span class=\"bp\">*</span> <span class=\"n\">v</span> <span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">add_le_add_right&#39;</span> <span class=\"o\">(</span><span class=\"n\">mul_le_mul_of_nonneg_right</span> <span class=\"o\">(</span><span class=\"n\">le_of_lt</span> <span class=\"n\">a_7</span><span class=\"o\">)</span> <span class=\"n\">h1</span><span class=\"o\">)</span>\n  <span class=\"bp\">...</span> <span class=\"bp\">=</span> <span class=\"n\">v</span> <span class=\"bp\">*</span> <span class=\"n\">x</span> <span class=\"bp\">+</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"bp\">*</span> <span class=\"n\">B</span> <span class=\"bp\">+</span> <span class=\"n\">u</span> <span class=\"bp\">*</span> <span class=\"n\">v</span> <span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"k\">by</span> <span class=\"n\">ring</span>\n  <span class=\"bp\">...</span> <span class=\"bp\">≤</span> <span class=\"n\">v</span> <span class=\"bp\">*</span> <span class=\"n\">B</span> <span class=\"bp\">+</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"bp\">*</span> <span class=\"n\">B</span> <span class=\"bp\">+</span> <span class=\"n\">u</span> <span class=\"bp\">*</span> <span class=\"n\">v</span> <span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">add_le_add_right&#39;</span> <span class=\"o\">(</span><span class=\"n\">mul_le_mul_of_nonneg_left</span> <span class=\"n\">a_3</span> <span class=\"n\">a_6</span><span class=\"o\">)</span>\n  <span class=\"bp\">...</span> <span class=\"bp\">≤</span> <span class=\"n\">A</span> <span class=\"bp\">*</span> <span class=\"n\">B</span> <span class=\"bp\">+</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"bp\">*</span> <span class=\"n\">B</span> <span class=\"bp\">+</span> <span class=\"n\">u</span> <span class=\"bp\">*</span> <span class=\"n\">v</span> <span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">add_le_add_right&#39;</span> <span class=\"o\">(</span><span class=\"n\">mul_le_mul_of_nonneg_right</span> <span class=\"o\">(</span><span class=\"n\">le_of_lt</span> <span class=\"n\">a_8</span><span class=\"o\">)</span> <span class=\"n\">h1</span><span class=\"o\">)</span>\n  <span class=\"bp\">...</span> <span class=\"bp\">=</span> <span class=\"n\">u</span> <span class=\"bp\">*</span> <span class=\"n\">v</span> <span class=\"bp\">+</span> <span class=\"mi\">2</span> <span class=\"bp\">*</span> <span class=\"n\">A</span> <span class=\"bp\">*</span> <span class=\"n\">B</span><span class=\"o\">:</span> <span class=\"k\">by</span> <span class=\"n\">ring</span>\n  <span class=\"bp\">...</span> <span class=\"bp\">≤</span> <span class=\"n\">A</span> <span class=\"bp\">*</span> <span class=\"n\">v</span> <span class=\"bp\">+</span> <span class=\"mi\">2</span> <span class=\"bp\">*</span> <span class=\"n\">A</span> <span class=\"bp\">*</span> <span class=\"n\">B</span> <span class=\"o\">:</span> <span class=\"n\">add_le_add_right&#39;</span> <span class=\"o\">(</span><span class=\"n\">mul_le_mul_of_nonneg_right</span> <span class=\"o\">(</span><span class=\"n\">le_of_lt</span> <span class=\"n\">a_7</span><span class=\"o\">)</span> <span class=\"n\">a_6</span><span class=\"o\">)</span>\n  <span class=\"bp\">...</span> <span class=\"bp\">≤</span> <span class=\"mi\">1</span> <span class=\"bp\">*</span> <span class=\"n\">v</span> <span class=\"bp\">+</span> <span class=\"mi\">2</span> <span class=\"bp\">*</span> <span class=\"n\">A</span> <span class=\"bp\">*</span> <span class=\"n\">B</span> <span class=\"o\">:</span> <span class=\"n\">add_le_add_right&#39;</span> <span class=\"o\">(</span><span class=\"n\">mul_le_mul_of_nonneg_right</span> <span class=\"n\">a_1</span> <span class=\"n\">a_6</span><span class=\"o\">)</span>\n  <span class=\"bp\">...</span> <span class=\"bp\">&lt;</span> <span class=\"mi\">1</span> <span class=\"bp\">*</span> <span class=\"n\">A</span> <span class=\"bp\">+</span> <span class=\"mi\">2</span> <span class=\"bp\">*</span> <span class=\"n\">A</span> <span class=\"bp\">*</span> <span class=\"n\">B</span> <span class=\"o\">:</span> <span class=\"k\">by</span> <span class=\"n\">linarith</span>\n  <span class=\"bp\">...</span> <span class=\"bp\">≤</span> <span class=\"n\">B</span> <span class=\"bp\">*</span> <span class=\"n\">A</span> <span class=\"bp\">+</span> <span class=\"mi\">2</span> <span class=\"bp\">*</span> <span class=\"n\">A</span> <span class=\"bp\">*</span> <span class=\"n\">B</span> <span class=\"o\">:</span> <span class=\"n\">add_le_add_right&#39;</span> <span class=\"o\">(</span><span class=\"n\">mul_le_mul_of_nonneg_right</span> <span class=\"n\">a_2</span> <span class=\"n\">h2</span><span class=\"o\">)</span>\n  <span class=\"bp\">...</span> <span class=\"bp\">=</span> <span class=\"mi\">3</span> <span class=\"bp\">*</span> <span class=\"n\">A</span> <span class=\"bp\">*</span> <span class=\"n\">B</span> <span class=\"o\">:</span> <span class=\"k\">by</span> <span class=\"n\">ring</span><span class=\"o\">,</span>\n<span class=\"kn\">end</span>\n</code></pre></div>\n\n\n<p>(I would also be interested to hear if there are any tricks that would shorten the above proof.)</p>",
        "id": 197345103,
        "sender_full_name": "Heather Macbeth",
        "timestamp": 1589320569
    },
    {
        "content": "<p>Yes, this is a very good start.</p>",
        "id": 197346096,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1589321112
    },
    {
        "content": "<p>(a few edits to the above, as </p>\n<blockquote>\n<p>The best I can figure out in Lean</p>\n</blockquote>\n<p>improves)</p>",
        "id": 197346208,
        "sender_full_name": "Heather Macbeth",
        "timestamp": 1589321166
    },
    {
        "content": "<p>I don't know if you noticed, but you can follow the conversation at <a href=\"https://github.com/leanprover-community/mathlib/pull/2637\">https://github.com/leanprover-community/mathlib/pull/2637</a></p>",
        "id": 197346315,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1589321244
    },
    {
        "content": "<p>About your Lean code, you probably missed the fact you can feed <code>linarith</code> a list of facts to use.</p>",
        "id": 197346481,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1589321367
    },
    {
        "content": "<p>So <code>linarith</code> would replace the explicit <code>add_le_add_right'</code> invocations, is that correct?</p>",
        "id": 197346625,
        "sender_full_name": "Heather Macbeth",
        "timestamp": 1589321438
    },
    {
        "content": "<p>Yes</p>",
        "id": 197346660,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1589321455
    },
    {
        "content": "<p>For instance you can begin your <code>calc</code> with</p>\n<div class=\"codehilite\"><pre><span></span><code>  <span class=\"k\">calc</span> <span class=\"n\">u</span> <span class=\"bp\">*</span> <span class=\"n\">y</span> <span class=\"bp\">+</span> <span class=\"n\">v</span> <span class=\"bp\">*</span> <span class=\"n\">x</span> <span class=\"bp\">+</span> <span class=\"n\">u</span> <span class=\"bp\">*</span> <span class=\"n\">v</span>\n      <span class=\"bp\">≤</span> <span class=\"n\">v</span> <span class=\"bp\">*</span> <span class=\"n\">x</span> <span class=\"bp\">+</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"bp\">*</span> <span class=\"n\">B</span> <span class=\"bp\">+</span> <span class=\"n\">u</span> <span class=\"bp\">*</span> <span class=\"n\">v</span> <span class=\"o\">)</span> <span class=\"o\">:</span>  <span class=\"k\">by</span> <span class=\"n\">linarith</span> <span class=\"o\">[</span><span class=\"n\">mul_le_mul_of_nonneg_left</span> <span class=\"n\">a_4</span> <span class=\"n\">a_5</span><span class=\"o\">,</span> <span class=\"n\">mul_le_mul_of_nonneg_right</span> <span class=\"o\">(</span><span class=\"n\">le_of_lt</span> <span class=\"n\">a_7</span><span class=\"o\">)</span> <span class=\"n\">h1</span><span class=\"o\">]</span>\n</code></pre></div>",
        "id": 197346682,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1589321473
    },
    {
        "content": "<p>But this is still crappy. We really need that new tactic here</p>",
        "id": 197346719,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1589321495
    },
    {
        "content": "<p>Still, that's better, thanks!</p>",
        "id": 197346821,
        "sender_full_name": "Heather Macbeth",
        "timestamp": 1589321566
    },
    {
        "content": "<p>Here's what I can reduce to using the trick you told me.  It's interesting to me that two invocations of <code>ring</code> cannot be removed.  I had thought that <code>linarith</code> subsumed <code>ring</code>, but it seems not.</p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"k\">begin</span>\n  <span class=\"n\">intros</span><span class=\"o\">,</span>\n  <span class=\"k\">have</span> <span class=\"n\">h1</span> <span class=\"o\">:</span> <span class=\"mi\">0</span> <span class=\"bp\">≤</span> <span class=\"n\">B</span> <span class=\"o\">:=</span> <span class=\"k\">by</span> <span class=\"n\">linarith</span><span class=\"o\">,</span>\n  <span class=\"k\">have</span> <span class=\"n\">h2</span> <span class=\"o\">:</span> <span class=\"mi\">0</span> <span class=\"bp\">≤</span> <span class=\"n\">A</span> <span class=\"o\">:=</span> <span class=\"k\">by</span> <span class=\"n\">linarith</span><span class=\"o\">,</span>\n  <span class=\"k\">calc</span> <span class=\"n\">u</span> <span class=\"bp\">*</span> <span class=\"n\">y</span> <span class=\"bp\">+</span> <span class=\"n\">v</span> <span class=\"bp\">*</span> <span class=\"n\">x</span> <span class=\"bp\">+</span> <span class=\"n\">u</span> <span class=\"bp\">*</span> <span class=\"n\">v</span>\n      <span class=\"bp\">≤</span> <span class=\"n\">u</span> <span class=\"bp\">*</span> <span class=\"n\">B</span> <span class=\"bp\">+</span> <span class=\"o\">(</span><span class=\"n\">v</span> <span class=\"bp\">*</span> <span class=\"n\">x</span> <span class=\"bp\">+</span> <span class=\"n\">u</span> <span class=\"bp\">*</span> <span class=\"n\">v</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"k\">by</span> <span class=\"n\">linarith</span> <span class=\"o\">[</span><span class=\"n\">mul_le_mul_of_nonneg_left</span> <span class=\"n\">a_4</span> <span class=\"n\">a_5</span><span class=\"o\">]</span>\n  <span class=\"bp\">...</span> <span class=\"bp\">≤</span> <span class=\"n\">A</span> <span class=\"bp\">*</span> <span class=\"n\">B</span> <span class=\"bp\">+</span> <span class=\"o\">(</span><span class=\"n\">v</span> <span class=\"bp\">*</span> <span class=\"n\">x</span> <span class=\"bp\">+</span> <span class=\"n\">u</span> <span class=\"bp\">*</span> <span class=\"n\">v</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"k\">by</span> <span class=\"n\">linarith</span> <span class=\"o\">[</span><span class=\"n\">mul_le_mul_of_nonneg_right</span> <span class=\"o\">(</span><span class=\"n\">le_of_lt</span> <span class=\"n\">a_7</span><span class=\"o\">)</span> <span class=\"n\">h1</span><span class=\"o\">]</span>\n  <span class=\"bp\">...</span> <span class=\"bp\">≤</span> <span class=\"n\">v</span> <span class=\"bp\">*</span> <span class=\"n\">B</span> <span class=\"bp\">+</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"bp\">*</span> <span class=\"n\">B</span> <span class=\"bp\">+</span> <span class=\"n\">u</span> <span class=\"bp\">*</span> <span class=\"n\">v</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"k\">by</span> <span class=\"n\">linarith</span> <span class=\"o\">[</span><span class=\"n\">mul_le_mul_of_nonneg_left</span> <span class=\"n\">a_3</span> <span class=\"n\">a_6</span><span class=\"o\">]</span>\n  <span class=\"bp\">...</span> <span class=\"bp\">≤</span> <span class=\"n\">A</span> <span class=\"bp\">*</span> <span class=\"n\">B</span> <span class=\"bp\">+</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"bp\">*</span> <span class=\"n\">B</span> <span class=\"bp\">+</span> <span class=\"n\">u</span> <span class=\"bp\">*</span> <span class=\"n\">v</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"k\">by</span> <span class=\"n\">linarith</span> <span class=\"o\">[</span><span class=\"n\">mul_le_mul_of_nonneg_right</span> <span class=\"o\">(</span><span class=\"n\">le_of_lt</span> <span class=\"n\">a_8</span><span class=\"o\">)</span> <span class=\"n\">h1</span><span class=\"o\">]</span>\n  <span class=\"bp\">...</span> <span class=\"bp\">=</span> <span class=\"n\">u</span> <span class=\"bp\">*</span> <span class=\"n\">v</span> <span class=\"bp\">+</span> <span class=\"mi\">2</span> <span class=\"bp\">*</span> <span class=\"n\">A</span> <span class=\"bp\">*</span> <span class=\"n\">B</span><span class=\"o\">:</span> <span class=\"k\">by</span> <span class=\"n\">ring</span>\n  <span class=\"bp\">...</span> <span class=\"bp\">≤</span> <span class=\"n\">A</span> <span class=\"bp\">*</span> <span class=\"n\">v</span> <span class=\"bp\">+</span> <span class=\"mi\">2</span> <span class=\"bp\">*</span> <span class=\"n\">A</span> <span class=\"bp\">*</span> <span class=\"n\">B</span> <span class=\"o\">:</span> <span class=\"k\">by</span> <span class=\"n\">linarith</span> <span class=\"o\">[</span><span class=\"n\">mul_le_mul_of_nonneg_right</span> <span class=\"o\">(</span><span class=\"n\">le_of_lt</span> <span class=\"n\">a_7</span><span class=\"o\">)</span> <span class=\"n\">a_6</span><span class=\"o\">]</span>\n  <span class=\"bp\">...</span> <span class=\"bp\">≤</span> <span class=\"mi\">1</span> <span class=\"bp\">*</span> <span class=\"n\">v</span> <span class=\"bp\">+</span> <span class=\"mi\">2</span> <span class=\"bp\">*</span> <span class=\"n\">A</span> <span class=\"bp\">*</span> <span class=\"n\">B</span> <span class=\"o\">:</span> <span class=\"k\">by</span> <span class=\"n\">linarith</span> <span class=\"o\">[</span><span class=\"n\">mul_le_mul_of_nonneg_right</span> <span class=\"n\">a_1</span> <span class=\"n\">a_6</span><span class=\"o\">]</span>\n  <span class=\"bp\">...</span> <span class=\"bp\">&lt;</span> <span class=\"n\">B</span> <span class=\"bp\">*</span> <span class=\"n\">A</span> <span class=\"bp\">+</span> <span class=\"mi\">2</span> <span class=\"bp\">*</span> <span class=\"n\">A</span> <span class=\"bp\">*</span> <span class=\"n\">B</span> <span class=\"o\">:</span> <span class=\"k\">by</span> <span class=\"n\">linarith</span> <span class=\"o\">[</span><span class=\"n\">mul_le_mul_of_nonneg_right</span> <span class=\"n\">a_2</span> <span class=\"n\">h2</span><span class=\"o\">]</span>\n  <span class=\"bp\">...</span> <span class=\"bp\">=</span> <span class=\"mi\">3</span> <span class=\"bp\">*</span> <span class=\"n\">A</span> <span class=\"bp\">*</span> <span class=\"n\">B</span> <span class=\"o\">:</span> <span class=\"k\">by</span> <span class=\"n\">ring</span><span class=\"o\">,</span>\n<span class=\"kn\">end</span>\n</code></pre></div>",
        "id": 197347456,
        "sender_full_name": "Heather Macbeth",
        "timestamp": 1589321956
    },
    {
        "content": "<p>Coq's <code>nra</code> is clearly doing more than it claims in the documentation. There's no comparison between <code>y</code> and <code>0</code>, so its preprocessing shouldn't learn anything new about <code>u*y</code>. This should just be treated as an atom that it knows nothing about, and it shouldn't find a proof.</p>",
        "id": 197347508,
        "sender_full_name": "Rob Lewis",
        "timestamp": 1589321991
    },
    {
        "content": "<blockquote>\n<p>I had thought that linarith subsumed ring, but it seems not.</p>\n</blockquote>\n<p>I'm surprised <code>linarith</code> doesn't solve the first <code>ring</code> goal. In the second, <code>linarith</code> won't know to identify <code>B*A</code> with <code>A*B</code>.</p>",
        "id": 197347786,
        "sender_full_name": "Rob Lewis",
        "timestamp": 1589322141
    },
    {
        "content": "<p>Oh, it's because <code>2*A*B</code> is <code>(2*A)*B</code>.</p>",
        "id": 197347860,
        "sender_full_name": "Rob Lewis",
        "timestamp": 1589322198
    },
    {
        "content": "<p>Conjecture:  The <a href=\"https://coq.inria.fr/refman/addendum/micromega.html\">tactic family</a> containing <code>nra</code> also contains <code>psatz</code>, which has the same purpose (nonlinear arithmetic) but uses a different algorithm.  Perhaps at some point <code>psatz</code> was determined to be better and <code>nra</code> now just is an alias for <code>psatz</code>.</p>",
        "id": 197347900,
        "sender_full_name": "Heather Macbeth",
        "timestamp": 1589322229
    },
    {
        "content": "<p>Could be! I can dig a little deeper tomorrow.</p>",
        "id": 197348048,
        "sender_full_name": "Rob Lewis",
        "timestamp": 1589322317
    },
    {
        "content": "<p>Here's the <a href=\"https://github.com/coq/coq/tree/master/theories/micromega\">source code</a>; I couldn't make head nor tail of it, but you surely can.</p>",
        "id": 197348150,
        "sender_full_name": "Heather Macbeth",
        "timestamp": 1589322387
    },
    {
        "content": "<p>I've made it as far as <a href=\"https://github.com/coq/coq/blob/fb7292570380e0490d7c74db1718725149996ffd/plugins/micromega/certificate.ml#L486-L500\">here</a>, which seems to be where the actual work is</p>",
        "id": 197348472,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1589322610
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span><code><span class=\"kn\">example</span> <span class=\"o\">(</span><span class=\"n\">u</span> <span class=\"n\">v</span> <span class=\"n\">x</span> <span class=\"n\">y</span> <span class=\"n\">A</span> <span class=\"n\">B</span> <span class=\"o\">:</span> <span class=\"n\">ℝ</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"o\">(</span><span class=\"mi\">0</span> <span class=\"bp\">&lt;</span> <span class=\"n\">A</span><span class=\"o\">)</span> <span class=\"bp\">→</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"bp\">≤</span> <span class=\"mi\">1</span><span class=\"o\">)</span> <span class=\"bp\">→</span> <span class=\"o\">(</span><span class=\"mi\">1</span> <span class=\"bp\">≤</span> <span class=\"n\">B</span><span class=\"o\">)</span>\n<span class=\"bp\">→</span> <span class=\"o\">(</span><span class=\"n\">x</span> <span class=\"bp\">≤</span> <span class=\"n\">B</span><span class=\"o\">)</span> <span class=\"bp\">→</span> <span class=\"o\">(</span> <span class=\"n\">y</span> <span class=\"bp\">≤</span> <span class=\"n\">B</span><span class=\"o\">)</span>\n<span class=\"bp\">→</span> <span class=\"o\">(</span><span class=\"mi\">0</span> <span class=\"bp\">≤</span> <span class=\"n\">u</span> <span class=\"o\">)</span> <span class=\"bp\">→</span> <span class=\"o\">(</span><span class=\"mi\">0</span> <span class=\"bp\">≤</span> <span class=\"n\">v</span> <span class=\"o\">)</span>\n<span class=\"bp\">→</span> <span class=\"o\">(</span><span class=\"n\">u</span> <span class=\"bp\">&lt;</span> <span class=\"n\">A</span><span class=\"o\">)</span> <span class=\"bp\">→</span> <span class=\"o\">(</span> <span class=\"n\">v</span> <span class=\"bp\">&lt;</span> <span class=\"n\">A</span><span class=\"o\">)</span>\n<span class=\"bp\">→</span> <span class=\"o\">(</span><span class=\"n\">u</span> <span class=\"bp\">*</span> <span class=\"n\">y</span> <span class=\"bp\">+</span> <span class=\"n\">v</span> <span class=\"bp\">*</span> <span class=\"n\">x</span> <span class=\"bp\">+</span> <span class=\"n\">u</span> <span class=\"bp\">*</span> <span class=\"n\">v</span> <span class=\"bp\">&lt;</span> <span class=\"mi\">3</span> <span class=\"bp\">*</span> <span class=\"n\">A</span> <span class=\"bp\">*</span> <span class=\"n\">B</span><span class=\"o\">)</span> <span class=\"o\">:=</span>\n<span class=\"k\">begin</span>\n  <span class=\"n\">intros</span><span class=\"o\">,</span>\n  <span class=\"k\">have</span> <span class=\"n\">h1</span> <span class=\"o\">:</span> <span class=\"mi\">0</span> <span class=\"bp\">≤</span> <span class=\"n\">B</span> <span class=\"o\">:=</span> <span class=\"k\">by</span> <span class=\"n\">linarith</span><span class=\"o\">,</span>\n  <span class=\"k\">have</span> <span class=\"n\">h2</span> <span class=\"o\">:</span> <span class=\"mi\">0</span> <span class=\"bp\">≤</span> <span class=\"n\">A</span> <span class=\"o\">:=</span> <span class=\"k\">by</span> <span class=\"n\">linarith</span><span class=\"o\">,</span>\n  <span class=\"k\">calc</span> <span class=\"n\">u</span> <span class=\"bp\">*</span> <span class=\"n\">y</span> <span class=\"bp\">+</span> <span class=\"n\">v</span> <span class=\"bp\">*</span> <span class=\"n\">x</span> <span class=\"bp\">+</span> <span class=\"n\">u</span> <span class=\"bp\">*</span> <span class=\"n\">v</span>\n      <span class=\"bp\">≤</span> <span class=\"n\">u</span> <span class=\"bp\">*</span> <span class=\"n\">B</span> <span class=\"bp\">+</span> <span class=\"o\">(</span><span class=\"n\">v</span> <span class=\"bp\">*</span> <span class=\"n\">x</span> <span class=\"bp\">+</span> <span class=\"n\">u</span> <span class=\"bp\">*</span> <span class=\"n\">v</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"k\">by</span> <span class=\"n\">linarith</span> <span class=\"o\">[</span><span class=\"n\">mul_le_mul_of_nonneg_left</span> <span class=\"n\">a_4</span> <span class=\"n\">a_5</span><span class=\"o\">]</span>\n  <span class=\"bp\">...</span> <span class=\"bp\">≤</span> <span class=\"n\">A</span> <span class=\"bp\">*</span> <span class=\"n\">B</span> <span class=\"bp\">+</span> <span class=\"o\">(</span><span class=\"n\">v</span> <span class=\"bp\">*</span> <span class=\"n\">x</span> <span class=\"bp\">+</span> <span class=\"n\">u</span> <span class=\"bp\">*</span> <span class=\"n\">v</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"k\">by</span> <span class=\"n\">linarith</span> <span class=\"o\">[</span><span class=\"n\">mul_le_mul_of_nonneg_right</span> <span class=\"o\">(</span><span class=\"n\">le_of_lt</span> <span class=\"n\">a_7</span><span class=\"o\">)</span> <span class=\"n\">h1</span><span class=\"o\">]</span>\n  <span class=\"bp\">...</span> <span class=\"bp\">≤</span> <span class=\"n\">v</span> <span class=\"bp\">*</span> <span class=\"n\">B</span> <span class=\"bp\">+</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"bp\">*</span> <span class=\"n\">B</span> <span class=\"bp\">+</span> <span class=\"n\">u</span> <span class=\"bp\">*</span> <span class=\"n\">v</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"k\">by</span> <span class=\"n\">linarith</span> <span class=\"o\">[</span><span class=\"n\">mul_le_mul_of_nonneg_left</span> <span class=\"n\">a_3</span> <span class=\"n\">a_6</span><span class=\"o\">]</span>\n  <span class=\"bp\">...</span> <span class=\"bp\">≤</span> <span class=\"n\">u</span> <span class=\"bp\">*</span> <span class=\"n\">v</span> <span class=\"bp\">+</span> <span class=\"mi\">2</span> <span class=\"bp\">*</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"bp\">*</span> <span class=\"n\">B</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"k\">by</span> <span class=\"n\">linarith</span> <span class=\"o\">[</span><span class=\"n\">mul_le_mul_of_nonneg_right</span> <span class=\"o\">(</span><span class=\"n\">le_of_lt</span> <span class=\"n\">a_8</span><span class=\"o\">)</span> <span class=\"n\">h1</span><span class=\"o\">]</span>\n  <span class=\"bp\">...</span> <span class=\"bp\">≤</span> <span class=\"n\">A</span> <span class=\"bp\">*</span> <span class=\"n\">v</span> <span class=\"bp\">+</span> <span class=\"mi\">2</span> <span class=\"bp\">*</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"bp\">*</span> <span class=\"n\">B</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"k\">by</span> <span class=\"n\">linarith</span> <span class=\"o\">[</span><span class=\"n\">mul_le_mul_of_nonneg_right</span> <span class=\"o\">(</span><span class=\"n\">le_of_lt</span> <span class=\"n\">a_7</span><span class=\"o\">)</span> <span class=\"n\">a_6</span><span class=\"o\">]</span>\n  <span class=\"bp\">...</span> <span class=\"bp\">≤</span> <span class=\"mi\">1</span> <span class=\"bp\">*</span> <span class=\"n\">v</span> <span class=\"bp\">+</span> <span class=\"mi\">2</span> <span class=\"bp\">*</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"bp\">*</span> <span class=\"n\">B</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"k\">by</span> <span class=\"n\">linarith</span> <span class=\"o\">[</span><span class=\"n\">mul_le_mul_of_nonneg_right</span> <span class=\"n\">a_1</span> <span class=\"n\">a_6</span><span class=\"o\">]</span>\n  <span class=\"bp\">...</span> <span class=\"bp\">&lt;</span> <span class=\"mi\">3</span> <span class=\"bp\">*</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"bp\">*</span> <span class=\"n\">B</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"k\">by</span> <span class=\"n\">linarith</span> <span class=\"o\">[</span><span class=\"n\">mul_le_mul_of_nonneg_right</span> <span class=\"n\">a_2</span> <span class=\"n\">h2</span><span class=\"o\">,</span> <span class=\"n\">mul_comm</span> <span class=\"n\">A</span> <span class=\"n\">B</span><span class=\"o\">]</span>\n  <span class=\"bp\">...</span> <span class=\"bp\">=</span> <span class=\"mi\">3</span> <span class=\"bp\">*</span> <span class=\"n\">A</span> <span class=\"bp\">*</span> <span class=\"n\">B</span> <span class=\"o\">:</span> <span class=\"k\">by</span> <span class=\"n\">ring</span><span class=\"o\">,</span>\n\n<span class=\"kn\">end</span>\n</code></pre></div>",
        "id": 197348477,
        "sender_full_name": "Rob Lewis",
        "timestamp": 1589322612
    },
    {
        "content": "<p>Aha, <a href=\"https://github.com/coq/coq/blob/fb7292570380e0490d7c74db1718725149996ffd/plugins/micromega/certificate.ml#L448-L451\">nlinear_preprocess</a> is the preprocessor</p>",
        "id": 197348614,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1589322702
    },
    {
        "content": "<p>Not claiming this is really better, but</p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"kn\">example</span> <span class=\"o\">(</span><span class=\"n\">u</span> <span class=\"n\">v</span> <span class=\"n\">x</span> <span class=\"n\">y</span> <span class=\"n\">A</span> <span class=\"n\">B</span> <span class=\"o\">:</span> <span class=\"n\">ℝ</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"o\">(</span><span class=\"mi\">0</span> <span class=\"bp\">&lt;</span> <span class=\"n\">A</span><span class=\"o\">)</span> <span class=\"bp\">→</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"bp\">≤</span> <span class=\"mi\">1</span><span class=\"o\">)</span> <span class=\"bp\">→</span> <span class=\"o\">(</span><span class=\"mi\">1</span> <span class=\"bp\">≤</span> <span class=\"n\">B</span><span class=\"o\">)</span>\n<span class=\"bp\">→</span> <span class=\"o\">(</span><span class=\"n\">x</span> <span class=\"bp\">≤</span> <span class=\"n\">B</span><span class=\"o\">)</span> <span class=\"bp\">→</span> <span class=\"o\">(</span> <span class=\"n\">y</span> <span class=\"bp\">≤</span> <span class=\"n\">B</span><span class=\"o\">)</span>\n<span class=\"bp\">→</span> <span class=\"o\">(</span><span class=\"mi\">0</span> <span class=\"bp\">≤</span> <span class=\"n\">u</span> <span class=\"o\">)</span> <span class=\"bp\">→</span> <span class=\"o\">(</span><span class=\"mi\">0</span> <span class=\"bp\">≤</span> <span class=\"n\">v</span> <span class=\"o\">)</span>\n<span class=\"bp\">→</span> <span class=\"o\">(</span><span class=\"n\">u</span> <span class=\"bp\">&lt;</span> <span class=\"n\">A</span><span class=\"o\">)</span> <span class=\"bp\">→</span> <span class=\"o\">(</span> <span class=\"n\">v</span> <span class=\"bp\">&lt;</span> <span class=\"n\">A</span><span class=\"o\">)</span>\n<span class=\"bp\">→</span> <span class=\"o\">(</span><span class=\"n\">u</span> <span class=\"bp\">*</span> <span class=\"n\">y</span> <span class=\"bp\">+</span> <span class=\"n\">v</span> <span class=\"bp\">*</span> <span class=\"n\">x</span> <span class=\"bp\">+</span> <span class=\"n\">u</span> <span class=\"bp\">*</span> <span class=\"n\">v</span> <span class=\"bp\">&lt;</span> <span class=\"mi\">3</span> <span class=\"bp\">*</span> <span class=\"n\">A</span> <span class=\"bp\">*</span> <span class=\"n\">B</span><span class=\"o\">)</span> <span class=\"o\">:=</span>\n<span class=\"k\">begin</span>\n  <span class=\"n\">intros</span><span class=\"o\">,</span>\n  <span class=\"k\">have</span> <span class=\"n\">h1</span> <span class=\"o\">:</span> <span class=\"mi\">0</span> <span class=\"bp\">≤</span> <span class=\"n\">B</span> <span class=\"o\">:=</span> <span class=\"k\">by</span> <span class=\"n\">linarith</span><span class=\"o\">,</span>\n  <span class=\"k\">have</span> <span class=\"n\">h2</span> <span class=\"o\">:</span> <span class=\"mi\">0</span> <span class=\"bp\">≤</span> <span class=\"n\">A</span> <span class=\"o\">:=</span> <span class=\"k\">by</span> <span class=\"n\">linarith</span><span class=\"o\">,</span>\n  <span class=\"k\">have</span> <span class=\"o\">:=</span> <span class=\"n\">mul_le_mul_of_nonneg_left</span> <span class=\"n\">a_4</span> <span class=\"n\">a_5</span><span class=\"o\">,</span>\n  <span class=\"k\">have</span> <span class=\"o\">:=</span> <span class=\"n\">mul_le_mul_of_nonneg_right</span> <span class=\"o\">(</span><span class=\"n\">le_of_lt</span> <span class=\"n\">a_7</span><span class=\"o\">)</span> <span class=\"n\">h1</span><span class=\"o\">,</span>\n  <span class=\"k\">have</span> <span class=\"o\">:=</span> <span class=\"n\">mul_le_mul_of_nonneg_left</span> <span class=\"n\">a_3</span> <span class=\"n\">a_6</span><span class=\"o\">,</span>\n  <span class=\"k\">have</span> <span class=\"o\">:=</span> <span class=\"n\">mul_le_mul_of_nonneg_right</span> <span class=\"o\">(</span><span class=\"n\">le_of_lt</span> <span class=\"n\">a_8</span><span class=\"o\">)</span> <span class=\"n\">h1</span><span class=\"o\">,</span>\n  <span class=\"k\">have</span> <span class=\"o\">:=</span> <span class=\"n\">mul_le_mul_of_nonneg_right</span> <span class=\"o\">(</span><span class=\"n\">le_of_lt</span> <span class=\"n\">a_7</span><span class=\"o\">)</span> <span class=\"n\">a_6</span><span class=\"o\">,</span>\n  <span class=\"k\">have</span> <span class=\"o\">:=</span> <span class=\"n\">mul_le_mul_of_nonneg_right</span> <span class=\"n\">a_1</span> <span class=\"n\">a_6</span><span class=\"o\">,</span>\n  <span class=\"k\">have</span> <span class=\"o\">:=</span> <span class=\"n\">mul_le_mul_of_nonneg_right</span> <span class=\"n\">a_2</span> <span class=\"n\">h2</span><span class=\"o\">,</span>\n  <span class=\"k\">have</span> <span class=\"o\">:=</span> <span class=\"n\">mul_comm</span> <span class=\"n\">A</span> <span class=\"n\">B</span><span class=\"o\">,</span>\n  <span class=\"k\">have</span> <span class=\"o\">:</span> <span class=\"mi\">3</span> <span class=\"bp\">*</span> <span class=\"n\">A</span> <span class=\"bp\">*</span> <span class=\"n\">B</span> <span class=\"bp\">=</span> <span class=\"mi\">3</span> <span class=\"bp\">*</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"bp\">*</span> <span class=\"n\">B</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"k\">by</span> <span class=\"n\">ring</span><span class=\"o\">,</span>\n  <span class=\"n\">linarith</span>\n<span class=\"kn\">end</span>\n</code></pre></div>",
        "id": 197348842,
        "sender_full_name": "Rob Lewis",
        "timestamp": 1589322859
    },
    {
        "content": "<p>I think what they failed to mention is that constraints are already normalized to <code>0 &lt;= x</code>, <code>0 &lt; x</code> or <code>0 = x</code></p>",
        "id": 197348935,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1589322937
    },
    {
        "content": "<p>One more quick example, also solved by <code>nra</code> in Coq:</p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"kn\">example</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"n\">B</span> <span class=\"o\">:</span> <span class=\"n\">ℝ</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"o\">(</span><span class=\"mi\">0</span> <span class=\"bp\">&lt;</span> <span class=\"n\">A</span><span class=\"o\">)</span> <span class=\"bp\">→</span> <span class=\"o\">(</span><span class=\"mi\">1</span> <span class=\"bp\">≤</span> <span class=\"n\">B</span><span class=\"o\">)</span> <span class=\"bp\">→</span> <span class=\"o\">(</span><span class=\"mi\">0</span> <span class=\"bp\">&lt;</span> <span class=\"n\">A</span> <span class=\"bp\">/</span> <span class=\"mi\">8</span> <span class=\"bp\">*</span> <span class=\"n\">B</span><span class=\"o\">)</span> <span class=\"o\">:=</span>\n<span class=\"k\">begin</span>\n  <span class=\"n\">intros</span><span class=\"o\">,</span>\n  <span class=\"k\">have</span> <span class=\"n\">h1</span> <span class=\"o\">:</span> <span class=\"mi\">0</span> <span class=\"bp\">&lt;</span> <span class=\"n\">A</span> <span class=\"bp\">/</span> <span class=\"mi\">8</span> <span class=\"o\">:=</span> <span class=\"k\">by</span> <span class=\"n\">linarith</span><span class=\"o\">,</span>\n  <span class=\"k\">have</span> <span class=\"n\">h2</span> <span class=\"o\">:</span> <span class=\"mi\">0</span> <span class=\"bp\">&lt;</span> <span class=\"n\">B</span> <span class=\"o\">:=</span> <span class=\"k\">by</span> <span class=\"n\">linarith</span><span class=\"o\">,</span>\n  <span class=\"n\">exact</span> <span class=\"n\">mul_pos&#39;</span> <span class=\"n\">h1</span> <span class=\"n\">h2</span><span class=\"o\">,</span>\n<span class=\"kn\">end</span>\n</code></pre></div>",
        "id": 197351762,
        "sender_full_name": "Heather Macbeth",
        "timestamp": 1589324910
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span><code><span class=\"kn\">import</span> <span class=\"n\">data</span><span class=\"bp\">.</span><span class=\"n\">real</span><span class=\"bp\">.</span><span class=\"n\">basic</span>\n\n<span class=\"kn\">example</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"n\">B</span> <span class=\"o\">:</span> <span class=\"n\">ℝ</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">hA</span> <span class=\"o\">:</span> <span class=\"mi\">0</span> <span class=\"bp\">&lt;</span> <span class=\"n\">A</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">hB</span> <span class=\"o\">:</span> <span class=\"mi\">1</span> <span class=\"bp\">≤</span> <span class=\"n\">B</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"o\">(</span><span class=\"mi\">0</span> <span class=\"bp\">&lt;</span> <span class=\"n\">A</span> <span class=\"bp\">/</span> <span class=\"mi\">8</span> <span class=\"bp\">*</span> <span class=\"n\">B</span><span class=\"o\">)</span> <span class=\"o\">:=</span>\n<span class=\"k\">by</span> <span class=\"n\">apply</span> <span class=\"n\">mul_pos&#39;</span><span class=\"bp\">;</span> <span class=\"n\">linarith</span>\n</code></pre></div>",
        "id": 197352767,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1589325857
    },
    {
        "content": "<p>If my mental model of <code>nra</code> is correct, it should be doing this:</p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"kn\">example</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"n\">B</span> <span class=\"o\">:</span> <span class=\"n\">ℝ</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"o\">(</span><span class=\"mi\">0</span> <span class=\"bp\">&lt;</span> <span class=\"n\">A</span><span class=\"o\">)</span> <span class=\"bp\">→</span> <span class=\"o\">(</span><span class=\"mi\">1</span> <span class=\"bp\">≤</span> <span class=\"n\">B</span><span class=\"o\">)</span> <span class=\"bp\">→</span> <span class=\"o\">(</span><span class=\"mi\">0</span> <span class=\"bp\">&lt;</span> <span class=\"n\">A</span> <span class=\"bp\">/</span> <span class=\"mi\">8</span> <span class=\"bp\">*</span> <span class=\"n\">B</span><span class=\"o\">)</span> <span class=\"o\">:=</span>\n<span class=\"k\">begin</span>\n  <span class=\"n\">intros</span><span class=\"o\">,</span>\n  <span class=\"k\">have</span> <span class=\"o\">:=</span> <span class=\"n\">mul_nonneg</span> <span class=\"o\">(</span><span class=\"n\">le_of_lt</span> <span class=\"n\">a</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">sub_nonneg_of_le</span> <span class=\"n\">a_1</span><span class=\"o\">),</span>\n  <span class=\"n\">linarith</span><span class=\"o\">,</span>\n<span class=\"kn\">end</span>\n</code></pre></div>\n\n\n<p>but evidently that doesn't work</p>",
        "id": 197353831,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1589326899
    },
    {
        "content": "<p>Actually, I think it's also doing normalization into monomials first as well. So it's more like</p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"kn\">example</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"n\">B</span> <span class=\"o\">:</span> <span class=\"n\">ℝ</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"o\">(</span><span class=\"mi\">0</span> <span class=\"bp\">&lt;</span> <span class=\"n\">A</span><span class=\"o\">)</span> <span class=\"bp\">→</span> <span class=\"o\">(</span><span class=\"mi\">1</span> <span class=\"bp\">≤</span> <span class=\"n\">B</span><span class=\"o\">)</span> <span class=\"bp\">→</span> <span class=\"o\">(</span><span class=\"mi\">0</span> <span class=\"bp\">&lt;</span> <span class=\"n\">A</span> <span class=\"bp\">/</span> <span class=\"mi\">8</span> <span class=\"bp\">*</span> <span class=\"n\">B</span><span class=\"o\">)</span> <span class=\"o\">:=</span>\n<span class=\"k\">begin</span>\n  <span class=\"n\">intros</span><span class=\"o\">,</span>\n  <span class=\"k\">have</span> <span class=\"o\">:=</span> <span class=\"n\">mul_nonneg</span> <span class=\"o\">(</span><span class=\"n\">le_of_lt</span> <span class=\"n\">a</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">sub_nonneg_of_le</span> <span class=\"n\">a_1</span><span class=\"o\">),</span>\n  <span class=\"n\">rw</span> <span class=\"o\">[</span><span class=\"n\">mul_sub</span><span class=\"o\">]</span> <span class=\"n\">at</span> <span class=\"n\">this</span><span class=\"o\">,</span>\n  <span class=\"n\">rw</span> <span class=\"k\">show</span> <span class=\"n\">A</span> <span class=\"bp\">/</span> <span class=\"mi\">8</span> <span class=\"bp\">*</span> <span class=\"n\">B</span> <span class=\"bp\">=</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"bp\">*</span> <span class=\"n\">B</span><span class=\"o\">)</span> <span class=\"bp\">*</span> <span class=\"mi\">1</span> <span class=\"bp\">/</span> <span class=\"mi\">8</span><span class=\"o\">,</span> <span class=\"k\">by</span> <span class=\"n\">ring</span><span class=\"o\">,</span>\n  <span class=\"n\">linarith</span><span class=\"o\">,</span>\n<span class=\"kn\">end</span>\n</code></pre></div>\n\n\n<p>which does work</p>",
        "id": 197354798,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1589327862
    },
    {
        "content": "<p>I don't think it's going to be possible to support this without getting into the weeds of <code>linarith</code></p>",
        "id": 197354871,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1589327918
    },
    {
        "content": "<p>I guess the point is that Coq's <code>lra</code> behaves differently from <code>linarith</code>?  In particular, as we <a href=\"#narrow/stream/187764-Lean-for.20teaching/topic/Real.20analysis/near/197347456\">discussed earlier</a>, it subsumes <code>ring</code>, whereas <code>linarith</code> does not.  For example, if I directly translate to Coq the <a href=\"#narrow/stream/187764-Lean-for.20teaching/topic/Real.20analysis/near/197348842\">code written</a> by <span class=\"user-mention\" data-user-id=\"110596\">@Rob Lewis</span> above, I can cut the two lines</p>\n<div class=\"codehilite\"><pre><span></span><code>  <span class=\"k\">have</span> <span class=\"o\">:=</span> <span class=\"n\">mul_comm</span> <span class=\"n\">A</span> <span class=\"n\">B</span><span class=\"o\">,</span>\n  <span class=\"k\">have</span> <span class=\"o\">:</span> <span class=\"mi\">3</span> <span class=\"bp\">*</span> <span class=\"n\">A</span> <span class=\"bp\">*</span> <span class=\"n\">B</span> <span class=\"bp\">=</span> <span class=\"mi\">3</span> <span class=\"bp\">*</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"bp\">*</span> <span class=\"n\">B</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"k\">by</span> <span class=\"n\">ring</span><span class=\"o\">,</span>\n</code></pre></div>\n\n\n<p>i.e., just the following works:</p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"n\">Require</span> <span class=\"n\">Import</span> <span class=\"n\">Rbase</span><span class=\"bp\">.</span>\n<span class=\"n\">Require</span> <span class=\"n\">Import</span> <span class=\"n\">Psatz</span><span class=\"bp\">.</span>\n<span class=\"n\">Local</span> <span class=\"n\">Open</span> <span class=\"n\">Scope</span> <span class=\"n\">R_scope</span><span class=\"bp\">.</span>\n\n<span class=\"n\">Lemma</span> <span class=\"n\">test</span> <span class=\"o\">(</span><span class=\"n\">u</span> <span class=\"n\">v</span> <span class=\"n\">x</span> <span class=\"n\">y</span> <span class=\"n\">A</span> <span class=\"n\">B</span> <span class=\"o\">:</span> <span class=\"n\">R</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"o\">(</span><span class=\"mi\">0</span> <span class=\"bp\">&lt;</span> <span class=\"n\">A</span><span class=\"o\">)</span> <span class=\"bp\">-&gt;</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"bp\">&lt;=</span> <span class=\"mi\">1</span><span class=\"o\">)</span> <span class=\"bp\">-&gt;</span> <span class=\"o\">(</span><span class=\"mi\">1</span> <span class=\"bp\">&lt;=</span> <span class=\"n\">B</span><span class=\"o\">)</span>\n<span class=\"bp\">-&gt;</span> <span class=\"o\">(</span><span class=\"n\">x</span> <span class=\"bp\">&lt;=</span> <span class=\"n\">B</span><span class=\"o\">)</span> <span class=\"bp\">-&gt;</span> <span class=\"o\">(</span> <span class=\"n\">y</span> <span class=\"bp\">&lt;=</span> <span class=\"n\">B</span><span class=\"o\">)</span>\n<span class=\"bp\">-&gt;</span> <span class=\"o\">(</span><span class=\"mi\">0</span> <span class=\"bp\">&lt;=</span> <span class=\"n\">u</span> <span class=\"o\">)</span> <span class=\"bp\">-&gt;</span> <span class=\"o\">(</span><span class=\"mi\">0</span> <span class=\"bp\">&lt;=</span> <span class=\"n\">v</span> <span class=\"o\">)</span>\n<span class=\"bp\">-&gt;</span> <span class=\"o\">(</span><span class=\"n\">u</span> <span class=\"bp\">&lt;</span> <span class=\"n\">A</span><span class=\"o\">)</span> <span class=\"bp\">-&gt;</span> <span class=\"o\">(</span> <span class=\"n\">v</span> <span class=\"bp\">&lt;</span> <span class=\"n\">A</span><span class=\"o\">)</span>\n<span class=\"bp\">-&gt;</span> <span class=\"o\">(</span><span class=\"n\">u</span> <span class=\"bp\">*</span> <span class=\"n\">y</span> <span class=\"bp\">+</span> <span class=\"n\">v</span> <span class=\"bp\">*</span> <span class=\"n\">x</span> <span class=\"bp\">+</span> <span class=\"n\">u</span> <span class=\"bp\">*</span> <span class=\"n\">v</span> <span class=\"bp\">&lt;</span> <span class=\"mi\">3</span> <span class=\"bp\">*</span> <span class=\"n\">A</span> <span class=\"bp\">*</span> <span class=\"n\">B</span><span class=\"o\">)</span><span class=\"bp\">.</span>\n<span class=\"n\">Proof</span><span class=\"bp\">.</span>\n  <span class=\"n\">intros</span> <span class=\"n\">a</span> <span class=\"n\">a_1</span> <span class=\"n\">a_2</span> <span class=\"n\">a_3</span> <span class=\"n\">a_4</span> <span class=\"n\">a_5</span> <span class=\"n\">a_6</span> <span class=\"n\">a_7</span> <span class=\"n\">a_8</span><span class=\"bp\">.</span>\n  <span class=\"n\">assert</span> <span class=\"o\">(</span><span class=\"n\">h1</span> <span class=\"o\">:</span> <span class=\"mi\">0</span> <span class=\"bp\">&lt;=</span> <span class=\"n\">B</span><span class=\"o\">)</span> <span class=\"k\">by</span> <span class=\"n\">lra</span><span class=\"bp\">.</span>\n  <span class=\"n\">assert</span> <span class=\"o\">(</span><span class=\"n\">h2</span> <span class=\"o\">:</span> <span class=\"mi\">0</span> <span class=\"bp\">&lt;=</span> <span class=\"n\">A</span><span class=\"o\">)</span> <span class=\"k\">by</span> <span class=\"n\">lra</span><span class=\"bp\">.</span>\n  <span class=\"n\">pose</span> <span class=\"k\">proof</span> <span class=\"n\">Rmult_le_compat_l</span> <span class=\"bp\">_</span> <span class=\"bp\">_</span> <span class=\"bp\">_</span> <span class=\"n\">a_5</span> <span class=\"n\">a_4</span><span class=\"bp\">.</span>\n  <span class=\"n\">pose</span> <span class=\"k\">proof</span> <span class=\"n\">Rmult_le_compat_r</span> <span class=\"bp\">_</span> <span class=\"bp\">_</span> <span class=\"bp\">_</span> <span class=\"n\">h1</span> <span class=\"o\">(</span><span class=\"n\">Rlt_le</span> <span class=\"bp\">_</span> <span class=\"bp\">_</span> <span class=\"n\">a_7</span><span class=\"o\">)</span><span class=\"bp\">.</span>\n  <span class=\"n\">pose</span> <span class=\"k\">proof</span> <span class=\"n\">Rmult_le_compat_l</span> <span class=\"bp\">_</span> <span class=\"bp\">_</span> <span class=\"bp\">_</span> <span class=\"n\">a_6</span> <span class=\"n\">a_3</span><span class=\"bp\">.</span>\n  <span class=\"n\">pose</span> <span class=\"k\">proof</span> <span class=\"n\">Rmult_le_compat_r</span> <span class=\"bp\">_</span> <span class=\"bp\">_</span> <span class=\"bp\">_</span> <span class=\"n\">h1</span> <span class=\"o\">(</span><span class=\"n\">Rlt_le</span> <span class=\"bp\">_</span> <span class=\"bp\">_</span> <span class=\"n\">a_8</span><span class=\"o\">)</span><span class=\"bp\">.</span>\n  <span class=\"n\">pose</span> <span class=\"k\">proof</span> <span class=\"n\">Rmult_le_compat_r</span> <span class=\"bp\">_</span> <span class=\"bp\">_</span> <span class=\"bp\">_</span> <span class=\"n\">a_6</span> <span class=\"o\">(</span><span class=\"n\">Rlt_le</span> <span class=\"bp\">_</span> <span class=\"bp\">_</span> <span class=\"n\">a_7</span><span class=\"o\">)</span><span class=\"bp\">.</span>\n  <span class=\"n\">pose</span> <span class=\"k\">proof</span> <span class=\"n\">Rmult_le_compat_r</span> <span class=\"bp\">_</span> <span class=\"bp\">_</span> <span class=\"bp\">_</span> <span class=\"n\">a_6</span> <span class=\"n\">a_1</span><span class=\"bp\">.</span>\n  <span class=\"n\">pose</span> <span class=\"k\">proof</span> <span class=\"n\">Rmult_le_compat_r</span> <span class=\"bp\">_</span> <span class=\"bp\">_</span> <span class=\"bp\">_</span> <span class=\"n\">h2</span> <span class=\"n\">a_2</span><span class=\"bp\">.</span>\n  <span class=\"n\">lra</span><span class=\"bp\">.</span>\n<span class=\"n\">Qed</span><span class=\"bp\">.</span>\n</code></pre></div>",
        "id": 197363077,
        "sender_full_name": "Heather Macbeth",
        "timestamp": 1589336978
    },
    {
        "content": "<p>Yep. Coq clearly does some kind of normalization of atoms in <code>lra</code>.</p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"kn\">Require</span> <span class=\"kn\">Import</span>  <span class=\"n\">Psatz</span> <span class=\"n\">Rbase</span><span class=\"o\">.</span>\n<span class=\"kn\">Open</span> <span class=\"kn\">Scope</span> <span class=\"n\">R_scope</span><span class=\"o\">.</span>\n\n<span class=\"kn\">Lemma</span> <span class=\"n\">test2</span> <span class=\"o\">(</span><span class=\"n\">u</span> <span class=\"n\">v</span> <span class=\"o\">:</span> <span class=\"n\">R</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"o\">(</span><span class=\"mi\">0</span> <span class=\"o\">&lt;</span> <span class=\"n\">u</span><span class=\"o\">*</span><span class=\"n\">v</span><span class=\"o\">)</span> <span class=\"o\">-&gt;</span> <span class=\"mi\">0</span> <span class=\"o\">&lt;</span> <span class=\"mi\">3</span><span class=\"o\">*</span><span class=\"n\">u</span><span class=\"o\">*</span><span class=\"n\">v</span><span class=\"o\">.</span>\n<span class=\"kn\">Proof</span><span class=\"o\">.</span>\n  <span class=\"n\">lra</span><span class=\"o\">.</span>\n<span class=\"kn\">Qed</span><span class=\"o\">.</span>\n</code></pre></div>\n\n\n<p><code>*</code> associates to the left, so it figures out that <code>(3*u)*v</code> is actually <code>3*(u*v)</code> where <code>u*v</code> is the atom it cares about.</p>",
        "id": 197389999,
        "sender_full_name": "Rob Lewis",
        "timestamp": 1589363483
    },
    {
        "content": "<p><code>linarith</code> could actually be adapted to do that one pretty easily, but this one is more surprising:</p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"kn\">Lemma</span> <span class=\"n\">test2</span> <span class=\"o\">(</span><span class=\"n\">u</span> <span class=\"n\">v</span> <span class=\"o\">:</span> <span class=\"n\">R</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"o\">(</span><span class=\"mi\">0</span> <span class=\"o\">&lt;</span> <span class=\"n\">u</span><span class=\"o\">*</span><span class=\"n\">v</span><span class=\"o\">)</span> <span class=\"o\">-&gt;</span> <span class=\"mi\">0</span> <span class=\"o\">&lt;</span> <span class=\"mi\">3</span><span class=\"o\">*</span><span class=\"n\">v</span><span class=\"o\">*</span><span class=\"n\">u</span><span class=\"o\">.</span>\n<span class=\"kn\">Proof</span><span class=\"o\">.</span>\n  <span class=\"n\">lra</span><span class=\"o\">.</span>\n<span class=\"kn\">Qed</span><span class=\"o\">.</span>\n</code></pre></div>",
        "id": 197390220,
        "sender_full_name": "Rob Lewis",
        "timestamp": 1589363616
    },
    {
        "content": "<p>It must be calling <code>ring</code> on the atoms? This sounds super expensive.</p>",
        "id": 197390362,
        "sender_full_name": "Rob Lewis",
        "timestamp": 1589363711
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"110049\">@Mario Carneiro</span> is there an API for <code>ring</code>-without-proofs? Like, I give it an <code>expr</code> and get a ring-normalized <code>expr</code> back without a proof that they're equal.</p>",
        "id": 197390635,
        "sender_full_name": "Rob Lewis",
        "timestamp": 1589363899
    },
    {
        "content": "<p>I have a partially working <code>linarith</code> that handles this at least. It needs efficiency improvements to be used in practice, and should become part of the more expensive <code>linarith!</code>. But there's a bug in <code>ring</code>:</p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"kn\">import</span> <span class=\"n\">tactic</span><span class=\"bp\">.</span><span class=\"n\">ring</span>\n\n<span class=\"c1\">-- loops</span>\n<span class=\"kn\">example</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"n\">B</span> <span class=\"o\">:</span> <span class=\"bp\">ℕ</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">A</span> <span class=\"bp\">*</span> <span class=\"n\">B</span> <span class=\"bp\">=</span> <span class=\"mi\">2</span> <span class=\"o\">:=</span>\n<span class=\"k\">begin</span>\n  <span class=\"c1\">-- ring,</span>\n<span class=\"kn\">end</span>\n</code></pre></div>\n\n\n<p>Haven't investigated yet.</p>",
        "id": 197398086,
        "sender_full_name": "Rob Lewis",
        "timestamp": 1589368923
    },
    {
        "content": "<p>I'm now marking my Lean exam. I didn't teach them the <code>assumption</code> tactic because that's one more tactic to learn and <code>exact</code> is good enough. Hence they use <code>linarith</code> instead of <code>assumption</code>. <span aria-label=\"shrug\" class=\"emoji emoji-1f937\" role=\"img\" title=\"shrug\">:shrug:</span></p>",
        "id": 197427151,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1589382923
    },
    {
        "content": "<p>Students are efficient, they do what works!  After my ones learned that <code>nra</code> did effectively anything, I think I saw them use it to prove that <code>2 * u = u + u</code>  :)</p>",
        "id": 197430247,
        "sender_full_name": "Heather Macbeth",
        "timestamp": 1589384116
    },
    {
        "content": "<p>I prove <code>0&lt;1</code> with <code>norm_num</code> because it's fewer characters than <code>exact zero_lt_one</code> and <code>exact dec_trivial</code>.</p>",
        "id": 197430847,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1589384323
    },
    {
        "content": "<p>When I give advice to people writing new tactics, I tell them that their users will abuse them in every way possible. They need to be foolproof. This is why the new <code>norm_cast</code> figures out attributes for you automatically.</p>",
        "id": 197431023,
        "sender_full_name": "Rob Lewis",
        "timestamp": 1589384389
    },
    {
        "content": "<p>Both those uses are fair. I don't want to waste student neurons on remembering the names of whatever specifically prove <code>2 * u = u + u</code> or <code>0 &lt; 1</code>.</p>",
        "id": 197431113,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1589384416
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110038\">Kevin Buzzard</span> <a href=\"#narrow/stream/187764-Lean-for.20teaching/topic/Real.20analysis/near/197430847\">said</a>:</p>\n<blockquote>\n<p>I prove <code>0&lt;1</code> with <code>norm_num</code> because it's fewer characters than <code>exact zero_lt_one</code> and <code>exact dec_trivial</code>.</p>\n</blockquote>\n<p>This doesn't sound like abuse though, that's exactly the situation <code>norm_num</code> is designed for!</p>",
        "id": 197431123,
        "sender_full_name": "Rob Lewis",
        "timestamp": 1589384418
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110596\">Rob Lewis</span> <a href=\"#narrow/stream/187764-Lean-for.20teaching/topic/Real.20analysis/near/197390635\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"110049\">Mario Carneiro</span> is there an API for <code>ring</code>-without-proofs? Like, I give it an <code>expr</code> and get a ring-normalized <code>expr</code> back without a proof that they're equal.</p>\n</blockquote>\n<p>No, but why would you want that? If you are normalizing the context, you will probably want to associate proofs during that phase too</p>",
        "id": 197444197,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1589389554
    },
    {
        "content": "<p>Linarith works using ring for verification. It does ~no proving of its own, including in the step where it identifies atoms. So that step just needs to ask \"are these exprs syntactically eq or defeq or ring-eq\" depending on the context. Then it builds the linear problem, computes the coefficients, and if <code>ring</code> claimed that things were equal before, it should normalize them away in the end.</p>",
        "id": 197449079,
        "sender_full_name": "Rob Lewis",
        "timestamp": 1589391495
    },
    {
        "content": "<p>But there's a related \"issue,\" the order of appearance of arguments to <code>ring</code> affects the normal form. This is kind of expected, since you need a deterministic term order. But <code>A*B</code> and <code>B*A</code> don't normalize to the same thing if you normalize them separately.</p>",
        "id": 197449329,
        "sender_full_name": "Rob Lewis",
        "timestamp": 1589391634
    },
    {
        "content": "<p>You should be operating in the <code>ring_m</code> monad</p>",
        "id": 197449555,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1589391744
    },
    {
        "content": "<p>or in your own monad that extends it</p>",
        "id": 197449569,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1589391752
    },
    {
        "content": "<p>that way you can share atoms between invocations</p>",
        "id": 197449604,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1589391767
    },
    {
        "content": "<p>Okay, that solves one issue. But I still can't get the normal form without a proof, right?</p>",
        "id": 197449976,
        "sender_full_name": "Rob Lewis",
        "timestamp": 1589391917
    },
    {
        "content": "<p>I have an update to <code>linarith</code> that makes some progress here, effectively doing normalization of monomials+. It handles <span class=\"user-mention\" data-user-id=\"110049\">@Mario Carneiro</span> 's example</p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"kn\">example</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"n\">B</span> <span class=\"o\">:</span> <span class=\"n\">ℝ</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"o\">(</span><span class=\"mi\">0</span> <span class=\"bp\">&lt;</span> <span class=\"n\">A</span><span class=\"o\">)</span> <span class=\"bp\">→</span> <span class=\"o\">(</span><span class=\"mi\">1</span> <span class=\"bp\">≤</span> <span class=\"n\">B</span><span class=\"o\">)</span> <span class=\"bp\">→</span> <span class=\"o\">(</span><span class=\"mi\">0</span> <span class=\"bp\">&lt;</span> <span class=\"n\">A</span> <span class=\"bp\">/</span> <span class=\"mi\">8</span> <span class=\"bp\">*</span> <span class=\"n\">B</span><span class=\"o\">)</span> <span class=\"o\">:=</span>\n<span class=\"k\">begin</span>\n  <span class=\"n\">intros</span><span class=\"o\">,</span>\n  <span class=\"k\">have</span> <span class=\"o\">:=</span> <span class=\"n\">mul_nonneg</span> <span class=\"o\">(</span><span class=\"n\">le_of_lt</span> <span class=\"n\">a</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">sub_nonneg_of_le</span> <span class=\"n\">a_1</span><span class=\"o\">),</span>\n  <span class=\"n\">linarith</span><span class=\"o\">,</span>\n<span class=\"kn\">end</span>\n</code></pre></div>\n\n\n<p>and <span class=\"user-mention\" data-user-id=\"260507\">@Heather Macbeth</span> 's example cutting the two ugliest lines from the ugly proof. But in combination with Mario's nonlinear preprocessing it still doesn't match <code>nra</code> -- Heather's example still fails.</p>",
        "id": 200151209,
        "sender_full_name": "Rob Lewis",
        "timestamp": 1591647735
    },
    {
        "content": "<p>AFAICT <code>linarith</code> is now comparable to <code>lra</code>, and <code>nlinarith</code> does everything the documentation of <code>nra</code> claims. So <code>nra</code> must be doing something extra.</p>",
        "id": 200151356,
        "sender_full_name": "Rob Lewis",
        "timestamp": 1591647816
    },
    {
        "content": "<p>This fails:</p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"kn\">example</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"n\">B</span> <span class=\"o\">:</span> <span class=\"n\">ℚ</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"o\">(</span><span class=\"mi\">0</span> <span class=\"bp\">&lt;</span> <span class=\"n\">A</span><span class=\"o\">)</span> <span class=\"bp\">→</span> <span class=\"o\">(</span><span class=\"mi\">1</span> <span class=\"bp\">≤</span> <span class=\"n\">B</span><span class=\"o\">)</span> <span class=\"bp\">→</span> <span class=\"o\">(</span><span class=\"mi\">0</span> <span class=\"bp\">&lt;</span> <span class=\"n\">A</span> <span class=\"bp\">/</span> <span class=\"mi\">8</span> <span class=\"bp\">*</span> <span class=\"n\">B</span><span class=\"o\">)</span> <span class=\"o\">:=</span>\n<span class=\"k\">begin</span>\n  <span class=\"n\">intros</span><span class=\"o\">,</span>\n  <span class=\"n\">nlinarith</span><span class=\"o\">,</span>\n<span class=\"kn\">end</span>\n</code></pre></div>\n\n\n<p>but this succeeds:</p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"kn\">example</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"n\">B</span> <span class=\"o\">:</span> <span class=\"n\">ℚ</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"o\">(</span><span class=\"mi\">0</span> <span class=\"bp\">&lt;</span> <span class=\"n\">A</span><span class=\"o\">)</span> <span class=\"bp\">→</span> <span class=\"o\">(</span><span class=\"mi\">1</span> <span class=\"bp\">≤</span> <span class=\"n\">B</span><span class=\"o\">)</span> <span class=\"bp\">→</span> <span class=\"o\">(</span><span class=\"mi\">0</span> <span class=\"bp\">&lt;</span> <span class=\"n\">B</span><span class=\"o\">)</span> <span class=\"bp\">→</span> <span class=\"o\">(</span><span class=\"mi\">0</span> <span class=\"bp\">&lt;</span> <span class=\"n\">A</span> <span class=\"bp\">/</span> <span class=\"mi\">8</span> <span class=\"bp\">*</span> <span class=\"n\">B</span><span class=\"o\">)</span> <span class=\"o\">:=</span>\n<span class=\"k\">begin</span>\n  <span class=\"n\">intros</span><span class=\"o\">,</span>\n  <span class=\"n\">nlinarith</span><span class=\"o\">,</span>\n<span class=\"kn\">end</span>\n</code></pre></div>\n\n\n<p>so maybe <code>nra</code> is working with a bit more than just comparisons with 0?</p>",
        "id": 200151751,
        "sender_full_name": "Rob Lewis",
        "timestamp": 1591648029
    },
    {
        "content": "<p>New <code>linarith</code> is here, btw: <a href=\"https://github.com/leanprover-community/mathlib/tree/linarith-update\">https://github.com/leanprover-community/mathlib/tree/linarith-update</a></p>",
        "id": 200151803,
        "sender_full_name": "Rob Lewis",
        "timestamp": 1591648066
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110596\">Rob Lewis</span> <a href=\"#narrow/stream/187764-Lean-for.20teaching/topic/Real.20analysis/near/200151209\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"260507\">Heather Macbeth</span> 's example cutting the two ugliest lines from the ugly proof.</p>\n</blockquote>\n<p>Thanks for the update!  What do you mean by the \"two ugliest lines\", is it the two I could cut from a Lean/<code>linarith</code> proof <a href=\"#narrow/stream/187764-Lean-for.20teaching/topic/Real.20analysis/near/197363077\">here</a> while preserving a working Coq/<code>lra</code> proof?</p>",
        "id": 200161303,
        "sender_full_name": "Heather Macbeth",
        "timestamp": 1591653624
    },
    {
        "content": "<p>Yep! This works now, the Lean equivalent of your <code>lra</code> proof.</p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"kn\">example</span> <span class=\"o\">(</span><span class=\"n\">u</span> <span class=\"n\">v</span> <span class=\"n\">x</span> <span class=\"n\">y</span> <span class=\"n\">A</span> <span class=\"n\">B</span> <span class=\"o\">:</span> <span class=\"n\">ℝ</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"o\">(</span><span class=\"mi\">0</span> <span class=\"bp\">&lt;</span> <span class=\"n\">A</span><span class=\"o\">)</span> <span class=\"bp\">→</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"bp\">≤</span> <span class=\"mi\">1</span><span class=\"o\">)</span> <span class=\"bp\">→</span> <span class=\"o\">(</span><span class=\"mi\">1</span> <span class=\"bp\">≤</span> <span class=\"n\">B</span><span class=\"o\">)</span>\n<span class=\"bp\">→</span> <span class=\"o\">(</span><span class=\"n\">x</span> <span class=\"bp\">≤</span> <span class=\"n\">B</span><span class=\"o\">)</span> <span class=\"bp\">→</span> <span class=\"o\">(</span> <span class=\"n\">y</span> <span class=\"bp\">≤</span> <span class=\"n\">B</span><span class=\"o\">)</span>\n<span class=\"bp\">→</span> <span class=\"o\">(</span><span class=\"mi\">0</span> <span class=\"bp\">≤</span> <span class=\"n\">u</span> <span class=\"o\">)</span> <span class=\"bp\">→</span> <span class=\"o\">(</span><span class=\"mi\">0</span> <span class=\"bp\">≤</span> <span class=\"n\">v</span> <span class=\"o\">)</span>\n<span class=\"bp\">→</span> <span class=\"o\">(</span><span class=\"n\">u</span> <span class=\"bp\">&lt;</span> <span class=\"n\">A</span><span class=\"o\">)</span> <span class=\"bp\">→</span> <span class=\"o\">(</span> <span class=\"n\">v</span> <span class=\"bp\">&lt;</span> <span class=\"n\">A</span><span class=\"o\">)</span>\n<span class=\"bp\">→</span> <span class=\"o\">(</span><span class=\"n\">u</span> <span class=\"bp\">*</span> <span class=\"n\">y</span> <span class=\"bp\">+</span> <span class=\"n\">v</span> <span class=\"bp\">*</span> <span class=\"n\">x</span> <span class=\"bp\">+</span> <span class=\"n\">u</span> <span class=\"bp\">*</span> <span class=\"n\">v</span> <span class=\"bp\">&lt;</span> <span class=\"mi\">3</span> <span class=\"bp\">*</span> <span class=\"n\">A</span> <span class=\"bp\">*</span> <span class=\"n\">B</span><span class=\"o\">)</span> <span class=\"o\">:=</span>\n<span class=\"k\">begin</span>\n  <span class=\"n\">intros</span><span class=\"o\">,</span>\n  <span class=\"k\">have</span> <span class=\"n\">h1</span> <span class=\"o\">:</span> <span class=\"mi\">0</span> <span class=\"bp\">≤</span> <span class=\"n\">B</span> <span class=\"o\">:=</span> <span class=\"k\">by</span> <span class=\"n\">linarith</span><span class=\"o\">,</span>\n  <span class=\"k\">have</span> <span class=\"n\">h2</span> <span class=\"o\">:</span> <span class=\"mi\">0</span> <span class=\"bp\">≤</span> <span class=\"n\">A</span> <span class=\"o\">:=</span> <span class=\"k\">by</span> <span class=\"n\">linarith</span><span class=\"o\">,</span>\n  <span class=\"k\">have</span> <span class=\"o\">:=</span> <span class=\"n\">mul_le_mul_of_nonneg_left</span> <span class=\"n\">a_4</span> <span class=\"n\">a_5</span><span class=\"o\">,</span>\n  <span class=\"k\">have</span> <span class=\"o\">:=</span> <span class=\"n\">mul_le_mul_of_nonneg_right</span> <span class=\"o\">(</span><span class=\"n\">le_of_lt</span> <span class=\"n\">a_7</span><span class=\"o\">)</span> <span class=\"n\">h1</span><span class=\"o\">,</span>\n  <span class=\"k\">have</span> <span class=\"o\">:=</span> <span class=\"n\">mul_le_mul_of_nonneg_left</span> <span class=\"n\">a_3</span> <span class=\"n\">a_6</span><span class=\"o\">,</span>\n  <span class=\"k\">have</span> <span class=\"o\">:=</span> <span class=\"n\">mul_le_mul_of_nonneg_right</span> <span class=\"o\">(</span><span class=\"n\">le_of_lt</span> <span class=\"n\">a_8</span><span class=\"o\">)</span> <span class=\"n\">h1</span><span class=\"o\">,</span>\n  <span class=\"k\">have</span> <span class=\"o\">:=</span> <span class=\"n\">mul_le_mul_of_nonneg_right</span> <span class=\"o\">(</span><span class=\"n\">le_of_lt</span> <span class=\"n\">a_7</span><span class=\"o\">)</span> <span class=\"n\">a_6</span><span class=\"o\">,</span>\n  <span class=\"k\">have</span> <span class=\"o\">:=</span> <span class=\"n\">mul_le_mul_of_nonneg_right</span> <span class=\"n\">a_1</span> <span class=\"n\">a_6</span><span class=\"o\">,</span>\n  <span class=\"k\">have</span> <span class=\"o\">:=</span> <span class=\"n\">mul_le_mul_of_nonneg_right</span> <span class=\"n\">a_2</span> <span class=\"n\">h2</span><span class=\"o\">,</span>\n  <span class=\"n\">linarith</span>\n<span class=\"kn\">end</span>\n</code></pre></div>",
        "id": 200161863,
        "sender_full_name": "Rob Lewis",
        "timestamp": 1591654049
    },
    {
        "content": "<p>As for the secret sauce of <code>nra</code>, one trivial possibility.  There was this discovery of Mario's:<br>\n<span class=\"user-mention silent\" data-user-id=\"110049\">Mario Carneiro</span> <a href=\"#narrow/stream/187764-Lean-for.20teaching/topic/Real.20analysis/near/197348935\">said</a>:</p>\n<blockquote>\n<p>I think what they failed to mention is that constraints are already normalized to <code>0 &lt;= x</code>, <code>0 &lt; x</code> or <code>0 = x</code></p>\n</blockquote>\n<p>Is your <code>nlinarith</code> doing the same?</p>",
        "id": 200162148,
        "sender_full_name": "Heather Macbeth",
        "timestamp": 1591654241
    },
    {
        "content": "<p>I didn't update <code>nlinarith</code> beyond what Mario did, but no, I don't think it's doing that. At a glance I don't think that's what's going on, but maybe..</p>",
        "id": 200162894,
        "sender_full_name": "Rob Lewis",
        "timestamp": 1591654822
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"110596\">@Rob Lewis</span> I think that normalizing should be sufficient, but I think <code>linarith</code> is currently blocked by lack of normalization in cases like this:</p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"kn\">example</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"n\">B</span> <span class=\"o\">:</span> <span class=\"n\">ℚ</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">h</span> <span class=\"o\">:</span> <span class=\"mi\">0</span> <span class=\"bp\">&lt;</span> <span class=\"n\">A</span> <span class=\"bp\">*</span> <span class=\"n\">B</span> <span class=\"bp\">/</span> <span class=\"mi\">8</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"mi\">0</span> <span class=\"bp\">&lt;</span> <span class=\"n\">A</span> <span class=\"bp\">/</span> <span class=\"mi\">8</span> <span class=\"bp\">*</span> <span class=\"n\">B</span> <span class=\"o\">:=</span> <span class=\"k\">by</span> <span class=\"n\">linarith</span> <span class=\"c1\">-- fail</span>\n</code></pre></div>\n\n\n<p>which would be normalized by <code>ring</code> but are probably being treated as distinct by <code>linarith</code></p>",
        "id": 200182000,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1591677992
    },
    {
        "content": "<p>Assuming that <code>linarith</code> is able to normalize both of these terms to <code>1/8 * atom(A*B)</code>, it should be sufficient to normalize inequalities to <code>0 &lt;= x</code> to prove</p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"kn\">example</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"n\">B</span> <span class=\"o\">:</span> <span class=\"n\">ℚ</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"o\">(</span><span class=\"mi\">0</span> <span class=\"bp\">&lt;</span> <span class=\"n\">A</span><span class=\"o\">)</span> <span class=\"bp\">→</span> <span class=\"o\">(</span><span class=\"mi\">1</span> <span class=\"bp\">≤</span> <span class=\"n\">B</span><span class=\"o\">)</span> <span class=\"bp\">→</span> <span class=\"o\">(</span><span class=\"mi\">0</span> <span class=\"bp\">&lt;</span> <span class=\"n\">A</span> <span class=\"bp\">/</span> <span class=\"mi\">8</span> <span class=\"bp\">*</span> <span class=\"n\">B</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"k\">by</span> <span class=\"n\">nlinarith</span>\n</code></pre></div>\n\n\n<p>because the preprocessing will produce </p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"kn\">example</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"n\">B</span> <span class=\"o\">:</span> <span class=\"n\">ℚ</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">h1</span> <span class=\"o\">:</span> <span class=\"mi\">0</span> <span class=\"bp\">&lt;</span> <span class=\"n\">A</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">h2</span> <span class=\"o\">:</span> <span class=\"mi\">0</span> <span class=\"bp\">≤</span> <span class=\"n\">B</span> <span class=\"bp\">-</span> <span class=\"mi\">1</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">h3</span> <span class=\"o\">:</span> <span class=\"mi\">0</span> <span class=\"bp\">&lt;</span> <span class=\"n\">A</span> <span class=\"bp\">*</span> <span class=\"o\">(</span><span class=\"n\">B</span> <span class=\"bp\">-</span> <span class=\"mi\">1</span><span class=\"o\">))</span> <span class=\"o\">:</span>\n  <span class=\"mi\">0</span> <span class=\"bp\">&lt;</span> <span class=\"n\">A</span> <span class=\"bp\">/</span> <span class=\"mi\">8</span> <span class=\"bp\">*</span> <span class=\"n\">B</span> <span class=\"o\">:=</span> <span class=\"k\">by</span> <span class=\"n\">linarith</span>\n</code></pre></div>\n\n\n<p>and I can confirm that after monomial processing <code>linarith</code> is able to prove this goal:</p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"kn\">example</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"n\">B</span> <span class=\"o\">:</span> <span class=\"n\">ℚ</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">h1</span> <span class=\"o\">:</span> <span class=\"mi\">0</span> <span class=\"bp\">&lt;</span> <span class=\"n\">A</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">h2</span> <span class=\"o\">:</span> <span class=\"mi\">0</span> <span class=\"bp\">≤</span> <span class=\"n\">B</span> <span class=\"bp\">-</span> <span class=\"mi\">1</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">h3</span> <span class=\"o\">:</span> <span class=\"mi\">0</span> <span class=\"bp\">&lt;</span> <span class=\"n\">A</span> <span class=\"bp\">*</span> <span class=\"n\">B</span> <span class=\"bp\">-</span> <span class=\"n\">A</span><span class=\"o\">)</span> <span class=\"o\">:</span>\n  <span class=\"mi\">0</span> <span class=\"bp\">&lt;</span> <span class=\"mi\">1</span><span class=\"bp\">/</span><span class=\"mi\">8</span> <span class=\"bp\">*</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"bp\">*</span> <span class=\"n\">B</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"k\">by</span> <span class=\"n\">linarith</span> <span class=\"c1\">--works</span>\n</code></pre></div>",
        "id": 200182156,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1591678293
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"110049\">@Mario Carneiro</span> did you see the <code>linarith</code> update I mentioned above? <a href=\"https://github.com/leanprover-community/mathlib/issues/2995\">#2995</a></p>",
        "id": 200190198,
        "sender_full_name": "Rob Lewis",
        "timestamp": 1591688398
    },
    {
        "content": "<p>It proves </p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"kn\">example</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"n\">B</span> <span class=\"o\">:</span> <span class=\"n\">ℚ</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">h</span> <span class=\"o\">:</span> <span class=\"mi\">0</span> <span class=\"bp\">&lt;</span> <span class=\"n\">A</span> <span class=\"bp\">*</span> <span class=\"n\">B</span> <span class=\"bp\">/</span> <span class=\"mi\">8</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"mi\">0</span> <span class=\"bp\">&lt;</span> <span class=\"n\">A</span> <span class=\"bp\">/</span> <span class=\"mi\">8</span> <span class=\"bp\">*</span> <span class=\"n\">B</span> <span class=\"o\">:=</span> <span class=\"k\">by</span> <span class=\"n\">linarith</span>\n</code></pre></div>",
        "id": 200190241,
        "sender_full_name": "Rob Lewis",
        "timestamp": 1591688405
    },
    {
        "content": "<p>But not </p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"kn\">example</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"n\">B</span> <span class=\"o\">:</span> <span class=\"n\">ℚ</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"o\">(</span><span class=\"mi\">0</span> <span class=\"bp\">&lt;</span> <span class=\"n\">A</span><span class=\"o\">)</span> <span class=\"bp\">→</span> <span class=\"o\">(</span><span class=\"mi\">1</span> <span class=\"bp\">≤</span> <span class=\"n\">B</span><span class=\"o\">)</span> <span class=\"bp\">→</span> <span class=\"o\">(</span><span class=\"mi\">0</span> <span class=\"bp\">&lt;</span> <span class=\"n\">A</span> <span class=\"bp\">/</span> <span class=\"mi\">8</span> <span class=\"bp\">*</span> <span class=\"n\">B</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"k\">by</span> <span class=\"n\">nlinarith</span>\n</code></pre></div>",
        "id": 200190253,
        "sender_full_name": "Rob Lewis",
        "timestamp": 1591688418
    },
    {
        "content": "<p>I saw it after this message; I saw that you noticed something similar</p>",
        "id": 200190255,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1591688420
    },
    {
        "content": "<p>Note that you have to be able to reduce <code>A * (B - 1)</code> to <code>A * B - A * 1</code> during monomial processing</p>",
        "id": 200190285,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1591688460
    },
    {
        "content": "<p>Okay, yeah, I think you're right. Normalizing hypotheses to <code>0 &lt;</code> and running the current <code>nlinarith</code> preprocessing creates a problem that <code>lra</code> can solve. In principle <code>linarith</code> should solve it too, but it hits an implementation bottleneck. Fixable in theory, <code>lra</code> is more or less instant.</p>",
        "id": 200197968,
        "sender_full_name": "Rob Lewis",
        "timestamp": 1591693574
    },
    {
        "content": "<p>(This is on the more complicated example.)</p>",
        "id": 200198006,
        "sender_full_name": "Rob Lewis",
        "timestamp": 1591693603
    },
    {
        "content": "<p>It did give me a stack overflow in JSCoq but the native version has no trouble, heh.</p>",
        "id": 200198211,
        "sender_full_name": "Rob Lewis",
        "timestamp": 1591693730
    },
    {
        "content": "<p>ooh, how have I not heard about jscoq before</p>",
        "id": 200198412,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1591693851
    },
    {
        "content": "<p>Confirmed. I refactored linarith to avoid a very expensive comparison between <code>rb_map</code>s. Surprised that didn't turn up as a bottleneck earlier. It now solves this (~8 seconds on my laptop, so still room for improvement).</p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"kn\">lemma</span> <span class=\"n\">test7</span> <span class=\"o\">(</span><span class=\"n\">u</span> <span class=\"n\">v</span> <span class=\"n\">x</span> <span class=\"n\">y</span> <span class=\"n\">A</span> <span class=\"n\">B</span> <span class=\"o\">:</span> <span class=\"n\">ℚ</span><span class=\"o\">)</span>\n<span class=\"o\">(</span><span class=\"n\">a</span> <span class=\"o\">:</span> <span class=\"mi\">0</span> <span class=\"bp\">&lt;</span> <span class=\"n\">A</span><span class=\"o\">)</span>\n<span class=\"o\">(</span><span class=\"n\">a_1</span> <span class=\"o\">:</span> <span class=\"mi\">0</span> <span class=\"bp\">&lt;=</span> <span class=\"mi\">1</span> <span class=\"bp\">-</span> <span class=\"n\">A</span><span class=\"o\">)</span>\n<span class=\"o\">(</span><span class=\"n\">a_2</span> <span class=\"o\">:</span> <span class=\"mi\">0</span> <span class=\"bp\">&lt;=</span> <span class=\"n\">B</span> <span class=\"bp\">-</span> <span class=\"mi\">1</span><span class=\"o\">)</span>\n<span class=\"o\">(</span><span class=\"n\">a_3</span> <span class=\"o\">:</span> <span class=\"mi\">0</span> <span class=\"bp\">&lt;=</span> <span class=\"n\">B</span> <span class=\"bp\">-</span> <span class=\"n\">x</span><span class=\"o\">)</span>\n<span class=\"o\">(</span><span class=\"n\">a_4</span> <span class=\"o\">:</span> <span class=\"mi\">0</span> <span class=\"bp\">&lt;=</span> <span class=\"n\">B</span> <span class=\"bp\">-</span> <span class=\"n\">y</span><span class=\"o\">)</span>\n<span class=\"o\">(</span><span class=\"n\">a_5</span> <span class=\"o\">:</span> <span class=\"mi\">0</span> <span class=\"bp\">&lt;=</span> <span class=\"n\">u</span><span class=\"o\">)</span>\n<span class=\"o\">(</span><span class=\"n\">a_6</span> <span class=\"o\">:</span> <span class=\"mi\">0</span> <span class=\"bp\">&lt;=</span> <span class=\"n\">v</span><span class=\"o\">)</span>\n<span class=\"o\">(</span><span class=\"n\">a_7</span> <span class=\"o\">:</span> <span class=\"mi\">0</span> <span class=\"bp\">&lt;</span> <span class=\"n\">A</span> <span class=\"bp\">-</span> <span class=\"n\">u</span><span class=\"o\">)</span>\n<span class=\"o\">(</span><span class=\"n\">a_8</span> <span class=\"o\">:</span> <span class=\"mi\">0</span> <span class=\"bp\">&lt;</span> <span class=\"n\">A</span> <span class=\"bp\">-</span> <span class=\"n\">v</span><span class=\"o\">)</span> <span class=\"o\">:</span>\n <span class=\"n\">u</span> <span class=\"bp\">*</span> <span class=\"n\">y</span> <span class=\"bp\">+</span> <span class=\"n\">v</span> <span class=\"bp\">*</span> <span class=\"n\">x</span> <span class=\"bp\">+</span> <span class=\"n\">u</span> <span class=\"bp\">*</span> <span class=\"n\">v</span> <span class=\"bp\">&lt;</span> <span class=\"mi\">3</span> <span class=\"bp\">*</span> <span class=\"n\">A</span> <span class=\"bp\">*</span> <span class=\"n\">B</span> <span class=\"o\">:=</span>\n <span class=\"k\">begin</span>\n  <span class=\"n\">intros</span><span class=\"o\">,</span>\n  <span class=\"n\">nlinarith</span>\n <span class=\"kn\">end</span>\n</code></pre></div>",
        "id": 200216335,
        "sender_full_name": "Rob Lewis",
        "timestamp": 1591705101
    },
    {
        "content": "<p>So the <code>nlinarith</code> preprocessing just needs to normalize things to <code>0 &lt;</code> before running, and we're there.</p>",
        "id": 200216401,
        "sender_full_name": "Rob Lewis",
        "timestamp": 1591705157
    },
    {
        "content": "<p>Doesn't <code>linarith</code> already have to do this preprocessing? Perhaps <code>linarith</code> can split this processing out as a separate function so that <code>nlinarith</code> can insert itself after this processing but before the main work</p>",
        "id": 200218684,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1591705907
    },
    {
        "content": "<p>Yes, this can be part of a refactor of the whole <code>linarith</code> frontend.</p>",
        "id": 200220086,
        "sender_full_name": "Rob Lewis",
        "timestamp": 1591706226
    },
    {
        "content": "<p>Thank you very much Rob and Mario for taking time to work on this.</p>",
        "id": 200220266,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1591706272
    }
]