[
    {
        "content": "<p>Like when it's about 70 lines it starts to be slow. Is there anything to do?</p>",
        "id": 183415058,
        "sender_full_name": "YH",
        "timestamp": 1576283706
    },
    {
        "content": "<p>Sure but it depends exactly what the problem is which is hard to diagnose without seeing the code. It could be any one of many problems so please post an example.</p>",
        "id": 183416960,
        "sender_full_name": "Alex J. Best",
        "timestamp": 1576286376
    },
    {
        "content": "<p><a href=\"https://gist.github.com/3abc/5a1aa9aff302bfb6d2f1aab41c2b9e6e\" target=\"_blank\" title=\"https://gist.github.com/3abc/5a1aa9aff302bfb6d2f1aab41c2b9e6e\">https://gist.github.com/3abc/5a1aa9aff302bfb6d2f1aab41c2b9e6e</a> <br>\nOK here is what I had.</p>",
        "id": 183417189,
        "sender_full_name": "YH",
        "timestamp": 1576286722
    },
    {
        "content": "<p>it's just that at 60 lines whenever I add a new line it hangs like 10 - 15 seconds.</p>",
        "id": 183417266,
        "sender_full_name": "YH",
        "timestamp": 1576286833
    },
    {
        "content": "<p>Which line do you add?</p>",
        "id": 183417280,
        "sender_full_name": "Simon Hudon",
        "timestamp": 1576286866
    },
    {
        "content": "<p>It's likely not a matter of length so much as what kind of work the proof requires from Lean</p>",
        "id": 183417333,
        "sender_full_name": "Simon Hudon",
        "timestamp": 1576286903
    },
    {
        "content": "<p>Any newline, even if I add a random thing and remove it.</p>",
        "id": 183417334,
        "sender_full_name": "YH",
        "timestamp": 1576286904
    },
    {
        "content": "<p>What if you do <code>change _</code>?</p>",
        "id": 183417667,
        "sender_full_name": "Simon Hudon",
        "timestamp": 1576287418
    },
    {
        "content": "<p>I have added a modified version of your proof on a gist: <a href=\"https://gist.github.com/alexjbest/5e21dea71b7ea3c4be346fd89c216951\" target=\"_blank\" title=\"https://gist.github.com/alexjbest/5e21dea71b7ea3c4be346fd89c216951\">https://gist.github.com/alexjbest/5e21dea71b7ea3c4be346fd89c216951</a> . The short answer is that the proof is long and complicated and uses lots of tactics. Which is fine but its often better to break things up in some way or other. I'm definitely not an expert speeder-upper but here are some comments in no particular order, maybe not all of them are useful but I hope some of them are:</p>\n<ul>\n<li>Use separate lemmas for subproofs, these won't be re-checked each time you change the main proof, this is probably the most important thing</li>\n<li>You use <code>let</code>  sometimes for Props instead of <code>have</code> which seems unnecessary.</li>\n<li>When you have a lot of hypotheses in the context it can be hard for tactics like linarith to find a contradiction, so you can use <code>linarith only [blah]</code> to tell linarith which things will give a contradiction.</li>\n<li>Alternatively to this (but it is also good in general) you can structure your proof in such a way that when you are done with a statement it drops out of context for instance your <code>h</code> was only used to prove <code>hhhh</code> but it was cluttering up the context after so I moved <code>h</code> into a proof block for <code>hhhh</code> same for <code>hh</code> <code>hhh</code> and <code>LHS_nonneg</code></li>\n<li>After identifying that some <code>linarith</code> calls are just simple contradictions we can replace them e.g. <code>linarith only [hhhh, a2]</code> can become</li>\n</ul>\n<div class=\"codehilite\"><pre><span></span>      <span class=\"n\">apply</span> <span class=\"n\">lt_irrefl</span> <span class=\"o\">((</span><span class=\"n\">m</span> <span class=\"err\">^</span> <span class=\"mi\">4</span><span class=\"o\">)</span> <span class=\"err\">^</span> <span class=\"mi\">3</span><span class=\"o\">),</span>\n      <span class=\"n\">exact</span> <span class=\"n\">lt_of_lt_of_le</span> <span class=\"n\">a2</span> <span class=\"n\">hhhh</span><span class=\"o\">,</span>\n</pre></div>\n\n\n<p>or even <code>exact lt_irrefl ((m ^ 4) ^ 3) (lt_of_lt_of_le a2 hhhh),</code></p>\n<ul>\n<li>You can use <code>set_option profiler true</code> to see some profiling information about what is taking time</li>\n<li>Instead of using <code>have blah : blaaaah, begin blah end</code> you can use <code>have  blah : blaaaah := begin  blah end</code>  this makes it easier to use the profiler for one.</li>\n<li>simp is great but once you are happy with the way the proof is it is good to change it to <code>squeeze_simp</code> which will output a string <code>simp only [blah]</code> which should give a more minimal proof.</li>\n<li>The last part of the proof you used <code>norm_num</code> and <code>ring</code> which are pretty heavy handed, I tried just using simp instead and it worked but left a <code>0^3</code> in there so <code>simp [zero_pow]</code> replaced both norm_num and ring here, then with <code>squeeze_simp</code> i got to <code>simp only [zero_pow, nat.succ_pos', zero_mul, zero_add, mul_zero],</code> the profiler says this took 22ms instead of over 600ms to use the tactics. In summary norm_num and ring and other tactics are great if they are really needed sometimes simp is just as good.</li>\n</ul>",
        "id": 183421702,
        "sender_full_name": "Alex J. Best",
        "timestamp": 1576294337
    },
    {
        "content": "<blockquote>\n<ul>\n<li>You use <code>let</code>  sometimes for Props instead of <code>have</code> which seems unnecessary.</li>\n</ul>\n</blockquote>\n<p>This is something I wanted to ask, what is the difference between <code>have</code> and <code>let</code>? I felt <code>have</code> is only for one goal and <code>let</code> have a larger scope, but I am not sure.</p>",
        "id": 183427169,
        "sender_full_name": "YH",
        "timestamp": 1576304906
    },
    {
        "content": "<p>let remembers the definition of the term whereas have does not, for statements (Props) the definition / proof is not relevant once it is constructed, all that matters is that a term has been constructed. Most of the time if you are introducing terms of Types that are not Prop i.e. some natural or real number you want to remember its definition so that you can later substitute or otherwise work with it.</p>",
        "id": 183427525,
        "sender_full_name": "Alex J. Best",
        "timestamp": 1576305697
    },
    {
        "content": "<p>So as Alex says, usually the problem when Lean gets sluggish like this is that you have used an expensive tactic like <code>simp</code> and the convoluted algorithm which it has discovered to prove your goal (which can involve trying literally thousands of stupid ideas before it finds the right one) gets repeated again and again. The fault is not some inbuilt lean issue, it's an argument which mathematicians would call logically fine and which computer scientists would call bad code. It's normally just one line which is causing the problem. Alex has listed several suggestions but the main idea to fix an issue like this is either to refactor (ie prove your lemmas before your theorems, not as sublemmas) or to replace an expensive tactic with the proof it found. Sometimes it can be the typeclass system though and this can be harder to work around</p>",
        "id": 183428825,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1576308289
    },
    {
        "content": "<p>In particular your original claim \"when it gets to 70 lines Lean gets slow\" is not an accurate diagnosis of the situation. You can tell this can't be the case because some of the files in mathlib are 1000 lines long. What is happening in those files is that 98% of the proofs are two lines long. It's a bit of a pain to diagnose what's making a 70 line proof slow -- what happens with me in practice is that the moment the proof starts to become slow I stop and try to figure out what I did wrong.</p>",
        "id": 183429745,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1576310065
    },
    {
        "content": "<p>OK. I'm looking at Alex's modified version of my proof. <br>\nActually moving one thing out as a lemma reduces the whole elaboration by 2 seconds. (The one that gets from a ≥ 0 and  ¬(a &gt; 0) to a = 0.) I do believe many things can be improved in that proof.</p>",
        "id": 183429887,
        "sender_full_name": "YH",
        "timestamp": 1576310349
    },
    {
        "content": "<p>One thing you can do with your 70 line proof is this: Step 1: put <code>set_option profiler true</code> just before the statement of the lemma. Step 2: insert the line <code>repeat {sorry} end #exit</code> as the first line of the proof. Step 3: switch VS Code to \"Info View: Display Messages (Ctrl+Shift+Alt+Enter)\" (now the Lean Messages window prints debugging information about the entire file rather than just what's going on in the middle of one tactic mode proof). Step 4: move the <code>repeat {sorry} end #exit</code> line around until you spot a big jump in the time taken to elaborate <code>ag3</code>.</p>",
        "id": 183430184,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1576310697
    },
    {
        "content": "<p>Oh cool</p>",
        "id": 183430244,
        "sender_full_name": "YH",
        "timestamp": 1576310777
    },
    {
        "content": "<p>Step 2: insert the line repeat {sorry} end #exit as the first line of the proof (or the lemma?).</p>",
        "id": 183430251,
        "sender_full_name": "YH",
        "timestamp": 1576310814
    },
    {
        "content": "<p>This is just a random line which has a good chance of just dumping you out of the proof immediately.</p>",
        "id": 183430256,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1576310843
    },
    {
        "content": "<p>How do I do step 3 on a Mac?</p>",
        "id": 183430298,
        "sender_full_name": "YH",
        "timestamp": 1576310905
    },
    {
        "content": "<p>It doesn't always work, e.g. you have a begin/end block within another one and then you'll get syntax errors. This is why it's usually better to catch these things as they happen -- i.e. the <em>moment</em> things start getting slow, stop what you're doing and fix them.</p>",
        "id": 183430299,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1576310908
    },
    {
        "content": "<p><a href=\"/user_uploads/3121/KS1bb5dkzJpFrOYjiWRrXS8b/view.png\" target=\"_blank\" title=\"view.png\">view.png</a> Click the button that looks like that on VS Code</p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/KS1bb5dkzJpFrOYjiWRrXS8b/view.png\" target=\"_blank\" title=\"view.png\"><img src=\"/user_uploads/3121/KS1bb5dkzJpFrOYjiWRrXS8b/view.png\"></a></div>",
        "id": 183430310,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1576310947
    },
    {
        "content": "<p><a href=\"/user_uploads/3121/gf2BcagSHNtaNn8my6kOBtNl/pasted_image.png\" target=\"_blank\" title=\"pasted_image.png\">pasted image</a> <br>\nCannot find any button like that...</p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/gf2BcagSHNtaNn8my6kOBtNl/pasted_image.png\" target=\"_blank\" title=\"pasted image\"><img src=\"/user_uploads/3121/gf2BcagSHNtaNn8my6kOBtNl/pasted_image.png\"></a></div>",
        "id": 183430364,
        "sender_full_name": "YH",
        "timestamp": 1576311019
    },
    {
        "content": "<p>Try the three dots in the top right?</p>",
        "id": 183430365,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1576311038
    },
    {
        "content": "<p><a href=\"/user_uploads/3121/-gV233IPu-oDVTGB-3JroVzk/pasted_image.png\" target=\"_blank\" title=\"pasted_image.png\">pasted image</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/-gV233IPu-oDVTGB-3JroVzk/pasted_image.png\" target=\"_blank\" title=\"pasted image\"><img src=\"/user_uploads/3121/-gV233IPu-oDVTGB-3JroVzk/pasted_image.png\"></a></div>",
        "id": 183430371,
        "sender_full_name": "YH",
        "timestamp": 1576311056
    },
    {
        "content": "<p>You have a tab which says \"Lean Messages\". If you close it, how can you open it again?</p>",
        "id": 183430377,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1576311071
    },
    {
        "content": "<p>My guess is that on a mac it will be command+all those other keys I mentioned</p>",
        "id": 183430380,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1576311093
    },
    {
        "content": "<p>Oh yeah close it the button appears</p>",
        "id": 183430381,
        "sender_full_name": "YH",
        "timestamp": 1576311097
    },
    {
        "content": "<p>There are two different windows displaying Lean messages, both helpfully with the title \"Lean Messages\" and explaining different things :-/</p>",
        "id": 183430425,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1576311139
    },
    {
        "content": "<p><a href=\"/user_uploads/3121/wOAus7OsRfZr8qjFjC9xO10A/pasted_image.png\" target=\"_blank\" title=\"pasted_image.png\">pasted image</a> <br>\nIs this the info view?</p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/wOAus7OsRfZr8qjFjC9xO10A/pasted_image.png\" target=\"_blank\" title=\"pasted image\"><img src=\"/user_uploads/3121/wOAus7OsRfZr8qjFjC9xO10A/pasted_image.png\"></a></div>",
        "id": 183430427,
        "sender_full_name": "YH",
        "timestamp": 1576311146
    },
    {
        "content": "<p>Yes!</p>",
        "id": 183430429,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1576311162
    },
    {
        "content": "<p>Oh OK. It was always open here...</p>",
        "id": 183430432,
        "sender_full_name": "YH",
        "timestamp": 1576311177
    },
    {
        "content": "<p>Now compile your proof and see if you have something like \"elaboration of ag3 took 10 seconds\" somewhere</p>",
        "id": 183430442,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1576311189
    },
    {
        "content": "<p><code>elaboration of ag3 took 4.99s</code></p>",
        "id": 183430489,
        "sender_full_name": "YH",
        "timestamp": 1576311254
    },
    {
        "content": "<p>so there's your problem, and there's just one or two bad lines of code in there where you use something like <code>simp</code> to go from a&lt;b to <code>not b&lt;=a</code> and it takes Lean about 2 seconds to do this, and you could cut this down to 0.002 seconds by changing that line to <code>rw lt_iff_not_le</code> or something.</p>",
        "id": 183430500,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1576311323
    },
    {
        "content": "<p>The problem is that it turns out that maths does not go at infinite speed.</p>",
        "id": 183430503,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1576311360
    },
    {
        "content": "<p>That's why they have induction as an axiom ;-)</p>",
        "id": 183430545,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1576311369
    },
    {
        "content": "<p>If we know <code>P 0</code> is true and <code>P n -&gt; P (n + 1)</code> then we can instantly deduce <code>P 10^10^10^10</code></p>",
        "id": 183430549,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1576311391
    },
    {
        "content": "<p>There are some things which I repeated three times. <br>\nLike proving some properties of 4th root of a number.<br>\nI will see if I can write a function into subtypes of ℝ and get a 4th root map together with its properties.</p>",
        "id": 183430552,
        "sender_full_name": "YH",
        "timestamp": 1576311400
    },
    {
        "content": "<p>because we won't ever bother writing the proof down</p>",
        "id": 183430553,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1576311404
    },
    {
        "content": "<p>These things are a pain to debug though. Sometimes it's just little things building up. There might be some killer line in there somewhere and rewriting it will save you 4 seconds. But it might just be a case of an annoying refactor.</p>",
        "id": 183430562,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1576311466
    },
    {
        "content": "<p>Is the 4.99s the old one or the one I modified? I think I got it down to 1.2s on my computer (a laptop) so if it's the modified one it could just be that your computer can't run lean that fast.</p>",
        "id": 183430638,
        "sender_full_name": "Alex J. Best",
        "timestamp": 1576311601
    },
    {
        "content": "<p>The old one.</p>",
        "id": 183438888,
        "sender_full_name": "YH",
        "timestamp": 1576326778
    },
    {
        "content": "<p>The new one actually took 3.17 on my computer. (If it is CPU that matters then it is a 2.3 GHz Intel Core i7)</p>",
        "id": 183452487,
        "sender_full_name": "YH",
        "timestamp": 1576348318
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"249123\">@YH</span> </p>\n<div class=\"codehilite\"><pre><span></span><span class=\"kn\">import</span> <span class=\"n\">data</span><span class=\"bp\">.</span><span class=\"n\">real</span><span class=\"bp\">.</span><span class=\"n\">basic</span>\n<span class=\"kn\">import</span> <span class=\"n\">data</span><span class=\"bp\">.</span><span class=\"n\">real</span><span class=\"bp\">.</span><span class=\"n\">nnreal</span>\n<span class=\"kn\">import</span> <span class=\"n\">data</span><span class=\"bp\">.</span><span class=\"n\">rat</span>\n<span class=\"kn\">open</span> <span class=\"n\">real</span> <span class=\"n\">nnreal</span>\n\n<span class=\"kn\">lemma</span> <span class=\"n\">ag2</span> <span class=\"o\">(</span><span class=\"n\">a</span> <span class=\"n\">b</span> <span class=\"o\">:</span> <span class=\"n\">ℝ</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"mi\">2</span> <span class=\"bp\">*</span> <span class=\"n\">a</span> <span class=\"bp\">*</span> <span class=\"n\">b</span> <span class=\"bp\">≤</span> <span class=\"n\">a</span> <span class=\"err\">^</span> <span class=\"mi\">2</span> <span class=\"bp\">+</span> <span class=\"n\">b</span> <span class=\"err\">^</span> <span class=\"mi\">2</span> <span class=\"o\">:=</span>\n<span class=\"k\">begin</span>\n  <span class=\"n\">apply</span> <span class=\"n\">le_of_sub_nonneg</span><span class=\"o\">,</span>\n  <span class=\"n\">convert</span> <span class=\"n\">mul_self_nonneg</span> <span class=\"o\">(</span><span class=\"n\">a</span> <span class=\"bp\">-</span> <span class=\"n\">b</span><span class=\"o\">),</span>\n  <span class=\"n\">ring</span>\n<span class=\"kn\">end</span>\n</pre></div>",
        "id": 183454894,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1576352039
    },
    {
        "content": "<p>also, IIRC, <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mi>a</mi><mn>3</mn></msup><mo>+</mo><msup><mi>b</mi><mn>3</mn></msup><mo>+</mo><msup><mi>c</mi><mn>3</mn></msup><mo>−</mo><mn>3</mn><mi>a</mi><mi>b</mi><mi>c</mi><mo>=</mo><mfrac><mn>1</mn><mn>2</mn></mfrac><mo stretchy=\"false\">(</mo><mi>a</mi><mo>+</mo><mi>b</mi><mo>+</mo><mi>c</mi><mo stretchy=\"false\">)</mo><mo stretchy=\"false\">(</mo><mo stretchy=\"false\">(</mo><mi>a</mi><mo>−</mo><mi>b</mi><msup><mo stretchy=\"false\">)</mo><mn>2</mn></msup><mo>+</mo><mo stretchy=\"false\">(</mo><mi>b</mi><mo>−</mo><mi>c</mi><msup><mo stretchy=\"false\">)</mo><mn>2</mn></msup><mo>+</mo><mo stretchy=\"false\">(</mo><mi>c</mi><mo>−</mo><mi>a</mi><msup><mo stretchy=\"false\">)</mo><mn>2</mn></msup><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">a^3 + b^3 + c^3 - 3abc = \\frac 12 (a + b + c) ((a - b)^2 + (b - c)^2 + (c - a)^2)</annotation></semantics></math></span><span aria-hidden=\"true\" class=\"katex-html\"><span class=\"base\"><span class=\"strut\" style=\"height:0.897438em;vertical-align:-0.08333em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">a</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">3</span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.897438em;vertical-align:-0.08333em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">b</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">3</span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.897438em;vertical-align:-0.08333em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">c</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">3</span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"mord\">3</span><span class=\"mord mathdefault\">a</span><span class=\"mord mathdefault\">b</span><span class=\"mord mathdefault\">c</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.190108em;vertical-align:-0.345em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.845108em;\"><span style=\"top:-2.6550000000000002em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.394em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.345em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span><span class=\"mopen\">(</span><span class=\"mord mathdefault\">a</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.77777em;vertical-align:-0.08333em;\"></span><span class=\"mord mathdefault\">b</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathdefault\">c</span><span class=\"mclose\">)</span><span class=\"mopen\">(</span><span class=\"mopen\">(</span><span class=\"mord mathdefault\">a</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.064108em;vertical-align:-0.25em;\"></span><span class=\"mord mathdefault\">b</span><span class=\"mclose\"><span class=\"mclose\">)</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord mathdefault\">b</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.064108em;vertical-align:-0.25em;\"></span><span class=\"mord mathdefault\">c</span><span class=\"mclose\"><span class=\"mclose\">)</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord mathdefault\">c</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.064108em;vertical-align:-0.25em;\"></span><span class=\"mord mathdefault\">a</span><span class=\"mclose\"><span class=\"mclose\">)</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span><span class=\"mclose\">)</span></span></span></span></p>",
        "id": 183454990,
        "sender_full_name": "Reid Barton",
        "timestamp": 1576352134
    },
    {
        "content": "<p>spoken like a true IMOer.</p>",
        "id": 183455000,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1576352160
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span><span class=\"kn\">example</span> <span class=\"o\">(</span><span class=\"n\">a</span> <span class=\"n\">b</span> <span class=\"n\">c</span> <span class=\"o\">:</span> <span class=\"n\">ℝ</span><span class=\"o\">):</span> <span class=\"n\">a</span> <span class=\"err\">^</span> <span class=\"mi\">3</span> <span class=\"bp\">+</span> <span class=\"n\">b</span> <span class=\"err\">^</span> <span class=\"mi\">3</span> <span class=\"bp\">+</span> <span class=\"n\">c</span> <span class=\"err\">^</span> <span class=\"mi\">3</span> <span class=\"bp\">-</span> <span class=\"mi\">3</span> <span class=\"bp\">*</span> <span class=\"n\">a</span> <span class=\"bp\">*</span> <span class=\"n\">b</span> <span class=\"bp\">*</span> <span class=\"n\">c</span> <span class=\"bp\">=</span>\n<span class=\"mi\">1</span> <span class=\"bp\">/</span> <span class=\"mi\">2</span> <span class=\"bp\">*</span> <span class=\"o\">(</span><span class=\"n\">a</span> <span class=\"bp\">+</span> <span class=\"n\">b</span> <span class=\"bp\">+</span> <span class=\"n\">c</span><span class=\"o\">)</span> <span class=\"bp\">*</span> <span class=\"o\">((</span><span class=\"n\">a</span> <span class=\"bp\">-</span> <span class=\"n\">b</span><span class=\"o\">)</span> <span class=\"err\">^</span> <span class=\"mi\">2</span> <span class=\"bp\">+</span> <span class=\"o\">(</span><span class=\"n\">b</span> <span class=\"bp\">-</span> <span class=\"n\">c</span><span class=\"o\">)</span> <span class=\"err\">^</span> <span class=\"mi\">2</span> <span class=\"bp\">+</span> <span class=\"o\">(</span><span class=\"n\">c</span> <span class=\"bp\">-</span> <span class=\"n\">a</span><span class=\"o\">)</span> <span class=\"err\">^</span> <span class=\"mi\">2</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"k\">by</span> <span class=\"n\">ring</span>\n</pre></div>",
        "id": 183455140,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1576352307
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span><span class=\"kn\">lemma</span> <span class=\"n\">ag4</span> <span class=\"o\">(</span><span class=\"n\">a</span> <span class=\"n\">b</span> <span class=\"n\">c</span> <span class=\"n\">d</span> <span class=\"o\">:</span> <span class=\"n\">ℝ</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"mi\">4</span> <span class=\"bp\">*</span> <span class=\"o\">(</span><span class=\"n\">a</span> <span class=\"bp\">*</span> <span class=\"n\">b</span> <span class=\"bp\">*</span> <span class=\"n\">c</span> <span class=\"bp\">*</span> <span class=\"n\">d</span><span class=\"o\">)</span> <span class=\"bp\">≤</span> <span class=\"n\">a</span> <span class=\"err\">^</span> <span class=\"mi\">4</span> <span class=\"bp\">+</span> <span class=\"n\">b</span> <span class=\"err\">^</span> <span class=\"mi\">4</span> <span class=\"bp\">+</span> <span class=\"n\">c</span> <span class=\"err\">^</span> <span class=\"mi\">4</span> <span class=\"bp\">+</span> <span class=\"n\">d</span> <span class=\"err\">^</span> <span class=\"mi\">4</span> <span class=\"o\">:=</span>\n<span class=\"k\">calc</span> <span class=\"mi\">4</span> <span class=\"bp\">*</span> <span class=\"o\">(</span><span class=\"n\">a</span> <span class=\"bp\">*</span> <span class=\"n\">b</span> <span class=\"bp\">*</span> <span class=\"n\">c</span> <span class=\"bp\">*</span> <span class=\"n\">d</span><span class=\"o\">)</span>\n     <span class=\"bp\">=</span> <span class=\"mi\">2</span> <span class=\"bp\">*</span> <span class=\"o\">(</span><span class=\"mi\">2</span> <span class=\"bp\">*</span> <span class=\"o\">(</span><span class=\"n\">a</span> <span class=\"bp\">*</span> <span class=\"n\">b</span><span class=\"o\">)</span> <span class=\"bp\">*</span> <span class=\"o\">(</span><span class=\"n\">c</span> <span class=\"bp\">*</span> <span class=\"n\">d</span><span class=\"o\">))</span> <span class=\"o\">:</span> <span class=\"k\">by</span> <span class=\"n\">ring</span>\n<span class=\"bp\">...</span>  <span class=\"bp\">≤</span> <span class=\"mi\">2</span> <span class=\"bp\">*</span> <span class=\"o\">((</span><span class=\"n\">a</span> <span class=\"bp\">*</span> <span class=\"n\">b</span><span class=\"o\">)</span> <span class=\"err\">^</span> <span class=\"mi\">2</span> <span class=\"bp\">+</span> <span class=\"o\">(</span><span class=\"n\">c</span> <span class=\"bp\">*</span> <span class=\"n\">d</span><span class=\"o\">)</span> <span class=\"err\">^</span> <span class=\"mi\">2</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"o\">(</span><span class=\"n\">mul_le_mul_left</span> <span class=\"err\">$</span> <span class=\"k\">by</span> <span class=\"n\">norm_num</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"mi\">2</span> <span class=\"err\">$</span> <span class=\"n\">ag2</span> <span class=\"bp\">_</span> <span class=\"bp\">_</span>\n<span class=\"bp\">...</span>  <span class=\"bp\">=</span> <span class=\"mi\">2</span> <span class=\"bp\">*</span> <span class=\"n\">a</span> <span class=\"err\">^</span> <span class=\"mi\">2</span> <span class=\"bp\">*</span> <span class=\"n\">b</span> <span class=\"err\">^</span> <span class=\"mi\">2</span> <span class=\"bp\">+</span> <span class=\"mi\">2</span> <span class=\"bp\">*</span> <span class=\"n\">c</span> <span class=\"err\">^</span> <span class=\"mi\">2</span> <span class=\"bp\">*</span> <span class=\"n\">d</span> <span class=\"err\">^</span> <span class=\"mi\">2</span> <span class=\"o\">:</span> <span class=\"k\">by</span> <span class=\"n\">ring</span>\n<span class=\"bp\">...</span>  <span class=\"bp\">≤</span> <span class=\"o\">(</span><span class=\"n\">a</span> <span class=\"err\">^</span> <span class=\"mi\">2</span><span class=\"o\">)</span> <span class=\"err\">^</span> <span class=\"mi\">2</span> <span class=\"bp\">+</span> <span class=\"o\">(</span><span class=\"n\">b</span> <span class=\"err\">^</span> <span class=\"mi\">2</span><span class=\"o\">)</span> <span class=\"err\">^</span> <span class=\"mi\">2</span>     <span class=\"bp\">+</span> <span class=\"mi\">2</span> <span class=\"bp\">*</span> <span class=\"n\">c</span> <span class=\"err\">^</span> <span class=\"mi\">2</span> <span class=\"bp\">*</span> <span class=\"n\">d</span> <span class=\"err\">^</span> <span class=\"mi\">2</span> <span class=\"o\">:</span> <span class=\"n\">add_le_add_right</span> <span class=\"o\">(</span><span class=\"n\">ag2</span> <span class=\"bp\">_</span> <span class=\"bp\">_</span><span class=\"o\">)</span> <span class=\"bp\">_</span>\n<span class=\"bp\">...</span>  <span class=\"bp\">≤</span> <span class=\"o\">(</span><span class=\"n\">a</span> <span class=\"err\">^</span> <span class=\"mi\">2</span><span class=\"o\">)</span> <span class=\"err\">^</span> <span class=\"mi\">2</span> <span class=\"bp\">+</span> <span class=\"o\">(</span><span class=\"n\">b</span> <span class=\"err\">^</span> <span class=\"mi\">2</span><span class=\"o\">)</span> <span class=\"err\">^</span> <span class=\"mi\">2</span>  <span class=\"bp\">+</span> <span class=\"o\">((</span><span class=\"n\">c</span> <span class=\"err\">^</span> <span class=\"mi\">2</span><span class=\"o\">)</span> <span class=\"err\">^</span> <span class=\"mi\">2</span> <span class=\"bp\">+</span> <span class=\"o\">(</span><span class=\"n\">d</span> <span class=\"err\">^</span> <span class=\"mi\">2</span><span class=\"o\">)</span> <span class=\"err\">^</span> <span class=\"mi\">2</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">add_le_add_left</span> <span class=\"o\">(</span><span class=\"n\">ag2</span> <span class=\"bp\">_</span> <span class=\"bp\">_</span><span class=\"o\">)</span> <span class=\"bp\">_</span>\n<span class=\"bp\">...</span>  <span class=\"bp\">=</span> <span class=\"n\">a</span> <span class=\"err\">^</span> <span class=\"mi\">4</span> <span class=\"bp\">+</span> <span class=\"n\">b</span> <span class=\"err\">^</span> <span class=\"mi\">4</span> <span class=\"bp\">+</span> <span class=\"n\">c</span> <span class=\"err\">^</span> <span class=\"mi\">4</span> <span class=\"bp\">+</span> <span class=\"n\">d</span> <span class=\"err\">^</span> <span class=\"mi\">4</span> <span class=\"o\">:</span> <span class=\"k\">by</span> <span class=\"n\">ring</span>\n</pre></div>\n\n\n<p>You can get <code>ag4</code> from <code>ag2</code> purely in calc mode</p>",
        "id": 183455713,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1576353151
    },
    {
        "content": "<p>The trick is to know exactly what the <code>ring</code> tactic can and can't do. I switch between term mode proofs like <code>add_le_add_right (ag2 _ _) _</code> which corresponds to what a mathematician means when they say \"now apply AG2 and we deduce that...\"</p>",
        "id": 183455795,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1576353249
    },
    {
        "content": "<p>All the equalities I did with <code>ring</code> and on the other steps I moved as little as possible.</p>",
        "id": 183455799,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1576353274
    },
    {
        "content": "<p>@YH your <code>ag3</code> code compiles with no warnings about sorrys now <span aria-label=\"grinning\" class=\"emoji emoji-1f600\" role=\"img\" title=\"grinning\">:grinning:</span></p>",
        "id": 183455837,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1576353358
    },
    {
        "content": "<blockquote>\n<p>also, IIRC, <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mi>a</mi><mn>3</mn></msup><mo>+</mo><msup><mi>b</mi><mn>3</mn></msup><mo>+</mo><msup><mi>c</mi><mn>3</mn></msup><mo>−</mo><mn>3</mn><mi>a</mi><mi>b</mi><mi>c</mi><mo>=</mo><mfrac><mn>1</mn><mn>2</mn></mfrac><mo stretchy=\"false\">(</mo><mi>a</mi><mo>+</mo><mi>b</mi><mo>+</mo><mi>c</mi><mo stretchy=\"false\">)</mo><mo stretchy=\"false\">(</mo><mo stretchy=\"false\">(</mo><mi>a</mi><mo>−</mo><mi>b</mi><msup><mo stretchy=\"false\">)</mo><mn>2</mn></msup><mo>+</mo><mo stretchy=\"false\">(</mo><mi>b</mi><mo>−</mo><mi>c</mi><msup><mo stretchy=\"false\">)</mo><mn>2</mn></msup><mo>+</mo><mo stretchy=\"false\">(</mo><mi>c</mi><mo>−</mo><mi>a</mi><msup><mo stretchy=\"false\">)</mo><mn>2</mn></msup><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">a^3 + b^3 + c^3 - 3abc = \\frac 12 (a + b + c) ((a - b)^2 + (b - c)^2 + (c - a)^2)</annotation></semantics></math></span><span aria-hidden=\"true\" class=\"katex-html\"><span class=\"base\"><span class=\"strut\" style=\"height:0.897438em;vertical-align:-0.08333em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">a</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">3</span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.897438em;vertical-align:-0.08333em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">b</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">3</span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.897438em;vertical-align:-0.08333em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">c</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">3</span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"mord\">3</span><span class=\"mord mathdefault\">a</span><span class=\"mord mathdefault\">b</span><span class=\"mord mathdefault\">c</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.190108em;vertical-align:-0.345em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.845108em;\"><span style=\"top:-2.6550000000000002em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.394em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.345em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span><span class=\"mopen\">(</span><span class=\"mord mathdefault\">a</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.77777em;vertical-align:-0.08333em;\"></span><span class=\"mord mathdefault\">b</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathdefault\">c</span><span class=\"mclose\">)</span><span class=\"mopen\">(</span><span class=\"mopen\">(</span><span class=\"mord mathdefault\">a</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.064108em;vertical-align:-0.25em;\"></span><span class=\"mord mathdefault\">b</span><span class=\"mclose\"><span class=\"mclose\">)</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord mathdefault\">b</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.064108em;vertical-align:-0.25em;\"></span><span class=\"mord mathdefault\">c</span><span class=\"mclose\"><span class=\"mclose\">)</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord mathdefault\">c</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.064108em;vertical-align:-0.25em;\"></span><span class=\"mord mathdefault\">a</span><span class=\"mclose\"><span class=\"mclose\">)</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span><span class=\"mclose\">)</span></span></span></span></p>\n</blockquote>\n<p>Yeah I know this one. I just want to write a proof that can be generalized.</p>",
        "id": 183456493,
        "sender_full_name": "YH",
        "timestamp": 1576354215
    },
    {
        "content": "<p>I don't want to spoil your fun, so feel free not to look at this! But I got a bit addicted and I think I got the general AM-GM to work, its a bit ugly atm (I should have proved more lemmas about nnreal from the start) and was quite hard (for me) ~450 lines. but if anyone is curious I followed the proof in <a href=\"https://math.stackexchange.com/a/1665056/31917\" target=\"_blank\" title=\"https://math.stackexchange.com/a/1665056/31917\">https://math.stackexchange.com/a/1665056/31917</a> and ended up with <a href=\"https://gist.github.com/alexjbest/da0a2e2acf3ba252659531ca77a3b5a7\" target=\"_blank\" title=\"https://gist.github.com/alexjbest/da0a2e2acf3ba252659531ca77a3b5a7\">https://gist.github.com/alexjbest/da0a2e2acf3ba252659531ca77a3b5a7</a></p>",
        "id": 183463815,
        "sender_full_name": "Alex J. Best",
        "timestamp": 1576367381
    },
    {
        "content": "<p>Oh <span aria-label=\"oops\" class=\"emoji emoji-1f643\" role=\"img\" title=\"oops\">:oops:</span>  I see <span class=\"user-mention\" data-user-id=\"214703\">@Yury G. Kudryashov</span> has added some of these useful lemmas for nnreal already, I really should update mathlib more often!</p>",
        "id": 183464756,
        "sender_full_name": "Alex J. Best",
        "timestamp": 1576369104
    },
    {
        "content": "<blockquote>\n<p>I don't want to spoil your fun, so feel free not to look at this! But I got a bit addicted and I think I got the general AM-GM to work, its a bit ugly atm (I should have proved more lemmas about nnreal from the start) and was quite hard (for me) ~450 lines. but if anyone is curious I followed the proof in <a href=\"https://math.stackexchange.com/a/1665056/31917\" target=\"_blank\" title=\"https://math.stackexchange.com/a/1665056/31917\">https://math.stackexchange.com/a/1665056/31917</a> and ended up with <a href=\"https://gist.github.com/alexjbest/da0a2e2acf3ba252659531ca77a3b5a7\" target=\"_blank\" title=\"https://gist.github.com/alexjbest/da0a2e2acf3ba252659531ca77a3b5a7\">https://gist.github.com/alexjbest/da0a2e2acf3ba252659531ca77a3b5a7</a></p>\n</blockquote>\n<p>Oh nice. I looked at the stackexchange proof.  What I had in mind is a different one. Since <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>n</mi><mo>≤</mo><msup><mn>2</mn><mi>n</mi></msup></mrow><annotation encoding=\"application/x-tex\">n ≤ 2^n</annotation></semantics></math></span><span aria-hidden=\"true\" class=\"katex-html\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7719400000000001em;vertical-align:-0.13597em;\"></span><span class=\"mord mathdefault\">n</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.664392em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord\">2</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.664392em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">n</span></span></span></span></span></span></span></span></span></span></span> and we have AM-GM for any <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>n</mi><mo>=</mo><msup><mn>2</mn><mi>m</mi></msup></mrow><annotation encoding=\"application/x-tex\">n = 2^m</annotation></semantics></math></span><span aria-hidden=\"true\" class=\"katex-html\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">n</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.664392em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord\">2</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.664392em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">m</span></span></span></span></span></span></span></span></span></span></span>,  for arbitrary non-negative <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>a</mi><mn>1</mn></msub><mo separator=\"true\">,</mo><mo>…</mo><mo separator=\"true\">,</mo><msub><mi>a</mi><mi>n</mi></msub></mrow><annotation encoding=\"application/x-tex\">a_1, \\ldots, a_n</annotation></semantics></math></span><span aria-hidden=\"true\" class=\"katex-html\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.19444em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"minner\">…</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.151392em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">n</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>, make it <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mn>2</mn><mi>n</mi></msup></mrow><annotation encoding=\"application/x-tex\">2^n</annotation></semantics></math></span><span aria-hidden=\"true\" class=\"katex-html\"><span class=\"base\"><span class=\"strut\" style=\"height:0.664392em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord\">2</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.664392em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">n</span></span></span></span></span></span></span></span></span></span></span> numbers <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>b</mi><mn>1</mn></msub><mo separator=\"true\">,</mo><mo>…</mo><mo separator=\"true\">,</mo><msub><mi>b</mi><mi>n</mi></msub><mo separator=\"true\">,</mo><mi>m</mi><mo separator=\"true\">,</mo><mi>m</mi><mo separator=\"true\">,</mo><mi>m</mi><mo separator=\"true\">,</mo><mo>…</mo><mo separator=\"true\">,</mo><mi>m</mi></mrow><annotation encoding=\"application/x-tex\">b_1, \\ldots, b_n, m, m, m, \\ldots, m</annotation></semantics></math></span><span aria-hidden=\"true\" class=\"katex-html\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8888799999999999em;vertical-align:-0.19444em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">b</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"minner\">…</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">b</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.151392em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">n</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathdefault\">m</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathdefault\">m</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathdefault\">m</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"minner\">…</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathdefault\">m</span></span></span></span> with the property <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msubsup><mi>b</mi><mi>k</mi><msup><mn>2</mn><mi>n</mi></msup></msubsup><mo>=</mo><msubsup><mi>a</mi><mi>k</mi><mi>n</mi></msubsup><mo separator=\"true\">,</mo><msup><mi>m</mi><msup><mn>2</mn><mi>n</mi></msup></msup><mo>=</mo><mstyle displaystyle=\"true\" scriptlevel=\"0\"><mfrac><mrow><msub><mo>∑</mo><mi>k</mi></msub><msubsup><mi>a</mi><mi>k</mi><mi>n</mi></msubsup></mrow><mi>n</mi></mfrac></mstyle></mrow><annotation encoding=\"application/x-tex\">b_k^{2^n} = a_k^n, m^{2^n} = \\dfrac{\\sum_k a_k^n}{n}</annotation></semantics></math></span><span aria-hidden=\"true\" class=\"katex-html\"><span class=\"base\"><span class=\"strut\" style=\"height:1.163088em;vertical-align:-0.2831079999999999em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">b</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.87998em;\"><span style=\"top:-2.4168920000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\" style=\"margin-right:0.03148em;\">k</span></span></span><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">2</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7385428571428572em;\"><span style=\"top:-2.931em;margin-right:0.07142857142857144em;\"><span class=\"pstrut\" style=\"height:2.5em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mathdefault mtight\">n</span></span></span></span></span></span></span></span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2831079999999999em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.163088em;vertical-align:-0.2831079999999999em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.664392em;\"><span style=\"top:-2.4168920000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\" style=\"margin-right:0.03148em;\">k</span></span></span><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">n</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2831079999999999em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">m</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.87998em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">2</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7385428571428572em;\"><span style=\"top:-2.931em;margin-right:0.07142857142857144em;\"><span class=\"pstrut\" style=\"height:2.5em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mathdefault mtight\">n</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:2.12571em;vertical-align:-0.686em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.4397100000000003em;\"><span style=\"top:-2.314em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">n</span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.6897100000000003em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mop\"><span class=\"mop op-symbol small-op\" style=\"position:relative;top:-0.0000050000000000050004em;\">∑</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1863979999999999em;\"><span style=\"top:-2.40029em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\" style=\"margin-right:0.03148em;\">k</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.29971000000000003em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.664392em;\"><span style=\"top:-2.4168920000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\" style=\"margin-right:0.03148em;\">k</span></span></span><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">n</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2831079999999999em;\"><span></span></span></span></span></span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.686em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span></span></span></span>. Now put it in AM-GM for <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mn>2</mn><mi>n</mi></msup></mrow><annotation encoding=\"application/x-tex\">2^n</annotation></semantics></math></span><span aria-hidden=\"true\" class=\"katex-html\"><span class=\"base\"><span class=\"strut\" style=\"height:0.664392em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord\">2</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.664392em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">n</span></span></span></span></span></span></span></span></span></span></span> numbers and simplify. Good thing about this is that it bypasses the definition of $n$-th root or fancy lemmas in <code>nnreal</code> (only need square root), it also bypasses the fancy induction (that proves it for $2^n$ and goes down), but I'm still struggling having lean doing basic algebraic operations.</p>",
        "id": 183464826,
        "sender_full_name": "YH",
        "timestamp": 1576369286
    },
    {
        "content": "<p>Ah that also sounds like a nice proof, I agree that avoiding the fancy induction seems good, the thing that attracted me to the one I picked is that the \"padding\" inductive step only involves replacing a couple of elements of the list, which seemed marginally easier to prove things about to me. It would be really interesting to compare them when done.</p>",
        "id": 183465035,
        "sender_full_name": "Alex J. Best",
        "timestamp": 1576369774
    },
    {
        "content": "<p>I almost have weighted version of AM-GM ready.</p>",
        "id": 183468238,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1576376598
    },
    {
        "content": "<p>I'll submit a series of PRs tonight.</p>",
        "id": 183468284,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1576376643
    },
    {
        "content": "<p>Together with a few other inequalities.</p>",
        "id": 183468289,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1576376662
    },
    {
        "content": "<p>We already have Jensen inequality in <code>convex</code>, so we only need to prove that <code>exp</code> is <code>convex_on univ</code>.</p>",
        "id": 183468410,
        "sender_full_name": "Yury G. Kudryashov",
        "timestamp": 1576376943
    }
]