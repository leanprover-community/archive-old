[
    {
        "content": "<p>We have a file with the following contents:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kn\">namespace</span> <span class=\"n\">chess</span>\n\n<span class=\"kd\">@[derive decidable_eq]</span>\n<span class=\"kd\">inductive</span> <span class=\"n\">color</span>\n<span class=\"bp\">|</span> <span class=\"n\">white</span>\n<span class=\"bp\">|</span> <span class=\"n\">black</span>\n\n<span class=\"kd\">@[derive decidable_eq]</span>\n<span class=\"kd\">inductive</span> <span class=\"n\">pieces</span>\n<span class=\"bp\">|</span> <span class=\"n\">bishop</span>\n<span class=\"bp\">|</span> <span class=\"n\">king</span>\n<span class=\"bp\">|</span> <span class=\"n\">knight</span>\n<span class=\"bp\">|</span> <span class=\"n\">pawn</span>\n<span class=\"bp\">|</span> <span class=\"n\">queen</span>\n<span class=\"bp\">|</span> <span class=\"n\">rook</span>\n\n<span class=\"kd\">@[derive decidable_eq]</span>\n<span class=\"kd\">structure</span> <span class=\"n\">colored_pieces</span> <span class=\"o\">:=</span>\n<span class=\"o\">(</span><span class=\"n\">piece</span> <span class=\"o\">:</span> <span class=\"n\">pieces</span><span class=\"o\">)</span>\n<span class=\"o\">(</span><span class=\"n\">color</span> <span class=\"o\">:</span> <span class=\"n\">color</span><span class=\"o\">)</span>\n\n<span class=\"kd\">def</span> <span class=\"n\">white_bishop</span> <span class=\"o\">:</span> <span class=\"n\">colored_pieces</span> <span class=\"o\">:=</span> <span class=\"o\">⟨</span><span class=\"n\">pieces.bishop</span><span class=\"o\">,</span> <span class=\"n\">color.white</span><span class=\"o\">⟩</span>\n<span class=\"kd\">def</span> <span class=\"n\">white_king</span> <span class=\"o\">:</span> <span class=\"n\">colored_pieces</span> <span class=\"o\">:=</span> <span class=\"o\">⟨</span><span class=\"n\">pieces.king</span><span class=\"o\">,</span> <span class=\"n\">color.white</span><span class=\"o\">⟩</span>\n<span class=\"kd\">def</span> <span class=\"n\">white_knight</span> <span class=\"o\">:</span> <span class=\"n\">colored_pieces</span> <span class=\"o\">:=</span> <span class=\"o\">⟨</span><span class=\"n\">pieces.knight</span><span class=\"o\">,</span> <span class=\"n\">color.white</span><span class=\"o\">⟩</span>\n<span class=\"kd\">def</span> <span class=\"n\">white_pawn</span> <span class=\"o\">:</span> <span class=\"n\">colored_pieces</span> <span class=\"o\">:=</span> <span class=\"o\">⟨</span><span class=\"n\">pieces.pawn</span><span class=\"o\">,</span> <span class=\"n\">color.white</span><span class=\"o\">⟩</span>\n<span class=\"kd\">def</span> <span class=\"n\">white_queen</span> <span class=\"o\">:</span> <span class=\"n\">colored_pieces</span> <span class=\"o\">:=</span> <span class=\"o\">⟨</span><span class=\"n\">pieces.queen</span><span class=\"o\">,</span> <span class=\"n\">color.white</span><span class=\"o\">⟩</span>\n<span class=\"kd\">def</span> <span class=\"n\">white_rook</span> <span class=\"o\">:</span> <span class=\"n\">colored_pieces</span> <span class=\"o\">:=</span> <span class=\"o\">⟨</span><span class=\"n\">pieces.rook</span><span class=\"o\">,</span> <span class=\"n\">color.white</span><span class=\"o\">⟩</span>\n\n<span class=\"kd\">def</span> <span class=\"n\">black_bishop</span> <span class=\"o\">:</span> <span class=\"n\">colored_pieces</span> <span class=\"o\">:=</span> <span class=\"o\">⟨</span><span class=\"n\">pieces.bishop</span><span class=\"o\">,</span> <span class=\"n\">color.black</span><span class=\"o\">⟩</span>\n<span class=\"kd\">def</span> <span class=\"n\">black_king</span> <span class=\"o\">:</span> <span class=\"n\">colored_pieces</span> <span class=\"o\">:=</span> <span class=\"o\">⟨</span><span class=\"n\">pieces.king</span><span class=\"o\">,</span> <span class=\"n\">color.black</span><span class=\"o\">⟩</span>\n<span class=\"kd\">def</span> <span class=\"n\">black_knight</span> <span class=\"o\">:</span> <span class=\"n\">colored_pieces</span> <span class=\"o\">:=</span> <span class=\"o\">⟨</span><span class=\"n\">pieces.knight</span><span class=\"o\">,</span> <span class=\"n\">color.black</span><span class=\"o\">⟩</span>\n<span class=\"kd\">def</span> <span class=\"n\">black_pawn</span> <span class=\"o\">:</span> <span class=\"n\">colored_pieces</span> <span class=\"o\">:=</span> <span class=\"o\">⟨</span><span class=\"n\">pieces.pawn</span><span class=\"o\">,</span> <span class=\"n\">color.black</span><span class=\"o\">⟩</span>\n<span class=\"kd\">def</span> <span class=\"n\">black_queen</span> <span class=\"o\">:</span> <span class=\"n\">colored_pieces</span> <span class=\"o\">:=</span> <span class=\"o\">⟨</span><span class=\"n\">pieces.queen</span><span class=\"o\">,</span> <span class=\"n\">color.black</span><span class=\"o\">⟩</span>\n<span class=\"kd\">def</span> <span class=\"n\">black_rook</span> <span class=\"o\">:</span> <span class=\"n\">colored_pieces</span> <span class=\"o\">:=</span> <span class=\"o\">⟨</span><span class=\"n\">pieces.rook</span><span class=\"o\">,</span> <span class=\"n\">color.black</span><span class=\"o\">⟩</span>\n\n<span class=\"kd\">notation</span> <span class=\"bp\">`</span> <span class=\"bp\">♔</span> <span class=\"bp\">`</span> <span class=\"o\">:=</span> <span class=\"n\">chess.white_king</span>\n<span class=\"kd\">notation</span> <span class=\"bp\">`</span> <span class=\"bp\">♕</span> <span class=\"bp\">`</span> <span class=\"o\">:=</span> <span class=\"n\">chess.white_queen</span>\n<span class=\"kd\">notation</span> <span class=\"bp\">`</span> <span class=\"bp\">♖</span> <span class=\"bp\">`</span> <span class=\"o\">:=</span> <span class=\"n\">chess.white_rook</span>\n<span class=\"kd\">notation</span> <span class=\"bp\">`</span> <span class=\"bp\">♗</span> <span class=\"bp\">`</span> <span class=\"o\">:=</span> <span class=\"n\">chess.white_bishop</span>\n<span class=\"kd\">notation</span> <span class=\"bp\">`</span> <span class=\"bp\">♘</span> <span class=\"bp\">`</span> <span class=\"o\">:=</span> <span class=\"n\">chess.white_knight</span>\n<span class=\"kd\">notation</span> <span class=\"bp\">`</span> <span class=\"bp\">♙</span> <span class=\"bp\">`</span> <span class=\"o\">:=</span> <span class=\"n\">chess.white_pawn</span>\n\n<span class=\"kd\">notation</span> <span class=\"bp\">`</span> <span class=\"bp\">♚</span> <span class=\"bp\">`</span> <span class=\"o\">:=</span> <span class=\"n\">chess.black_king</span>\n<span class=\"kd\">notation</span> <span class=\"bp\">`</span> <span class=\"bp\">♛</span> <span class=\"bp\">`</span> <span class=\"o\">:=</span> <span class=\"n\">chess.black_queen</span>\n<span class=\"kd\">notation</span> <span class=\"bp\">`</span> <span class=\"bp\">♜</span> <span class=\"bp\">`</span> <span class=\"o\">:=</span> <span class=\"n\">chess.black_rook</span>\n<span class=\"kd\">notation</span> <span class=\"bp\">`</span> <span class=\"bp\">♝</span> <span class=\"bp\">`</span> <span class=\"o\">:=</span> <span class=\"n\">chess.black_bishop</span>\n<span class=\"kd\">notation</span> <span class=\"bp\">`</span> <span class=\"bp\">♞</span> <span class=\"bp\">`</span> <span class=\"o\">:=</span> <span class=\"n\">chess.black_knight</span>\n<span class=\"kd\">notation</span> <span class=\"bp\">`</span> <span class=\"bp\">♟︎</span> <span class=\"bp\">`</span> <span class=\"o\">:=</span> <span class=\"n\">chess.black_pawn</span>\n\n<span class=\"kd\">notation</span> <span class=\"bp\">`</span> <span class=\"n\">__</span> <span class=\"bp\">`</span> <span class=\"o\">:=</span> <span class=\"n\">none</span>\n\n<span class=\"kd\">def</span> <span class=\"n\">piece_repr</span> <span class=\"o\">:</span> <span class=\"n\">colored_pieces</span> <span class=\"bp\">→</span> <span class=\"n\">string</span>\n<span class=\"bp\">|</span> <span class=\"o\">⟨</span><span class=\"n\">pieces.king</span><span class=\"o\">,</span> <span class=\"n\">color.white</span><span class=\"o\">⟩</span> <span class=\"o\">:=</span> <span class=\"s2\">\"♔\"</span>\n<span class=\"bp\">|</span> <span class=\"o\">⟨</span><span class=\"n\">pieces.queen</span><span class=\"o\">,</span> <span class=\"n\">color.white</span><span class=\"o\">⟩</span> <span class=\"o\">:=</span> <span class=\"s2\">\"♕\"</span>\n<span class=\"bp\">|</span> <span class=\"o\">⟨</span><span class=\"n\">pieces.rook</span><span class=\"o\">,</span> <span class=\"n\">color.white</span><span class=\"o\">⟩</span> <span class=\"o\">:=</span> <span class=\"s2\">\"♖\"</span>\n<span class=\"bp\">|</span> <span class=\"o\">⟨</span><span class=\"n\">pieces.bishop</span><span class=\"o\">,</span> <span class=\"n\">color.white</span><span class=\"o\">⟩</span> <span class=\"o\">:=</span> <span class=\"s2\">\"♗\"</span>\n<span class=\"bp\">|</span> <span class=\"o\">⟨</span><span class=\"n\">pieces.knight</span><span class=\"o\">,</span> <span class=\"n\">color.white</span><span class=\"o\">⟩</span> <span class=\"o\">:=</span> <span class=\"s2\">\"♘\"</span>\n<span class=\"bp\">|</span> <span class=\"o\">⟨</span><span class=\"n\">pieces.pawn</span><span class=\"o\">,</span> <span class=\"n\">color.white</span><span class=\"o\">⟩</span> <span class=\"o\">:=</span> <span class=\"s2\">\"♙\"</span>\n<span class=\"bp\">|</span> <span class=\"o\">⟨</span><span class=\"n\">pieces.king</span><span class=\"o\">,</span> <span class=\"n\">color.black</span><span class=\"o\">⟩</span> <span class=\"o\">:=</span> <span class=\"s2\">\"♚\"</span>\n<span class=\"bp\">|</span> <span class=\"o\">⟨</span><span class=\"n\">pieces.queen</span><span class=\"o\">,</span> <span class=\"n\">color.black</span><span class=\"o\">⟩</span> <span class=\"o\">:=</span> <span class=\"s2\">\"♛\"</span>\n<span class=\"bp\">|</span> <span class=\"o\">⟨</span><span class=\"n\">pieces.rook</span><span class=\"o\">,</span> <span class=\"n\">color.black</span><span class=\"o\">⟩</span> <span class=\"o\">:=</span> <span class=\"s2\">\"♜\"</span>\n<span class=\"bp\">|</span> <span class=\"o\">⟨</span><span class=\"n\">pieces.bishop</span><span class=\"o\">,</span> <span class=\"n\">color.black</span><span class=\"o\">⟩</span> <span class=\"o\">:=</span> <span class=\"s2\">\"♝\"</span>\n<span class=\"bp\">|</span> <span class=\"o\">⟨</span><span class=\"n\">pieces.knight</span><span class=\"o\">,</span> <span class=\"n\">color.black</span><span class=\"o\">⟩</span> <span class=\"o\">:=</span> <span class=\"s2\">\"♞\"</span>\n<span class=\"bp\">|</span> <span class=\"o\">⟨</span><span class=\"n\">pieces.pawn</span><span class=\"o\">,</span> <span class=\"n\">color.black</span><span class=\"o\">⟩</span> <span class=\"o\">:=</span> <span class=\"s2\">\"♟︎\"</span>\n\n<span class=\"kd\">instance</span> <span class=\"o\">:</span> <span class=\"n\">has_repr</span> <span class=\"n\">colored_pieces</span> <span class=\"o\">:=</span> <span class=\"o\">⟨</span><span class=\"n\">piece_repr</span><span class=\"o\">⟩</span>\n\n<span class=\"kd\">end</span> <span class=\"n\">chess</span>\n</code></pre></div>",
        "id": 211053627,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1600890599
    },
    {
        "content": "<p>And we noticed we can't use the notation, nor the defns <code>white_king</code> in the pattern matching portion of the equation compiler in <code>piece_repr</code>.</p>",
        "id": 211053731,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1600890635
    },
    {
        "content": "<p>Is that because <code>def</code>s can't substitute in for patterns? Is that similar to how <code>pattern ...</code> has to be defined separately in Haskell?</p>",
        "id": 211053827,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1600890703
    },
    {
        "content": "<p>I don't remember the details here, but I think you can use <code>@[pattern]</code> on <code>def white_bishop</code>, etc to use it in the pattern match.</p>",
        "id": 211054627,
        "sender_full_name": "Rob Lewis",
        "timestamp": 1600891159
    },
    {
        "content": "<p>interesting, that indeed does work</p>",
        "id": 211055142,
        "sender_full_name": "Julian Berman",
        "timestamp": 1600891377
    },
    {
        "content": "<p>and I think it works for notation too!</p>",
        "id": 211055909,
        "sender_full_name": "Julian Berman",
        "timestamp": 1600891789
    },
    {
        "content": "<p>We should add the <code>pattern</code> attribute to our docs.</p>",
        "id": 211055915,
        "sender_full_name": "Bryan Gin-ge Chen",
        "timestamp": 1600891792
    },
    {
        "content": "<p>i.e. after adding the <code>@[pattern]</code> to the defs I can use the notation too, so I guess the issue was just the defs not having htat attribute.</p>",
        "id": 211055969,
        "sender_full_name": "Julian Berman",
        "timestamp": 1600891808
    }
]