[
    {
        "content": "<div class=\"codehilite\"><pre><span></span><span class=\"kn\">import</span> <span class=\"n\">data</span><span class=\"bp\">.</span><span class=\"n\">polynomial</span>\n       <span class=\"n\">data</span><span class=\"bp\">.</span><span class=\"n\">real</span><span class=\"bp\">.</span><span class=\"n\">basic</span>\n\n<span class=\"kn\">open</span> <span class=\"n\">polynomial</span>\n\n<span class=\"kn\">structure</span> <span class=\"n\">polynomial_derivation</span> <span class=\"o\">(</span><span class=\"n\">R</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span><span class=\"o\">)</span> <span class=\"o\">[</span><span class=\"n\">comm_ring</span> <span class=\"n\">R</span><span class=\"o\">]</span> <span class=\"o\">:=</span>\n<span class=\"o\">(</span><span class=\"n\">to_fun</span> <span class=\"o\">:</span> <span class=\"n\">polynomial</span> <span class=\"n\">R</span> <span class=\"bp\">→</span> <span class=\"n\">polynomial</span> <span class=\"n\">R</span><span class=\"o\">)</span> <span class=\"c1\">-- Delta</span>\n<span class=\"o\">(</span><span class=\"n\">map_add&#39;</span> <span class=\"o\">:</span> <span class=\"bp\">∀</span> <span class=\"o\">(</span><span class=\"n\">f</span> <span class=\"n\">g</span> <span class=\"o\">:</span> <span class=\"n\">polynomial</span> <span class=\"n\">R</span><span class=\"o\">),</span> <span class=\"n\">to_fun</span> <span class=\"o\">(</span><span class=\"n\">f</span> <span class=\"bp\">+</span> <span class=\"n\">g</span><span class=\"o\">)</span> <span class=\"bp\">=</span> <span class=\"n\">to_fun</span> <span class=\"n\">f</span> <span class=\"bp\">+</span> <span class=\"n\">to_fun</span> <span class=\"n\">g</span><span class=\"o\">)</span>\n<span class=\"o\">(</span><span class=\"n\">map_C_mul&#39;</span> <span class=\"o\">:</span> <span class=\"bp\">∀</span> <span class=\"o\">(</span><span class=\"n\">k</span> <span class=\"o\">:</span> <span class=\"n\">R</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">f</span> <span class=\"o\">:</span> <span class=\"n\">polynomial</span> <span class=\"n\">R</span><span class=\"o\">),</span> <span class=\"n\">to_fun</span> <span class=\"o\">(</span><span class=\"n\">polynomial</span><span class=\"bp\">.</span><span class=\"n\">C</span> <span class=\"n\">k</span> <span class=\"bp\">*</span> <span class=\"n\">f</span><span class=\"o\">)</span> <span class=\"bp\">=</span> <span class=\"n\">polynomial</span><span class=\"bp\">.</span><span class=\"n\">C</span> <span class=\"n\">k</span> <span class=\"bp\">*</span> <span class=\"n\">to_fun</span> <span class=\"n\">f</span><span class=\"o\">)</span>\n<span class=\"o\">(</span><span class=\"n\">map_mul&#39;</span> <span class=\"o\">:</span> <span class=\"bp\">∀</span> <span class=\"o\">(</span><span class=\"n\">f</span> <span class=\"n\">g</span> <span class=\"o\">:</span> <span class=\"n\">polynomial</span> <span class=\"n\">R</span><span class=\"o\">),</span> <span class=\"n\">to_fun</span> <span class=\"o\">(</span><span class=\"n\">f</span> <span class=\"bp\">*</span> <span class=\"n\">g</span><span class=\"o\">)</span> <span class=\"bp\">=</span> <span class=\"n\">f</span> <span class=\"bp\">*</span> <span class=\"n\">to_fun</span> <span class=\"n\">g</span> <span class=\"bp\">+</span> <span class=\"n\">g</span> <span class=\"bp\">*</span> <span class=\"n\">to_fun</span> <span class=\"n\">f</span><span class=\"o\">)</span>\n\n<span class=\"kn\">namespace</span> <span class=\"n\">polynomial_derivation</span>\n\n<span class=\"kn\">variables</span> <span class=\"o\">{</span><span class=\"n\">R</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span><span class=\"o\">}</span> <span class=\"o\">[</span><span class=\"n\">comm_ring</span> <span class=\"n\">R</span><span class=\"o\">]</span>\n\n<span class=\"kn\">instance</span> <span class=\"o\">:</span> <span class=\"n\">has_coe_to_fun</span> <span class=\"o\">(</span><span class=\"n\">polynomial_derivation</span> <span class=\"n\">R</span><span class=\"o\">)</span> <span class=\"o\">:=</span>\n<span class=\"o\">{</span> <span class=\"n\">F</span> <span class=\"o\">:=</span> <span class=\"bp\">λ</span> <span class=\"bp\">_</span><span class=\"o\">,</span> <span class=\"n\">polynomial</span> <span class=\"n\">R</span> <span class=\"bp\">→</span> <span class=\"n\">polynomial</span> <span class=\"n\">R</span><span class=\"o\">,</span>\n  <span class=\"n\">coe</span> <span class=\"o\">:=</span> <span class=\"n\">to_fun</span>\n<span class=\"o\">}</span>\n\n<span class=\"kn\">end</span> <span class=\"n\">polynomial_derivation</span>\n\n<span class=\"kn\">variable</span> <span class=\"err\">Δ</span> <span class=\"o\">:</span> <span class=\"n\">polynomial</span> <span class=\"n\">ℝ</span> <span class=\"bp\">→</span> <span class=\"n\">polynomial</span> <span class=\"n\">ℝ</span>\n<span class=\"n\">include</span> <span class=\"err\">Δ</span>\n\n<span class=\"kn\">variable</span> <span class=\"err\">Δ</span><span class=\"mi\">1</span> <span class=\"o\">:</span> <span class=\"err\">Δ</span> <span class=\"n\">X</span> <span class=\"bp\">=</span> <span class=\"n\">C</span> <span class=\"mi\">1</span>\n<span class=\"kn\">variable</span> <span class=\"err\">Δ</span><span class=\"mi\">2</span> <span class=\"o\">:</span> <span class=\"bp\">∀</span> <span class=\"o\">(</span><span class=\"n\">f</span> <span class=\"n\">g</span> <span class=\"o\">:</span> <span class=\"n\">polynomial</span> <span class=\"n\">ℝ</span><span class=\"o\">),</span> <span class=\"err\">Δ</span><span class=\"o\">(</span><span class=\"n\">f</span> <span class=\"bp\">+</span> <span class=\"n\">g</span><span class=\"o\">)</span> <span class=\"bp\">=</span> <span class=\"err\">Δ</span> <span class=\"n\">f</span> <span class=\"bp\">+</span> <span class=\"err\">Δ</span> <span class=\"n\">g</span>\n<span class=\"kn\">variable</span> <span class=\"err\">Δ</span><span class=\"mi\">3</span> <span class=\"o\">:</span> <span class=\"bp\">∀</span> <span class=\"o\">(</span><span class=\"n\">k</span> <span class=\"o\">:</span> <span class=\"n\">ℝ</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">f</span> <span class=\"o\">:</span> <span class=\"n\">polynomial</span> <span class=\"n\">ℝ</span><span class=\"o\">),</span> <span class=\"err\">Δ</span><span class=\"o\">(</span><span class=\"n\">C</span> <span class=\"n\">k</span> <span class=\"bp\">*</span> <span class=\"n\">f</span><span class=\"o\">)</span> <span class=\"bp\">=</span> <span class=\"n\">C</span> <span class=\"n\">k</span> <span class=\"bp\">*</span> <span class=\"err\">Δ</span> <span class=\"n\">f</span>\n<span class=\"kn\">variable</span> <span class=\"err\">Δ</span><span class=\"mi\">4</span> <span class=\"o\">:</span> <span class=\"bp\">∀</span> <span class=\"o\">(</span><span class=\"n\">f</span> <span class=\"n\">g</span> <span class=\"o\">:</span> <span class=\"n\">polynomial</span> <span class=\"n\">ℝ</span><span class=\"o\">),</span> <span class=\"err\">Δ</span><span class=\"o\">(</span><span class=\"n\">f</span> <span class=\"bp\">*</span> <span class=\"n\">g</span><span class=\"o\">)</span> <span class=\"bp\">=</span> <span class=\"n\">f</span> <span class=\"bp\">*</span> <span class=\"err\">Δ</span> <span class=\"n\">g</span> <span class=\"bp\">+</span> <span class=\"n\">g</span> <span class=\"bp\">*</span> <span class=\"err\">Δ</span> <span class=\"n\">f</span>\n<span class=\"n\">include</span> <span class=\"err\">Δ</span><span class=\"mi\">1</span> <span class=\"err\">Δ</span><span class=\"mi\">2</span> <span class=\"err\">Δ</span><span class=\"mi\">3</span> <span class=\"err\">Δ</span><span class=\"mi\">4</span>\n\n<span class=\"kn\">definition</span> <span class=\"n\">d</span> <span class=\"o\">:</span> <span class=\"n\">polynomial_derivation</span> <span class=\"n\">ℝ</span> <span class=\"o\">:=</span>\n<span class=\"o\">{</span> <span class=\"n\">to_fun</span> <span class=\"o\">:=</span> <span class=\"err\">Δ</span><span class=\"o\">,</span>\n  <span class=\"n\">map_add&#39;</span> <span class=\"o\">:=</span> <span class=\"err\">Δ</span><span class=\"mi\">2</span><span class=\"o\">,</span>\n  <span class=\"n\">map_C_mul&#39;</span> <span class=\"o\">:=</span> <span class=\"err\">Δ</span><span class=\"mi\">3</span><span class=\"o\">,</span>\n  <span class=\"n\">map_mul&#39;</span> <span class=\"o\">:=</span> <span class=\"err\">Δ</span><span class=\"mi\">4</span> <span class=\"o\">}</span>\n\n<span class=\"kn\">theorem</span> <span class=\"n\">d_is_differentiation</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"o\">:</span> <span class=\"n\">polynomial</span> <span class=\"n\">ℝ</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">d</span> <span class=\"n\">p</span> <span class=\"bp\">=</span> <span class=\"n\">derivative</span> <span class=\"n\">p</span> <span class=\"o\">:=</span> <span class=\"n\">sorry</span>\n</pre></div>\n\n\n<p>There is a type mismatch at <code>d p</code> in the last line. The error message is</p>\n<div class=\"codehilite\"><pre><span></span>type mismatch at application\n  d p\nterm\n  p\nhas type\n  polynomial ℝ\nbut is expected to have type\n  polynomial ℝ → polynomial ℝ\n</pre></div>",
        "id": 191903385,
        "sender_full_name": "Shing Tak Lam",
        "timestamp": 1585237287
    },
    {
        "content": "<p>I would think that since <code>polynomial_derivation</code> <code>has _coe_to_fun</code>, I would expect that <code>d p = d.to_fun p = Δ p</code>. And <code>Δ : polynomial ℝ → polynomial ℝ</code>. So <code>Δ p : polynomial ℝ</code>.</p>",
        "id": 191903888,
        "sender_full_name": "Shing Tak Lam",
        "timestamp": 1585237454
    },
    {
        "content": "<p>Figured it out (maybe?) The <code>variable</code>s are hypotheses in <code>d</code>, so I need to use <code>(d Δ Δ1 Δ2 Δ3 Δ4) p</code></p>",
        "id": 191904691,
        "sender_full_name": "Shing Tak Lam",
        "timestamp": 1585237760
    },
    {
        "content": "<p>Isn't there any way you can get Delta and all the Delta_i to be included automatically?What does <code>include</code> do if not this?</p>",
        "id": 191905841,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1585238068
    },
    {
        "content": "<p><code>parameters</code></p>",
        "id": 191906464,
        "sender_full_name": "Reid Barton",
        "timestamp": 1585238268
    },
    {
        "content": "<p><code>include</code> makes sure that <code>Δ1 Δ2 Δ3 Δ4</code> are included as arguments at the definition of <code>d</code>. It doesn't do anything at the use sites of <code>d</code>.</p>",
        "id": 191906815,
        "sender_full_name": "Reid Barton",
        "timestamp": 1585238383
    }
]