[
    {
        "content": "<p>Hello, in an effort to play with polynomials in Lean I came up with the following,</p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"kn\">import</span> <span class=\"n\">data</span><span class=\"bp\">.</span><span class=\"n\">polynomial</span>\n\n<span class=\"kn\">open</span> <span class=\"n\">polynomial</span>\n\n<span class=\"n\">noncomputable</span> <span class=\"n\">def</span> <span class=\"n\">P</span> <span class=\"o\">:</span> <span class=\"n\">polynomial</span> <span class=\"bp\">ℤ</span> <span class=\"o\">:=</span> <span class=\"mi\">3</span> <span class=\"bp\">*</span> <span class=\"n\">X</span><span class=\"bp\">^</span><span class=\"mi\">2</span> <span class=\"bp\">+</span> <span class=\"mi\">1</span>\n<span class=\"n\">noncomputable</span> <span class=\"n\">def</span> <span class=\"n\">Q</span> <span class=\"o\">:</span> <span class=\"n\">polynomial</span> <span class=\"bp\">ℤ</span> <span class=\"o\">:=</span> <span class=\"mi\">4</span> <span class=\"bp\">*</span> <span class=\"n\">X</span><span class=\"bp\">^</span><span class=\"mi\">2</span> <span class=\"bp\">+</span> <span class=\"mi\">7</span> <span class=\"bp\">*</span> <span class=\"n\">X</span> <span class=\"bp\">+</span> <span class=\"mi\">6</span>\n\n<span class=\"bp\">#</span><span class=\"kn\">check</span> <span class=\"n\">P</span> <span class=\"bp\">+</span> <span class=\"n\">Q</span>\n<span class=\"bp\">#</span><span class=\"kn\">check</span> <span class=\"n\">P</span> <span class=\"bp\">-</span> <span class=\"n\">Q</span>\n<span class=\"bp\">#</span><span class=\"kn\">check</span> <span class=\"n\">P</span> <span class=\"bp\">*</span> <span class=\"n\">Q</span>\n<span class=\"bp\">#</span><span class=\"kn\">check</span> <span class=\"n\">P</span> <span class=\"bp\">/</span><span class=\"err\">ₘ</span> <span class=\"n\">Q</span>\n\n<span class=\"bp\">#</span><span class=\"kn\">eval</span> <span class=\"n\">P</span> <span class=\"bp\">+</span> <span class=\"n\">Q</span>\n<span class=\"bp\">#</span><span class=\"kn\">eval</span> <span class=\"n\">P</span> <span class=\"bp\">-</span> <span class=\"n\">Q</span>\n<span class=\"bp\">#</span><span class=\"kn\">eval</span> <span class=\"n\">P</span> <span class=\"bp\">*</span> <span class=\"n\">Q</span>\n<span class=\"bp\">#</span><span class=\"kn\">eval</span> <span class=\"n\">P</span> <span class=\"bp\">/</span><span class=\"err\">ₘ</span> <span class=\"n\">Q</span>\n</code></pre></div>\n\n\n<p>The <code>#eval</code> lines give the error \"code generation failed, VM does not have code for 'classical.choice'\", and the definitions of <code>P</code> and <code>Q</code> demand the <code>noncomputable</code>. Is there some way around the noncomputability of polynomials, so that <code>#eval P + Q</code> gives <code>7 * X^2 + 7 * X + 7</code>?</p>",
        "id": 210652189,
        "sender_full_name": "Lucas Allen",
        "timestamp": 1600583213
    },
    {
        "content": "<p>\"If you want to calculate, use Python\"</p>",
        "id": 210652610,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1600584215
    },
    {
        "content": "<p>(or use an older version of Lean/mathlib before we decided to make everything noncomputable)</p>",
        "id": 210652657,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1600584246
    },
    {
        "content": "<p>probably some version in 2018</p>",
        "id": 210652660,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1600584261
    },
    {
        "content": "<p>Ok.</p>",
        "id": 210653077,
        "sender_full_name": "Lucas Allen",
        "timestamp": 1600585045
    },
    {
        "content": "<p>Or use a future version of Lean/mathlib with the <code>norm_poly</code> tactic</p>",
        "id": 210660677,
        "sender_full_name": "Reid Barton",
        "timestamp": 1600599095
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"209436\">@Lucas Allen</span> can you please leave 2020, you've come to the wrong year. Please recalibrate a couple of years in either direction.</p>",
        "id": 210662989,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1600602282
    },
    {
        "content": "<p>I need a telephone booth emoji</p>",
        "id": 210663316,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1600602741
    },
    {
        "content": "<p>Polynomials used to be computable but this caused trouble with reasoning. Now they're noncomputable but apparently this causes problems with computation. Is Reid right that this can be fixed with a tactic?</p>",
        "id": 210663906,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1600603616
    },
    {
        "content": "<p>yes</p>",
        "id": 210663966,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1600603700
    },
    {
        "content": "<p>just like <code>norm_num</code> but for polynomials</p>",
        "id": 210663969,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1600603711
    },
    {
        "content": "<p>The trick is the kind of \"computation\" you want is not the same as the <code>noncomputable</code> kind. For example, <code>norm_num</code> works on the reals too</p>",
        "id": 210663990,
        "sender_full_name": "Reid Barton",
        "timestamp": 1600603757
    },
    {
        "content": "<p>that there are two meanings of \"computation\": the Lean meaning, which is that you write a program that does it; the mathematical meaning, which is that you reduce something to a normal form.</p>",
        "id": 210666104,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1600606686
    },
    {
        "content": "<p>There's some trickery involved though, isn't there? Because norm_num doesn't _really_ work with reals, right? It can only make progress if all the reals are rational.</p>",
        "id": 210669699,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1600612686
    },
    {
        "content": "<p>It really works with <code>expr</code>s that represent reals</p>",
        "id": 210670016,
        "sender_full_name": "Reid Barton",
        "timestamp": 1600613311
    },
    {
        "content": "<p>Aah!</p>",
        "id": 210670025,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1600613339
    },
    {
        "content": "<p>So why don't we teach it that sqrt(x)*sqrt(x)=x :-)</p>",
        "id": 210670032,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1600613360
    },
    {
        "content": "<p>Like this?</p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"kn\">import</span> <span class=\"n\">data</span><span class=\"bp\">.</span><span class=\"n\">real</span><span class=\"bp\">.</span><span class=\"n\">basic</span>\n<span class=\"kn\">import</span> <span class=\"n\">tactic</span><span class=\"bp\">.</span><span class=\"n\">norm_num</span>\n\n<span class=\"kn\">example</span> <span class=\"o\">:</span> <span class=\"n\">real</span><span class=\"bp\">.</span><span class=\"n\">sqrt</span> <span class=\"mi\">5</span> <span class=\"bp\">*</span> <span class=\"n\">real</span><span class=\"bp\">.</span><span class=\"n\">sqrt</span> <span class=\"mi\">5</span> <span class=\"bp\">=</span> <span class=\"mi\">5</span> <span class=\"o\">:=</span> <span class=\"k\">by</span> <span class=\"n\">norm_num</span>\n</code></pre></div>",
        "id": 210670104,
        "sender_full_name": "Reid Barton",
        "timestamp": 1600613483
    },
    {
        "content": "<p>Thanks!</p>",
        "id": 210670258,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1600613695
    },
    {
        "content": "<p>(I never knew it did that -- I had the wrong mental model)</p>",
        "id": 210670266,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1600613721
    },
    {
        "content": "<p>I think the main obstruction to turning <code>norm_num</code> into something more like a computer algebra system is that it's not obvious (at least to me) what kind of organizational framework is appropriate</p>",
        "id": 210670344,
        "sender_full_name": "Reid Barton",
        "timestamp": 1600613846
    },
    {
        "content": "<p>along with perhaps a lack of specific applications at the moment</p>",
        "id": 210670350,
        "sender_full_name": "Reid Barton",
        "timestamp": 1600613860
    },
    {
        "content": "<p>I want to prove that <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mi>x</mi><mn>2</mn></msup><mo>−</mo><mn>4</mn></mrow><annotation encoding=\"application/x-tex\">x^2-4</annotation></semantics></math></span><span aria-hidden=\"true\" class=\"katex-html\"><span class=\"base\"><span class=\"strut\" style=\"height:0.897438em;vertical-align:-0.08333em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">4</span></span></span></span> is not irreduible without doing any work.</p>",
        "id": 210670400,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1600613898
    },
    {
        "content": "<p>but for any computation you can do in a CAS, provided you can give a proof that the computation is correct (when it succeeds), there's no reason that something like <code>norm_num</code> couldn't be extended to do it</p>",
        "id": 210670412,
        "sender_full_name": "Reid Barton",
        "timestamp": 1600613935
    },
    {
        "content": "<p>Actually I don't really want to prove this at all, I just want to prove stuff about DVRs etc. I don't have a specific application.</p>",
        "id": 210670417,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1600613945
    },
    {
        "content": "<p>This example is pretty trivial because <code>ring</code> can already do the correctness proof</p>",
        "id": 210670421,
        "sender_full_name": "Reid Barton",
        "timestamp": 1600613954
    },
    {
        "content": "<p>I guess sometimes I want to prove that y^2=x^3-4x has rank 0 (or 1 or whatever).</p>",
        "id": 210670434,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1600613984
    },
    {
        "content": "<p>so you can \"just\" do the factorization in an untrusted program</p>",
        "id": 210670435,
        "sender_full_name": "Reid Barton",
        "timestamp": 1600613989
    },
    {
        "content": "<p>and Cremona's software is not spitting out a formally verifiable thing here</p>",
        "id": 210670442,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1600614002
    },
    {
        "content": "<p>Right, I think you skipped over a large range of difficulties there <span aria-label=\"upside down\" class=\"emoji emoji-1f643\" role=\"img\" title=\"upside down\">:upside_down:</span></p>",
        "id": 210670484,
        "sender_full_name": "Reid Barton",
        "timestamp": 1600614007
    },
    {
        "content": "<p>Nobody can prove the algorithm terminates, for starters</p>",
        "id": 210670506,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1600614055
    },
    {
        "content": "<p>Well that's not actually a problem</p>",
        "id": 210670523,
        "sender_full_name": "Reid Barton",
        "timestamp": 1600614094
    },
    {
        "content": "<p>Try telling that to the equation compiler</p>",
        "id": 210670598,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1600614204
    },
    {
        "content": "<p>Of course I see what you mean, tactics are meta</p>",
        "id": 210670608,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1600614235
    },
    {
        "content": "<p>For a procedure like this, there are two relevant outcomes:</p>\n<ul>\n<li>the procedure succeeds in producing an answer along with a correct proof</li>\n<li>all other behavior: nontermination, answer but no certificate, certificate but it doesn't type check somehow</li>\n</ul>",
        "id": 210670742,
        "sender_full_name": "Reid Barton",
        "timestamp": 1600614404
    },
    {
        "content": "<p>If you can build a procedure which provably always has the first behavior then great, but in practice it's fine to have tactics that can fail, as long as they work when you need them to</p>",
        "id": 210670808,
        "sender_full_name": "Reid Barton",
        "timestamp": 1600614511
    },
    {
        "content": "<p>since our goal is to compute the ranks of elliptic curves (or whatever), not prove an internal theorem \"there exists an algorithm which computes the rank of every elliptic curve\"</p>",
        "id": 210670844,
        "sender_full_name": "Reid Barton",
        "timestamp": 1600614580
    },
    {
        "content": "<p>which is good because that's an open problem</p>",
        "id": 210670897,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1600614617
    },
    {
        "content": "<p>FYI, this was a surprise to me as well. <code>norm_num</code> doesn't know anything about square roots, that's all <code>simp</code>'s work</p>",
        "id": 210683579,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1600633487
    },
    {
        "content": "<p>aha!</p>",
        "id": 210683682,
        "sender_full_name": "Reid Barton",
        "timestamp": 1600633624
    },
    {
        "content": "<p>Returning to the initial question, right now <code>#simp [P,Q] P + Q</code> just returns <code>3 * X ^ 2 + 1 + (4 * X ^ 2 + 7 * X + 6)</code>, but maybe it's possible to add some simp lemmas (or make a simp set?) to make it more \"useful\".</p>",
        "id": 210684454,
        "sender_full_name": "Bryan Gin-ge Chen",
        "timestamp": 1600634569
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110038\">Kevin Buzzard</span> <a href=\"#narrow/stream/113489-new-members/topic/Playing.20with.20polynomials/near/210662989\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"209436\">Lucas Allen</span> can you please leave 2020, you've come to the wrong year. Please recalibrate a couple of years in either direction.</p>\n</blockquote>\n<p>I think practicing the art of impeccable timing is starting to pay off.</p>",
        "id": 210701054,
        "sender_full_name": "Lucas Allen",
        "timestamp": 1600663201
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"123965\">Bryan Gin-ge Chen</span> <a href=\"#narrow/stream/113489-new-members/topic/Playing.20with.20polynomials/near/210684454\">said</a>:</p>\n<blockquote>\n<p>Returning to the initial question, right now <code>#simp [P,Q] P + Q</code> just returns <code>3 * X ^ 2 + 1 + (4 * X ^ 2 + 7 * X + 6)</code>, but maybe it's possible to add some simp lemmas (or make a simp set?) to make it more \"useful\".</p>\n</blockquote>\n<p>I had a go at adding a simp lemma to see if it worked,</p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"bp\">@</span><span class=\"o\">[</span><span class=\"n\">simp</span><span class=\"o\">]</span> <span class=\"kn\">lemma</span> <span class=\"n\">X_add</span> <span class=\"o\">:</span> <span class=\"o\">(</span><span class=\"n\">X</span> <span class=\"o\">:</span> <span class=\"n\">polynomial</span> <span class=\"bp\">ℤ</span><span class=\"o\">)</span> <span class=\"bp\">+</span> <span class=\"n\">X</span> <span class=\"bp\">=</span> <span class=\"mi\">2</span> <span class=\"bp\">*</span> <span class=\"n\">X</span> <span class=\"o\">:=</span> <span class=\"n\">sorry</span>\n\n<span class=\"bp\">#</span><span class=\"n\">simp</span> <span class=\"o\">[</span><span class=\"n\">X</span><span class=\"o\">]</span> <span class=\"n\">X</span> <span class=\"bp\">+</span> <span class=\"n\">X</span>\n</code></pre></div>\n\n\n<p>It gives \"monomial 1 1 + monomial 1 1\", but I want \"2 * X\". I also tried <code>#simp [(X : polynomial ℤ)] X + X</code> but this gives \"simplify tactic failed to simplify.\" Is there some way to get this to work?</p>",
        "id": 210701161,
        "sender_full_name": "Lucas Allen",
        "timestamp": 1600663351
    },
    {
        "content": "<p>Ooh, you don't want to put <code>X</code> in the simpset, rather put <code>X_add</code> between the <code>[]</code></p>",
        "id": 210701181,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1600663403
    },
    {
        "content": "<p><code>#simp [X_add] X + X</code> gives \"simplify tactic failed to simplify\". Do I need to say something about it being a <code>ℤ</code> polynomial?</p>",
        "id": 210701314,
        "sender_full_name": "Lucas Allen",
        "timestamp": 1600663670
    },
    {
        "content": "<p>Aah, I guess you do</p>",
        "id": 210701358,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1600663695
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span><code><span class=\"bp\">@</span><span class=\"o\">[</span><span class=\"n\">simp</span><span class=\"o\">]</span> <span class=\"kn\">lemma</span> <span class=\"n\">X_add</span> <span class=\"o\">:</span> <span class=\"o\">(</span><span class=\"n\">X</span> <span class=\"o\">:</span> <span class=\"n\">polynomial</span> <span class=\"bp\">ℤ</span><span class=\"o\">)</span> <span class=\"bp\">+</span> <span class=\"n\">X</span> <span class=\"bp\">=</span> <span class=\"mi\">2</span> <span class=\"bp\">*</span> <span class=\"n\">X</span> <span class=\"o\">:=</span> <span class=\"n\">sorry</span>\n\n<span class=\"bp\">#</span><span class=\"n\">simp</span> <span class=\"o\">[</span><span class=\"n\">X_add</span><span class=\"o\">]</span> <span class=\"o\">(</span><span class=\"n\">X</span> <span class=\"o\">:</span> <span class=\"n\">polynomial</span> <span class=\"bp\">ℤ</span><span class=\"o\">)</span> <span class=\"bp\">+</span> <span class=\"n\">X</span>\n</code></pre></div>\n\n\n<p>does this work?</p>",
        "id": 210701372,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1600663739
    },
    {
        "content": "<p>Yes!</p>",
        "id": 210701381,
        "sender_full_name": "Lucas Allen",
        "timestamp": 1600663760
    },
    {
        "content": "<p>Why is this an invalid simp lemma?</p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"kn\">lemma</span> <span class=\"n\">X_add</span> <span class=\"o\">(</span><span class=\"n\">m</span> <span class=\"o\">:</span> <span class=\"bp\">ℕ</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">a</span> <span class=\"n\">b</span> <span class=\"o\">:</span> <span class=\"bp\">ℤ</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"o\">(</span><span class=\"n\">a</span> <span class=\"bp\">*</span> <span class=\"n\">X</span> <span class=\"o\">:</span> <span class=\"n\">polynomial</span> <span class=\"bp\">ℤ</span><span class=\"o\">)</span> <span class=\"bp\">+</span> <span class=\"o\">(</span><span class=\"n\">b</span> <span class=\"bp\">*</span> <span class=\"n\">X</span><span class=\"o\">)</span> <span class=\"bp\">=</span> <span class=\"o\">(</span><span class=\"n\">a</span> <span class=\"bp\">+</span> <span class=\"n\">b</span><span class=\"o\">)</span> <span class=\"bp\">*</span> <span class=\"n\">X</span> <span class=\"o\">:=</span>\n<span class=\"k\">begin</span>\n  <span class=\"n\">exact</span> <span class=\"o\">(</span><span class=\"n\">add_mul</span> <span class=\"err\">↑</span><span class=\"n\">a</span> <span class=\"err\">↑</span><span class=\"n\">b</span> <span class=\"n\">X</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">symm</span><span class=\"o\">,</span>\n<span class=\"kn\">end</span>\n</code></pre></div>",
        "id": 210701694,
        "sender_full_name": "Lucas Allen",
        "timestamp": 1600664334
    },
    {
        "content": "<p>Adding <code>@[simp]</code> gives a red squiggle.</p>",
        "id": 210701699,
        "sender_full_name": "Lucas Allen",
        "timestamp": 1600664365
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"209436\">@Lucas Allen</span> because the statement doesn't use <code>m</code></p>",
        "id": 210702743,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1600666157
    },
    {
        "content": "<p>Oh no.</p>",
        "id": 210702881,
        "sender_full_name": "Lucas Allen",
        "timestamp": 1600666417
    },
    {
        "content": "<p>sorry.</p>",
        "id": 210702883,
        "sender_full_name": "Lucas Allen",
        "timestamp": 1600666423
    },
    {
        "content": "<p>I get a deterministic timeout with the following</p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"bp\">@</span><span class=\"o\">[</span><span class=\"n\">simp</span><span class=\"o\">]</span> <span class=\"kn\">lemma</span> <span class=\"n\">X_add</span> <span class=\"o\">(</span><span class=\"n\">a</span> <span class=\"n\">b</span> <span class=\"o\">:</span> <span class=\"bp\">ℤ</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"o\">(</span><span class=\"n\">a</span> <span class=\"bp\">*</span> <span class=\"n\">X</span> <span class=\"o\">:</span> <span class=\"n\">polynomial</span> <span class=\"bp\">ℤ</span><span class=\"o\">)</span> <span class=\"bp\">+</span> <span class=\"o\">(</span><span class=\"n\">b</span> <span class=\"bp\">*</span> <span class=\"n\">X</span><span class=\"o\">)</span> <span class=\"bp\">=</span> <span class=\"o\">(</span><span class=\"n\">a</span> <span class=\"bp\">+</span> <span class=\"n\">b</span><span class=\"o\">)</span> <span class=\"bp\">*</span> <span class=\"n\">X</span> <span class=\"o\">:=</span>\n<span class=\"k\">begin</span>\n  <span class=\"n\">exact</span> <span class=\"o\">(</span><span class=\"n\">add_mul</span> <span class=\"err\">↑</span><span class=\"n\">a</span> <span class=\"err\">↑</span><span class=\"n\">b</span> <span class=\"n\">X</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">symm</span><span class=\"o\">,</span>\n<span class=\"kn\">end</span>\n\n<span class=\"kn\">lemma</span> <span class=\"n\">test</span> <span class=\"o\">:</span> <span class=\"o\">(</span><span class=\"mi\">3</span> <span class=\"bp\">*</span> <span class=\"n\">X</span> <span class=\"o\">:</span> <span class=\"n\">polynomial</span> <span class=\"bp\">ℤ</span><span class=\"o\">)</span> <span class=\"bp\">+</span> <span class=\"o\">(</span><span class=\"mi\">5</span> <span class=\"bp\">*</span> <span class=\"n\">X</span><span class=\"o\">)</span> <span class=\"bp\">=</span> <span class=\"mi\">8</span> <span class=\"bp\">*</span> <span class=\"n\">X</span> <span class=\"o\">:=</span>\n<span class=\"k\">begin</span>\n  <span class=\"n\">apply</span> <span class=\"n\">X_add</span><span class=\"o\">,</span>\n<span class=\"kn\">end</span>\n</code></pre></div>\n\n\n<p>I don't know why, and I hope it's not obvious again...</p>",
        "id": 210703131,
        "sender_full_name": "Lucas Allen",
        "timestamp": 1600666784
    },
    {
        "content": "<p>What happens if you <code>rw</code> instead of <code>apply</code>?</p>",
        "id": 210703266,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1600666974
    },
    {
        "content": "<p>I would have expected the apply to work though.</p>",
        "id": 210703275,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1600666992
    },
    {
        "content": "<p>\"rewrite tactic failed, did not find instance of the pattern in the target expression<br>\n  ↑?m_1 * X + ↑?m_2 * X<br>\nstate:<br>\n⊢ 3 * X + 5 * X = 8 * X\"</p>\n<p>no deterministic timeout though.</p>",
        "id": 210703717,
        "sender_full_name": "Lucas Allen",
        "timestamp": 1600667569
    },
    {
        "content": "<p>I'm wondering if it has something to do with the fact that <code>a * X</code> has type polynomial <code>ℤ</code>, and it's not <code>(a : ℤ) * X</code>.</p>",
        "id": 210703779,
        "sender_full_name": "Lucas Allen",
        "timestamp": 1600667653
    },
    {
        "content": "<p>But <code>(a : ℤ) * X</code> doesn't work.</p>",
        "id": 210703788,
        "sender_full_name": "Lucas Allen",
        "timestamp": 1600667674
    },
    {
        "content": "<p><code>lemma X_add (a b : ℤ) : a * (X : polynomial ℤ) + b * X = (a + b) * X :=</code>gives red squiggles under the <code>*</code>'s. It likes <code>lemma test : 3 * (X : polynomial ℤ) + 5 * (X) = 8 * X := </code> however.</p>",
        "id": 210703875,
        "sender_full_name": "Lucas Allen",
        "timestamp": 1600667826
    },
    {
        "content": "<p>Try <code>(3 : \\Z)</code> instead</p>",
        "id": 210703878,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1600667836
    },
    {
        "content": "<p>but rather, I think you should use <code>C</code> to create constant polynomials</p>",
        "id": 210703893,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1600667873
    },
    {
        "content": "<p>Arguably, we should consider making <code>a \\bu X</code> the standard way of multiplying by scalars, instead of <code>C a * X</code>.</p>",
        "id": 210703940,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1600667903
    },
    {
        "content": "<p><code>lemma xxx : (3 : ℤ) * (X : polynomial ℤ) + (5 : ℤ) * (X) = (8 : ℤ) * X := </code>gives red squiggles under the *'s type mismatch error.</p>",
        "id": 210703943,
        "sender_full_name": "Lucas Allen",
        "timestamp": 1600667912
    },
    {
        "content": "<p><code>((3 : \\Z) * X : ...)</code> ?</p>",
        "id": 210703952,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1600667939
    },
    {
        "content": "<p>I think it was<code> (3 : \\Z) * (X : ...)</code></p>",
        "id": 210704020,
        "sender_full_name": "Lucas Allen",
        "timestamp": 1600668005
    },
    {
        "content": "<p>It likes the <code>\\bu</code>. Everything works now.</p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"bp\">@</span><span class=\"o\">[</span><span class=\"n\">simp</span><span class=\"o\">]</span> <span class=\"kn\">lemma</span> <span class=\"n\">X_add</span> <span class=\"o\">(</span><span class=\"n\">a</span> <span class=\"n\">b</span> <span class=\"o\">:</span> <span class=\"bp\">ℤ</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">a</span> <span class=\"err\">•</span> <span class=\"o\">(</span><span class=\"n\">X</span> <span class=\"o\">:</span> <span class=\"n\">polynomial</span> <span class=\"bp\">ℤ</span><span class=\"o\">)</span> <span class=\"bp\">+</span> <span class=\"n\">b</span> <span class=\"err\">•</span> <span class=\"n\">X</span> <span class=\"bp\">=</span> <span class=\"o\">(</span><span class=\"n\">a</span> <span class=\"bp\">+</span> <span class=\"n\">b</span><span class=\"o\">)</span> <span class=\"err\">•</span> <span class=\"n\">X</span> <span class=\"o\">:=</span>\n<span class=\"k\">begin</span>\n  <span class=\"n\">exact</span> <span class=\"o\">(</span><span class=\"n\">add_smul</span> <span class=\"n\">a</span> <span class=\"n\">b</span> <span class=\"n\">X</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">symm</span>\n<span class=\"kn\">end</span>\n\n<span class=\"kn\">lemma</span> <span class=\"n\">xxx</span> <span class=\"o\">:</span> <span class=\"o\">(</span><span class=\"mi\">3</span> <span class=\"o\">:</span> <span class=\"bp\">ℤ</span><span class=\"o\">)</span> <span class=\"err\">•</span> <span class=\"o\">(</span><span class=\"n\">X</span> <span class=\"o\">:</span> <span class=\"n\">polynomial</span> <span class=\"bp\">ℤ</span><span class=\"o\">)</span> <span class=\"bp\">+</span> <span class=\"o\">(</span><span class=\"mi\">5</span> <span class=\"o\">:</span> <span class=\"bp\">ℤ</span><span class=\"o\">)</span> <span class=\"err\">•</span> <span class=\"o\">(</span><span class=\"n\">X</span><span class=\"o\">)</span> <span class=\"bp\">=</span> <span class=\"o\">(</span><span class=\"mi\">8</span> <span class=\"o\">:</span> <span class=\"bp\">ℤ</span><span class=\"o\">)</span> <span class=\"err\">•</span> <span class=\"n\">X</span> <span class=\"o\">:=</span>\n<span class=\"k\">begin</span>\n  <span class=\"n\">apply</span> <span class=\"n\">X_add</span><span class=\"o\">,</span>\n<span class=\"kn\">end</span>\n\n<span class=\"bp\">#</span><span class=\"n\">simp</span> <span class=\"o\">[</span><span class=\"n\">X_add</span><span class=\"o\">]</span> <span class=\"o\">(</span><span class=\"mi\">3</span> <span class=\"o\">:</span> <span class=\"bp\">ℤ</span><span class=\"o\">)</span> <span class=\"err\">•</span> <span class=\"o\">(</span><span class=\"n\">X</span> <span class=\"o\">:</span> <span class=\"n\">polynomial</span> <span class=\"bp\">ℤ</span><span class=\"o\">)</span> <span class=\"bp\">+</span> <span class=\"o\">(</span><span class=\"mi\">5</span> <span class=\"o\">:</span> <span class=\"bp\">ℤ</span><span class=\"o\">)</span> <span class=\"err\">•</span> <span class=\"o\">(</span><span class=\"n\">X</span><span class=\"o\">)</span> <span class=\"c1\">--(3 + 5) • X</span>\n</code></pre></div>",
        "id": 210704063,
        "sender_full_name": "Lucas Allen",
        "timestamp": 1600668097
    },
    {
        "content": "<p>This is the best I could come up with but I have a feeling it's not idiomatic (or correct?). Is there a way to eval directly into <code>polynomial R</code> ?</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kd\">theorem</span> <span class=\"n\">aopsbook_v2_c6_em2</span>\n  <span class=\"o\">(</span><span class=\"n\">f</span> <span class=\"o\">:</span> <span class=\"n\">polynomial</span> <span class=\"n\">ℝ</span><span class=\"o\">)</span>\n  <span class=\"o\">(</span><span class=\"n\">a</span> <span class=\"o\">:</span> <span class=\"n\">ℝ</span><span class=\"o\">)</span> <span class=\"o\">:</span>\n  <span class=\"n\">polynomial.mod</span> <span class=\"n\">f</span> <span class=\"o\">(</span><span class=\"n\">polynomial.X</span> <span class=\"bp\">-</span> <span class=\"n\">polynomial.C</span> <span class=\"n\">a</span><span class=\"o\">)</span> <span class=\"bp\">=</span> <span class=\"n\">polynomial.C</span> <span class=\"o\">(</span><span class=\"n\">polynomial.eval</span> <span class=\"n\">a</span> <span class=\"n\">f</span><span class=\"o\">)</span> <span class=\"o\">:=</span>\n<span class=\"kd\">begin</span>\n  <span class=\"gr\">sorry</span>\n<span class=\"kd\">end</span>\n</code></pre></div>",
        "id": 243661361,
        "sender_full_name": "Stanislas Polu",
        "timestamp": 1624459106
    },
    {
        "content": "<p>There is <code>eval\\_2</code>, I think. It takes a ring hom as argument</p>",
        "id": 243661452,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1624459147
    },
    {
        "content": "<p>Maybe</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kn\">open</span> <span class=\"n\">polynomial</span>\n\n<span class=\"bp\">...</span> <span class=\"bp\">=</span> <span class=\"n\">aeval</span> <span class=\"n\">f</span> <span class=\"o\">(</span><span class=\"n\">C</span> <span class=\"n\">a</span><span class=\"o\">)</span>\n</code></pre></div>",
        "id": 243661555,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1624459200
    },
    {
        "content": "<p>Well from the <a href=\"https://leanprover-community.github.io/mathlib_docs/find/polynomial.eval\">docs#polynomial.eval</a>:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"n\">polynomial.eval</span> <span class=\"bp\">=</span> <span class=\"n\">polynomial.eval₂</span> <span class=\"o\">(</span><span class=\"n\">ring_hom.id</span> <span class=\"n\">R</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>so it should land in R as well?</p>",
        "id": 243661637,
        "sender_full_name": "Stanislas Polu",
        "timestamp": 1624459221
    },
    {
        "content": "<p>No, if you pass it something different from <code>ring_hom.id R</code>... then you can land in another ring</p>",
        "id": 243661799,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1624459305
    },
    {
        "content": "<p>Hmmm <code>aeval f (C a)</code> typechecks.</p>",
        "id": 243661877,
        "sender_full_name": "Stanislas Polu",
        "timestamp": 1624459325
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kd\">theorem</span> <span class=\"n\">aopsbook_v2_c6_em2</span>\n  <span class=\"o\">(</span><span class=\"n\">f</span> <span class=\"o\">:</span> <span class=\"n\">polynomial</span> <span class=\"n\">ℝ</span><span class=\"o\">)</span>\n  <span class=\"o\">(</span><span class=\"n\">a</span> <span class=\"o\">:</span> <span class=\"n\">ℝ</span><span class=\"o\">)</span> <span class=\"o\">:</span>\n  <span class=\"n\">polynomial.mod</span> <span class=\"n\">f</span> <span class=\"o\">(</span><span class=\"n\">polynomial.X</span> <span class=\"bp\">-</span> <span class=\"n\">polynomial.C</span> <span class=\"n\">a</span><span class=\"o\">)</span> <span class=\"bp\">=</span> <span class=\"n\">polynomial.aeval</span> <span class=\"n\">f</span> <span class=\"o\">(</span><span class=\"n\">polynomial.C</span> <span class=\"n\">a</span><span class=\"o\">)</span> <span class=\"o\">:=</span>\n<span class=\"kd\">begin</span>\n  <span class=\"gr\">sorry</span>\n<span class=\"kd\">end</span>\n</code></pre></div>",
        "id": 243661897,
        "sender_full_name": "Stanislas Polu",
        "timestamp": 1624459336
    },
    {
        "content": "<p>Doesn't <code>aeval f (C a)</code> mean \"evaluate the constant polynomial <code>C a</code> at the point <code>f</code>? <a href=\"https://leanprover-community.github.io/mathlib_docs/find/polynomial.aeval\">docs#polynomial.aeval</a></p>",
        "id": 243662014,
        "sender_full_name": "Anne Baanen",
        "timestamp": 1624459390
    },
    {
        "content": "<p>Ooh, so maybe you need to swap the arguments <span aria-label=\"see no evil\" class=\"emoji emoji-1f648\" role=\"img\" title=\"see no evil\">:see_no_evil:</span></p>",
        "id": 243662103,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1624459426
    },
    {
        "content": "<p>Yes, we want instead <code>aeval (C a) f</code>, which is the same as <code>C (aeval a f) = C (eval a f)</code>. (See e.g. my PR <a href=\"https://github.com/leanprover-community/mathlib/issues/8038\">#8038</a>)</p>",
        "id": 243662284,
        "sender_full_name": "Anne Baanen",
        "timestamp": 1624459487
    },
    {
        "content": "<p>Fantastic!</p>",
        "id": 243662331,
        "sender_full_name": "Stanislas Polu",
        "timestamp": 1624459505
    },
    {
        "content": "<p>Follow up question. I'd like to state the rational root theorem using a non generalized form (polynomial with integer coefficients and consider rational roots).</p>\n<p>I therefore need to state that the polynomial has integer coefficient and that a fraction in <code>ℚ</code> is a root of the polynomial but that does not typechecks because I'm no authorized to evaluate the polynomial in <code>ℚ</code> if it's defined as <code>polynomial ℤ</code>. Example:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kd\">theorem</span> <span class=\"n\">aopsbook_v2_c6_em6</span>\n  <span class=\"o\">(</span><span class=\"n\">P</span> <span class=\"o\">:</span> <span class=\"n\">polynomial</span> <span class=\"n\">ℤ</span><span class=\"o\">)</span>\n  <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"n\">q</span> <span class=\"o\">:</span> <span class=\"n\">ℤ</span><span class=\"o\">)</span>\n  <span class=\"o\">(</span><span class=\"n\">h₀</span> <span class=\"o\">:</span> <span class=\"n\">p.gcd</span> <span class=\"n\">q</span> <span class=\"bp\">=</span> <span class=\"mi\">1</span><span class=\"o\">)</span>\n  <span class=\"o\">(</span><span class=\"n\">h₁</span> <span class=\"o\">:</span> <span class=\"n\">is_root</span> <span class=\"n\">P</span> <span class=\"o\">(</span><span class=\"n\">p</span><span class=\"o\">:</span><span class=\"n\">ℚ</span><span class=\"bp\">/</span><span class=\"n\">q</span><span class=\"o\">))</span> <span class=\"o\">:</span>\n  <span class=\"n\">p</span> <span class=\"bp\">∣</span> <span class=\"n\">P.coeff</span> <span class=\"mi\">0</span> <span class=\"bp\">∧</span> <span class=\"n\">q</span> <span class=\"bp\">∣</span> <span class=\"n\">P.leading_coeff</span> <span class=\"o\">:=</span>\n<span class=\"kd\">begin</span>\n  <span class=\"gr\">sorry</span>\n<span class=\"kd\">end</span>\n</code></pre></div>\n<p>What exactly does <code>polynomial R</code> mean? Does it mean that the coeffs are in <code>R</code>? Can one define a polynomial whose coefficient are in R1 but codomain/domain R2 ?</p>",
        "id": 243800493,
        "sender_full_name": "Stanislas Polu",
        "timestamp": 1624547383
    },
    {
        "content": "<p>I think <a href=\"https://leanprover-community.github.io/mathlib_docs/find/polynomial.aeval\">docs#polynomial.aeval</a> should work?</p>",
        "id": 243801177,
        "sender_full_name": "Adam Topaz",
        "timestamp": 1624547660
    },
    {
        "content": "<p>Rephrasing, I'm surprised that <code>eval : R → polynomial R → R</code> or <code>is_root : polynomial R → R → Prop</code> and not <code>is_root: polynomial R → S → Prop</code> ?</p>",
        "id": 243801200,
        "sender_full_name": "Stanislas Polu",
        "timestamp": 1624547673
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"243562\">@Adam Topaz</span> what would be the syntax to use <a href=\"https://leanprover-community.github.io/mathlib_docs/find/polynomial.aeval\">docs#polynomial.aeval</a> here?</p>",
        "id": 243801270,
        "sender_full_name": "Stanislas Polu",
        "timestamp": 1624547701
    },
    {
        "content": "<p>(and I would use that to specify that <code>p/q</code> is a root) ?</p>",
        "id": 243801305,
        "sender_full_name": "Stanislas Polu",
        "timestamp": 1624547712
    },
    {
        "content": "<p>One sec I'll try to sketch some code</p>",
        "id": 243801356,
        "sender_full_name": "Adam Topaz",
        "timestamp": 1624547734
    },
    {
        "content": "<p>You can use <a href=\"https://leanprover-community.github.io/mathlib_docs/find/polynomial.map\">docs#polynomial.map</a> to interpret a polynomial with integer coefficients as a polynomial with rational coefficients</p>",
        "id": 243801523,
        "sender_full_name": "Riccardo Brasca",
        "timestamp": 1624547802
    },
    {
        "content": "<p>Sure, you can do that too, but I think you can just use aeval in this case.</p>",
        "id": 243801563,
        "sender_full_name": "Adam Topaz",
        "timestamp": 1624547820
    },
    {
        "content": "<p>Interesting, and out of curiousity how do I define <code>(f : R →+* S)</code> for <code>ℤ</code> and <code>ℚ</code> ?</p>",
        "id": 243801721,
        "sender_full_name": "Stanislas Polu",
        "timestamp": 1624547887
    },
    {
        "content": "<p>I presume it's <code>fraction_map ℤ ℚ</code> assuming that type checks ? <span aria-label=\"grimacing\" class=\"emoji emoji-1f62c\" role=\"img\" title=\"grimacing\">:grimacing:</span></p>",
        "id": 243801784,
        "sender_full_name": "Stanislas Polu",
        "timestamp": 1624547927
    },
    {
        "content": "<p>Almost, <code>algebra_map ℤ ℚ</code></p>",
        "id": 243801812,
        "sender_full_name": "Anne Baanen",
        "timestamp": 1624547940
    },
    {
        "content": "<p>But I agree with Adam that <code>aeval</code> Is better</p>",
        "id": 243801822,
        "sender_full_name": "Riccardo Brasca",
        "timestamp": 1624547946
    },
    {
        "content": "<p>In mathlib we tend to define an <code>algebra R S</code> instance if there's a canonical map <code>algebra_map R S : R →+* S</code>.</p>",
        "id": 243801993,
        "sender_full_name": "Anne Baanen",
        "timestamp": 1624548025
    },
    {
        "content": "<p>Something like this is what I had in mind:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kn\">import</span> <span class=\"n\">ring_theory.polynomial.basic</span>\n\n<span class=\"k\">#check</span> <span class=\"bp\">@</span><span class=\"n\">polynomial.aeval</span>\n\n<span class=\"kd\">example</span> <span class=\"o\">:</span> <span class=\"n\">algebra</span> <span class=\"n\">ℤ</span> <span class=\"n\">ℚ</span> <span class=\"o\">:=</span> <span class=\"kd\">by</span> <span class=\"n\">apply_instance</span>\n\n<span class=\"kd\">variables</span> <span class=\"o\">(</span><span class=\"n\">f</span> <span class=\"o\">:</span> <span class=\"n\">polynomial</span> <span class=\"n\">ℤ</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"n\">q</span> <span class=\"o\">:</span> <span class=\"n\">ℤ</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">h</span> <span class=\"o\">:</span> <span class=\"n\">p.gcd</span> <span class=\"n\">q</span> <span class=\"bp\">=</span> <span class=\"mi\">1</span><span class=\"o\">)</span>\n\n<span class=\"kd\">example</span> <span class=\"o\">(</span><span class=\"n\">hh</span> <span class=\"o\">:</span> <span class=\"n\">polynomial.aeval</span> <span class=\"o\">((</span><span class=\"n\">p</span> <span class=\"o\">:</span> <span class=\"n\">ℚ</span><span class=\"o\">)</span> <span class=\"bp\">/</span> <span class=\"n\">q</span><span class=\"o\">)</span> <span class=\"n\">f</span>  <span class=\"bp\">=</span> <span class=\"mi\">0</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">true</span> <span class=\"o\">:=</span> <span class=\"gr\">sorry</span>\n</code></pre></div>",
        "id": 243802013,
        "sender_full_name": "Adam Topaz",
        "timestamp": 1624548039
    },
    {
        "content": "<p>(sorry, the <code>#check</code> and first <code>example</code> were just a sanity check for myself ;) )</p>",
        "id": 243802140,
        "sender_full_name": "Adam Topaz",
        "timestamp": 1624548106
    },
    {
        "content": "<p>We also have <a href=\"https://leanprover-community.github.io/mathlib_docs/find/int.cast_ring_hom\">docs#int.cast_ring_hom</a></p>",
        "id": 243802142,
        "sender_full_name": "Riccardo Brasca",
        "timestamp": 1624548108
    },
    {
        "content": "<p><a href=\"https://leanprover-community.github.io/mathlib_docs/find/fraction_map\">docs#fraction_map</a> is more like <code>ring_hom</code>, in that <code>fraction_map ℤ ℚ</code> is the type of maps <code>ℤ → ℚ</code> that display <code>ℚ</code> as the fraction field of <code>ℤ</code></p>",
        "id": 243802173,
        "sender_full_name": "Anne Baanen",
        "timestamp": 1624548121
    },
    {
        "content": "<p>Thanks <span class=\"user-mention\" data-user-id=\"243562\">@Adam Topaz</span>!</p>",
        "id": 243802421,
        "sender_full_name": "Stanislas Polu",
        "timestamp": 1624548205
    },
    {
        "content": "<p>And thanks <span class=\"user-mention\" data-user-id=\"130384\">@Riccardo Brasca</span> and <span class=\"user-mention\" data-user-id=\"238446\">@Anne Baanen</span> things are getting much clearer to me \\o/</p>",
        "id": 243802452,
        "sender_full_name": "Stanislas Polu",
        "timestamp": 1624548225
    },
    {
        "content": "<p>Unfortunately it looks like we can't use dot notation for <code>polynomial.aeval</code> because it gives the evaluation as a ring hom.</p>",
        "id": 243802555,
        "sender_full_name": "Adam Topaz",
        "timestamp": 1624548261
    },
    {
        "content": "<p>I.e. <code>f.aeval ...</code> doesn't work</p>",
        "id": 243802577,
        "sender_full_name": "Adam Topaz",
        "timestamp": 1624548271
    },
    {
        "content": "<p>Try it in Lean 4!</p>",
        "id": 243802824,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1624548369
    },
    {
        "content": "<p>So just to make sure I understand, <code>aeval</code> infers the mapping based on the types of the arguments and the right mapping is defined somewhere for it to pick it up automatically?</p>",
        "id": 243806547,
        "sender_full_name": "Stanislas Polu",
        "timestamp": 1624549921
    },
    {
        "content": "<p>Yes, there's a long list of \"canonical\" mappings at <a href=\"https://leanprover-community.github.io/mathlib_docs/find/algebra\">docs#algebra</a></p>",
        "id": 243807469,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1624550339
    },
    {
        "content": "<p>(under <code>&gt; Instances</code>)</p>",
        "id": 243807518,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1624550356
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"249373\">@Stanislas Polu</span> the <code>a</code> in <code>aeval</code> stands for <code>algebra</code>. So it infers the right mapping based on an algebra instance. Fortunately for you, any ring has a unique structure of a Z-algebra and I think this is an actual instance in mathlib. So presumably you should be able to use <code>aeval</code> to evaluate an integral polynomial at an element in any ring.</p>",
        "id": 243808640,
        "sender_full_name": "Adam Topaz",
        "timestamp": 1624550842
    },
    {
        "content": "<p>Thanks! Makes sense <span aria-label=\"+1\" class=\"emoji emoji-1f44d\" role=\"img\" title=\"+1\">:+1:</span></p>",
        "id": 243811809,
        "sender_full_name": "Stanislas Polu",
        "timestamp": 1624552332
    },
    {
        "content": "<p>Hi! Me again <span aria-label=\"wave\" class=\"emoji emoji-1f44b\" role=\"img\" title=\"wave\">:wave:</span>  What would be an elegant way to define the k-th symmetric sum of the roots of a polynomial to prove that it's <code>(-1)^k*a_{n-k}/a_n</code> ?</p>",
        "id": 244139230,
        "sender_full_name": "Stanislas Polu",
        "timestamp": 1624884663
    },
    {
        "content": "<p>I've been looking for that theorem to no avail, and have no good idea on how to define such a summation?</p>",
        "id": 244139309,
        "sender_full_name": "Stanislas Polu",
        "timestamp": 1624884708
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"249373\">@Stanislas Polu</span> Note that there is <code>src/ring_theory/polynomial/symmetric.lean</code>, but I don't think it contains exactly what you want.</p>",
        "id": 244139862,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1624885014
    },
    {
        "content": "<p>Thanks! will look into it <span aria-label=\"+1\" class=\"emoji emoji-1f44d\" role=\"img\" title=\"+1\">:+1:</span></p>",
        "id": 244141950,
        "sender_full_name": "Stanislas Polu",
        "timestamp": 1624885995
    },
    {
        "content": "<p>(Seems quite unrelated indeed)</p>",
        "id": 244142083,
        "sender_full_name": "Stanislas Polu",
        "timestamp": 1624886050
    },
    {
        "content": "<p>Well, a more fleshed out version of that file would hopefully make it very easy to talk about the k-th symmetric sum, etc...</p>",
        "id": 244142252,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1624886155
    },
    {
        "content": "<p>Relatedly how can I describe a sum on a multiset (to describe a sum that depends on the roots of a polynomial)?</p>",
        "id": 244147127,
        "sender_full_name": "Stanislas Polu",
        "timestamp": 1624888276
    },
    {
        "content": "<p>If you have <code>s : multiset α</code> and you have a term <code>f x</code> for each <code>x ∈ s</code> that you want to add up, then you can use <code>(s.map f).sum</code> (see <a href=\"https://leanprover-community.github.io/mathlib_docs/find/multiset.map\">docs#multiset.map</a>, <a href=\"https://leanprover-community.github.io/mathlib_docs/find/multiset.sum\">docs#multiset.sum</a>).</p>",
        "id": 244147333,
        "sender_full_name": "Anne Baanen",
        "timestamp": 1624888369
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"238446\">@Anne Baanen</span> Thanks!</p>",
        "id": 244147567,
        "sender_full_name": "Stanislas Polu",
        "timestamp": 1624888479
    },
    {
        "content": "<p>Fantastic!</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kn\">import</span> <span class=\"n\">data.real.basic</span>\n<span class=\"kn\">import</span> <span class=\"n\">data.polynomial</span>\n<span class=\"kn\">open</span> <span class=\"n\">polynomial</span>\n\n<span class=\"kd\">theorem</span> <span class=\"n\">aopsbook_v2_c6_ex7</span>\n  <span class=\"o\">(</span><span class=\"n\">P</span> <span class=\"o\">:</span> <span class=\"n\">polynomial</span> <span class=\"n\">ℝ</span><span class=\"o\">)</span>\n  <span class=\"o\">(</span><span class=\"n\">f</span> <span class=\"o\">:</span> <span class=\"n\">ℝ</span> <span class=\"bp\">-&gt;</span> <span class=\"n\">ℝ</span><span class=\"o\">)</span>\n  <span class=\"o\">(</span><span class=\"n\">h₀</span> <span class=\"o\">:</span> <span class=\"n\">P</span> <span class=\"bp\">=</span> <span class=\"o\">(</span><span class=\"n\">C</span> <span class=\"mi\">3</span><span class=\"o\">)</span><span class=\"bp\">*</span><span class=\"n\">X</span><span class=\"bp\">^</span><span class=\"mi\">3</span> <span class=\"bp\">-</span> <span class=\"o\">(</span><span class=\"n\">C</span> <span class=\"mi\">14</span><span class=\"o\">)</span><span class=\"bp\">*</span><span class=\"n\">X</span><span class=\"bp\">^</span><span class=\"mi\">2</span> <span class=\"bp\">+</span> <span class=\"n\">X</span> <span class=\"bp\">+</span> <span class=\"n\">C</span> <span class=\"mi\">62</span><span class=\"o\">)</span>\n  <span class=\"o\">(</span><span class=\"n\">h₁</span> <span class=\"o\">:</span> <span class=\"bp\">∀</span> <span class=\"n\">r</span><span class=\"o\">,</span> <span class=\"n\">f</span><span class=\"o\">(</span><span class=\"n\">r</span><span class=\"o\">)</span> <span class=\"bp\">=</span> <span class=\"mi\">1</span><span class=\"bp\">/</span><span class=\"o\">(</span><span class=\"n\">r</span><span class=\"bp\">+</span><span class=\"mi\">3</span><span class=\"o\">))</span> <span class=\"o\">:</span>\n  <span class=\"o\">(</span><span class=\"n\">P.roots.map</span> <span class=\"n\">f</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">sum</span> <span class=\"bp\">=</span> <span class=\"mi\">83</span><span class=\"bp\">/</span><span class=\"mi\">74</span> <span class=\"o\">:=</span>\n<span class=\"kd\">begin</span>\n  <span class=\"gr\">sorry</span>\n<span class=\"kd\">end</span>\n</code></pre></div>",
        "id": 244147835,
        "sender_full_name": "Stanislas Polu",
        "timestamp": 1624888591
    },
    {
        "content": "<p>This does not look true to me. The cubic only has one real root and P.roots looks to me to be the multiset of real roots. Have I made a mistake?</p>",
        "id": 244192293,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1624907873
    }
]