[
    {
        "content": "<p>Is there a tactic for proving inductively defined propositions, where the right constructor to apply is always obvious because they're all mutually exclusive in their conclusions? I find myself having to apply many constructors of the inductive proposition, all of which terminate to some atomic constructor, or can be solved with <code>assumption</code>.</p>",
        "id": 200186449,
        "sender_full_name": "Billy Price",
        "timestamp": 1591684840
    },
    {
        "content": "<p>Is <code>tauto</code> of any use?</p>",
        "id": 200186533,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1591684935
    },
    {
        "content": "<p>It uses <code>solve_by_elim</code></p>",
        "id": 200186536,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1591684950
    },
    {
        "content": "<p>That sounds like <code>constructor</code></p>",
        "id": 200186811,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1591685309
    },
    {
        "content": "<p>which is basically the same as <code>apply T.constr1 &lt;|&gt; apply T.constr2 &lt;|&gt;  ...</code></p>",
        "id": 200186832,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1591685353
    },
    {
        "content": "<p><code>tauto</code> didn't work, and <code>constructor</code> works as expected for 1 step, so I did <code>repeat {constructor}</code> and that solved it - but this will only work if the proposition reduces to atomic constructors, not if one of the goals produced is part of the context (for which <code>assumption</code> would work). I'm guessing I could do something like <code>repeat {constructor &lt;|&gt; assumption}</code> - but is that the cleanest way to proceed?</p>\n<p>Here's a contrived example to illustrate this</p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"kn\">inductive</span> <span class=\"n\">WF</span> <span class=\"o\">:</span> <span class=\"kn\">context</span> <span class=\"bp\">→</span> <span class=\"n\">type</span> <span class=\"bp\">→</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"kt\">Prop</span>\n<span class=\"bp\">|</span> <span class=\"n\">star</span> <span class=\"o\">{</span><span class=\"err\">Γ</span><span class=\"o\">}</span>         <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"n\">Unit</span> <span class=\"err\">⁎</span>\n<span class=\"bp\">|</span> <span class=\"n\">top</span>  <span class=\"o\">{</span><span class=\"err\">Γ</span><span class=\"o\">}</span>         <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"err\">⊤</span>\n<span class=\"bp\">|</span> <span class=\"n\">bot</span>  <span class=\"o\">{</span><span class=\"err\">Γ</span><span class=\"o\">}</span>         <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"err\">⊥</span>\n<span class=\"bp\">|</span> <span class=\"n\">and</span>  <span class=\"o\">{</span><span class=\"err\">Γ</span> <span class=\"n\">p</span> <span class=\"n\">q</span><span class=\"o\">}</span>     <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"n\">p</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"n\">q</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"err\">⋀</span> <span class=\"n\">q</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"n\">or</span>   <span class=\"o\">{</span><span class=\"err\">Γ</span> <span class=\"n\">p</span> <span class=\"n\">q</span><span class=\"o\">}</span>     <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"n\">p</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"n\">q</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"err\">⋁</span> <span class=\"n\">q</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"n\">imp</span>  <span class=\"o\">{</span><span class=\"err\">Γ</span> <span class=\"n\">p</span> <span class=\"n\">q</span><span class=\"o\">}</span>     <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"n\">p</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"n\">q</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"err\">⟹</span> <span class=\"n\">q</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"n\">elem</span> <span class=\"o\">{</span><span class=\"err\">Γ</span> <span class=\"n\">A</span> <span class=\"n\">a</span> <span class=\"n\">α</span><span class=\"o\">}</span>   <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"n\">A</span> <span class=\"n\">a</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"o\">(</span><span class=\"err\">𝒫</span> <span class=\"n\">A</span><span class=\"o\">)</span> <span class=\"n\">α</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"o\">(</span><span class=\"n\">a</span> <span class=\"err\">∈</span> <span class=\"n\">α</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"n\">pair</span> <span class=\"o\">{</span><span class=\"err\">Γ</span> <span class=\"n\">A</span> <span class=\"n\">B</span> <span class=\"n\">a</span> <span class=\"n\">b</span><span class=\"o\">}</span> <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"n\">A</span> <span class=\"n\">a</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"n\">B</span> <span class=\"n\">b</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"bp\">××</span> <span class=\"n\">B</span><span class=\"o\">)</span> <span class=\"err\">⟪</span><span class=\"n\">a</span><span class=\"o\">,</span><span class=\"n\">b</span><span class=\"err\">⟫</span>\n<span class=\"bp\">|</span> <span class=\"n\">var</span>  <span class=\"o\">{</span><span class=\"err\">Γ</span> <span class=\"n\">A</span> <span class=\"n\">n</span><span class=\"o\">}</span>     <span class=\"o\">:</span> <span class=\"n\">list</span><span class=\"bp\">.</span><span class=\"n\">nth</span> <span class=\"err\">Γ</span> <span class=\"n\">n</span> <span class=\"bp\">=</span> <span class=\"n\">some</span> <span class=\"n\">A</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"n\">A</span> <span class=\"o\">(</span><span class=\"n\">var</span> <span class=\"n\">n</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"n\">comp</span> <span class=\"o\">{</span><span class=\"err\">Γ</span> <span class=\"n\">A</span> <span class=\"n\">φ</span><span class=\"o\">}</span>     <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"o\">(</span><span class=\"n\">A</span><span class=\"bp\">::</span><span class=\"err\">Γ</span><span class=\"o\">)</span> <span class=\"err\">Ω</span> <span class=\"n\">φ</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"o\">(</span><span class=\"err\">𝒫</span> <span class=\"n\">A</span><span class=\"o\">)</span> <span class=\"err\">⟦</span><span class=\"n\">φ</span><span class=\"err\">⟧</span>\n<span class=\"bp\">|</span> <span class=\"n\">all</span>  <span class=\"o\">{</span><span class=\"err\">Γ</span> <span class=\"n\">A</span> <span class=\"n\">φ</span><span class=\"o\">}</span>     <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"o\">(</span><span class=\"n\">A</span><span class=\"bp\">::</span><span class=\"err\">Γ</span><span class=\"o\">)</span> <span class=\"err\">Ω</span> <span class=\"n\">φ</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"o\">(</span><span class=\"bp\">∀</span><span class=\"err\">&#39;</span> <span class=\"n\">φ</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"n\">ex</span>   <span class=\"o\">{</span><span class=\"err\">Γ</span> <span class=\"n\">A</span> <span class=\"n\">φ</span><span class=\"o\">}</span>     <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"o\">(</span><span class=\"n\">A</span><span class=\"bp\">::</span><span class=\"err\">Γ</span><span class=\"o\">)</span> <span class=\"err\">Ω</span> <span class=\"n\">φ</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"o\">(</span><span class=\"bp\">∃</span><span class=\"err\">&#39;</span> <span class=\"n\">φ</span><span class=\"o\">)</span>\n\n<span class=\"kn\">example</span> <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"o\">[]</span> <span class=\"err\">Ω</span> <span class=\"n\">p</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"o\">[]</span> <span class=\"err\">Ω</span> <span class=\"n\">q</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"o\">[]</span> <span class=\"err\">Ω</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"err\">⋀</span> <span class=\"n\">q</span><span class=\"o\">)</span> <span class=\"o\">:=</span>\n<span class=\"k\">begin</span>\n  <span class=\"n\">intros</span> <span class=\"n\">h₁</span> <span class=\"n\">h₂</span><span class=\"o\">,</span>\n  <span class=\"n\">constructor</span><span class=\"o\">,</span>\n  <span class=\"n\">assumption</span><span class=\"o\">,</span>\n  <span class=\"n\">assumption</span>\n<span class=\"kn\">end</span>\n</code></pre></div>",
        "id": 200188035,
        "sender_full_name": "Billy Price",
        "timestamp": 1591686603
    },
    {
        "content": "<p>Does <code>tidy</code> do it for you?</p>",
        "id": 200188422,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1591686957
    },
    {
        "content": "<p>Nope, no progress</p>",
        "id": 200188698,
        "sender_full_name": "Billy Price",
        "timestamp": 1591687198
    },
    {
        "content": "<p>it seems you have a proof already. Do you have a better example?</p>",
        "id": 200189837,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1591688046
    },
    {
        "content": "<p>also that's not an <a href=\"https://leanprover-community.github.io/mwe.html\">#mwe</a></p>",
        "id": 200190069,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1591688267
    },
    {
        "content": "<p>probably <code>constructor; assumption</code> will work on this and similar goals</p>",
        "id": 200190138,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1591688317
    },
    {
        "content": "<p>so something like <code>induction h; constructor; assumption</code> will take care of most of your theorem</p>",
        "id": 200190169,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1591688351
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"255481\">@Billy Price</span></p>",
        "id": 200190183,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1591688370
    },
    {
        "content": "<p>Here's an example of how this problem blows up, which is only half done because of the definition of <code>biimp</code>. Essentially I want a tactic which will do as much of this as it can by itself, and then leave me with the non-trivial goals (in this case those can be solved by <code>assumption</code> - but I can imagine more general usage where I'd need to do more work).</p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"kn\">import</span> <span class=\"n\">tactic</span><span class=\"bp\">.</span><span class=\"n\">tidy</span>\n<span class=\"kn\">import</span> <span class=\"n\">tactic</span><span class=\"bp\">.</span><span class=\"n\">tauto</span>\n\n<span class=\"kn\">inductive</span> <span class=\"n\">type</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span>\n<span class=\"bp\">|</span> <span class=\"n\">Unit</span> <span class=\"bp\">|</span> <span class=\"n\">Omega</span> <span class=\"bp\">|</span> <span class=\"n\">Prod</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"n\">B</span> <span class=\"o\">:</span> <span class=\"n\">type</span><span class=\"o\">)</span><span class=\"bp\">|</span> <span class=\"n\">Pow</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"o\">:</span> <span class=\"n\">type</span><span class=\"o\">)</span>\n\n<span class=\"kn\">notation</span> <span class=\"bp\">`</span><span class=\"err\">Ω</span><span class=\"bp\">`</span> <span class=\"o\">:=</span> <span class=\"n\">type</span><span class=\"bp\">.</span><span class=\"n\">Omega</span>\n<span class=\"n\">def</span> <span class=\"n\">Unit</span> <span class=\"o\">:=</span> <span class=\"n\">type</span><span class=\"bp\">.</span><span class=\"n\">Unit</span>\n<span class=\"kn\">infix</span> <span class=\"bp\">`××`</span><span class=\"o\">:</span><span class=\"n\">max</span> <span class=\"o\">:=</span> <span class=\"n\">type</span><span class=\"bp\">.</span><span class=\"n\">Prod</span>\n<span class=\"kn\">notation</span> <span class=\"bp\">`</span><span class=\"err\">𝒫</span><span class=\"bp\">`</span><span class=\"n\">A</span> <span class=\"o\">:</span><span class=\"n\">max</span> <span class=\"o\">:=</span> <span class=\"n\">type</span><span class=\"bp\">.</span><span class=\"n\">Pow</span> <span class=\"n\">A</span>\n\n<span class=\"n\">def</span> <span class=\"kn\">context</span> <span class=\"o\">:=</span> <span class=\"n\">list</span> <span class=\"n\">type</span>\n\n<span class=\"kn\">inductive</span> <span class=\"n\">term</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span>\n<span class=\"bp\">|</span> <span class=\"n\">star</span> <span class=\"o\">:</span> <span class=\"n\">term</span>\n<span class=\"bp\">|</span> <span class=\"n\">top</span>  <span class=\"o\">:</span> <span class=\"n\">term</span>\n<span class=\"bp\">|</span> <span class=\"n\">bot</span>  <span class=\"o\">:</span> <span class=\"n\">term</span>\n<span class=\"bp\">|</span> <span class=\"n\">and</span>  <span class=\"o\">:</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">term</span>\n<span class=\"bp\">|</span> <span class=\"n\">or</span>   <span class=\"o\">:</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">term</span>\n<span class=\"bp\">|</span> <span class=\"n\">imp</span>  <span class=\"o\">:</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">term</span>\n<span class=\"bp\">|</span> <span class=\"n\">elem</span> <span class=\"o\">:</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">term</span>\n<span class=\"bp\">|</span> <span class=\"n\">pair</span> <span class=\"o\">:</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">term</span>\n<span class=\"bp\">|</span> <span class=\"n\">var</span>  <span class=\"o\">:</span> <span class=\"bp\">ℕ</span> <span class=\"bp\">→</span> <span class=\"n\">term</span>\n<span class=\"bp\">|</span> <span class=\"n\">comp</span> <span class=\"o\">:</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">term</span>\n<span class=\"bp\">|</span> <span class=\"n\">all</span>  <span class=\"o\">:</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">term</span>\n<span class=\"bp\">|</span> <span class=\"n\">ex</span>   <span class=\"o\">:</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">term</span>\n\n<span class=\"c1\">-- * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *</span>\n<span class=\"c1\">-- Notation and derived operators</span>\n<span class=\"c1\">-- * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *</span>\n\n<span class=\"kn\">notation</span> <span class=\"bp\">`</span><span class=\"mi\">𝟘</span><span class=\"bp\">`</span> <span class=\"o\">:=</span> <span class=\"n\">term</span><span class=\"bp\">.</span><span class=\"n\">var</span> <span class=\"mi\">0</span>\n<span class=\"kn\">notation</span> <span class=\"bp\">`</span><span class=\"mi\">𝟙</span><span class=\"bp\">`</span> <span class=\"o\">:=</span> <span class=\"n\">term</span><span class=\"bp\">.</span><span class=\"n\">var</span> <span class=\"mi\">1</span>\n<span class=\"kn\">notation</span> <span class=\"bp\">`</span><span class=\"mi\">𝟚</span><span class=\"bp\">`</span> <span class=\"o\">:=</span> <span class=\"n\">term</span><span class=\"bp\">.</span><span class=\"n\">var</span> <span class=\"mi\">2</span>\n<span class=\"kn\">notation</span> <span class=\"bp\">`</span><span class=\"mi\">𝟛</span><span class=\"bp\">`</span> <span class=\"o\">:=</span> <span class=\"n\">term</span><span class=\"bp\">.</span><span class=\"n\">var</span> <span class=\"mi\">3</span>\n<span class=\"kn\">notation</span> <span class=\"bp\">`</span><span class=\"mi\">𝟜</span><span class=\"bp\">`</span> <span class=\"o\">:=</span> <span class=\"n\">term</span><span class=\"bp\">.</span><span class=\"n\">var</span> <span class=\"mi\">4</span>\n<span class=\"kn\">notation</span> <span class=\"bp\">`</span><span class=\"mi\">𝟝</span><span class=\"bp\">`</span> <span class=\"o\">:=</span> <span class=\"n\">term</span><span class=\"bp\">.</span><span class=\"n\">var</span> <span class=\"mi\">5</span>\n\n<span class=\"kn\">notation</span> <span class=\"bp\">`</span><span class=\"err\">⁎</span><span class=\"bp\">`</span> <span class=\"o\">:=</span> <span class=\"n\">term</span><span class=\"bp\">.</span><span class=\"n\">star</span>    <span class=\"c1\">-- input \\asterisk</span>\n<span class=\"kn\">notation</span> <span class=\"bp\">`</span><span class=\"err\">⊤</span><span class=\"bp\">`</span> <span class=\"o\">:=</span> <span class=\"n\">term</span><span class=\"bp\">.</span><span class=\"n\">top</span>     <span class=\"c1\">--       \\top</span>\n<span class=\"kn\">notation</span> <span class=\"bp\">`</span><span class=\"err\">⊥</span><span class=\"bp\">`</span> <span class=\"o\">:=</span> <span class=\"n\">term</span><span class=\"bp\">.</span><span class=\"n\">bot</span>     <span class=\"c1\">-- input \\bot</span>\n<span class=\"kn\">infixr</span> <span class=\"bp\">`</span> <span class=\"err\">⟹</span> <span class=\"bp\">`</span><span class=\"o\">:</span><span class=\"mi\">60</span> <span class=\"o\">:=</span> <span class=\"n\">term</span><span class=\"bp\">.</span><span class=\"n\">imp</span> <span class=\"c1\">-- input \\==&gt;</span>\n<span class=\"kn\">infixr</span> <span class=\"bp\">`</span> <span class=\"err\">⋀</span> <span class=\"bp\">`</span> <span class=\"o\">:</span><span class=\"mi\">70</span> <span class=\"o\">:=</span> <span class=\"n\">term</span><span class=\"bp\">.</span><span class=\"n\">and</span> <span class=\"c1\">-- input \\And or \\bigwedge</span>\n<span class=\"kn\">infixr</span> <span class=\"bp\">`</span> <span class=\"err\">⋁</span> <span class=\"bp\">`</span> <span class=\"o\">:</span><span class=\"mi\">59</span> <span class=\"o\">:=</span> <span class=\"n\">term</span><span class=\"bp\">.</span><span class=\"n\">or</span>  <span class=\"c1\">-- input \\Or or \\bigvee</span>\n\n\n<span class=\"n\">def</span> <span class=\"n\">biimp</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"n\">q</span><span class=\"o\">:</span> <span class=\"n\">term</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"err\">⟹</span> <span class=\"n\">q</span><span class=\"o\">)</span> <span class=\"err\">⋀</span> <span class=\"o\">(</span><span class=\"n\">q</span> <span class=\"err\">⟹</span> <span class=\"n\">p</span><span class=\"o\">)</span>\n<span class=\"kn\">infix</span> <span class=\"bp\">`</span> <span class=\"err\">⇔</span> <span class=\"bp\">`</span><span class=\"o\">:</span><span class=\"mi\">60</span> <span class=\"o\">:=</span> <span class=\"n\">biimp</span> <span class=\"c1\">-- input \\&lt;=&gt;</span>\n\n<span class=\"kn\">infix</span> <span class=\"err\">∈</span> <span class=\"o\">:=</span> <span class=\"n\">term</span><span class=\"bp\">.</span><span class=\"n\">elem</span>\n<span class=\"kn\">notation</span> <span class=\"bp\">`</span><span class=\"err\">⟦</span><span class=\"bp\">`</span> <span class=\"n\">φ</span> <span class=\"bp\">`</span><span class=\"err\">⟧</span><span class=\"bp\">`</span> <span class=\"o\">:=</span> <span class=\"n\">term</span><span class=\"bp\">.</span><span class=\"n\">comp</span> <span class=\"n\">φ</span>\n\n<span class=\"kn\">notation</span> <span class=\"bp\">`</span><span class=\"err\">⟪</span><span class=\"bp\">`</span> <span class=\"n\">a</span> <span class=\"bp\">`</span><span class=\"o\">,</span><span class=\"bp\">`</span> <span class=\"n\">b</span> <span class=\"bp\">`</span><span class=\"err\">⟫</span><span class=\"bp\">`</span> <span class=\"o\">:=</span> <span class=\"n\">term</span><span class=\"bp\">.</span><span class=\"n\">pair</span> <span class=\"n\">a</span> <span class=\"n\">b</span>\n\n<span class=\"kn\">prefix</span> <span class=\"bp\">`∀</span><span class=\"err\">&#39;</span><span class=\"bp\">`</span><span class=\"o\">:</span><span class=\"mi\">1</span> <span class=\"o\">:=</span> <span class=\"n\">term</span><span class=\"bp\">.</span><span class=\"n\">all</span>\n<span class=\"kn\">prefix</span> <span class=\"bp\">`∃</span><span class=\"err\">&#39;</span><span class=\"bp\">`</span><span class=\"o\">:</span><span class=\"mi\">2</span> <span class=\"o\">:=</span> <span class=\"n\">term</span><span class=\"bp\">.</span><span class=\"n\">ex</span>\n\n<span class=\"n\">def</span> <span class=\"n\">lib_eq</span> <span class=\"o\">(</span><span class=\"n\">a₁</span> <span class=\"n\">a₂</span> <span class=\"o\">:</span> <span class=\"n\">term</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">term</span> <span class=\"o\">:=</span> <span class=\"bp\">∀</span><span class=\"err\">&#39;</span> <span class=\"o\">(</span><span class=\"n\">a₁</span> <span class=\"err\">∈</span> <span class=\"mi\">𝟘</span><span class=\"o\">)</span> <span class=\"err\">⇔</span> <span class=\"o\">(</span><span class=\"n\">a₂</span> <span class=\"err\">∈</span> <span class=\"mi\">𝟘</span><span class=\"o\">)</span>\n<span class=\"kn\">infix</span> <span class=\"bp\">`</span> <span class=\"err\">≃</span> <span class=\"bp\">`</span> <span class=\"o\">:</span><span class=\"mi\">50</span> <span class=\"o\">:=</span> <span class=\"n\">lib_eq</span>\n\n\n<span class=\"c1\">-- * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *</span>\n<span class=\"kn\">open</span> <span class=\"n\">term</span>\n\n\n\n<span class=\"kn\">inductive</span> <span class=\"n\">WF</span> <span class=\"o\">:</span> <span class=\"kn\">context</span> <span class=\"bp\">→</span> <span class=\"n\">type</span> <span class=\"bp\">→</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"kt\">Prop</span>\n<span class=\"bp\">|</span> <span class=\"n\">star</span> <span class=\"o\">{</span><span class=\"err\">Γ</span><span class=\"o\">}</span>         <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"n\">Unit</span> <span class=\"err\">⁎</span>\n<span class=\"bp\">|</span> <span class=\"n\">top</span>  <span class=\"o\">{</span><span class=\"err\">Γ</span><span class=\"o\">}</span>         <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"err\">⊤</span>\n<span class=\"bp\">|</span> <span class=\"n\">bot</span>  <span class=\"o\">{</span><span class=\"err\">Γ</span><span class=\"o\">}</span>         <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"err\">⊥</span>\n<span class=\"bp\">|</span> <span class=\"n\">and</span>  <span class=\"o\">{</span><span class=\"err\">Γ</span> <span class=\"n\">p</span> <span class=\"n\">q</span><span class=\"o\">}</span>     <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"n\">p</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"n\">q</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"err\">⋀</span> <span class=\"n\">q</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"n\">or</span>   <span class=\"o\">{</span><span class=\"err\">Γ</span> <span class=\"n\">p</span> <span class=\"n\">q</span><span class=\"o\">}</span>     <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"n\">p</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"n\">q</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"err\">⋁</span> <span class=\"n\">q</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"n\">imp</span>  <span class=\"o\">{</span><span class=\"err\">Γ</span> <span class=\"n\">p</span> <span class=\"n\">q</span><span class=\"o\">}</span>     <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"n\">p</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"n\">q</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"err\">⟹</span> <span class=\"n\">q</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"n\">elem</span> <span class=\"o\">{</span><span class=\"err\">Γ</span> <span class=\"n\">A</span> <span class=\"n\">a</span> <span class=\"n\">α</span><span class=\"o\">}</span>   <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"n\">A</span> <span class=\"n\">a</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"o\">(</span><span class=\"err\">𝒫</span> <span class=\"n\">A</span><span class=\"o\">)</span> <span class=\"n\">α</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"o\">(</span><span class=\"n\">a</span> <span class=\"err\">∈</span> <span class=\"n\">α</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"n\">pair</span> <span class=\"o\">{</span><span class=\"err\">Γ</span> <span class=\"n\">A</span> <span class=\"n\">B</span> <span class=\"n\">a</span> <span class=\"n\">b</span><span class=\"o\">}</span> <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"n\">A</span> <span class=\"n\">a</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"n\">B</span> <span class=\"n\">b</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"bp\">××</span> <span class=\"n\">B</span><span class=\"o\">)</span> <span class=\"err\">⟪</span><span class=\"n\">a</span><span class=\"o\">,</span><span class=\"n\">b</span><span class=\"err\">⟫</span>\n<span class=\"bp\">|</span> <span class=\"n\">var</span>  <span class=\"o\">{</span><span class=\"err\">Γ</span> <span class=\"n\">A</span> <span class=\"n\">n</span><span class=\"o\">}</span>     <span class=\"o\">:</span> <span class=\"n\">list</span><span class=\"bp\">.</span><span class=\"n\">nth</span> <span class=\"err\">Γ</span> <span class=\"n\">n</span> <span class=\"bp\">=</span> <span class=\"n\">some</span> <span class=\"n\">A</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"n\">A</span> <span class=\"o\">(</span><span class=\"n\">var</span> <span class=\"n\">n</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"n\">comp</span> <span class=\"o\">{</span><span class=\"err\">Γ</span> <span class=\"n\">A</span> <span class=\"n\">φ</span><span class=\"o\">}</span>     <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"o\">(</span><span class=\"n\">A</span><span class=\"bp\">::</span><span class=\"err\">Γ</span><span class=\"o\">)</span> <span class=\"err\">Ω</span> <span class=\"n\">φ</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"o\">(</span><span class=\"err\">𝒫</span> <span class=\"n\">A</span><span class=\"o\">)</span> <span class=\"err\">⟦</span><span class=\"n\">φ</span><span class=\"err\">⟧</span>\n<span class=\"bp\">|</span> <span class=\"n\">all</span>  <span class=\"o\">{</span><span class=\"err\">Γ</span> <span class=\"n\">A</span> <span class=\"n\">φ</span><span class=\"o\">}</span>     <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"o\">(</span><span class=\"n\">A</span><span class=\"bp\">::</span><span class=\"err\">Γ</span><span class=\"o\">)</span> <span class=\"err\">Ω</span> <span class=\"n\">φ</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"o\">(</span><span class=\"bp\">∀</span><span class=\"err\">&#39;</span> <span class=\"n\">φ</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"n\">ex</span>   <span class=\"o\">{</span><span class=\"err\">Γ</span> <span class=\"n\">A</span> <span class=\"n\">φ</span><span class=\"o\">}</span>     <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"o\">(</span><span class=\"n\">A</span><span class=\"bp\">::</span><span class=\"err\">Γ</span><span class=\"o\">)</span> <span class=\"err\">Ω</span> <span class=\"n\">φ</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"o\">(</span><span class=\"bp\">∃</span><span class=\"err\">&#39;</span> <span class=\"n\">φ</span><span class=\"o\">)</span>\n\n<span class=\"kn\">variables</span> <span class=\"n\">p</span> <span class=\"n\">q</span> <span class=\"n\">r</span> <span class=\"o\">:</span> <span class=\"n\">term</span>\n\n<span class=\"kn\">example</span> <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"o\">[</span><span class=\"n\">Unit</span><span class=\"o\">,</span><span class=\"err\">Ω</span><span class=\"o\">]</span> <span class=\"err\">Ω</span> <span class=\"n\">p</span> <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"o\">[</span><span class=\"n\">Unit</span><span class=\"o\">,</span><span class=\"err\">Ω</span><span class=\"o\">]</span> <span class=\"err\">Ω</span> <span class=\"n\">q</span>  <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"o\">[</span><span class=\"n\">Unit</span><span class=\"o\">,</span><span class=\"err\">Ω</span><span class=\"o\">]</span> <span class=\"err\">Ω</span> <span class=\"n\">r</span>  <span class=\"bp\">→</span> <span class=\"n\">WF</span> <span class=\"o\">[</span><span class=\"n\">Unit</span><span class=\"o\">,</span><span class=\"err\">Ω</span><span class=\"o\">]</span> <span class=\"err\">Ω</span> <span class=\"o\">((</span><span class=\"n\">p</span> <span class=\"err\">⋀</span> <span class=\"mi\">𝟙</span><span class=\"o\">)</span> <span class=\"err\">⇔</span> <span class=\"o\">((</span><span class=\"n\">q</span> <span class=\"err\">⋀</span> <span class=\"n\">r</span> <span class=\"err\">⋀</span> <span class=\"mi\">𝟙</span><span class=\"o\">)</span> <span class=\"err\">⟹</span> <span class=\"o\">((</span><span class=\"err\">⁎</span> <span class=\"err\">≃</span> <span class=\"mi\">𝟙</span><span class=\"o\">)</span> <span class=\"err\">⋀</span> <span class=\"n\">p</span><span class=\"o\">)))</span> <span class=\"o\">:=</span>\n<span class=\"k\">begin</span>\n  <span class=\"n\">intros</span><span class=\"o\">,</span>\n  <span class=\"n\">constructor</span><span class=\"o\">,</span>\n  <span class=\"n\">constructor</span><span class=\"o\">,</span>\n  <span class=\"n\">constructor</span><span class=\"o\">,</span>\n  <span class=\"n\">assumption</span><span class=\"o\">,</span>\n  <span class=\"n\">constructor</span><span class=\"o\">,</span>\n  <span class=\"n\">simp</span><span class=\"o\">,</span>\n  <span class=\"n\">constructor</span><span class=\"o\">,</span>\n  <span class=\"n\">constructor</span><span class=\"o\">,</span>\n  <span class=\"n\">assumption</span><span class=\"o\">,</span>\n  <span class=\"n\">constructor</span><span class=\"o\">,</span>\n  <span class=\"n\">assumption</span><span class=\"o\">,</span>\n  <span class=\"n\">constructor</span><span class=\"o\">,</span>\n  <span class=\"n\">simp</span><span class=\"o\">,</span>\n  <span class=\"n\">constructor</span><span class=\"o\">,</span>\n  <span class=\"n\">constructor</span><span class=\"o\">,</span>\n  <span class=\"n\">constructor</span><span class=\"o\">,</span>\n  <span class=\"n\">constructor</span><span class=\"o\">,</span>\n  <span class=\"n\">constructor</span><span class=\"o\">,</span>\n  <span class=\"n\">constructor</span><span class=\"o\">,</span>\n  <span class=\"n\">constructor</span><span class=\"o\">,</span>\n  <span class=\"n\">simp</span><span class=\"o\">,</span>\n  <span class=\"n\">constructor</span><span class=\"o\">,</span>\n  <span class=\"n\">constructor</span><span class=\"o\">,</span>\n  <span class=\"n\">simp</span><span class=\"o\">,</span>\n  <span class=\"n\">constructor</span><span class=\"o\">,</span>\n  <span class=\"n\">simp</span><span class=\"o\">,</span>\n  <span class=\"n\">constructor</span><span class=\"o\">,</span>\n  <span class=\"n\">constructor</span><span class=\"o\">,</span>\n  <span class=\"n\">constructor</span><span class=\"o\">,</span>\n  <span class=\"n\">simp</span><span class=\"o\">,</span>\n  <span class=\"n\">constructor</span><span class=\"o\">,</span>\n  <span class=\"n\">simp</span><span class=\"o\">,</span>\n  <span class=\"n\">constructor</span><span class=\"o\">,</span>\n  <span class=\"n\">constructor</span><span class=\"o\">,</span>\n  <span class=\"n\">constructor</span><span class=\"o\">,</span>\n  <span class=\"n\">simp</span><span class=\"o\">,</span>\n  <span class=\"n\">assumption</span><span class=\"o\">,</span>\n  <span class=\"n\">sorry</span>\n<span class=\"kn\">end</span>\n</code></pre></div>",
        "id": 200198768,
        "sender_full_name": "Billy Price",
        "timestamp": 1591694091
    },
    {
        "content": "<p>Btw some of my Unicode notation is non-obvious. I'm using <code>\\And, \\Or, \\==&gt;, \\&lt;=&gt;,  \\asterisk</code> to name a few relevant ones. Also the numbers are <code>\\b0, \\b1, \\b2,</code> etc.</p>",
        "id": 200199029,
        "sender_full_name": "Billy Price",
        "timestamp": 1591694255
    },
    {
        "content": "<p>Off topic, but your <code>WF.all</code> rule looks wrong. The argument <code>A</code> is not fixed by application, so you are allowed to assume any type for it</p>",
        "id": 200199533,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1591694575
    },
    {
        "content": "<p>Your definition of <code>lib_eq</code> is also wrong, you have to lift <code>a1</code> and <code>a2</code></p>",
        "id": 200199698,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1591694702
    },
    {
        "content": "<p>the theorem itself is false, because <code>⁎ ≃ 𝟙</code> isn't well typed</p>",
        "id": 200199881,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1591694837
    },
    {
        "content": "<p>Modulo those things, this proof works:</p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"kn\">theorem</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">biimp</span> <span class=\"o\">{</span><span class=\"err\">Γ</span> <span class=\"n\">p</span> <span class=\"n\">q</span><span class=\"o\">}</span> <span class=\"o\">(</span><span class=\"n\">h1</span> <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"n\">p</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">h2</span> <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"n\">q</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"err\">⇔</span> <span class=\"n\">q</span><span class=\"o\">)</span> <span class=\"o\">:=</span>\n<span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">and</span> <span class=\"o\">(</span><span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">imp</span> <span class=\"n\">h1</span> <span class=\"n\">h2</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">imp</span> <span class=\"n\">h2</span> <span class=\"n\">h1</span><span class=\"o\">)</span>\n\n<span class=\"kn\">theorem</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">lib_eq</span> <span class=\"o\">{</span><span class=\"err\">Γ</span> <span class=\"n\">A</span> <span class=\"n\">a</span> <span class=\"n\">b</span><span class=\"o\">}</span> <span class=\"o\">(</span><span class=\"n\">h1</span> <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"n\">A</span> <span class=\"n\">a</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">h2</span> <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"n\">A</span> <span class=\"n\">b</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"err\">Γ</span> <span class=\"err\">Ω</span> <span class=\"o\">(</span><span class=\"n\">a</span> <span class=\"err\">≃</span> <span class=\"n\">b</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"n\">sorry</span>\n\n<span class=\"kn\">example</span> <span class=\"o\">(</span><span class=\"n\">hp</span> <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"o\">[</span><span class=\"n\">Unit</span><span class=\"o\">,</span><span class=\"err\">Ω</span><span class=\"o\">]</span> <span class=\"err\">Ω</span> <span class=\"n\">p</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">hq</span> <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"o\">[</span><span class=\"n\">Unit</span><span class=\"o\">,</span><span class=\"err\">Ω</span><span class=\"o\">]</span> <span class=\"err\">Ω</span> <span class=\"n\">q</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">hr</span> <span class=\"o\">:</span> <span class=\"n\">WF</span> <span class=\"o\">[</span><span class=\"n\">Unit</span><span class=\"o\">,</span><span class=\"err\">Ω</span><span class=\"o\">]</span> <span class=\"err\">Ω</span> <span class=\"n\">r</span><span class=\"o\">)</span> <span class=\"o\">:</span>\n  <span class=\"n\">WF</span> <span class=\"o\">[</span><span class=\"n\">Unit</span><span class=\"o\">,</span><span class=\"err\">Ω</span><span class=\"o\">]</span> <span class=\"err\">Ω</span> <span class=\"o\">((</span><span class=\"n\">p</span> <span class=\"err\">⋀</span> <span class=\"mi\">𝟙</span><span class=\"o\">)</span> <span class=\"err\">⇔</span> <span class=\"o\">((</span><span class=\"n\">q</span> <span class=\"err\">⋀</span> <span class=\"n\">r</span> <span class=\"err\">⋀</span> <span class=\"mi\">𝟙</span><span class=\"o\">)</span> <span class=\"err\">⟹</span> <span class=\"o\">((</span><span class=\"err\">⁎</span> <span class=\"err\">≃</span> <span class=\"mi\">𝟘</span><span class=\"o\">)</span> <span class=\"err\">⋀</span> <span class=\"n\">p</span><span class=\"o\">)))</span> <span class=\"o\">:=</span>\n<span class=\"k\">by</span> <span class=\"n\">apply_rules</span> <span class=\"o\">[</span><span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">biimp</span><span class=\"o\">,</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">and</span><span class=\"o\">,</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">imp</span><span class=\"o\">,</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">lib_eq</span><span class=\"o\">,</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">star</span><span class=\"o\">,</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">var</span><span class=\"o\">]</span><span class=\"bp\">;</span> <span class=\"n\">refl</span>\n</code></pre></div>",
        "id": 200199996,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1591694907
    },
    {
        "content": "<p>Hm, the proof works without <code>WF.biimp</code> in the list, but it is twice as long. I think there should be a reducibility setting in <code>apply_rules</code> so that it doesn't go unfold-happy</p>",
        "id": 200200450,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1591695200
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span><code><span class=\"n\">local</span> <span class=\"n\">attribute</span> <span class=\"o\">[</span><span class=\"kn\">irreducible</span><span class=\"o\">]</span> <span class=\"n\">biimp</span>\n</code></pre></div>\n\n\n<p>works, of course</p>",
        "id": 200200472,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1591695220
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110049\">Mario Carneiro</span> <a href=\"#narrow/stream/113489-new-members/topic/inductive.20proposition.20tactics/near/200199533\">said</a>:</p>\n<blockquote>\n<p>Off topic, but your <code>WF.all</code> rule looks wrong. The argument <code>A</code> is not fixed by application, so you are allowed to assume any type for it</p>\n</blockquote>\n<p>Isn't it fixed by the hypothesis that <code>\\phi</code> is well-formed in the context with <code>A</code> put at the start?</p>\n<p><span class=\"user-mention silent\" data-user-id=\"110049\">Mario Carneiro</span> <a href=\"#narrow/stream/113489-new-members/topic/inductive.20proposition.20tactics/near/200199698\">said</a>:</p>\n<blockquote>\n<p>Your definition of <code>lib_eq</code> is also wrong, you have to lift <code>a1</code> and <code>a2</code></p>\n</blockquote>\n<p>Good point, didn't think about lifting it here, I was just making do by manually lifting the variables, which is why I wrote <code>⁎ ≃ 𝟙</code>, instead of <code>⁎ ≃ 𝟘</code> - isn't that well formed?</p>",
        "id": 200200493,
        "sender_full_name": "Billy Price",
        "timestamp": 1591695232
    },
    {
        "content": "<blockquote>\n<p>Isn't it fixed by the hypothesis that \\phi is well-formed in the context with A put at the start?</p>\n</blockquote>\n<p>The problem is that the term doesn't record what <code>A</code> is, so you can have multiple types for one term. It's not exactly broken, I think they call this \"implicit typing\" and it was used by Curry I think for lambda terms, but in the modern tradition the terms carry enough typing information so that the context uniquely determines the type of the expression</p>",
        "id": 200200762,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1591695406
    },
    {
        "content": "<blockquote>\n<p>Good point, didn't think about lifting it here, I was just making do by manually lifting the variables, which is why I wrote ⁎ ≃ 𝟙, instead of ⁎ ≃ 𝟘 - isn't that well formed?</p>\n</blockquote>\n<p>Oh I see, you made = a binder. Well that's one way to solve the problem <span aria-label=\"shrug\" class=\"emoji emoji-1f937\" role=\"img\" title=\"shrug\">:shrug:</span></p>",
        "id": 200200851,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1591695470
    },
    {
        "content": "<p>Can you explain the role of the semicolon? I was under the impression it's just a new-line-separator, but it seems that there's a lot of cleanup done after apply_rules, whereas if I do this in tactic mode, I have 20 goals to apply <code>refl</code> to.</p>",
        "id": 200201298,
        "sender_full_name": "Billy Price",
        "timestamp": 1591695725
    },
    {
        "content": "<p>semicolon means \"apply next tactic to all goals generated by this tactic\"</p>",
        "id": 200201319,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1591695747
    },
    {
        "content": "<p>As an example of the bad behavior of implicit typing here, <code>∃' ∀' (𝟘 ≃ 𝟙)</code> (or with your binding equals operator, <code>∃' ∀' (𝟙 ≃ 𝟚)</code>) is well typed of type <code>Ω</code> but assuming that you can prove that <code>Unit</code> is a singleton and <code>𝒫 Unit</code> is not, this term is both provably true and provably false and hence the system is inconsistent</p>",
        "id": 200201329,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1591695756
    },
    {
        "content": "<p>The problem is that the term is vague about what type is being asserted to be a singleton</p>",
        "id": 200201457,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1591695853
    },
    {
        "content": "<p>There are only 3 goals produced by <code>apply_rules</code> in my test, which are kicked back from the <code>var</code> rule</p>",
        "id": 200201508,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1591695915
    },
    {
        "content": "<p>a less golfed version is</p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"k\">begin</span>\n  <span class=\"n\">apply_rules</span> <span class=\"o\">[</span><span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">biimp</span><span class=\"o\">,</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">and</span><span class=\"o\">,</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">imp</span><span class=\"o\">,</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">lib_eq</span><span class=\"o\">,</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">star</span><span class=\"o\">,</span> <span class=\"n\">WF</span><span class=\"bp\">.</span><span class=\"n\">var</span><span class=\"o\">],</span>\n  <span class=\"n\">all_goals</span> <span class=\"o\">{</span><span class=\"n\">refl</span><span class=\"o\">}</span>\n<span class=\"kn\">end</span>\n</code></pre></div>",
        "id": 200201572,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1591695961
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110049\">Mario Carneiro</span> <a href=\"#narrow/stream/113489-new-members/topic/inductive.20proposition.20tactics/near/200201329\">said</a>:</p>\n<blockquote>\n<p>As an example of the bad behavior of implicit typing here, <code>∃' ∀' (𝟘 ≃ 𝟙)</code> (or with your binding equals operator, <code>∃' ∀' (𝟙 ≃ 𝟚)</code>) is well typed of type <code>Ω</code> but assuming that you can prove that <code>Unit</code> is a singleton and <code>𝒫 Unit</code> is not, this term is both provably true and provably false and hence the system is inconsistent</p>\n</blockquote>\n<p>Thanks for that explanation, I forget when or why I dropped the type parameter from term.all and term.ex. Thanks for pointing that out</p>",
        "id": 200201780,
        "sender_full_name": "Billy Price",
        "timestamp": 1591696100
    },
    {
        "content": "<p>I recall you had a lot more types before (on things like application) and I think I pointed out that they were not necessary</p>",
        "id": 200201852,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1591696150
    },
    {
        "content": "<p>The place where you need types are when you are introducing a new type variable that can't be inferred from the arguments</p>",
        "id": 200201913,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1591696196
    },
    {
        "content": "<p>Yeah I must have taken that too far haha</p>",
        "id": 200201918,
        "sender_full_name": "Billy Price",
        "timestamp": 1591696200
    },
    {
        "content": "<p>R.e. apply_rules, can I be lazy with it and tell it to try all of the rules? Like everything starting with <code>WF.</code>?</p>",
        "id": 200202090,
        "sender_full_name": "Billy Price",
        "timestamp": 1591696300
    },
    {
        "content": "<p>I think there is a way to make sets of rules for it</p>",
        "id": 200202272,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1591696409
    },
    {
        "content": "<p>the <code>apply_rules</code> documentation has an example</p>",
        "id": 200202352,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1591696448
    },
    {
        "content": "<p><a href=\"https://leanprover-community.github.io/mathlib_docs/tactics.html#apply_rules\">tactic#apply_rules</a></p>",
        "id": 200202473,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1591696535
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110049\">Mario Carneiro</span> <a href=\"#narrow/stream/113489-new-members/topic/inductive.20proposition.20tactics/near/200201913\">said</a>:</p>\n<blockquote>\n<p>The place where you need types are when you are introducing a new type variable that can't be inferred from the arguments</p>\n</blockquote>\n<p>Does this mean that <code>term.comp</code> doesn't need an explicit type parameter, because the WF constructor<code> | comp {Γ A φ}     : WF (A::Γ) Ω φ → WF Γ (𝒫 A) term.comp φ</code> tells you the type of the variable free in phi?</p>",
        "id": 200202481,
        "sender_full_name": "Billy Price",
        "timestamp": 1591696540
    },
    {
        "content": "<p>To be honest I don't quite understand what exact kind of situation you are referring to in \"when you are introducing a new type variable\". Is this strictly just when defining WF?</p>",
        "id": 200202768,
        "sender_full_name": "Billy Price",
        "timestamp": 1591696698
    },
    {
        "content": "<p>No, I think <code>comp</code> needs a type</p>",
        "id": 200202900,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1591696787
    },
    {
        "content": "<p>An easy rule is anything with a binder (where the hypothesis to the <code>WF</code> rule has an extended context) needs a type</p>",
        "id": 200203032,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1591696838
    },
    {
        "content": "<p>The general form of the claim would be that any term <code>p</code> has at most one type given a context <code>Gamma</code></p>",
        "id": 200203108,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1591696883
    },
    {
        "content": "<p>and I think you can even claim at most one type derivation</p>",
        "id": 200203138,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1591696907
    },
    {
        "content": "<p>That's very eye opening thank you. I was just here thinking \"my terms seem so freely defined - but my proof constraints are enough to allow you to only prove true statements when you choose appropriate types for each term\"</p>",
        "id": 200203389,
        "sender_full_name": "Billy Price",
        "timestamp": 1591697066
    },
    {
        "content": "<p>If I have more related questions I'll continue them back in my usual channel/topic. I just thought my original question was general enough.</p>",
        "id": 200203443,
        "sender_full_name": "Billy Price",
        "timestamp": 1591697122
    },
    {
        "content": "<p>the problem is that the terms are responsible for carrying type assignments from one line of proof to the next, so if they are too free then you can interpret the same term in two incompatible ways during the same proof</p>",
        "id": 200203472,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1591697143
    },
    {
        "content": "<p>proofs are irrelevant but terms aren't</p>",
        "id": 200203537,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1591697172
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"110049\">@Mario Carneiro</span>  I've just noticed that my <code>elem : term -&gt; term -&gt; term</code> constructor doesn't have a <code>type</code> in the contstructor. It's <code>WF</code> rule does not extend the context, yet a term like <code>0 \\in 1</code> doesn't tell me the types of 0 or 1 (though I can't think of an example term that's true with one type and false with another). Why is this different?</p>\n<p>I noticed this because for all other term constructors I have a corresponding lemma which extracts a well-formedness proof of each argument, but I can't write one that does <code>WF Γ Ω (a∈α) → WF Γ A a</code>, because I can't presume to know <code>A</code>. This tempts me to add a type to the elem constructor - but is there a reason I shouldn't?</p>",
        "id": 204069666,
        "sender_full_name": "Billy Price",
        "timestamp": 1594897452
    }
]