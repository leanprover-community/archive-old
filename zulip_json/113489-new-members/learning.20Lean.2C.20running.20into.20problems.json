[
    {
        "content": "<p>I've worked through some tutorials and read some documentation and I'm excited about Lean. Whenever I try to do something non-trivial by myself, I run into problems. Here's an example. I'm trying to define a dg-category (this is mostly an education exercise for me. but I didn't see this in mathlib, yet either, so maybe I can contribute eventually):</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kn\">import</span> <span class=\"n\">algebra.category.Module.basic</span>\n<span class=\"kn\">import</span> <span class=\"n\">algebra.homology.chain_complex</span>\n\n<span class=\"kn\">open</span> <span class=\"n\">category_theory</span>\n\n<span class=\"kd\">universes</span> <span class=\"n\">v</span> <span class=\"n\">u</span>\n\n<span class=\"kd\">variables</span> <span class=\"o\">(</span><span class=\"n\">C</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span> <span class=\"n\">u</span><span class=\"o\">)</span>\n\n<span class=\"kd\">class</span> <span class=\"n\">dgcat</span> <span class=\"o\">:=</span>\n  <span class=\"o\">(</span><span class=\"n\">hom</span> <span class=\"o\">:</span> <span class=\"bp\">Π</span> <span class=\"n\">P</span> <span class=\"n\">Q</span> <span class=\"o\">:</span> <span class=\"n\">C</span><span class=\"o\">,</span> <span class=\"o\">(</span><span class=\"n\">cochain_complex</span> <span class=\"o\">(</span><span class=\"n\">Module</span><span class=\"o\">(</span><span class=\"n\">ℚ</span><span class=\"o\">))))</span>\n  <span class=\"o\">(</span><span class=\"n\">comp</span><span class=\"o\">:</span> <span class=\"bp\">Π</span> <span class=\"o\">{</span><span class=\"n\">P</span> <span class=\"n\">Q</span> <span class=\"n\">R</span><span class=\"o\">:</span> <span class=\"n\">C</span><span class=\"o\">}</span> <span class=\"o\">{</span><span class=\"n\">i</span> <span class=\"n\">j</span> <span class=\"o\">:</span> <span class=\"n\">ℤ</span><span class=\"o\">},</span> <span class=\"o\">(</span><span class=\"n\">hom</span> <span class=\"n\">Q</span> <span class=\"n\">R</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">X</span> <span class=\"n\">i</span> <span class=\"bp\">-&gt;</span> <span class=\"o\">(</span><span class=\"n\">hom</span> <span class=\"n\">P</span> <span class=\"n\">Q</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">X</span> <span class=\"n\">j</span> <span class=\"bp\">-&gt;</span> <span class=\"o\">(</span><span class=\"n\">hom</span> <span class=\"n\">P</span> <span class=\"n\">R</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">X</span> <span class=\"o\">(</span><span class=\"n\">i</span><span class=\"bp\">+</span><span class=\"n\">j</span><span class=\"o\">))</span>\n  <span class=\"o\">(</span><span class=\"n\">id</span> <span class=\"o\">:</span> <span class=\"bp\">Π</span> <span class=\"n\">P</span> <span class=\"o\">:</span> <span class=\"n\">C</span><span class=\"o\">,</span> <span class=\"o\">(</span><span class=\"n\">hom</span> <span class=\"n\">P</span> <span class=\"n\">P</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">X</span> <span class=\"mi\">0</span><span class=\"o\">)</span>\n  <span class=\"o\">(</span><span class=\"n\">leibnitz</span><span class=\"o\">:</span> <span class=\"bp\">Π</span> <span class=\"o\">(</span><span class=\"n\">P</span> <span class=\"n\">Q</span> <span class=\"n\">R</span><span class=\"o\">:</span> <span class=\"n\">C</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">i</span> <span class=\"n\">j</span> <span class=\"o\">:</span> <span class=\"n\">ℤ</span><span class=\"o\">)</span>  <span class=\"o\">(</span><span class=\"n\">g</span><span class=\"o\">:</span> <span class=\"o\">(</span><span class=\"n\">hom</span> <span class=\"n\">Q</span> <span class=\"n\">R</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">X</span> <span class=\"n\">i</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">f</span> <span class=\"o\">:</span> <span class=\"o\">(</span><span class=\"n\">hom</span> <span class=\"n\">P</span> <span class=\"n\">Q</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">X</span> <span class=\"n\">j</span><span class=\"o\">),</span>\n    <span class=\"o\">(</span><span class=\"n\">hom</span> <span class=\"n\">P</span> <span class=\"n\">R</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">d</span> <span class=\"o\">(</span><span class=\"n\">i</span><span class=\"bp\">+</span><span class=\"n\">j</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">comp</span> <span class=\"n\">g</span> <span class=\"n\">f</span><span class=\"o\">)</span> <span class=\"bp\">=</span> <span class=\"n\">comp</span> <span class=\"o\">((</span><span class=\"n\">hom</span> <span class=\"n\">Q</span> <span class=\"n\">R</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">d</span> <span class=\"n\">i</span> <span class=\"n\">g</span><span class=\"o\">)</span> <span class=\"n\">f</span> <span class=\"bp\">+</span> <span class=\"o\">(</span><span class=\"bp\">-</span><span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"bp\">^</span><span class=\"n\">i</span> <span class=\"bp\">*</span> <span class=\"n\">comp</span> <span class=\"n\">g</span> <span class=\"o\">((</span><span class=\"n\">hom</span> <span class=\"n\">P</span> <span class=\"n\">Q</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">d</span> <span class=\"n\">j</span> <span class=\"n\">f</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>The last property of the class does not check out. If I comment it out and put</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kd\">variables</span> <span class=\"o\">(</span><span class=\"n\">D</span><span class=\"o\">:</span><span class=\"kt\">Type</span> <span class=\"n\">u</span><span class=\"o\">)</span> <span class=\"o\">[</span><span class=\"n\">dgcat</span> <span class=\"n\">D</span><span class=\"o\">]</span>\n<span class=\"kd\">variables</span> <span class=\"n\">P</span> <span class=\"n\">Q</span> <span class=\"n\">R</span><span class=\"o\">:</span> <span class=\"n\">D</span>\n<span class=\"kd\">variables</span> <span class=\"n\">i</span> <span class=\"n\">j</span> <span class=\"o\">:</span> <span class=\"n\">ℤ</span>\n<span class=\"kd\">variable</span> <span class=\"o\">(</span><span class=\"n\">g</span><span class=\"o\">:</span> <span class=\"o\">(</span><span class=\"n\">dgcat.hom</span> <span class=\"n\">Q</span> <span class=\"n\">R</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">X</span> <span class=\"n\">i</span><span class=\"o\">)</span>\n<span class=\"kd\">variable</span> <span class=\"o\">(</span><span class=\"n\">f</span> <span class=\"o\">:</span> <span class=\"o\">(</span><span class=\"n\">dgcat.hom</span> <span class=\"n\">P</span> <span class=\"n\">Q</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">X</span> <span class=\"n\">j</span><span class=\"o\">)</span>\n\n<span class=\"k\">#check</span> <span class=\"o\">(</span><span class=\"n\">dgcat.hom</span> <span class=\"n\">P</span> <span class=\"n\">R</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">d</span> <span class=\"o\">(</span><span class=\"n\">i</span><span class=\"bp\">+</span><span class=\"n\">j</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">dgcat.comp</span> <span class=\"n\">g</span> <span class=\"n\">f</span><span class=\"o\">)</span>\n\n<span class=\"k\">#check</span> <span class=\"n\">dgcat.comp</span> <span class=\"o\">((</span><span class=\"n\">dgcat.hom</span> <span class=\"n\">Q</span> <span class=\"n\">R</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">d</span> <span class=\"n\">i</span> <span class=\"n\">g</span><span class=\"o\">)</span> <span class=\"n\">f</span>\n\n<span class=\"k\">#check</span> <span class=\"n\">dgcat.comp</span> <span class=\"n\">g</span> <span class=\"o\">((</span><span class=\"n\">dgcat.hom</span> <span class=\"n\">P</span> <span class=\"n\">Q</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">d</span> <span class=\"n\">j</span> <span class=\"n\">f</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>then you can see why. Lean doesn't recognize these as the same type, even though they should be living in (hom P R) (i+j+1). The types are given by</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"bp\">⇑</span><span class=\"o\">((</span><span class=\"n\">dgcat.hom</span> <span class=\"n\">P</span> <span class=\"n\">R</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">d</span> <span class=\"o\">(</span><span class=\"n\">i</span> <span class=\"bp\">+</span> <span class=\"n\">j</span><span class=\"o\">))</span> <span class=\"o\">(</span><span class=\"n\">dgcat.comp</span> <span class=\"n\">g</span> <span class=\"n\">f</span><span class=\"o\">)</span> <span class=\"o\">:</span>\n  <span class=\"bp\">↥</span><span class=\"o\">((</span><span class=\"n\">shift</span> <span class=\"o\">(</span><span class=\"n\">graded_object_with_shift</span> <span class=\"mi\">1</span> <span class=\"o\">(</span><span class=\"n\">Module</span> <span class=\"n\">ℚ</span><span class=\"o\">))</span> <span class=\"bp\">^</span> <span class=\"mi\">1</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">functor.obj</span> <span class=\"o\">(</span><span class=\"n\">dgcat.hom</span> <span class=\"n\">P</span> <span class=\"n\">R</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">X</span> <span class=\"o\">(</span><span class=\"n\">i</span> <span class=\"bp\">+</span> <span class=\"n\">j</span><span class=\"o\">))</span>\n\n<span class=\"n\">dgcat.comp</span> <span class=\"o\">(</span><span class=\"bp\">⇑</span><span class=\"o\">((</span><span class=\"n\">dgcat.hom</span> <span class=\"n\">Q</span> <span class=\"n\">R</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">d</span> <span class=\"n\">i</span><span class=\"o\">)</span> <span class=\"n\">g</span><span class=\"o\">)</span> <span class=\"n\">f</span> <span class=\"o\">:</span>\n  <span class=\"bp\">↥</span><span class=\"o\">((</span><span class=\"n\">dgcat.hom</span> <span class=\"n\">P</span> <span class=\"n\">R</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">X</span>\n       <span class=\"o\">(</span><span class=\"bp\">⇑</span><span class=\"o\">({</span><span class=\"n\">to_fun</span> <span class=\"o\">:=</span> <span class=\"bp\">λ</span> <span class=\"o\">(</span><span class=\"n\">b</span> <span class=\"o\">:</span> <span class=\"n\">ℤ</span><span class=\"o\">),</span> <span class=\"n\">b</span> <span class=\"bp\">-</span> <span class=\"mi\">1</span><span class=\"o\">,</span> <span class=\"n\">inv_fun</span> <span class=\"o\">:=</span> <span class=\"bp\">λ</span> <span class=\"o\">(</span><span class=\"n\">b</span> <span class=\"o\">:</span> <span class=\"n\">ℤ</span><span class=\"o\">),</span> <span class=\"n\">b</span> <span class=\"bp\">+</span> <span class=\"mi\">1</span><span class=\"o\">,</span> <span class=\"n\">left_inv</span> <span class=\"o\">:=</span> <span class=\"n\">_</span><span class=\"o\">,</span> <span class=\"n\">right_inv</span> <span class=\"o\">:=</span> <span class=\"n\">_</span><span class=\"o\">}</span><span class=\"bp\">.</span><span class=\"n\">symm</span><span class=\"o\">)</span> <span class=\"n\">i</span> <span class=\"bp\">+</span> <span class=\"n\">j</span><span class=\"o\">))</span>\n\n<span class=\"n\">dgcat.comp</span> <span class=\"n\">g</span> <span class=\"o\">(</span><span class=\"bp\">⇑</span><span class=\"o\">((</span><span class=\"n\">dgcat.hom</span> <span class=\"n\">P</span> <span class=\"n\">Q</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">d</span> <span class=\"n\">j</span><span class=\"o\">)</span> <span class=\"n\">f</span><span class=\"o\">)</span> <span class=\"o\">:</span>\n  <span class=\"bp\">↥</span><span class=\"o\">((</span><span class=\"n\">dgcat.hom</span> <span class=\"n\">P</span> <span class=\"n\">R</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">X</span>\n       <span class=\"o\">(</span><span class=\"n\">i</span> <span class=\"bp\">+</span> <span class=\"bp\">⇑</span><span class=\"o\">({</span><span class=\"n\">to_fun</span> <span class=\"o\">:=</span> <span class=\"bp\">λ</span> <span class=\"o\">(</span><span class=\"n\">b</span> <span class=\"o\">:</span> <span class=\"n\">ℤ</span><span class=\"o\">),</span> <span class=\"n\">b</span> <span class=\"bp\">-</span> <span class=\"mi\">1</span><span class=\"o\">,</span> <span class=\"n\">inv_fun</span> <span class=\"o\">:=</span> <span class=\"bp\">λ</span> <span class=\"o\">(</span><span class=\"n\">b</span> <span class=\"o\">:</span> <span class=\"n\">ℤ</span><span class=\"o\">),</span> <span class=\"n\">b</span> <span class=\"bp\">+</span> <span class=\"mi\">1</span><span class=\"o\">,</span> <span class=\"n\">left_inv</span> <span class=\"o\">:=</span> <span class=\"n\">_</span><span class=\"o\">,</span> <span class=\"n\">right_inv</span> <span class=\"o\">:=</span> <span class=\"n\">_</span><span class=\"o\">}</span><span class=\"bp\">.</span><span class=\"n\">symm</span><span class=\"o\">)</span> <span class=\"n\">j</span><span class=\"o\">))</span>\n</code></pre></div>\n<p>What do the various up pointing arrows mean? Is there a way I can make this work? Thank you for any hints!</p>",
        "id": 220055613,
        "sender_full_name": "Drew Johnson",
        "timestamp": 1608073171
    },
    {
        "content": "<p>The arrows are different types of coercions; you can read more about them in <a href=\"https://leanprover.github.io/theorem_proving_in_lean/type_classes.html#coercions-using-type-classes\">Section 10.6 of TPiL</a>.</p>",
        "id": 220055749,
        "sender_full_name": "Bryan Gin-ge Chen",
        "timestamp": 1608073242
    },
    {
        "content": "<p>Thanks! I'll read up on that.</p>",
        "id": 220055843,
        "sender_full_name": "Drew Johnson",
        "timestamp": 1608073301
    },
    {
        "content": "<p>You should check out this old thread on cdgas <a href=\"#narrow/stream/116395-maths/topic/CDGAs/near/167848869\">https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/CDGAs/near/167848869</a> . It's quite possible you are running into this classic problem with this sort of maths in leans type theory, where you can prove the indices are equal, but they are not equal by definition so lean will not treat them as terms of the same type</p>",
        "id": 220056974,
        "sender_full_name": "Alex J. Best",
        "timestamp": 1608073953
    },
    {
        "content": "<p>And also see <a href=\"#narrow/stream/116395-maths/topic/tensor.20algebras.20and.20a.20construction/near/214985046\">https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/tensor.20algebras.20and.20a.20construction/near/214985046</a></p>",
        "id": 220057111,
        "sender_full_name": "Alex J. Best",
        "timestamp": 1608074046
    },
    {
        "content": "<p>Thank you! I think that was exactly the issue I was running into.</p>",
        "id": 220147989,
        "sender_full_name": "Drew Johnson",
        "timestamp": 1608140669
    }
]