[
    {
        "content": "<p>Hi all,</p>\n<p>Noob question: I am trying to prove some elementary results in number theory to get more practice with Lean proof writing. I feel that some generic tactic should kill this MWE, but I can't seem to find it:</p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"kn\">import</span> <span class=\"n\">group_theory</span><span class=\"bp\">.</span><span class=\"n\">subgroup</span>\n<span class=\"kn\">import</span> <span class=\"n\">tactic</span>\n\n<span class=\"n\">open_locale</span> <span class=\"n\">classical</span> <span class=\"n\">big_operators</span>\n\n<span class=\"kn\">lemma</span> <span class=\"n\">blah</span> <span class=\"o\">{</span><span class=\"n\">G</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span> <span class=\"o\">[</span><span class=\"n\">comm_group</span> <span class=\"n\">G</span><span class=\"o\">]</span> <span class=\"o\">[</span><span class=\"n\">fintype</span> <span class=\"n\">G</span><span class=\"o\">]:</span>\n<span class=\"o\">(</span><span class=\"err\">∏</span> <span class=\"n\">g</span> <span class=\"o\">:</span> <span class=\"n\">G</span><span class=\"o\">,</span> <span class=\"n\">g</span><span class=\"o\">)</span> <span class=\"bp\">=</span> <span class=\"o\">(</span><span class=\"err\">∏</span> <span class=\"n\">g</span> <span class=\"k\">in</span> <span class=\"o\">{</span><span class=\"n\">g</span> <span class=\"o\">:</span> <span class=\"n\">G</span> <span class=\"bp\">|</span> <span class=\"n\">true</span><span class=\"o\">}</span><span class=\"bp\">.</span><span class=\"n\">to_finset</span><span class=\"o\">,</span> <span class=\"n\">g</span><span class=\"o\">)</span> <span class=\"o\">:=</span>\n<span class=\"k\">begin</span>\n  <span class=\"n\">sorry</span><span class=\"o\">,</span>\n<span class=\"kn\">end</span>\n</code></pre></div>\n\n\n<p>Thanks in advance for any help...</p>",
        "id": 202693896,
        "sender_full_name": "Marc Masdeu",
        "timestamp": 1593699283
    },
    {
        "content": "<p><code>congr, ext, simp</code></p>",
        "id": 202695480,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1593700018
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"254058\">@Marc Masdeu</span> Hi, welcome back. (Have you seen <a href=\"https://leanprover-community.github.io/lftcm2020/\">https://leanprover-community.github.io/lftcm2020/</a>)<br>\nOoh, Mario is faster with answering the actual question <span aria-label=\"oops\" class=\"emoji emoji-1f643\" role=\"img\" title=\"oops\">:oops:</span></p>",
        "id": 202695519,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1593700043
    },
    {
        "content": "<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"254058\">Marc Masdeu</span> Hi, welcome back. (Have you seen <a href=\"https://leanprover-community.github.io/lftcm2020/\">https://leanprover-community.github.io/lftcm2020/</a>)</p>\n</blockquote>\n<p>Thanks <span class=\"user-mention\" data-user-id=\"112680\">@Johan Commelin</span>, I've been following everything Lean, just not posting to here... I know about the workshop, but sadly I'll be \"away\" next week...</p>",
        "id": 202696382,
        "sender_full_name": "Marc Masdeu",
        "timestamp": 1593700418
    },
    {
        "content": "<p>Ok, no worries!</p>",
        "id": 202696514,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1593700460
    },
    {
        "content": "<p>OK, turns out that the MWE I constructed was too M (but thanks <span class=\"user-mention\" data-user-id=\"110049\">@Mario Carneiro</span> ! I did learn about congr!). Here's an updated one, hopefully it is enough now:</p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"n\">def</span> <span class=\"n\">some_subgroup</span> <span class=\"o\">(</span><span class=\"n\">G</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">)[</span><span class=\"n\">comm_group</span> <span class=\"n\">G</span><span class=\"o\">]</span> <span class=\"o\">:</span> <span class=\"n\">subgroup</span> <span class=\"n\">G</span> <span class=\"o\">:=</span> <span class=\"n\">sorry</span>\n\n<span class=\"kn\">lemma</span> <span class=\"n\">blah2</span> <span class=\"o\">{</span><span class=\"n\">G</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span> <span class=\"o\">[</span><span class=\"n\">comm_group</span> <span class=\"n\">G</span><span class=\"o\">]</span> <span class=\"o\">[</span><span class=\"n\">fintype</span> <span class=\"n\">G</span><span class=\"o\">]:</span>\n<span class=\"o\">(</span><span class=\"err\">∏</span> <span class=\"o\">(</span><span class=\"n\">x</span> <span class=\"o\">:</span> <span class=\"n\">G</span><span class=\"o\">)</span> <span class=\"k\">in</span> <span class=\"o\">{</span><span class=\"n\">x</span> <span class=\"o\">:</span> <span class=\"n\">G</span> <span class=\"bp\">|</span> <span class=\"n\">x</span> <span class=\"err\">∈</span> <span class=\"n\">some_subgroup</span> <span class=\"n\">G</span><span class=\"o\">}</span><span class=\"bp\">.</span><span class=\"n\">to_finset</span><span class=\"o\">,</span> <span class=\"n\">x</span><span class=\"o\">)</span> <span class=\"bp\">=</span>\n    <span class=\"err\">∏</span> <span class=\"o\">(</span><span class=\"n\">g</span> <span class=\"o\">:</span> <span class=\"err\">↥</span><span class=\"o\">(</span><span class=\"n\">some_subgroup</span> <span class=\"n\">G</span><span class=\"o\">)),</span> <span class=\"err\">↑</span><span class=\"n\">g</span> <span class=\"o\">:=</span>\n<span class=\"k\">begin</span>\n    <span class=\"n\">sorry</span><span class=\"o\">,</span>\n<span class=\"kn\">end</span>\n</code></pre></div>",
        "id": 202698689,
        "sender_full_name": "Marc Masdeu",
        "timestamp": 1593701415
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span><code><span class=\"n\">apply</span> <span class=\"n\">finset</span><span class=\"bp\">.</span><span class=\"n\">prod_congr</span> <span class=\"c1\">--?</span>\n</code></pre></div>",
        "id": 202699051,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1593701580
    },
    {
        "content": "<p>It complains with</p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"n\">invalid</span> <span class=\"n\">apply</span> <span class=\"n\">tactic</span><span class=\"o\">,</span> <span class=\"n\">failed</span> <span class=\"n\">to</span> <span class=\"n\">unify</span>\n  <span class=\"err\">∏</span> <span class=\"o\">(</span><span class=\"n\">x</span> <span class=\"o\">:</span> <span class=\"n\">G</span><span class=\"o\">)</span> <span class=\"k\">in</span> <span class=\"o\">{</span><span class=\"n\">x</span> <span class=\"o\">:</span> <span class=\"n\">G</span> <span class=\"bp\">|</span> <span class=\"n\">x</span> <span class=\"err\">∈</span> <span class=\"n\">some_subgroup</span> <span class=\"n\">G</span><span class=\"o\">}</span><span class=\"bp\">.</span><span class=\"n\">to_finset</span><span class=\"o\">,</span> <span class=\"n\">x</span> <span class=\"bp\">=</span> <span class=\"err\">∏</span> <span class=\"o\">(</span><span class=\"n\">g</span> <span class=\"o\">:</span> <span class=\"err\">↥</span><span class=\"o\">(</span><span class=\"n\">some_subgroup</span> <span class=\"n\">G</span><span class=\"o\">)),</span> <span class=\"err\">↑</span><span class=\"n\">g</span>\n<span class=\"k\">with</span>\n  <span class=\"err\">?</span><span class=\"n\">m_4</span><span class=\"bp\">.</span><span class=\"n\">prod</span> <span class=\"err\">?</span><span class=\"n\">m_5</span> <span class=\"bp\">=</span> <span class=\"err\">?</span><span class=\"n\">m_6</span><span class=\"bp\">.</span><span class=\"n\">prod</span> <span class=\"err\">?</span><span class=\"n\">m_7</span>\n</code></pre></div>",
        "id": 202699543,
        "sender_full_name": "Marc Masdeu",
        "timestamp": 1593701834
    },
    {
        "content": "<p>Aah, of course</p>",
        "id": 202699597,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1593701872
    },
    {
        "content": "<p>The rhs is over some subgroup.</p>",
        "id": 202699620,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1593701881
    },
    {
        "content": "<p><code>rw finset.prod_subtype</code>?</p>",
        "id": 202699676,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1593701888
    },
    {
        "content": "<p>If all else fails, there is <code>finset.prod_bij</code> but I would try to avoid that.</p>",
        "id": 202699739,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1593701922
    },
    {
        "content": "<p><code>finset.prod_subtype</code> does not seem to exists...</p>",
        "id": 202699968,
        "sender_full_name": "Marc Masdeu",
        "timestamp": 1593702020
    },
    {
        "content": "<p><code>import data.fintype.card</code>? I think</p>",
        "id": 202700011,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1593702038
    },
    {
        "content": "<p>This has worked:</p>\n<div class=\"codehilite\"><pre><span></span><code>    <span class=\"n\">rw</span> <span class=\"n\">finset</span><span class=\"bp\">.</span><span class=\"n\">prod_subtype</span><span class=\"o\">,</span>\n    <span class=\"n\">tauto</span><span class=\"o\">,</span>\n    <span class=\"n\">finish</span><span class=\"o\">,</span>\n</code></pre></div>\n\n\n<p>Leaving me with no idea of what's going on, of course...</p>",
        "id": 202700424,
        "sender_full_name": "Marc Masdeu",
        "timestamp": 1593702242
    },
    {
        "content": "<p><code>prod_subtype</code> is missing</p>",
        "id": 202700668,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1593702353
    },
    {
        "content": "<p>oops, misread Johan's suggestion. This proof might be a little clearer:</p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"kn\">lemma</span> <span class=\"n\">blah2</span> <span class=\"o\">{</span><span class=\"n\">G</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span> <span class=\"o\">[</span><span class=\"n\">comm_group</span> <span class=\"n\">G</span><span class=\"o\">]</span> <span class=\"o\">[</span><span class=\"n\">fintype</span> <span class=\"n\">G</span><span class=\"o\">]:</span>\n<span class=\"o\">(</span><span class=\"err\">∏</span> <span class=\"o\">(</span><span class=\"n\">x</span> <span class=\"o\">:</span> <span class=\"n\">G</span><span class=\"o\">)</span> <span class=\"k\">in</span> <span class=\"o\">{</span><span class=\"n\">x</span> <span class=\"o\">:</span> <span class=\"n\">G</span> <span class=\"bp\">|</span> <span class=\"n\">x</span> <span class=\"err\">∈</span> <span class=\"n\">some_subgroup</span> <span class=\"n\">G</span><span class=\"o\">}</span><span class=\"bp\">.</span><span class=\"n\">to_finset</span><span class=\"o\">,</span> <span class=\"n\">x</span><span class=\"o\">)</span> <span class=\"bp\">=</span>\n    <span class=\"err\">∏</span> <span class=\"o\">(</span><span class=\"n\">g</span> <span class=\"o\">:</span> <span class=\"err\">↥</span><span class=\"o\">(</span><span class=\"n\">some_subgroup</span> <span class=\"n\">G</span><span class=\"o\">)),</span> <span class=\"err\">↑</span><span class=\"n\">g</span> <span class=\"o\">:=</span>\n<span class=\"k\">begin</span>\n  <span class=\"n\">apply</span> <span class=\"n\">finset</span><span class=\"bp\">.</span><span class=\"n\">prod_subtype</span><span class=\"o\">,</span>\n  <span class=\"n\">simp</span><span class=\"o\">,</span> <span class=\"n\">exact</span> <span class=\"bp\">λ</span> <span class=\"bp\">_</span><span class=\"o\">,</span> <span class=\"n\">iff</span><span class=\"bp\">.</span><span class=\"n\">rfl</span>\n<span class=\"kn\">end</span>\n</code></pre></div>",
        "id": 202701438,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1593702699
    },
    {
        "content": "<p>Unfortunately the unification problem leaves <code>has_coe_t_aux.coe</code> in the term, and <code>simp</code> doesn't know how to simplify it, so we have to finish with <code>iff.rfl</code> instead</p>",
        "id": 202701636,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1593702788
    },
    {
        "content": "<p>Here is what I have managed to prove: given a finite commutative group G, the product of all its elements equals the product of its elements of order 2. This could be seen as some sort of generalization of Wilson's theorem on the factorial of p-1 modulo p.</p>\n<p>Now I know that this is terrible coding style, especially the proof of <code>prod_all_eq_prod_two_torsion</code>. I would appreciate a constructive critique of it. I am not looking for anything mathlib-ready at all, and in fact I'm happy with expensive tactics (to prove mathematically obvious statements) as long as it stays somewhat readable...</p>\n<p>Thanks!</p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"kn\">import</span> <span class=\"n\">group_theory</span><span class=\"bp\">.</span><span class=\"n\">subgroup</span>\n<span class=\"kn\">import</span> <span class=\"n\">data</span><span class=\"bp\">.</span><span class=\"n\">fintype</span><span class=\"bp\">.</span><span class=\"n\">card</span>\n<span class=\"kn\">import</span> <span class=\"n\">data</span><span class=\"bp\">.</span><span class=\"n\">set</span><span class=\"bp\">.</span><span class=\"n\">finite</span>\n<span class=\"kn\">import</span> <span class=\"n\">tactic</span>\n\n<span class=\"n\">open_locale</span> <span class=\"n\">classical</span> <span class=\"n\">big_operators</span>\n\n<span class=\"kn\">lemma</span> <span class=\"n\">prod_finset_distinct_inv</span> <span class=\"o\">{</span><span class=\"n\">α</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span> <span class=\"o\">[</span><span class=\"n\">comm_group</span> <span class=\"n\">α</span><span class=\"o\">]</span> <span class=\"o\">{</span><span class=\"n\">s</span> <span class=\"o\">:</span> <span class=\"n\">finset</span> <span class=\"n\">α</span><span class=\"o\">}</span> <span class=\"o\">:</span>\n  <span class=\"o\">(</span><span class=\"bp\">∀</span> <span class=\"n\">x</span> <span class=\"err\">∈</span> <span class=\"n\">s</span><span class=\"o\">,</span> <span class=\"n\">x</span><span class=\"bp\">⁻¹</span> <span class=\"err\">∈</span> <span class=\"n\">s</span><span class=\"o\">)</span> <span class=\"bp\">→</span> <span class=\"o\">(</span><span class=\"bp\">∀</span> <span class=\"n\">x</span> <span class=\"err\">∈</span> <span class=\"n\">s</span><span class=\"o\">,</span> <span class=\"n\">x</span><span class=\"bp\">⁻¹</span> <span class=\"bp\">≠</span> <span class=\"n\">x</span><span class=\"o\">)</span> <span class=\"bp\">→</span> <span class=\"o\">(</span><span class=\"err\">∏</span> <span class=\"n\">x</span> <span class=\"k\">in</span> <span class=\"n\">s</span><span class=\"o\">,</span> <span class=\"n\">x</span><span class=\"o\">)</span> <span class=\"bp\">=</span> <span class=\"mi\">1</span> <span class=\"o\">:=</span>\n<span class=\"k\">begin</span>\n<span class=\"n\">apply</span> <span class=\"n\">finset</span><span class=\"bp\">.</span><span class=\"n\">case_strong_induction_on</span> <span class=\"n\">s</span><span class=\"o\">,</span> <span class=\"k\">by</span> <span class=\"n\">tauto</span><span class=\"o\">,</span>\n<span class=\"n\">intros</span> <span class=\"n\">a</span> <span class=\"n\">s</span> <span class=\"n\">a_notin_s</span> <span class=\"n\">H</span> <span class=\"n\">h1</span> <span class=\"n\">h2</span><span class=\"o\">,</span>\n<span class=\"n\">specialize</span> <span class=\"n\">H</span> <span class=\"o\">(</span><span class=\"n\">finset</span><span class=\"bp\">.</span><span class=\"n\">erase</span> <span class=\"n\">s</span> <span class=\"n\">a</span><span class=\"bp\">⁻¹</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">finset</span><span class=\"bp\">.</span><span class=\"n\">erase_subset</span> <span class=\"o\">(</span><span class=\"n\">a</span><span class=\"bp\">⁻¹</span><span class=\"o\">)</span> <span class=\"n\">s</span><span class=\"o\">),</span>\n<span class=\"k\">have</span> <span class=\"n\">r</span> <span class=\"o\">:</span> <span class=\"o\">(</span><span class=\"err\">∏</span> <span class=\"n\">x</span> <span class=\"k\">in</span> <span class=\"o\">(</span><span class=\"n\">finset</span><span class=\"bp\">.</span><span class=\"n\">erase</span> <span class=\"n\">s</span> <span class=\"n\">a</span><span class=\"bp\">⁻¹</span><span class=\"o\">),</span> <span class=\"n\">x</span><span class=\"o\">)</span> <span class=\"bp\">=</span> <span class=\"mi\">1</span><span class=\"o\">,</span>\n<span class=\"o\">{</span>\n  <span class=\"n\">apply</span> <span class=\"n\">H</span><span class=\"o\">,</span>\n  <span class=\"o\">{</span>\n    <span class=\"n\">intros</span> <span class=\"n\">x</span> <span class=\"n\">h</span><span class=\"o\">,</span>\n    <span class=\"n\">suffices</span> <span class=\"o\">:</span> <span class=\"bp\">¬</span><span class=\"n\">x</span> <span class=\"bp\">=</span> <span class=\"n\">a</span> <span class=\"bp\">∧</span> <span class=\"n\">x</span><span class=\"bp\">⁻¹</span> <span class=\"err\">∈</span> <span class=\"n\">s</span><span class=\"o\">,</span> <span class=\"k\">by</span> <span class=\"n\">simpa</span><span class=\"o\">,</span>\n    <span class=\"n\">split</span><span class=\"o\">,</span>\n    <span class=\"n\">clarify</span><span class=\"o\">,</span>\n    <span class=\"n\">suffices</span> <span class=\"o\">:</span> <span class=\"n\">x</span><span class=\"bp\">⁻¹</span> <span class=\"bp\">≠</span> <span class=\"n\">a</span><span class=\"o\">,</span> <span class=\"k\">by</span> <span class=\"n\">finish</span><span class=\"o\">,</span>\n    <span class=\"k\">have</span> <span class=\"n\">x_not_ainv</span> <span class=\"o\">:=</span> <span class=\"n\">finset</span><span class=\"bp\">.</span><span class=\"n\">ne_of_mem_erase</span> <span class=\"n\">h</span><span class=\"o\">,</span>\n    <span class=\"n\">by_contradiction</span> <span class=\"n\">hh</span><span class=\"o\">,</span>\n    <span class=\"n\">push_neg</span> <span class=\"n\">at</span> <span class=\"n\">hh</span><span class=\"o\">,</span>\n    <span class=\"n\">induction</span> <span class=\"n\">hh</span><span class=\"o\">,</span>\n    <span class=\"n\">finish</span><span class=\"o\">,</span>\n  <span class=\"o\">},</span>\n  <span class=\"o\">{</span>\n    <span class=\"n\">intros</span> <span class=\"n\">x</span> <span class=\"n\">h</span><span class=\"o\">,</span>\n    <span class=\"n\">apply</span> <span class=\"n\">h2</span><span class=\"o\">,</span>\n    <span class=\"n\">exact</span> <span class=\"n\">finset</span><span class=\"bp\">.</span><span class=\"n\">mem_insert_of_mem</span> <span class=\"o\">(</span><span class=\"n\">finset</span><span class=\"bp\">.</span><span class=\"n\">mem_of_mem_erase</span> <span class=\"n\">h</span><span class=\"o\">)</span>\n  <span class=\"o\">}</span>\n<span class=\"o\">},</span>\n<span class=\"o\">{</span>\n  <span class=\"n\">rw</span> <span class=\"n\">finset</span><span class=\"bp\">.</span><span class=\"n\">prod_insert</span> <span class=\"n\">a_notin_s</span><span class=\"o\">,</span>\n  <span class=\"n\">suffices</span> <span class=\"n\">hkey</span> <span class=\"o\">:</span> <span class=\"o\">(</span><span class=\"err\">∏</span> <span class=\"n\">x</span> <span class=\"k\">in</span> <span class=\"n\">s</span><span class=\"o\">,</span> <span class=\"n\">x</span><span class=\"o\">)</span> <span class=\"bp\">=</span> <span class=\"n\">a</span><span class=\"bp\">⁻¹</span><span class=\"o\">,</span>\n  <span class=\"n\">exact</span> <span class=\"n\">mul_eq_one_iff_inv_eq</span><span class=\"bp\">.</span><span class=\"n\">mpr</span> <span class=\"o\">(</span><span class=\"n\">eq</span><span class=\"bp\">.</span><span class=\"n\">symm</span> <span class=\"n\">hkey</span><span class=\"o\">),</span>\n  <span class=\"k\">have</span> <span class=\"n\">ainv_notin_s1</span> <span class=\"o\">:</span> <span class=\"n\">a</span><span class=\"bp\">⁻¹</span> <span class=\"err\">∉</span> <span class=\"n\">finset</span><span class=\"bp\">.</span><span class=\"n\">erase</span> <span class=\"n\">s</span> <span class=\"n\">a</span><span class=\"bp\">⁻¹</span> <span class=\"o\">:=</span> <span class=\"n\">finset</span><span class=\"bp\">.</span><span class=\"n\">not_mem_erase</span> <span class=\"n\">a</span><span class=\"bp\">⁻¹</span> <span class=\"n\">s</span><span class=\"o\">,</span>\n  <span class=\"k\">have</span> <span class=\"n\">ainv_in_s</span> <span class=\"o\">:</span> <span class=\"n\">a</span><span class=\"bp\">⁻¹</span> <span class=\"err\">∈</span> <span class=\"n\">s</span><span class=\"o\">,</span>\n  <span class=\"o\">{</span>\n    <span class=\"k\">have</span> <span class=\"n\">ainv_in_s1</span> <span class=\"o\">:</span> <span class=\"n\">a</span><span class=\"bp\">⁻¹</span> <span class=\"err\">∈</span> <span class=\"n\">insert</span> <span class=\"n\">a</span> <span class=\"n\">s</span> <span class=\"o\">:=</span> <span class=\"n\">h1</span> <span class=\"n\">a</span> <span class=\"o\">(</span><span class=\"n\">finset</span><span class=\"bp\">.</span><span class=\"n\">mem_insert_self</span> <span class=\"n\">a</span> <span class=\"n\">s</span><span class=\"o\">),</span>\n    <span class=\"n\">suffices</span> <span class=\"o\">:</span> <span class=\"n\">a</span><span class=\"bp\">⁻¹</span> <span class=\"bp\">≠</span> <span class=\"n\">a</span><span class=\"o\">,</span> <span class=\"k\">by</span> <span class=\"n\">exact</span> <span class=\"n\">finset</span><span class=\"bp\">.</span><span class=\"n\">mem_of_mem_insert_of_ne</span> <span class=\"n\">ainv_in_s1</span> <span class=\"n\">this</span><span class=\"o\">,</span>\n    <span class=\"n\">exact</span> <span class=\"n\">h2</span> <span class=\"n\">a</span> <span class=\"o\">(</span><span class=\"n\">finset</span><span class=\"bp\">.</span><span class=\"n\">mem_insert_self</span> <span class=\"n\">a</span> <span class=\"n\">s</span><span class=\"o\">)</span>\n  <span class=\"o\">},</span>\n  <span class=\"o\">{</span>\n    <span class=\"n\">rw</span> <span class=\"o\">[</span><span class=\"err\">←</span><span class=\"n\">finset</span><span class=\"bp\">.</span><span class=\"n\">insert_erase</span> <span class=\"n\">ainv_in_s</span><span class=\"o\">,</span><span class=\"n\">finset</span><span class=\"bp\">.</span><span class=\"n\">prod_insert</span> <span class=\"n\">ainv_notin_s1</span><span class=\"o\">,</span><span class=\"n\">r</span><span class=\"o\">],</span>\n    <span class=\"n\">exact</span> <span class=\"n\">mul_one</span> <span class=\"n\">a</span><span class=\"bp\">⁻¹</span>\n  <span class=\"o\">},</span>\n<span class=\"o\">},</span>\n<span class=\"kn\">end</span>\n\n<span class=\"n\">def</span> <span class=\"n\">two_torsion_subgroup</span> <span class=\"o\">(</span><span class=\"n\">G</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">)[</span><span class=\"n\">comm_group</span> <span class=\"n\">G</span><span class=\"o\">]</span> <span class=\"o\">:</span> <span class=\"n\">subgroup</span> <span class=\"n\">G</span> <span class=\"o\">:=</span>\n<span class=\"o\">{</span> <span class=\"n\">carrier</span> <span class=\"o\">:=</span> <span class=\"o\">{</span><span class=\"n\">z</span> <span class=\"o\">:</span> <span class=\"n\">G</span> <span class=\"bp\">|</span> <span class=\"n\">z</span> <span class=\"bp\">*</span> <span class=\"n\">z</span> <span class=\"bp\">=</span> <span class=\"mi\">1</span><span class=\"o\">},</span>\n  <span class=\"n\">one_mem&#39;</span> <span class=\"o\">:=</span> <span class=\"k\">by</span> <span class=\"n\">simp</span><span class=\"o\">,</span>\n  <span class=\"n\">mul_mem&#39;</span> <span class=\"o\">:=</span> <span class=\"bp\">λ</span> <span class=\"n\">a</span> <span class=\"n\">b</span> <span class=\"o\">(</span><span class=\"n\">ha</span> <span class=\"o\">:</span> <span class=\"n\">a</span> <span class=\"bp\">*</span> <span class=\"n\">a</span> <span class=\"bp\">=</span> <span class=\"mi\">1</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">hb</span> <span class=\"o\">:</span> <span class=\"n\">b</span> <span class=\"bp\">*</span> <span class=\"n\">b</span> <span class=\"bp\">=</span> <span class=\"mi\">1</span><span class=\"o\">),</span>\n  <span class=\"k\">begin</span>\n    <span class=\"n\">tidy</span><span class=\"o\">,</span>\n    <span class=\"n\">rw</span> <span class=\"o\">[</span><span class=\"n\">mul_mul_mul_comm</span> <span class=\"n\">a</span> <span class=\"n\">b</span> <span class=\"n\">a</span> <span class=\"n\">b</span><span class=\"o\">,</span> <span class=\"n\">ha</span><span class=\"o\">,</span> <span class=\"n\">hb</span><span class=\"o\">],</span>\n    <span class=\"n\">refine</span> <span class=\"n\">mul_one</span> <span class=\"mi\">1</span><span class=\"o\">,</span>\n  <span class=\"kn\">end</span><span class=\"o\">,</span>\n  <span class=\"n\">inv_mem&#39;</span> <span class=\"o\">:=</span> <span class=\"bp\">λ</span> <span class=\"n\">a</span> <span class=\"o\">(</span><span class=\"n\">ha</span> <span class=\"o\">:</span> <span class=\"n\">a</span> <span class=\"bp\">*</span> <span class=\"n\">a</span> <span class=\"bp\">=</span> <span class=\"mi\">1</span><span class=\"o\">),</span> <span class=\"k\">by</span> <span class=\"o\">{</span><span class=\"n\">tidy</span><span class=\"o\">,</span> <span class=\"n\">rw</span> <span class=\"n\">mul_inv_eq_one</span><span class=\"o\">,</span> <span class=\"n\">refine</span> <span class=\"n\">inv_eq_of_mul_eq_one</span> <span class=\"n\">ha</span><span class=\"o\">}</span>\n<span class=\"o\">}</span>\n\n<span class=\"kn\">lemma</span> <span class=\"n\">prod_all_eq_prod_two_torsion</span> <span class=\"o\">{</span><span class=\"n\">G</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span> <span class=\"o\">[</span><span class=\"n\">comm_group</span> <span class=\"n\">G</span><span class=\"o\">]</span> <span class=\"o\">[</span><span class=\"n\">fintype</span> <span class=\"n\">G</span><span class=\"o\">]:</span>\n<span class=\"o\">(</span><span class=\"err\">∏</span> <span class=\"n\">g</span> <span class=\"o\">:</span> <span class=\"n\">G</span><span class=\"o\">,</span> <span class=\"n\">g</span><span class=\"o\">)</span> <span class=\"bp\">=</span> <span class=\"o\">(</span><span class=\"err\">∏</span> <span class=\"n\">g</span> <span class=\"o\">:</span> <span class=\"n\">two_torsion_subgroup</span> <span class=\"n\">G</span><span class=\"o\">,</span> <span class=\"n\">g</span><span class=\"o\">)</span> <span class=\"o\">:=</span>\n<span class=\"k\">begin</span>\n    <span class=\"k\">have</span> <span class=\"n\">hdisj</span> <span class=\"o\">:</span> <span class=\"n\">disjoint</span> <span class=\"o\">{</span><span class=\"n\">x</span> <span class=\"o\">:</span> <span class=\"n\">G</span> <span class=\"bp\">|</span> <span class=\"n\">x</span> <span class=\"err\">∈</span> <span class=\"n\">two_torsion_subgroup</span> <span class=\"n\">G</span><span class=\"o\">}</span> <span class=\"o\">{</span><span class=\"n\">x</span> <span class=\"o\">:</span> <span class=\"n\">G</span> <span class=\"bp\">|</span> <span class=\"n\">x</span> <span class=\"bp\">≠</span> <span class=\"n\">x</span><span class=\"bp\">⁻¹</span> <span class=\"o\">},</span>\n    <span class=\"o\">{</span>\n        <span class=\"n\">intros</span> <span class=\"n\">x</span> <span class=\"n\">hx</span><span class=\"o\">,</span>\n        <span class=\"n\">cases</span> <span class=\"n\">hx</span> <span class=\"k\">with</span> <span class=\"n\">h1</span> <span class=\"n\">h2</span><span class=\"o\">,</span>\n        <span class=\"n\">norm_num</span><span class=\"o\">,</span>\n        <span class=\"k\">have</span> <span class=\"n\">hA</span> <span class=\"o\">:</span> <span class=\"n\">x</span> <span class=\"bp\">*</span> <span class=\"n\">x</span> <span class=\"bp\">=</span> <span class=\"mi\">1</span><span class=\"o\">,</span> <span class=\"k\">by</span> <span class=\"n\">assumption</span><span class=\"o\">,</span>\n        <span class=\"n\">suffices</span> <span class=\"n\">hB</span> <span class=\"o\">:</span> <span class=\"n\">x</span> <span class=\"bp\">*</span> <span class=\"n\">x</span> <span class=\"bp\">≠</span> <span class=\"mi\">1</span><span class=\"o\">,</span> <span class=\"k\">by</span> <span class=\"n\">exact</span> <span class=\"n\">h2</span> <span class=\"o\">(</span><span class=\"n\">false</span><span class=\"bp\">.</span><span class=\"n\">rec</span> <span class=\"o\">(</span><span class=\"n\">x</span> <span class=\"bp\">=</span> <span class=\"n\">x</span><span class=\"bp\">⁻¹</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">hB</span> <span class=\"n\">hA</span><span class=\"o\">)),</span>\n        <span class=\"n\">clear</span> <span class=\"n\">hA</span> <span class=\"n\">h1</span><span class=\"o\">,</span>\n        <span class=\"n\">simp</span> <span class=\"o\">[</span><span class=\"err\">←</span> <span class=\"n\">mul_eq_one_iff_eq_inv</span><span class=\"o\">]</span> <span class=\"n\">at</span> <span class=\"n\">h2</span><span class=\"o\">,</span>\n        <span class=\"n\">assumption</span><span class=\"o\">,</span>\n    <span class=\"o\">},</span>\n    <span class=\"k\">have</span> <span class=\"n\">h</span> <span class=\"o\">:</span> <span class=\"o\">(</span><span class=\"err\">∏</span> <span class=\"n\">g</span> <span class=\"k\">in</span> <span class=\"o\">{</span><span class=\"n\">x</span> <span class=\"o\">:</span> <span class=\"n\">G</span> <span class=\"bp\">|</span> <span class=\"n\">x</span> <span class=\"bp\">≠</span> <span class=\"n\">x</span><span class=\"bp\">⁻¹</span> <span class=\"o\">}</span><span class=\"bp\">.</span><span class=\"n\">to_finset</span><span class=\"o\">,</span> <span class=\"n\">g</span><span class=\"o\">)</span> <span class=\"bp\">=</span> <span class=\"mi\">1</span><span class=\"o\">,</span>\n    <span class=\"o\">{</span>\n        <span class=\"n\">apply</span> <span class=\"n\">prod_finset_distinct_inv</span><span class=\"bp\">;</span>\n        <span class=\"n\">finish</span><span class=\"o\">,</span>\n    <span class=\"o\">},</span>\n    <span class=\"k\">have</span> <span class=\"n\">H</span> <span class=\"o\">:</span> <span class=\"o\">(</span><span class=\"err\">∏</span> <span class=\"o\">(</span><span class=\"n\">g</span> <span class=\"o\">:</span> <span class=\"n\">G</span><span class=\"o\">),</span> <span class=\"n\">g</span><span class=\"o\">)</span> <span class=\"bp\">=</span> <span class=\"o\">(</span><span class=\"err\">∏</span> <span class=\"n\">x</span> <span class=\"k\">in</span> <span class=\"o\">{</span><span class=\"n\">x</span> <span class=\"o\">:</span> <span class=\"n\">G</span> <span class=\"bp\">|</span> <span class=\"n\">x</span> <span class=\"err\">∈</span> <span class=\"n\">two_torsion_subgroup</span> <span class=\"n\">G</span><span class=\"o\">}</span><span class=\"bp\">.</span><span class=\"n\">to_finset</span><span class=\"o\">,</span> <span class=\"n\">x</span><span class=\"o\">)</span>\n            <span class=\"bp\">*</span> <span class=\"o\">(</span><span class=\"err\">∏</span> <span class=\"n\">x</span> <span class=\"k\">in</span> <span class=\"o\">{</span><span class=\"n\">x</span> <span class=\"o\">:</span> <span class=\"n\">G</span> <span class=\"bp\">|</span> <span class=\"n\">x</span> <span class=\"bp\">≠</span> <span class=\"n\">x</span><span class=\"bp\">⁻¹</span> <span class=\"o\">}</span><span class=\"bp\">.</span><span class=\"n\">to_finset</span><span class=\"o\">,</span> <span class=\"n\">x</span><span class=\"o\">),</span>\n    <span class=\"o\">{</span>\n        <span class=\"c1\">--simp [finset.prod_union],</span>\n        <span class=\"n\">simp</span> <span class=\"n\">at</span> <span class=\"bp\">*</span><span class=\"o\">,</span>\n        <span class=\"n\">rw</span> <span class=\"err\">←</span> <span class=\"n\">finset</span><span class=\"bp\">.</span><span class=\"n\">prod_union</span><span class=\"o\">,</span>\n        <span class=\"o\">{</span>\n            <span class=\"n\">congr</span><span class=\"o\">,</span>\n            <span class=\"n\">ext1</span><span class=\"o\">,</span>\n            <span class=\"n\">simp</span> <span class=\"o\">[</span><span class=\"n\">finset</span><span class=\"bp\">.</span><span class=\"n\">coe_inj</span><span class=\"o\">],</span>\n            <span class=\"n\">safe</span><span class=\"o\">,</span>\n            <span class=\"n\">suffices</span> <span class=\"n\">hh</span> <span class=\"o\">:</span> <span class=\"n\">a</span> <span class=\"err\">∈</span> <span class=\"n\">two_torsion_subgroup</span> <span class=\"n\">G</span><span class=\"o\">,</span> <span class=\"n\">tauto</span><span class=\"o\">,</span>\n            <span class=\"k\">have</span> <span class=\"n\">a2</span><span class=\"o\">:</span> <span class=\"n\">a</span> <span class=\"bp\">*</span> <span class=\"n\">a</span> <span class=\"bp\">=</span> <span class=\"mi\">1</span> <span class=\"o\">:=</span> <span class=\"n\">eq_inv_iff_mul_eq_one</span><span class=\"bp\">.</span><span class=\"n\">mp</span> <span class=\"n\">h_1</span><span class=\"o\">,</span>\n            <span class=\"n\">tauto</span><span class=\"o\">,</span>\n        <span class=\"o\">},</span>\n        <span class=\"o\">{</span>\n            <span class=\"n\">simp</span> <span class=\"o\">[</span><span class=\"n\">finset</span><span class=\"bp\">.</span><span class=\"n\">disjoint_iff_disjoint_coe</span><span class=\"o\">],</span>\n            <span class=\"n\">exact</span> <span class=\"n\">hdisj</span><span class=\"o\">,</span>\n        <span class=\"o\">}</span>\n    <span class=\"o\">},</span>\n    <span class=\"o\">{</span>\n        <span class=\"n\">rw</span> <span class=\"o\">[</span><span class=\"n\">H</span><span class=\"o\">,</span> <span class=\"n\">h</span><span class=\"o\">],</span>\n        <span class=\"n\">simp</span> <span class=\"n\">at</span> <span class=\"bp\">*</span><span class=\"o\">,</span>\n        <span class=\"n\">apply</span> <span class=\"n\">finset</span><span class=\"bp\">.</span><span class=\"n\">prod_subtype</span><span class=\"o\">,</span>\n        <span class=\"n\">finish</span><span class=\"o\">,</span>\n    <span class=\"o\">},</span>\n<span class=\"kn\">end</span>\n</code></pre></div>",
        "id": 202718881,
        "sender_full_name": "Marc Masdeu",
        "timestamp": 1593710754
    },
    {
        "content": "<p>Its a nice result, I'd say we should have (some version) it in mathlib!<br>\nI made some comments inline: it looks pretty good to me, maybe more lemmas and less long proofs would be more manageable though, like for the last statement you could have a lemma that<br>\nprod of elements of G is prod of the two torsion times prod of things not their own inverse.<br>\nthen a lemma that the prod of things that are not their own inverse of any group is one, all as separate lemmas which are combined at the end (basically all of the have's in the last proof could be lemmas)</p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"kn\">import</span> <span class=\"n\">group_theory</span><span class=\"bp\">.</span><span class=\"n\">subgroup</span>\n<span class=\"kn\">import</span> <span class=\"n\">data</span><span class=\"bp\">.</span><span class=\"n\">fintype</span><span class=\"bp\">.</span><span class=\"n\">card</span>\n<span class=\"kn\">import</span> <span class=\"n\">data</span><span class=\"bp\">.</span><span class=\"n\">set</span><span class=\"bp\">.</span><span class=\"n\">finite</span>\n<span class=\"kn\">import</span> <span class=\"n\">tactic</span>\n\n<span class=\"n\">open_locale</span> <span class=\"n\">classical</span> <span class=\"n\">big_operators</span>\n<span class=\"c\">/-</span><span class=\"cm\"> General comments</span>\n<span class=\"cm\"> 1. You can add @[to_additive] to generate additive versions of these lemmas if you like</span>\n<span class=\"cm\"> 2. you use tactics like clarify, finish, safe, a lot, these things can be a little slow, but they</span>\n<span class=\"cm\">    are convenient, so might be best to separate out some of the times they are used as separate lemmas</span>\n<span class=\"cm\">    whose proof is just by finish or whatever, so that they don&#39;t get re-run all the time -/</span>\n\n<span class=\"kn\">set_option</span> <span class=\"n\">profiler</span> <span class=\"n\">true</span> <span class=\"c1\">-- you can use this too see time spent on proofs</span>\n\n<span class=\"kn\">lemma</span> <span class=\"n\">prod_finset_distinct_inv</span> <span class=\"o\">{</span><span class=\"n\">α</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span> <span class=\"o\">[</span><span class=\"n\">comm_group</span> <span class=\"n\">α</span><span class=\"o\">]</span> <span class=\"o\">{</span><span class=\"n\">s</span> <span class=\"o\">:</span> <span class=\"n\">finset</span> <span class=\"n\">α</span><span class=\"o\">}</span> <span class=\"o\">:</span>\n  <span class=\"o\">(</span><span class=\"bp\">∀</span> <span class=\"n\">x</span> <span class=\"err\">∈</span> <span class=\"n\">s</span><span class=\"o\">,</span> <span class=\"n\">x</span><span class=\"bp\">⁻¹</span> <span class=\"err\">∈</span> <span class=\"n\">s</span><span class=\"o\">)</span> <span class=\"bp\">→</span> <span class=\"o\">(</span><span class=\"bp\">∀</span> <span class=\"n\">x</span> <span class=\"err\">∈</span> <span class=\"n\">s</span><span class=\"o\">,</span> <span class=\"n\">x</span><span class=\"bp\">⁻¹</span> <span class=\"bp\">≠</span> <span class=\"n\">x</span><span class=\"o\">)</span> <span class=\"bp\">→</span> <span class=\"o\">(</span><span class=\"err\">∏</span> <span class=\"n\">x</span> <span class=\"k\">in</span> <span class=\"n\">s</span><span class=\"o\">,</span> <span class=\"n\">x</span><span class=\"o\">)</span> <span class=\"bp\">=</span> <span class=\"mi\">1</span> <span class=\"o\">:=</span>\n<span class=\"k\">begin</span>\n<span class=\"n\">apply</span> <span class=\"n\">finset</span><span class=\"bp\">.</span><span class=\"n\">case_strong_induction_on</span> <span class=\"n\">s</span><span class=\"o\">,</span>  <span class=\"k\">by</span> <span class=\"n\">tauto</span><span class=\"o\">,</span>\n<span class=\"n\">intros</span> <span class=\"n\">a</span> <span class=\"n\">s</span> <span class=\"n\">a_notin_s</span> <span class=\"n\">H</span> <span class=\"n\">h1</span> <span class=\"n\">h2</span><span class=\"o\">,</span>\n<span class=\"n\">specialize</span> <span class=\"n\">H</span> <span class=\"o\">(</span><span class=\"n\">finset</span><span class=\"bp\">.</span><span class=\"n\">erase</span> <span class=\"n\">s</span> <span class=\"n\">a</span><span class=\"bp\">⁻¹</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">finset</span><span class=\"bp\">.</span><span class=\"n\">erase_subset</span> <span class=\"o\">(</span><span class=\"n\">a</span><span class=\"bp\">⁻¹</span><span class=\"o\">)</span> <span class=\"n\">s</span><span class=\"o\">),</span>\n<span class=\"k\">have</span> <span class=\"n\">r</span> <span class=\"o\">:</span> <span class=\"o\">(</span><span class=\"err\">∏</span> <span class=\"n\">x</span> <span class=\"k\">in</span> <span class=\"o\">(</span><span class=\"n\">finset</span><span class=\"bp\">.</span><span class=\"n\">erase</span> <span class=\"n\">s</span> <span class=\"n\">a</span><span class=\"bp\">⁻¹</span><span class=\"o\">),</span> <span class=\"n\">x</span><span class=\"o\">)</span> <span class=\"bp\">=</span> <span class=\"mi\">1</span><span class=\"o\">,</span>\n<span class=\"o\">{</span>\n  <span class=\"n\">apply</span> <span class=\"n\">H</span><span class=\"o\">,</span>\n  <span class=\"o\">{</span>\n    <span class=\"n\">intros</span> <span class=\"n\">x</span> <span class=\"n\">h</span><span class=\"o\">,</span>\n    <span class=\"n\">suffices</span> <span class=\"o\">:</span> <span class=\"bp\">¬</span><span class=\"n\">x</span> <span class=\"bp\">=</span> <span class=\"n\">a</span> <span class=\"bp\">∧</span> <span class=\"n\">x</span><span class=\"bp\">⁻¹</span> <span class=\"err\">∈</span> <span class=\"n\">s</span><span class=\"o\">,</span> <span class=\"k\">by</span> <span class=\"n\">simpa</span><span class=\"o\">,</span>\n    <span class=\"n\">split</span><span class=\"o\">,</span>\n    <span class=\"k\">begin</span> <span class=\"n\">finish</span><span class=\"o\">,</span> <span class=\"kn\">end</span><span class=\"o\">,</span> <span class=\"c1\">-- this takes ages</span>\n    <span class=\"n\">suffices</span> <span class=\"o\">:</span> <span class=\"n\">x</span><span class=\"bp\">⁻¹</span> <span class=\"bp\">≠</span> <span class=\"n\">a</span><span class=\"o\">,</span> <span class=\"k\">from</span> <span class=\"n\">finset</span><span class=\"bp\">.</span><span class=\"n\">mem_of_mem_insert_of_ne</span> <span class=\"o\">(</span><span class=\"n\">h1</span> <span class=\"n\">x</span> <span class=\"o\">(</span><span class=\"n\">finset</span><span class=\"bp\">.</span><span class=\"n\">mem_insert_of_mem</span> <span class=\"o\">(</span><span class=\"n\">finset</span><span class=\"bp\">.</span><span class=\"n\">mem_of_mem_erase</span> <span class=\"n\">h</span><span class=\"o\">)))</span> <span class=\"n\">this</span><span class=\"o\">,</span>\n    <span class=\"c1\">-- replaced finish with an explicit proof,</span>\n    <span class=\"n\">by_contradiction</span> <span class=\"n\">hh</span><span class=\"o\">,</span>\n    <span class=\"n\">push_neg</span> <span class=\"n\">at</span> <span class=\"n\">hh</span><span class=\"o\">,</span>\n    <span class=\"n\">induction</span> <span class=\"n\">hh</span><span class=\"o\">,</span>\n    <span class=\"n\">simpa</span> <span class=\"kn\">using</span> <span class=\"n\">finset</span><span class=\"bp\">.</span><span class=\"n\">ne_of_mem_erase</span> <span class=\"n\">h</span><span class=\"o\">,</span>\n    <span class=\"c1\">-- replaced finish with an explicit proof and don&#39;t name a short term that is only used once now</span>\n  <span class=\"o\">},</span>\n  <span class=\"o\">{</span>\n    <span class=\"n\">intros</span> <span class=\"n\">x</span> <span class=\"n\">h</span><span class=\"o\">,</span>\n    <span class=\"n\">apply</span> <span class=\"n\">h2</span><span class=\"o\">,</span>\n    <span class=\"n\">exact</span> <span class=\"n\">finset</span><span class=\"bp\">.</span><span class=\"n\">mem_insert_of_mem</span> <span class=\"o\">(</span><span class=\"n\">finset</span><span class=\"bp\">.</span><span class=\"n\">mem_of_mem_erase</span> <span class=\"n\">h</span><span class=\"o\">)</span>\n  <span class=\"o\">}</span>\n<span class=\"o\">},</span>\n<span class=\"o\">{</span>\n  <span class=\"n\">rw</span> <span class=\"n\">finset</span><span class=\"bp\">.</span><span class=\"n\">prod_insert</span> <span class=\"n\">a_notin_s</span><span class=\"o\">,</span>\n  <span class=\"n\">suffices</span> <span class=\"n\">hkey</span> <span class=\"o\">:</span> <span class=\"o\">(</span><span class=\"err\">∏</span> <span class=\"n\">x</span> <span class=\"k\">in</span> <span class=\"n\">s</span><span class=\"o\">,</span> <span class=\"n\">x</span><span class=\"o\">)</span> <span class=\"bp\">=</span> <span class=\"n\">a</span><span class=\"bp\">⁻¹</span><span class=\"o\">,</span>\n  <span class=\"n\">exact</span> <span class=\"n\">mul_eq_one_iff_inv_eq</span><span class=\"bp\">.</span><span class=\"n\">mpr</span> <span class=\"o\">(</span><span class=\"n\">eq</span><span class=\"bp\">.</span><span class=\"n\">symm</span> <span class=\"n\">hkey</span><span class=\"o\">),</span>\n  <span class=\"k\">have</span> <span class=\"n\">ainv_notin_s1</span> <span class=\"o\">:</span> <span class=\"n\">a</span><span class=\"bp\">⁻¹</span> <span class=\"err\">∉</span> <span class=\"n\">finset</span><span class=\"bp\">.</span><span class=\"n\">erase</span> <span class=\"n\">s</span> <span class=\"n\">a</span><span class=\"bp\">⁻¹</span> <span class=\"o\">:=</span> <span class=\"n\">finset</span><span class=\"bp\">.</span><span class=\"n\">not_mem_erase</span> <span class=\"n\">a</span><span class=\"bp\">⁻¹</span> <span class=\"n\">s</span><span class=\"o\">,</span>\n  <span class=\"k\">have</span> <span class=\"n\">ainv_in_s</span> <span class=\"o\">:</span> <span class=\"n\">a</span><span class=\"bp\">⁻¹</span> <span class=\"err\">∈</span> <span class=\"n\">s</span><span class=\"o\">,</span>\n  <span class=\"o\">{</span>\n    <span class=\"k\">have</span> <span class=\"n\">ainv_in_s1</span> <span class=\"o\">:</span> <span class=\"n\">a</span><span class=\"bp\">⁻¹</span> <span class=\"err\">∈</span> <span class=\"n\">insert</span> <span class=\"n\">a</span> <span class=\"n\">s</span> <span class=\"o\">:=</span> <span class=\"n\">h1</span> <span class=\"n\">a</span> <span class=\"o\">(</span><span class=\"n\">finset</span><span class=\"bp\">.</span><span class=\"n\">mem_insert_self</span> <span class=\"n\">a</span> <span class=\"n\">s</span><span class=\"o\">),</span>\n    <span class=\"n\">suffices</span> <span class=\"o\">:</span> <span class=\"n\">a</span><span class=\"bp\">⁻¹</span> <span class=\"bp\">≠</span> <span class=\"n\">a</span><span class=\"o\">,</span> <span class=\"k\">from</span> <span class=\"n\">finset</span><span class=\"bp\">.</span><span class=\"n\">mem_of_mem_insert_of_ne</span> <span class=\"n\">ainv_in_s1</span> <span class=\"n\">this</span><span class=\"o\">,</span> <span class=\"c1\">-- by exact can almost always be removed!</span>\n    <span class=\"c1\">-- as it is just openening tactic mode then returning to term mode</span>\n    <span class=\"n\">exact</span> <span class=\"n\">h2</span> <span class=\"n\">a</span> <span class=\"o\">(</span><span class=\"n\">finset</span><span class=\"bp\">.</span><span class=\"n\">mem_insert_self</span> <span class=\"n\">a</span> <span class=\"n\">s</span><span class=\"o\">)</span>\n  <span class=\"o\">},</span>\n  <span class=\"o\">{</span>\n    <span class=\"n\">rw</span> <span class=\"o\">[</span><span class=\"err\">←</span><span class=\"n\">finset</span><span class=\"bp\">.</span><span class=\"n\">insert_erase</span> <span class=\"n\">ainv_in_s</span><span class=\"o\">,</span><span class=\"n\">finset</span><span class=\"bp\">.</span><span class=\"n\">prod_insert</span> <span class=\"n\">ainv_notin_s1</span><span class=\"o\">,</span><span class=\"n\">r</span><span class=\"o\">],</span>\n    <span class=\"n\">exact</span> <span class=\"n\">mul_one</span> <span class=\"n\">a</span><span class=\"bp\">⁻¹</span>\n  <span class=\"o\">},</span>\n<span class=\"o\">},</span>\n<span class=\"kn\">end</span>\n\n<span class=\"n\">def</span> <span class=\"n\">two_torsion_subgroup</span> <span class=\"o\">(</span><span class=\"n\">G</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">)</span> <span class=\"o\">[</span><span class=\"n\">comm_group</span> <span class=\"n\">G</span><span class=\"o\">]</span> <span class=\"o\">:</span> <span class=\"n\">subgroup</span> <span class=\"n\">G</span> <span class=\"o\">:=</span>\n<span class=\"o\">{</span> <span class=\"n\">carrier</span> <span class=\"o\">:=</span> <span class=\"o\">{</span><span class=\"n\">z</span> <span class=\"o\">:</span> <span class=\"n\">G</span> <span class=\"bp\">|</span> <span class=\"n\">z</span> <span class=\"bp\">*</span> <span class=\"n\">z</span> <span class=\"bp\">=</span> <span class=\"mi\">1</span><span class=\"o\">},</span>\n  <span class=\"n\">one_mem&#39;</span> <span class=\"o\">:=</span> <span class=\"k\">by</span> <span class=\"n\">simp</span><span class=\"o\">,</span>\n  <span class=\"n\">mul_mem&#39;</span> <span class=\"o\">:=</span> <span class=\"bp\">λ</span> <span class=\"n\">a</span> <span class=\"n\">b</span> <span class=\"o\">(</span><span class=\"n\">ha</span> <span class=\"o\">:</span> <span class=\"n\">a</span> <span class=\"bp\">*</span> <span class=\"n\">a</span> <span class=\"bp\">=</span> <span class=\"mi\">1</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">hb</span> <span class=\"o\">:</span> <span class=\"n\">b</span> <span class=\"bp\">*</span> <span class=\"n\">b</span> <span class=\"bp\">=</span> <span class=\"mi\">1</span><span class=\"o\">),</span>\n  <span class=\"k\">begin</span>\n    <span class=\"n\">dsimp</span><span class=\"o\">,</span> <span class=\"c1\">-- use tidy? and tidy will tell you what it did in this case it only did dsimp at *, and we can just change it to dsimp</span>\n    <span class=\"n\">rw</span> <span class=\"o\">[</span><span class=\"n\">mul_mul_mul_comm</span> <span class=\"n\">a</span> <span class=\"n\">b</span> <span class=\"n\">a</span> <span class=\"n\">b</span><span class=\"o\">,</span> <span class=\"n\">ha</span><span class=\"o\">,</span> <span class=\"n\">hb</span><span class=\"o\">],</span>\n    <span class=\"n\">exact</span> <span class=\"n\">mul_one</span> <span class=\"mi\">1</span><span class=\"o\">,</span> <span class=\"c1\">-- exact instead of refine</span>\n  <span class=\"kn\">end</span><span class=\"o\">,</span>\n  <span class=\"n\">inv_mem&#39;</span> <span class=\"o\">:=</span> <span class=\"bp\">λ</span> <span class=\"n\">a</span> <span class=\"o\">(</span><span class=\"n\">ha</span> <span class=\"o\">:</span> <span class=\"n\">a</span> <span class=\"bp\">*</span> <span class=\"n\">a</span> <span class=\"bp\">=</span> <span class=\"mi\">1</span><span class=\"o\">),</span> <span class=\"k\">by</span> <span class=\"o\">{</span><span class=\"n\">dsimp</span><span class=\"o\">,</span> <span class=\"n\">rw</span> <span class=\"n\">mul_inv_eq_one</span><span class=\"o\">,</span> <span class=\"n\">refine</span> <span class=\"n\">inv_eq_of_mul_eq_one</span> <span class=\"n\">ha</span><span class=\"o\">}</span> <span class=\"c1\">--same with tidy</span>\n<span class=\"o\">}</span>\n\n<span class=\"kn\">lemma</span> <span class=\"n\">prod_all_eq_prod_two_torsion</span> <span class=\"o\">{</span><span class=\"n\">G</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span> <span class=\"o\">[</span><span class=\"n\">comm_group</span> <span class=\"n\">G</span><span class=\"o\">]</span> <span class=\"o\">[</span><span class=\"n\">fintype</span> <span class=\"n\">G</span><span class=\"o\">]:</span>\n<span class=\"err\">∏</span> <span class=\"n\">g</span> <span class=\"o\">:</span> <span class=\"n\">G</span><span class=\"o\">,</span> <span class=\"n\">g</span> <span class=\"bp\">=</span> <span class=\"err\">∏</span> <span class=\"n\">g</span> <span class=\"o\">:</span> <span class=\"n\">two_torsion_subgroup</span> <span class=\"n\">G</span><span class=\"o\">,</span> <span class=\"n\">g</span> <span class=\"o\">:=</span> <span class=\"c1\">-- don&#39;t need brackets</span>\n<span class=\"k\">begin</span>\n    <span class=\"k\">have</span> <span class=\"n\">hdisj</span> <span class=\"o\">:</span> <span class=\"n\">disjoint</span> <span class=\"o\">{</span><span class=\"n\">x</span> <span class=\"o\">:</span> <span class=\"n\">G</span> <span class=\"bp\">|</span> <span class=\"n\">x</span> <span class=\"err\">∈</span> <span class=\"n\">two_torsion_subgroup</span> <span class=\"n\">G</span><span class=\"o\">}</span> <span class=\"o\">{</span><span class=\"n\">x</span> <span class=\"o\">:</span> <span class=\"n\">G</span> <span class=\"bp\">|</span> <span class=\"n\">x</span> <span class=\"bp\">≠</span> <span class=\"n\">x</span><span class=\"bp\">⁻¹</span> <span class=\"o\">},</span>\n    <span class=\"o\">{</span>\n        <span class=\"n\">intros</span> <span class=\"n\">x</span> <span class=\"n\">hx</span><span class=\"o\">,</span>\n        <span class=\"n\">cases</span> <span class=\"n\">hx</span> <span class=\"k\">with</span> <span class=\"n\">h1</span> <span class=\"n\">h2</span><span class=\"o\">,</span>\n        <span class=\"n\">norm_num</span><span class=\"o\">,</span>\n        <span class=\"k\">have</span> <span class=\"n\">hA</span> <span class=\"o\">:</span> <span class=\"n\">x</span> <span class=\"bp\">*</span> <span class=\"n\">x</span> <span class=\"bp\">=</span> <span class=\"mi\">1</span><span class=\"o\">,</span> <span class=\"k\">by</span> <span class=\"n\">assumption</span><span class=\"o\">,</span>\n        <span class=\"n\">suffices</span> <span class=\"n\">hB</span> <span class=\"o\">:</span> <span class=\"n\">x</span> <span class=\"bp\">*</span> <span class=\"n\">x</span> <span class=\"bp\">≠</span> <span class=\"mi\">1</span><span class=\"o\">,</span> <span class=\"k\">by</span> <span class=\"n\">exact</span> <span class=\"n\">h2</span> <span class=\"o\">(</span><span class=\"n\">false</span><span class=\"bp\">.</span><span class=\"n\">rec</span> <span class=\"o\">(</span><span class=\"n\">x</span> <span class=\"bp\">=</span> <span class=\"n\">x</span><span class=\"bp\">⁻¹</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">hB</span> <span class=\"n\">hA</span><span class=\"o\">)),</span>\n        <span class=\"n\">clear</span> <span class=\"n\">hA</span> <span class=\"n\">h1</span><span class=\"o\">,</span>\n        <span class=\"n\">simpa</span> <span class=\"o\">[</span><span class=\"err\">←</span> <span class=\"n\">mul_eq_one_iff_eq_inv</span><span class=\"o\">]</span> <span class=\"kn\">using</span> <span class=\"n\">h2</span><span class=\"o\">,</span> <span class=\"c1\">-- simpa .. using instead of simp .. at .., assumption</span>\n    <span class=\"o\">},</span>\n    <span class=\"k\">have</span> <span class=\"n\">h</span> <span class=\"o\">:</span> <span class=\"o\">(</span><span class=\"err\">∏</span> <span class=\"n\">g</span> <span class=\"k\">in</span> <span class=\"o\">{</span><span class=\"n\">x</span> <span class=\"o\">:</span> <span class=\"n\">G</span> <span class=\"bp\">|</span> <span class=\"n\">x</span> <span class=\"bp\">≠</span> <span class=\"n\">x</span><span class=\"bp\">⁻¹</span> <span class=\"o\">}</span><span class=\"bp\">.</span><span class=\"n\">to_finset</span><span class=\"o\">,</span> <span class=\"n\">g</span><span class=\"o\">)</span> <span class=\"bp\">=</span> <span class=\"mi\">1</span><span class=\"o\">,</span>\n    <span class=\"o\">{</span>\n        <span class=\"n\">apply</span> <span class=\"n\">prod_finset_distinct_inv</span><span class=\"bp\">;</span>\n        <span class=\"n\">finish</span><span class=\"o\">,</span>\n    <span class=\"o\">},</span>\n    <span class=\"k\">have</span> <span class=\"n\">H</span> <span class=\"o\">:</span> <span class=\"o\">(</span><span class=\"err\">∏</span> <span class=\"o\">(</span><span class=\"n\">g</span> <span class=\"o\">:</span> <span class=\"n\">G</span><span class=\"o\">),</span> <span class=\"n\">g</span><span class=\"o\">)</span> <span class=\"bp\">=</span> <span class=\"o\">(</span><span class=\"err\">∏</span> <span class=\"n\">x</span> <span class=\"k\">in</span> <span class=\"o\">{</span><span class=\"n\">x</span> <span class=\"o\">:</span> <span class=\"n\">G</span> <span class=\"bp\">|</span> <span class=\"n\">x</span> <span class=\"err\">∈</span> <span class=\"n\">two_torsion_subgroup</span> <span class=\"n\">G</span><span class=\"o\">}</span><span class=\"bp\">.</span><span class=\"n\">to_finset</span><span class=\"o\">,</span> <span class=\"n\">x</span><span class=\"o\">)</span>\n            <span class=\"bp\">*</span> <span class=\"o\">(</span><span class=\"err\">∏</span> <span class=\"n\">x</span> <span class=\"k\">in</span> <span class=\"o\">{</span><span class=\"n\">x</span> <span class=\"o\">:</span> <span class=\"n\">G</span> <span class=\"bp\">|</span> <span class=\"n\">x</span> <span class=\"bp\">≠</span> <span class=\"n\">x</span><span class=\"bp\">⁻¹</span> <span class=\"o\">}</span><span class=\"bp\">.</span><span class=\"n\">to_finset</span><span class=\"o\">,</span> <span class=\"n\">x</span><span class=\"o\">),</span>\n    <span class=\"o\">{</span>\n        <span class=\"c1\">--simp [finset.prod_union],</span>\n        <span class=\"c1\">-- using squeeze_simp we see that simp only used one lemma here, which was ne.def</span>\n        <span class=\"c1\">-- didn&#39;t seem like this was really changing anything so remove it!</span>\n        <span class=\"n\">rw</span> <span class=\"err\">←</span> <span class=\"n\">finset</span><span class=\"bp\">.</span><span class=\"n\">prod_union</span><span class=\"o\">,</span>\n        <span class=\"o\">{</span>\n            <span class=\"n\">congr</span><span class=\"o\">,</span>\n            <span class=\"n\">ext1</span><span class=\"o\">,</span>\n            <span class=\"n\">simp</span> <span class=\"n\">only</span> <span class=\"o\">[</span><span class=\"n\">true_iff</span><span class=\"o\">,</span> <span class=\"n\">finset</span><span class=\"bp\">.</span><span class=\"n\">mem_univ</span><span class=\"o\">,</span> <span class=\"n\">set</span><span class=\"bp\">.</span><span class=\"n\">mem_to_finset</span><span class=\"o\">,</span> <span class=\"n\">ne</span><span class=\"bp\">.</span><span class=\"n\">def</span><span class=\"o\">,</span> <span class=\"n\">finset</span><span class=\"bp\">.</span><span class=\"n\">mem_union</span><span class=\"o\">,</span> <span class=\"n\">set</span><span class=\"bp\">.</span><span class=\"n\">mem_set_of_eq</span><span class=\"o\">],</span>\n            <span class=\"n\">rw</span> <span class=\"o\">[</span><span class=\"n\">two_torsion_subgroup</span><span class=\"o\">,</span> <span class=\"n\">eq_inv_iff_mul_eq_one</span><span class=\"o\">],</span> <span class=\"c1\">--neater proof</span>\n            <span class=\"n\">exact</span> <span class=\"n\">classical</span><span class=\"bp\">.</span><span class=\"n\">em</span> <span class=\"bp\">_</span><span class=\"o\">,</span>\n        <span class=\"o\">},</span>\n        <span class=\"o\">{</span>\n            <span class=\"n\">simpa</span> <span class=\"n\">only</span> <span class=\"o\">[</span><span class=\"n\">finset</span><span class=\"bp\">.</span><span class=\"n\">disjoint_iff_disjoint_coe</span><span class=\"o\">,</span> <span class=\"n\">set</span><span class=\"bp\">.</span><span class=\"n\">coe_to_finset</span><span class=\"o\">],</span>\n            <span class=\"c1\">-- simp then exact (hypothesis) can be written as simpa</span>\n        <span class=\"o\">}</span>\n    <span class=\"o\">},</span>\n    <span class=\"o\">{</span>\n        <span class=\"n\">rw</span> <span class=\"o\">[</span><span class=\"n\">H</span><span class=\"o\">,</span> <span class=\"n\">h</span><span class=\"o\">],</span>\n        <span class=\"n\">simp</span><span class=\"o\">,</span> <span class=\"c1\">-- once again simp wasnt doing much to most goals</span>\n        <span class=\"n\">apply</span> <span class=\"n\">finset</span><span class=\"bp\">.</span><span class=\"n\">prod_subtype</span><span class=\"o\">,</span>\n        <span class=\"n\">finish</span><span class=\"o\">,</span>\n    <span class=\"o\">},</span>\n<span class=\"kn\">end</span>\n</code></pre></div>",
        "id": 202742147,
        "sender_full_name": "Alex J. Best",
        "timestamp": 1593722519
    },
    {
        "content": "<p>Probably relevant: <code>prod_involution</code></p>",
        "id": 202742425,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1593722727
    },
    {
        "content": "<p>Thanks <span class=\"user-mention\" data-user-id=\"127136\">@Alex J. Best</span> for the review! I have incorporated your suggestions, although I see no way of coming up with this</p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"n\">suffices</span> <span class=\"o\">:</span> <span class=\"n\">x</span><span class=\"bp\">⁻¹</span> <span class=\"bp\">≠</span> <span class=\"n\">a</span><span class=\"o\">,</span> <span class=\"k\">from</span> <span class=\"n\">finset</span><span class=\"bp\">.</span><span class=\"n\">mem_of_mem_insert_of_ne</span> <span class=\"o\">(</span><span class=\"n\">h1</span> <span class=\"n\">x</span> <span class=\"o\">(</span><span class=\"n\">finset</span><span class=\"bp\">.</span><span class=\"n\">mem_insert_of_mem</span> <span class=\"o\">(</span><span class=\"n\">finset</span><span class=\"bp\">.</span><span class=\"n\">mem_of_mem_erase</span> <span class=\"n\">h</span><span class=\"o\">)))</span> <span class=\"n\">this</span><span class=\"o\">,</span>\n</code></pre></div>\n\n\n<p>on my own without spending half an hour trying different things. Would be nice if the <code>finish</code> tactic gave something back as a hint!</p>\n<p><span class=\"user-mention\" data-user-id=\"112680\">@Johan Commelin</span> : I was aware of <code>prod_involution</code> (this is the one that wilson's theorem uses, right?), but wanted to prove the version that I needed using tactics.</p>\n<p>Next step (we have a \"summer project\" with <span class=\"user-mention\" data-user-id=\"315546\">@Xavier Xarles</span>) will be to prove that the product of all the elements of a finite elementary abelian 2-group of order &gt; 2 is 1...</p>",
        "id": 202789566,
        "sender_full_name": "Marc Masdeu",
        "timestamp": 1593772546
    },
    {
        "content": "<p>To expand on Johan's point, applying <code>prod_involution</code> reduces the problem to four much easier sorries.</p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"kn\">import</span> <span class=\"n\">data</span><span class=\"bp\">.</span><span class=\"n\">fintype</span><span class=\"bp\">.</span><span class=\"n\">card</span>\n<span class=\"kn\">import</span> <span class=\"n\">data</span><span class=\"bp\">.</span><span class=\"n\">set</span><span class=\"bp\">.</span><span class=\"n\">finite</span>\n<span class=\"kn\">import</span> <span class=\"n\">tactic</span>\n\n<span class=\"n\">open_locale</span> <span class=\"n\">classical</span> <span class=\"n\">big_operators</span>\n<span class=\"kn\">open</span> <span class=\"n\">finset</span>\n\n<span class=\"kn\">lemma</span> <span class=\"n\">prod_finset_distinct_inv</span>\n<span class=\"o\">{</span><span class=\"n\">α</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span> <span class=\"o\">[</span><span class=\"n\">comm_group</span> <span class=\"n\">α</span><span class=\"o\">]</span> <span class=\"o\">{</span><span class=\"n\">s</span> <span class=\"o\">:</span> <span class=\"n\">finset</span> <span class=\"n\">α</span><span class=\"o\">}</span>\n<span class=\"o\">(</span><span class=\"n\">hs1</span> <span class=\"o\">:</span> <span class=\"bp\">∀</span> <span class=\"n\">x</span> <span class=\"err\">∈</span> <span class=\"n\">s</span><span class=\"o\">,</span> <span class=\"n\">x</span><span class=\"bp\">⁻¹</span> <span class=\"err\">∈</span> <span class=\"n\">s</span><span class=\"o\">)</span>\n<span class=\"o\">(</span><span class=\"n\">hs2</span> <span class=\"o\">:</span> <span class=\"bp\">∀</span> <span class=\"n\">x</span> <span class=\"err\">∈</span> <span class=\"n\">s</span><span class=\"o\">,</span> <span class=\"n\">x</span><span class=\"bp\">⁻¹</span> <span class=\"bp\">≠</span> <span class=\"n\">x</span><span class=\"o\">)</span>\n<span class=\"o\">:</span> <span class=\"err\">∏</span> <span class=\"n\">x</span> <span class=\"k\">in</span> <span class=\"n\">s</span><span class=\"o\">,</span> <span class=\"n\">x</span> <span class=\"bp\">=</span> <span class=\"mi\">1</span> <span class=\"o\">:=</span>\n<span class=\"k\">begin</span>\n  <span class=\"n\">apply</span> <span class=\"bp\">@</span><span class=\"n\">prod_involution</span> <span class=\"bp\">_</span> <span class=\"bp\">_</span> <span class=\"bp\">_</span> <span class=\"bp\">_</span> <span class=\"bp\">_</span> <span class=\"o\">(</span><span class=\"bp\">λ</span> <span class=\"n\">a</span> <span class=\"n\">ha</span><span class=\"o\">,</span> <span class=\"n\">a</span><span class=\"bp\">⁻¹</span><span class=\"o\">),</span>\n  <span class=\"o\">{</span> <span class=\"n\">intros</span><span class=\"o\">,</span> <span class=\"n\">rw</span> <span class=\"n\">mul_inv_self</span> <span class=\"o\">},</span>\n  <span class=\"o\">{</span> <span class=\"n\">intros</span><span class=\"o\">,</span> <span class=\"n\">apply</span> <span class=\"n\">hs2</span><span class=\"o\">,</span> <span class=\"n\">assumption</span> <span class=\"o\">},</span>\n  <span class=\"o\">{</span> <span class=\"n\">intros</span><span class=\"o\">,</span> <span class=\"n\">simp</span><span class=\"o\">,</span> <span class=\"o\">},</span>\n  <span class=\"o\">{</span> <span class=\"n\">intros</span><span class=\"o\">,</span> <span class=\"n\">apply</span> <span class=\"n\">hs1</span><span class=\"o\">,</span> <span class=\"n\">assumption</span><span class=\"o\">,</span> <span class=\"o\">},</span>\n<span class=\"kn\">end</span>\n</code></pre></div>",
        "id": 202805882,
        "sender_full_name": "Jalex Stark",
        "timestamp": 1593784451
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"254058\">Marc Masdeu</span> <a href=\"#narrow/stream/113489-new-members/topic/Frustration.20with.20finset/near/202789566\">said</a>:</p>\n<blockquote>\n<p>Would be nice if the <code>finish</code> tactic gave something back as a hint!</p>\n</blockquote>\n<p>I asked about this once and was told more or less that the output would be unreadable and no quicker than just running finish again unfortunately: <a href=\"https://github.com/leanprover-community/mathlib/issues/1451#issuecomment-533151071\">https://github.com/leanprover-community/mathlib/issues/1451#issuecomment-533151071</a></p>",
        "id": 203070357,
        "sender_full_name": "Alex J. Best",
        "timestamp": 1594103015
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"252300\">Jalex Stark</span> <a href=\"#narrow/stream/113489-new-members/topic/Frustration.20with.20finset/near/202805882\">said</a>:</p>\n<blockquote>\n<p>To expand on Johan's point, applying <code>prod_involution</code> reduces the problem to four much easier sorries.</p>\n</blockquote>\n<p>Thanks <span class=\"user-mention\" data-user-id=\"252300\">@Jalex Stark</span> , we knew about this but it seemed like killing flies with cannons, so we set to prove directly what we exactly wanted. But in the long run, I agree your approach is the right one.</p>",
        "id": 203485008,
        "sender_full_name": "Marc Masdeu",
        "timestamp": 1594372240
    },
    {
        "content": "<p>And now I can't even start the next lemma:</p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"kn\">variables</span> <span class=\"o\">{</span><span class=\"n\">G</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span> <span class=\"o\">[</span><span class=\"n\">comm_group</span> <span class=\"n\">G</span><span class=\"o\">]</span> <span class=\"o\">[</span><span class=\"n\">fintype</span> <span class=\"n\">G</span><span class=\"o\">]</span>\n\n<span class=\"c1\">-- given G two torsion and 1 ≠ g ∈ G, there is H &lt; G of index 2 with g ∉ H</span>\n<span class=\"kn\">lemma</span> <span class=\"n\">element_avoidance</span> <span class=\"o\">{</span><span class=\"n\">g</span> <span class=\"o\">:</span> <span class=\"n\">G</span><span class=\"o\">}</span> <span class=\"o\">(</span><span class=\"n\">h₁</span> <span class=\"o\">:</span> <span class=\"n\">g</span> <span class=\"bp\">≠</span> <span class=\"mi\">1</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">h₂</span> <span class=\"o\">:</span> <span class=\"n\">g</span> <span class=\"bp\">*</span> <span class=\"n\">g</span> <span class=\"bp\">=</span> <span class=\"mi\">1</span><span class=\"o\">):</span>\n <span class=\"bp\">∃</span> <span class=\"o\">(</span><span class=\"n\">H</span> <span class=\"o\">:</span> <span class=\"n\">subgroup</span> <span class=\"n\">G</span><span class=\"o\">)</span> <span class=\"o\">,</span> <span class=\"o\">(</span><span class=\"n\">g</span> <span class=\"err\">∉</span> <span class=\"n\">H</span> <span class=\"bp\">∧</span> <span class=\"o\">(</span><span class=\"bp\">∀</span> <span class=\"n\">x</span> <span class=\"o\">:</span> <span class=\"n\">H</span><span class=\"o\">,</span> <span class=\"n\">x</span> <span class=\"bp\">*</span> <span class=\"n\">x</span> <span class=\"bp\">=</span> <span class=\"mi\">1</span><span class=\"o\">)</span> <span class=\"bp\">∧</span> <span class=\"o\">{</span><span class=\"n\">x</span> <span class=\"o\">:</span> <span class=\"n\">G</span> <span class=\"bp\">|</span> <span class=\"n\">x</span> <span class=\"bp\">*</span> <span class=\"n\">x</span> <span class=\"bp\">=</span> <span class=\"mi\">1</span><span class=\"o\">}</span> <span class=\"bp\">=</span> <span class=\"n\">H</span> <span class=\"err\">∪</span> <span class=\"o\">(</span><span class=\"n\">left_coset</span> <span class=\"n\">g</span> <span class=\"n\">H</span><span class=\"o\">)):=</span>\n<span class=\"k\">begin</span>\n    <span class=\"n\">apply</span> <span class=\"n\">nat</span><span class=\"bp\">.</span><span class=\"n\">case_strong_induction_on</span> <span class=\"o\">(</span><span class=\"n\">fintype</span><span class=\"bp\">.</span><span class=\"n\">card</span> <span class=\"n\">G</span><span class=\"o\">),</span>\n<span class=\"kn\">end</span>\n</code></pre></div>\n\n\n<p>I want to do a proof by induction on the size of G, but it complains at the first step. I can't quite make sense of the error. In trying to debug what was going on, I went for a much stupider lemma, which I can't do either!</p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"kn\">lemma</span> <span class=\"n\">stupid</span> <span class=\"o\">{</span><span class=\"n\">g</span> <span class=\"o\">:</span> <span class=\"n\">G</span><span class=\"o\">}</span> <span class=\"o\">(</span><span class=\"n\">h₁</span> <span class=\"o\">:</span> <span class=\"n\">g</span> <span class=\"bp\">≠</span> <span class=\"mi\">1</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">h₂</span> <span class=\"o\">:</span> <span class=\"n\">g</span> <span class=\"bp\">*</span> <span class=\"n\">g</span> <span class=\"bp\">=</span> <span class=\"mi\">1</span><span class=\"o\">):</span>\n <span class=\"bp\">∃</span> <span class=\"o\">(</span><span class=\"n\">H</span> <span class=\"o\">:</span> <span class=\"n\">subgroup</span> <span class=\"n\">G</span><span class=\"o\">)</span> <span class=\"o\">,</span>  <span class=\"n\">H</span> <span class=\"bp\">=</span> <span class=\"n\">H</span> <span class=\"o\">:=</span>\n<span class=\"k\">begin</span>\n    <span class=\"n\">use</span> <span class=\"err\">↑</span><span class=\"n\">G</span><span class=\"o\">,</span> <span class=\"c1\">-- Complains!</span>\n<span class=\"kn\">end</span>\n</code></pre></div>",
        "id": 203485263,
        "sender_full_name": "Marc Masdeu",
        "timestamp": 1594372426
    },
    {
        "content": "<p>One way to get <code>G</code> as a subgroup of itself is to think of the ordering on subgroups by inclusion, <code>G</code> is then tthe maximal, or top element, so lean understands the symbol <code>\\top</code> for <code>G</code> as a sub of itself.</p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"kn\">lemma</span> <span class=\"n\">stupid</span> <span class=\"o\">{</span><span class=\"n\">g</span> <span class=\"o\">:</span> <span class=\"n\">G</span><span class=\"o\">}</span> <span class=\"o\">(</span><span class=\"n\">h₁</span> <span class=\"o\">:</span> <span class=\"n\">g</span> <span class=\"bp\">≠</span> <span class=\"mi\">1</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">h₂</span> <span class=\"o\">:</span> <span class=\"n\">g</span> <span class=\"bp\">*</span> <span class=\"n\">g</span> <span class=\"bp\">=</span> <span class=\"mi\">1</span><span class=\"o\">):</span>\n <span class=\"bp\">∃</span> <span class=\"o\">(</span><span class=\"n\">H</span> <span class=\"o\">:</span> <span class=\"n\">subgroup</span> <span class=\"n\">G</span><span class=\"o\">)</span> <span class=\"o\">,</span>  <span class=\"n\">H</span> <span class=\"bp\">=</span> <span class=\"n\">H</span> <span class=\"o\">:=</span>\n<span class=\"k\">begin</span>\n    <span class=\"n\">use</span> <span class=\"err\">⊤</span><span class=\"o\">,</span>\n<span class=\"kn\">end</span>\n</code></pre></div>",
        "id": 203488036,
        "sender_full_name": "Alex J. Best",
        "timestamp": 1594374357
    },
    {
        "content": "<p>Also, be cautious using the arrow directly, if you want to coerce something try <code>(thing : Type)</code> to tell lean which type to coerce it to, lean will print the up arrow but it can be underdetermined what you want the arrow to mean so just putting the type you want can save headaches.</p>",
        "id": 203488304,
        "sender_full_name": "Alex J. Best",
        "timestamp": 1594374542
    },
    {
        "content": "<p>Yes but isn't this like cheating? I would expect that there would be some kind of coertion mechanism that would work in this case. In particular, <code>use (G : subgroup G)</code> is more like what I'd like to work, and it doesn't. Recall that I want to really do the non-stupid lemma by induction...</p>",
        "id": 203488494,
        "sender_full_name": "Marc Masdeu",
        "timestamp": 1594374654
    },
    {
        "content": "<p>As for your first question lean gets a bit confused because it doesn't see the cardinality of <code>G</code>, or even <code>G</code> really in your goal, maybe its possible to make it work, but it seems less hassle to set this up more explicitly as a statement parameterised by the caridinality of the group</p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"kn\">lemma</span> <span class=\"n\">element_avoidance_aux</span> <span class=\"o\">{</span><span class=\"n\">n</span> <span class=\"o\">:</span> <span class=\"bp\">ℕ</span><span class=\"o\">}</span> <span class=\"o\">:</span> <span class=\"o\">(</span><span class=\"n\">fintype</span><span class=\"bp\">.</span><span class=\"n\">card</span> <span class=\"n\">G</span> <span class=\"bp\">=</span> <span class=\"n\">n</span><span class=\"o\">)</span> <span class=\"bp\">→</span> <span class=\"bp\">∀</span> <span class=\"o\">{</span><span class=\"n\">g</span> <span class=\"o\">:</span> <span class=\"n\">G</span><span class=\"o\">}</span> <span class=\"o\">(</span><span class=\"n\">h₁</span> <span class=\"o\">:</span> <span class=\"n\">g</span> <span class=\"bp\">≠</span> <span class=\"mi\">1</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">h₂</span> <span class=\"o\">:</span> <span class=\"n\">g</span> <span class=\"bp\">*</span> <span class=\"n\">g</span> <span class=\"bp\">=</span> <span class=\"mi\">1</span><span class=\"o\">),</span>\n <span class=\"bp\">∃</span> <span class=\"o\">(</span><span class=\"n\">H</span> <span class=\"o\">:</span> <span class=\"n\">subgroup</span> <span class=\"n\">G</span><span class=\"o\">)</span> <span class=\"o\">,</span> <span class=\"o\">(</span><span class=\"n\">g</span> <span class=\"err\">∉</span> <span class=\"n\">H</span> <span class=\"bp\">∧</span> <span class=\"o\">(</span><span class=\"bp\">∀</span> <span class=\"n\">x</span> <span class=\"o\">:</span> <span class=\"n\">H</span><span class=\"o\">,</span> <span class=\"n\">x</span> <span class=\"bp\">*</span> <span class=\"n\">x</span> <span class=\"bp\">=</span> <span class=\"mi\">1</span><span class=\"o\">)</span> <span class=\"bp\">∧</span> <span class=\"o\">{</span><span class=\"n\">x</span> <span class=\"o\">:</span> <span class=\"n\">G</span> <span class=\"bp\">|</span> <span class=\"n\">x</span> <span class=\"bp\">*</span> <span class=\"n\">x</span> <span class=\"bp\">=</span> <span class=\"mi\">1</span><span class=\"o\">}</span> <span class=\"bp\">=</span> <span class=\"n\">H</span> <span class=\"err\">∪</span> <span class=\"o\">(</span><span class=\"n\">left_coset</span> <span class=\"n\">g</span> <span class=\"n\">H</span><span class=\"o\">)):=</span>\n<span class=\"k\">begin</span>\n  <span class=\"n\">apply</span> <span class=\"n\">nat</span><span class=\"bp\">.</span><span class=\"n\">case_strong_induction_on</span> <span class=\"n\">n</span><span class=\"o\">,</span>\n<span class=\"kn\">end</span>\n</code></pre></div>\n\n\n<p>your original statement is then obtained as <code>element_avoidance_aux (rfl _)</code> or something like that.</p>",
        "id": 203488752,
        "sender_full_name": "Alex J. Best",
        "timestamp": 1594374844
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"254058\">Marc Masdeu</span> <a href=\"#narrow/stream/113489-new-members/topic/Frustration.20with.20finset/near/203488494\">said</a>:</p>\n<blockquote>\n<p>Yes but isn't this like cheating? I would expect that there would be some kind of coertion mechanism that would work in this case. In particular, <code>use (G : subgroup G)</code> is more like what I'd like to work, and it doesn't. Recall that I want to really do the non-stupid lemma by induction...</p>\n</blockquote>\n<p>I agree some automatic coercion would be nice, I'm just not sure how the setup would go. It doesn't seem to me to fit the coercion model: <code>G</code> is a type and you can't make a coercion from any random type to <code>subgroup G</code>, only from <code>G</code> itself.</p>\n<p>Top is a bit weird to look at at first, but its short to type, and you get all the lemmas about order (every subgroup is contained in top, nothing contains top, etc for free.</p>",
        "id": 203489157,
        "sender_full_name": "Alex J. Best",
        "timestamp": 1594375166
    },
    {
        "content": "<p>I was confused but: Ohhh I get it <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>H</mi></mrow><annotation encoding=\"application/x-tex\">H</annotation></semantics></math></span><span aria-hidden=\"true\" class=\"katex-html\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.08125em;\">H</span></span></span></span> is index 2 only in the 2-torsion.</p>",
        "id": 203491429,
        "sender_full_name": "Alex J. Best",
        "timestamp": 1594376815
    },
    {
        "content": "<p>Coercing G into subgroup G is a dependent coercion which I don't think is possible</p>",
        "id": 203509774,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1594389693
    },
    {
        "content": "<p>OK so I'm Leaning again, and managed to prove the element_avoidance lemma, modulo proving the \"obvious\" fact that a finite subgroup has finitely many subgroups:</p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"kn\">import</span> <span class=\"n\">group_theory</span><span class=\"bp\">.</span><span class=\"n\">subgroup</span>\n<span class=\"kn\">import</span> <span class=\"n\">data</span><span class=\"bp\">.</span><span class=\"n\">fintype</span><span class=\"bp\">.</span><span class=\"n\">card</span>\n<span class=\"kn\">import</span> <span class=\"n\">data</span><span class=\"bp\">.</span><span class=\"n\">set</span><span class=\"bp\">.</span><span class=\"n\">finite</span>\n<span class=\"kn\">import</span> <span class=\"n\">tactic</span>\n<span class=\"kn\">import</span> <span class=\"n\">basic</span>\n\n<span class=\"n\">open_locale</span> <span class=\"n\">classical</span> <span class=\"n\">big_operators</span>\n\n<span class=\"kn\">variables</span> <span class=\"o\">{</span><span class=\"n\">G</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span> <span class=\"o\">[</span><span class=\"n\">comm_group</span> <span class=\"n\">G</span><span class=\"o\">]</span> <span class=\"o\">[</span><span class=\"n\">fintype</span> <span class=\"n\">G</span><span class=\"o\">]</span>\n\n<span class=\"kn\">lemma</span> <span class=\"n\">finite_subgroups_of_finite_group</span> <span class=\"o\">:</span> <span class=\"o\">{</span><span class=\"n\">X</span> <span class=\"o\">:</span> <span class=\"n\">subgroup</span> <span class=\"n\">G</span> <span class=\"bp\">|</span> <span class=\"n\">true</span><span class=\"o\">}</span><span class=\"bp\">.</span><span class=\"n\">finite</span> <span class=\"o\">:=</span>\n<span class=\"k\">begin</span>\n    <span class=\"n\">sorry</span>\n<span class=\"kn\">end</span>\n</code></pre></div>\n\n\n<p>Is this something easy to do?</p>",
        "id": 205092342,
        "sender_full_name": "Marc Masdeu",
        "timestamp": 1595838941
    },
    {
        "content": "<p>it injects to <code>set G</code></p>",
        "id": 205092357,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1595838961
    },
    {
        "content": "<p>also instead of that you want to say <code>fintype (subgroup G)</code>?</p>",
        "id": 205092407,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1595838980
    },
    {
        "content": "<p>The exact statement that  I need in my proof is this one, but maybe what you suggest is also OK?</p>",
        "id": 205092447,
        "sender_full_name": "Marc Masdeu",
        "timestamp": 1595839034
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span><code><span class=\"kn\">import</span> <span class=\"n\">group_theory</span><span class=\"bp\">.</span><span class=\"n\">subgroup</span>\n<span class=\"kn\">import</span> <span class=\"n\">data</span><span class=\"bp\">.</span><span class=\"n\">fintype</span><span class=\"bp\">.</span><span class=\"n\">card</span>\n<span class=\"kn\">import</span> <span class=\"n\">data</span><span class=\"bp\">.</span><span class=\"n\">set</span><span class=\"bp\">.</span><span class=\"n\">finite</span>\n<span class=\"kn\">import</span> <span class=\"n\">tactic</span>\n\n<span class=\"n\">noncomputable</span> <span class=\"n\">theory</span>\n<span class=\"n\">open_locale</span> <span class=\"n\">classical</span> <span class=\"n\">big_operators</span>\n\n<span class=\"kn\">variables</span> <span class=\"o\">{</span><span class=\"n\">G</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span> <span class=\"o\">[</span><span class=\"n\">comm_group</span> <span class=\"n\">G</span><span class=\"o\">]</span> <span class=\"o\">[</span><span class=\"n\">fintype</span> <span class=\"n\">G</span><span class=\"o\">]</span>\n\n<span class=\"kn\">instance</span> <span class=\"o\">:</span> <span class=\"n\">fintype</span> <span class=\"o\">(</span><span class=\"n\">subgroup</span> <span class=\"n\">G</span><span class=\"o\">)</span> <span class=\"o\">:=</span>\n<span class=\"n\">fintype</span><span class=\"bp\">.</span><span class=\"n\">of_injective</span> <span class=\"o\">(</span><span class=\"n\">coe</span> <span class=\"o\">:</span> <span class=\"n\">subgroup</span> <span class=\"n\">G</span> <span class=\"bp\">→</span> <span class=\"n\">set</span> <span class=\"n\">G</span><span class=\"o\">)</span> <span class=\"err\">$</span> <span class=\"bp\">λ</span> <span class=\"bp\">_</span> <span class=\"bp\">_</span><span class=\"o\">,</span> <span class=\"n\">subgroup</span><span class=\"bp\">.</span><span class=\"n\">ext&#39;</span>\n\n<span class=\"kn\">lemma</span> <span class=\"n\">finite_subgroups_of_finite_group</span> <span class=\"o\">:</span> <span class=\"o\">{</span><span class=\"n\">X</span> <span class=\"o\">:</span> <span class=\"n\">subgroup</span> <span class=\"n\">G</span> <span class=\"bp\">|</span> <span class=\"n\">true</span><span class=\"o\">}</span><span class=\"bp\">.</span><span class=\"n\">finite</span> <span class=\"o\">:=</span>\n<span class=\"n\">set</span><span class=\"bp\">.</span><span class=\"n\">finite</span><span class=\"bp\">.</span><span class=\"n\">of_fintype</span> <span class=\"bp\">_</span>\n</code></pre></div>",
        "id": 205092546,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1595839110
    },
    {
        "content": "<p>(edited)</p>",
        "id": 205092573,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1595839155
    },
    {
        "content": "<p>Wow!! I am trying to make sense of what just happened there... I have trouble understanding finset, fintype,... And also the <code>instance</code> thingy. But thanks so much <span class=\"user-mention\" data-user-id=\"110064\">@Kenny Lau</span> !</p>",
        "id": 205092917,
        "sender_full_name": "Marc Masdeu",
        "timestamp": 1595839481
    },
    {
        "content": "<p>After minimal cleaning, this is what I got:</p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"kn\">instance</span> <span class=\"o\">:</span> <span class=\"n\">fintype</span> <span class=\"o\">(</span><span class=\"n\">subgroup</span> <span class=\"n\">G</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"n\">fintype</span><span class=\"bp\">.</span><span class=\"n\">of_injective</span> <span class=\"o\">(</span><span class=\"n\">coe</span> <span class=\"o\">:</span> <span class=\"n\">subgroup</span> <span class=\"n\">G</span> <span class=\"bp\">→</span> <span class=\"n\">set</span> <span class=\"n\">G</span><span class=\"o\">)</span> <span class=\"err\">$</span> <span class=\"bp\">λ</span> <span class=\"bp\">_</span> <span class=\"bp\">_</span><span class=\"o\">,</span> <span class=\"n\">subgroup</span><span class=\"bp\">.</span><span class=\"n\">ext&#39;</span>\n\n<span class=\"c1\">-- given a finite group G  and g ∈ G of order 2, there is H &lt; G  with g ∉ H and such that G[2] = H \\cup g H.</span>\n<span class=\"kn\">lemma</span> <span class=\"n\">element_avoidance</span> <span class=\"o\">{</span><span class=\"n\">g</span> <span class=\"o\">:</span> <span class=\"n\">G</span><span class=\"o\">}</span>  <span class=\"o\">(</span><span class=\"n\">h₁</span> <span class=\"o\">:</span> <span class=\"n\">g</span> <span class=\"bp\">≠</span> <span class=\"mi\">1</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">h₂</span> <span class=\"o\">:</span> <span class=\"n\">g</span> <span class=\"bp\">*</span> <span class=\"n\">g</span> <span class=\"bp\">=</span> <span class=\"mi\">1</span><span class=\"o\">):</span>\n <span class=\"bp\">∃</span> <span class=\"o\">(</span><span class=\"n\">H</span> <span class=\"o\">:</span> <span class=\"n\">subgroup</span> <span class=\"n\">G</span><span class=\"o\">)</span> <span class=\"o\">,</span>\n  <span class=\"o\">(</span><span class=\"n\">g</span> <span class=\"err\">∉</span> <span class=\"n\">H</span> <span class=\"bp\">∧</span>\n  <span class=\"o\">(</span><span class=\"bp\">∀</span> <span class=\"o\">(</span><span class=\"n\">x</span> <span class=\"o\">:</span> <span class=\"n\">G</span><span class=\"o\">),</span> <span class=\"n\">x</span> <span class=\"err\">∈</span> <span class=\"n\">H</span> <span class=\"bp\">→</span> <span class=\"n\">x</span> <span class=\"bp\">*</span> <span class=\"n\">x</span> <span class=\"bp\">=</span> <span class=\"mi\">1</span><span class=\"o\">)</span> <span class=\"bp\">∧</span>\n  <span class=\"o\">{</span><span class=\"n\">x</span> <span class=\"o\">:</span> <span class=\"n\">G</span> <span class=\"bp\">|</span> <span class=\"n\">x</span> <span class=\"bp\">*</span> <span class=\"n\">x</span> <span class=\"bp\">=</span> <span class=\"mi\">1</span><span class=\"o\">}</span> <span class=\"bp\">=</span> <span class=\"n\">H</span> <span class=\"err\">∪</span> <span class=\"o\">(</span><span class=\"n\">left_coset</span> <span class=\"n\">g</span> <span class=\"n\">H</span><span class=\"o\">))</span>\n  <span class=\"o\">:=</span>\n<span class=\"k\">begin</span>\n    <span class=\"k\">let</span> <span class=\"n\">s</span> <span class=\"o\">:=</span> <span class=\"o\">{</span><span class=\"n\">X</span> <span class=\"o\">:</span> <span class=\"n\">subgroup</span> <span class=\"n\">G</span> <span class=\"bp\">|</span> <span class=\"n\">g</span> <span class=\"err\">∉</span> <span class=\"n\">X</span> <span class=\"bp\">∧</span> <span class=\"o\">(</span><span class=\"bp\">∀</span> <span class=\"n\">x</span> <span class=\"o\">:</span> <span class=\"n\">G</span><span class=\"o\">,</span> <span class=\"n\">x</span> <span class=\"err\">∈</span> <span class=\"n\">X</span> <span class=\"bp\">→</span> <span class=\"n\">x</span><span class=\"bp\">*</span><span class=\"n\">x</span> <span class=\"bp\">=</span> <span class=\"mi\">1</span><span class=\"o\">)},</span>\n    <span class=\"k\">have</span> <span class=\"n\">sfin</span> <span class=\"o\">:</span> <span class=\"n\">s</span><span class=\"bp\">.</span><span class=\"n\">finite</span> <span class=\"o\">:=</span> <span class=\"n\">set</span><span class=\"bp\">.</span><span class=\"n\">finite</span><span class=\"bp\">.</span><span class=\"n\">of_fintype</span> <span class=\"bp\">_</span><span class=\"o\">,</span>\n    <span class=\"k\">have</span> <span class=\"n\">snonempty</span> <span class=\"o\">:</span> <span class=\"n\">set</span><span class=\"bp\">.</span><span class=\"n\">nonempty</span> <span class=\"n\">s</span><span class=\"o\">,</span>\n    <span class=\"o\">{</span>\n        <span class=\"n\">use</span> <span class=\"err\">⊥</span><span class=\"o\">,</span>\n        <span class=\"n\">split</span><span class=\"o\">,</span>\n        <span class=\"n\">exact</span> <span class=\"n\">h₁</span><span class=\"o\">,</span>\n        <span class=\"n\">intros</span> <span class=\"n\">x</span> <span class=\"n\">hx</span><span class=\"o\">,</span>\n        <span class=\"n\">rw</span> <span class=\"n\">subgroup</span><span class=\"bp\">.</span><span class=\"n\">mem_bot</span> <span class=\"n\">at</span> <span class=\"n\">hx</span><span class=\"o\">,</span>\n        <span class=\"n\">rw</span> <span class=\"n\">hx</span><span class=\"o\">,</span>\n        <span class=\"n\">exact</span> <span class=\"n\">mul_one</span> <span class=\"mi\">1</span><span class=\"o\">,</span>\n    <span class=\"o\">},</span>\n    <span class=\"k\">let</span> <span class=\"n\">existsH</span> <span class=\"o\">:=</span> <span class=\"n\">set</span><span class=\"bp\">.</span><span class=\"n\">finite</span><span class=\"bp\">.</span><span class=\"n\">exists_maximal_wrt</span> <span class=\"n\">id</span> <span class=\"n\">s</span> <span class=\"n\">sfin</span> <span class=\"n\">snonempty</span><span class=\"o\">,</span>\n    <span class=\"n\">simp</span> <span class=\"n\">only</span> <span class=\"o\">[</span><span class=\"n\">and_imp</span><span class=\"o\">,</span> <span class=\"n\">exists_prop</span><span class=\"o\">,</span> <span class=\"n\">id</span><span class=\"bp\">.</span><span class=\"n\">def</span><span class=\"o\">,</span> <span class=\"n\">set</span><span class=\"bp\">.</span><span class=\"n\">mem_set_of_eq</span><span class=\"o\">]</span> <span class=\"n\">at</span> <span class=\"n\">existsH</span><span class=\"o\">,</span>\n    <span class=\"n\">cases</span> <span class=\"n\">existsH</span> <span class=\"k\">with</span> <span class=\"n\">a</span> <span class=\"n\">ha</span><span class=\"o\">,</span>\n    <span class=\"n\">use</span> <span class=\"n\">a</span><span class=\"o\">,</span>\n    <span class=\"n\">split</span><span class=\"o\">,</span>\n    <span class=\"n\">exact</span> <span class=\"n\">ha</span><span class=\"bp\">.</span><span class=\"mi\">1</span><span class=\"bp\">.</span><span class=\"mi\">1</span><span class=\"o\">,</span>\n    <span class=\"n\">split</span><span class=\"o\">,</span>\n    <span class=\"n\">exact</span> <span class=\"n\">ha</span><span class=\"bp\">.</span><span class=\"mi\">1</span><span class=\"bp\">.</span><span class=\"mi\">2</span><span class=\"o\">,</span>\n    <span class=\"c1\">-- We have defined a as the maximal subgroup of G satisfying</span>\n    <span class=\"c1\">-- 1) g ∉ a</span>\n    <span class=\"c1\">-- 2) ∀ x ∈ a, x*x = 1</span>\n    <span class=\"c1\">-- Now we must show that a ∪ ga = twotorsion(G)</span>\n    <span class=\"n\">apply</span> <span class=\"n\">set</span><span class=\"bp\">.</span><span class=\"n\">subset</span><span class=\"bp\">.</span><span class=\"n\">antisymm</span><span class=\"o\">,</span>\n    <span class=\"o\">{</span>\n        <span class=\"c1\">-- Prove that twotorsion(G) ⊆ a u ga</span>\n        <span class=\"n\">intros</span> <span class=\"n\">x</span> <span class=\"n\">hx</span><span class=\"o\">,</span>\n        <span class=\"n\">dsimp</span> <span class=\"n\">at</span> <span class=\"n\">hx</span><span class=\"o\">,</span>\n        <span class=\"n\">rcases</span> <span class=\"n\">ha</span> <span class=\"k\">with</span> <span class=\"bp\">⟨</span>  <span class=\"n\">ha1</span><span class=\"o\">,</span> <span class=\"n\">hmax</span> <span class=\"bp\">⟩</span> <span class=\"o\">,</span>\n        <span class=\"n\">cases</span> <span class=\"n\">ha1</span> <span class=\"k\">with</span> <span class=\"n\">hga</span> <span class=\"n\">hatwotors</span><span class=\"o\">,</span>\n\n        <span class=\"n\">by_contradiction</span> <span class=\"n\">h</span><span class=\"o\">,</span>\n        <span class=\"k\">have</span> <span class=\"n\">x_eq_xinv</span> <span class=\"o\">:</span> <span class=\"n\">x</span> <span class=\"bp\">=</span> <span class=\"n\">x</span><span class=\"bp\">⁻¹</span> <span class=\"o\">:=</span> <span class=\"n\">eq_inv_of_mul_eq_one</span> <span class=\"n\">hx</span><span class=\"o\">,</span>\n        <span class=\"k\">let</span> <span class=\"n\">xua</span> <span class=\"o\">:</span> <span class=\"n\">subgroup</span> <span class=\"n\">G</span> <span class=\"o\">:=</span>\n        <span class=\"o\">{</span>\n            <span class=\"n\">carrier</span> <span class=\"o\">:=</span> <span class=\"err\">↑</span><span class=\"n\">a</span> <span class=\"err\">∪</span> <span class=\"n\">left_coset</span> <span class=\"n\">x</span> <span class=\"n\">a</span><span class=\"o\">,</span>\n            <span class=\"n\">one_mem&#39;</span> <span class=\"o\">:=</span> <span class=\"n\">or</span><span class=\"bp\">.</span><span class=\"n\">inl</span> <span class=\"o\">(</span><span class=\"n\">subgroup</span><span class=\"bp\">.</span><span class=\"n\">one_mem</span> <span class=\"n\">a</span><span class=\"o\">),</span>\n            <span class=\"n\">mul_mem&#39;</span> <span class=\"o\">:=</span>\n            <span class=\"k\">begin</span>\n            <span class=\"n\">intros</span> <span class=\"n\">u</span> <span class=\"n\">v</span> <span class=\"n\">hu</span> <span class=\"n\">hv</span><span class=\"o\">,</span>\n            <span class=\"n\">cases</span> <span class=\"n\">hv</span> <span class=\"k\">with</span> <span class=\"n\">hv1</span> <span class=\"n\">hv2</span><span class=\"o\">,</span>\n            <span class=\"o\">{</span>\n                <span class=\"n\">cases</span> <span class=\"n\">hu</span> <span class=\"k\">with</span> <span class=\"n\">hu1</span> <span class=\"n\">hu2</span><span class=\"o\">,</span>\n                <span class=\"o\">{</span>\n                    <span class=\"n\">exact</span> <span class=\"n\">or</span><span class=\"bp\">.</span><span class=\"n\">inl</span> <span class=\"o\">(</span><span class=\"n\">subgroup</span><span class=\"bp\">.</span><span class=\"n\">mul_mem</span> <span class=\"n\">a</span> <span class=\"n\">hu1</span> <span class=\"n\">hv1</span><span class=\"o\">),</span>\n                <span class=\"o\">},</span>\n                <span class=\"o\">{</span>\n                    <span class=\"n\">right</span><span class=\"o\">,</span>\n                    <span class=\"n\">rw</span> <span class=\"o\">[</span><span class=\"n\">mem_left_coset_iff</span><span class=\"o\">,</span> <span class=\"err\">←</span><span class=\"n\">mul_assoc</span><span class=\"o\">],</span>\n                    <span class=\"n\">rw</span> <span class=\"n\">mem_left_coset_iff</span> <span class=\"n\">at</span> <span class=\"n\">hu2</span><span class=\"o\">,</span>\n                    <span class=\"n\">exact</span> <span class=\"n\">is_submonoid</span><span class=\"bp\">.</span><span class=\"n\">mul_mem</span> <span class=\"n\">hu2</span> <span class=\"n\">hv1</span><span class=\"o\">,</span>\n                <span class=\"o\">}</span>\n            <span class=\"o\">},</span>\n            <span class=\"o\">{</span>\n                <span class=\"n\">cases</span> <span class=\"n\">hu</span> <span class=\"k\">with</span> <span class=\"n\">hu1</span> <span class=\"n\">hu2</span><span class=\"o\">,</span>\n                <span class=\"o\">{</span>\n                    <span class=\"n\">right</span><span class=\"o\">,</span>\n                    <span class=\"n\">rw</span> <span class=\"o\">[</span><span class=\"n\">mul_comm</span><span class=\"o\">,</span> <span class=\"n\">mem_left_coset_iff</span><span class=\"o\">,</span> <span class=\"err\">←</span><span class=\"n\">mul_assoc</span><span class=\"o\">],</span>\n                    <span class=\"n\">rw</span> <span class=\"n\">mem_left_coset_iff</span> <span class=\"n\">at</span> <span class=\"n\">hv2</span><span class=\"o\">,</span>\n                    <span class=\"n\">exact</span> <span class=\"n\">is_submonoid</span><span class=\"bp\">.</span><span class=\"n\">mul_mem</span> <span class=\"n\">hv2</span> <span class=\"n\">hu1</span><span class=\"o\">,</span>\n                <span class=\"o\">},</span>\n                <span class=\"o\">{</span>\n                    <span class=\"n\">left</span><span class=\"o\">,</span>\n                    <span class=\"n\">rw</span> <span class=\"n\">mem_left_coset_iff</span> <span class=\"n\">at</span> <span class=\"n\">hu2</span> <span class=\"n\">hv2</span><span class=\"o\">,</span>\n                    <span class=\"k\">have</span> <span class=\"n\">H</span> <span class=\"o\">:</span> <span class=\"n\">x</span><span class=\"bp\">⁻¹</span> <span class=\"bp\">*</span> <span class=\"n\">x</span><span class=\"bp\">⁻¹</span> <span class=\"bp\">*</span> <span class=\"n\">u</span> <span class=\"bp\">*</span> <span class=\"n\">v</span> <span class=\"err\">∈</span> <span class=\"n\">a</span><span class=\"o\">,</span>\n                    <span class=\"o\">{</span>\n                        <span class=\"n\">norm_cast</span> <span class=\"n\">at</span> <span class=\"n\">hu2</span> <span class=\"n\">hv2</span> <span class=\"err\">⊢</span><span class=\"o\">,</span>\n                        <span class=\"n\">rw</span> <span class=\"o\">[</span><span class=\"n\">mul_comm</span><span class=\"o\">,</span> <span class=\"n\">mul_assoc</span><span class=\"o\">,</span> <span class=\"err\">←</span><span class=\"n\">mul_assoc</span> <span class=\"n\">v</span> <span class=\"bp\">_</span><span class=\"o\">,</span> <span class=\"n\">mul_comm</span> <span class=\"n\">v</span> <span class=\"bp\">_</span><span class=\"o\">],</span>\n                        <span class=\"n\">exact</span> <span class=\"n\">subgroup</span><span class=\"bp\">.</span><span class=\"n\">mul_mem</span> <span class=\"n\">a</span> <span class=\"n\">hv2</span> <span class=\"n\">hu2</span><span class=\"o\">,</span>\n                    <span class=\"o\">},</span>\n                    <span class=\"n\">rw</span> <span class=\"o\">[</span><span class=\"err\">←</span><span class=\"n\">x_eq_xinv</span><span class=\"o\">,</span> <span class=\"n\">hx</span><span class=\"o\">,</span> <span class=\"n\">one_mul</span><span class=\"o\">]</span> <span class=\"n\">at</span> <span class=\"n\">H</span><span class=\"o\">,</span>\n                    <span class=\"n\">exact</span> <span class=\"n\">H</span><span class=\"o\">,</span>\n                <span class=\"o\">},</span>\n            <span class=\"o\">},</span>\n            <span class=\"kn\">end</span><span class=\"o\">,</span>\n            <span class=\"n\">inv_mem&#39;</span> <span class=\"o\">:=</span>\n            <span class=\"k\">begin</span>\n                <span class=\"n\">intros</span> <span class=\"n\">u</span> <span class=\"n\">hu</span><span class=\"o\">,</span>\n                <span class=\"n\">cases</span> <span class=\"n\">hu</span> <span class=\"k\">with</span> <span class=\"n\">hu1</span> <span class=\"n\">hu2</span><span class=\"o\">,</span>\n                <span class=\"o\">{</span>\n                    <span class=\"n\">exact</span> <span class=\"n\">or</span><span class=\"bp\">.</span><span class=\"n\">inl</span> <span class=\"o\">(</span><span class=\"n\">is_subgroup</span><span class=\"bp\">.</span><span class=\"n\">inv_mem</span> <span class=\"n\">hu1</span><span class=\"o\">),</span>\n                <span class=\"o\">},</span>\n                <span class=\"o\">{</span>\n                    <span class=\"n\">right</span><span class=\"o\">,</span>\n                    <span class=\"n\">rw</span> <span class=\"n\">mem_left_coset_iff</span> <span class=\"n\">at</span> <span class=\"n\">hu2</span> <span class=\"err\">⊢</span><span class=\"o\">,</span>\n                    <span class=\"n\">norm_cast</span> <span class=\"n\">at</span> <span class=\"n\">hu2</span> <span class=\"err\">⊢</span><span class=\"o\">,</span>\n                    <span class=\"n\">rw</span> <span class=\"o\">[</span><span class=\"err\">←</span><span class=\"n\">subgroup</span><span class=\"bp\">.</span><span class=\"n\">inv_mem_iff</span><span class=\"o\">,</span> <span class=\"n\">mul_inv</span><span class=\"o\">,</span> <span class=\"n\">inv_inv</span><span class=\"o\">,</span> <span class=\"n\">inv_inv</span><span class=\"o\">],</span>\n                    <span class=\"n\">rw</span> <span class=\"err\">←</span><span class=\"n\">x_eq_xinv</span> <span class=\"n\">at</span> <span class=\"n\">hu2</span><span class=\"o\">,</span>\n                    <span class=\"n\">exact</span> <span class=\"n\">hu2</span><span class=\"o\">,</span>\n                <span class=\"o\">}</span>\n            <span class=\"kn\">end</span>\n        <span class=\"o\">},</span>\n        <span class=\"k\">have</span> <span class=\"n\">hxinxua</span> <span class=\"o\">:</span> <span class=\"bp\">∀</span> <span class=\"n\">y</span> <span class=\"o\">:</span> <span class=\"n\">G</span><span class=\"o\">,</span> <span class=\"n\">y</span> <span class=\"err\">∈</span> <span class=\"n\">xua</span> <span class=\"bp\">↔</span> <span class=\"o\">(</span><span class=\"n\">y</span> <span class=\"err\">∈</span> <span class=\"err\">↑</span><span class=\"n\">a</span> <span class=\"bp\">∨</span> <span class=\"n\">y</span> <span class=\"err\">∈</span> <span class=\"n\">left_coset</span> <span class=\"n\">x</span> <span class=\"n\">a</span><span class=\"o\">),</span> <span class=\"k\">by</span> <span class=\"n\">apply</span> <span class=\"n\">subgroup</span><span class=\"bp\">.</span><span class=\"n\">mem_coe</span><span class=\"o\">,</span>\n        <span class=\"n\">specialize</span> <span class=\"n\">hmax</span> <span class=\"n\">xua</span><span class=\"o\">,</span>\n        <span class=\"k\">have</span> <span class=\"n\">g_notin_xua</span> <span class=\"o\">:</span> <span class=\"n\">g</span> <span class=\"err\">∉</span> <span class=\"n\">xua</span><span class=\"o\">,</span>\n        <span class=\"o\">{</span>\n            <span class=\"n\">clear</span> <span class=\"n\">hmax</span><span class=\"o\">,</span>\n            <span class=\"n\">by_contradiction</span> <span class=\"n\">cont</span><span class=\"o\">,</span>\n            <span class=\"n\">cases</span> <span class=\"n\">cont</span> <span class=\"k\">with</span> <span class=\"n\">c1</span> <span class=\"n\">c2</span><span class=\"o\">,</span>\n            <span class=\"o\">{</span>\n                <span class=\"n\">solve_by_elim</span><span class=\"o\">,</span>\n            <span class=\"o\">},</span>\n            <span class=\"o\">{</span>\n                <span class=\"n\">rw</span> <span class=\"n\">mem_left_coset_iff</span> <span class=\"n\">at</span> <span class=\"n\">c2</span><span class=\"o\">,</span>\n                <span class=\"k\">have</span> <span class=\"n\">h2</span><span class=\"o\">:</span> <span class=\"n\">x</span> <span class=\"err\">∉</span> <span class=\"n\">left_coset</span> <span class=\"n\">g</span> <span class=\"err\">↑</span><span class=\"n\">a</span><span class=\"o\">,</span>\n                <span class=\"o\">{</span>\n                    <span class=\"n\">rw</span> <span class=\"n\">set</span><span class=\"bp\">.</span><span class=\"n\">mem_union_eq</span> <span class=\"n\">at</span> <span class=\"n\">h</span><span class=\"o\">,</span>\n                    <span class=\"n\">push_neg</span> <span class=\"n\">at</span> <span class=\"n\">h</span><span class=\"o\">,</span>\n                    <span class=\"n\">exact</span> <span class=\"n\">h</span><span class=\"bp\">.</span><span class=\"n\">right</span><span class=\"o\">,</span>\n                <span class=\"o\">},</span>\n                <span class=\"n\">rw</span> <span class=\"n\">mem_left_coset_iff</span> <span class=\"n\">at</span> <span class=\"n\">h2</span><span class=\"o\">,</span>\n                <span class=\"n\">suffices</span> <span class=\"n\">h3</span><span class=\"o\">:</span> <span class=\"n\">g</span><span class=\"bp\">⁻¹</span> <span class=\"bp\">*</span> <span class=\"n\">x</span> <span class=\"err\">∈</span> <span class=\"err\">↑</span><span class=\"n\">a</span><span class=\"o\">,</span> <span class=\"k\">by</span> <span class=\"n\">solve_by_elim</span><span class=\"o\">,</span>\n                <span class=\"n\">norm_cast</span> <span class=\"n\">at</span> <span class=\"bp\">*</span><span class=\"o\">,</span>\n                <span class=\"n\">rw</span> <span class=\"o\">[</span><span class=\"err\">←</span><span class=\"n\">subgroup</span><span class=\"bp\">.</span><span class=\"n\">inv_mem_iff</span><span class=\"o\">,</span> <span class=\"n\">mul_inv</span><span class=\"o\">,</span> <span class=\"n\">mul_comm</span><span class=\"o\">,</span> <span class=\"n\">inv_inv</span><span class=\"o\">],</span>\n                <span class=\"n\">exact</span> <span class=\"n\">c2</span><span class=\"o\">,</span>\n            <span class=\"o\">}</span>\n        <span class=\"o\">},</span>\n        <span class=\"n\">specialize</span> <span class=\"n\">hmax</span> <span class=\"n\">g_notin_xua</span><span class=\"o\">,</span>\n        <span class=\"k\">have</span> <span class=\"n\">h_twotors</span> <span class=\"o\">:</span> <span class=\"o\">(</span><span class=\"bp\">∀</span> <span class=\"o\">(</span><span class=\"n\">y</span> <span class=\"o\">:</span> <span class=\"n\">G</span><span class=\"o\">),</span> <span class=\"n\">y</span> <span class=\"err\">∈</span> <span class=\"n\">xua</span> <span class=\"bp\">→</span> <span class=\"n\">y</span> <span class=\"bp\">*</span> <span class=\"n\">y</span> <span class=\"bp\">=</span> <span class=\"mi\">1</span><span class=\"o\">),</span>\n        <span class=\"o\">{</span>\n            <span class=\"n\">intros</span> <span class=\"n\">y</span> <span class=\"n\">hy</span><span class=\"o\">,</span>\n            <span class=\"n\">rw</span> <span class=\"n\">hxinxua</span> <span class=\"n\">at</span> <span class=\"n\">hy</span><span class=\"o\">,</span>\n            <span class=\"n\">cases</span> <span class=\"n\">hy</span><span class=\"o\">,</span>\n            <span class=\"o\">{</span>\n                <span class=\"n\">apply</span> <span class=\"n\">hatwotors</span><span class=\"o\">,</span>\n                <span class=\"n\">exact</span> <span class=\"n\">subgroup</span><span class=\"bp\">.</span><span class=\"n\">mem_coe</span><span class=\"bp\">.</span><span class=\"n\">mp</span> <span class=\"n\">hy</span><span class=\"o\">,</span>\n            <span class=\"o\">},</span>\n            <span class=\"o\">{</span>\n                <span class=\"n\">rw</span> <span class=\"n\">mem_left_coset_iff</span> <span class=\"n\">at</span> <span class=\"n\">hy</span><span class=\"o\">,</span>\n                <span class=\"k\">have</span> <span class=\"n\">HH</span> <span class=\"o\">:</span> <span class=\"bp\">∃</span> <span class=\"n\">w</span> <span class=\"err\">∈</span> <span class=\"n\">a</span><span class=\"o\">,</span> <span class=\"n\">x</span><span class=\"bp\">⁻¹</span> <span class=\"bp\">*</span> <span class=\"n\">y</span> <span class=\"bp\">=</span> <span class=\"n\">w</span><span class=\"o\">,</span> <span class=\"k\">by</span> <span class=\"n\">tauto</span><span class=\"o\">,</span>\n                <span class=\"n\">cases</span> <span class=\"n\">HH</span> <span class=\"k\">with</span> <span class=\"n\">w</span> <span class=\"n\">hw</span><span class=\"o\">,</span>\n                <span class=\"n\">cases</span> <span class=\"n\">hw</span> <span class=\"k\">with</span> <span class=\"n\">hw1</span> <span class=\"n\">hw2</span><span class=\"o\">,</span>\n                <span class=\"k\">have</span> <span class=\"n\">hhy</span> <span class=\"o\">:</span> <span class=\"n\">y</span> <span class=\"bp\">=</span> <span class=\"n\">x</span> <span class=\"bp\">*</span> <span class=\"n\">w</span> <span class=\"o\">:=</span> <span class=\"n\">eq_mul_of_inv_mul_eq</span> <span class=\"n\">hw2</span><span class=\"o\">,</span>\n                <span class=\"k\">calc</span>\n                <span class=\"n\">y</span> <span class=\"bp\">*</span> <span class=\"n\">y</span> <span class=\"bp\">=</span> <span class=\"o\">(</span><span class=\"n\">x</span> <span class=\"bp\">*</span> <span class=\"n\">w</span><span class=\"o\">)</span> <span class=\"bp\">*</span> <span class=\"o\">(</span><span class=\"n\">x</span> <span class=\"bp\">*</span> <span class=\"n\">w</span><span class=\"o\">):</span> <span class=\"n\">congr</span> <span class=\"o\">(</span><span class=\"n\">congr_arg</span> <span class=\"n\">has_mul</span><span class=\"bp\">.</span><span class=\"n\">mul</span> <span class=\"n\">hhy</span><span class=\"o\">)</span> <span class=\"n\">hhy</span>\n                <span class=\"bp\">...</span>   <span class=\"bp\">=</span> <span class=\"o\">(</span><span class=\"n\">x</span> <span class=\"bp\">*</span> <span class=\"n\">x</span><span class=\"o\">)</span> <span class=\"bp\">*</span> <span class=\"o\">(</span><span class=\"n\">w</span> <span class=\"bp\">*</span> <span class=\"n\">w</span><span class=\"o\">):</span> <span class=\"n\">mul_mul_mul_comm</span> <span class=\"n\">x</span> <span class=\"n\">w</span> <span class=\"n\">x</span> <span class=\"n\">w</span>\n                <span class=\"bp\">...</span>   <span class=\"bp\">=</span> <span class=\"n\">w</span> <span class=\"bp\">*</span> <span class=\"n\">w</span> <span class=\"o\">:</span> <span class=\"n\">mul_left_eq_self</span><span class=\"bp\">.</span><span class=\"n\">mpr</span> <span class=\"n\">hx</span>\n                <span class=\"bp\">...</span>   <span class=\"bp\">=</span> <span class=\"mi\">1</span>      <span class=\"o\">:</span> <span class=\"n\">hatwotors</span> <span class=\"n\">w</span> <span class=\"n\">hw1</span><span class=\"o\">,</span>\n            <span class=\"o\">}</span>\n        <span class=\"o\">},</span>\n        <span class=\"n\">specialize</span> <span class=\"n\">hmax</span> <span class=\"n\">h_twotors</span><span class=\"o\">,</span>\n        <span class=\"k\">have</span> <span class=\"n\">htriv</span> <span class=\"o\">:</span> <span class=\"n\">a</span> <span class=\"bp\">≤</span> <span class=\"n\">xua</span><span class=\"o\">,</span>\n        <span class=\"o\">{</span>\n            <span class=\"n\">rw</span> <span class=\"n\">subgroup</span><span class=\"bp\">.</span><span class=\"n\">le_def</span><span class=\"o\">,</span>\n            <span class=\"n\">intros</span> <span class=\"n\">y</span> <span class=\"n\">hy</span><span class=\"o\">,</span>\n            <span class=\"n\">rw</span> <span class=\"n\">hxinxua</span><span class=\"o\">,</span>\n            <span class=\"n\">left</span><span class=\"o\">,</span>\n            <span class=\"n\">exact</span> <span class=\"n\">hy</span><span class=\"o\">,</span>\n        <span class=\"o\">},</span>\n        <span class=\"n\">specialize</span> <span class=\"n\">hmax</span> <span class=\"n\">htriv</span><span class=\"o\">,</span>\n        <span class=\"k\">have</span> <span class=\"n\">hc</span> <span class=\"o\">:</span> <span class=\"n\">x</span> <span class=\"err\">∈</span> <span class=\"n\">a</span><span class=\"o\">,</span>\n        <span class=\"o\">{</span>\n            <span class=\"n\">norm_cast</span> <span class=\"n\">at</span> <span class=\"bp\">*</span><span class=\"o\">,</span>\n            <span class=\"n\">rw</span> <span class=\"n\">hmax</span><span class=\"o\">,</span>\n            <span class=\"n\">clear</span> <span class=\"n\">sfin</span> <span class=\"n\">snonempty</span> <span class=\"n\">s</span> <span class=\"n\">hga</span> <span class=\"n\">hatwotors</span> <span class=\"n\">h</span> <span class=\"n\">g_notin_xua</span> <span class=\"n\">htriv</span> <span class=\"n\">h_twotors</span> <span class=\"n\">h₁</span> <span class=\"n\">h₂</span> <span class=\"n\">hmax</span><span class=\"o\">,</span>\n            <span class=\"n\">dsimp</span> <span class=\"n\">at</span> <span class=\"bp\">*</span><span class=\"o\">,</span>\n            <span class=\"n\">rw</span> <span class=\"n\">hxinxua</span><span class=\"o\">,</span>\n            <span class=\"n\">right</span><span class=\"o\">,</span>\n            <span class=\"n\">rw</span> <span class=\"n\">mem_left_coset_iff</span><span class=\"o\">,</span>\n            <span class=\"n\">exact</span> <span class=\"n\">quotient_group</span><span class=\"bp\">.</span><span class=\"n\">eq</span><span class=\"bp\">.</span><span class=\"n\">mp</span> <span class=\"n\">rfl</span><span class=\"o\">,</span>\n        <span class=\"o\">},</span>\n        <span class=\"k\">have</span> <span class=\"n\">hl</span> <span class=\"o\">:</span> <span class=\"n\">x</span> <span class=\"err\">∉</span> <span class=\"n\">a</span><span class=\"o\">,</span>\n        <span class=\"o\">{</span>\n            <span class=\"n\">rw</span> <span class=\"n\">set</span><span class=\"bp\">.</span><span class=\"n\">mem_union</span> <span class=\"n\">at</span> <span class=\"n\">h</span><span class=\"o\">,</span>\n            <span class=\"n\">push_neg</span> <span class=\"n\">at</span> <span class=\"n\">h</span><span class=\"o\">,</span>\n            <span class=\"n\">exact</span> <span class=\"n\">h</span><span class=\"bp\">.</span><span class=\"n\">left</span>\n        <span class=\"o\">},</span>\n        <span class=\"n\">solve_by_elim</span><span class=\"o\">,</span>\n    <span class=\"o\">},</span>\n    <span class=\"o\">{</span>\n        <span class=\"c1\">-- prove that twotorsion(G) ⊇ a u ga</span>\n        <span class=\"n\">intros</span> <span class=\"n\">x</span> <span class=\"n\">hx</span><span class=\"o\">,</span>\n        <span class=\"n\">by_cases</span> <span class=\"o\">(</span><span class=\"n\">x</span> <span class=\"err\">∈</span> <span class=\"n\">a</span><span class=\"o\">),</span>\n        <span class=\"n\">tauto</span><span class=\"o\">,</span>\n        <span class=\"o\">{</span>\n            <span class=\"k\">have</span> <span class=\"n\">H</span> <span class=\"o\">:</span> <span class=\"o\">(</span><span class=\"n\">x</span> <span class=\"err\">∈</span> <span class=\"n\">left_coset</span> <span class=\"n\">g</span> <span class=\"n\">a</span><span class=\"o\">),</span>\n            <span class=\"o\">{</span>\n                <span class=\"n\">rw</span> <span class=\"n\">set</span><span class=\"bp\">.</span><span class=\"n\">mem_union</span> <span class=\"n\">at</span> <span class=\"n\">hx</span><span class=\"o\">,</span>\n                <span class=\"n\">tauto</span><span class=\"o\">,</span>\n            <span class=\"o\">},</span>\n            <span class=\"n\">suffices</span> <span class=\"n\">x_is_twotors</span> <span class=\"o\">:</span> <span class=\"n\">x</span> <span class=\"bp\">*</span> <span class=\"n\">x</span> <span class=\"bp\">=</span> <span class=\"mi\">1</span><span class=\"o\">,</span> <span class=\"k\">by</span> <span class=\"n\">tauto</span><span class=\"o\">,</span>\n            <span class=\"n\">clear</span> <span class=\"n\">hx</span> <span class=\"n\">h</span><span class=\"o\">,</span>\n            <span class=\"k\">have</span> <span class=\"n\">H2</span> <span class=\"o\">:</span> <span class=\"bp\">∀</span> <span class=\"o\">(</span><span class=\"n\">x</span> <span class=\"o\">:</span> <span class=\"n\">G</span><span class=\"o\">),</span> <span class=\"n\">x</span> <span class=\"err\">∈</span> <span class=\"n\">a</span> <span class=\"bp\">→</span> <span class=\"n\">x</span> <span class=\"bp\">*</span> <span class=\"n\">x</span> <span class=\"bp\">=</span> <span class=\"mi\">1</span><span class=\"o\">,</span> <span class=\"k\">by</span> <span class=\"n\">tauto</span><span class=\"o\">,</span>\n            <span class=\"n\">rw</span> <span class=\"n\">mem_left_coset_iff</span> <span class=\"n\">at</span> <span class=\"n\">H</span><span class=\"o\">,</span>\n            <span class=\"n\">specialize</span> <span class=\"n\">H2</span>  <span class=\"o\">(</span><span class=\"n\">g</span><span class=\"bp\">⁻¹</span> <span class=\"bp\">*</span> <span class=\"n\">x</span><span class=\"o\">)</span> <span class=\"n\">H</span><span class=\"o\">,</span>\n            <span class=\"k\">have</span> <span class=\"n\">H3</span> <span class=\"o\">:</span> <span class=\"n\">g</span> <span class=\"bp\">=</span> <span class=\"n\">g</span><span class=\"bp\">⁻¹</span> <span class=\"o\">:=</span> <span class=\"n\">eq_inv_of_mul_eq_one</span> <span class=\"n\">h₂</span><span class=\"o\">,</span>\n            <span class=\"k\">by</span> <span class=\"k\">calc</span>\n            <span class=\"n\">x</span> <span class=\"bp\">*</span> <span class=\"n\">x</span> <span class=\"bp\">=</span> <span class=\"n\">g</span> <span class=\"bp\">*</span> <span class=\"n\">g</span> <span class=\"bp\">*</span> <span class=\"n\">x</span> <span class=\"bp\">*</span> <span class=\"n\">x</span> <span class=\"o\">:</span> <span class=\"k\">by</span> <span class=\"n\">simp</span> <span class=\"n\">only</span> <span class=\"o\">[</span><span class=\"n\">h₂</span><span class=\"o\">,</span> <span class=\"n\">one_mul</span><span class=\"o\">]</span>\n            <span class=\"bp\">...</span>   <span class=\"bp\">=</span> <span class=\"n\">g</span><span class=\"bp\">⁻¹</span> <span class=\"bp\">*</span> <span class=\"n\">g</span><span class=\"bp\">⁻¹</span> <span class=\"bp\">*</span> <span class=\"n\">x</span> <span class=\"bp\">*</span> <span class=\"n\">x</span> <span class=\"o\">:</span> <span class=\"k\">by</span> <span class=\"n\">rw</span> <span class=\"err\">←</span> <span class=\"n\">H3</span>\n            <span class=\"bp\">...</span>   <span class=\"bp\">=</span> <span class=\"n\">g</span><span class=\"bp\">⁻¹</span> <span class=\"bp\">*</span> <span class=\"n\">x</span> <span class=\"bp\">*</span> <span class=\"n\">g</span><span class=\"bp\">⁻¹</span> <span class=\"bp\">*</span> <span class=\"n\">x</span> <span class=\"o\">:</span> <span class=\"k\">by</span> <span class=\"n\">rw</span> <span class=\"n\">mul_right_comm</span> <span class=\"n\">g</span><span class=\"bp\">⁻¹</span> <span class=\"n\">g</span><span class=\"bp\">⁻¹</span> <span class=\"n\">x</span>\n            <span class=\"bp\">...</span>   <span class=\"bp\">=</span> <span class=\"n\">g</span><span class=\"bp\">⁻¹</span> <span class=\"bp\">*</span> <span class=\"n\">x</span> <span class=\"bp\">*</span> <span class=\"o\">(</span><span class=\"n\">g</span><span class=\"bp\">⁻¹</span> <span class=\"bp\">*</span> <span class=\"n\">x</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"k\">by</span> <span class=\"n\">exact</span> <span class=\"n\">mul_assoc</span> <span class=\"o\">(</span><span class=\"n\">g</span><span class=\"bp\">⁻¹</span> <span class=\"bp\">*</span> <span class=\"n\">x</span><span class=\"o\">)</span> <span class=\"n\">g</span><span class=\"bp\">⁻¹</span> <span class=\"n\">x</span>\n            <span class=\"bp\">...</span>   <span class=\"bp\">=</span> <span class=\"mi\">1</span> <span class=\"o\">:</span> <span class=\"k\">by</span> <span class=\"n\">exact</span> <span class=\"n\">H2</span><span class=\"o\">,</span>\n        <span class=\"o\">}</span>\n    <span class=\"o\">},</span>\n<span class=\"kn\">end</span>\n</code></pre></div>",
        "id": 205096706,
        "sender_full_name": "Marc Masdeu",
        "timestamp": 1595842573
    },
    {
        "content": "<p>Please please turn that into 10 separate lemmas. :-)</p>",
        "id": 205098166,
        "sender_full_name": "Scott Morrison",
        "timestamp": 1595843524
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110087\">Scott Morrison</span> <a href=\"#narrow/stream/113489-new-members/topic/Frustration.20with.20finset/near/205098166\">said</a>:</p>\n<blockquote>\n<p>Please please turn that into 10 separate lemmas. :-)</p>\n</blockquote>\n<p>Have 6 so far...and done for the day :-).</p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"kn\">variables</span> <span class=\"o\">{</span><span class=\"n\">G</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span> <span class=\"o\">[</span><span class=\"n\">comm_group</span> <span class=\"n\">G</span><span class=\"o\">]</span> <span class=\"o\">[</span><span class=\"n\">fintype</span> <span class=\"n\">G</span><span class=\"o\">]</span>\n\n<span class=\"kn\">instance</span> <span class=\"o\">:</span> <span class=\"n\">fintype</span> <span class=\"o\">(</span><span class=\"n\">subgroup</span> <span class=\"n\">G</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"n\">fintype</span><span class=\"bp\">.</span><span class=\"n\">of_injective</span> <span class=\"o\">(</span><span class=\"n\">coe</span> <span class=\"o\">:</span> <span class=\"n\">subgroup</span> <span class=\"n\">G</span> <span class=\"bp\">→</span> <span class=\"n\">set</span> <span class=\"n\">G</span><span class=\"o\">)</span> <span class=\"err\">$</span> <span class=\"bp\">λ</span> <span class=\"bp\">_</span> <span class=\"bp\">_</span><span class=\"o\">,</span> <span class=\"n\">subgroup</span><span class=\"bp\">.</span><span class=\"n\">ext&#39;</span>\n\n<span class=\"c\">/-</span><span class=\"cm\"></span>\n<span class=\"cm\">If a is a subgroup of G[2] and x ∈ G[2], then a ∪ x *l a is a subgroup.</span>\n<span class=\"cm\">-/</span>\n<span class=\"n\">def</span> <span class=\"n\">insert_twotors_to_twotors</span> <span class=\"o\">{</span><span class=\"n\">x</span> <span class=\"o\">:</span> <span class=\"n\">G</span><span class=\"o\">}</span> <span class=\"o\">{</span><span class=\"n\">a</span> <span class=\"o\">:</span> <span class=\"n\">subgroup</span> <span class=\"n\">G</span><span class=\"o\">}</span>\n  <span class=\"o\">(</span><span class=\"n\">hx</span> <span class=\"o\">:</span> <span class=\"n\">x</span> <span class=\"bp\">*</span> <span class=\"n\">x</span> <span class=\"bp\">=</span> <span class=\"mi\">1</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">ha</span> <span class=\"o\">:</span> <span class=\"bp\">∀</span> <span class=\"n\">g</span> <span class=\"o\">:</span> <span class=\"n\">G</span><span class=\"o\">,</span> <span class=\"n\">g</span> <span class=\"err\">∈</span> <span class=\"n\">a</span> <span class=\"bp\">→</span> <span class=\"n\">g</span> <span class=\"bp\">*</span> <span class=\"n\">g</span> <span class=\"bp\">=</span> <span class=\"mi\">1</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">subgroup</span> <span class=\"n\">G</span> <span class=\"o\">:=</span>\n<span class=\"o\">{</span>\n  <span class=\"n\">carrier</span> <span class=\"o\">:=</span> <span class=\"err\">↑</span><span class=\"n\">a</span> <span class=\"err\">∪</span> <span class=\"n\">left_coset</span> <span class=\"n\">x</span> <span class=\"n\">a</span><span class=\"o\">,</span>\n  <span class=\"n\">one_mem&#39;</span> <span class=\"o\">:=</span> <span class=\"n\">or</span><span class=\"bp\">.</span><span class=\"n\">inl</span> <span class=\"o\">(</span><span class=\"n\">subgroup</span><span class=\"bp\">.</span><span class=\"n\">one_mem</span> <span class=\"n\">a</span><span class=\"o\">),</span>\n  <span class=\"n\">mul_mem&#39;</span> <span class=\"o\">:=</span>\n  <span class=\"k\">begin</span>\n    <span class=\"n\">intros</span> <span class=\"n\">u</span> <span class=\"n\">v</span> <span class=\"n\">hu</span> <span class=\"n\">hv</span><span class=\"o\">,</span>\n    <span class=\"c1\">--rcases? hu hv,-- with ⟨ hu1, hu2⟩ | ⟨  hv1, hv2⟩ ,</span>\n    <span class=\"n\">cases</span> <span class=\"n\">hv</span> <span class=\"k\">with</span> <span class=\"n\">hv1</span> <span class=\"n\">hv2</span><span class=\"o\">,</span>\n    <span class=\"n\">repeat</span> <span class=\"o\">{</span><span class=\"n\">cases</span> <span class=\"n\">hu</span> <span class=\"k\">with</span> <span class=\"n\">hu1</span> <span class=\"n\">hu2</span><span class=\"o\">},</span>\n    <span class=\"o\">{</span>\n      <span class=\"n\">exact</span> <span class=\"n\">or</span><span class=\"bp\">.</span><span class=\"n\">inl</span> <span class=\"o\">(</span><span class=\"n\">subgroup</span><span class=\"bp\">.</span><span class=\"n\">mul_mem</span> <span class=\"n\">a</span> <span class=\"n\">hu1</span> <span class=\"n\">hv1</span><span class=\"o\">),</span>\n    <span class=\"o\">},</span>\n    <span class=\"o\">{</span>\n      <span class=\"n\">right</span><span class=\"o\">,</span>\n      <span class=\"n\">rw</span> <span class=\"o\">[</span><span class=\"n\">mem_left_coset_iff</span><span class=\"o\">,</span> <span class=\"err\">←</span><span class=\"n\">mul_assoc</span><span class=\"o\">],</span>\n      <span class=\"n\">rw</span> <span class=\"n\">mem_left_coset_iff</span> <span class=\"n\">at</span> <span class=\"n\">hu2</span><span class=\"o\">,</span>\n      <span class=\"n\">exact</span> <span class=\"n\">is_submonoid</span><span class=\"bp\">.</span><span class=\"n\">mul_mem</span> <span class=\"n\">hu2</span> <span class=\"n\">hv1</span><span class=\"o\">,</span>\n    <span class=\"o\">},</span>\n    <span class=\"o\">{</span>\n      <span class=\"n\">right</span><span class=\"o\">,</span>\n      <span class=\"n\">rw</span> <span class=\"o\">[</span><span class=\"n\">mul_comm</span><span class=\"o\">,</span> <span class=\"n\">mem_left_coset_iff</span><span class=\"o\">,</span> <span class=\"err\">←</span><span class=\"n\">mul_assoc</span><span class=\"o\">],</span>\n      <span class=\"n\">rw</span> <span class=\"n\">mem_left_coset_iff</span> <span class=\"n\">at</span> <span class=\"n\">hv2</span><span class=\"o\">,</span>\n      <span class=\"n\">exact</span> <span class=\"n\">is_submonoid</span><span class=\"bp\">.</span><span class=\"n\">mul_mem</span> <span class=\"n\">hv2</span> <span class=\"n\">hu1</span><span class=\"o\">,</span>\n    <span class=\"o\">},</span>\n    <span class=\"o\">{</span>\n      <span class=\"n\">left</span><span class=\"o\">,</span>\n      <span class=\"n\">rw</span> <span class=\"n\">mem_left_coset_iff</span> <span class=\"n\">at</span> <span class=\"n\">hu2</span> <span class=\"n\">hv2</span><span class=\"o\">,</span>\n      <span class=\"k\">have</span> <span class=\"n\">H</span> <span class=\"o\">:</span> <span class=\"n\">x</span><span class=\"bp\">⁻¹</span> <span class=\"bp\">*</span> <span class=\"n\">x</span><span class=\"bp\">⁻¹</span> <span class=\"bp\">*</span> <span class=\"n\">u</span> <span class=\"bp\">*</span> <span class=\"n\">v</span> <span class=\"err\">∈</span> <span class=\"n\">a</span><span class=\"o\">,</span>\n      <span class=\"o\">{</span>\n          <span class=\"n\">norm_cast</span> <span class=\"n\">at</span> <span class=\"n\">hu2</span> <span class=\"n\">hv2</span> <span class=\"err\">⊢</span><span class=\"o\">,</span>\n          <span class=\"n\">rw</span> <span class=\"o\">[</span><span class=\"n\">mul_comm</span><span class=\"o\">,</span> <span class=\"n\">mul_assoc</span><span class=\"o\">,</span> <span class=\"err\">←</span><span class=\"n\">mul_assoc</span> <span class=\"n\">v</span> <span class=\"bp\">_</span><span class=\"o\">,</span> <span class=\"n\">mul_comm</span> <span class=\"n\">v</span> <span class=\"bp\">_</span><span class=\"o\">],</span>\n          <span class=\"n\">exact</span> <span class=\"n\">subgroup</span><span class=\"bp\">.</span><span class=\"n\">mul_mem</span> <span class=\"n\">a</span> <span class=\"n\">hv2</span> <span class=\"n\">hu2</span><span class=\"o\">,</span>\n      <span class=\"o\">},</span>\n      <span class=\"k\">have</span> <span class=\"n\">x_eq_xinv</span> <span class=\"o\">:</span> <span class=\"n\">x</span> <span class=\"bp\">=</span> <span class=\"n\">x</span><span class=\"bp\">⁻¹</span> <span class=\"o\">:=</span> <span class=\"n\">eq_inv_of_mul_eq_one</span> <span class=\"n\">hx</span><span class=\"o\">,</span>\n      <span class=\"n\">rw</span> <span class=\"o\">[</span><span class=\"err\">←</span><span class=\"n\">x_eq_xinv</span><span class=\"o\">,</span> <span class=\"n\">hx</span><span class=\"o\">,</span> <span class=\"n\">one_mul</span><span class=\"o\">]</span> <span class=\"n\">at</span> <span class=\"n\">H</span><span class=\"o\">,</span>\n      <span class=\"n\">exact</span> <span class=\"n\">H</span><span class=\"o\">,</span>\n    <span class=\"o\">}</span>\n  <span class=\"kn\">end</span><span class=\"o\">,</span>\n  <span class=\"n\">inv_mem&#39;</span> <span class=\"o\">:=</span>\n  <span class=\"k\">begin</span>\n      <span class=\"n\">intros</span> <span class=\"n\">u</span> <span class=\"n\">hu</span><span class=\"o\">,</span>\n      <span class=\"n\">cases</span> <span class=\"n\">hu</span> <span class=\"k\">with</span> <span class=\"n\">hu1</span> <span class=\"n\">hu2</span><span class=\"o\">,</span> <span class=\"k\">by</span> <span class=\"n\">exact</span> <span class=\"n\">or</span><span class=\"bp\">.</span><span class=\"n\">inl</span> <span class=\"o\">(</span><span class=\"n\">is_subgroup</span><span class=\"bp\">.</span><span class=\"n\">inv_mem</span> <span class=\"n\">hu1</span><span class=\"o\">),</span>\n      <span class=\"o\">{</span>\n          <span class=\"n\">right</span><span class=\"o\">,</span>\n          <span class=\"n\">rw</span> <span class=\"n\">mem_left_coset_iff</span> <span class=\"n\">at</span> <span class=\"n\">hu2</span> <span class=\"err\">⊢</span><span class=\"o\">,</span>\n          <span class=\"n\">norm_cast</span> <span class=\"n\">at</span> <span class=\"n\">hu2</span> <span class=\"err\">⊢</span><span class=\"o\">,</span>\n          <span class=\"n\">rw</span> <span class=\"o\">[</span><span class=\"err\">←</span><span class=\"n\">subgroup</span><span class=\"bp\">.</span><span class=\"n\">inv_mem_iff</span><span class=\"o\">,</span> <span class=\"n\">mul_inv</span><span class=\"o\">,</span> <span class=\"n\">inv_inv</span><span class=\"o\">,</span> <span class=\"n\">inv_inv</span><span class=\"o\">],</span>\n          <span class=\"k\">have</span> <span class=\"n\">x_eq_xinv</span> <span class=\"o\">:</span> <span class=\"n\">x</span> <span class=\"bp\">=</span> <span class=\"n\">x</span><span class=\"bp\">⁻¹</span> <span class=\"o\">:=</span> <span class=\"n\">eq_inv_of_mul_eq_one</span> <span class=\"n\">hx</span><span class=\"o\">,</span>\n          <span class=\"n\">rw</span> <span class=\"err\">←</span><span class=\"n\">x_eq_xinv</span> <span class=\"n\">at</span> <span class=\"n\">hu2</span><span class=\"o\">,</span>\n          <span class=\"n\">exact</span> <span class=\"n\">hu2</span><span class=\"o\">,</span>\n      <span class=\"o\">}</span>\n  <span class=\"kn\">end</span>\n<span class=\"o\">}</span>\n<span class=\"c\">/-</span><span class=\"cm\">-</span>\n<span class=\"cm\">If g ∈ G[2] and a ≤ G[2], then a ∪ g l* a ⊆ G[2].</span>\n<span class=\"cm\">--/</span>\n<span class=\"kn\">lemma</span> <span class=\"n\">twotorsion_contains_a_and_ga</span> <span class=\"o\">{</span><span class=\"n\">g</span> <span class=\"o\">:</span> <span class=\"n\">G</span><span class=\"o\">}</span> <span class=\"o\">{</span><span class=\"n\">a</span> <span class=\"o\">:</span> <span class=\"n\">subgroup</span> <span class=\"n\">G</span><span class=\"o\">}</span>\n  <span class=\"o\">(</span><span class=\"n\">h₁</span> <span class=\"o\">:</span> <span class=\"n\">g</span> <span class=\"bp\">*</span> <span class=\"n\">g</span> <span class=\"bp\">=</span> <span class=\"mi\">1</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">h₂</span> <span class=\"o\">:</span> <span class=\"bp\">∀</span> <span class=\"o\">(</span><span class=\"n\">x</span> <span class=\"o\">:</span> <span class=\"n\">G</span><span class=\"o\">),</span> <span class=\"n\">x</span> <span class=\"err\">∈</span> <span class=\"n\">a</span> <span class=\"bp\">→</span> <span class=\"n\">x</span> <span class=\"bp\">*</span> <span class=\"n\">x</span> <span class=\"bp\">=</span> <span class=\"mi\">1</span><span class=\"o\">)</span> <span class=\"o\">:</span>\n    <span class=\"err\">↑</span><span class=\"n\">a</span> <span class=\"err\">∪</span> <span class=\"n\">left_coset</span> <span class=\"n\">g</span> <span class=\"err\">↑</span><span class=\"n\">a</span> <span class=\"err\">⊆</span> <span class=\"o\">{</span><span class=\"n\">x</span> <span class=\"o\">:</span> <span class=\"n\">G</span> <span class=\"bp\">|</span> <span class=\"n\">x</span> <span class=\"bp\">*</span> <span class=\"n\">x</span> <span class=\"bp\">=</span> <span class=\"mi\">1</span><span class=\"o\">}</span> <span class=\"o\">:=</span>\n<span class=\"k\">begin</span>\n  <span class=\"c1\">-- prove that twotorsion(G) ⊇ a u ga</span>\n  <span class=\"n\">intros</span> <span class=\"n\">x</span> <span class=\"n\">hx</span><span class=\"o\">,</span>\n  <span class=\"n\">by_cases</span> <span class=\"o\">(</span><span class=\"n\">x</span> <span class=\"err\">∈</span> <span class=\"n\">a</span><span class=\"o\">),</span> <span class=\"n\">tauto</span><span class=\"o\">,</span>\n  <span class=\"k\">have</span> <span class=\"n\">H</span> <span class=\"o\">:</span> <span class=\"o\">(</span><span class=\"n\">x</span> <span class=\"err\">∈</span> <span class=\"n\">left_coset</span> <span class=\"n\">g</span> <span class=\"n\">a</span><span class=\"o\">),</span>\n  <span class=\"o\">{</span>\n      <span class=\"n\">rw</span> <span class=\"n\">set</span><span class=\"bp\">.</span><span class=\"n\">mem_union</span> <span class=\"n\">at</span> <span class=\"n\">hx</span><span class=\"o\">,</span>\n      <span class=\"n\">norm_cast</span> <span class=\"n\">at</span> <span class=\"n\">hx</span><span class=\"o\">,</span>\n      <span class=\"n\">tauto</span><span class=\"o\">,</span>\n  <span class=\"o\">},</span>\n  <span class=\"n\">suffices</span> <span class=\"n\">x_is_twotors</span> <span class=\"o\">:</span> <span class=\"n\">x</span> <span class=\"bp\">*</span> <span class=\"n\">x</span> <span class=\"bp\">=</span> <span class=\"mi\">1</span><span class=\"o\">,</span> <span class=\"k\">by</span> <span class=\"n\">tauto</span><span class=\"o\">,</span>\n  <span class=\"n\">clear</span> <span class=\"n\">hx</span> <span class=\"n\">h</span><span class=\"o\">,</span>\n  <span class=\"k\">have</span> <span class=\"n\">H2</span> <span class=\"o\">:</span> <span class=\"bp\">∀</span> <span class=\"o\">(</span><span class=\"n\">x</span> <span class=\"o\">:</span> <span class=\"n\">G</span><span class=\"o\">),</span> <span class=\"n\">x</span> <span class=\"err\">∈</span> <span class=\"n\">a</span> <span class=\"bp\">→</span> <span class=\"n\">x</span> <span class=\"bp\">*</span> <span class=\"n\">x</span> <span class=\"bp\">=</span> <span class=\"mi\">1</span><span class=\"o\">,</span> <span class=\"k\">by</span> <span class=\"n\">tauto</span><span class=\"o\">,</span>\n  <span class=\"n\">rw</span> <span class=\"n\">mem_left_coset_iff</span> <span class=\"n\">at</span> <span class=\"n\">H</span><span class=\"o\">,</span>\n  <span class=\"n\">specialize</span> <span class=\"n\">H2</span>  <span class=\"o\">(</span><span class=\"n\">g</span><span class=\"bp\">⁻¹</span> <span class=\"bp\">*</span> <span class=\"n\">x</span><span class=\"o\">)</span> <span class=\"n\">H</span><span class=\"o\">,</span>\n  <span class=\"k\">have</span> <span class=\"n\">H3</span> <span class=\"o\">:</span> <span class=\"n\">g</span> <span class=\"bp\">=</span> <span class=\"n\">g</span><span class=\"bp\">⁻¹</span> <span class=\"o\">:=</span> <span class=\"n\">eq_inv_of_mul_eq_one</span> <span class=\"n\">h₁</span><span class=\"o\">,</span>\n  <span class=\"k\">by</span> <span class=\"k\">calc</span>\n  <span class=\"n\">x</span> <span class=\"bp\">*</span> <span class=\"n\">x</span> <span class=\"bp\">=</span> <span class=\"n\">g</span> <span class=\"bp\">*</span> <span class=\"n\">g</span> <span class=\"bp\">*</span> <span class=\"n\">x</span> <span class=\"bp\">*</span> <span class=\"n\">x</span> <span class=\"o\">:</span> <span class=\"k\">by</span> <span class=\"n\">simp</span> <span class=\"n\">only</span> <span class=\"o\">[</span><span class=\"n\">h₁</span><span class=\"o\">,</span> <span class=\"n\">one_mul</span><span class=\"o\">]</span>\n  <span class=\"bp\">...</span>   <span class=\"bp\">=</span> <span class=\"n\">g</span><span class=\"bp\">⁻¹</span> <span class=\"bp\">*</span> <span class=\"n\">g</span><span class=\"bp\">⁻¹</span> <span class=\"bp\">*</span> <span class=\"n\">x</span> <span class=\"bp\">*</span> <span class=\"n\">x</span> <span class=\"o\">:</span> <span class=\"k\">by</span> <span class=\"n\">rw</span> <span class=\"err\">←</span> <span class=\"n\">H3</span>\n  <span class=\"bp\">...</span>   <span class=\"bp\">=</span> <span class=\"n\">g</span><span class=\"bp\">⁻¹</span> <span class=\"bp\">*</span> <span class=\"n\">x</span> <span class=\"bp\">*</span> <span class=\"n\">g</span><span class=\"bp\">⁻¹</span> <span class=\"bp\">*</span> <span class=\"n\">x</span> <span class=\"o\">:</span> <span class=\"k\">by</span> <span class=\"n\">rw</span> <span class=\"n\">mul_right_comm</span> <span class=\"n\">g</span><span class=\"bp\">⁻¹</span> <span class=\"n\">g</span><span class=\"bp\">⁻¹</span> <span class=\"n\">x</span>\n  <span class=\"bp\">...</span>   <span class=\"bp\">=</span> <span class=\"n\">g</span><span class=\"bp\">⁻¹</span> <span class=\"bp\">*</span> <span class=\"n\">x</span> <span class=\"bp\">*</span> <span class=\"o\">(</span><span class=\"n\">g</span><span class=\"bp\">⁻¹</span> <span class=\"bp\">*</span> <span class=\"n\">x</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"k\">by</span> <span class=\"n\">exact</span> <span class=\"n\">mul_assoc</span> <span class=\"o\">(</span><span class=\"n\">g</span><span class=\"bp\">⁻¹</span> <span class=\"bp\">*</span> <span class=\"n\">x</span><span class=\"o\">)</span> <span class=\"n\">g</span><span class=\"bp\">⁻¹</span> <span class=\"n\">x</span>\n  <span class=\"bp\">...</span>   <span class=\"bp\">=</span> <span class=\"mi\">1</span> <span class=\"o\">:</span> <span class=\"k\">by</span> <span class=\"n\">exact</span> <span class=\"n\">H2</span><span class=\"o\">,</span>\n<span class=\"kn\">end</span>\n\n<span class=\"c\">/-</span><span class=\"cm\">-</span>\n<span class=\"cm\">Suppose a ≤ G[2], and g ∉ a.</span>\n<span class=\"cm\">Then if x ∈ G[2] and x ∉ g l* a,</span>\n<span class=\"cm\">then g ∉ ⟨ x, a ⟩.</span>\n<span class=\"cm\">--/</span>\n<span class=\"kn\">lemma</span> <span class=\"n\">g_notin_xua</span> <span class=\"o\">{</span><span class=\"n\">x</span> <span class=\"n\">g</span><span class=\"o\">:</span> <span class=\"n\">G</span><span class=\"o\">}</span> <span class=\"o\">{</span><span class=\"n\">a</span> <span class=\"o\">:</span> <span class=\"n\">subgroup</span> <span class=\"n\">G</span><span class=\"o\">}</span>\n  <span class=\"o\">(</span><span class=\"n\">hg</span> <span class=\"o\">:</span> <span class=\"n\">g</span> <span class=\"err\">∉</span> <span class=\"n\">a</span><span class=\"o\">)</span>\n  <span class=\"o\">(</span><span class=\"n\">hx</span> <span class=\"o\">:</span> <span class=\"n\">x</span> <span class=\"bp\">*</span> <span class=\"n\">x</span> <span class=\"bp\">=</span> <span class=\"mi\">1</span><span class=\"o\">)</span>\n  <span class=\"o\">(</span><span class=\"n\">ha</span> <span class=\"o\">:</span> <span class=\"bp\">∀</span> <span class=\"n\">y</span> <span class=\"o\">:</span> <span class=\"n\">G</span><span class=\"o\">,</span> <span class=\"n\">y</span> <span class=\"err\">∈</span> <span class=\"n\">a</span> <span class=\"bp\">→</span> <span class=\"n\">y</span> <span class=\"bp\">*</span> <span class=\"n\">y</span> <span class=\"bp\">=</span> <span class=\"mi\">1</span><span class=\"o\">)</span>\n  <span class=\"o\">(</span><span class=\"n\">hgx</span> <span class=\"o\">:</span> <span class=\"n\">x</span> <span class=\"err\">∉</span> <span class=\"n\">left_coset</span> <span class=\"n\">g</span> <span class=\"err\">↑</span><span class=\"n\">a</span><span class=\"o\">)</span> <span class=\"o\">:</span>\n    <span class=\"o\">(</span><span class=\"n\">g</span> <span class=\"err\">∉</span> <span class=\"n\">insert_twotors_to_twotors</span> <span class=\"n\">hx</span> <span class=\"n\">ha</span><span class=\"o\">)</span> <span class=\"o\">:=</span>\n<span class=\"k\">begin</span>\n  <span class=\"n\">by_contradiction</span> <span class=\"n\">cont</span><span class=\"o\">,</span>\n  <span class=\"n\">cases</span> <span class=\"n\">cont</span><span class=\"o\">,</span>\n  <span class=\"k\">by</span> <span class=\"n\">contradiction</span><span class=\"o\">,</span>\n  <span class=\"o\">{</span>\n      <span class=\"n\">rw</span> <span class=\"n\">mem_left_coset_iff</span> <span class=\"n\">at</span> <span class=\"bp\">*</span><span class=\"o\">,</span>\n      <span class=\"n\">suffices</span> <span class=\"o\">:</span> <span class=\"n\">g</span><span class=\"bp\">⁻¹</span> <span class=\"bp\">*</span> <span class=\"n\">x</span> <span class=\"err\">∈</span> <span class=\"err\">↑</span><span class=\"n\">a</span><span class=\"o\">,</span> <span class=\"k\">by</span> <span class=\"n\">solve_by_elim</span><span class=\"o\">,</span>\n      <span class=\"n\">norm_cast</span> <span class=\"n\">at</span> <span class=\"bp\">*</span><span class=\"o\">,</span>\n      <span class=\"n\">rw</span> <span class=\"o\">[</span><span class=\"err\">←</span><span class=\"n\">subgroup</span><span class=\"bp\">.</span><span class=\"n\">inv_mem_iff</span><span class=\"o\">,</span> <span class=\"n\">mul_inv</span><span class=\"o\">,</span> <span class=\"n\">mul_comm</span><span class=\"o\">,</span> <span class=\"n\">inv_inv</span><span class=\"o\">],</span>\n      <span class=\"n\">exact</span> <span class=\"n\">cont</span><span class=\"o\">,</span>\n  <span class=\"o\">}</span>\n<span class=\"kn\">end</span>\n\n<span class=\"c\">/-</span><span class=\"cm\">-</span>\n<span class=\"cm\">If x ∈ G[2] and a ≤ G[2], then ⟨ x, a ⟩ ≤ G[2].</span>\n<span class=\"cm\">--/</span>\n<span class=\"kn\">lemma</span> <span class=\"n\">xua_twotors</span> <span class=\"o\">{</span><span class=\"n\">x</span> <span class=\"o\">:</span> <span class=\"n\">G</span><span class=\"o\">}</span> <span class=\"o\">{</span><span class=\"n\">a</span> <span class=\"o\">:</span> <span class=\"n\">subgroup</span> <span class=\"n\">G</span><span class=\"o\">}</span>\n  <span class=\"o\">(</span><span class=\"n\">hx</span> <span class=\"o\">:</span> <span class=\"n\">x</span> <span class=\"bp\">*</span> <span class=\"n\">x</span> <span class=\"bp\">=</span> <span class=\"mi\">1</span><span class=\"o\">)</span>\n  <span class=\"o\">(</span><span class=\"n\">ha</span> <span class=\"o\">:</span> <span class=\"bp\">∀</span> <span class=\"n\">y</span> <span class=\"o\">:</span> <span class=\"n\">G</span><span class=\"o\">,</span> <span class=\"n\">y</span> <span class=\"err\">∈</span> <span class=\"n\">a</span> <span class=\"bp\">→</span> <span class=\"n\">y</span> <span class=\"bp\">*</span> <span class=\"n\">y</span> <span class=\"bp\">=</span> <span class=\"mi\">1</span><span class=\"o\">)</span> <span class=\"o\">:</span>\n    <span class=\"o\">(</span><span class=\"bp\">∀</span> <span class=\"o\">(</span><span class=\"n\">y</span> <span class=\"o\">:</span> <span class=\"n\">G</span><span class=\"o\">),</span> <span class=\"n\">y</span> <span class=\"err\">∈</span> <span class=\"o\">(</span><span class=\"n\">insert_twotors_to_twotors</span> <span class=\"n\">hx</span> <span class=\"n\">ha</span><span class=\"o\">)</span> <span class=\"bp\">→</span> <span class=\"n\">y</span> <span class=\"bp\">*</span> <span class=\"n\">y</span> <span class=\"bp\">=</span> <span class=\"mi\">1</span><span class=\"o\">)</span> <span class=\"o\">:=</span>\n<span class=\"k\">begin</span>\n  <span class=\"n\">intros</span> <span class=\"n\">y</span> <span class=\"n\">hy</span><span class=\"o\">,</span>\n  <span class=\"k\">let</span> <span class=\"n\">xua</span> <span class=\"o\">:=</span> <span class=\"n\">insert_twotors_to_twotors</span> <span class=\"n\">hx</span> <span class=\"n\">ha</span><span class=\"o\">,</span>\n  <span class=\"k\">have</span> <span class=\"n\">hxinxua</span> <span class=\"o\">:</span> <span class=\"bp\">∀</span> <span class=\"n\">y</span> <span class=\"o\">:</span> <span class=\"n\">G</span><span class=\"o\">,</span> <span class=\"n\">y</span> <span class=\"err\">∈</span> <span class=\"n\">xua</span> <span class=\"bp\">↔</span> <span class=\"o\">(</span><span class=\"n\">y</span> <span class=\"err\">∈</span> <span class=\"err\">↑</span><span class=\"n\">a</span> <span class=\"bp\">∨</span> <span class=\"n\">y</span> <span class=\"err\">∈</span> <span class=\"n\">left_coset</span> <span class=\"n\">x</span> <span class=\"n\">a</span><span class=\"o\">),</span> <span class=\"k\">by</span> <span class=\"n\">apply</span> <span class=\"n\">subgroup</span><span class=\"bp\">.</span><span class=\"n\">mem_coe</span><span class=\"o\">,</span>\n  <span class=\"n\">rw</span> <span class=\"n\">hxinxua</span> <span class=\"n\">at</span> <span class=\"n\">hy</span><span class=\"o\">,</span>\n  <span class=\"n\">cases</span> <span class=\"n\">hy</span><span class=\"o\">,</span> <span class=\"k\">by</span> <span class=\"n\">exact</span> <span class=\"n\">ha</span> <span class=\"n\">y</span> <span class=\"o\">(</span><span class=\"n\">subgroup</span><span class=\"bp\">.</span><span class=\"n\">mem_coe</span><span class=\"bp\">.</span><span class=\"n\">mp</span> <span class=\"n\">hy</span><span class=\"o\">),</span>\n  <span class=\"o\">{</span>\n    <span class=\"n\">rw</span> <span class=\"n\">mem_left_coset_iff</span> <span class=\"n\">at</span> <span class=\"n\">hy</span><span class=\"o\">,</span>\n    <span class=\"k\">have</span> <span class=\"n\">HH</span> <span class=\"o\">:</span> <span class=\"bp\">∃</span> <span class=\"n\">w</span> <span class=\"err\">∈</span> <span class=\"n\">a</span><span class=\"o\">,</span> <span class=\"n\">x</span><span class=\"bp\">⁻¹</span> <span class=\"bp\">*</span> <span class=\"n\">y</span> <span class=\"bp\">=</span> <span class=\"n\">w</span><span class=\"o\">,</span> <span class=\"k\">by</span> <span class=\"n\">tauto</span><span class=\"o\">,</span>\n    <span class=\"n\">rcases</span> <span class=\"n\">HH</span> <span class=\"k\">with</span> <span class=\"bp\">⟨</span> <span class=\"n\">w</span> <span class=\"o\">,</span><span class=\"bp\">⟨</span> <span class=\"n\">hw1</span><span class=\"o\">,</span> <span class=\"n\">hw2</span><span class=\"bp\">⟩⟩</span><span class=\"o\">,</span>\n    <span class=\"k\">have</span> <span class=\"n\">hhy</span> <span class=\"o\">:</span> <span class=\"n\">y</span> <span class=\"bp\">=</span> <span class=\"n\">x</span> <span class=\"bp\">*</span> <span class=\"n\">w</span> <span class=\"o\">:=</span> <span class=\"n\">eq_mul_of_inv_mul_eq</span> <span class=\"n\">hw2</span><span class=\"o\">,</span>\n    <span class=\"k\">calc</span>\n    <span class=\"n\">y</span> <span class=\"bp\">*</span> <span class=\"n\">y</span> <span class=\"bp\">=</span> <span class=\"o\">(</span><span class=\"n\">x</span> <span class=\"bp\">*</span> <span class=\"n\">w</span><span class=\"o\">)</span> <span class=\"bp\">*</span> <span class=\"o\">(</span><span class=\"n\">x</span> <span class=\"bp\">*</span> <span class=\"n\">w</span><span class=\"o\">):</span> <span class=\"n\">congr</span> <span class=\"o\">(</span><span class=\"n\">congr_arg</span> <span class=\"n\">has_mul</span><span class=\"bp\">.</span><span class=\"n\">mul</span> <span class=\"n\">hhy</span><span class=\"o\">)</span> <span class=\"n\">hhy</span>\n    <span class=\"bp\">...</span>   <span class=\"bp\">=</span> <span class=\"o\">(</span><span class=\"n\">x</span> <span class=\"bp\">*</span> <span class=\"n\">x</span><span class=\"o\">)</span> <span class=\"bp\">*</span> <span class=\"o\">(</span><span class=\"n\">w</span> <span class=\"bp\">*</span> <span class=\"n\">w</span><span class=\"o\">):</span> <span class=\"n\">mul_mul_mul_comm</span> <span class=\"n\">x</span> <span class=\"n\">w</span> <span class=\"n\">x</span> <span class=\"n\">w</span>\n    <span class=\"bp\">...</span>   <span class=\"bp\">=</span> <span class=\"n\">w</span> <span class=\"bp\">*</span> <span class=\"n\">w</span> <span class=\"o\">:</span> <span class=\"n\">mul_left_eq_self</span><span class=\"bp\">.</span><span class=\"n\">mpr</span> <span class=\"n\">hx</span>\n    <span class=\"bp\">...</span>   <span class=\"bp\">=</span> <span class=\"mi\">1</span>      <span class=\"o\">:</span> <span class=\"n\">ha</span> <span class=\"n\">w</span> <span class=\"n\">hw1</span><span class=\"o\">,</span>\n  <span class=\"o\">}</span>\n<span class=\"kn\">end</span>\n\n<span class=\"c\">/-</span><span class=\"cm\">-</span>\n<span class=\"cm\">G[2] ≤ ⟨g, a⟩</span>\n<span class=\"cm\">--/</span>\n<span class=\"kn\">lemma</span> <span class=\"n\">twotorsion_containedin_a_union_ga</span> <span class=\"o\">{</span><span class=\"n\">g</span> <span class=\"o\">:</span> <span class=\"n\">G</span><span class=\"o\">}</span> <span class=\"o\">{</span><span class=\"n\">a</span> <span class=\"o\">:</span> <span class=\"n\">subgroup</span> <span class=\"n\">G</span><span class=\"o\">}</span>\n      <span class=\"o\">(</span><span class=\"n\">h₁</span> <span class=\"o\">:</span> <span class=\"n\">g</span> <span class=\"bp\">*</span> <span class=\"n\">g</span> <span class=\"bp\">=</span> <span class=\"mi\">1</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">h₂</span> <span class=\"o\">:</span> <span class=\"bp\">∀</span> <span class=\"o\">(</span><span class=\"n\">x</span> <span class=\"o\">:</span> <span class=\"n\">G</span><span class=\"o\">),</span> <span class=\"n\">x</span> <span class=\"err\">∈</span> <span class=\"n\">a</span> <span class=\"bp\">→</span> <span class=\"n\">x</span> <span class=\"bp\">*</span> <span class=\"n\">x</span> <span class=\"bp\">=</span> <span class=\"mi\">1</span><span class=\"o\">)</span>\n      <span class=\"o\">(</span><span class=\"n\">hga</span> <span class=\"o\">:</span> <span class=\"n\">g</span> <span class=\"err\">∉</span> <span class=\"n\">a</span><span class=\"o\">)</span>\n      <span class=\"o\">(</span><span class=\"n\">hmax</span> <span class=\"o\">:</span> <span class=\"bp\">∀</span> <span class=\"o\">(</span><span class=\"n\">a&#39;</span> <span class=\"o\">:</span> <span class=\"n\">subgroup</span> <span class=\"n\">G</span><span class=\"o\">),</span> <span class=\"n\">g</span> <span class=\"err\">∉</span> <span class=\"n\">a&#39;</span> <span class=\"bp\">→</span> <span class=\"o\">(</span><span class=\"bp\">∀</span> <span class=\"o\">(</span><span class=\"n\">x</span> <span class=\"o\">:</span> <span class=\"n\">G</span><span class=\"o\">),</span> <span class=\"n\">x</span> <span class=\"err\">∈</span> <span class=\"n\">a&#39;</span> <span class=\"bp\">→</span> <span class=\"n\">x</span> <span class=\"bp\">*</span> <span class=\"n\">x</span> <span class=\"bp\">=</span> <span class=\"mi\">1</span><span class=\"o\">)</span> <span class=\"bp\">→</span> <span class=\"n\">a</span> <span class=\"bp\">≤</span> <span class=\"n\">a&#39;</span> <span class=\"bp\">→</span> <span class=\"n\">a</span> <span class=\"bp\">=</span> <span class=\"n\">a&#39;</span><span class=\"o\">)</span> <span class=\"o\">:</span>\n      <span class=\"o\">{</span><span class=\"n\">x</span> <span class=\"o\">:</span> <span class=\"n\">G</span> <span class=\"bp\">|</span> <span class=\"n\">x</span> <span class=\"bp\">*</span> <span class=\"n\">x</span> <span class=\"bp\">=</span> <span class=\"mi\">1</span><span class=\"o\">}</span> <span class=\"err\">⊆</span> <span class=\"err\">↑</span><span class=\"n\">a</span> <span class=\"err\">∪</span> <span class=\"n\">left_coset</span> <span class=\"n\">g</span> <span class=\"err\">↑</span><span class=\"n\">a</span> <span class=\"o\">:=</span>\n<span class=\"k\">begin</span>\n  <span class=\"c1\">-- Prove that twotorsion(G) ⊆ a u ga</span>\n  <span class=\"n\">intros</span> <span class=\"n\">x</span> <span class=\"n\">hx</span><span class=\"o\">,</span>\n  <span class=\"n\">dsimp</span> <span class=\"n\">at</span> <span class=\"n\">hx</span><span class=\"o\">,</span>\n  <span class=\"n\">by_contradiction</span> <span class=\"n\">h</span><span class=\"o\">,</span>\n  <span class=\"n\">rw</span> <span class=\"n\">set</span><span class=\"bp\">.</span><span class=\"n\">mem_union</span> <span class=\"n\">at</span> <span class=\"n\">h</span><span class=\"o\">,</span>\n  <span class=\"n\">push_neg</span> <span class=\"n\">at</span> <span class=\"n\">h</span><span class=\"o\">,</span>\n  <span class=\"k\">let</span> <span class=\"n\">xua</span> <span class=\"o\">:=</span> <span class=\"n\">insert_twotors_to_twotors</span> <span class=\"n\">hx</span> <span class=\"n\">h₂</span><span class=\"o\">,</span>\n  <span class=\"k\">have</span> <span class=\"n\">hxinxua</span> <span class=\"o\">:</span> <span class=\"bp\">∀</span> <span class=\"n\">y</span> <span class=\"o\">:</span> <span class=\"n\">G</span><span class=\"o\">,</span> <span class=\"n\">y</span> <span class=\"err\">∈</span> <span class=\"n\">xua</span> <span class=\"bp\">↔</span> <span class=\"o\">(</span><span class=\"n\">y</span> <span class=\"err\">∈</span> <span class=\"err\">↑</span><span class=\"n\">a</span> <span class=\"bp\">∨</span> <span class=\"n\">y</span> <span class=\"err\">∈</span> <span class=\"n\">left_coset</span> <span class=\"n\">x</span> <span class=\"n\">a</span><span class=\"o\">),</span> <span class=\"k\">by</span> <span class=\"n\">apply</span> <span class=\"n\">subgroup</span><span class=\"bp\">.</span><span class=\"n\">mem_coe</span><span class=\"o\">,</span>\n  <span class=\"k\">have</span> <span class=\"n\">g_notin_xua</span> <span class=\"o\">:</span> <span class=\"n\">g</span> <span class=\"err\">∉</span> <span class=\"n\">xua</span><span class=\"o\">,</span> <span class=\"k\">by</span> <span class=\"n\">exact</span> <span class=\"n\">g_notin_xua</span> <span class=\"n\">hga</span> <span class=\"n\">hx</span> <span class=\"n\">h₂</span> <span class=\"n\">h</span><span class=\"bp\">.</span><span class=\"n\">right</span><span class=\"o\">,</span>\n  <span class=\"k\">have</span> <span class=\"n\">h_twotors</span> <span class=\"o\">:</span> <span class=\"o\">(</span><span class=\"bp\">∀</span> <span class=\"o\">(</span><span class=\"n\">y</span> <span class=\"o\">:</span> <span class=\"n\">G</span><span class=\"o\">),</span> <span class=\"n\">y</span> <span class=\"err\">∈</span> <span class=\"n\">xua</span> <span class=\"bp\">→</span> <span class=\"n\">y</span> <span class=\"bp\">*</span> <span class=\"n\">y</span> <span class=\"bp\">=</span> <span class=\"mi\">1</span><span class=\"o\">),</span> <span class=\"k\">by</span> <span class=\"n\">exact</span> <span class=\"n\">xua_twotors</span> <span class=\"n\">hx</span> <span class=\"n\">h₂</span><span class=\"o\">,</span>\n  <span class=\"k\">have</span> <span class=\"n\">a_eq_xua</span> <span class=\"o\">:</span> <span class=\"n\">a</span> <span class=\"bp\">=</span> <span class=\"n\">xua</span> <span class=\"o\">:=</span> <span class=\"n\">hmax</span> <span class=\"n\">xua</span> <span class=\"n\">g_notin_xua</span> <span class=\"n\">h_twotors</span> <span class=\"o\">(</span><span class=\"bp\">λ</span> <span class=\"n\">y</span> <span class=\"n\">hy</span><span class=\"o\">,</span> <span class=\"n\">or</span><span class=\"bp\">.</span><span class=\"n\">inl</span> <span class=\"n\">hy</span><span class=\"o\">),</span>\n  <span class=\"k\">have</span> <span class=\"n\">x_in_a</span> <span class=\"o\">:</span> <span class=\"n\">x</span> <span class=\"err\">∈</span> <span class=\"n\">a</span><span class=\"o\">,</span>\n  <span class=\"o\">{</span>\n      <span class=\"n\">norm_cast</span> <span class=\"n\">at</span> <span class=\"bp\">*</span><span class=\"o\">,</span>\n      <span class=\"n\">rw</span> <span class=\"o\">[</span><span class=\"n\">a_eq_xua</span><span class=\"o\">,</span> <span class=\"n\">hxinxua</span><span class=\"o\">,</span> <span class=\"n\">mem_left_coset_iff</span><span class=\"o\">],</span>\n      <span class=\"n\">right</span><span class=\"o\">,</span>\n      <span class=\"n\">simp</span> <span class=\"n\">only</span> <span class=\"o\">[</span><span class=\"n\">subgroup</span><span class=\"bp\">.</span><span class=\"n\">mem_coe</span><span class=\"o\">,</span> <span class=\"n\">mul_left_inv</span><span class=\"o\">],</span>\n      <span class=\"n\">exact</span> <span class=\"n\">subgroup</span><span class=\"bp\">.</span><span class=\"n\">one_mem</span> <span class=\"n\">a</span>\n  <span class=\"o\">},</span>\n  <span class=\"n\">norm_cast</span> <span class=\"n\">at</span> <span class=\"n\">h</span><span class=\"o\">,</span>\n  <span class=\"k\">have</span> <span class=\"n\">hl</span> <span class=\"o\">:=</span> <span class=\"n\">h</span><span class=\"bp\">.</span><span class=\"n\">left</span><span class=\"o\">,</span>\n  <span class=\"n\">trivial</span><span class=\"o\">,</span>\n<span class=\"kn\">end</span>\n\n<span class=\"c1\">-- given G two torsion and 1 ≠ g ∈ G, there is H &lt; G of index 2 with g ∉ H</span>\n<span class=\"kn\">lemma</span> <span class=\"n\">element_avoidance</span> <span class=\"o\">{</span><span class=\"n\">g</span> <span class=\"o\">:</span> <span class=\"n\">G</span><span class=\"o\">}</span>  <span class=\"o\">(</span><span class=\"n\">h₁</span> <span class=\"o\">:</span> <span class=\"n\">g</span> <span class=\"bp\">≠</span> <span class=\"mi\">1</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">h₂</span> <span class=\"o\">:</span> <span class=\"n\">g</span> <span class=\"bp\">*</span> <span class=\"n\">g</span> <span class=\"bp\">=</span> <span class=\"mi\">1</span><span class=\"o\">):</span>\n <span class=\"bp\">∃</span> <span class=\"o\">(</span><span class=\"n\">H</span> <span class=\"o\">:</span> <span class=\"n\">subgroup</span> <span class=\"n\">G</span><span class=\"o\">)</span> <span class=\"o\">,</span>\n  <span class=\"o\">(</span><span class=\"n\">g</span> <span class=\"err\">∉</span> <span class=\"n\">H</span> <span class=\"bp\">∧</span>\n  <span class=\"o\">(</span><span class=\"bp\">∀</span> <span class=\"o\">(</span><span class=\"n\">x</span> <span class=\"o\">:</span> <span class=\"n\">G</span><span class=\"o\">),</span> <span class=\"n\">x</span> <span class=\"err\">∈</span> <span class=\"n\">H</span> <span class=\"bp\">→</span> <span class=\"n\">x</span> <span class=\"bp\">*</span> <span class=\"n\">x</span> <span class=\"bp\">=</span> <span class=\"mi\">1</span><span class=\"o\">)</span> <span class=\"bp\">∧</span>\n  <span class=\"o\">{</span><span class=\"n\">x</span> <span class=\"o\">:</span> <span class=\"n\">G</span> <span class=\"bp\">|</span> <span class=\"n\">x</span> <span class=\"bp\">*</span> <span class=\"n\">x</span> <span class=\"bp\">=</span> <span class=\"mi\">1</span><span class=\"o\">}</span> <span class=\"bp\">=</span> <span class=\"n\">H</span> <span class=\"err\">∪</span> <span class=\"o\">(</span><span class=\"n\">left_coset</span> <span class=\"n\">g</span> <span class=\"n\">H</span><span class=\"o\">))</span>\n  <span class=\"o\">:=</span>\n<span class=\"k\">begin</span>\n    <span class=\"k\">let</span> <span class=\"n\">s</span> <span class=\"o\">:=</span> <span class=\"o\">{</span><span class=\"n\">X</span> <span class=\"o\">:</span> <span class=\"n\">subgroup</span> <span class=\"n\">G</span> <span class=\"bp\">|</span> <span class=\"n\">g</span> <span class=\"err\">∉</span> <span class=\"n\">X</span> <span class=\"bp\">∧</span> <span class=\"o\">(</span><span class=\"bp\">∀</span> <span class=\"n\">x</span> <span class=\"o\">:</span> <span class=\"n\">G</span><span class=\"o\">,</span> <span class=\"n\">x</span> <span class=\"err\">∈</span> <span class=\"n\">X</span> <span class=\"bp\">→</span> <span class=\"n\">x</span><span class=\"bp\">*</span><span class=\"n\">x</span> <span class=\"bp\">=</span> <span class=\"mi\">1</span><span class=\"o\">)},</span>\n    <span class=\"k\">have</span> <span class=\"n\">sfin</span> <span class=\"o\">:</span> <span class=\"n\">s</span><span class=\"bp\">.</span><span class=\"n\">finite</span> <span class=\"o\">:=</span> <span class=\"n\">set</span><span class=\"bp\">.</span><span class=\"n\">finite</span><span class=\"bp\">.</span><span class=\"n\">of_fintype</span> <span class=\"bp\">_</span><span class=\"o\">,</span>\n    <span class=\"k\">have</span> <span class=\"n\">snonempty</span> <span class=\"o\">:</span> <span class=\"n\">set</span><span class=\"bp\">.</span><span class=\"n\">nonempty</span> <span class=\"n\">s</span><span class=\"o\">,</span>\n    <span class=\"o\">{</span>\n        <span class=\"n\">use</span> <span class=\"err\">⊥</span><span class=\"o\">,</span>\n        <span class=\"n\">split</span><span class=\"o\">,</span>\n        <span class=\"n\">exact</span> <span class=\"n\">h₁</span><span class=\"o\">,</span>\n        <span class=\"n\">intros</span> <span class=\"n\">x</span> <span class=\"n\">hx</span><span class=\"o\">,</span>\n        <span class=\"n\">rw</span> <span class=\"n\">subgroup</span><span class=\"bp\">.</span><span class=\"n\">mem_bot</span> <span class=\"n\">at</span> <span class=\"n\">hx</span><span class=\"o\">,</span>\n        <span class=\"n\">rw</span> <span class=\"n\">hx</span><span class=\"o\">,</span>\n        <span class=\"n\">exact</span> <span class=\"n\">mul_one</span> <span class=\"mi\">1</span><span class=\"o\">,</span>\n    <span class=\"o\">},</span>\n    <span class=\"k\">let</span> <span class=\"n\">existsH</span> <span class=\"o\">:=</span> <span class=\"n\">set</span><span class=\"bp\">.</span><span class=\"n\">finite</span><span class=\"bp\">.</span><span class=\"n\">exists_maximal_wrt</span> <span class=\"n\">id</span> <span class=\"n\">s</span> <span class=\"n\">sfin</span> <span class=\"n\">snonempty</span><span class=\"o\">,</span>\n    <span class=\"n\">simp</span> <span class=\"n\">only</span> <span class=\"o\">[</span><span class=\"n\">and_imp</span><span class=\"o\">,</span> <span class=\"n\">exists_prop</span><span class=\"o\">,</span> <span class=\"n\">id</span><span class=\"bp\">.</span><span class=\"n\">def</span><span class=\"o\">,</span> <span class=\"n\">set</span><span class=\"bp\">.</span><span class=\"n\">mem_set_of_eq</span><span class=\"o\">]</span> <span class=\"n\">at</span> <span class=\"n\">existsH</span><span class=\"o\">,</span>\n    <span class=\"n\">cases</span> <span class=\"n\">existsH</span> <span class=\"k\">with</span> <span class=\"n\">a</span> <span class=\"n\">ha</span><span class=\"o\">,</span>\n    <span class=\"n\">use</span> <span class=\"n\">a</span><span class=\"o\">,</span>\n    <span class=\"n\">repeat</span> <span class=\"o\">{</span><span class=\"n\">split</span><span class=\"o\">},</span>\n    <span class=\"n\">exact</span> <span class=\"n\">ha</span><span class=\"bp\">.</span><span class=\"mi\">1</span><span class=\"bp\">.</span><span class=\"mi\">1</span><span class=\"o\">,</span>\n    <span class=\"n\">exact</span> <span class=\"n\">ha</span><span class=\"bp\">.</span><span class=\"mi\">1</span><span class=\"bp\">.</span><span class=\"mi\">2</span><span class=\"o\">,</span>\n    <span class=\"c1\">-- We have defined a as the maximal subgroup of G satisfying</span>\n    <span class=\"c1\">-- 1) g ∉ a</span>\n    <span class=\"c1\">-- 2) ∀ x ∈ a, x*x = 1</span>\n    <span class=\"c1\">-- Now we must show that a ∪ ga = twotorsion(G)</span>\n    <span class=\"n\">apply</span> <span class=\"n\">set</span><span class=\"bp\">.</span><span class=\"n\">subset</span><span class=\"bp\">.</span><span class=\"n\">antisymm</span><span class=\"o\">,</span>\n    <span class=\"n\">apply</span> <span class=\"n\">twotorsion_containedin_a_union_ga</span> <span class=\"n\">h₂</span> <span class=\"n\">ha</span><span class=\"bp\">.</span><span class=\"mi\">1</span><span class=\"bp\">.</span><span class=\"mi\">2</span> <span class=\"n\">ha</span><span class=\"bp\">.</span><span class=\"mi\">1</span><span class=\"bp\">.</span><span class=\"mi\">1</span> <span class=\"n\">ha</span><span class=\"bp\">.</span><span class=\"mi\">2</span><span class=\"o\">,</span>\n    <span class=\"n\">exact</span> <span class=\"n\">twotorsion_contains_a_and_ga</span> <span class=\"n\">h₂</span> <span class=\"n\">ha</span><span class=\"bp\">.</span><span class=\"mi\">1</span><span class=\"bp\">.</span><span class=\"mi\">2</span><span class=\"o\">,</span>\n<span class=\"kn\">end</span>\n</code></pre></div>",
        "id": 205121206,
        "sender_full_name": "Marc Masdeu",
        "timestamp": 1595858930
    },
    {
        "content": "<p>And I still don't see the need to change the topic title... Here's another place that I've got stuck:</p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"n\">def</span> <span class=\"n\">two_torsion_subgroup</span> <span class=\"o\">(</span><span class=\"n\">G</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">)[</span><span class=\"n\">comm_group</span> <span class=\"n\">G</span><span class=\"o\">]</span> <span class=\"o\">:</span> <span class=\"n\">subgroup</span> <span class=\"n\">G</span> <span class=\"o\">:=</span>\n<span class=\"o\">{</span> <span class=\"n\">carrier</span> <span class=\"o\">:=</span> <span class=\"o\">{</span><span class=\"n\">z</span> <span class=\"o\">:</span> <span class=\"n\">G</span> <span class=\"bp\">|</span> <span class=\"n\">z</span> <span class=\"bp\">*</span> <span class=\"n\">z</span> <span class=\"bp\">=</span> <span class=\"mi\">1</span><span class=\"o\">},</span>\n  <span class=\"n\">one_mem&#39;</span> <span class=\"o\">:=</span> <span class=\"k\">by</span> <span class=\"n\">simp</span><span class=\"o\">,</span>\n  <span class=\"n\">mul_mem&#39;</span> <span class=\"o\">:=</span> <span class=\"bp\">λ</span> <span class=\"n\">a</span> <span class=\"n\">b</span> <span class=\"o\">(</span><span class=\"n\">ha</span> <span class=\"o\">:</span> <span class=\"n\">a</span> <span class=\"bp\">*</span> <span class=\"n\">a</span> <span class=\"bp\">=</span> <span class=\"mi\">1</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">hb</span> <span class=\"o\">:</span> <span class=\"n\">b</span> <span class=\"bp\">*</span> <span class=\"n\">b</span> <span class=\"bp\">=</span> <span class=\"mi\">1</span><span class=\"o\">),</span>\n  <span class=\"k\">begin</span>\n    <span class=\"n\">tidy</span><span class=\"o\">,</span>\n    <span class=\"n\">rw</span> <span class=\"o\">[</span><span class=\"n\">mul_mul_mul_comm</span> <span class=\"n\">a</span> <span class=\"n\">b</span> <span class=\"n\">a</span> <span class=\"n\">b</span><span class=\"o\">,</span> <span class=\"n\">ha</span><span class=\"o\">,</span> <span class=\"n\">hb</span><span class=\"o\">],</span>\n    <span class=\"n\">refine</span> <span class=\"n\">mul_one</span> <span class=\"mi\">1</span><span class=\"o\">,</span>\n  <span class=\"kn\">end</span><span class=\"o\">,</span>\n  <span class=\"n\">inv_mem&#39;</span> <span class=\"o\">:=</span> <span class=\"bp\">λ</span> <span class=\"n\">a</span> <span class=\"o\">(</span><span class=\"n\">ha</span> <span class=\"o\">:</span> <span class=\"n\">a</span> <span class=\"bp\">*</span> <span class=\"n\">a</span> <span class=\"bp\">=</span> <span class=\"mi\">1</span><span class=\"o\">),</span> <span class=\"k\">by</span> <span class=\"o\">{</span><span class=\"n\">tidy</span><span class=\"o\">,</span> <span class=\"n\">rw</span> <span class=\"n\">mul_inv_eq_one</span><span class=\"o\">,</span> <span class=\"n\">refine</span> <span class=\"n\">inv_eq_of_mul_eq_one</span> <span class=\"n\">ha</span><span class=\"o\">}</span>\n<span class=\"o\">}</span>\n\n<span class=\"kn\">lemma</span> <span class=\"n\">two_prods_are_equal</span> <span class=\"o\">{</span><span class=\"n\">G</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span> <span class=\"o\">[</span><span class=\"n\">comm_group</span> <span class=\"n\">G</span><span class=\"o\">]</span> <span class=\"o\">[</span><span class=\"n\">fintype</span> <span class=\"n\">G</span><span class=\"o\">]:</span>\n<span class=\"o\">((</span><span class=\"err\">∏</span> <span class=\"o\">(</span><span class=\"n\">g</span> <span class=\"o\">:</span> <span class=\"err\">↥</span><span class=\"o\">(</span><span class=\"n\">two_torsion_subgroup</span> <span class=\"n\">G</span><span class=\"o\">)),</span> <span class=\"n\">g</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">G</span><span class=\"o\">)</span> <span class=\"bp\">=</span> <span class=\"o\">(</span><span class=\"err\">∏</span> <span class=\"o\">(</span><span class=\"n\">g</span> <span class=\"o\">:</span> <span class=\"n\">G</span><span class=\"o\">)</span> <span class=\"k\">in</span> <span class=\"o\">(</span><span class=\"n\">two_torsion_subgroup</span> <span class=\"n\">G</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">carrier</span><span class=\"bp\">.</span><span class=\"n\">to_finset</span><span class=\"o\">,</span> <span class=\"n\">g</span> <span class=\"o\">):=</span>\n<span class=\"k\">begin</span>\n  <span class=\"n\">sorry</span>\n<span class=\"kn\">end</span>\n</code></pre></div>\n\n\n<p>I don't manage to prove the lemma, which to me is just two different ways of writing in Lean the same exact product. I also don't see why I can't apply finset.prod_congr...</p>\n<p>Thanks Lean community!</p>",
        "id": 205378082,
        "sender_full_name": "Marc Masdeu",
        "timestamp": 1596039193
    },
    {
        "content": "<p>This is exactly the sort of thing which makes lean hard for mathematicians to use</p>",
        "id": 205380257,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1596040213
    },
    {
        "content": "<p>The official answer is probably that this is <a href=\"https://en.wikipedia.org/wiki/XY_problem\">#xy</a> and you should decide once and for all how you want to talk about this subset instead of switching between different ways of talking about it</p>",
        "id": 205380552,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1596040367
    },
    {
        "content": "<p>It wouldn't surprise me if you ended up with two different witnesses to finiteness of the set you're taking a product over and then nothing will work anyway and you'll have to get the forensic experts in</p>",
        "id": 205380734,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1596040468
    },
    {
        "content": "<p>Did you try library_search?</p>",
        "id": 205380816,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1596040513
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"254058\">@Marc Masdeu</span> Sorry for the pain...</p>",
        "id": 205380908,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1596040560
    },
    {
        "content": "<p>The reason that <code>finset.prod_congr</code> doesn't work is because it assumes you are taking products indexed by the same type. But in your case the LHS is a subtype of the type on the right.</p>",
        "id": 205381018,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1596040601
    },
    {
        "content": "<p>So you probably need to <code>rw</code> the LHS using something like <code>finset.prod_subtype</code>.</p>",
        "id": 205381074,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1596040627
    },
    {
        "content": "<p>PS unrelated -- <code>tidy</code> is only supposed to be used at the end of a proof. You might want to replace it with <code>tidy?</code> and then with the output of what it says it's doing. It might not be doing much at all.</p>",
        "id": 205381142,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1596040677
    },
    {
        "content": "<p>I agree that we shouldn't need to experience this pain. But I don't know how to solve it.</p>",
        "id": 205381145,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1596040678
    },
    {
        "content": "<p>Maybe better simp-lemmas?</p>",
        "id": 205381212,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1596040693
    },
    {
        "content": "<p>Delete fintype ;-)</p>",
        "id": 205382745,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1596041425
    },
    {
        "content": "<p>Or at least don't tell mathematicians about it</p>",
        "id": 205382757,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1596041438
    },
    {
        "content": "<p>I don't know how to solve this. We offer several ways of doing a product over a finite set and this is problematic</p>",
        "id": 205382949,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1596041533
    },
    {
        "content": "<p>The problem is even more basic than this, we offer three ways to take the intersection of a bunch of sets</p>",
        "id": 205383035,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1596041585
    },
    {
        "content": "<p>Oh well. I understand that if I choose different ways of writing the same, then I'll have to deal with coercions and the like. I'm very surprised though that this is so hard!</p>\n<p>I got into this because I am trying to prove some lemmas about products of elements of a finite abelian multiplicative group G. Which way should I be using? I'm happy to redo parts of what I already have.</p>",
        "id": 205383180,
        "sender_full_name": "Marc Masdeu",
        "timestamp": 1596041654
    },
    {
        "content": "<p>This should be generalized to a lemma about prod</p>",
        "id": 205383487,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1596041828
    },
    {
        "content": "<p>The issue of course Marc is that if you only prove the result about one of them, then sooner or later someone will need it for the other variant :-)</p>",
        "id": 205383688,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1596041911
    },
    {
        "content": "<p>I think something like <code>prod (g : S), f g = prod g in T, f g</code> if <code>S = T</code></p>",
        "id": 205383698,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1596041921
    },
    {
        "content": "<p>where <code>S = T</code> needs some coe or to_finset or something</p>",
        "id": 205383753,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1596041959
    },
    {
        "content": "<p>Here's my real problem (to avoid xy): I have proven this lemma</p>\n<div class=\"codehilite\"><pre><span></span><code>(∏ g : G, g) = (∏ g : two_torsion_subgroup G, g)\n</code></pre></div>\n\n\n<p>and this one:</p>\n<div class=\"codehilite\"><pre><span></span><code> ∃ (H : subgroup G) ,\n  (g ∉ H ∧\n  (∀ (x : G), x ∈ H → x * x = 1) ∧\n  {x : G | x * x = 1} = H ∪ (left_coset g H))\n</code></pre></div>\n\n\n<p>The one that I'd like to prove next is:</p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"kn\">lemma</span> <span class=\"n\">prod_identity</span> <span class=\"o\">{</span><span class=\"n\">g</span> <span class=\"o\">:</span> <span class=\"n\">G</span><span class=\"o\">}</span> <span class=\"o\">(</span><span class=\"n\">h₁</span> <span class=\"o\">:</span> <span class=\"bp\">∀</span> <span class=\"n\">x</span> <span class=\"o\">:</span> <span class=\"n\">G</span><span class=\"o\">,</span> <span class=\"n\">x</span> <span class=\"bp\">*</span> <span class=\"n\">x</span> <span class=\"bp\">=</span> <span class=\"mi\">1</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">h₂</span> <span class=\"o\">:</span> <span class=\"n\">g</span> <span class=\"bp\">≠</span> <span class=\"mi\">1</span><span class=\"o\">):</span>\n <span class=\"o\">(</span><span class=\"err\">∏</span> <span class=\"n\">x</span> <span class=\"o\">:</span> <span class=\"n\">G</span><span class=\"o\">,</span> <span class=\"n\">x</span><span class=\"o\">)</span> <span class=\"bp\">=</span> <span class=\"n\">g</span><span class=\"bp\">^</span><span class=\"o\">((</span><span class=\"n\">fintype</span><span class=\"bp\">.</span><span class=\"n\">card</span> <span class=\"n\">G</span> <span class=\"bp\">/</span> <span class=\"mi\">2</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"bp\">ℕ</span><span class=\"o\">)</span>\n</code></pre></div>\n\n\n<p>and along the way I thought that I would easily be able to prove</p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"o\">((</span><span class=\"err\">∏</span> <span class=\"n\">x</span> <span class=\"o\">:</span> <span class=\"n\">two_torsion_subgroup</span> <span class=\"n\">G</span><span class=\"o\">,</span> <span class=\"n\">x</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">G</span><span class=\"o\">)</span> <span class=\"bp\">=</span> <span class=\"o\">((</span><span class=\"err\">∏</span> <span class=\"n\">x</span> <span class=\"o\">:</span> <span class=\"n\">H</span><span class=\"o\">,</span> <span class=\"n\">x</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">G</span><span class=\"o\">)</span> <span class=\"bp\">*</span> <span class=\"o\">(</span><span class=\"err\">∏</span> <span class=\"n\">x</span> <span class=\"o\">:</span> <span class=\"n\">left_coset</span> <span class=\"n\">g</span> <span class=\"err\">↑</span><span class=\"n\">H</span><span class=\"o\">,</span> <span class=\"n\">x</span> <span class=\"o\">)</span>\n</code></pre></div>\n\n\n<p>for the subgroup H given by the previous lemma. I have already proven that the two sets (H and g *l H) are disjoint, so it seemed easy...</p>",
        "id": 205383869,
        "sender_full_name": "Marc Masdeu",
        "timestamp": 1596042004
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110049\">Mario Carneiro</span> <a href=\"#narrow/stream/113489-new-members/topic/Frustration.20with.20finset/near/205383698\">said</a>:</p>\n<blockquote>\n<p>I think something like <code>prod (g : S), f g = prod g in T, f g</code> if <code>S = T</code></p>\n</blockquote>\n<p>I'll try to see if I can write a proof for this...</p>",
        "id": 205384082,
        "sender_full_name": "Marc Masdeu",
        "timestamp": 1596042090
    },
    {
        "content": "<p>That looks messy and unmathematical (but important)</p>",
        "id": 205384573,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1596042295
    },
    {
        "content": "<p>You look like you're on the right track but now things are going to get a bit nasty.</p>",
        "id": 205384829,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1596042410
    },
    {
        "content": "<p>I've never used these finite products before but it looks to me like you're taking a product over a finite type and I think you'd be much better off taking a product over a finite subset of a type</p>",
        "id": 205385010,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1596042497
    },
    {
        "content": "<p>Because then the proof that a product over H union gH equals the product over H times the product over gH will be much easier</p>",
        "id": 205385112,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1596042562
    },
    {
        "content": "<p>Well for me the most confusing thing is that I deal at the same time with a group and a subgroup of it, and then the product may run over subsets of either. I don't know whether I should first coerce everything as elements of the big group, and then take the corresponding set (finset?) or take the set corresponding to the element of the subgroup.</p>",
        "id": 205385264,
        "sender_full_name": "Marc Masdeu",
        "timestamp": 1596042638
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110038\">Kevin Buzzard</span> <a href=\"#narrow/stream/113489-new-members/topic/Frustration.20with.20finset/near/205385010\">said</a>:</p>\n<blockquote>\n<p>I've never used these finite products before but it looks to me like you're taking a product over a finite type and I think you'd be much better off taking a product over a finite subset of a type</p>\n</blockquote>\n<p>Yup, I suggest trying to avoid the subtype</p>",
        "id": 205385680,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1596042872
    },
    {
        "content": "<p>My gut feeling is that you'd be better off always working with subsets of the big group</p>",
        "id": 205385692,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1596042880
    },
    {
        "content": "<p>(Sometimes they are useful... but most of the time I would avoid them.)</p>",
        "id": 205385703,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1596042888
    },
    {
        "content": "<p>I'm affraid this is not what <span class=\"user-mention\" data-user-id=\"110049\">@Mario Carneiro</span> was asking for, right?</p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"kn\">lemma</span> <span class=\"n\">two_products</span> <span class=\"o\">{</span><span class=\"n\">α</span> <span class=\"n\">β</span><span class=\"o\">:</span> <span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span> <span class=\"o\">{</span><span class=\"n\">s</span> <span class=\"o\">:</span> <span class=\"n\">finset</span> <span class=\"n\">α</span><span class=\"o\">}</span> <span class=\"o\">[</span><span class=\"n\">comm_monoid</span> <span class=\"n\">β</span><span class=\"o\">]</span> <span class=\"o\">{</span><span class=\"n\">t</span> <span class=\"o\">:</span> <span class=\"n\">set</span> <span class=\"n\">α</span><span class=\"o\">}</span> <span class=\"o\">[</span><span class=\"n\">fintype</span> <span class=\"n\">t</span><span class=\"o\">]</span> <span class=\"o\">{</span><span class=\"n\">f</span> <span class=\"o\">:</span> <span class=\"n\">α</span> <span class=\"bp\">→</span> <span class=\"n\">β</span><span class=\"o\">}</span>\n<span class=\"o\">(</span><span class=\"n\">h</span><span class=\"o\">:</span> <span class=\"n\">s</span> <span class=\"bp\">=</span> <span class=\"n\">t</span><span class=\"bp\">.</span><span class=\"n\">to_finset</span><span class=\"o\">)</span> <span class=\"o\">:</span>\n<span class=\"o\">(</span><span class=\"err\">∏</span> <span class=\"n\">g</span> <span class=\"k\">in</span> <span class=\"n\">s</span><span class=\"o\">,</span> <span class=\"n\">f</span> <span class=\"n\">g</span><span class=\"o\">)</span> <span class=\"bp\">=</span> <span class=\"o\">(</span><span class=\"err\">∏</span> <span class=\"n\">g</span> <span class=\"k\">in</span> <span class=\"n\">t</span><span class=\"bp\">.</span><span class=\"n\">to_finset</span><span class=\"o\">,</span> <span class=\"n\">f</span> <span class=\"n\">g</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"n\">congr_fun</span> <span class=\"o\">(</span><span class=\"n\">congr_arg</span> <span class=\"n\">finset</span><span class=\"bp\">.</span><span class=\"n\">prod</span> <span class=\"n\">h</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"bp\">λ</span> <span class=\"o\">(</span><span class=\"n\">g</span> <span class=\"o\">:</span> <span class=\"n\">α</span><span class=\"o\">),</span> <span class=\"n\">f</span> <span class=\"n\">g</span><span class=\"o\">)</span>\n</code></pre></div>",
        "id": 205386902,
        "sender_full_name": "Marc Masdeu",
        "timestamp": 1596043530
    },
    {
        "content": "<p>You want <code>t</code> to be a finset</p>",
        "id": 205387019,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1596043578
    },
    {
        "content": "<p>and <code>h</code> could be for example <code>\\forall x, x \\in s &lt;-&gt; x \\in t</code></p>",
        "id": 205387068,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1596043600
    },
    {
        "content": "<p>and <code>s</code> should be a <code>set</code>, with <code>g : s</code> on the left</p>",
        "id": 205387115,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1596043628
    },
    {
        "content": "<p>That's just <code>prod_congr</code>, right?</p>",
        "id": 205387147,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1596043642
    },
    {
        "content": "<p>if you have <code>prod g in s</code> on both sides it's just <code>congr</code></p>",
        "id": 205387174,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1596043656
    },
    {
        "content": "<p>Sure, but there is a lemma <code>prod_congr</code></p>",
        "id": 205387210,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1596043676
    },
    {
        "content": "<p>the point here is that it's two different kinds of summations on each side</p>",
        "id": 205387216,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1596043679
    },
    {
        "content": "<p><code>g : s</code> on the left and <code>g in t</code> on the right</p>",
        "id": 205387283,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1596043692
    },
    {
        "content": "<p>Oh I see. Yes, it's also confusing because the symbol is the same...If s is a finset then one can abbreviate g in s with g : s, according to what's written in big_operators.lean</p>",
        "id": 205387291,
        "sender_full_name": "Marc Masdeu",
        "timestamp": 1596043698
    },
    {
        "content": "<p><code>prod g : s</code> is really <code>prod (g:s) in univ</code></p>",
        "id": 205387341,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1596043730
    },
    {
        "content": "<p><code>prod g in s</code> is therefore not the same (syntactically) as <code>prod g : s</code> even if <code>s</code> is a finset (the latter being <code>prod g in (univ : finset s)</code>)</p>",
        "id": 205387446,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1596043798
    },
    {
        "content": "<p>but there should be a theorem proving they are equal</p>",
        "id": 205387563,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1596043836
    },
    {
        "content": "<p>OK now trying to prove this:</p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"kn\">lemma</span> <span class=\"n\">two_products</span> <span class=\"o\">{</span><span class=\"n\">α</span> <span class=\"n\">β</span><span class=\"o\">:</span> <span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span> <span class=\"o\">{</span><span class=\"n\">s</span> <span class=\"o\">:</span> <span class=\"n\">set</span> <span class=\"n\">α</span><span class=\"o\">}</span> <span class=\"o\">[</span><span class=\"n\">fintype</span> <span class=\"n\">s</span><span class=\"o\">]</span> <span class=\"o\">[</span><span class=\"n\">comm_monoid</span> <span class=\"n\">β</span><span class=\"o\">]</span> <span class=\"o\">{</span><span class=\"n\">t</span> <span class=\"o\">:</span> <span class=\"n\">set</span> <span class=\"n\">α</span><span class=\"o\">}</span> <span class=\"o\">[</span><span class=\"n\">fintype</span> <span class=\"n\">t</span><span class=\"o\">]</span> <span class=\"o\">{</span><span class=\"n\">f</span> <span class=\"o\">:</span> <span class=\"n\">α</span> <span class=\"bp\">→</span> <span class=\"n\">β</span><span class=\"o\">}</span>\n <span class=\"o\">(</span><span class=\"n\">h</span><span class=\"o\">:</span> <span class=\"bp\">∀</span> <span class=\"n\">x</span><span class=\"o\">,</span> <span class=\"n\">x</span> <span class=\"err\">∈</span> <span class=\"n\">s</span> <span class=\"bp\">↔</span> <span class=\"n\">x</span> <span class=\"err\">∈</span> <span class=\"n\">t</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"o\">(</span><span class=\"err\">∏</span> <span class=\"n\">g</span> <span class=\"o\">:</span> <span class=\"n\">s</span><span class=\"o\">,</span> <span class=\"n\">f</span> <span class=\"n\">g</span><span class=\"o\">)</span> <span class=\"bp\">=</span> <span class=\"o\">(</span><span class=\"err\">∏</span> <span class=\"n\">g</span> <span class=\"k\">in</span> <span class=\"n\">t</span><span class=\"bp\">.</span><span class=\"n\">to_finset</span><span class=\"o\">,</span> <span class=\"n\">f</span> <span class=\"n\">g</span><span class=\"o\">)</span>\n</code></pre></div>",
        "id": 205387566,
        "sender_full_name": "Marc Masdeu",
        "timestamp": 1596043839
    },
    {
        "content": "<p>still drop the <code>to_finset</code></p>",
        "id": 205387595,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1596043853
    },
    {
        "content": "<p><code>t : finset A</code></p>",
        "id": 205387633,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1596043874
    },
    {
        "content": "<p>and no <code>fintype t</code> assumption</p>",
        "id": 205387681,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1596043892
    },
    {
        "content": "<p><code>rw ← finset.prod_subtype, apply finset.prod_congr</code> should get you moving again</p>",
        "id": 205387813,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1596043940
    },
    {
        "content": "<p>Not for me, <span class=\"user-mention\" data-user-id=\"112680\">@Johan Commelin</span> ... I am trying this, as Mario suggested:</p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"kn\">lemma</span> <span class=\"n\">two_products</span> <span class=\"o\">{</span><span class=\"n\">α</span> <span class=\"n\">β</span><span class=\"o\">:</span> <span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span> <span class=\"o\">{</span><span class=\"n\">s</span> <span class=\"o\">:</span> <span class=\"n\">set</span> <span class=\"n\">α</span><span class=\"o\">}</span> <span class=\"o\">[</span><span class=\"n\">fintype</span> <span class=\"n\">s</span><span class=\"o\">]</span> <span class=\"o\">[</span><span class=\"n\">comm_monoid</span> <span class=\"n\">β</span><span class=\"o\">]</span> <span class=\"o\">{</span><span class=\"n\">t</span> <span class=\"o\">:</span> <span class=\"n\">finset</span> <span class=\"n\">α</span><span class=\"o\">}</span> <span class=\"o\">{</span><span class=\"n\">f</span> <span class=\"o\">:</span> <span class=\"n\">α</span> <span class=\"bp\">→</span> <span class=\"n\">β</span><span class=\"o\">}</span>\n <span class=\"o\">(</span><span class=\"n\">h</span><span class=\"o\">:</span> <span class=\"bp\">∀</span> <span class=\"n\">x</span><span class=\"o\">,</span> <span class=\"n\">x</span> <span class=\"err\">∈</span> <span class=\"n\">s</span> <span class=\"bp\">↔</span> <span class=\"n\">x</span> <span class=\"err\">∈</span> <span class=\"n\">t</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"o\">(</span><span class=\"err\">∏</span> <span class=\"n\">g</span> <span class=\"o\">:</span> <span class=\"n\">s</span><span class=\"o\">,</span> <span class=\"n\">f</span> <span class=\"n\">g</span><span class=\"o\">)</span> <span class=\"bp\">=</span> <span class=\"o\">(</span><span class=\"err\">∏</span> <span class=\"n\">g</span> <span class=\"k\">in</span> <span class=\"n\">t</span><span class=\"o\">,</span> <span class=\"n\">f</span> <span class=\"n\">g</span><span class=\"o\">)</span> <span class=\"o\">:=</span>\n</code></pre></div>\n\n\n<p>and the first rw gives me 4 goals...</p>",
        "id": 205388180,
        "sender_full_name": "Marc Masdeu",
        "timestamp": 1596044108
    },
    {
        "content": "<p>So now we have to start hunting through the finset and big_operator API to prove this</p>",
        "id": 205388500,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1596044238
    },
    {
        "content": "<p>It helps to understand what the theorem actually says, without all the nice notations. The left product is<br>\n<code>(finset.univ {x // x \\in s}).prod (\\lam x, f x.1)</code>, and the right is <code>t.prod (\\lam x : A, f x)</code></p>",
        "id": 205388732,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1596044331
    },
    {
        "content": "<p>so you need something that talks about applying an injection (in this case <code>x.1</code>) to change the index type</p>",
        "id": 205388935,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1596044409
    },
    {
        "content": "<p>I'm surprised this or something like it hasn't been proved yet. Anyway the general theorem about index changes is <code>prod_bij</code></p>",
        "id": 205389478,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1596044683
    },
    {
        "content": "<p>Do mem_to_finset or coe_to_finset help? I don't know if you are trying a socratic dialogue here...</p>",
        "id": 205389560,
        "sender_full_name": "Marc Masdeu",
        "timestamp": 1596044726
    },
    {
        "content": "<p>You should start the proof by applying <code>prod_bij</code>, which has a ton of assumptions that you can fill in</p>",
        "id": 205389662,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1596044768
    },
    {
        "content": "<p>OK, I'll try.</p>",
        "id": 205389751,
        "sender_full_name": "Marc Masdeu",
        "timestamp": 1596044822
    },
    {
        "content": "<p>You won't need <code>mem_to_finset</code> and such because <code>to_finset</code> doesn't appear in the statement anymore</p>",
        "id": 205390009,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1596044937
    },
    {
        "content": "<p>When I apply prod_bij, some of the goals contain a m_1. This means that it couldn't figure out what I really was applying, right?</p>",
        "id": 205390456,
        "sender_full_name": "Marc Masdeu",
        "timestamp": 1596045162
    },
    {
        "content": "<p>This is the first goal:</p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"err\">⊢</span> <span class=\"bp\">∀</span> <span class=\"o\">(</span><span class=\"n\">a</span> <span class=\"o\">:</span> <span class=\"err\">↥</span><span class=\"n\">s</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">ha</span> <span class=\"o\">:</span> <span class=\"n\">a</span> <span class=\"err\">∈</span> <span class=\"n\">finset</span><span class=\"bp\">.</span><span class=\"n\">univ</span><span class=\"o\">),</span> <span class=\"err\">?</span><span class=\"n\">m_1</span> <span class=\"n\">a</span> <span class=\"n\">ha</span> <span class=\"err\">∈</span> <span class=\"n\">t</span>\n</code></pre></div>",
        "id": 205390493,
        "sender_full_name": "Marc Masdeu",
        "timestamp": 1596045183
    },
    {
        "content": "<p>If you use <code>refine prod_bij _ _ _ _ _ _ _,</code> you can give the functions in the first few underscores, so that you don't get any <code>?m_1 a ha</code> business</p>",
        "id": 205390661,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1596045257
    },
    {
        "content": "<p>I think the function is <code>\\lam x _, x.1</code></p>",
        "id": 205391009,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1596045423
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span><code><span class=\"kn\">lemma</span> <span class=\"n\">two_products</span> <span class=\"o\">{</span><span class=\"n\">α</span> <span class=\"n\">β</span><span class=\"o\">:</span> <span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span> <span class=\"o\">{</span><span class=\"n\">s</span> <span class=\"o\">:</span> <span class=\"n\">set</span> <span class=\"n\">α</span><span class=\"o\">}</span> <span class=\"o\">[</span><span class=\"n\">fintype</span> <span class=\"n\">s</span><span class=\"o\">]</span> <span class=\"o\">[</span><span class=\"n\">comm_monoid</span> <span class=\"n\">β</span><span class=\"o\">]</span> <span class=\"o\">{</span><span class=\"n\">t</span> <span class=\"o\">:</span> <span class=\"n\">finset</span> <span class=\"n\">α</span><span class=\"o\">}</span> <span class=\"o\">{</span><span class=\"n\">f</span> <span class=\"o\">:</span> <span class=\"n\">α</span> <span class=\"bp\">→</span> <span class=\"n\">β</span><span class=\"o\">}</span>\n <span class=\"o\">(</span><span class=\"n\">h</span><span class=\"o\">:</span> <span class=\"bp\">∀</span> <span class=\"n\">x</span><span class=\"o\">,</span> <span class=\"n\">x</span> <span class=\"err\">∈</span> <span class=\"n\">s</span> <span class=\"bp\">↔</span> <span class=\"n\">x</span> <span class=\"err\">∈</span> <span class=\"n\">t</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"o\">(</span><span class=\"err\">∏</span> <span class=\"n\">g</span> <span class=\"o\">:</span> <span class=\"n\">s</span><span class=\"o\">,</span> <span class=\"n\">f</span> <span class=\"n\">g</span><span class=\"o\">)</span> <span class=\"bp\">=</span> <span class=\"o\">(</span><span class=\"err\">∏</span> <span class=\"n\">g</span> <span class=\"k\">in</span> <span class=\"n\">t</span><span class=\"o\">,</span> <span class=\"n\">f</span> <span class=\"n\">g</span><span class=\"o\">)</span> <span class=\"o\">:=</span>\n<span class=\"k\">begin</span>\n<span class=\"n\">refine</span> <span class=\"n\">finset</span><span class=\"bp\">.</span><span class=\"n\">prod_bij</span> <span class=\"o\">(</span><span class=\"bp\">λ</span> <span class=\"n\">x</span> <span class=\"bp\">_</span><span class=\"o\">,</span> <span class=\"n\">x</span><span class=\"bp\">.</span><span class=\"mi\">1</span><span class=\"o\">)</span> <span class=\"bp\">_</span> <span class=\"bp\">_</span> <span class=\"bp\">_</span> <span class=\"bp\">_</span><span class=\"o\">,</span>\n<span class=\"o\">{</span>\n  <span class=\"n\">intros</span> <span class=\"n\">a</span> <span class=\"n\">ha</span><span class=\"o\">,</span>\n  <span class=\"n\">specialize</span> <span class=\"n\">h</span> <span class=\"n\">a</span><span class=\"o\">,</span>\n  <span class=\"n\">apply</span> <span class=\"n\">h</span><span class=\"bp\">.</span><span class=\"n\">mp</span><span class=\"o\">,</span>\n  <span class=\"n\">exact</span> <span class=\"n\">subtype</span><span class=\"bp\">.</span><span class=\"n\">mem</span> <span class=\"n\">a</span><span class=\"o\">,</span>\n<span class=\"o\">},</span>\n<span class=\"o\">{</span>\n  <span class=\"n\">intros</span> <span class=\"n\">a</span> <span class=\"n\">ha</span><span class=\"o\">,</span>\n  <span class=\"n\">refl</span><span class=\"o\">,</span>\n<span class=\"o\">},</span>\n<span class=\"o\">{</span>\n  <span class=\"n\">intros</span> <span class=\"n\">a1</span> <span class=\"n\">a2</span> <span class=\"n\">h1</span> <span class=\"n\">h2</span><span class=\"o\">,</span>\n  <span class=\"n\">exact</span> <span class=\"n\">subtype</span><span class=\"bp\">.</span><span class=\"n\">eq</span><span class=\"o\">,</span>\n<span class=\"o\">},</span>\n<span class=\"o\">{</span>\n  <span class=\"n\">intros</span> <span class=\"n\">b</span> <span class=\"n\">hb</span><span class=\"o\">,</span>\n  <span class=\"n\">specialize</span> <span class=\"n\">h</span> <span class=\"n\">b</span><span class=\"o\">,</span>\n  <span class=\"n\">use</span> <span class=\"n\">b</span><span class=\"o\">,</span>\n  <span class=\"n\">rw</span> <span class=\"n\">h</span><span class=\"o\">,</span>\n  <span class=\"n\">exact</span> <span class=\"n\">hb</span><span class=\"o\">,</span>\n  <span class=\"n\">split</span><span class=\"o\">,</span>\n  <span class=\"n\">apply</span> <span class=\"n\">finset</span><span class=\"bp\">.</span><span class=\"n\">mem_univ</span><span class=\"o\">,</span>\n  <span class=\"n\">exact</span> <span class=\"n\">rfl</span><span class=\"o\">,</span>\n<span class=\"o\">}</span>\n<span class=\"kn\">end</span>\n</code></pre></div>",
        "id": 205393157,
        "sender_full_name": "Marc Masdeu",
        "timestamp": 1596046357
    },
    {
        "content": "<p>This all sounds like issues that were obviously solved in mathcomp before formalizing the odd order theorem, but this observation is taboo here.</p>",
        "id": 205394050,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1596046763
    },
    {
        "content": "<p>This is a hole in the library. Of course the proof isn't nice</p>",
        "id": 205394282,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1596046874
    },
    {
        "content": "<p>the correct proof is to cite this theorem</p>",
        "id": 205394313,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1596046891
    },
    {
        "content": "<p>but the theorem didn't exist</p>",
        "id": 205394329,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1596046899
    },
    {
        "content": "<p>Is anyone working in improving the user experience with sets/finsets/fintypes and the like? It is basic enough that it can cause problems in many places...</p>",
        "id": 205394489,
        "sender_full_name": "Marc Masdeu",
        "timestamp": 1596046969
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110031\">Patrick Massot</span> <a href=\"#narrow/stream/113489-new-members/topic/Frustration.20with.20finset/near/205394050\">said</a>:</p>\n<blockquote>\n<p>This all sounds like issues that were obviously solved in mathcomp before formalizing the odd order theorem, but this observation is taboo here.</p>\n</blockquote>\n<p>Please elaborate, the story sounds potentially interesting!</p>",
        "id": 205394558,
        "sender_full_name": "Marc Masdeu",
        "timestamp": 1596047011
    },
    {
        "content": "<p>The best way to solve these problems is to have a really complete library of basic lemmas</p>",
        "id": 205394976,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1596047202
    },
    {
        "content": "<p>finset itself has a fairly complete API, and big_operators do too, for the most part. Like I said I'm surprised this was missed</p>",
        "id": 205395063,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1596047244
    },
    {
        "content": "<p>I see that <code>algebra.big_operators.basic</code> doesn't import <code>fintype</code> so it's impossible to state this theorem in that file. So maybe it is in another file and I missed it</p>",
        "id": 205395215,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1596047294
    },
    {
        "content": "<p>Marc, the story is: some very smart people spend six years working on how to do finite groups in a proof assistant very close to Lean. They wrote several papers about the clever tricks they found the most useful. Sentences like \"Well for me the most confusing thing is that I deal at the same time with a group and a subgroup of it,\" were at the heart of those papers. So we ignore them.</p>",
        "id": 205395267,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1596047321
    },
    {
        "content": "<p>I didn't watch closely when <code>algebra.big_operators</code> got split into pieces</p>",
        "id": 205395275,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1596047325
    },
    {
        "content": "<p>eh, found it</p>",
        "id": 205395629,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1596047492
    },
    {
        "content": "<p><a href=\"https://leanprover-community.github.io/mathlib_docs/find/finset.prod_subtype/src\">src#finset.prod_subtype</a></p>",
        "id": 205395641,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1596047497
    },
    {
        "content": "<p>In the same way, there is a huge subgroup refactor going on. Those Coq people told us repeatedly that they found a very simple criterion to see whether we get this right: painlessly state and prove the <a href=\"https://groupprops.subwiki.org/wiki/Third_isomorphism_theorem\">third isomorphism theorem</a>. So we invest a lot of time in the refactor and never discuss how this test will go once the refactor will be done (I asked the question several time and never got any answer).</p>",
        "id": 205395752,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1596047533
    },
    {
        "content": "<p>Do you think that the 3rd iso theorem will go bad after this, then??</p>",
        "id": 205396982,
        "sender_full_name": "Marc Masdeu",
        "timestamp": 1596048096
    },
    {
        "content": "<p>Patrick, my impression in the odd order work is that they solve this by never talking about the cardinality of a type. Every group is a subgroup of a large ambient group and they only have one notion of cardinality, that of a subset of a group.</p>\n<p>As for refactoring subgroups, I think that the third isomorphism theorem should be easy with bundled subgroups but I can't check until Friday. We have a really nice <code>map</code> and <code>comap</code> for group homs. We have N and K normal in G and N a subset of K, we have a construction making a subgroup a group. I don't envisage any problems</p>",
        "id": 205397363,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1596048285
    },
    {
        "content": "<p>Here's the statement</p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"kn\">import</span> <span class=\"n\">group_theory</span><span class=\"bp\">.</span><span class=\"n\">quotient_group</span> <span class=\"n\">data</span><span class=\"bp\">.</span><span class=\"n\">equiv</span><span class=\"bp\">.</span><span class=\"n\">mul_add</span>\n\n<span class=\"kn\">variables</span> <span class=\"o\">{</span><span class=\"n\">α</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span> <span class=\"o\">[</span><span class=\"n\">group</span> <span class=\"n\">α</span><span class=\"o\">]</span>\n\n<span class=\"n\">def</span> <span class=\"n\">image_normal</span> <span class=\"o\">{</span><span class=\"n\">G</span> <span class=\"n\">H</span><span class=\"o\">}</span> <span class=\"o\">[</span><span class=\"n\">group</span> <span class=\"n\">G</span><span class=\"o\">]</span> <span class=\"o\">[</span><span class=\"n\">group</span> <span class=\"n\">H</span><span class=\"o\">]</span>\n  <span class=\"o\">(</span><span class=\"n\">f</span> <span class=\"o\">:</span> <span class=\"n\">G</span> <span class=\"bp\">→</span> <span class=\"n\">H</span><span class=\"o\">)</span> <span class=\"o\">[</span><span class=\"n\">is_group_hom</span> <span class=\"n\">f</span><span class=\"o\">]</span> <span class=\"o\">(</span><span class=\"n\">hf</span> <span class=\"o\">:</span> <span class=\"n\">function</span><span class=\"bp\">.</span><span class=\"n\">surjective</span> <span class=\"n\">f</span><span class=\"o\">)</span>\n  <span class=\"o\">(</span><span class=\"n\">s</span> <span class=\"o\">:</span> <span class=\"n\">set</span> <span class=\"n\">G</span><span class=\"o\">)</span> <span class=\"o\">[</span><span class=\"n\">normal_subgroup</span> <span class=\"n\">s</span><span class=\"o\">]</span> <span class=\"o\">:</span> <span class=\"n\">normal_subgroup</span> <span class=\"o\">(</span><span class=\"n\">f</span> <span class=\"err\">&#39;&#39;</span> <span class=\"n\">s</span><span class=\"o\">)</span> <span class=\"o\">:=</span>\n<span class=\"bp\">⟨</span><span class=\"k\">begin</span>\n  <span class=\"n\">rintro</span> <span class=\"bp\">_</span> <span class=\"bp\">⟨</span><span class=\"n\">a</span><span class=\"o\">,</span> <span class=\"n\">h</span><span class=\"o\">,</span> <span class=\"n\">rfl</span><span class=\"bp\">⟩</span> <span class=\"n\">b</span><span class=\"o\">,</span>\n  <span class=\"k\">obtain</span> <span class=\"bp\">⟨</span><span class=\"n\">b</span><span class=\"o\">,</span> <span class=\"n\">rfl</span><span class=\"bp\">⟩</span> <span class=\"o\">:=</span> <span class=\"n\">hf</span> <span class=\"n\">b</span><span class=\"o\">,</span>\n  <span class=\"n\">refine</span> <span class=\"bp\">⟨_</span><span class=\"o\">,</span> <span class=\"n\">normal_subgroup</span><span class=\"bp\">.</span><span class=\"n\">normal</span> <span class=\"n\">a</span> <span class=\"n\">h</span> <span class=\"n\">b</span><span class=\"o\">,</span> <span class=\"bp\">_⟩</span><span class=\"o\">,</span>\n  <span class=\"n\">rw</span> <span class=\"o\">[</span><span class=\"n\">is_mul_hom</span><span class=\"bp\">.</span><span class=\"n\">map_mul</span> <span class=\"n\">f</span><span class=\"o\">,</span> <span class=\"n\">is_mul_hom</span><span class=\"bp\">.</span><span class=\"n\">map_mul</span> <span class=\"n\">f</span><span class=\"o\">,</span> <span class=\"n\">is_group_hom</span><span class=\"bp\">.</span><span class=\"n\">map_inv</span> <span class=\"n\">f</span><span class=\"o\">],</span>\n<span class=\"kn\">end</span><span class=\"bp\">⟩</span>\n\n<span class=\"kn\">structure</span> <span class=\"n\">normal_subgroup&#39;</span> <span class=\"o\">(</span><span class=\"n\">α</span><span class=\"o\">)</span> <span class=\"o\">[</span><span class=\"n\">group</span> <span class=\"n\">α</span><span class=\"o\">]</span> <span class=\"o\">:=</span>\n<span class=\"o\">(</span><span class=\"n\">carrier</span> <span class=\"o\">:</span> <span class=\"n\">set</span> <span class=\"n\">α</span><span class=\"o\">)</span> <span class=\"o\">[</span><span class=\"n\">is_normal</span> <span class=\"o\">:</span> <span class=\"n\">normal_subgroup</span> <span class=\"n\">carrier</span><span class=\"o\">]</span>\n\n<span class=\"n\">attribute</span> <span class=\"o\">[</span><span class=\"kn\">instance</span><span class=\"o\">]</span> <span class=\"n\">normal_subgroup&#39;</span><span class=\"bp\">.</span><span class=\"n\">is_normal</span>\n\n<span class=\"n\">def</span> <span class=\"n\">to_subgroup</span> <span class=\"o\">(</span><span class=\"n\">s</span> <span class=\"o\">:</span> <span class=\"n\">normal_subgroup&#39;</span> <span class=\"n\">α</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">subgroup</span> <span class=\"n\">α</span> <span class=\"o\">:=</span> <span class=\"n\">subgroup</span><span class=\"bp\">.</span><span class=\"n\">of</span> <span class=\"n\">s</span><span class=\"bp\">.</span><span class=\"n\">carrier</span>\n\n<span class=\"kn\">instance</span> <span class=\"n\">normal_subgroup&#39;</span><span class=\"bp\">.</span><span class=\"n\">coe_subgroup</span> <span class=\"o\">:</span> <span class=\"n\">has_coe</span> <span class=\"o\">(</span><span class=\"n\">normal_subgroup&#39;</span> <span class=\"n\">α</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">subgroup</span> <span class=\"n\">α</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"bp\">⟨</span><span class=\"n\">to_subgroup</span><span class=\"bp\">⟩</span>\n\n<span class=\"kn\">instance</span> <span class=\"n\">normal_subgroup&#39;</span><span class=\"bp\">.</span><span class=\"n\">coe_normal_subgroup</span> <span class=\"o\">(</span><span class=\"n\">s</span> <span class=\"o\">:</span> <span class=\"n\">normal_subgroup&#39;</span> <span class=\"n\">α</span><span class=\"o\">)</span> <span class=\"o\">:</span>\n  <span class=\"n\">normal_subgroup</span> <span class=\"o\">(</span><span class=\"n\">s</span> <span class=\"o\">:</span> <span class=\"n\">set</span> <span class=\"n\">α</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"n\">normal_subgroup&#39;</span><span class=\"bp\">.</span><span class=\"n\">is_normal</span> <span class=\"bp\">_</span>\n\n<span class=\"kn\">instance</span> <span class=\"n\">normal_subgroup&#39;</span><span class=\"bp\">.</span><span class=\"n\">coe_coe_normal_subgroup</span> <span class=\"o\">(</span><span class=\"n\">s</span> <span class=\"o\">:</span> <span class=\"n\">normal_subgroup&#39;</span> <span class=\"n\">α</span><span class=\"o\">)</span> <span class=\"o\">:</span>\n  <span class=\"n\">normal_subgroup</span> <span class=\"o\">((</span><span class=\"n\">s</span> <span class=\"o\">:</span> <span class=\"n\">subgroup</span> <span class=\"n\">α</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">set</span> <span class=\"n\">α</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"n\">normal_subgroup&#39;</span><span class=\"bp\">.</span><span class=\"n\">is_normal</span> <span class=\"bp\">_</span>\n\n<span class=\"kn\">instance</span> <span class=\"o\">:</span> <span class=\"n\">preorder</span> <span class=\"o\">(</span><span class=\"n\">normal_subgroup&#39;</span> <span class=\"n\">α</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"n\">preorder</span><span class=\"bp\">.</span><span class=\"n\">lift</span> <span class=\"n\">normal_subgroup&#39;</span><span class=\"bp\">.</span><span class=\"n\">carrier</span>\n\n<span class=\"n\">def</span> <span class=\"n\">normal_subgroup&#39;</span><span class=\"bp\">.</span><span class=\"n\">image</span> <span class=\"o\">{</span><span class=\"n\">G</span> <span class=\"n\">H</span><span class=\"o\">}</span> <span class=\"o\">[</span><span class=\"n\">group</span> <span class=\"n\">G</span><span class=\"o\">]</span> <span class=\"o\">[</span><span class=\"n\">group</span> <span class=\"n\">H</span><span class=\"o\">]</span> <span class=\"o\">(</span><span class=\"n\">f</span> <span class=\"o\">:</span> <span class=\"n\">G</span> <span class=\"bp\">→*</span> <span class=\"n\">H</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">hf</span> <span class=\"o\">:</span> <span class=\"n\">function</span><span class=\"bp\">.</span><span class=\"n\">surjective</span> <span class=\"n\">f</span><span class=\"o\">)</span>\n  <span class=\"o\">(</span><span class=\"n\">s</span> <span class=\"o\">:</span> <span class=\"n\">normal_subgroup&#39;</span> <span class=\"n\">G</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">normal_subgroup&#39;</span> <span class=\"n\">H</span> <span class=\"o\">:=</span>\n<span class=\"k\">by</span> <span class=\"n\">haveI</span> <span class=\"o\">:=</span> <span class=\"n\">image_normal</span> <span class=\"n\">f</span> <span class=\"n\">hf</span> <span class=\"n\">s</span><span class=\"bp\">;</span> <span class=\"n\">exact</span> <span class=\"bp\">⟨</span><span class=\"n\">f</span> <span class=\"err\">&#39;&#39;</span> <span class=\"n\">s</span><span class=\"bp\">⟩</span>\n\n<span class=\"kn\">namespace</span> <span class=\"n\">quotient_group</span>\n\n<span class=\"n\">def</span> <span class=\"n\">quotient&#39;</span> <span class=\"o\">[</span><span class=\"n\">group</span> <span class=\"n\">α</span><span class=\"o\">]</span> <span class=\"o\">(</span><span class=\"n\">s</span> <span class=\"o\">:</span> <span class=\"n\">normal_subgroup&#39;</span> <span class=\"n\">α</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span><span class=\"bp\">*</span> <span class=\"o\">:=</span> <span class=\"n\">quotient</span> <span class=\"o\">((</span><span class=\"n\">s</span> <span class=\"o\">:</span> <span class=\"n\">subgroup</span> <span class=\"n\">α</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">set</span> <span class=\"n\">α</span><span class=\"o\">)</span>\n\n<span class=\"kn\">variables</span> <span class=\"o\">[</span><span class=\"n\">group</span> <span class=\"n\">α</span><span class=\"o\">]</span> <span class=\"o\">{</span><span class=\"n\">s</span> <span class=\"o\">:</span> <span class=\"n\">normal_subgroup&#39;</span> <span class=\"n\">α</span><span class=\"o\">}</span>\n\n<span class=\"kn\">instance</span> <span class=\"n\">quotient_group</span><span class=\"bp\">.</span><span class=\"n\">group&#39;</span> <span class=\"o\">(</span><span class=\"n\">s</span> <span class=\"o\">:</span> <span class=\"n\">normal_subgroup&#39;</span> <span class=\"n\">α</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">group</span> <span class=\"o\">(</span><span class=\"n\">quotient&#39;</span> <span class=\"n\">s</span><span class=\"o\">)</span> <span class=\"o\">:=</span>\n<span class=\"n\">quotient_group</span><span class=\"bp\">.</span><span class=\"n\">group</span> <span class=\"n\">s</span>\n\n<span class=\"n\">def</span> <span class=\"n\">mk&#39;</span> <span class=\"o\">:</span> <span class=\"n\">α</span> <span class=\"bp\">→</span> <span class=\"n\">quotient&#39;</span> <span class=\"n\">s</span> <span class=\"o\">:=</span> <span class=\"n\">quotient</span><span class=\"bp\">.</span><span class=\"n\">mk&#39;</span>\n\n<span class=\"kn\">instance</span> <span class=\"n\">mk&#39;</span><span class=\"bp\">.</span><span class=\"n\">is_group_hom</span> <span class=\"o\">:</span> <span class=\"n\">is_group_hom</span> <span class=\"o\">(</span><span class=\"n\">mk&#39;</span> <span class=\"o\">:</span> <span class=\"n\">α</span> <span class=\"bp\">→</span> <span class=\"n\">quotient&#39;</span> <span class=\"n\">s</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"n\">quotient_group</span><span class=\"bp\">.</span><span class=\"n\">is_group_hom</span> <span class=\"bp\">_</span>\n\n<span class=\"n\">def</span> <span class=\"n\">mk_hom</span> <span class=\"o\">:</span> <span class=\"n\">α</span> <span class=\"bp\">→*</span> <span class=\"n\">quotient&#39;</span> <span class=\"n\">s</span> <span class=\"o\">:=</span> <span class=\"n\">monoid_hom</span><span class=\"bp\">.</span><span class=\"n\">of</span> <span class=\"n\">mk&#39;</span>\n\n<span class=\"kn\">variable</span> <span class=\"o\">(</span><span class=\"n\">s</span><span class=\"o\">)</span>\n<span class=\"n\">def</span> <span class=\"n\">below</span> <span class=\"o\">(</span><span class=\"n\">t</span> <span class=\"o\">:</span> <span class=\"n\">normal_subgroup&#39;</span> <span class=\"n\">α</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">normal_subgroup&#39;</span> <span class=\"o\">(</span><span class=\"n\">quotient&#39;</span> <span class=\"n\">s</span><span class=\"o\">)</span> <span class=\"o\">:=</span>\n<span class=\"n\">t</span><span class=\"bp\">.</span><span class=\"n\">image</span> <span class=\"n\">mk_hom</span> <span class=\"err\">$</span> <span class=\"k\">by</span> <span class=\"n\">rintro</span> <span class=\"bp\">⟨</span><span class=\"n\">i</span><span class=\"bp\">⟩;</span> <span class=\"n\">exact</span> <span class=\"bp\">⟨_</span><span class=\"o\">,</span> <span class=\"n\">rfl</span><span class=\"bp\">⟩</span>\n\n<span class=\"kn\">end</span> <span class=\"n\">quotient_group</span>\n\n<span class=\"kn\">theorem</span> <span class=\"n\">third_isomorphism_thm</span> <span class=\"o\">{</span><span class=\"n\">G</span><span class=\"o\">}</span> <span class=\"o\">[</span><span class=\"n\">group</span> <span class=\"n\">G</span><span class=\"o\">]</span> <span class=\"o\">{</span><span class=\"n\">H</span> <span class=\"n\">K</span> <span class=\"o\">:</span> <span class=\"n\">normal_subgroup&#39;</span> <span class=\"n\">G</span><span class=\"o\">}</span> <span class=\"o\">(</span><span class=\"n\">h</span> <span class=\"o\">:</span> <span class=\"n\">H</span> <span class=\"bp\">≤</span> <span class=\"n\">K</span><span class=\"o\">)</span> <span class=\"o\">:</span>\n  <span class=\"n\">quotient_group</span><span class=\"bp\">.</span><span class=\"n\">quotient&#39;</span> <span class=\"o\">(</span><span class=\"n\">quotient_group</span><span class=\"bp\">.</span><span class=\"n\">below</span> <span class=\"n\">H</span> <span class=\"n\">K</span><span class=\"o\">)</span> <span class=\"err\">≃</span><span class=\"bp\">*</span> <span class=\"n\">quotient_group</span><span class=\"bp\">.</span><span class=\"n\">quotient&#39;</span> <span class=\"n\">H</span> <span class=\"o\">:=</span>\n<span class=\"n\">sorry</span>\n</code></pre></div>",
        "id": 205401917,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1596050633
    },
    {
        "content": "<p>the proof is easier if you have all the hom functions doing equalizer tricks</p>",
        "id": 205402063,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1596050708
    },
    {
        "content": "<p>is_group_hom is deprecated</p>",
        "id": 205407597,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1596053489
    },
    {
        "content": "<p>I know?</p>",
        "id": 205408618,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1596054014
    },
    {
        "content": "<p>For the purpose of simplifying the proof, I'm using the deprecated lemmas to prove the bundled ones. In a proper refactor you would rewrite the proofs</p>",
        "id": 205408671,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1596054053
    },
    {
        "content": "<p>The hard part here, as ever, is just setting up statements - ignore the proofs, which are all trivial anyway</p>",
        "id": 205408787,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1596054121
    },
    {
        "content": "<p>I only had to prove one theorem about <code>is_group_hom</code> which was missing from the library (<code>image_normal</code>)</p>",
        "id": 205408897,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1596054159
    },
    {
        "content": "<p>In the bundling subgroup refactor we still don't bundle normal subgroups. I don't know what I feel about this. In the group theory game we're going to bundle them</p>",
        "id": 205409843,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1596054629
    },
    {
        "content": "<p>I know, I wondered about this as well. I think there is a good argument for bundling them - <code>quotient</code> is naturally a function on it, and the whole family <code>ker</code>/<code>im</code>/<code>map</code>/<code>comap</code>/ complete lattice structure exists for them</p>",
        "id": 205410068,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1596054740
    },
    {
        "content": "<p>the downside is that now we have a more complicated coercion graph</p>",
        "id": 205410146,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1596054804
    },
    {
        "content": "<p>OK, back to finsets... Here's a puzzle which doesn't involve unions and the such:</p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"kn\">variables</span> <span class=\"o\">{</span><span class=\"n\">G</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span> <span class=\"o\">[</span><span class=\"n\">comm_group</span> <span class=\"n\">G</span><span class=\"o\">]</span> <span class=\"o\">[</span><span class=\"n\">fintype</span> <span class=\"n\">G</span><span class=\"o\">]</span>\n\n<span class=\"kn\">lemma</span> <span class=\"n\">fintype_card_eq_finset_card&#39;</span> <span class=\"o\">:</span> <span class=\"n\">fintype</span><span class=\"bp\">.</span><span class=\"n\">card</span> <span class=\"n\">G</span> <span class=\"bp\">=</span>\n       <span class=\"n\">finset</span><span class=\"bp\">.</span><span class=\"n\">card</span> <span class=\"o\">(((</span><span class=\"err\">⊤</span> <span class=\"o\">:</span> <span class=\"n\">subgroup</span> <span class=\"n\">G</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">set</span> <span class=\"n\">G</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">to_finset</span><span class=\"o\">):=</span>\n<span class=\"k\">begin</span>\n    <span class=\"n\">sorry</span>\n<span class=\"kn\">end</span>\n</code></pre></div>",
        "id": 205463913,
        "sender_full_name": "Marc Masdeu",
        "timestamp": 1596105994
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span><code><span class=\"kn\">import</span> <span class=\"n\">data</span><span class=\"bp\">.</span><span class=\"n\">fintype</span><span class=\"bp\">.</span><span class=\"n\">card</span> <span class=\"n\">group_theory</span><span class=\"bp\">.</span><span class=\"n\">subgroup</span>\n\n<span class=\"kn\">variables</span> <span class=\"o\">{</span><span class=\"n\">G</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span> <span class=\"o\">[</span><span class=\"n\">comm_group</span> <span class=\"n\">G</span><span class=\"o\">]</span> <span class=\"o\">[</span><span class=\"n\">fintype</span> <span class=\"n\">G</span><span class=\"o\">]</span>\n\n<span class=\"n\">open_locale</span> <span class=\"n\">classical</span>\n\n<span class=\"kn\">lemma</span> <span class=\"n\">fintype_card_eq_finset_card&#39;</span> <span class=\"o\">:</span>\n  <span class=\"n\">fintype</span><span class=\"bp\">.</span><span class=\"n\">card</span> <span class=\"n\">G</span> <span class=\"bp\">=</span> <span class=\"n\">finset</span><span class=\"bp\">.</span><span class=\"n\">card</span> <span class=\"o\">(((</span><span class=\"err\">⊤</span> <span class=\"o\">:</span> <span class=\"n\">subgroup</span> <span class=\"n\">G</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">set</span> <span class=\"n\">G</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">to_finset</span><span class=\"o\">):=</span>\n<span class=\"k\">begin</span>\n  <span class=\"n\">unfold</span> <span class=\"n\">fintype</span><span class=\"bp\">.</span><span class=\"n\">card</span><span class=\"o\">,</span> <span class=\"n\">congr</span><span class=\"o\">,</span> <span class=\"n\">rw</span> <span class=\"n\">subgroup</span><span class=\"bp\">.</span><span class=\"n\">coe_top</span><span class=\"o\">,</span> <span class=\"n\">convert</span> <span class=\"n\">set</span><span class=\"bp\">.</span><span class=\"n\">to_finset_univ</span><span class=\"bp\">.</span><span class=\"n\">symm</span><span class=\"o\">,</span>\n<span class=\"kn\">end</span>\n</code></pre></div>",
        "id": 205464111,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1596106174
    },
    {
        "content": "<p>we need <span class=\"user-mention\" data-user-id=\"110038\">@Kevin Buzzard</span> 's <code>fincard</code></p>",
        "id": 205464121,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1596106190
    },
    {
        "content": "<p>Thanks for teaching me the <code>convert</code> tactic, <span class=\"user-mention\" data-user-id=\"110064\">@Kenny Lau</span> !</p>",
        "id": 205464594,
        "sender_full_name": "Marc Masdeu",
        "timestamp": 1596106540
    },
    {
        "content": "<p>cheers</p>",
        "id": 205464600,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1596106552
    },
    {
        "content": "<p>I don't know if I pushed it to the group theory game repo. If I didn't then it's inaccessible until Friday evening</p>",
        "id": 205465936,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1596107720
    },
    {
        "content": "<p>Thanks to <span class=\"user-mention\" data-user-id=\"112680\">@Johan Commelin</span>, <span class=\"user-mention\" data-user-id=\"110064\">@Kenny Lau</span> , <span class=\"user-mention\" data-user-id=\"110038\">@Kevin Buzzard</span>, <span class=\"user-mention\" data-user-id=\"110049\">@Mario Carneiro</span> (and probably others that on Zulip that I am forgetting) I have managed to formalize (the proof of) a non-trivial group-theory statement:</p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"kn\">theorem</span> <span class=\"n\">prod_identity_general</span> <span class=\"o\">{</span><span class=\"n\">G</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span> <span class=\"o\">[</span><span class=\"n\">comm_group</span> <span class=\"n\">G</span><span class=\"o\">]</span> <span class=\"o\">[</span><span class=\"n\">fintype</span> <span class=\"n\">G</span><span class=\"o\">]</span> <span class=\"o\">{</span><span class=\"n\">g</span> <span class=\"o\">:</span> <span class=\"n\">G</span><span class=\"o\">}</span> <span class=\"o\">(</span><span class=\"n\">h1</span> <span class=\"o\">:</span> <span class=\"n\">g</span> <span class=\"bp\">≠</span> <span class=\"mi\">1</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">h2</span> <span class=\"o\">:</span> <span class=\"n\">g</span> <span class=\"bp\">*</span> <span class=\"n\">g</span> <span class=\"bp\">=</span> <span class=\"mi\">1</span><span class=\"o\">)</span> <span class=\"o\">:</span>\n <span class=\"o\">(</span><span class=\"err\">∏</span> <span class=\"n\">x</span> <span class=\"o\">:</span> <span class=\"n\">G</span><span class=\"o\">,</span> <span class=\"n\">x</span><span class=\"o\">)</span> <span class=\"bp\">=</span> <span class=\"n\">g</span><span class=\"bp\">^</span><span class=\"o\">(</span><span class=\"n\">fintype</span><span class=\"bp\">.</span><span class=\"n\">card</span> <span class=\"o\">(</span><span class=\"n\">two_torsion_subgroup</span> <span class=\"n\">G</span><span class=\"o\">)</span> <span class=\"bp\">/</span> <span class=\"mi\">2</span><span class=\"o\">)</span>\n</code></pre></div>\n\n\n<p>I'll try next to apply it to (Z/nZ)^*...</p>",
        "id": 205596636,
        "sender_full_name": "Marc Masdeu",
        "timestamp": 1596205745
    },
    {
        "content": "<p>Awesome! Is your code online somewhere?</p>",
        "id": 205657358,
        "sender_full_name": "Carl Friedrich Bolz-Tereick",
        "timestamp": 1596245181
    }
]