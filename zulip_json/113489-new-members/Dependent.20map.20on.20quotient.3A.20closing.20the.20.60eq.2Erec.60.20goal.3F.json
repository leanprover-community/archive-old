[
    {
        "content": "<p>I'm trying to define the quotient of a groupoid by a normal subgroupoid below (following Bourbaki's <em>Topologie Alg√©brique</em>), and to do so I need first to define the vertices as a quotient, and then the arrows as another one (see below). I'm getting into troubles when trying to define the identity and composition morphisms, since their types depend on the element(s) on which they are defined.<br>\n<code>quot.rec</code> seems to be the correct way to proceed, but then I¬†get stuck trying to prove the \"soundness\" of my recursion, which involves an <code>eq.rec</code>. Am I off-base, or missing something?<br>\nNote that for the identity morphism, I¬†can get around this problem since I can first define a non-dependent lift, but it's not really \"pretty\" and wouldn't work for the composition without ugly tricks, I¬†believe.</p>\n<p>Thanks!</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kn\">import</span> <span class=\"n\">category_theory.groupoid</span>\n\n<span class=\"kn\">open</span> <span class=\"n\">set</span>\n\n<span class=\"kn\">namespace</span> <span class=\"n\">category_theory</span>\n\n<span class=\"kd\">universes</span> <span class=\"n\">u</span> <span class=\"n\">v</span>\n\n<span class=\"kd\">variables</span> <span class=\"o\">{</span><span class=\"n\">C</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span> <span class=\"n\">u</span><span class=\"o\">}</span>\n\n<span class=\"kn\">namespace</span> <span class=\"n\">groupoid</span>\n\n<span class=\"kn\">section</span> <span class=\"n\">subgroupoid</span>\n\n<span class=\"kd\">variable</span> <span class=\"o\">(</span><span class=\"n\">G</span> <span class=\"o\">:</span> <span class=\"n\">groupoid</span> <span class=\"n\">C</span><span class=\"o\">)</span>\n\n<span class=\"kd\">@[ext]</span>\n<span class=\"kd\">structure</span> <span class=\"n\">subgroupoid</span> <span class=\"o\">:=</span>\n  <span class=\"o\">(</span><span class=\"n\">arrws</span> <span class=\"o\">:</span> <span class=\"bp\">‚àÄ</span> <span class=\"o\">(</span><span class=\"n\">c</span> <span class=\"n\">d</span> <span class=\"o\">:</span> <span class=\"n\">C</span><span class=\"o\">),</span> <span class=\"n\">set</span> <span class=\"o\">(</span><span class=\"n\">G.hom</span> <span class=\"n\">c</span> <span class=\"n\">d</span><span class=\"o\">))</span>\n  <span class=\"o\">(</span><span class=\"n\">inv'</span> <span class=\"o\">:</span> <span class=\"bp\">‚àÄ</span> <span class=\"o\">{</span><span class=\"n\">c</span> <span class=\"n\">d</span><span class=\"o\">}</span> <span class=\"o\">{</span><span class=\"n\">p</span> <span class=\"o\">:</span> <span class=\"n\">G.hom</span> <span class=\"n\">c</span> <span class=\"n\">d</span><span class=\"o\">}</span> <span class=\"o\">(</span><span class=\"n\">hp</span> <span class=\"o\">:</span> <span class=\"n\">p</span> <span class=\"bp\">‚àà</span> <span class=\"n\">arrws</span> <span class=\"n\">c</span> <span class=\"n\">d</span><span class=\"o\">),</span>\n            <span class=\"n\">groupoid.inv</span> <span class=\"n\">p</span> <span class=\"bp\">‚àà</span> <span class=\"n\">arrws</span> <span class=\"n\">d</span> <span class=\"n\">c</span><span class=\"o\">)</span>\n  <span class=\"o\">(</span><span class=\"n\">mul'</span> <span class=\"o\">:</span> <span class=\"bp\">‚àÄ</span> <span class=\"o\">{</span><span class=\"n\">c</span> <span class=\"n\">d</span> <span class=\"n\">e</span><span class=\"o\">}</span> <span class=\"o\">{</span><span class=\"n\">p</span><span class=\"o\">}</span> <span class=\"o\">(</span><span class=\"n\">hp</span> <span class=\"o\">:</span> <span class=\"n\">p</span> <span class=\"bp\">‚àà</span> <span class=\"n\">arrws</span> <span class=\"n\">c</span> <span class=\"n\">d</span><span class=\"o\">)</span> <span class=\"o\">{</span><span class=\"n\">q</span><span class=\"o\">}</span> <span class=\"o\">(</span><span class=\"n\">hq</span> <span class=\"o\">:</span> <span class=\"n\">q</span> <span class=\"bp\">‚àà</span> <span class=\"n\">arrws</span> <span class=\"n\">d</span> <span class=\"n\">e</span><span class=\"o\">),</span>\n            <span class=\"n\">p</span> <span class=\"bp\">‚â´</span> <span class=\"n\">q</span> <span class=\"bp\">‚àà</span> <span class=\"n\">arrws</span> <span class=\"n\">c</span> <span class=\"n\">e</span><span class=\"o\">)</span>\n\n<span class=\"kd\">variable</span> <span class=\"o\">{</span><span class=\"n\">G</span><span class=\"o\">}</span>\n\n<span class=\"kd\">def</span> <span class=\"n\">is_normal</span> <span class=\"o\">(</span><span class=\"n\">S</span> <span class=\"o\">:</span> <span class=\"n\">subgroupoid</span> <span class=\"n\">G</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"kt\">Prop</span> <span class=\"o\">:=</span>\n  <span class=\"o\">(</span><span class=\"bp\">‚àÄ</span> <span class=\"n\">c</span><span class=\"o\">,</span> <span class=\"o\">(</span><span class=\"mi\">ùüô</span> <span class=\"n\">c</span><span class=\"o\">)</span> <span class=\"bp\">‚àà</span> <span class=\"o\">(</span><span class=\"n\">S.arrws</span> <span class=\"n\">c</span> <span class=\"n\">c</span><span class=\"o\">))</span> <span class=\"bp\">‚àß</span>  <span class=\"c1\">-- S is \"wide\": all vertices of G are covered</span>\n  <span class=\"o\">(</span><span class=\"bp\">‚àÄ</span> <span class=\"o\">{</span><span class=\"n\">c</span> <span class=\"n\">d</span><span class=\"o\">}</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"o\">:</span> <span class=\"n\">c</span> <span class=\"bp\">‚ü∂</span> <span class=\"n\">d</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">Œ≥</span> <span class=\"o\">:</span> <span class=\"n\">c</span> <span class=\"bp\">‚ü∂</span> <span class=\"n\">c</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">hs</span> <span class=\"o\">:</span> <span class=\"n\">Œ≥</span> <span class=\"bp\">‚àà</span> <span class=\"n\">S.arrws</span> <span class=\"n\">c</span> <span class=\"n\">c</span><span class=\"o\">),</span> <span class=\"o\">((</span><span class=\"n\">G.inv</span> <span class=\"n\">p</span><span class=\"o\">)</span> <span class=\"bp\">‚â´</span> <span class=\"n\">Œ≥</span> <span class=\"bp\">‚â´</span> <span class=\"n\">p</span><span class=\"o\">)</span> <span class=\"bp\">‚àà</span> <span class=\"o\">(</span><span class=\"n\">S.arrws</span> <span class=\"n\">d</span> <span class=\"n\">d</span><span class=\"o\">))</span>\n\n\n<span class=\"kd\">end</span> <span class=\"n\">subgroupoid</span>\n\n\n<span class=\"kn\">section</span> <span class=\"n\">quotient</span>\n\n<span class=\"c1\">-- The vertices of the quotient of G by S</span>\n<span class=\"kd\">def</span> <span class=\"n\">quot_v</span> <span class=\"o\">[</span><span class=\"n\">G</span> <span class=\"o\">:</span> <span class=\"n\">groupoid</span> <span class=\"n\">C</span><span class=\"o\">]</span> <span class=\"o\">(</span><span class=\"n\">S</span> <span class=\"o\">:</span> <span class=\"n\">subgroupoid</span> <span class=\"n\">G</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">Sn</span> <span class=\"o\">:</span> <span class=\"n\">is_normal</span> <span class=\"n\">S</span><span class=\"o\">)</span> <span class=\"o\">:=</span>\n  <span class=\"o\">(</span><span class=\"n\">quot</span> <span class=\"o\">(</span><span class=\"bp\">Œª</span> <span class=\"o\">(</span><span class=\"n\">c</span> <span class=\"n\">d</span> <span class=\"o\">:</span> <span class=\"n\">C</span><span class=\"o\">),</span> <span class=\"o\">(</span><span class=\"n\">S.arrws</span> <span class=\"n\">c</span> <span class=\"n\">d</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">nonempty</span><span class=\"o\">))</span>\n\n\n<span class=\"kd\">def</span> <span class=\"n\">quot_v.mk</span> <span class=\"o\">[</span><span class=\"n\">G</span> <span class=\"o\">:</span> <span class=\"n\">groupoid</span> <span class=\"n\">C</span><span class=\"o\">]</span> <span class=\"o\">(</span><span class=\"n\">S</span> <span class=\"o\">:</span> <span class=\"n\">subgroupoid</span> <span class=\"n\">G</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">Sn</span> <span class=\"o\">:</span> <span class=\"n\">is_normal</span> <span class=\"n\">S</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">c</span> <span class=\"o\">:</span> <span class=\"n\">C</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">quot_v</span> <span class=\"n\">S</span> <span class=\"n\">Sn</span><span class=\"o\">:=</span>\n  <span class=\"o\">(</span><span class=\"n\">quot.mk</span> <span class=\"o\">(</span><span class=\"bp\">Œª</span> <span class=\"o\">(</span><span class=\"n\">c</span> <span class=\"n\">d</span> <span class=\"o\">:</span> <span class=\"n\">C</span><span class=\"o\">),</span> <span class=\"o\">(</span><span class=\"n\">S.arrws</span> <span class=\"n\">c</span> <span class=\"n\">d</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">nonempty</span><span class=\"o\">)</span> <span class=\"n\">c</span><span class=\"o\">)</span>\n\n<span class=\"kd\">def</span> <span class=\"n\">conj</span>  <span class=\"o\">[</span><span class=\"n\">G</span> <span class=\"o\">:</span> <span class=\"n\">groupoid</span> <span class=\"n\">C</span><span class=\"o\">]</span> <span class=\"o\">(</span><span class=\"n\">S</span> <span class=\"o\">:</span> <span class=\"n\">subgroupoid</span> <span class=\"n\">G</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">Sn</span> <span class=\"o\">:</span> <span class=\"n\">is_normal</span> <span class=\"n\">S</span><span class=\"o\">)</span> <span class=\"o\">:</span>\n  <span class=\"o\">(</span><span class=\"bp\">Œ£</span> <span class=\"o\">(</span><span class=\"n\">a</span> <span class=\"n\">b</span> <span class=\"o\">:</span> <span class=\"n\">C</span><span class=\"o\">),</span> <span class=\"n\">a</span> <span class=\"bp\">‚ü∂</span> <span class=\"n\">b</span><span class=\"o\">)</span> <span class=\"bp\">‚Üí</span> <span class=\"o\">(</span><span class=\"bp\">Œ£</span> <span class=\"o\">(</span><span class=\"n\">a</span> <span class=\"n\">b</span> <span class=\"o\">:</span> <span class=\"n\">C</span><span class=\"o\">),</span> <span class=\"n\">a</span> <span class=\"bp\">‚ü∂</span> <span class=\"n\">b</span><span class=\"o\">)</span> <span class=\"bp\">‚Üí</span> <span class=\"kt\">Prop</span> <span class=\"o\">:=</span>\n<span class=\"kd\">begin</span>\n  <span class=\"n\">rintros</span> <span class=\"o\">‚ü®</span><span class=\"n\">a</span><span class=\"o\">,</span><span class=\"n\">b</span><span class=\"o\">,</span><span class=\"n\">f</span><span class=\"o\">‚ü©</span> <span class=\"o\">‚ü®</span><span class=\"n\">c</span><span class=\"o\">,</span><span class=\"n\">d</span><span class=\"o\">,</span><span class=\"n\">g</span><span class=\"o\">‚ü©,</span>\n  <span class=\"n\">exact</span> <span class=\"bp\">‚àÉ</span> <span class=\"o\">(</span><span class=\"n\">Œ±</span> <span class=\"bp\">‚àà</span> <span class=\"n\">S.arrws</span> <span class=\"n\">a</span> <span class=\"n\">c</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">Œ≤</span> <span class=\"bp\">‚àà</span> <span class=\"n\">S.arrws</span> <span class=\"n\">d</span> <span class=\"n\">b</span><span class=\"o\">),</span> <span class=\"n\">f</span> <span class=\"bp\">=</span> <span class=\"n\">Œ±</span> <span class=\"bp\">‚â´</span> <span class=\"n\">g</span> <span class=\"bp\">‚â´</span> <span class=\"n\">Œ≤</span>\n<span class=\"kd\">end</span>\n\n<span class=\"kd\">@[refl]</span>\n<span class=\"kd\">lemma</span> <span class=\"n\">conj.refl</span> <span class=\"o\">[</span><span class=\"n\">G</span> <span class=\"o\">:</span> <span class=\"n\">groupoid</span> <span class=\"n\">C</span><span class=\"o\">]</span> <span class=\"o\">(</span><span class=\"n\">S</span> <span class=\"o\">:</span> <span class=\"n\">subgroupoid</span> <span class=\"n\">G</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">Sn</span> <span class=\"o\">:</span> <span class=\"n\">is_normal</span> <span class=\"n\">S</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"bp\">‚àÄ</span> <span class=\"n\">F</span><span class=\"o\">,</span> <span class=\"n\">conj</span> <span class=\"n\">S</span> <span class=\"n\">Sn</span> <span class=\"n\">F</span> <span class=\"n\">F</span> <span class=\"o\">:=</span>\n<span class=\"kd\">begin</span>\n  <span class=\"n\">rintro</span> <span class=\"o\">‚ü®</span><span class=\"n\">a</span><span class=\"o\">,</span><span class=\"n\">b</span><span class=\"o\">,</span><span class=\"n\">f</span><span class=\"o\">‚ü©,</span>\n  <span class=\"n\">use</span> <span class=\"o\">[(</span><span class=\"mi\">ùüô</span> <span class=\"n\">a</span><span class=\"o\">),</span> <span class=\"n\">Sn.left</span> <span class=\"n\">a</span><span class=\"o\">,</span> <span class=\"o\">(</span><span class=\"mi\">ùüô</span> <span class=\"n\">b</span><span class=\"o\">),</span> <span class=\"n\">Sn.left</span> <span class=\"n\">b</span><span class=\"o\">],</span>\n  <span class=\"n\">simp</span> <span class=\"n\">only</span> <span class=\"o\">[</span><span class=\"n\">category.comp_id</span><span class=\"o\">,</span> <span class=\"n\">category.id_comp</span><span class=\"o\">],</span>\n<span class=\"kd\">end</span>\n\n<span class=\"kd\">@[symm]</span>\n<span class=\"kd\">lemma</span> <span class=\"n\">conj.symm</span> <span class=\"o\">[</span><span class=\"n\">G</span> <span class=\"o\">:</span> <span class=\"n\">groupoid</span> <span class=\"n\">C</span><span class=\"o\">]</span> <span class=\"o\">(</span><span class=\"n\">S</span> <span class=\"o\">:</span> <span class=\"n\">subgroupoid</span> <span class=\"n\">G</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">Sn</span> <span class=\"o\">:</span> <span class=\"n\">is_normal</span> <span class=\"n\">S</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"bp\">‚àÄ</span> <span class=\"n\">F</span> <span class=\"n\">G</span><span class=\"o\">,</span> <span class=\"n\">conj</span> <span class=\"n\">S</span> <span class=\"n\">Sn</span> <span class=\"n\">F</span> <span class=\"n\">G</span> <span class=\"bp\">‚Üí</span> <span class=\"n\">conj</span> <span class=\"n\">S</span> <span class=\"n\">Sn</span> <span class=\"n\">G</span> <span class=\"n\">F</span> <span class=\"o\">:=</span>\n<span class=\"kd\">begin</span>\n  <span class=\"n\">rintros</span> <span class=\"o\">‚ü®</span><span class=\"n\">a</span><span class=\"o\">,</span><span class=\"n\">b</span><span class=\"o\">,</span><span class=\"n\">f</span><span class=\"o\">‚ü©</span> <span class=\"o\">‚ü®</span><span class=\"n\">c</span><span class=\"o\">,</span><span class=\"n\">d</span><span class=\"o\">,</span><span class=\"n\">g</span><span class=\"o\">‚ü©</span> <span class=\"o\">‚ü®</span><span class=\"n\">Œ±</span><span class=\"o\">,</span><span class=\"n\">hŒ±</span><span class=\"o\">,</span><span class=\"n\">Œ≤</span><span class=\"o\">,</span><span class=\"n\">hŒ≤</span><span class=\"o\">,</span><span class=\"n\">rfl</span><span class=\"o\">‚ü©,</span>\n  <span class=\"n\">use</span> <span class=\"o\">[</span><span class=\"n\">G.inv</span> <span class=\"n\">Œ±</span><span class=\"o\">,</span> <span class=\"n\">S.inv'</span> <span class=\"n\">hŒ±</span><span class=\"o\">,</span> <span class=\"n\">G.inv</span> <span class=\"n\">Œ≤</span><span class=\"o\">,</span> <span class=\"n\">S.inv'</span> <span class=\"n\">hŒ≤</span><span class=\"o\">],</span>\n  <span class=\"n\">simp</span> <span class=\"n\">only</span> <span class=\"o\">[</span><span class=\"n\">category.assoc</span><span class=\"o\">,</span> <span class=\"n\">comp_inv</span><span class=\"o\">,</span> <span class=\"n\">category.comp_id</span><span class=\"o\">],</span>\n  <span class=\"n\">rw</span> <span class=\"bp\">‚Üê</span><span class=\"n\">category.assoc</span><span class=\"o\">,</span>\n  <span class=\"n\">simp</span> <span class=\"n\">only</span> <span class=\"o\">[</span><span class=\"n\">inv_comp</span><span class=\"o\">,</span> <span class=\"n\">category.id_comp</span><span class=\"o\">],</span>\n<span class=\"kd\">end</span>\n\n<span class=\"kd\">@[trans]</span>\n<span class=\"kd\">lemma</span> <span class=\"n\">conj.trans</span> <span class=\"o\">[</span><span class=\"n\">G</span> <span class=\"o\">:</span> <span class=\"n\">groupoid</span> <span class=\"n\">C</span><span class=\"o\">]</span> <span class=\"o\">(</span><span class=\"n\">S</span> <span class=\"o\">:</span> <span class=\"n\">subgroupoid</span> <span class=\"n\">G</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">Sn</span> <span class=\"o\">:</span> <span class=\"n\">is_normal</span> <span class=\"n\">S</span><span class=\"o\">)</span> <span class=\"o\">:</span>\n  <span class=\"bp\">‚àÄ</span> <span class=\"n\">F</span> <span class=\"n\">G</span> <span class=\"n\">H</span><span class=\"o\">,</span> <span class=\"n\">conj</span> <span class=\"n\">S</span> <span class=\"n\">Sn</span> <span class=\"n\">F</span> <span class=\"n\">G</span> <span class=\"bp\">‚Üí</span> <span class=\"n\">conj</span> <span class=\"n\">S</span> <span class=\"n\">Sn</span> <span class=\"n\">G</span> <span class=\"n\">H</span> <span class=\"bp\">‚Üí</span> <span class=\"n\">conj</span> <span class=\"n\">S</span> <span class=\"n\">Sn</span> <span class=\"n\">F</span> <span class=\"n\">H</span> <span class=\"o\">:=</span>\n<span class=\"kd\">begin</span>\n  <span class=\"n\">rintros</span> <span class=\"o\">‚ü®</span><span class=\"n\">a‚ÇÄ</span><span class=\"o\">,</span><span class=\"n\">b‚ÇÄ</span><span class=\"o\">,</span><span class=\"n\">f‚ÇÄ</span><span class=\"o\">‚ü©</span> <span class=\"o\">‚ü®</span><span class=\"n\">a‚ÇÅ</span><span class=\"o\">,</span><span class=\"n\">b‚ÇÅ</span><span class=\"o\">,</span><span class=\"n\">f‚ÇÅ</span><span class=\"o\">‚ü©</span> <span class=\"o\">‚ü®</span><span class=\"n\">a‚ÇÇ</span><span class=\"o\">,</span><span class=\"n\">b‚ÇÇ</span><span class=\"o\">,</span><span class=\"n\">f‚ÇÇ</span><span class=\"o\">‚ü©</span> <span class=\"o\">‚ü®</span><span class=\"n\">Œ±‚ÇÄ</span><span class=\"o\">,</span><span class=\"n\">hŒ±‚ÇÄ</span><span class=\"o\">,</span><span class=\"n\">Œ≤‚ÇÄ</span><span class=\"o\">,</span><span class=\"n\">hŒ≤‚ÇÄ</span><span class=\"o\">,</span><span class=\"n\">rfl</span><span class=\"o\">‚ü©</span>  <span class=\"o\">‚ü®</span><span class=\"n\">Œ±‚ÇÅ</span><span class=\"o\">,</span><span class=\"n\">hŒ±‚ÇÅ</span><span class=\"o\">,</span><span class=\"n\">Œ≤‚ÇÅ</span><span class=\"o\">,</span><span class=\"n\">hŒ≤‚ÇÅ</span><span class=\"o\">,</span><span class=\"n\">rfl</span><span class=\"o\">‚ü©,</span>\n  <span class=\"n\">use</span> <span class=\"o\">[</span><span class=\"n\">Œ±‚ÇÄ</span> <span class=\"bp\">‚â´</span> <span class=\"n\">Œ±‚ÇÅ</span><span class=\"o\">,</span> <span class=\"n\">S.mul'</span> <span class=\"n\">hŒ±‚ÇÄ</span> <span class=\"n\">hŒ±‚ÇÅ</span><span class=\"o\">,</span> <span class=\"n\">Œ≤‚ÇÅ</span> <span class=\"bp\">‚â´</span> <span class=\"n\">Œ≤‚ÇÄ</span><span class=\"o\">,</span> <span class=\"n\">S.mul'</span> <span class=\"n\">hŒ≤‚ÇÅ</span> <span class=\"n\">hŒ≤‚ÇÄ</span><span class=\"o\">],</span>\n  <span class=\"n\">simp</span> <span class=\"n\">only</span> <span class=\"o\">[</span><span class=\"n\">category.assoc</span><span class=\"o\">],</span>\n<span class=\"kd\">end</span>\n\n<span class=\"kd\">def</span> <span class=\"n\">quot_start</span> <span class=\"o\">[</span><span class=\"n\">G</span> <span class=\"o\">:</span> <span class=\"n\">groupoid</span> <span class=\"n\">C</span><span class=\"o\">]</span> <span class=\"o\">(</span><span class=\"n\">S</span> <span class=\"o\">:</span> <span class=\"n\">subgroupoid</span> <span class=\"n\">G</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">Sn</span> <span class=\"o\">:</span> <span class=\"n\">is_normal</span> <span class=\"n\">S</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"o\">(</span><span class=\"n\">quot</span> <span class=\"bp\">$</span> <span class=\"n\">conj</span> <span class=\"n\">S</span> <span class=\"n\">Sn</span><span class=\"o\">)</span> <span class=\"bp\">‚Üí</span> <span class=\"o\">(</span><span class=\"n\">quot_v</span> <span class=\"n\">S</span> <span class=\"n\">Sn</span><span class=\"o\">)</span> <span class=\"o\">:=</span>\n<span class=\"kd\">begin</span>\n  <span class=\"n\">refine</span> <span class=\"n\">quot.lift</span> <span class=\"n\">_</span> <span class=\"n\">_</span><span class=\"o\">,</span>\n  <span class=\"o\">{</span> <span class=\"n\">rintro</span> <span class=\"o\">‚ü®</span><span class=\"n\">a</span><span class=\"o\">,</span><span class=\"n\">b</span><span class=\"o\">,</span><span class=\"n\">f</span><span class=\"o\">‚ü©,</span> <span class=\"n\">apply</span> <span class=\"n\">quot_v.mk</span><span class=\"o\">,</span> <span class=\"n\">exact</span> <span class=\"n\">a</span><span class=\"o\">,},</span>\n  <span class=\"o\">{</span> <span class=\"n\">rintro</span> <span class=\"o\">‚ü®</span><span class=\"n\">a‚ÇÄ</span><span class=\"o\">,</span><span class=\"n\">b‚ÇÄ</span><span class=\"o\">,</span><span class=\"n\">f‚ÇÄ</span><span class=\"o\">‚ü©</span> <span class=\"o\">‚ü®</span><span class=\"n\">a‚ÇÅ</span><span class=\"o\">,</span><span class=\"n\">b‚ÇÅ</span><span class=\"o\">,</span><span class=\"n\">f‚ÇÅ</span><span class=\"o\">‚ü©</span> <span class=\"o\">‚ü®</span><span class=\"n\">Œ±</span><span class=\"o\">,</span><span class=\"n\">hŒ±</span><span class=\"o\">,</span><span class=\"n\">Œ≤</span><span class=\"o\">,</span><span class=\"n\">hŒ≤</span><span class=\"o\">,</span><span class=\"n\">rfl</span><span class=\"o\">‚ü©,</span><span class=\"n\">simp</span><span class=\"o\">,</span><span class=\"n\">dsimp</span> <span class=\"o\">[</span><span class=\"n\">quot_v.mk</span><span class=\"o\">],</span> <span class=\"n\">apply</span> <span class=\"n\">quot.sound</span><span class=\"o\">,</span> <span class=\"n\">exact</span> <span class=\"o\">‚ü®</span><span class=\"n\">Œ±</span><span class=\"o\">,</span><span class=\"n\">hŒ±</span><span class=\"o\">‚ü©,}</span>\n<span class=\"kd\">end</span>\n\n<span class=\"kd\">def</span> <span class=\"n\">quot_end</span> <span class=\"o\">[</span><span class=\"n\">G</span> <span class=\"o\">:</span> <span class=\"n\">groupoid</span> <span class=\"n\">C</span><span class=\"o\">]</span> <span class=\"o\">(</span><span class=\"n\">S</span> <span class=\"o\">:</span> <span class=\"n\">subgroupoid</span> <span class=\"n\">G</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">Sn</span> <span class=\"o\">:</span> <span class=\"n\">is_normal</span> <span class=\"n\">S</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"o\">(</span><span class=\"n\">quot</span> <span class=\"bp\">$</span> <span class=\"n\">conj</span> <span class=\"n\">S</span> <span class=\"n\">Sn</span><span class=\"o\">)</span> <span class=\"bp\">‚Üí</span> <span class=\"o\">(</span><span class=\"n\">quot_v</span> <span class=\"n\">S</span> <span class=\"n\">Sn</span><span class=\"o\">)</span> <span class=\"o\">:=</span>\n<span class=\"kd\">begin</span>\n  <span class=\"n\">refine</span> <span class=\"n\">quot.lift</span> <span class=\"n\">_</span> <span class=\"n\">_</span><span class=\"o\">,</span>\n  <span class=\"o\">{</span> <span class=\"n\">rintro</span> <span class=\"o\">‚ü®</span><span class=\"n\">a</span><span class=\"o\">,</span><span class=\"n\">b</span><span class=\"o\">,</span><span class=\"n\">f</span><span class=\"o\">‚ü©,</span> <span class=\"n\">apply</span> <span class=\"n\">quot_v.mk</span><span class=\"o\">,</span> <span class=\"n\">exact</span> <span class=\"n\">b</span><span class=\"o\">,},</span>\n  <span class=\"o\">{</span> <span class=\"n\">rintro</span> <span class=\"o\">‚ü®</span><span class=\"n\">a‚ÇÄ</span><span class=\"o\">,</span><span class=\"n\">b‚ÇÄ</span><span class=\"o\">,</span><span class=\"n\">f‚ÇÄ</span><span class=\"o\">‚ü©</span> <span class=\"o\">‚ü®</span><span class=\"n\">a‚ÇÅ</span><span class=\"o\">,</span><span class=\"n\">b‚ÇÅ</span><span class=\"o\">,</span><span class=\"n\">f‚ÇÅ</span><span class=\"o\">‚ü©</span> <span class=\"o\">‚ü®</span><span class=\"n\">Œ±</span><span class=\"o\">,</span><span class=\"n\">hŒ±</span><span class=\"o\">,</span><span class=\"n\">Œ≤</span><span class=\"o\">,</span><span class=\"n\">hŒ≤</span><span class=\"o\">,</span><span class=\"n\">rfl</span><span class=\"o\">‚ü©,</span><span class=\"n\">simp</span><span class=\"o\">,</span><span class=\"n\">dsimp</span> <span class=\"o\">[</span><span class=\"n\">quot_v.mk</span><span class=\"o\">],</span> <span class=\"n\">apply</span> <span class=\"n\">quot.sound</span><span class=\"o\">,</span> <span class=\"n\">exact</span> <span class=\"o\">‚ü®</span><span class=\"n\">G.inv</span> <span class=\"n\">Œ≤</span><span class=\"o\">,</span><span class=\"n\">S.inv'</span> <span class=\"n\">hŒ≤</span><span class=\"o\">‚ü©,}</span>\n<span class=\"kd\">end</span>\n\n<span class=\"kd\">@[instance]</span>\n<span class=\"kd\">def</span> <span class=\"n\">quotient_quiver</span> <span class=\"o\">[</span><span class=\"n\">G</span> <span class=\"o\">:</span> <span class=\"n\">groupoid</span> <span class=\"n\">C</span><span class=\"o\">]</span> <span class=\"o\">(</span><span class=\"n\">S</span> <span class=\"o\">:</span> <span class=\"n\">subgroupoid</span> <span class=\"n\">G</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">Sn</span> <span class=\"o\">:</span> <span class=\"n\">is_normal</span> <span class=\"n\">S</span><span class=\"o\">)</span> <span class=\"o\">:</span>\n  <span class=\"n\">quiver</span> <span class=\"o\">(</span><span class=\"n\">quot_v</span> <span class=\"n\">S</span> <span class=\"n\">Sn</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"o\">‚ü®</span><span class=\"bp\">Œª</span><span class=\"n\">c</span> <span class=\"n\">d</span><span class=\"o\">,</span> <span class=\"o\">{</span> <span class=\"n\">F</span> <span class=\"bp\">|</span> <span class=\"n\">quot_start</span> <span class=\"n\">S</span> <span class=\"n\">Sn</span> <span class=\"n\">F</span> <span class=\"bp\">=</span> <span class=\"n\">c</span> <span class=\"bp\">‚àß</span> <span class=\"n\">quot_end</span> <span class=\"n\">S</span> <span class=\"n\">Sn</span> <span class=\"n\">F</span> <span class=\"bp\">=</span> <span class=\"n\">d</span> <span class=\"o\">}‚ü©</span>\n\n<span class=\"kd\">def</span> <span class=\"n\">quot_id'</span>  <span class=\"o\">[</span><span class=\"n\">G</span> <span class=\"o\">:</span> <span class=\"n\">groupoid</span> <span class=\"n\">C</span><span class=\"o\">]</span> <span class=\"o\">(</span><span class=\"n\">S</span> <span class=\"o\">:</span> <span class=\"n\">subgroupoid</span> <span class=\"n\">G</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">Sn</span> <span class=\"o\">:</span> <span class=\"n\">is_normal</span> <span class=\"n\">S</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"bp\">Œ†</span> <span class=\"o\">(</span><span class=\"n\">c</span> <span class=\"o\">:</span> <span class=\"n\">quot_v</span> <span class=\"n\">S</span> <span class=\"n\">Sn</span><span class=\"o\">),</span>  <span class=\"o\">(</span><span class=\"n\">quot</span> <span class=\"bp\">$</span> <span class=\"n\">conj</span> <span class=\"n\">S</span> <span class=\"n\">Sn</span><span class=\"o\">)</span> <span class=\"o\">:=</span>\n<span class=\"kd\">begin</span>\n  <span class=\"n\">apply</span> <span class=\"n\">quot.lift</span><span class=\"o\">,</span> <span class=\"n\">rotate</span><span class=\"o\">,</span>\n  <span class=\"o\">{</span> <span class=\"n\">rintro</span> <span class=\"n\">c</span><span class=\"o\">,</span>\n    <span class=\"n\">exact</span> <span class=\"n\">quot.mk</span> <span class=\"o\">(</span><span class=\"n\">conj</span> <span class=\"n\">S</span> <span class=\"n\">Sn</span><span class=\"o\">)</span> <span class=\"o\">‚ü®</span><span class=\"n\">c</span><span class=\"o\">,</span><span class=\"n\">c</span><span class=\"o\">,</span><span class=\"mi\">ùüô</span> <span class=\"n\">c</span><span class=\"o\">‚ü©</span> <span class=\"o\">},</span>\n  <span class=\"o\">{</span> <span class=\"n\">rintros</span> <span class=\"n\">c</span> <span class=\"n\">d</span> <span class=\"o\">‚ü®</span><span class=\"n\">f</span><span class=\"o\">,</span><span class=\"n\">fS</span><span class=\"o\">‚ü©,</span>\n    <span class=\"n\">apply</span> <span class=\"n\">quot.sound</span><span class=\"o\">,</span>\n    <span class=\"n\">use</span> <span class=\"o\">[</span><span class=\"n\">f</span><span class=\"o\">,</span><span class=\"n\">fS</span><span class=\"o\">,</span><span class=\"n\">G.inv</span> <span class=\"n\">f</span><span class=\"o\">,</span> <span class=\"n\">S.inv'</span> <span class=\"n\">fS</span><span class=\"o\">],</span>\n    <span class=\"n\">simp</span> <span class=\"n\">only</span> <span class=\"o\">[</span><span class=\"n\">category.id_comp</span><span class=\"o\">,</span> <span class=\"n\">comp_inv</span><span class=\"o\">],</span> <span class=\"o\">}</span>\n<span class=\"kd\">end</span>\n\n<span class=\"kd\">def</span> <span class=\"n\">quotient_id</span>  <span class=\"o\">[</span><span class=\"n\">G</span> <span class=\"o\">:</span> <span class=\"n\">groupoid</span> <span class=\"n\">C</span><span class=\"o\">]</span> <span class=\"o\">(</span><span class=\"n\">S</span> <span class=\"o\">:</span> <span class=\"n\">subgroupoid</span> <span class=\"n\">G</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">Sn</span> <span class=\"o\">:</span> <span class=\"n\">is_normal</span> <span class=\"n\">S</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"bp\">Œ†</span> <span class=\"o\">(</span><span class=\"n\">c</span> <span class=\"o\">:</span> <span class=\"n\">quot_v</span> <span class=\"n\">S</span> <span class=\"n\">Sn</span><span class=\"o\">),</span>  <span class=\"n\">c</span> <span class=\"bp\">‚ü∂</span> <span class=\"n\">c</span> <span class=\"o\">:=</span>\n<span class=\"bp\">Œª</span> <span class=\"n\">c</span><span class=\"o\">,</span> <span class=\"o\">‚ü®</span> <span class=\"n\">quot_id'</span> <span class=\"n\">S</span> <span class=\"n\">Sn</span> <span class=\"n\">c</span><span class=\"o\">,</span> <span class=\"kd\">by</span> <span class=\"o\">{</span><span class=\"n\">dsimp</span> <span class=\"n\">only</span> <span class=\"o\">[</span><span class=\"n\">quot_id'</span><span class=\"o\">,</span><span class=\"n\">quot_start</span><span class=\"o\">,</span><span class=\"n\">quot_end</span><span class=\"o\">,</span><span class=\"n\">quot_v.mk</span><span class=\"o\">],</span> <span class=\"n\">induction</span> <span class=\"n\">c</span><span class=\"o\">,</span> <span class=\"n\">simp</span><span class=\"o\">,</span> <span class=\"n\">simp</span><span class=\"o\">,}‚ü©</span>\n\n\n<span class=\"kd\">def</span> <span class=\"n\">quot_id''</span>  <span class=\"o\">[</span><span class=\"n\">G</span> <span class=\"o\">:</span> <span class=\"n\">groupoid</span> <span class=\"n\">C</span><span class=\"o\">]</span> <span class=\"o\">(</span><span class=\"n\">S</span> <span class=\"o\">:</span> <span class=\"n\">subgroupoid</span> <span class=\"n\">G</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">Sn</span> <span class=\"o\">:</span> <span class=\"n\">is_normal</span> <span class=\"n\">S</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"bp\">Œ†</span> <span class=\"o\">(</span><span class=\"n\">c</span> <span class=\"o\">:</span> <span class=\"n\">quot_v</span> <span class=\"n\">S</span> <span class=\"n\">Sn</span><span class=\"o\">),</span>  <span class=\"n\">c</span> <span class=\"bp\">‚ü∂</span> <span class=\"n\">c</span> <span class=\"o\">:=</span>\n<span class=\"kd\">begin</span>\n  <span class=\"n\">refine</span> <span class=\"bp\">Œª</span> <span class=\"n\">c</span><span class=\"o\">,</span> <span class=\"n\">c.rec_on</span> <span class=\"n\">_</span> <span class=\"n\">_</span><span class=\"o\">,</span>\n  <span class=\"o\">{</span> <span class=\"n\">rintro</span> <span class=\"n\">c</span><span class=\"o\">,</span> <span class=\"n\">dsimp</span> <span class=\"n\">only</span> <span class=\"o\">[</span><span class=\"n\">quotient_quiver</span><span class=\"o\">,</span><span class=\"n\">quot_start</span><span class=\"o\">,</span><span class=\"n\">quot_end</span><span class=\"o\">,</span><span class=\"n\">quot_v.mk</span><span class=\"o\">],</span>\n    <span class=\"n\">use</span> <span class=\"n\">quot.mk</span> <span class=\"o\">(</span><span class=\"n\">conj</span> <span class=\"n\">S</span> <span class=\"n\">Sn</span><span class=\"o\">)</span> <span class=\"o\">‚ü®</span><span class=\"n\">c</span><span class=\"o\">,</span><span class=\"n\">c</span><span class=\"o\">,</span><span class=\"mi\">ùüô</span> <span class=\"n\">c</span><span class=\"o\">‚ü©,</span> <span class=\"n\">split</span><span class=\"o\">,</span> <span class=\"n\">simp</span> <span class=\"n\">only</span><span class=\"o\">,</span> <span class=\"n\">simp</span> <span class=\"n\">only</span><span class=\"o\">,</span> <span class=\"o\">},</span>\n  <span class=\"o\">{</span> <span class=\"n\">rintros</span> <span class=\"n\">c</span> <span class=\"n\">d</span> <span class=\"o\">‚ü®</span><span class=\"n\">f</span><span class=\"o\">,</span><span class=\"n\">fS</span><span class=\"o\">‚ü©,</span>\n    <span class=\"k\">have</span> <span class=\"o\">:</span> <span class=\"n\">quot.mk</span> <span class=\"o\">(</span><span class=\"bp\">Œª</span> <span class=\"o\">(</span><span class=\"n\">c</span> <span class=\"n\">d</span> <span class=\"o\">:</span> <span class=\"n\">C</span><span class=\"o\">),</span> <span class=\"o\">(</span><span class=\"n\">S.arrws</span> <span class=\"n\">c</span> <span class=\"n\">d</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">nonempty</span><span class=\"o\">)</span> <span class=\"n\">c</span> <span class=\"bp\">=</span> <span class=\"n\">quot.mk</span> <span class=\"o\">(</span><span class=\"bp\">Œª</span> <span class=\"o\">(</span><span class=\"n\">c</span> <span class=\"n\">d</span> <span class=\"o\">:</span> <span class=\"n\">C</span><span class=\"o\">),</span> <span class=\"o\">(</span><span class=\"n\">S.arrws</span> <span class=\"n\">c</span> <span class=\"n\">d</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">nonempty</span><span class=\"o\">)</span> <span class=\"n\">d</span><span class=\"o\">,</span> <span class=\"kd\">by</span>\n    <span class=\"o\">{</span> <span class=\"n\">apply</span> <span class=\"n\">quot.sound</span><span class=\"o\">,</span> <span class=\"n\">constructor</span><span class=\"o\">,</span> <span class=\"n\">use</span> <span class=\"n\">fS</span><span class=\"o\">,},</span>\n    <span class=\"n\">simp</span><span class=\"o\">,</span>\n    <span class=\"gr\">sorry</span><span class=\"o\">,</span>\n    <span class=\"o\">}</span>\n<span class=\"kd\">end</span>\n\n\n<span class=\"kd\">def</span> <span class=\"n\">quot_comp'</span>  <span class=\"o\">[</span><span class=\"n\">G</span> <span class=\"o\">:</span> <span class=\"n\">groupoid</span> <span class=\"n\">C</span><span class=\"o\">]</span> <span class=\"o\">(</span><span class=\"n\">S</span> <span class=\"o\">:</span> <span class=\"n\">subgroupoid</span> <span class=\"n\">G</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">Sn</span> <span class=\"o\">:</span> <span class=\"n\">is_normal</span> <span class=\"n\">S</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"bp\">Œ†</span> <span class=\"o\">(</span><span class=\"n\">c</span> <span class=\"n\">d</span> <span class=\"n\">e</span> <span class=\"o\">:</span> <span class=\"n\">quot_v</span> <span class=\"n\">S</span> <span class=\"n\">Sn</span><span class=\"o\">),</span> <span class=\"o\">(</span><span class=\"n\">c</span> <span class=\"bp\">‚ü∂</span> <span class=\"n\">d</span><span class=\"o\">)</span> <span class=\"bp\">‚Üí</span> <span class=\"o\">(</span><span class=\"n\">d</span> <span class=\"bp\">‚ü∂</span> <span class=\"n\">e</span><span class=\"o\">)</span> <span class=\"bp\">‚Üí</span> <span class=\"o\">(</span><span class=\"n\">quot</span> <span class=\"bp\">$</span> <span class=\"n\">conj</span> <span class=\"n\">S</span> <span class=\"n\">Sn</span><span class=\"o\">)</span> <span class=\"o\">:=</span>\n<span class=\"kd\">begin</span>\n  <span class=\"gr\">sorry</span>\n<span class=\"kd\">end</span>\n\n\n<span class=\"kd\">end</span> <span class=\"n\">quotient</span>\n\n\n<span class=\"kd\">end</span> <span class=\"n\">groupoid</span>\n<span class=\"kd\">end</span> <span class=\"n\">category_theory</span>\n</code></pre></div>",
        "id": 299537538,
        "sender_full_name": "R√©mi Bottinelli",
        "timestamp": 1663582787
    },
    {
        "content": "<p>Several comments:</p>\n<ul>\n<li>Since you've shown that <code>conj</code> is reflexive, symmetric and transitive, you may package them into a <a href=\"https://leanprover-community.github.io/mathlib_docs/find/setoid\">docs#setoid</a> instance, and then you can use <code>quotient</code> instead of <code>quot</code>, which allows you access to theorems like <a href=\"https://leanprover-community.github.io/mathlib_docs/find/quotient.exact\">docs#quotient.exact</a> that isn't true if the relation you quotient by is not an equivalence relation.</li>\n<li>When defining data, we usually don't destruct an input; instead we use its projections. For example, <code>conj</code> should be defined as <code>Œª f g, ‚àÉ (Œ± ‚àà S.arrws f.1 g.1) (Œ≤ ‚àà S.arrws g.2.1 f.2.1), f.2.2 = Œ± ‚â´ g.2.2 ‚â´ Œ≤</code>, and the same applies to <code>quot_start</code> and <code>quot_end</code>; in proofs we don't care though.</li>\n<li>I think the way you construct <code>quot_id</code> and <code>quotient_id</code> is perfectly fine. Not sure why you want to try the approach in <code>quot_id''</code>. The use of <code>quot.rec_on</code> seems exactly what introduces <code>eq.rec</code> that's hard to deal with.</li>\n<li>In order to define <code>quot_comp'</code>, I would take the following approach: first convert (c ‚ü∂ d) and (d ‚ü∂ e) which are subtypes of quotient types into quotient types of subtypes using <a href=\"https://leanprover-community.github.io/mathlib_docs/find/equiv.subtype_quotient_equiv_quotient_subtype\">docs#equiv.subtype_quotient_equiv_quotient_subtype</a>, then use <a href=\"https://leanprover-community.github.io/mathlib_docs/init/data/quot.html#quotient.lift%E2%82%82\">quotient.lift‚ÇÇ</a>. You would still need to use choice to pick an arrow from <code>(S.arrws _ _).nonempty</code> to connect the two lifts of <code>d</code>, but this is the best solution I can think of.</li>\n</ul>",
        "id": 300481460,
        "sender_full_name": "Junyan Xu",
        "timestamp": 1663992032
    },
    {
        "content": "<p>I think it may be easier to simply define the types of arrows in the quotient groupoid as quotients rather than subtypes of quotients; I believe the following is also a valid definition:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kd\">def</span> <span class=\"n\">conj'</span> <span class=\"o\">[</span><span class=\"n\">G</span> <span class=\"o\">:</span> <span class=\"n\">groupoid</span> <span class=\"n\">C</span><span class=\"o\">]</span> <span class=\"o\">(</span><span class=\"n\">S</span> <span class=\"o\">:</span> <span class=\"n\">subgroupoid</span> <span class=\"n\">G</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">Sn</span> <span class=\"o\">:</span> <span class=\"n\">is_normal</span> <span class=\"n\">S</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">a</span> <span class=\"n\">b</span> <span class=\"o\">:</span> <span class=\"n\">quot_v</span> <span class=\"n\">S</span> <span class=\"n\">Sn</span><span class=\"o\">)</span>\n  <span class=\"o\">(</span><span class=\"n\">f</span> <span class=\"n\">g</span> <span class=\"o\">:</span> <span class=\"bp\">Œ£</span> <span class=\"o\">(</span><span class=\"n\">c</span> <span class=\"o\">:</span> <span class=\"o\">{</span><span class=\"n\">c</span> <span class=\"bp\">//</span> <span class=\"n\">quot.mk</span> <span class=\"n\">_</span> <span class=\"n\">c</span> <span class=\"bp\">=</span> <span class=\"n\">a</span><span class=\"o\">})</span> <span class=\"o\">(</span><span class=\"n\">d</span> <span class=\"o\">:</span> <span class=\"o\">{</span><span class=\"n\">d</span> <span class=\"bp\">//</span> <span class=\"n\">quot.mk</span> <span class=\"n\">_</span> <span class=\"n\">d</span> <span class=\"bp\">=</span> <span class=\"n\">b</span><span class=\"o\">}),</span> <span class=\"n\">c.1</span> <span class=\"bp\">‚ü∂</span> <span class=\"n\">d.1</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"kt\">Prop</span> <span class=\"o\">:=</span>\n<span class=\"bp\">‚àÉ</span> <span class=\"o\">(</span><span class=\"n\">Œ±</span> <span class=\"bp\">‚àà</span> <span class=\"n\">S.arrws</span> <span class=\"n\">f.1.1</span> <span class=\"n\">g.1.1</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">Œ≤</span> <span class=\"bp\">‚àà</span> <span class=\"n\">S.arrws</span> <span class=\"n\">g.2.1.1</span> <span class=\"n\">f.2.1.1</span><span class=\"o\">),</span> <span class=\"n\">f.2.2</span> <span class=\"bp\">=</span> <span class=\"n\">Œ±</span> <span class=\"bp\">‚â´</span> <span class=\"n\">g.2.2</span> <span class=\"bp\">‚â´</span> <span class=\"n\">Œ≤</span>\n\n<span class=\"kd\">def</span> <span class=\"n\">quotient_quiver</span> <span class=\"o\">[</span><span class=\"n\">G</span> <span class=\"o\">:</span> <span class=\"n\">groupoid</span> <span class=\"n\">C</span><span class=\"o\">]</span> <span class=\"o\">(</span><span class=\"n\">S</span> <span class=\"o\">:</span> <span class=\"n\">subgroupoid</span> <span class=\"n\">G</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">Sn</span> <span class=\"o\">:</span> <span class=\"n\">is_normal</span> <span class=\"n\">S</span><span class=\"o\">)</span> <span class=\"o\">:</span>\n  <span class=\"n\">quiver</span> <span class=\"o\">(</span><span class=\"n\">quot_v</span> <span class=\"n\">S</span> <span class=\"n\">Sn</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"o\">‚ü®</span><span class=\"bp\">Œª</span> <span class=\"n\">a</span> <span class=\"n\">b</span><span class=\"o\">,</span> <span class=\"n\">quot</span> <span class=\"o\">(</span><span class=\"n\">conj'</span> <span class=\"n\">S</span> <span class=\"n\">Sn</span> <span class=\"n\">a</span> <span class=\"n\">b</span><span class=\"o\">)‚ü©</span>\n</code></pre></div>",
        "id": 300482641,
        "sender_full_name": "Junyan Xu",
        "timestamp": 1663993379
    },
    {
        "content": "<p>Thanks for the feedback. <br>\nAs for your third bullet: It's mostly because I felt that I'd have to deal with this problem of <code>quot.rec_on/eq.rec</code> with <code>quot_comp</code> anyway, and since <code>id</code> is easier than <code>comp</code>, it would help me figure out how to deal with that. <br>\nAs for your proposal, I¬†thought about something along these lines but couldn't tell if it was useful. Do we agree that your proposal takes care of the conversion mentioned in bullet 4 already?</p>",
        "id": 300515229,
        "sender_full_name": "R√©mi Bottinelli",
        "timestamp": 1664015158
    },
    {
        "content": "<p>But as far as I¬†understand, I¬†can't simply do <code>quotient.lift‚ÇÇ</code>, because the lift needs to have a dependent codomain, so only <code>quot.rec</code> works here.</p>",
        "id": 300520078,
        "sender_full_name": "R√©mi Bottinelli",
        "timestamp": 1664017329
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"461830\">@R√©mi Bottinelli</span> I haven't dealt with the composition problem, but I have some suggestions for handling the <code>groupoid</code> structure and how to organize taking the vertex quotient</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kn\">import</span> <span class=\"n\">category_theory.groupoid</span>\n\n<span class=\"kn\">open</span> <span class=\"n\">set</span>\n\n<span class=\"kn\">namespace</span> <span class=\"n\">category_theory</span>\n\n<span class=\"kd\">universes</span> <span class=\"n\">u</span> <span class=\"n\">v</span>\n\n<span class=\"kd\">variables</span> <span class=\"o\">(</span><span class=\"n\">C</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span> <span class=\"n\">u</span><span class=\"o\">)</span>\n\n<span class=\"kn\">namespace</span> <span class=\"n\">groupoid</span>\n\n<span class=\"kn\">section</span> <span class=\"n\">subgroupoid</span>\n\n<span class=\"kd\">variable</span> <span class=\"o\">[</span><span class=\"n\">groupoid</span> <span class=\"n\">C</span><span class=\"o\">]</span>\n\n<span class=\"kd\">@[ext]</span>\n<span class=\"kd\">structure</span> <span class=\"n\">subgroupoid</span> <span class=\"o\">(</span><span class=\"n\">C</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span> <span class=\"n\">u</span><span class=\"o\">)</span> <span class=\"o\">[</span><span class=\"n\">groupoid</span> <span class=\"n\">C</span><span class=\"o\">]</span> <span class=\"o\">:=</span>\n<span class=\"o\">(</span><span class=\"n\">arrws</span> <span class=\"o\">:</span> <span class=\"bp\">‚àÄ</span> <span class=\"o\">(</span><span class=\"n\">c</span> <span class=\"n\">d</span> <span class=\"o\">:</span> <span class=\"n\">C</span><span class=\"o\">),</span> <span class=\"n\">set</span> <span class=\"o\">(</span><span class=\"n\">c</span> <span class=\"bp\">‚ü∂</span> <span class=\"n\">d</span><span class=\"o\">))</span>\n<span class=\"o\">(</span><span class=\"n\">inv'</span> <span class=\"o\">:</span> <span class=\"bp\">‚àÄ</span> <span class=\"o\">{</span><span class=\"n\">c</span> <span class=\"n\">d</span><span class=\"o\">}</span> <span class=\"o\">{</span><span class=\"n\">p</span> <span class=\"o\">:</span> <span class=\"n\">c</span> <span class=\"bp\">‚ü∂</span> <span class=\"n\">d</span><span class=\"o\">}</span> <span class=\"o\">(</span><span class=\"n\">hp</span> <span class=\"o\">:</span> <span class=\"n\">p</span> <span class=\"bp\">‚àà</span> <span class=\"n\">arrws</span> <span class=\"n\">c</span> <span class=\"n\">d</span><span class=\"o\">),</span>\n          <span class=\"n\">groupoid.inv</span> <span class=\"n\">p</span> <span class=\"bp\">‚àà</span> <span class=\"n\">arrws</span> <span class=\"n\">d</span> <span class=\"n\">c</span><span class=\"o\">)</span>\n<span class=\"o\">(</span><span class=\"n\">mul'</span> <span class=\"o\">:</span> <span class=\"bp\">‚àÄ</span> <span class=\"o\">{</span><span class=\"n\">c</span> <span class=\"n\">d</span> <span class=\"n\">e</span><span class=\"o\">}</span> <span class=\"o\">{</span><span class=\"n\">p</span><span class=\"o\">}</span> <span class=\"o\">(</span><span class=\"n\">hp</span> <span class=\"o\">:</span> <span class=\"n\">p</span> <span class=\"bp\">‚àà</span> <span class=\"n\">arrws</span> <span class=\"n\">c</span> <span class=\"n\">d</span><span class=\"o\">)</span> <span class=\"o\">{</span><span class=\"n\">q</span><span class=\"o\">}</span> <span class=\"o\">(</span><span class=\"n\">hq</span> <span class=\"o\">:</span> <span class=\"n\">q</span> <span class=\"bp\">‚àà</span> <span class=\"n\">arrws</span> <span class=\"n\">d</span> <span class=\"n\">e</span><span class=\"o\">),</span>\n          <span class=\"n\">p</span> <span class=\"bp\">‚â´</span> <span class=\"n\">q</span> <span class=\"bp\">‚àà</span> <span class=\"n\">arrws</span> <span class=\"n\">c</span> <span class=\"n\">e</span><span class=\"o\">)</span>\n\n<span class=\"kd\">variable</span> <span class=\"o\">{</span><span class=\"n\">C</span><span class=\"o\">}</span>\n\n<span class=\"kn\">namespace</span> <span class=\"n\">subgroupoid</span>\n\n<span class=\"kd\">structure</span> <span class=\"n\">is_normal</span> <span class=\"o\">(</span><span class=\"n\">S</span> <span class=\"o\">:</span> <span class=\"n\">subgroupoid</span> <span class=\"n\">C</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"kt\">Prop</span> <span class=\"o\">:=</span>\n<span class=\"o\">(</span><span class=\"n\">wide</span> <span class=\"o\">:</span> <span class=\"bp\">‚àÄ</span> <span class=\"n\">c</span><span class=\"o\">,</span> <span class=\"mi\">ùüô</span> <span class=\"n\">c</span> <span class=\"bp\">‚àà</span> <span class=\"n\">S.arrws</span> <span class=\"n\">c</span> <span class=\"n\">c</span><span class=\"o\">)</span>  <span class=\"c1\">-- S is \"wide\": all vertices of G are covered</span>\n<span class=\"o\">(</span><span class=\"n\">conj</span> <span class=\"o\">{</span><span class=\"n\">c</span> <span class=\"n\">d</span><span class=\"o\">}</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"o\">:</span> <span class=\"n\">c</span> <span class=\"bp\">‚ü∂</span> <span class=\"n\">d</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">Œ≥</span> <span class=\"o\">:</span> <span class=\"n\">c</span> <span class=\"bp\">‚ü∂</span> <span class=\"n\">c</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">hs</span> <span class=\"o\">:</span> <span class=\"n\">Œ≥</span> <span class=\"bp\">‚àà</span> <span class=\"n\">S.arrws</span> <span class=\"n\">c</span> <span class=\"n\">c</span><span class=\"o\">)</span> <span class=\"o\">:</span>\n  <span class=\"n\">groupoid.inv</span> <span class=\"n\">p</span> <span class=\"bp\">‚â´</span> <span class=\"n\">Œ≥</span> <span class=\"bp\">‚â´</span> <span class=\"n\">p</span> <span class=\"bp\">‚àà</span> <span class=\"n\">S.arrws</span> <span class=\"n\">d</span> <span class=\"n\">d</span><span class=\"o\">)</span>\n\n<span class=\"kd\">lemma</span> <span class=\"n\">is_normal.arrws_nonempty_refl</span> <span class=\"o\">{</span><span class=\"n\">S</span> <span class=\"o\">:</span> <span class=\"n\">subgroupoid</span> <span class=\"n\">C</span><span class=\"o\">}</span> <span class=\"o\">(</span><span class=\"n\">Sn</span> <span class=\"o\">:</span> <span class=\"n\">S.is_normal</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">c</span> <span class=\"o\">:</span> <span class=\"n\">C</span><span class=\"o\">)</span> <span class=\"o\">:</span>\n  <span class=\"o\">(</span><span class=\"n\">S.arrws</span> <span class=\"n\">c</span> <span class=\"n\">c</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">nonempty</span> <span class=\"o\">:=</span>\n<span class=\"o\">‚ü®</span><span class=\"mi\">ùüô</span> <span class=\"n\">c</span><span class=\"o\">,</span> <span class=\"n\">Sn.wide</span> <span class=\"n\">c</span><span class=\"o\">‚ü©</span>\n\n<span class=\"kd\">lemma</span> <span class=\"n\">is_normal.arrws_nonempty_symm</span> <span class=\"o\">{</span><span class=\"n\">S</span> <span class=\"o\">:</span> <span class=\"n\">subgroupoid</span> <span class=\"n\">C</span><span class=\"o\">}</span> <span class=\"o\">(</span><span class=\"n\">Sn</span> <span class=\"o\">:</span> <span class=\"n\">S.is_normal</span><span class=\"o\">)</span>\n  <span class=\"o\">{</span><span class=\"n\">c</span> <span class=\"n\">d</span> <span class=\"o\">:</span> <span class=\"n\">C</span><span class=\"o\">}</span> <span class=\"o\">:</span> <span class=\"o\">(</span><span class=\"n\">S.arrws</span> <span class=\"n\">c</span> <span class=\"n\">d</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">nonempty</span> <span class=\"bp\">‚Üí</span> <span class=\"o\">(</span><span class=\"n\">S.arrws</span> <span class=\"n\">d</span> <span class=\"n\">c</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">nonempty</span> <span class=\"o\">:=</span>\n<span class=\"kd\">by</span> <span class=\"o\">{</span> <span class=\"n\">rintro</span> <span class=\"o\">‚ü®</span><span class=\"n\">f</span><span class=\"o\">,</span> <span class=\"n\">hf</span><span class=\"o\">‚ü©,</span> <span class=\"n\">exact</span> <span class=\"o\">‚ü®</span><span class=\"n\">groupoid.inv</span> <span class=\"n\">f</span><span class=\"o\">,</span> <span class=\"n\">S.inv'</span> <span class=\"n\">hf</span><span class=\"o\">‚ü©</span> <span class=\"o\">}</span>\n\n<span class=\"kd\">lemma</span> <span class=\"n\">is_normal.arrws_nonempty_trans</span> <span class=\"o\">{</span><span class=\"n\">S</span> <span class=\"o\">:</span> <span class=\"n\">subgroupoid</span> <span class=\"n\">C</span><span class=\"o\">}</span> <span class=\"o\">(</span><span class=\"n\">Sn</span> <span class=\"o\">:</span> <span class=\"n\">S.is_normal</span><span class=\"o\">)</span>\n  <span class=\"o\">{</span><span class=\"n\">c</span> <span class=\"n\">d</span> <span class=\"n\">e</span> <span class=\"o\">:</span> <span class=\"n\">C</span><span class=\"o\">}</span> <span class=\"o\">:</span> <span class=\"o\">(</span><span class=\"n\">S.arrws</span> <span class=\"n\">c</span> <span class=\"n\">d</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">nonempty</span> <span class=\"bp\">‚Üí</span> <span class=\"o\">(</span><span class=\"n\">S.arrws</span> <span class=\"n\">d</span> <span class=\"n\">e</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">nonempty</span> <span class=\"bp\">‚Üí</span> <span class=\"o\">(</span><span class=\"n\">S.arrws</span> <span class=\"n\">c</span> <span class=\"n\">e</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">nonempty</span> <span class=\"o\">:=</span>\n<span class=\"kd\">by</span> <span class=\"o\">{</span> <span class=\"n\">rintro</span> <span class=\"o\">‚ü®</span><span class=\"n\">f</span><span class=\"o\">,</span> <span class=\"n\">hf</span><span class=\"o\">‚ü©</span> <span class=\"o\">‚ü®</span><span class=\"n\">g</span><span class=\"o\">,</span> <span class=\"n\">hg</span><span class=\"o\">‚ü©,</span> <span class=\"n\">exact</span> <span class=\"o\">‚ü®</span><span class=\"n\">f</span> <span class=\"bp\">‚â´</span> <span class=\"n\">g</span><span class=\"o\">,</span> <span class=\"n\">S.mul'</span> <span class=\"n\">hf</span> <span class=\"n\">hg</span><span class=\"o\">‚ü©</span> <span class=\"o\">}</span>\n\n<span class=\"kd\">def</span> <span class=\"n\">is_normal.arrws_nonempty_setoid</span> <span class=\"o\">{</span><span class=\"n\">S</span> <span class=\"o\">:</span> <span class=\"n\">subgroupoid</span> <span class=\"n\">C</span><span class=\"o\">}</span> <span class=\"o\">(</span><span class=\"n\">Sn</span> <span class=\"o\">:</span> <span class=\"n\">S.is_normal</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">setoid</span> <span class=\"n\">C</span> <span class=\"o\">:=</span>\n<span class=\"o\">{</span> <span class=\"n\">r</span> <span class=\"o\">:=</span> <span class=\"bp\">Œª</span> <span class=\"n\">c</span> <span class=\"n\">d</span><span class=\"o\">,</span> <span class=\"o\">(</span><span class=\"n\">S.arrws</span> <span class=\"n\">c</span> <span class=\"n\">d</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">nonempty</span><span class=\"o\">,</span>\n  <span class=\"n\">iseqv</span> <span class=\"o\">:=</span> <span class=\"o\">‚ü®</span><span class=\"n\">Sn.arrws_nonempty_refl</span><span class=\"o\">,</span>\n            <span class=\"bp\">Œª</span> <span class=\"n\">c</span> <span class=\"n\">d</span><span class=\"o\">,</span> <span class=\"n\">Sn.arrws_nonempty_symm</span><span class=\"o\">,</span>\n            <span class=\"bp\">Œª</span> <span class=\"n\">c</span> <span class=\"n\">d</span> <span class=\"n\">e</span><span class=\"o\">,</span> <span class=\"n\">Sn.arrws_nonempty_trans</span><span class=\"o\">‚ü©</span> <span class=\"o\">}</span>\n\n<span class=\"kd\">end</span> <span class=\"n\">subgroupoid</span>\n\n<span class=\"kd\">end</span> <span class=\"n\">subgroupoid</span>\n\n<span class=\"kn\">section</span> <span class=\"n\">quotient</span>\n<span class=\"kd\">variables</span> <span class=\"o\">{</span><span class=\"n\">C</span><span class=\"o\">}</span> <span class=\"o\">[</span><span class=\"n\">groupoid</span> <span class=\"n\">C</span><span class=\"o\">]</span> <span class=\"o\">(</span><span class=\"n\">S</span> <span class=\"o\">:</span> <span class=\"n\">subgroupoid</span> <span class=\"n\">C</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">Sn</span> <span class=\"o\">:</span> <span class=\"n\">S.is_normal</span><span class=\"o\">)</span>\n\n<span class=\"c1\">-- The vertices of the quotient of G by S</span>\n<span class=\"kd\">@[reducible]</span> <span class=\"kd\">def</span> <span class=\"n\">subgroupoid.quot_v</span> <span class=\"o\">:=</span> <span class=\"n\">quotient</span> <span class=\"n\">Sn.arrws_nonempty_setoid</span>\n\n<span class=\"kd\">def</span> <span class=\"n\">subgroupoid.quot_v_mk</span> <span class=\"o\">(</span><span class=\"n\">c</span> <span class=\"o\">:</span> <span class=\"n\">C</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">S.quot_v</span> <span class=\"n\">Sn</span> <span class=\"o\">:=</span> <span class=\"n\">quotient.mk'</span> <span class=\"n\">c</span>\n\n<span class=\"kn\">namespace</span> <span class=\"n\">subgroupoid</span>\n\n<span class=\"sd\">/-- We don't need Sn in the definition, but it makes it inferrable where it is needed. -/</span>\n<span class=\"kd\">def</span> <span class=\"n\">conj</span> <span class=\"o\">(</span><span class=\"n\">Sn</span> <span class=\"o\">:</span> <span class=\"n\">S.is_normal</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"o\">(</span><span class=\"bp\">Œ£</span> <span class=\"o\">(</span><span class=\"n\">a</span> <span class=\"n\">b</span> <span class=\"o\">:</span> <span class=\"n\">C</span><span class=\"o\">),</span> <span class=\"n\">a</span> <span class=\"bp\">‚ü∂</span> <span class=\"n\">b</span><span class=\"o\">)</span> <span class=\"bp\">‚Üí</span> <span class=\"o\">(</span><span class=\"bp\">Œ£</span> <span class=\"o\">(</span><span class=\"n\">a</span> <span class=\"n\">b</span> <span class=\"o\">:</span> <span class=\"n\">C</span><span class=\"o\">),</span> <span class=\"n\">a</span> <span class=\"bp\">‚ü∂</span> <span class=\"n\">b</span><span class=\"o\">)</span> <span class=\"bp\">‚Üí</span> <span class=\"kt\">Prop</span>\n<span class=\"bp\">|</span> <span class=\"o\">‚ü®</span><span class=\"n\">a</span><span class=\"o\">,</span> <span class=\"n\">b</span><span class=\"o\">,</span> <span class=\"n\">f</span><span class=\"o\">‚ü©</span> <span class=\"o\">‚ü®</span><span class=\"n\">c</span><span class=\"o\">,</span> <span class=\"n\">d</span><span class=\"o\">,</span> <span class=\"n\">g</span><span class=\"o\">‚ü©</span> <span class=\"o\">:=</span> <span class=\"bp\">‚àÉ</span> <span class=\"o\">(</span><span class=\"n\">Œ±</span> <span class=\"bp\">‚àà</span> <span class=\"n\">S.arrws</span> <span class=\"n\">a</span> <span class=\"n\">c</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">Œ≤</span> <span class=\"bp\">‚àà</span> <span class=\"n\">S.arrws</span> <span class=\"n\">d</span> <span class=\"n\">b</span><span class=\"o\">),</span> <span class=\"n\">f</span> <span class=\"bp\">=</span> <span class=\"n\">Œ±</span> <span class=\"bp\">‚â´</span> <span class=\"n\">g</span> <span class=\"bp\">‚â´</span> <span class=\"n\">Œ≤</span>\n\n<span class=\"kd\">@[refl]</span>\n<span class=\"kd\">lemma</span> <span class=\"n\">conj.refl</span> <span class=\"o\">:</span> <span class=\"bp\">‚àÄ</span> <span class=\"n\">F</span><span class=\"o\">,</span> <span class=\"n\">S.conj</span> <span class=\"n\">Sn</span> <span class=\"n\">F</span> <span class=\"n\">F</span> <span class=\"o\">:=</span>\n<span class=\"kd\">begin</span>\n  <span class=\"n\">rintro</span> <span class=\"o\">‚ü®</span><span class=\"n\">a</span><span class=\"o\">,</span><span class=\"n\">b</span><span class=\"o\">,</span><span class=\"n\">f</span><span class=\"o\">‚ü©,</span>\n  <span class=\"n\">use</span> <span class=\"o\">[</span><span class=\"mi\">ùüô</span> <span class=\"n\">a</span><span class=\"o\">,</span> <span class=\"n\">Sn.wide</span> <span class=\"n\">a</span><span class=\"o\">,</span> <span class=\"mi\">ùüô</span> <span class=\"n\">b</span><span class=\"o\">,</span> <span class=\"n\">Sn.wide</span> <span class=\"n\">b</span><span class=\"o\">],</span>\n  <span class=\"n\">simp</span> <span class=\"n\">only</span> <span class=\"o\">[</span><span class=\"n\">category.comp_id</span><span class=\"o\">,</span> <span class=\"n\">category.id_comp</span><span class=\"o\">],</span>\n<span class=\"kd\">end</span>\n\n<span class=\"kd\">@[symm]</span>\n<span class=\"kd\">lemma</span> <span class=\"n\">conj.symm</span> <span class=\"o\">:</span> <span class=\"bp\">‚àÄ</span> <span class=\"n\">F</span> <span class=\"n\">G</span><span class=\"o\">,</span> <span class=\"n\">S.conj</span> <span class=\"n\">Sn</span> <span class=\"n\">F</span> <span class=\"n\">G</span> <span class=\"bp\">‚Üí</span> <span class=\"n\">S.conj</span> <span class=\"n\">Sn</span> <span class=\"n\">G</span> <span class=\"n\">F</span> <span class=\"o\">:=</span>\n<span class=\"kd\">begin</span>\n  <span class=\"n\">rintros</span> <span class=\"o\">‚ü®</span><span class=\"n\">a</span><span class=\"o\">,</span><span class=\"n\">b</span><span class=\"o\">,</span><span class=\"n\">f</span><span class=\"o\">‚ü©</span> <span class=\"o\">‚ü®</span><span class=\"n\">c</span><span class=\"o\">,</span><span class=\"n\">d</span><span class=\"o\">,</span><span class=\"n\">g</span><span class=\"o\">‚ü©</span> <span class=\"o\">‚ü®</span><span class=\"n\">Œ±</span><span class=\"o\">,</span><span class=\"n\">hŒ±</span><span class=\"o\">,</span><span class=\"n\">Œ≤</span><span class=\"o\">,</span><span class=\"n\">hŒ≤</span><span class=\"o\">,</span><span class=\"n\">rfl</span><span class=\"o\">‚ü©,</span>\n  <span class=\"n\">use</span> <span class=\"o\">[</span><span class=\"n\">groupoid.inv</span> <span class=\"n\">Œ±</span><span class=\"o\">,</span> <span class=\"n\">S.inv'</span> <span class=\"n\">hŒ±</span><span class=\"o\">,</span> <span class=\"n\">groupoid.inv</span> <span class=\"n\">Œ≤</span><span class=\"o\">,</span> <span class=\"n\">S.inv'</span> <span class=\"n\">hŒ≤</span><span class=\"o\">],</span>\n  <span class=\"n\">simp</span> <span class=\"n\">only</span> <span class=\"o\">[</span><span class=\"n\">category.assoc</span><span class=\"o\">,</span> <span class=\"n\">comp_inv</span><span class=\"o\">,</span> <span class=\"n\">category.comp_id</span><span class=\"o\">],</span>\n  <span class=\"n\">rw</span> <span class=\"bp\">‚Üê</span><span class=\"n\">category.assoc</span><span class=\"o\">,</span>\n  <span class=\"n\">simp</span> <span class=\"n\">only</span> <span class=\"o\">[</span><span class=\"n\">inv_comp</span><span class=\"o\">,</span> <span class=\"n\">category.id_comp</span><span class=\"o\">],</span>\n<span class=\"kd\">end</span>\n\n<span class=\"kd\">@[trans]</span>\n<span class=\"kd\">lemma</span> <span class=\"n\">conj.trans</span> <span class=\"o\">:</span> <span class=\"bp\">‚àÄ</span> <span class=\"n\">F</span> <span class=\"n\">G</span> <span class=\"n\">H</span><span class=\"o\">,</span> <span class=\"n\">conj</span> <span class=\"n\">S</span> <span class=\"n\">Sn</span> <span class=\"n\">F</span> <span class=\"n\">G</span> <span class=\"bp\">‚Üí</span> <span class=\"n\">conj</span> <span class=\"n\">S</span> <span class=\"n\">Sn</span> <span class=\"n\">G</span> <span class=\"n\">H</span> <span class=\"bp\">‚Üí</span> <span class=\"n\">conj</span> <span class=\"n\">S</span> <span class=\"n\">Sn</span> <span class=\"n\">F</span> <span class=\"n\">H</span> <span class=\"o\">:=</span>\n<span class=\"kd\">begin</span>\n  <span class=\"n\">rintros</span> <span class=\"o\">‚ü®</span><span class=\"n\">a‚ÇÄ</span><span class=\"o\">,</span><span class=\"n\">b‚ÇÄ</span><span class=\"o\">,</span><span class=\"n\">f‚ÇÄ</span><span class=\"o\">‚ü©</span> <span class=\"o\">‚ü®</span><span class=\"n\">a‚ÇÅ</span><span class=\"o\">,</span><span class=\"n\">b‚ÇÅ</span><span class=\"o\">,</span><span class=\"n\">f‚ÇÅ</span><span class=\"o\">‚ü©</span> <span class=\"o\">‚ü®</span><span class=\"n\">a‚ÇÇ</span><span class=\"o\">,</span><span class=\"n\">b‚ÇÇ</span><span class=\"o\">,</span><span class=\"n\">f‚ÇÇ</span><span class=\"o\">‚ü©</span> <span class=\"o\">‚ü®</span><span class=\"n\">Œ±‚ÇÄ</span><span class=\"o\">,</span><span class=\"n\">hŒ±‚ÇÄ</span><span class=\"o\">,</span><span class=\"n\">Œ≤‚ÇÄ</span><span class=\"o\">,</span><span class=\"n\">hŒ≤‚ÇÄ</span><span class=\"o\">,</span><span class=\"n\">rfl</span><span class=\"o\">‚ü©</span>  <span class=\"o\">‚ü®</span><span class=\"n\">Œ±‚ÇÅ</span><span class=\"o\">,</span><span class=\"n\">hŒ±‚ÇÅ</span><span class=\"o\">,</span><span class=\"n\">Œ≤‚ÇÅ</span><span class=\"o\">,</span><span class=\"n\">hŒ≤‚ÇÅ</span><span class=\"o\">,</span><span class=\"n\">rfl</span><span class=\"o\">‚ü©,</span>\n  <span class=\"n\">use</span> <span class=\"o\">[</span><span class=\"n\">Œ±‚ÇÄ</span> <span class=\"bp\">‚â´</span> <span class=\"n\">Œ±‚ÇÅ</span><span class=\"o\">,</span> <span class=\"n\">S.mul'</span> <span class=\"n\">hŒ±‚ÇÄ</span> <span class=\"n\">hŒ±‚ÇÅ</span><span class=\"o\">,</span> <span class=\"n\">Œ≤‚ÇÅ</span> <span class=\"bp\">‚â´</span> <span class=\"n\">Œ≤‚ÇÄ</span><span class=\"o\">,</span> <span class=\"n\">S.mul'</span> <span class=\"n\">hŒ≤‚ÇÅ</span> <span class=\"n\">hŒ≤‚ÇÄ</span><span class=\"o\">],</span>\n  <span class=\"n\">simp</span> <span class=\"n\">only</span> <span class=\"o\">[</span><span class=\"n\">category.assoc</span><span class=\"o\">],</span>\n<span class=\"kd\">end</span>\n\n<span class=\"kd\">def</span> <span class=\"n\">conj_setoid</span> <span class=\"o\">:</span> <span class=\"n\">setoid</span> <span class=\"o\">(</span><span class=\"bp\">Œ£</span> <span class=\"o\">(</span><span class=\"n\">a</span> <span class=\"n\">b</span> <span class=\"o\">:</span> <span class=\"n\">C</span><span class=\"o\">),</span> <span class=\"n\">a</span> <span class=\"bp\">‚ü∂</span> <span class=\"n\">b</span><span class=\"o\">)</span> <span class=\"o\">:=</span>\n<span class=\"o\">{</span> <span class=\"n\">r</span> <span class=\"o\">:=</span> <span class=\"n\">S.conj</span> <span class=\"n\">Sn</span><span class=\"o\">,</span>\n  <span class=\"n\">iseqv</span> <span class=\"o\">:=</span> <span class=\"o\">‚ü®</span><span class=\"n\">conj.refl</span> <span class=\"n\">_</span> <span class=\"n\">_</span><span class=\"o\">,</span> <span class=\"bp\">Œª</span> <span class=\"n\">_</span> <span class=\"n\">_</span><span class=\"o\">,</span> <span class=\"n\">conj.symm</span> <span class=\"n\">_</span> <span class=\"n\">_</span> <span class=\"n\">_</span> <span class=\"n\">_</span><span class=\"o\">,</span> <span class=\"bp\">Œª</span> <span class=\"n\">_</span> <span class=\"n\">_</span> <span class=\"n\">_</span><span class=\"o\">,</span> <span class=\"n\">conj.trans</span> <span class=\"n\">_</span> <span class=\"n\">_</span> <span class=\"n\">_</span> <span class=\"n\">_</span> <span class=\"n\">_</span><span class=\"o\">‚ü©</span> <span class=\"o\">}</span>\n\n<span class=\"kd\">@[reducible]</span> <span class=\"kd\">def</span> <span class=\"n\">quot_conj</span> <span class=\"o\">:=</span> <span class=\"n\">quotient</span> <span class=\"o\">(</span><span class=\"n\">S.conj_setoid</span> <span class=\"n\">Sn</span><span class=\"o\">)</span>\n\n<span class=\"kd\">def</span> <span class=\"n\">quot_conj_mk</span> <span class=\"o\">{</span><span class=\"n\">a</span> <span class=\"n\">b</span> <span class=\"o\">:</span> <span class=\"n\">C</span><span class=\"o\">}</span> <span class=\"o\">(</span><span class=\"n\">f</span> <span class=\"o\">:</span> <span class=\"n\">a</span> <span class=\"bp\">‚ü∂</span> <span class=\"n\">b</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">S.quot_conj</span> <span class=\"n\">Sn</span> <span class=\"o\">:=</span> <span class=\"n\">quotient.mk'</span> <span class=\"o\">‚ü®</span><span class=\"n\">a</span><span class=\"o\">,</span> <span class=\"n\">b</span><span class=\"o\">,</span> <span class=\"n\">f</span><span class=\"o\">‚ü©</span>\n\n<span class=\"kn\">namespace</span> <span class=\"n\">quot_conj</span>\n<span class=\"kd\">variables</span> <span class=\"o\">{</span><span class=\"n\">S</span><span class=\"o\">}</span> <span class=\"o\">{</span><span class=\"n\">Sn</span><span class=\"o\">}</span>\n\n<span class=\"kn\">protected</span> <span class=\"kd\">def</span> <span class=\"n\">start</span> <span class=\"o\">:</span> <span class=\"n\">S.quot_conj</span> <span class=\"n\">Sn</span> <span class=\"bp\">‚Üí</span> <span class=\"n\">S.quot_v</span> <span class=\"n\">Sn</span> <span class=\"o\">:=</span>\n<span class=\"n\">quotient.map'</span> <span class=\"o\">(</span><span class=\"bp\">Œª</span> <span class=\"n\">f</span><span class=\"o\">,</span> <span class=\"n\">f.1</span><span class=\"o\">)</span> <span class=\"kd\">begin</span>\n  <span class=\"n\">rintro</span> <span class=\"o\">‚ü®</span><span class=\"n\">a‚ÇÄ</span><span class=\"o\">,</span><span class=\"n\">b‚ÇÄ</span><span class=\"o\">,</span><span class=\"n\">f‚ÇÄ</span><span class=\"o\">‚ü©</span> <span class=\"o\">‚ü®</span><span class=\"n\">a‚ÇÅ</span><span class=\"o\">,</span><span class=\"n\">b‚ÇÅ</span><span class=\"o\">,</span><span class=\"n\">f‚ÇÅ</span><span class=\"o\">‚ü©</span> <span class=\"o\">‚ü®</span><span class=\"n\">Œ±</span><span class=\"o\">,</span><span class=\"n\">hŒ±</span><span class=\"o\">,</span><span class=\"n\">Œ≤</span><span class=\"o\">,</span><span class=\"n\">hŒ≤</span><span class=\"o\">,</span><span class=\"n\">rfl</span><span class=\"o\">‚ü©,</span>\n  <span class=\"n\">exact</span> <span class=\"o\">‚ü®</span><span class=\"n\">Œ±</span><span class=\"o\">,</span> <span class=\"n\">hŒ±</span><span class=\"o\">‚ü©,</span>\n<span class=\"kd\">end</span>\n\n<span class=\"kn\">protected</span> <span class=\"kd\">def</span> <span class=\"bp\">¬´</span><span class=\"kd\">end</span><span class=\"bp\">¬ª</span>  <span class=\"o\">:</span> <span class=\"n\">S.quot_conj</span> <span class=\"n\">Sn</span> <span class=\"bp\">‚Üí</span> <span class=\"n\">S.quot_v</span> <span class=\"n\">Sn</span> <span class=\"o\">:=</span>\n<span class=\"n\">quotient.map'</span> <span class=\"o\">(</span><span class=\"bp\">Œª</span> <span class=\"n\">f</span><span class=\"o\">,</span> <span class=\"n\">f.2.1</span><span class=\"o\">)</span> <span class=\"kd\">begin</span>\n  <span class=\"n\">rintro</span> <span class=\"o\">‚ü®</span><span class=\"n\">a‚ÇÄ</span><span class=\"o\">,</span><span class=\"n\">b‚ÇÄ</span><span class=\"o\">,</span><span class=\"n\">f‚ÇÄ</span><span class=\"o\">‚ü©</span> <span class=\"o\">‚ü®</span><span class=\"n\">a‚ÇÅ</span><span class=\"o\">,</span><span class=\"n\">b‚ÇÅ</span><span class=\"o\">,</span><span class=\"n\">f‚ÇÅ</span><span class=\"o\">‚ü©</span> <span class=\"o\">‚ü®</span><span class=\"n\">Œ±</span><span class=\"o\">,</span><span class=\"n\">hŒ±</span><span class=\"o\">,</span><span class=\"n\">Œ≤</span><span class=\"o\">,</span><span class=\"n\">hŒ≤</span><span class=\"o\">,</span><span class=\"n\">rfl</span><span class=\"o\">‚ü©,</span>\n  <span class=\"n\">exact</span> <span class=\"o\">‚ü®</span><span class=\"n\">groupoid.inv</span> <span class=\"n\">Œ≤</span><span class=\"o\">,</span> <span class=\"n\">S.inv'</span> <span class=\"n\">hŒ≤</span><span class=\"o\">‚ü©,</span>\n<span class=\"kd\">end</span>\n\n<span class=\"kd\">end</span> <span class=\"n\">quot_conj</span>\n\n<span class=\"kd\">@[simp]</span>\n<span class=\"kd\">lemma</span> <span class=\"n\">start_mk_eq</span> <span class=\"o\">{</span><span class=\"n\">a</span> <span class=\"n\">b</span> <span class=\"o\">:</span> <span class=\"n\">C</span><span class=\"o\">}</span> <span class=\"o\">(</span><span class=\"n\">f</span> <span class=\"o\">:</span> <span class=\"n\">a</span> <span class=\"bp\">‚ü∂</span> <span class=\"n\">b</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"o\">(</span><span class=\"n\">S.quot_conj_mk</span> <span class=\"n\">Sn</span> <span class=\"n\">f</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">start</span> <span class=\"bp\">=</span> <span class=\"n\">S.quot_v_mk</span> <span class=\"n\">Sn</span> <span class=\"n\">a</span> <span class=\"o\">:=</span> <span class=\"n\">rfl</span>\n\n<span class=\"kd\">@[simp]</span>\n<span class=\"kd\">lemma</span> <span class=\"n\">end_mk_eq</span> <span class=\"o\">{</span><span class=\"n\">a</span> <span class=\"n\">b</span> <span class=\"o\">:</span> <span class=\"n\">C</span><span class=\"o\">}</span> <span class=\"o\">(</span><span class=\"n\">f</span> <span class=\"o\">:</span> <span class=\"n\">a</span> <span class=\"bp\">‚ü∂</span> <span class=\"n\">b</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"o\">(</span><span class=\"n\">S.quot_conj_mk</span> <span class=\"n\">Sn</span> <span class=\"n\">f</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"kd\">end</span> <span class=\"bp\">=</span> <span class=\"n\">S.quot_v_mk</span> <span class=\"n\">Sn</span> <span class=\"n\">b</span> <span class=\"o\">:=</span> <span class=\"n\">rfl</span>\n\n<span class=\"kd\">instance</span> <span class=\"n\">quot_quiver</span> <span class=\"o\">:</span> <span class=\"n\">quiver</span> <span class=\"o\">(</span><span class=\"n\">S.quot_v</span> <span class=\"n\">Sn</span><span class=\"o\">)</span> <span class=\"o\">:=</span>\n<span class=\"o\">‚ü®</span><span class=\"bp\">Œª</span> <span class=\"n\">c</span> <span class=\"n\">d</span><span class=\"o\">,</span> <span class=\"o\">{</span> <span class=\"n\">F</span> <span class=\"o\">:</span> <span class=\"n\">S.quot_conj</span> <span class=\"n\">Sn</span> <span class=\"bp\">|</span> <span class=\"n\">F.start</span> <span class=\"bp\">=</span> <span class=\"n\">c</span> <span class=\"bp\">‚àß</span> <span class=\"n\">F.end</span> <span class=\"bp\">=</span> <span class=\"n\">d</span> <span class=\"o\">}‚ü©</span>\n\n<span class=\"kd\">def</span> <span class=\"n\">quot_id</span> <span class=\"o\">(</span><span class=\"n\">c</span> <span class=\"o\">:</span> <span class=\"n\">quot_v</span> <span class=\"n\">S</span> <span class=\"n\">Sn</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">c</span> <span class=\"bp\">‚ü∂</span> <span class=\"n\">c</span> <span class=\"o\">:=</span>\n<span class=\"o\">‚ü®</span><span class=\"n\">quotient.lift_on'</span> <span class=\"n\">c</span> <span class=\"o\">(</span><span class=\"bp\">Œª</span> <span class=\"n\">c'</span><span class=\"o\">,</span> <span class=\"n\">S.quot_conj_mk</span> <span class=\"n\">Sn</span> <span class=\"o\">(</span><span class=\"mi\">ùüô</span> <span class=\"n\">c'</span><span class=\"o\">))</span> <span class=\"kd\">begin</span>\n  <span class=\"n\">rintro</span> <span class=\"n\">a</span> <span class=\"n\">b</span> <span class=\"o\">‚ü®</span><span class=\"n\">f</span><span class=\"o\">,</span> <span class=\"n\">hf</span><span class=\"o\">‚ü©,</span>\n  <span class=\"n\">apply</span> <span class=\"n\">quotient.sound'</span><span class=\"o\">,</span>\n  <span class=\"n\">use</span> <span class=\"o\">[</span><span class=\"n\">f</span><span class=\"o\">,</span> <span class=\"n\">hf</span><span class=\"o\">,</span> <span class=\"n\">groupoid.inv</span> <span class=\"n\">f</span><span class=\"o\">,</span> <span class=\"n\">S.inv'</span> <span class=\"n\">hf</span><span class=\"o\">],</span>\n  <span class=\"n\">simp</span> <span class=\"n\">only</span> <span class=\"o\">[</span><span class=\"n\">category.id_comp</span><span class=\"o\">,</span> <span class=\"n\">comp_inv</span><span class=\"o\">],</span>\n<span class=\"kd\">end</span><span class=\"o\">,</span> <span class=\"kd\">by</span> <span class=\"n\">exact</span> <span class=\"n\">quotient.ind'</span> <span class=\"o\">(</span><span class=\"bp\">Œª</span> <span class=\"n\">_</span><span class=\"o\">,</span> <span class=\"o\">‚ü®</span><span class=\"n\">rfl</span><span class=\"o\">,</span> <span class=\"n\">rfl</span><span class=\"o\">‚ü©)</span> <span class=\"n\">c</span><span class=\"o\">‚ü©</span>\n\n<span class=\"kd\">def</span> <span class=\"n\">quot_comp</span> <span class=\"o\">{</span><span class=\"n\">c</span> <span class=\"n\">d</span> <span class=\"n\">e</span> <span class=\"o\">:</span> <span class=\"n\">quot_v</span> <span class=\"n\">S</span> <span class=\"n\">Sn</span><span class=\"o\">}</span> <span class=\"o\">:</span> <span class=\"o\">(</span><span class=\"n\">c</span> <span class=\"bp\">‚ü∂</span> <span class=\"n\">d</span><span class=\"o\">)</span> <span class=\"bp\">‚Üí</span> <span class=\"o\">(</span><span class=\"n\">d</span> <span class=\"bp\">‚ü∂</span> <span class=\"n\">e</span><span class=\"o\">)</span> <span class=\"bp\">‚Üí</span> <span class=\"o\">(</span><span class=\"n\">c</span> <span class=\"bp\">‚ü∂</span> <span class=\"n\">e</span><span class=\"o\">)</span> <span class=\"o\">:=</span>\n<span class=\"kd\">begin</span>\n  <span class=\"c1\">-- should do in a different way</span>\n  <span class=\"n\">letI</span> <span class=\"o\">:=</span> <span class=\"n\">Sn.arrws_nonempty_setoid</span><span class=\"o\">,</span>\n  <span class=\"n\">refine</span> <span class=\"n\">quotient.rec</span> <span class=\"o\">(</span><span class=\"bp\">Œª</span> <span class=\"n\">c'</span><span class=\"o\">,</span> <span class=\"n\">_</span><span class=\"o\">)</span> <span class=\"n\">_</span> <span class=\"n\">c</span><span class=\"o\">,</span>\n  <span class=\"n\">refine</span> <span class=\"n\">quotient.rec</span> <span class=\"o\">(</span><span class=\"bp\">Œª</span> <span class=\"n\">d'</span><span class=\"o\">,</span> <span class=\"n\">_</span><span class=\"o\">)</span> <span class=\"n\">_</span> <span class=\"n\">d</span><span class=\"o\">,</span>\n  <span class=\"n\">refine</span> <span class=\"n\">quotient.rec</span> <span class=\"o\">(</span><span class=\"bp\">Œª</span> <span class=\"n\">e'</span><span class=\"o\">,</span> <span class=\"n\">_</span><span class=\"o\">)</span> <span class=\"n\">_</span> <span class=\"n\">e</span><span class=\"o\">,</span>\n  <span class=\"n\">rintro</span> <span class=\"o\">‚ü®</span><span class=\"n\">f</span><span class=\"o\">,</span> <span class=\"n\">hf</span><span class=\"o\">‚ü©</span> <span class=\"o\">‚ü®</span><span class=\"n\">g</span><span class=\"o\">,</span> <span class=\"n\">hg</span><span class=\"o\">‚ü©,</span>\n  <span class=\"gr\">sorry</span>\n<span class=\"kd\">end</span>\n\n\n<span class=\"kd\">end</span> <span class=\"n\">subgroupoid</span>\n<span class=\"kd\">end</span> <span class=\"n\">quotient</span>\n\n<span class=\"kd\">end</span> <span class=\"n\">groupoid</span>\n<span class=\"kd\">end</span> <span class=\"n\">category_theory</span>\n</code></pre></div>",
        "id": 300553895,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1664034378
    },
    {
        "content": "<p>I think Junyan's correct about how the main difficulty is in subtypes of quotients vs quotients of subtypes. It might help to make custom lift functions to deal with dependent types from the objects.</p>",
        "id": 300554331,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1664034649
    },
    {
        "content": "<p>Thanks for the cleaned-up code. I tried commuting quotients and subtype <a href=\"https://github.com/bottine/Bass-Serre/blob/e027941270fa9a631c2d3f3a0b78eff043eeeae2/src/groupoid_presentation.lean#L543\">here</a> but as far as I can tell, it doesn't help with the fact that I need a dependent function.</p>",
        "id": 300562628,
        "sender_full_name": "R√©mi Bottinelli",
        "timestamp": 1664039128
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"461830\">@R√©mi Bottinelli</span> Here's a full construction of the composition, which should be inserted after</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kd\">def</span> <span class=\"n\">subgroupoid.quot_v_mk</span>\n<span class=\"kn\">namespace</span> <span class=\"n\">subgroupoid</span>\n</code></pre></div>\n<p>in Kyle's code (thanks!). I use my own definition of <code>quotient_quiver</code> to be able to apply <code>quot.lift‚ÇÇ</code> directly. Surely the resulting type <code>c ‚ü∂ e</code> depends on <code>c</code> and <code>e</code>, but it's still the same type for different choice of elements of the input types <code>c ‚ü∂ d</code> and <code>d ‚ü∂ e</code>, so <code>quot.lift</code> works without problem. (With your original definition of <code>quotient_quiver</code>, the situation is in some sense better, since you're constructing an element in a subtype of a type that doesn't even depend on <code>c</code> and <code>e</code>, however needing to convert from subtype of quotient to quotient of subtype makes it unpleasant to work with.) I might open a PR to put everything about <code>inv</code> into category_theory.groupoid.</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kd\">def</span> <span class=\"n\">conj</span> <span class=\"o\">{</span><span class=\"n\">a</span> <span class=\"n\">b</span> <span class=\"n\">c</span> <span class=\"n\">d</span> <span class=\"o\">:</span> <span class=\"n\">C</span><span class=\"o\">}</span> <span class=\"o\">(</span><span class=\"n\">f</span> <span class=\"o\">:</span> <span class=\"n\">a</span> <span class=\"bp\">‚ü∂</span> <span class=\"n\">b</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">g</span> <span class=\"o\">:</span> <span class=\"n\">c</span> <span class=\"bp\">‚ü∂</span> <span class=\"n\">d</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"kt\">Prop</span> <span class=\"o\">:=</span>\n<span class=\"bp\">‚àÉ</span> <span class=\"o\">(</span><span class=\"n\">Œ±</span> <span class=\"bp\">‚àà</span> <span class=\"n\">S.arrws</span> <span class=\"n\">a</span> <span class=\"n\">c</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">Œ≤</span> <span class=\"bp\">‚àà</span> <span class=\"n\">S.arrws</span> <span class=\"n\">d</span> <span class=\"n\">b</span><span class=\"o\">),</span> <span class=\"n\">f</span> <span class=\"bp\">=</span> <span class=\"n\">Œ±</span> <span class=\"bp\">‚â´</span> <span class=\"n\">g</span> <span class=\"bp\">‚â´</span> <span class=\"n\">Œ≤</span>\n\n<span class=\"kn\">attribute</span> <span class=\"o\">[</span><span class=\"n\">reassoc</span><span class=\"o\">]</span> <span class=\"n\">inv_comp</span> <span class=\"n\">comp_inv</span> <span class=\"c1\">-- groupoid</span>\n\n<span class=\"kd\">lemma</span> <span class=\"n\">conj.refl</span> <span class=\"o\">{</span><span class=\"n\">a</span> <span class=\"n\">b</span> <span class=\"o\">:</span> <span class=\"n\">C</span><span class=\"o\">}</span> <span class=\"o\">(</span><span class=\"n\">f</span> <span class=\"o\">:</span> <span class=\"n\">a</span> <span class=\"bp\">‚ü∂</span> <span class=\"n\">b</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">S.conj</span> <span class=\"n\">f</span> <span class=\"n\">f</span> <span class=\"o\">:=</span> <span class=\"o\">‚ü®</span><span class=\"n\">_</span><span class=\"o\">,</span> <span class=\"n\">Sn.wide</span> <span class=\"n\">_</span><span class=\"o\">,</span> <span class=\"n\">_</span><span class=\"o\">,</span> <span class=\"n\">Sn.wide</span> <span class=\"n\">_</span><span class=\"o\">,</span> <span class=\"kd\">by</span> <span class=\"n\">simp</span><span class=\"o\">‚ü©</span>\n\n<span class=\"kd\">lemma</span> <span class=\"n\">conj.symm</span> <span class=\"o\">{</span><span class=\"n\">a</span> <span class=\"n\">b</span> <span class=\"n\">c</span> <span class=\"n\">d</span> <span class=\"o\">:</span> <span class=\"n\">C</span><span class=\"o\">}</span> <span class=\"o\">(</span><span class=\"n\">f</span> <span class=\"o\">:</span> <span class=\"n\">a</span> <span class=\"bp\">‚ü∂</span> <span class=\"n\">b</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">g</span> <span class=\"o\">:</span> <span class=\"n\">c</span> <span class=\"bp\">‚ü∂</span> <span class=\"n\">d</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">S.conj</span> <span class=\"n\">f</span> <span class=\"n\">g</span> <span class=\"bp\">‚Üí</span> <span class=\"n\">S.conj</span> <span class=\"n\">g</span> <span class=\"n\">f</span> <span class=\"o\">:=</span>\n<span class=\"bp\">Œª</span> <span class=\"o\">‚ü®</span><span class=\"n\">Œ±</span><span class=\"o\">,</span> <span class=\"n\">hŒ±</span><span class=\"o\">,</span> <span class=\"n\">Œ≤</span><span class=\"o\">,</span> <span class=\"n\">hŒ≤</span><span class=\"o\">,</span> <span class=\"n\">he</span><span class=\"o\">‚ü©,</span> <span class=\"o\">‚ü®</span><span class=\"n\">_</span><span class=\"o\">,</span> <span class=\"n\">S.inv'</span> <span class=\"n\">hŒ±</span><span class=\"o\">,</span> <span class=\"n\">_</span><span class=\"o\">,</span> <span class=\"n\">S.inv'</span> <span class=\"n\">hŒ≤</span><span class=\"o\">,</span> <span class=\"kd\">by</span> <span class=\"n\">simp</span> <span class=\"o\">[</span><span class=\"n\">he</span><span class=\"o\">]‚ü©</span>\n\n<span class=\"kd\">lemma</span> <span class=\"n\">conj_comm</span> <span class=\"o\">{</span><span class=\"n\">a</span> <span class=\"n\">b</span> <span class=\"n\">c</span> <span class=\"n\">d</span> <span class=\"o\">:</span> <span class=\"n\">C</span><span class=\"o\">}</span> <span class=\"o\">(</span><span class=\"n\">f</span> <span class=\"o\">:</span> <span class=\"n\">a</span> <span class=\"bp\">‚ü∂</span> <span class=\"n\">b</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">g</span> <span class=\"o\">:</span> <span class=\"n\">c</span> <span class=\"bp\">‚ü∂</span> <span class=\"n\">d</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">S.conj</span> <span class=\"n\">f</span> <span class=\"n\">g</span> <span class=\"bp\">‚Üî</span> <span class=\"n\">S.conj</span> <span class=\"n\">g</span> <span class=\"n\">f</span> <span class=\"o\">:=</span>\n<span class=\"o\">‚ü®</span><span class=\"n\">conj.symm</span> <span class=\"n\">S</span> <span class=\"n\">f</span> <span class=\"n\">g</span><span class=\"o\">,</span> <span class=\"n\">conj.symm</span> <span class=\"n\">S</span> <span class=\"n\">g</span> <span class=\"n\">f</span><span class=\"o\">‚ü©</span>\n\n<span class=\"kd\">lemma</span> <span class=\"n\">conj.trans</span> <span class=\"o\">{</span><span class=\"n\">a</span> <span class=\"n\">b</span> <span class=\"n\">c</span> <span class=\"n\">d</span> <span class=\"n\">e</span> <span class=\"n\">f</span> <span class=\"o\">:</span> <span class=\"n\">C</span><span class=\"o\">}</span> <span class=\"o\">(</span><span class=\"n\">g</span> <span class=\"o\">:</span> <span class=\"n\">a</span> <span class=\"bp\">‚ü∂</span> <span class=\"n\">b</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">h</span> <span class=\"o\">:</span> <span class=\"n\">c</span> <span class=\"bp\">‚ü∂</span> <span class=\"n\">d</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">i</span> <span class=\"o\">:</span> <span class=\"n\">e</span> <span class=\"bp\">‚ü∂</span> <span class=\"n\">f</span><span class=\"o\">)</span> <span class=\"o\">:</span>\n  <span class=\"n\">S.conj</span> <span class=\"n\">g</span> <span class=\"n\">h</span> <span class=\"bp\">‚Üí</span> <span class=\"n\">S.conj</span> <span class=\"n\">h</span> <span class=\"n\">i</span> <span class=\"bp\">‚Üí</span> <span class=\"n\">S.conj</span> <span class=\"n\">g</span> <span class=\"n\">i</span> <span class=\"o\">:=</span>\n<span class=\"bp\">Œª</span> <span class=\"o\">‚ü®</span><span class=\"n\">Œ±‚ÇÅ</span><span class=\"o\">,</span> <span class=\"n\">hŒ±‚ÇÅ</span><span class=\"o\">,</span> <span class=\"n\">Œ≤‚ÇÅ</span><span class=\"o\">,</span> <span class=\"n\">hŒ≤‚ÇÅ</span><span class=\"o\">,</span> <span class=\"n\">he‚ÇÅ</span><span class=\"o\">‚ü©</span> <span class=\"o\">‚ü®</span><span class=\"n\">Œ±‚ÇÇ</span><span class=\"o\">,</span> <span class=\"n\">hŒ±‚ÇÇ</span><span class=\"o\">,</span> <span class=\"n\">Œ≤‚ÇÇ</span><span class=\"o\">,</span> <span class=\"n\">hŒ≤‚ÇÇ</span><span class=\"o\">,</span> <span class=\"n\">he‚ÇÇ</span><span class=\"o\">‚ü©,</span>\n  <span class=\"o\">‚ü®</span><span class=\"n\">_</span><span class=\"o\">,</span> <span class=\"n\">S.mul'</span> <span class=\"n\">hŒ±‚ÇÅ</span> <span class=\"n\">hŒ±‚ÇÇ</span><span class=\"o\">,</span> <span class=\"n\">_</span><span class=\"o\">,</span> <span class=\"n\">S.mul'</span> <span class=\"n\">hŒ≤‚ÇÇ</span> <span class=\"n\">hŒ≤‚ÇÅ</span><span class=\"o\">,</span> <span class=\"kd\">by</span> <span class=\"n\">simp</span> <span class=\"o\">[</span><span class=\"n\">he‚ÇÅ</span><span class=\"o\">,</span> <span class=\"n\">he‚ÇÇ</span><span class=\"o\">]‚ü©</span>\n\n<span class=\"kd\">def</span> <span class=\"n\">conj_setoid</span> <span class=\"o\">(</span><span class=\"n\">a</span> <span class=\"n\">b</span> <span class=\"o\">:</span> <span class=\"n\">quot_v</span> <span class=\"n\">S</span> <span class=\"n\">Sn</span><span class=\"o\">)</span> <span class=\"o\">:</span>\n  <span class=\"n\">setoid</span> <span class=\"o\">(</span><span class=\"bp\">Œ£</span> <span class=\"o\">(</span><span class=\"n\">c</span> <span class=\"o\">:</span> <span class=\"o\">{</span><span class=\"n\">c</span> <span class=\"bp\">//</span> <span class=\"n\">quot.mk</span> <span class=\"n\">_</span> <span class=\"n\">c</span> <span class=\"bp\">=</span> <span class=\"n\">a</span><span class=\"o\">})</span> <span class=\"o\">(</span><span class=\"n\">d</span> <span class=\"o\">:</span> <span class=\"o\">{</span><span class=\"n\">d</span> <span class=\"bp\">//</span> <span class=\"n\">quot.mk</span> <span class=\"n\">_</span> <span class=\"n\">d</span> <span class=\"bp\">=</span> <span class=\"n\">b</span><span class=\"o\">}),</span> <span class=\"n\">c.1</span> <span class=\"bp\">‚ü∂</span> <span class=\"n\">d.1</span><span class=\"o\">)</span> <span class=\"o\">:=</span>\n<span class=\"o\">{</span> <span class=\"n\">r</span> <span class=\"o\">:=</span> <span class=\"bp\">Œª</span> <span class=\"n\">f</span> <span class=\"n\">g</span><span class=\"o\">,</span> <span class=\"n\">S.conj</span> <span class=\"n\">f.2.2</span> <span class=\"n\">g.2.2</span><span class=\"o\">,</span>\n  <span class=\"n\">iseqv</span> <span class=\"o\">:=</span> <span class=\"o\">‚ü®</span><span class=\"bp\">Œª</span> <span class=\"n\">_</span><span class=\"o\">,</span> <span class=\"n\">conj.refl</span> <span class=\"n\">_</span> <span class=\"n\">Sn</span> <span class=\"n\">_</span><span class=\"o\">,</span> <span class=\"bp\">Œª</span> <span class=\"n\">_</span> <span class=\"n\">_</span><span class=\"o\">,</span> <span class=\"n\">conj.symm</span> <span class=\"n\">_</span> <span class=\"n\">_</span> <span class=\"n\">_</span><span class=\"o\">,</span> <span class=\"bp\">Œª</span> <span class=\"n\">_</span> <span class=\"n\">_</span> <span class=\"n\">_</span><span class=\"o\">,</span> <span class=\"n\">conj.trans</span> <span class=\"n\">_</span> <span class=\"n\">_</span> <span class=\"n\">_</span> <span class=\"n\">_</span><span class=\"o\">‚ü©</span> <span class=\"o\">}</span>\n\n<span class=\"kd\">lemma</span> <span class=\"n\">conj_comp</span> <span class=\"o\">{</span><span class=\"n\">a</span> <span class=\"n\">b</span> <span class=\"n\">c</span> <span class=\"n\">d</span> <span class=\"n\">e</span> <span class=\"o\">:</span> <span class=\"n\">C</span><span class=\"o\">}</span> <span class=\"o\">(</span><span class=\"n\">f</span> <span class=\"o\">:</span> <span class=\"n\">a</span> <span class=\"bp\">‚ü∂</span> <span class=\"n\">b</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">g</span> <span class=\"o\">:</span> <span class=\"n\">c</span> <span class=\"bp\">‚ü∂</span> <span class=\"n\">d</span><span class=\"o\">)</span> <span class=\"o\">{</span><span class=\"n\">h</span> <span class=\"o\">:</span> <span class=\"n\">d</span> <span class=\"bp\">‚ü∂</span> <span class=\"n\">e</span><span class=\"o\">}</span> <span class=\"o\">(</span><span class=\"n\">hS</span> <span class=\"o\">:</span> <span class=\"n\">h</span> <span class=\"bp\">‚àà</span> <span class=\"n\">S.arrws</span> <span class=\"n\">d</span> <span class=\"n\">e</span><span class=\"o\">)</span> <span class=\"o\">:</span>\n  <span class=\"n\">S.conj</span> <span class=\"n\">f</span> <span class=\"o\">(</span><span class=\"n\">g</span> <span class=\"bp\">‚â´</span> <span class=\"n\">h</span><span class=\"o\">)</span> <span class=\"bp\">‚Üî</span> <span class=\"n\">S.conj</span> <span class=\"n\">f</span> <span class=\"n\">g</span> <span class=\"o\">:=</span>\n<span class=\"o\">‚ü®</span><span class=\"bp\">Œª</span> <span class=\"o\">‚ü®</span><span class=\"n\">Œ±</span><span class=\"o\">,</span> <span class=\"n\">hŒ±</span><span class=\"o\">,</span> <span class=\"n\">Œ≤</span><span class=\"o\">,</span> <span class=\"n\">hŒ≤</span><span class=\"o\">,</span> <span class=\"n\">he</span><span class=\"o\">‚ü©,</span> <span class=\"o\">‚ü®</span><span class=\"n\">Œ±</span><span class=\"o\">,</span> <span class=\"n\">hŒ±</span><span class=\"o\">,</span> <span class=\"n\">h</span> <span class=\"bp\">‚â´</span> <span class=\"n\">Œ≤</span><span class=\"o\">,</span> <span class=\"n\">S.mul'</span> <span class=\"n\">hS</span> <span class=\"n\">hŒ≤</span><span class=\"o\">,</span> <span class=\"kd\">by</span> <span class=\"n\">simp</span> <span class=\"o\">[</span><span class=\"n\">he</span><span class=\"o\">]‚ü©,</span>\n <span class=\"bp\">Œª</span> <span class=\"o\">‚ü®</span><span class=\"n\">Œ±</span><span class=\"o\">,</span> <span class=\"n\">hŒ±</span><span class=\"o\">,</span> <span class=\"n\">Œ≤</span><span class=\"o\">,</span> <span class=\"n\">hŒ≤</span><span class=\"o\">,</span> <span class=\"n\">he</span><span class=\"o\">‚ü©,</span> <span class=\"o\">‚ü®</span><span class=\"n\">Œ±</span><span class=\"o\">,</span> <span class=\"n\">hŒ±</span><span class=\"o\">,</span> <span class=\"n\">inv</span> <span class=\"n\">h</span> <span class=\"bp\">‚â´</span> <span class=\"n\">Œ≤</span><span class=\"o\">,</span> <span class=\"n\">S.mul'</span> <span class=\"o\">(</span><span class=\"n\">S.inv'</span> <span class=\"n\">hS</span><span class=\"o\">)</span> <span class=\"n\">hŒ≤</span><span class=\"o\">,</span> <span class=\"kd\">by</span> <span class=\"n\">simp</span> <span class=\"o\">[</span><span class=\"n\">he</span><span class=\"o\">]‚ü©‚ü©</span>\n\n<span class=\"kd\">lemma</span> <span class=\"n\">conj_comp'</span> <span class=\"o\">{</span><span class=\"n\">a</span> <span class=\"n\">b</span> <span class=\"n\">c</span> <span class=\"n\">d</span> <span class=\"n\">e</span> <span class=\"o\">:</span> <span class=\"n\">C</span><span class=\"o\">}</span> <span class=\"o\">(</span><span class=\"n\">f</span> <span class=\"o\">:</span> <span class=\"n\">a</span> <span class=\"bp\">‚ü∂</span> <span class=\"n\">b</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">g</span> <span class=\"o\">:</span> <span class=\"n\">c</span> <span class=\"bp\">‚ü∂</span> <span class=\"n\">d</span><span class=\"o\">)</span> <span class=\"o\">{</span><span class=\"n\">h</span> <span class=\"o\">:</span> <span class=\"n\">e</span> <span class=\"bp\">‚ü∂</span> <span class=\"n\">c</span><span class=\"o\">}</span> <span class=\"o\">(</span><span class=\"n\">hS</span> <span class=\"o\">:</span> <span class=\"n\">h</span> <span class=\"bp\">‚àà</span> <span class=\"n\">S.arrws</span> <span class=\"n\">e</span> <span class=\"n\">c</span><span class=\"o\">)</span> <span class=\"o\">:</span>\n  <span class=\"n\">S.conj</span> <span class=\"n\">f</span> <span class=\"o\">(</span><span class=\"n\">h</span> <span class=\"bp\">‚â´</span> <span class=\"n\">g</span><span class=\"o\">)</span> <span class=\"bp\">‚Üî</span> <span class=\"n\">S.conj</span> <span class=\"n\">f</span> <span class=\"n\">g</span> <span class=\"o\">:=</span>\n<span class=\"o\">‚ü®</span><span class=\"bp\">Œª</span> <span class=\"o\">‚ü®</span><span class=\"n\">Œ±</span><span class=\"o\">,</span> <span class=\"n\">hŒ±</span><span class=\"o\">,</span> <span class=\"n\">Œ≤</span><span class=\"o\">,</span> <span class=\"n\">hŒ≤</span><span class=\"o\">,</span> <span class=\"n\">he</span><span class=\"o\">‚ü©,</span> <span class=\"o\">‚ü®</span><span class=\"n\">Œ±</span> <span class=\"bp\">‚â´</span> <span class=\"n\">h</span><span class=\"o\">,</span> <span class=\"n\">S.mul'</span> <span class=\"n\">hŒ±</span> <span class=\"n\">hS</span><span class=\"o\">,</span> <span class=\"n\">Œ≤</span><span class=\"o\">,</span> <span class=\"n\">hŒ≤</span><span class=\"o\">,</span> <span class=\"kd\">by</span> <span class=\"n\">simp</span> <span class=\"o\">[</span><span class=\"n\">he</span><span class=\"o\">]‚ü©,</span>\n <span class=\"bp\">Œª</span> <span class=\"o\">‚ü®</span><span class=\"n\">Œ±</span><span class=\"o\">,</span> <span class=\"n\">hŒ±</span><span class=\"o\">,</span> <span class=\"n\">Œ≤</span><span class=\"o\">,</span> <span class=\"n\">hŒ≤</span><span class=\"o\">,</span> <span class=\"n\">he</span><span class=\"o\">‚ü©,</span> <span class=\"o\">‚ü®</span><span class=\"n\">Œ±</span> <span class=\"bp\">‚â´</span> <span class=\"n\">inv</span> <span class=\"n\">h</span><span class=\"o\">,</span> <span class=\"n\">S.mul'</span> <span class=\"n\">hŒ±</span> <span class=\"o\">(</span><span class=\"n\">S.inv'</span> <span class=\"n\">hS</span><span class=\"o\">),</span> <span class=\"n\">Œ≤</span><span class=\"o\">,</span> <span class=\"n\">hŒ≤</span><span class=\"o\">,</span> <span class=\"kd\">by</span> <span class=\"n\">simp</span> <span class=\"o\">[</span><span class=\"n\">he</span><span class=\"o\">]‚ü©‚ü©</span>\n\n<span class=\"kd\">@[simp]</span> <span class=\"kd\">lemma</span> <span class=\"n\">inv_inv</span> <span class=\"o\">{</span><span class=\"n\">a</span> <span class=\"n\">b</span> <span class=\"o\">:</span> <span class=\"n\">C</span><span class=\"o\">}</span> <span class=\"o\">(</span><span class=\"n\">f</span> <span class=\"o\">:</span> <span class=\"n\">a</span> <span class=\"bp\">‚ü∂</span> <span class=\"n\">b</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">inv</span> <span class=\"o\">(</span><span class=\"n\">inv</span> <span class=\"n\">f</span><span class=\"o\">)</span> <span class=\"bp\">=</span> <span class=\"n\">f</span> <span class=\"o\">:=</span>\n<span class=\"kd\">by</span> <span class=\"n\">rw</span> <span class=\"o\">[</span><span class=\"bp\">‚Üê</span> <span class=\"n\">category.comp_id</span> <span class=\"o\">(</span><span class=\"n\">inv</span> <span class=\"o\">(</span><span class=\"n\">inv</span> <span class=\"n\">f</span><span class=\"o\">)),</span> <span class=\"bp\">‚Üê</span> <span class=\"n\">inv_comp</span> <span class=\"n\">f</span><span class=\"o\">,</span> <span class=\"n\">inv_comp_assoc</span><span class=\"o\">]</span>\n\n<span class=\"kd\">lemma</span> <span class=\"n\">conj_congr_left</span> <span class=\"o\">{</span><span class=\"n\">a</span> <span class=\"n\">b</span> <span class=\"n\">c</span> <span class=\"n\">d</span> <span class=\"o\">:</span> <span class=\"n\">C</span><span class=\"o\">}</span> <span class=\"o\">(</span><span class=\"n\">f‚ÇÅ</span> <span class=\"o\">:</span> <span class=\"n\">a</span> <span class=\"bp\">‚ü∂</span> <span class=\"n\">c</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">f‚ÇÇ</span> <span class=\"o\">:</span> <span class=\"n\">b</span> <span class=\"bp\">‚ü∂</span> <span class=\"n\">c</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">g</span> <span class=\"o\">:</span> <span class=\"n\">c</span> <span class=\"bp\">‚ü∂</span> <span class=\"n\">d</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">h</span> <span class=\"o\">:</span> <span class=\"n\">S.conj</span> <span class=\"n\">f‚ÇÅ</span> <span class=\"n\">f‚ÇÇ</span><span class=\"o\">)</span> <span class=\"o\">:</span>\n  <span class=\"n\">S.conj</span> <span class=\"o\">(</span><span class=\"n\">f‚ÇÅ</span> <span class=\"bp\">‚â´</span> <span class=\"n\">g</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">f‚ÇÇ</span> <span class=\"bp\">‚â´</span> <span class=\"n\">g</span><span class=\"o\">)</span> <span class=\"o\">:=</span>\n<span class=\"k\">let</span> <span class=\"o\">‚ü®</span><span class=\"n\">Œ±</span><span class=\"o\">,</span> <span class=\"n\">hŒ±</span><span class=\"o\">,</span> <span class=\"n\">Œ≤</span><span class=\"o\">,</span> <span class=\"n\">hŒ≤</span><span class=\"o\">,</span> <span class=\"n\">he</span><span class=\"o\">‚ü©</span> <span class=\"o\">:=</span> <span class=\"n\">h</span> <span class=\"k\">in</span> <span class=\"o\">‚ü®</span><span class=\"n\">Œ±</span><span class=\"o\">,</span> <span class=\"n\">hŒ±</span><span class=\"o\">,</span> <span class=\"n\">_</span><span class=\"o\">,</span> <span class=\"n\">Sn.conj</span> <span class=\"n\">g</span> <span class=\"n\">_</span> <span class=\"n\">hŒ≤</span><span class=\"o\">,</span> <span class=\"kd\">by</span> <span class=\"n\">simp</span> <span class=\"o\">[</span><span class=\"n\">he</span><span class=\"o\">]‚ü©</span>\n\n<span class=\"kd\">lemma</span> <span class=\"n\">conj_congr_right</span> <span class=\"o\">{</span><span class=\"n\">a</span> <span class=\"n\">b</span> <span class=\"n\">c</span> <span class=\"n\">d</span> <span class=\"o\">:</span> <span class=\"n\">C</span><span class=\"o\">}</span> <span class=\"o\">(</span><span class=\"n\">f</span> <span class=\"o\">:</span> <span class=\"n\">a</span> <span class=\"bp\">‚ü∂</span> <span class=\"n\">b</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">g‚ÇÅ</span> <span class=\"o\">:</span> <span class=\"n\">b</span> <span class=\"bp\">‚ü∂</span> <span class=\"n\">c</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">g‚ÇÇ</span> <span class=\"o\">:</span> <span class=\"n\">b</span> <span class=\"bp\">‚ü∂</span> <span class=\"n\">d</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">h</span> <span class=\"o\">:</span> <span class=\"n\">S.conj</span> <span class=\"n\">g‚ÇÅ</span> <span class=\"n\">g‚ÇÇ</span><span class=\"o\">)</span> <span class=\"o\">:</span>\n  <span class=\"n\">S.conj</span> <span class=\"o\">(</span><span class=\"n\">f</span> <span class=\"bp\">‚â´</span> <span class=\"n\">g‚ÇÅ</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">f</span> <span class=\"bp\">‚â´</span> <span class=\"n\">g‚ÇÇ</span><span class=\"o\">)</span> <span class=\"o\">:=</span>\n<span class=\"k\">let</span> <span class=\"o\">‚ü®</span><span class=\"n\">Œ±</span><span class=\"o\">,</span> <span class=\"n\">hŒ±</span><span class=\"o\">,</span> <span class=\"n\">Œ≤</span><span class=\"o\">,</span> <span class=\"n\">hŒ≤</span><span class=\"o\">,</span> <span class=\"n\">he</span><span class=\"o\">‚ü©</span> <span class=\"o\">:=</span> <span class=\"n\">h</span> <span class=\"k\">in</span> <span class=\"o\">‚ü®</span><span class=\"n\">_</span><span class=\"o\">,</span> <span class=\"n\">Sn.conj</span> <span class=\"o\">(</span><span class=\"n\">groupoid.inv</span> <span class=\"n\">f</span><span class=\"o\">)</span> <span class=\"n\">_</span> <span class=\"n\">hŒ±</span><span class=\"o\">,</span> <span class=\"n\">Œ≤</span><span class=\"o\">,</span> <span class=\"n\">hŒ≤</span><span class=\"o\">,</span> <span class=\"kd\">by</span> <span class=\"n\">simp</span> <span class=\"o\">[</span><span class=\"n\">he</span><span class=\"o\">]‚ü©</span>\n\n<span class=\"kd\">@[instance]</span>\n<span class=\"kd\">def</span> <span class=\"n\">quotient_quiver</span> <span class=\"o\">:</span> <span class=\"n\">quiver</span> <span class=\"o\">(</span><span class=\"n\">quot_v</span> <span class=\"n\">S</span> <span class=\"n\">Sn</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"o\">‚ü®</span><span class=\"bp\">Œª</span> <span class=\"n\">a</span> <span class=\"n\">b</span><span class=\"o\">,</span> <span class=\"n\">quotient</span> <span class=\"o\">(</span><span class=\"n\">conj_setoid</span> <span class=\"n\">S</span> <span class=\"n\">Sn</span> <span class=\"n\">a</span> <span class=\"n\">b</span><span class=\"o\">)‚ü©</span>\n\n<span class=\"kd\">noncomputable</span> <span class=\"kd\">def</span> <span class=\"n\">quot_comp</span> <span class=\"o\">{</span><span class=\"n\">c</span> <span class=\"n\">d</span> <span class=\"n\">e</span> <span class=\"o\">:</span> <span class=\"n\">quot_v</span> <span class=\"n\">S</span> <span class=\"n\">Sn</span><span class=\"o\">}</span> <span class=\"o\">:</span> <span class=\"o\">(</span><span class=\"n\">c</span> <span class=\"bp\">‚ü∂</span> <span class=\"n\">d</span><span class=\"o\">)</span> <span class=\"bp\">‚Üí</span> <span class=\"o\">(</span><span class=\"n\">d</span> <span class=\"bp\">‚ü∂</span> <span class=\"n\">e</span><span class=\"o\">)</span> <span class=\"bp\">‚Üí</span> <span class=\"o\">(</span><span class=\"n\">c</span> <span class=\"bp\">‚ü∂</span> <span class=\"n\">e</span><span class=\"o\">)</span> <span class=\"o\">:=</span>\n<span class=\"kd\">begin</span>\n  <span class=\"k\">let</span> <span class=\"n\">sm</span> <span class=\"o\">:=</span> <span class=\"bp\">@</span><span class=\"n\">nonempty.some_mem</span><span class=\"o\">,</span>\n  <span class=\"n\">refine</span> <span class=\"n\">quot.lift‚ÇÇ</span> <span class=\"o\">(</span><span class=\"bp\">Œª</span> <span class=\"n\">f</span> <span class=\"n\">g</span><span class=\"o\">,</span> <span class=\"n\">quot.mk</span> <span class=\"n\">_</span> <span class=\"n\">_</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"bp\">Œª</span> <span class=\"n\">f</span> <span class=\"n\">g‚ÇÅ</span> <span class=\"n\">g‚ÇÇ</span> <span class=\"n\">h</span><span class=\"o\">,</span> <span class=\"n\">_</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"bp\">Œª</span> <span class=\"n\">f‚ÇÅ</span> <span class=\"n\">f‚ÇÇ</span> <span class=\"n\">g</span> <span class=\"n\">h</span><span class=\"o\">,</span> <span class=\"n\">_</span><span class=\"o\">),</span>\n  <span class=\"o\">{</span> <span class=\"n\">letI</span> <span class=\"o\">:=</span> <span class=\"n\">Sn.arrws_nonempty_setoid</span><span class=\"o\">,</span>\n    <span class=\"n\">exact</span> <span class=\"o\">‚ü®</span><span class=\"n\">_</span><span class=\"o\">,</span> <span class=\"n\">_</span><span class=\"o\">,</span> <span class=\"n\">f.2.2</span> <span class=\"bp\">‚â´</span> <span class=\"o\">(</span><span class=\"n\">quotient.exact</span> <span class=\"bp\">$</span> <span class=\"n\">f.2.1.2.trans</span> <span class=\"n\">g.1.2.symm</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">some</span> <span class=\"bp\">‚â´</span> <span class=\"n\">g.2.2</span><span class=\"o\">‚ü©</span> <span class=\"o\">},</span>\n  <span class=\"n\">all_goals</span> <span class=\"o\">{</span> <span class=\"n\">apply</span> <span class=\"n\">quot.sound</span><span class=\"o\">,</span> <span class=\"n\">dsimp</span> <span class=\"n\">only</span> <span class=\"o\">[</span><span class=\"n\">conj_setoid</span><span class=\"o\">]</span> <span class=\"o\">},</span>\n  <span class=\"o\">{</span> <span class=\"n\">apply</span> <span class=\"n\">S.conj_congr_right</span> <span class=\"n\">Sn</span><span class=\"o\">,</span>\n    <span class=\"n\">rw</span> <span class=\"o\">[</span><span class=\"n\">S.conj_comp'</span> <span class=\"n\">_</span> <span class=\"n\">_</span> <span class=\"o\">(</span><span class=\"n\">sm</span> <span class=\"n\">_</span><span class=\"o\">),</span> <span class=\"n\">conj_comm</span><span class=\"o\">,</span> <span class=\"n\">S.conj_comp'</span> <span class=\"n\">_</span> <span class=\"n\">_</span> <span class=\"o\">(</span><span class=\"n\">sm</span> <span class=\"n\">_</span><span class=\"o\">),</span> <span class=\"n\">conj_comm</span><span class=\"o\">],</span>\n    <span class=\"n\">exact</span> <span class=\"n\">h</span> <span class=\"o\">},</span>\n  <span class=\"o\">{</span> <span class=\"n\">simp</span> <span class=\"n\">only</span> <span class=\"o\">[</span><span class=\"bp\">‚Üê</span> <span class=\"n\">category.assoc</span><span class=\"o\">],</span>\n    <span class=\"n\">apply</span> <span class=\"n\">S.conj_congr_left</span> <span class=\"n\">Sn</span><span class=\"o\">,</span>\n    <span class=\"n\">rw</span> <span class=\"o\">[</span><span class=\"n\">S.conj_comp</span> <span class=\"n\">_</span> <span class=\"n\">_</span> <span class=\"o\">(</span><span class=\"n\">sm</span> <span class=\"n\">_</span><span class=\"o\">),</span> <span class=\"n\">conj_comm</span><span class=\"o\">,</span> <span class=\"n\">S.conj_comp</span> <span class=\"n\">_</span> <span class=\"n\">_</span> <span class=\"o\">(</span><span class=\"n\">sm</span> <span class=\"n\">_</span><span class=\"o\">),</span> <span class=\"n\">conj_comm</span><span class=\"o\">],</span>\n    <span class=\"n\">exact</span> <span class=\"n\">h</span> <span class=\"o\">},</span>\n<span class=\"kd\">end</span>\n</code></pre></div>",
        "id": 300603525,
        "sender_full_name": "Junyan Xu",
        "timestamp": 1664076135
    },
    {
        "content": "<p>Oh I see you actually added four lemmas about groupoids in <a href=\"https://github.com/leanprover-community/mathlib/pull/16611/files#diff-0e224c1fd025af007b7ac0995e9e6e48e7993722ae69b3a64a3029adacc82df2\">the free groupoid PR</a>. I think the best thing to do is to first show that groupoid.inv = <a href=\"https://leanprover-community.github.io/mathlib_docs/find/category_theory.inv\">docs#category_theory.inv</a>, and use the latter everywhere (we already has the is_iso instance), to avoid duplicating the API (<a href=\"https://leanprover-community.github.io/mathlib_docs/find/category_theory.is_iso.inv_comp\">docs#category_theory.is_iso.inv_comp</a> etc. already exist). So we should probably <code>open category_theory</code> but not <code>open groupoid</code> (or hide <code>groupoid.inv</code>) to be able to simply write <code>inv</code>.</p>",
        "id": 300605245,
        "sender_full_name": "Junyan Xu",
        "timestamp": 1664078230
    },
    {
        "content": "<p>see PR <a href=\"https://github.com/leanprover-community/mathlib/pull/16624\">#16624</a></p>",
        "id": 300610338,
        "sender_full_name": "Junyan Xu",
        "timestamp": 1664084842
    },
    {
        "content": "<p>Thanks a lot! Looking forward to see what I¬†was misunderstanding exactly.</p>",
        "id": 300610797,
        "sender_full_name": "R√©mi Bottinelli",
        "timestamp": 1664085311
    },
    {
        "content": "<p>I think I'm being stupid, but actually, following your approach to the quotient, I feel like now defining <code>id</code> becomes problematic. How would you do it?</p>",
        "id": 301017493,
        "sender_full_name": "R√©mi Bottinelli",
        "timestamp": 1664288791
    },
    {
        "content": "<p>The easy way is to use choice:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kd\">noncomputable</span> <span class=\"kd\">def</span> <span class=\"n\">quot_id</span> <span class=\"o\">(</span><span class=\"n\">c</span> <span class=\"o\">:</span> <span class=\"n\">quot_v</span> <span class=\"n\">S</span> <span class=\"n\">Sn</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">c</span> <span class=\"bp\">‚ü∂</span> <span class=\"n\">c</span> <span class=\"o\">:=</span>\n<span class=\"n\">quot.mk</span> <span class=\"n\">_</span> <span class=\"o\">‚ü®‚ü®</span><span class=\"n\">_</span><span class=\"o\">,</span> <span class=\"n\">quot.out_eq</span> <span class=\"n\">c</span><span class=\"o\">‚ü©,</span> <span class=\"o\">‚ü®</span><span class=\"n\">_</span><span class=\"o\">,</span> <span class=\"n\">quot.out_eq</span> <span class=\"n\">c</span><span class=\"o\">‚ü©,</span> <span class=\"mi\">ùüô</span> <span class=\"n\">_</span><span class=\"o\">‚ü©</span>\n</code></pre></div>\n<p>or you could also do it computably (albeit more complicated, and I have to adjust the sigma type to a subtype in order to use <a href=\"https://leanprover-community.github.io/mathlib_docs/find/subtype_quotient_equiv_quotient_subtype\">docs#subtype_quotient_equiv_quotient_subtype</a>):</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kd\">def</span> <span class=\"n\">sigma_conj_setoid</span> <span class=\"o\">(</span><span class=\"n\">a</span> <span class=\"n\">b</span> <span class=\"o\">:</span> <span class=\"n\">quot_v</span> <span class=\"n\">S</span> <span class=\"n\">Sn</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">setoid</span> <span class=\"o\">(</span><span class=\"bp\">Œ£</span> <span class=\"n\">c</span> <span class=\"n\">d</span> <span class=\"o\">:</span> <span class=\"n\">C</span><span class=\"o\">,</span> <span class=\"n\">c</span> <span class=\"bp\">‚ü∂</span> <span class=\"n\">d</span><span class=\"o\">)</span> <span class=\"o\">:=</span>\n<span class=\"o\">{</span> <span class=\"n\">r</span> <span class=\"o\">:=</span> <span class=\"bp\">Œª</span> <span class=\"n\">f</span> <span class=\"n\">g</span><span class=\"o\">,</span> <span class=\"n\">S.conj</span> <span class=\"n\">f.2.2</span> <span class=\"n\">g.2.2</span><span class=\"o\">,</span>\n  <span class=\"n\">iseqv</span> <span class=\"o\">:=</span> <span class=\"o\">‚ü®</span><span class=\"bp\">Œª</span> <span class=\"n\">_</span><span class=\"o\">,</span> <span class=\"n\">conj.refl</span> <span class=\"n\">_</span> <span class=\"n\">Sn</span> <span class=\"n\">_</span><span class=\"o\">,</span> <span class=\"bp\">Œª</span> <span class=\"n\">_</span> <span class=\"n\">_</span><span class=\"o\">,</span> <span class=\"n\">conj.symm</span> <span class=\"n\">_</span> <span class=\"n\">_</span> <span class=\"n\">_</span><span class=\"o\">,</span> <span class=\"bp\">Œª</span> <span class=\"n\">_</span> <span class=\"n\">_</span> <span class=\"n\">_</span><span class=\"o\">,</span> <span class=\"n\">conj.trans</span> <span class=\"n\">_</span> <span class=\"n\">_</span> <span class=\"n\">_</span> <span class=\"n\">_</span><span class=\"o\">‚ü©</span> <span class=\"o\">}</span>\n\n<span class=\"kd\">def</span> <span class=\"n\">conj_setoid'</span> <span class=\"o\">(</span><span class=\"n\">a</span> <span class=\"n\">b</span> <span class=\"o\">:</span> <span class=\"n\">quot_v</span> <span class=\"n\">S</span> <span class=\"n\">Sn</span><span class=\"o\">)</span> <span class=\"o\">:</span>\n  <span class=\"n\">setoid</span> <span class=\"o\">{</span><span class=\"n\">f</span> <span class=\"o\">:</span> <span class=\"bp\">Œ£</span> <span class=\"n\">c</span> <span class=\"n\">d</span> <span class=\"o\">:</span> <span class=\"n\">C</span><span class=\"o\">,</span> <span class=\"n\">c</span> <span class=\"bp\">‚ü∂</span> <span class=\"n\">d</span> <span class=\"bp\">//</span> <span class=\"n\">quot.mk</span> <span class=\"n\">_</span> <span class=\"n\">f.1</span> <span class=\"bp\">=</span> <span class=\"n\">a</span> <span class=\"bp\">‚àß</span> <span class=\"n\">quot.mk</span> <span class=\"n\">_</span> <span class=\"n\">f.2.1</span> <span class=\"bp\">=</span> <span class=\"n\">b</span><span class=\"o\">}</span> <span class=\"o\">:=</span>\n<span class=\"o\">{</span> <span class=\"n\">r</span> <span class=\"o\">:=</span> <span class=\"bp\">Œª</span> <span class=\"n\">f</span> <span class=\"n\">g</span><span class=\"o\">,</span> <span class=\"n\">S.conj</span> <span class=\"n\">f.1.2.2</span> <span class=\"n\">g.1.2.2</span><span class=\"o\">,</span>\n  <span class=\"n\">iseqv</span> <span class=\"o\">:=</span> <span class=\"o\">‚ü®</span><span class=\"bp\">Œª</span> <span class=\"n\">_</span><span class=\"o\">,</span> <span class=\"n\">conj.refl</span> <span class=\"n\">_</span> <span class=\"n\">Sn</span> <span class=\"n\">_</span><span class=\"o\">,</span> <span class=\"bp\">Œª</span> <span class=\"n\">_</span> <span class=\"n\">_</span><span class=\"o\">,</span> <span class=\"n\">conj.symm</span> <span class=\"n\">_</span> <span class=\"n\">_</span> <span class=\"n\">_</span><span class=\"o\">,</span> <span class=\"bp\">Œª</span> <span class=\"n\">_</span> <span class=\"n\">_</span> <span class=\"n\">_</span><span class=\"o\">,</span> <span class=\"n\">conj.trans</span> <span class=\"n\">_</span> <span class=\"n\">_</span> <span class=\"n\">_</span> <span class=\"n\">_</span><span class=\"o\">‚ü©</span> <span class=\"o\">}</span>\n<span class=\"c1\">-- setoid.comap coe (sigma_conj_setoid S Sn a b) -- need import data.setoid.basic</span>\n\n<span class=\"kd\">@[instance]</span>\n<span class=\"kd\">def</span> <span class=\"n\">quotient_quiver</span> <span class=\"o\">:</span> <span class=\"n\">quiver</span> <span class=\"o\">(</span><span class=\"n\">quot_v</span> <span class=\"n\">S</span> <span class=\"n\">Sn</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"o\">‚ü®</span><span class=\"bp\">Œª</span> <span class=\"n\">a</span> <span class=\"n\">b</span><span class=\"o\">,</span> <span class=\"n\">quotient</span> <span class=\"o\">(</span><span class=\"n\">conj_setoid'</span> <span class=\"n\">S</span> <span class=\"n\">Sn</span> <span class=\"n\">a</span> <span class=\"n\">b</span><span class=\"o\">)‚ü©</span>\n\n<span class=\"kd\">def</span> <span class=\"n\">quot_id</span> <span class=\"o\">(</span><span class=\"n\">c</span> <span class=\"o\">:</span> <span class=\"n\">quot_v</span> <span class=\"n\">S</span> <span class=\"n\">Sn</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">c</span> <span class=\"bp\">‚ü∂</span> <span class=\"n\">c</span> <span class=\"o\">:=</span>\n<span class=\"kd\">begin</span>\n  <span class=\"n\">refine</span> <span class=\"bp\">@</span><span class=\"n\">equiv.subtype_quotient_equiv_quotient_subtype</span> <span class=\"n\">_</span> <span class=\"n\">_</span> <span class=\"o\">(</span><span class=\"n\">sigma_conj_setoid</span> <span class=\"n\">S</span> <span class=\"n\">Sn</span> <span class=\"n\">c</span> <span class=\"n\">c</span><span class=\"o\">)</span>\n    <span class=\"o\">(</span><span class=\"n\">conj_setoid'</span> <span class=\"n\">S</span> <span class=\"n\">Sn</span> <span class=\"n\">c</span> <span class=\"n\">c</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">quot.lift</span> <span class=\"n\">_</span> <span class=\"bp\">$</span> <span class=\"bp\">Œª</span> <span class=\"n\">f</span> <span class=\"n\">g</span> <span class=\"n\">h</span><span class=\"o\">,</span> <span class=\"n\">_</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"bp\">Œª</span> <span class=\"n\">_</span><span class=\"o\">,</span> <span class=\"n\">iff.rfl</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"bp\">Œª</span> <span class=\"n\">f</span> <span class=\"n\">g</span><span class=\"o\">,</span> <span class=\"n\">iff.rfl</span><span class=\"o\">)</span> <span class=\"n\">_</span><span class=\"o\">,</span>\n  <span class=\"o\">{</span> <span class=\"n\">obtain</span> <span class=\"o\">‚ü®</span><span class=\"n\">a</span><span class=\"o\">,</span> <span class=\"n\">ha</span><span class=\"o\">,</span> <span class=\"n\">b</span><span class=\"o\">,</span> <span class=\"n\">hb</span><span class=\"o\">,</span> <span class=\"bp\">-</span><span class=\"o\">‚ü©</span> <span class=\"o\">:=</span> <span class=\"n\">h</span><span class=\"o\">,</span> <span class=\"n\">congr'</span> <span class=\"mi\">2</span><span class=\"bp\">;</span> <span class=\"n\">apply</span> <span class=\"n\">quot.sound</span><span class=\"o\">,</span> <span class=\"n\">exacts</span> <span class=\"o\">[‚ü®</span><span class=\"n\">a</span><span class=\"o\">,</span> <span class=\"n\">ha</span><span class=\"o\">‚ü©,</span> <span class=\"o\">‚ü®</span><span class=\"n\">_</span><span class=\"o\">,</span> <span class=\"n\">S.inv'</span> <span class=\"n\">hb</span><span class=\"o\">‚ü©]</span> <span class=\"o\">},</span>\n  <span class=\"o\">{</span> <span class=\"n\">refine</span> <span class=\"o\">‚ü®</span><span class=\"n\">quot.lift</span> <span class=\"o\">(</span><span class=\"bp\">Œª</span> <span class=\"n\">c</span><span class=\"o\">,</span> <span class=\"n\">quot.mk</span> <span class=\"n\">_</span> <span class=\"n\">_</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"bp\">Œª</span> <span class=\"n\">d</span> <span class=\"n\">e</span> <span class=\"n\">h</span><span class=\"o\">,</span> <span class=\"n\">_</span><span class=\"o\">)</span> <span class=\"n\">c</span><span class=\"o\">,</span> <span class=\"n\">_</span><span class=\"o\">‚ü©,</span> <span class=\"o\">{</span> <span class=\"n\">exact</span> <span class=\"o\">‚ü®</span><span class=\"n\">c</span><span class=\"o\">,</span> <span class=\"n\">c</span><span class=\"o\">,</span> <span class=\"mi\">ùüô</span> <span class=\"n\">c</span><span class=\"o\">‚ü©</span> <span class=\"o\">},</span>\n    <span class=\"o\">{</span> <span class=\"n\">obtain</span> <span class=\"o\">‚ü®</span><span class=\"n\">a</span><span class=\"o\">,</span> <span class=\"n\">ha</span><span class=\"o\">‚ü©</span> <span class=\"o\">:=</span> <span class=\"n\">h</span><span class=\"o\">,</span> <span class=\"n\">refine</span> <span class=\"n\">quot.sound</span> <span class=\"o\">‚ü®</span><span class=\"n\">a</span><span class=\"o\">,</span> <span class=\"n\">ha</span><span class=\"o\">,</span> <span class=\"n\">_</span><span class=\"o\">,</span> <span class=\"n\">S.inv'</span> <span class=\"n\">ha</span><span class=\"o\">,</span> <span class=\"kd\">by</span> <span class=\"n\">simp</span><span class=\"o\">‚ü©</span> <span class=\"o\">},</span>\n    <span class=\"o\">{</span> <span class=\"n\">rcases</span> <span class=\"n\">c</span><span class=\"o\">,</span> <span class=\"n\">exacts</span> <span class=\"o\">‚ü®</span><span class=\"n\">rfl</span><span class=\"o\">,</span> <span class=\"n\">rfl</span><span class=\"o\">‚ü©</span> <span class=\"o\">}</span> <span class=\"o\">},</span>\n<span class=\"kd\">end</span>\n\n<span class=\"c\">/-</span><span class=\"cm\"> and you get nice defeq: -/</span>\n<span class=\"kd\">lemma</span> <span class=\"n\">quot_id_eq</span> <span class=\"o\">(</span><span class=\"n\">c</span> <span class=\"o\">:</span> <span class=\"n\">C</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">quot_id</span> <span class=\"n\">S</span> <span class=\"n\">Sn</span> <span class=\"o\">(</span><span class=\"n\">quot_v_mk</span> <span class=\"n\">S</span> <span class=\"n\">Sn</span> <span class=\"n\">c</span><span class=\"o\">)</span> <span class=\"bp\">=</span> <span class=\"n\">quot.mk</span> <span class=\"n\">_</span> <span class=\"o\">‚ü®‚ü®</span><span class=\"n\">c</span><span class=\"o\">,</span> <span class=\"n\">c</span><span class=\"o\">,</span> <span class=\"mi\">ùüô</span> <span class=\"n\">c</span><span class=\"o\">‚ü©,</span> <span class=\"n\">rfl</span><span class=\"o\">,</span> <span class=\"n\">rfl</span><span class=\"o\">‚ü©</span> <span class=\"o\">:=</span> <span class=\"n\">rfl</span>\n</code></pre></div>",
        "id": 301083600,
        "sender_full_name": "Junyan Xu",
        "timestamp": 1664302776
    },
    {
        "content": "<p>Sorry I haven't got a chance to look at your new free groupoid PR carefully yet, but I agree with Jo√´l's comment there.</p>",
        "id": 301083853,
        "sender_full_name": "Junyan Xu",
        "timestamp": 1664302868
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"224323\">Junyan Xu</span> <a href=\"#narrow/stream/113489-new-members/topic/Dependent.20map.20on.20quotient.3A.20closing.20the.20.60eq.2Erec.60.20goal.3F/near/301083853\">said</a>:</p>\n<blockquote>\n<p>Sorry I haven't got a chance to look at your new free groupoid PR carefully yet, but I agree with Jo√´l's comment there.</p>\n</blockquote>\n<p>No worry, I'm trying to finish the quotient construction in the meantime. It's at the edge of my lean abilities, so I'm advancing very slowly!</p>",
        "id": 301191503,
        "sender_full_name": "R√©mi Bottinelli",
        "timestamp": 1664357859
    },
    {
        "content": "<p>Actually, I think I found a probably easier way to deal with the quotient: <br>\nIf <code>N</code> is a normal subgroupoid, one should be able to decompose it into <code>V * G</code> where <code>V</code> consists only of the vertex groups of <code>N</code>, and <code>G</code> has at most one arrow per pair of vertices. One can then quotient first by <code>N</code> and then by <code>G</code>:</p>\n<ul>\n<li>Quotienting by <code>N</code> preserves the vertices, so we only need to quotient edges.</li>\n<li>Quotienting then by <code>G</code> preserves arrows: we're just bunching groups together corresponding to squashing vertices.</li>\n</ul>\n<p>So, both definitions should be relatively transparent, and they're actually useful by their own I¬†believe.</p>",
        "id": 301903154,
        "sender_full_name": "R√©mi Bottinelli",
        "timestamp": 1664697394
    }
]