[
    {
        "content": "<p>In <em><a href=\"https://ttic.uchicago.edu/~dreyer/course/papers/barendregt.pdf\">Typed Lambda Calculi</a></em>, the first lemma Henk Barendregt proposes is the following:</p>\n<blockquote>\n<p><strong>Proposition 2.1.6 (Substitution lemma).</strong> Let <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>M</mi><mo separator=\"true\">,</mo><mi>N</mi><mo separator=\"true\">,</mo><mi>L</mi><mo>∈</mo><mi mathvariant=\"normal\">Λ</mi></mrow><annotation encoding=\"application/x-tex\">M, N, L \\in \\Lambda</annotation></semantics></math></span><span aria-hidden=\"true\" class=\"katex-html\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8777699999999999em;vertical-align:-0.19444em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">M</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">N</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathnormal\">L</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">∈</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord\">Λ</span></span></span></span>. Suppose <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>x</mi><mo>≢</mo><mi>y</mi></mrow><annotation encoding=\"application/x-tex\">x \\not\\equiv y</annotation></semantics></math></span><span aria-hidden=\"true\" class=\"katex-html\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8888799999999999em;vertical-align:-0.19444em;\"></span><span class=\"mord mathnormal\">x</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\"><span class=\"mord vbox\"><span class=\"thinbox\"><span class=\"rlap\"><span class=\"strut\" style=\"height:0.8888799999999999em;vertical-align:-0.19444em;\"></span><span class=\"inner\"><span class=\"mrel\"></span></span><span class=\"fix\"></span></span></span></span></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.46375em;vertical-align:0em;\"></span><span class=\"mrel\">≡</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.19444em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span></span></span></span> and <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>x</mi><mo mathvariant=\"normal\">∉</mo><mi>F</mi><mi>V</mi><mo stretchy=\"false\">(</mo><mi>L</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">x \\notin FV(L)</annotation></semantics></math></span><span aria-hidden=\"true\" class=\"katex-html\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">x</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\"><span class=\"mord\"><span class=\"mrel\">∈</span></span><span class=\"mord vbox\"><span class=\"thinbox\"><span class=\"llap\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"inner\"><span class=\"mord\"><span class=\"mord\">/</span><span class=\"mspace\" style=\"margin-right:0.05555555555555555em;\"></span></span></span><span class=\"fix\"></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">F</span><span class=\"mord mathnormal\" style=\"margin-right:0.22222em;\">V</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">L</span><span class=\"mclose\">)</span></span></span></span>. Then</p>\n<p><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>M</mi><mo stretchy=\"false\">[</mo><mi>x</mi><mo>:</mo><mo>=</mo><mi>N</mi><mo stretchy=\"false\">]</mo><mo stretchy=\"false\">[</mo><mi>y</mi><mo>:</mo><mo>=</mo><mi>L</mi><mo stretchy=\"false\">]</mo><mo>=</mo><mi>M</mi><mo stretchy=\"false\">[</mo><mi>y</mi><mo>:</mo><mo>=</mo><mi>L</mi><mo stretchy=\"false\">]</mo><mo stretchy=\"false\">[</mo><mi>x</mi><mo>:</mo><mo>=</mo><mi>N</mi><mo stretchy=\"false\">[</mo><mi>y</mi><mo>:</mo><mo>=</mo><mi>L</mi><mo stretchy=\"false\">]</mo><mo stretchy=\"false\">]</mo></mrow><annotation encoding=\"application/x-tex\">M[x := N][y := L] = M[y := L][x := N[y := L]]</annotation></semantics></math></span><span aria-hidden=\"true\" class=\"katex-html\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">M</span><span class=\"mopen\">[</span><span class=\"mord mathnormal\">x</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">:</span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.36687em;vertical-align:0em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">N</span><span class=\"mclose\">]</span><span class=\"mopen\">[</span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">:</span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.36687em;vertical-align:0em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">L</span><span class=\"mclose\">]</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">M</span><span class=\"mopen\">[</span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">:</span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.36687em;vertical-align:0em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">L</span><span class=\"mclose\">]</span><span class=\"mopen\">[</span><span class=\"mord mathnormal\">x</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">:</span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.36687em;vertical-align:0em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">N</span><span class=\"mopen\">[</span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">:</span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.36687em;vertical-align:0em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">L</span><span class=\"mclose\">]</span><span class=\"mclose\">]</span></span></span></span>.</p>\n<p><strong>Proof.</strong> By induction on the structure of <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>M</mi></mrow><annotation encoding=\"application/x-tex\">M</annotation></semantics></math></span><span aria-hidden=\"true\" class=\"katex-html\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">M</span></span></span></span>. <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"normal\">■</mi></mrow><annotation encoding=\"application/x-tex\">\\blacksquare</annotation></semantics></math></span><span aria-hidden=\"true\" class=\"katex-html\"><span class=\"base\"><span class=\"strut\" style=\"height:0.675em;vertical-align:0em;\"></span><span class=\"mord amsrm\">■</span></span></span></span></p>\n</blockquote>\n<p>A while ago I tried to formalize it in Lean, but it felt like it was taking way too much work to formalize a one-line proof. Well, not only once I've proved something just to find a <em>much</em> shorter proof on here or mathlib. Lean magicians know a simple proof for this proposition?</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kn\">import</span> <span class=\"n\">tactic</span>\n\n<span class=\"kd\">@[derive decidable_eq]</span>\n<span class=\"kd\">inductive</span> <span class=\"n\">term</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span>\n<span class=\"bp\">|</span> <span class=\"n\">app</span> <span class=\"o\">(</span><span class=\"n\">M</span> <span class=\"n\">N</span> <span class=\"o\">:</span> <span class=\"n\">term</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">term</span>\n<span class=\"bp\">|</span> <span class=\"n\">lam</span> <span class=\"o\">(</span><span class=\"n\">M</span> <span class=\"o\">:</span> <span class=\"n\">term</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">term</span>\n<span class=\"bp\">|</span> <span class=\"n\">var</span> <span class=\"o\">(</span><span class=\"n\">x</span> <span class=\"o\">:</span> <span class=\"n\">ℕ</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">term</span>\n\n<span class=\"kn\">open</span> <span class=\"n\">term</span>\n\n<span class=\"kd\">@[simp]</span> <span class=\"kd\">def</span> <span class=\"n\">FV</span> <span class=\"o\">:</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">set</span> <span class=\"n\">ℕ</span>\n<span class=\"bp\">|</span> <span class=\"o\">(</span><span class=\"n\">app</span> <span class=\"n\">M</span> <span class=\"n\">N</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"n\">FV</span> <span class=\"n\">M</span> <span class=\"bp\">∪</span> <span class=\"n\">FV</span> <span class=\"n\">N</span>\n<span class=\"bp\">|</span> <span class=\"o\">(</span><span class=\"n\">lam</span> <span class=\"n\">M</span><span class=\"o\">)</span>   <span class=\"o\">:=</span> <span class=\"o\">{</span><span class=\"n\">x</span> <span class=\"bp\">|</span> <span class=\"n\">x</span> <span class=\"bp\">+</span> <span class=\"mi\">1</span> <span class=\"bp\">∈</span> <span class=\"n\">FV</span> <span class=\"n\">M</span><span class=\"o\">}</span>\n<span class=\"bp\">|</span> <span class=\"o\">(</span><span class=\"n\">var</span> <span class=\"n\">x</span><span class=\"o\">)</span>   <span class=\"o\">:=</span> <span class=\"o\">{</span><span class=\"n\">x</span><span class=\"o\">}</span>\n\n<span class=\"kd\">instance</span> <span class=\"o\">(</span><span class=\"n\">x</span> <span class=\"o\">:</span> <span class=\"n\">ℕ</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">M</span> <span class=\"o\">:</span> <span class=\"n\">term</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">decidable</span> <span class=\"o\">(</span><span class=\"n\">x</span> <span class=\"bp\">∈</span> <span class=\"n\">FV</span> <span class=\"n\">M</span><span class=\"o\">)</span> <span class=\"o\">:=</span>\n<span class=\"kd\">begin</span>\n  <span class=\"n\">induction</span> <span class=\"n\">M</span> <span class=\"k\">with</span> <span class=\"n\">M</span> <span class=\"n\">N</span> <span class=\"n\">ih₁</span> <span class=\"n\">ih₂</span> <span class=\"n\">M</span> <span class=\"n\">ih</span> <span class=\"n\">y</span> <span class=\"n\">generalizing</span> <span class=\"n\">x</span><span class=\"o\">,</span>\n  <span class=\"o\">{</span> <span class=\"n\">cases</span> <span class=\"n\">ih₁</span> <span class=\"n\">x</span> <span class=\"k\">with</span> <span class=\"n\">ih₁</span> <span class=\"n\">ih₁</span><span class=\"bp\">;</span> <span class=\"n\">cases</span> <span class=\"n\">ih₂</span> <span class=\"n\">x</span> <span class=\"k\">with</span> <span class=\"n\">ih₂</span> <span class=\"n\">ih₂</span><span class=\"o\">,</span>\n    <span class=\"o\">{</span> <span class=\"n\">exact</span> <span class=\"n\">is_false</span> <span class=\"o\">(</span><span class=\"bp\">λ</span> <span class=\"n\">h</span><span class=\"o\">,</span> <span class=\"n\">h.cases_on</span> <span class=\"n\">ih₁</span> <span class=\"n\">ih₂</span><span class=\"o\">)</span> <span class=\"o\">},</span>\n    <span class=\"n\">all_goals</span> <span class=\"o\">{</span> <span class=\"n\">exact</span> <span class=\"n\">is_true</span> <span class=\"o\">(</span><span class=\"kd\">by</span> <span class=\"n\">exact</span> <span class=\"n\">or.inl</span> <span class=\"n\">ih₁</span> <span class=\"bp\">&lt;|&gt;</span> <span class=\"n\">exact</span> <span class=\"n\">or.inr</span> <span class=\"n\">ih₂</span><span class=\"o\">)</span> <span class=\"o\">}</span> <span class=\"o\">},</span>\n  <span class=\"o\">{</span> <span class=\"n\">exact</span> <span class=\"n\">decidable.cases_on</span> <span class=\"o\">(</span><span class=\"n\">ih</span> <span class=\"o\">(</span><span class=\"n\">x</span> <span class=\"bp\">+</span> <span class=\"mi\">1</span><span class=\"o\">))</span> <span class=\"n\">is_false</span> <span class=\"n\">is_true</span> <span class=\"o\">},</span>\n  <span class=\"o\">{</span> <span class=\"n\">exact</span> <span class=\"n\">dite</span> <span class=\"o\">(</span><span class=\"n\">x</span> <span class=\"bp\">=</span> <span class=\"n\">y</span><span class=\"o\">)</span> <span class=\"n\">is_true</span> <span class=\"n\">is_false</span> <span class=\"o\">}</span>\n<span class=\"kd\">end</span>\n\n<span class=\"kd\">@[simp]</span> <span class=\"kd\">def</span> <span class=\"n\">rename_ext</span> <span class=\"o\">(</span><span class=\"n\">ρ</span> <span class=\"o\">:</span> <span class=\"n\">ℕ</span> <span class=\"bp\">→</span> <span class=\"n\">ℕ</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">ℕ</span> <span class=\"bp\">→</span> <span class=\"n\">ℕ</span>\n<span class=\"bp\">|</span> <span class=\"mi\">0</span>       <span class=\"o\">:=</span> <span class=\"mi\">0</span>\n<span class=\"bp\">|</span> <span class=\"o\">(</span><span class=\"n\">x</span> <span class=\"bp\">+</span> <span class=\"mi\">1</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"n\">ρ</span> <span class=\"n\">x</span> <span class=\"bp\">+</span> <span class=\"mi\">1</span>\n\n<span class=\"kd\">@[simp]</span> <span class=\"kd\">def</span> <span class=\"n\">rename</span> <span class=\"o\">:</span> <span class=\"o\">(</span><span class=\"n\">ℕ</span> <span class=\"bp\">→</span> <span class=\"n\">ℕ</span><span class=\"o\">)</span> <span class=\"bp\">→</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">term</span>\n<span class=\"bp\">|</span> <span class=\"n\">ρ</span> <span class=\"o\">(</span><span class=\"n\">app</span> <span class=\"n\">M</span> <span class=\"n\">N</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"n\">app</span> <span class=\"o\">(</span><span class=\"n\">rename</span> <span class=\"n\">ρ</span> <span class=\"n\">M</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">rename</span> <span class=\"n\">ρ</span> <span class=\"n\">N</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"n\">ρ</span> <span class=\"o\">(</span><span class=\"n\">lam</span> <span class=\"n\">M</span><span class=\"o\">)</span>   <span class=\"o\">:=</span> <span class=\"n\">lam</span> <span class=\"o\">(</span><span class=\"n\">rename</span> <span class=\"o\">(</span><span class=\"n\">rename_ext</span> <span class=\"n\">ρ</span><span class=\"o\">)</span> <span class=\"n\">M</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"n\">ρ</span> <span class=\"o\">(</span><span class=\"n\">var</span> <span class=\"n\">x</span><span class=\"o\">)</span>   <span class=\"o\">:=</span> <span class=\"n\">var</span> <span class=\"o\">(</span><span class=\"n\">ρ</span> <span class=\"n\">x</span><span class=\"o\">)</span>\n\n<span class=\"n\">abbreviation</span> <span class=\"n\">shift</span> <span class=\"o\">:=</span> <span class=\"n\">rename</span> <span class=\"n\">nat.succ</span>\n\n<span class=\"kd\">@[simp]</span> <span class=\"kd\">def</span> <span class=\"n\">subst_ext</span> <span class=\"o\">(</span><span class=\"n\">σ</span> <span class=\"o\">:</span> <span class=\"n\">ℕ</span> <span class=\"bp\">→</span> <span class=\"n\">term</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">ℕ</span> <span class=\"bp\">→</span> <span class=\"n\">term</span>\n<span class=\"bp\">|</span> <span class=\"mi\">0</span>       <span class=\"o\">:=</span> <span class=\"n\">var</span> <span class=\"mi\">0</span>\n<span class=\"bp\">|</span> <span class=\"o\">(</span><span class=\"n\">x</span> <span class=\"bp\">+</span> <span class=\"mi\">1</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"n\">shift</span> <span class=\"o\">(</span><span class=\"n\">σ</span> <span class=\"n\">x</span><span class=\"o\">)</span>\n\n<span class=\"kd\">@[simp]</span> <span class=\"kd\">def</span> <span class=\"n\">subst</span> <span class=\"o\">:</span> <span class=\"o\">(</span><span class=\"n\">ℕ</span> <span class=\"bp\">→</span> <span class=\"n\">term</span><span class=\"o\">)</span> <span class=\"bp\">→</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">term</span>\n<span class=\"bp\">|</span> <span class=\"n\">σ</span> <span class=\"o\">(</span><span class=\"n\">app</span> <span class=\"n\">M</span> <span class=\"n\">N</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"n\">app</span> <span class=\"o\">(</span><span class=\"n\">subst</span> <span class=\"n\">σ</span> <span class=\"n\">M</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">subst</span> <span class=\"n\">σ</span> <span class=\"n\">N</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"n\">σ</span> <span class=\"o\">(</span><span class=\"n\">lam</span> <span class=\"n\">M</span><span class=\"o\">)</span>   <span class=\"o\">:=</span> <span class=\"n\">lam</span> <span class=\"o\">(</span><span class=\"n\">subst</span> <span class=\"o\">(</span><span class=\"n\">subst_ext</span> <span class=\"n\">σ</span><span class=\"o\">)</span> <span class=\"n\">M</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"n\">σ</span> <span class=\"o\">(</span><span class=\"n\">var</span> <span class=\"n\">x</span><span class=\"o\">)</span>   <span class=\"o\">:=</span> <span class=\"n\">σ</span> <span class=\"n\">x</span>\n\n<span class=\"n\">abbreviation</span> <span class=\"n\">σ</span> <span class=\"o\">(</span><span class=\"n\">x</span> <span class=\"o\">:</span> <span class=\"n\">ℕ</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">L</span> <span class=\"o\">:</span> <span class=\"n\">term</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">y</span> <span class=\"o\">:</span> <span class=\"n\">ℕ</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">term</span> <span class=\"o\">:=</span>\n<span class=\"k\">if</span> <span class=\"n\">x</span> <span class=\"bp\">=</span> <span class=\"n\">y</span> <span class=\"k\">then</span> <span class=\"n\">L</span> <span class=\"k\">else</span> <span class=\"n\">var</span> <span class=\"n\">y</span>\n\n<span class=\"c1\">-- This changes the precedence of `[`. Let's hope this doesn't become an issue.</span>\n<span class=\"kd\">notation</span> <span class=\"n\">M</span> <span class=\"bp\">`</span><span class=\"o\">[</span><span class=\"bp\">`</span><span class=\"o\">:</span><span class=\"n\">std.prec.max_plus</span> <span class=\"n\">x</span> <span class=\"bp\">`</span> <span class=\"o\">:=</span> <span class=\"bp\">`</span> <span class=\"n\">L</span> <span class=\"bp\">`</span><span class=\"o\">]</span><span class=\"bp\">`</span> <span class=\"o\">:=</span> <span class=\"n\">subst</span> <span class=\"o\">(</span><span class=\"n\">σ</span> <span class=\"n\">x</span> <span class=\"n\">L</span><span class=\"o\">)</span> <span class=\"n\">M</span>\n\n<span class=\"kd\">variables</span> <span class=\"o\">{</span><span class=\"n\">x</span> <span class=\"n\">y</span> <span class=\"o\">:</span> <span class=\"n\">ℕ</span><span class=\"o\">}</span> <span class=\"o\">{</span><span class=\"n\">M</span> <span class=\"n\">N</span> <span class=\"n\">L</span> <span class=\"o\">:</span> <span class=\"n\">term</span><span class=\"o\">}</span>\n\n<span class=\"kd\">example</span> <span class=\"o\">(</span><span class=\"n\">h</span> <span class=\"o\">:</span> <span class=\"n\">x</span> <span class=\"bp\">≠</span> <span class=\"n\">y</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">hx</span> <span class=\"o\">:</span> <span class=\"n\">x</span> <span class=\"bp\">∉</span> <span class=\"n\">FV</span> <span class=\"n\">L</span><span class=\"o\">)</span> <span class=\"o\">:</span>\n  <span class=\"n\">M</span><span class=\"o\">[</span><span class=\"n\">x</span> <span class=\"o\">:=</span> <span class=\"n\">N</span><span class=\"o\">][</span><span class=\"n\">y</span> <span class=\"o\">:=</span> <span class=\"n\">L</span><span class=\"o\">]</span> <span class=\"bp\">=</span> <span class=\"n\">M</span><span class=\"o\">[</span><span class=\"n\">y</span> <span class=\"o\">:=</span> <span class=\"n\">L</span><span class=\"o\">][</span><span class=\"n\">x</span> <span class=\"o\">:=</span> <span class=\"n\">N</span><span class=\"o\">[</span><span class=\"n\">y</span> <span class=\"o\">:=</span> <span class=\"n\">L</span><span class=\"o\">]]</span> <span class=\"o\">:=</span>\n<span class=\"n\">sorry</span>\n</code></pre></div>",
        "id": 211854617,
        "sender_full_name": "Pedro Minicz",
        "timestamp": 1601510283
    },
    {
        "content": "<blockquote>\n<p>it was taking way too much work to formalize a one-line proof.</p>\n</blockquote>\n<p>Ha! Type theory papers are famous for shuffling these \"trivial\" proof obligations under the rug. (Including mine!)</p>",
        "id": 211854750,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1601510406
    },
    {
        "content": "<p>I should point out though that your formalization differs significantly from Barendregt's</p>",
        "id": 211856225,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1601511702
    },
    {
        "content": "<p>Here's a more faithful translation of Barendregt:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"c1\">-- import tactic.localized</span>\n<span class=\"kn\">import</span> <span class=\"n\">tactic</span>\n\n<span class=\"kd\">@[derive decidable_eq]</span>\n<span class=\"kd\">inductive</span> <span class=\"n\">term</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span>\n<span class=\"bp\">|</span> <span class=\"n\">app</span> <span class=\"o\">(</span><span class=\"n\">M</span> <span class=\"n\">N</span> <span class=\"o\">:</span> <span class=\"n\">term</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">term</span>\n<span class=\"bp\">|</span> <span class=\"n\">lam</span> <span class=\"o\">(</span><span class=\"n\">x</span> <span class=\"o\">:</span> <span class=\"n\">ℕ</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">M</span> <span class=\"o\">:</span> <span class=\"n\">term</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">term</span>\n<span class=\"bp\">|</span> <span class=\"n\">var</span> <span class=\"o\">(</span><span class=\"n\">x</span> <span class=\"o\">:</span> <span class=\"n\">ℕ</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">term</span>\n\n<span class=\"kn\">open</span> <span class=\"n\">term</span>\n\n<span class=\"kd\">@[simp]</span> <span class=\"kd\">def</span> <span class=\"n\">FV</span> <span class=\"o\">:</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">finset</span> <span class=\"n\">ℕ</span>\n<span class=\"bp\">|</span> <span class=\"o\">(</span><span class=\"n\">app</span> <span class=\"n\">M</span> <span class=\"n\">N</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"n\">FV</span> <span class=\"n\">M</span> <span class=\"bp\">∪</span> <span class=\"n\">FV</span> <span class=\"n\">N</span>\n<span class=\"bp\">|</span> <span class=\"o\">(</span><span class=\"n\">lam</span> <span class=\"n\">x</span> <span class=\"n\">M</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"n\">FV</span> <span class=\"n\">M</span> <span class=\"bp\">\\</span> <span class=\"o\">{</span><span class=\"n\">x</span><span class=\"o\">}</span>\n<span class=\"bp\">|</span> <span class=\"o\">(</span><span class=\"n\">var</span> <span class=\"n\">x</span><span class=\"o\">)</span>   <span class=\"o\">:=</span> <span class=\"o\">{</span><span class=\"n\">x</span><span class=\"o\">}</span>\n\n<span class=\"kd\">@[simp]</span> <span class=\"kd\">def</span> <span class=\"n\">subst</span> <span class=\"o\">(</span><span class=\"n\">x</span> <span class=\"o\">:</span> <span class=\"n\">ℕ</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">L</span> <span class=\"o\">:</span> <span class=\"n\">term</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">term</span>\n<span class=\"bp\">|</span> <span class=\"o\">(</span><span class=\"n\">app</span> <span class=\"n\">M</span> <span class=\"n\">N</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"n\">app</span> <span class=\"o\">(</span><span class=\"n\">subst</span> <span class=\"n\">M</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">subst</span> <span class=\"n\">N</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"o\">(</span><span class=\"n\">lam</span> <span class=\"n\">y</span> <span class=\"n\">M</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"k\">if</span> <span class=\"n\">x</span> <span class=\"bp\">=</span> <span class=\"n\">y</span> <span class=\"k\">then</span> <span class=\"n\">lam</span> <span class=\"n\">y</span> <span class=\"n\">M</span> <span class=\"k\">else</span> <span class=\"n\">lam</span> <span class=\"n\">y</span> <span class=\"o\">(</span><span class=\"n\">subst</span> <span class=\"n\">M</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"o\">(</span><span class=\"n\">var</span> <span class=\"n\">y</span><span class=\"o\">)</span>   <span class=\"o\">:=</span> <span class=\"k\">if</span> <span class=\"n\">x</span> <span class=\"bp\">=</span> <span class=\"n\">y</span> <span class=\"k\">then</span> <span class=\"n\">L</span> <span class=\"k\">else</span> <span class=\"n\">var</span> <span class=\"n\">y</span>\n\n<span class=\"c1\">-- This changes the precedence of `[`. Let's hope this doesn't become an issue.</span>\n<span class=\"kd\">notation</span> <span class=\"n\">M</span> <span class=\"bp\">`</span><span class=\"o\">[</span><span class=\"bp\">`</span><span class=\"o\">:</span><span class=\"n\">std.prec.max_plus</span> <span class=\"n\">x</span> <span class=\"bp\">`</span> <span class=\"o\">:=</span> <span class=\"bp\">`</span> <span class=\"n\">L</span> <span class=\"bp\">`</span><span class=\"o\">]</span><span class=\"bp\">`</span> <span class=\"o\">:=</span> <span class=\"n\">subst</span> <span class=\"n\">x</span> <span class=\"n\">L</span> <span class=\"n\">M</span>\n\n<span class=\"kd\">variables</span> <span class=\"o\">{</span><span class=\"n\">x</span> <span class=\"n\">y</span> <span class=\"o\">:</span> <span class=\"n\">ℕ</span><span class=\"o\">}</span> <span class=\"o\">{</span><span class=\"n\">M</span> <span class=\"n\">N</span> <span class=\"n\">L</span> <span class=\"o\">:</span> <span class=\"n\">term</span><span class=\"o\">}</span>\n\n<span class=\"kd\">theorem</span> <span class=\"n\">subst_none</span> <span class=\"o\">(</span><span class=\"n\">hx</span> <span class=\"o\">:</span> <span class=\"n\">x</span> <span class=\"bp\">∉</span> <span class=\"n\">FV</span> <span class=\"n\">M</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">M</span><span class=\"o\">[</span><span class=\"n\">x</span> <span class=\"o\">:=</span> <span class=\"n\">L</span><span class=\"o\">]</span> <span class=\"bp\">=</span> <span class=\"n\">M</span> <span class=\"o\">:=</span>\n<span class=\"kd\">begin</span>\n  <span class=\"n\">induction</span> <span class=\"n\">M</span> <span class=\"n\">generalizing</span> <span class=\"n\">hx</span><span class=\"bp\">;</span> <span class=\"n\">simp</span> <span class=\"o\">[</span><span class=\"n\">not_or_distrib</span><span class=\"o\">]</span> <span class=\"n\">at</span> <span class=\"n\">hx</span><span class=\"bp\">;</span> <span class=\"n\">simp</span> <span class=\"bp\">*</span><span class=\"o\">,</span>\n  <span class=\"n\">split_ifs</span><span class=\"bp\">;</span> <span class=\"n\">simp</span><span class=\"o\">,</span> <span class=\"n\">exact</span> <span class=\"n\">M_ih</span> <span class=\"o\">(</span><span class=\"n\">mt</span> <span class=\"n\">hx</span> <span class=\"n\">h</span><span class=\"o\">)</span>\n<span class=\"kd\">end</span>\n\n<span class=\"kd\">example</span> <span class=\"o\">(</span><span class=\"n\">h</span> <span class=\"o\">:</span> <span class=\"n\">x</span> <span class=\"bp\">≠</span> <span class=\"n\">y</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">hx</span> <span class=\"o\">:</span> <span class=\"n\">x</span> <span class=\"bp\">∉</span> <span class=\"n\">FV</span> <span class=\"n\">L</span><span class=\"o\">)</span> <span class=\"o\">:</span>\n  <span class=\"n\">M</span><span class=\"o\">[</span><span class=\"n\">x</span> <span class=\"o\">:=</span> <span class=\"n\">N</span><span class=\"o\">][</span><span class=\"n\">y</span> <span class=\"o\">:=</span> <span class=\"n\">L</span><span class=\"o\">]</span> <span class=\"bp\">=</span> <span class=\"n\">M</span><span class=\"o\">[</span><span class=\"n\">y</span> <span class=\"o\">:=</span> <span class=\"n\">L</span><span class=\"o\">][</span><span class=\"n\">x</span> <span class=\"o\">:=</span> <span class=\"n\">N</span><span class=\"o\">[</span><span class=\"n\">y</span> <span class=\"o\">:=</span> <span class=\"n\">L</span><span class=\"o\">]]</span> <span class=\"o\">:=</span>\n<span class=\"kd\">begin</span>\n  <span class=\"n\">induction</span> <span class=\"n\">M</span><span class=\"bp\">;</span> <span class=\"n\">simp</span> <span class=\"bp\">*</span><span class=\"o\">,</span>\n  <span class=\"o\">{</span> <span class=\"n\">split_ifs</span><span class=\"bp\">;</span> <span class=\"n\">simp</span> <span class=\"bp\">*</span><span class=\"o\">,</span>\n    <span class=\"n\">subst</span> <span class=\"n\">M_x</span><span class=\"o\">,</span> <span class=\"n\">sorry</span> <span class=\"o\">},</span>\n  <span class=\"o\">{</span> <span class=\"n\">split_ifs</span><span class=\"bp\">;</span> <span class=\"n\">simp</span> <span class=\"bp\">*</span><span class=\"o\">,</span>\n    <span class=\"o\">{</span> <span class=\"n\">subst</span> <span class=\"n\">M</span><span class=\"o\">,</span> <span class=\"n\">rw</span> <span class=\"n\">subst_none</span> <span class=\"n\">hx</span><span class=\"o\">,</span> <span class=\"n\">sorry</span> <span class=\"o\">},</span>\n    <span class=\"o\">{</span> <span class=\"n\">subst</span> <span class=\"n\">M</span><span class=\"o\">,</span> <span class=\"n\">rw</span> <span class=\"n\">subst_none</span> <span class=\"n\">hx</span> <span class=\"o\">}</span> <span class=\"o\">}</span>\n<span class=\"kd\">end</span>\n</code></pre></div>\n\n<p>As you can see, the proof is actually a straightforward induction, except for the <code>sorry</code>'s</p>",
        "id": 211858229,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1601513646
    },
    {
        "content": "<p>and the reason I didn't finish the proof is because it's false!</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"k\">#eval</span> <span class=\"c1\">-- ff</span>\n  <span class=\"k\">let</span> <span class=\"n\">x</span> <span class=\"o\">:=</span> <span class=\"mi\">0</span><span class=\"o\">,</span> <span class=\"n\">y</span> <span class=\"o\">:=</span> <span class=\"mi\">1</span><span class=\"o\">,</span> <span class=\"n\">z</span> <span class=\"o\">:=</span> <span class=\"mi\">2</span><span class=\"o\">,</span>\n      <span class=\"n\">L</span> <span class=\"o\">:=</span> <span class=\"n\">var</span> <span class=\"n\">z</span><span class=\"o\">,</span> <span class=\"n\">N</span> <span class=\"o\">:=</span> <span class=\"n\">var</span> <span class=\"n\">y</span><span class=\"o\">,</span> <span class=\"n\">M</span> <span class=\"o\">:=</span> <span class=\"n\">lam</span> <span class=\"n\">y</span> <span class=\"o\">(</span><span class=\"n\">var</span> <span class=\"n\">x</span><span class=\"o\">)</span> <span class=\"k\">in</span>\n  <span class=\"n\">to_bool</span> <span class=\"o\">(</span><span class=\"bp\">∀</span> <span class=\"o\">(</span><span class=\"n\">h</span> <span class=\"o\">:</span> <span class=\"n\">x</span> <span class=\"bp\">≠</span> <span class=\"n\">y</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">hx</span> <span class=\"o\">:</span> <span class=\"n\">x</span> <span class=\"bp\">∉</span> <span class=\"n\">FV</span> <span class=\"n\">L</span><span class=\"o\">),</span>\n    <span class=\"n\">M</span><span class=\"o\">[</span><span class=\"n\">x</span> <span class=\"o\">:=</span> <span class=\"n\">N</span><span class=\"o\">][</span><span class=\"n\">y</span> <span class=\"o\">:=</span> <span class=\"n\">L</span><span class=\"o\">]</span> <span class=\"bp\">=</span> <span class=\"n\">M</span><span class=\"o\">[</span><span class=\"n\">y</span> <span class=\"o\">:=</span> <span class=\"n\">L</span><span class=\"o\">][</span><span class=\"n\">x</span> <span class=\"o\">:=</span> <span class=\"n\">N</span><span class=\"o\">[</span><span class=\"n\">y</span> <span class=\"o\">:=</span> <span class=\"n\">L</span><span class=\"o\">]])</span>\n</code></pre></div>",
        "id": 211858254,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1601513676
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"110026\">@Simon Hudon</span> I was hoping I could use slim_check out of the box for this but it seems like I have to write a testable instance for <code>term</code>. Are there any plans for <code>@[derive testable]</code>?</p>",
        "id": 211858405,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1601513877
    },
    {
        "content": "<p>What you need is an instance of <code>sampleable</code>. I'd like to generate it</p>",
        "id": 211858610,
        "sender_full_name": "Simon Hudon",
        "timestamp": 1601514060
    },
    {
        "content": "<p>I've been considering doing some of what QuickChick does in Coq and creating generators for inductive relations too. It needs some thought</p>",
        "id": 211858700,
        "sender_full_name": "Simon Hudon",
        "timestamp": 1601514127
    },
    {
        "content": "<p>For inductive relations, you can mostly get by using <code>decidable</code></p>",
        "id": 211858961,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1601514445
    },
    {
        "content": "<p>It seems like Barendregt has some line about a \"so-called variable convention\" (his words) that may allow him to get out of this error, but I don't really understand what his intent is</p>",
        "id": 211859078,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1601514570
    },
    {
        "content": "<p>wow it's really called QuickChick <img alt=\":coq:\" class=\"emoji\" src=\"https://zulip-avatars.s3.amazonaws.com/3121/emoji/images/17559.png\" title=\"coq\"></p>",
        "id": 211860741,
        "sender_full_name": "Reid Barton",
        "timestamp": 1601516701
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110049\">Mario Carneiro</span> <a href=\"#narrow/stream/113489-new-members/topic/Substitution.20lemma/near/211858254\">said</a>:</p>\n<blockquote>\n<p>and the reason I didn't finish the proof is because it's false!</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"k\">#eval</span> <span class=\"c1\">-- ff</span>\n  <span class=\"k\">let</span> <span class=\"n\">x</span> <span class=\"o\">:=</span> <span class=\"mi\">0</span><span class=\"o\">,</span> <span class=\"n\">y</span> <span class=\"o\">:=</span> <span class=\"mi\">1</span><span class=\"o\">,</span> <span class=\"n\">z</span> <span class=\"o\">:=</span> <span class=\"mi\">2</span><span class=\"o\">,</span>\n      <span class=\"n\">L</span> <span class=\"o\">:=</span> <span class=\"n\">var</span> <span class=\"n\">z</span><span class=\"o\">,</span> <span class=\"n\">N</span> <span class=\"o\">:=</span> <span class=\"n\">var</span> <span class=\"n\">y</span><span class=\"o\">,</span> <span class=\"n\">M</span> <span class=\"o\">:=</span> <span class=\"n\">lam</span> <span class=\"n\">y</span> <span class=\"o\">(</span><span class=\"n\">var</span> <span class=\"n\">x</span><span class=\"o\">)</span> <span class=\"k\">in</span>\n  <span class=\"n\">to_bool</span> <span class=\"o\">(</span><span class=\"bp\">∀</span> <span class=\"o\">(</span><span class=\"n\">h</span> <span class=\"o\">:</span> <span class=\"n\">x</span> <span class=\"bp\">≠</span> <span class=\"n\">y</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">hx</span> <span class=\"o\">:</span> <span class=\"n\">x</span> <span class=\"bp\">∉</span> <span class=\"n\">FV</span> <span class=\"n\">L</span><span class=\"o\">),</span>\n    <span class=\"n\">M</span><span class=\"o\">[</span><span class=\"n\">x</span> <span class=\"o\">:=</span> <span class=\"n\">N</span><span class=\"o\">][</span><span class=\"n\">y</span> <span class=\"o\">:=</span> <span class=\"n\">L</span><span class=\"o\">]</span> <span class=\"bp\">=</span> <span class=\"n\">M</span><span class=\"o\">[</span><span class=\"n\">y</span> <span class=\"o\">:=</span> <span class=\"n\">L</span><span class=\"o\">][</span><span class=\"n\">x</span> <span class=\"o\">:=</span> <span class=\"n\">N</span><span class=\"o\">[</span><span class=\"n\">y</span> <span class=\"o\">:=</span> <span class=\"n\">L</span><span class=\"o\">]])</span>\n</code></pre></div>\n\n</blockquote>\n<p>Yes, it is false because you have to consider terms up to alpha equivalence.</p>",
        "id": 211862424,
        "sender_full_name": "Pedro Minicz",
        "timestamp": 1601518598
    },
    {
        "content": "<p>That is reason for using De Bruijn indices. But it may have made the proofs harder.</p>",
        "id": 211862440,
        "sender_full_name": "Pedro Minicz",
        "timestamp": 1601518630
    },
    {
        "content": "<p>There doesn't seem to be a straight forward way of defining alpha equivalence. The simplest thing I can think of is <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>M</mi><mo>≡</mo><mi>N</mi></mrow><annotation encoding=\"application/x-tex\">M \\equiv N</annotation></semantics></math></span><span aria-hidden=\"true\" class=\"katex-html\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">M</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≡</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">N</span></span></span></span> if there is a bijective renaming <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>ρ</mi><mo>:</mo><mi mathvariant=\"double-struck\">N</mi><mo>→</mo><mi mathvariant=\"double-struck\">N</mi></mrow><annotation encoding=\"application/x-tex\">\\rho : \\mathbb{N} \\to \\mathbb{N}</annotation></semantics></math></span><span aria-hidden=\"true\" class=\"katex-html\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.19444em;\"></span><span class=\"mord mathnormal\">ρ</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">:</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.68889em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathbb\">N</span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">→</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.68889em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathbb\">N</span></span></span></span></span> such that <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>r</mi><mi>e</mi><mi>n</mi><mi>a</mi><mi>m</mi><mi>e</mi><mtext> </mtext><mi>ρ</mi><mtext> </mtext><mi>M</mi><mo>=</mo><mi>N</mi></mrow><annotation encoding=\"application/x-tex\">rename \\, \\rho \\, M = N</annotation></semantics></math></span><span aria-hidden=\"true\" class=\"katex-html\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8777699999999999em;vertical-align:-0.19444em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"mord mathnormal\">e</span><span class=\"mord mathnormal\">n</span><span class=\"mord mathnormal\">a</span><span class=\"mord mathnormal\">m</span><span class=\"mord mathnormal\">e</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathnormal\">ρ</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">M</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">N</span></span></span></span>.</p>",
        "id": 211862603,
        "sender_full_name": "Pedro Minicz",
        "timestamp": 1601518894
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kd\">@[simp]</span> <span class=\"kd\">def</span> <span class=\"n\">rename</span> <span class=\"o\">(</span><span class=\"n\">ρ</span> <span class=\"o\">:</span> <span class=\"n\">ℕ</span> <span class=\"bp\">→</span> <span class=\"n\">ℕ</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">term</span>\n<span class=\"bp\">|</span> <span class=\"o\">(</span><span class=\"n\">app</span> <span class=\"n\">M</span> <span class=\"n\">N</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"n\">app</span> <span class=\"o\">(</span><span class=\"n\">rename</span> <span class=\"n\">M</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">rename</span> <span class=\"n\">N</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"o\">(</span><span class=\"n\">lam</span> <span class=\"n\">x</span> <span class=\"n\">M</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"n\">lam</span> <span class=\"o\">(</span><span class=\"n\">ρ</span> <span class=\"n\">x</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">rename</span> <span class=\"n\">M</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"o\">(</span><span class=\"n\">var</span> <span class=\"n\">x</span><span class=\"o\">)</span>   <span class=\"o\">:=</span> <span class=\"n\">var</span> <span class=\"o\">(</span><span class=\"n\">ρ</span> <span class=\"n\">x</span><span class=\"o\">)</span>\n\n<span class=\"kd\">@[simp]</span> <span class=\"kd\">def</span> <span class=\"n\">α</span> <span class=\"o\">(</span><span class=\"n\">M</span> <span class=\"n\">N</span> <span class=\"o\">:</span> <span class=\"n\">term</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"kt\">Prop</span> <span class=\"o\">:=</span> <span class=\"bp\">∃</span> <span class=\"n\">ρ</span><span class=\"o\">,</span> <span class=\"n\">function.bijective</span> <span class=\"n\">ρ</span> <span class=\"bp\">∧</span> <span class=\"n\">rename</span> <span class=\"n\">ρ</span> <span class=\"n\">M</span> <span class=\"bp\">=</span> <span class=\"n\">N</span>\n</code></pre></div>\n\n<p>This seems correct. I may to make this relation into a setoid tomorrow if I have time.</p>",
        "id": 211862755,
        "sender_full_name": "Pedro Minicz",
        "timestamp": 1601519096
    },
    {
        "content": "<p>That doesn't actually solve the problem, as there is no guard in the case <code>(lam y P)[x := N] == lam y (P [x := N]), provided x != y</code> that prevents occurences of y in N from being captured. It simply makes the equation fail to hold sometimes</p>",
        "id": 211863206,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1601519633
    },
    {
        "content": "<p>If you want to use de bruijn indices, I would suggest using a book that deals with terms that way, as the proofs of all the basic properties is very different</p>",
        "id": 211863257,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1601519682
    },
    {
        "content": "<p>Here's the way I would suggest setting up de bruijn terms:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kn\">import</span> <span class=\"n\">tactic</span>\n\n<span class=\"kd\">@[derive decidable_eq]</span>\n<span class=\"kd\">inductive</span> <span class=\"n\">term</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span>\n<span class=\"bp\">|</span> <span class=\"n\">app</span> <span class=\"o\">(</span><span class=\"n\">M</span> <span class=\"n\">N</span> <span class=\"o\">:</span> <span class=\"n\">term</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">term</span>\n<span class=\"bp\">|</span> <span class=\"n\">lam</span> <span class=\"o\">(</span><span class=\"n\">M</span> <span class=\"o\">:</span> <span class=\"n\">term</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">term</span>\n<span class=\"bp\">|</span> <span class=\"n\">var</span> <span class=\"o\">(</span><span class=\"n\">x</span> <span class=\"o\">:</span> <span class=\"n\">ℕ</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">term</span>\n\n<span class=\"kn\">open</span> <span class=\"n\">term</span>\n\n<span class=\"kd\">@[simp]</span> <span class=\"kd\">def</span> <span class=\"n\">shiftn</span> <span class=\"o\">:</span> <span class=\"n\">ℕ</span> <span class=\"bp\">→</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">term</span>\n<span class=\"bp\">|</span> <span class=\"n\">k</span> <span class=\"o\">(</span><span class=\"n\">app</span> <span class=\"n\">M</span> <span class=\"n\">N</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"n\">app</span> <span class=\"o\">(</span><span class=\"n\">shiftn</span> <span class=\"n\">k</span> <span class=\"n\">M</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">shiftn</span> <span class=\"n\">k</span> <span class=\"n\">N</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"n\">k</span> <span class=\"o\">(</span><span class=\"n\">lam</span> <span class=\"n\">M</span><span class=\"o\">)</span>   <span class=\"o\">:=</span> <span class=\"n\">lam</span> <span class=\"o\">(</span><span class=\"n\">shiftn</span> <span class=\"o\">(</span><span class=\"n\">k</span><span class=\"bp\">+</span><span class=\"mi\">1</span><span class=\"o\">)</span> <span class=\"n\">M</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"n\">k</span> <span class=\"o\">(</span><span class=\"n\">var</span> <span class=\"n\">x</span><span class=\"o\">)</span>   <span class=\"o\">:=</span> <span class=\"k\">if</span> <span class=\"n\">x</span> <span class=\"bp\">&lt;</span> <span class=\"n\">k</span> <span class=\"k\">then</span> <span class=\"n\">var</span> <span class=\"n\">x</span> <span class=\"k\">else</span> <span class=\"n\">var</span> <span class=\"o\">(</span><span class=\"n\">x</span> <span class=\"bp\">+</span> <span class=\"mi\">1</span><span class=\"o\">)</span>\n\n<span class=\"n\">abbreviation</span> <span class=\"n\">shift</span> <span class=\"o\">:=</span> <span class=\"n\">shiftn</span> <span class=\"mi\">0</span>\n\n<span class=\"kd\">@[simp]</span> <span class=\"kd\">def</span> <span class=\"n\">substn</span> <span class=\"o\">:</span> <span class=\"n\">ℕ</span> <span class=\"bp\">→</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">term</span>\n<span class=\"bp\">|</span> <span class=\"n\">k</span> <span class=\"n\">L</span> <span class=\"o\">(</span><span class=\"n\">app</span> <span class=\"n\">M</span> <span class=\"n\">N</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"n\">app</span> <span class=\"o\">(</span><span class=\"n\">substn</span> <span class=\"n\">k</span> <span class=\"n\">L</span> <span class=\"n\">M</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">substn</span> <span class=\"n\">k</span> <span class=\"n\">L</span> <span class=\"n\">N</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"n\">k</span> <span class=\"n\">L</span> <span class=\"o\">(</span><span class=\"n\">lam</span> <span class=\"n\">M</span><span class=\"o\">)</span>   <span class=\"o\">:=</span> <span class=\"n\">lam</span> <span class=\"o\">(</span><span class=\"n\">substn</span> <span class=\"o\">(</span><span class=\"n\">k</span><span class=\"bp\">+</span><span class=\"mi\">1</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">shift</span> <span class=\"n\">L</span><span class=\"o\">)</span> <span class=\"n\">M</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"n\">k</span> <span class=\"n\">L</span> <span class=\"o\">(</span><span class=\"n\">var</span> <span class=\"n\">x</span><span class=\"o\">)</span>   <span class=\"o\">:=</span> <span class=\"k\">if</span> <span class=\"n\">x</span> <span class=\"bp\">&lt;</span> <span class=\"n\">k</span> <span class=\"k\">then</span> <span class=\"n\">var</span> <span class=\"n\">x</span> <span class=\"k\">else</span> <span class=\"k\">if</span> <span class=\"n\">x</span> <span class=\"bp\">=</span> <span class=\"n\">k</span> <span class=\"k\">then</span> <span class=\"n\">L</span> <span class=\"k\">else</span> <span class=\"n\">var</span> <span class=\"o\">(</span><span class=\"n\">x</span> <span class=\"bp\">-</span> <span class=\"mi\">1</span><span class=\"o\">)</span>\n\n<span class=\"n\">abbreviation</span> <span class=\"n\">subst</span> <span class=\"o\">:=</span> <span class=\"n\">substn</span> <span class=\"mi\">0</span>\n\n<span class=\"kd\">notation</span> <span class=\"n\">M</span> <span class=\"bp\">`</span><span class=\"o\">[</span><span class=\"mi\">0</span><span class=\"bp\">`</span> <span class=\"bp\">`</span> <span class=\"o\">:=</span> <span class=\"bp\">`</span> <span class=\"n\">L</span> <span class=\"bp\">`</span><span class=\"o\">]</span><span class=\"bp\">`</span> <span class=\"o\">:=</span> <span class=\"n\">subst</span> <span class=\"n\">L</span> <span class=\"n\">M</span>\n</code></pre></div>\n\n<p>You can't really state Barendregt's theorem with this version though, as <code>subst</code> has to be used in restricted ways, basically only the operations that are needed to define beta reduction and typing</p>",
        "id": 211863914,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1601520585
    },
    {
        "content": "<p>your definition of alpha equivalence is not correct, as it fails to prove <code>lam x (lam x (var x)) =ₐ lam x (lam y (var y))</code></p>",
        "id": 211864624,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1601521451
    },
    {
        "content": "<p>There is an elegant inductive definition using a context:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kd\">inductive</span> <span class=\"n\">alpha</span> <span class=\"o\">:</span> <span class=\"n\">list</span> <span class=\"o\">(</span><span class=\"n\">ℕ</span> <span class=\"bp\">×</span> <span class=\"n\">ℕ</span><span class=\"o\">)</span> <span class=\"bp\">→</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"n\">term</span> <span class=\"bp\">→</span> <span class=\"kt\">Prop</span>\n<span class=\"bp\">|</span> <span class=\"n\">app</span> <span class=\"o\">{</span><span class=\"bp\">Γ</span> <span class=\"n\">M</span> <span class=\"n\">M'</span> <span class=\"n\">N</span> <span class=\"n\">N'</span><span class=\"o\">}</span> <span class=\"o\">:</span> <span class=\"n\">alpha</span> <span class=\"bp\">Γ</span> <span class=\"n\">M</span> <span class=\"n\">M'</span> <span class=\"bp\">→</span> <span class=\"n\">alpha</span> <span class=\"bp\">Γ</span> <span class=\"n\">N</span> <span class=\"n\">N'</span> <span class=\"bp\">→</span> <span class=\"n\">alpha</span> <span class=\"bp\">Γ</span> <span class=\"o\">(</span><span class=\"n\">app</span> <span class=\"n\">M</span> <span class=\"n\">N</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">app</span> <span class=\"n\">M'</span> <span class=\"n\">N'</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"n\">lam</span> <span class=\"o\">{</span><span class=\"bp\">Γ</span> <span class=\"n\">x</span> <span class=\"n\">x'</span> <span class=\"n\">M</span> <span class=\"n\">M'</span><span class=\"o\">}</span> <span class=\"o\">:</span> <span class=\"n\">alpha</span> <span class=\"o\">((</span><span class=\"n\">x</span><span class=\"o\">,</span> <span class=\"n\">x'</span><span class=\"o\">)</span> <span class=\"o\">::</span> <span class=\"bp\">Γ</span><span class=\"o\">)</span> <span class=\"n\">M</span> <span class=\"n\">M'</span> <span class=\"bp\">→</span> <span class=\"n\">alpha</span> <span class=\"bp\">Γ</span> <span class=\"o\">(</span><span class=\"n\">lam</span> <span class=\"n\">x</span> <span class=\"n\">M</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">lam</span> <span class=\"n\">x'</span> <span class=\"n\">M'</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"n\">var</span> <span class=\"o\">{</span><span class=\"bp\">Γ</span> <span class=\"n\">x</span> <span class=\"n\">x'</span><span class=\"o\">}</span> <span class=\"o\">:</span> <span class=\"o\">(</span><span class=\"n\">x</span><span class=\"o\">,</span> <span class=\"n\">x'</span><span class=\"o\">)</span> <span class=\"bp\">∈</span> <span class=\"bp\">Γ</span> <span class=\"bp\">→</span> <span class=\"n\">alpha</span> <span class=\"bp\">Γ</span> <span class=\"o\">(</span><span class=\"n\">var</span> <span class=\"n\">x</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">var</span> <span class=\"n\">x'</span><span class=\"o\">)</span>\n</code></pre></div>\n\n<p>but unfortunately it also fails in the case of shadowed variables</p>",
        "id": 211864719,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1601521584
    },
    {
        "content": "<p>You can define it by closing the relation <code>lam x (M [x := y]) =ₐ lam y M</code> under the term formers and refl/symm/trans, but this requires a previous definition of substitution (you can get around the BV capture problem here by just not having the result be defined, since it's only one case in the inductive relation)</p>",
        "id": 211864922,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1601521878
    },
    {
        "content": "<p>On the subject of inductive relations <span class=\"user-mention\" data-user-id=\"110049\">@Mario Carneiro</span>, I've been considering creating generators for Lean's <code>expr</code> type and in that situation, generating type correct terms is useful but most terms that you'll generate will not by type correct. I'd like to formalize the Lean typing relation (or a subset thereof) so that we could use <code>slim_check</code> to test tactics in a useful way. Is this something you've thought about?</p>",
        "id": 212179362,
        "sender_full_name": "Simon Hudon",
        "timestamp": 1601742911
    },
    {
        "content": "<p>can't you use <code>type_check</code> if you want to test the result of a tactic?</p>",
        "id": 212181682,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1601746601
    },
    {
        "content": "<p>reimplementing lean in lean would be a huge project and the result wouldn't be particularly fast</p>",
        "id": 212181750,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1601746709
    },
    {
        "content": "<p><code>type_check</code> would be the right thing to do if you want to use type correctness as a guard. What I want to do is a generator that creates type correct expression. I don't want to evaluate a decision procedure about type correctness. I want to use the relation guide the construction of examples</p>",
        "id": 212183216,
        "sender_full_name": "Simon Hudon",
        "timestamp": 1601748665
    }
]