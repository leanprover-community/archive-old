[
    {
        "content": "<p>I'm finding proving simple high school / college results a bit difficult. For the following result about matrix inverses, how could I clean this up further? I've already been able to make a lot of headway with <code>field_simp</code>. Is there some <code>fin_cases</code> which would populate all my <code>let :=</code> hypotheses?</p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"kn\">import</span> <span class=\"n\">data</span><span class=\"bp\">.</span><span class=\"n\">matrix</span><span class=\"bp\">.</span><span class=\"kn\">notation</span>\n<span class=\"kn\">import</span> <span class=\"n\">tactic</span>\n\n<span class=\"kn\">universe</span> <span class=\"n\">u</span>\n<span class=\"kn\">variables</span> <span class=\"o\">{</span><span class=\"n\">R</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span> <span class=\"o\">[</span><span class=\"n\">field</span> <span class=\"n\">R</span><span class=\"o\">]</span>\n<span class=\"kn\">variables</span> <span class=\"o\">{</span><span class=\"n\">n</span> <span class=\"o\">:</span> <span class=\"bp\">ℕ</span><span class=\"o\">}</span>\n\n<span class=\"kn\">variables</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"n\">B</span> <span class=\"o\">:</span> <span class=\"n\">matrix</span> <span class=\"o\">(</span><span class=\"n\">fin</span> <span class=\"n\">n</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">fin</span> <span class=\"n\">n</span><span class=\"o\">)</span> <span class=\"n\">R</span><span class=\"o\">)</span>\n\n<span class=\"bp\">@</span><span class=\"o\">[</span><span class=\"kn\">reducible</span><span class=\"o\">]</span> <span class=\"n\">def</span> <span class=\"n\">mat_invertible</span> <span class=\"o\">:</span> <span class=\"kt\">Prop</span> <span class=\"o\">:=</span> <span class=\"n\">A</span> <span class=\"bp\">*</span> <span class=\"n\">B</span> <span class=\"bp\">=</span> <span class=\"mi\">1</span> <span class=\"bp\">∧</span> <span class=\"n\">B</span> <span class=\"bp\">*</span> <span class=\"n\">A</span> <span class=\"bp\">=</span> <span class=\"mi\">1</span>\n\n<span class=\"kn\">variables</span> <span class=\"o\">{</span><span class=\"n\">α</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span> <span class=\"n\">u</span><span class=\"o\">}</span> <span class=\"o\">[</span><span class=\"n\">semiring</span> <span class=\"n\">α</span><span class=\"o\">]</span>\n<span class=\"kn\">variables</span> <span class=\"o\">{</span><span class=\"n\">m</span> <span class=\"n\">o</span> <span class=\"o\">:</span> <span class=\"bp\">ℕ</span><span class=\"o\">}</span> <span class=\"o\">{</span><span class=\"n\">m&#39;</span> <span class=\"n\">n&#39;</span> <span class=\"n\">o&#39;</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span><span class=\"o\">}</span> <span class=\"o\">[</span><span class=\"n\">fintype</span> <span class=\"n\">m&#39;</span><span class=\"o\">]</span> <span class=\"o\">[</span><span class=\"n\">fintype</span> <span class=\"n\">n&#39;</span><span class=\"o\">]</span>\n\n<span class=\"n\">open_locale</span> <span class=\"n\">matrix</span>\n\n<span class=\"kn\">lemma</span> <span class=\"n\">mul_cons</span> <span class=\"o\">{</span><span class=\"n\">o</span> <span class=\"o\">:</span> <span class=\"bp\">ℕ</span><span class=\"o\">}</span> <span class=\"o\">{</span><span class=\"n\">α</span><span class=\"o\">}</span> <span class=\"o\">[</span><span class=\"n\">comm_semiring</span> <span class=\"n\">α</span><span class=\"o\">]</span>\n  <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"o\">:</span> <span class=\"n\">matrix</span> <span class=\"o\">(</span><span class=\"n\">fin</span> <span class=\"n\">m</span><span class=\"bp\">.</span><span class=\"n\">succ</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">fin</span> <span class=\"n\">n</span><span class=\"bp\">.</span><span class=\"n\">succ</span><span class=\"o\">)</span> <span class=\"n\">α</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">B</span> <span class=\"o\">:</span> <span class=\"n\">matrix</span> <span class=\"o\">(</span><span class=\"n\">fin</span> <span class=\"n\">n</span><span class=\"bp\">.</span><span class=\"n\">succ</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">fin</span> <span class=\"n\">o</span><span class=\"bp\">.</span><span class=\"n\">succ</span><span class=\"o\">)</span> <span class=\"n\">α</span><span class=\"o\">)</span> <span class=\"o\">:</span>\n  <span class=\"n\">A</span> <span class=\"bp\">⬝</span> <span class=\"n\">B</span> <span class=\"bp\">=</span> <span class=\"o\">(</span><span class=\"n\">matrix</span><span class=\"bp\">.</span><span class=\"n\">vec_cons</span> <span class=\"o\">(</span><span class=\"n\">matrix</span><span class=\"bp\">.</span><span class=\"n\">mul_vec</span> <span class=\"n\">A</span> <span class=\"o\">(</span><span class=\"n\">matrix</span><span class=\"bp\">.</span><span class=\"n\">vec_head</span> <span class=\"n\">B</span><span class=\"err\">ᵀ</span><span class=\"o\">))</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"bp\">⬝</span> <span class=\"o\">(</span><span class=\"n\">matrix</span><span class=\"bp\">.</span><span class=\"n\">vec_tail</span> <span class=\"n\">B</span><span class=\"err\">ᵀ</span><span class=\"o\">)</span><span class=\"err\">ᵀ</span><span class=\"o\">)</span><span class=\"err\">ᵀ</span><span class=\"o\">)</span><span class=\"err\">ᵀ</span> <span class=\"o\">:=</span>\n<span class=\"k\">begin</span>\n  <span class=\"n\">ext</span> <span class=\"n\">i</span> <span class=\"n\">j</span><span class=\"o\">,</span>\n  <span class=\"n\">refine</span> <span class=\"n\">fin</span><span class=\"bp\">.</span><span class=\"n\">cases</span> <span class=\"bp\">_</span> <span class=\"bp\">_</span> <span class=\"n\">i</span><span class=\"bp\">;</span>\n  <span class=\"n\">induction</span> <span class=\"n\">j</span> <span class=\"k\">with</span> <span class=\"n\">kj</span> <span class=\"n\">hkj</span><span class=\"bp\">;</span>\n  <span class=\"n\">induction</span> <span class=\"n\">kj</span> <span class=\"k\">with</span> <span class=\"n\">nj</span> <span class=\"n\">hnj</span><span class=\"bp\">;</span>\n  <span class=\"o\">{</span> <span class=\"n\">intros</span><span class=\"o\">,</span> <span class=\"n\">simp</span><span class=\"o\">,</span> <span class=\"n\">refl</span> <span class=\"o\">},</span>\n<span class=\"kn\">end</span>\n\n<span class=\"kn\">example</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"o\">:</span> <span class=\"n\">matrix</span> <span class=\"o\">(</span><span class=\"n\">fin</span> <span class=\"mi\">2</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">fin</span> <span class=\"mi\">2</span><span class=\"o\">)</span> <span class=\"n\">R</span><span class=\"o\">)</span> <span class=\"o\">{</span><span class=\"n\">a</span> <span class=\"n\">b</span> <span class=\"n\">c</span> <span class=\"n\">d</span> <span class=\"o\">:</span> <span class=\"n\">R</span><span class=\"o\">}</span> <span class=\"o\">(</span><span class=\"n\">hA</span> <span class=\"o\">:</span> <span class=\"n\">A</span> <span class=\"bp\">=</span> <span class=\"bp\">!</span><span class=\"o\">[</span><span class=\"bp\">!</span><span class=\"o\">[</span><span class=\"n\">a</span><span class=\"o\">,</span> <span class=\"n\">b</span><span class=\"o\">],</span> <span class=\"bp\">!</span><span class=\"o\">[</span><span class=\"n\">c</span><span class=\"o\">,</span> <span class=\"n\">d</span><span class=\"o\">]])</span> <span class=\"o\">:</span>\n        <span class=\"n\">a</span> <span class=\"bp\">*</span> <span class=\"n\">d</span> <span class=\"bp\">-</span> <span class=\"n\">b</span> <span class=\"bp\">*</span> <span class=\"n\">c</span> <span class=\"bp\">≠</span> <span class=\"mi\">0</span> <span class=\"bp\">↔</span> <span class=\"bp\">∃</span> <span class=\"n\">B</span><span class=\"o\">,</span> <span class=\"n\">mat_invertible</span> <span class=\"n\">A</span> <span class=\"n\">B</span> <span class=\"o\">:=</span>\n<span class=\"k\">begin</span>\n  <span class=\"n\">split</span><span class=\"o\">,</span>\n  <span class=\"o\">{</span> <span class=\"n\">intros</span> <span class=\"n\">h</span><span class=\"o\">,</span>\n    <span class=\"n\">use</span> <span class=\"o\">(</span><span class=\"mi\">1</span> <span class=\"bp\">/</span> <span class=\"o\">(</span><span class=\"n\">a</span> <span class=\"bp\">*</span> <span class=\"n\">d</span> <span class=\"bp\">-</span> <span class=\"n\">b</span> <span class=\"bp\">*</span> <span class=\"n\">c</span><span class=\"o\">))</span> <span class=\"err\">•</span> <span class=\"bp\">!</span><span class=\"o\">[</span><span class=\"bp\">!</span><span class=\"o\">[</span><span class=\"n\">d</span><span class=\"o\">,</span> <span class=\"bp\">-</span><span class=\"n\">b</span><span class=\"o\">],</span> <span class=\"bp\">!</span><span class=\"o\">[</span><span class=\"bp\">-</span><span class=\"n\">c</span><span class=\"o\">,</span> <span class=\"n\">a</span><span class=\"o\">]],</span>\n    <span class=\"n\">split</span><span class=\"bp\">;</span>\n      <span class=\"o\">{</span> <span class=\"n\">ext</span> <span class=\"n\">i</span> <span class=\"n\">j</span><span class=\"o\">,</span>\n        <span class=\"n\">fin_cases</span> <span class=\"n\">i</span><span class=\"bp\">;</span>\n        <span class=\"n\">fin_cases</span> <span class=\"n\">j</span><span class=\"bp\">;</span>\n        <span class=\"n\">field_simp</span> <span class=\"o\">[</span><span class=\"n\">hA</span><span class=\"o\">,</span> <span class=\"n\">h</span><span class=\"o\">]</span><span class=\"bp\">;</span>\n        <span class=\"n\">ring</span> <span class=\"o\">}</span> <span class=\"o\">},</span>\n  <span class=\"o\">{</span> <span class=\"n\">intros</span> <span class=\"n\">h</span> <span class=\"n\">H</span><span class=\"o\">,</span>\n    <span class=\"n\">rcases</span> <span class=\"n\">h</span> <span class=\"k\">with</span> <span class=\"bp\">⟨</span><span class=\"n\">B</span><span class=\"o\">,</span> <span class=\"n\">hAB</span><span class=\"o\">,</span> <span class=\"n\">hBA</span><span class=\"bp\">⟩</span><span class=\"o\">,</span>\n    <span class=\"n\">rw</span> <span class=\"o\">[</span><span class=\"bp\">&lt;-</span><span class=\"n\">matrix</span><span class=\"bp\">.</span><span class=\"n\">ext_iff</span><span class=\"o\">,</span> <span class=\"n\">hA</span><span class=\"o\">,</span> <span class=\"n\">matrix</span><span class=\"bp\">.</span><span class=\"n\">mul_eq_mul</span><span class=\"o\">]</span> <span class=\"n\">at</span> <span class=\"n\">hAB</span> <span class=\"n\">hBA</span><span class=\"o\">,</span>\n    <span class=\"n\">simp</span> <span class=\"o\">[</span><span class=\"n\">mul_cons</span><span class=\"o\">,</span> <span class=\"n\">matrix</span><span class=\"bp\">.</span><span class=\"n\">vec_head</span><span class=\"o\">,</span> <span class=\"n\">matrix</span><span class=\"bp\">.</span><span class=\"n\">vec_tail</span><span class=\"o\">]</span> <span class=\"n\">at</span> <span class=\"n\">hAB</span> <span class=\"n\">hBA</span><span class=\"o\">,</span>\n    <span class=\"k\">let</span> <span class=\"n\">hAB&#39;</span> <span class=\"o\">:=</span> <span class=\"n\">hAB</span> <span class=\"mi\">0</span> <span class=\"mi\">0</span><span class=\"o\">,</span>\n    <span class=\"k\">let</span> <span class=\"n\">hAB&#39;&#39;&#39;&#39;</span> <span class=\"o\">:=</span> <span class=\"n\">hAB</span> <span class=\"mi\">0</span> <span class=\"mi\">1</span><span class=\"o\">,</span>\n    <span class=\"k\">let</span> <span class=\"n\">hAB&#39;&#39;&#39;</span> <span class=\"o\">:=</span> <span class=\"n\">hAB</span> <span class=\"mi\">1</span> <span class=\"mi\">0</span><span class=\"o\">,</span>\n    <span class=\"k\">let</span> <span class=\"n\">hAB&#39;&#39;</span> <span class=\"o\">:=</span> <span class=\"n\">hAB</span> <span class=\"mi\">1</span> <span class=\"mi\">1</span><span class=\"o\">,</span>\n    <span class=\"k\">let</span> <span class=\"n\">hBA&#39;</span> <span class=\"o\">:=</span> <span class=\"n\">hBA</span> <span class=\"mi\">0</span> <span class=\"mi\">0</span><span class=\"o\">,</span>\n    <span class=\"k\">let</span> <span class=\"n\">hBA&#39;&#39;&#39;&#39;</span> <span class=\"o\">:=</span> <span class=\"n\">hBA</span> <span class=\"mi\">0</span> <span class=\"mi\">1</span><span class=\"o\">,</span>\n    <span class=\"k\">let</span> <span class=\"n\">hBA&#39;&#39;&#39;</span> <span class=\"o\">:=</span> <span class=\"n\">hBA</span> <span class=\"mi\">1</span> <span class=\"mi\">0</span><span class=\"o\">,</span>\n    <span class=\"k\">let</span> <span class=\"n\">hBA&#39;&#39;</span> <span class=\"o\">:=</span> <span class=\"n\">hBA</span> <span class=\"mi\">1</span> <span class=\"mi\">1</span><span class=\"o\">,</span>\n    <span class=\"k\">have</span> <span class=\"n\">finne</span> <span class=\"o\">:</span> <span class=\"o\">((</span><span class=\"mi\">0</span> <span class=\"o\">:</span> <span class=\"n\">fin</span> <span class=\"mi\">2</span><span class=\"o\">)</span> <span class=\"bp\">≠</span> <span class=\"mi\">1</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"n\">fin</span><span class=\"bp\">.</span><span class=\"n\">ne_of_vne</span> <span class=\"n\">zero_ne_one</span><span class=\"o\">,</span>\n    <span class=\"n\">simp</span> <span class=\"o\">[</span><span class=\"n\">finne</span><span class=\"o\">]</span> <span class=\"n\">at</span> <span class=\"n\">hAB&#39;</span> <span class=\"n\">hAB&#39;&#39;</span> <span class=\"n\">hAB&#39;&#39;&#39;</span> <span class=\"n\">hAB&#39;&#39;&#39;&#39;</span> <span class=\"n\">hBA&#39;</span> <span class=\"n\">hBA&#39;&#39;</span> <span class=\"n\">hBA&#39;&#39;&#39;</span> <span class=\"n\">hBA&#39;&#39;&#39;&#39;</span><span class=\"o\">,</span>\n    <span class=\"n\">classical</span><span class=\"o\">,</span>\n    <span class=\"n\">by_cases</span> <span class=\"n\">ha</span> <span class=\"o\">:</span> <span class=\"n\">a</span> <span class=\"bp\">=</span> <span class=\"mi\">0</span><span class=\"bp\">;</span>\n    <span class=\"n\">by_cases</span> <span class=\"n\">hb</span> <span class=\"o\">:</span> <span class=\"n\">b</span> <span class=\"bp\">=</span> <span class=\"mi\">0</span><span class=\"bp\">;</span>\n    <span class=\"n\">by_cases</span> <span class=\"n\">hc</span> <span class=\"o\">:</span> <span class=\"n\">c</span> <span class=\"bp\">=</span> <span class=\"mi\">0</span><span class=\"bp\">;</span>\n    <span class=\"n\">by_cases</span> <span class=\"n\">hd</span> <span class=\"o\">:</span> <span class=\"n\">d</span> <span class=\"bp\">=</span> <span class=\"mi\">0</span><span class=\"o\">,</span>\n    <span class=\"c1\">-- at least one element of A is zero</span>\n    <span class=\"n\">any_goals</span>\n      <span class=\"o\">{</span> <span class=\"n\">simp</span> <span class=\"o\">[</span><span class=\"n\">ha</span><span class=\"o\">,</span> <span class=\"n\">hb</span><span class=\"o\">,</span> <span class=\"n\">hc</span><span class=\"o\">,</span> <span class=\"n\">hd</span><span class=\"o\">,</span> <span class=\"n\">mul_zero</span><span class=\"o\">,</span> <span class=\"n\">sub_zero</span><span class=\"o\">,</span> <span class=\"n\">mul_eq_zero</span><span class=\"o\">]</span> <span class=\"n\">at</span> <span class=\"n\">H</span><span class=\"o\">,</span>\n        <span class=\"n\">cases</span> <span class=\"n\">H</span><span class=\"bp\">;</span>\n        <span class=\"n\">simp</span> <span class=\"bp\">*</span> <span class=\"n\">at</span> <span class=\"bp\">*</span> <span class=\"o\">},</span>\n    <span class=\"c1\">-- all elements of A nonzero</span>\n    <span class=\"o\">{</span> <span class=\"k\">have</span> <span class=\"n\">ha&#39;</span> <span class=\"o\">:</span> <span class=\"n\">a</span> <span class=\"bp\">=</span> <span class=\"n\">b</span> <span class=\"bp\">*</span> <span class=\"n\">c</span> <span class=\"bp\">/</span> <span class=\"n\">d</span><span class=\"o\">,</span>\n        <span class=\"k\">by</span> <span class=\"o\">{</span> <span class=\"n\">rw</span> <span class=\"n\">eq_div_iff</span> <span class=\"n\">hd</span><span class=\"o\">,</span> <span class=\"n\">rw</span> <span class=\"bp\">&lt;-</span><span class=\"n\">sub_eq_zero</span><span class=\"o\">,</span> <span class=\"n\">exact</span> <span class=\"n\">H</span> <span class=\"o\">},</span>\n      <span class=\"n\">change</span> <span class=\"o\">(</span><span class=\"n\">a</span> <span class=\"bp\">*</span> <span class=\"n\">B</span> <span class=\"mi\">0</span> <span class=\"mi\">0</span> <span class=\"bp\">+</span> <span class=\"n\">b</span> <span class=\"bp\">*</span> <span class=\"n\">B</span> <span class=\"mi\">1</span> <span class=\"mi\">0</span> <span class=\"bp\">=</span> <span class=\"mi\">1</span><span class=\"o\">)</span> <span class=\"n\">at</span> <span class=\"n\">hAB&#39;</span><span class=\"o\">,</span>\n      <span class=\"n\">change</span> <span class=\"o\">(</span><span class=\"n\">c</span> <span class=\"bp\">*</span> <span class=\"n\">B</span> <span class=\"mi\">0</span> <span class=\"mi\">0</span> <span class=\"bp\">+</span> <span class=\"n\">d</span> <span class=\"bp\">*</span> <span class=\"n\">B</span> <span class=\"mi\">1</span> <span class=\"mi\">0</span> <span class=\"bp\">=</span> <span class=\"mi\">0</span><span class=\"o\">)</span> <span class=\"n\">at</span> <span class=\"n\">hAB&#39;&#39;&#39;</span><span class=\"o\">,</span>\n      <span class=\"k\">have</span> <span class=\"n\">hBv&#39;</span><span class=\"o\">:</span> <span class=\"n\">B</span> <span class=\"mi\">1</span> <span class=\"mi\">0</span> <span class=\"bp\">=</span> <span class=\"bp\">-</span> <span class=\"n\">c</span> <span class=\"bp\">/</span> <span class=\"n\">d</span> <span class=\"bp\">*</span> <span class=\"n\">B</span> <span class=\"mi\">0</span> <span class=\"mi\">0</span><span class=\"o\">,</span>\n        <span class=\"o\">{</span> <span class=\"n\">field_simp</span> <span class=\"o\">[</span><span class=\"n\">hc</span><span class=\"o\">,</span> <span class=\"n\">hd</span><span class=\"o\">],</span>\n          <span class=\"n\">rw</span> <span class=\"bp\">&lt;-</span><span class=\"n\">eq_neg_iff_add_eq_zero</span> <span class=\"n\">at</span> <span class=\"n\">hAB&#39;&#39;&#39;</span><span class=\"o\">,</span>\n          <span class=\"n\">simp</span> <span class=\"o\">[</span><span class=\"n\">hAB&#39;&#39;&#39;</span><span class=\"o\">,</span> <span class=\"n\">mul_comm</span><span class=\"o\">]</span> <span class=\"o\">},</span>\n      <span class=\"k\">have</span> <span class=\"n\">hd&#39;</span> <span class=\"o\">:</span> <span class=\"n\">d</span> <span class=\"bp\">=</span> <span class=\"mi\">0</span><span class=\"o\">,</span>\n        <span class=\"o\">{</span> <span class=\"n\">field_simp</span> <span class=\"o\">[</span><span class=\"n\">ha&#39;</span><span class=\"o\">,</span> <span class=\"n\">ha</span><span class=\"o\">,</span> <span class=\"n\">hb</span><span class=\"o\">,</span> <span class=\"n\">hc</span><span class=\"o\">,</span> <span class=\"n\">hd</span><span class=\"o\">,</span> <span class=\"n\">hBv&#39;</span><span class=\"o\">]</span> <span class=\"n\">at</span> <span class=\"n\">hAB&#39;</span><span class=\"o\">,</span>\n          <span class=\"n\">rw</span> <span class=\"bp\">&lt;-</span><span class=\"n\">hAB&#39;</span><span class=\"o\">,</span>\n          <span class=\"n\">ring</span> <span class=\"o\">},</span>\n      <span class=\"n\">exact</span> <span class=\"n\">absurd</span> <span class=\"n\">hd&#39;</span> <span class=\"n\">hd</span> <span class=\"o\">}</span> <span class=\"o\">}</span>\n<span class=\"kn\">end</span>\n</code></pre></div>",
        "id": 203424610,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1594320751
    },
    {
        "content": "<p>Additionally, something like <code>mul_cons</code> is not in <code>matrix.notation</code>. Should it be? It's a bit clunky with all the transposes.</p>",
        "id": 203424684,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1594320794
    },
    {
        "content": "<p>I'm able to remove all the <code>hAB'</code> hypotheses. It's too bad the pretty printer doesn't have a way to flip the notation for the transposes, which makes <code>hAB</code> pretty ugly if simplified.</p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"kn\">import</span> <span class=\"n\">data</span><span class=\"bp\">.</span><span class=\"n\">matrix</span><span class=\"bp\">.</span><span class=\"kn\">notation</span>\n<span class=\"kn\">import</span> <span class=\"n\">tactic</span>\n\n<span class=\"kn\">universe</span> <span class=\"n\">u</span>\n<span class=\"kn\">variables</span> <span class=\"o\">{</span><span class=\"n\">R</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span> <span class=\"o\">[</span><span class=\"n\">field</span> <span class=\"n\">R</span><span class=\"o\">]</span>\n<span class=\"kn\">variables</span> <span class=\"o\">{</span><span class=\"n\">n</span> <span class=\"o\">:</span> <span class=\"bp\">ℕ</span><span class=\"o\">}</span>\n\n<span class=\"kn\">variables</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"n\">B</span> <span class=\"o\">:</span> <span class=\"n\">matrix</span> <span class=\"o\">(</span><span class=\"n\">fin</span> <span class=\"n\">n</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">fin</span> <span class=\"n\">n</span><span class=\"o\">)</span> <span class=\"n\">R</span><span class=\"o\">)</span>\n\n<span class=\"bp\">@</span><span class=\"o\">[</span><span class=\"kn\">reducible</span><span class=\"o\">]</span> <span class=\"n\">def</span> <span class=\"n\">mat_invertible</span> <span class=\"o\">:</span> <span class=\"kt\">Prop</span> <span class=\"o\">:=</span> <span class=\"n\">A</span> <span class=\"bp\">*</span> <span class=\"n\">B</span> <span class=\"bp\">=</span> <span class=\"mi\">1</span> <span class=\"bp\">∧</span> <span class=\"n\">B</span> <span class=\"bp\">*</span> <span class=\"n\">A</span> <span class=\"bp\">=</span> <span class=\"mi\">1</span>\n\n<span class=\"kn\">variables</span> <span class=\"o\">{</span><span class=\"n\">α</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span> <span class=\"n\">u</span><span class=\"o\">}</span> <span class=\"o\">[</span><span class=\"n\">semiring</span> <span class=\"n\">α</span><span class=\"o\">]</span>\n<span class=\"kn\">variables</span> <span class=\"o\">{</span><span class=\"n\">m</span> <span class=\"n\">o</span> <span class=\"o\">:</span> <span class=\"bp\">ℕ</span><span class=\"o\">}</span> <span class=\"o\">{</span><span class=\"n\">m&#39;</span> <span class=\"n\">n&#39;</span> <span class=\"n\">o&#39;</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span><span class=\"o\">}</span> <span class=\"o\">[</span><span class=\"n\">fintype</span> <span class=\"n\">m&#39;</span><span class=\"o\">]</span> <span class=\"o\">[</span><span class=\"n\">fintype</span> <span class=\"n\">n&#39;</span><span class=\"o\">]</span>\n\n<span class=\"n\">open_locale</span> <span class=\"n\">matrix</span>\n\n<span class=\"kn\">lemma</span> <span class=\"n\">mul_cons</span> <span class=\"o\">{</span><span class=\"n\">o</span> <span class=\"o\">:</span> <span class=\"bp\">ℕ</span><span class=\"o\">}</span> <span class=\"o\">{</span><span class=\"n\">α</span><span class=\"o\">}</span> <span class=\"o\">[</span><span class=\"n\">comm_semiring</span> <span class=\"n\">α</span><span class=\"o\">]</span>\n  <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"o\">:</span> <span class=\"n\">matrix</span> <span class=\"o\">(</span><span class=\"n\">fin</span> <span class=\"n\">m</span><span class=\"bp\">.</span><span class=\"n\">succ</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">fin</span> <span class=\"n\">n</span><span class=\"bp\">.</span><span class=\"n\">succ</span><span class=\"o\">)</span> <span class=\"n\">α</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">B</span> <span class=\"o\">:</span> <span class=\"n\">matrix</span> <span class=\"o\">(</span><span class=\"n\">fin</span> <span class=\"n\">n</span><span class=\"bp\">.</span><span class=\"n\">succ</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">fin</span> <span class=\"n\">o</span><span class=\"bp\">.</span><span class=\"n\">succ</span><span class=\"o\">)</span> <span class=\"n\">α</span><span class=\"o\">)</span> <span class=\"o\">:</span>\n  <span class=\"n\">A</span> <span class=\"bp\">⬝</span> <span class=\"n\">B</span> <span class=\"bp\">=</span> <span class=\"o\">(</span><span class=\"n\">matrix</span><span class=\"bp\">.</span><span class=\"n\">vec_cons</span> <span class=\"o\">(</span><span class=\"n\">matrix</span><span class=\"bp\">.</span><span class=\"n\">mul_vec</span> <span class=\"n\">A</span> <span class=\"o\">(</span><span class=\"n\">matrix</span><span class=\"bp\">.</span><span class=\"n\">vec_head</span> <span class=\"n\">B</span><span class=\"err\">ᵀ</span><span class=\"o\">))</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"bp\">⬝</span> <span class=\"o\">(</span><span class=\"n\">matrix</span><span class=\"bp\">.</span><span class=\"n\">vec_tail</span> <span class=\"n\">B</span><span class=\"err\">ᵀ</span><span class=\"o\">)</span><span class=\"err\">ᵀ</span><span class=\"o\">)</span><span class=\"err\">ᵀ</span><span class=\"o\">)</span><span class=\"err\">ᵀ</span> <span class=\"o\">:=</span>\n<span class=\"k\">begin</span>\n  <span class=\"n\">ext</span> <span class=\"n\">i</span> <span class=\"n\">j</span><span class=\"o\">,</span>\n  <span class=\"n\">refine</span> <span class=\"n\">fin</span><span class=\"bp\">.</span><span class=\"n\">cases</span> <span class=\"bp\">_</span> <span class=\"bp\">_</span> <span class=\"n\">i</span><span class=\"bp\">;</span>\n  <span class=\"n\">induction</span> <span class=\"n\">j</span> <span class=\"k\">with</span> <span class=\"n\">kj</span> <span class=\"n\">hkj</span><span class=\"bp\">;</span>\n  <span class=\"n\">induction</span> <span class=\"n\">kj</span> <span class=\"k\">with</span> <span class=\"n\">nj</span> <span class=\"n\">hnj</span><span class=\"bp\">;</span>\n  <span class=\"o\">{</span> <span class=\"n\">intros</span><span class=\"o\">,</span> <span class=\"n\">simp</span><span class=\"o\">,</span> <span class=\"n\">refl</span> <span class=\"o\">},</span>\n<span class=\"kn\">end</span>\n\n<span class=\"kn\">example</span> <span class=\"o\">(</span><span class=\"n\">A</span> <span class=\"o\">:</span> <span class=\"n\">matrix</span> <span class=\"o\">(</span><span class=\"n\">fin</span> <span class=\"mi\">2</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">fin</span> <span class=\"mi\">2</span><span class=\"o\">)</span> <span class=\"n\">R</span><span class=\"o\">)</span> <span class=\"o\">{</span><span class=\"n\">a</span> <span class=\"n\">b</span> <span class=\"n\">c</span> <span class=\"n\">d</span> <span class=\"o\">:</span> <span class=\"n\">R</span><span class=\"o\">}</span> <span class=\"o\">(</span><span class=\"n\">hA</span> <span class=\"o\">:</span> <span class=\"n\">A</span> <span class=\"bp\">=</span> <span class=\"bp\">!</span><span class=\"o\">[</span><span class=\"bp\">!</span><span class=\"o\">[</span><span class=\"n\">a</span><span class=\"o\">,</span> <span class=\"n\">b</span><span class=\"o\">],</span> <span class=\"bp\">!</span><span class=\"o\">[</span><span class=\"n\">c</span><span class=\"o\">,</span> <span class=\"n\">d</span><span class=\"o\">]])</span> <span class=\"o\">:</span>\n        <span class=\"n\">a</span> <span class=\"bp\">*</span> <span class=\"n\">d</span> <span class=\"bp\">-</span> <span class=\"n\">b</span> <span class=\"bp\">*</span> <span class=\"n\">c</span> <span class=\"bp\">≠</span> <span class=\"mi\">0</span> <span class=\"bp\">↔</span> <span class=\"bp\">∃</span> <span class=\"n\">B</span><span class=\"o\">,</span> <span class=\"n\">mat_invertible</span> <span class=\"n\">A</span> <span class=\"n\">B</span> <span class=\"o\">:=</span>\n<span class=\"k\">begin</span>\n  <span class=\"n\">split</span><span class=\"o\">,</span>\n  <span class=\"o\">{</span> <span class=\"n\">intros</span> <span class=\"n\">h</span><span class=\"o\">,</span>\n    <span class=\"n\">use</span> <span class=\"o\">(</span><span class=\"mi\">1</span> <span class=\"bp\">/</span> <span class=\"o\">(</span><span class=\"n\">a</span> <span class=\"bp\">*</span> <span class=\"n\">d</span> <span class=\"bp\">-</span> <span class=\"n\">b</span> <span class=\"bp\">*</span> <span class=\"n\">c</span><span class=\"o\">))</span> <span class=\"err\">•</span> <span class=\"bp\">!</span><span class=\"o\">[</span><span class=\"bp\">!</span><span class=\"o\">[</span><span class=\"n\">d</span><span class=\"o\">,</span> <span class=\"bp\">-</span><span class=\"n\">b</span><span class=\"o\">],</span> <span class=\"bp\">!</span><span class=\"o\">[</span><span class=\"bp\">-</span><span class=\"n\">c</span><span class=\"o\">,</span> <span class=\"n\">a</span><span class=\"o\">]],</span>\n    <span class=\"n\">split</span><span class=\"bp\">;</span>\n      <span class=\"o\">{</span> <span class=\"n\">ext</span> <span class=\"n\">i</span> <span class=\"n\">j</span><span class=\"o\">,</span>\n        <span class=\"n\">fin_cases</span> <span class=\"n\">i</span><span class=\"bp\">;</span>\n        <span class=\"n\">fin_cases</span> <span class=\"n\">j</span><span class=\"bp\">;</span>\n        <span class=\"n\">field_simp</span> <span class=\"o\">[</span><span class=\"n\">hA</span><span class=\"o\">,</span> <span class=\"n\">h</span><span class=\"o\">]</span><span class=\"bp\">;</span>\n        <span class=\"n\">ring</span> <span class=\"o\">}</span> <span class=\"o\">},</span>\n  <span class=\"o\">{</span> <span class=\"n\">intros</span> <span class=\"n\">h</span> <span class=\"n\">H</span><span class=\"o\">,</span>\n    <span class=\"n\">rcases</span> <span class=\"n\">h</span> <span class=\"k\">with</span> <span class=\"bp\">⟨</span><span class=\"n\">B</span><span class=\"o\">,</span> <span class=\"n\">hAB</span><span class=\"o\">,</span> <span class=\"n\">hBA</span><span class=\"bp\">⟩</span><span class=\"o\">,</span>\n    <span class=\"n\">rw</span> <span class=\"o\">[</span><span class=\"bp\">&lt;-</span><span class=\"n\">matrix</span><span class=\"bp\">.</span><span class=\"n\">ext_iff</span><span class=\"o\">,</span> <span class=\"n\">hA</span><span class=\"o\">,</span> <span class=\"n\">matrix</span><span class=\"bp\">.</span><span class=\"n\">mul_eq_mul</span><span class=\"o\">]</span> <span class=\"n\">at</span> <span class=\"n\">hBA</span><span class=\"o\">,</span>\n    <span class=\"n\">simp</span> <span class=\"o\">[</span><span class=\"n\">mul_cons</span><span class=\"o\">,</span> <span class=\"n\">matrix</span><span class=\"bp\">.</span><span class=\"n\">vec_head</span><span class=\"o\">,</span> <span class=\"n\">matrix</span><span class=\"bp\">.</span><span class=\"n\">vec_tail</span><span class=\"o\">]</span> <span class=\"n\">at</span> <span class=\"n\">hBA</span><span class=\"o\">,</span>\n    <span class=\"k\">let</span> <span class=\"n\">hBA&#39;</span> <span class=\"o\">:=</span> <span class=\"n\">hBA</span> <span class=\"mi\">0</span> <span class=\"mi\">0</span><span class=\"o\">,</span>\n    <span class=\"k\">let</span> <span class=\"n\">hBA&#39;&#39;&#39;&#39;</span> <span class=\"o\">:=</span> <span class=\"n\">hBA</span> <span class=\"mi\">0</span> <span class=\"mi\">1</span><span class=\"o\">,</span>\n    <span class=\"k\">let</span> <span class=\"n\">hBA&#39;&#39;&#39;</span> <span class=\"o\">:=</span> <span class=\"n\">hBA</span> <span class=\"mi\">1</span> <span class=\"mi\">0</span><span class=\"o\">,</span>\n    <span class=\"k\">let</span> <span class=\"n\">hBA&#39;&#39;</span> <span class=\"o\">:=</span> <span class=\"n\">hBA</span> <span class=\"mi\">1</span> <span class=\"mi\">1</span><span class=\"o\">,</span>\n    <span class=\"k\">have</span> <span class=\"n\">finne</span> <span class=\"o\">:</span> <span class=\"o\">((</span><span class=\"mi\">0</span> <span class=\"o\">:</span> <span class=\"n\">fin</span> <span class=\"mi\">2</span><span class=\"o\">)</span> <span class=\"bp\">≠</span> <span class=\"mi\">1</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"n\">fin</span><span class=\"bp\">.</span><span class=\"n\">ne_of_vne</span> <span class=\"n\">zero_ne_one</span><span class=\"o\">,</span>\n    <span class=\"n\">simp</span> <span class=\"o\">[</span><span class=\"n\">finne</span><span class=\"o\">]</span> <span class=\"n\">at</span> <span class=\"n\">hBA&#39;</span> <span class=\"n\">hBA&#39;&#39;</span> <span class=\"n\">hBA&#39;&#39;&#39;</span> <span class=\"n\">hBA&#39;&#39;&#39;&#39;</span><span class=\"o\">,</span>\n    <span class=\"n\">classical</span><span class=\"o\">,</span>\n    <span class=\"n\">by_cases</span> <span class=\"n\">ha</span> <span class=\"o\">:</span> <span class=\"n\">a</span> <span class=\"bp\">=</span> <span class=\"mi\">0</span><span class=\"bp\">;</span>\n    <span class=\"n\">by_cases</span> <span class=\"n\">hb</span> <span class=\"o\">:</span> <span class=\"n\">b</span> <span class=\"bp\">=</span> <span class=\"mi\">0</span><span class=\"bp\">;</span>\n    <span class=\"n\">by_cases</span> <span class=\"n\">hc</span> <span class=\"o\">:</span> <span class=\"n\">c</span> <span class=\"bp\">=</span> <span class=\"mi\">0</span><span class=\"bp\">;</span>\n    <span class=\"n\">by_cases</span> <span class=\"n\">hd</span> <span class=\"o\">:</span> <span class=\"n\">d</span> <span class=\"bp\">=</span> <span class=\"mi\">0</span><span class=\"o\">,</span>\n    <span class=\"c1\">-- at least one element of A is zero</span>\n    <span class=\"n\">any_goals</span>\n      <span class=\"o\">{</span> <span class=\"n\">simp</span> <span class=\"o\">[</span><span class=\"n\">ha</span><span class=\"o\">,</span> <span class=\"n\">hb</span><span class=\"o\">,</span> <span class=\"n\">hc</span><span class=\"o\">,</span> <span class=\"n\">hd</span><span class=\"o\">,</span> <span class=\"n\">mul_zero</span><span class=\"o\">,</span> <span class=\"n\">sub_zero</span><span class=\"o\">,</span> <span class=\"n\">mul_eq_zero</span><span class=\"o\">]</span> <span class=\"n\">at</span> <span class=\"n\">H</span><span class=\"o\">,</span>\n        <span class=\"n\">cases</span> <span class=\"n\">H</span><span class=\"bp\">;</span>\n        <span class=\"n\">simp</span> <span class=\"bp\">*</span> <span class=\"n\">at</span> <span class=\"bp\">*</span> <span class=\"o\">},</span>\n    <span class=\"c1\">-- all elements of A nonzero</span>\n    <span class=\"o\">{</span> <span class=\"k\">have</span> <span class=\"n\">ha&#39;</span> <span class=\"o\">:</span> <span class=\"n\">a</span> <span class=\"bp\">=</span> <span class=\"n\">b</span> <span class=\"bp\">*</span> <span class=\"n\">c</span> <span class=\"bp\">/</span> <span class=\"n\">d</span><span class=\"o\">,</span>\n        <span class=\"k\">by</span> <span class=\"o\">{</span> <span class=\"n\">rw</span> <span class=\"n\">eq_div_iff</span> <span class=\"n\">hd</span><span class=\"o\">,</span> <span class=\"n\">rw</span> <span class=\"bp\">&lt;-</span><span class=\"n\">sub_eq_zero</span><span class=\"o\">,</span> <span class=\"n\">exact</span> <span class=\"n\">H</span> <span class=\"o\">},</span>\n      <span class=\"n\">change</span> <span class=\"o\">(</span><span class=\"n\">a</span> <span class=\"bp\">*</span> <span class=\"n\">B</span> <span class=\"mi\">0</span> <span class=\"mi\">0</span> <span class=\"bp\">+</span> <span class=\"n\">c</span> <span class=\"bp\">*</span> <span class=\"n\">B</span> <span class=\"mi\">0</span> <span class=\"mi\">1</span> <span class=\"bp\">=</span> <span class=\"mi\">1</span><span class=\"o\">)</span> <span class=\"n\">at</span> <span class=\"n\">hBA&#39;</span><span class=\"o\">,</span>\n      <span class=\"n\">change</span> <span class=\"o\">(</span><span class=\"n\">b</span> <span class=\"bp\">*</span> <span class=\"n\">B</span> <span class=\"mi\">0</span> <span class=\"mi\">0</span> <span class=\"bp\">+</span> <span class=\"n\">d</span> <span class=\"bp\">*</span> <span class=\"n\">B</span> <span class=\"mi\">0</span> <span class=\"mi\">1</span> <span class=\"bp\">=</span> <span class=\"mi\">0</span><span class=\"o\">)</span> <span class=\"n\">at</span> <span class=\"n\">hBA&#39;&#39;&#39;&#39;</span><span class=\"o\">,</span>\n      <span class=\"k\">have</span> <span class=\"n\">hBv</span> <span class=\"o\">:</span> <span class=\"n\">B</span> <span class=\"mi\">0</span> <span class=\"mi\">1</span> <span class=\"bp\">=</span> <span class=\"bp\">-</span> <span class=\"n\">b</span> <span class=\"bp\">/</span> <span class=\"n\">d</span> <span class=\"bp\">*</span> <span class=\"n\">B</span> <span class=\"mi\">0</span> <span class=\"mi\">0</span><span class=\"o\">,</span>\n        <span class=\"o\">{</span> <span class=\"n\">field_simp</span> <span class=\"o\">[</span><span class=\"n\">hb</span><span class=\"o\">,</span> <span class=\"n\">hd</span><span class=\"o\">],</span>\n          <span class=\"n\">rw</span> <span class=\"bp\">&lt;-</span><span class=\"n\">eq_neg_iff_add_eq_zero</span> <span class=\"n\">at</span> <span class=\"n\">hBA&#39;&#39;&#39;&#39;</span><span class=\"o\">,</span>\n          <span class=\"n\">simp</span> <span class=\"o\">[</span><span class=\"n\">hBA&#39;&#39;&#39;&#39;</span><span class=\"o\">,</span> <span class=\"n\">mul_comm</span><span class=\"o\">]</span> <span class=\"o\">},</span>\n      <span class=\"k\">have</span> <span class=\"n\">hd&#39;</span> <span class=\"o\">:</span> <span class=\"n\">d</span> <span class=\"bp\">=</span> <span class=\"mi\">0</span><span class=\"o\">,</span>\n        <span class=\"o\">{</span> <span class=\"n\">field_simp</span> <span class=\"o\">[</span><span class=\"n\">ha&#39;</span><span class=\"o\">,</span> <span class=\"n\">ha</span><span class=\"o\">,</span> <span class=\"n\">hb</span><span class=\"o\">,</span> <span class=\"n\">hc</span><span class=\"o\">,</span> <span class=\"n\">hd</span><span class=\"o\">,</span> <span class=\"n\">hBv</span><span class=\"o\">]</span> <span class=\"n\">at</span> <span class=\"n\">hBA&#39;</span><span class=\"o\">,</span>\n          <span class=\"n\">rw</span> <span class=\"bp\">&lt;-</span><span class=\"n\">hBA&#39;</span><span class=\"o\">,</span>\n          <span class=\"n\">ring</span> <span class=\"o\">},</span>\n      <span class=\"n\">exact</span> <span class=\"n\">absurd</span> <span class=\"n\">hd&#39;</span> <span class=\"n\">hd</span> <span class=\"o\">}</span> <span class=\"o\">}</span>\n<span class=\"kn\">end</span>\n</code></pre></div>",
        "id": 203427969,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1594322534
    },
    {
        "content": "<p>For the \"has inverse -&gt; det isn't zero\" I would use det(AB)=det(A)det(B). In fact I'd prove that det!=0 iff exists inverse for n x n matrices, prove that det(A)=ad-bc if n=2 (which was done in another thread) and then put it together. This seems like a more natural approach. I'm pretty sure we have det(AB)=det(A)det(B). You can use it to prove that if A has an inverse then det(A) is a unit, over an arbitrary commutative semiring I should think.</p>",
        "id": 203605219,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1594487568
    },
    {
        "content": "<p>We have the other direction too, <code>nonsing_inv</code></p>",
        "id": 203605348,
        "sender_full_name": "Reid Barton",
        "timestamp": 1594487804
    },
    {
        "content": "<p>I was hoping to avoid the definition of det for this particular proof</p>",
        "id": 203625290,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1594524179
    },
    {
        "content": "<p>(deleted)</p>",
        "id": 203625297,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1594524223
    }
]