[
    {
        "content": "<p>Hi, all, I'm just getting started using LEAN. I've opened .../tutorial  (to get lean.toml), and I'm trying to work in 00_first_proofs.lean.<br>\nI've got 128 messages that seem wrong. For example,<br>\n    invalid import: data.option.defs<br>\n    excessive memory consumption detected at 'replace' (potential solution: increase memory consumption threshold)</p>\n<ol>\n<li>I would assume that all the imports in that file should work. What do I need to do to make them valid?</li>\n<li>WRT memory consumption, lean itself is taking 5.4 GB. Total memory consumption seems to be near 8GB. Does it realy have to be that high?</li>\n</ol>\n<p>Finally,</p>\n<ol start=\"3\">\n<li>I have a lot of messages like this: invalid object declaration, environment already has an object named 'option.elim._main'. Many of these messages are exact duplicates. How can I correct things to avoid such collisions?</li>\n</ol>",
        "id": 236589142,
        "sender_full_name": "Douglas Lewan",
        "timestamp": 1619648206
    },
    {
        "content": "<p><del>Can you edit the title of your message above to move it to a new thread?</del> thanks!</p>",
        "id": 236589704,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1619648564
    },
    {
        "content": "<p>Sorry. I'm new to zulip too.</p>",
        "id": 236589869,
        "sender_full_name": "Douglas Lewan",
        "timestamp": 1619648678
    },
    {
        "content": "<p>Another start up problem is that I have no \"goals\" window. (I'm using VSCode.) The very first runhad both infoview and goals. Now I can't tell how to get the goals window.</p>",
        "id": 236590084,
        "sender_full_name": "Douglas Lewan",
        "timestamp": 1619648814
    },
    {
        "content": "<p>It seems likely you that don't have a local copy of mathlib setup correctly. Could you point us to the installation instructions you used?</p>",
        "id": 236595803,
        "sender_full_name": "Scott Morrison",
        "timestamp": 1619652445
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"408577\">Douglas Lewan</span> <a href=\"#narrow/stream/113489-new-members/topic/Distubing.20messages.20on.20start.20up/near/236590084\">said</a>:</p>\n<blockquote>\n<p>Another start up problem is that I have no \"goals\" window. (I'm using VSCode.) The very first runhad both infoview and goals. Now I can't tell how to get the goals window.</p>\n</blockquote>\n<p>Ctrl-shift-space, or a little button in the top right of the editor window will open the goal view</p>",
        "id": 236611461,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1619664850
    },
    {
        "content": "<p>Did you install the project with <code>leanproject</code> and did you open the root directory (not a file) with VS Code?</p>",
        "id": 236630032,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1619680880
    },
    {
        "content": "<p>I've got the same issue not long ago. Did you have something like \"unknown archive format\" when you do \"leanproject get tutorials\"?<br>\n<a href=\"#narrow/stream/113489-new-members/topic/Issue.20of.20Installation.20on.20generic.20Linux/near/236359317\">https://leanprover.zulipchat.com/#narrow/stream/113489-new-members/topic/Issue.20of.20Installation.20on.20generic.20Linux/near/236359317</a></p>",
        "id": 236650183,
        "sender_full_name": "Kunhao Zheng",
        "timestamp": 1619691782
    },
    {
        "content": "<p>I followed the instructions at <a href=\"https://leanprover-community.github.io/install/debian_details.html\">https://leanprover-community.github.io/install/debian_details.html</a>. I'm running Debian 9.4, stretch.<br>\nI followed the instructions at <a href=\"https://leanprover-community.github.io/install/project.html\">https://leanprover-community.github.io/install/project.html</a> to install the tutorial, yes, with leanproject.</p>",
        "id": 236708555,
        "sender_full_name": "Douglas Lewan",
        "timestamp": 1619715451
    },
    {
        "content": "<p>Can you open the root directory of the tutorials project using \"open folder\" with VS Code, then open 00_first_proofs.lean in src, and see if it works, and if it doesn't work then send a screenshot of your VS Code?</p>",
        "id": 236708745,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1619715515
    },
    {
        "content": "<p>I've tried starting again 'from scratch', something that VScode doesn't seem to want to do. I'd be happy to send a screenshot, but i'm not sure how to.</p>",
        "id": 236711140,
        "sender_full_name": "Douglas Lewan",
        "timestamp": 1619716538
    },
    {
        "content": "<p>I would help, were you to be more precise about which part of uploading a screenshot to Zulip you're not sure how to do</p>",
        "id": 236715476,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1619718180
    },
    {
        "content": "<p>Here's a screenshot of VSCode. <a href=\"/user_uploads/3121/jBdIz4rYbnlxVn7Z_x-x_jhN/VScode-Screenshot_2021-04-29_13-14-10.png\">VScode-Screenshot_2021-04-29_13-14-10.png</a> <br>\n(Sorry, as I mentioned elsewhere, I'm new to Zulip too.)</p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/jBdIz4rYbnlxVn7Z_x-x_jhN/VScode-Screenshot_2021-04-29_13-14-10.png\" title=\"VScode-Screenshot_2021-04-29_13-14-10.png\"><img src=\"/user_uploads/3121/jBdIz4rYbnlxVn7Z_x-x_jhN/VScode-Screenshot_2021-04-29_13-14-10.png\"></a></div>",
        "id": 236734827,
        "sender_full_name": "Douglas Lewan",
        "timestamp": 1619726045
    },
    {
        "content": "<p>And what happens if you try ctrl-shift-P and then start typing <code>restart</code> and then click on <code>Lean: Restart</code>?</p>\n<p>Independent of that, if you get to a terminal by pulling up on the blue bar at the bottom and then clicking on \"TERMINAL\", and then type <code>ls src/data/option/*</code>, what does the output say?</p>",
        "id": 236740928,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1619728548
    },
    {
        "content": "<p>If  I restart, then I get the same results (many disturbing messages).<br>\nHere's the listing you asked for:<br>\n    lean@debian2019:~/src/expt/lean/tutorials$ ls src/data/option/*<br>\n    ls: cannot access 'src/data/option/*': No such file or directory<br>\n    lean@debian2019:~/src/expt/lean/tutorials$<br>\nI'm guessing that that's not a good thing. It certainly suggests that I've missed something. Shouldn't the leanproject install have dealt with this?</p>",
        "id": 236748271,
        "sender_full_name": "Douglas Lewan",
        "timestamp": 1619730993
    },
    {
        "content": "<p>Since you're working in the tutorials project and not mathlib, try <code>ls _target/deps/mathlib/src/data/option/*</code>.</p>",
        "id": 236749651,
        "sender_full_name": "Bryan Gin-ge Chen",
        "timestamp": 1619731386
    },
    {
        "content": "<p>OK, I've done that; here are the results:<br>\nlean@debian2019:~/src/expt/lean/tutorials$ ls _target/deps/mathlib/src/data/option/*<br>\n_target/deps/mathlib/src/data/option/basic.lean  _target/deps/mathlib/src/data/option/defs.lean<br>\nlean@debian2019:~/src/expt/lean/tutorials$ </p>\n<p>That feels better. What should I make of it?</p>",
        "id": 236754833,
        "sender_full_name": "Douglas Lewan",
        "timestamp": 1619734034
    },
    {
        "content": "<p>Well we've located your problem, at least. I would delete the tutorials directly completely, get it again using <code>leanproject</code> and then check the output for errors. You don't have any <code>olean</code> files.</p>",
        "id": 236756174,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1619734812
    },
    {
        "content": "<p>Running <code>leanproject get tutorials</code> will create a new directory <code>tutorials/</code> with everything you need, hopefully. If you see any error messages in the <code>leanproject</code> output let us know.</p>",
        "id": 236758499,
        "sender_full_name": "Bryan Gin-ge Chen",
        "timestamp": 1619736155
    },
    {
        "content": "<p>OK. I'll try again. Thanks for the attention.</p>",
        "id": 236767311,
        "sender_full_name": "Douglas Lewan",
        "timestamp": 1619741985
    },
    {
        "content": "<p>OK. I'm trying to go bck to the beginning, or at least as far as I can. I'm starting with \"elan update\". That gets the following:</p>\n<p>lean@debian2019:~/src/expt/lean$ elan update<br>\ninfo: syncing channel updates for 'stable'<br>\ninfo: latest update on stable, lean version v3.29.0<br>\ninfo: downloading component 'lean'<br>\n 10.0 MiB /  10.0 MiB (100 %)  80.0 KiB/s ETA:   0 s                <br>\ninfo: installing component 'lean'<br>\ninfo: checking for self-updates<br>\ninfo: downloading self-update<br>\nError(Download(HttpStatus(404)), State { next_error: None, backtrace: InternalBacktrace { backtrace: None } })<br>\nerror: could not download file from '<a href=\"https://github.com/Kha/elan/releases/download/v1.0.2/elan-x86_64-unknown-linux-musl.tar.gz\">https://github.com/Kha/elan/releases/download/v1.0.2/elan-x86_64-unknown-linux-musl.tar.gz</a>' to '/tmp/elan-update.N6Fcl7Pa3otC/elan-x86_64-unknown-linux-musl.tar.gz'<br>\ninfo: caused by: http request returned an unsuccessful status code: 404</p>\n<p>I'm guessing that a 404 is not desirable.</p>",
        "id": 236768109,
        "sender_full_name": "Douglas Lewan",
        "timestamp": 1619742538
    },
    {
        "content": "<p>Yeah, for some reason your system is looking for an option which isn't in the list here: <a href=\"https://github.com/leanprover/elan/releases/tag/v1.0.2\">https://github.com/leanprover/elan/releases/tag/v1.0.2</a></p>",
        "id": 236768647,
        "sender_full_name": "Bryan Gin-ge Chen",
        "timestamp": 1619742938
    },
    {
        "content": "<p>cc <span class=\"user-mention\" data-user-id=\"110024\">@Sebastian Ullrich</span></p>",
        "id": 236768654,
        "sender_full_name": "Bryan Gin-ge Chen",
        "timestamp": 1619742946
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"408577\">@Douglas Lewan</span>, what do you get from <code>uname -s</code> and <code>uname -m</code>?</p>",
        "id": 236768978,
        "sender_full_name": "Scott Morrison",
        "timestamp": 1619743230
    },
    {
        "content": "<p>lean@debian2019:~/src/expt/lean$ uname -s<br>\nLinux<br>\nlean@debian2019:~/src/expt/lean$ uname -m<br>\nx86_64<br>\nlean@debian2019:~/src/expt/lean$ <br>\nIs that really intereting?</p>",
        "id": 236769150,
        "sender_full_name": "Douglas Lewan",
        "timestamp": 1619743360
    },
    {
        "content": "<p>OK, I went looking on github at <a href=\"https://github.com/leanprover/elan/releases/tag/v1.0.2\">https://github.com/leanprover/elan/releases/tag/v1.0.2</a>. It looks reasonable to me. In particular, it looks like the link that elan wants is there. What am I missing?</p>",
        "id": 236769361,
        "sender_full_name": "Douglas Lewan",
        "timestamp": 1619743547
    },
    {
        "content": "<p>The mystery is why it is looking for  <code>https://github.com/Kha/elan/releases/download/v1.0.2/elan-x86_64-unknown-linux-musl.tar.gz</code>, rather than <code>linux-gnu</code>.</p>",
        "id": 236769509,
        "sender_full_name": "Scott Morrison",
        "timestamp": 1619743677
    },
    {
        "content": "<p>It's a bit strange. On e.g. distributions like alpine, it would be reasonable for it to be looking for the <code>musl</code> version (and then to complain that that is missing). But you're on a perfectly normal looking debian from what you've said, so it should be looking for the <code>gnu</code> version.</p>",
        "id": 236769630,
        "sender_full_name": "Scott Morrison",
        "timestamp": 1619743773
    },
    {
        "content": "<p>Maybe delete the entirety of your <code>~/.elan</code> directory, and start fresh?</p>",
        "id": 236769976,
        "sender_full_name": "Scott Morrison",
        "timestamp": 1619744065
    },
    {
        "content": "<p>(by installing elan again: <code>curl https://raw.githubusercontent.com/leanprover/elan/master/elan-init.sh -sSf | sh</code>)</p>",
        "id": 236769986,
        "sender_full_name": "Scott Morrison",
        "timestamp": 1619744081
    },
    {
        "content": "<p>I'm more than happy to push things back yet another step, and I'm doing it now. I've deleted ~/.elan and am reinstalling it with the above curl ... | sh incantation..</p>",
        "id": 236770261,
        "sender_full_name": "Douglas Lewan",
        "timestamp": 1619744374
    },
    {
        "content": "<p>Any luck, <span class=\"user-mention\" data-user-id=\"408577\">@Douglas Lewan</span>?</p>",
        "id": 236773591,
        "sender_full_name": "Scott Morrison",
        "timestamp": 1619747078
    },
    {
        "content": "<p>It looks like there was a bug in <code>elan self update</code> between 0.11.0 and 1.0.2 that would look for the wrong URL on Linux. It should be fixed now, but you will need to update manually by reinstalling if your elan is affected.</p>",
        "id": 236802012,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1619771062
    },
    {
        "content": "<p>The bug was introduced because I didn't want to break the URL for older releases. Oh well...</p>",
        "id": 236802113,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1619771129
    },
    {
        "content": "<p>I still get an error here:<br>\nlean@debian2019:~/src/expt/lean$ elan update<br>\ninfo: syncing channel updates for 'stable'<br>\ninfo: latest update on stable, lean version v3.29.0<br>\ninfo: checking for self-updates<br>\ninfo: downloading self-update<br>\nError(Download(HttpStatus(404)), State { next_error: None, backtrace: InternalBacktrace { backtrace: None } })<br>\nerror: could not download file from '<a href=\"https://github.com/leanprover/elan/releases/download/v1.0.3/elan-x86_64-unknown-linux-musl.tar.gz\">https://github.com/leanprover/elan/releases/download/v1.0.3/elan-x86_64-unknown-linux-musl.tar.gz</a>' to '/tmp/elan-update.1j5fOI1SOl2v/elan-x86_64-unknown-linux-musl.tar.gz'<br>\ninfo: caused by: http request returned an unsuccessful status code: 404</p>",
        "id": 236805896,
        "sender_full_name": "Douglas Lewan",
        "timestamp": 1619773470
    },
    {
        "content": "<p>Yeah, you need to reinstall <code>elan</code> with the instruction from the second point here: <a href=\"https://leanprover-community.github.io/install/debian_details.html\">https://leanprover-community.github.io/install/debian_details.html</a></p>",
        "id": 236805944,
        "sender_full_name": "Ruben Van de Velde",
        "timestamp": 1619773511
    },
    {
        "content": "<p>OK, I've removed and re-installed elan. I've tried re-installing the tutorials project. I still get the following error:<br>\nUnknown archive format '/home/lean/.mathlib/95260613e481c2571df45c3961d491821f147dd8.tar.xz'<br>\nI could unpack that archive; it looks like it should be unpacked in .../tutorials. Should it?<br>\nI've looked at the source for leanproject and it invokes python magic that I don't understand..<br>\nWould unpacking that archive be the last step? If so, I'll do it. If not, how do I glean what other intermediate steps I should go through.</p>",
        "id": 236819197,
        "sender_full_name": "Douglas Lewan",
        "timestamp": 1619781269
    },
    {
        "content": "<p>Yes, all your problems are caused by that big zipped up collection of oleans not being on your system, and that error may indicate that your version of python is too old. What does <code>python3 -- version</code> give you? Someone posted a very nice trick to persuade leanproject to use a specific version of python -- search the chat for <code>Unknown archive format</code> and you'll find a couple of people struggling with this for which a python upgrade fixed the problem.</p>",
        "id": 236822198,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1619783124
    },
    {
        "content": "<p>python3 --version gives me 3.9.4. It was built from source. That seems to be the most recent stable version.<br>\nRather than mucking about, possibly corrupting the target system, with adding new versions of python, it strikes me that a simpler solution would be to install a \".tar\" archive instead of a \".tar.xz\" archive.<br>\nAgain, I'll ask, can I simply unpack that archive (under .../tutorials)? Or is there more?</p>",
        "id": 236825032,
        "sender_full_name": "Douglas Lewan",
        "timestamp": 1619784851
    },
    {
        "content": "<p>So, you can just unpack that archive (someone... we'll have to investigate to know for sure, as all of us just use the tooling!). I think we're all hesitant to recommend it as this is a step that has to be done regularly (every time you want to move to a new version of mathlib --- mathlib updates many times a day!).</p>",
        "id": 236825317,
        "sender_full_name": "Scott Morrison",
        "timestamp": 1619785039
    },
    {
        "content": "<p>We'd also like to work out the root cause of your problem. It may be that you have an unusual system (the fact that you have python built from source suggests so :-), or it may be a problem in the tooling, which we'd like to fix.</p>",
        "id": 236825413,
        "sender_full_name": "Scott Morrison",
        "timestamp": 1619785086
    },
    {
        "content": "<p>(And regarding why it is a <code>.tar.xz</code>, rather than just a <code>.tar</code>: this is a file that many of us who hack on mathlib download <em>many</em> times a day as part of our workflow.)</p>",
        "id": 236825671,
        "sender_full_name": "Scott Morrison",
        "timestamp": 1619785237
    },
    {
        "content": "<p>It's python3 pre about 3.5 which was problematic. If you've built from source then do you have this lzma module installed or whatever it's called? I urge you to search out the recent thread on all this.</p>",
        "id": 236825688,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1619785248
    },
    {
        "content": "<p><a href=\"#narrow/stream/113489-new-members/topic/Issue.20of.20Installation.20on.20generic.20Linux/near/236372684\">https://leanprover.zulipchat.com/#narrow/stream/113489-new-members/topic/Issue.20of.20Installation.20on.20generic.20Linux/near/236372684</a></p>",
        "id": 236825788,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1619785305
    },
    {
        "content": "<p>The thread is <a href=\"#narrow/stream/113489-new-members/topic/Issue.20of.20Installation.20on.20generic.20Linux\">https://leanprover.zulipchat.com/#narrow/stream/113489-new-members/topic/Issue.20of.20Installation.20on.20generic.20Linux</a></p>",
        "id": 236825859,
        "sender_full_name": "Scott Morrison",
        "timestamp": 1619785331
    },
    {
        "content": "<p>Kunhao Zheng's last message on that thread is almost certainly your problem.</p>",
        "id": 236826096,
        "sender_full_name": "Scott Morrison",
        "timestamp": 1619785471
    },
    {
        "content": "<p>If you cannot import lzma when in your python environment, that is exactly the same problem as mine. <span aria-label=\"thinking\" class=\"emoji emoji-1f914\" role=\"img\" title=\"thinking\">:thinking:</span> Rebuilding your python (with lzma installed) or getting another one should get away with that.</p>",
        "id": 236855977,
        "sender_full_name": "Kunhao Zheng",
        "timestamp": 1619797331
    },
    {
        "content": "<p>@Scott Morrison, No luck yet. I've stopped using python3 3.9.4 and going back to the 3.5.3, the version supplied by Debian.<br>\nI tried installing python-lzma, but it looks like that only applies to python &lt; 3. python3 3.5.3 continues to complain about an \"unknown archive format\".<br>\nSo, I've gone back to using python3 3.9.4<br>\nI've been combing through its code and installation and I do find /usr/local/lib/python3.9/lzma.py, which I assume can be found and loaded. (Is \"loaded\" the right word in python? I've had very little interaction with python.)<br>\nI've also installed the lzma and lzma-dev packages from Debian. I'm currently rebuilding python3 3.9.4. The test code mentions .tar.xz files, but does say that those tests depend on the presence of lzma.<br>\nI'll let you know how things work out.</p>",
        "id": 236862594,
        "sender_full_name": "Douglas Lewan",
        "timestamp": 1619800032
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"110087\">@Scott Morrison</span> <span class=\"user-mention\" data-user-id=\"408484\">@Kunhao Zheng</span> <span class=\"user-mention\" data-user-id=\"110038\">@Kevin Buzzard</span> <br>\nRebilding python3 with lzma support did the trick.<br>\nThanks to everyone for all the help.<br>\nNow, on to more interesting issues (I hope).</p>",
        "id": 236868905,
        "sender_full_name": "Douglas Lewan",
        "timestamp": 1619802560
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"408577\">@Douglas Lewan</span>  I'm sorry it took you so long to get started. Lean is a project and not a finished product, and the community has worked hard to try and make the installation process as painless as possible, but unfortunately it still involves pain for some. If it's any consolation, this part is by far the most boring part, and if you can get the tutorial project running then our general experience is that you won't run into any more infrastructure issues -- the tutorial project is complex from an infrastructure point of view -- it has mathlib as a dependency, for example. If you can run it, you should now be able to run anything.</p>",
        "id": 236878717,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1619806448
    },
    {
        "content": "<p>Thanks. And I understand.<br>\nThe spirit behind the GNU autoconf project might also be worth considering, although I have no idea how you would build a test in python to catch the .tar.xz issue. Python's test code may give a hint.<br>\nI've already started looking at the tutorial code. A \"Nebenprojekt\" (What's the right english word?) will be learning the documentation system and how to walk available modules. My experience has been that learning how a language's documentation works is one of the hardest parts to learning that language.</p>",
        "id": 236879925,
        "sender_full_name": "Douglas Lewan",
        "timestamp": 1619806940
    },
    {
        "content": "<p>I assume we can make leanproject emit a better diagnostic message for this problem without too much work</p>",
        "id": 236882515,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1619808039
    },
    {
        "content": "<p>I am very curious about this new trend. Can people explain why they choose to compile python instead of using prebuilt python? I can vaguely imagine people who would want a stripped down standard library for some reason, but here you seem surprised to discover you are missing part of the standard library. What's the story?</p>",
        "id": 236900313,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1619816259
    },
    {
        "content": "<p>I've been in that position before when using a shared-usage linux machine to which I don't have sudo access, and on which the system python is way too out of date.</p>",
        "id": 236913678,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1619822741
    },
    {
        "content": "<p>The error described in this thread happens pretty often to me while I am editing mathlib in VSCode. Seemingly out of nowhere, I get a error on every lemma on every file I open which says <br>\n<code>excessive memory consumption detected at 'replace' (potential solution: increase memory consumption threshold)</code></p>\n<p>Restarting lean does not fix the problem. My other troubleshooting routine is to run <code>leanproject get-mathlib-cache</code> which gives me <code>failed to fetch mathlib oleans</code>. When I run <code>lean --make src</code> it seems to go off without a hitch. I can't discern any pattern in what causes this to start happening. Is the takeaway from this thread that I should try to reinstall elan?</p>",
        "id": 237921791,
        "sender_full_name": "Bolton Bailey",
        "timestamp": 1620446067
    },
    {
        "content": "<p>An interesting observation: restarting VSCode itself seems to fix the issue</p>",
        "id": 237921865,
        "sender_full_name": "Bolton Bailey",
        "timestamp": 1620446160
    },
    {
        "content": "<p>Failed to fetch mathlib oleans just means that the mathlib commit you're working on isn't in the collection of compiled oleans that GitHub makes. It's easy to make that happen, eg edit a file in mathlib and then commit locally without pushing and waiting a few hours</p>",
        "id": 237935984,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1620460768
    }
]