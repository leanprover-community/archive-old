[
    {
        "content": "<p>Is there an easy way to avoid repetition in the proof below? I often end up repeating myself when proving biconditionals, I wonder if there is a technique or tactic that can be used in such cases.</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kn\">import</span> <span class=\"n\">tactic</span>\n\n<span class=\"kd\">noncomputable theory</span>\n\n<span class=\"kd\">axiom</span> <span class=\"n\">Set</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span>\n<span class=\"kd\">axiom</span> <span class=\"n\">mem</span> <span class=\"o\">:</span> <span class=\"n\">Set</span> <span class=\"bp\">→</span> <span class=\"n\">Set</span> <span class=\"bp\">→</span> <span class=\"kt\">Prop</span>\n<span class=\"kd\">instance</span> <span class=\"o\">:</span> <span class=\"n\">has_mem</span> <span class=\"n\">Set</span> <span class=\"n\">Set</span> <span class=\"o\">:=</span> <span class=\"o\">⟨</span><span class=\"n\">mem</span><span class=\"o\">⟩</span>\n\n<span class=\"kd\">@[ext]</span> <span class=\"kd\">axiom</span> <span class=\"n\">extensionality</span> <span class=\"o\">{</span><span class=\"n\">A</span> <span class=\"n\">B</span> <span class=\"o\">:</span> <span class=\"n\">Set</span><span class=\"o\">}</span> <span class=\"o\">(</span><span class=\"n\">h</span> <span class=\"o\">:</span> <span class=\"bp\">∀</span> <span class=\"n\">x</span><span class=\"o\">,</span> <span class=\"n\">x</span> <span class=\"bp\">∈</span> <span class=\"n\">A</span> <span class=\"bp\">↔</span> <span class=\"n\">x</span> <span class=\"bp\">∈</span> <span class=\"n\">B</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">A</span> <span class=\"bp\">=</span> <span class=\"n\">B</span>\n<span class=\"kd\">axiom</span> <span class=\"n\">pairing</span> <span class=\"o\">(</span><span class=\"n\">a</span> <span class=\"n\">b</span> <span class=\"o\">:</span> <span class=\"n\">Set</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"bp\">∃</span> <span class=\"n\">P</span> <span class=\"o\">:</span> <span class=\"n\">Set</span><span class=\"o\">,</span> <span class=\"bp\">∀</span> <span class=\"n\">x</span><span class=\"o\">,</span> <span class=\"n\">x</span> <span class=\"bp\">∈</span> <span class=\"n\">P</span> <span class=\"bp\">↔</span> <span class=\"n\">x</span> <span class=\"bp\">=</span> <span class=\"n\">a</span> <span class=\"bp\">∨</span> <span class=\"n\">x</span> <span class=\"bp\">=</span> <span class=\"n\">b</span>\n\n<span class=\"kd\">lemma</span> <span class=\"n\">fst_eq_fst_of_pair_eq_pair</span> <span class=\"o\">{</span><span class=\"n\">a₁</span> <span class=\"n\">a₂</span> <span class=\"n\">b₁</span> <span class=\"n\">b₂</span> <span class=\"o\">:</span> <span class=\"n\">Set</span><span class=\"o\">}</span>\n  <span class=\"o\">(</span><span class=\"n\">h</span> <span class=\"o\">:</span> <span class=\"bp\">∀</span> <span class=\"n\">z</span> <span class=\"o\">:</span> <span class=\"n\">Set</span><span class=\"o\">,</span> <span class=\"o\">(</span><span class=\"bp\">∀</span> <span class=\"n\">w</span><span class=\"o\">,</span> <span class=\"n\">w</span> <span class=\"bp\">∈</span> <span class=\"n\">z</span> <span class=\"bp\">↔</span> <span class=\"n\">w</span> <span class=\"bp\">=</span> <span class=\"n\">a₁</span><span class=\"o\">)</span> <span class=\"bp\">∨</span> <span class=\"o\">(</span><span class=\"bp\">∀</span> <span class=\"n\">w</span><span class=\"o\">,</span> <span class=\"n\">w</span> <span class=\"bp\">∈</span> <span class=\"n\">z</span> <span class=\"bp\">↔</span> <span class=\"n\">w</span> <span class=\"bp\">=</span> <span class=\"n\">a₁</span> <span class=\"bp\">∨</span> <span class=\"n\">w</span> <span class=\"bp\">=</span> <span class=\"n\">b₁</span><span class=\"o\">)</span> <span class=\"bp\">↔</span>\n                  <span class=\"o\">(</span><span class=\"bp\">∀</span> <span class=\"n\">w</span><span class=\"o\">,</span> <span class=\"n\">w</span> <span class=\"bp\">∈</span> <span class=\"n\">z</span> <span class=\"bp\">↔</span> <span class=\"n\">w</span> <span class=\"bp\">=</span> <span class=\"n\">a₂</span><span class=\"o\">)</span> <span class=\"bp\">∨</span> <span class=\"o\">(</span><span class=\"bp\">∀</span> <span class=\"n\">w</span><span class=\"o\">,</span> <span class=\"n\">w</span> <span class=\"bp\">∈</span> <span class=\"n\">z</span> <span class=\"bp\">↔</span> <span class=\"n\">w</span> <span class=\"bp\">=</span> <span class=\"n\">a₂</span> <span class=\"bp\">∨</span> <span class=\"n\">w</span> <span class=\"bp\">=</span> <span class=\"n\">b₂</span><span class=\"o\">))</span> <span class=\"o\">:</span> <span class=\"n\">a₁</span> <span class=\"bp\">=</span> <span class=\"n\">a₂</span> <span class=\"o\">:=</span>\n<span class=\"kd\">begin</span>\n  <span class=\"n\">ext</span> <span class=\"n\">x</span><span class=\"o\">,</span>\n  <span class=\"n\">split</span><span class=\"bp\">;</span> <span class=\"n\">intro</span> <span class=\"n\">hx</span><span class=\"o\">,</span>\n  <span class=\"o\">{</span> <span class=\"n\">obtain</span> <span class=\"o\">⟨</span><span class=\"n\">P</span><span class=\"o\">,</span> <span class=\"n\">hP</span><span class=\"o\">⟩</span> <span class=\"o\">:=</span> <span class=\"n\">pairing</span> <span class=\"n\">a₂</span> <span class=\"n\">a₂</span><span class=\"o\">,</span>\n    <span class=\"n\">simp</span> <span class=\"n\">only</span> <span class=\"o\">[</span><span class=\"n\">or_self</span><span class=\"o\">]</span> <span class=\"n\">at</span> <span class=\"n\">hP</span><span class=\"o\">,</span>\n    <span class=\"n\">obtain</span> <span class=\"o\">⟨</span><span class=\"n\">h₁</span><span class=\"o\">,</span> <span class=\"n\">h₂</span><span class=\"o\">⟩</span> <span class=\"o\">:=</span> <span class=\"n\">h</span> <span class=\"n\">P</span><span class=\"o\">,</span>\n    <span class=\"n\">clear</span> <span class=\"n\">h</span> <span class=\"n\">h₁</span><span class=\"o\">,</span>\n    <span class=\"n\">simp</span> <span class=\"o\">[</span><span class=\"n\">hP</span><span class=\"o\">]</span> <span class=\"n\">at</span> <span class=\"n\">h₂</span><span class=\"o\">,</span>\n    <span class=\"n\">cases</span> <span class=\"n\">h₂</span><span class=\"o\">,</span>\n    <span class=\"o\">{</span> <span class=\"n\">rwa</span> <span class=\"n\">h₂</span> <span class=\"o\">},</span>\n    <span class=\"o\">{</span> <span class=\"k\">have</span> <span class=\"o\">:=</span> <span class=\"n\">h₂</span> <span class=\"n\">a₁</span><span class=\"o\">,</span>\n      <span class=\"n\">simp</span> <span class=\"n\">at</span> <span class=\"n\">this</span><span class=\"o\">,</span>\n      <span class=\"n\">specialize</span> <span class=\"n\">h₂</span> <span class=\"n\">a₂</span><span class=\"o\">,</span>\n      <span class=\"n\">simp</span> <span class=\"n\">at</span> <span class=\"n\">h₂</span><span class=\"o\">,</span>\n      <span class=\"n\">cases</span> <span class=\"n\">h₂</span><span class=\"o\">,</span>\n      <span class=\"o\">{</span> <span class=\"n\">rwa</span> <span class=\"n\">h₂</span> <span class=\"o\">},</span>\n      <span class=\"o\">{</span> <span class=\"n\">substs</span> <span class=\"n\">h₂</span><span class=\"o\">,</span>\n        <span class=\"n\">rwa</span> <span class=\"bp\">←</span><span class=\"n\">this</span> <span class=\"o\">}</span> <span class=\"o\">}</span> <span class=\"o\">},</span>\n  <span class=\"c1\">-- Basically the same as above...</span>\n  <span class=\"o\">{</span> <span class=\"n\">obtain</span> <span class=\"o\">⟨</span><span class=\"n\">P</span><span class=\"o\">,</span> <span class=\"n\">hP</span><span class=\"o\">⟩</span> <span class=\"o\">:=</span> <span class=\"n\">pairing</span> <span class=\"n\">a₁</span> <span class=\"n\">a₁</span><span class=\"o\">,</span>\n    <span class=\"n\">simp</span> <span class=\"n\">only</span> <span class=\"o\">[</span><span class=\"n\">or_self</span><span class=\"o\">]</span> <span class=\"n\">at</span> <span class=\"n\">hP</span><span class=\"o\">,</span>\n    <span class=\"n\">obtain</span> <span class=\"o\">⟨</span><span class=\"n\">h₁</span><span class=\"o\">,</span> <span class=\"n\">h₂</span><span class=\"o\">⟩</span> <span class=\"o\">:=</span> <span class=\"n\">h</span> <span class=\"n\">P</span><span class=\"o\">,</span>\n    <span class=\"n\">clear</span> <span class=\"n\">h</span> <span class=\"n\">h₂</span><span class=\"o\">,</span>\n    <span class=\"n\">simp</span> <span class=\"o\">[</span><span class=\"n\">hP</span><span class=\"o\">]</span> <span class=\"n\">at</span> <span class=\"n\">h₁</span><span class=\"o\">,</span>\n    <span class=\"n\">cases</span> <span class=\"n\">h₁</span><span class=\"o\">,</span>\n    <span class=\"o\">{</span> <span class=\"n\">rwa</span> <span class=\"n\">h₁</span> <span class=\"o\">},</span>\n    <span class=\"o\">{</span> <span class=\"k\">have</span> <span class=\"o\">:=</span> <span class=\"n\">h₁</span> <span class=\"n\">a₂</span><span class=\"o\">,</span>\n      <span class=\"n\">simp</span> <span class=\"n\">at</span> <span class=\"n\">this</span><span class=\"o\">,</span>\n      <span class=\"n\">specialize</span> <span class=\"n\">h₁</span> <span class=\"n\">a₁</span><span class=\"o\">,</span>\n      <span class=\"n\">simp</span> <span class=\"n\">at</span> <span class=\"n\">h₁</span><span class=\"o\">,</span>\n      <span class=\"n\">cases</span> <span class=\"n\">h₁</span><span class=\"o\">,</span>\n      <span class=\"o\">{</span> <span class=\"n\">rwa</span> <span class=\"n\">h₁</span> <span class=\"o\">},</span>\n      <span class=\"o\">{</span> <span class=\"n\">substs</span> <span class=\"n\">h₁</span><span class=\"o\">,</span>\n        <span class=\"n\">rwa</span> <span class=\"bp\">←</span><span class=\"n\">this</span> <span class=\"o\">}</span> <span class=\"o\">}</span> <span class=\"o\">}</span>\n<span class=\"kd\">end</span>\n</code></pre></div>",
        "id": 267219338,
        "sender_full_name": "Pedro Minicz",
        "timestamp": 1641577736
    },
    {
        "content": "<p>One thing you could try is to prove a general statement of the principle you’re using as <code>have aux_lemma : …</code> and then apply that in each of the two cases.</p>",
        "id": 267221338,
        "sender_full_name": "Stuart Presnell",
        "timestamp": 1641578684
    },
    {
        "content": "<p>Taking Stuart's thought a little further. If you want to avoid repeating yourself it's quite often possible the same way as we do in regular programming, if we have a function and notice we are repeating ourselves just pull out stuff into an additional function. And since proof=function this applies here as well.</p>\n<p>Alternatively you could look into proof combinators such as e.g. <code>;</code> which repeats a tactic on all subgoals create by another statement (there are many more) or more heavily automated proofs.</p>",
        "id": 267225952,
        "sender_full_name": "Henrik Böving",
        "timestamp": 1641580986
    },
    {
        "content": "<p>The right way to do it would be to write another lemma and cover the differences between the cases by the lemma parameters. There is also <a href=\"https://leanprover-community.github.io/mathlib_docs/find/tactic.wlog\">docs#tactic.wlog</a> that reduces multiple subgoals to just one, if you prove that the generality is not lost.</p>\n<p>BTW, in this particular case, <code>finish</code> seems to be smart enough to prove it automatically:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kd\">lemma</span> <span class=\"n\">fst_eq_fst_of_pair_eq_pair</span> <span class=\"o\">{</span><span class=\"n\">a₁</span> <span class=\"n\">a₂</span> <span class=\"n\">b₁</span> <span class=\"n\">b₂</span> <span class=\"o\">:</span> <span class=\"n\">Set</span><span class=\"o\">}</span>\n  <span class=\"o\">(</span><span class=\"n\">h</span> <span class=\"o\">:</span> <span class=\"bp\">∀</span> <span class=\"n\">z</span> <span class=\"o\">:</span> <span class=\"n\">Set</span><span class=\"o\">,</span> <span class=\"o\">(</span><span class=\"bp\">∀</span> <span class=\"n\">w</span><span class=\"o\">,</span> <span class=\"n\">w</span> <span class=\"bp\">∈</span> <span class=\"n\">z</span> <span class=\"bp\">↔</span> <span class=\"n\">w</span> <span class=\"bp\">=</span> <span class=\"n\">a₁</span><span class=\"o\">)</span> <span class=\"bp\">∨</span> <span class=\"o\">(</span><span class=\"bp\">∀</span> <span class=\"n\">w</span><span class=\"o\">,</span> <span class=\"n\">w</span> <span class=\"bp\">∈</span> <span class=\"n\">z</span> <span class=\"bp\">↔</span> <span class=\"n\">w</span> <span class=\"bp\">=</span> <span class=\"n\">a₁</span> <span class=\"bp\">∨</span> <span class=\"n\">w</span> <span class=\"bp\">=</span> <span class=\"n\">b₁</span><span class=\"o\">)</span> <span class=\"bp\">↔</span>\n                  <span class=\"o\">(</span><span class=\"bp\">∀</span> <span class=\"n\">w</span><span class=\"o\">,</span> <span class=\"n\">w</span> <span class=\"bp\">∈</span> <span class=\"n\">z</span> <span class=\"bp\">↔</span> <span class=\"n\">w</span> <span class=\"bp\">=</span> <span class=\"n\">a₂</span><span class=\"o\">)</span> <span class=\"bp\">∨</span> <span class=\"o\">(</span><span class=\"bp\">∀</span> <span class=\"n\">w</span><span class=\"o\">,</span> <span class=\"n\">w</span> <span class=\"bp\">∈</span> <span class=\"n\">z</span> <span class=\"bp\">↔</span> <span class=\"n\">w</span> <span class=\"bp\">=</span> <span class=\"n\">a₂</span> <span class=\"bp\">∨</span> <span class=\"n\">w</span> <span class=\"bp\">=</span> <span class=\"n\">b₂</span><span class=\"o\">))</span> <span class=\"o\">:</span> <span class=\"n\">a₁</span> <span class=\"bp\">=</span> <span class=\"n\">a₂</span> <span class=\"o\">:=</span>\n<span class=\"kd\">begin</span>\n  <span class=\"n\">obtain</span> <span class=\"o\">⟨</span><span class=\"n\">s₁</span><span class=\"o\">,</span> <span class=\"n\">h₁</span><span class=\"o\">⟩</span> <span class=\"o\">:=</span> <span class=\"n\">pairing</span> <span class=\"n\">a₁</span> <span class=\"n\">a₁</span><span class=\"o\">,</span> <span class=\"n\">obtain</span> <span class=\"o\">⟨</span><span class=\"n\">s₂</span><span class=\"o\">,</span> <span class=\"n\">h₂</span><span class=\"o\">⟩</span> <span class=\"o\">:=</span> <span class=\"n\">pairing</span> <span class=\"n\">a₂</span> <span class=\"n\">a₂</span><span class=\"o\">,</span>\n  <span class=\"k\">have</span> <span class=\"n\">h₃</span> <span class=\"o\">:=</span> <span class=\"n\">h</span> <span class=\"n\">s₁</span><span class=\"o\">,</span> <span class=\"k\">have</span> <span class=\"n\">h₄</span> <span class=\"o\">:=</span> <span class=\"n\">h</span> <span class=\"n\">s₂</span><span class=\"o\">,</span> <span class=\"n\">finish</span><span class=\"o\">,</span>\n<span class=\"kd\">end</span>\n</code></pre></div>",
        "id": 267226624,
        "sender_full_name": "Patrick Johnson",
        "timestamp": 1641581275
    },
    {
        "content": "<p>Sometimes it makes sense to pull out a separate lemma, but if you're planning to PR something to mathlib you should consider whether that lemma is something that will be used more generally or if it's only of interest for this one specific proof.  In the latter case you should perhaps just inline it.</p>",
        "id": 267227924,
        "sender_full_name": "Stuart Presnell",
        "timestamp": 1641581824
    }
]