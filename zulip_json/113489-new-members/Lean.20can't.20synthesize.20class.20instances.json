[
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kn\">import</span> <span class=\"n\">tactic</span>\n<span class=\"kn\">import</span> <span class=\"n\">data.mv_polynomial.rename</span>\n\n<span class=\"kn\">open</span> <span class=\"n\">equiv</span> <span class=\"o\">(</span><span class=\"n\">perm</span><span class=\"o\">)</span>\n<span class=\"n\">open_locale</span> <span class=\"n\">big_operators</span>\n\n<span class=\"kd\">noncomputable theory</span>\n\n<span class=\"kn\">namespace</span> <span class=\"n\">mv_polynomial</span>\n\n<span class=\"kd\">variables</span> <span class=\"o\">{</span><span class=\"n\">σ</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span> <span class=\"o\">{</span><span class=\"n\">R</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span>\n<span class=\"kd\">variables</span> <span class=\"o\">{</span><span class=\"n\">τ</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span> <span class=\"o\">{</span><span class=\"n\">S</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span>\n\n<span class=\"kd\">def</span> <span class=\"n\">is_symmetric</span> <span class=\"o\">[</span><span class=\"n\">comm_semiring</span> <span class=\"n\">R</span><span class=\"o\">]</span> <span class=\"o\">(</span><span class=\"n\">φ</span> <span class=\"o\">:</span> <span class=\"n\">mv_polynomial</span> <span class=\"n\">σ</span> <span class=\"n\">R</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"kt\">Prop</span> <span class=\"o\">:=</span>\n<span class=\"bp\">∀</span> <span class=\"n\">e</span> <span class=\"o\">:</span> <span class=\"n\">perm</span> <span class=\"n\">σ</span><span class=\"o\">,</span> <span class=\"n\">rename</span> <span class=\"n\">e</span> <span class=\"n\">φ</span> <span class=\"bp\">=</span> <span class=\"n\">φ</span>\n\n<span class=\"kn\">namespace</span> <span class=\"n\">is_symmetric</span>\n\n<span class=\"kd\">variables</span> <span class=\"o\">[</span><span class=\"n\">comm_semiring</span> <span class=\"n\">R</span><span class=\"o\">]</span> <span class=\"o\">[</span><span class=\"n\">comm_semiring</span> <span class=\"n\">S</span><span class=\"o\">]</span> <span class=\"o\">{</span><span class=\"n\">φ</span> <span class=\"n\">ψ</span> <span class=\"o\">:</span> <span class=\"n\">mv_polynomial</span> <span class=\"n\">σ</span> <span class=\"n\">R</span><span class=\"o\">}</span>\n\n<span class=\"kd\">@[simp]</span>\n<span class=\"kd\">lemma</span> <span class=\"n\">neg</span> <span class=\"o\">(</span><span class=\"n\">hφ</span> <span class=\"o\">:</span> <span class=\"n\">is_symmetric</span> <span class=\"n\">φ</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">is_symmetric</span> <span class=\"o\">(</span><span class=\"bp\">-</span><span class=\"n\">φ</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"kd\">by</span> <span class=\"gr\">sorry</span> <span class=\"c1\">-- fails, \"failed to synthesize type class instance for `has_neg (mv_polynomial σ R)`\"</span>\n\n<span class=\"kd\">end</span> <span class=\"n\">is_symmetric</span>\n\n<span class=\"kd\">end</span> <span class=\"n\">mv_polynomial</span>\n</code></pre></div>\n<p>What is going on?</p>",
        "id": 222998263,
        "sender_full_name": "Hanting Zhang",
        "timestamp": 1610822429
    },
    {
        "content": "<p>I'm not sure if you have to have <code>comm_semiring R</code>, but if I change it to <code>comm_ring R</code> and add an import then it works.</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kn\">import</span> <span class=\"n\">tactic</span>\n<span class=\"kn\">import</span> <span class=\"n\">data.mv_polynomial.rename</span>\n<span class=\"kn\">import</span> <span class=\"n\">data.mv_polynomial.comm_ring</span> <span class=\"c1\">-- NEW IMPORT</span>\n\n<span class=\"kn\">open</span> <span class=\"n\">equiv</span> <span class=\"o\">(</span><span class=\"n\">perm</span><span class=\"o\">)</span>\n<span class=\"n\">open_locale</span> <span class=\"n\">big_operators</span>\n\n<span class=\"kd\">noncomputable theory</span>\n\n<span class=\"kn\">namespace</span> <span class=\"n\">mv_polynomial</span>\n\n<span class=\"kd\">variables</span> <span class=\"o\">{</span><span class=\"n\">σ</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span> <span class=\"o\">{</span><span class=\"n\">R</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span>\n<span class=\"kd\">variables</span> <span class=\"o\">{</span><span class=\"n\">τ</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span> <span class=\"o\">{</span><span class=\"n\">S</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span>\n\n<span class=\"kd\">def</span> <span class=\"n\">is_symmetric</span> <span class=\"o\">[</span><span class=\"n\">comm_semiring</span> <span class=\"n\">R</span><span class=\"o\">]</span> <span class=\"o\">(</span><span class=\"n\">φ</span> <span class=\"o\">:</span> <span class=\"n\">mv_polynomial</span> <span class=\"n\">σ</span> <span class=\"n\">R</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"kt\">Prop</span> <span class=\"o\">:=</span>\n<span class=\"bp\">∀</span> <span class=\"n\">e</span> <span class=\"o\">:</span> <span class=\"n\">perm</span> <span class=\"n\">σ</span><span class=\"o\">,</span> <span class=\"n\">rename</span> <span class=\"n\">e</span> <span class=\"n\">φ</span> <span class=\"bp\">=</span> <span class=\"n\">φ</span>\n\n<span class=\"kn\">namespace</span> <span class=\"n\">is_symmetric</span>\n\n<span class=\"kd\">variables</span> <span class=\"o\">[</span><span class=\"n\">comm_ring</span> <span class=\"n\">R</span><span class=\"o\">]</span> <span class=\"o\">[</span><span class=\"n\">comm_semiring</span> <span class=\"n\">S</span><span class=\"o\">]</span> <span class=\"o\">{</span><span class=\"n\">φ</span> <span class=\"n\">ψ</span> <span class=\"o\">:</span> <span class=\"n\">mv_polynomial</span> <span class=\"n\">σ</span> <span class=\"n\">R</span><span class=\"o\">}</span> <span class=\"c1\">-- CHANGED FROM [comm_semiring] TO [comm_ring R]</span>\n\n<span class=\"kd\">@[simp]</span>\n<span class=\"kd\">lemma</span> <span class=\"n\">neg</span> <span class=\"o\">(</span><span class=\"n\">hφ</span> <span class=\"o\">:</span> <span class=\"n\">is_symmetric</span> <span class=\"n\">φ</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">is_symmetric</span> <span class=\"o\">(</span><span class=\"bp\">-</span><span class=\"n\">φ</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"kd\">by</span> <span class=\"gr\">sorry</span> <span class=\"c1\">-- WORKS NOW</span>\n\n<span class=\"kd\">end</span> <span class=\"n\">is_symmetric</span>\n\n<span class=\"kd\">end</span> <span class=\"n\">mv_polynomial</span>\n</code></pre></div>",
        "id": 222999649,
        "sender_full_name": "Shing Tak Lam",
        "timestamp": 1610823699
    },
    {
        "content": "<p>Thanks! I forgot about <code>comm_semiring R</code>. Why does the <code>data.mv_polynomial.comm_ring</code> import matter though? Does the type class inference system need it?</p>",
        "id": 222999969,
        "sender_full_name": "Hanting Zhang",
        "timestamp": 1610823969
    },
    {
        "content": "<p>I think the <code>comm_ring</code> instance is defined in <code>data.mv_polynomial.comm_ring</code>, and <code>data.mv_polynomial.rename</code> doesn't import <code>data.mv_polynomial.comm_ring</code>, so the instance isn't available until you import that file.</p>",
        "id": 223000236,
        "sender_full_name": "Shing Tak Lam",
        "timestamp": 1610824244
    },
    {
        "content": "<p>Ah, ok, thanks!</p>",
        "id": 223000347,
        "sender_full_name": "Hanting Zhang",
        "timestamp": 1610824370
    }
]