[
    {
        "content": "<p>Am I missing something that I can use from Pi lemmas? Or are there lemmas missing about pair types? I'm trying to prove lemmas about higher-dim dot products, and am hitting issues proving the following generalized lemma:</p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"kn\">import</span> <span class=\"n\">data</span><span class=\"bp\">.</span><span class=\"n\">finset</span>\n\n<span class=\"kn\">universe</span> <span class=\"n\">u</span>\n<span class=\"kn\">variables</span> <span class=\"o\">{</span><span class=\"n\">α</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span> <span class=\"n\">u</span><span class=\"o\">}</span> <span class=\"o\">[</span><span class=\"n\">add_comm_monoid</span> <span class=\"n\">α</span><span class=\"o\">]</span>\n\n<span class=\"n\">open_locale</span> <span class=\"n\">big_operators</span>\n\n<span class=\"kn\">example</span> <span class=\"o\">{</span><span class=\"n\">u</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span> <span class=\"o\">{</span><span class=\"n\">v</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span> <span class=\"o\">[</span><span class=\"n\">fintype</span> <span class=\"n\">u</span><span class=\"o\">]</span> <span class=\"o\">[</span><span class=\"n\">fintype</span> <span class=\"n\">v</span><span class=\"o\">]</span> <span class=\"o\">(</span><span class=\"n\">f</span> <span class=\"o\">:</span> <span class=\"n\">u</span> <span class=\"bp\">×</span> <span class=\"n\">v</span> <span class=\"bp\">-&gt;</span> <span class=\"n\">α</span><span class=\"o\">)</span> <span class=\"o\">:</span>\n  <span class=\"err\">∑</span> <span class=\"o\">(</span><span class=\"n\">i</span> <span class=\"o\">:</span> <span class=\"n\">u</span><span class=\"o\">),</span> <span class=\"err\">∑</span> <span class=\"o\">(</span><span class=\"n\">j</span> <span class=\"o\">:</span> <span class=\"n\">v</span><span class=\"o\">),</span> <span class=\"n\">f</span> <span class=\"o\">(</span><span class=\"n\">i</span><span class=\"o\">,</span> <span class=\"n\">j</span><span class=\"o\">)</span> <span class=\"bp\">=</span> <span class=\"err\">∑</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"o\">:</span> <span class=\"n\">u</span> <span class=\"bp\">×</span> <span class=\"n\">v</span><span class=\"o\">),</span> <span class=\"n\">f</span> <span class=\"n\">p</span> <span class=\"o\">:=</span>\n<span class=\"k\">begin</span>\n  <span class=\"n\">rw</span> <span class=\"bp\">&lt;-</span><span class=\"n\">finset</span><span class=\"bp\">.</span><span class=\"n\">sum_product</span><span class=\"o\">,</span>\n  <span class=\"n\">repeat</span> <span class=\"o\">{</span> <span class=\"n\">rw</span> <span class=\"n\">finset</span><span class=\"bp\">.</span><span class=\"n\">univ</span> <span class=\"o\">},</span>\n  <span class=\"n\">sorry</span><span class=\"o\">,</span>\n<span class=\"kn\">end</span>\n</code></pre></div>\n\n\n<p>It's getting into the morass of fintype.elems and finsets.</p>",
        "id": 201787474,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1592948546
    },
    {
        "content": "<p>This'll probably be <code>refl</code> after <code>rw &lt;- finset.sum_product</code>. I don't think it's in the library already and it should be added.</p>",
        "id": 201787938,
        "sender_full_name": "Chris Hughes",
        "timestamp": 1592948774
    },
    {
        "content": "<p>It won't be <code>refl</code> actually.</p>",
        "id": 201787992,
        "sender_full_name": "Chris Hughes",
        "timestamp": 1592948817
    },
    {
        "content": "<p>It is <code>refl</code></p>",
        "id": 201788148,
        "sender_full_name": "Chris Hughes",
        "timestamp": 1592948918
    },
    {
        "content": "<p>Do you think it should be in mathlib in this forward, or in the backward direction?</p>",
        "id": 201789470,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1592949692
    },
    {
        "content": "<p>It's been my recent experience that there aren't a lot of lemmas that work directly on pair types, so perhaps expanding out the pair into the double sum is the better direction.</p>",
        "id": 201789549,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1592949723
    },
    {
        "content": "<p>It should be the same direction as <code>finset.sum_product</code></p>",
        "id": 201789689,
        "sender_full_name": "Chris Hughes",
        "timestamp": 1592949809
    },
    {
        "content": "<p>And where would it go? <code>algebra.big_operators</code> has no lemmas that utilize <code>[fintype \\a]</code>. Would it be alright to change the imports to introduce <code>fintype</code>?</p>",
        "id": 201791709,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1592951099
    },
    {
        "content": "<p>Those lemmas are in <code>data.fintype</code> I think</p>",
        "id": 201795924,
        "sender_full_name": "Reid Barton",
        "timestamp": 1592953874
    },
    {
        "content": "<p>Thanks for that guidance. Using that now-defined lemma, I'm trying to prove the equivalent of <code>fin.sum_univ_succ</code> for pair types, and am running into issues, culminating in getting fin to nat coercion to work. My computer has been crashing on memory with Lean and VSCode, so I've had to limit it's available memory. This prevents me from using library_search, so I'm relying a lot on <code>refine _</code> suggested by <code>suggest</code>. I'm sure this proof can be cleaned up a lot. But the current issue is the final coercion from nat to fin back to nat. It could also be that this has been proved in a more general way for some <code>\\Pi u</code> type, I just don't know how to find it, or how to specialize it for pairs. I'd be happy to develop the more general <code>\\Pi</code> version if I better understood how pi_finsets work.</p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"kn\">import</span> <span class=\"n\">data</span><span class=\"bp\">.</span><span class=\"n\">matrix</span><span class=\"bp\">.</span><span class=\"kn\">notation</span>\n\n<span class=\"kn\">universe</span> <span class=\"n\">u</span>\n<span class=\"kn\">variables</span> <span class=\"o\">{</span><span class=\"n\">α</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span> <span class=\"n\">u</span><span class=\"o\">}</span> <span class=\"o\">[</span><span class=\"n\">add_comm_monoid</span> <span class=\"n\">α</span><span class=\"o\">]</span> <span class=\"o\">[</span><span class=\"n\">has_mul</span> <span class=\"n\">α</span><span class=\"o\">]</span>\n\n<span class=\"n\">open_locale</span> <span class=\"n\">big_operators</span>\n\n<span class=\"bp\">@</span><span class=\"o\">[</span><span class=\"n\">simp</span><span class=\"o\">]</span> <span class=\"kn\">lemma</span> <span class=\"n\">sum_prod</span> <span class=\"o\">{</span><span class=\"n\">u</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span> <span class=\"o\">{</span><span class=\"n\">v</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span> <span class=\"o\">[</span><span class=\"n\">fintype</span> <span class=\"n\">u</span><span class=\"o\">]</span> <span class=\"o\">[</span><span class=\"n\">fintype</span> <span class=\"n\">v</span><span class=\"o\">]</span> <span class=\"o\">(</span><span class=\"n\">f</span> <span class=\"o\">:</span> <span class=\"n\">u</span> <span class=\"bp\">×</span> <span class=\"n\">v</span> <span class=\"bp\">-&gt;</span> <span class=\"n\">α</span><span class=\"o\">)</span> <span class=\"o\">:</span>\n  <span class=\"err\">∑</span> <span class=\"o\">(</span><span class=\"n\">i</span> <span class=\"o\">:</span> <span class=\"n\">u</span><span class=\"o\">),</span> <span class=\"err\">∑</span> <span class=\"o\">(</span><span class=\"n\">j</span> <span class=\"o\">:</span> <span class=\"n\">v</span><span class=\"o\">),</span> <span class=\"n\">f</span> <span class=\"o\">(</span><span class=\"n\">i</span><span class=\"o\">,</span> <span class=\"n\">j</span><span class=\"o\">)</span> <span class=\"bp\">=</span> <span class=\"err\">∑</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"o\">:</span> <span class=\"n\">u</span> <span class=\"bp\">×</span> <span class=\"n\">v</span><span class=\"o\">),</span> <span class=\"n\">f</span> <span class=\"n\">p</span> <span class=\"o\">:=</span>\n<span class=\"k\">begin</span>\n  <span class=\"n\">rw</span> <span class=\"bp\">&lt;-</span><span class=\"n\">finset</span><span class=\"bp\">.</span><span class=\"n\">sum_product</span><span class=\"o\">,</span>\n  <span class=\"n\">refl</span>\n<span class=\"kn\">end</span>\n\n<span class=\"kn\">example</span> <span class=\"o\">{</span><span class=\"n\">u</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span> <span class=\"o\">{</span><span class=\"n\">n</span> <span class=\"o\">:</span> <span class=\"bp\">ℕ</span><span class=\"o\">}</span> <span class=\"o\">[</span><span class=\"n\">fintype</span> <span class=\"n\">u</span><span class=\"o\">]</span> <span class=\"o\">[</span><span class=\"n\">decidable_eq</span> <span class=\"n\">u</span><span class=\"o\">]</span> <span class=\"o\">(</span><span class=\"n\">v</span> <span class=\"o\">:</span> <span class=\"n\">fin</span> <span class=\"n\">n</span><span class=\"bp\">.</span><span class=\"n\">succ</span> <span class=\"bp\">×</span> <span class=\"n\">u</span> <span class=\"bp\">-&gt;</span> <span class=\"n\">α</span><span class=\"o\">)</span> <span class=\"o\">:</span>\n   <span class=\"err\">∑</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"o\">:</span> <span class=\"n\">fin</span> <span class=\"n\">n</span><span class=\"bp\">.</span><span class=\"n\">succ</span> <span class=\"bp\">×</span> <span class=\"n\">u</span><span class=\"o\">),</span> <span class=\"n\">v</span> <span class=\"n\">p</span> <span class=\"bp\">=</span>\n   <span class=\"err\">∑</span> <span class=\"o\">(</span><span class=\"n\">i</span> <span class=\"o\">:</span> <span class=\"n\">u</span><span class=\"o\">),</span> <span class=\"n\">v</span> <span class=\"o\">(</span><span class=\"mi\">0</span><span class=\"o\">,</span> <span class=\"n\">i</span><span class=\"o\">)</span> <span class=\"bp\">+</span> <span class=\"err\">∑</span> <span class=\"o\">(</span><span class=\"n\">ki</span> <span class=\"o\">:</span> <span class=\"n\">fin</span> <span class=\"n\">n</span> <span class=\"bp\">×</span> <span class=\"n\">u</span><span class=\"o\">),</span> <span class=\"n\">v</span> <span class=\"o\">(</span><span class=\"n\">nat</span><span class=\"bp\">.</span><span class=\"n\">succ</span> <span class=\"n\">ki</span><span class=\"bp\">.</span><span class=\"n\">fst</span><span class=\"o\">,</span> <span class=\"n\">ki</span><span class=\"bp\">.</span><span class=\"n\">snd</span><span class=\"o\">)</span> <span class=\"o\">:=</span>\n<span class=\"k\">begin</span>\n  <span class=\"n\">rw</span> <span class=\"bp\">&lt;-@</span><span class=\"n\">sum_prod</span> <span class=\"n\">α</span> <span class=\"bp\">_</span> <span class=\"o\">(</span><span class=\"k\">by</span> <span class=\"n\">apply_instance</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">fin</span> <span class=\"n\">n</span><span class=\"o\">)</span> <span class=\"n\">u</span> <span class=\"bp\">_</span><span class=\"o\">,</span>\n  <span class=\"n\">rw</span> <span class=\"n\">finset</span><span class=\"bp\">.</span><span class=\"n\">sum_comm</span><span class=\"o\">,</span>\n  <span class=\"n\">rw</span> <span class=\"bp\">&lt;-</span><span class=\"n\">finset</span><span class=\"bp\">.</span><span class=\"n\">sum_add_distrib</span><span class=\"o\">,</span>\n  <span class=\"n\">rw</span> <span class=\"bp\">&lt;-</span><span class=\"n\">sum_prod</span><span class=\"o\">,</span>\n  <span class=\"n\">rw</span> <span class=\"n\">finset</span><span class=\"bp\">.</span><span class=\"n\">sum_comm</span><span class=\"o\">,</span>\n  <span class=\"n\">simp_rw</span> <span class=\"n\">fin</span><span class=\"bp\">.</span><span class=\"n\">sum_univ_succ</span><span class=\"o\">,</span>\n  <span class=\"n\">refine</span> <span class=\"n\">congr_arg</span> <span class=\"n\">finset</span><span class=\"bp\">.</span><span class=\"n\">univ</span><span class=\"bp\">.</span><span class=\"n\">sum</span> <span class=\"bp\">_</span><span class=\"o\">,</span>\n  <span class=\"n\">ext</span> <span class=\"n\">i</span><span class=\"o\">,</span>\n  <span class=\"n\">refine</span> <span class=\"n\">congr_arg</span> <span class=\"o\">((</span><span class=\"bp\">+</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">v</span> <span class=\"o\">(</span><span class=\"mi\">0</span><span class=\"o\">,</span> <span class=\"n\">i</span><span class=\"o\">)))</span> <span class=\"bp\">_</span><span class=\"o\">,</span>\n  <span class=\"n\">refine</span> <span class=\"n\">congr_arg</span> <span class=\"n\">finset</span><span class=\"bp\">.</span><span class=\"n\">univ</span><span class=\"bp\">.</span><span class=\"n\">sum</span> <span class=\"bp\">_</span><span class=\"o\">,</span>\n  <span class=\"n\">ext</span> <span class=\"n\">j</span><span class=\"o\">,</span>\n  <span class=\"n\">refine</span> <span class=\"n\">congr_arg</span> <span class=\"n\">v</span> <span class=\"bp\">_</span><span class=\"o\">,</span>\n  <span class=\"n\">rw</span> <span class=\"n\">prod</span><span class=\"bp\">.</span><span class=\"n\">eq_iff_fst_eq_snd_eq</span><span class=\"o\">,</span>\n  <span class=\"n\">split</span><span class=\"o\">,</span>\n  <span class=\"o\">{</span> <span class=\"n\">rw</span> <span class=\"n\">fin</span><span class=\"bp\">.</span><span class=\"n\">coe_eq_val</span><span class=\"o\">,</span>\n    <span class=\"n\">rw</span> <span class=\"n\">fin</span><span class=\"bp\">.</span><span class=\"n\">eq_iff_veq</span><span class=\"o\">,</span>\n    <span class=\"n\">rw</span> <span class=\"n\">fin</span><span class=\"bp\">.</span><span class=\"n\">succ_val</span><span class=\"o\">,</span>\n    <span class=\"n\">cases</span> <span class=\"n\">j</span><span class=\"o\">,</span>\n    <span class=\"n\">rw</span> <span class=\"n\">nat</span><span class=\"bp\">.</span><span class=\"n\">succ_eq_add_one</span><span class=\"o\">,</span>\n    <span class=\"n\">rw</span> <span class=\"bp\">&lt;-</span><span class=\"n\">fin</span><span class=\"bp\">.</span><span class=\"n\">coe_eq_val</span><span class=\"o\">,</span>\n    <span class=\"n\">sorry</span> <span class=\"o\">},</span> <span class=\"c1\">-- j_val + 1 = ↑↑(j_val + 1)</span>\n  <span class=\"o\">{</span> <span class=\"n\">refl</span> <span class=\"o\">}</span>\n<span class=\"kn\">end</span>\n</code></pre></div>",
        "id": 201808628,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1592969360
    },
    {
        "content": "<p>There might be some cleaner way to do this with <code>finset.prod_image, finset.prod_insert</code>, but I think it would have to be on the pi_finsets</p>",
        "id": 201808715,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1592969478
    },
    {
        "content": "<p>Currently there are a bunch of lemmas that need both <code>fintype</code> and <code>big_operators</code> in <code>data.finitype.card</code>. I think that's a reasonably bad name. Probably that file should be renamed to <code>data.fintype.big_operators</code></p>",
        "id": 201814434,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1592979295
    },
    {
        "content": "<p>Maybe even better: all those lemmas don't belong in <code>data.*</code></p>",
        "id": 201814447,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1592979323
    },
    {
        "content": "<p>I'm not sure if they belong in <code>algebra.*</code> either. I think initially the goal was to have <code>algebra.*</code> mean \"algebraic hierarchy\" and it should only contain the definitions (of groups, rings, what have you) and the most basic lemmas.<br>\nSo maybe the bigops stuff should all move to <code>group_theory.*</code></p>",
        "id": 201814511,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1592979389
    },
    {
        "content": "<p>Would it make more sense to PR in a couple of small lemmas still into <code>data.fintype.card</code>, and then rearrange later?</p>",
        "id": 201815349,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1592980624
    },
    {
        "content": "<p>It might be easier to do the rearrangement when a critical mass has formed</p>",
        "id": 201815361,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1592980643
    },
    {
        "content": "<p>Whatever you want. But a \"rename a file PR\" could also be done right now</p>",
        "id": 201815420,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1592980684
    },
    {
        "content": "<p>In any case, I'm still struggling on how to prove:</p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"kn\">import</span> <span class=\"n\">data</span><span class=\"bp\">.</span><span class=\"n\">finset</span>\n<span class=\"kn\">import</span> <span class=\"n\">tactic</span>\n\n<span class=\"kn\">example</span> <span class=\"o\">{</span><span class=\"n\">n</span> <span class=\"o\">:</span> <span class=\"bp\">ℕ</span><span class=\"o\">}</span> <span class=\"o\">(</span><span class=\"n\">x</span> <span class=\"o\">:</span> <span class=\"n\">fin</span> <span class=\"n\">n</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">x</span><span class=\"bp\">.</span><span class=\"n\">succ</span> <span class=\"bp\">=</span> <span class=\"err\">↑</span><span class=\"o\">((</span><span class=\"err\">↑</span><span class=\"n\">x</span> <span class=\"o\">:</span> <span class=\"n\">fin</span> <span class=\"o\">(</span><span class=\"n\">n</span> <span class=\"bp\">+</span> <span class=\"mi\">1</span><span class=\"o\">))</span><span class=\"bp\">.</span><span class=\"n\">succ</span><span class=\"o\">)</span> <span class=\"o\">:=</span>\n<span class=\"k\">begin</span>\n  <span class=\"n\">unfold_coes</span><span class=\"o\">,</span>\n  <span class=\"n\">rw</span> <span class=\"n\">fin</span><span class=\"bp\">.</span><span class=\"n\">eq_iff_veq</span><span class=\"o\">,</span>\n  <span class=\"n\">sorry</span><span class=\"o\">,</span> <span class=\"c1\">-- x.succ.val = x.val.cast.succ.val.cast.val</span>\n<span class=\"kn\">end</span>\n</code></pre></div>",
        "id": 201815440,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1592980721
    },
    {
        "content": "<p>There's some weird diamond going on with <code>val</code>, <code>cast</code>, and <code>succ</code> where I can't eliminate any of them</p>",
        "id": 201815474,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1592980790
    },
    {
        "content": "<p>In which type is that equality taking place?</p>",
        "id": 201815743,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1592981091
    },
    {
        "content": "<p>As far as I understand, it should be taking place in <code>fin (n + 1)</code></p>",
        "id": 201815825,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1592981194
    },
    {
        "content": "<p><del>but since there is no arrow on the left, it's probably in <code>fin n</code></del></p>",
        "id": 201815837,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1592981217
    },
    {
        "content": "<p>So on the rhs you are casting <code>x</code> to <code>fin (n+1)</code>, then taking <code>succ</code>, which moves it to <code>fin (n+2)</code> and then casting back?</p>",
        "id": 201815991,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1592981416
    },
    {
        "content": "<p>(deleted)<br>\nWhoops, had my cursor in the wrong place.</p>",
        "id": 201816004,
        "sender_full_name": "Bryan Gin-ge Chen",
        "timestamp": 1592981461
    },
    {
        "content": "<p>I guess it is in nat after the <code>rw fin.eq_iff_veq</code>, but the statement at the top is in <code>fin (n + 1)</code></p>",
        "id": 201816076,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1592981579
    },
    {
        "content": "<p>I think the right hand side is going to <code>fin n --val--&gt; nat --cast--&gt; fin (n + 1) --succ--&gt; fin (n + 1) --val--&gt; nat --cast--&gt; fin (n + 1)</code></p>",
        "id": 201816166,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1592981715
    },
    {
        "content": "<p>Right... if possible, I would try to avoid that <span aria-label=\"stuck out tongue wink\" class=\"emoji emoji-1f61c\" role=\"img\" title=\"stuck out tongue wink\">:stuck_out_tongue_wink:</span></p>",
        "id": 201816452,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1592982044
    },
    {
        "content": "<p>Or is it <code>fin n --val--&gt; nat --cast--&gt; fin (n + 1) --succ--&gt; fin (n + 2) --val--&gt; nat --cast--&gt; fin (n + 2)</code></p>",
        "id": 201816453,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1592982044
    },
    {
        "content": "<p>It is</p>\n<div class=\"codehilite\"><pre><span></span><code>fin n --val--&gt; nat --cast--&gt; fin (n + 1) --succ--&gt; fin (n + 2) --val--&gt; nat --cast--&gt; fin (n + 1)\n</code></pre></div>",
        "id": 201816465,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1592982076
    },
    {
        "content": "<p>And the cast from <code>nat</code> to <code>fin (? + 1)</code> is taking <code>i</code> to <code>i % (?+1)</code></p>",
        "id": 201816483,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1592982112
    },
    {
        "content": "<p>This proof will be a bit messy, because of all those casts</p>",
        "id": 201816527,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1592982130
    },
    {
        "content": "<p>Well it goes back to the proof I'm trying to show above, that sums broken up over pair types works out. The current sum lemmas are on plain <code>fin</code> types, and I don't understand how to employ the <code>pi_finset</code> to prove about pairs.</p>",
        "id": 201816542,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1592982150
    },
    {
        "content": "<p>hence, maybe it's easier to take a small step back, and see if you can avoid it all together</p>",
        "id": 201816546,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1592982154
    },
    {
        "content": "<p>Can you instead use sums over <code>finset.range n</code>?</p>",
        "id": 201816564,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1592982182
    },
    {
        "content": "<p>There is also <code>finset.product</code> to take the cartesian product of two finsets</p>",
        "id": 201816613,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1592982240
    },
    {
        "content": "<p>I would imagine that any proof which involves some funny map from fin(n+2) to fin(n+1) which is \"the right thing for the input you have, but crazy in general\" is going to have difficulties, for the same reason that theorems involving natural number subtraction are hard in general, even when the subtraction is \"the right subtraction in this situation\"</p>",
        "id": 201819714,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1592984952
    },
    {
        "content": "<p>Usually I try to refactor subtractions so instead of a-b which is \"ok in this situation\" I lose the a variable completely and instead use a new variable c such that a=c+b</p>",
        "id": 201819803,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1592985019
    },
    {
        "content": "<p>Looking at what you did, it seems very natural; I am surprised this has happened! Your original statement looks sensible, how did we end up with the casts?</p>",
        "id": 201820392,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1592985571
    },
    {
        "content": "<p>Aah, I think the statement <em>is</em> bad. It contains <code>example (m : ℕ) (i : fin m) : fin (m+1) := nat.succ i</code>. Maybe <code>i.succ</code> is better?</p>",
        "id": 201821339,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1592986262
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span><code><span class=\"kn\">example</span> <span class=\"o\">{</span><span class=\"n\">u</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span> <span class=\"o\">{</span><span class=\"n\">n</span> <span class=\"o\">:</span> <span class=\"bp\">ℕ</span><span class=\"o\">}</span> <span class=\"o\">[</span><span class=\"n\">fintype</span> <span class=\"n\">u</span><span class=\"o\">]</span> <span class=\"o\">[</span><span class=\"n\">decidable_eq</span> <span class=\"n\">u</span><span class=\"o\">]</span> <span class=\"o\">(</span><span class=\"n\">v</span> <span class=\"o\">:</span> <span class=\"n\">fin</span> <span class=\"n\">n</span><span class=\"bp\">.</span><span class=\"n\">succ</span> <span class=\"bp\">×</span> <span class=\"n\">u</span> <span class=\"bp\">-&gt;</span> <span class=\"n\">α</span><span class=\"o\">)</span> <span class=\"o\">:</span>\n   <span class=\"err\">∑</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"o\">:</span> <span class=\"n\">fin</span> <span class=\"n\">n</span><span class=\"bp\">.</span><span class=\"n\">succ</span> <span class=\"bp\">×</span> <span class=\"n\">u</span><span class=\"o\">),</span> <span class=\"n\">v</span> <span class=\"n\">p</span> <span class=\"bp\">=</span>\n   <span class=\"err\">∑</span> <span class=\"o\">(</span><span class=\"n\">i</span> <span class=\"o\">:</span> <span class=\"n\">u</span><span class=\"o\">),</span> <span class=\"n\">v</span> <span class=\"o\">(</span><span class=\"mi\">0</span><span class=\"o\">,</span> <span class=\"n\">i</span><span class=\"o\">)</span> <span class=\"bp\">+</span> <span class=\"err\">∑</span> <span class=\"o\">(</span><span class=\"n\">ki</span> <span class=\"o\">:</span> <span class=\"n\">fin</span> <span class=\"n\">n</span> <span class=\"bp\">×</span> <span class=\"n\">u</span><span class=\"o\">),</span> <span class=\"n\">v</span> <span class=\"o\">(</span><span class=\"n\">fin</span><span class=\"bp\">.</span><span class=\"n\">succ</span> <span class=\"n\">ki</span><span class=\"bp\">.</span><span class=\"n\">fst</span><span class=\"o\">,</span> <span class=\"n\">ki</span><span class=\"bp\">.</span><span class=\"n\">snd</span><span class=\"o\">)</span> <span class=\"o\">:=</span>\n<span class=\"k\">begin</span>\n  <span class=\"n\">rw</span> <span class=\"bp\">&lt;-@</span><span class=\"n\">sum_prod</span> <span class=\"n\">α</span> <span class=\"bp\">_</span> <span class=\"o\">(</span><span class=\"k\">by</span> <span class=\"n\">apply_instance</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">fin</span> <span class=\"n\">n</span><span class=\"o\">)</span> <span class=\"n\">u</span> <span class=\"bp\">_</span><span class=\"o\">,</span>\n  <span class=\"n\">rw</span> <span class=\"n\">finset</span><span class=\"bp\">.</span><span class=\"n\">sum_comm</span><span class=\"o\">,</span>\n  <span class=\"n\">rw</span> <span class=\"bp\">&lt;-</span><span class=\"n\">finset</span><span class=\"bp\">.</span><span class=\"n\">sum_add_distrib</span><span class=\"o\">,</span>\n  <span class=\"n\">rw</span> <span class=\"bp\">&lt;-</span><span class=\"n\">sum_prod</span><span class=\"o\">,</span>\n  <span class=\"n\">rw</span> <span class=\"n\">finset</span><span class=\"bp\">.</span><span class=\"n\">sum_comm</span><span class=\"o\">,</span>\n  <span class=\"n\">refine</span> <span class=\"n\">congr_arg</span> <span class=\"n\">finset</span><span class=\"bp\">.</span><span class=\"n\">univ</span><span class=\"bp\">.</span><span class=\"n\">sum</span> <span class=\"bp\">_</span><span class=\"o\">,</span>\n  <span class=\"n\">ext</span> <span class=\"n\">i</span><span class=\"o\">,</span>\n  <span class=\"n\">simp_rw</span> <span class=\"n\">fin</span><span class=\"bp\">.</span><span class=\"n\">sum_univ_succ</span><span class=\"o\">,</span>\n  <span class=\"c1\">-- it&#39;s all over</span>\n<span class=\"kn\">end</span>\n</code></pre></div>\n\n\n<p>Will this do for you? It's an initial segment of your proof, applied to a different statement.</p>",
        "id": 201821578,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1592986448
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span><code><span class=\"kn\">example</span> <span class=\"o\">(</span><span class=\"n\">n</span> <span class=\"o\">:</span> <span class=\"bp\">ℕ</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">i</span> <span class=\"o\">:</span> <span class=\"n\">fin</span> <span class=\"n\">n</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">nat</span><span class=\"bp\">.</span><span class=\"n\">succ</span> <span class=\"n\">i</span> <span class=\"bp\">=</span> <span class=\"n\">fin</span><span class=\"bp\">.</span><span class=\"n\">succ</span> <span class=\"n\">i</span> <span class=\"o\">:=</span>\n<span class=\"k\">begin</span>\n  <span class=\"n\">unfold_coes</span><span class=\"o\">,</span>\n  <span class=\"n\">cases</span> <span class=\"n\">i</span><span class=\"o\">,</span>\n  <span class=\"n\">simp</span><span class=\"o\">,</span>\n<span class=\"kn\">end</span>\n</code></pre></div>\n\n\n<p>This is the glue which relates the proof above to your original statement.</p>",
        "id": 201822384,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1592987073
    },
    {
        "content": "<p>Here's a proof of your original statement. I am still a bit confused by all this. Note that it contains a non-terminal simp.</p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"kn\">lemma</span> <span class=\"n\">helper</span> <span class=\"o\">(</span><span class=\"n\">n</span> <span class=\"o\">:</span> <span class=\"bp\">ℕ</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">i</span> <span class=\"o\">:</span> <span class=\"n\">fin</span> <span class=\"n\">n</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">nat</span><span class=\"bp\">.</span><span class=\"n\">succ</span> <span class=\"n\">i</span> <span class=\"bp\">=</span> <span class=\"n\">fin</span><span class=\"bp\">.</span><span class=\"n\">succ</span> <span class=\"n\">i</span> <span class=\"o\">:=</span>\n<span class=\"k\">begin</span>\n  <span class=\"n\">unfold_coes</span><span class=\"o\">,</span>\n  <span class=\"n\">cases</span> <span class=\"n\">i</span><span class=\"o\">,</span>\n  <span class=\"n\">simp</span><span class=\"o\">,</span>\n<span class=\"kn\">end</span>\n\n\n<span class=\"kn\">example</span> <span class=\"o\">{</span><span class=\"n\">u</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span> <span class=\"o\">{</span><span class=\"n\">n</span> <span class=\"o\">:</span> <span class=\"bp\">ℕ</span><span class=\"o\">}</span> <span class=\"o\">[</span><span class=\"n\">fintype</span> <span class=\"n\">u</span><span class=\"o\">]</span> <span class=\"o\">[</span><span class=\"n\">decidable_eq</span> <span class=\"n\">u</span><span class=\"o\">]</span> <span class=\"o\">(</span><span class=\"n\">v</span> <span class=\"o\">:</span> <span class=\"n\">fin</span> <span class=\"n\">n</span><span class=\"bp\">.</span><span class=\"n\">succ</span> <span class=\"bp\">×</span> <span class=\"n\">u</span> <span class=\"bp\">-&gt;</span> <span class=\"n\">α</span><span class=\"o\">)</span> <span class=\"o\">:</span>\n   <span class=\"err\">∑</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"o\">:</span> <span class=\"n\">fin</span> <span class=\"n\">n</span><span class=\"bp\">.</span><span class=\"n\">succ</span> <span class=\"bp\">×</span> <span class=\"n\">u</span><span class=\"o\">),</span> <span class=\"n\">v</span> <span class=\"n\">p</span> <span class=\"bp\">=</span>\n   <span class=\"err\">∑</span> <span class=\"o\">(</span><span class=\"n\">i</span> <span class=\"o\">:</span> <span class=\"n\">u</span><span class=\"o\">),</span> <span class=\"n\">v</span> <span class=\"o\">(</span><span class=\"mi\">0</span><span class=\"o\">,</span> <span class=\"n\">i</span><span class=\"o\">)</span> <span class=\"bp\">+</span> <span class=\"err\">∑</span> <span class=\"o\">(</span><span class=\"n\">ki</span> <span class=\"o\">:</span> <span class=\"n\">fin</span> <span class=\"n\">n</span> <span class=\"bp\">×</span> <span class=\"n\">u</span><span class=\"o\">),</span> <span class=\"n\">v</span> <span class=\"o\">(</span><span class=\"n\">nat</span><span class=\"bp\">.</span><span class=\"n\">succ</span> <span class=\"n\">ki</span><span class=\"bp\">.</span><span class=\"n\">fst</span><span class=\"o\">,</span> <span class=\"n\">ki</span><span class=\"bp\">.</span><span class=\"n\">snd</span><span class=\"o\">)</span> <span class=\"o\">:=</span>\n<span class=\"k\">begin</span>\n  <span class=\"n\">simp_rw</span> <span class=\"n\">helper</span><span class=\"o\">,</span>\n  <span class=\"n\">simp</span><span class=\"o\">,</span>\n  <span class=\"n\">rw</span> <span class=\"bp\">&lt;-@</span><span class=\"n\">sum_prod</span> <span class=\"n\">α</span> <span class=\"bp\">_</span> <span class=\"o\">(</span><span class=\"k\">by</span> <span class=\"n\">apply_instance</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">fin</span> <span class=\"n\">n</span><span class=\"o\">)</span> <span class=\"n\">u</span> <span class=\"bp\">_</span><span class=\"o\">,</span>\n  <span class=\"n\">rw</span> <span class=\"n\">finset</span><span class=\"bp\">.</span><span class=\"n\">sum_comm</span><span class=\"o\">,</span>\n  <span class=\"n\">rw</span> <span class=\"bp\">&lt;-</span><span class=\"n\">finset</span><span class=\"bp\">.</span><span class=\"n\">sum_add_distrib</span><span class=\"o\">,</span>\n  <span class=\"n\">rw</span> <span class=\"bp\">&lt;-</span><span class=\"n\">sum_prod</span><span class=\"o\">,</span>\n  <span class=\"n\">rw</span> <span class=\"n\">finset</span><span class=\"bp\">.</span><span class=\"n\">sum_comm</span><span class=\"o\">,</span>\n  <span class=\"n\">simp_rw</span> <span class=\"n\">fin</span><span class=\"bp\">.</span><span class=\"n\">sum_univ_succ</span><span class=\"o\">,</span>\n<span class=\"kn\">end</span>\n</code></pre></div>",
        "id": 201822656,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1592987292
    },
    {
        "content": "<p>There's a coercion from nat to <code>fin (nat.succ m)</code> and this is the poorly-behaved map which involves <code>%</code> in general. Avoiding this is the key.</p>",
        "id": 201823578,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1592988025
    },
    {
        "content": "<p>My actual problem is at the bottom of the mwe below. Thanks for all the insights. I'd love to hear more comments about how to incorporate this general sum result into the more specific <code>dot_product</code> proof. I think what is blocking that incorporation is that <code>simp_rw</code> which can't be moved further up.</p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"kn\">import</span> <span class=\"n\">data</span><span class=\"bp\">.</span><span class=\"n\">fintype</span><span class=\"bp\">.</span><span class=\"n\">card</span>\n<span class=\"kn\">import</span> <span class=\"n\">data</span><span class=\"bp\">.</span><span class=\"n\">matrix</span><span class=\"bp\">.</span><span class=\"n\">basic</span>\n\n<span class=\"n\">open_locale</span> <span class=\"n\">big_operators</span>\n\n<span class=\"kn\">namespace</span> <span class=\"n\">matrix</span>\n\n<span class=\"kn\">universe</span> <span class=\"n\">u</span>\n<span class=\"kn\">variables</span> <span class=\"o\">{</span><span class=\"n\">α</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span> <span class=\"n\">u</span><span class=\"o\">}</span>\n\n<span class=\"n\">open_locale</span> <span class=\"n\">matrix</span>\n\n<span class=\"kn\">section</span> <span class=\"n\">matrix_notation</span>\n<span class=\"kn\">variables</span> <span class=\"o\">{</span><span class=\"n\">ι</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span><span class=\"o\">}</span> <span class=\"o\">[</span><span class=\"n\">fintype</span> <span class=\"n\">ι</span><span class=\"o\">]</span> <span class=\"o\">[</span><span class=\"n\">decidable_eq</span> <span class=\"n\">ι</span><span class=\"o\">]</span>\n\n<span class=\"c\">/-</span><span class=\"cm\">- `vec_cons h t` prepends an entry `h` to a vector `t`.</span>\n\n<span class=\"cm\">The inverse functions are `vec_head` and `vec_tail`.</span>\n<span class=\"cm\">The notation `![a, b, ...]` expands to `vec_cons a (vec_cons b ...)`.</span>\n<span class=\"cm\">-/</span>\n<span class=\"n\">def</span> <span class=\"n\">vec_cons</span> <span class=\"o\">{</span><span class=\"n\">n</span> <span class=\"o\">:</span> <span class=\"bp\">ℕ</span><span class=\"o\">}</span> <span class=\"o\">(</span><span class=\"n\">h</span> <span class=\"o\">:</span> <span class=\"n\">ι</span> <span class=\"bp\">→</span> <span class=\"n\">α</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">t</span> <span class=\"o\">:</span> <span class=\"n\">fin</span> <span class=\"n\">n</span> <span class=\"bp\">×</span> <span class=\"n\">ι</span> <span class=\"bp\">→</span> <span class=\"n\">α</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">fin</span> <span class=\"n\">n</span><span class=\"bp\">.</span><span class=\"n\">succ</span> <span class=\"bp\">×</span> <span class=\"n\">ι</span> <span class=\"bp\">→</span> <span class=\"n\">α</span> <span class=\"o\">:=</span>\n<span class=\"bp\">λ</span> <span class=\"n\">p</span><span class=\"o\">,</span> <span class=\"k\">match</span> <span class=\"n\">p</span> <span class=\"k\">with</span>\n<span class=\"bp\">|</span> <span class=\"bp\">⟨⟨</span><span class=\"mi\">0</span><span class=\"o\">,</span> <span class=\"bp\">_⟩</span><span class=\"o\">,</span> <span class=\"n\">i</span><span class=\"bp\">⟩</span> <span class=\"o\">:=</span> <span class=\"n\">h</span> <span class=\"n\">i</span>\n<span class=\"bp\">|</span> <span class=\"bp\">⟨⟨</span><span class=\"n\">nat</span><span class=\"bp\">.</span><span class=\"n\">succ</span> <span class=\"n\">k</span><span class=\"o\">,</span> <span class=\"n\">hk</span><span class=\"bp\">⟩</span><span class=\"o\">,</span> <span class=\"n\">i</span><span class=\"bp\">⟩</span> <span class=\"o\">:=</span> <span class=\"n\">t</span> <span class=\"o\">(</span><span class=\"bp\">⟨</span><span class=\"n\">k</span><span class=\"o\">,</span> <span class=\"n\">nat</span><span class=\"bp\">.</span><span class=\"n\">lt_of_succ_lt_succ</span> <span class=\"n\">hk</span><span class=\"bp\">⟩</span><span class=\"o\">,</span> <span class=\"n\">i</span><span class=\"o\">)</span>\n<span class=\"kn\">end</span>\n\n<span class=\"c\">/-</span><span class=\"cm\">- `vec_head v` gives the first entry of the vector `v` -/</span>\n<span class=\"n\">def</span> <span class=\"n\">vec_head</span> <span class=\"o\">{</span><span class=\"n\">n</span> <span class=\"o\">:</span> <span class=\"bp\">ℕ</span><span class=\"o\">}</span> <span class=\"o\">(</span><span class=\"n\">v</span> <span class=\"o\">:</span> <span class=\"n\">fin</span> <span class=\"n\">n</span><span class=\"bp\">.</span><span class=\"n\">succ</span> <span class=\"bp\">×</span> <span class=\"n\">ι</span> <span class=\"bp\">→</span> <span class=\"n\">α</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">ι</span> <span class=\"bp\">-&gt;</span> <span class=\"n\">α</span> <span class=\"o\">:=</span>\n<span class=\"bp\">λ</span> <span class=\"n\">i</span><span class=\"o\">,</span> <span class=\"n\">v</span> <span class=\"o\">(</span><span class=\"bp\">⟨</span><span class=\"mi\">0</span><span class=\"o\">,</span> <span class=\"n\">nat</span><span class=\"bp\">.</span><span class=\"n\">succ_pos&#39;</span><span class=\"bp\">⟩</span><span class=\"o\">,</span> <span class=\"n\">i</span><span class=\"o\">)</span>\n\n<span class=\"c\">/-</span><span class=\"cm\">- `vec_tail v` gives a vector consisting of all entries of `v` except the first -/</span>\n<span class=\"n\">def</span> <span class=\"n\">vec_tail</span> <span class=\"o\">{</span><span class=\"n\">n</span> <span class=\"o\">:</span> <span class=\"bp\">ℕ</span><span class=\"o\">}</span> <span class=\"o\">(</span><span class=\"n\">v</span> <span class=\"o\">:</span> <span class=\"n\">fin</span> <span class=\"n\">n</span><span class=\"bp\">.</span><span class=\"n\">succ</span> <span class=\"bp\">×</span> <span class=\"n\">ι</span> <span class=\"bp\">→</span> <span class=\"n\">α</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">fin</span> <span class=\"n\">n</span> <span class=\"bp\">×</span> <span class=\"n\">ι</span> <span class=\"bp\">→</span> <span class=\"n\">α</span> <span class=\"o\">:=</span>\n<span class=\"bp\">λ</span> <span class=\"n\">p</span><span class=\"o\">,</span> <span class=\"n\">v</span> <span class=\"bp\">⟨⟨</span><span class=\"n\">nat</span><span class=\"bp\">.</span><span class=\"n\">succ</span> <span class=\"n\">p</span><span class=\"bp\">.</span><span class=\"mi\">1</span><span class=\"o\">,</span> <span class=\"n\">nat</span><span class=\"bp\">.</span><span class=\"n\">succ_lt_succ</span> <span class=\"n\">p</span><span class=\"bp\">.</span><span class=\"mi\">1</span><span class=\"bp\">.</span><span class=\"mi\">2</span><span class=\"bp\">⟩</span><span class=\"o\">,</span> <span class=\"n\">p</span><span class=\"bp\">.</span><span class=\"mi\">2</span><span class=\"bp\">⟩</span>\n\n<span class=\"kn\">end</span> <span class=\"n\">matrix_notation</span>\n\n<span class=\"kn\">variables</span> <span class=\"o\">{</span><span class=\"n\">n</span> <span class=\"o\">:</span> <span class=\"bp\">ℕ</span><span class=\"o\">}</span> <span class=\"o\">{</span><span class=\"n\">n&#39;</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span><span class=\"o\">}</span> <span class=\"o\">[</span><span class=\"n\">fintype</span> <span class=\"n\">n&#39;</span><span class=\"o\">]</span> <span class=\"o\">[</span><span class=\"n\">decidable_eq</span> <span class=\"n\">n&#39;</span><span class=\"o\">]</span>\n<span class=\"kn\">variables</span> <span class=\"o\">{</span><span class=\"n\">ι</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span><span class=\"o\">}</span> <span class=\"o\">[</span><span class=\"n\">fintype</span> <span class=\"n\">ι</span><span class=\"o\">]</span> <span class=\"o\">[</span><span class=\"n\">decidable_eq</span> <span class=\"n\">ι</span><span class=\"o\">]</span>\n\n<span class=\"kn\">section</span> <span class=\"n\">val</span>\n\n<span class=\"bp\">@</span><span class=\"o\">[</span><span class=\"n\">simp</span><span class=\"o\">]</span> <span class=\"kn\">lemma</span> <span class=\"n\">cons_val_succ</span> <span class=\"o\">(</span><span class=\"n\">x</span> <span class=\"o\">:</span> <span class=\"n\">ι</span> <span class=\"bp\">-&gt;</span> <span class=\"n\">α</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">u</span> <span class=\"o\">:</span> <span class=\"n\">fin</span> <span class=\"n\">n</span> <span class=\"bp\">×</span> <span class=\"n\">ι</span> <span class=\"bp\">→</span> <span class=\"n\">α</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">i</span> <span class=\"o\">:</span> <span class=\"n\">fin</span> <span class=\"n\">n</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">ix</span> <span class=\"o\">:</span> <span class=\"n\">ι</span><span class=\"o\">)</span> <span class=\"o\">:</span>\n  <span class=\"o\">(</span><span class=\"n\">vec_cons</span> <span class=\"n\">x</span> <span class=\"n\">u</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">i</span><span class=\"bp\">.</span><span class=\"n\">succ</span><span class=\"o\">,</span> <span class=\"n\">ix</span><span class=\"o\">)</span> <span class=\"bp\">=</span> <span class=\"n\">u</span> <span class=\"o\">(</span><span class=\"n\">i</span><span class=\"o\">,</span> <span class=\"n\">ix</span><span class=\"o\">)</span> <span class=\"o\">:=</span>\n<span class=\"k\">by</span> <span class=\"o\">{</span> <span class=\"n\">simp</span> <span class=\"o\">[</span><span class=\"n\">vec_cons</span><span class=\"o\">],</span> <span class=\"n\">cases</span> <span class=\"n\">i</span><span class=\"o\">,</span> <span class=\"n\">refl</span> <span class=\"o\">}</span>\n\n<span class=\"kn\">end</span> <span class=\"n\">val</span>\n\n<span class=\"c\">/-</span><span class=\"cm\">- A product over the `univ` of a pair type equals to</span>\n<span class=\"cm\">the double product over the `univ`s of the `fst` and `snd` types. -/</span>\n<span class=\"bp\">@</span><span class=\"o\">[</span><span class=\"n\">to_additive</span> <span class=\"s2\">&quot;A sum over the `univ` of a pair type equals to</span>\n<span class=\"s2\">the double sum over the `univ`s of the `fst` and `snd` types.&quot;</span><span class=\"o\">]</span>\n<span class=\"kn\">lemma</span> <span class=\"n\">fintype</span><span class=\"bp\">.</span><span class=\"n\">prod_product_fintype</span> <span class=\"o\">{</span><span class=\"n\">a</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span> <span class=\"o\">{</span><span class=\"n\">β</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span> <span class=\"o\">{</span><span class=\"n\">M</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span> <span class=\"o\">[</span><span class=\"n\">fintype</span> <span class=\"n\">α</span><span class=\"o\">]</span> <span class=\"o\">[</span><span class=\"n\">comm_monoid</span> <span class=\"n\">M</span><span class=\"o\">]</span> <span class=\"o\">[</span><span class=\"n\">fintype</span> <span class=\"n\">β</span><span class=\"o\">]</span> <span class=\"o\">{</span><span class=\"n\">f</span> <span class=\"o\">:</span> <span class=\"n\">α</span> <span class=\"bp\">×</span> <span class=\"n\">β</span> <span class=\"bp\">→</span> <span class=\"n\">M</span><span class=\"o\">}</span> <span class=\"o\">:</span>\n  <span class=\"err\">∏</span> <span class=\"o\">(</span><span class=\"n\">x</span> <span class=\"o\">:</span> <span class=\"n\">α</span> <span class=\"bp\">×</span> <span class=\"n\">β</span><span class=\"o\">),</span> <span class=\"n\">f</span> <span class=\"n\">x</span> <span class=\"bp\">=</span> <span class=\"err\">∏</span> <span class=\"n\">x</span> <span class=\"o\">:</span> <span class=\"n\">α</span><span class=\"o\">,</span> <span class=\"err\">∏</span> <span class=\"n\">y</span> <span class=\"o\">:</span> <span class=\"n\">β</span><span class=\"o\">,</span> <span class=\"n\">f</span> <span class=\"o\">(</span><span class=\"n\">x</span><span class=\"o\">,</span> <span class=\"n\">y</span><span class=\"o\">)</span> <span class=\"o\">:=</span>\n<span class=\"k\">by</span> <span class=\"o\">{</span> <span class=\"n\">rw</span> <span class=\"bp\">&lt;-</span><span class=\"n\">finset</span><span class=\"bp\">.</span><span class=\"n\">prod_product</span><span class=\"o\">,</span> <span class=\"n\">refl</span> <span class=\"o\">}</span>\n\n<span class=\"kn\">section</span> <span class=\"n\">dot_product</span>\n\n<span class=\"kn\">variables</span> <span class=\"o\">[</span><span class=\"n\">add_comm_monoid</span> <span class=\"n\">α</span><span class=\"o\">]</span> <span class=\"o\">[</span><span class=\"n\">has_mul</span> <span class=\"n\">α</span><span class=\"o\">]</span>\n\n<span class=\"bp\">@</span><span class=\"o\">[</span><span class=\"n\">simp</span><span class=\"o\">]</span> <span class=\"kn\">lemma</span> <span class=\"n\">cons_dot_product</span> <span class=\"o\">[</span><span class=\"n\">has_mul</span> <span class=\"n\">α</span><span class=\"o\">]</span> <span class=\"o\">(</span><span class=\"n\">x</span> <span class=\"o\">:</span> <span class=\"n\">ι</span> <span class=\"bp\">-&gt;</span> <span class=\"n\">α</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">v</span> <span class=\"o\">:</span> <span class=\"n\">fin</span> <span class=\"n\">n</span> <span class=\"bp\">×</span> <span class=\"n\">ι</span> <span class=\"bp\">→</span> <span class=\"n\">α</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">w</span> <span class=\"o\">:</span> <span class=\"n\">fin</span> <span class=\"n\">n</span><span class=\"bp\">.</span><span class=\"n\">succ</span> <span class=\"bp\">×</span> <span class=\"n\">ι</span> <span class=\"bp\">→</span> <span class=\"n\">α</span><span class=\"o\">)</span> <span class=\"o\">:</span>\n  <span class=\"n\">dot_product</span> <span class=\"o\">(</span><span class=\"n\">vec_cons</span> <span class=\"n\">x</span> <span class=\"n\">v</span><span class=\"o\">)</span> <span class=\"n\">w</span> <span class=\"bp\">=</span> <span class=\"n\">dot_product</span> <span class=\"n\">x</span> <span class=\"o\">(</span><span class=\"n\">vec_head</span> <span class=\"n\">w</span><span class=\"o\">)</span> <span class=\"bp\">+</span> <span class=\"n\">dot_product</span> <span class=\"n\">v</span> <span class=\"o\">(</span><span class=\"n\">vec_tail</span> <span class=\"n\">w</span><span class=\"o\">)</span> <span class=\"o\">:=</span>\n<span class=\"k\">begin</span>\n  <span class=\"n\">dsimp</span> <span class=\"n\">only</span> <span class=\"o\">[</span><span class=\"n\">dot_product</span><span class=\"o\">,</span> <span class=\"n\">vec_head</span><span class=\"o\">,</span> <span class=\"n\">vec_tail</span><span class=\"o\">],</span>\n  <span class=\"n\">rw</span> <span class=\"o\">[</span><span class=\"n\">fintype</span><span class=\"bp\">.</span><span class=\"n\">sum_product_fintype</span><span class=\"o\">,</span> <span class=\"bp\">@</span><span class=\"n\">finset</span><span class=\"bp\">.</span><span class=\"n\">sum_comm</span> <span class=\"n\">ι</span> <span class=\"bp\">_</span> <span class=\"bp\">_</span> <span class=\"bp\">_</span> <span class=\"bp\">_</span> <span class=\"bp\">_</span> <span class=\"bp\">_</span><span class=\"o\">,</span>\n      <span class=\"n\">fintype</span><span class=\"bp\">.</span><span class=\"n\">sum_product_fintype</span><span class=\"o\">,</span> <span class=\"bp\">@</span><span class=\"n\">finset</span><span class=\"bp\">.</span><span class=\"n\">sum_comm</span> <span class=\"n\">ι</span> <span class=\"bp\">_</span> <span class=\"bp\">_</span> <span class=\"bp\">_</span> <span class=\"bp\">_</span> <span class=\"bp\">_</span> <span class=\"bp\">_</span><span class=\"o\">,</span>\n      <span class=\"bp\">&lt;-</span><span class=\"n\">finset</span><span class=\"bp\">.</span><span class=\"n\">sum_add_distrib</span><span class=\"o\">],</span>\n  <span class=\"n\">refine</span> <span class=\"n\">congr_arg</span> <span class=\"n\">finset</span><span class=\"bp\">.</span><span class=\"n\">univ</span><span class=\"bp\">.</span><span class=\"n\">sum</span> <span class=\"bp\">_</span><span class=\"o\">,</span>\n  <span class=\"n\">ext</span> <span class=\"n\">i</span><span class=\"o\">,</span>\n  <span class=\"n\">rw</span> <span class=\"n\">fin</span><span class=\"bp\">.</span><span class=\"n\">sum_univ_succ</span><span class=\"o\">,</span>\n  <span class=\"n\">simp_rw</span> <span class=\"o\">[</span><span class=\"n\">cons_val_succ</span><span class=\"o\">],</span>  <span class=\"c1\">-- I wish I could move this further up, but simp_rw doesn&#39;t work higher</span>\n  <span class=\"n\">refine</span> <span class=\"n\">congr_arg</span> <span class=\"o\">((</span><span class=\"bp\">+</span><span class=\"o\">)</span> <span class=\"bp\">_</span><span class=\"o\">)</span> <span class=\"bp\">_</span><span class=\"o\">,</span>\n  <span class=\"n\">refine</span> <span class=\"n\">congr_arg</span> <span class=\"n\">finset</span><span class=\"bp\">.</span><span class=\"n\">univ</span><span class=\"bp\">.</span><span class=\"n\">sum</span> <span class=\"bp\">_</span><span class=\"o\">,</span>\n  <span class=\"n\">ext</span> <span class=\"n\">j</span><span class=\"o\">,</span>\n  <span class=\"n\">refine</span> <span class=\"n\">congr_arg</span> <span class=\"o\">((</span><span class=\"bp\">*</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">v</span> <span class=\"o\">(</span><span class=\"n\">j</span><span class=\"o\">,</span> <span class=\"n\">i</span><span class=\"o\">)))</span> <span class=\"bp\">_</span><span class=\"o\">,</span>\n  <span class=\"n\">refine</span> <span class=\"n\">congr_arg</span> <span class=\"n\">w</span> <span class=\"bp\">_</span><span class=\"o\">,</span>\n  <span class=\"n\">unfold_coes</span><span class=\"o\">,</span>\n  <span class=\"n\">cases</span> <span class=\"n\">j</span><span class=\"o\">,</span>\n  <span class=\"n\">simp</span> <span class=\"o\">[</span><span class=\"n\">fin</span><span class=\"bp\">.</span><span class=\"n\">eq_iff_veq</span><span class=\"o\">,</span> <span class=\"n\">fin</span><span class=\"bp\">.</span><span class=\"n\">succ_val</span><span class=\"o\">],</span>\n  <span class=\"n\">assumption</span><span class=\"o\">,</span> <span class=\"n\">assumption</span><span class=\"o\">,</span> <span class=\"c1\">-- this line isn&#39;t needed in my actual file because sum_product_fintype is properly imported</span>\n<span class=\"kn\">end</span>\n\n<span class=\"kn\">end</span> <span class=\"n\">dot_product</span>\n\n<span class=\"kn\">end</span> <span class=\"n\">matrix</span>\n</code></pre></div>",
        "id": 201826749,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1592990469
    },
    {
        "content": "<p>I don't really understand this question -- the code compiles. You don't need all those <code>_</code>s in the rewrite in the last proof; <code>rw</code> will put them in for you.</p>",
        "id": 201829591,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1592992521
    },
    {
        "content": "<p>I don't know anything about big operators, I was just intrigued by the puzzle about succ :-)</p>",
        "id": 201829701,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1592992597
    },
    {
        "content": "<p>Why is <code>fintype.prod_product_fintype</code> not a valid <code>simp</code> lemma? This looks like the sort of proof <code>simp</code> would be really good at.</p>",
        "id": 201830224,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1592993038
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span><code><span class=\"n\">def</span> <span class=\"n\">vec_cons</span> <span class=\"o\">{</span><span class=\"n\">n</span> <span class=\"o\">:</span> <span class=\"bp\">ℕ</span><span class=\"o\">}</span> <span class=\"o\">(</span><span class=\"n\">h</span> <span class=\"o\">:</span> <span class=\"n\">ι</span> <span class=\"bp\">→</span> <span class=\"n\">α</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">t</span> <span class=\"o\">:</span> <span class=\"n\">fin</span> <span class=\"n\">n</span> <span class=\"bp\">×</span> <span class=\"n\">ι</span> <span class=\"bp\">→</span> <span class=\"n\">α</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">fin</span> <span class=\"n\">n</span><span class=\"bp\">.</span><span class=\"n\">succ</span> <span class=\"bp\">×</span> <span class=\"n\">ι</span> <span class=\"bp\">→</span> <span class=\"n\">α</span>\n<span class=\"bp\">|</span> <span class=\"bp\">⟨⟨</span><span class=\"mi\">0</span><span class=\"o\">,</span> <span class=\"bp\">_⟩</span><span class=\"o\">,</span> <span class=\"n\">i</span><span class=\"bp\">⟩</span> <span class=\"o\">:=</span> <span class=\"n\">h</span> <span class=\"n\">i</span>\n<span class=\"bp\">|</span> <span class=\"bp\">⟨⟨</span><span class=\"n\">nat</span><span class=\"bp\">.</span><span class=\"n\">succ</span> <span class=\"n\">k</span><span class=\"o\">,</span> <span class=\"n\">hk</span><span class=\"bp\">⟩</span><span class=\"o\">,</span> <span class=\"n\">i</span><span class=\"bp\">⟩</span> <span class=\"o\">:=</span> <span class=\"n\">t</span> <span class=\"o\">(</span><span class=\"bp\">⟨</span><span class=\"n\">k</span><span class=\"o\">,</span> <span class=\"n\">nat</span><span class=\"bp\">.</span><span class=\"n\">lt_of_succ_lt_succ</span> <span class=\"n\">hk</span><span class=\"bp\">⟩</span><span class=\"o\">,</span> <span class=\"n\">i</span><span class=\"o\">)</span>\n</code></pre></div>",
        "id": 201830651,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1592993355
    },
    {
        "content": "<p>I think it's better -- better definitional equalities maybe?</p>",
        "id": 201830685,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1592993386
    },
    {
        "content": "<p>e.g.</p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"bp\">@</span><span class=\"o\">[</span><span class=\"n\">simp</span><span class=\"o\">]</span> <span class=\"kn\">lemma</span> <span class=\"n\">cons_val_succ</span> <span class=\"o\">(</span><span class=\"n\">x</span> <span class=\"o\">:</span> <span class=\"n\">ι</span> <span class=\"bp\">-&gt;</span> <span class=\"n\">α</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">u</span> <span class=\"o\">:</span> <span class=\"n\">fin</span> <span class=\"n\">n</span> <span class=\"bp\">×</span> <span class=\"n\">ι</span> <span class=\"bp\">→</span> <span class=\"n\">α</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">i</span> <span class=\"o\">:</span> <span class=\"n\">fin</span> <span class=\"n\">n</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">ix</span> <span class=\"o\">:</span> <span class=\"n\">ι</span><span class=\"o\">)</span> <span class=\"o\">:</span>\n  <span class=\"o\">(</span><span class=\"n\">vec_cons</span> <span class=\"n\">x</span> <span class=\"n\">u</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">i</span><span class=\"bp\">.</span><span class=\"n\">succ</span><span class=\"o\">,</span> <span class=\"n\">ix</span><span class=\"o\">)</span> <span class=\"bp\">=</span> <span class=\"n\">u</span> <span class=\"o\">(</span><span class=\"n\">i</span><span class=\"o\">,</span> <span class=\"n\">ix</span><span class=\"o\">)</span> <span class=\"o\">:=</span>\n<span class=\"k\">by</span> <span class=\"o\">{</span> <span class=\"n\">cases</span> <span class=\"n\">i</span><span class=\"o\">,</span> <span class=\"n\">refl</span> <span class=\"o\">}</span>\n</code></pre></div>",
        "id": 201830692,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1592993392
    },
    {
        "content": "<p>Does this help you?</p>",
        "id": 201830755,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1592993411
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"110049\">@Mario Carneiro</span> why isn't <code>fintype.prod_product_fintype</code> a valid <code>simp</code> lemma? I want <code>simp</code> to be doing the donkey work here, don't I?</p>",
        "id": 201830809,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1592993477
    },
    {
        "content": "<p>what's the statement?</p>",
        "id": 201830832,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1592993509
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"308899\">@Yakov Pechersky</span> that change to the definition of <code>vec_cons</code> lets me move the <code>simp_rw</code> up. Have I solved your problem?</p>",
        "id": 201830843,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1592993520
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span><code><span class=\"c\">/-</span><span class=\"cm\">- A product over the `univ` of a pair type equals to</span>\n<span class=\"cm\">the double product over the `univ`s of the `fst` and `snd` types. -/</span>\n<span class=\"bp\">@</span><span class=\"o\">[</span><span class=\"n\">to_additive</span> <span class=\"s2\">&quot;A sum over the `univ` of a pair type equals to</span>\n<span class=\"s2\">the double sum over the `univ`s of the `fst` and `snd` types.&quot;</span><span class=\"o\">]</span>\n<span class=\"kn\">lemma</span> <span class=\"n\">fintype</span><span class=\"bp\">.</span><span class=\"n\">prod_product_fintype</span> <span class=\"o\">{</span><span class=\"n\">a</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span> <span class=\"o\">{</span><span class=\"n\">β</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span> <span class=\"o\">{</span><span class=\"n\">M</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span> <span class=\"o\">[</span><span class=\"n\">fintype</span> <span class=\"n\">α</span><span class=\"o\">]</span> <span class=\"o\">[</span><span class=\"n\">comm_monoid</span> <span class=\"n\">M</span><span class=\"o\">]</span> <span class=\"o\">[</span><span class=\"n\">fintype</span> <span class=\"n\">β</span><span class=\"o\">]</span> <span class=\"o\">{</span><span class=\"n\">f</span> <span class=\"o\">:</span> <span class=\"n\">α</span> <span class=\"bp\">×</span> <span class=\"n\">β</span> <span class=\"bp\">→</span> <span class=\"n\">M</span><span class=\"o\">}</span> <span class=\"o\">:</span>\n  <span class=\"err\">∏</span> <span class=\"o\">(</span><span class=\"n\">x</span> <span class=\"o\">:</span> <span class=\"n\">α</span> <span class=\"bp\">×</span> <span class=\"n\">β</span><span class=\"o\">),</span> <span class=\"n\">f</span> <span class=\"n\">x</span> <span class=\"bp\">=</span> <span class=\"err\">∏</span> <span class=\"n\">x</span> <span class=\"o\">:</span> <span class=\"n\">α</span><span class=\"o\">,</span> <span class=\"err\">∏</span> <span class=\"n\">y</span> <span class=\"o\">:</span> <span class=\"n\">β</span><span class=\"o\">,</span> <span class=\"n\">f</span> <span class=\"o\">(</span><span class=\"n\">x</span><span class=\"o\">,</span> <span class=\"n\">y</span><span class=\"o\">)</span> <span class=\"o\">:=</span>\n<span class=\"k\">by</span> <span class=\"o\">{</span> <span class=\"n\">rw</span> <span class=\"bp\">&lt;-</span><span class=\"n\">finset</span><span class=\"bp\">.</span><span class=\"n\">prod_product</span><span class=\"o\">,</span> <span class=\"n\">refl</span> <span class=\"o\">}</span>\n</code></pre></div>",
        "id": 201830890,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1592993528
    },
    {
        "content": "<p>Those pis are products not Pi types</p>",
        "id": 201830908,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1592993545
    },
    {
        "content": "<p>I don't know about this always being a simp lemma, but you should be able to simp with it</p>",
        "id": 201830946,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1592993586
    },
    {
        "content": "<p><code>simp [fintype.sum_product_fintype],</code> -&gt; <code>invalid simplification lemma 'matrix.fintype.sum_product_fintype' (use command 'set_option trace.simp_lemmas true' for more details)</code></p>",
        "id": 201830984,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1592993637
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span><code>[simp_lemmas.invalid] rule derived from &#39;matrix.fintype.sum_product_fintype&#39; contains argument that is (a) not a Prop, (b) not an instance, and (c) not in the LHS of the rule\n</code></pre></div>",
        "id": 201831037,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1592993661
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span><code>fintype.sum_product_fintype :\n  ∀ {α : Type u_1} {a : Type u_2} {β : Type u_3} {M : Type u_4} [_inst_5 : fintype α] [_inst_6 : add_comm_monoid M]\n  [_inst_7 : fintype β] {f : α × β → M}, ∑ (x : α × β), f x = ∑ (x : α) (y : β), f (x, y)\n</code></pre></div>",
        "id": 201831069,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1592993704
    },
    {
        "content": "<p>oh!</p>",
        "id": 201831115,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1592993752
    },
    {
        "content": "<p>what's <code>a</code> doing there</p>",
        "id": 201831119,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1592993756
    },
    {
        "content": "<p>I'm surprised the unused arguments linter didn't catch this</p>",
        "id": 201831211,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1592993811
    },
    {
        "content": "<p>This is not in mathlib</p>",
        "id": 201831376,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1592993949
    },
    {
        "content": "<p>Thanks! I should have linted!</p>",
        "id": 201831386,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1592993975
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"308899\">@Yakov Pechersky</span> there's a typo in your definition of <code>fintype.prod_product_fintype</code> -- an <code>{a : Type*}</code> should be <code>{α : Type*}</code>. This explains the random <code>Type</code> goals you get after the rewrite (the <code>assumption, assumption</code> thing). It can now be made into a <code>simp</code> lemma.</p>",
        "id": 201834472,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1592996531
    },
    {
        "content": "<p>The linter also points out that you have two <code>has_mul</code> instances for <code>cons_dot_product</code>. Put <code>#lint</code> at the bottom of your file and take a look at the output.</p>",
        "id": 201835191,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1592997141
    },
    {
        "content": "<p>Thanks for all the insight! Your suggestions made me think of writing another simp lemma, which now makes these higher-dim dot product proofs pretty nice:</p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"kn\">import</span> <span class=\"n\">data</span><span class=\"bp\">.</span><span class=\"n\">fintype</span><span class=\"bp\">.</span><span class=\"n\">card</span>\n<span class=\"kn\">import</span> <span class=\"n\">data</span><span class=\"bp\">.</span><span class=\"n\">matrix</span><span class=\"bp\">.</span><span class=\"n\">basic</span>\n\n<span class=\"n\">open_locale</span> <span class=\"n\">big_operators</span>\n\n<span class=\"kn\">namespace</span> <span class=\"n\">matrix</span>\n\n<span class=\"kn\">universe</span> <span class=\"n\">u</span>\n<span class=\"kn\">variables</span> <span class=\"o\">{</span><span class=\"n\">α</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span> <span class=\"n\">u</span><span class=\"o\">}</span>\n\n<span class=\"n\">open_locale</span> <span class=\"n\">matrix</span>\n\n<span class=\"kn\">section</span> <span class=\"n\">matrix_notation</span>\n<span class=\"kn\">variables</span> <span class=\"o\">{</span><span class=\"n\">ι</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span><span class=\"o\">}</span> <span class=\"o\">[</span><span class=\"n\">fintype</span> <span class=\"n\">ι</span><span class=\"o\">]</span> <span class=\"o\">[</span><span class=\"n\">decidable_eq</span> <span class=\"n\">ι</span><span class=\"o\">]</span>\n\n<span class=\"c\">/-</span><span class=\"cm\">- `![]` is the vector with no entries. -/</span>\n<span class=\"n\">def</span> <span class=\"n\">vec_empty</span> <span class=\"o\">:</span> <span class=\"n\">fin</span> <span class=\"mi\">0</span> <span class=\"bp\">×</span> <span class=\"n\">ι</span> <span class=\"bp\">→</span> <span class=\"n\">α</span>\n<span class=\"bp\">|</span> <span class=\"bp\">⟨</span><span class=\"n\">k</span><span class=\"o\">,</span> <span class=\"bp\">_⟩</span> <span class=\"o\">:=</span> <span class=\"bp\">@</span><span class=\"n\">fin_zero_elim</span> <span class=\"o\">(</span><span class=\"bp\">λ</span> <span class=\"bp\">_</span><span class=\"o\">,</span> <span class=\"n\">α</span><span class=\"o\">)</span> <span class=\"n\">k</span>\n\n<span class=\"c\">/-</span><span class=\"cm\">- `vec_cons h t` prepends an entry `h` to a vector `t`.</span>\n\n<span class=\"cm\">The inverse functions are `vec_head` and `vec_tail`.</span>\n<span class=\"cm\">The notation `![a, b, ...]` expands to `vec_cons a (vec_cons b ...)`.</span>\n<span class=\"cm\">-/</span>\n<span class=\"n\">def</span> <span class=\"n\">vec_cons</span> <span class=\"o\">{</span><span class=\"n\">n</span> <span class=\"o\">:</span> <span class=\"bp\">ℕ</span><span class=\"o\">}</span> <span class=\"o\">(</span><span class=\"n\">h</span> <span class=\"o\">:</span> <span class=\"n\">ι</span> <span class=\"bp\">→</span> <span class=\"n\">α</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">t</span> <span class=\"o\">:</span> <span class=\"n\">fin</span> <span class=\"n\">n</span> <span class=\"bp\">×</span> <span class=\"n\">ι</span> <span class=\"bp\">→</span> <span class=\"n\">α</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">fin</span> <span class=\"n\">n</span><span class=\"bp\">.</span><span class=\"n\">succ</span> <span class=\"bp\">×</span> <span class=\"n\">ι</span> <span class=\"bp\">→</span> <span class=\"n\">α</span>\n<span class=\"bp\">|</span> <span class=\"bp\">⟨⟨</span><span class=\"mi\">0</span><span class=\"o\">,</span> <span class=\"bp\">_⟩</span><span class=\"o\">,</span> <span class=\"n\">i</span><span class=\"bp\">⟩</span> <span class=\"o\">:=</span> <span class=\"n\">h</span> <span class=\"n\">i</span>\n<span class=\"bp\">|</span> <span class=\"bp\">⟨⟨</span><span class=\"n\">nat</span><span class=\"bp\">.</span><span class=\"n\">succ</span> <span class=\"n\">k</span><span class=\"o\">,</span> <span class=\"n\">hk</span><span class=\"bp\">⟩</span><span class=\"o\">,</span> <span class=\"n\">i</span><span class=\"bp\">⟩</span> <span class=\"o\">:=</span> <span class=\"n\">t</span> <span class=\"o\">(</span><span class=\"bp\">⟨</span><span class=\"n\">k</span><span class=\"o\">,</span> <span class=\"n\">nat</span><span class=\"bp\">.</span><span class=\"n\">lt_of_succ_lt_succ</span> <span class=\"n\">hk</span><span class=\"bp\">⟩</span><span class=\"o\">,</span> <span class=\"n\">i</span><span class=\"o\">)</span>\n\n<span class=\"kn\">notation</span> <span class=\"bp\">`!</span><span class=\"o\">[</span><span class=\"bp\">`</span> <span class=\"n\">l</span><span class=\"o\">:(</span><span class=\"n\">foldr</span> <span class=\"bp\">`</span><span class=\"o\">,</span> <span class=\"bp\">`</span> <span class=\"o\">(</span><span class=\"n\">h</span> <span class=\"n\">t</span><span class=\"o\">,</span> <span class=\"n\">vec_cons</span> <span class=\"n\">h</span> <span class=\"n\">t</span><span class=\"o\">)</span> <span class=\"n\">vec_empty</span> <span class=\"bp\">`</span><span class=\"o\">]</span><span class=\"bp\">`</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"n\">l</span>\n\n<span class=\"c\">/-</span><span class=\"cm\">- `vec_head v` gives the first entry of the vector `v` -/</span>\n<span class=\"n\">def</span> <span class=\"n\">vec_head</span> <span class=\"o\">{</span><span class=\"n\">n</span> <span class=\"o\">:</span> <span class=\"bp\">ℕ</span><span class=\"o\">}</span> <span class=\"o\">(</span><span class=\"n\">v</span> <span class=\"o\">:</span> <span class=\"n\">fin</span> <span class=\"n\">n</span><span class=\"bp\">.</span><span class=\"n\">succ</span> <span class=\"bp\">×</span> <span class=\"n\">ι</span> <span class=\"bp\">→</span> <span class=\"n\">α</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">ι</span> <span class=\"bp\">-&gt;</span> <span class=\"n\">α</span>\n<span class=\"bp\">|</span> <span class=\"n\">i</span> <span class=\"o\">:=</span> <span class=\"n\">v</span> <span class=\"o\">(</span><span class=\"bp\">⟨</span><span class=\"mi\">0</span><span class=\"o\">,</span> <span class=\"n\">nat</span><span class=\"bp\">.</span><span class=\"n\">succ_pos&#39;</span><span class=\"bp\">⟩</span><span class=\"o\">,</span> <span class=\"n\">i</span><span class=\"o\">)</span>\n\n<span class=\"c\">/-</span><span class=\"cm\">- `vec_tail v` gives a vector consisting of all entries of `v` except the first -/</span>\n<span class=\"n\">def</span> <span class=\"n\">vec_tail</span> <span class=\"o\">{</span><span class=\"n\">n</span> <span class=\"o\">:</span> <span class=\"bp\">ℕ</span><span class=\"o\">}</span> <span class=\"o\">(</span><span class=\"n\">v</span> <span class=\"o\">:</span> <span class=\"n\">fin</span> <span class=\"n\">n</span><span class=\"bp\">.</span><span class=\"n\">succ</span> <span class=\"bp\">×</span> <span class=\"n\">ι</span> <span class=\"bp\">→</span> <span class=\"n\">α</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">fin</span> <span class=\"n\">n</span> <span class=\"bp\">×</span> <span class=\"n\">ι</span> <span class=\"bp\">→</span> <span class=\"n\">α</span>\n<span class=\"bp\">|</span> <span class=\"bp\">⟨⟨</span><span class=\"n\">k</span><span class=\"o\">,</span> <span class=\"n\">hk</span><span class=\"bp\">⟩</span><span class=\"o\">,</span> <span class=\"n\">i</span><span class=\"bp\">⟩</span> <span class=\"o\">:=</span> <span class=\"n\">v</span> <span class=\"bp\">⟨⟨</span><span class=\"n\">nat</span><span class=\"bp\">.</span><span class=\"n\">succ</span> <span class=\"n\">k</span><span class=\"o\">,</span> <span class=\"n\">nat</span><span class=\"bp\">.</span><span class=\"n\">succ_lt_succ</span> <span class=\"n\">hk</span><span class=\"bp\">⟩</span><span class=\"o\">,</span> <span class=\"n\">i</span><span class=\"bp\">⟩</span>\n\n<span class=\"kn\">end</span> <span class=\"n\">matrix_notation</span>\n\n<span class=\"kn\">variables</span> <span class=\"o\">{</span><span class=\"n\">n</span> <span class=\"o\">:</span> <span class=\"bp\">ℕ</span><span class=\"o\">}</span> <span class=\"o\">{</span><span class=\"n\">n&#39;</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span><span class=\"o\">}</span> <span class=\"o\">[</span><span class=\"n\">fintype</span> <span class=\"n\">n&#39;</span><span class=\"o\">]</span> <span class=\"o\">[</span><span class=\"n\">decidable_eq</span> <span class=\"n\">n&#39;</span><span class=\"o\">]</span>\n<span class=\"kn\">variables</span> <span class=\"o\">{</span><span class=\"n\">ι</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span><span class=\"o\">}</span> <span class=\"o\">[</span><span class=\"n\">fintype</span> <span class=\"n\">ι</span><span class=\"o\">]</span> <span class=\"o\">[</span><span class=\"n\">decidable_eq</span> <span class=\"n\">ι</span><span class=\"o\">]</span>\n\n<span class=\"kn\">section</span> <span class=\"n\">val</span>\n\n<span class=\"bp\">@</span><span class=\"o\">[</span><span class=\"n\">simp</span><span class=\"o\">]</span> <span class=\"kn\">lemma</span> <span class=\"n\">cons_val_succ</span> <span class=\"o\">(</span><span class=\"n\">x</span> <span class=\"o\">:</span> <span class=\"n\">ι</span> <span class=\"bp\">-&gt;</span> <span class=\"n\">α</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">u</span> <span class=\"o\">:</span> <span class=\"n\">fin</span> <span class=\"n\">n</span> <span class=\"bp\">×</span> <span class=\"n\">ι</span> <span class=\"bp\">→</span> <span class=\"n\">α</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">i</span> <span class=\"o\">:</span> <span class=\"n\">fin</span> <span class=\"n\">n</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">ix</span> <span class=\"o\">:</span> <span class=\"n\">ι</span><span class=\"o\">)</span> <span class=\"o\">:</span>\n  <span class=\"o\">(</span><span class=\"n\">vec_cons</span> <span class=\"n\">x</span> <span class=\"n\">u</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">i</span><span class=\"bp\">.</span><span class=\"n\">succ</span><span class=\"o\">,</span> <span class=\"n\">ix</span><span class=\"o\">)</span> <span class=\"bp\">=</span> <span class=\"n\">u</span> <span class=\"o\">(</span><span class=\"n\">i</span><span class=\"o\">,</span> <span class=\"n\">ix</span><span class=\"o\">)</span> <span class=\"o\">:=</span>\n<span class=\"k\">by</span> <span class=\"o\">{</span> <span class=\"n\">cases</span> <span class=\"n\">i</span><span class=\"o\">,</span> <span class=\"n\">refl</span> <span class=\"o\">}</span>\n\n<span class=\"bp\">@</span><span class=\"o\">[</span><span class=\"n\">simp</span><span class=\"o\">]</span> <span class=\"kn\">lemma</span> <span class=\"n\">tail_cons&#39;</span> <span class=\"o\">(</span><span class=\"n\">u</span> <span class=\"o\">:</span> <span class=\"n\">fin</span> <span class=\"o\">(</span><span class=\"n\">n</span> <span class=\"bp\">+</span> <span class=\"mi\">1</span><span class=\"o\">)</span> <span class=\"bp\">×</span> <span class=\"n\">ι</span> <span class=\"bp\">→</span> <span class=\"n\">α</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">k</span> <span class=\"o\">:</span> <span class=\"n\">fin</span> <span class=\"n\">n</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">ix</span> <span class=\"o\">:</span> <span class=\"n\">ι</span><span class=\"o\">)</span> <span class=\"o\">:</span>\n  <span class=\"n\">vec_tail</span> <span class=\"n\">u</span> <span class=\"o\">(</span><span class=\"n\">k</span><span class=\"o\">,</span> <span class=\"n\">ix</span><span class=\"o\">)</span> <span class=\"bp\">=</span> <span class=\"n\">u</span> <span class=\"o\">(</span><span class=\"n\">k</span><span class=\"bp\">.</span><span class=\"n\">succ</span><span class=\"o\">,</span> <span class=\"n\">ix</span><span class=\"o\">)</span> <span class=\"o\">:=</span>\n<span class=\"c1\">-- by { ext i, simp [vec_tail], cases i, cases i_fst, { simp [fin.cases], }, rw cons_val_succ&#39;&#39;,  }</span>\n<span class=\"k\">by</span> <span class=\"o\">{</span> <span class=\"n\">cases</span> <span class=\"n\">k</span><span class=\"o\">,</span> <span class=\"n\">refl</span> <span class=\"o\">}</span>\n\n<span class=\"kn\">end</span> <span class=\"n\">val</span>\n\n<span class=\"kn\">section</span> <span class=\"n\">dot_product</span>\n\n<span class=\"c\">/-</span><span class=\"cm\">- A product over the `univ` of a pair type equals to</span>\n<span class=\"cm\">the double product over the `univ`s of the `fst` and `snd` types. -/</span>\n<span class=\"bp\">@</span><span class=\"o\">[</span><span class=\"n\">to_additive</span> <span class=\"s2\">&quot;A sum over the `univ` of a pair type equals to</span>\n<span class=\"s2\">the double sum over the `univ`s of the `fst` and `snd` types.&quot;</span><span class=\"o\">]</span>\n<span class=\"kn\">lemma</span> <span class=\"n\">fintype</span><span class=\"bp\">.</span><span class=\"n\">prod_product_fintype</span> <span class=\"o\">{</span><span class=\"n\">α</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span> <span class=\"o\">{</span><span class=\"n\">β</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span> <span class=\"o\">{</span><span class=\"n\">M</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span> <span class=\"o\">[</span><span class=\"n\">fintype</span> <span class=\"n\">α</span><span class=\"o\">]</span> <span class=\"o\">[</span><span class=\"n\">comm_monoid</span> <span class=\"n\">M</span><span class=\"o\">]</span> <span class=\"o\">[</span><span class=\"n\">fintype</span> <span class=\"n\">β</span><span class=\"o\">]</span> <span class=\"o\">{</span><span class=\"n\">f</span> <span class=\"o\">:</span> <span class=\"n\">α</span> <span class=\"bp\">×</span> <span class=\"n\">β</span> <span class=\"bp\">→</span> <span class=\"n\">M</span><span class=\"o\">}</span> <span class=\"o\">:</span>\n  <span class=\"err\">∏</span> <span class=\"o\">(</span><span class=\"n\">x</span> <span class=\"o\">:</span> <span class=\"n\">α</span> <span class=\"bp\">×</span> <span class=\"n\">β</span><span class=\"o\">),</span> <span class=\"n\">f</span> <span class=\"n\">x</span> <span class=\"bp\">=</span> <span class=\"err\">∏</span> <span class=\"n\">x</span> <span class=\"o\">:</span> <span class=\"n\">α</span><span class=\"o\">,</span> <span class=\"err\">∏</span> <span class=\"n\">y</span> <span class=\"o\">:</span> <span class=\"n\">β</span><span class=\"o\">,</span> <span class=\"n\">f</span> <span class=\"o\">(</span><span class=\"n\">x</span><span class=\"o\">,</span> <span class=\"n\">y</span><span class=\"o\">)</span> <span class=\"o\">:=</span>\n<span class=\"k\">by</span> <span class=\"o\">{</span> <span class=\"n\">rw</span> <span class=\"bp\">&lt;-</span><span class=\"n\">finset</span><span class=\"bp\">.</span><span class=\"n\">prod_product</span><span class=\"o\">,</span> <span class=\"n\">refl</span> <span class=\"o\">}</span>\n\n<span class=\"kn\">variables</span> <span class=\"o\">[</span><span class=\"n\">add_comm_monoid</span> <span class=\"n\">α</span><span class=\"o\">]</span> <span class=\"o\">[</span><span class=\"n\">has_mul</span> <span class=\"n\">α</span><span class=\"o\">]</span>\n\n<span class=\"bp\">@</span><span class=\"o\">[</span><span class=\"n\">simp</span><span class=\"o\">]</span> <span class=\"kn\">lemma</span> <span class=\"n\">cons_dot_product</span> <span class=\"o\">(</span><span class=\"n\">x</span> <span class=\"o\">:</span> <span class=\"n\">ι</span> <span class=\"bp\">-&gt;</span> <span class=\"n\">α</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">v</span> <span class=\"o\">:</span> <span class=\"n\">fin</span> <span class=\"n\">n</span> <span class=\"bp\">×</span> <span class=\"n\">ι</span> <span class=\"bp\">→</span> <span class=\"n\">α</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">w</span> <span class=\"o\">:</span> <span class=\"n\">fin</span> <span class=\"n\">n</span><span class=\"bp\">.</span><span class=\"n\">succ</span> <span class=\"bp\">×</span> <span class=\"n\">ι</span> <span class=\"bp\">→</span> <span class=\"n\">α</span><span class=\"o\">)</span> <span class=\"o\">:</span>\n  <span class=\"n\">dot_product</span> <span class=\"o\">(</span><span class=\"n\">vec_cons</span> <span class=\"n\">x</span> <span class=\"n\">v</span><span class=\"o\">)</span> <span class=\"n\">w</span> <span class=\"bp\">=</span> <span class=\"n\">dot_product</span> <span class=\"n\">x</span> <span class=\"o\">(</span><span class=\"n\">vec_head</span> <span class=\"n\">w</span><span class=\"o\">)</span> <span class=\"bp\">+</span> <span class=\"n\">dot_product</span> <span class=\"n\">v</span> <span class=\"o\">(</span><span class=\"n\">vec_tail</span> <span class=\"n\">w</span><span class=\"o\">)</span> <span class=\"o\">:=</span>\n<span class=\"k\">begin</span>\n  <span class=\"n\">dsimp</span> <span class=\"n\">only</span> <span class=\"o\">[</span><span class=\"n\">dot_product</span><span class=\"o\">,</span> <span class=\"n\">vec_head</span><span class=\"o\">,</span> <span class=\"n\">vec_tail</span><span class=\"o\">],</span>\n  <span class=\"n\">rw</span> <span class=\"o\">[</span><span class=\"n\">fintype</span><span class=\"bp\">.</span><span class=\"n\">sum_product_fintype</span><span class=\"o\">,</span> <span class=\"bp\">@</span><span class=\"n\">finset</span><span class=\"bp\">.</span><span class=\"n\">sum_comm</span> <span class=\"n\">ι</span> <span class=\"bp\">_</span> <span class=\"bp\">_</span> <span class=\"bp\">_</span> <span class=\"bp\">_</span> <span class=\"bp\">_</span> <span class=\"bp\">_</span><span class=\"o\">,</span>\n      <span class=\"n\">fintype</span><span class=\"bp\">.</span><span class=\"n\">sum_product_fintype</span><span class=\"o\">,</span> <span class=\"bp\">@</span><span class=\"n\">finset</span><span class=\"bp\">.</span><span class=\"n\">sum_comm</span> <span class=\"n\">ι</span> <span class=\"bp\">_</span> <span class=\"bp\">_</span> <span class=\"bp\">_</span> <span class=\"bp\">_</span> <span class=\"bp\">_</span> <span class=\"bp\">_</span><span class=\"o\">,</span>\n      <span class=\"bp\">&lt;-</span><span class=\"n\">finset</span><span class=\"bp\">.</span><span class=\"n\">sum_add_distrib</span><span class=\"o\">],</span>\n  <span class=\"n\">refine</span> <span class=\"n\">congr_arg</span> <span class=\"n\">finset</span><span class=\"bp\">.</span><span class=\"n\">univ</span><span class=\"bp\">.</span><span class=\"n\">sum</span> <span class=\"bp\">_</span><span class=\"o\">,</span>\n  <span class=\"n\">ext</span> <span class=\"n\">i</span><span class=\"o\">,</span>\n  <span class=\"n\">simpa</span> <span class=\"o\">[</span><span class=\"n\">fin</span><span class=\"bp\">.</span><span class=\"n\">sum_univ_succ</span><span class=\"o\">],</span>\n<span class=\"kn\">end</span>\n\n<span class=\"bp\">@</span><span class=\"o\">[</span><span class=\"n\">simp</span><span class=\"o\">]</span> <span class=\"kn\">lemma</span> <span class=\"n\">dot_product_cons</span> <span class=\"o\">(</span><span class=\"n\">v</span> <span class=\"o\">:</span> <span class=\"n\">fin</span> <span class=\"n\">n</span><span class=\"bp\">.</span><span class=\"n\">succ</span> <span class=\"bp\">×</span> <span class=\"n\">ι</span> <span class=\"bp\">→</span> <span class=\"n\">α</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">x</span> <span class=\"o\">:</span> <span class=\"n\">ι</span> <span class=\"bp\">-&gt;</span> <span class=\"n\">α</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">w</span> <span class=\"o\">:</span> <span class=\"n\">fin</span> <span class=\"n\">n</span> <span class=\"bp\">×</span> <span class=\"n\">ι</span> <span class=\"bp\">→</span> <span class=\"n\">α</span><span class=\"o\">)</span> <span class=\"o\">:</span>\n  <span class=\"n\">dot_product</span> <span class=\"n\">v</span> <span class=\"o\">(</span><span class=\"n\">vec_cons</span> <span class=\"n\">x</span> <span class=\"n\">w</span><span class=\"o\">)</span> <span class=\"bp\">=</span> <span class=\"n\">dot_product</span> <span class=\"o\">(</span><span class=\"n\">vec_head</span> <span class=\"n\">v</span><span class=\"o\">)</span> <span class=\"n\">x</span> <span class=\"bp\">+</span> <span class=\"n\">dot_product</span> <span class=\"o\">(</span><span class=\"n\">vec_tail</span> <span class=\"n\">v</span><span class=\"o\">)</span> <span class=\"n\">w</span> <span class=\"o\">:=</span>\n<span class=\"k\">begin</span>\n  <span class=\"n\">dsimp</span> <span class=\"n\">only</span> <span class=\"o\">[</span><span class=\"n\">dot_product</span><span class=\"o\">,</span> <span class=\"n\">vec_head</span><span class=\"o\">,</span> <span class=\"n\">vec_tail</span><span class=\"o\">],</span>\n  <span class=\"n\">rw</span> <span class=\"o\">[</span><span class=\"n\">fintype</span><span class=\"bp\">.</span><span class=\"n\">sum_product_fintype</span><span class=\"o\">,</span> <span class=\"bp\">@</span><span class=\"n\">finset</span><span class=\"bp\">.</span><span class=\"n\">sum_comm</span> <span class=\"n\">ι</span> <span class=\"bp\">_</span> <span class=\"bp\">_</span> <span class=\"bp\">_</span> <span class=\"bp\">_</span> <span class=\"bp\">_</span> <span class=\"bp\">_</span><span class=\"o\">,</span>\n      <span class=\"n\">fintype</span><span class=\"bp\">.</span><span class=\"n\">sum_product_fintype</span><span class=\"o\">,</span> <span class=\"bp\">@</span><span class=\"n\">finset</span><span class=\"bp\">.</span><span class=\"n\">sum_comm</span> <span class=\"n\">ι</span> <span class=\"bp\">_</span> <span class=\"bp\">_</span> <span class=\"bp\">_</span> <span class=\"bp\">_</span> <span class=\"bp\">_</span> <span class=\"bp\">_</span><span class=\"o\">,</span>\n      <span class=\"bp\">&lt;-</span><span class=\"n\">finset</span><span class=\"bp\">.</span><span class=\"n\">sum_add_distrib</span><span class=\"o\">],</span>\n  <span class=\"n\">refine</span> <span class=\"n\">congr_arg</span> <span class=\"n\">finset</span><span class=\"bp\">.</span><span class=\"n\">univ</span><span class=\"bp\">.</span><span class=\"n\">sum</span> <span class=\"bp\">_</span><span class=\"o\">,</span>\n  <span class=\"n\">ext</span> <span class=\"n\">i</span><span class=\"o\">,</span>\n  <span class=\"n\">simpa</span> <span class=\"o\">[</span><span class=\"n\">fin</span><span class=\"bp\">.</span><span class=\"n\">sum_univ_succ</span><span class=\"o\">],</span>\n<span class=\"kn\">end</span>\n\n<span class=\"kn\">end</span> <span class=\"n\">dot_product</span>\n\n<span class=\"kn\">end</span> <span class=\"n\">matrix</span>\n</code></pre></div>",
        "id": 201886724,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1593023983
    },
    {
        "content": "<p>Even further golfed:</p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"bp\">@</span><span class=\"o\">[</span><span class=\"n\">simp</span><span class=\"o\">]</span> <span class=\"kn\">lemma</span> <span class=\"n\">cons_dot_product</span> <span class=\"o\">(</span><span class=\"n\">x</span> <span class=\"o\">:</span> <span class=\"n\">ι</span> <span class=\"bp\">-&gt;</span> <span class=\"n\">α</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">v</span> <span class=\"o\">:</span> <span class=\"n\">fin</span> <span class=\"n\">n</span> <span class=\"bp\">×</span> <span class=\"n\">ι</span> <span class=\"bp\">→</span> <span class=\"n\">α</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">w</span> <span class=\"o\">:</span> <span class=\"n\">fin</span> <span class=\"n\">n</span><span class=\"bp\">.</span><span class=\"n\">succ</span> <span class=\"bp\">×</span> <span class=\"n\">ι</span> <span class=\"bp\">→</span> <span class=\"n\">α</span><span class=\"o\">)</span> <span class=\"o\">:</span>\n  <span class=\"n\">dot_product</span> <span class=\"o\">(</span><span class=\"n\">vec_cons</span> <span class=\"n\">x</span> <span class=\"n\">v</span><span class=\"o\">)</span> <span class=\"n\">w</span> <span class=\"bp\">=</span> <span class=\"n\">dot_product</span> <span class=\"n\">x</span> <span class=\"o\">(</span><span class=\"n\">vec_head</span> <span class=\"n\">w</span><span class=\"o\">)</span> <span class=\"bp\">+</span> <span class=\"n\">dot_product</span> <span class=\"n\">v</span> <span class=\"o\">(</span><span class=\"n\">vec_tail</span> <span class=\"n\">w</span><span class=\"o\">)</span> <span class=\"o\">:=</span>\n<span class=\"k\">begin</span>\n  <span class=\"n\">dsimp</span> <span class=\"n\">only</span> <span class=\"o\">[</span><span class=\"n\">dot_product</span><span class=\"o\">,</span> <span class=\"n\">vec_head</span><span class=\"o\">,</span> <span class=\"n\">vec_tail</span><span class=\"o\">],</span>\n  <span class=\"n\">rw</span> <span class=\"o\">[</span><span class=\"n\">fintype</span><span class=\"bp\">.</span><span class=\"n\">sum_product_fintype</span><span class=\"o\">,</span> <span class=\"bp\">@</span><span class=\"n\">finset</span><span class=\"bp\">.</span><span class=\"n\">sum_comm</span> <span class=\"n\">ι</span> <span class=\"bp\">_</span> <span class=\"bp\">_</span> <span class=\"bp\">_</span> <span class=\"bp\">_</span> <span class=\"bp\">_</span> <span class=\"bp\">_</span><span class=\"o\">,</span>\n      <span class=\"n\">fintype</span><span class=\"bp\">.</span><span class=\"n\">sum_product_fintype</span><span class=\"o\">,</span> <span class=\"bp\">@</span><span class=\"n\">finset</span><span class=\"bp\">.</span><span class=\"n\">sum_comm</span> <span class=\"n\">ι</span> <span class=\"bp\">_</span> <span class=\"bp\">_</span> <span class=\"bp\">_</span> <span class=\"bp\">_</span> <span class=\"bp\">_</span> <span class=\"bp\">_</span><span class=\"o\">,</span>\n      <span class=\"bp\">&lt;-</span><span class=\"n\">finset</span><span class=\"bp\">.</span><span class=\"n\">sum_add_distrib</span><span class=\"o\">],</span>\n  <span class=\"n\">simpa</span> <span class=\"n\">only</span> <span class=\"o\">[</span><span class=\"n\">fin</span><span class=\"bp\">.</span><span class=\"n\">sum_univ_succ</span><span class=\"o\">,</span> <span class=\"n\">tail_cons&#39;</span><span class=\"o\">,</span> <span class=\"n\">cons_val_succ</span><span class=\"o\">]</span>\n<span class=\"kn\">end</span>\n\n<span class=\"bp\">@</span><span class=\"o\">[</span><span class=\"n\">simp</span><span class=\"o\">]</span> <span class=\"kn\">lemma</span> <span class=\"n\">dot_product_cons</span> <span class=\"o\">(</span><span class=\"n\">v</span> <span class=\"o\">:</span> <span class=\"n\">fin</span> <span class=\"n\">n</span><span class=\"bp\">.</span><span class=\"n\">succ</span> <span class=\"bp\">×</span> <span class=\"n\">ι</span> <span class=\"bp\">→</span> <span class=\"n\">α</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">x</span> <span class=\"o\">:</span> <span class=\"n\">ι</span> <span class=\"bp\">-&gt;</span> <span class=\"n\">α</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">w</span> <span class=\"o\">:</span> <span class=\"n\">fin</span> <span class=\"n\">n</span> <span class=\"bp\">×</span> <span class=\"n\">ι</span> <span class=\"bp\">→</span> <span class=\"n\">α</span><span class=\"o\">)</span> <span class=\"o\">:</span>\n  <span class=\"n\">dot_product</span> <span class=\"n\">v</span> <span class=\"o\">(</span><span class=\"n\">vec_cons</span> <span class=\"n\">x</span> <span class=\"n\">w</span><span class=\"o\">)</span> <span class=\"bp\">=</span> <span class=\"n\">dot_product</span> <span class=\"o\">(</span><span class=\"n\">vec_head</span> <span class=\"n\">v</span><span class=\"o\">)</span> <span class=\"n\">x</span> <span class=\"bp\">+</span> <span class=\"n\">dot_product</span> <span class=\"o\">(</span><span class=\"n\">vec_tail</span> <span class=\"n\">v</span><span class=\"o\">)</span> <span class=\"n\">w</span> <span class=\"o\">:=</span>\n<span class=\"k\">begin</span>\n  <span class=\"n\">dsimp</span> <span class=\"n\">only</span> <span class=\"o\">[</span><span class=\"n\">dot_product</span><span class=\"o\">,</span> <span class=\"n\">vec_head</span><span class=\"o\">,</span> <span class=\"n\">vec_tail</span><span class=\"o\">],</span>\n  <span class=\"n\">rw</span> <span class=\"o\">[</span><span class=\"n\">fintype</span><span class=\"bp\">.</span><span class=\"n\">sum_product_fintype</span><span class=\"o\">,</span> <span class=\"bp\">@</span><span class=\"n\">finset</span><span class=\"bp\">.</span><span class=\"n\">sum_comm</span> <span class=\"n\">ι</span> <span class=\"bp\">_</span> <span class=\"bp\">_</span> <span class=\"bp\">_</span> <span class=\"bp\">_</span> <span class=\"bp\">_</span> <span class=\"bp\">_</span><span class=\"o\">,</span>\n      <span class=\"n\">fintype</span><span class=\"bp\">.</span><span class=\"n\">sum_product_fintype</span><span class=\"o\">,</span> <span class=\"bp\">@</span><span class=\"n\">finset</span><span class=\"bp\">.</span><span class=\"n\">sum_comm</span> <span class=\"n\">ι</span> <span class=\"bp\">_</span> <span class=\"bp\">_</span> <span class=\"bp\">_</span> <span class=\"bp\">_</span> <span class=\"bp\">_</span> <span class=\"bp\">_</span><span class=\"o\">,</span>\n      <span class=\"bp\">&lt;-</span><span class=\"n\">finset</span><span class=\"bp\">.</span><span class=\"n\">sum_add_distrib</span><span class=\"o\">],</span>\n  <span class=\"n\">simpa</span> <span class=\"n\">only</span> <span class=\"o\">[</span><span class=\"n\">fin</span><span class=\"bp\">.</span><span class=\"n\">sum_univ_succ</span><span class=\"o\">,</span> <span class=\"n\">tail_cons&#39;</span><span class=\"o\">,</span> <span class=\"n\">cons_val_succ</span><span class=\"o\">]</span>\n<span class=\"kn\">end</span>\n</code></pre></div>",
        "id": 201888195,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1593024599
    },
    {
        "content": "<p>I'd been banging my head against the wall for like 4-5 days on these lemmas. And turns out just defining the <code>fintype.prod_product_fintype</code> and <code>tail_cons'</code> was all I needed. Is that a normal proof workflow? I feel like I went down too many wrong paths.</p>",
        "id": 201888492,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1593024732
    },
    {
        "content": "<p>I haven't been following the discussion but the last message sounds like you're learning.</p>",
        "id": 201888759,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1593024877
    },
    {
        "content": "<p>Without having any idea about the topic of the discussion, I can see uncurried functions and lots of underscores. This doesn't smell good.</p>",
        "id": 201888883,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1593024945
    },
    {
        "content": "<p>The uncurried functions are due to my trying to make lemmas about higher-dim \"matrices\" without having to rewrite them for <code>b -&gt; a</code>, <code>c -&gt; b -&gt; a</code>, <code>d -&gt; c -&gt; b -&gt; a</code>.</p>",
        "id": 201889076,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1593025035
    },
    {
        "content": "<p>where the head of those arguments is always a <code>fin n</code>. So my proving over the product type, I can stuff the rest of the arrows all into the <code>\\io</code> index type.</p>",
        "id": 201889196,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1593025084
    },
    {
        "content": "<p>This is fishy.</p>",
        "id": 201889340,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1593025174
    },
    {
        "content": "<p>What do you call higher-dim matrices? Tensors?</p>",
        "id": 201889430,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1593025207
    },
    {
        "content": "<p>Yakov yes, this is exactly the workflow for learning Lean. You get interested in something, you work on it, you come up with some <em>concrete Lean code</em> which works, or doesn't quite work, you post it, others look at it and suggest fixes or changes, and proofs just get neater and neater. It doesn't matter how much you understand the material \"informally\", there is some kind of a knack for getting it into Lean which you learn by doing (writing code) and getting others to look at it. The vast majority of us learnt this way. The power of this chat is that there are a whole bunch of experts on it -- your situation was sufficiently basic that an intermediate user like me could help, but as you get better and maybe more specialised then you ask more challenging questions with your code and experts who know the system inside out give you more subtle answers (e.g. there are very subtle questions which can come up regarding e.g. the type class inference system).</p>",
        "id": 201889730,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1593025365
    },
    {
        "content": "<p>I'm a fan of that sort of learning style. The hope is that everyone remains eager to teach each other</p>",
        "id": 201890961,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1593025949
    },
    {
        "content": "<p>What do you find fishy about that sort of construction, Patrick?</p>",
        "id": 201890985,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1593025966
    },
    {
        "content": "<p>Once could call them tensors, although in a mathlib that seems inappropriate. Higher dim matrices is a numpy style moniker.</p>",
        "id": 201891093,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1593026032
    },
    {
        "content": "<p>I thought they were called holors :-)</p>",
        "id": 201891163,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1593026057
    },
    {
        "content": "<p>Holors, from what I looked at in the lib, don't have good support for cons, they seemed to me to be more about construct-once at desired shape</p>",
        "id": 201891234,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1593026117
    },
    {
        "content": "<p>I'm editing the matrix notation file, and didn't want to write repetitive lemmas about matrices for the ones that were already written about vectors. Seemed to me that they were general statements about cons, head, tail, etc that did not rely on 1- or 2- dimensionality</p>",
        "id": 201891443,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1593026224
    },
    {
        "content": "<p>And also a good way to flex/train my lean programming skills</p>",
        "id": 201891670,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1593026382
    }
]