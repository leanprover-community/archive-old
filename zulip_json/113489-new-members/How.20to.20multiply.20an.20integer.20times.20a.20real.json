[
    {
        "content": "<p>The first check works and the second throws an error:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kn\">import</span> <span class=\"n\">data.real.basic</span>\n<span class=\"kn\">import</span> <span class=\"n\">analysis.special_functions.pow</span>\n\n<span class=\"kd\">variable</span> <span class=\"n\">a</span> <span class=\"o\">:</span> <span class=\"n\">ℤ</span>\n\n<span class=\"k\">#check</span> <span class=\"o\">((</span><span class=\"mi\">9</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">)</span> <span class=\"bp\">^</span> <span class=\"o\">((</span><span class=\"mi\">1</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">)</span><span class=\"bp\">/</span><span class=\"o\">(</span><span class=\"mi\">4</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">)))</span> <span class=\"c1\">-- OK</span>\n\n<span class=\"k\">#check</span> <span class=\"n\">a</span><span class=\"bp\">*</span><span class=\"o\">((</span><span class=\"mi\">9</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">)</span> <span class=\"bp\">^</span> <span class=\"o\">((</span><span class=\"mi\">1</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">)</span><span class=\"bp\">/</span><span class=\"o\">(</span><span class=\"mi\">4</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">)))</span> <span class=\"c1\">-- error</span>\n</code></pre></div>\n<p>The error is</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"n\">foo1.lean</span><span class=\"o\">:</span><span class=\"mi\">8</span><span class=\"o\">:</span><span class=\"mi\">16</span>\n<span class=\"n\">type</span> <span class=\"n\">mismatch</span> <span class=\"n\">at</span> <span class=\"n\">application</span>\n  <span class=\"n\">pow</span> <span class=\"mi\">9</span>\n<span class=\"n\">term</span>\n  <span class=\"mi\">9</span>\n<span class=\"n\">has</span> <span class=\"n\">type</span>\n  <span class=\"n\">ℝ</span>\n<span class=\"n\">but</span> <span class=\"n\">is</span> <span class=\"n\">expected</span> <span class=\"n\">to</span> <span class=\"k\">have</span> <span class=\"n\">type</span>\n  <span class=\"n\">ℤ</span>\n<span class=\"n\">foo1.lean</span><span class=\"o\">:</span><span class=\"mi\">8</span><span class=\"o\">:</span><span class=\"mi\">16</span>\n<span class=\"n\">failed</span> <span class=\"n\">to</span> <span class=\"n\">synthesize</span> <span class=\"n\">type</span> <span class=\"kd\">class</span> <span class=\"kd\">instance</span> <span class=\"n\">for</span>\n<span class=\"n\">a</span> <span class=\"o\">:</span> <span class=\"n\">ℤ</span>\n<span class=\"bp\">⊢</span> <span class=\"n\">has_pow</span> <span class=\"n\">ℤ</span> <span class=\"n\">ℝ</span>\n</code></pre></div>\n<p>I'm trying to figure out how to state this theorem:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kn\">import</span> <span class=\"n\">data.real.basic</span>\n<span class=\"kn\">import</span> <span class=\"n\">analysis.special_functions.pow</span>\n\n<span class=\"kd\">theorem</span> <span class=\"n\">ex6e_mul_closed</span> <span class=\"o\">(</span><span class=\"n\">a</span> <span class=\"n\">b</span> <span class=\"n\">c</span> <span class=\"n\">d</span> <span class=\"o\">:</span> <span class=\"n\">ℤ</span><span class=\"o\">):</span>\n  <span class=\"o\">(</span><span class=\"n\">a</span> <span class=\"bp\">+</span> <span class=\"n\">b</span> <span class=\"bp\">*</span> <span class=\"o\">((</span><span class=\"mi\">9</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">)</span> <span class=\"bp\">^</span> <span class=\"o\">((</span><span class=\"mi\">1</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">)</span><span class=\"bp\">/</span><span class=\"o\">(</span><span class=\"mi\">4</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">))))</span> <span class=\"bp\">*</span> <span class=\"o\">(</span><span class=\"n\">c</span> <span class=\"bp\">+</span> <span class=\"n\">d</span> <span class=\"bp\">*</span> <span class=\"o\">((</span><span class=\"mi\">9</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">)</span> <span class=\"bp\">^</span> <span class=\"o\">((</span><span class=\"mi\">1</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">)</span><span class=\"bp\">/</span><span class=\"o\">(</span><span class=\"mi\">4</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">))))</span><span class=\"bp\">=</span>\n  <span class=\"o\">(</span><span class=\"n\">a</span> <span class=\"bp\">*</span> <span class=\"n\">c</span> <span class=\"bp\">+</span> <span class=\"n\">b</span> <span class=\"bp\">*</span> <span class=\"n\">d</span> <span class=\"bp\">*</span> <span class=\"mi\">3</span><span class=\"o\">)</span> <span class=\"bp\">+</span> <span class=\"o\">(</span><span class=\"n\">a</span><span class=\"bp\">*</span><span class=\"n\">d</span> <span class=\"bp\">+</span> <span class=\"n\">b</span> <span class=\"bp\">*</span> <span class=\"n\">c</span><span class=\"o\">)</span> <span class=\"bp\">*</span> <span class=\"o\">((</span><span class=\"mi\">9</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">)</span> <span class=\"bp\">^</span> <span class=\"o\">((</span><span class=\"mi\">1</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">)</span><span class=\"bp\">/</span><span class=\"o\">(</span><span class=\"mi\">4</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">)))</span> <span class=\"o\">:=</span>\n  <span class=\"gr\">sorry</span>\n</code></pre></div>",
        "id": 221717240,
        "sender_full_name": "Lars Ericson",
        "timestamp": 1609890179
    },
    {
        "content": "<p>Lean reads from left to right. Read <code>a*((9:ℝ) ^ ((1:ℝ)/(4:ℝ)))</code> from left to right. First we see <code>a</code>. This is an integer. Then we see <code>*</code>. That is multiplication, which takes two elements of type X and returns an element of type X. Then we solve for X, and it's easy to solve -- a is an integer, so X must be the integers. Then we read on and see real numbers instead of integers. Then we get confused and produce an error.</p>",
        "id": 221717869,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1609890637
    },
    {
        "content": "<p>The fix is to not let Lean solve for X incorrectly, by not letting it see the integer a, e.g. by writing <code>(a : ℝ)</code> instead of <code>a</code>. Then it will set X = reals and then you should hopefully be fine.</p>",
        "id": 221717970,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1609890695
    },
    {
        "content": "<p>The problem is that I have to have <code>a</code> be an integer for this particular theorem.  That's why I said <code>variable a : ℤ</code>. I am trying to prove that expressions of form a + b * 9^(1/4) are closed under multiplication, where a and b are integers and 9^(1/4) is a particular irrational number.   Writing <code>a : ℝ</code> won't get me there.</p>",
        "id": 221722383,
        "sender_full_name": "Lars Ericson",
        "timestamp": 1609894300
    },
    {
        "content": "<p>I think Kevin's suggestion is not to replace the <code>variable</code> statement, but to add the type coercion to the expression you're interested in:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kn\">import</span> <span class=\"n\">data.real.basic</span>\n<span class=\"kn\">import</span> <span class=\"n\">analysis.special_functions.pow</span>\n\n<span class=\"kd\">variable</span> <span class=\"n\">a</span> <span class=\"o\">:</span> <span class=\"n\">ℤ</span>\n\n<span class=\"k\">#check</span> <span class=\"o\">((</span><span class=\"mi\">9</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">)</span> <span class=\"bp\">^</span> <span class=\"o\">((</span><span class=\"mi\">1</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">)</span><span class=\"bp\">/</span><span class=\"o\">(</span><span class=\"mi\">4</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">)))</span> <span class=\"c1\">-- OK</span>\n\n<span class=\"k\">#check</span> <span class=\"o\">(</span><span class=\"n\">a</span> <span class=\"o\">:</span> <span class=\"n\">ℝ</span><span class=\"o\">)</span><span class=\"bp\">*</span><span class=\"o\">((</span><span class=\"mi\">9</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">)</span> <span class=\"bp\">^</span> <span class=\"o\">((</span><span class=\"mi\">1</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">)</span><span class=\"bp\">/</span><span class=\"o\">(</span><span class=\"mi\">4</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">)))</span> <span class=\"c1\">-- also OK</span>\n</code></pre></div>",
        "id": 221722588,
        "sender_full_name": "Bryan Gin-ge Chen",
        "timestamp": 1609894484
    },
    {
        "content": "<p>Thanks <span class=\"user-mention\" data-user-id=\"110038\">@Kevin Buzzard</span> and <span class=\"user-mention\" data-user-id=\"123965\">@Bryan Gin-ge Chen</span>.  The following is a bit more awkward but it better represents what I am trying to prove, and doesn't raise an error, I guess because the <code>subring</code> tells Lean something that makes it  find a <code>has_pow</code> for this case:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kn\">import</span> <span class=\"n\">data.real.basic</span>\n<span class=\"kn\">import</span> <span class=\"n\">analysis.special_functions.pow</span>\n\n<span class=\"kd\">theorem</span> <span class=\"n\">ex6e_mul_closed</span> <span class=\"o\">:</span> <span class=\"bp\">∃</span> <span class=\"n\">s</span> <span class=\"o\">:</span> <span class=\"n\">subring</span> <span class=\"n\">ℝ</span><span class=\"o\">,</span>\n      <span class=\"bp\">∀</span> <span class=\"n\">x</span> <span class=\"n\">y</span> <span class=\"n\">z</span><span class=\"o\">:</span> <span class=\"n\">ℝ</span><span class=\"o\">,</span>\n      <span class=\"n\">x</span> <span class=\"bp\">∈</span> <span class=\"n\">s</span> <span class=\"bp\">→</span>\n      <span class=\"n\">y</span> <span class=\"bp\">∈</span> <span class=\"n\">s</span> <span class=\"bp\">→</span>\n      <span class=\"n\">z</span> <span class=\"bp\">∈</span> <span class=\"n\">s</span> <span class=\"bp\">→</span>\n      <span class=\"bp\">∀</span> <span class=\"n\">a</span> <span class=\"n\">b</span> <span class=\"n\">c</span> <span class=\"n\">d</span><span class=\"o\">:</span> <span class=\"n\">ℤ</span><span class=\"o\">,</span>\n      <span class=\"n\">x</span> <span class=\"bp\">=</span> <span class=\"n\">a</span> <span class=\"bp\">+</span> <span class=\"n\">b</span> <span class=\"bp\">*</span> <span class=\"o\">((</span><span class=\"mi\">9</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">)</span> <span class=\"bp\">^</span> <span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"bp\">/</span><span class=\"mi\">4</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">))</span> <span class=\"bp\">→</span>\n      <span class=\"n\">y</span> <span class=\"bp\">=</span> <span class=\"n\">c</span> <span class=\"bp\">+</span> <span class=\"n\">d</span> <span class=\"bp\">*</span> <span class=\"o\">((</span><span class=\"mi\">9</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">)</span> <span class=\"bp\">^</span> <span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"bp\">/</span><span class=\"mi\">4</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">))</span> <span class=\"bp\">→</span>\n      <span class=\"n\">z</span> <span class=\"bp\">=</span> <span class=\"n\">x</span> <span class=\"bp\">*</span> <span class=\"n\">y</span> <span class=\"bp\">→</span>\n      <span class=\"n\">z</span> <span class=\"bp\">=</span> <span class=\"o\">(</span><span class=\"n\">a</span> <span class=\"bp\">*</span> <span class=\"n\">c</span> <span class=\"bp\">+</span> <span class=\"n\">b</span> <span class=\"bp\">*</span> <span class=\"n\">d</span> <span class=\"bp\">*</span> <span class=\"mi\">3</span><span class=\"o\">)</span> <span class=\"bp\">+</span> <span class=\"o\">(</span><span class=\"n\">a</span> <span class=\"bp\">*</span> <span class=\"n\">d</span> <span class=\"bp\">+</span> <span class=\"n\">b</span> <span class=\"bp\">*</span> <span class=\"n\">c</span><span class=\"o\">)</span> <span class=\"bp\">*</span> <span class=\"o\">(</span><span class=\"mi\">9</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">)</span> <span class=\"bp\">^</span> <span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"bp\">/</span><span class=\"mi\">4</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">)</span>\n      <span class=\"o\">:=</span>\n<span class=\"gr\">sorry</span>\n</code></pre></div>",
        "id": 221723168,
        "sender_full_name": "Lars Ericson",
        "timestamp": 1609895103
    },
    {
        "content": "<p>That's a strange way to state that. Shouldn't the last two lines just be <code>x * y \\in s</code>?</p>",
        "id": 221723401,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1609895382
    },
    {
        "content": "<p>You seem to be mixing the proof with the theorem statement</p>",
        "id": 221723449,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1609895417
    },
    {
        "content": "<p>As Kevin said, Lean reads each expression from left to right, so it has no problem realizing that <code>a</code> in <code>x = a + b * ((9:ℝ) ^ (1/4:ℝ))</code> needs to be coerced to <code>ℝ</code>, since it's already seen <code>x</code> which is of type <code>ℝ</code>.</p>",
        "id": 221723476,
        "sender_full_name": "Bryan Gin-ge Chen",
        "timestamp": 1609895478
    },
    {
        "content": "<p>I think your statement can be proved with <code>use [\\top], ...</code> which shows your statement is wrong</p>",
        "id": 221723584,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1609895618
    },
    {
        "content": "<p>I'm trying to build up pieces of a proof that I have a subring by showing that the form <code>a+b*I</code> is closed under addition and multiplication where <code>I=(9:ℝ) ^ (1/4:ℝ)</code> and <code>a b: ℤ</code>.  So this is a lemma about closed under multiplication.  Here is an even more awkward statement of it:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kn\">import</span> <span class=\"n\">data.real.basic</span>\n<span class=\"kn\">import</span> <span class=\"n\">analysis.special_functions.pow</span>\n\n<span class=\"kd\">theorem</span> <span class=\"n\">ex6e_mul_closed</span> <span class=\"o\">:</span> <span class=\"bp\">∃</span> <span class=\"n\">s</span> <span class=\"o\">:</span> <span class=\"n\">subring</span> <span class=\"n\">ℝ</span><span class=\"o\">,</span>\n      <span class=\"bp\">∀</span> <span class=\"n\">x</span> <span class=\"n\">y</span> <span class=\"n\">z</span><span class=\"o\">:</span> <span class=\"n\">ℝ</span><span class=\"o\">,</span>\n      <span class=\"n\">x</span> <span class=\"bp\">∈</span> <span class=\"n\">s</span> <span class=\"bp\">→</span>\n      <span class=\"n\">y</span> <span class=\"bp\">∈</span> <span class=\"n\">s</span> <span class=\"bp\">→</span>\n      <span class=\"n\">z</span> <span class=\"bp\">∈</span> <span class=\"n\">s</span> <span class=\"bp\">→</span>\n      <span class=\"bp\">∀</span> <span class=\"n\">a</span> <span class=\"n\">b</span> <span class=\"n\">c</span> <span class=\"n\">d</span><span class=\"o\">:</span> <span class=\"n\">ℤ</span><span class=\"o\">,</span>\n      <span class=\"n\">x</span> <span class=\"bp\">=</span> <span class=\"n\">a</span> <span class=\"bp\">+</span> <span class=\"n\">b</span> <span class=\"bp\">*</span> <span class=\"o\">((</span><span class=\"mi\">9</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">)</span> <span class=\"bp\">^</span> <span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"bp\">/</span><span class=\"mi\">4</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">))</span> <span class=\"bp\">→</span>\n      <span class=\"n\">y</span> <span class=\"bp\">=</span> <span class=\"n\">c</span> <span class=\"bp\">+</span> <span class=\"n\">d</span> <span class=\"bp\">*</span> <span class=\"o\">((</span><span class=\"mi\">9</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">)</span> <span class=\"bp\">^</span> <span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"bp\">/</span><span class=\"mi\">4</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">))</span> <span class=\"bp\">→</span>\n      <span class=\"n\">z</span> <span class=\"bp\">=</span> <span class=\"n\">x</span> <span class=\"bp\">*</span> <span class=\"n\">y</span> <span class=\"bp\">→</span>\n      <span class=\"bp\">∃</span> <span class=\"n\">e</span> <span class=\"n\">f</span><span class=\"o\">:</span> <span class=\"n\">ℤ</span><span class=\"o\">,</span>\n      <span class=\"n\">e</span> <span class=\"bp\">=</span> <span class=\"n\">a</span> <span class=\"bp\">*</span> <span class=\"n\">c</span> <span class=\"bp\">+</span> <span class=\"n\">b</span> <span class=\"bp\">*</span> <span class=\"n\">d</span> <span class=\"bp\">*</span> <span class=\"mi\">3</span> <span class=\"bp\">∧</span>\n      <span class=\"n\">f</span> <span class=\"bp\">=</span> <span class=\"n\">a</span> <span class=\"bp\">*</span> <span class=\"n\">d</span> <span class=\"bp\">+</span> <span class=\"n\">b</span> <span class=\"bp\">*</span> <span class=\"n\">c</span> <span class=\"bp\">∧</span>\n      <span class=\"n\">z</span> <span class=\"bp\">=</span> <span class=\"n\">e</span> <span class=\"bp\">+</span> <span class=\"n\">f</span> <span class=\"bp\">*</span> <span class=\"o\">(</span><span class=\"mi\">9</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">)</span> <span class=\"bp\">^</span> <span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"bp\">/</span><span class=\"mi\">4</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">)</span>\n      <span class=\"o\">:=</span>\n<span class=\"kd\">begin</span>\n  <span class=\"gr\">sorry</span>\n<span class=\"kd\">end</span>\n</code></pre></div>\n<p>I am borrowing the <code>∃ s : subring ℝ</code> from the theorem I want to prove which is</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kd\">theorem</span> <span class=\"n\">ex6e</span> <span class=\"o\">:</span> <span class=\"bp\">∃</span> <span class=\"n\">s</span> <span class=\"o\">:</span> <span class=\"n\">subring</span> <span class=\"n\">ℝ</span><span class=\"o\">,</span> <span class=\"bp\">∀</span> <span class=\"n\">x</span> <span class=\"o\">:</span> <span class=\"n\">ℝ</span><span class=\"o\">,</span> <span class=\"n\">x</span> <span class=\"bp\">∈</span> <span class=\"n\">s</span> <span class=\"bp\">↔</span> <span class=\"bp\">∃</span> <span class=\"n\">a</span> <span class=\"n\">b</span> <span class=\"o\">:</span> <span class=\"n\">ℤ</span><span class=\"o\">,</span> <span class=\"n\">x</span> <span class=\"bp\">=</span> <span class=\"n\">a</span> <span class=\"bp\">+</span> <span class=\"n\">b</span> <span class=\"bp\">*</span> <span class=\"o\">(</span><span class=\"mi\">9</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">)</span> <span class=\"bp\">^</span> <span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"bp\">/</span><span class=\"mi\">4</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"gr\">sorry</span>\n</code></pre></div>\n<p>I'm just putting it up there to get the <code>has_pow</code> problem to go away.  It's chicken and egg though because I need to prove closed under multiplication before I have a <code>subring</code>, because it's part of the proof of <code>subring</code>.</p>\n<p>I guess I have to rethink this and use <code>instance</code> or look at the structure for <code>subring</code> directly and prove the structure all at one time without lemmas.</p>\n<p>Basically I need a framework where I can have a space where I prove the closed under multiplication and a space where I prove the closed under addition.  I guess that's an <code>instance</code>.</p>",
        "id": 221724395,
        "sender_full_name": "Lars Ericson",
        "timestamp": 1609896489
    },
    {
        "content": "<p>The proof of closure is <code>s.mul_mem</code> for your subring lemma</p>",
        "id": 221725120,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1609897425
    },
    {
        "content": "<p>That's the right idea going in the wrong direction.  <code>s.mul_mem</code> says that if I have a subring already, then it is closed under multiplication. </p>\n<p>I have to go the other way: I am closed under multiplication and addition, and hence I am a subring.  </p>\n<p>So net net I need to do <code>instance: subring</code> of some sort  where what I am focusing on now is the <code>mul_mem'</code> and <code>add_mem'</code> fields of the structure, but I also have to do the other fields.  It looks like I can't do these facets as separate lemmas, I have to do everything all at once.  They have to be inside the proof of the <code>instance</code> so I can get Lean to give me <code>has_pow</code> between integers and reals while I am in the process of proving my subring, and not after I have proven the subring, which I can't assume because I haven't proven it yet.</p>\n<p>Or I guess what you are saying is that Lean is coercing my integers to reals before applying <code>has_pow</code>. Which is OK but it is essential to the nature of what I am proving that my integers are integers \"where it counts\".  I guess \"where it counts\" is when I establish that the result of addition or multiplication is of form A+B*I where A and B are definitely integers and I is definitely the real 9^(1/4).</p>",
        "id": 221725679,
        "sender_full_name": "Lars Ericson",
        "timestamp": 1609898061
    },
    {
        "content": "<p>You don't need an <code>instance</code>, you just need a structure. Your proof is the existence of such a structure. You can start your proof of an existence of such a subring (with whatever properties it has) with some statement about <code>subring.mk'</code> if you want.</p>",
        "id": 221726133,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1609898676
    },
    {
        "content": "<p>Can you post an image or a latex of the actual problem statement you are formalizing?</p>",
        "id": 221726138,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1609898690
    },
    {
        "content": "<p>6E:<br>\n<a href=\"/user_uploads/3121/ToS9DynKtS7wTY3wHcwmSKLD/Screenshot-from-2021-01-05-21-23-27.png\">Screenshot-from-2021-01-05-21-23-27.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/ToS9DynKtS7wTY3wHcwmSKLD/Screenshot-from-2021-01-05-21-23-27.png\" title=\"Screenshot-from-2021-01-05-21-23-27.png\"><img src=\"/user_uploads/3121/ToS9DynKtS7wTY3wHcwmSKLD/Screenshot-from-2021-01-05-21-23-27.png\"></a></div>",
        "id": 221727027,
        "sender_full_name": "Lars Ericson",
        "timestamp": 1609899835
    },
    {
        "content": "<p><code>a</code> and <code>b</code> have to start life as integers.  I can coerce them to real to do the multiplication with the <code>pow</code>, but I have to un-coerce the results of times and plus afterwards back to integer to prove the subring.</p>",
        "id": 221727163,
        "sender_full_name": "Lars Ericson",
        "timestamp": 1609899963
    },
    {
        "content": "<p>Try this:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kn\">import</span> <span class=\"n\">data.real.basic</span>\n<span class=\"kn\">import</span> <span class=\"n\">analysis.special_functions.pow</span>\n\n<span class=\"kd\">theorem</span> <span class=\"n\">ex6e</span> <span class=\"o\">:</span> <span class=\"bp\">∃</span> <span class=\"o\">(</span><span class=\"n\">s</span> <span class=\"o\">:</span> <span class=\"n\">subring</span> <span class=\"n\">ℝ</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">hs</span> <span class=\"o\">:</span> <span class=\"n\">s</span> <span class=\"bp\">≠</span> <span class=\"bp\">⊤</span><span class=\"o\">),</span>\n  <span class=\"bp\">∀</span> <span class=\"o\">(</span><span class=\"n\">a</span> <span class=\"n\">b</span> <span class=\"o\">:</span> <span class=\"n\">ℤ</span><span class=\"o\">),</span> <span class=\"o\">(</span><span class=\"n\">a</span> <span class=\"o\">:</span> <span class=\"n\">ℝ</span><span class=\"o\">)</span> <span class=\"bp\">+</span> <span class=\"n\">b</span> <span class=\"bp\">*</span> <span class=\"o\">(</span><span class=\"mi\">9</span> <span class=\"bp\">^</span> <span class=\"o\">(</span><span class=\"mi\">1</span> <span class=\"bp\">/</span> <span class=\"mi\">4</span><span class=\"o\">))</span> <span class=\"bp\">∈</span> <span class=\"n\">s</span> <span class=\"o\">:=</span>\n<span class=\"kd\">begin</span>\n  <span class=\"n\">refine</span> <span class=\"o\">⟨</span><span class=\"n\">subring.mk'</span> <span class=\"n\">_</span> <span class=\"n\">_</span> <span class=\"n\">_</span> <span class=\"n\">_</span> <span class=\"n\">_</span><span class=\"o\">,</span> <span class=\"n\">_</span><span class=\"o\">,</span> <span class=\"n\">_</span><span class=\"o\">⟩,</span>\n<span class=\"kd\">end</span>\n</code></pre></div>",
        "id": 221727394,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1609900270
    },
    {
        "content": "<p>or use <code>subring.closure _</code></p>",
        "id": 221728194,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1609901316
    },
    {
        "content": "<p>But I can't make it work:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kn\">import</span> <span class=\"n\">data.real.basic</span>\n<span class=\"kn\">import</span> <span class=\"n\">analysis.special_functions.pow</span>\n\n<span class=\"kd\">set_option</span> <span class=\"n\">pp.all</span> <span class=\"n\">true</span>\n\n<span class=\"kd\">theorem</span> <span class=\"n\">ex6e</span> <span class=\"o\">:</span> <span class=\"bp\">∃</span> <span class=\"o\">(</span><span class=\"n\">s</span> <span class=\"o\">:</span> <span class=\"n\">subring</span> <span class=\"n\">ℝ</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">hs</span> <span class=\"o\">:</span> <span class=\"n\">s</span> <span class=\"bp\">≠</span> <span class=\"bp\">⊤</span><span class=\"o\">),</span>\n  <span class=\"bp\">∀</span> <span class=\"o\">(</span><span class=\"n\">a</span> <span class=\"n\">b</span> <span class=\"o\">:</span> <span class=\"n\">ℤ</span><span class=\"o\">),</span> <span class=\"o\">(</span><span class=\"n\">a</span> <span class=\"o\">:</span> <span class=\"n\">ℝ</span><span class=\"o\">)</span> <span class=\"bp\">+</span> <span class=\"n\">b</span> <span class=\"bp\">*</span> <span class=\"o\">(</span><span class=\"mi\">9</span> <span class=\"bp\">^</span> <span class=\"o\">((</span><span class=\"mi\">1</span> <span class=\"o\">:</span> <span class=\"n\">ℝ</span><span class=\"o\">)</span> <span class=\"bp\">/</span> <span class=\"mi\">4</span><span class=\"o\">))</span> <span class=\"bp\">∈</span> <span class=\"n\">s</span> <span class=\"o\">:=</span>\n<span class=\"kd\">begin</span>\n  <span class=\"n\">set</span> <span class=\"n\">s</span> <span class=\"o\">:</span> <span class=\"n\">set</span> <span class=\"n\">ℝ</span> <span class=\"o\">:=</span> <span class=\"n\">set.insert</span> <span class=\"o\">(</span><span class=\"mi\">9</span> <span class=\"bp\">^</span> <span class=\"o\">((</span><span class=\"mi\">1</span> <span class=\"o\">:</span> <span class=\"n\">ℝ</span><span class=\"o\">)</span> <span class=\"bp\">/</span> <span class=\"mi\">4</span><span class=\"o\">))</span> <span class=\"o\">(</span><span class=\"n\">set.range</span> <span class=\"o\">(</span><span class=\"n\">coe</span> <span class=\"o\">:</span> <span class=\"n\">ℤ</span> <span class=\"bp\">→</span> <span class=\"n\">ℝ</span><span class=\"o\">))</span> <span class=\"k\">with</span> <span class=\"n\">hs</span><span class=\"o\">,</span>\n  <span class=\"n\">refine</span> <span class=\"o\">⟨</span><span class=\"n\">subring.mk'</span> <span class=\"n\">_</span> <span class=\"n\">_</span> <span class=\"n\">_</span> <span class=\"n\">_</span> <span class=\"n\">_</span><span class=\"o\">,</span> <span class=\"n\">_</span><span class=\"o\">,</span> <span class=\"n\">_</span><span class=\"o\">⟩,</span>\n  <span class=\"o\">{</span> <span class=\"n\">exact</span> <span class=\"n\">s</span> <span class=\"o\">},</span>\n  <span class=\"o\">{</span> <span class=\"n\">refine</span> <span class=\"o\">{</span><span class=\"n\">carrier</span> <span class=\"o\">:=</span> <span class=\"n\">s</span><span class=\"o\">,</span> <span class=\"n\">one_mem'</span> <span class=\"o\">:=</span> <span class=\"n\">_</span><span class=\"o\">,</span> <span class=\"n\">mul_mem'</span> <span class=\"o\">:=</span> <span class=\"n\">_</span><span class=\"o\">},</span>\n    <span class=\"o\">{</span> <span class=\"n\">rw</span> <span class=\"o\">[</span><span class=\"n\">hs</span><span class=\"o\">],</span>\n      <span class=\"k\">have</span> <span class=\"o\">:=</span> <span class=\"bp\">@</span><span class=\"n\">set.mem_insert_iff</span> <span class=\"n\">ℝ</span> <span class=\"mi\">1</span> <span class=\"o\">(</span><span class=\"mi\">9</span> <span class=\"bp\">^</span> <span class=\"o\">((</span><span class=\"mi\">1</span> <span class=\"o\">:</span> <span class=\"n\">ℝ</span><span class=\"o\">)</span> <span class=\"bp\">/</span> <span class=\"mi\">4</span><span class=\"o\">))</span> <span class=\"o\">(</span><span class=\"n\">set.range</span> <span class=\"o\">(</span><span class=\"n\">coe</span> <span class=\"o\">:</span> <span class=\"n\">ℤ</span> <span class=\"bp\">→</span> <span class=\"n\">ℝ</span><span class=\"o\">)),</span>\n      <span class=\"n\">rw</span> <span class=\"n\">this</span><span class=\"o\">,</span> <span class=\"c1\">-- failure, they look the same to me though</span>\n      <span class=\"gr\">sorry</span>\n    <span class=\"o\">},</span>\n  <span class=\"o\">},</span>\n  <span class=\"gr\">sorry</span>\n<span class=\"kd\">end</span>\n</code></pre></div>",
        "id": 221731015,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1609904906
    },
    {
        "content": "<p>Is there some weird typo I made, or some typeclass issue?</p>",
        "id": 221731024,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1609904944
    },
    {
        "content": "<p>If <code>rw</code> fails me I try <code>erw</code> instead</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kn\">import</span> <span class=\"n\">data.real.basic</span>\n<span class=\"kn\">import</span> <span class=\"n\">analysis.special_functions.pow</span>\n\n<span class=\"c1\">--set_option pp.all true</span>\n\n<span class=\"kd\">theorem</span> <span class=\"n\">ex6e</span> <span class=\"o\">:</span> <span class=\"bp\">∃</span> <span class=\"o\">(</span><span class=\"n\">s</span> <span class=\"o\">:</span> <span class=\"n\">subring</span> <span class=\"n\">ℝ</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">hs</span> <span class=\"o\">:</span> <span class=\"n\">s</span> <span class=\"bp\">≠</span> <span class=\"bp\">⊤</span><span class=\"o\">),</span>\n  <span class=\"bp\">∀</span> <span class=\"o\">(</span><span class=\"n\">a</span> <span class=\"n\">b</span> <span class=\"o\">:</span> <span class=\"n\">ℤ</span><span class=\"o\">),</span> <span class=\"o\">(</span><span class=\"n\">a</span> <span class=\"o\">:</span> <span class=\"n\">ℝ</span><span class=\"o\">)</span> <span class=\"bp\">+</span> <span class=\"n\">b</span> <span class=\"bp\">*</span> <span class=\"o\">(</span><span class=\"mi\">9</span> <span class=\"bp\">^</span> <span class=\"o\">((</span><span class=\"mi\">1</span> <span class=\"o\">:</span> <span class=\"n\">ℝ</span><span class=\"o\">)</span> <span class=\"bp\">/</span> <span class=\"mi\">4</span><span class=\"o\">))</span> <span class=\"bp\">∈</span> <span class=\"n\">s</span> <span class=\"o\">:=</span>\n<span class=\"kd\">begin</span>\n  <span class=\"n\">set</span> <span class=\"n\">s</span> <span class=\"o\">:</span> <span class=\"n\">set</span> <span class=\"n\">ℝ</span> <span class=\"o\">:=</span> <span class=\"n\">set.insert</span> <span class=\"o\">(</span><span class=\"mi\">9</span> <span class=\"bp\">^</span> <span class=\"o\">((</span><span class=\"mi\">1</span> <span class=\"o\">:</span> <span class=\"n\">ℝ</span><span class=\"o\">)</span> <span class=\"bp\">/</span> <span class=\"mi\">4</span><span class=\"o\">))</span> <span class=\"o\">(</span><span class=\"n\">set.range</span> <span class=\"o\">(</span><span class=\"n\">coe</span> <span class=\"o\">:</span> <span class=\"n\">ℤ</span> <span class=\"bp\">→</span> <span class=\"n\">ℝ</span><span class=\"o\">))</span> <span class=\"k\">with</span> <span class=\"n\">hs</span><span class=\"o\">,</span>\n  <span class=\"n\">refine</span> <span class=\"o\">⟨</span><span class=\"n\">subring.mk'</span> <span class=\"n\">_</span> <span class=\"n\">_</span> <span class=\"n\">_</span> <span class=\"n\">_</span> <span class=\"n\">_</span><span class=\"o\">,</span> <span class=\"n\">_</span><span class=\"o\">,</span> <span class=\"n\">_</span><span class=\"o\">⟩,</span>\n  <span class=\"o\">{</span> <span class=\"n\">exact</span> <span class=\"n\">s</span> <span class=\"o\">},</span>\n  <span class=\"o\">{</span> <span class=\"n\">refine</span> <span class=\"o\">{</span><span class=\"n\">carrier</span> <span class=\"o\">:=</span> <span class=\"n\">s</span><span class=\"o\">,</span> <span class=\"n\">one_mem'</span> <span class=\"o\">:=</span> <span class=\"n\">_</span><span class=\"o\">,</span> <span class=\"n\">mul_mem'</span> <span class=\"o\">:=</span> <span class=\"n\">_</span><span class=\"o\">},</span>\n    <span class=\"o\">{</span> <span class=\"n\">rw</span> <span class=\"o\">[</span><span class=\"n\">hs</span><span class=\"o\">],</span>\n      <span class=\"n\">erw</span> <span class=\"n\">set.mem_insert_iff</span><span class=\"o\">,</span>\n    <span class=\"o\">},</span>\n  <span class=\"o\">},</span>\n  <span class=\"gr\">sorry</span>\n<span class=\"kd\">end</span>\n</code></pre></div>",
        "id": 221731257,
        "sender_full_name": "Alex J. Best",
        "timestamp": 1609905253
    },
    {
        "content": "<p>In this case it does what you want, <a href=\"https://leanprover-community.github.io/mathlib_docs/tactics.html#erewrite%20/%20erw\">https://leanprover-community.github.io/mathlib_docs/tactics.html#erewrite%20/%20erw</a></p>",
        "id": 221731270,
        "sender_full_name": "Alex J. Best",
        "timestamp": 1609905274
    },
    {
        "content": "<p>The root cause of the issue however is that you used <code>set.insert</code> to define <code>s</code> instead of <code>insert</code>, quite confusing indeed.</p>",
        "id": 221731507,
        "sender_full_name": "Alex J. Best",
        "timestamp": 1609905619
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kn\">import</span> <span class=\"n\">data.real.basic</span>\n<span class=\"kn\">import</span> <span class=\"n\">analysis.special_functions.pow</span>\n\n<span class=\"c1\">--set_option pp.all true</span>\n\n<span class=\"kd\">theorem</span> <span class=\"n\">ex6e</span> <span class=\"o\">:</span> <span class=\"bp\">∃</span> <span class=\"o\">(</span><span class=\"n\">s</span> <span class=\"o\">:</span> <span class=\"n\">subring</span> <span class=\"n\">ℝ</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">hs</span> <span class=\"o\">:</span> <span class=\"n\">s</span> <span class=\"bp\">≠</span> <span class=\"bp\">⊤</span><span class=\"o\">),</span>\n  <span class=\"bp\">∀</span> <span class=\"o\">(</span><span class=\"n\">a</span> <span class=\"n\">b</span> <span class=\"o\">:</span> <span class=\"n\">ℤ</span><span class=\"o\">),</span> <span class=\"o\">(</span><span class=\"n\">a</span> <span class=\"o\">:</span> <span class=\"n\">ℝ</span><span class=\"o\">)</span> <span class=\"bp\">+</span> <span class=\"n\">b</span> <span class=\"bp\">*</span> <span class=\"o\">(</span><span class=\"mi\">9</span> <span class=\"bp\">^</span> <span class=\"o\">((</span><span class=\"mi\">1</span> <span class=\"o\">:</span> <span class=\"n\">ℝ</span><span class=\"o\">)</span> <span class=\"bp\">/</span> <span class=\"mi\">4</span><span class=\"o\">))</span> <span class=\"bp\">∈</span> <span class=\"n\">s</span> <span class=\"o\">:=</span>\n<span class=\"kd\">begin</span>\n  <span class=\"n\">set</span> <span class=\"n\">s</span> <span class=\"o\">:</span> <span class=\"n\">set</span> <span class=\"n\">ℝ</span> <span class=\"o\">:=</span> <span class=\"n\">insert</span> <span class=\"o\">(</span><span class=\"mi\">9</span> <span class=\"bp\">^</span> <span class=\"o\">((</span><span class=\"mi\">1</span> <span class=\"o\">:</span> <span class=\"n\">ℝ</span><span class=\"o\">)</span> <span class=\"bp\">/</span> <span class=\"mi\">4</span><span class=\"o\">))</span> <span class=\"o\">(</span><span class=\"n\">set.range</span> <span class=\"o\">(</span><span class=\"n\">coe</span> <span class=\"o\">:</span> <span class=\"n\">ℤ</span> <span class=\"bp\">→</span> <span class=\"n\">ℝ</span><span class=\"o\">))</span> <span class=\"k\">with</span> <span class=\"n\">hs</span><span class=\"o\">,</span> <span class=\"c1\">-- CHANGED set.insert to insert here</span>\n  <span class=\"n\">refine</span> <span class=\"o\">⟨</span><span class=\"n\">subring.mk'</span> <span class=\"n\">_</span> <span class=\"n\">_</span> <span class=\"n\">_</span> <span class=\"n\">_</span> <span class=\"n\">_</span><span class=\"o\">,</span> <span class=\"n\">_</span><span class=\"o\">,</span> <span class=\"n\">_</span><span class=\"o\">⟩,</span>\n  <span class=\"o\">{</span> <span class=\"n\">exact</span> <span class=\"n\">s</span> <span class=\"o\">},</span>\n  <span class=\"o\">{</span> <span class=\"n\">refine</span> <span class=\"o\">{</span><span class=\"n\">carrier</span> <span class=\"o\">:=</span> <span class=\"n\">s</span><span class=\"o\">,</span> <span class=\"n\">one_mem'</span> <span class=\"o\">:=</span> <span class=\"n\">_</span><span class=\"o\">,</span> <span class=\"n\">mul_mem'</span> <span class=\"o\">:=</span> <span class=\"n\">_</span><span class=\"o\">},</span>\n    <span class=\"o\">{</span> <span class=\"n\">rw</span> <span class=\"o\">[</span><span class=\"n\">hs</span><span class=\"o\">],</span>\n      <span class=\"n\">rw</span> <span class=\"n\">set.mem_insert_iff</span><span class=\"o\">,</span>\n    <span class=\"o\">},</span>\n  <span class=\"o\">},</span>\n  <span class=\"gr\">sorry</span>\n<span class=\"kd\">end</span>\n</code></pre></div>\n<p>also works then</p>",
        "id": 221731520,
        "sender_full_name": "Alex J. Best",
        "timestamp": 1609905648
    },
    {
        "content": "<p>To see this look at the last line of the error message you get from trying <code>rw set.mem_insert_iff</code></p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"n\">rewrite</span> <span class=\"n\">tactic</span> <span class=\"n\">failed</span><span class=\"o\">,</span> <span class=\"n\">did</span> <span class=\"n\">not</span> <span class=\"n\">find</span> <span class=\"kd\">instance</span> <span class=\"n\">of</span> <span class=\"n\">the</span> <span class=\"n\">pattern</span> <span class=\"k\">in</span> <span class=\"n\">the</span> <span class=\"n\">target</span> <span class=\"n\">expression</span>\n  <span class=\"bp\">@</span><span class=\"n\">has_mem.mem.</span><span class=\"o\">{</span><span class=\"bp\">?</span><span class=\"n\">l_1</span> <span class=\"bp\">?</span><span class=\"n\">l_1</span><span class=\"o\">}</span> <span class=\"bp\">?</span><span class=\"n\">m_2</span> <span class=\"o\">(</span><span class=\"n\">set.</span><span class=\"o\">{</span><span class=\"bp\">?</span><span class=\"n\">l_1</span><span class=\"o\">}</span> <span class=\"bp\">?</span><span class=\"n\">m_2</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"bp\">@</span><span class=\"n\">set.has_mem.</span><span class=\"o\">{</span><span class=\"bp\">?</span><span class=\"n\">l_1</span><span class=\"o\">}</span> <span class=\"bp\">?</span><span class=\"n\">m_2</span><span class=\"o\">)</span> <span class=\"bp\">?</span><span class=\"n\">m_3</span>\n    <span class=\"o\">(</span><span class=\"bp\">@</span><span class=\"n\">has_insert.insert.</span><span class=\"o\">{</span><span class=\"bp\">?</span><span class=\"n\">l_1</span> <span class=\"bp\">?</span><span class=\"n\">l_1</span><span class=\"o\">}</span> <span class=\"bp\">?</span><span class=\"n\">m_2</span> <span class=\"o\">(</span><span class=\"n\">set.</span><span class=\"o\">{</span><span class=\"bp\">?</span><span class=\"n\">l_1</span><span class=\"o\">}</span> <span class=\"bp\">?</span><span class=\"n\">m_2</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"bp\">@</span><span class=\"n\">set.has_insert.</span><span class=\"o\">{</span><span class=\"bp\">?</span><span class=\"n\">l_1</span><span class=\"o\">}</span> <span class=\"bp\">?</span><span class=\"n\">m_2</span><span class=\"o\">)</span> <span class=\"bp\">?</span><span class=\"n\">m_4</span> <span class=\"bp\">?</span><span class=\"n\">m_5</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>its about <code>has_insert.insert</code>, but the goal is</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code> <span class=\"bp\">@</span><span class=\"n\">has_mem.mem.</span><span class=\"o\">{</span><span class=\"mi\">0</span> <span class=\"mi\">0</span><span class=\"o\">}</span> <span class=\"n\">real</span> <span class=\"o\">(</span><span class=\"n\">set.</span><span class=\"o\">{</span><span class=\"mi\">0</span><span class=\"o\">}</span> <span class=\"n\">real</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"bp\">@</span><span class=\"n\">set.has_mem.</span><span class=\"o\">{</span><span class=\"mi\">0</span><span class=\"o\">}</span> <span class=\"n\">real</span><span class=\"o\">)</span>\n    <span class=\"o\">(</span><span class=\"bp\">@</span><span class=\"n\">has_one.one.</span><span class=\"o\">{</span><span class=\"mi\">0</span><span class=\"o\">}</span> <span class=\"n\">real</span> <span class=\"o\">(</span><span class=\"bp\">@</span><span class=\"n\">monoid.to_has_one.</span><span class=\"o\">{</span><span class=\"mi\">0</span><span class=\"o\">}</span> <span class=\"n\">real</span> <span class=\"o\">(</span><span class=\"bp\">@</span><span class=\"n\">ring.to_monoid.</span><span class=\"o\">{</span><span class=\"mi\">0</span><span class=\"o\">}</span> <span class=\"n\">real</span> <span class=\"n\">real.ring</span><span class=\"o\">)))</span>\n    <span class=\"o\">(</span><span class=\"bp\">@</span><span class=\"n\">set.insert.</span><span class=\"o\">{</span><span class=\"mi\">0</span><span class=\"o\">}</span> <span class=\"n\">real</span> <span class=\"bp\">......</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>which refers to <code>set.insert</code> instead.</p>",
        "id": 221731602,
        "sender_full_name": "Alex J. Best",
        "timestamp": 1609905750
    },
    {
        "content": "<p>These things are equal under the hood which is why <code>erw</code> works, but syntactically they don't look the same so <code>rw</code> fails.</p>",
        "id": 221731632,
        "sender_full_name": "Alex J. Best",
        "timestamp": 1609905798
    },
    {
        "content": "<p>If you look at <a href=\"https://leanprover-community.github.io/mathlib_docs/find/set.insert/src\">src#set.insert</a> you'll see it is a <code>protected def</code> which is maybe a bit of a hint you aren't meant to be calling it directly</p>",
        "id": 221731725,
        "sender_full_name": "Alex J. Best",
        "timestamp": 1609905906
    },
    {
        "content": "<p>Thanks for the lift.  I guess as long as we know that <code>a</code> and <code>b</code> are integers in <code>∀ (a b : ℤ)</code> it is fine for <code>a</code> to be lifted to ℝ inside the ∀.  I would have thought that it was <code>b</code> that needed to be lifted since that is what is multiplied by the power.</p>\n<p>I don't understand why technically you need to say <code>s ≠ ⊤</code>.  What is  <code>⊤</code>, all of the reals?  Because all of the reals will not be expressible as a + b * 9^(1/4) for  <code>a b : ℤ</code>, so I don't know why the exclusion is necessary.</p>",
        "id": 221734319,
        "sender_full_name": "Lars Ericson",
        "timestamp": 1609909397
    },
    {
        "content": "<p>I think the formalization might be something like:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kd\">theorem</span> <span class=\"n\">ex6e</span> <span class=\"o\">:</span> <span class=\"bp\">∃</span> <span class=\"o\">(</span><span class=\"n\">s</span> <span class=\"o\">:</span> <span class=\"n\">subring</span> <span class=\"n\">ℝ</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">hs</span> <span class=\"o\">:</span> <span class=\"n\">s</span> <span class=\"bp\">≠</span> <span class=\"bp\">⊤</span><span class=\"o\">),</span>\n  <span class=\"bp\">∀</span> <span class=\"o\">(</span><span class=\"n\">a</span> <span class=\"n\">b</span> <span class=\"o\">:</span> <span class=\"n\">ℤ</span><span class=\"o\">),</span> <span class=\"o\">(</span><span class=\"n\">a</span> <span class=\"o\">:</span> <span class=\"n\">ℝ</span><span class=\"o\">)</span> <span class=\"bp\">+</span> <span class=\"n\">b</span> <span class=\"bp\">*</span> <span class=\"o\">(</span><span class=\"mi\">9</span> <span class=\"bp\">^</span> <span class=\"o\">((</span><span class=\"mi\">1</span> <span class=\"o\">:</span> <span class=\"n\">ℝ</span><span class=\"o\">)</span> <span class=\"bp\">/</span> <span class=\"mi\">4</span><span class=\"o\">))</span> <span class=\"bp\">∈</span> <span class=\"n\">s</span> <span class=\"o\">:=</span>\n<span class=\"kd\">begin</span>\n  <span class=\"n\">refine</span> <span class=\"o\">⟨</span><span class=\"n\">subring.closure</span> <span class=\"o\">{</span> <span class=\"mi\">9</span> <span class=\"bp\">^</span> <span class=\"o\">((</span><span class=\"mi\">1</span> <span class=\"o\">:</span> <span class=\"n\">ℝ</span><span class=\"o\">)</span> <span class=\"bp\">/</span> <span class=\"mi\">4</span><span class=\"o\">),</span> <span class=\"o\">(</span><span class=\"mi\">1</span> <span class=\"o\">:</span> <span class=\"n\">ℤ</span><span class=\"o\">)</span> <span class=\"o\">},</span> <span class=\"n\">_</span><span class=\"o\">,</span> <span class=\"n\">_</span><span class=\"o\">⟩,</span>\n  <span class=\"o\">{</span> <span class=\"gr\">sorry</span> <span class=\"o\">},</span>\n  <span class=\"o\">{</span> <span class=\"gr\">sorry</span> <span class=\"o\">},</span>\n<span class=\"kd\">end</span>\n</code></pre></div>",
        "id": 221734487,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1609909564
    },
    {
        "content": "<p>but I think there might be some lemmas missing about <code>subring.closure</code> to show this</p>",
        "id": 221734493,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1609909576
    },
    {
        "content": "<p>The <code>hs : s ≠ ⊤</code> is necessary because like Eric said above, the full <code>ℝ</code> does have the property that <code>(a : ℝ) + b * (9 ^ ((1 : ℝ) / 4)) ∈</code> \"all of the reals\".</p>",
        "id": 221734540,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1609909666
    },
    {
        "content": "<p>And I think the exercise is to show that a strict subset of the reals is still an integral domain, or in the language here, a subring.</p>",
        "id": 221734596,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1609909714
    },
    {
        "content": "<p>But 'a : ℤ', which should be enough information to exclude 's ≠ ⊤'.  We know that under 'a : ℤ', the expression '(a : ℝ) + b * (9 ^ ((1 : ℝ) / 4))' is equivalent to '(a : ℤ) + b * (9 ^ ((1 : ℝ) / 4))'.  The only thing stopping us from saying the latter is some technicality in Lean about no <code>has_pow</code> for <br>\nℤ and ℝ together.  Once you have '(a : ℤ) + b * (9 ^ ((1 : ℝ) / 4))', <code>⊤</code> is not a contender.  So it shouldn't be necessary to put it in the theorem statement, because the <code>a : ℤ</code> in the quantifier is enough information already to exclude top.</p>",
        "id": 221735042,
        "sender_full_name": "Lars Ericson",
        "timestamp": 1609910333
    },
    {
        "content": "<p>When I wrote <code> ∀ (a b : ℤ), (a : ℝ)...</code> that just indicates that I require <code>a</code> and <code>b</code> to be integers. They're then cast to reals.</p>",
        "id": 221735351,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1609910805
    },
    {
        "content": "<p>I've moved it along a little.  I should be able to apply <code>subring.mul_mem</code> but it is not matching although it looks exactly like it should:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kn\">import</span> <span class=\"n\">data.real.basic</span>\n<span class=\"kn\">import</span> <span class=\"n\">analysis.special_functions.pow</span>\n\n<span class=\"kd\">lemma</span> <span class=\"n\">one_in_Z</span> <span class=\"o\">:</span> <span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">)</span> <span class=\"bp\">∈</span> <span class=\"n\">set.range</span> <span class=\"o\">(</span><span class=\"n\">coe</span> <span class=\"o\">:</span> <span class=\"n\">ℤ</span> <span class=\"bp\">→</span> <span class=\"n\">ℝ</span><span class=\"o\">)</span> <span class=\"o\">:=</span>\n<span class=\"kd\">begin</span>\n  <span class=\"gr\">sorry</span><span class=\"o\">,</span>\n<span class=\"kd\">end</span>\n\n<span class=\"kd\">theorem</span> <span class=\"n\">ex6e</span> <span class=\"o\">:</span> <span class=\"bp\">∃</span> <span class=\"o\">(</span><span class=\"n\">s</span> <span class=\"o\">:</span> <span class=\"n\">subring</span> <span class=\"n\">ℝ</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">hs</span> <span class=\"o\">:</span> <span class=\"n\">s</span> <span class=\"bp\">≠</span> <span class=\"bp\">⊤</span><span class=\"o\">),</span>\n  <span class=\"bp\">∀</span> <span class=\"o\">(</span><span class=\"n\">a</span> <span class=\"n\">b</span> <span class=\"o\">:</span> <span class=\"n\">ℤ</span><span class=\"o\">),</span> <span class=\"o\">(</span><span class=\"n\">a</span> <span class=\"o\">:</span> <span class=\"n\">ℝ</span><span class=\"o\">)</span> <span class=\"bp\">+</span> <span class=\"n\">b</span> <span class=\"bp\">*</span> <span class=\"o\">(</span><span class=\"mi\">9</span> <span class=\"bp\">^</span> <span class=\"o\">((</span><span class=\"mi\">1</span> <span class=\"o\">:</span> <span class=\"n\">ℝ</span><span class=\"o\">)</span> <span class=\"bp\">/</span> <span class=\"mi\">4</span><span class=\"o\">))</span> <span class=\"bp\">∈</span> <span class=\"n\">s</span> <span class=\"o\">:=</span>\n<span class=\"kd\">begin</span>\n  <span class=\"n\">set</span> <span class=\"n\">s</span> <span class=\"o\">:</span> <span class=\"n\">set</span> <span class=\"n\">ℝ</span> <span class=\"o\">:=</span> <span class=\"n\">insert</span> <span class=\"o\">(</span><span class=\"mi\">9</span> <span class=\"bp\">^</span> <span class=\"o\">((</span><span class=\"mi\">1</span> <span class=\"o\">:</span> <span class=\"n\">ℝ</span><span class=\"o\">)</span> <span class=\"bp\">/</span> <span class=\"mi\">4</span><span class=\"o\">))</span> <span class=\"o\">(</span><span class=\"n\">set.range</span> <span class=\"o\">(</span><span class=\"n\">coe</span> <span class=\"o\">:</span> <span class=\"n\">ℤ</span> <span class=\"bp\">→</span> <span class=\"n\">ℝ</span><span class=\"o\">))</span> <span class=\"k\">with</span> <span class=\"n\">hs</span><span class=\"o\">,</span> <span class=\"c1\">-- CHANGED set.insert to insert here</span>\n  <span class=\"n\">refine</span> <span class=\"o\">⟨</span><span class=\"n\">subring.mk'</span> <span class=\"n\">_</span> <span class=\"n\">_</span> <span class=\"n\">_</span> <span class=\"n\">_</span> <span class=\"n\">_</span><span class=\"o\">,</span> <span class=\"n\">_</span><span class=\"o\">,</span> <span class=\"n\">_</span><span class=\"o\">⟩,</span>\n  <span class=\"o\">{</span> <span class=\"n\">exact</span> <span class=\"n\">s</span> <span class=\"o\">},</span>\n  <span class=\"o\">{</span> <span class=\"n\">refine</span> <span class=\"o\">{</span><span class=\"n\">carrier</span> <span class=\"o\">:=</span> <span class=\"n\">s</span><span class=\"o\">,</span> <span class=\"n\">one_mem'</span> <span class=\"o\">:=</span> <span class=\"n\">_</span><span class=\"o\">,</span> <span class=\"n\">mul_mem'</span> <span class=\"o\">:=</span> <span class=\"n\">_</span><span class=\"o\">},</span>\n    <span class=\"o\">{</span> <span class=\"n\">rw</span> <span class=\"o\">[</span><span class=\"n\">hs</span><span class=\"o\">],</span>\n      <span class=\"n\">rw</span> <span class=\"n\">set.mem_insert_iff</span><span class=\"o\">,</span>\n      <span class=\"n\">right</span><span class=\"o\">,</span>\n      <span class=\"n\">exact</span> <span class=\"n\">one_in_Z</span><span class=\"o\">,</span>\n    <span class=\"o\">},</span>\n    <span class=\"n\">intros</span> <span class=\"n\">a</span> <span class=\"n\">b</span><span class=\"o\">,</span>\n    <span class=\"n\">intro</span> <span class=\"n\">h1</span><span class=\"o\">,</span>\n    <span class=\"n\">intro</span> <span class=\"n\">h2</span><span class=\"o\">,</span>\n    <span class=\"k\">have</span> <span class=\"n\">h3</span> <span class=\"o\">:=</span> <span class=\"n\">subring.mul_mem</span> <span class=\"n\">h1</span> <span class=\"n\">h2</span><span class=\"o\">,</span>\n  <span class=\"o\">},</span>\n  <span class=\"gr\">sorry</span><span class=\"o\">,</span>\n  <span class=\"gr\">sorry</span><span class=\"o\">,</span>\n  <span class=\"gr\">sorry</span><span class=\"o\">,</span>\n  <span class=\"gr\">sorry</span><span class=\"o\">,</span>\n  <span class=\"gr\">sorry</span><span class=\"o\">,</span>\n<span class=\"kd\">end</span>\n</code></pre></div>\n<p>where the goal state is</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"n\">Tactic</span> <span class=\"n\">state</span>\n<span class=\"n\">widget</span>\n<span class=\"n\">filter</span><span class=\"o\">:</span>\n<span class=\"n\">no</span> <span class=\"n\">filter</span>\n<span class=\"mi\">1</span> <span class=\"n\">goal</span>\n<span class=\"n\">s</span><span class=\"o\">:</span> <span class=\"n\">set</span> <span class=\"n\">ℝ</span> <span class=\"o\">:=</span> <span class=\"n\">insert</span> <span class=\"o\">(</span><span class=\"mi\">9</span> <span class=\"bp\">^</span> <span class=\"o\">(</span><span class=\"mi\">1</span> <span class=\"bp\">/</span> <span class=\"mi\">4</span><span class=\"o\">))</span> <span class=\"o\">(</span><span class=\"n\">set.range</span> <span class=\"n\">coe</span><span class=\"o\">)</span>\n<span class=\"n\">hs</span><span class=\"o\">:</span> <span class=\"n\">s</span> <span class=\"bp\">=</span> <span class=\"n\">insert</span> <span class=\"o\">(</span><span class=\"mi\">9</span> <span class=\"bp\">^</span> <span class=\"o\">(</span><span class=\"mi\">1</span> <span class=\"bp\">/</span> <span class=\"mi\">4</span><span class=\"o\">))</span> <span class=\"o\">(</span><span class=\"n\">set.range</span> <span class=\"n\">coe</span><span class=\"o\">)</span>\n<span class=\"n\">ab</span><span class=\"o\">:</span> <span class=\"n\">ℝ</span>\n<span class=\"n\">h1</span><span class=\"o\">:</span> <span class=\"n\">a</span> <span class=\"bp\">∈</span> <span class=\"n\">s</span>\n<span class=\"n\">h2</span><span class=\"o\">:</span> <span class=\"n\">b</span> <span class=\"bp\">∈</span> <span class=\"n\">s</span>\n<span class=\"bp\">⊢</span> <span class=\"n\">a</span> <span class=\"bp\">*</span> <span class=\"n\">b</span> <span class=\"bp\">∈</span> <span class=\"n\">s</span>\n</code></pre></div>\n<p>and the error is</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"n\">type</span> <span class=\"n\">mismatch</span> <span class=\"n\">at</span> <span class=\"n\">application</span>\n  <span class=\"n\">subring.mul_mem</span> <span class=\"n\">h1</span>\n<span class=\"n\">term</span>\n  <span class=\"n\">h1</span>\n<span class=\"n\">has</span> <span class=\"n\">type</span>\n  <span class=\"n\">a</span> <span class=\"bp\">∈</span> <span class=\"n\">s</span> <span class=\"o\">:</span> <span class=\"kt\">Prop</span>\n<span class=\"n\">but</span> <span class=\"n\">is</span> <span class=\"n\">expected</span> <span class=\"n\">to</span> <span class=\"k\">have</span> <span class=\"n\">type</span>\n  <span class=\"n\">subring</span> <span class=\"bp\">?</span><span class=\"n\">m_1</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span> <span class=\"bp\">?</span>\n<span class=\"n\">state</span><span class=\"o\">:</span>\n<span class=\"n\">s</span> <span class=\"o\">:</span> <span class=\"n\">set</span> <span class=\"n\">ℝ</span> <span class=\"o\">:=</span> <span class=\"n\">insert</span> <span class=\"o\">(</span><span class=\"mi\">9</span> <span class=\"bp\">^</span> <span class=\"o\">(</span><span class=\"mi\">1</span> <span class=\"bp\">/</span> <span class=\"mi\">4</span><span class=\"o\">))</span> <span class=\"o\">(</span><span class=\"n\">set.range</span> <span class=\"n\">coe</span><span class=\"o\">),</span>\n<span class=\"n\">hs</span> <span class=\"o\">:</span> <span class=\"n\">s</span> <span class=\"bp\">=</span> <span class=\"n\">insert</span> <span class=\"o\">(</span><span class=\"mi\">9</span> <span class=\"bp\">^</span> <span class=\"o\">(</span><span class=\"mi\">1</span> <span class=\"bp\">/</span> <span class=\"mi\">4</span><span class=\"o\">))</span> <span class=\"o\">(</span><span class=\"n\">set.range</span> <span class=\"n\">coe</span><span class=\"o\">),</span>\n<span class=\"n\">a</span> <span class=\"n\">b</span> <span class=\"o\">:</span> <span class=\"n\">ℝ</span><span class=\"o\">,</span>\n<span class=\"n\">h1</span> <span class=\"o\">:</span> <span class=\"n\">a</span> <span class=\"bp\">∈</span> <span class=\"n\">s</span><span class=\"o\">,</span>\n<span class=\"n\">h2</span> <span class=\"o\">:</span> <span class=\"n\">b</span> <span class=\"bp\">∈</span> <span class=\"n\">s</span>\n<span class=\"bp\">⊢</span> <span class=\"n\">a</span> <span class=\"bp\">*</span> <span class=\"n\">b</span> <span class=\"bp\">∈</span> <span class=\"n\">s</span>\n</code></pre></div>",
        "id": 221735368,
        "sender_full_name": "Lars Ericson",
        "timestamp": 1609910846
    },
    {
        "content": "<p>For sure, for any <code>(a b : ℤ)</code>, <code>a + b * (9 ^ 1 / 4)  ∈ ℝ</code> (to use set theory notation.</p>",
        "id": 221735380,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1609910878
    },
    {
        "content": "<p>I don't think my original approach works because just inserting this 9^x value isn't enough to make that set closed. You won't be able to prove <code>mul_mem'</code>.</p>",
        "id": 221735445,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1609910959
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"308899\">@Yakov Pechersky</span> they are cast to reals for a technical reason, but the information in the environment, provided by the quantifier, should still include the fact that <code>a</code> and <code>b</code> are integers.  You can't, to my mind, prove the subring without using that information.   Completely forgetting that <code>a</code> is an integer forces you to say <code>s ≠ ⊤</code> but that is not an insightful statement.  All that is saying is \"I forget that I just said that <code>a</code> is an integer\".  There should be a way of retaining that type information about <code>a</code> in the tactic state and then doing the coercion to make <code>has_pow</code> happy.  It is  not insightful to lose information and than replace it with another tangentially equivalent restriction.</p>",
        "id": 221735510,
        "sender_full_name": "Lars Ericson",
        "timestamp": 1609911035
    },
    {
        "content": "<p>The error message is telling you what isn't matching</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"n\">type</span> <span class=\"n\">mismatch</span> <span class=\"n\">at</span> <span class=\"n\">application</span>\n  <span class=\"n\">subring.mul_mem</span> <span class=\"n\">h1</span>\n<span class=\"n\">term</span>\n  <span class=\"n\">h1</span>\n<span class=\"n\">has</span> <span class=\"n\">type</span>\n  <span class=\"n\">a</span> <span class=\"bp\">∈</span> <span class=\"n\">s</span> <span class=\"o\">:</span> <span class=\"kt\">Prop</span>\n<span class=\"n\">but</span> <span class=\"n\">is</span> <span class=\"n\">expected</span> <span class=\"n\">to</span> <span class=\"k\">have</span> <span class=\"n\">type</span>\n  <span class=\"n\">subring</span> <span class=\"bp\">?</span><span class=\"n\">m_1</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span> <span class=\"bp\">?</span>\n</code></pre></div>\n<p>the complaint is exactly that the first argument of <a href=\"https://leanprover-community.github.io/mathlib_docs/find/subring.mul_mem\">docs#subring.mul_mem</a> should be a <code>subring R</code> of some ring <code>R</code>, then the second and third arguments are two proofs of membership of that subring</p>",
        "id": 221735514,
        "sender_full_name": "Alex J. Best",
        "timestamp": 1609911042
    },
    {
        "content": "<p>Yes subring of R is what we are trying to prove, it is not an assumption.</p>",
        "id": 221735526,
        "sender_full_name": "Lars Ericson",
        "timestamp": 1609911105
    },
    {
        "content": "<p>It does remember! It'll show <code>↑1</code> for my <code>(1 : ℤ)</code> which is in an expression that expects an ℝ.</p>",
        "id": 221735571,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1609911152
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"364351\">Lars Ericson</span> <a href=\"#narrow/stream/113489-new-members/topic/How.20to.20multiply.20an.20integer.20times.20a.20real/near/221735526\">said</a>:</p>\n<blockquote>\n<p>Yes subring of R is what we are trying to prove, it is not an assumption.</p>\n</blockquote>\n<p>Right so you can't apply that lemma!</p>",
        "id": 221735647,
        "sender_full_name": "Alex J. Best",
        "timestamp": 1609911246
    },
    {
        "content": "<p>I think of <code>a + b X </code>where<code> X = 9^(1/4)</code> as a pair or a vector <code>&lt;a,b&gt;</code> where X is a kind of basis vector.  The insight is that it is a ring of 2-element vectors with a slightly funny multiplication operation.  The proof has to start with definition of addition and multiplication on such pairs and that such pairs multiplied or added are also pairs.  The <code>has_pow</code> takes away from that insight, it is a kind of detour.</p>",
        "id": 221735670,
        "sender_full_name": "Lars Ericson",
        "timestamp": 1609911343
    },
    {
        "content": "<p>In other words we are spending a lot of time on coercions and <code>has_pow</code>s and so on because we are losing sight of the idea that we have encoded integer pairs with a trick involving a single irrational real.</p>",
        "id": 221735736,
        "sender_full_name": "Lars Ericson",
        "timestamp": 1609911428
    },
    {
        "content": "<p>So <code>0 = &lt;0, 0&gt;</code>,  <code>1 = &lt;1,0&gt;</code>, otherwise you have <code>&lt;a,b&gt;</code> where <code>a,b</code> are integers, and <code>&lt;a,b&gt;+&lt;c,d&gt; = &lt;a+c,b+d&gt;</code> and <code>&lt;a,b&gt;*&lt;c,d&gt; = &lt;a*c+*d*3, a*d+b*c&gt;</code>.  It's really proving that pairs with that definition of + and * form a ring.  The pairs are isomorphic to <code>a + b *9^(1/4)</code>.  It seems like it would be easier to prove</p>\n<ul>\n<li>The isomorphism of pairs to that expression</li>\n<li>That the pairs under that * and + are a ring</li>\n</ul>\n<p>than to get lost in coercions between integers and reals and complicated libraries of definitions on <code>pow</code>.</p>",
        "id": 221735878,
        "sender_full_name": "Lars Ericson",
        "timestamp": 1609911650
    },
    {
        "content": "<p>This is what I mean currently:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kn\">import</span> <span class=\"n\">data.real.basic</span>\n<span class=\"kn\">import</span> <span class=\"n\">analysis.special_functions.pow</span>\n\n<span class=\"kd\">theorem</span> <span class=\"n\">ex6e</span> <span class=\"o\">:</span> <span class=\"bp\">∃</span> <span class=\"o\">(</span><span class=\"n\">s</span> <span class=\"o\">:</span> <span class=\"n\">subring</span> <span class=\"n\">ℝ</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">hs</span> <span class=\"o\">:</span> <span class=\"n\">s</span> <span class=\"bp\">≠</span> <span class=\"bp\">⊤</span><span class=\"o\">),</span>\n  <span class=\"bp\">∀</span> <span class=\"o\">(</span><span class=\"n\">a</span> <span class=\"n\">b</span> <span class=\"o\">:</span> <span class=\"n\">ℤ</span><span class=\"o\">),</span> <span class=\"o\">(</span><span class=\"n\">a</span> <span class=\"o\">:</span> <span class=\"n\">ℝ</span><span class=\"o\">)</span> <span class=\"bp\">+</span> <span class=\"n\">b</span> <span class=\"bp\">*</span> <span class=\"o\">(</span><span class=\"mi\">9</span> <span class=\"bp\">^</span> <span class=\"o\">((</span><span class=\"mi\">1</span> <span class=\"o\">:</span> <span class=\"n\">ℝ</span><span class=\"o\">)</span> <span class=\"bp\">/</span> <span class=\"mi\">4</span><span class=\"o\">))</span> <span class=\"bp\">∈</span> <span class=\"n\">s</span> <span class=\"o\">:=</span>\n<span class=\"kd\">begin</span>\n  <span class=\"n\">use</span> <span class=\"bp\">⊤</span><span class=\"o\">,</span> <span class=\"c1\">-- use the whole ring of reals, the top of the subring lattice</span>\n  <span class=\"n\">split</span><span class=\"o\">,</span>\n  <span class=\"o\">{</span> <span class=\"gr\">sorry</span> <span class=\"o\">},</span> <span class=\"c1\">-- here I am ignoring the fact I have to prove the hs hypothesis</span>\n  <span class=\"n\">simp</span>\n<span class=\"kd\">end</span>\n</code></pre></div>",
        "id": 221736083,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1609911976
    },
    {
        "content": "<p>It's what Eric remarked on earlier.</p>",
        "id": 221736084,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1609911982
    },
    {
        "content": "<p>Here's how I'd structure this exercise (and some of the proofs) if asked to formalise it:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kn\">import</span> <span class=\"n\">data.real.basic</span>\n<span class=\"kn\">import</span> <span class=\"n\">analysis.special_functions.pow</span>\n\n<span class=\"kd\">lemma</span> <span class=\"n\">important</span> <span class=\"o\">:</span> <span class=\"o\">(</span><span class=\"mi\">9</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">)</span> <span class=\"bp\">^</span> <span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"bp\">/</span><span class=\"mi\">4</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">)</span> <span class=\"bp\">=</span> <span class=\"n\">real.sqrt</span> <span class=\"mi\">3</span> <span class=\"o\">:=</span> <span class=\"kd\">begin</span> <span class=\"gr\">sorry</span> <span class=\"kd\">end</span>\n<span class=\"kd\">theorem</span> <span class=\"n\">ex6e</span> <span class=\"o\">:</span> <span class=\"bp\">∃</span> <span class=\"n\">s</span> <span class=\"o\">:</span> <span class=\"n\">subring</span> <span class=\"n\">ℝ</span><span class=\"o\">,</span> <span class=\"o\">(</span><span class=\"bp\">∀</span> <span class=\"n\">x</span> <span class=\"o\">:</span> <span class=\"n\">ℝ</span><span class=\"o\">,</span> <span class=\"n\">x</span> <span class=\"bp\">∈</span> <span class=\"n\">s</span> <span class=\"bp\">↔</span> <span class=\"bp\">∃</span> <span class=\"n\">a</span> <span class=\"n\">b</span> <span class=\"o\">:</span> <span class=\"n\">ℤ</span><span class=\"o\">,</span> <span class=\"n\">x</span> <span class=\"bp\">=</span> <span class=\"n\">a</span> <span class=\"bp\">+</span> <span class=\"n\">b</span> <span class=\"bp\">*</span> <span class=\"o\">(</span><span class=\"mi\">9</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">)</span> <span class=\"bp\">^</span> <span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"bp\">/</span><span class=\"mi\">4</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">))</span> <span class=\"bp\">∧</span> <span class=\"n\">is_integral_domain</span> <span class=\"n\">s</span> <span class=\"o\">:=</span>\n<span class=\"kd\">begin</span>\n  <span class=\"n\">rw</span> <span class=\"n\">important</span><span class=\"o\">,</span> <span class=\"c1\">-- 9^1/4 is ugly, use sqrt 3 instead (likely more lemmas in library about sqrt so this will make our life easier)</span>\n  <span class=\"n\">refine</span> <span class=\"o\">⟨</span><span class=\"n\">subring.mk</span> <span class=\"n\">_</span> <span class=\"n\">_</span> <span class=\"n\">_</span> <span class=\"n\">_</span> <span class=\"n\">_</span> <span class=\"n\">_</span> <span class=\"o\">,</span> <span class=\"o\">⟨</span><span class=\"n\">_</span><span class=\"o\">,</span> <span class=\"n\">_</span><span class=\"o\">⟩⟩,</span> <span class=\"c1\">-- separate out all the goals</span>\n  <span class=\"n\">rotate</span> <span class=\"mi\">6</span><span class=\"o\">,</span> <span class=\"c1\">-- we want our subring to be defined to be the a + b * (9:ℝ) ^ (1/4:ℝ)  so switch to that goal first</span>\n  <span class=\"o\">{</span> <span class=\"n\">intro</span> <span class=\"n\">x</span><span class=\"o\">,</span>\n    <span class=\"n\">refl</span><span class=\"o\">,</span> <span class=\"o\">},</span> <span class=\"c1\">-- saying to lean this is true by definition forces the subring to have the elements we want, without having to do a set s := ..</span>\n  <span class=\"n\">rotate</span> <span class=\"mi\">1</span><span class=\"o\">,</span>\n  <span class=\"o\">{</span> <span class=\"n\">use</span> <span class=\"o\">[</span><span class=\"mi\">1</span><span class=\"o\">,</span><span class=\"mi\">0</span><span class=\"o\">],</span> <span class=\"n\">norm_num</span><span class=\"o\">,</span> <span class=\"o\">},</span> <span class=\"c1\">-- 1 and 0 are easy thanks to norm num</span>\n  <span class=\"o\">{</span> <span class=\"gr\">sorry</span><span class=\"o\">,</span> <span class=\"o\">},</span> <span class=\"c1\">-- this can hopefully done like the negation below, maybe using the ring, norm_num and linarith tactics.</span>\n  <span class=\"o\">{</span> <span class=\"n\">use</span> <span class=\"o\">[</span><span class=\"mi\">0</span><span class=\"o\">,</span><span class=\"mi\">0</span><span class=\"o\">],</span> <span class=\"n\">norm_num</span><span class=\"o\">,</span> <span class=\"o\">},</span>\n  <span class=\"o\">{</span> <span class=\"gr\">sorry</span> <span class=\"o\">},</span>\n  <span class=\"o\">{</span> <span class=\"n\">rintro</span> <span class=\"n\">x</span> <span class=\"o\">⟨</span><span class=\"n\">haa</span><span class=\"o\">,</span> <span class=\"n\">hab</span><span class=\"o\">,</span> <span class=\"n\">rfl</span><span class=\"o\">⟩,</span> <span class=\"n\">use</span> <span class=\"o\">[</span><span class=\"bp\">-</span><span class=\"n\">haa</span><span class=\"o\">,</span> <span class=\"bp\">-</span><span class=\"n\">hab</span><span class=\"o\">],</span> <span class=\"n\">rw</span> <span class=\"n\">neg_add</span><span class=\"o\">,</span> <span class=\"n\">simp</span><span class=\"o\">,</span> <span class=\"o\">},</span> <span class=\"c1\">-- this is doing the \"basis vector\" thing lars is referring to using rintro splits our subring element x into components haa hab the rfl part clears all mention of x now we have decomposed it into its components</span>\n  <span class=\"n\">split</span><span class=\"o\">,</span>\n  <span class=\"o\">{</span> <span class=\"n\">use</span> <span class=\"o\">[</span><span class=\"mi\">0</span><span class=\"o\">,</span> <span class=\"mi\">1</span><span class=\"o\">],</span> <span class=\"n\">simp</span><span class=\"o\">,</span> <span class=\"o\">},</span> <span class=\"c1\">-- maybe library_search does this too...</span>\n  <span class=\"o\">{</span> <span class=\"n\">exact</span> <span class=\"n\">mul_comm</span><span class=\"o\">,</span> <span class=\"o\">},</span> <span class=\"c1\">-- library_search</span>\n  <span class=\"o\">{</span> <span class=\"n\">intros</span> <span class=\"n\">x</span> <span class=\"n\">y</span><span class=\"o\">,</span> <span class=\"n\">exact</span> <span class=\"n\">mul_eq_zero.mp</span><span class=\"o\">,</span> <span class=\"o\">},</span> <span class=\"c1\">-- library_search</span>\n<span class=\"kd\">end</span>\n</code></pre></div>",
        "id": 221736542,
        "sender_full_name": "Alex J. Best",
        "timestamp": 1609912678
    },
    {
        "content": "<p>Now can you do it using <code>subring.closure { real.sqrt 3 }</code>?</p>",
        "id": 221743542,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1609921521
    },
    {
        "content": "<p>Do what, show that above criterion for membership, or show it is an integral domain?</p>",
        "id": 221743669,
        "sender_full_name": "Alex J. Best",
        "timestamp": 1609921626
    },
    {
        "content": "<p>Ideally, the lemmas about <code>subring.closure</code> should allow you to say:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"n\">refine</span> <span class=\"o\">⟨</span><span class=\"n\">subring.closure</span> <span class=\"o\">{</span> <span class=\"n\">real.sqrt</span> <span class=\"mi\">3</span> <span class=\"o\">}</span> <span class=\"o\">,</span> <span class=\"n\">_</span><span class=\"o\">,</span> <span class=\"n\">_</span><span class=\"o\">⟩,</span>\n</code></pre></div>\n<p>instead</p>",
        "id": 221743943,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1609921871
    },
    {
        "content": "<p>Oh for sure, if the goal is to formalise that same object in a easy to work with way I'd set everything up totally differently, I was just trying to match the exercise as closely as possible.</p>",
        "id": 221744210,
        "sender_full_name": "Alex J. Best",
        "timestamp": 1609922107
    },
    {
        "content": "<p>btw the last line can be expressed as:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code>  <span class=\"o\">{</span> <span class=\"n\">exact</span> <span class=\"bp\">@</span><span class=\"n\">integral_domain.to_is_integral_domain</span> <span class=\"n\">_</span> <span class=\"o\">(</span><span class=\"n\">subring.subring.domain</span> <span class=\"n\">_</span><span class=\"o\">)</span> <span class=\"o\">}</span>\n</code></pre></div>",
        "id": 221744710,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1609922609
    },
    {
        "content": "<p>because the parent ring on <code>ℝ</code> is also an integral domain</p>",
        "id": 221744735,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1609922638
    },
    {
        "content": "<p>But I guess proving that is part of the exercise</p>",
        "id": 221744789,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1609922664
    },
    {
        "content": "<p>Yeah my solution is probably cheating via the typeclass mechanism really, at least in a pen and paper proof you would mention subrings of domains being domains explicitly.</p>",
        "id": 221745324,
        "sender_full_name": "Alex J. Best",
        "timestamp": 1609923178
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"127136\">@Alex J. Best</span>' statement is the only correct one so far</p>",
        "id": 221746762,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1609924369
    },
    {
        "content": "<p>The <code>iff</code> is crucial, otherwise it allows larger subrings than the question permits</p>",
        "id": 221746804,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1609924408
    },
    {
        "content": "<p>By the way this ring already exists in mathlib, it's called <code>zsqrtd 3</code></p>",
        "id": 221748549,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1609925975
    },
    {
        "content": "<p>Presumably there's some way to interpret <a href=\"https://leanprover-community.github.io/mathlib_docs/find/zsqrtd\">docs#zsqrtd</a> as asubring?</p>",
        "id": 221748903,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1609926306
    },
    {
        "content": "<p>Sending it through a coercion ring hom would do the trick I assume, although I don't know where the def is for that</p>",
        "id": 221748998,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1609926380
    },
    {
        "content": "<p>I'm a little surprised that zqrtd has no coercion to real...</p>",
        "id": 221749059,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1609926476
    },
    {
        "content": "<p>Well according to the copyright headers its older than real <span aria-label=\"grinning\" class=\"emoji emoji-1f600\" role=\"img\" title=\"grinning\">:grinning:</span></p>",
        "id": 221749283,
        "sender_full_name": "Alex J. Best",
        "timestamp": 1609926648
    },
    {
        "content": "<p>I'll make a pr</p>",
        "id": 221749838,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1609927145
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"sd\">/-- The image of `zsqrtd` in `ℝ`.  -/</span>\n<span class=\"kd\">@[simps]</span>\n<span class=\"kd\">noncomputable</span> <span class=\"kd\">def</span> <span class=\"n\">to_real</span> <span class=\"o\">(</span><span class=\"n\">h</span> <span class=\"o\">:</span> <span class=\"mi\">0</span> <span class=\"bp\">≤</span> <span class=\"n\">d</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">ℤ</span><span class=\"bp\">√</span><span class=\"n\">d</span> <span class=\"bp\">→+*</span> <span class=\"n\">ℝ</span> <span class=\"o\">:=</span> <span class=\"o\">{</span>\n  <span class=\"n\">to_fun</span> <span class=\"o\">:=</span> <span class=\"bp\">λ</span> <span class=\"n\">a</span><span class=\"o\">,</span> <span class=\"n\">a.1</span> <span class=\"bp\">+</span> <span class=\"n\">a.2</span><span class=\"bp\">*</span><span class=\"n\">real.sqrt</span> <span class=\"n\">d</span><span class=\"o\">,</span>\n  <span class=\"n\">map_zero'</span> <span class=\"o\">:=</span> <span class=\"kd\">by</span> <span class=\"n\">simp</span><span class=\"o\">,</span>\n  <span class=\"n\">map_add'</span> <span class=\"o\">:=</span> <span class=\"bp\">λ</span> <span class=\"n\">a</span> <span class=\"n\">b</span><span class=\"o\">,</span> <span class=\"kd\">by</span> <span class=\"o\">{</span> <span class=\"n\">simp</span><span class=\"o\">,</span> <span class=\"n\">ring</span><span class=\"o\">,</span> <span class=\"o\">},</span>\n  <span class=\"n\">map_one'</span> <span class=\"o\">:=</span> <span class=\"kd\">by</span> <span class=\"n\">simp</span><span class=\"o\">,</span>\n  <span class=\"n\">map_mul'</span> <span class=\"o\">:=</span> <span class=\"bp\">λ</span> <span class=\"n\">a</span> <span class=\"n\">b</span><span class=\"o\">,</span> <span class=\"kd\">by</span> <span class=\"o\">{</span>\n    <span class=\"k\">have</span> <span class=\"o\">:</span> <span class=\"o\">(</span><span class=\"bp\">↑</span><span class=\"n\">a.re</span> <span class=\"bp\">+</span> <span class=\"bp\">↑</span><span class=\"n\">a.im</span> <span class=\"bp\">*</span> <span class=\"n\">real.sqrt</span> <span class=\"n\">d</span><span class=\"o\">)</span> <span class=\"bp\">*</span> <span class=\"o\">(</span><span class=\"bp\">↑</span><span class=\"n\">b.re</span> <span class=\"bp\">+</span> <span class=\"bp\">↑</span><span class=\"n\">b.im</span> <span class=\"bp\">*</span> <span class=\"n\">real.sqrt</span> <span class=\"n\">d</span><span class=\"o\">)</span> <span class=\"bp\">=</span>\n             <span class=\"bp\">↑</span><span class=\"n\">a.re</span> <span class=\"bp\">*</span> <span class=\"bp\">↑</span><span class=\"n\">b.re</span> <span class=\"bp\">+</span> <span class=\"o\">(</span><span class=\"bp\">↑</span><span class=\"n\">a.re</span> <span class=\"bp\">*</span> <span class=\"bp\">↑</span><span class=\"n\">b.im</span> <span class=\"bp\">+</span> <span class=\"bp\">↑</span><span class=\"n\">a.im</span> <span class=\"bp\">*</span> <span class=\"bp\">↑</span><span class=\"n\">b.re</span><span class=\"o\">)</span> <span class=\"bp\">*</span> <span class=\"n\">real.sqrt</span> <span class=\"n\">d</span>\n                           <span class=\"bp\">+</span> <span class=\"bp\">↑</span><span class=\"n\">a.im</span> <span class=\"bp\">*</span> <span class=\"bp\">↑</span><span class=\"n\">b.im</span> <span class=\"bp\">*</span> <span class=\"o\">(</span><span class=\"n\">real.sqrt</span> <span class=\"n\">d</span> <span class=\"bp\">*</span> <span class=\"n\">real.sqrt</span> <span class=\"n\">d</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"kd\">by</span> <span class=\"n\">ring</span><span class=\"o\">,</span>\n    <span class=\"n\">simp</span> <span class=\"o\">[</span><span class=\"n\">this</span><span class=\"o\">,</span> <span class=\"n\">real.mul_self_sqrt</span> <span class=\"o\">(</span><span class=\"n\">int.cast_nonneg.mpr</span> <span class=\"n\">h</span><span class=\"o\">)],</span>\n    <span class=\"n\">ring</span><span class=\"o\">,</span> <span class=\"o\">}</span> <span class=\"o\">}</span>\n</code></pre></div>\n<p>seems like the def needed, which proves the subring as <code>to_real.range</code></p>",
        "id": 221755534,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1609931332
    },
    {
        "content": "<p>I was hoping to be able to also prove</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kd\">lemma</span> <span class=\"n\">to_real_injective</span> <span class=\"o\">(</span><span class=\"n\">h</span> <span class=\"o\">:</span> <span class=\"mi\">0</span> <span class=\"bp\">≤</span> <span class=\"n\">d</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">h_not_square</span> <span class=\"o\">:</span> <span class=\"bp\">¬∃</span> <span class=\"o\">(</span><span class=\"n\">x</span> <span class=\"o\">:</span> <span class=\"n\">ℤ</span><span class=\"o\">),</span> <span class=\"n\">x</span><span class=\"bp\">*</span><span class=\"n\">x</span> <span class=\"bp\">=</span> <span class=\"n\">d</span><span class=\"o\">)</span> <span class=\"o\">:</span>\n  <span class=\"n\">function.injective</span> <span class=\"o\">(</span><span class=\"n\">to_real</span> <span class=\"n\">h</span><span class=\"o\">)</span> <span class=\"o\">:=</span>\n<span class=\"o\">(</span><span class=\"n\">to_real</span> <span class=\"n\">h</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">injective_iff.mpr</span> <span class=\"bp\">$</span> <span class=\"bp\">λ</span> <span class=\"n\">a</span> <span class=\"n\">ha</span><span class=\"o\">,</span> <span class=\"kd\">begin</span>\n  <span class=\"n\">simp</span> <span class=\"n\">only</span> <span class=\"o\">[</span><span class=\"n\">to_real_apply</span><span class=\"o\">]</span> <span class=\"n\">at</span> <span class=\"n\">ha</span><span class=\"o\">,</span>\n  <span class=\"k\">have</span> <span class=\"o\">:</span> <span class=\"o\">(</span><span class=\"bp\">↑</span><span class=\"n\">a.re</span> <span class=\"bp\">+</span> <span class=\"bp\">↑</span><span class=\"n\">a.im</span> <span class=\"bp\">*</span> <span class=\"n\">real.sqrt</span> <span class=\"n\">d</span><span class=\"o\">)</span> <span class=\"bp\">*</span> <span class=\"o\">(</span><span class=\"bp\">↑</span><span class=\"n\">a.re</span> <span class=\"bp\">-</span> <span class=\"bp\">↑</span><span class=\"n\">a.im</span> <span class=\"bp\">*</span> <span class=\"n\">real.sqrt</span> <span class=\"n\">d</span><span class=\"o\">)</span> <span class=\"bp\">=</span>\n          <span class=\"n\">a.re</span> <span class=\"bp\">*</span> <span class=\"n\">a.re</span> <span class=\"bp\">-</span> <span class=\"o\">(</span><span class=\"n\">real.sqrt</span> <span class=\"n\">d</span> <span class=\"bp\">*</span> <span class=\"n\">real.sqrt</span> <span class=\"n\">d</span><span class=\"o\">)</span> <span class=\"bp\">*</span> <span class=\"o\">(</span><span class=\"n\">a.im</span> <span class=\"bp\">*</span> <span class=\"n\">a.im</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"kd\">by</span> <span class=\"n\">ring</span><span class=\"o\">,</span>\n  <span class=\"n\">replace</span> <span class=\"n\">ha</span> <span class=\"o\">:=</span> <span class=\"n\">congr_arg</span> <span class=\"o\">(</span><span class=\"bp\">λ</span> <span class=\"n\">x</span><span class=\"o\">,</span> <span class=\"n\">x</span> <span class=\"bp\">*</span> <span class=\"o\">(</span><span class=\"bp\">↑</span><span class=\"o\">(</span><span class=\"n\">a.re</span><span class=\"o\">)</span> <span class=\"bp\">-</span> <span class=\"bp\">↑</span><span class=\"o\">(</span><span class=\"n\">a.im</span><span class=\"o\">)</span> <span class=\"bp\">*</span> <span class=\"n\">real.sqrt</span> <span class=\"bp\">↑</span><span class=\"n\">d</span><span class=\"o\">))</span> <span class=\"n\">ha</span><span class=\"o\">,</span>\n  <span class=\"n\">simp</span> <span class=\"o\">[</span><span class=\"n\">this</span><span class=\"o\">,</span> <span class=\"n\">real.mul_self_sqrt</span> <span class=\"o\">(</span><span class=\"n\">int.cast_nonneg.mpr</span> <span class=\"n\">h</span><span class=\"o\">)]</span> <span class=\"n\">at</span> <span class=\"n\">ha</span><span class=\"o\">,</span>\n  <span class=\"n\">rw</span> <span class=\"n\">sub_eq_zero</span> <span class=\"n\">at</span> <span class=\"n\">ha</span><span class=\"o\">,</span>\n  <span class=\"n\">norm_cast</span> <span class=\"n\">at</span> <span class=\"n\">ha</span><span class=\"o\">,</span>\n  <span class=\"n\">simp</span> <span class=\"n\">at</span> <span class=\"n\">h_not_square</span><span class=\"o\">,</span>\n  <span class=\"gr\">sorry</span><span class=\"o\">,</span>\n<span class=\"kd\">end</span>\n</code></pre></div>\n<p>but I think I'm missing some knowledge of the lemmas to apply</p>",
        "id": 221755705,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1609931426
    },
    {
        "content": "<p>A number-theoretic ring like <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"double-struck\">Z</mi><mo stretchy=\"false\">[</mo><msqrt><mi>d</mi></msqrt><mo stretchy=\"false\">]</mo></mrow><annotation encoding=\"application/x-tex\">\\mathbb{Z}[\\sqrt{d}]</annotation></semantics></math></span><span aria-hidden=\"true\" class=\"katex-html\"><span class=\"base\"><span class=\"strut\" style=\"height:1.18222em;vertical-align:-0.25em;\"></span><span class=\"mord\"><span class=\"mord mathbb\">Z</span></span><span class=\"mopen\">[</span><span class=\"mord sqrt\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.93222em;\"><span class=\"svg-align\" style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\" style=\"padding-left:0.833em;\"><span class=\"mord mathnormal\">d</span></span></span><span style=\"top:-2.89222em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"hide-tail\" style=\"min-width:0.853em;height:1.08em;\"><svg height=\"1.08em\" preserveAspectRatio=\"xMinYMin slice\" viewBox=\"0 0 400000 1080\" width=\"400em\"><path d=\"M95,702 c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14 c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54 c44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10 s173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429 c69,-144,104.5,-217.7,106.5,-221 l0 -0 c5.3,-9.3,12,-14,20,-14 H400000v40H845.2724 s-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7 c-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47z M834 80h400000v40h-400000z\"></path></svg></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.10777999999999999em;\"><span></span></span></span></span></span><span class=\"mclose\">]</span></span></span></span> has two maps to the reals and it's not clear to me that the one you're thinking of is any better than the other one. <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"double-struck\">Z</mi><mo stretchy=\"false\">[</mo><msqrt><mi>d</mi></msqrt><mo stretchy=\"false\">]</mo></mrow><annotation encoding=\"application/x-tex\">\\mathbb{Z}[\\sqrt{d}]</annotation></semantics></math></span><span aria-hidden=\"true\" class=\"katex-html\"><span class=\"base\"><span class=\"strut\" style=\"height:1.18222em;vertical-align:-0.25em;\"></span><span class=\"mord\"><span class=\"mord mathbb\">Z</span></span><span class=\"mopen\">[</span><span class=\"mord sqrt\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.93222em;\"><span class=\"svg-align\" style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\" style=\"padding-left:0.833em;\"><span class=\"mord mathnormal\">d</span></span></span><span style=\"top:-2.89222em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"hide-tail\" style=\"min-width:0.853em;height:1.08em;\"><svg height=\"1.08em\" preserveAspectRatio=\"xMinYMin slice\" viewBox=\"0 0 400000 1080\" width=\"400em\"><path d=\"M95,702 c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14 c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54 c44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10 s173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429 c69,-144,104.5,-217.7,106.5,-221 l0 -0 c5.3,-9.3,12,-14,20,-14 H400000v40H845.2724 s-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7 c-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47z M834 80h400000v40h-400000z\"></path></svg></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.10777999999999999em;\"><span></span></span></span></span></span><span class=\"mclose\">]</span></span></span></span> should not be thought of as a subring of the reals, it is notation for the abstract ring <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"double-struck\">Z</mi><mo stretchy=\"false\">[</mo><mi>X</mi><mo stretchy=\"false\">]</mo><mi mathvariant=\"normal\">/</mi><mo stretchy=\"false\">(</mo><msup><mi>X</mi><mn>2</mn></msup><mo>−</mo><mi>d</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">\\mathbb{Z}[X]/(X^2-d)</annotation></semantics></math></span><span aria-hidden=\"true\" class=\"katex-html\"><span class=\"base\"><span class=\"strut\" style=\"height:1.064108em;vertical-align:-0.25em;\"></span><span class=\"mord\"><span class=\"mord mathbb\">Z</span></span><span class=\"mopen\">[</span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">X</span><span class=\"mclose\">]</span><span class=\"mord\">/</span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">X</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">d</span><span class=\"mclose\">)</span></span></span></span> and <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>X</mi></mrow><annotation encoding=\"application/x-tex\">X</annotation></semantics></math></span><span aria-hidden=\"true\" class=\"katex-html\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">X</span></span></span></span> is no more positive than it is negative.</p>",
        "id": 221758766,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1609933875
    },
    {
        "content": "<p>That's perhaps an argument against it being a coe, but I think the mapping should probably still exist</p>",
        "id": 221759996,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1609934780
    },
    {
        "content": "<p>Both should ;-)</p>",
        "id": 221760011,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1609934794
    },
    {
        "content": "<p>This is a great example of an object with a canonical non-trivial automorphism, so everything either is invariant under the automorphism or comes in pairs.</p>",
        "id": 221760093,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1609934853
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib/issues/5640\">#5640</a></p>",
        "id": 221760256,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1609934979
    },
    {
        "content": "<p>I only added <code>to_real</code> because we only have <code>real.sqrt</code></p>",
        "id": 221760269,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1609934999
    },
    {
        "content": "<p>If you want the other one you can use <code>conj.to_real</code></p>",
        "id": 221760316,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1609935005
    },
    {
        "content": "<p>That's generally the rule when you only have one of the pair ;-)</p>",
        "id": 221760342,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1609935029
    },
    {
        "content": "<p>alternative approach:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kd\">lemma</span> <span class=\"n\">to_real_injective</span> <span class=\"o\">(</span><span class=\"n\">h</span> <span class=\"o\">:</span> <span class=\"mi\">0</span> <span class=\"bp\">≤</span> <span class=\"n\">d</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">h_not_square</span> <span class=\"o\">:</span> <span class=\"bp\">¬∃</span> <span class=\"o\">(</span><span class=\"n\">x</span> <span class=\"o\">:</span> <span class=\"n\">ℤ</span><span class=\"o\">),</span> <span class=\"n\">x</span><span class=\"bp\">*</span><span class=\"n\">x</span> <span class=\"bp\">=</span> <span class=\"n\">d</span><span class=\"o\">)</span> <span class=\"o\">:</span>\n  <span class=\"n\">function.injective</span> <span class=\"o\">(</span><span class=\"n\">to_real</span> <span class=\"n\">h</span><span class=\"o\">)</span> <span class=\"o\">:=</span>\n<span class=\"o\">(</span><span class=\"n\">to_real</span> <span class=\"n\">h</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">injective_iff.mpr</span> <span class=\"bp\">$</span> <span class=\"bp\">λ</span> <span class=\"n\">a</span> <span class=\"n\">ha</span><span class=\"o\">,</span> <span class=\"kd\">begin</span>\n  <span class=\"n\">simp</span> <span class=\"n\">only</span> <span class=\"o\">[</span><span class=\"n\">to_real_apply</span><span class=\"o\">]</span> <span class=\"n\">at</span> <span class=\"n\">ha</span><span class=\"o\">,</span>\n  <span class=\"k\">have</span> <span class=\"o\">:=</span> <span class=\"n\">irrational_nrt_of_notint_nrt</span> <span class=\"mi\">2</span> <span class=\"n\">d</span> <span class=\"o\">(</span><span class=\"kd\">by</span> <span class=\"gr\">sorry</span> <span class=\"o\">:</span> <span class=\"o\">(</span><span class=\"n\">real.sqrt</span> <span class=\"n\">d</span><span class=\"o\">)</span> <span class=\"bp\">^</span> <span class=\"mi\">2</span> <span class=\"bp\">=</span><span class=\"n\">d</span><span class=\"o\">),</span>\n  <span class=\"n\">specialize</span> <span class=\"n\">this</span> <span class=\"n\">_</span> <span class=\"n\">_</span><span class=\"o\">,</span>\n  <span class=\"n\">by_cases</span> <span class=\"n\">haim</span> <span class=\"o\">:</span> <span class=\"n\">a.im</span> <span class=\"bp\">=</span> <span class=\"mi\">0</span><span class=\"o\">,</span>\n  <span class=\"o\">{</span> <span class=\"gr\">sorry</span> <span class=\"o\">},</span>\n  <span class=\"k\">have</span> <span class=\"o\">:=</span> <span class=\"n\">rat_add</span> <span class=\"n\">a.re</span> <span class=\"o\">(</span><span class=\"n\">rat_mul</span> <span class=\"n\">this</span> <span class=\"o\">(</span><span class=\"kd\">by</span> <span class=\"n\">exact_mod_cast</span> <span class=\"n\">haim</span> <span class=\"o\">:</span> <span class=\"o\">(</span><span class=\"n\">a.im</span> <span class=\"o\">:</span> <span class=\"n\">ℚ</span><span class=\"o\">)</span> <span class=\"bp\">≠</span> <span class=\"mi\">0</span><span class=\"o\">)),</span>\n  <span class=\"n\">norm_cast</span> <span class=\"n\">at</span> <span class=\"n\">this</span><span class=\"o\">,</span>\n  <span class=\"n\">rw</span> <span class=\"n\">ha</span> <span class=\"n\">at</span> <span class=\"n\">this</span><span class=\"o\">,</span>\n  <span class=\"n\">exfalso</span><span class=\"o\">,</span>\n  <span class=\"n\">exact</span> <span class=\"n\">rat.not_irrational</span> <span class=\"mi\">0</span> <span class=\"o\">(</span><span class=\"kd\">by</span> <span class=\"n\">exact_mod_cast</span> <span class=\"n\">this</span><span class=\"o\">),</span>\n  <span class=\"gr\">sorry</span><span class=\"o\">,</span>\n  <span class=\"gr\">sorry</span><span class=\"o\">,</span>\n<span class=\"kd\">end</span>\n</code></pre></div>",
        "id": 221760429,
        "sender_full_name": "Alex J. Best",
        "timestamp": 1609935121
    },
    {
        "content": "<p>I've solved the lemma in the PR</p>",
        "id": 221760825,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1609935480
    },
    {
        "content": "<p>So alternative approaches fine, but the bar is now sorry-free :)</p>",
        "id": 221760872,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1609935493
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"364351\">@Lars Ericson</span>, with that PR, your problem can now be solved as:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"c1\">-- This definition is what each question in exercise 6 is asking. No need to restate it each time</span>\n<span class=\"kd\">abbreviation</span> <span class=\"n\">ex6</span> <span class=\"o\">{</span><span class=\"n\">α</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span> <span class=\"o\">[</span><span class=\"n\">ring</span> <span class=\"n\">α</span><span class=\"o\">]</span> <span class=\"o\">(</span><span class=\"n\">s</span> <span class=\"o\">:</span> <span class=\"n\">set</span> <span class=\"n\">α</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"bp\">∃</span> <span class=\"o\">(</span><span class=\"n\">sr</span> <span class=\"o\">:</span> <span class=\"n\">subring</span> <span class=\"n\">α</span><span class=\"o\">)</span> <span class=\"o\">[</span><span class=\"n\">integral_domain</span> <span class=\"n\">sr</span><span class=\"o\">],</span> <span class=\"n\">s</span> <span class=\"bp\">=</span> <span class=\"n\">sr</span>\n\n<span class=\"kd\">theorem</span> <span class=\"n\">ex6e</span> <span class=\"o\">:</span> <span class=\"n\">ex6</span> <span class=\"o\">{</span><span class=\"n\">x</span> <span class=\"o\">:</span> <span class=\"n\">ℝ</span> <span class=\"bp\">|</span> <span class=\"bp\">∃</span> <span class=\"n\">a</span> <span class=\"n\">b</span> <span class=\"o\">:</span> <span class=\"n\">ℤ</span><span class=\"o\">,</span> <span class=\"n\">x</span> <span class=\"bp\">=</span> <span class=\"n\">a</span> <span class=\"bp\">+</span> <span class=\"n\">b</span> <span class=\"bp\">*</span> <span class=\"o\">(</span><span class=\"mi\">9</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">)</span> <span class=\"bp\">^</span> <span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"bp\">/</span><span class=\"mi\">4</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">)}</span> <span class=\"o\">:=</span>\n<span class=\"kd\">begin</span>\n  <span class=\"n\">refine</span> <span class=\"o\">⟨(</span><span class=\"n\">zsqrtd.to_real</span> <span class=\"o\">(</span><span class=\"k\">show</span> <span class=\"mi\">0</span> <span class=\"bp\">≤</span> <span class=\"o\">(</span><span class=\"mi\">3</span> <span class=\"o\">:</span> <span class=\"n\">ℤ</span><span class=\"o\">),</span> <span class=\"kd\">by</span> <span class=\"n\">norm_num</span><span class=\"o\">))</span><span class=\"bp\">.</span><span class=\"n\">range</span><span class=\"o\">,</span> <span class=\"n\">_</span><span class=\"o\">,</span> <span class=\"n\">_</span><span class=\"o\">⟩,</span>\n  <span class=\"n\">apply_instance</span><span class=\"o\">,</span>\n  <span class=\"n\">ext</span><span class=\"o\">,</span>\n  <span class=\"gr\">sorry</span>\n<span class=\"kd\">end</span>\n</code></pre></div>\n<p>where the final goals ought to be fairly easy to close without any knowledge of the reals</p>",
        "id": 221761004,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1609935611
    },
    {
        "content": "<p>Thank you all very much.  I just did a <code>leanproject upgrade-mathlib</code> which I guess gets me the PR.  I will try to fill out the <code>sorry</code> in Eric's final version.</p>",
        "id": 221771490,
        "sender_full_name": "Lars Ericson",
        "timestamp": 1609942697
    },
    {
        "content": "<p>It does not get you the PR, because the PR is not merged yet!</p>",
        "id": 221771515,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1609942717
    },
    {
        "content": "<p>However, you can still use the <code>abbreviation ex6</code>definition without the PR</p>",
        "id": 221771612,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1609942790
    },
    {
        "content": "<p>It still wants <code>has_pow</code>:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kn\">import</span> <span class=\"n\">data.zsqrtd.basic</span>\n<span class=\"kn\">import</span> <span class=\"n\">ring_theory.subring</span>\n<span class=\"kn\">import</span> <span class=\"n\">data.real.basic</span>\n\n<span class=\"c1\">-- This definition is what each question in exercise 6 is asking. No need to restate it each time</span>\n<span class=\"kd\">abbreviation</span> <span class=\"n\">ex6</span> <span class=\"o\">{</span><span class=\"n\">α</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span> <span class=\"o\">[</span><span class=\"n\">ring</span> <span class=\"n\">α</span><span class=\"o\">]</span> <span class=\"o\">(</span><span class=\"n\">s</span> <span class=\"o\">:</span> <span class=\"n\">set</span> <span class=\"n\">α</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"bp\">∃</span> <span class=\"o\">(</span><span class=\"n\">sr</span> <span class=\"o\">:</span> <span class=\"n\">subring</span> <span class=\"n\">α</span><span class=\"o\">)</span> <span class=\"o\">[</span><span class=\"n\">integral_domain</span> <span class=\"n\">sr</span><span class=\"o\">],</span> <span class=\"n\">s</span> <span class=\"bp\">=</span> <span class=\"n\">sr</span>\n\n<span class=\"kd\">theorem</span> <span class=\"n\">ex6e</span> <span class=\"o\">:</span> <span class=\"n\">ex6</span> <span class=\"o\">{</span><span class=\"n\">x</span> <span class=\"o\">:</span> <span class=\"n\">ℝ</span> <span class=\"bp\">|</span> <span class=\"bp\">∃</span> <span class=\"n\">a</span> <span class=\"n\">b</span> <span class=\"o\">:</span> <span class=\"n\">ℤ</span><span class=\"o\">,</span> <span class=\"n\">x</span> <span class=\"bp\">=</span> <span class=\"n\">a</span> <span class=\"bp\">+</span> <span class=\"n\">b</span> <span class=\"bp\">*</span> <span class=\"o\">(</span><span class=\"mi\">9</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">)</span> <span class=\"bp\">^</span> <span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"bp\">/</span><span class=\"mi\">4</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">)}</span> <span class=\"o\">:=</span>\n<span class=\"kd\">begin</span>\n  <span class=\"n\">refine</span> <span class=\"o\">⟨(</span><span class=\"n\">zsqrtd.to_real</span> <span class=\"o\">(</span><span class=\"k\">show</span> <span class=\"mi\">0</span> <span class=\"bp\">≤</span> <span class=\"o\">(</span><span class=\"mi\">3</span> <span class=\"o\">:</span> <span class=\"n\">ℤ</span><span class=\"o\">),</span> <span class=\"kd\">by</span> <span class=\"n\">norm_num</span><span class=\"o\">))</span><span class=\"bp\">.</span><span class=\"n\">range</span><span class=\"o\">,</span> <span class=\"n\">_</span><span class=\"o\">,</span> <span class=\"n\">_</span><span class=\"o\">⟩,</span>\n  <span class=\"n\">apply_instance</span><span class=\"o\">,</span>\n  <span class=\"n\">ext</span><span class=\"o\">,</span>\n  <span class=\"gr\">sorry</span>\n<span class=\"kd\">end</span>\n</code></pre></div>\n<p>gives error</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"n\">failed</span> <span class=\"n\">to</span> <span class=\"n\">synthesize</span> <span class=\"n\">type</span> <span class=\"kd\">class</span> <span class=\"kd\">instance</span> <span class=\"n\">for</span>\n<span class=\"n\">x</span> <span class=\"o\">:</span> <span class=\"n\">ℝ</span><span class=\"o\">,</span>\n<span class=\"n\">a</span> <span class=\"n\">b</span> <span class=\"o\">:</span> <span class=\"n\">ℤ</span>\n<span class=\"bp\">⊢</span> <span class=\"n\">has_pow</span> <span class=\"n\">ℝ</span> <span class=\"n\">ℝ</span>\n</code></pre></div>",
        "id": 221771759,
        "sender_full_name": "Lars Ericson",
        "timestamp": 1609942865
    },
    {
        "content": "<p>Yes, you need <code>import analysis.special_functions.pow</code></p>",
        "id": 221771807,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1609942892
    },
    {
        "content": "<p>It wants one more definition, should I add that lemma <code>to_real_injective</code> above?</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"n\">unknown</span> <span class=\"n\">identifier</span> <span class=\"bp\">'</span><span class=\"n\">zsqrtd.to_real'</span>\n<span class=\"n\">state</span><span class=\"o\">:</span>\n<span class=\"bp\">⊢</span> <span class=\"n\">ex6</span> <span class=\"o\">{</span><span class=\"n\">x</span> <span class=\"o\">:</span> <span class=\"n\">ℝ</span> <span class=\"bp\">|</span> <span class=\"bp\">∃</span> <span class=\"o\">(</span><span class=\"n\">a</span> <span class=\"n\">b</span> <span class=\"o\">:</span> <span class=\"n\">ℤ</span><span class=\"o\">),</span> <span class=\"n\">x</span> <span class=\"bp\">=</span> <span class=\"bp\">↑</span><span class=\"n\">a</span> <span class=\"bp\">+</span> <span class=\"bp\">↑</span><span class=\"n\">b</span> <span class=\"bp\">*</span> <span class=\"mi\">9</span> <span class=\"bp\">^</span> <span class=\"o\">(</span><span class=\"mi\">1</span> <span class=\"bp\">/</span> <span class=\"mi\">4</span><span class=\"o\">)}</span>\n</code></pre></div>",
        "id": 221771945,
        "sender_full_name": "Lars Ericson",
        "timestamp": 1609942956
    },
    {
        "content": "<p>You need this one: <a href=\"#narrow/stream/113489-new-members/topic/How.20to.20multiply.20an.20integer.20times.20a.20real/near/221755534\">https://leanprover.zulipchat.com/#narrow/stream/113489-new-members/topic/How.20to.20multiply.20an.20integer.20times.20a.20real/near/221755534</a></p>",
        "id": 221771988,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1609942982
    },
    {
        "content": "<p>You don't need the injectivity one, I added that because I thought it might be useful to someone</p>",
        "id": 221772044,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1609943032
    },
    {
        "content": "<p>It wants a <code>d</code>.</p>",
        "id": 221772149,
        "sender_full_name": "Lars Ericson",
        "timestamp": 1609943078
    },
    {
        "content": "<p>Should I add <code>variable d: ℕ </code> in context?</p>",
        "id": 221772204,
        "sender_full_name": "Lars Ericson",
        "timestamp": 1609943120
    },
    {
        "content": "<p>Just add <code>{d : ℕ}</code> after the word <code>to_real</code></p>",
        "id": 221772333,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1609943182
    },
    {
        "content": "<p>I can't make it happy.  This is my starting point:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kn\">import</span> <span class=\"n\">data.zsqrtd.basic</span>\n<span class=\"kn\">import</span> <span class=\"n\">ring_theory.subring</span>\n<span class=\"kn\">import</span> <span class=\"n\">data.real.basic</span>\n<span class=\"kn\">import</span> <span class=\"n\">analysis.special_functions.pow</span>\n\n<span class=\"kn\">namespace</span> <span class=\"n\">zsqrtd</span>\n\n<span class=\"kd\">variable</span> <span class=\"n\">d</span><span class=\"o\">:</span> <span class=\"n\">ℕ</span>\n\n<span class=\"sd\">/-- The image of `zsqrtd` in `ℝ`.  -/</span>\n<span class=\"kd\">@[simps]</span>\n<span class=\"kd\">noncomputable</span> <span class=\"kd\">def</span> <span class=\"n\">to_real</span> <span class=\"o\">(</span><span class=\"n\">h</span> <span class=\"o\">:</span> <span class=\"mi\">0</span> <span class=\"bp\">≤</span> <span class=\"n\">d</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">ℤ</span><span class=\"bp\">√</span><span class=\"n\">d</span> <span class=\"bp\">→+*</span> <span class=\"n\">ℝ</span> <span class=\"o\">:=</span> <span class=\"o\">{</span>\n  <span class=\"n\">to_fun</span> <span class=\"o\">:=</span> <span class=\"bp\">λ</span> <span class=\"n\">a</span><span class=\"o\">,</span> <span class=\"n\">a.1</span> <span class=\"bp\">+</span> <span class=\"n\">a.2</span><span class=\"bp\">*</span><span class=\"n\">real.sqrt</span> <span class=\"n\">d</span><span class=\"o\">,</span>\n  <span class=\"n\">map_zero'</span> <span class=\"o\">:=</span> <span class=\"kd\">by</span> <span class=\"n\">simp</span><span class=\"o\">,</span>\n  <span class=\"n\">map_add'</span> <span class=\"o\">:=</span> <span class=\"bp\">λ</span> <span class=\"n\">a</span> <span class=\"n\">b</span><span class=\"o\">,</span> <span class=\"kd\">by</span> <span class=\"o\">{</span> <span class=\"n\">simp</span><span class=\"o\">,</span> <span class=\"n\">ring</span><span class=\"o\">,</span> <span class=\"o\">},</span>\n  <span class=\"n\">map_one'</span> <span class=\"o\">:=</span> <span class=\"kd\">by</span> <span class=\"n\">simp</span><span class=\"o\">,</span>\n  <span class=\"n\">map_mul'</span> <span class=\"o\">:=</span> <span class=\"bp\">λ</span> <span class=\"n\">a</span> <span class=\"n\">b</span><span class=\"o\">,</span> <span class=\"kd\">by</span> <span class=\"o\">{</span>\n    <span class=\"k\">have</span> <span class=\"o\">:</span> <span class=\"o\">(</span><span class=\"bp\">↑</span><span class=\"n\">a.re</span> <span class=\"bp\">+</span> <span class=\"bp\">↑</span><span class=\"n\">a.im</span> <span class=\"bp\">*</span> <span class=\"n\">real.sqrt</span> <span class=\"n\">d</span><span class=\"o\">)</span> <span class=\"bp\">*</span> <span class=\"o\">(</span><span class=\"bp\">↑</span><span class=\"n\">b.re</span> <span class=\"bp\">+</span> <span class=\"bp\">↑</span><span class=\"n\">b.im</span> <span class=\"bp\">*</span> <span class=\"n\">real.sqrt</span> <span class=\"n\">d</span><span class=\"o\">)</span> <span class=\"bp\">=</span>\n             <span class=\"bp\">↑</span><span class=\"n\">a.re</span> <span class=\"bp\">*</span> <span class=\"bp\">↑</span><span class=\"n\">b.re</span> <span class=\"bp\">+</span> <span class=\"o\">(</span><span class=\"bp\">↑</span><span class=\"n\">a.re</span> <span class=\"bp\">*</span> <span class=\"bp\">↑</span><span class=\"n\">b.im</span> <span class=\"bp\">+</span> <span class=\"bp\">↑</span><span class=\"n\">a.im</span> <span class=\"bp\">*</span> <span class=\"bp\">↑</span><span class=\"n\">b.re</span><span class=\"o\">)</span> <span class=\"bp\">*</span> <span class=\"n\">real.sqrt</span> <span class=\"n\">d</span>\n                           <span class=\"bp\">+</span> <span class=\"bp\">↑</span><span class=\"n\">a.im</span> <span class=\"bp\">*</span> <span class=\"bp\">↑</span><span class=\"n\">b.im</span> <span class=\"bp\">*</span> <span class=\"o\">(</span><span class=\"n\">real.sqrt</span> <span class=\"n\">d</span> <span class=\"bp\">*</span> <span class=\"n\">real.sqrt</span> <span class=\"n\">d</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"kd\">by</span> <span class=\"n\">ring</span><span class=\"o\">,</span>\n    <span class=\"n\">simp</span> <span class=\"o\">[</span><span class=\"n\">this</span><span class=\"o\">,</span> <span class=\"n\">real.mul_self_sqrt</span> <span class=\"o\">(</span><span class=\"n\">int.cast_nonneg.mpr</span> <span class=\"n\">h</span><span class=\"o\">)],</span>\n    <span class=\"n\">ring</span><span class=\"o\">,</span> <span class=\"o\">}</span> <span class=\"o\">}</span>\n\n<span class=\"kd\">end</span> <span class=\"n\">zsqrtd</span>\n\n<span class=\"c1\">-- This definition is what each question in exercise 6 is asking. No need to restate it each time</span>\n<span class=\"kd\">abbreviation</span> <span class=\"n\">ex6</span> <span class=\"o\">{</span><span class=\"n\">α</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span> <span class=\"o\">[</span><span class=\"n\">ring</span> <span class=\"n\">α</span><span class=\"o\">]</span> <span class=\"o\">(</span><span class=\"n\">s</span> <span class=\"o\">:</span> <span class=\"n\">set</span> <span class=\"n\">α</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"bp\">∃</span> <span class=\"o\">(</span><span class=\"n\">sr</span> <span class=\"o\">:</span> <span class=\"n\">subring</span> <span class=\"n\">α</span><span class=\"o\">)</span> <span class=\"o\">[</span><span class=\"n\">integral_domain</span> <span class=\"n\">sr</span><span class=\"o\">],</span> <span class=\"n\">s</span> <span class=\"bp\">=</span> <span class=\"n\">sr</span>\n\n<span class=\"kd\">theorem</span> <span class=\"n\">ex6e</span> <span class=\"o\">:</span> <span class=\"n\">ex6</span> <span class=\"o\">{</span><span class=\"n\">x</span> <span class=\"o\">:</span> <span class=\"n\">ℝ</span> <span class=\"bp\">|</span> <span class=\"bp\">∃</span> <span class=\"n\">a</span> <span class=\"n\">b</span> <span class=\"o\">:</span> <span class=\"n\">ℤ</span><span class=\"o\">,</span> <span class=\"n\">x</span> <span class=\"bp\">=</span> <span class=\"n\">a</span> <span class=\"bp\">+</span> <span class=\"n\">b</span> <span class=\"bp\">*</span> <span class=\"o\">(</span><span class=\"mi\">9</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">)</span> <span class=\"bp\">^</span> <span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"bp\">/</span><span class=\"mi\">4</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">)}</span> <span class=\"o\">:=</span>\n<span class=\"kd\">begin</span>\n  <span class=\"n\">refine</span> <span class=\"o\">⟨(</span><span class=\"n\">zsqrtd.to_real</span> <span class=\"o\">(</span><span class=\"k\">show</span> <span class=\"mi\">0</span> <span class=\"bp\">≤</span> <span class=\"o\">(</span><span class=\"mi\">3</span> <span class=\"o\">:</span> <span class=\"n\">ℤ</span><span class=\"o\">),</span> <span class=\"kd\">by</span> <span class=\"n\">norm_num</span><span class=\"o\">))</span><span class=\"bp\">.</span><span class=\"n\">range</span><span class=\"o\">,</span> <span class=\"n\">_</span><span class=\"o\">,</span> <span class=\"n\">_</span><span class=\"o\">⟩,</span>\n  <span class=\"n\">apply_instance</span><span class=\"o\">,</span>\n  <span class=\"n\">ext</span><span class=\"o\">,</span>\n  <span class=\"gr\">sorry</span>\n<span class=\"kd\">end</span>\n</code></pre></div>\n<p>it's giving me</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"n\">type</span> <span class=\"n\">mismatch</span> <span class=\"n\">at</span> <span class=\"n\">application</span>\n  <span class=\"n\">int.cast_nonneg.mpr</span> <span class=\"n\">h</span>\n<span class=\"n\">term</span>\n  <span class=\"n\">h</span>\n<span class=\"n\">has</span> <span class=\"n\">type</span>\n  <span class=\"mi\">0</span> <span class=\"bp\">≤</span> <span class=\"n\">d</span>\n<span class=\"n\">but</span> <span class=\"n\">is</span> <span class=\"n\">expected</span> <span class=\"n\">to</span> <span class=\"k\">have</span> <span class=\"n\">type</span>\n  <span class=\"mi\">0</span> <span class=\"bp\">≤</span> <span class=\"bp\">?</span><span class=\"n\">m_1</span>\n<span class=\"n\">state</span><span class=\"o\">:</span>\n<span class=\"n\">d</span> <span class=\"o\">:</span> <span class=\"n\">ℕ</span><span class=\"o\">,</span>\n<span class=\"n\">h</span> <span class=\"o\">:</span> <span class=\"mi\">0</span> <span class=\"bp\">≤</span> <span class=\"n\">d</span><span class=\"o\">,</span>\n<span class=\"n\">a</span> <span class=\"n\">b</span> <span class=\"o\">:</span> <span class=\"n\">ℤ</span><span class=\"bp\">√↑</span><span class=\"n\">d</span><span class=\"o\">,</span>\n<span class=\"n\">this</span> <span class=\"o\">:</span>\n  <span class=\"o\">(</span><span class=\"bp\">↑</span><span class=\"o\">(</span><span class=\"n\">a.re</span><span class=\"o\">)</span> <span class=\"bp\">+</span> <span class=\"bp\">↑</span><span class=\"o\">(</span><span class=\"n\">a.im</span><span class=\"o\">)</span> <span class=\"bp\">*</span> <span class=\"n\">real.sqrt</span> <span class=\"bp\">↑</span><span class=\"n\">d</span><span class=\"o\">)</span> <span class=\"bp\">*</span> <span class=\"o\">(</span><span class=\"bp\">↑</span><span class=\"o\">(</span><span class=\"n\">b.re</span><span class=\"o\">)</span> <span class=\"bp\">+</span> <span class=\"bp\">↑</span><span class=\"o\">(</span><span class=\"n\">b.im</span><span class=\"o\">)</span> <span class=\"bp\">*</span> <span class=\"n\">real.sqrt</span> <span class=\"bp\">↑</span><span class=\"n\">d</span><span class=\"o\">)</span> <span class=\"bp\">=</span>\n    <span class=\"bp\">↑</span><span class=\"o\">(</span><span class=\"n\">a.re</span><span class=\"o\">)</span> <span class=\"bp\">*</span> <span class=\"bp\">↑</span><span class=\"o\">(</span><span class=\"n\">b.re</span><span class=\"o\">)</span> <span class=\"bp\">+</span> <span class=\"o\">(</span><span class=\"bp\">↑</span><span class=\"o\">(</span><span class=\"n\">a.re</span><span class=\"o\">)</span> <span class=\"bp\">*</span> <span class=\"bp\">↑</span><span class=\"o\">(</span><span class=\"n\">b.im</span><span class=\"o\">)</span> <span class=\"bp\">+</span> <span class=\"bp\">↑</span><span class=\"o\">(</span><span class=\"n\">a.im</span><span class=\"o\">)</span> <span class=\"bp\">*</span> <span class=\"bp\">↑</span><span class=\"o\">(</span><span class=\"n\">b.re</span><span class=\"o\">))</span> <span class=\"bp\">*</span> <span class=\"n\">real.sqrt</span> <span class=\"bp\">↑</span><span class=\"n\">d</span> <span class=\"bp\">+</span>\n      <span class=\"bp\">↑</span><span class=\"o\">(</span><span class=\"n\">a.im</span><span class=\"o\">)</span> <span class=\"bp\">*</span> <span class=\"bp\">↑</span><span class=\"o\">(</span><span class=\"n\">b.im</span><span class=\"o\">)</span> <span class=\"bp\">*</span> <span class=\"o\">(</span><span class=\"n\">real.sqrt</span> <span class=\"bp\">↑</span><span class=\"n\">d</span> <span class=\"bp\">*</span> <span class=\"n\">real.sqrt</span> <span class=\"bp\">↑</span><span class=\"n\">d</span><span class=\"o\">)</span>\n<span class=\"bp\">⊢</span> <span class=\"bp\">↑</span><span class=\"o\">((</span><span class=\"n\">a</span> <span class=\"bp\">*</span> <span class=\"n\">b</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">re</span><span class=\"o\">)</span> <span class=\"bp\">+</span> <span class=\"bp\">↑</span><span class=\"o\">((</span><span class=\"n\">a</span> <span class=\"bp\">*</span> <span class=\"n\">b</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">im</span><span class=\"o\">)</span> <span class=\"bp\">*</span> <span class=\"n\">real.sqrt</span> <span class=\"bp\">↑</span><span class=\"n\">d</span> <span class=\"bp\">=</span>\n    <span class=\"o\">(</span><span class=\"bp\">↑</span><span class=\"o\">(</span><span class=\"n\">a.re</span><span class=\"o\">)</span> <span class=\"bp\">+</span> <span class=\"bp\">↑</span><span class=\"o\">(</span><span class=\"n\">a.im</span><span class=\"o\">)</span> <span class=\"bp\">*</span> <span class=\"n\">real.sqrt</span> <span class=\"bp\">↑</span><span class=\"n\">d</span><span class=\"o\">)</span> <span class=\"bp\">*</span> <span class=\"o\">(</span><span class=\"bp\">↑</span><span class=\"o\">(</span><span class=\"n\">b.re</span><span class=\"o\">)</span> <span class=\"bp\">+</span> <span class=\"bp\">↑</span><span class=\"o\">(</span><span class=\"n\">b.im</span><span class=\"o\">)</span> <span class=\"bp\">*</span> <span class=\"n\">real.sqrt</span> <span class=\"bp\">↑</span><span class=\"n\">d</span><span class=\"o\">)</span>\n</code></pre></div>",
        "id": 221772343,
        "sender_full_name": "Lars Ericson",
        "timestamp": 1609943195
    },
    {
        "content": "<p>d should be a <code>\\Z</code></p>",
        "id": 221772394,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1609943227
    },
    {
        "content": "<p>Thank you.  This is my starting point, it checks:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kn\">import</span> <span class=\"n\">data.zsqrtd.basic</span>\n<span class=\"kn\">import</span> <span class=\"n\">ring_theory.subring</span>\n<span class=\"kn\">import</span> <span class=\"n\">data.real.basic</span>\n<span class=\"kn\">import</span> <span class=\"n\">analysis.special_functions.pow</span>\n\n<span class=\"sd\">/-- The image of `zsqrtd` in `ℝ`.  -/</span>\n<span class=\"kd\">@[simps]</span>\n<span class=\"kd\">noncomputable</span> <span class=\"kd\">def</span> <span class=\"n\">zsqrtd.to_real</span> <span class=\"o\">{</span><span class=\"n\">d</span> <span class=\"o\">:</span> <span class=\"n\">ℤ</span> <span class=\"o\">}</span> <span class=\"o\">(</span><span class=\"n\">h</span> <span class=\"o\">:</span> <span class=\"mi\">0</span> <span class=\"bp\">≤</span> <span class=\"n\">d</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">ℤ</span><span class=\"bp\">√</span><span class=\"n\">d</span> <span class=\"bp\">→+*</span> <span class=\"n\">ℝ</span> <span class=\"o\">:=</span> <span class=\"o\">{</span>\n  <span class=\"n\">to_fun</span> <span class=\"o\">:=</span> <span class=\"bp\">λ</span> <span class=\"n\">a</span><span class=\"o\">,</span> <span class=\"n\">a.1</span> <span class=\"bp\">+</span> <span class=\"n\">a.2</span><span class=\"bp\">*</span><span class=\"n\">real.sqrt</span> <span class=\"n\">d</span><span class=\"o\">,</span>\n  <span class=\"n\">map_zero'</span> <span class=\"o\">:=</span> <span class=\"kd\">by</span> <span class=\"n\">simp</span><span class=\"o\">,</span>\n  <span class=\"n\">map_add'</span> <span class=\"o\">:=</span> <span class=\"bp\">λ</span> <span class=\"n\">a</span> <span class=\"n\">b</span><span class=\"o\">,</span> <span class=\"kd\">by</span> <span class=\"o\">{</span> <span class=\"n\">simp</span><span class=\"o\">,</span> <span class=\"n\">ring</span><span class=\"o\">,</span> <span class=\"o\">},</span>\n  <span class=\"n\">map_one'</span> <span class=\"o\">:=</span> <span class=\"kd\">by</span> <span class=\"n\">simp</span><span class=\"o\">,</span>\n  <span class=\"n\">map_mul'</span> <span class=\"o\">:=</span> <span class=\"bp\">λ</span> <span class=\"n\">a</span> <span class=\"n\">b</span><span class=\"o\">,</span> <span class=\"kd\">by</span> <span class=\"o\">{</span>\n    <span class=\"k\">have</span> <span class=\"o\">:</span> <span class=\"o\">(</span><span class=\"bp\">↑</span><span class=\"n\">a.re</span> <span class=\"bp\">+</span> <span class=\"bp\">↑</span><span class=\"n\">a.im</span> <span class=\"bp\">*</span> <span class=\"n\">real.sqrt</span> <span class=\"n\">d</span><span class=\"o\">)</span> <span class=\"bp\">*</span> <span class=\"o\">(</span><span class=\"bp\">↑</span><span class=\"n\">b.re</span> <span class=\"bp\">+</span> <span class=\"bp\">↑</span><span class=\"n\">b.im</span> <span class=\"bp\">*</span> <span class=\"n\">real.sqrt</span> <span class=\"n\">d</span><span class=\"o\">)</span> <span class=\"bp\">=</span>\n             <span class=\"bp\">↑</span><span class=\"n\">a.re</span> <span class=\"bp\">*</span> <span class=\"bp\">↑</span><span class=\"n\">b.re</span> <span class=\"bp\">+</span> <span class=\"o\">(</span><span class=\"bp\">↑</span><span class=\"n\">a.re</span> <span class=\"bp\">*</span> <span class=\"bp\">↑</span><span class=\"n\">b.im</span> <span class=\"bp\">+</span> <span class=\"bp\">↑</span><span class=\"n\">a.im</span> <span class=\"bp\">*</span> <span class=\"bp\">↑</span><span class=\"n\">b.re</span><span class=\"o\">)</span> <span class=\"bp\">*</span> <span class=\"n\">real.sqrt</span> <span class=\"n\">d</span>\n                           <span class=\"bp\">+</span> <span class=\"bp\">↑</span><span class=\"n\">a.im</span> <span class=\"bp\">*</span> <span class=\"bp\">↑</span><span class=\"n\">b.im</span> <span class=\"bp\">*</span> <span class=\"o\">(</span><span class=\"n\">real.sqrt</span> <span class=\"n\">d</span> <span class=\"bp\">*</span> <span class=\"n\">real.sqrt</span> <span class=\"n\">d</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"kd\">by</span> <span class=\"n\">ring</span><span class=\"o\">,</span>\n    <span class=\"n\">simp</span> <span class=\"o\">[</span><span class=\"n\">this</span><span class=\"o\">,</span> <span class=\"n\">real.mul_self_sqrt</span> <span class=\"o\">(</span><span class=\"n\">int.cast_nonneg.mpr</span> <span class=\"n\">h</span><span class=\"o\">)],</span>\n    <span class=\"n\">ring</span><span class=\"o\">,</span> <span class=\"o\">}</span> <span class=\"o\">}</span>\n\n<span class=\"c1\">-- This definition is what each question in exercise 6 is asking. No need to restate it each time</span>\n<span class=\"kd\">abbreviation</span> <span class=\"n\">ex6</span> <span class=\"o\">{</span><span class=\"n\">α</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span> <span class=\"o\">[</span><span class=\"n\">ring</span> <span class=\"n\">α</span><span class=\"o\">]</span> <span class=\"o\">(</span><span class=\"n\">s</span> <span class=\"o\">:</span> <span class=\"n\">set</span> <span class=\"n\">α</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"bp\">∃</span> <span class=\"o\">(</span><span class=\"n\">sr</span> <span class=\"o\">:</span> <span class=\"n\">subring</span> <span class=\"n\">α</span><span class=\"o\">)</span> <span class=\"o\">[</span><span class=\"n\">integral_domain</span> <span class=\"n\">sr</span><span class=\"o\">],</span> <span class=\"n\">s</span> <span class=\"bp\">=</span> <span class=\"n\">sr</span>\n\n<span class=\"kd\">theorem</span> <span class=\"n\">ex6e</span> <span class=\"o\">:</span> <span class=\"n\">ex6</span> <span class=\"o\">{</span><span class=\"n\">x</span> <span class=\"o\">:</span> <span class=\"n\">ℝ</span> <span class=\"bp\">|</span> <span class=\"bp\">∃</span> <span class=\"n\">a</span> <span class=\"n\">b</span> <span class=\"o\">:</span> <span class=\"n\">ℤ</span><span class=\"o\">,</span> <span class=\"n\">x</span> <span class=\"bp\">=</span> <span class=\"n\">a</span> <span class=\"bp\">+</span> <span class=\"n\">b</span> <span class=\"bp\">*</span> <span class=\"o\">(</span><span class=\"mi\">9</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">)</span> <span class=\"bp\">^</span> <span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"bp\">/</span><span class=\"mi\">4</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">)}</span> <span class=\"o\">:=</span>\n<span class=\"kd\">begin</span>\n  <span class=\"n\">refine</span> <span class=\"o\">⟨(</span><span class=\"n\">zsqrtd.to_real</span> <span class=\"o\">(</span><span class=\"k\">show</span> <span class=\"mi\">0</span> <span class=\"bp\">≤</span> <span class=\"o\">(</span><span class=\"mi\">3</span> <span class=\"o\">:</span> <span class=\"n\">ℤ</span><span class=\"o\">),</span> <span class=\"kd\">by</span> <span class=\"n\">norm_num</span><span class=\"o\">))</span><span class=\"bp\">.</span><span class=\"n\">range</span><span class=\"o\">,</span> <span class=\"n\">_</span><span class=\"o\">,</span> <span class=\"n\">_</span><span class=\"o\">⟩,</span>\n  <span class=\"n\">apply_instance</span><span class=\"o\">,</span>\n  <span class=\"n\">ext</span><span class=\"o\">,</span>\n  <span class=\"gr\">sorry</span>\n<span class=\"kd\">end</span>\n</code></pre></div>",
        "id": 221772450,
        "sender_full_name": "Lars Ericson",
        "timestamp": 1609943265
    },
    {
        "content": "<p>Great! You'll want to start by proving <code>lemma important : (9:ℝ) ^ (1/4:ℝ) = real.sqrt 3 := begin sorry end</code>.</p>",
        "id": 221772628,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1609943336
    },
    {
        "content": "<p>Should be easy.  I've done similar ones while golfing over last few days:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kd\">lemma</span> <span class=\"n\">nine_equals_3_times_3</span> <span class=\"o\">:</span> <span class=\"o\">(</span><span class=\"mi\">9</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">)</span> <span class=\"bp\">=</span> <span class=\"o\">(</span><span class=\"mi\">3</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">)</span><span class=\"bp\">*</span><span class=\"o\">(</span><span class=\"mi\">3</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">)</span> <span class=\"o\">:=</span>\n<span class=\"kd\">begin</span>\n  <span class=\"n\">linarith</span><span class=\"o\">,</span>\n<span class=\"kd\">end</span>\n\n<span class=\"kd\">lemma</span> <span class=\"n\">a_squared_equals_a_times_a</span> <span class=\"o\">(</span><span class=\"n\">a</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">a</span><span class=\"bp\">*</span><span class=\"n\">a</span> <span class=\"bp\">=</span> <span class=\"n\">a</span><span class=\"bp\">^</span><span class=\"o\">(</span><span class=\"mi\">2</span><span class=\"o\">:</span><span class=\"n\">ℕ</span><span class=\"o\">)</span> <span class=\"o\">:=</span>\n<span class=\"kd\">begin</span>\n  <span class=\"n\">linarith</span><span class=\"o\">,</span>\n<span class=\"kd\">end</span>\n\n<span class=\"kd\">lemma</span> <span class=\"n\">nine_equals_3_squared</span> <span class=\"o\">:</span>  <span class=\"o\">(</span><span class=\"mi\">9</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">)</span> <span class=\"bp\">=</span> <span class=\"o\">((</span><span class=\"mi\">3</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">)</span> <span class=\"bp\">^</span> <span class=\"o\">(</span><span class=\"mi\">2</span><span class=\"o\">:</span><span class=\"n\">ℕ</span><span class=\"o\">))</span> <span class=\"o\">:=</span>\n<span class=\"kd\">begin</span>\n  <span class=\"k\">have</span> <span class=\"n\">h1</span> <span class=\"o\">:=</span> <span class=\"n\">nine_equals_3_times_3</span><span class=\"o\">,</span>\n  <span class=\"k\">have</span> <span class=\"n\">h2</span> <span class=\"o\">:=</span> <span class=\"n\">a_squared_equals_a_times_a</span> <span class=\"mi\">3</span><span class=\"o\">,</span>\n  <span class=\"n\">rw</span> <span class=\"n\">h2</span> <span class=\"n\">at</span> <span class=\"n\">h1</span><span class=\"o\">,</span>\n  <span class=\"n\">assumption</span><span class=\"o\">,</span>\n<span class=\"kd\">end</span>\n</code></pre></div>",
        "id": 221773493,
        "sender_full_name": "Lars Ericson",
        "timestamp": 1609943768
    },
    {
        "content": "<p><code>a_squared_equals_a_times_a </code>is <a href=\"https://leanprover-community.github.io/mathlib_docs/find/pow_two\">docs#pow_two</a> (or rather, its reverse)</p>",
        "id": 221773731,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1609943902
    },
    {
        "content": "<p>Always try <code>library_search</code> for trivial lemmas like that first :)</p>",
        "id": 221773754,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1609943918
    },
    {
        "content": "<p>How do I prove that 2 = 2?  I need it for the 2nd lemma <code>x_mul_x_pow_y_equals_x_pow_y_plus_y</code>:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kd\">lemma</span> <span class=\"n\">two_equals_two</span> <span class=\"o\">:</span> <span class=\"o\">(</span><span class=\"mi\">2</span><span class=\"o\">:</span><span class=\"n\">ℕ</span><span class=\"o\">)</span> <span class=\"bp\">=</span> <span class=\"o\">(</span><span class=\"mi\">2</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">)</span> <span class=\"o\">:=</span>\n<span class=\"gr\">sorry</span>\n\n<span class=\"kd\">lemma</span> <span class=\"n\">x_mul_x_pow_y_equals_x_pow_y_plus_y</span> <span class=\"o\">(</span><span class=\"n\">x</span> <span class=\"n\">y</span> <span class=\"o\">:</span> <span class=\"n\">ℝ</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"mi\">0</span> <span class=\"bp\">≤</span> <span class=\"n\">x</span> <span class=\"bp\">→</span> <span class=\"o\">(</span><span class=\"n\">x</span> <span class=\"bp\">*</span> <span class=\"n\">x</span><span class=\"o\">)</span><span class=\"bp\">^</span><span class=\"n\">y</span> <span class=\"bp\">=</span> <span class=\"n\">x</span><span class=\"bp\">^</span><span class=\"o\">(</span><span class=\"n\">y</span><span class=\"bp\">+</span><span class=\"n\">y</span><span class=\"o\">)</span> <span class=\"o\">:=</span>\n<span class=\"kd\">begin</span>\n  <span class=\"n\">intro</span> <span class=\"n\">h</span><span class=\"o\">,</span>\n  <span class=\"n\">ring</span><span class=\"o\">,</span>\n  <span class=\"k\">have</span> <span class=\"n\">h1</span> <span class=\"o\">:=</span> <span class=\"n\">real.rpow_mul</span> <span class=\"n\">h</span> <span class=\"o\">(</span><span class=\"mi\">2</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">)</span> <span class=\"n\">y</span><span class=\"o\">,</span>\n  <span class=\"n\">rw</span> <span class=\"n\">h1</span><span class=\"o\">,</span>\n  <span class=\"gr\">sorry</span><span class=\"o\">,</span>\n<span class=\"kd\">end</span>\n</code></pre></div>\n<p>The first lemma won't typecheck in the <code>=</code>, giving:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"n\">type</span> <span class=\"n\">mismatch</span> <span class=\"n\">at</span> <span class=\"n\">application</span>\n  <span class=\"mi\">2</span> <span class=\"bp\">=</span> <span class=\"mi\">2</span>\n<span class=\"n\">term</span>\n  <span class=\"mi\">2</span>\n<span class=\"n\">has</span> <span class=\"n\">type</span>\n  <span class=\"n\">ℝ</span>\n<span class=\"n\">but</span> <span class=\"n\">is</span> <span class=\"n\">expected</span> <span class=\"n\">to</span> <span class=\"k\">have</span> <span class=\"n\">type</span>\n  <span class=\"n\">ℕ</span>\n</code></pre></div>\n<p>The 2nd lemma won't go through because I have a mismatch of <code>2:ℕ</code> versus <code>2:ℝ</code> that I can't get rid of because the <code>2:ℕ</code>  is coming in under the hood without my control.  Here is the goal state on the 2nd lemma:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"mi\">1</span> <span class=\"n\">goal</span>\n<span class=\"n\">xy</span><span class=\"o\">:</span> <span class=\"n\">ℝ</span>\n<span class=\"n\">h</span><span class=\"o\">:</span> <span class=\"mi\">0</span> <span class=\"bp\">≤</span> <span class=\"n\">x</span>\n<span class=\"n\">h1</span><span class=\"o\">:</span> <span class=\"n\">x</span> <span class=\"bp\">^</span> <span class=\"o\">(</span><span class=\"mi\">2</span> <span class=\"bp\">*</span> <span class=\"n\">y</span><span class=\"o\">)</span> <span class=\"bp\">=</span> <span class=\"o\">(</span><span class=\"n\">x</span> <span class=\"bp\">^</span> <span class=\"mi\">2</span><span class=\"o\">)</span> <span class=\"bp\">^</span> <span class=\"n\">y</span>\n<span class=\"bp\">⊢</span> <span class=\"o\">(</span><span class=\"n\">x</span> <span class=\"bp\">^</span> <span class=\"mi\">2</span><span class=\"o\">)</span> <span class=\"bp\">^</span> <span class=\"n\">y</span> <span class=\"bp\">=</span> <span class=\"o\">(</span><span class=\"n\">x</span> <span class=\"bp\">^</span> <span class=\"mi\">2</span><span class=\"o\">)</span> <span class=\"bp\">^</span> <span class=\"n\">y</span>\n<span class=\"n\">All</span> <span class=\"n\">Messages</span> <span class=\"o\">(</span><span class=\"mi\">8</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>I should be done but the above-mentioned widget is telling me that not all 2s are alike and I don't know how to coerce my 2:N to a 2:R.</p>\n<p>This is all in service of getting closer to the goal of proving the <code>important</code> lemma above.   This is where I'm stuck now.</p>",
        "id": 221845088,
        "sender_full_name": "Lars Ericson",
        "timestamp": 1609981331
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kd\">lemma</span> <span class=\"n\">two_equals_two</span> <span class=\"o\">:</span> <span class=\"o\">(</span><span class=\"mi\">2</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">)</span> <span class=\"bp\">=</span> <span class=\"o\">(</span><span class=\"mi\">2</span><span class=\"o\">:</span><span class=\"n\">ℕ</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"kd\">by</span> <span class=\"n\">norm_num</span>\n</code></pre></div>",
        "id": 221845360,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1609981601
    },
    {
        "content": "<p>Not that the real has to be on the LHS for the casting to work properly.</p>",
        "id": 221845375,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1609981615
    },
    {
        "content": "<p>You might like <a href=\"https://leanprover-community.github.io/mathlib_docs/find/mul_rpow\">docs#mul_rpow</a></p>",
        "id": 221845497,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1609981716
    },
    {
        "content": "<p>I'll try going that way.  I'm using the other direction <code>rpow_mul</code>. The <code>two_equals_two</code> lemma doesn't work as a rewrite rule.  I can't get this lemma to close, the goal definitely has a <code>2:ℕ</code> in it but <code>rw ← two_equals_two</code> won't bind:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kn\">import</span> <span class=\"n\">data.zsqrtd.basic</span>\n<span class=\"kn\">import</span> <span class=\"n\">ring_theory.subring</span>\n<span class=\"kn\">import</span> <span class=\"n\">data.real.basic</span>\n<span class=\"kn\">import</span> <span class=\"n\">analysis.special_functions.pow</span>\n\n<span class=\"kd\">lemma</span> <span class=\"n\">two_equals_two</span> <span class=\"o\">:</span> <span class=\"o\">(</span><span class=\"mi\">2</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">)</span> <span class=\"bp\">=</span> <span class=\"o\">(</span><span class=\"mi\">2</span><span class=\"o\">:</span><span class=\"n\">ℕ</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"kd\">by</span> <span class=\"n\">norm_num</span>\n\n<span class=\"kd\">lemma</span> <span class=\"n\">x_mul_x_pow_y_equals_x_pow_y_plus_y</span> <span class=\"o\">(</span><span class=\"n\">x</span> <span class=\"n\">y</span> <span class=\"o\">:</span> <span class=\"n\">ℝ</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"mi\">0</span> <span class=\"bp\">≤</span> <span class=\"n\">x</span> <span class=\"bp\">→</span> <span class=\"o\">(</span><span class=\"n\">x</span> <span class=\"bp\">*</span> <span class=\"n\">x</span><span class=\"o\">)</span><span class=\"bp\">^</span><span class=\"n\">y</span> <span class=\"bp\">=</span> <span class=\"n\">x</span><span class=\"bp\">^</span><span class=\"o\">(</span><span class=\"n\">y</span><span class=\"bp\">+</span><span class=\"n\">y</span><span class=\"o\">)</span> <span class=\"o\">:=</span>\n<span class=\"kd\">begin</span>\n  <span class=\"n\">intro</span> <span class=\"n\">h</span><span class=\"o\">,</span>\n  <span class=\"n\">ring</span><span class=\"o\">,</span>\n  <span class=\"k\">have</span> <span class=\"n\">h1</span> <span class=\"o\">:=</span> <span class=\"n\">real.rpow_mul</span> <span class=\"n\">h</span> <span class=\"o\">(</span><span class=\"mi\">2</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">)</span> <span class=\"n\">y</span><span class=\"o\">,</span>\n  <span class=\"k\">have</span> <span class=\"n\">h2</span> <span class=\"o\">:=</span> <span class=\"n\">eq.symm</span> <span class=\"n\">h1</span><span class=\"o\">,</span>\n  <span class=\"n\">conv</span>\n  <span class=\"kd\">begin</span>\n    <span class=\"n\">to_lhs</span><span class=\"o\">,</span>\n    <span class=\"n\">rw</span> <span class=\"bp\">←</span> <span class=\"n\">two_equals_two</span><span class=\"o\">,</span> <span class=\"c1\">-- FAIL</span>\n  <span class=\"kd\">end</span><span class=\"o\">,</span>\n\n<span class=\"kd\">end</span>\n</code></pre></div>",
        "id": 221846264,
        "sender_full_name": "Lars Ericson",
        "timestamp": 1609982516
    },
    {
        "content": "<p>Your lemma isn't true is <code>x = 0</code> and <code>y = 0</code></p>",
        "id": 221846502,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1609982712
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kn\">import</span> <span class=\"n\">data.zsqrtd.basic</span>\n<span class=\"kn\">import</span> <span class=\"n\">ring_theory.subring</span>\n<span class=\"kn\">import</span> <span class=\"n\">data.real.basic</span>\n<span class=\"kn\">import</span> <span class=\"n\">analysis.special_functions.pow</span>\n\n<span class=\"kd\">lemma</span> <span class=\"n\">two_equals_two</span> <span class=\"o\">:</span> <span class=\"o\">(</span><span class=\"mi\">2</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">)</span> <span class=\"bp\">=</span> <span class=\"o\">(</span><span class=\"mi\">2</span><span class=\"o\">:</span><span class=\"n\">ℕ</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"kd\">by</span> <span class=\"n\">norm_num</span>\n\n<span class=\"kd\">lemma</span> <span class=\"n\">x_mul_x_pow_y_equals_x_pow_y_plus_y</span> <span class=\"o\">(</span><span class=\"n\">x</span> <span class=\"n\">y</span> <span class=\"o\">:</span> <span class=\"n\">ℝ</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"mi\">0</span> <span class=\"bp\">≤</span> <span class=\"n\">x</span> <span class=\"bp\">→</span> <span class=\"mi\">0</span> <span class=\"bp\">&lt;</span> <span class=\"n\">y</span> <span class=\"bp\">→</span> <span class=\"o\">(</span><span class=\"n\">x</span> <span class=\"bp\">*</span> <span class=\"n\">x</span><span class=\"o\">)</span><span class=\"bp\">^</span><span class=\"n\">y</span> <span class=\"bp\">=</span> <span class=\"n\">x</span><span class=\"bp\">^</span><span class=\"o\">(</span><span class=\"n\">y</span><span class=\"bp\">+</span><span class=\"n\">y</span><span class=\"o\">)</span> <span class=\"o\">:=</span>\n<span class=\"kd\">begin</span>\n  <span class=\"n\">intros</span> <span class=\"n\">hx</span> <span class=\"n\">hy</span><span class=\"o\">,</span>\n  <span class=\"n\">rw</span> <span class=\"n\">real.mul_rpow</span> <span class=\"n\">hx</span> <span class=\"n\">hx</span><span class=\"o\">,</span>\n  <span class=\"n\">rcases</span> <span class=\"n\">eq_or_lt_of_le</span> <span class=\"n\">hx</span> <span class=\"k\">with</span> <span class=\"n\">rfl</span><span class=\"bp\">|</span><span class=\"n\">hx</span><span class=\"o\">,</span>\n  <span class=\"o\">{</span> <span class=\"n\">rw</span> <span class=\"n\">real.zero_rpow</span> <span class=\"o\">(</span><span class=\"n\">ne_of_gt</span> <span class=\"n\">hy</span><span class=\"o\">),</span>\n    <span class=\"n\">rw</span> <span class=\"n\">real.zero_rpow</span> <span class=\"o\">(</span><span class=\"n\">ne_of_gt</span> <span class=\"o\">(</span><span class=\"n\">add_pos</span> <span class=\"n\">hy</span> <span class=\"n\">hy</span><span class=\"o\">)),</span>\n    <span class=\"n\">rw</span> <span class=\"n\">zero_mul</span> <span class=\"o\">},</span>\n  <span class=\"o\">{</span> <span class=\"n\">rw</span> <span class=\"n\">real.rpow_add</span> <span class=\"n\">hx</span> <span class=\"o\">}</span>\n<span class=\"kd\">end</span>\n</code></pre></div>",
        "id": 221846760,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1609982912
    },
    {
        "content": "<p>As you can see, no knowledge of some equality of cast nats needed.</p>",
        "id": 221847140,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1609983332
    },
    {
        "content": "<p>Thanks I got there the other way but with <code>x &lt; 0</code>, and no 2's using your <code>rpow_add</code> suggestion:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kn\">import</span> <span class=\"n\">data.zsqrtd.basic</span>\n<span class=\"kn\">import</span> <span class=\"n\">ring_theory.subring</span>\n<span class=\"kn\">import</span> <span class=\"n\">data.real.basic</span>\n<span class=\"kn\">import</span> <span class=\"n\">analysis.special_functions.pow</span>\n\n<span class=\"kd\">lemma</span> <span class=\"n\">le_if_leq</span> <span class=\"o\">(</span><span class=\"n\">x</span> <span class=\"o\">:</span> <span class=\"n\">ℝ</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"mi\">0</span> <span class=\"bp\">&lt;</span> <span class=\"n\">x</span> <span class=\"bp\">→</span> <span class=\"mi\">0</span> <span class=\"bp\">≤</span> <span class=\"n\">x</span> <span class=\"o\">:=</span>\n<span class=\"kd\">begin</span>\n  <span class=\"n\">intro</span> <span class=\"n\">h</span><span class=\"o\">,</span>\n  <span class=\"n\">linarith</span><span class=\"o\">,</span>\n<span class=\"kd\">end</span>\n\n<span class=\"kd\">lemma</span> <span class=\"n\">x_mul_x_pow_y_equals_x_pow_y_plus_y</span> <span class=\"o\">(</span><span class=\"n\">x</span> <span class=\"n\">y</span> <span class=\"o\">:</span> <span class=\"n\">ℝ</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"mi\">0</span> <span class=\"bp\">&lt;</span> <span class=\"n\">x</span> <span class=\"bp\">→</span> <span class=\"o\">(</span><span class=\"n\">x</span> <span class=\"bp\">*</span> <span class=\"n\">x</span><span class=\"o\">)</span><span class=\"bp\">^</span><span class=\"n\">y</span> <span class=\"bp\">=</span> <span class=\"n\">x</span><span class=\"bp\">^</span><span class=\"o\">(</span><span class=\"n\">y</span><span class=\"bp\">+</span><span class=\"n\">y</span><span class=\"o\">)</span> <span class=\"o\">:=</span>\n<span class=\"kd\">begin</span>\n  <span class=\"n\">intro</span> <span class=\"n\">h</span><span class=\"o\">,</span>\n  <span class=\"k\">have</span> <span class=\"n\">h1</span> <span class=\"o\">:=</span> <span class=\"n\">le_if_leq</span> <span class=\"n\">x</span> <span class=\"n\">h</span><span class=\"o\">,</span>\n  <span class=\"k\">have</span> <span class=\"n\">h2</span> <span class=\"o\">:=</span> <span class=\"bp\">@</span><span class=\"n\">real.mul_rpow</span> <span class=\"n\">x</span> <span class=\"n\">x</span> <span class=\"n\">y</span> <span class=\"n\">h1</span> <span class=\"n\">h1</span><span class=\"o\">,</span>\n  <span class=\"n\">rw</span> <span class=\"n\">h2</span><span class=\"o\">,</span>\n  <span class=\"k\">have</span> <span class=\"n\">h3</span> <span class=\"o\">:=</span> <span class=\"n\">real.rpow_add</span> <span class=\"n\">h</span> <span class=\"n\">y</span> <span class=\"n\">y</span><span class=\"o\">,</span>\n  <span class=\"n\">exact</span> <span class=\"n\">eq.symm</span> <span class=\"n\">h3</span><span class=\"o\">,</span>\n<span class=\"kd\">end</span>\n</code></pre></div>",
        "id": 221847498,
        "sender_full_name": "Lars Ericson",
        "timestamp": 1609983678
    },
    {
        "content": "<p>The first one is <code>le_of_lt</code></p>",
        "id": 221847700,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1609983868
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"308899\">@Yakov Pechersky</span> thanks for the help.  <span class=\"user-mention\" data-user-id=\"310045\">@Eric Wieser</span> I have now proved <code>lemma important : (9:ℝ) ^ (1/4:ℝ) = real.sqrt 3</code> as you suggested, in only 160 lines:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kn\">import</span> <span class=\"n\">data.zsqrtd.basic</span>\n<span class=\"kn\">import</span> <span class=\"n\">ring_theory.subring</span>\n<span class=\"kn\">import</span> <span class=\"n\">data.real.basic</span>\n<span class=\"kn\">import</span> <span class=\"n\">analysis.special_functions.pow</span>\n\n<span class=\"c1\">-- Eric Wieser</span>\n<span class=\"sd\">/-- The image of `zsqrtd` in `ℝ`.  -/</span>\n<span class=\"kd\">@[simps]</span>\n<span class=\"kd\">noncomputable</span> <span class=\"kd\">def</span> <span class=\"n\">zsqrtd.to_real</span> <span class=\"o\">{</span><span class=\"n\">d</span> <span class=\"o\">:</span> <span class=\"n\">ℤ</span> <span class=\"o\">}</span> <span class=\"o\">(</span><span class=\"n\">h</span> <span class=\"o\">:</span> <span class=\"mi\">0</span> <span class=\"bp\">≤</span> <span class=\"n\">d</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">ℤ</span><span class=\"bp\">√</span><span class=\"n\">d</span> <span class=\"bp\">→+*</span> <span class=\"n\">ℝ</span> <span class=\"o\">:=</span> <span class=\"o\">{</span>\n  <span class=\"n\">to_fun</span> <span class=\"o\">:=</span> <span class=\"bp\">λ</span> <span class=\"n\">a</span><span class=\"o\">,</span> <span class=\"n\">a.1</span> <span class=\"bp\">+</span> <span class=\"n\">a.2</span><span class=\"bp\">*</span><span class=\"n\">real.sqrt</span> <span class=\"n\">d</span><span class=\"o\">,</span>\n  <span class=\"n\">map_zero'</span> <span class=\"o\">:=</span> <span class=\"kd\">by</span> <span class=\"n\">simp</span><span class=\"o\">,</span>\n  <span class=\"n\">map_add'</span> <span class=\"o\">:=</span> <span class=\"bp\">λ</span> <span class=\"n\">a</span> <span class=\"n\">b</span><span class=\"o\">,</span> <span class=\"kd\">by</span> <span class=\"o\">{</span> <span class=\"n\">simp</span><span class=\"o\">,</span> <span class=\"n\">ring</span><span class=\"o\">,</span> <span class=\"o\">},</span>\n  <span class=\"n\">map_one'</span> <span class=\"o\">:=</span> <span class=\"kd\">by</span> <span class=\"n\">simp</span><span class=\"o\">,</span>\n  <span class=\"n\">map_mul'</span> <span class=\"o\">:=</span> <span class=\"bp\">λ</span> <span class=\"n\">a</span> <span class=\"n\">b</span><span class=\"o\">,</span> <span class=\"kd\">by</span> <span class=\"o\">{</span>\n    <span class=\"k\">have</span> <span class=\"o\">:</span> <span class=\"o\">(</span><span class=\"bp\">↑</span><span class=\"n\">a.re</span> <span class=\"bp\">+</span> <span class=\"bp\">↑</span><span class=\"n\">a.im</span> <span class=\"bp\">*</span> <span class=\"n\">real.sqrt</span> <span class=\"n\">d</span><span class=\"o\">)</span> <span class=\"bp\">*</span> <span class=\"o\">(</span><span class=\"bp\">↑</span><span class=\"n\">b.re</span> <span class=\"bp\">+</span> <span class=\"bp\">↑</span><span class=\"n\">b.im</span> <span class=\"bp\">*</span> <span class=\"n\">real.sqrt</span> <span class=\"n\">d</span><span class=\"o\">)</span> <span class=\"bp\">=</span>\n             <span class=\"bp\">↑</span><span class=\"n\">a.re</span> <span class=\"bp\">*</span> <span class=\"bp\">↑</span><span class=\"n\">b.re</span> <span class=\"bp\">+</span> <span class=\"o\">(</span><span class=\"bp\">↑</span><span class=\"n\">a.re</span> <span class=\"bp\">*</span> <span class=\"bp\">↑</span><span class=\"n\">b.im</span> <span class=\"bp\">+</span> <span class=\"bp\">↑</span><span class=\"n\">a.im</span> <span class=\"bp\">*</span> <span class=\"bp\">↑</span><span class=\"n\">b.re</span><span class=\"o\">)</span> <span class=\"bp\">*</span> <span class=\"n\">real.sqrt</span> <span class=\"n\">d</span>\n                           <span class=\"bp\">+</span> <span class=\"bp\">↑</span><span class=\"n\">a.im</span> <span class=\"bp\">*</span> <span class=\"bp\">↑</span><span class=\"n\">b.im</span> <span class=\"bp\">*</span> <span class=\"o\">(</span><span class=\"n\">real.sqrt</span> <span class=\"n\">d</span> <span class=\"bp\">*</span> <span class=\"n\">real.sqrt</span> <span class=\"n\">d</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"kd\">by</span> <span class=\"n\">ring</span><span class=\"o\">,</span>\n    <span class=\"n\">simp</span> <span class=\"o\">[</span><span class=\"n\">this</span><span class=\"o\">,</span> <span class=\"n\">real.mul_self_sqrt</span> <span class=\"o\">(</span><span class=\"n\">int.cast_nonneg.mpr</span> <span class=\"n\">h</span><span class=\"o\">)],</span>\n    <span class=\"n\">ring</span><span class=\"o\">,</span> <span class=\"o\">}</span> <span class=\"o\">}</span>\n\n<span class=\"c1\">-- This definition is what each question in exercise 6 is asking. No need to restate it each time</span>\n<span class=\"kd\">abbreviation</span> <span class=\"n\">ex6</span> <span class=\"o\">{</span><span class=\"n\">α</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span> <span class=\"o\">[</span><span class=\"n\">ring</span> <span class=\"n\">α</span><span class=\"o\">]</span> <span class=\"o\">(</span><span class=\"n\">s</span> <span class=\"o\">:</span> <span class=\"n\">set</span> <span class=\"n\">α</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"bp\">∃</span> <span class=\"o\">(</span><span class=\"n\">sr</span> <span class=\"o\">:</span> <span class=\"n\">subring</span> <span class=\"n\">α</span><span class=\"o\">)</span> <span class=\"o\">[</span><span class=\"n\">integral_domain</span> <span class=\"n\">sr</span><span class=\"o\">],</span> <span class=\"n\">s</span> <span class=\"bp\">=</span> <span class=\"n\">sr</span>\n\n<span class=\"kd\">lemma</span> <span class=\"n\">nine_equals_3_times_3</span> <span class=\"o\">:</span> <span class=\"o\">(</span><span class=\"mi\">9</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">)</span><span class=\"bp\">=</span><span class=\"o\">(</span><span class=\"mi\">3</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">)</span><span class=\"bp\">*</span><span class=\"o\">(</span><span class=\"mi\">3</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">)</span> <span class=\"o\">:=</span>\n<span class=\"kd\">begin</span>\n  <span class=\"n\">linarith</span><span class=\"o\">,</span>\n<span class=\"kd\">end</span>\n\n<span class=\"kd\">lemma</span> <span class=\"n\">three_is_gt_0</span> <span class=\"o\">:</span> <span class=\"o\">(</span><span class=\"mi\">0</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">)</span> <span class=\"bp\">&lt;</span> <span class=\"o\">(</span><span class=\"mi\">3</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">)</span> <span class=\"o\">:=</span>\n<span class=\"kd\">begin</span>\n  <span class=\"n\">linarith</span><span class=\"o\">,</span>\n<span class=\"kd\">end</span>\n\n<span class=\"kd\">lemma</span> <span class=\"n\">three_is_gte_0</span> <span class=\"o\">:</span> <span class=\"o\">(</span><span class=\"mi\">0</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">)</span> <span class=\"bp\">≤</span> <span class=\"o\">(</span><span class=\"mi\">3</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">)</span> <span class=\"o\">:=</span>\n<span class=\"kd\">begin</span>\n  <span class=\"n\">linarith</span><span class=\"o\">,</span>\n<span class=\"kd\">end</span>\n\n<span class=\"kd\">lemma</span> <span class=\"n\">sqrt_of_9_is_3</span> <span class=\"o\">:</span> <span class=\"o\">(</span><span class=\"mi\">3</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">)</span> <span class=\"bp\">=</span> <span class=\"o\">(</span><span class=\"n\">real.sqrt</span> <span class=\"o\">(</span><span class=\"mi\">9</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">))</span> <span class=\"o\">:=</span>\n<span class=\"kd\">begin</span>\n  <span class=\"k\">have</span> <span class=\"n\">h1</span> <span class=\"o\">:=</span> <span class=\"n\">nine_equals_3_times_3</span><span class=\"o\">,</span>\n  <span class=\"n\">rw</span> <span class=\"n\">h1</span><span class=\"o\">,</span>\n  <span class=\"k\">have</span> <span class=\"n\">h2</span> <span class=\"o\">:=</span> <span class=\"n\">three_is_gte_0</span><span class=\"o\">,</span>\n  <span class=\"k\">have</span> <span class=\"n\">h3</span> <span class=\"o\">:=</span> <span class=\"n\">real.sqrt_mul_self</span> <span class=\"n\">h2</span><span class=\"o\">,</span>\n  <span class=\"n\">rw</span> <span class=\"bp\">←</span> <span class=\"n\">h1</span> <span class=\"n\">at</span> <span class=\"n\">h3</span><span class=\"o\">,</span>\n  <span class=\"n\">rw</span> <span class=\"bp\">←</span> <span class=\"n\">h1</span><span class=\"o\">,</span>\n  <span class=\"n\">exact</span> <span class=\"n\">eq.symm</span> <span class=\"n\">h3</span><span class=\"o\">,</span>\n<span class=\"kd\">end</span>\n\n<span class=\"kd\">lemma</span> <span class=\"n\">half_plus_half_equals_1</span><span class=\"o\">:</span> <span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"bp\">/</span><span class=\"mi\">2</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">)</span><span class=\"bp\">+</span><span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"bp\">/</span><span class=\"mi\">2</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">)</span><span class=\"bp\">=</span><span class=\"mi\">1</span> <span class=\"o\">:=</span>\n<span class=\"kd\">begin</span>\n  <span class=\"n\">linarith</span><span class=\"o\">,</span>\n<span class=\"kd\">end</span>\n\n<span class=\"kd\">lemma</span> <span class=\"n\">x_equals_sqrtx_times_sqrtx</span> <span class=\"o\">(</span><span class=\"n\">x</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">):</span> <span class=\"mi\">0</span> <span class=\"bp\">&lt;</span> <span class=\"n\">x</span> <span class=\"bp\">→</span> <span class=\"n\">x</span> <span class=\"bp\">=</span> <span class=\"n\">x</span><span class=\"bp\">^</span><span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"bp\">/</span><span class=\"mi\">2</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">)</span> <span class=\"bp\">*</span> <span class=\"n\">x</span><span class=\"bp\">^</span><span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"bp\">/</span><span class=\"mi\">2</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">)</span> <span class=\"o\">:=</span>\n<span class=\"kd\">begin</span>\n  <span class=\"n\">intro</span> <span class=\"n\">h1</span><span class=\"o\">,</span>\n  <span class=\"k\">have</span> <span class=\"n\">h2</span> <span class=\"o\">:=</span> <span class=\"n\">real.rpow_add</span> <span class=\"n\">h1</span><span class=\"o\">,</span>\n  <span class=\"k\">have</span> <span class=\"n\">h3</span> <span class=\"o\">:=</span> <span class=\"n\">h2</span> <span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"bp\">/</span><span class=\"mi\">2</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"bp\">/</span><span class=\"mi\">2</span><span class=\"o\">),</span>\n  <span class=\"k\">have</span> <span class=\"n\">h4</span> <span class=\"o\">:=</span> <span class=\"n\">half_plus_half_equals_1</span><span class=\"o\">,</span>\n  <span class=\"n\">rw</span> <span class=\"n\">h4</span> <span class=\"n\">at</span> <span class=\"n\">h3</span><span class=\"o\">,</span>\n  <span class=\"k\">have</span> <span class=\"n\">h5</span> <span class=\"o\">:=</span> <span class=\"n\">real.rpow_one</span> <span class=\"n\">x</span><span class=\"o\">,</span>\n  <span class=\"n\">rw</span> <span class=\"n\">h5</span> <span class=\"n\">at</span> <span class=\"n\">h3</span><span class=\"o\">,</span>\n  <span class=\"n\">exact</span> <span class=\"n\">h3</span><span class=\"o\">,</span>\n<span class=\"kd\">end</span>\n\n<span class=\"kd\">lemma</span> <span class=\"n\">x_is_0</span> <span class=\"o\">(</span><span class=\"n\">x</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">x</span> <span class=\"bp\">≥</span> <span class=\"mi\">0</span> <span class=\"bp\">→</span> <span class=\"bp\">¬</span><span class=\"o\">(</span><span class=\"mi\">0</span> <span class=\"bp\">&lt;</span> <span class=\"n\">x</span><span class=\"o\">)</span> <span class=\"bp\">→</span> <span class=\"n\">x</span> <span class=\"bp\">=</span> <span class=\"mi\">0</span> <span class=\"o\">:=</span>\n<span class=\"kd\">begin</span>\n  <span class=\"n\">intro</span> <span class=\"n\">h1</span><span class=\"o\">,</span>\n  <span class=\"n\">intro</span> <span class=\"n\">h2</span><span class=\"o\">,</span>\n  <span class=\"n\">linarith</span><span class=\"o\">,</span>\n<span class=\"kd\">end</span>\n\n<span class=\"kd\">lemma</span> <span class=\"n\">half_ne_0</span> <span class=\"o\">:</span> <span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"bp\">/</span><span class=\"mi\">2</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">)</span>  <span class=\"bp\">≠</span> <span class=\"o\">(</span><span class=\"mi\">0</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">)</span> <span class=\"o\">:=</span>\n<span class=\"kd\">begin</span>\n  <span class=\"n\">linarith</span><span class=\"o\">,</span>\n<span class=\"kd\">end</span>\n\n<span class=\"kd\">lemma</span> <span class=\"n\">zero_le_0</span> <span class=\"o\">:</span> <span class=\"o\">(</span><span class=\"mi\">0</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">)</span> <span class=\"bp\">≤</span> <span class=\"o\">(</span><span class=\"mi\">0</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">)</span> <span class=\"o\">:=</span>\n<span class=\"kd\">begin</span>\n  <span class=\"n\">linarith</span><span class=\"o\">,</span>\n<span class=\"kd\">end</span>\n\n<span class=\"kd\">lemma</span> <span class=\"n\">sqrt_0_equals_0</span> <span class=\"o\">:</span> <span class=\"n\">real.sqrt</span> <span class=\"mi\">0</span> <span class=\"bp\">=</span> <span class=\"mi\">0</span> <span class=\"o\">:=</span>\n<span class=\"kd\">begin</span>\n  <span class=\"k\">have</span> <span class=\"n\">h1</span> <span class=\"o\">:=</span> <span class=\"n\">zero_le_0</span><span class=\"o\">,</span>\n  <span class=\"n\">exact</span> <span class=\"n\">real.sqrt_eq_zero_of_nonpos</span> <span class=\"n\">h1</span><span class=\"o\">,</span>\n<span class=\"kd\">end</span>\n\n<span class=\"kd\">lemma</span> <span class=\"n\">x_gt_0_implies_sqrt_x_gt_0</span> <span class=\"o\">(</span><span class=\"n\">x</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">):</span> <span class=\"n\">x</span> <span class=\"bp\">≥</span> <span class=\"mi\">0</span> <span class=\"bp\">→</span> <span class=\"n\">x</span><span class=\"bp\">^</span><span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"bp\">/</span><span class=\"mi\">2</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">)</span> <span class=\"bp\">≥</span> <span class=\"mi\">0</span> <span class=\"o\">:=</span>\n<span class=\"kd\">begin</span>\n  <span class=\"n\">intro</span> <span class=\"n\">h1</span><span class=\"o\">,</span>\n  <span class=\"n\">exact</span> <span class=\"n\">real.rpow_nonneg_of_nonneg</span> <span class=\"n\">h1</span> <span class=\"o\">(</span><span class=\"mi\">1</span> <span class=\"bp\">/</span> <span class=\"mi\">2</span><span class=\"o\">),</span>\n<span class=\"kd\">end</span>\n\n<span class=\"kd\">lemma</span> <span class=\"n\">sqrt_x_equals_sqrt_x</span> <span class=\"o\">(</span><span class=\"n\">x</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">x</span> <span class=\"bp\">≥</span> <span class=\"mi\">0</span> <span class=\"bp\">→</span> <span class=\"n\">x</span><span class=\"bp\">^</span><span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"bp\">/</span><span class=\"mi\">2</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">)</span> <span class=\"bp\">=</span> <span class=\"n\">real.sqrt</span> <span class=\"n\">x</span> <span class=\"o\">:=</span>\n<span class=\"kd\">begin</span>\n  <span class=\"n\">intro</span> <span class=\"n\">h</span><span class=\"o\">,</span>\n  <span class=\"k\">have</span> <span class=\"n\">h1</span> <span class=\"o\">:=</span> <span class=\"n\">x_equals_sqrtx_times_sqrtx</span> <span class=\"n\">x</span><span class=\"o\">,</span>\n  <span class=\"n\">by_cases</span> <span class=\"n\">h2</span> <span class=\"o\">:</span> <span class=\"mi\">0</span> <span class=\"bp\">&lt;</span> <span class=\"n\">x</span><span class=\"o\">,</span>\n  <span class=\"o\">{</span>\n    <span class=\"k\">have</span> <span class=\"n\">h3</span> <span class=\"o\">:=</span> <span class=\"n\">h1</span> <span class=\"n\">h2</span><span class=\"o\">,</span>\n    <span class=\"n\">conv</span>\n    <span class=\"kd\">begin</span>\n      <span class=\"n\">to_rhs</span><span class=\"o\">,</span>\n      <span class=\"n\">rw</span> <span class=\"n\">h3</span><span class=\"o\">,</span>\n    <span class=\"kd\">end</span><span class=\"o\">,</span>\n    <span class=\"k\">have</span> <span class=\"n\">h5</span> <span class=\"o\">:=</span> <span class=\"n\">x_gt_0_implies_sqrt_x_gt_0</span> <span class=\"n\">x</span><span class=\"o\">,</span>\n    <span class=\"k\">have</span> <span class=\"n\">h6</span> <span class=\"o\">:=</span> <span class=\"n\">h5</span> <span class=\"n\">h</span><span class=\"o\">,</span>\n    <span class=\"k\">have</span> <span class=\"n\">h4</span> <span class=\"o\">:=</span> <span class=\"n\">real.sqrt_mul_self</span> <span class=\"n\">h6</span><span class=\"o\">,</span>\n    <span class=\"n\">exact</span> <span class=\"n\">eq.symm</span> <span class=\"n\">h4</span><span class=\"o\">,</span>\n  <span class=\"o\">},</span>\n  <span class=\"o\">{</span>\n    <span class=\"k\">have</span> <span class=\"n\">h3</span> <span class=\"o\">:=</span> <span class=\"n\">x_is_0</span> <span class=\"n\">x</span><span class=\"o\">,</span>\n    <span class=\"k\">have</span> <span class=\"n\">h4</span> <span class=\"o\">:=</span> <span class=\"n\">h3</span> <span class=\"n\">h</span><span class=\"o\">,</span>\n    <span class=\"k\">have</span> <span class=\"n\">h5</span> <span class=\"o\">:=</span> <span class=\"n\">h4</span> <span class=\"n\">h2</span><span class=\"o\">,</span>\n    <span class=\"n\">rw</span> <span class=\"n\">h5</span><span class=\"o\">,</span>\n    <span class=\"k\">have</span> <span class=\"n\">h6</span> <span class=\"o\">:=</span> <span class=\"bp\">@</span><span class=\"n\">real.zero_rpow</span> <span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"bp\">/</span><span class=\"mi\">2</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">),</span>\n    <span class=\"k\">have</span> <span class=\"n\">h7</span> <span class=\"o\">:=</span> <span class=\"n\">half_ne_0</span><span class=\"o\">,</span>\n    <span class=\"k\">have</span> <span class=\"n\">h8</span> <span class=\"o\">:=</span> <span class=\"n\">h6</span> <span class=\"n\">h7</span><span class=\"o\">,</span>\n    <span class=\"n\">rw</span> <span class=\"n\">h8</span><span class=\"o\">,</span>\n    <span class=\"k\">have</span> <span class=\"n\">h9</span> <span class=\"o\">:=</span> <span class=\"n\">sqrt_0_equals_0</span><span class=\"o\">,</span>\n    <span class=\"n\">exact</span> <span class=\"n\">eq.symm</span> <span class=\"n\">h9</span><span class=\"o\">,</span>\n  <span class=\"o\">}</span>\n<span class=\"kd\">end</span>\n\n<span class=\"kd\">lemma</span> <span class=\"n\">x_mul_x_pow_y_equals_x_pow_y_plus_y</span> <span class=\"o\">(</span><span class=\"n\">x</span> <span class=\"n\">y</span> <span class=\"o\">:</span> <span class=\"n\">ℝ</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"mi\">0</span> <span class=\"bp\">&lt;</span> <span class=\"n\">x</span> <span class=\"bp\">→</span> <span class=\"o\">(</span><span class=\"n\">x</span> <span class=\"bp\">*</span> <span class=\"n\">x</span><span class=\"o\">)</span><span class=\"bp\">^</span><span class=\"n\">y</span> <span class=\"bp\">=</span> <span class=\"n\">x</span><span class=\"bp\">^</span><span class=\"o\">(</span><span class=\"n\">y</span><span class=\"bp\">+</span><span class=\"n\">y</span><span class=\"o\">)</span> <span class=\"o\">:=</span>\n<span class=\"kd\">begin</span>\n  <span class=\"n\">intro</span> <span class=\"n\">h</span><span class=\"o\">,</span>\n  <span class=\"k\">have</span> <span class=\"n\">h1</span> <span class=\"o\">:=</span> <span class=\"n\">le_of_lt</span> <span class=\"n\">h</span><span class=\"o\">,</span>\n  <span class=\"k\">have</span> <span class=\"n\">h2</span> <span class=\"o\">:=</span> <span class=\"bp\">@</span><span class=\"n\">real.mul_rpow</span> <span class=\"n\">x</span> <span class=\"n\">x</span> <span class=\"n\">y</span> <span class=\"n\">h1</span> <span class=\"n\">h1</span><span class=\"o\">,</span>\n  <span class=\"n\">rw</span> <span class=\"n\">h2</span><span class=\"o\">,</span>\n  <span class=\"k\">have</span> <span class=\"n\">h3</span> <span class=\"o\">:=</span> <span class=\"n\">real.rpow_add</span> <span class=\"n\">h</span> <span class=\"n\">y</span> <span class=\"n\">y</span><span class=\"o\">,</span>\n  <span class=\"n\">exact</span> <span class=\"n\">eq.symm</span> <span class=\"n\">h3</span><span class=\"o\">,</span>\n<span class=\"kd\">end</span>\n\n<span class=\"kd\">lemma</span> <span class=\"n\">fourth_root_of_9_equals_sqrt_sqrt</span> <span class=\"o\">:</span> <span class=\"o\">(</span><span class=\"mi\">9</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">)</span> <span class=\"bp\">^</span> <span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"bp\">/</span><span class=\"mi\">4</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">)</span> <span class=\"bp\">=</span> <span class=\"n\">real.sqrt</span> <span class=\"o\">(</span><span class=\"n\">real.sqrt</span> <span class=\"o\">(</span><span class=\"mi\">9</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">))</span> <span class=\"o\">:=</span>\n<span class=\"kd\">begin</span>\n  <span class=\"k\">have</span> <span class=\"n\">h1</span> <span class=\"o\">:=</span> <span class=\"n\">nine_equals_3_times_3</span><span class=\"o\">,</span>\n  <span class=\"k\">have</span> <span class=\"n\">h2</span> <span class=\"o\">:=</span> <span class=\"n\">three_is_gt_0</span><span class=\"o\">,</span>\n  <span class=\"k\">have</span> <span class=\"n\">h7</span> <span class=\"o\">:=</span> <span class=\"n\">three_is_gte_0</span><span class=\"o\">,</span>\n  <span class=\"k\">have</span> <span class=\"n\">h3</span> <span class=\"o\">:=</span> <span class=\"n\">sqrt_of_9_is_3</span><span class=\"o\">,</span>\n  <span class=\"n\">rw</span> <span class=\"bp\">←</span> <span class=\"n\">h3</span><span class=\"o\">,</span>\n  <span class=\"n\">rw</span> <span class=\"n\">h1</span><span class=\"o\">,</span>\n  <span class=\"k\">have</span> <span class=\"n\">h4</span> <span class=\"o\">:=</span> <span class=\"n\">sqrt_x_equals_sqrt_x</span> <span class=\"o\">(</span><span class=\"mi\">3</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">),</span>\n  <span class=\"k\">have</span> <span class=\"n\">h5</span> <span class=\"o\">:=</span> <span class=\"n\">h4</span> <span class=\"n\">h7</span><span class=\"o\">,</span>\n  <span class=\"n\">rw</span> <span class=\"bp\">←</span> <span class=\"n\">h5</span><span class=\"o\">,</span>\n  <span class=\"k\">have</span> <span class=\"n\">h6</span> <span class=\"o\">:=</span> <span class=\"n\">x_mul_x_pow_y_equals_x_pow_y_plus_y</span> <span class=\"mi\">3</span> <span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"bp\">/</span><span class=\"mi\">4</span><span class=\"o\">),</span>\n  <span class=\"k\">have</span> <span class=\"n\">h8</span> <span class=\"o\">:=</span> <span class=\"n\">h6</span> <span class=\"n\">h2</span><span class=\"o\">,</span>\n  <span class=\"n\">rw</span> <span class=\"n\">h8</span><span class=\"o\">,</span>\n  <span class=\"n\">ring</span><span class=\"o\">,</span>\n<span class=\"kd\">end</span>\n\n<span class=\"kd\">lemma</span> <span class=\"n\">important</span> <span class=\"o\">:</span> <span class=\"o\">(</span><span class=\"mi\">9</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">)</span> <span class=\"bp\">^</span> <span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"bp\">/</span><span class=\"mi\">4</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">)</span> <span class=\"bp\">=</span> <span class=\"n\">real.sqrt</span> <span class=\"mi\">3</span> <span class=\"o\">:=</span>\n<span class=\"kd\">begin</span>\n  <span class=\"k\">have</span> <span class=\"n\">h1</span> <span class=\"o\">:=</span> <span class=\"n\">fourth_root_of_9_equals_sqrt_sqrt</span><span class=\"o\">,</span>\n  <span class=\"n\">rw</span> <span class=\"n\">h1</span><span class=\"o\">,</span>\n  <span class=\"k\">have</span> <span class=\"n\">h2</span> <span class=\"o\">:=</span> <span class=\"n\">sqrt_of_9_is_3</span><span class=\"o\">,</span>\n  <span class=\"n\">rw</span> <span class=\"n\">h2</span><span class=\"o\">,</span>\n<span class=\"kd\">end</span>\n</code></pre></div>",
        "id": 221848885,
        "sender_full_name": "Lars Ericson",
        "timestamp": 1609985111
    },
    {
        "content": "<p>I am back to the main question, which now is how do I prove equality of two sets?  Here is the context:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kn\">import</span> <span class=\"n\">data.zsqrtd.basic</span>\n<span class=\"kn\">import</span> <span class=\"n\">ring_theory.subring</span>\n<span class=\"kn\">import</span> <span class=\"n\">data.real.basic</span>\n<span class=\"kn\">import</span> <span class=\"n\">analysis.special_functions.pow</span>\n\n<span class=\"c1\">-- Eric Wieser</span>\n<span class=\"sd\">/-- The image of `zsqrtd` in `ℝ`.  -/</span>\n<span class=\"kd\">@[simps]</span>\n<span class=\"kd\">noncomputable</span> <span class=\"kd\">def</span> <span class=\"n\">zsqrtd.to_real</span> <span class=\"o\">{</span><span class=\"n\">d</span> <span class=\"o\">:</span> <span class=\"n\">ℤ</span> <span class=\"o\">}</span> <span class=\"o\">(</span><span class=\"n\">h</span> <span class=\"o\">:</span> <span class=\"mi\">0</span> <span class=\"bp\">≤</span> <span class=\"n\">d</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">ℤ</span><span class=\"bp\">√</span><span class=\"n\">d</span> <span class=\"bp\">→+*</span> <span class=\"n\">ℝ</span> <span class=\"o\">:=</span> <span class=\"o\">{</span>\n  <span class=\"n\">to_fun</span> <span class=\"o\">:=</span> <span class=\"bp\">λ</span> <span class=\"n\">a</span><span class=\"o\">,</span> <span class=\"n\">a.1</span> <span class=\"bp\">+</span> <span class=\"n\">a.2</span><span class=\"bp\">*</span><span class=\"n\">real.sqrt</span> <span class=\"n\">d</span><span class=\"o\">,</span>\n  <span class=\"n\">map_zero'</span> <span class=\"o\">:=</span> <span class=\"kd\">by</span> <span class=\"n\">simp</span><span class=\"o\">,</span>\n  <span class=\"n\">map_add'</span> <span class=\"o\">:=</span> <span class=\"bp\">λ</span> <span class=\"n\">a</span> <span class=\"n\">b</span><span class=\"o\">,</span> <span class=\"kd\">by</span> <span class=\"o\">{</span> <span class=\"n\">simp</span><span class=\"o\">,</span> <span class=\"n\">ring</span><span class=\"o\">,</span> <span class=\"o\">},</span>\n  <span class=\"n\">map_one'</span> <span class=\"o\">:=</span> <span class=\"kd\">by</span> <span class=\"n\">simp</span><span class=\"o\">,</span>\n  <span class=\"n\">map_mul'</span> <span class=\"o\">:=</span> <span class=\"bp\">λ</span> <span class=\"n\">a</span> <span class=\"n\">b</span><span class=\"o\">,</span> <span class=\"kd\">by</span> <span class=\"o\">{</span>\n    <span class=\"k\">have</span> <span class=\"o\">:</span> <span class=\"o\">(</span><span class=\"bp\">↑</span><span class=\"n\">a.re</span> <span class=\"bp\">+</span> <span class=\"bp\">↑</span><span class=\"n\">a.im</span> <span class=\"bp\">*</span> <span class=\"n\">real.sqrt</span> <span class=\"n\">d</span><span class=\"o\">)</span> <span class=\"bp\">*</span> <span class=\"o\">(</span><span class=\"bp\">↑</span><span class=\"n\">b.re</span> <span class=\"bp\">+</span> <span class=\"bp\">↑</span><span class=\"n\">b.im</span> <span class=\"bp\">*</span> <span class=\"n\">real.sqrt</span> <span class=\"n\">d</span><span class=\"o\">)</span> <span class=\"bp\">=</span>\n             <span class=\"bp\">↑</span><span class=\"n\">a.re</span> <span class=\"bp\">*</span> <span class=\"bp\">↑</span><span class=\"n\">b.re</span> <span class=\"bp\">+</span> <span class=\"o\">(</span><span class=\"bp\">↑</span><span class=\"n\">a.re</span> <span class=\"bp\">*</span> <span class=\"bp\">↑</span><span class=\"n\">b.im</span> <span class=\"bp\">+</span> <span class=\"bp\">↑</span><span class=\"n\">a.im</span> <span class=\"bp\">*</span> <span class=\"bp\">↑</span><span class=\"n\">b.re</span><span class=\"o\">)</span> <span class=\"bp\">*</span> <span class=\"n\">real.sqrt</span> <span class=\"n\">d</span>\n                           <span class=\"bp\">+</span> <span class=\"bp\">↑</span><span class=\"n\">a.im</span> <span class=\"bp\">*</span> <span class=\"bp\">↑</span><span class=\"n\">b.im</span> <span class=\"bp\">*</span> <span class=\"o\">(</span><span class=\"n\">real.sqrt</span> <span class=\"n\">d</span> <span class=\"bp\">*</span> <span class=\"n\">real.sqrt</span> <span class=\"n\">d</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"kd\">by</span> <span class=\"n\">ring</span><span class=\"o\">,</span>\n    <span class=\"n\">simp</span> <span class=\"o\">[</span><span class=\"n\">this</span><span class=\"o\">,</span> <span class=\"n\">real.mul_self_sqrt</span> <span class=\"o\">(</span><span class=\"n\">int.cast_nonneg.mpr</span> <span class=\"n\">h</span><span class=\"o\">)],</span>\n    <span class=\"n\">ring</span><span class=\"o\">,</span> <span class=\"o\">}</span> <span class=\"o\">}</span>\n\n<span class=\"kd\">abbreviation</span> <span class=\"n\">is_an_integral_domain</span> <span class=\"o\">{</span><span class=\"n\">α</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span> <span class=\"o\">[</span><span class=\"n\">ring</span> <span class=\"n\">α</span><span class=\"o\">]</span> <span class=\"o\">(</span><span class=\"n\">s</span> <span class=\"o\">:</span> <span class=\"n\">set</span> <span class=\"n\">α</span><span class=\"o\">)</span> <span class=\"o\">:=</span>\n  <span class=\"bp\">∃</span> <span class=\"o\">(</span><span class=\"n\">sr</span> <span class=\"o\">:</span> <span class=\"n\">subring</span> <span class=\"n\">α</span><span class=\"o\">)</span> <span class=\"o\">[</span><span class=\"n\">integral_domain</span> <span class=\"n\">sr</span><span class=\"o\">],</span> <span class=\"n\">s</span> <span class=\"bp\">=</span> <span class=\"n\">sr</span>\n\n<span class=\"kd\">theorem</span> <span class=\"n\">ex6e</span> <span class=\"o\">:</span> <span class=\"n\">is_an_integral_domain</span> <span class=\"o\">{</span><span class=\"n\">x</span> <span class=\"o\">:</span> <span class=\"n\">ℝ</span> <span class=\"bp\">|</span> <span class=\"bp\">∃</span> <span class=\"n\">a</span> <span class=\"n\">b</span> <span class=\"o\">:</span> <span class=\"n\">ℤ</span><span class=\"o\">,</span> <span class=\"n\">x</span> <span class=\"bp\">=</span> <span class=\"n\">a</span> <span class=\"bp\">+</span> <span class=\"n\">b</span> <span class=\"bp\">*</span> <span class=\"o\">(</span><span class=\"mi\">9</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">)</span> <span class=\"bp\">^</span> <span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"bp\">/</span><span class=\"mi\">4</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">)}</span> <span class=\"o\">:=</span>\n<span class=\"kd\">begin</span>\n  <span class=\"n\">refine</span> <span class=\"o\">⟨(</span><span class=\"n\">zsqrtd.to_real</span> <span class=\"o\">(</span><span class=\"k\">show</span> <span class=\"mi\">0</span> <span class=\"bp\">≤</span> <span class=\"o\">(</span><span class=\"mi\">3</span> <span class=\"o\">:</span> <span class=\"n\">ℤ</span><span class=\"o\">),</span> <span class=\"kd\">by</span> <span class=\"n\">norm_num</span><span class=\"o\">))</span><span class=\"bp\">.</span><span class=\"n\">range</span><span class=\"o\">,</span> <span class=\"n\">_</span><span class=\"o\">,</span> <span class=\"n\">_</span><span class=\"o\">⟩,</span>\n  <span class=\"n\">apply_instance</span><span class=\"o\">,</span>\n  <span class=\"n\">ext</span><span class=\"o\">,</span>\n  <span class=\"n\">refine</span> <span class=\"n\">omega.pred_mono_2</span> <span class=\"n\">rfl</span> <span class=\"n\">_</span><span class=\"o\">,</span>\n  <span class=\"gr\">sorry</span><span class=\"o\">,</span>\n<span class=\"kd\">end</span>\n</code></pre></div>\n<p>Just before the <code>sorry</code> the goal state is:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"bp\">⊢</span> <span class=\"o\">{</span><span class=\"n\">x</span> <span class=\"o\">:</span> <span class=\"n\">ℝ</span> <span class=\"bp\">|</span> <span class=\"bp\">∃</span> <span class=\"o\">(</span><span class=\"n\">a</span> <span class=\"n\">b</span> <span class=\"o\">:</span> <span class=\"n\">ℤ</span><span class=\"o\">),</span> <span class=\"n\">x</span> <span class=\"bp\">=</span> <span class=\"bp\">↑</span><span class=\"n\">a</span> <span class=\"bp\">+</span> <span class=\"bp\">↑</span><span class=\"n\">b</span> <span class=\"bp\">*</span> <span class=\"mi\">9</span> <span class=\"bp\">^</span> <span class=\"o\">(</span><span class=\"mi\">1</span> <span class=\"bp\">/</span> <span class=\"mi\">4</span><span class=\"o\">)}</span> <span class=\"bp\">=</span> <span class=\"bp\">↑</span><span class=\"o\">((</span><span class=\"n\">zsqrtd.to_real</span> <span class=\"n\">_</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">range</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>I don't know where to begin on how to unroll that.  <code>library_search</code> times out and <code>suggest</code> gives a long list of possibilities.  I haven't done any set equivalence proofs so I don't know what will reduce this to more underlying material:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"n\">Try</span> <span class=\"n\">this</span><span class=\"o\">:</span> <span class=\"n\">refine</span> <span class=\"n\">funext</span> <span class=\"n\">_</span>\n<span class=\"n\">Try</span> <span class=\"n\">this</span><span class=\"o\">:</span> <span class=\"n\">refine</span> <span class=\"n\">eq.symm</span> <span class=\"n\">_</span>\n<span class=\"n\">Try</span> <span class=\"n\">this</span><span class=\"o\">:</span> <span class=\"n\">refine</span> <span class=\"n\">set.ext</span> <span class=\"n\">_</span>\n<span class=\"n\">Try</span> <span class=\"n\">this</span><span class=\"o\">:</span> <span class=\"n\">refine</span> <span class=\"n\">eq_comm.mp</span> <span class=\"n\">_</span>\n<span class=\"n\">Try</span> <span class=\"n\">this</span><span class=\"o\">:</span> <span class=\"n\">refine</span> <span class=\"n\">eq_comm.mpr</span> <span class=\"n\">_</span>\n<span class=\"n\">Try</span> <span class=\"n\">this</span><span class=\"o\">:</span> <span class=\"n\">refine</span> <span class=\"n\">eq_of_heq</span> <span class=\"n\">_</span>\n<span class=\"n\">Try</span> <span class=\"n\">this</span><span class=\"o\">:</span> <span class=\"n\">refine</span> <span class=\"n\">congr_arg</span> <span class=\"n\">set_of</span> <span class=\"n\">_</span>\n<span class=\"n\">Try</span> <span class=\"n\">this</span><span class=\"o\">:</span> <span class=\"n\">refine</span> <span class=\"n\">mem_id_rel.mp</span> <span class=\"n\">_</span>\n<span class=\"n\">Try</span> <span class=\"n\">this</span><span class=\"o\">:</span> <span class=\"n\">refine</span> <span class=\"n\">heq_iff_eq.mp</span> <span class=\"n\">_</span>\n<span class=\"n\">Try</span> <span class=\"n\">this</span><span class=\"o\">:</span> <span class=\"n\">refine</span> <span class=\"n\">set.ext_iff.mpr</span> <span class=\"n\">_</span>\n<span class=\"n\">Try</span> <span class=\"n\">this</span><span class=\"o\">:</span> <span class=\"n\">refine</span> <span class=\"n\">plift.up.inj</span> <span class=\"n\">_</span>\n<span class=\"n\">Try</span> <span class=\"n\">this</span><span class=\"o\">:</span> <span class=\"n\">refine</span> <span class=\"n\">ulift.up.inj</span> <span class=\"n\">_</span>\n<span class=\"n\">Try</span> <span class=\"n\">this</span><span class=\"o\">:</span> <span class=\"n\">refine</span> <span class=\"n\">let_value_eq</span> <span class=\"n\">set_of</span> <span class=\"n\">_</span>\n<span class=\"n\">Try</span> <span class=\"n\">this</span><span class=\"o\">:</span> <span class=\"n\">refine</span> <span class=\"n\">compl_inj_iff.mp</span> <span class=\"n\">_</span>\n<span class=\"n\">Try</span> <span class=\"n\">this</span><span class=\"o\">:</span> <span class=\"n\">refine</span> <span class=\"o\">(</span><span class=\"n\">list.mem_pure</span> <span class=\"o\">{</span><span class=\"n\">x</span> <span class=\"o\">:</span> <span class=\"n\">ℝ</span> <span class=\"bp\">|</span> <span class=\"bp\">∃</span> <span class=\"o\">(</span><span class=\"n\">a</span> <span class=\"n\">b</span> <span class=\"o\">:</span> <span class=\"n\">ℤ</span><span class=\"o\">),</span> <span class=\"n\">x</span> <span class=\"bp\">=</span> <span class=\"bp\">↑</span><span class=\"n\">a</span> <span class=\"bp\">+</span> <span class=\"bp\">↑</span><span class=\"n\">b</span> <span class=\"bp\">*</span> <span class=\"mi\">9</span> <span class=\"bp\">^</span> <span class=\"o\">(</span><span class=\"mi\">1</span> <span class=\"bp\">/</span> <span class=\"mi\">4</span><span class=\"o\">)}</span>\n   <span class=\"bp\">↑</span><span class=\"o\">((</span><span class=\"n\">zsqrtd.to_real</span>\n         <span class=\"o\">(</span><span class=\"k\">show</span> <span class=\"mi\">0</span> <span class=\"bp\">≤</span> <span class=\"mi\">3</span><span class=\"o\">,</span> <span class=\"k\">from</span>\n            <span class=\"o\">(</span><span class=\"n\">id</span> <span class=\"o\">(</span><span class=\"n\">eq_true_intro</span> <span class=\"o\">(</span><span class=\"n\">norm_num.nonneg_pos</span> <span class=\"mi\">3</span> <span class=\"o\">(</span><span class=\"n\">bit1_pos'</span> <span class=\"n\">zero_lt_one'</span><span class=\"o\">))))</span><span class=\"bp\">.</span><span class=\"n\">mpr</span> <span class=\"n\">trivial</span><span class=\"o\">))</span><span class=\"bp\">.</span><span class=\"n\">range</span><span class=\"o\">))</span><span class=\"bp\">.</span><span class=\"n\">mp</span>\n  <span class=\"n\">_</span>\n<span class=\"n\">Try</span> <span class=\"n\">this</span><span class=\"o\">:</span> <span class=\"n\">refine</span> <span class=\"n\">setoid.ker_def.mp</span> <span class=\"n\">_</span>\n<span class=\"n\">Try</span> <span class=\"n\">this</span><span class=\"o\">:</span> <span class=\"n\">refine</span> <span class=\"n\">has_top.mk.inj</span> <span class=\"n\">_</span>\n<span class=\"n\">Try</span> <span class=\"n\">this</span><span class=\"o\">:</span> <span class=\"n\">refine</span> <span class=\"n\">has_one.mk.inj</span> <span class=\"n\">_</span>\n<span class=\"n\">Try</span> <span class=\"n\">this</span><span class=\"o\">:</span> <span class=\"n\">refine</span> <span class=\"n\">has_bot.mk.inj</span> <span class=\"n\">_</span>\n<span class=\"n\">Try</span> <span class=\"n\">this</span><span class=\"o\">:</span> <span class=\"n\">refine</span> <span class=\"n\">has_coe.mk.inj</span> <span class=\"n\">_</span>\n<span class=\"n\">Try</span> <span class=\"n\">this</span><span class=\"o\">:</span> <span class=\"n\">refine</span> <span class=\"n\">option.some_inj.mp</span> <span class=\"n\">_</span>\n<span class=\"n\">Try</span> <span class=\"n\">this</span><span class=\"o\">:</span> <span class=\"n\">refine</span> <span class=\"n\">sum.inl.inj</span> <span class=\"n\">_</span>\n<span class=\"n\">Try</span> <span class=\"n\">this</span><span class=\"o\">:</span> <span class=\"n\">refine</span> <span class=\"n\">sum.inr.inj</span> <span class=\"n\">_</span>\n<span class=\"n\">Try</span> <span class=\"n\">this</span><span class=\"o\">:</span> <span class=\"n\">refine</span> <span class=\"n\">le_antisymm</span> <span class=\"n\">_</span> <span class=\"n\">_</span>\n<span class=\"n\">Try</span> <span class=\"n\">this</span><span class=\"o\">:</span> <span class=\"n\">refine</span> <span class=\"n\">psum.inr.inj</span> <span class=\"n\">_</span>\n<span class=\"n\">Try</span> <span class=\"n\">this</span><span class=\"o\">:</span> <span class=\"n\">refine</span> <span class=\"n\">le_antisymm'</span> <span class=\"n\">_</span> <span class=\"n\">_</span>\n<span class=\"n\">Try</span> <span class=\"n\">this</span><span class=\"o\">:</span> <span class=\"n\">refine</span> <span class=\"n\">psum.inl.inj</span> <span class=\"n\">_</span>\n<span class=\"n\">Try</span> <span class=\"n\">this</span><span class=\"o\">:</span> <span class=\"n\">refine</span> <span class=\"o\">(</span><span class=\"n\">divp_left_inj</span> <span class=\"n\">_</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">mp</span> <span class=\"n\">_</span>\n<span class=\"n\">Try</span> <span class=\"n\">this</span><span class=\"o\">:</span> <span class=\"n\">refine</span> <span class=\"n\">except.ok.inj</span> <span class=\"n\">_</span>\n<span class=\"n\">Try</span> <span class=\"n\">this</span><span class=\"o\">:</span> <span class=\"n\">refine</span> <span class=\"n\">eq.trans</span> <span class=\"n\">_</span> <span class=\"n\">_</span>\n<span class=\"n\">Try</span> <span class=\"n\">this</span><span class=\"o\">:</span> <span class=\"n\">refine</span> <span class=\"n\">inv_unique</span> <span class=\"n\">_</span> <span class=\"n\">_</span>\n<span class=\"n\">Try</span> <span class=\"n\">this</span><span class=\"o\">:</span> <span class=\"n\">refine</span> <span class=\"n\">neg_unique</span> <span class=\"n\">_</span> <span class=\"n\">_</span>\n<span class=\"n\">Try</span> <span class=\"n\">this</span><span class=\"o\">:</span> <span class=\"n\">refine</span> <span class=\"o\">(</span><span class=\"n\">eq.congr_left</span> <span class=\"n\">_</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">mp</span> <span class=\"n\">_</span>\n<span class=\"n\">Try</span> <span class=\"n\">this</span><span class=\"o\">:</span> <span class=\"n\">refine</span> <span class=\"o\">(</span><span class=\"n\">eq.congr_left</span> <span class=\"n\">_</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">mpr</span> <span class=\"n\">_</span>\n<span class=\"n\">Try</span> <span class=\"n\">this</span><span class=\"o\">:</span> <span class=\"n\">refine</span> <span class=\"n\">is_glb.unique</span> <span class=\"n\">_</span> <span class=\"n\">_</span>\n<span class=\"n\">Try</span> <span class=\"n\">this</span><span class=\"o\">:</span> <span class=\"n\">refine</span> <span class=\"n\">is_lub.unique</span> <span class=\"n\">_</span> <span class=\"n\">_</span>\n<span class=\"n\">Try</span> <span class=\"n\">this</span><span class=\"o\">:</span> <span class=\"n\">refine</span> <span class=\"o\">(</span><span class=\"n\">eq.congr_right</span> <span class=\"n\">_</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">mp</span> <span class=\"n\">_</span>\n<span class=\"n\">Try</span> <span class=\"n\">this</span><span class=\"o\">:</span> <span class=\"n\">refine</span> <span class=\"o\">(</span><span class=\"n\">eq.congr_right</span> <span class=\"n\">_</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">mpr</span> <span class=\"n\">_</span>\n<span class=\"n\">Try</span> <span class=\"n\">this</span><span class=\"o\">:</span> <span class=\"n\">refine</span> <span class=\"n\">subtype.mk.inj</span> <span class=\"n\">_</span>\n<span class=\"n\">Try</span> <span class=\"n\">this</span><span class=\"o\">:</span> <span class=\"n\">refine</span> <span class=\"o\">(</span><span class=\"n\">eq.congr</span> <span class=\"n\">_</span> <span class=\"n\">_</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">mp</span> <span class=\"n\">_</span>\n<span class=\"n\">Try</span> <span class=\"n\">this</span><span class=\"o\">:</span> <span class=\"n\">refine</span> <span class=\"o\">(</span><span class=\"n\">eq.congr</span> <span class=\"n\">_</span> <span class=\"n\">_</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">mpr</span> <span class=\"n\">_</span>\n<span class=\"n\">Try</span> <span class=\"n\">this</span><span class=\"o\">:</span> <span class=\"n\">refine</span> <span class=\"n\">pequiv.inj</span> <span class=\"n\">_</span> <span class=\"n\">_</span> <span class=\"n\">_</span>\n<span class=\"n\">Try</span> <span class=\"n\">this</span><span class=\"o\">:</span> <span class=\"n\">refine</span> <span class=\"n\">add_hom.mk.inj</span> <span class=\"n\">_</span>\n<span class=\"n\">Try</span> <span class=\"n\">this</span><span class=\"o\">:</span> <span class=\"n\">refine</span> <span class=\"n\">one_hom.mk.inj</span> <span class=\"n\">_</span>\n<span class=\"n\">Try</span> <span class=\"n\">this</span><span class=\"o\">:</span> <span class=\"n\">refine</span> <span class=\"n\">rel_hom.mk.inj</span> <span class=\"n\">_</span>\n<span class=\"n\">Try</span> <span class=\"n\">this</span><span class=\"o\">:</span> <span class=\"n\">refine</span> <span class=\"n\">mul_hom.mk.inj</span> <span class=\"n\">_</span>\n<span class=\"n\">Try</span> <span class=\"n\">this</span><span class=\"o\">:</span> <span class=\"n\">refine</span> <span class=\"n\">zero_hom.mk.inj</span> <span class=\"n\">_</span>\n<span class=\"n\">Try</span> <span class=\"n\">this</span><span class=\"o\">:</span> <span class=\"n\">refine</span> <span class=\"n\">subgroup.mk.inj</span> <span class=\"n\">_</span>\n<span class=\"n\">Try</span> <span class=\"n\">this</span><span class=\"o\">:</span> <span class=\"n\">refine</span> <span class=\"n\">subring.mk.inj</span> <span class=\"n\">_</span>\n<span class=\"n\">Try</span> <span class=\"n\">this</span><span class=\"o\">:</span> <span class=\"n\">refine</span> <span class=\"n\">alg_hom.mk.inj</span> <span class=\"n\">_</span>\n</code></pre></div>",
        "id": 221851134,
        "sender_full_name": "Lars Ericson",
        "timestamp": 1609987649
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"308899\">Yakov Pechersky</span> <a href=\"#narrow/stream/113489-new-members/topic/How.20to.20multiply.20an.20integer.20times.20a.20real/near/221845360\">said</a>:</p>\n<blockquote>\n<p><div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kd\">lemma</span> <span class=\"n\">two_equals_two</span> <span class=\"o\">:</span> <span class=\"o\">(</span><span class=\"mi\">2</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">)</span> <span class=\"bp\">=</span> <span class=\"o\">(</span><span class=\"mi\">2</span><span class=\"o\">:</span><span class=\"n\">ℕ</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"kd\">by</span> <span class=\"n\">norm_num</span>\n</code></pre></div><br>\n</p>\n</blockquote>\n<p>I think <code>simp</code> is doing all the work there</p>",
        "id": 221861406,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1610001006
    },
    {
        "content": "<p>I have no idea what <a href=\"https://leanprover-community.github.io/mathlib_docs/find/omega.pred_mono_2\">docs#omega.pred_mono_2</a> is, but I'm pretty sure you don't want to use it - it's undoing the progress made by <code>ext</code></p>",
        "id": 221864797,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1610005549
    },
    {
        "content": "<p>Thanks, per <span class=\"user-mention\" data-user-id=\"111080\">@Floris van Doorn</span> I backed out the omega and applied <a href=\"https://leanprover-community.github.io/mathlib_docs/find/set.mem_set_of_eq\">docs#set.mem_set_of_eq</a> and that gets me here which gets me back into predicate calculus and out of sets:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"bp\">⊢</span> <span class=\"o\">(</span><span class=\"bp\">∃</span> <span class=\"o\">(</span><span class=\"n\">a</span> <span class=\"n\">b</span> <span class=\"o\">:</span> <span class=\"n\">ℤ</span><span class=\"o\">),</span> <span class=\"n\">x</span> <span class=\"bp\">=</span> <span class=\"bp\">↑</span><span class=\"n\">a</span> <span class=\"bp\">+</span> <span class=\"bp\">↑</span><span class=\"n\">b</span> <span class=\"bp\">*</span> <span class=\"mi\">9</span> <span class=\"bp\">^</span> <span class=\"o\">(</span><span class=\"mi\">1</span> <span class=\"bp\">/</span> <span class=\"mi\">4</span><span class=\"o\">))</span> <span class=\"bp\">↔</span> <span class=\"n\">x</span> <span class=\"bp\">∈</span> <span class=\"bp\">↑</span><span class=\"o\">((</span><span class=\"n\">zsqrtd.to_real</span> <span class=\"n\">_</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">range</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>I don't see that in the <code>suggest</code> list,  so that's a possible improvement for <code>suggest</code>.</p>",
        "id": 221975407,
        "sender_full_name": "Lars Ericson",
        "timestamp": 1610041585
    },
    {
        "content": "<p>You can always do <code>suggest 100</code> to get more suggestions, perhaps it shows up with a higher number than the default?</p>",
        "id": 221977532,
        "sender_full_name": "Alex J. Best",
        "timestamp": 1610042482
    },
    {
        "content": "<p>I got it this far but I'm out of ideas again:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kn\">import</span> <span class=\"n\">data.zsqrtd.basic</span>\n<span class=\"kn\">import</span> <span class=\"n\">ring_theory.subring</span>\n<span class=\"kn\">import</span> <span class=\"n\">data.real.basic</span>\n<span class=\"kn\">import</span> <span class=\"n\">analysis.special_functions.pow</span>\n\n\n<span class=\"sd\">/-- The image of `zsqrtd` in `ℝ`.  -/</span>  <span class=\"c1\">-- Eric Wieser</span>\n<span class=\"kd\">@[simps]</span>\n<span class=\"kd\">noncomputable</span> <span class=\"kd\">def</span> <span class=\"n\">zsqrtd.to_real</span> <span class=\"o\">{</span><span class=\"n\">d</span> <span class=\"o\">:</span> <span class=\"n\">ℤ</span> <span class=\"o\">}</span> <span class=\"o\">(</span><span class=\"n\">h</span> <span class=\"o\">:</span> <span class=\"mi\">0</span> <span class=\"bp\">≤</span> <span class=\"n\">d</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">ℤ</span><span class=\"bp\">√</span><span class=\"n\">d</span> <span class=\"bp\">→+*</span> <span class=\"n\">ℝ</span> <span class=\"o\">:=</span> <span class=\"o\">{</span>\n  <span class=\"n\">to_fun</span> <span class=\"o\">:=</span> <span class=\"bp\">λ</span> <span class=\"n\">a</span><span class=\"o\">,</span> <span class=\"n\">a.1</span> <span class=\"bp\">+</span> <span class=\"n\">a.2</span><span class=\"bp\">*</span><span class=\"n\">real.sqrt</span> <span class=\"n\">d</span><span class=\"o\">,</span>\n  <span class=\"n\">map_zero'</span> <span class=\"o\">:=</span> <span class=\"kd\">by</span> <span class=\"n\">simp</span><span class=\"o\">,</span>\n  <span class=\"n\">map_add'</span> <span class=\"o\">:=</span> <span class=\"bp\">λ</span> <span class=\"n\">a</span> <span class=\"n\">b</span><span class=\"o\">,</span> <span class=\"kd\">by</span> <span class=\"o\">{</span> <span class=\"n\">simp</span><span class=\"o\">,</span> <span class=\"n\">ring</span><span class=\"o\">,</span> <span class=\"o\">},</span>\n  <span class=\"n\">map_one'</span> <span class=\"o\">:=</span> <span class=\"kd\">by</span> <span class=\"n\">simp</span><span class=\"o\">,</span>\n  <span class=\"n\">map_mul'</span> <span class=\"o\">:=</span> <span class=\"bp\">λ</span> <span class=\"n\">a</span> <span class=\"n\">b</span><span class=\"o\">,</span> <span class=\"kd\">by</span> <span class=\"o\">{</span>\n    <span class=\"k\">have</span> <span class=\"o\">:</span> <span class=\"o\">(</span><span class=\"bp\">↑</span><span class=\"n\">a.re</span> <span class=\"bp\">+</span> <span class=\"bp\">↑</span><span class=\"n\">a.im</span> <span class=\"bp\">*</span> <span class=\"n\">real.sqrt</span> <span class=\"n\">d</span><span class=\"o\">)</span> <span class=\"bp\">*</span> <span class=\"o\">(</span><span class=\"bp\">↑</span><span class=\"n\">b.re</span> <span class=\"bp\">+</span> <span class=\"bp\">↑</span><span class=\"n\">b.im</span> <span class=\"bp\">*</span> <span class=\"n\">real.sqrt</span> <span class=\"n\">d</span><span class=\"o\">)</span> <span class=\"bp\">=</span>\n             <span class=\"bp\">↑</span><span class=\"n\">a.re</span> <span class=\"bp\">*</span> <span class=\"bp\">↑</span><span class=\"n\">b.re</span> <span class=\"bp\">+</span> <span class=\"o\">(</span><span class=\"bp\">↑</span><span class=\"n\">a.re</span> <span class=\"bp\">*</span> <span class=\"bp\">↑</span><span class=\"n\">b.im</span> <span class=\"bp\">+</span> <span class=\"bp\">↑</span><span class=\"n\">a.im</span> <span class=\"bp\">*</span> <span class=\"bp\">↑</span><span class=\"n\">b.re</span><span class=\"o\">)</span> <span class=\"bp\">*</span> <span class=\"n\">real.sqrt</span> <span class=\"n\">d</span>\n                           <span class=\"bp\">+</span> <span class=\"bp\">↑</span><span class=\"n\">a.im</span> <span class=\"bp\">*</span> <span class=\"bp\">↑</span><span class=\"n\">b.im</span> <span class=\"bp\">*</span> <span class=\"o\">(</span><span class=\"n\">real.sqrt</span> <span class=\"n\">d</span> <span class=\"bp\">*</span> <span class=\"n\">real.sqrt</span> <span class=\"n\">d</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"kd\">by</span> <span class=\"n\">ring</span><span class=\"o\">,</span>\n    <span class=\"n\">simp</span> <span class=\"o\">[</span><span class=\"n\">this</span><span class=\"o\">,</span> <span class=\"n\">real.mul_self_sqrt</span> <span class=\"o\">(</span><span class=\"n\">int.cast_nonneg.mpr</span> <span class=\"n\">h</span><span class=\"o\">)],</span>\n    <span class=\"n\">ring</span><span class=\"o\">,</span> <span class=\"o\">}</span> <span class=\"o\">}</span>\n\n<span class=\"kd\">abbreviation</span> <span class=\"n\">is_an_integral_domain</span> <span class=\"o\">{</span><span class=\"n\">α</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span> <span class=\"o\">[</span><span class=\"n\">ring</span> <span class=\"n\">α</span><span class=\"o\">]</span> <span class=\"o\">(</span><span class=\"n\">s</span> <span class=\"o\">:</span> <span class=\"n\">set</span> <span class=\"n\">α</span><span class=\"o\">)</span> <span class=\"o\">:=</span>\n  <span class=\"bp\">∃</span> <span class=\"o\">(</span><span class=\"n\">sr</span> <span class=\"o\">:</span> <span class=\"n\">subring</span> <span class=\"n\">α</span><span class=\"o\">)</span> <span class=\"o\">[</span><span class=\"n\">integral_domain</span> <span class=\"n\">sr</span><span class=\"o\">],</span> <span class=\"n\">s</span> <span class=\"bp\">=</span> <span class=\"n\">sr</span>\n\n<span class=\"kd\">lemma</span> <span class=\"n\">fourth_root_of_nine_equals_sqrt_3</span> <span class=\"o\">:</span> <span class=\"o\">(</span><span class=\"mi\">9</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">)</span> <span class=\"bp\">^</span> <span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"bp\">/</span><span class=\"mi\">4</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">)</span> <span class=\"bp\">=</span> <span class=\"n\">real.sqrt</span> <span class=\"mi\">3</span> <span class=\"o\">:=</span> <span class=\"gr\">sorry</span>\n\n<span class=\"kd\">theorem</span> <span class=\"n\">ex6e</span> <span class=\"o\">:</span> <span class=\"n\">is_an_integral_domain</span> <span class=\"o\">{</span><span class=\"n\">x</span> <span class=\"o\">:</span> <span class=\"n\">ℝ</span> <span class=\"bp\">|</span> <span class=\"bp\">∃</span> <span class=\"n\">a</span> <span class=\"n\">b</span> <span class=\"o\">:</span> <span class=\"n\">ℤ</span><span class=\"o\">,</span> <span class=\"n\">x</span> <span class=\"bp\">=</span> <span class=\"n\">a</span> <span class=\"bp\">+</span> <span class=\"n\">b</span> <span class=\"bp\">*</span> <span class=\"o\">(</span><span class=\"mi\">9</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">)</span> <span class=\"bp\">^</span> <span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"bp\">/</span><span class=\"mi\">4</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">)}</span> <span class=\"o\">:=</span>\n<span class=\"kd\">begin</span>\n  <span class=\"n\">refine</span> <span class=\"o\">⟨(</span><span class=\"n\">zsqrtd.to_real</span> <span class=\"o\">(</span><span class=\"k\">show</span> <span class=\"mi\">0</span> <span class=\"bp\">≤</span> <span class=\"o\">(</span><span class=\"mi\">3</span> <span class=\"o\">:</span> <span class=\"n\">ℤ</span><span class=\"o\">),</span> <span class=\"kd\">by</span> <span class=\"n\">norm_num</span><span class=\"o\">))</span><span class=\"bp\">.</span><span class=\"n\">range</span><span class=\"o\">,</span> <span class=\"n\">_</span><span class=\"o\">,</span> <span class=\"n\">_</span><span class=\"o\">⟩,</span>\n  <span class=\"n\">apply_instance</span><span class=\"o\">,</span>\n  <span class=\"n\">ext</span><span class=\"o\">,</span>\n  <span class=\"n\">rw</span> <span class=\"n\">set.mem_set_of_eq</span><span class=\"o\">,</span>\n  <span class=\"n\">split</span><span class=\"o\">,</span>\n  <span class=\"o\">{</span>\n    <span class=\"n\">intro</span> <span class=\"n\">h1</span><span class=\"o\">,</span>\n    <span class=\"n\">apply</span> <span class=\"n\">exists.intro</span><span class=\"o\">,</span>\n    <span class=\"n\">split</span><span class=\"o\">,</span>\n    <span class=\"o\">{</span>\n      <span class=\"n\">cases</span> <span class=\"n\">h1</span> <span class=\"k\">with</span> <span class=\"n\">a</span> <span class=\"n\">ha</span><span class=\"o\">,</span>\n      <span class=\"n\">cases</span> <span class=\"n\">ha</span> <span class=\"k\">with</span> <span class=\"n\">b</span> <span class=\"n\">hb</span><span class=\"o\">,</span>\n      <span class=\"n\">exact</span> <span class=\"n\">trivial</span><span class=\"o\">,</span>\n    <span class=\"o\">},</span>\n    <span class=\"o\">{</span>\n      <span class=\"n\">cases</span> <span class=\"n\">h1</span> <span class=\"k\">with</span> <span class=\"n\">a</span> <span class=\"n\">ha</span><span class=\"o\">,</span>\n      <span class=\"n\">cases</span> <span class=\"n\">ha</span> <span class=\"k\">with</span> <span class=\"n\">b</span> <span class=\"n\">hb</span><span class=\"o\">,</span>\n      <span class=\"n\">norm_num</span><span class=\"o\">,</span>\n      <span class=\"k\">have</span> <span class=\"n\">h2</span> <span class=\"o\">:=</span> <span class=\"n\">fourth_root_of_nine_equals_sqrt_3</span><span class=\"o\">,</span>\n      <span class=\"n\">rw</span> <span class=\"bp\">←</span> <span class=\"n\">h2</span><span class=\"o\">,</span>\n      <span class=\"gr\">sorry</span><span class=\"o\">,</span>\n    <span class=\"o\">},</span>\n    <span class=\"n\">exact</span> <span class=\"n\">zsqrtd.one</span><span class=\"o\">,</span>\n  <span class=\"o\">},</span>\n  <span class=\"o\">{</span>\n    <span class=\"n\">intro</span> <span class=\"n\">h</span><span class=\"o\">,</span>\n    <span class=\"n\">apply</span> <span class=\"n\">exists.intro</span><span class=\"o\">,</span>\n    <span class=\"n\">apply</span> <span class=\"n\">exists.intro</span><span class=\"o\">,</span>\n    <span class=\"n\">cases</span> <span class=\"n\">h</span><span class=\"o\">,</span>\n    <span class=\"n\">unfold_coes</span><span class=\"o\">,</span>\n    <span class=\"gr\">sorry</span><span class=\"o\">,</span>\n    <span class=\"n\">exact</span> <span class=\"n\">int.one</span><span class=\"o\">,</span>\n    <span class=\"n\">exact</span> <span class=\"n\">int.one</span><span class=\"o\">,</span>\n  <span class=\"o\">}</span>\n<span class=\"kd\">end</span>\n</code></pre></div>\n<p>At the first <code>sorry</code>, my tactic state is</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"mi\">1</span> <span class=\"n\">goal</span>\n<span class=\"n\">x</span><span class=\"o\">:</span> <span class=\"n\">ℝ</span>\n<span class=\"n\">ab</span><span class=\"o\">:</span> <span class=\"n\">ℤ</span>\n<span class=\"n\">hb</span><span class=\"o\">:</span> <span class=\"n\">x</span> <span class=\"bp\">=</span> <span class=\"bp\">↑</span><span class=\"n\">a</span> <span class=\"bp\">+</span> <span class=\"bp\">↑</span><span class=\"n\">b</span> <span class=\"bp\">*</span> <span class=\"mi\">9</span> <span class=\"bp\">^</span> <span class=\"o\">(</span><span class=\"mi\">1</span> <span class=\"bp\">/</span> <span class=\"mi\">4</span><span class=\"o\">)</span>\n<span class=\"n\">h2</span><span class=\"o\">:</span> <span class=\"mi\">9</span> <span class=\"bp\">^</span> <span class=\"o\">(</span><span class=\"mi\">1</span> <span class=\"bp\">/</span> <span class=\"mi\">4</span><span class=\"o\">)</span> <span class=\"bp\">=</span> <span class=\"n\">real.sqrt</span> <span class=\"mi\">3</span>\n<span class=\"bp\">⊢</span> <span class=\"bp\">↑</span><span class=\"o\">(</span><span class=\"bp\">?</span><span class=\"n\">m_1</span><span class=\"o\">[</span><span class=\"n\">_</span><span class=\"o\">]</span><span class=\"bp\">.</span><span class=\"n\">re</span><span class=\"o\">)</span> <span class=\"bp\">+</span> <span class=\"bp\">↑</span><span class=\"o\">(</span><span class=\"bp\">?</span><span class=\"n\">m_1</span><span class=\"o\">[</span><span class=\"n\">_</span><span class=\"o\">]</span><span class=\"bp\">.</span><span class=\"n\">im</span><span class=\"o\">)</span> <span class=\"bp\">*</span> <span class=\"mi\">9</span> <span class=\"bp\">^</span> <span class=\"o\">(</span><span class=\"mi\">1</span> <span class=\"bp\">/</span> <span class=\"mi\">4</span><span class=\"o\">)</span> <span class=\"bp\">=</span> <span class=\"n\">x</span>\n</code></pre></div>\n<p>It's asking for real and imaginary parts of an unmatched thing.  I haven't been reasoning about complex numbers, that just popped up.</p>\n<p>The second <code>sorry</code> also seems to want me to fill in some random number.  The goal state is</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"mi\">3</span> <span class=\"n\">goals</span>\n<span class=\"n\">x</span><span class=\"o\">:</span> <span class=\"n\">ℝ</span>\n<span class=\"n\">h_w</span><span class=\"o\">:</span> <span class=\"n\">ℤ</span><span class=\"bp\">√</span><span class=\"mi\">3</span>\n<span class=\"n\">h_h</span><span class=\"o\">:</span> <span class=\"n\">h_w</span> <span class=\"bp\">∈</span> <span class=\"bp\">⊤.</span><span class=\"n\">carrier</span> <span class=\"bp\">∧</span> <span class=\"bp\">⇑</span><span class=\"o\">(</span><span class=\"n\">zsqrtd.to_real</span> <span class=\"n\">_</span><span class=\"o\">)</span> <span class=\"n\">h_w</span> <span class=\"bp\">=</span> <span class=\"n\">x</span>\n<span class=\"bp\">⊢</span> <span class=\"n\">x</span> <span class=\"bp\">=</span> <span class=\"n\">int.cast</span> <span class=\"bp\">?</span><span class=\"n\">m_1</span><span class=\"o\">[</span><span class=\"n\">_</span><span class=\"o\">]</span> <span class=\"bp\">+</span> <span class=\"n\">int.cast</span> <span class=\"bp\">?</span><span class=\"n\">m_2</span><span class=\"o\">[</span><span class=\"n\">_</span><span class=\"o\">]</span> <span class=\"bp\">*</span> <span class=\"mi\">9</span> <span class=\"bp\">^</span> <span class=\"o\">(</span><span class=\"mi\">1</span> <span class=\"bp\">/</span> <span class=\"mi\">4</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>I don't understand how to work with these metavariables and what the tactics or theorems are that would apply.</p>",
        "id": 222153450,
        "sender_full_name": "Lars Ericson",
        "timestamp": 1610167120
    },
    {
        "content": "<p>things seem to start to go wrong at <code>apply exists.intro</code></p>",
        "id": 222153646,
        "sender_full_name": "Thomas Browning",
        "timestamp": 1610167488
    },
    {
        "content": "<p>This seems like a good starting point</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kd\">theorem</span> <span class=\"n\">ex6e</span> <span class=\"o\">:</span> <span class=\"n\">is_an_integral_domain</span> <span class=\"o\">{</span><span class=\"n\">x</span> <span class=\"o\">:</span> <span class=\"n\">ℝ</span> <span class=\"bp\">|</span> <span class=\"bp\">∃</span> <span class=\"n\">a</span> <span class=\"n\">b</span> <span class=\"o\">:</span> <span class=\"n\">ℤ</span><span class=\"o\">,</span> <span class=\"n\">x</span> <span class=\"bp\">=</span> <span class=\"n\">a</span> <span class=\"bp\">+</span> <span class=\"n\">b</span> <span class=\"bp\">*</span> <span class=\"o\">(</span><span class=\"mi\">9</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">)</span> <span class=\"bp\">^</span> <span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"bp\">/</span><span class=\"mi\">4</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">)}</span> <span class=\"o\">:=</span>\n<span class=\"kd\">begin</span>\n  <span class=\"n\">refine</span> <span class=\"o\">⟨(</span><span class=\"n\">zsqrtd.to_real</span> <span class=\"o\">(</span><span class=\"k\">show</span> <span class=\"mi\">0</span> <span class=\"bp\">≤</span> <span class=\"o\">(</span><span class=\"mi\">3</span> <span class=\"o\">:</span> <span class=\"n\">ℤ</span><span class=\"o\">),</span> <span class=\"kd\">by</span> <span class=\"n\">norm_num</span><span class=\"o\">))</span><span class=\"bp\">.</span><span class=\"n\">range</span><span class=\"o\">,</span> <span class=\"n\">_</span><span class=\"o\">,</span> <span class=\"n\">_</span><span class=\"o\">⟩,</span>\n  <span class=\"n\">apply_instance</span><span class=\"o\">,</span>\n  <span class=\"n\">ext</span><span class=\"o\">,</span>\n  <span class=\"n\">rw</span> <span class=\"o\">[</span><span class=\"n\">fourth_root_of_nine_equals_sqrt_3</span><span class=\"o\">],</span>\n  <span class=\"n\">simp</span> <span class=\"o\">[</span><span class=\"n\">zsqrtd.to_real</span><span class=\"o\">],</span>\n  <span class=\"gr\">sorry</span>\n<span class=\"kd\">end</span>\n</code></pre></div>",
        "id": 222153711,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1610167579
    },
    {
        "content": "<p>the proof of the sorry should be very short, just unpacking and repacking the real and imaginary parts</p>",
        "id": 222153726,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1610167614
    },
    {
        "content": "<p>By the way, the <code>re</code> and <code>im</code> aren't actually referring to complex numbers here</p>",
        "id": 222153733,
        "sender_full_name": "Thomas Browning",
        "timestamp": 1610167643
    },
    {
        "content": "<p>If you look at zsqrtd/basic.lean, you see this:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"sd\">/-- The ring of integers adjoined with a square root of `d`.</span>\n<span class=\"sd\">  These have the form `a + b √d` where `a b : ℤ`. The components</span>\n<span class=\"sd\">  are called `re` and `im` by analogy to the negative `d` case,</span>\n<span class=\"sd\">  but of course both parts are real here since `d` is nonnegative. -/</span>\n<span class=\"kd\">structure</span> <span class=\"n\">zsqrtd</span> <span class=\"o\">(</span><span class=\"n\">d</span> <span class=\"o\">:</span> <span class=\"n\">ℤ</span><span class=\"o\">)</span> <span class=\"o\">:=</span>\n<span class=\"o\">(</span><span class=\"n\">re</span> <span class=\"o\">:</span> <span class=\"n\">ℤ</span><span class=\"o\">)</span>\n<span class=\"o\">(</span><span class=\"n\">im</span> <span class=\"o\">:</span> <span class=\"n\">ℤ</span><span class=\"o\">)</span>\n</code></pre></div>",
        "id": 222153748,
        "sender_full_name": "Thomas Browning",
        "timestamp": 1610167661
    },
    {
        "content": "<p>so the <code>re</code> and <code>im</code> are referring to the <code>a</code> and the <code>b</code> in <code>a + b √d</code></p>",
        "id": 222153793,
        "sender_full_name": "Thomas Browning",
        "timestamp": 1610167688
    },
    {
        "content": "<p>I have reached an absurdity.  It is asking me to prove <code>⊢ a = b ∨ real.sqrt 3 = 0</code> after the <code>simp *</code>:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kn\">import</span> <span class=\"n\">data.zsqrtd.basic</span>\n<span class=\"kn\">import</span> <span class=\"n\">ring_theory.subring</span>\n<span class=\"kn\">import</span> <span class=\"n\">data.real.basic</span>\n<span class=\"kn\">import</span> <span class=\"n\">analysis.special_functions.pow</span>\n\n\n<span class=\"sd\">/-- The image of `zsqrtd` in `ℝ`.  -/</span>  <span class=\"c1\">-- Eric Wieser</span>\n<span class=\"kd\">@[simps]</span>\n<span class=\"kd\">noncomputable</span> <span class=\"kd\">def</span> <span class=\"n\">zsqrtd.to_real</span> <span class=\"o\">{</span><span class=\"n\">d</span> <span class=\"o\">:</span> <span class=\"n\">ℤ</span> <span class=\"o\">}</span> <span class=\"o\">(</span><span class=\"n\">h</span> <span class=\"o\">:</span> <span class=\"mi\">0</span> <span class=\"bp\">≤</span> <span class=\"n\">d</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">ℤ</span><span class=\"bp\">√</span><span class=\"n\">d</span> <span class=\"bp\">→+*</span> <span class=\"n\">ℝ</span> <span class=\"o\">:=</span> <span class=\"o\">{</span>\n  <span class=\"n\">to_fun</span> <span class=\"o\">:=</span> <span class=\"bp\">λ</span> <span class=\"n\">a</span><span class=\"o\">,</span> <span class=\"n\">a.1</span> <span class=\"bp\">+</span> <span class=\"n\">a.2</span><span class=\"bp\">*</span><span class=\"n\">real.sqrt</span> <span class=\"n\">d</span><span class=\"o\">,</span>\n  <span class=\"n\">map_zero'</span> <span class=\"o\">:=</span> <span class=\"kd\">by</span> <span class=\"n\">simp</span><span class=\"o\">,</span>\n  <span class=\"n\">map_add'</span> <span class=\"o\">:=</span> <span class=\"bp\">λ</span> <span class=\"n\">a</span> <span class=\"n\">b</span><span class=\"o\">,</span> <span class=\"kd\">by</span> <span class=\"o\">{</span> <span class=\"n\">simp</span><span class=\"o\">,</span> <span class=\"n\">ring</span><span class=\"o\">,</span> <span class=\"o\">},</span>\n  <span class=\"n\">map_one'</span> <span class=\"o\">:=</span> <span class=\"kd\">by</span> <span class=\"n\">simp</span><span class=\"o\">,</span>\n  <span class=\"n\">map_mul'</span> <span class=\"o\">:=</span> <span class=\"bp\">λ</span> <span class=\"n\">a</span> <span class=\"n\">b</span><span class=\"o\">,</span> <span class=\"kd\">by</span> <span class=\"o\">{</span>\n    <span class=\"k\">have</span> <span class=\"o\">:</span> <span class=\"o\">(</span><span class=\"bp\">↑</span><span class=\"n\">a.re</span> <span class=\"bp\">+</span> <span class=\"bp\">↑</span><span class=\"n\">a.im</span> <span class=\"bp\">*</span> <span class=\"n\">real.sqrt</span> <span class=\"n\">d</span><span class=\"o\">)</span> <span class=\"bp\">*</span> <span class=\"o\">(</span><span class=\"bp\">↑</span><span class=\"n\">b.re</span> <span class=\"bp\">+</span> <span class=\"bp\">↑</span><span class=\"n\">b.im</span> <span class=\"bp\">*</span> <span class=\"n\">real.sqrt</span> <span class=\"n\">d</span><span class=\"o\">)</span> <span class=\"bp\">=</span>\n             <span class=\"bp\">↑</span><span class=\"n\">a.re</span> <span class=\"bp\">*</span> <span class=\"bp\">↑</span><span class=\"n\">b.re</span> <span class=\"bp\">+</span> <span class=\"o\">(</span><span class=\"bp\">↑</span><span class=\"n\">a.re</span> <span class=\"bp\">*</span> <span class=\"bp\">↑</span><span class=\"n\">b.im</span> <span class=\"bp\">+</span> <span class=\"bp\">↑</span><span class=\"n\">a.im</span> <span class=\"bp\">*</span> <span class=\"bp\">↑</span><span class=\"n\">b.re</span><span class=\"o\">)</span> <span class=\"bp\">*</span> <span class=\"n\">real.sqrt</span> <span class=\"n\">d</span>\n                           <span class=\"bp\">+</span> <span class=\"bp\">↑</span><span class=\"n\">a.im</span> <span class=\"bp\">*</span> <span class=\"bp\">↑</span><span class=\"n\">b.im</span> <span class=\"bp\">*</span> <span class=\"o\">(</span><span class=\"n\">real.sqrt</span> <span class=\"n\">d</span> <span class=\"bp\">*</span> <span class=\"n\">real.sqrt</span> <span class=\"n\">d</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"kd\">by</span> <span class=\"n\">ring</span><span class=\"o\">,</span>\n    <span class=\"n\">simp</span> <span class=\"o\">[</span><span class=\"n\">this</span><span class=\"o\">,</span> <span class=\"n\">real.mul_self_sqrt</span> <span class=\"o\">(</span><span class=\"n\">int.cast_nonneg.mpr</span> <span class=\"n\">h</span><span class=\"o\">)],</span>\n    <span class=\"n\">ring</span><span class=\"o\">,</span> <span class=\"o\">}</span> <span class=\"o\">}</span>\n\n<span class=\"kd\">abbreviation</span> <span class=\"n\">is_an_integral_domain</span> <span class=\"o\">{</span><span class=\"n\">α</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span> <span class=\"o\">[</span><span class=\"n\">ring</span> <span class=\"n\">α</span><span class=\"o\">]</span> <span class=\"o\">(</span><span class=\"n\">s</span> <span class=\"o\">:</span> <span class=\"n\">set</span> <span class=\"n\">α</span><span class=\"o\">)</span> <span class=\"o\">:=</span>\n  <span class=\"bp\">∃</span> <span class=\"o\">(</span><span class=\"n\">sr</span> <span class=\"o\">:</span> <span class=\"n\">subring</span> <span class=\"n\">α</span><span class=\"o\">)</span> <span class=\"o\">[</span><span class=\"n\">integral_domain</span> <span class=\"n\">sr</span><span class=\"o\">],</span> <span class=\"n\">s</span> <span class=\"bp\">=</span> <span class=\"n\">sr</span>\n\n<span class=\"kd\">lemma</span> <span class=\"n\">fourth_root_of_nine_equals_sqrt_3</span> <span class=\"o\">:</span> <span class=\"o\">(</span><span class=\"mi\">9</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">)</span> <span class=\"bp\">^</span> <span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"bp\">/</span><span class=\"mi\">4</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">)</span> <span class=\"bp\">=</span> <span class=\"n\">real.sqrt</span> <span class=\"mi\">3</span> <span class=\"o\">:=</span> <span class=\"gr\">sorry</span>\n\n<span class=\"kd\">theorem</span> <span class=\"n\">ex6e</span> <span class=\"o\">:</span> <span class=\"n\">is_an_integral_domain</span> <span class=\"o\">{</span><span class=\"n\">x</span> <span class=\"o\">:</span> <span class=\"n\">ℝ</span> <span class=\"bp\">|</span> <span class=\"bp\">∃</span> <span class=\"n\">a</span> <span class=\"n\">b</span> <span class=\"o\">:</span> <span class=\"n\">ℤ</span><span class=\"o\">,</span> <span class=\"n\">x</span> <span class=\"bp\">=</span> <span class=\"n\">a</span> <span class=\"bp\">+</span> <span class=\"n\">b</span> <span class=\"bp\">*</span> <span class=\"o\">(</span><span class=\"mi\">9</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">)</span> <span class=\"bp\">^</span> <span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"bp\">/</span><span class=\"mi\">4</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">)}</span> <span class=\"o\">:=</span>\n<span class=\"kd\">begin</span>\n  <span class=\"n\">refine</span> <span class=\"o\">⟨(</span><span class=\"n\">zsqrtd.to_real</span> <span class=\"o\">(</span><span class=\"k\">show</span> <span class=\"mi\">0</span> <span class=\"bp\">≤</span> <span class=\"o\">(</span><span class=\"mi\">3</span> <span class=\"o\">:</span> <span class=\"n\">ℤ</span><span class=\"o\">),</span> <span class=\"kd\">by</span> <span class=\"n\">norm_num</span><span class=\"o\">))</span><span class=\"bp\">.</span><span class=\"n\">range</span><span class=\"o\">,</span> <span class=\"n\">_</span><span class=\"o\">,</span> <span class=\"n\">_</span><span class=\"o\">⟩,</span>\n  <span class=\"n\">apply_instance</span><span class=\"o\">,</span>\n  <span class=\"n\">ext</span><span class=\"o\">,</span>\n  <span class=\"n\">rw</span> <span class=\"o\">[</span><span class=\"n\">fourth_root_of_nine_equals_sqrt_3</span><span class=\"o\">],</span>\n  <span class=\"n\">simp</span> <span class=\"o\">[</span><span class=\"n\">zsqrtd.to_real</span><span class=\"o\">],</span>\n  <span class=\"n\">split</span><span class=\"o\">,</span>\n  <span class=\"o\">{</span>\n    <span class=\"n\">intro</span> <span class=\"n\">h1</span><span class=\"o\">,</span>\n    <span class=\"n\">cases</span> <span class=\"n\">h1</span> <span class=\"k\">with</span> <span class=\"n\">a</span> <span class=\"n\">ha</span><span class=\"o\">,</span>\n    <span class=\"n\">cases</span> <span class=\"n\">ha</span> <span class=\"k\">with</span> <span class=\"n\">b</span> <span class=\"n\">hb</span><span class=\"o\">,</span>\n    <span class=\"n\">apply</span> <span class=\"n\">exists.intro</span><span class=\"o\">,</span>\n    <span class=\"n\">rw</span> <span class=\"n\">hb</span><span class=\"o\">,</span>\n    <span class=\"n\">rotate</span><span class=\"o\">,</span>\n    <span class=\"n\">exact</span> <span class=\"o\">{</span><span class=\"n\">re</span> <span class=\"o\">:=</span> <span class=\"n\">a</span><span class=\"o\">,</span> <span class=\"n\">im</span> <span class=\"o\">:=</span> <span class=\"n\">a</span><span class=\"o\">},</span>\n    <span class=\"n\">simp</span> <span class=\"bp\">*</span><span class=\"o\">,</span>\n    <span class=\"c1\">-- ⊢ a = b ∨ real.sqrt 3 = 0</span>\n  <span class=\"o\">},</span>\n  <span class=\"o\">{</span>\n    <span class=\"gr\">sorry</span><span class=\"o\">,</span>\n  <span class=\"o\">}</span>\n<span class=\"kd\">end</span>\n</code></pre></div>",
        "id": 222173585,
        "sender_full_name": "Lars Ericson",
        "timestamp": 1610203089
    },
    {
        "content": "<p>Do you know the maths proof of what you're trying to prove? Lean won't figure out the ideas, it will just check them.</p>",
        "id": 222173656,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1610203236
    },
    {
        "content": "<p>I think the maths proof by the time you reach the <code>split</code> is \"both sides are obviously the same\"</p>",
        "id": 222173776,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1610203483
    },
    {
        "content": "<p>But in this case, your mistake is the <code>exact</code> line</p>",
        "id": 222173787,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1610203537
    },
    {
        "content": "<p>It should read <code>im := b</code></p>",
        "id": 222173791,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1610203561
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"110038\">@Kevin Buzzard</span>  what I actually wanted to prove is that the ring is closed under addition and multiplication as defined by <code>&lt;a,b&gt;+&lt;c,d&gt;=&lt;a+b,c+d&gt;</code> and <code>&lt;a,b&gt;*&lt;c,d&gt; = &lt;a*c+3*b*d, a*d+b*c&gt;</code>.  In the recent above I am following expert suggestions which do not map directly to my original intuition.</p>",
        "id": 222173971,
        "sender_full_name": "Lars Ericson",
        "timestamp": 1610203807
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"310045\">@Eric Wieser</span> I don't know the syntax to assign directly to the components of the goal.  This doesn't work:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"n\">exact</span> <span class=\"o\">{</span> <span class=\"n\">im</span> <span class=\"o\">:=</span> <span class=\"n\">b</span> <span class=\"o\">},</span>\n</code></pre></div>\n<p>where the goal is</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"bp\">⊢</span> <span class=\"bp\">↑</span><span class=\"o\">(</span><span class=\"bp\">?</span><span class=\"n\">m_1.re</span><span class=\"o\">)</span> <span class=\"bp\">+</span> <span class=\"bp\">↑</span><span class=\"o\">(</span><span class=\"bp\">?</span><span class=\"n\">m_1.im</span><span class=\"o\">)</span> <span class=\"bp\">*</span> <span class=\"n\">real.sqrt</span> <span class=\"mi\">3</span> <span class=\"bp\">=</span> <span class=\"bp\">↑</span><span class=\"n\">a</span> <span class=\"bp\">+</span> <span class=\"bp\">↑</span><span class=\"n\">b</span> <span class=\"bp\">*</span> <span class=\"n\">real.sqrt</span> <span class=\"mi\">3</span>\n</code></pre></div>",
        "id": 222174005,
        "sender_full_name": "Lars Ericson",
        "timestamp": 1610203903
    },
    {
        "content": "<p>You already have <code>im := a</code> in your example code</p>",
        "id": 222174214,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1610204225
    },
    {
        "content": "<p>Just change the a for a b</p>",
        "id": 222174216,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1610204231
    },
    {
        "content": "<p><code>congr</code> would probably also solve that goal</p>",
        "id": 222174223,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1610204269
    },
    {
        "content": "<p>I think <code>apply exists.intro</code> is a recurring wrong choice you seen to be taking. When you're faced with an existential, your strategy should be to think of the maths proof and work out which object to provide; then use <a href=\"https://leanprover-community.github.io/mathlib_docs/tactics.html#use\">tactic#use</a></p>",
        "id": 222174410,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1610204526
    },
    {
        "content": "<p>Thank you <span class=\"user-mention\" data-user-id=\"310045\">@Eric Wieser</span> I will follow the advice on <code>exists.intro</code>.</p>",
        "id": 222176989,
        "sender_full_name": "Lars Ericson",
        "timestamp": 1610209003
    },
    {
        "content": "<p>I got farther on the first half of the split.  </p>\n<p>On the second half, I'm trying to make  <code>y=0 + 0 * sqrt(3)</code> and apply it on the <code>exist</code> which is in the assumptions.  It's not going through, I don't know the syntax:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kn\">import</span> <span class=\"n\">data.zsqrtd.basic</span>\n<span class=\"kn\">import</span> <span class=\"n\">ring_theory.subring</span>\n<span class=\"kn\">import</span> <span class=\"n\">data.real.basic</span>\n<span class=\"kn\">import</span> <span class=\"n\">analysis.special_functions.pow</span>\n\n\n<span class=\"sd\">/-- The image of `zsqrtd` in `ℝ`.  -/</span>  <span class=\"c1\">-- Eric Wieser</span>\n<span class=\"kd\">@[simps]</span>\n<span class=\"kd\">noncomputable</span> <span class=\"kd\">def</span> <span class=\"n\">zsqrtd.to_real</span> <span class=\"o\">{</span><span class=\"n\">d</span> <span class=\"o\">:</span> <span class=\"n\">ℤ</span> <span class=\"o\">}</span> <span class=\"o\">(</span><span class=\"n\">h</span> <span class=\"o\">:</span> <span class=\"mi\">0</span> <span class=\"bp\">≤</span> <span class=\"n\">d</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">ℤ</span><span class=\"bp\">√</span><span class=\"n\">d</span> <span class=\"bp\">→+*</span> <span class=\"n\">ℝ</span> <span class=\"o\">:=</span> <span class=\"o\">{</span>\n  <span class=\"n\">to_fun</span> <span class=\"o\">:=</span> <span class=\"bp\">λ</span> <span class=\"n\">a</span><span class=\"o\">,</span> <span class=\"n\">a.1</span> <span class=\"bp\">+</span> <span class=\"n\">a.2</span><span class=\"bp\">*</span><span class=\"n\">real.sqrt</span> <span class=\"n\">d</span><span class=\"o\">,</span>\n  <span class=\"n\">map_zero'</span> <span class=\"o\">:=</span> <span class=\"kd\">by</span> <span class=\"n\">simp</span><span class=\"o\">,</span>\n  <span class=\"n\">map_add'</span> <span class=\"o\">:=</span> <span class=\"bp\">λ</span> <span class=\"n\">a</span> <span class=\"n\">b</span><span class=\"o\">,</span> <span class=\"kd\">by</span> <span class=\"o\">{</span> <span class=\"n\">simp</span><span class=\"o\">,</span> <span class=\"n\">ring</span><span class=\"o\">,</span> <span class=\"o\">},</span>\n  <span class=\"n\">map_one'</span> <span class=\"o\">:=</span> <span class=\"kd\">by</span> <span class=\"n\">simp</span><span class=\"o\">,</span>\n  <span class=\"n\">map_mul'</span> <span class=\"o\">:=</span> <span class=\"bp\">λ</span> <span class=\"n\">a</span> <span class=\"n\">b</span><span class=\"o\">,</span> <span class=\"kd\">by</span> <span class=\"o\">{</span>\n    <span class=\"k\">have</span> <span class=\"o\">:</span> <span class=\"o\">(</span><span class=\"bp\">↑</span><span class=\"n\">a.re</span> <span class=\"bp\">+</span> <span class=\"bp\">↑</span><span class=\"n\">a.im</span> <span class=\"bp\">*</span> <span class=\"n\">real.sqrt</span> <span class=\"n\">d</span><span class=\"o\">)</span> <span class=\"bp\">*</span> <span class=\"o\">(</span><span class=\"bp\">↑</span><span class=\"n\">b.re</span> <span class=\"bp\">+</span> <span class=\"bp\">↑</span><span class=\"n\">b.im</span> <span class=\"bp\">*</span> <span class=\"n\">real.sqrt</span> <span class=\"n\">d</span><span class=\"o\">)</span> <span class=\"bp\">=</span>\n             <span class=\"bp\">↑</span><span class=\"n\">a.re</span> <span class=\"bp\">*</span> <span class=\"bp\">↑</span><span class=\"n\">b.re</span> <span class=\"bp\">+</span> <span class=\"o\">(</span><span class=\"bp\">↑</span><span class=\"n\">a.re</span> <span class=\"bp\">*</span> <span class=\"bp\">↑</span><span class=\"n\">b.im</span> <span class=\"bp\">+</span> <span class=\"bp\">↑</span><span class=\"n\">a.im</span> <span class=\"bp\">*</span> <span class=\"bp\">↑</span><span class=\"n\">b.re</span><span class=\"o\">)</span> <span class=\"bp\">*</span> <span class=\"n\">real.sqrt</span> <span class=\"n\">d</span>\n                           <span class=\"bp\">+</span> <span class=\"bp\">↑</span><span class=\"n\">a.im</span> <span class=\"bp\">*</span> <span class=\"bp\">↑</span><span class=\"n\">b.im</span> <span class=\"bp\">*</span> <span class=\"o\">(</span><span class=\"n\">real.sqrt</span> <span class=\"n\">d</span> <span class=\"bp\">*</span> <span class=\"n\">real.sqrt</span> <span class=\"n\">d</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"kd\">by</span> <span class=\"n\">ring</span><span class=\"o\">,</span>\n    <span class=\"n\">simp</span> <span class=\"o\">[</span><span class=\"n\">this</span><span class=\"o\">,</span> <span class=\"n\">real.mul_self_sqrt</span> <span class=\"o\">(</span><span class=\"n\">int.cast_nonneg.mpr</span> <span class=\"n\">h</span><span class=\"o\">)],</span>\n    <span class=\"n\">ring</span><span class=\"o\">,</span> <span class=\"o\">}</span> <span class=\"o\">}</span>\n\n<span class=\"kd\">abbreviation</span> <span class=\"n\">is_an_integral_domain</span> <span class=\"o\">{</span><span class=\"n\">α</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span> <span class=\"o\">[</span><span class=\"n\">ring</span> <span class=\"n\">α</span><span class=\"o\">]</span> <span class=\"o\">(</span><span class=\"n\">s</span> <span class=\"o\">:</span> <span class=\"n\">set</span> <span class=\"n\">α</span><span class=\"o\">)</span> <span class=\"o\">:=</span>\n  <span class=\"bp\">∃</span> <span class=\"o\">(</span><span class=\"n\">sr</span> <span class=\"o\">:</span> <span class=\"n\">subring</span> <span class=\"n\">α</span><span class=\"o\">)</span> <span class=\"o\">[</span><span class=\"n\">integral_domain</span> <span class=\"n\">sr</span><span class=\"o\">],</span> <span class=\"n\">s</span> <span class=\"bp\">=</span> <span class=\"n\">sr</span>\n\n<span class=\"kd\">lemma</span> <span class=\"n\">fourth_root_of_nine_equals_sqrt_3</span> <span class=\"o\">:</span> <span class=\"o\">(</span><span class=\"mi\">9</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">)</span> <span class=\"bp\">^</span> <span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"bp\">/</span><span class=\"mi\">4</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">)</span> <span class=\"bp\">=</span> <span class=\"n\">real.sqrt</span> <span class=\"mi\">3</span> <span class=\"o\">:=</span> <span class=\"gr\">sorry</span>\n\n<span class=\"kd\">theorem</span> <span class=\"n\">ex6e</span> <span class=\"o\">:</span> <span class=\"n\">is_an_integral_domain</span> <span class=\"o\">{</span><span class=\"n\">x</span> <span class=\"o\">:</span> <span class=\"n\">ℝ</span> <span class=\"bp\">|</span> <span class=\"bp\">∃</span> <span class=\"n\">a</span> <span class=\"n\">b</span> <span class=\"o\">:</span> <span class=\"n\">ℤ</span><span class=\"o\">,</span> <span class=\"n\">x</span> <span class=\"bp\">=</span> <span class=\"n\">a</span> <span class=\"bp\">+</span> <span class=\"n\">b</span> <span class=\"bp\">*</span> <span class=\"o\">(</span><span class=\"mi\">9</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">)</span> <span class=\"bp\">^</span> <span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"bp\">/</span><span class=\"mi\">4</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">)}</span> <span class=\"o\">:=</span>\n<span class=\"kd\">begin</span>\n  <span class=\"n\">refine</span> <span class=\"o\">⟨(</span><span class=\"n\">zsqrtd.to_real</span> <span class=\"o\">(</span><span class=\"k\">show</span> <span class=\"mi\">0</span> <span class=\"bp\">≤</span> <span class=\"o\">(</span><span class=\"mi\">3</span> <span class=\"o\">:</span> <span class=\"n\">ℤ</span><span class=\"o\">),</span> <span class=\"kd\">by</span> <span class=\"n\">norm_num</span><span class=\"o\">))</span><span class=\"bp\">.</span><span class=\"n\">range</span><span class=\"o\">,</span> <span class=\"n\">_</span><span class=\"o\">,</span> <span class=\"n\">_</span><span class=\"o\">⟩,</span>\n  <span class=\"n\">apply_instance</span><span class=\"o\">,</span>\n  <span class=\"n\">ext</span><span class=\"o\">,</span>\n  <span class=\"n\">rw</span> <span class=\"o\">[</span><span class=\"n\">fourth_root_of_nine_equals_sqrt_3</span><span class=\"o\">],</span>\n  <span class=\"n\">simp</span> <span class=\"o\">[</span><span class=\"n\">zsqrtd.to_real</span><span class=\"o\">],</span>\n  <span class=\"n\">split</span><span class=\"o\">,</span>\n  <span class=\"o\">{</span>\n    <span class=\"n\">intro</span> <span class=\"n\">h1</span><span class=\"o\">,</span>\n    <span class=\"n\">cases</span> <span class=\"n\">h1</span> <span class=\"k\">with</span> <span class=\"n\">a</span> <span class=\"n\">ha</span><span class=\"o\">,</span>\n    <span class=\"n\">cases</span> <span class=\"n\">ha</span> <span class=\"k\">with</span> <span class=\"n\">b</span> <span class=\"n\">hb</span><span class=\"o\">,</span>\n    <span class=\"n\">use</span> <span class=\"o\">{</span><span class=\"n\">re</span> <span class=\"o\">:=</span> <span class=\"n\">a</span><span class=\"o\">,</span> <span class=\"n\">im</span> <span class=\"o\">:=</span> <span class=\"n\">b</span><span class=\"o\">},</span>\n    <span class=\"n\">rw</span> <span class=\"n\">hb</span><span class=\"o\">,</span>\n  <span class=\"o\">},</span>\n  <span class=\"o\">{</span>\n    <span class=\"n\">intro</span> <span class=\"n\">h</span><span class=\"o\">,</span>\n    <span class=\"n\">use</span> <span class=\"mi\">0</span><span class=\"o\">,</span>\n    <span class=\"n\">use</span> <span class=\"mi\">0</span><span class=\"o\">,</span>\n    <span class=\"n\">simp</span> <span class=\"bp\">*</span><span class=\"o\">,</span>\n    <span class=\"k\">have</span> <span class=\"n\">y</span> <span class=\"o\">:</span> <span class=\"n\">ℤ</span><span class=\"bp\">√</span><span class=\"mi\">3</span> <span class=\"o\">:=</span> <span class=\"o\">{</span><span class=\"n\">re</span> <span class=\"o\">:=</span> <span class=\"mi\">0</span><span class=\"o\">,</span> <span class=\"n\">im</span> <span class=\"o\">:=</span> <span class=\"mi\">0</span><span class=\"o\">},</span>\n    <span class=\"k\">have</span> <span class=\"n\">h3</span> <span class=\"o\">:=</span> <span class=\"n\">h</span> <span class=\"n\">y</span><span class=\"o\">,</span> <span class=\"c1\">-- ERROR</span>\n  <span class=\"o\">}</span>\n<span class=\"kd\">end</span>\n</code></pre></div>\n<p>The goal state is</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"n\">x</span><span class=\"o\">:</span> <span class=\"n\">ℝ</span>\n<span class=\"n\">h</span><span class=\"o\">:</span> <span class=\"bp\">∃</span> <span class=\"o\">(</span><span class=\"n\">y</span> <span class=\"o\">:</span> <span class=\"n\">ℤ</span><span class=\"bp\">√</span><span class=\"mi\">3</span><span class=\"o\">),</span> <span class=\"bp\">↑</span><span class=\"o\">(</span><span class=\"n\">y.re</span><span class=\"o\">)</span> <span class=\"bp\">+</span> <span class=\"bp\">↑</span><span class=\"o\">(</span><span class=\"n\">y.im</span><span class=\"o\">)</span> <span class=\"bp\">*</span> <span class=\"n\">real.sqrt</span> <span class=\"mi\">3</span> <span class=\"bp\">=</span> <span class=\"n\">x</span>\n<span class=\"n\">y</span><span class=\"o\">:</span> <span class=\"n\">ℤ</span><span class=\"bp\">√</span><span class=\"mi\">3</span>\n<span class=\"bp\">⊢</span> <span class=\"n\">x</span> <span class=\"bp\">=</span> <span class=\"mi\">0</span>\n</code></pre></div>",
        "id": 222183138,
        "sender_full_name": "Lars Ericson",
        "timestamp": 1610217456
    },
    {
        "content": "<p>Why did you <code>use 0</code>?</p>",
        "id": 222183579,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1610217967
    },
    {
        "content": "<p>Your goal state is unprovable because you used the wrong value</p>",
        "id": 222183704,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1610218181
    },
    {
        "content": "<p>What was the goal state before the first <code>use 0</code>?</p>",
        "id": 222183752,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1610218203
    },
    {
        "content": "<p>I'm at this tactic state:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"mi\">1</span> <span class=\"n\">goal</span>\n<span class=\"n\">x</span><span class=\"o\">:</span> <span class=\"n\">ℝ</span>\n<span class=\"n\">y</span><span class=\"o\">:</span> <span class=\"n\">ℤ</span><span class=\"bp\">√</span><span class=\"mi\">3</span>\n<span class=\"n\">hy</span><span class=\"o\">:</span> <span class=\"bp\">↑</span><span class=\"o\">(</span><span class=\"n\">y.re</span><span class=\"o\">)</span> <span class=\"bp\">+</span> <span class=\"bp\">↑</span><span class=\"o\">(</span><span class=\"n\">y.im</span><span class=\"o\">)</span> <span class=\"bp\">*</span> <span class=\"n\">real.sqrt</span> <span class=\"mi\">3</span> <span class=\"bp\">=</span> <span class=\"n\">x</span>\n<span class=\"bp\">⊢</span> <span class=\"bp\">∃</span> <span class=\"o\">(</span><span class=\"n\">a</span> <span class=\"n\">b</span> <span class=\"o\">:</span> <span class=\"n\">ℤ</span><span class=\"o\">),</span> <span class=\"bp\">↑</span><span class=\"o\">(</span><span class=\"n\">y.re</span><span class=\"o\">)</span> <span class=\"bp\">+</span> <span class=\"bp\">↑</span><span class=\"o\">(</span><span class=\"n\">y.im</span><span class=\"o\">)</span> <span class=\"bp\">*</span> <span class=\"n\">real.sqrt</span> <span class=\"mi\">3</span> <span class=\"bp\">=</span> <span class=\"bp\">↑</span><span class=\"n\">a</span> <span class=\"bp\">+</span> <span class=\"bp\">↑</span><span class=\"n\">b</span> <span class=\"bp\">*</span> <span class=\"n\">real.sqrt</span> <span class=\"mi\">3</span>\n</code></pre></div>\n<p>I want to set <code>y.re</code> to <code>a</code> and <code>y.im</code> to <code>b</code>.  using something like</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"k\">have</span> <span class=\"n\">y</span><span class=\"o\">:</span><span class=\"n\">ℤ</span><span class=\"bp\">√</span><span class=\"mi\">3</span> <span class=\"o\">:=</span> <span class=\"n\">a</span> <span class=\"bp\">+</span> <span class=\"n\">b</span> <span class=\"bp\">*</span> <span class=\"n\">real.sqrt</span> <span class=\"mi\">3</span><span class=\"o\">,</span>\n</code></pre></div>\n<p>and have that get applied  to the goal to replace <code>y.re</code> with <code>a</code> and <code>y.im</code> with <code>b</code>.  I don't know how to do it.  This is just before the <code>sorry</code> in</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kn\">import</span> <span class=\"n\">data.zsqrtd.basic</span>\n<span class=\"kn\">import</span> <span class=\"n\">ring_theory.subring</span>\n<span class=\"kn\">import</span> <span class=\"n\">data.real.basic</span>\n<span class=\"kn\">import</span> <span class=\"n\">analysis.special_functions.pow</span>\n\n\n<span class=\"sd\">/-- The image of `zsqrtd` in `ℝ`.  -/</span>  <span class=\"c1\">-- Eric Wieser</span>\n<span class=\"kd\">@[simps]</span>\n<span class=\"kd\">noncomputable</span> <span class=\"kd\">def</span> <span class=\"n\">zsqrtd.to_real</span> <span class=\"o\">{</span><span class=\"n\">d</span> <span class=\"o\">:</span> <span class=\"n\">ℤ</span> <span class=\"o\">}</span> <span class=\"o\">(</span><span class=\"n\">h</span> <span class=\"o\">:</span> <span class=\"mi\">0</span> <span class=\"bp\">≤</span> <span class=\"n\">d</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">ℤ</span><span class=\"bp\">√</span><span class=\"n\">d</span> <span class=\"bp\">→+*</span> <span class=\"n\">ℝ</span> <span class=\"o\">:=</span> <span class=\"o\">{</span>\n  <span class=\"n\">to_fun</span> <span class=\"o\">:=</span> <span class=\"bp\">λ</span> <span class=\"n\">a</span><span class=\"o\">,</span> <span class=\"n\">a.1</span> <span class=\"bp\">+</span> <span class=\"n\">a.2</span><span class=\"bp\">*</span><span class=\"n\">real.sqrt</span> <span class=\"n\">d</span><span class=\"o\">,</span>\n  <span class=\"n\">map_zero'</span> <span class=\"o\">:=</span> <span class=\"kd\">by</span> <span class=\"n\">simp</span><span class=\"o\">,</span>\n  <span class=\"n\">map_add'</span> <span class=\"o\">:=</span> <span class=\"bp\">λ</span> <span class=\"n\">a</span> <span class=\"n\">b</span><span class=\"o\">,</span> <span class=\"kd\">by</span> <span class=\"o\">{</span> <span class=\"n\">simp</span><span class=\"o\">,</span> <span class=\"n\">ring</span><span class=\"o\">,</span> <span class=\"o\">},</span>\n  <span class=\"n\">map_one'</span> <span class=\"o\">:=</span> <span class=\"kd\">by</span> <span class=\"n\">simp</span><span class=\"o\">,</span>\n  <span class=\"n\">map_mul'</span> <span class=\"o\">:=</span> <span class=\"bp\">λ</span> <span class=\"n\">a</span> <span class=\"n\">b</span><span class=\"o\">,</span> <span class=\"kd\">by</span> <span class=\"o\">{</span>\n    <span class=\"k\">have</span> <span class=\"o\">:</span> <span class=\"o\">(</span><span class=\"bp\">↑</span><span class=\"n\">a.re</span> <span class=\"bp\">+</span> <span class=\"bp\">↑</span><span class=\"n\">a.im</span> <span class=\"bp\">*</span> <span class=\"n\">real.sqrt</span> <span class=\"n\">d</span><span class=\"o\">)</span> <span class=\"bp\">*</span> <span class=\"o\">(</span><span class=\"bp\">↑</span><span class=\"n\">b.re</span> <span class=\"bp\">+</span> <span class=\"bp\">↑</span><span class=\"n\">b.im</span> <span class=\"bp\">*</span> <span class=\"n\">real.sqrt</span> <span class=\"n\">d</span><span class=\"o\">)</span> <span class=\"bp\">=</span>\n             <span class=\"bp\">↑</span><span class=\"n\">a.re</span> <span class=\"bp\">*</span> <span class=\"bp\">↑</span><span class=\"n\">b.re</span> <span class=\"bp\">+</span> <span class=\"o\">(</span><span class=\"bp\">↑</span><span class=\"n\">a.re</span> <span class=\"bp\">*</span> <span class=\"bp\">↑</span><span class=\"n\">b.im</span> <span class=\"bp\">+</span> <span class=\"bp\">↑</span><span class=\"n\">a.im</span> <span class=\"bp\">*</span> <span class=\"bp\">↑</span><span class=\"n\">b.re</span><span class=\"o\">)</span> <span class=\"bp\">*</span> <span class=\"n\">real.sqrt</span> <span class=\"n\">d</span>\n                           <span class=\"bp\">+</span> <span class=\"bp\">↑</span><span class=\"n\">a.im</span> <span class=\"bp\">*</span> <span class=\"bp\">↑</span><span class=\"n\">b.im</span> <span class=\"bp\">*</span> <span class=\"o\">(</span><span class=\"n\">real.sqrt</span> <span class=\"n\">d</span> <span class=\"bp\">*</span> <span class=\"n\">real.sqrt</span> <span class=\"n\">d</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"kd\">by</span> <span class=\"n\">ring</span><span class=\"o\">,</span>\n    <span class=\"n\">simp</span> <span class=\"o\">[</span><span class=\"n\">this</span><span class=\"o\">,</span> <span class=\"n\">real.mul_self_sqrt</span> <span class=\"o\">(</span><span class=\"n\">int.cast_nonneg.mpr</span> <span class=\"n\">h</span><span class=\"o\">)],</span>\n    <span class=\"n\">ring</span><span class=\"o\">,</span> <span class=\"o\">}</span> <span class=\"o\">}</span>\n\n<span class=\"kd\">abbreviation</span> <span class=\"n\">is_an_integral_domain</span> <span class=\"o\">{</span><span class=\"n\">α</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span> <span class=\"o\">[</span><span class=\"n\">ring</span> <span class=\"n\">α</span><span class=\"o\">]</span> <span class=\"o\">(</span><span class=\"n\">s</span> <span class=\"o\">:</span> <span class=\"n\">set</span> <span class=\"n\">α</span><span class=\"o\">)</span> <span class=\"o\">:=</span>\n  <span class=\"bp\">∃</span> <span class=\"o\">(</span><span class=\"n\">sr</span> <span class=\"o\">:</span> <span class=\"n\">subring</span> <span class=\"n\">α</span><span class=\"o\">)</span> <span class=\"o\">[</span><span class=\"n\">integral_domain</span> <span class=\"n\">sr</span><span class=\"o\">],</span> <span class=\"n\">s</span> <span class=\"bp\">=</span> <span class=\"n\">sr</span>\n\n<span class=\"kd\">lemma</span> <span class=\"n\">fourth_root_of_nine_equals_sqrt_3</span> <span class=\"o\">:</span> <span class=\"o\">(</span><span class=\"mi\">9</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">)</span> <span class=\"bp\">^</span> <span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"bp\">/</span><span class=\"mi\">4</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">)</span> <span class=\"bp\">=</span> <span class=\"n\">real.sqrt</span> <span class=\"mi\">3</span> <span class=\"o\">:=</span> <span class=\"gr\">sorry</span>\n\n<span class=\"kd\">theorem</span> <span class=\"n\">ex6e</span> <span class=\"o\">:</span> <span class=\"n\">is_an_integral_domain</span> <span class=\"o\">{</span><span class=\"n\">x</span> <span class=\"o\">:</span> <span class=\"n\">ℝ</span> <span class=\"bp\">|</span> <span class=\"bp\">∃</span> <span class=\"n\">a</span> <span class=\"n\">b</span> <span class=\"o\">:</span> <span class=\"n\">ℤ</span><span class=\"o\">,</span> <span class=\"n\">x</span> <span class=\"bp\">=</span> <span class=\"n\">a</span> <span class=\"bp\">+</span> <span class=\"n\">b</span> <span class=\"bp\">*</span> <span class=\"o\">(</span><span class=\"mi\">9</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">)</span> <span class=\"bp\">^</span> <span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"bp\">/</span><span class=\"mi\">4</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">)}</span> <span class=\"o\">:=</span>\n<span class=\"kd\">begin</span>\n  <span class=\"n\">refine</span> <span class=\"o\">⟨(</span><span class=\"n\">zsqrtd.to_real</span> <span class=\"o\">(</span><span class=\"k\">show</span> <span class=\"mi\">0</span> <span class=\"bp\">≤</span> <span class=\"o\">(</span><span class=\"mi\">3</span> <span class=\"o\">:</span> <span class=\"n\">ℤ</span><span class=\"o\">),</span> <span class=\"kd\">by</span> <span class=\"n\">norm_num</span><span class=\"o\">))</span><span class=\"bp\">.</span><span class=\"n\">range</span><span class=\"o\">,</span> <span class=\"n\">_</span><span class=\"o\">,</span> <span class=\"n\">_</span><span class=\"o\">⟩,</span>\n  <span class=\"n\">apply_instance</span><span class=\"o\">,</span>\n  <span class=\"n\">ext</span><span class=\"o\">,</span>\n  <span class=\"n\">rw</span> <span class=\"o\">[</span><span class=\"n\">fourth_root_of_nine_equals_sqrt_3</span><span class=\"o\">],</span>\n  <span class=\"n\">simp</span> <span class=\"o\">[</span><span class=\"n\">zsqrtd.to_real</span><span class=\"o\">],</span>\n  <span class=\"n\">split</span><span class=\"o\">,</span>\n  <span class=\"o\">{</span>\n    <span class=\"n\">intro</span> <span class=\"n\">h1</span><span class=\"o\">,</span>\n    <span class=\"n\">cases</span> <span class=\"n\">h1</span> <span class=\"k\">with</span> <span class=\"n\">a</span> <span class=\"n\">ha</span><span class=\"o\">,</span>\n    <span class=\"n\">cases</span> <span class=\"n\">ha</span> <span class=\"k\">with</span> <span class=\"n\">b</span> <span class=\"n\">hb</span><span class=\"o\">,</span>\n    <span class=\"n\">use</span> <span class=\"o\">{</span><span class=\"n\">re</span> <span class=\"o\">:=</span> <span class=\"n\">a</span><span class=\"o\">,</span> <span class=\"n\">im</span> <span class=\"o\">:=</span> <span class=\"n\">b</span><span class=\"o\">},</span>\n    <span class=\"n\">rw</span> <span class=\"n\">hb</span><span class=\"o\">,</span>\n  <span class=\"o\">},</span>\n  <span class=\"o\">{</span>\n    <span class=\"n\">intro</span> <span class=\"n\">h1</span><span class=\"o\">,</span>\n    <span class=\"n\">cases</span> <span class=\"n\">h1</span> <span class=\"k\">with</span> <span class=\"n\">y</span> <span class=\"n\">hy</span><span class=\"o\">,</span>\n    <span class=\"n\">rw</span> <span class=\"bp\">←</span> <span class=\"n\">hy</span><span class=\"o\">,</span>\n    <span class=\"gr\">sorry</span>\n  <span class=\"o\">}</span>\n<span class=\"kd\">end</span>\n</code></pre></div>",
        "id": 222188357,
        "sender_full_name": "Lars Ericson",
        "timestamp": 1610224594
    },
    {
        "content": "<p><code>use [y.re, y.im]</code></p>",
        "id": 222190357,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1610227135
    },
    {
        "content": "<p>Exercise 6E, we hardly knew ye:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kn\">import</span> <span class=\"n\">data.zsqrtd.basic</span>\n<span class=\"kn\">import</span> <span class=\"n\">ring_theory.subring</span>\n<span class=\"kn\">import</span> <span class=\"n\">data.real.basic</span>\n<span class=\"kn\">import</span> <span class=\"n\">analysis.special_functions.pow</span>\n\n<span class=\"c1\">-- Eric Wieser</span>\n<span class=\"sd\">/-- The image of `zsqrtd` in `ℝ`.  -/</span>\n<span class=\"kd\">@[simps]</span>\n<span class=\"kd\">noncomputable</span> <span class=\"kd\">def</span> <span class=\"n\">zsqrtd.to_real</span> <span class=\"o\">{</span><span class=\"n\">d</span> <span class=\"o\">:</span> <span class=\"n\">ℤ</span> <span class=\"o\">}</span> <span class=\"o\">(</span><span class=\"n\">h</span> <span class=\"o\">:</span> <span class=\"mi\">0</span> <span class=\"bp\">≤</span> <span class=\"n\">d</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">ℤ</span><span class=\"bp\">√</span><span class=\"n\">d</span> <span class=\"bp\">→+*</span> <span class=\"n\">ℝ</span> <span class=\"o\">:=</span> <span class=\"o\">{</span>\n  <span class=\"n\">to_fun</span> <span class=\"o\">:=</span> <span class=\"bp\">λ</span> <span class=\"n\">a</span><span class=\"o\">,</span> <span class=\"n\">a.1</span> <span class=\"bp\">+</span> <span class=\"n\">a.2</span><span class=\"bp\">*</span><span class=\"n\">real.sqrt</span> <span class=\"n\">d</span><span class=\"o\">,</span>\n  <span class=\"n\">map_zero'</span> <span class=\"o\">:=</span> <span class=\"kd\">by</span> <span class=\"n\">simp</span><span class=\"o\">,</span>\n  <span class=\"n\">map_add'</span> <span class=\"o\">:=</span> <span class=\"bp\">λ</span> <span class=\"n\">a</span> <span class=\"n\">b</span><span class=\"o\">,</span> <span class=\"kd\">by</span> <span class=\"o\">{</span> <span class=\"n\">simp</span><span class=\"o\">,</span> <span class=\"n\">ring</span><span class=\"o\">,</span> <span class=\"o\">},</span>\n  <span class=\"n\">map_one'</span> <span class=\"o\">:=</span> <span class=\"kd\">by</span> <span class=\"n\">simp</span><span class=\"o\">,</span>\n  <span class=\"n\">map_mul'</span> <span class=\"o\">:=</span> <span class=\"bp\">λ</span> <span class=\"n\">a</span> <span class=\"n\">b</span><span class=\"o\">,</span> <span class=\"kd\">by</span> <span class=\"o\">{</span>\n    <span class=\"k\">have</span> <span class=\"o\">:</span> <span class=\"o\">(</span><span class=\"bp\">↑</span><span class=\"n\">a.re</span> <span class=\"bp\">+</span> <span class=\"bp\">↑</span><span class=\"n\">a.im</span> <span class=\"bp\">*</span> <span class=\"n\">real.sqrt</span> <span class=\"n\">d</span><span class=\"o\">)</span> <span class=\"bp\">*</span> <span class=\"o\">(</span><span class=\"bp\">↑</span><span class=\"n\">b.re</span> <span class=\"bp\">+</span> <span class=\"bp\">↑</span><span class=\"n\">b.im</span> <span class=\"bp\">*</span> <span class=\"n\">real.sqrt</span> <span class=\"n\">d</span><span class=\"o\">)</span> <span class=\"bp\">=</span>\n             <span class=\"bp\">↑</span><span class=\"n\">a.re</span> <span class=\"bp\">*</span> <span class=\"bp\">↑</span><span class=\"n\">b.re</span> <span class=\"bp\">+</span> <span class=\"o\">(</span><span class=\"bp\">↑</span><span class=\"n\">a.re</span> <span class=\"bp\">*</span> <span class=\"bp\">↑</span><span class=\"n\">b.im</span> <span class=\"bp\">+</span> <span class=\"bp\">↑</span><span class=\"n\">a.im</span> <span class=\"bp\">*</span> <span class=\"bp\">↑</span><span class=\"n\">b.re</span><span class=\"o\">)</span> <span class=\"bp\">*</span> <span class=\"n\">real.sqrt</span> <span class=\"n\">d</span>\n                           <span class=\"bp\">+</span> <span class=\"bp\">↑</span><span class=\"n\">a.im</span> <span class=\"bp\">*</span> <span class=\"bp\">↑</span><span class=\"n\">b.im</span> <span class=\"bp\">*</span> <span class=\"o\">(</span><span class=\"n\">real.sqrt</span> <span class=\"n\">d</span> <span class=\"bp\">*</span> <span class=\"n\">real.sqrt</span> <span class=\"n\">d</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"kd\">by</span> <span class=\"n\">ring</span><span class=\"o\">,</span>\n    <span class=\"n\">simp</span> <span class=\"o\">[</span><span class=\"n\">this</span><span class=\"o\">,</span> <span class=\"n\">real.mul_self_sqrt</span> <span class=\"o\">(</span><span class=\"n\">int.cast_nonneg.mpr</span> <span class=\"n\">h</span><span class=\"o\">)],</span>\n    <span class=\"n\">ring</span><span class=\"o\">,</span> <span class=\"o\">}</span> <span class=\"o\">}</span>\n\n<span class=\"c1\">-- This definition is what each question in exercise 6 is asking. No need to restate it each time</span>\n<span class=\"kd\">abbreviation</span> <span class=\"n\">ex6</span> <span class=\"o\">{</span><span class=\"n\">α</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span> <span class=\"o\">[</span><span class=\"n\">ring</span> <span class=\"n\">α</span><span class=\"o\">]</span> <span class=\"o\">(</span><span class=\"n\">s</span> <span class=\"o\">:</span> <span class=\"n\">set</span> <span class=\"n\">α</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"bp\">∃</span> <span class=\"o\">(</span><span class=\"n\">sr</span> <span class=\"o\">:</span> <span class=\"n\">subring</span> <span class=\"n\">α</span><span class=\"o\">)</span> <span class=\"o\">[</span><span class=\"n\">integral_domain</span> <span class=\"n\">sr</span><span class=\"o\">],</span> <span class=\"n\">s</span> <span class=\"bp\">=</span> <span class=\"n\">sr</span>\n\n<span class=\"kd\">lemma</span> <span class=\"n\">nine_equals_3_times_3</span> <span class=\"o\">:</span> <span class=\"o\">(</span><span class=\"mi\">9</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">)</span><span class=\"bp\">=</span><span class=\"o\">(</span><span class=\"mi\">3</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">)</span><span class=\"bp\">*</span><span class=\"o\">(</span><span class=\"mi\">3</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">)</span> <span class=\"o\">:=</span>\n<span class=\"kd\">begin</span>\n  <span class=\"n\">linarith</span><span class=\"o\">,</span>\n<span class=\"kd\">end</span>\n\n<span class=\"kd\">lemma</span> <span class=\"n\">three_is_gt_0</span> <span class=\"o\">:</span> <span class=\"o\">(</span><span class=\"mi\">0</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">)</span> <span class=\"bp\">&lt;</span> <span class=\"o\">(</span><span class=\"mi\">3</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">)</span> <span class=\"o\">:=</span>\n<span class=\"kd\">begin</span>\n  <span class=\"n\">linarith</span><span class=\"o\">,</span>\n<span class=\"kd\">end</span>\n\n<span class=\"kd\">lemma</span> <span class=\"n\">three_is_gte_0</span> <span class=\"o\">:</span> <span class=\"o\">(</span><span class=\"mi\">0</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">)</span> <span class=\"bp\">≤</span> <span class=\"o\">(</span><span class=\"mi\">3</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">)</span> <span class=\"o\">:=</span>\n<span class=\"kd\">begin</span>\n  <span class=\"n\">linarith</span><span class=\"o\">,</span>\n<span class=\"kd\">end</span>\n\n<span class=\"kd\">lemma</span> <span class=\"n\">sqrt_of_9_is_3</span> <span class=\"o\">:</span> <span class=\"o\">(</span><span class=\"mi\">3</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">)</span> <span class=\"bp\">=</span> <span class=\"o\">(</span><span class=\"n\">real.sqrt</span> <span class=\"o\">(</span><span class=\"mi\">9</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">))</span> <span class=\"o\">:=</span>\n<span class=\"kd\">begin</span>\n  <span class=\"k\">have</span> <span class=\"n\">h1</span> <span class=\"o\">:=</span> <span class=\"n\">nine_equals_3_times_3</span><span class=\"o\">,</span>\n  <span class=\"n\">rw</span> <span class=\"n\">h1</span><span class=\"o\">,</span>\n  <span class=\"k\">have</span> <span class=\"n\">h2</span> <span class=\"o\">:=</span> <span class=\"n\">three_is_gte_0</span><span class=\"o\">,</span>\n  <span class=\"k\">have</span> <span class=\"n\">h3</span> <span class=\"o\">:=</span> <span class=\"n\">real.sqrt_mul_self</span> <span class=\"n\">h2</span><span class=\"o\">,</span>\n  <span class=\"n\">rw</span> <span class=\"bp\">←</span> <span class=\"n\">h1</span> <span class=\"n\">at</span> <span class=\"n\">h3</span><span class=\"o\">,</span>\n  <span class=\"n\">rw</span> <span class=\"bp\">←</span> <span class=\"n\">h1</span><span class=\"o\">,</span>\n  <span class=\"n\">exact</span> <span class=\"n\">eq.symm</span> <span class=\"n\">h3</span><span class=\"o\">,</span>\n<span class=\"kd\">end</span>\n\n<span class=\"kd\">lemma</span> <span class=\"n\">half_plus_half_equals_1</span><span class=\"o\">:</span> <span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"bp\">/</span><span class=\"mi\">2</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">)</span><span class=\"bp\">+</span><span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"bp\">/</span><span class=\"mi\">2</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">)</span><span class=\"bp\">=</span><span class=\"mi\">1</span> <span class=\"o\">:=</span>\n<span class=\"kd\">begin</span>\n  <span class=\"n\">linarith</span><span class=\"o\">,</span>\n<span class=\"kd\">end</span>\n\n<span class=\"kd\">lemma</span> <span class=\"n\">x_equals_sqrtx_times_sqrtx</span> <span class=\"o\">(</span><span class=\"n\">x</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">):</span> <span class=\"mi\">0</span> <span class=\"bp\">&lt;</span> <span class=\"n\">x</span> <span class=\"bp\">→</span> <span class=\"n\">x</span> <span class=\"bp\">=</span> <span class=\"n\">x</span><span class=\"bp\">^</span><span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"bp\">/</span><span class=\"mi\">2</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">)</span> <span class=\"bp\">*</span> <span class=\"n\">x</span><span class=\"bp\">^</span><span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"bp\">/</span><span class=\"mi\">2</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">)</span> <span class=\"o\">:=</span>\n<span class=\"kd\">begin</span>\n  <span class=\"n\">intro</span> <span class=\"n\">h1</span><span class=\"o\">,</span>\n  <span class=\"k\">have</span> <span class=\"n\">h2</span> <span class=\"o\">:=</span> <span class=\"n\">real.rpow_add</span> <span class=\"n\">h1</span><span class=\"o\">,</span>\n  <span class=\"k\">have</span> <span class=\"n\">h3</span> <span class=\"o\">:=</span> <span class=\"n\">h2</span> <span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"bp\">/</span><span class=\"mi\">2</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"bp\">/</span><span class=\"mi\">2</span><span class=\"o\">),</span>\n  <span class=\"k\">have</span> <span class=\"n\">h4</span> <span class=\"o\">:=</span> <span class=\"n\">half_plus_half_equals_1</span><span class=\"o\">,</span>\n  <span class=\"n\">rw</span> <span class=\"n\">h4</span> <span class=\"n\">at</span> <span class=\"n\">h3</span><span class=\"o\">,</span>\n  <span class=\"k\">have</span> <span class=\"n\">h5</span> <span class=\"o\">:=</span> <span class=\"n\">real.rpow_one</span> <span class=\"n\">x</span><span class=\"o\">,</span>\n  <span class=\"n\">rw</span> <span class=\"n\">h5</span> <span class=\"n\">at</span> <span class=\"n\">h3</span><span class=\"o\">,</span>\n  <span class=\"n\">exact</span> <span class=\"n\">h3</span><span class=\"o\">,</span>\n<span class=\"kd\">end</span>\n\n<span class=\"kd\">lemma</span> <span class=\"n\">x_is_0</span> <span class=\"o\">(</span><span class=\"n\">x</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">x</span> <span class=\"bp\">≥</span> <span class=\"mi\">0</span> <span class=\"bp\">→</span> <span class=\"bp\">¬</span><span class=\"o\">(</span><span class=\"mi\">0</span> <span class=\"bp\">&lt;</span> <span class=\"n\">x</span><span class=\"o\">)</span> <span class=\"bp\">→</span> <span class=\"n\">x</span> <span class=\"bp\">=</span> <span class=\"mi\">0</span> <span class=\"o\">:=</span>\n<span class=\"kd\">begin</span>\n  <span class=\"n\">intro</span> <span class=\"n\">h1</span><span class=\"o\">,</span>\n  <span class=\"n\">intro</span> <span class=\"n\">h2</span><span class=\"o\">,</span>\n  <span class=\"n\">linarith</span><span class=\"o\">,</span>\n<span class=\"kd\">end</span>\n\n<span class=\"kd\">lemma</span> <span class=\"n\">half_ne_0</span> <span class=\"o\">:</span> <span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"bp\">/</span><span class=\"mi\">2</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">)</span>  <span class=\"bp\">≠</span> <span class=\"o\">(</span><span class=\"mi\">0</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">)</span> <span class=\"o\">:=</span>\n<span class=\"kd\">begin</span>\n  <span class=\"n\">linarith</span><span class=\"o\">,</span>\n<span class=\"kd\">end</span>\n\n<span class=\"kd\">lemma</span> <span class=\"n\">zero_le_0</span> <span class=\"o\">:</span> <span class=\"o\">(</span><span class=\"mi\">0</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">)</span> <span class=\"bp\">≤</span> <span class=\"o\">(</span><span class=\"mi\">0</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">)</span> <span class=\"o\">:=</span>\n<span class=\"kd\">begin</span>\n  <span class=\"n\">linarith</span><span class=\"o\">,</span>\n<span class=\"kd\">end</span>\n\n<span class=\"kd\">lemma</span> <span class=\"n\">sqrt_0_equals_0</span> <span class=\"o\">:</span> <span class=\"n\">real.sqrt</span> <span class=\"mi\">0</span> <span class=\"bp\">=</span> <span class=\"mi\">0</span> <span class=\"o\">:=</span>\n<span class=\"kd\">begin</span>\n  <span class=\"k\">have</span> <span class=\"n\">h1</span> <span class=\"o\">:=</span> <span class=\"n\">zero_le_0</span><span class=\"o\">,</span>\n  <span class=\"n\">exact</span> <span class=\"n\">real.sqrt_eq_zero_of_nonpos</span> <span class=\"n\">h1</span><span class=\"o\">,</span>\n<span class=\"kd\">end</span>\n\n<span class=\"kd\">lemma</span> <span class=\"n\">x_gt_0_implies_sqrt_x_gt_0</span> <span class=\"o\">(</span><span class=\"n\">x</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">):</span> <span class=\"n\">x</span> <span class=\"bp\">≥</span> <span class=\"mi\">0</span> <span class=\"bp\">→</span> <span class=\"n\">x</span><span class=\"bp\">^</span><span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"bp\">/</span><span class=\"mi\">2</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">)</span> <span class=\"bp\">≥</span> <span class=\"mi\">0</span> <span class=\"o\">:=</span>\n<span class=\"kd\">begin</span>\n  <span class=\"n\">intro</span> <span class=\"n\">h1</span><span class=\"o\">,</span>\n  <span class=\"n\">exact</span> <span class=\"n\">real.rpow_nonneg_of_nonneg</span> <span class=\"n\">h1</span> <span class=\"o\">(</span><span class=\"mi\">1</span> <span class=\"bp\">/</span> <span class=\"mi\">2</span><span class=\"o\">),</span>\n<span class=\"kd\">end</span>\n\n<span class=\"kd\">lemma</span> <span class=\"n\">sqrt_x_equals_sqrt_x</span> <span class=\"o\">(</span><span class=\"n\">x</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">x</span> <span class=\"bp\">≥</span> <span class=\"mi\">0</span> <span class=\"bp\">→</span> <span class=\"n\">x</span><span class=\"bp\">^</span><span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"bp\">/</span><span class=\"mi\">2</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">)</span> <span class=\"bp\">=</span> <span class=\"n\">real.sqrt</span> <span class=\"n\">x</span> <span class=\"o\">:=</span>\n<span class=\"kd\">begin</span>\n  <span class=\"n\">intro</span> <span class=\"n\">h</span><span class=\"o\">,</span>\n  <span class=\"k\">have</span> <span class=\"n\">h1</span> <span class=\"o\">:=</span> <span class=\"n\">x_equals_sqrtx_times_sqrtx</span> <span class=\"n\">x</span><span class=\"o\">,</span>\n  <span class=\"n\">by_cases</span> <span class=\"n\">h2</span> <span class=\"o\">:</span> <span class=\"mi\">0</span> <span class=\"bp\">&lt;</span> <span class=\"n\">x</span><span class=\"o\">,</span>\n  <span class=\"o\">{</span>\n    <span class=\"k\">have</span> <span class=\"n\">h3</span> <span class=\"o\">:=</span> <span class=\"n\">h1</span> <span class=\"n\">h2</span><span class=\"o\">,</span>\n    <span class=\"n\">conv</span>\n    <span class=\"kd\">begin</span>\n      <span class=\"n\">to_rhs</span><span class=\"o\">,</span>\n      <span class=\"n\">rw</span> <span class=\"n\">h3</span><span class=\"o\">,</span>\n    <span class=\"kd\">end</span><span class=\"o\">,</span>\n    <span class=\"k\">have</span> <span class=\"n\">h5</span> <span class=\"o\">:=</span> <span class=\"n\">x_gt_0_implies_sqrt_x_gt_0</span> <span class=\"n\">x</span><span class=\"o\">,</span>\n    <span class=\"k\">have</span> <span class=\"n\">h6</span> <span class=\"o\">:=</span> <span class=\"n\">h5</span> <span class=\"n\">h</span><span class=\"o\">,</span>\n    <span class=\"k\">have</span> <span class=\"n\">h4</span> <span class=\"o\">:=</span> <span class=\"n\">real.sqrt_mul_self</span> <span class=\"n\">h6</span><span class=\"o\">,</span>\n    <span class=\"n\">exact</span> <span class=\"n\">eq.symm</span> <span class=\"n\">h4</span><span class=\"o\">,</span>\n  <span class=\"o\">},</span>\n  <span class=\"o\">{</span>\n    <span class=\"k\">have</span> <span class=\"n\">h3</span> <span class=\"o\">:=</span> <span class=\"n\">x_is_0</span> <span class=\"n\">x</span><span class=\"o\">,</span>\n    <span class=\"k\">have</span> <span class=\"n\">h4</span> <span class=\"o\">:=</span> <span class=\"n\">h3</span> <span class=\"n\">h</span><span class=\"o\">,</span>\n    <span class=\"k\">have</span> <span class=\"n\">h5</span> <span class=\"o\">:=</span> <span class=\"n\">h4</span> <span class=\"n\">h2</span><span class=\"o\">,</span>\n    <span class=\"n\">rw</span> <span class=\"n\">h5</span><span class=\"o\">,</span>\n    <span class=\"k\">have</span> <span class=\"n\">h6</span> <span class=\"o\">:=</span> <span class=\"bp\">@</span><span class=\"n\">real.zero_rpow</span> <span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"bp\">/</span><span class=\"mi\">2</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">),</span>\n    <span class=\"k\">have</span> <span class=\"n\">h7</span> <span class=\"o\">:=</span> <span class=\"n\">half_ne_0</span><span class=\"o\">,</span>\n    <span class=\"k\">have</span> <span class=\"n\">h8</span> <span class=\"o\">:=</span> <span class=\"n\">h6</span> <span class=\"n\">h7</span><span class=\"o\">,</span>\n    <span class=\"n\">rw</span> <span class=\"n\">h8</span><span class=\"o\">,</span>\n    <span class=\"k\">have</span> <span class=\"n\">h9</span> <span class=\"o\">:=</span> <span class=\"n\">sqrt_0_equals_0</span><span class=\"o\">,</span>\n    <span class=\"n\">exact</span> <span class=\"n\">eq.symm</span> <span class=\"n\">h9</span><span class=\"o\">,</span>\n  <span class=\"o\">}</span>\n<span class=\"kd\">end</span>\n\n<span class=\"kd\">lemma</span> <span class=\"n\">x_mul_x_pow_y_equals_x_pow_y_plus_y</span> <span class=\"o\">(</span><span class=\"n\">x</span> <span class=\"n\">y</span> <span class=\"o\">:</span> <span class=\"n\">ℝ</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"mi\">0</span> <span class=\"bp\">&lt;</span> <span class=\"n\">x</span> <span class=\"bp\">→</span> <span class=\"o\">(</span><span class=\"n\">x</span> <span class=\"bp\">*</span> <span class=\"n\">x</span><span class=\"o\">)</span><span class=\"bp\">^</span><span class=\"n\">y</span> <span class=\"bp\">=</span> <span class=\"n\">x</span><span class=\"bp\">^</span><span class=\"o\">(</span><span class=\"n\">y</span><span class=\"bp\">+</span><span class=\"n\">y</span><span class=\"o\">)</span> <span class=\"o\">:=</span>\n<span class=\"kd\">begin</span>\n  <span class=\"n\">intro</span> <span class=\"n\">h</span><span class=\"o\">,</span>\n  <span class=\"k\">have</span> <span class=\"n\">h1</span> <span class=\"o\">:=</span> <span class=\"n\">le_of_lt</span> <span class=\"n\">h</span><span class=\"o\">,</span>\n  <span class=\"k\">have</span> <span class=\"n\">h2</span> <span class=\"o\">:=</span> <span class=\"bp\">@</span><span class=\"n\">real.mul_rpow</span> <span class=\"n\">x</span> <span class=\"n\">x</span> <span class=\"n\">y</span> <span class=\"n\">h1</span> <span class=\"n\">h1</span><span class=\"o\">,</span>\n  <span class=\"n\">rw</span> <span class=\"n\">h2</span><span class=\"o\">,</span>\n  <span class=\"k\">have</span> <span class=\"n\">h3</span> <span class=\"o\">:=</span> <span class=\"n\">real.rpow_add</span> <span class=\"n\">h</span> <span class=\"n\">y</span> <span class=\"n\">y</span><span class=\"o\">,</span>\n  <span class=\"n\">exact</span> <span class=\"n\">eq.symm</span> <span class=\"n\">h3</span><span class=\"o\">,</span>\n<span class=\"kd\">end</span>\n\n<span class=\"kd\">lemma</span> <span class=\"n\">fourth_root_of_9_equals_sqrt_sqrt</span> <span class=\"o\">:</span> <span class=\"o\">(</span><span class=\"mi\">9</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">)</span> <span class=\"bp\">^</span> <span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"bp\">/</span><span class=\"mi\">4</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">)</span> <span class=\"bp\">=</span> <span class=\"n\">real.sqrt</span> <span class=\"o\">(</span><span class=\"n\">real.sqrt</span> <span class=\"o\">(</span><span class=\"mi\">9</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">))</span> <span class=\"o\">:=</span>\n<span class=\"kd\">begin</span>\n  <span class=\"k\">have</span> <span class=\"n\">h1</span> <span class=\"o\">:=</span> <span class=\"n\">nine_equals_3_times_3</span><span class=\"o\">,</span>\n  <span class=\"k\">have</span> <span class=\"n\">h2</span> <span class=\"o\">:=</span> <span class=\"n\">three_is_gt_0</span><span class=\"o\">,</span>\n  <span class=\"k\">have</span> <span class=\"n\">h7</span> <span class=\"o\">:=</span> <span class=\"n\">three_is_gte_0</span><span class=\"o\">,</span>\n  <span class=\"k\">have</span> <span class=\"n\">h3</span> <span class=\"o\">:=</span> <span class=\"n\">sqrt_of_9_is_3</span><span class=\"o\">,</span>\n  <span class=\"n\">rw</span> <span class=\"bp\">←</span> <span class=\"n\">h3</span><span class=\"o\">,</span>\n  <span class=\"n\">rw</span> <span class=\"n\">h1</span><span class=\"o\">,</span>\n  <span class=\"k\">have</span> <span class=\"n\">h4</span> <span class=\"o\">:=</span> <span class=\"n\">sqrt_x_equals_sqrt_x</span> <span class=\"o\">(</span><span class=\"mi\">3</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">),</span>\n  <span class=\"k\">have</span> <span class=\"n\">h5</span> <span class=\"o\">:=</span> <span class=\"n\">h4</span> <span class=\"n\">h7</span><span class=\"o\">,</span>\n  <span class=\"n\">rw</span> <span class=\"bp\">←</span> <span class=\"n\">h5</span><span class=\"o\">,</span>\n  <span class=\"k\">have</span> <span class=\"n\">h6</span> <span class=\"o\">:=</span> <span class=\"n\">x_mul_x_pow_y_equals_x_pow_y_plus_y</span> <span class=\"mi\">3</span> <span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"bp\">/</span><span class=\"mi\">4</span><span class=\"o\">),</span>\n  <span class=\"k\">have</span> <span class=\"n\">h8</span> <span class=\"o\">:=</span> <span class=\"n\">h6</span> <span class=\"n\">h2</span><span class=\"o\">,</span>\n  <span class=\"n\">rw</span> <span class=\"n\">h8</span><span class=\"o\">,</span>\n  <span class=\"n\">ring</span><span class=\"o\">,</span>\n<span class=\"kd\">end</span>\n\n<span class=\"kd\">lemma</span> <span class=\"n\">fourth_root_of_nine_equals_sqrt_3</span> <span class=\"o\">:</span> <span class=\"o\">(</span><span class=\"mi\">9</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">)</span> <span class=\"bp\">^</span> <span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"bp\">/</span><span class=\"mi\">4</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">)</span> <span class=\"bp\">=</span> <span class=\"n\">real.sqrt</span> <span class=\"mi\">3</span> <span class=\"o\">:=</span>\n<span class=\"kd\">begin</span>\n  <span class=\"k\">have</span> <span class=\"n\">h1</span> <span class=\"o\">:=</span> <span class=\"n\">fourth_root_of_9_equals_sqrt_sqrt</span><span class=\"o\">,</span>\n  <span class=\"n\">rw</span> <span class=\"n\">h1</span><span class=\"o\">,</span>\n  <span class=\"k\">have</span> <span class=\"n\">h2</span> <span class=\"o\">:=</span> <span class=\"n\">sqrt_of_9_is_3</span><span class=\"o\">,</span>\n  <span class=\"n\">rw</span> <span class=\"n\">h2</span><span class=\"o\">,</span>\n<span class=\"kd\">end</span>\n\n<span class=\"kd\">abbreviation</span> <span class=\"n\">is_an_integral_domain</span> <span class=\"o\">{</span><span class=\"n\">α</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span> <span class=\"o\">[</span><span class=\"n\">ring</span> <span class=\"n\">α</span><span class=\"o\">]</span> <span class=\"o\">(</span><span class=\"n\">s</span> <span class=\"o\">:</span> <span class=\"n\">set</span> <span class=\"n\">α</span><span class=\"o\">)</span> <span class=\"o\">:=</span>\n  <span class=\"bp\">∃</span> <span class=\"o\">(</span><span class=\"n\">sr</span> <span class=\"o\">:</span> <span class=\"n\">subring</span> <span class=\"n\">α</span><span class=\"o\">)</span> <span class=\"o\">[</span><span class=\"n\">integral_domain</span> <span class=\"n\">sr</span><span class=\"o\">],</span> <span class=\"n\">s</span> <span class=\"bp\">=</span> <span class=\"n\">sr</span>\n\n<span class=\"kd\">theorem</span> <span class=\"n\">ex6e</span> <span class=\"o\">:</span> <span class=\"n\">is_an_integral_domain</span> <span class=\"o\">{</span><span class=\"n\">x</span> <span class=\"o\">:</span> <span class=\"n\">ℝ</span> <span class=\"bp\">|</span> <span class=\"bp\">∃</span> <span class=\"n\">a</span> <span class=\"n\">b</span> <span class=\"o\">:</span> <span class=\"n\">ℤ</span><span class=\"o\">,</span> <span class=\"n\">x</span> <span class=\"bp\">=</span> <span class=\"n\">a</span> <span class=\"bp\">+</span> <span class=\"n\">b</span> <span class=\"bp\">*</span> <span class=\"o\">(</span><span class=\"mi\">9</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">)</span> <span class=\"bp\">^</span> <span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"bp\">/</span><span class=\"mi\">4</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">)}</span> <span class=\"o\">:=</span>\n<span class=\"kd\">begin</span>\n  <span class=\"n\">refine</span> <span class=\"o\">⟨(</span><span class=\"n\">zsqrtd.to_real</span> <span class=\"o\">(</span><span class=\"k\">show</span> <span class=\"mi\">0</span> <span class=\"bp\">≤</span> <span class=\"o\">(</span><span class=\"mi\">3</span> <span class=\"o\">:</span> <span class=\"n\">ℤ</span><span class=\"o\">),</span> <span class=\"kd\">by</span> <span class=\"n\">norm_num</span><span class=\"o\">))</span><span class=\"bp\">.</span><span class=\"n\">range</span><span class=\"o\">,</span> <span class=\"n\">_</span><span class=\"o\">,</span> <span class=\"n\">_</span><span class=\"o\">⟩,</span>\n  <span class=\"n\">apply_instance</span><span class=\"o\">,</span>\n  <span class=\"n\">ext</span><span class=\"o\">,</span>\n  <span class=\"n\">rw</span> <span class=\"o\">[</span><span class=\"n\">fourth_root_of_nine_equals_sqrt_3</span><span class=\"o\">],</span>\n  <span class=\"n\">simp</span> <span class=\"o\">[</span><span class=\"n\">zsqrtd.to_real</span><span class=\"o\">],</span>\n  <span class=\"n\">split</span><span class=\"o\">,</span>\n  <span class=\"o\">{</span>\n    <span class=\"n\">intro</span> <span class=\"n\">h1</span><span class=\"o\">,</span>\n    <span class=\"n\">cases</span> <span class=\"n\">h1</span> <span class=\"k\">with</span> <span class=\"n\">a</span> <span class=\"n\">ha</span><span class=\"o\">,</span>\n    <span class=\"n\">cases</span> <span class=\"n\">ha</span> <span class=\"k\">with</span> <span class=\"n\">b</span> <span class=\"n\">hb</span><span class=\"o\">,</span>\n    <span class=\"n\">use</span> <span class=\"o\">{</span><span class=\"n\">re</span> <span class=\"o\">:=</span> <span class=\"n\">a</span><span class=\"o\">,</span> <span class=\"n\">im</span> <span class=\"o\">:=</span> <span class=\"n\">b</span><span class=\"o\">},</span>\n    <span class=\"n\">rw</span> <span class=\"n\">hb</span><span class=\"o\">,</span>\n  <span class=\"o\">},</span>\n  <span class=\"o\">{</span>\n    <span class=\"n\">intro</span> <span class=\"n\">h1</span><span class=\"o\">,</span>\n    <span class=\"n\">cases</span> <span class=\"n\">h1</span> <span class=\"k\">with</span> <span class=\"n\">y</span> <span class=\"n\">hy</span><span class=\"o\">,</span>\n    <span class=\"n\">rw</span> <span class=\"bp\">←</span> <span class=\"n\">hy</span><span class=\"o\">,</span>\n    <span class=\"n\">use</span> <span class=\"o\">[</span><span class=\"n\">y.re</span><span class=\"o\">,</span> <span class=\"n\">y.im</span><span class=\"o\">],</span>\n  <span class=\"o\">}</span>\n<span class=\"kd\">end</span>\n</code></pre></div>",
        "id": 222193673,
        "sender_full_name": "Lars Ericson",
        "timestamp": 1610232711
    },
    {
        "content": "<p>I think it's easier if you just do it directly without using this zsqrtd stuff:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kn\">import</span> <span class=\"n\">tactic</span>\n<span class=\"kn\">import</span> <span class=\"n\">ring_theory.subring</span>\n<span class=\"kn\">import</span> <span class=\"n\">data.real.basic</span>\n<span class=\"kn\">import</span> <span class=\"n\">analysis.special_functions.pow</span>\n\n<span class=\"kd\">abbreviation</span> <span class=\"n\">is_an_integral_domain</span> <span class=\"o\">{</span><span class=\"n\">α</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span> <span class=\"o\">[</span><span class=\"n\">ring</span> <span class=\"n\">α</span><span class=\"o\">]</span> <span class=\"o\">(</span><span class=\"n\">s</span> <span class=\"o\">:</span> <span class=\"n\">set</span> <span class=\"n\">α</span><span class=\"o\">)</span> <span class=\"o\">:=</span>\n  <span class=\"bp\">∃</span> <span class=\"o\">(</span><span class=\"n\">sr</span> <span class=\"o\">:</span> <span class=\"n\">subring</span> <span class=\"n\">α</span><span class=\"o\">)</span> <span class=\"o\">[</span><span class=\"n\">integral_domain</span> <span class=\"n\">sr</span><span class=\"o\">],</span> <span class=\"n\">s</span> <span class=\"bp\">=</span> <span class=\"n\">sr</span>\n\n<span class=\"kn\">open</span> <span class=\"n\">real</span>\n\n<span class=\"kd\">lemma</span> <span class=\"n\">useful</span> <span class=\"o\">:</span> <span class=\"o\">((</span><span class=\"mi\">9</span> <span class=\"o\">:</span> <span class=\"n\">ℝ</span><span class=\"o\">)</span> <span class=\"bp\">^</span> <span class=\"o\">(</span><span class=\"mi\">4</span><span class=\"bp\">⁻¹</span> <span class=\"o\">:</span> <span class=\"n\">ℝ</span><span class=\"o\">))</span> <span class=\"bp\">*</span> <span class=\"o\">(</span><span class=\"mi\">9</span> <span class=\"bp\">^</span> <span class=\"o\">(</span><span class=\"mi\">4</span><span class=\"bp\">⁻¹</span> <span class=\"o\">:</span> <span class=\"n\">ℝ</span><span class=\"o\">))</span> <span class=\"bp\">=</span> <span class=\"mi\">3</span> <span class=\"o\">:=</span>\n<span class=\"kd\">begin</span>\n  <span class=\"n\">rw</span> <span class=\"bp\">←</span> <span class=\"n\">mul_rpow</span><span class=\"o\">,</span>\n  <span class=\"n\">convert</span> <span class=\"n\">pow_nat_rpow_nat_inv</span> <span class=\"o\">(</span><span class=\"k\">show</span> <span class=\"o\">(</span><span class=\"mi\">0</span> <span class=\"o\">:</span> <span class=\"n\">ℝ</span><span class=\"o\">)</span> <span class=\"bp\">≤</span> <span class=\"mi\">3</span><span class=\"o\">,</span> <span class=\"kd\">by</span> <span class=\"n\">norm_num</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"k\">show</span> <span class=\"mi\">0</span> <span class=\"bp\">&lt;</span> <span class=\"mi\">4</span><span class=\"o\">,</span> <span class=\"kd\">by</span> <span class=\"n\">norm_num</span><span class=\"o\">)</span> <span class=\"n\">using</span> <span class=\"mi\">2</span><span class=\"o\">,</span>\n  <span class=\"n\">all_goals</span> <span class=\"o\">{</span><span class=\"n\">norm_num</span><span class=\"o\">}</span>\n<span class=\"kd\">end</span>\n\n<span class=\"kd\">def</span> <span class=\"n\">A</span> <span class=\"o\">:</span> <span class=\"n\">subring</span> <span class=\"n\">ℝ</span> <span class=\"o\">:=</span>\n<span class=\"o\">{</span> <span class=\"n\">carrier</span> <span class=\"o\">:=</span> <span class=\"o\">{</span><span class=\"n\">x</span> <span class=\"bp\">|</span> <span class=\"bp\">∃</span> <span class=\"n\">a</span> <span class=\"n\">b</span> <span class=\"o\">:</span> <span class=\"n\">ℤ</span><span class=\"o\">,</span> <span class=\"n\">x</span> <span class=\"bp\">=</span> <span class=\"n\">a</span> <span class=\"bp\">+</span> <span class=\"n\">b</span> <span class=\"bp\">*</span> <span class=\"o\">(</span><span class=\"mi\">9</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">)</span> <span class=\"bp\">^</span> <span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"bp\">/</span><span class=\"mi\">4</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">)},</span>\n  <span class=\"n\">one_mem'</span> <span class=\"o\">:=</span> <span class=\"o\">⟨</span><span class=\"mi\">1</span><span class=\"o\">,</span> <span class=\"mi\">0</span><span class=\"o\">,</span> <span class=\"kd\">by</span> <span class=\"n\">simp</span><span class=\"o\">⟩,</span>\n  <span class=\"n\">mul_mem'</span> <span class=\"o\">:=</span> <span class=\"kd\">begin</span>\n    <span class=\"n\">rintro</span> <span class=\"n\">_</span> <span class=\"n\">_</span> <span class=\"o\">⟨</span><span class=\"n\">a1</span><span class=\"o\">,</span> <span class=\"n\">b1</span><span class=\"o\">,</span> <span class=\"n\">rfl</span><span class=\"o\">⟩</span> <span class=\"o\">⟨</span><span class=\"n\">a2</span><span class=\"o\">,</span> <span class=\"n\">b2</span><span class=\"o\">,</span> <span class=\"n\">rfl</span><span class=\"o\">⟩,</span>\n    <span class=\"n\">use</span> <span class=\"o\">[</span><span class=\"n\">a1</span> <span class=\"bp\">*</span> <span class=\"n\">a2</span> <span class=\"bp\">+</span> <span class=\"mi\">3</span> <span class=\"bp\">*</span> <span class=\"n\">b1</span> <span class=\"bp\">*</span> <span class=\"n\">b2</span><span class=\"o\">,</span> <span class=\"n\">a1</span> <span class=\"bp\">*</span> <span class=\"n\">b2</span> <span class=\"bp\">+</span> <span class=\"n\">a2</span> <span class=\"bp\">*</span> <span class=\"n\">b1</span><span class=\"o\">],</span>\n    <span class=\"n\">simp</span> <span class=\"o\">[</span><span class=\"n\">mul_add</span><span class=\"o\">,</span> <span class=\"n\">add_mul</span><span class=\"o\">,</span> <span class=\"n\">mul_assoc</span><span class=\"o\">,</span> <span class=\"n\">mul_left_comm</span><span class=\"o\">,</span> <span class=\"n\">useful</span><span class=\"o\">],</span>\n    <span class=\"n\">ring</span><span class=\"o\">,</span>\n  <span class=\"kd\">end</span><span class=\"o\">,</span>\n  <span class=\"n\">zero_mem'</span> <span class=\"o\">:=</span> <span class=\"o\">⟨</span><span class=\"mi\">0</span><span class=\"o\">,</span> <span class=\"mi\">0</span><span class=\"o\">,</span> <span class=\"kd\">by</span> <span class=\"n\">simp</span><span class=\"o\">⟩,</span>\n  <span class=\"n\">add_mem'</span> <span class=\"o\">:=</span> <span class=\"kd\">by</span> <span class=\"o\">{</span> <span class=\"n\">rintro</span> <span class=\"n\">_</span> <span class=\"n\">_</span> <span class=\"o\">⟨</span><span class=\"n\">a1</span><span class=\"o\">,</span> <span class=\"n\">b1</span><span class=\"o\">,</span> <span class=\"n\">rfl</span><span class=\"o\">⟩</span> <span class=\"o\">⟨</span><span class=\"n\">a2</span><span class=\"o\">,</span> <span class=\"n\">b2</span><span class=\"o\">,</span> <span class=\"n\">rfl</span><span class=\"o\">⟩,</span>\n                   <span class=\"n\">use</span> <span class=\"o\">[</span><span class=\"n\">a1</span> <span class=\"bp\">+</span> <span class=\"n\">a2</span><span class=\"o\">,</span> <span class=\"n\">b1</span> <span class=\"bp\">+</span> <span class=\"n\">b2</span><span class=\"o\">],</span>\n                   <span class=\"n\">simp</span><span class=\"o\">,</span> <span class=\"n\">ring</span> <span class=\"o\">},</span>\n  <span class=\"n\">neg_mem'</span> <span class=\"o\">:=</span> <span class=\"kd\">by</span> <span class=\"o\">{</span> <span class=\"n\">rintro</span> <span class=\"n\">_</span> <span class=\"o\">⟨</span><span class=\"n\">a</span><span class=\"o\">,</span> <span class=\"n\">b</span><span class=\"o\">,</span> <span class=\"n\">rfl</span><span class=\"o\">⟩,</span>\n                   <span class=\"n\">use</span> <span class=\"o\">[</span><span class=\"bp\">-</span><span class=\"n\">a</span><span class=\"o\">,</span> <span class=\"bp\">-</span><span class=\"n\">b</span><span class=\"o\">],</span>\n                   <span class=\"n\">simp</span><span class=\"o\">,</span> <span class=\"n\">ring</span> <span class=\"o\">},</span>\n   <span class=\"o\">}</span>\n\n<span class=\"kd\">noncomputable</span> <span class=\"kd\">instance</span> <span class=\"o\">:</span> <span class=\"n\">integral_domain</span> <span class=\"n\">A</span> <span class=\"o\">:=</span> <span class=\"kd\">by</span> <span class=\"n\">apply_instance</span>\n\n<span class=\"kd\">theorem</span> <span class=\"n\">ex6e</span> <span class=\"o\">:</span> <span class=\"n\">is_an_integral_domain</span> <span class=\"o\">{</span><span class=\"n\">x</span> <span class=\"o\">:</span> <span class=\"n\">ℝ</span> <span class=\"bp\">|</span> <span class=\"bp\">∃</span> <span class=\"n\">a</span> <span class=\"n\">b</span> <span class=\"o\">:</span> <span class=\"n\">ℤ</span><span class=\"o\">,</span> <span class=\"n\">x</span> <span class=\"bp\">=</span> <span class=\"n\">a</span> <span class=\"bp\">+</span> <span class=\"n\">b</span> <span class=\"bp\">*</span> <span class=\"o\">(</span><span class=\"mi\">9</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">)</span> <span class=\"bp\">^</span> <span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"bp\">/</span><span class=\"mi\">4</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">)}</span> <span class=\"o\">:=</span>\n<span class=\"o\">⟨</span><span class=\"n\">A</span><span class=\"o\">,</span> <span class=\"n\">infer_instance</span><span class=\"o\">,</span> <span class=\"n\">rfl</span><span class=\"o\">⟩</span>\n</code></pre></div>",
        "id": 222194633,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1610234437
    },
    {
        "content": "<p>This way you just isolate the useful lemma and you don't ever need to engage with square roots at all.</p>",
        "id": 222194989,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1610235053
    },
    {
        "content": "<p>I disagree. The first lemma by Eric is supposed to be in mathlib (I think it's PR'd), and the rest is a few lines</p>",
        "id": 222195005,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1610235086
    },
    {
        "content": "<p>Fair enough. My construction of the subring shouldn't be in mathlib and that's most of the work. I guess your way you still need to prove 9^{1/4}=sqrt(3), that just looked unappealing to me for some reason, but now I see we already have <code>sqrt_eq_rpow</code></p>",
        "id": 222195210,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1610235365
    },
    {
        "content": "<p>BTW we're missing <code>pow_inj : a^x=b^x -&gt; a=b</code> (modulo edge cases) (at least as far as I can see)</p>",
        "id": 222195280,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1610235543
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kd\">theorem</span> <span class=\"n\">ex6e</span> <span class=\"o\">:</span> <span class=\"n\">is_an_integral_domain</span> <span class=\"o\">{</span><span class=\"n\">x</span> <span class=\"o\">:</span> <span class=\"n\">ℝ</span> <span class=\"bp\">|</span> <span class=\"bp\">∃</span> <span class=\"n\">a</span> <span class=\"n\">b</span> <span class=\"o\">:</span> <span class=\"n\">ℤ</span><span class=\"o\">,</span> <span class=\"n\">x</span> <span class=\"bp\">=</span> <span class=\"n\">a</span> <span class=\"bp\">+</span> <span class=\"n\">b</span> <span class=\"bp\">*</span> <span class=\"o\">(</span><span class=\"mi\">9</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">)</span> <span class=\"bp\">^</span> <span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"bp\">/</span><span class=\"mi\">4</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">)}</span> <span class=\"o\">:=</span>\n<span class=\"kd\">begin</span>\n  <span class=\"n\">refine</span> <span class=\"o\">⟨(</span><span class=\"n\">zsqrtd.to_real</span> <span class=\"o\">(</span><span class=\"k\">show</span> <span class=\"mi\">0</span> <span class=\"bp\">≤</span> <span class=\"o\">(</span><span class=\"mi\">3</span> <span class=\"o\">:</span> <span class=\"n\">ℤ</span><span class=\"o\">),</span> <span class=\"kd\">by</span> <span class=\"n\">norm_num</span><span class=\"o\">))</span><span class=\"bp\">.</span><span class=\"n\">range</span><span class=\"o\">,</span> <span class=\"n\">_</span><span class=\"o\">,</span> <span class=\"n\">_</span><span class=\"o\">⟩,</span>\n  <span class=\"n\">apply_instance</span><span class=\"o\">,</span>\n  <span class=\"n\">ext</span><span class=\"o\">,</span>\n  <span class=\"n\">rw</span> <span class=\"k\">calc</span> <span class=\"o\">(</span><span class=\"mi\">9</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">)</span> <span class=\"bp\">^</span> <span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"bp\">/</span><span class=\"mi\">4</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">)</span> <span class=\"bp\">=</span> <span class=\"o\">(</span><span class=\"mi\">9</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">)</span><span class=\"bp\">^</span><span class=\"o\">((</span><span class=\"mi\">2</span><span class=\"o\">:</span><span class=\"n\">ℕ</span><span class=\"o\">)</span><span class=\"bp\">⁻¹</span> <span class=\"bp\">*</span> <span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"bp\">/</span><span class=\"mi\">2</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">ℝ</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"kd\">by</span> <span class=\"n\">norm_num</span>\n    <span class=\"bp\">...</span> <span class=\"bp\">=</span> <span class=\"o\">((</span><span class=\"mi\">3</span><span class=\"bp\">^</span><span class=\"mi\">2</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">)</span><span class=\"bp\">^</span><span class=\"o\">((</span><span class=\"mi\">2</span><span class=\"o\">:</span><span class=\"n\">ℕ</span><span class=\"o\">)</span><span class=\"bp\">⁻¹</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">))</span> <span class=\"bp\">^</span> <span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"bp\">/</span><span class=\"mi\">2</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"kd\">by</span> <span class=\"n\">rw</span> <span class=\"n\">real.rpow_mul</span><span class=\"bp\">;</span> <span class=\"n\">norm_num</span>\n    <span class=\"bp\">...</span> <span class=\"bp\">=</span> <span class=\"n\">real.sqrt</span> <span class=\"mi\">3</span> <span class=\"o\">:</span> <span class=\"kd\">by</span> <span class=\"n\">rw</span> <span class=\"o\">[</span><span class=\"n\">real.pow_nat_rpow_nat_inv</span><span class=\"o\">,</span> <span class=\"n\">real.sqrt_eq_rpow</span><span class=\"o\">]</span><span class=\"bp\">;</span> <span class=\"n\">norm_num</span><span class=\"o\">,</span>\n  <span class=\"n\">simp</span> <span class=\"o\">[</span><span class=\"n\">zsqrtd.to_real</span><span class=\"o\">],</span>\n  <span class=\"n\">exact</span> <span class=\"o\">⟨</span><span class=\"bp\">λ</span> <span class=\"o\">⟨</span><span class=\"n\">x</span><span class=\"o\">,</span><span class=\"n\">y</span><span class=\"o\">,</span><span class=\"n\">h</span><span class=\"o\">⟩,</span> <span class=\"o\">⟨⟨</span><span class=\"n\">x</span><span class=\"o\">,</span><span class=\"n\">y</span><span class=\"o\">⟩,</span> <span class=\"n\">h.symm</span><span class=\"o\">⟩,</span> <span class=\"bp\">λ</span> <span class=\"o\">⟨⟨</span><span class=\"n\">x</span><span class=\"o\">,</span><span class=\"n\">y</span><span class=\"o\">⟩,</span><span class=\"n\">h</span><span class=\"o\">⟩,</span> <span class=\"o\">⟨</span><span class=\"n\">x</span><span class=\"o\">,</span><span class=\"n\">y</span><span class=\"o\">,</span> <span class=\"n\">h.symm</span><span class=\"o\">⟩⟩,</span>\n<span class=\"kd\">end</span>\n</code></pre></div>",
        "id": 222195638,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1610236203
    },
    {
        "content": "<p>Kevin's proof is easier for me to follow  because it directly constructs the subring.</p>",
        "id": 222195663,
        "sender_full_name": "Lars Ericson",
        "timestamp": 1610236262
    },
    {
        "content": "<p>Mario's proof is the same as yours, he just gets to the point more directly.</p>",
        "id": 222195674,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1610236287
    },
    {
        "content": "<p>There certainly seems to be some friction around <code>real.rpow</code> that could use some automation</p>",
        "id": 222195748,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1610236405
    },
    {
        "content": "<p>I don't think I've ever seen <code>rw calc</code> before, and it doesn't seem to ever occur in mathlib.</p>",
        "id": 222195749,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1610236408
    },
    {
        "content": "<p>It would be <code>rw show</code> but <code>calc</code> kind of has <code>show</code> built in</p>",
        "id": 222195758,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1610236439
    },
    {
        "content": "<p>Nice!</p>",
        "id": 222195797,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1610236454
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"364351\">@Lars Ericson</span>, the point of my approach to the proof is that mathlib already has the ring construction so there is no need to build it yourself</p>",
        "id": 222197571,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1610239242
    },
    {
        "content": "<p>Pedagogically of course, you can still do so</p>",
        "id": 222197580,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1610239257
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"310045\">@Eric Wieser</span> , I'm grateful for your help.   In this example, the relevant subring was already mostly in <code>mathlib</code>, except for the multiplication which you define in  <code>zsqrtd.to_real</code>.  For a beginner like myself, to transfer the techniques to a subring which is not already in <code>mathlib</code>, the pattern of <code>def A</code> seems easier to replicate.</p>",
        "id": 222198499,
        "sender_full_name": "Lars Ericson",
        "timestamp": 1610240978
    },
    {
        "content": "<p><a href=\"https://leanprover-community.github.io/mathlib_docs/find/zsqrtd.to_real\">docs#zsqrtd.to_real</a> is now merged</p>",
        "id": 224259798,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1611787631
    }
]