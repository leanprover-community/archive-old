[
    {
        "content": "<p>Hi everybody. It's my first time posting, so I'll briefly introduce myself. My name is Andrea,  I have a bachelor in Computer Science and I'm currently studying Logic at the ILLC in Amsterdam. I've been playing with other proof assistants in the past, but lately I've decided to start working with Lean (mostly  thanks to Kevin Buzzard's presentations). It's nice to meet you all :)</p>\n<p>I've been reading the book \"Theorem proving in Lean\" and I've been trying to wrap my head around inductive families (both the concept and the Lean implementation of it) ever since the weekend. In particular, I was a little puzzled about exercise 5 in chapter 7, which says: \"Simulate the mutual inductive definition of even and odd described in Section 7.9 with an ordinary inductive type, using an index to encode the choice between them in the target type\" (quick <a href=\"https://leanprover.github.io/theorem_proving_in_lean/inductive_types.html#mutual-and-nested-inductive-types\">link</a> to the chapter in question). I've come up with this solution and also proved a quick lemma with it:</p>\n<div class=\"spoiler-block\"><div class=\"spoiler-header\">\n<p>Don't want to spoil it for others</p>\n</div><div class=\"spoiler-content\" aria-hidden=\"true\">\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kd\">universe</span> <span class=\"n\">u</span>\n<span class=\"kn\">open</span> <span class=\"n\">nat</span>\n\n<span class=\"kd\">inductive</span> <span class=\"n\">odd_even</span> <span class=\"o\">:</span> <span class=\"n\">nat</span> <span class=\"bp\">→</span> <span class=\"n\">bool</span> <span class=\"bp\">→</span> <span class=\"kt\">Prop</span>\n<span class=\"bp\">|</span> <span class=\"n\">zero_even</span><span class=\"o\">:</span> <span class=\"n\">odd_even</span> <span class=\"mi\">0</span> <span class=\"n\">true</span>\n<span class=\"bp\">|</span> <span class=\"n\">odd_even</span> <span class=\"o\">{</span><span class=\"n\">n</span><span class=\"o\">:</span><span class=\"n\">nat</span><span class=\"o\">}</span> <span class=\"o\">{</span><span class=\"n\">b</span><span class=\"o\">:</span><span class=\"n\">bool</span><span class=\"o\">}</span> <span class=\"o\">(</span><span class=\"n\">o</span><span class=\"o\">:</span><span class=\"n\">odd_even</span> <span class=\"n\">n</span> <span class=\"n\">b</span><span class=\"o\">):</span> <span class=\"n\">odd_even</span> <span class=\"o\">(</span><span class=\"n\">succ</span> <span class=\"n\">n</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">not</span> <span class=\"n\">b</span><span class=\"o\">)</span>\n\n<span class=\"kd\">lemma</span> <span class=\"n\">odd_or_even</span> <span class=\"o\">(</span><span class=\"n\">n</span> <span class=\"o\">:</span> <span class=\"n\">nat</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"o\">(</span><span class=\"n\">odd_even</span> <span class=\"n\">n</span> <span class=\"n\">true</span><span class=\"o\">)</span> <span class=\"bp\">∨</span> <span class=\"o\">(</span><span class=\"n\">odd_even</span> <span class=\"n\">n</span> <span class=\"n\">false</span><span class=\"o\">)</span> <span class=\"o\">:=</span>\n<span class=\"kd\">begin</span>\n  <span class=\"n\">induction</span> <span class=\"n\">n</span><span class=\"o\">,</span>\n  <span class=\"n\">case</span> <span class=\"n\">zero</span><span class=\"o\">:</span> <span class=\"o\">{</span><span class=\"n\">left</span><span class=\"o\">,</span> <span class=\"n\">exact</span> <span class=\"n\">odd_even.zero_even</span><span class=\"o\">},</span>\n  <span class=\"n\">case</span> <span class=\"n\">succ</span><span class=\"o\">:</span> <span class=\"n\">n</span> <span class=\"n\">ih</span> <span class=\"o\">{</span>\n    <span class=\"n\">cases</span> <span class=\"n\">ih</span><span class=\"o\">,</span>\n    <span class=\"o\">{</span> <span class=\"n\">right</span><span class=\"o\">,</span> <span class=\"n\">exact</span> <span class=\"n\">odd_even.odd_even</span> <span class=\"n\">ih</span><span class=\"o\">},</span>\n    <span class=\"n\">left</span><span class=\"o\">,</span> <span class=\"n\">exact</span> <span class=\"n\">odd_even.odd_even</span> <span class=\"n\">ih</span> <span class=\"o\">}</span>\n<span class=\"kd\">end</span>\n</code></pre></div>\n</div></div>\n<p>Do you think this is a good \"simulation\" for the corresponding mutual induction? I've been trying to define the inductive type with all sorts of combinations of putting <code>nat</code> and <code>bool</code> before and after the semicolon, but they led to nothing interesting. The only way I see right now is to index the type on both <code>nat</code> and <code>bool</code>.</p>",
        "id": 224707285,
        "sender_full_name": "Andrea Berlingieri",
        "timestamp": 1612174928
    },
    {
        "content": "<p>That's the correct answer to the puzzle</p>",
        "id": 224714068,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1612179576
    },
    {
        "content": "<p>In fact, if you dig a little into how mutual inductive types are implemented in lean you will find out that this trick of adding an extra index storing which inductive type we're inhabiting is used in practice</p>",
        "id": 224714184,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1612179653
    },
    {
        "content": "<p>Here's a version that should make it clear how this generalizes:</p>\n<div class=\"spoiler-block\"><div class=\"spoiler-header\">\n</div><div class=\"spoiler-content\" aria-hidden=\"true\">\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kd\">inductive</span> <span class=\"n\">even_odd</span> <span class=\"o\">:</span> <span class=\"n\">bool</span> <span class=\"bp\">→</span> <span class=\"n\">ℕ</span> <span class=\"bp\">→</span> <span class=\"kt\">Prop</span>\n<span class=\"bp\">|</span> <span class=\"n\">even_zero</span> <span class=\"o\">:</span> <span class=\"n\">even_odd</span> <span class=\"n\">tt</span> <span class=\"mi\">0</span>\n<span class=\"bp\">|</span> <span class=\"n\">even_succ</span> <span class=\"o\">:</span> <span class=\"bp\">∀</span> <span class=\"n\">n</span><span class=\"o\">,</span> <span class=\"n\">even_odd</span> <span class=\"n\">ff</span> <span class=\"n\">n</span> <span class=\"bp\">→</span> <span class=\"n\">even_odd</span> <span class=\"n\">tt</span> <span class=\"o\">(</span><span class=\"n\">n</span> <span class=\"bp\">+</span> <span class=\"mi\">1</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"n\">odd_succ</span> <span class=\"o\">:</span> <span class=\"bp\">∀</span> <span class=\"n\">n</span><span class=\"o\">,</span> <span class=\"n\">even_odd</span> <span class=\"n\">tt</span> <span class=\"n\">n</span> <span class=\"bp\">→</span> <span class=\"n\">even_odd</span> <span class=\"n\">ff</span> <span class=\"o\">(</span><span class=\"n\">n</span> <span class=\"bp\">+</span> <span class=\"mi\">1</span><span class=\"o\">)</span>\n\n<span class=\"kd\">def</span> <span class=\"n\">even</span> <span class=\"o\">:=</span> <span class=\"n\">even_odd</span> <span class=\"n\">tt</span>\n<span class=\"kd\">def</span> <span class=\"n\">odd</span> <span class=\"o\">:=</span> <span class=\"n\">even_odd</span> <span class=\"n\">ff</span>\n</code></pre></div>\n</div></div>",
        "id": 224714437,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1612179855
    },
    {
        "content": "<p>Thank you for your answer Mario <span aria-label=\"smile\" class=\"emoji emoji-1f642\" role=\"img\" title=\"smile\">:smile:</span></p>",
        "id": 224719097,
        "sender_full_name": "Andrea Berlingieri",
        "timestamp": 1612183048
    }
]