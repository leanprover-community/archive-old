[
    {
        "content": "<p>The following is in F#.</p>\n<div class=\"codehilite\"><pre><span></span><span class=\"k\">let</span> <span class=\"nv\">claims</span><span class=\"o\">:</span> <span class=\"o\">(</span><span class=\"n\">int</span> <span class=\"o\">*</span> <span class=\"n\">int</span><span class=\"o\">)</span> <span class=\"bp\">[]</span> <span class=\"o\">=</span> <span class=\"o\">[|</span><span class=\"mi\">1</span><span class=\"o\">,</span><span class=\"mi\">2</span><span class=\"o\">;</span> <span class=\"mi\">1</span><span class=\"o\">,</span><span class=\"mi\">3</span><span class=\"o\">;</span> <span class=\"mi\">1</span><span class=\"o\">,</span><span class=\"mi\">4</span><span class=\"o\">;</span> <span class=\"mi\">1</span><span class=\"o\">,</span><span class=\"mi\">5</span><span class=\"o\">;</span> <span class=\"mi\">1</span><span class=\"o\">,</span><span class=\"mi\">6</span><span class=\"o\">;</span> <span class=\"mi\">1</span><span class=\"o\">,</span><span class=\"mi\">1</span><span class=\"o\">;</span> <span class=\"mi\">2</span><span class=\"o\">,</span><span class=\"mi\">2</span><span class=\"o\">;</span> <span class=\"mi\">2</span><span class=\"o\">,</span><span class=\"mi\">3</span><span class=\"o\">;</span> <span class=\"mi\">2</span><span class=\"o\">,</span><span class=\"mi\">4</span><span class=\"o\">;</span> <span class=\"mi\">2</span><span class=\"o\">,</span><span class=\"mi\">5</span><span class=\"o\">;</span> <span class=\"mi\">2</span><span class=\"o\">,</span><span class=\"mi\">6</span><span class=\"o\">;</span> <span class=\"mi\">2</span><span class=\"o\">,</span><span class=\"mi\">1</span><span class=\"o\">|]</span>\n<span class=\"k\">let</span> <span class=\"nv\">to_the_right_of</span> <span class=\"n\">x</span> <span class=\"o\">=</span> <span class=\"n\">claims</span><span class=\"o\">.[</span><span class=\"nn\">Array</span><span class=\"p\">.</span><span class=\"n\">findIndex</span> <span class=\"o\">((=)</span> <span class=\"n\">x</span><span class=\"o\">)</span> <span class=\"n\">claims</span> <span class=\"o\">+</span> <span class=\"mi\">1</span> <span class=\"o\">..]</span>\n\n<span class=\"n\">to_the_right_of</span> <span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"o\">,</span><span class=\"mi\">4</span><span class=\"o\">)</span>\n\n<span class=\"c1\">//val claims : (int * int) [] =</span>\n<span class=\"c1\">//  [|(1, 2); (1, 3); (1, 4); (1, 5); (1, 6); (1, 1); (2, 2); (2, 3); (2, 4);</span>\n<span class=\"c1\">//    (2, 5); (2, 6); (2, 1)|]</span>\n<span class=\"c1\">//val to_the_right_of : int * int -&gt; (int * int) []</span>\n<span class=\"c1\">//val it : (int * int) [] =</span>\n<span class=\"c1\">//  [|(1, 5); (1, 6); (1, 1); (2, 2); (2, 3); (2, 4); (2, 5); (2, 6); (2, 1)|]</span>\n</pre></div>\n\n\n<p>To follow up on my <a href=\"#narrow/stream/113489-new-members/topic/How.20do.20I.20map.20a.20list.20along.20with.20proof.20of.20membership.3F\" title=\"#narrow/stream/113489-new-members/topic/How.20do.20I.20map.20a.20list.20along.20with.20proof.20of.20membership.3F\">previous question</a>, how would I implement this in Lean? If possible using arrays and not lists. </p>\n<p>I guess in Lean I would need something like...</p>\n<div class=\"codehilite\"><pre><span></span><span class=\"n\">def</span> <span class=\"n\">list_claim</span> <span class=\"o\">:=</span> <span class=\"o\">[(</span><span class=\"mi\">1</span><span class=\"o\">,</span><span class=\"mi\">2</span><span class=\"o\">),</span> <span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"o\">,</span><span class=\"mi\">3</span><span class=\"o\">),</span> <span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"o\">,</span><span class=\"mi\">4</span><span class=\"o\">),</span> <span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"o\">,</span><span class=\"mi\">5</span><span class=\"o\">),</span> <span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"o\">,</span><span class=\"mi\">6</span><span class=\"o\">),</span> <span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"o\">,</span><span class=\"mi\">1</span><span class=\"o\">),</span> <span class=\"o\">(</span><span class=\"mi\">2</span><span class=\"o\">,</span><span class=\"mi\">2</span><span class=\"o\">),</span> <span class=\"o\">(</span><span class=\"mi\">2</span><span class=\"o\">,</span><span class=\"mi\">3</span><span class=\"o\">),</span> <span class=\"o\">(</span><span class=\"mi\">2</span><span class=\"o\">,</span><span class=\"mi\">4</span><span class=\"o\">),</span> <span class=\"o\">(</span><span class=\"mi\">2</span><span class=\"o\">,</span><span class=\"mi\">5</span><span class=\"o\">),</span> <span class=\"o\">(</span><span class=\"mi\">2</span><span class=\"o\">,</span><span class=\"mi\">6</span><span class=\"o\">),</span> <span class=\"o\">(</span><span class=\"mi\">2</span><span class=\"o\">,</span><span class=\"mi\">1</span><span class=\"o\">)]</span>\n\n<span class=\"n\">def</span> <span class=\"n\">to_the_right_of</span> <span class=\"o\">(</span><span class=\"n\">x</span> <span class=\"o\">:</span> <span class=\"o\">{</span><span class=\"n\">n</span> <span class=\"bp\">//</span> <span class=\"n\">n</span> <span class=\"err\">∈</span> <span class=\"n\">list_claim</span><span class=\"o\">})</span> <span class=\"o\">:</span> <span class=\"err\">Σ</span> <span class=\"n\">s</span><span class=\"o\">,</span> <span class=\"n\">array</span> <span class=\"n\">s</span> <span class=\"o\">{</span><span class=\"n\">n</span> <span class=\"bp\">//</span> <span class=\"n\">n</span> <span class=\"err\">∈</span> <span class=\"n\">list_claim</span><span class=\"o\">}</span> <span class=\"o\">:=</span>\n    <span class=\"n\">sorry</span>\n</pre></div>\n\n\n<p>I would not mind turning <code>list_claim</code> into an <code>array</code>, but I am not sure how I would implement something like <code>list.attach</code> for <code>array</code>s.</p>\n<hr>\n<p>Anyway, I've given it a try and here is how far I've gotten.</p>\n<div class=\"codehilite\"><pre><span></span><span class=\"n\">def</span> <span class=\"n\">to_the_right_of</span> <span class=\"o\">:</span> <span class=\"bp\">∀</span> <span class=\"o\">(</span><span class=\"n\">list_claim</span> <span class=\"o\">:</span> <span class=\"n\">list</span> <span class=\"o\">(</span><span class=\"n\">rat</span> <span class=\"bp\">×</span> <span class=\"n\">rat</span><span class=\"o\">)),</span> <span class=\"n\">list</span> <span class=\"n\">Action</span> <span class=\"bp\">→</span> <span class=\"o\">{</span><span class=\"n\">n</span> <span class=\"bp\">//</span> <span class=\"n\">n</span> <span class=\"err\">∈</span> <span class=\"n\">list_claim</span><span class=\"o\">}</span> <span class=\"bp\">→</span> <span class=\"n\">list</span> <span class=\"n\">Action</span>\n    <span class=\"bp\">|</span> <span class=\"bp\">_</span> <span class=\"n\">l</span> <span class=\"bp\">⟨</span> <span class=\"bp\">_</span><span class=\"o\">,</span> <span class=\"n\">or</span><span class=\"bp\">.</span><span class=\"n\">inl</span> <span class=\"bp\">_</span> <span class=\"bp\">⟩</span> <span class=\"o\">:=</span> <span class=\"n\">l</span><span class=\"bp\">.</span><span class=\"n\">drop</span> <span class=\"mi\">1</span>\n    <span class=\"bp\">|</span> <span class=\"bp\">_</span> <span class=\"n\">l</span> <span class=\"bp\">⟨</span> <span class=\"bp\">_</span><span class=\"o\">,</span> <span class=\"n\">or</span><span class=\"bp\">.</span><span class=\"n\">inr</span> <span class=\"n\">l&#39;</span><span class=\"bp\">⟩</span> <span class=\"o\">:=</span> <span class=\"n\">to_the_right_of</span> <span class=\"o\">(</span><span class=\"n\">l</span><span class=\"bp\">.</span><span class=\"n\">drop</span> <span class=\"mi\">1</span><span class=\"o\">)</span> <span class=\"n\">l&#39;</span>\n</pre></div>\n\n\n<p>This is full of strange type errors, and I am not sure how to proceed here. Any help would be appreciated. At this point, I am wondering whether I am too obsessed with making sure the search succeeds at compile time, but since I am still starting out it makes sense for me to take on this challenge. I want to learn how to do it properly using the full power of a dependently typed language.</p>",
        "id": 178937164,
        "sender_full_name": "Marko Grdinić",
        "timestamp": 1571911405
    },
    {
        "content": "<p>That doesn't seem to be the same as the F# code</p>",
        "id": 178939279,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1571913671
    },
    {
        "content": "<p>why do you have the attach stuff?</p>",
        "id": 178939283,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1571913681
    },
    {
        "content": "<p>By the way, the sigma over array is defined and called <code>buffer</code></p>",
        "id": 178939362,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1571913740
    },
    {
        "content": "<p>Here's the list version:</p>\n<div class=\"codehilite\"><pre><span></span><span class=\"n\">def</span> <span class=\"n\">after_first</span> <span class=\"o\">{</span><span class=\"n\">α</span><span class=\"o\">}</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"o\">:</span> <span class=\"n\">α</span> <span class=\"bp\">→</span> <span class=\"kt\">Prop</span><span class=\"o\">)</span> <span class=\"o\">[</span><span class=\"n\">decidable_pred</span> <span class=\"n\">p</span><span class=\"o\">]</span> <span class=\"o\">:</span> <span class=\"n\">list</span> <span class=\"n\">α</span> <span class=\"bp\">→</span> <span class=\"n\">list</span> <span class=\"n\">α</span>\n<span class=\"bp\">|</span> <span class=\"o\">[]</span> <span class=\"o\">:=</span> <span class=\"o\">[]</span>\n<span class=\"bp\">|</span> <span class=\"o\">(</span><span class=\"n\">a</span> <span class=\"bp\">::</span> <span class=\"n\">l</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"k\">if</span> <span class=\"n\">p</span> <span class=\"n\">a</span> <span class=\"k\">then</span> <span class=\"n\">l</span> <span class=\"k\">else</span> <span class=\"n\">after_first</span> <span class=\"n\">l</span>\n\n<span class=\"n\">def</span> <span class=\"n\">list_claim</span> <span class=\"o\">:=</span> <span class=\"o\">[(</span><span class=\"mi\">1</span><span class=\"o\">,</span><span class=\"mi\">2</span><span class=\"o\">),</span> <span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"o\">,</span><span class=\"mi\">3</span><span class=\"o\">),</span> <span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"o\">,</span><span class=\"mi\">4</span><span class=\"o\">),</span> <span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"o\">,</span><span class=\"mi\">5</span><span class=\"o\">),</span> <span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"o\">,</span><span class=\"mi\">6</span><span class=\"o\">),</span> <span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"o\">,</span><span class=\"mi\">1</span><span class=\"o\">),</span> <span class=\"o\">(</span><span class=\"mi\">2</span><span class=\"o\">,</span><span class=\"mi\">2</span><span class=\"o\">),</span> <span class=\"o\">(</span><span class=\"mi\">2</span><span class=\"o\">,</span><span class=\"mi\">3</span><span class=\"o\">),</span> <span class=\"o\">(</span><span class=\"mi\">2</span><span class=\"o\">,</span><span class=\"mi\">4</span><span class=\"o\">),</span> <span class=\"o\">(</span><span class=\"mi\">2</span><span class=\"o\">,</span><span class=\"mi\">5</span><span class=\"o\">),</span> <span class=\"o\">(</span><span class=\"mi\">2</span><span class=\"o\">,</span><span class=\"mi\">6</span><span class=\"o\">),</span> <span class=\"o\">(</span><span class=\"mi\">2</span><span class=\"o\">,</span><span class=\"mi\">1</span><span class=\"o\">)]</span>\n\n<span class=\"bp\">#</span><span class=\"kn\">eval</span> <span class=\"n\">after_first</span> <span class=\"o\">(</span><span class=\"n\">eq</span> <span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"o\">,</span> <span class=\"mi\">4</span><span class=\"o\">))</span> <span class=\"n\">list_claim</span>\n<span class=\"c1\">-- [(1, 5), (1, 6), (1, 1), (2, 2), (2, 3), (2, 4), (2, 5), (2, 6), (2, 1)]</span>\n</pre></div>",
        "id": 178939518,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1571913932
    },
    {
        "content": "<p>and the buffer version:</p>\n<div class=\"codehilite\"><pre><span></span><span class=\"n\">def</span> <span class=\"n\">array</span><span class=\"bp\">.</span><span class=\"n\">find_index</span> <span class=\"o\">{</span><span class=\"n\">α</span><span class=\"o\">}</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"o\">:</span> <span class=\"n\">α</span> <span class=\"bp\">→</span> <span class=\"kt\">Prop</span><span class=\"o\">)</span> <span class=\"o\">[</span><span class=\"n\">decidable_pred</span> <span class=\"n\">p</span><span class=\"o\">]</span>\n  <span class=\"o\">{</span><span class=\"n\">n</span><span class=\"o\">}</span> <span class=\"o\">(</span><span class=\"n\">arr</span> <span class=\"o\">:</span> <span class=\"n\">array</span> <span class=\"n\">n</span> <span class=\"n\">α</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">option</span> <span class=\"o\">(</span><span class=\"n\">fin</span> <span class=\"n\">n</span><span class=\"o\">)</span> <span class=\"o\">:=</span>\n<span class=\"n\">arr</span><span class=\"bp\">.</span><span class=\"n\">iterate</span> <span class=\"n\">none</span> <span class=\"o\">(</span><span class=\"bp\">λ</span> <span class=\"n\">i</span> <span class=\"n\">a</span> <span class=\"n\">o</span><span class=\"o\">,</span> <span class=\"n\">o</span> <span class=\"bp\">&lt;|&gt;</span> <span class=\"k\">if</span> <span class=\"n\">p</span> <span class=\"n\">a</span> <span class=\"k\">then</span> <span class=\"n\">some</span> <span class=\"n\">i</span> <span class=\"k\">else</span> <span class=\"n\">none</span><span class=\"o\">)</span>\n\n<span class=\"n\">def</span> <span class=\"n\">buffer</span><span class=\"bp\">.</span><span class=\"n\">after_first</span> <span class=\"o\">{</span><span class=\"n\">α</span><span class=\"o\">}</span> <span class=\"o\">(</span><span class=\"n\">p</span> <span class=\"o\">:</span> <span class=\"n\">α</span> <span class=\"bp\">→</span> <span class=\"kt\">Prop</span><span class=\"o\">)</span> <span class=\"o\">[</span><span class=\"n\">decidable_pred</span> <span class=\"n\">p</span><span class=\"o\">]</span>\n  <span class=\"o\">(</span><span class=\"n\">buf</span> <span class=\"o\">:</span> <span class=\"n\">buffer</span> <span class=\"n\">α</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">buffer</span> <span class=\"n\">α</span> <span class=\"o\">:=</span>\n<span class=\"k\">match</span> <span class=\"n\">buf</span><span class=\"bp\">.</span><span class=\"mi\">2</span><span class=\"bp\">.</span><span class=\"n\">find_index</span> <span class=\"n\">p</span> <span class=\"k\">with</span>\n<span class=\"bp\">|</span> <span class=\"n\">none</span> <span class=\"o\">:=</span> <span class=\"n\">buf</span>\n<span class=\"bp\">|</span> <span class=\"n\">some</span> <span class=\"n\">i</span> <span class=\"o\">:=</span> <span class=\"bp\">⟨_</span><span class=\"o\">,</span> <span class=\"n\">buf</span><span class=\"bp\">.</span><span class=\"mi\">2</span><span class=\"bp\">.</span><span class=\"n\">drop</span> <span class=\"n\">i</span><span class=\"bp\">.</span><span class=\"mi\">1</span><span class=\"bp\">.</span><span class=\"n\">succ</span> <span class=\"n\">i</span><span class=\"bp\">.</span><span class=\"mi\">2</span><span class=\"bp\">⟩</span>\n<span class=\"kn\">end</span>\n\n<span class=\"n\">def</span> <span class=\"n\">buffer_claim</span> <span class=\"o\">:</span> <span class=\"n\">buffer</span> <span class=\"o\">(</span><span class=\"bp\">ℕ</span> <span class=\"bp\">×</span> <span class=\"bp\">ℕ</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"n\">list_claim</span><span class=\"bp\">.</span><span class=\"n\">to_buffer</span>\n\n<span class=\"bp\">#</span><span class=\"kn\">eval</span> <span class=\"n\">buffer</span><span class=\"bp\">.</span><span class=\"n\">after_first</span> <span class=\"o\">(</span><span class=\"n\">eq</span> <span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"o\">,</span> <span class=\"mi\">4</span><span class=\"o\">))</span> <span class=\"n\">buffer_claim</span>\n</pre></div>",
        "id": 178940266,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1571914694
    },
    {
        "content": "<blockquote>\n<p>That doesn't seem to be the same as the F# code</p>\n</blockquote>\n<p>Indeed. I can't really translate it directly into Lean as it does not have exceptions, so the issue is making sure that all accesses are valid at compile time.</p>\n<blockquote>\n<p>why do you have the attach stuff?</p>\n</blockquote>\n<p>I am translating the CFR algorithm + <a href=\"https://en.wikipedia.org/wiki/Dudo\" target=\"_blank\" title=\"https://en.wikipedia.org/wiki/Dudo\">Dudo game</a> from <a href=\"https://github.com/mrakgr/The-Spiral-Language/tree/1cdc7e5b3c99d74fe232437ec2c689fc865020a7/Learning/CFR/Intro/CFR\" target=\"_blank\" title=\"https://github.com/mrakgr/The-Spiral-Language/tree/1cdc7e5b3c99d74fe232437ec2c689fc865020a7/Learning/CFR/Intro/CFR\">F#</a> to Lean. The real goal after I am done with this is to translate the theorems from the CFR papers into Lean. This is something I would not be able to do with a less powerful type system than Leans.</p>\n<p>Here is how <code>dudo.lean</code> looks so far.</p>\n<div class=\"codehilite\"><pre><span></span><span class=\"kn\">import</span> <span class=\"n\">data</span><span class=\"bp\">.</span><span class=\"n\">rat</span>\n\n<span class=\"n\">def</span> <span class=\"n\">list_dice</span> <span class=\"o\">:=</span> <span class=\"o\">[</span><span class=\"mi\">1</span><span class=\"o\">,</span><span class=\"mi\">2</span><span class=\"o\">,</span><span class=\"mi\">3</span><span class=\"o\">,</span><span class=\"mi\">4</span><span class=\"o\">,</span><span class=\"mi\">5</span><span class=\"o\">,</span><span class=\"mi\">6</span><span class=\"o\">]</span>\n<span class=\"n\">def</span> <span class=\"n\">list_claim</span> <span class=\"o\">:=</span> <span class=\"o\">[(</span><span class=\"mi\">1</span><span class=\"o\">,</span><span class=\"mi\">2</span><span class=\"o\">),</span> <span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"o\">,</span><span class=\"mi\">3</span><span class=\"o\">),</span> <span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"o\">,</span><span class=\"mi\">4</span><span class=\"o\">),</span> <span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"o\">,</span><span class=\"mi\">5</span><span class=\"o\">),</span> <span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"o\">,</span><span class=\"mi\">6</span><span class=\"o\">),</span> <span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"o\">,</span><span class=\"mi\">1</span><span class=\"o\">),</span> <span class=\"o\">(</span><span class=\"mi\">2</span><span class=\"o\">,</span><span class=\"mi\">2</span><span class=\"o\">),</span> <span class=\"o\">(</span><span class=\"mi\">2</span><span class=\"o\">,</span><span class=\"mi\">3</span><span class=\"o\">),</span> <span class=\"o\">(</span><span class=\"mi\">2</span><span class=\"o\">,</span><span class=\"mi\">4</span><span class=\"o\">),</span> <span class=\"o\">(</span><span class=\"mi\">2</span><span class=\"o\">,</span><span class=\"mi\">5</span><span class=\"o\">),</span> <span class=\"o\">(</span><span class=\"mi\">2</span><span class=\"o\">,</span><span class=\"mi\">6</span><span class=\"o\">),</span> <span class=\"o\">(</span><span class=\"mi\">2</span><span class=\"o\">,</span><span class=\"mi\">1</span><span class=\"o\">)]</span>\n\n<span class=\"kn\">inductive</span> <span class=\"n\">Action</span>\n<span class=\"bp\">|</span> <span class=\"n\">Claim</span> <span class=\"o\">(</span><span class=\"n\">claim</span> <span class=\"o\">:</span> <span class=\"o\">{</span><span class=\"n\">n</span> <span class=\"bp\">//</span> <span class=\"n\">n</span> <span class=\"err\">∈</span> <span class=\"n\">list_claim</span><span class=\"o\">})</span> <span class=\"o\">:</span> <span class=\"n\">Action</span>\n<span class=\"bp\">|</span> <span class=\"n\">Dudo</span> <span class=\"o\">:</span> <span class=\"n\">Action</span>\n\n<span class=\"n\">def</span> <span class=\"n\">actions</span><span class=\"bp\">.</span><span class=\"k\">begin</span> <span class=\"o\">:=</span> <span class=\"n\">list_claim</span><span class=\"bp\">.</span><span class=\"n\">attach</span><span class=\"bp\">.</span><span class=\"n\">map</span> <span class=\"n\">Action</span><span class=\"bp\">.</span><span class=\"n\">Claim</span>\n<span class=\"n\">def</span> <span class=\"n\">actions</span><span class=\"bp\">.</span><span class=\"n\">later</span> <span class=\"o\">:=</span> <span class=\"n\">actions</span><span class=\"bp\">.</span><span class=\"k\">begin</span> <span class=\"bp\">++</span> <span class=\"o\">[</span><span class=\"n\">Action</span><span class=\"bp\">.</span><span class=\"n\">Dudo</span><span class=\"o\">]</span>\n</pre></div>\n\n\n<p>Unlike in the <a href=\"https://github.com/mrakgr/The-Spiral-Language/blob/1cdc7e5b3c99d74fe232437ec2c689fc865020a7/Learning/CFR/Intro/CFR/dudo_v4.fsx\" target=\"_blank\" title=\"https://github.com/mrakgr/The-Spiral-Language/blob/1cdc7e5b3c99d74fe232437ec2c689fc865020a7/Learning/CFR/Intro/CFR/dudo_v4.fsx\">F# version</a>, in Lean I want to relate the <code>Action</code> type to the existing list of actions at compile time.</p>\n<p>Would it be possible to implement the above except with <code>list_claim</code> being replaced by an array (including in the <code>Action</code> type)?</p>\n<p>Either way, thanks for the examples. Let me study them for a bit.</p>",
        "id": 178946720,
        "sender_full_name": "Marko Grdinić",
        "timestamp": 1571920479
    },
    {
        "content": "<p>Since when I will be indexing into the array in the Lean version, the inputs will be of the form <code>{n // n ∈ list_claim}</code>, meaning they will have proof of membership I would like to take advantage of that.</p>\n<div class=\"codehilite\"><pre><span></span>def after_first : ∀ (l : list (nat × nat)) (x : {x // x ∈ l}), {ll // {lr // ll ++ [x.1] ++ lr = l}}\n</pre></div>\n\n\n<p>Right now I am trying to do this function and am wondering how to even write the <code>{ll // {lr // ll ++ [x.1] ++ lr = l}}</code> part correctly. How should it be done?</p>\n<hr>\n<p>I've realized that with arrays, the membership proofs actually include an index.</p>\n<div class=\"codehilite\"><pre><span></span><span class=\"kn\">protected</span> <span class=\"n\">def</span> <span class=\"n\">mem</span> <span class=\"o\">(</span><span class=\"n\">v</span> <span class=\"o\">:</span> <span class=\"n\">α</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">a</span> <span class=\"o\">:</span> <span class=\"n\">buffer</span> <span class=\"n\">α</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"kt\">Prop</span> <span class=\"o\">:=</span> <span class=\"bp\">∃</span><span class=\"n\">i</span><span class=\"o\">,</span> <span class=\"n\">read</span> <span class=\"n\">a</span> <span class=\"n\">i</span> <span class=\"bp\">=</span> <span class=\"n\">v</span>\n</pre></div>\n\n\n<p>Here is the one in <code>buffer</code>. Unfortunately, as I am also realizing, there is a difference between an existential and a subtype. It seems that the existential <code>Prop</code>s cannot be destructured in regular code unlike subtypes. I was wondering what the difference between <code>Prop</code> and <code>Type</code> was up to now. I guess I have my answer.</p>\n<div class=\"codehilite\"><pre><span></span><span class=\"n\">def</span> <span class=\"n\">claims</span> <span class=\"o\">:</span> <span class=\"n\">buffer</span> <span class=\"bp\">_</span> <span class=\"o\">:=</span> <span class=\"n\">list</span><span class=\"bp\">.</span><span class=\"n\">to_buffer</span> <span class=\"o\">[(</span><span class=\"mi\">1</span><span class=\"o\">,</span><span class=\"mi\">2</span><span class=\"o\">),</span> <span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"o\">,</span><span class=\"mi\">3</span><span class=\"o\">),</span> <span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"o\">,</span><span class=\"mi\">4</span><span class=\"o\">),</span> <span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"o\">,</span><span class=\"mi\">5</span><span class=\"o\">),</span> <span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"o\">,</span><span class=\"mi\">6</span><span class=\"o\">),</span> <span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"o\">,</span><span class=\"mi\">1</span><span class=\"o\">),</span> <span class=\"o\">(</span><span class=\"mi\">2</span><span class=\"o\">,</span><span class=\"mi\">2</span><span class=\"o\">),</span> <span class=\"o\">(</span><span class=\"mi\">2</span><span class=\"o\">,</span><span class=\"mi\">3</span><span class=\"o\">),</span> <span class=\"o\">(</span><span class=\"mi\">2</span><span class=\"o\">,</span><span class=\"mi\">4</span><span class=\"o\">),</span> <span class=\"o\">(</span><span class=\"mi\">2</span><span class=\"o\">,</span><span class=\"mi\">5</span><span class=\"o\">),</span> <span class=\"o\">(</span><span class=\"mi\">2</span><span class=\"o\">,</span><span class=\"mi\">6</span><span class=\"o\">),</span> <span class=\"o\">(</span><span class=\"mi\">2</span><span class=\"o\">,</span><span class=\"mi\">1</span><span class=\"o\">)]</span>\n\n<span class=\"kn\">inductive</span> <span class=\"n\">Action</span>\n<span class=\"bp\">|</span> <span class=\"n\">Claim</span> <span class=\"o\">(</span><span class=\"n\">claim</span> <span class=\"o\">:</span> <span class=\"bp\">∃</span> <span class=\"n\">n</span><span class=\"o\">,</span> <span class=\"n\">n</span> <span class=\"err\">∈</span> <span class=\"n\">claims</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">Action</span>\n<span class=\"bp\">|</span> <span class=\"n\">Dudo</span> <span class=\"o\">:</span> <span class=\"n\">Action</span>\n\n<span class=\"n\">def</span> <span class=\"n\">Action</span><span class=\"bp\">.</span><span class=\"k\">show</span> <span class=\"o\">:</span> <span class=\"n\">Action</span> <span class=\"bp\">→</span> <span class=\"n\">string</span>\n<span class=\"bp\">|</span> <span class=\"o\">(</span><span class=\"n\">Action</span><span class=\"bp\">.</span><span class=\"n\">Claim</span> <span class=\"bp\">⟨</span> <span class=\"n\">n</span><span class=\"o\">,</span> <span class=\"bp\">_⟩</span> <span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"s2\">&quot;Claim &quot;</span> <span class=\"bp\">++</span> <span class=\"n\">has_repr</span><span class=\"bp\">.</span><span class=\"n\">repr</span> <span class=\"n\">n</span>\n<span class=\"bp\">|</span> <span class=\"n\">Action</span><span class=\"bp\">.</span><span class=\"n\">Dudo</span> <span class=\"o\">:=</span> <span class=\"s2\">&quot;Dudo&quot;</span>\n</pre></div>\n\n\n<div class=\"codehilite\"><pre><span></span>equation compiler failed (use &#39;set_option trace.eqn_compiler.elim_match true&#39; for additional details)\nnested exception message:\ninduction tactic failed, recursor &#39;Exists.dcases_on&#39; can only eliminate into Prop\n</pre></div>\n\n\n<hr>\n<p>Given all that, the way I would really like to structure the <code>Action</code> type would be something like this (in pseudo-code)...</p>\n<div class=\"codehilite\"><pre><span></span><span class=\"n\">def</span> <span class=\"n\">list_claim</span> <span class=\"o\">:=</span> <span class=\"n\">list</span><span class=\"bp\">.</span><span class=\"n\">to_buffer</span> <span class=\"o\">[(</span><span class=\"mi\">1</span><span class=\"o\">,</span><span class=\"mi\">2</span><span class=\"o\">),</span> <span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"o\">,</span><span class=\"mi\">3</span><span class=\"o\">),</span> <span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"o\">,</span><span class=\"mi\">4</span><span class=\"o\">),</span> <span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"o\">,</span><span class=\"mi\">5</span><span class=\"o\">),</span> <span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"o\">,</span><span class=\"mi\">6</span><span class=\"o\">),</span> <span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"o\">,</span><span class=\"mi\">1</span><span class=\"o\">),</span> <span class=\"o\">(</span><span class=\"mi\">2</span><span class=\"o\">,</span><span class=\"mi\">2</span><span class=\"o\">),</span> <span class=\"o\">(</span><span class=\"mi\">2</span><span class=\"o\">,</span><span class=\"mi\">3</span><span class=\"o\">),</span> <span class=\"o\">(</span><span class=\"mi\">2</span><span class=\"o\">,</span><span class=\"mi\">4</span><span class=\"o\">),</span> <span class=\"o\">(</span><span class=\"mi\">2</span><span class=\"o\">,</span><span class=\"mi\">5</span><span class=\"o\">),</span> <span class=\"o\">(</span><span class=\"mi\">2</span><span class=\"o\">,</span><span class=\"mi\">6</span><span class=\"o\">),</span> <span class=\"o\">(</span><span class=\"mi\">2</span><span class=\"o\">,</span><span class=\"mi\">1</span><span class=\"o\">)]</span>\n\n<span class=\"kn\">inductive</span> <span class=\"n\">Action</span>\n<span class=\"bp\">|</span> <span class=\"n\">Claim</span> <span class=\"o\">(</span><span class=\"n\">claim</span> <span class=\"o\">:</span> <span class=\"o\">{</span><span class=\"n\">n</span> <span class=\"n\">i</span> <span class=\"bp\">//</span> <span class=\"n\">n</span> <span class=\"err\">∈</span> <span class=\"n\">list_claim</span> <span class=\"bp\">@</span> <span class=\"n\">i</span><span class=\"o\">})</span> <span class=\"o\">:</span> <span class=\"n\">Action</span>\n<span class=\"bp\">|</span> <span class=\"n\">Dudo</span> <span class=\"o\">:</span> <span class=\"n\">Action</span>\n</pre></div>\n\n\n<p>Rather than having to waste time looking up the array, having the index there directly would be ideal. It would have made taking all the items of the array to the right of the index trivially easy. I should have implemented the F# version like that, but I wasn't aiming for an efficient implementation there. But since I am doing it in Lean, I am interested in exploring some of the possibilities of the language as an exercise. Where should I start with this?</p>\n<p>The one thing I am going to need some help is figuring out how to do the equivalent of <code>list.attach</code> for <code>buffer</code>s. I am drawing a blank on how to approach that. Would it be possible to adapt <code>list.pmap</code> for that purpose somehow? I guess that is the first place I should look into...</p>",
        "id": 178956738,
        "sender_full_name": "Marko Grdinić",
        "timestamp": 1571926859
    },
    {
        "content": "<p>oof, that's a lot of dependent types</p>",
        "id": 178957361,
        "sender_full_name": "Andrew Ashworth",
        "timestamp": 1571927194
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span><span class=\"n\">def</span> <span class=\"n\">dice</span> <span class=\"o\">:=</span> <span class=\"n\">list</span><span class=\"bp\">.</span><span class=\"n\">to_buffer</span> <span class=\"o\">[</span><span class=\"mi\">1</span><span class=\"o\">,</span><span class=\"mi\">2</span><span class=\"o\">,</span><span class=\"mi\">3</span><span class=\"o\">,</span><span class=\"mi\">4</span><span class=\"o\">,</span><span class=\"mi\">5</span><span class=\"o\">,</span><span class=\"mi\">6</span><span class=\"o\">]</span>\n<span class=\"n\">def</span> <span class=\"n\">claims</span> <span class=\"o\">:=</span> <span class=\"n\">list</span><span class=\"bp\">.</span><span class=\"n\">to_buffer</span> <span class=\"o\">[(</span><span class=\"mi\">1</span><span class=\"o\">,</span><span class=\"mi\">2</span><span class=\"o\">),</span> <span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"o\">,</span><span class=\"mi\">3</span><span class=\"o\">),</span> <span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"o\">,</span><span class=\"mi\">4</span><span class=\"o\">),</span> <span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"o\">,</span><span class=\"mi\">5</span><span class=\"o\">),</span> <span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"o\">,</span><span class=\"mi\">6</span><span class=\"o\">),</span> <span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"o\">,</span><span class=\"mi\">1</span><span class=\"o\">),</span> <span class=\"o\">(</span><span class=\"mi\">2</span><span class=\"o\">,</span><span class=\"mi\">2</span><span class=\"o\">),</span> <span class=\"o\">(</span><span class=\"mi\">2</span><span class=\"o\">,</span><span class=\"mi\">3</span><span class=\"o\">),</span> <span class=\"o\">(</span><span class=\"mi\">2</span><span class=\"o\">,</span><span class=\"mi\">4</span><span class=\"o\">),</span> <span class=\"o\">(</span><span class=\"mi\">2</span><span class=\"o\">,</span><span class=\"mi\">5</span><span class=\"o\">),</span> <span class=\"o\">(</span><span class=\"mi\">2</span><span class=\"o\">,</span><span class=\"mi\">6</span><span class=\"o\">),</span> <span class=\"o\">(</span><span class=\"mi\">2</span><span class=\"o\">,</span><span class=\"mi\">1</span><span class=\"o\">)]</span>\n\n<span class=\"kn\">inductive</span> <span class=\"n\">Action</span>\n<span class=\"bp\">|</span> <span class=\"n\">Claim</span> <span class=\"o\">(</span><span class=\"n\">claim</span> <span class=\"o\">:</span> <span class=\"o\">{</span><span class=\"n\">i</span> <span class=\"bp\">//</span> <span class=\"bp\">∃</span> <span class=\"n\">v</span><span class=\"o\">,</span> <span class=\"n\">claims</span><span class=\"bp\">.</span><span class=\"n\">read</span> <span class=\"n\">i</span> <span class=\"bp\">=</span> <span class=\"n\">v</span><span class=\"o\">})</span> <span class=\"o\">:</span> <span class=\"n\">Action</span>\n<span class=\"bp\">|</span> <span class=\"n\">Dudo</span> <span class=\"o\">:</span> <span class=\"n\">Action</span>\n\n<span class=\"n\">def</span> <span class=\"n\">Action</span><span class=\"bp\">.</span><span class=\"k\">show</span> <span class=\"o\">:</span> <span class=\"n\">Action</span> <span class=\"bp\">→</span> <span class=\"n\">string</span>\n<span class=\"bp\">|</span> <span class=\"o\">(</span><span class=\"n\">Action</span><span class=\"bp\">.</span><span class=\"n\">Claim</span> <span class=\"bp\">⟨</span> <span class=\"n\">i</span><span class=\"o\">,</span> <span class=\"bp\">_⟩</span> <span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"s2\">&quot;Claim &quot;</span> <span class=\"bp\">++</span> <span class=\"n\">has_repr</span><span class=\"bp\">.</span><span class=\"n\">repr</span> <span class=\"o\">(</span><span class=\"n\">claims</span><span class=\"bp\">.</span><span class=\"n\">read</span> <span class=\"n\">i</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"n\">Action</span><span class=\"bp\">.</span><span class=\"n\">Dudo</span> <span class=\"o\">:=</span> <span class=\"s2\">&quot;Dudo&quot;</span>\n\n<span class=\"kn\">instance</span> <span class=\"o\">:</span> <span class=\"n\">has_repr</span> <span class=\"n\">Action</span> <span class=\"o\">:=</span> <span class=\"bp\">⟨</span> <span class=\"n\">Action</span><span class=\"bp\">.</span><span class=\"k\">show</span> <span class=\"bp\">⟩</span>\n\n<span class=\"n\">def</span> <span class=\"n\">buffer</span><span class=\"bp\">.</span><span class=\"n\">attach_index</span> <span class=\"o\">{</span><span class=\"n\">α</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span> <span class=\"o\">(</span><span class=\"n\">a</span> <span class=\"o\">:</span> <span class=\"n\">buffer</span> <span class=\"n\">α</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">buffer</span> <span class=\"o\">{</span><span class=\"n\">i</span> <span class=\"bp\">//</span> <span class=\"bp\">∃</span> <span class=\"n\">v</span><span class=\"o\">,</span> <span class=\"n\">a</span><span class=\"bp\">.</span><span class=\"n\">read</span> <span class=\"n\">i</span> <span class=\"bp\">=</span> <span class=\"n\">v</span><span class=\"o\">}</span> <span class=\"o\">:=</span>\n    <span class=\"n\">a</span><span class=\"bp\">.</span><span class=\"n\">iterate</span> <span class=\"n\">buffer</span><span class=\"bp\">.</span><span class=\"n\">nil</span> <span class=\"o\">(</span><span class=\"k\">fun</span> <span class=\"n\">i</span> <span class=\"bp\">_</span> <span class=\"n\">s</span><span class=\"o\">,</span> <span class=\"n\">s</span><span class=\"bp\">.</span><span class=\"n\">push_back</span> <span class=\"bp\">⟨</span> <span class=\"n\">i</span><span class=\"o\">,</span> <span class=\"bp\">⟨</span> <span class=\"n\">a</span><span class=\"bp\">.</span><span class=\"n\">read</span> <span class=\"n\">i</span><span class=\"o\">,</span> <span class=\"n\">rfl</span> <span class=\"bp\">⟩</span> <span class=\"bp\">⟩</span><span class=\"o\">)</span>\n\n<span class=\"n\">def</span> <span class=\"n\">actions</span><span class=\"bp\">.</span><span class=\"k\">begin</span> <span class=\"o\">:=</span> <span class=\"n\">claims</span><span class=\"bp\">.</span><span class=\"n\">attach_index</span><span class=\"bp\">.</span><span class=\"n\">iterate</span> <span class=\"n\">buffer</span><span class=\"bp\">.</span><span class=\"n\">nil</span> <span class=\"o\">(</span><span class=\"k\">fun</span> <span class=\"n\">i</span> <span class=\"n\">x</span> <span class=\"n\">s</span><span class=\"o\">,</span> <span class=\"n\">s</span><span class=\"bp\">.</span><span class=\"n\">push_back</span> <span class=\"err\">$</span> <span class=\"n\">Action</span><span class=\"bp\">.</span><span class=\"n\">Claim</span> <span class=\"n\">x</span><span class=\"o\">)</span>\n<span class=\"n\">def</span> <span class=\"n\">actions</span><span class=\"bp\">.</span><span class=\"n\">later</span> <span class=\"o\">:=</span> <span class=\"n\">actions</span><span class=\"bp\">.</span><span class=\"k\">begin</span><span class=\"bp\">.</span><span class=\"n\">push_back</span> <span class=\"n\">Action</span><span class=\"bp\">.</span><span class=\"n\">Dudo</span>\n</pre></div>\n\n\n<p>This is the form I was looking for. Then the <code>to_the_right_of</code> could trivially be implemented in terms of <code>buffer.drop</code>. It is pretty simple, but yesterday when I posed the question I was feeling particularly uninspired. Then after dwelling on it for a bit, the answer came naturally.</p>",
        "id": 179030731,
        "sender_full_name": "Marko Grdinić",
        "timestamp": 1571991679
    }
]