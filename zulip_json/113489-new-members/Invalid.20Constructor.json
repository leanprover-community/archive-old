[
    {
        "content": "<p>I'm having a bit of trouble with inductive type constructors. My code is as follows:</p>\n<div class=\"codehilite\"><pre><span></span><span class=\"kn\">import</span> <span class=\"n\">algebra</span><span class=\"bp\">.</span><span class=\"n\">ring</span>\n<span class=\"kn\">import</span> <span class=\"n\">data</span><span class=\"bp\">.</span><span class=\"n\">equiv</span><span class=\"bp\">.</span><span class=\"n\">algebra</span>\n<span class=\"kn\">import</span> <span class=\"n\">field_theory</span><span class=\"bp\">.</span><span class=\"n\">subfield</span>\n\n<span class=\"kn\">set_option</span> <span class=\"n\">class</span><span class=\"bp\">.</span><span class=\"n\">instance_max_depth</span> <span class=\"mi\">40</span>\n\n<span class=\"c1\">-- define fixes K k f for any f ∈ ring_aut K</span>\n<span class=\"n\">def</span> <span class=\"n\">fixes</span> <span class=\"o\">{</span><span class=\"n\">K</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span> <span class=\"o\">[</span><span class=\"n\">discrete_field</span> <span class=\"n\">K</span><span class=\"o\">]</span> <span class=\"o\">(</span><span class=\"n\">k</span> <span class=\"o\">:</span> <span class=\"n\">set</span> <span class=\"n\">K</span><span class=\"o\">)</span> <span class=\"o\">[</span><span class=\"n\">is_subfield</span> <span class=\"n\">k</span><span class=\"o\">]</span> <span class=\"o\">:</span> <span class=\"o\">(</span><span class=\"n\">ring_aut</span> <span class=\"n\">K</span><span class=\"o\">)</span> <span class=\"bp\">→</span> <span class=\"kt\">Prop</span>\n<span class=\"o\">:=</span> <span class=\"o\">(</span><span class=\"bp\">λ</span> <span class=\"n\">f</span> <span class=\"o\">:</span> <span class=\"n\">ring_aut</span> <span class=\"n\">K</span><span class=\"o\">,</span> <span class=\"o\">(</span><span class=\"bp\">∀</span> <span class=\"n\">x</span> <span class=\"o\">:</span> <span class=\"n\">k</span><span class=\"o\">,</span> <span class=\"n\">f</span><span class=\"bp\">.</span><span class=\"n\">to_fun</span> <span class=\"n\">x</span> <span class=\"bp\">=</span> <span class=\"n\">x</span><span class=\"o\">))</span>\n\n<span class=\"c1\">-- define gal K k</span>\n<span class=\"n\">def</span> <span class=\"n\">gal</span> <span class=\"o\">(</span><span class=\"n\">K</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">)</span> <span class=\"o\">[</span><span class=\"n\">discrete_field</span> <span class=\"n\">K</span><span class=\"o\">]</span> <span class=\"o\">(</span><span class=\"n\">k</span> <span class=\"o\">:</span> <span class=\"n\">set</span> <span class=\"n\">K</span><span class=\"o\">)</span> <span class=\"o\">[</span><span class=\"n\">is_subfield</span> <span class=\"n\">k</span><span class=\"o\">]</span> <span class=\"o\">:=</span> <span class=\"o\">{</span> <span class=\"n\">α</span> <span class=\"o\">:</span> <span class=\"o\">(</span><span class=\"n\">K</span> <span class=\"err\">≃</span><span class=\"bp\">+*</span> <span class=\"n\">K</span><span class=\"o\">)</span> <span class=\"bp\">//</span> <span class=\"o\">(</span><span class=\"n\">fixes</span> <span class=\"n\">k</span> <span class=\"n\">α</span><span class=\"o\">)</span> <span class=\"o\">}</span>\n<span class=\"kn\">instance</span> <span class=\"o\">{</span><span class=\"n\">K</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span> <span class=\"o\">[</span><span class=\"n\">discrete_field</span> <span class=\"n\">K</span><span class=\"o\">]</span> <span class=\"o\">{</span><span class=\"n\">k</span> <span class=\"o\">:</span> <span class=\"n\">set</span> <span class=\"n\">K</span><span class=\"o\">}</span> <span class=\"o\">[</span><span class=\"n\">is_subfield</span> <span class=\"n\">k</span><span class=\"o\">]</span> <span class=\"o\">:</span><span class=\"n\">has_coe</span> <span class=\"o\">(</span><span class=\"n\">gal</span> <span class=\"n\">K</span> <span class=\"n\">k</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">ring_aut</span> <span class=\"n\">K</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"bp\">⟨λ</span> <span class=\"n\">s</span><span class=\"o\">,</span> <span class=\"n\">s</span><span class=\"bp\">.</span><span class=\"n\">val</span><span class=\"bp\">⟩</span>\n\n<span class=\"kn\">section</span> <span class=\"n\">gal</span>\n\n<span class=\"c1\">-- Let K/k be an extension of fields</span>\n<span class=\"kn\">variable</span> <span class=\"o\">{</span><span class=\"n\">K</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span>\n<span class=\"kn\">variable</span> <span class=\"o\">[</span><span class=\"n\">discrete_field</span> <span class=\"n\">K</span><span class=\"o\">]</span>\n<span class=\"kn\">variable</span> <span class=\"o\">{</span><span class=\"n\">k</span> <span class=\"o\">:</span> <span class=\"n\">set</span> <span class=\"n\">K</span><span class=\"o\">}</span>\n<span class=\"kn\">variable</span> <span class=\"o\">[</span><span class=\"n\">is_subfield</span> <span class=\"n\">k</span><span class=\"o\">]</span>\n\n<span class=\"c1\">-- Show that id is in gal</span>\n<span class=\"n\">def</span> <span class=\"n\">aut_one</span> <span class=\"o\">:</span> <span class=\"n\">ring_aut</span> <span class=\"n\">K</span> <span class=\"o\">:=</span>  <span class=\"n\">group</span><span class=\"bp\">.</span><span class=\"n\">one</span> <span class=\"o\">(</span><span class=\"n\">ring_aut</span> <span class=\"n\">K</span><span class=\"o\">)</span>\n<span class=\"kn\">theorem</span> <span class=\"n\">aut_one_fixes_k</span> <span class=\"o\">:</span> <span class=\"n\">fixes</span> <span class=\"n\">k</span> <span class=\"n\">aut_one</span> <span class=\"o\">:=</span> <span class=\"k\">begin</span> <span class=\"n\">rw</span> <span class=\"o\">[</span><span class=\"n\">fixes</span><span class=\"o\">],</span> <span class=\"n\">intro</span><span class=\"o\">,</span> <span class=\"n\">refl</span> <span class=\"kn\">end</span>\n<span class=\"n\">def</span> <span class=\"n\">gal_one</span> <span class=\"o\">:</span> <span class=\"n\">gal</span> <span class=\"n\">K</span> <span class=\"n\">k</span> <span class=\"o\">:=</span> <span class=\"bp\">⟨</span> <span class=\"n\">aut_one</span><span class=\"o\">,</span> <span class=\"n\">aut_one_fixes_k</span> <span class=\"bp\">⟩</span>\n\n<span class=\"c1\">-- define multiplication in the galois group</span>\n<span class=\"n\">def</span> <span class=\"n\">aut_mul</span> <span class=\"o\">:</span> <span class=\"n\">ring_aut</span> <span class=\"n\">K</span> <span class=\"bp\">→</span> <span class=\"n\">ring_aut</span> <span class=\"n\">K</span> <span class=\"bp\">→</span> <span class=\"n\">ring_aut</span> <span class=\"n\">K</span> <span class=\"o\">:=</span> <span class=\"n\">group</span><span class=\"bp\">.</span><span class=\"n\">mul</span>\n<span class=\"kn\">theorem</span> <span class=\"n\">gal_closed_under_aut_mul</span> <span class=\"o\">(</span><span class=\"n\">g</span> <span class=\"n\">h</span> <span class=\"o\">:</span> <span class=\"n\">gal</span> <span class=\"n\">K</span> <span class=\"n\">k</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">fixes</span> <span class=\"n\">k</span> <span class=\"o\">(</span><span class=\"n\">aut_mul</span> <span class=\"n\">g</span> <span class=\"n\">h</span><span class=\"o\">)</span> <span class=\"o\">:=</span>\n<span class=\"k\">begin</span>\n    <span class=\"n\">intro</span> <span class=\"n\">x</span><span class=\"o\">,</span>\n    <span class=\"n\">change</span> <span class=\"n\">g</span><span class=\"bp\">.</span><span class=\"n\">val</span><span class=\"bp\">.</span><span class=\"n\">to_fun</span> <span class=\"o\">(</span><span class=\"n\">h</span><span class=\"bp\">.</span><span class=\"n\">val</span><span class=\"bp\">.</span><span class=\"n\">to_fun</span> <span class=\"err\">↑</span><span class=\"n\">x</span><span class=\"o\">)</span> <span class=\"bp\">=</span> <span class=\"err\">↑</span><span class=\"n\">x</span><span class=\"o\">,</span>\n    <span class=\"n\">rw</span> <span class=\"o\">[</span><span class=\"n\">h</span><span class=\"bp\">.</span><span class=\"n\">property</span><span class=\"o\">,</span> <span class=\"n\">g</span><span class=\"bp\">.</span><span class=\"n\">property</span><span class=\"o\">]</span>\n<span class=\"kn\">end</span>\n<span class=\"n\">def</span> <span class=\"n\">gal_mul</span> <span class=\"o\">:</span> <span class=\"n\">gal</span> <span class=\"n\">K</span> <span class=\"n\">k</span> <span class=\"bp\">→</span> <span class=\"n\">gal</span> <span class=\"n\">K</span> <span class=\"n\">k</span> <span class=\"bp\">→</span> <span class=\"n\">gal</span> <span class=\"n\">K</span> <span class=\"n\">k</span> <span class=\"o\">:=</span>\n    <span class=\"bp\">λ</span> <span class=\"n\">g</span> <span class=\"n\">h</span> <span class=\"o\">:</span> <span class=\"o\">(</span><span class=\"n\">gal</span> <span class=\"n\">K</span> <span class=\"n\">k</span><span class=\"o\">),</span> <span class=\"bp\">⟨</span> <span class=\"n\">aut_mul</span> <span class=\"n\">g</span> <span class=\"n\">h</span><span class=\"o\">,</span> <span class=\"n\">gal_closed_under_aut_mul</span> <span class=\"n\">g</span> <span class=\"n\">h</span><span class=\"bp\">⟩</span>\n\n<span class=\"c1\">-- show that the galois group is closed under inversion</span>\n<span class=\"n\">def</span> <span class=\"n\">aut_inv</span> <span class=\"o\">:</span> <span class=\"n\">ring_aut</span> <span class=\"n\">K</span> <span class=\"bp\">→</span> <span class=\"n\">ring_aut</span> <span class=\"n\">K</span> <span class=\"o\">:=</span> <span class=\"n\">group</span><span class=\"bp\">.</span><span class=\"n\">inv</span>\n<span class=\"kn\">theorem</span> <span class=\"n\">gal_closed_under_inversion</span> <span class=\"o\">(</span><span class=\"n\">g</span> <span class=\"o\">:</span> <span class=\"n\">gal</span> <span class=\"n\">K</span> <span class=\"n\">k</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">fixes</span> <span class=\"n\">k</span> <span class=\"o\">(</span><span class=\"n\">aut_inv</span> <span class=\"n\">g</span><span class=\"bp\">.</span><span class=\"n\">val</span><span class=\"o\">)</span> <span class=\"o\">:=</span>\n<span class=\"k\">begin</span>\n    <span class=\"n\">intro</span> <span class=\"n\">x</span><span class=\"o\">,</span>\n    <span class=\"n\">apply</span> <span class=\"n\">g</span><span class=\"bp\">.</span><span class=\"n\">val</span><span class=\"bp\">.</span><span class=\"n\">to_equiv</span><span class=\"bp\">.</span><span class=\"n\">injective</span><span class=\"o\">,</span>\n    <span class=\"n\">change</span> <span class=\"n\">g</span><span class=\"bp\">.</span><span class=\"n\">val</span><span class=\"bp\">.</span><span class=\"n\">to_fun</span> <span class=\"o\">(</span><span class=\"n\">g</span><span class=\"bp\">.</span><span class=\"n\">val</span><span class=\"bp\">.</span><span class=\"n\">inv_fun</span> <span class=\"err\">↑</span><span class=\"n\">x</span><span class=\"o\">)</span> <span class=\"bp\">=</span> <span class=\"n\">g</span><span class=\"bp\">.</span><span class=\"n\">val</span><span class=\"bp\">.</span><span class=\"n\">to_fun</span> <span class=\"err\">↑</span><span class=\"n\">x</span><span class=\"o\">,</span>\n    <span class=\"n\">rw</span> <span class=\"o\">[</span><span class=\"n\">g</span><span class=\"bp\">.</span><span class=\"n\">val</span><span class=\"bp\">.</span><span class=\"n\">right_inv</span><span class=\"o\">,</span> <span class=\"n\">g</span><span class=\"bp\">.</span><span class=\"n\">property</span><span class=\"o\">],</span>\n<span class=\"kn\">end</span>\n<span class=\"n\">def</span> <span class=\"n\">gal_inv</span> <span class=\"o\">:</span> <span class=\"n\">gal</span> <span class=\"n\">K</span> <span class=\"n\">k</span> <span class=\"bp\">→</span> <span class=\"n\">gal</span> <span class=\"n\">K</span> <span class=\"n\">k</span> <span class=\"o\">:=</span> <span class=\"bp\">λ</span> <span class=\"n\">g</span> <span class=\"o\">:</span> <span class=\"n\">gal</span> <span class=\"n\">K</span> <span class=\"n\">k</span><span class=\"o\">,</span> <span class=\"bp\">⟨</span><span class=\"n\">aut_inv</span> <span class=\"n\">g</span><span class=\"bp\">.</span><span class=\"n\">val</span><span class=\"o\">,</span> <span class=\"n\">gal_closed_under_inversion</span> <span class=\"n\">g</span><span class=\"bp\">⟩</span>\n\n<span class=\"c1\">-- show is assoc</span>\n<span class=\"kn\">theorem</span> <span class=\"n\">gal_mul_assoc</span> <span class=\"o\">:</span> <span class=\"bp\">∀</span> <span class=\"o\">(</span><span class=\"n\">a</span> <span class=\"n\">b</span> <span class=\"n\">c</span> <span class=\"o\">:</span> <span class=\"n\">gal</span> <span class=\"n\">K</span> <span class=\"n\">k</span><span class=\"o\">),</span> <span class=\"n\">gal_mul</span> <span class=\"o\">(</span><span class=\"n\">gal_mul</span> <span class=\"n\">a</span> <span class=\"n\">b</span><span class=\"o\">)</span> <span class=\"n\">c</span> <span class=\"bp\">=</span> <span class=\"n\">gal_mul</span> <span class=\"n\">a</span> <span class=\"o\">(</span><span class=\"n\">gal_mul</span> <span class=\"n\">b</span> <span class=\"n\">c</span><span class=\"o\">)</span> <span class=\"o\">:=</span>\n<span class=\"k\">begin</span>\n    <span class=\"n\">intros</span> <span class=\"n\">a</span> <span class=\"n\">b</span> <span class=\"n\">c</span><span class=\"o\">,</span>\n    <span class=\"n\">split</span><span class=\"o\">,</span>\n<span class=\"kn\">end</span>\n\n<span class=\"c1\">-- show gal_one is the left and right identity</span>\n<span class=\"kn\">theorem</span> <span class=\"n\">gal_one_mul</span> <span class=\"o\">:</span> <span class=\"bp\">∀</span> <span class=\"o\">(</span><span class=\"n\">a</span> <span class=\"o\">:</span> <span class=\"n\">gal</span> <span class=\"n\">K</span> <span class=\"n\">k</span><span class=\"o\">),</span> <span class=\"n\">gal_mul</span> <span class=\"n\">gal_one</span> <span class=\"n\">a</span> <span class=\"bp\">=</span> <span class=\"n\">a</span> <span class=\"o\">:=</span>\n<span class=\"k\">begin</span>\n    <span class=\"n\">intro</span> <span class=\"n\">a</span><span class=\"o\">,</span>\n    <span class=\"n\">change</span> <span class=\"bp\">⟨</span> <span class=\"n\">aut_mul</span> <span class=\"n\">aut_one</span> <span class=\"n\">a</span><span class=\"bp\">.</span><span class=\"n\">val</span><span class=\"o\">,</span> <span class=\"n\">gal_closed_under_aut_mul</span> <span class=\"n\">gal_one</span> <span class=\"n\">a</span> <span class=\"bp\">⟩</span> <span class=\"bp\">=</span> <span class=\"n\">a</span><span class=\"o\">,</span>\n<span class=\"kn\">end</span>\n</pre></div>\n\n\n<p>The last line produces an error, specifically it tells me:</p>\n<div class=\"codehilite\"><pre><span></span>invalid constructor ⟨...⟩, expected type is not an inductive type\n  ?m_1\n</pre></div>\n\n\n<p>which isn't making much sense to me. As far as I can see the type <code>gal K k</code> really ought to be deducible, so it should be using the constructor for that type, which as a subtype is of the form <code>⟨a : ring_aut K, p : fixes k a⟩</code>.</p>",
        "id": 184546082,
        "sender_full_name": "James Weaver",
        "timestamp": 1577801789
    },
    {
        "content": "<p>use ```lean to enable syntax highlighting</p>",
        "id": 184546091,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1577801815
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span>```lean\nlorem ipsum\n```\n</pre></div>",
        "id": 184546100,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1577801833
    },
    {
        "content": "<p>change that line to:</p>\n<div class=\"codehilite\"><pre><span></span><span class=\"n\">change</span> <span class=\"o\">(</span><span class=\"bp\">⟨</span> <span class=\"n\">aut_mul</span> <span class=\"n\">aut_one</span> <span class=\"n\">a</span><span class=\"bp\">.</span><span class=\"n\">val</span><span class=\"o\">,</span> <span class=\"n\">gal_closed_under_aut_mul</span> <span class=\"n\">gal_one</span> <span class=\"n\">a</span> <span class=\"bp\">⟩</span> <span class=\"o\">:</span> <span class=\"n\">gal</span> <span class=\"n\">K</span> <span class=\"n\">k</span><span class=\"o\">)</span> <span class=\"bp\">=</span> <span class=\"n\">a</span><span class=\"o\">,</span>\n</pre></div>",
        "id": 184546159,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1577801935
    },
    {
        "content": "<p>Lean elaborates from left to right</p>",
        "id": 184546161,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1577801941
    },
    {
        "content": "<p>so Lean sees the anonymous constructor before it sees <code>a</code></p>",
        "id": 184546166,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1577801951
    },
    {
        "content": "<p>and it tries to match the type of <code>a</code> <strong>to</strong> the type of the anonymous constructor (i.e. coerce RHS to LHS)</p>",
        "id": 184546171,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1577801963
    },
    {
        "content": "<p>but Lean cannot figure out the type of the anonymous constructor</p>",
        "id": 184546175,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1577801974
    },
    {
        "content": "<p>Thanks, that really helps!</p>",
        "id": 184546355,
        "sender_full_name": "James Weaver",
        "timestamp": 1577802199
    },
    {
        "content": "<p>One issue with doing Galois theory like this (with subfields) is that in practice you might end up with two fields E and F and an injective field map from E to F, and you'll have to dance around between E and the image of the map. This is not really an issue when doing mathematics, but when formalising it in type theory you might find that it becomes a pain and you'd be better off setting things up with E a field and F an E-algebra.</p>",
        "id": 184546753,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1577802816
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span><span class=\"kn\">import</span> <span class=\"n\">algebra</span><span class=\"bp\">.</span><span class=\"n\">ring</span>\n<span class=\"kn\">import</span> <span class=\"n\">data</span><span class=\"bp\">.</span><span class=\"n\">equiv</span><span class=\"bp\">.</span><span class=\"n\">algebra</span>\n<span class=\"kn\">import</span> <span class=\"n\">field_theory</span><span class=\"bp\">.</span><span class=\"n\">subfield</span>\n\n<span class=\"n\">universes</span> <span class=\"n\">u</span>\n\n<span class=\"c1\">-- Define fixes k f for any f : ring_aut K.</span>\n<span class=\"n\">def</span> <span class=\"n\">fixes</span> <span class=\"o\">{</span><span class=\"n\">K</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span> <span class=\"n\">u</span><span class=\"o\">}</span> <span class=\"o\">[</span><span class=\"n\">discrete_field</span> <span class=\"n\">K</span><span class=\"o\">]</span> <span class=\"o\">(</span><span class=\"n\">k</span> <span class=\"o\">:</span> <span class=\"n\">set</span> <span class=\"n\">K</span><span class=\"o\">)</span> <span class=\"o\">[</span><span class=\"n\">is_subfield</span> <span class=\"n\">k</span><span class=\"o\">]</span> <span class=\"o\">(</span><span class=\"n\">f</span> <span class=\"o\">:</span> <span class=\"n\">ring_aut</span> <span class=\"n\">K</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"kt\">Prop</span> <span class=\"o\">:=</span>\n<span class=\"bp\">∀</span> <span class=\"n\">x</span> <span class=\"err\">∈</span> <span class=\"n\">k</span><span class=\"o\">,</span> <span class=\"bp\">@</span><span class=\"n\">coe_fn</span> <span class=\"bp\">_</span> <span class=\"n\">ring_equiv</span><span class=\"bp\">.</span><span class=\"n\">has_coe_to_fun</span> <span class=\"n\">f</span> <span class=\"n\">x</span> <span class=\"bp\">=</span> <span class=\"n\">x</span>\n\n<span class=\"c1\">-- Define gal K k.</span>\n<span class=\"n\">def</span> <span class=\"n\">gal</span> <span class=\"o\">(</span><span class=\"n\">K</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">)</span> <span class=\"o\">[</span><span class=\"n\">discrete_field</span> <span class=\"n\">K</span><span class=\"o\">]</span> <span class=\"o\">(</span><span class=\"n\">k</span> <span class=\"o\">:</span> <span class=\"n\">set</span> <span class=\"n\">K</span><span class=\"o\">)</span> <span class=\"o\">[</span><span class=\"n\">is_subfield</span> <span class=\"n\">k</span><span class=\"o\">]</span> <span class=\"o\">:=</span>\n<span class=\"o\">{</span> <span class=\"n\">α</span> <span class=\"o\">:</span> <span class=\"n\">K</span> <span class=\"err\">≃</span><span class=\"bp\">+*</span> <span class=\"n\">K</span> <span class=\"bp\">//</span> <span class=\"n\">fixes</span> <span class=\"n\">k</span> <span class=\"n\">α</span> <span class=\"o\">}</span>\n\n<span class=\"kn\">instance</span> <span class=\"o\">{</span><span class=\"n\">K</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span> <span class=\"o\">[</span><span class=\"n\">discrete_field</span> <span class=\"n\">K</span><span class=\"o\">]</span> <span class=\"o\">{</span><span class=\"n\">k</span> <span class=\"o\">:</span> <span class=\"n\">set</span> <span class=\"n\">K</span><span class=\"o\">}</span> <span class=\"o\">[</span><span class=\"n\">is_subfield</span> <span class=\"n\">k</span><span class=\"o\">]</span> <span class=\"o\">:</span>\n  <span class=\"n\">has_coe</span> <span class=\"o\">(</span><span class=\"n\">gal</span> <span class=\"n\">K</span> <span class=\"n\">k</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">ring_aut</span> <span class=\"n\">K</span><span class=\"o\">)</span> <span class=\"o\">:=</span>\n<span class=\"bp\">⟨λ</span> <span class=\"n\">s</span><span class=\"o\">,</span> <span class=\"n\">s</span><span class=\"bp\">.</span><span class=\"n\">val</span><span class=\"bp\">⟩</span>\n\n<span class=\"kn\">instance</span> <span class=\"o\">{</span><span class=\"n\">K</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span> <span class=\"o\">[</span><span class=\"n\">discrete_field</span> <span class=\"n\">K</span><span class=\"o\">]</span> <span class=\"o\">{</span><span class=\"n\">k</span> <span class=\"o\">:</span> <span class=\"n\">set</span> <span class=\"n\">K</span><span class=\"o\">}</span> <span class=\"o\">[</span><span class=\"n\">is_subfield</span> <span class=\"n\">k</span><span class=\"o\">]</span> <span class=\"o\">:</span>\n  <span class=\"n\">group</span> <span class=\"o\">(</span><span class=\"n\">gal</span> <span class=\"n\">K</span> <span class=\"n\">k</span><span class=\"o\">)</span> <span class=\"o\">:=</span>\n<span class=\"bp\">@</span><span class=\"n\">subtype</span><span class=\"bp\">.</span><span class=\"n\">group</span> <span class=\"o\">(</span><span class=\"n\">ring_aut</span> <span class=\"n\">K</span><span class=\"o\">)</span> <span class=\"bp\">_</span> <span class=\"o\">{</span> <span class=\"n\">f</span> <span class=\"bp\">|</span> <span class=\"n\">fixes</span> <span class=\"n\">k</span> <span class=\"n\">f</span> <span class=\"o\">}</span>\n<span class=\"o\">{</span> <span class=\"n\">mul_mem</span> <span class=\"o\">:=</span> <span class=\"bp\">λ</span> <span class=\"n\">f</span> <span class=\"n\">g</span> <span class=\"n\">hf</span> <span class=\"n\">hg</span> <span class=\"n\">x</span> <span class=\"n\">hx</span><span class=\"o\">,</span> <span class=\"k\">show</span> <span class=\"n\">f</span><span class=\"bp\">.</span><span class=\"mi\">1</span> <span class=\"o\">(</span><span class=\"n\">g</span><span class=\"bp\">.</span><span class=\"mi\">1</span> <span class=\"n\">x</span><span class=\"o\">)</span> <span class=\"bp\">=</span> <span class=\"n\">x</span><span class=\"o\">,</span> <span class=\"k\">by</span> <span class=\"n\">rw</span> <span class=\"o\">[</span><span class=\"k\">show</span> <span class=\"n\">g</span><span class=\"bp\">.</span><span class=\"mi\">1</span> <span class=\"n\">x</span> <span class=\"bp\">=</span> <span class=\"n\">x</span><span class=\"o\">,</span> <span class=\"k\">from</span> <span class=\"n\">hg</span> <span class=\"n\">x</span> <span class=\"n\">hx</span><span class=\"o\">]</span><span class=\"bp\">;</span> <span class=\"n\">exact</span> <span class=\"n\">hf</span> <span class=\"n\">x</span> <span class=\"n\">hx</span><span class=\"o\">,</span>\n  <span class=\"n\">one_mem</span> <span class=\"o\">:=</span> <span class=\"bp\">λ</span> <span class=\"n\">x</span> <span class=\"n\">hx</span><span class=\"o\">,</span> <span class=\"n\">rfl</span><span class=\"o\">,</span>\n  <span class=\"n\">inv_mem</span> <span class=\"o\">:=</span> <span class=\"bp\">λ</span> <span class=\"n\">f</span> <span class=\"n\">hf</span> <span class=\"n\">x</span> <span class=\"n\">hx</span><span class=\"o\">,</span> <span class=\"o\">(</span><span class=\"n\">equiv</span><span class=\"bp\">.</span><span class=\"n\">symm_apply_eq</span> <span class=\"bp\">_</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"mi\">2</span> <span class=\"err\">$</span> <span class=\"n\">eq</span><span class=\"bp\">.</span><span class=\"n\">symm</span> <span class=\"err\">$</span> <span class=\"n\">hf</span> <span class=\"n\">x</span> <span class=\"n\">hx</span> <span class=\"o\">}</span>\n</pre></div>",
        "id": 184546816,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1577802888
    },
    {
        "content": "<p><code>theorem aut_one_fixes_k : fixes k aut_one := begin intro, refl end</code> You don't need the rewrite, because it's true by definition ;-)</p>",
        "id": 184546818,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1577802895
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"110038\">@Kevin Buzzard</span> try as I might, I cannot fix the line with <code>@coe_fn _ ring_equiv.has_coe_to_fun f x = x</code> (L9)</p>",
        "id": 184546832,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1577802911
    },
    {
        "content": "<p>you might be familiar with priority tricks</p>",
        "id": 184546834,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1577802920
    },
    {
        "content": "<p><code>theorem aut_one_fixes_k : fixes k aut_one := λ _, rfl</code> is the term mode version</p>",
        "id": 184546841,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1577802931
    },
    {
        "content": "<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"110038\">Kevin Buzzard</span> try as I might, I cannot fix the line with <code>@coe_fn _ ring_equiv.has_coe_to_fun f x = x</code> (L9)</p>\n</blockquote>\n<div class=\"codehilite\"><pre><span></span><span class=\"bp\">∀</span> <span class=\"n\">x</span> <span class=\"err\">∈</span> <span class=\"n\">k</span><span class=\"o\">,</span> <span class=\"n\">f</span><span class=\"bp\">.</span><span class=\"n\">to_equiv</span> <span class=\"n\">x</span> <span class=\"bp\">=</span> <span class=\"n\">x</span>\n</pre></div>\n\n\n<p>? I remember talking about this with Mario. I think there's no coercion from all these higher equivs to regular equiv, and perhaps this is for a reason.</p>",
        "id": 184546965,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1577803087
    },
    {
        "content": "<p>but why isn't the <code>ring_equiv.has_coe_to_fun</code> instance triggering</p>",
        "id": 184546973,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1577803121
    },
    {
        "content": "<p>You do seem to have to manually cast them using to_equiv</p>",
        "id": 184546978,
        "sender_full_name": "James Weaver",
        "timestamp": 1577803132
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"253752\">@James Weaver</span> btw this is how I would construct the group structure</p>",
        "id": 184546980,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1577803135
    },
    {
        "content": "<p>then what is <code>ring_equiv.has_coe_to_fun</code> for</p>",
        "id": 184546996,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1577803195
    },
    {
        "content": "<p><code>@subtype.group</code> is a new one to me</p>",
        "id": 184547062,
        "sender_full_name": "James Weaver",
        "timestamp": 1577803280
    },
    {
        "content": "<p>In type theory a set is a term, not a type.</p>",
        "id": 184547115,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1577803333
    },
    {
        "content": "<p>So <code>group X</code> doesn't make sense if X is a subset of Y.</p>",
        "id": 184547120,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1577803354
    },
    {
        "content": "<p>It doesn't typecheck.</p>",
        "id": 184547130,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1577803372
    },
    {
        "content": "<p>If X is a subgroup of G, then <code>subtype.group</code> is the function you need to create the <code>group  ↥X</code> term</p>",
        "id": 184547157,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1577803429
    },
    {
        "content": "<p>right, I see</p>",
        "id": 184547201,
        "sender_full_name": "James Weaver",
        "timestamp": 1577803447
    },
    {
        "content": "<p>where that weird little up-arrow means \"change the subset X into a subtype\"</p>",
        "id": 184547202,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1577803452
    },
    {
        "content": "<p>You can figure out what Kenny is doing by just writing <code>#check @subtype.group</code>. The <code>@</code> sign means \"let me fill in all of the inputs to the function myself, even the ones you usually guess for me in the <code>{}</code> and <code>[]</code> brackets\"</p>",
        "id": 184547244,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1577803555
    },
    {
        "content": "<blockquote>\n<p>but why isn't the <code>ring_equiv.has_coe_to_fun</code> instance triggering</p>\n</blockquote>\n<p>Is it because <code>ring_aut</code> isn't syntactically equivalent to <code>ring_equiv</code>?</p>",
        "id": 184547326,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1577803637
    },
    {
        "content": "<p>/me nods</p>",
        "id": 184547351,
        "sender_full_name": "James Weaver",
        "timestamp": 1577803664
    },
    {
        "content": "<p>Right, and the $ is function application with a different binding weight so as to avoid excessive parentheses?</p>",
        "id": 184547397,
        "sender_full_name": "James Weaver",
        "timestamp": 1577803702
    },
    {
        "content": "<p>I tried <code>∀ x ∈ k, (f : K ≃+* K) x = x</code> <span class=\"user-mention\" data-user-id=\"110038\">@Kevin Buzzard</span></p>",
        "id": 184547402,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1577803710
    },
    {
        "content": "<p>(Like in Haskel)</p>",
        "id": 184547403,
        "sender_full_name": "James Weaver",
        "timestamp": 1577803711
    },
    {
        "content": "<blockquote>\n<p>I tried <code>∀ x ∈ k, (f : K ≃+* K) x = x</code> <span class=\"user-mention silent\" data-user-id=\"110038\">Kevin Buzzard</span></p>\n</blockquote>\n<p>Maybe that's one of those \"check that <code>f</code> can be considered as having type <code>ring_equiv</code> but don't actually change what Lean thinks the type of <code>f</code> is?\" issues?</p>",
        "id": 184547443,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1577803771
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span><span class=\"kn\">instance</span> <span class=\"o\">(</span><span class=\"n\">α</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">)</span> <span class=\"o\">[</span><span class=\"n\">ring</span> <span class=\"n\">α</span><span class=\"o\">]</span> <span class=\"o\">:</span> <span class=\"n\">has_coe_to_fun</span> <span class=\"o\">(</span><span class=\"n\">ring_aut</span> <span class=\"n\">α</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"bp\">⟨_</span><span class=\"o\">,</span> <span class=\"n\">ring_equiv</span><span class=\"bp\">.</span><span class=\"n\">to_fun</span><span class=\"bp\">⟩</span>\n\n<span class=\"n\">def</span> <span class=\"n\">fixes</span> <span class=\"o\">{</span><span class=\"n\">K</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span> <span class=\"n\">u</span><span class=\"o\">}</span> <span class=\"o\">[</span><span class=\"n\">discrete_field</span> <span class=\"n\">K</span><span class=\"o\">]</span> <span class=\"o\">(</span><span class=\"n\">k</span> <span class=\"o\">:</span> <span class=\"n\">set</span> <span class=\"n\">K</span><span class=\"o\">)</span> <span class=\"o\">[</span><span class=\"n\">is_subfield</span> <span class=\"n\">k</span><span class=\"o\">]</span> <span class=\"o\">(</span><span class=\"n\">f</span> <span class=\"o\">:</span> <span class=\"n\">ring_aut</span> <span class=\"n\">K</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"kt\">Prop</span> <span class=\"o\">:=</span>\n<span class=\"bp\">∀</span> <span class=\"n\">x</span> <span class=\"err\">∈</span> <span class=\"n\">k</span><span class=\"o\">,</span> <span class=\"n\">f</span> <span class=\"n\">x</span> <span class=\"bp\">=</span> <span class=\"n\">x</span>\n</pre></div>",
        "id": 184547455,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1577803802
    },
    {
        "content": "<p>ok <code>∀ x ∈ k, (show K ≃+* K, from f) x = x</code> worked but that is only zeta equivalent</p>",
        "id": 184547501,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1577803815
    },
    {
        "content": "<blockquote>\n<div class=\"codehilite\"><pre><span></span><span class=\"kn\">instance</span> <span class=\"o\">(</span><span class=\"n\">α</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">)</span> <span class=\"o\">[</span><span class=\"n\">ring</span> <span class=\"n\">α</span><span class=\"o\">]</span> <span class=\"o\">:</span> <span class=\"n\">has_coe_to_fun</span> <span class=\"o\">(</span><span class=\"n\">ring_aut</span> <span class=\"n\">α</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"bp\">⟨_</span><span class=\"o\">,</span> <span class=\"n\">ring_equiv</span><span class=\"bp\">.</span><span class=\"n\">to_fun</span><span class=\"bp\">⟩</span>\n\n<span class=\"n\">def</span> <span class=\"n\">fixes</span> <span class=\"o\">{</span><span class=\"n\">K</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span> <span class=\"n\">u</span><span class=\"o\">}</span> <span class=\"o\">[</span><span class=\"n\">discrete_field</span> <span class=\"n\">K</span><span class=\"o\">]</span> <span class=\"o\">(</span><span class=\"n\">k</span> <span class=\"o\">:</span> <span class=\"n\">set</span> <span class=\"n\">K</span><span class=\"o\">)</span> <span class=\"o\">[</span><span class=\"n\">is_subfield</span> <span class=\"n\">k</span><span class=\"o\">]</span> <span class=\"o\">(</span><span class=\"n\">f</span> <span class=\"o\">:</span> <span class=\"n\">ring_aut</span> <span class=\"n\">K</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"kt\">Prop</span> <span class=\"o\">:=</span>\n<span class=\"bp\">∀</span> <span class=\"n\">x</span> <span class=\"err\">∈</span> <span class=\"n\">k</span><span class=\"o\">,</span> <span class=\"n\">f</span> <span class=\"n\">x</span> <span class=\"bp\">=</span> <span class=\"n\">x</span>\n</pre></div>\n\n\n</blockquote>\n<p>nice</p>",
        "id": 184547506,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1577803822
    },
    {
        "content": "<p>So arguably there's a missing instance here.</p>",
        "id": 184547512,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1577803843
    },
    {
        "content": "<p>(and I don't care if I made a loop in the instance graph because eveything is defeq)</p>",
        "id": 184547522,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1577803869
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span><span class=\"kn\">import</span> <span class=\"n\">algebra</span><span class=\"bp\">.</span><span class=\"n\">ring</span>\n<span class=\"kn\">import</span> <span class=\"n\">data</span><span class=\"bp\">.</span><span class=\"n\">equiv</span><span class=\"bp\">.</span><span class=\"n\">algebra</span>\n<span class=\"kn\">import</span> <span class=\"n\">field_theory</span><span class=\"bp\">.</span><span class=\"n\">subfield</span>\n\n<span class=\"n\">universes</span> <span class=\"n\">u</span>\n\n<span class=\"c1\">-- credit Kevin Buzzard</span>\n<span class=\"kn\">instance</span> <span class=\"o\">(</span><span class=\"n\">α</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">)</span> <span class=\"o\">[</span><span class=\"n\">ring</span> <span class=\"n\">α</span><span class=\"o\">]</span> <span class=\"o\">:</span> <span class=\"n\">has_coe_to_fun</span> <span class=\"o\">(</span><span class=\"n\">ring_aut</span> <span class=\"n\">α</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"bp\">⟨_</span><span class=\"o\">,</span> <span class=\"n\">ring_equiv</span><span class=\"bp\">.</span><span class=\"n\">to_fun</span><span class=\"bp\">⟩</span>\n\n<span class=\"c1\">-- Define fixes k f for any f : ring_aut K.</span>\n<span class=\"n\">def</span> <span class=\"n\">fixes</span> <span class=\"o\">{</span><span class=\"n\">K</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span> <span class=\"n\">u</span><span class=\"o\">}</span> <span class=\"o\">[</span><span class=\"n\">discrete_field</span> <span class=\"n\">K</span><span class=\"o\">]</span> <span class=\"o\">(</span><span class=\"n\">k</span> <span class=\"o\">:</span> <span class=\"n\">set</span> <span class=\"n\">K</span><span class=\"o\">)</span> <span class=\"o\">[</span><span class=\"n\">is_subfield</span> <span class=\"n\">k</span><span class=\"o\">]</span> <span class=\"o\">(</span><span class=\"n\">f</span> <span class=\"o\">:</span> <span class=\"n\">ring_aut</span> <span class=\"n\">K</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"kt\">Prop</span> <span class=\"o\">:=</span>\n<span class=\"bp\">∀</span> <span class=\"n\">x</span> <span class=\"err\">∈</span> <span class=\"n\">k</span><span class=\"o\">,</span> <span class=\"n\">f</span> <span class=\"n\">x</span> <span class=\"bp\">=</span> <span class=\"n\">x</span>\n\n<span class=\"c1\">-- Define gal K k.</span>\n<span class=\"n\">def</span> <span class=\"n\">gal</span> <span class=\"o\">(</span><span class=\"n\">K</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">)</span> <span class=\"o\">[</span><span class=\"n\">discrete_field</span> <span class=\"n\">K</span><span class=\"o\">]</span> <span class=\"o\">(</span><span class=\"n\">k</span> <span class=\"o\">:</span> <span class=\"n\">set</span> <span class=\"n\">K</span><span class=\"o\">)</span> <span class=\"o\">[</span><span class=\"n\">is_subfield</span> <span class=\"n\">k</span><span class=\"o\">]</span> <span class=\"o\">:=</span>\n<span class=\"o\">{</span> <span class=\"n\">α</span> <span class=\"o\">:</span> <span class=\"n\">K</span> <span class=\"err\">≃</span><span class=\"bp\">+*</span> <span class=\"n\">K</span> <span class=\"bp\">//</span> <span class=\"n\">fixes</span> <span class=\"n\">k</span> <span class=\"n\">α</span> <span class=\"o\">}</span>\n\n<span class=\"kn\">instance</span> <span class=\"o\">{</span><span class=\"n\">K</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span> <span class=\"o\">[</span><span class=\"n\">discrete_field</span> <span class=\"n\">K</span><span class=\"o\">]</span> <span class=\"o\">{</span><span class=\"n\">k</span> <span class=\"o\">:</span> <span class=\"n\">set</span> <span class=\"n\">K</span><span class=\"o\">}</span> <span class=\"o\">[</span><span class=\"n\">is_subfield</span> <span class=\"n\">k</span><span class=\"o\">]</span> <span class=\"o\">:</span>\n  <span class=\"n\">has_coe</span> <span class=\"o\">(</span><span class=\"n\">gal</span> <span class=\"n\">K</span> <span class=\"n\">k</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">ring_aut</span> <span class=\"n\">K</span><span class=\"o\">)</span> <span class=\"o\">:=</span>\n<span class=\"bp\">⟨λ</span> <span class=\"n\">s</span><span class=\"o\">,</span> <span class=\"n\">s</span><span class=\"bp\">.</span><span class=\"n\">val</span><span class=\"bp\">⟩</span>\n\n<span class=\"kn\">instance</span> <span class=\"o\">{</span><span class=\"n\">K</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span> <span class=\"o\">[</span><span class=\"n\">discrete_field</span> <span class=\"n\">K</span><span class=\"o\">]</span> <span class=\"o\">{</span><span class=\"n\">k</span> <span class=\"o\">:</span> <span class=\"n\">set</span> <span class=\"n\">K</span><span class=\"o\">}</span> <span class=\"o\">[</span><span class=\"n\">is_subfield</span> <span class=\"n\">k</span><span class=\"o\">]</span> <span class=\"o\">:</span>\n  <span class=\"n\">group</span> <span class=\"o\">(</span><span class=\"n\">gal</span> <span class=\"n\">K</span> <span class=\"n\">k</span><span class=\"o\">)</span> <span class=\"o\">:=</span>\n<span class=\"bp\">@</span><span class=\"n\">subtype</span><span class=\"bp\">.</span><span class=\"n\">group</span> <span class=\"o\">(</span><span class=\"n\">ring_aut</span> <span class=\"n\">K</span><span class=\"o\">)</span> <span class=\"bp\">_</span> <span class=\"o\">{</span> <span class=\"n\">f</span> <span class=\"bp\">|</span> <span class=\"n\">fixes</span> <span class=\"n\">k</span> <span class=\"n\">f</span> <span class=\"o\">}</span>\n<span class=\"o\">{</span> <span class=\"n\">mul_mem</span> <span class=\"o\">:=</span> <span class=\"bp\">λ</span> <span class=\"n\">f</span> <span class=\"n\">g</span> <span class=\"n\">hf</span> <span class=\"n\">hg</span> <span class=\"n\">x</span> <span class=\"n\">hx</span><span class=\"o\">,</span> <span class=\"k\">show</span> <span class=\"n\">f</span> <span class=\"o\">(</span><span class=\"n\">g</span> <span class=\"n\">x</span><span class=\"o\">)</span> <span class=\"bp\">=</span> <span class=\"n\">x</span><span class=\"o\">,</span> <span class=\"k\">by</span> <span class=\"n\">rw</span> <span class=\"n\">hg</span> <span class=\"n\">x</span> <span class=\"n\">hx</span><span class=\"bp\">;</span> <span class=\"n\">exact</span> <span class=\"n\">hf</span> <span class=\"n\">x</span> <span class=\"n\">hx</span><span class=\"o\">,</span>\n  <span class=\"n\">one_mem</span> <span class=\"o\">:=</span> <span class=\"bp\">λ</span> <span class=\"n\">x</span> <span class=\"n\">hx</span><span class=\"o\">,</span> <span class=\"n\">rfl</span><span class=\"o\">,</span>\n  <span class=\"n\">inv_mem</span> <span class=\"o\">:=</span> <span class=\"bp\">λ</span> <span class=\"n\">f</span> <span class=\"n\">hf</span> <span class=\"n\">x</span> <span class=\"n\">hx</span><span class=\"o\">,</span> <span class=\"o\">(</span><span class=\"n\">equiv</span><span class=\"bp\">.</span><span class=\"n\">symm_apply_eq</span> <span class=\"bp\">_</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"mi\">2</span> <span class=\"err\">$</span> <span class=\"n\">eq</span><span class=\"bp\">.</span><span class=\"n\">symm</span> <span class=\"err\">$</span> <span class=\"n\">hf</span> <span class=\"n\">x</span> <span class=\"n\">hx</span> <span class=\"o\">}</span>\n</pre></div>",
        "id": 184547529,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1577803884
    },
    {
        "content": "<p>now the code is cleaner</p>",
        "id": 184547538,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1577803896
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span><span class=\"kn\">theorem</span> <span class=\"n\">gal_one_mul</span> <span class=\"o\">:</span> <span class=\"bp\">∀</span> <span class=\"o\">(</span><span class=\"n\">a</span> <span class=\"o\">:</span> <span class=\"n\">gal</span> <span class=\"n\">K</span> <span class=\"n\">k</span><span class=\"o\">),</span> <span class=\"n\">gal_mul</span> <span class=\"n\">gal_one</span> <span class=\"n\">a</span> <span class=\"bp\">=</span> <span class=\"n\">a</span> <span class=\"o\">:=</span>\n<span class=\"k\">begin</span>\n  <span class=\"n\">intro</span> <span class=\"n\">a</span><span class=\"o\">,</span>\n  <span class=\"n\">unfold</span> <span class=\"n\">gal_mul</span> <span class=\"n\">gal_one</span><span class=\"o\">,</span>\n  <span class=\"n\">unfold_coes</span><span class=\"o\">,</span>\n  <span class=\"n\">dsimp</span><span class=\"o\">,</span>\n<span class=\"bp\">...</span>\n</pre></div>\n\n\n<p>is another way of getting around the <code>change</code> issue. But actually the correct thing to do is to play around like I'm doing above, and then see what you want to change the goal to, and then use <code>change</code> the way Kenny said.</p>",
        "id": 184547799,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1577804204
    },
    {
        "content": "<p>I did find the operation of the function <code>set</code> a little surprising<br>\nI would have expected <code>set K</code> to be an assertion that <code>K</code> is a set or a way of accessing the underlying set of <code>K</code>, but it seems that <code>set K</code> is the type of subsets of the underlying set of <code>K</code>.</p>",
        "id": 184547874,
        "sender_full_name": "James Weaver",
        "timestamp": 1577804300
    },
    {
        "content": "<p>There's no \"underlying set\" -- it's type theory.</p>",
        "id": 184547887,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1577804329
    },
    {
        "content": "<p>I spent a long time mentally changing <code>set K</code> to <code>subset_of K</code> before I got the hang of it.</p>",
        "id": 184547902,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1577804355
    },
    {
        "content": "<p>This kerfuffle is one reason why I would consider setting it up with k and K both types and an injective field map k -&gt; K. This is a delicate type theory foundational issue which has burned me in the past (I wrote a bunch of MSc level algebraic and arithmetic geometry up in Lean and it taught me loads about what to avoid -- the hard way).</p>",
        "id": 184547993,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1577804449
    },
    {
        "content": "<p>That's always the way when learning a language I find. You learn by doing wrongly.</p>",
        "id": 184548024,
        "sender_full_name": "James Weaver",
        "timestamp": 1577804497
    },
    {
        "content": "<p>The way to think about it is to imagine what might come your way in the future which you might want to apply your theory to, and if your theory only applies after a lot of pain then you might have set up your theory incorrectly. The p-adic valuation of 0 is +infinity and as you can imagine, this is a pain. But here's a summary of how it caused me far more pain than it should have done.</p>",
        "id": 184548086,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1577804534
    },
    {
        "content": "<p>We were setting up a theory of adic spaces so we needed a theory of norms on general rings. A general norm takes values (in the mathematical literature) in the set <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>0</mn><mo>∪</mo><mi mathvariant=\"normal\">Γ</mi></mrow><annotation encoding=\"application/x-tex\">{0}\\cup\\Gamma</annotation></semantics></math></span><span aria-hidden=\"true\" class=\"katex-html\"><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord\">0</span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">∪</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord\">Γ</span></span></span></span> where <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"normal\">Γ</mi></mrow><annotation encoding=\"application/x-tex\">\\Gamma</annotation></semantics></math></span><span aria-hidden=\"true\" class=\"katex-html\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord\">Γ</span></span></span></span> is a totally ordered group under multiplication (for example the positive reals). We dutifully defined a new function which ate Gamma and spat out {0} union Gamma.</p>",
        "id": 184548146,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1577804620
    },
    {
        "content": "<p>and then let our norms take values in this. And then we tried to unify our work with the p-adic norm, but the p-adic norm was taking values in the non-negative real numbers :-/ and although this might be canonically isomorphic to {0} union (positive reals), it wasn't _equal_ to it, so there was a lot of faffing around which culminated in our changing our definition of a general norm.</p>",
        "id": 184548224,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1577804700
    },
    {
        "content": "<p>This issue doesn't exist mathematically, because of course <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi mathvariant=\"double-struck\">R</mi><mrow><mo>≥</mo><mn>0</mn></mrow></msub><mo>=</mo><msub><mi mathvariant=\"double-struck\">R</mi><mrow><mo>&gt;</mo><mn>0</mn></mrow></msub><mo>∪</mo><mo stretchy=\"false\">{</mo><mn>0</mn><mo stretchy=\"false\">}</mo></mrow><annotation encoding=\"application/x-tex\">\\mathbb{R}_{\\geq0}=\\mathbb{R}_{&gt;0}\\cup\\{0\\}</annotation></semantics></math></span><span aria-hidden=\"true\" class=\"katex-html\"><span class=\"base\"><span class=\"strut\" style=\"height:0.934069em;vertical-align:-0.24517899999999998em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathbb\">R</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.301108em;\"><span style=\"top:-2.5500000000000003em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mrel mtight\">≥</span><span class=\"mord mtight\">0</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.24517899999999998em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.86626em;vertical-align:-0.17737em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathbb\">R</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mrel mtight\">&gt;</span><span class=\"mord mtight\">0</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.17737em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">∪</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">{</span><span class=\"mord\">0</span><span class=\"mclose\">}</span></span></span></span>, but this is a set-theoretic equals not a type-theoretic one.</p>",
        "id": 184548256,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1577804759
    },
    {
        "content": "<p>in type theory, there are maps in both directions and you can get sick of them very quickly.</p>",
        "id": 184548302,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1577804782
    },
    {
        "content": "<p>so if you want to do Gal(C/R) with your Galois theory, but for some reason you want to use Lean's real numbers, which are of course not <em>defined</em> as a subfield of the complex numbers, then you'll be forever passing between Lean's real numbers and the subfield of C.</p>",
        "id": 184548390,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1577804899
    },
    {
        "content": "<p>something which is completely transparent to a mathematician but which is an issue when formalising.</p>",
        "id": 184548397,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1577804925
    },
    {
        "content": "<p>ugh, yes</p>",
        "id": 184548405,
        "sender_full_name": "James Weaver",
        "timestamp": 1577804936
    },
    {
        "content": "<p>To be honest mathematicians can get very sloppy with equality and isomorphism</p>",
        "id": 184548422,
        "sender_full_name": "James Weaver",
        "timestamp": 1577804962
    },
    {
        "content": "<p>Mathematicians know that nothing changes if you move from the reals as Cauchy sequences to the reals as Dedekind cuts to the reals as a subfield of C, but really these are all (\"canonical\") isomorphisms, and they are sufficiently canonical that any sensible mathematical statement about \"the reals\" will be true for one iff it's true for all of them. However there are stupid statements which are only true for some and not for others (e.g. in set theory one could ask \"is the real number 37 a countable or an uncountable set?\") and in type theory there are analogous pathological (i.e. non-mathematical) questions which one could ask about \"the reals\" which might be true for one model and false for others.</p>",
        "id": 184548531,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1577805077
    },
    {
        "content": "<p>This means that working with isomorphisms is harder than it should be (e.g. you can't <code>rw h</code> if <code>h</code> is a proof that the rings A and B are <strong>isomorphic</strong>, and you have a proof that A is Noetherian, and your goal is to prove that B is Noetherian).</p>",
        "id": 184548614,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1577805160
    },
    {
        "content": "<p>one day a computer scientist will come and write some kind of <code>rw</code> on steroids which will let us rewrite here, because <code>Noetherian</code> will be tagged with a special tag saying \"this predicate on rings is constant on isomorphism classes\"</p>",
        "id": 184548657,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1577805237
    },
    {
        "content": "<p>but that hasn't happened yet.</p>",
        "id": 184548697,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1577805248
    },
    {
        "content": "<p>Right, after some changes based on what you both said yesterday this is what I have now:</p>\n<div class=\"codehilite\"><pre><span></span><span class=\"kn\">import</span> <span class=\"n\">algebra</span><span class=\"bp\">.</span><span class=\"n\">ring</span>\n<span class=\"kn\">import</span> <span class=\"n\">data</span><span class=\"bp\">.</span><span class=\"n\">equiv</span><span class=\"bp\">.</span><span class=\"n\">algebra</span>\n<span class=\"kn\">import</span> <span class=\"n\">field_theory</span><span class=\"bp\">.</span><span class=\"n\">subfield</span>\n\n<span class=\"n\">universes</span> <span class=\"n\">u</span>\n\n<span class=\"c1\">-- Causes ring automorphisms K ≃+* K to be coercible to functions K → K</span>\n<span class=\"c1\">-- credit Kevin Buzzard</span>\n<span class=\"kn\">instance</span> <span class=\"o\">(</span><span class=\"n\">α</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">)</span> <span class=\"o\">[</span><span class=\"n\">ring</span> <span class=\"n\">α</span><span class=\"o\">]</span> <span class=\"o\">:</span> <span class=\"n\">has_coe_to_fun</span> <span class=\"o\">(</span><span class=\"n\">ring_aut</span> <span class=\"n\">α</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"bp\">⟨_</span><span class=\"o\">,</span> <span class=\"n\">ring_equiv</span><span class=\"bp\">.</span><span class=\"n\">to_fun</span><span class=\"bp\">⟩</span>\n\n<span class=\"c1\">-- Define a field extension as a chosen monomorphism k → K</span>\n<span class=\"kn\">structure</span> <span class=\"n\">field_extension</span>\n    <span class=\"o\">(</span><span class=\"n\">K</span> <span class=\"n\">k</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">)</span> <span class=\"o\">[</span><span class=\"n\">discrete_field</span> <span class=\"n\">k</span><span class=\"o\">]</span> <span class=\"o\">[</span><span class=\"n\">discrete_field</span> <span class=\"n\">K</span><span class=\"o\">]</span>\n        <span class=\"o\">:=</span> <span class=\"n\">mk</span> <span class=\"bp\">::</span> <span class=\"o\">(</span><span class=\"n\">inc</span><span class=\"o\">:</span> <span class=\"n\">ring_hom</span> <span class=\"n\">k</span> <span class=\"n\">K</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">inj</span><span class=\"o\">:</span> <span class=\"n\">function</span><span class=\"bp\">.</span><span class=\"n\">injective</span> <span class=\"n\">inc</span><span class=\"bp\">.</span><span class=\"n\">to_fun</span><span class=\"o\">)</span>\n\n<span class=\"c1\">-- Define a coercion from a field extension to a ring_homomorphism, this in turn provides coercions to</span>\n<span class=\"c1\">-- other types including k → K</span>\n<span class=\"kn\">instance</span>\n    <span class=\"o\">(</span><span class=\"n\">K</span> <span class=\"n\">k</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">)</span> <span class=\"o\">[</span><span class=\"n\">discrete_field</span> <span class=\"n\">k</span><span class=\"o\">]</span> <span class=\"o\">[</span><span class=\"n\">discrete_field</span> <span class=\"n\">K</span><span class=\"o\">]</span> <span class=\"o\">:</span>\n        <span class=\"n\">has_coe</span> <span class=\"o\">(</span><span class=\"n\">field_extension</span> <span class=\"n\">K</span> <span class=\"n\">k</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">ring_hom</span> <span class=\"n\">k</span> <span class=\"n\">K</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"bp\">⟨λ</span> <span class=\"n\">ext</span><span class=\"o\">,</span> <span class=\"n\">ext</span><span class=\"bp\">.</span><span class=\"n\">inc</span><span class=\"bp\">⟩</span>\n\n\n<span class=\"c1\">-- Define fixes k f for any f : ring_aut K.</span>\n<span class=\"n\">def</span> <span class=\"n\">fixes</span>\n    <span class=\"o\">{</span><span class=\"n\">K</span> <span class=\"n\">k</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span> <span class=\"n\">u</span><span class=\"o\">}</span> <span class=\"o\">[</span><span class=\"n\">discrete_field</span> <span class=\"n\">k</span><span class=\"o\">]</span> <span class=\"o\">[</span><span class=\"n\">discrete_field</span> <span class=\"n\">K</span><span class=\"o\">]</span>\n    <span class=\"o\">(</span><span class=\"n\">ext</span><span class=\"o\">:</span> <span class=\"n\">field_extension</span> <span class=\"n\">K</span> <span class=\"n\">k</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">f</span> <span class=\"o\">:</span> <span class=\"n\">ring_aut</span> <span class=\"n\">K</span><span class=\"o\">)</span>\n        <span class=\"o\">:</span> <span class=\"kt\">Prop</span> <span class=\"o\">:=</span> <span class=\"bp\">∀</span> <span class=\"n\">x</span> <span class=\"o\">:</span> <span class=\"n\">k</span><span class=\"o\">,</span> <span class=\"n\">f</span> <span class=\"o\">(</span><span class=\"n\">ext</span> <span class=\"n\">x</span><span class=\"o\">)</span> <span class=\"bp\">=</span> <span class=\"n\">ext</span> <span class=\"n\">x</span>\n\n<span class=\"c1\">-- Define gal for an extension</span>\n<span class=\"n\">def</span> <span class=\"n\">gal</span>\n    <span class=\"o\">{</span><span class=\"n\">K</span> <span class=\"n\">k</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span> <span class=\"n\">u</span><span class=\"o\">}</span> <span class=\"o\">[</span><span class=\"n\">discrete_field</span> <span class=\"n\">k</span><span class=\"o\">]</span> <span class=\"o\">[</span><span class=\"n\">discrete_field</span> <span class=\"n\">K</span><span class=\"o\">]</span>\n    <span class=\"o\">(</span><span class=\"n\">K_k</span><span class=\"o\">:</span> <span class=\"n\">field_extension</span> <span class=\"n\">K</span> <span class=\"n\">k</span><span class=\"o\">)</span>\n        <span class=\"o\">:=</span> <span class=\"o\">{</span> <span class=\"n\">α</span> <span class=\"o\">:</span> <span class=\"n\">ring_aut</span> <span class=\"n\">K</span> <span class=\"bp\">//</span> <span class=\"n\">fixes</span> <span class=\"n\">K_k</span> <span class=\"n\">α</span> <span class=\"o\">}</span>\n\n<span class=\"c1\">-- Define a coercion from gal K_k to ring_aut K</span>\n<span class=\"c1\">-- This in turn will allow coercions further including to K → K</span>\n<span class=\"kn\">instance</span>\n    <span class=\"o\">{</span><span class=\"n\">K</span> <span class=\"n\">k</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span> <span class=\"n\">u</span><span class=\"o\">}</span> <span class=\"o\">[</span><span class=\"n\">discrete_field</span> <span class=\"n\">k</span><span class=\"o\">]</span> <span class=\"o\">[</span><span class=\"n\">discrete_field</span> <span class=\"n\">K</span><span class=\"o\">]</span>\n    <span class=\"o\">(</span><span class=\"n\">K_k</span><span class=\"o\">:</span> <span class=\"n\">field_extension</span> <span class=\"n\">K</span> <span class=\"n\">k</span><span class=\"o\">)</span> <span class=\"o\">:</span>\n        <span class=\"n\">has_coe</span> <span class=\"o\">(</span><span class=\"n\">gal</span> <span class=\"n\">K_k</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">ring_aut</span> <span class=\"n\">K</span><span class=\"o\">)</span> <span class=\"o\">:=</span>\n            <span class=\"bp\">⟨λ</span> <span class=\"n\">s</span><span class=\"o\">,</span> <span class=\"n\">s</span><span class=\"bp\">.</span><span class=\"n\">val</span><span class=\"bp\">⟩</span>\n\n<span class=\"c1\">-- Prove that gal K_k is a group under composition</span>\n<span class=\"kn\">instance</span>\n    <span class=\"o\">{</span><span class=\"n\">K</span> <span class=\"n\">k</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span> <span class=\"n\">u</span><span class=\"o\">}</span> <span class=\"o\">[</span><span class=\"n\">discrete_field</span> <span class=\"n\">k</span><span class=\"o\">]</span> <span class=\"o\">[</span><span class=\"n\">discrete_field</span> <span class=\"n\">K</span><span class=\"o\">]</span>\n    <span class=\"o\">(</span><span class=\"n\">K_k</span><span class=\"o\">:</span> <span class=\"n\">field_extension</span> <span class=\"n\">K</span> <span class=\"n\">k</span><span class=\"o\">)</span> <span class=\"o\">:</span>\n        <span class=\"n\">group</span> <span class=\"o\">(</span><span class=\"n\">gal</span> <span class=\"n\">K_k</span><span class=\"o\">)</span> <span class=\"o\">:=</span>\n<span class=\"bp\">@</span><span class=\"n\">subtype</span><span class=\"bp\">.</span><span class=\"n\">group</span> <span class=\"o\">(</span><span class=\"n\">ring_aut</span> <span class=\"n\">K</span><span class=\"o\">)</span> <span class=\"bp\">_</span> <span class=\"o\">{</span> <span class=\"n\">f</span> <span class=\"bp\">|</span> <span class=\"n\">fixes</span> <span class=\"n\">K_k</span> <span class=\"n\">f</span> <span class=\"o\">}</span>\n<span class=\"o\">{</span> <span class=\"n\">mul_mem</span> <span class=\"o\">:=</span> <span class=\"bp\">λ</span> <span class=\"n\">f</span> <span class=\"n\">g</span> <span class=\"n\">hf</span> <span class=\"n\">hg</span> <span class=\"n\">x</span><span class=\"o\">,</span> <span class=\"k\">show</span> <span class=\"n\">f</span> <span class=\"o\">(</span><span class=\"n\">g</span> <span class=\"err\">$</span> <span class=\"n\">K_k</span> <span class=\"n\">x</span><span class=\"o\">)</span> <span class=\"bp\">=</span> <span class=\"n\">K_k</span> <span class=\"n\">x</span><span class=\"o\">,</span> <span class=\"k\">by</span> <span class=\"n\">rw</span> <span class=\"n\">hg</span> <span class=\"n\">x</span><span class=\"bp\">;</span> <span class=\"n\">exact</span> <span class=\"n\">hf</span> <span class=\"n\">x</span><span class=\"o\">,</span>\n  <span class=\"n\">one_mem</span> <span class=\"o\">:=</span> <span class=\"bp\">λ</span> <span class=\"n\">x</span><span class=\"o\">,</span> <span class=\"k\">by</span> <span class=\"n\">refl</span><span class=\"o\">,</span>\n  <span class=\"n\">inv_mem</span> <span class=\"o\">:=</span> <span class=\"bp\">λ</span> <span class=\"n\">f</span> <span class=\"n\">hf</span> <span class=\"n\">x</span><span class=\"o\">,</span> <span class=\"o\">(</span><span class=\"n\">equiv</span><span class=\"bp\">.</span><span class=\"n\">symm_apply_eq</span> <span class=\"bp\">_</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"mi\">2</span> <span class=\"err\">$</span> <span class=\"n\">eq</span><span class=\"bp\">.</span><span class=\"n\">symm</span> <span class=\"err\">$</span> <span class=\"n\">hf</span> <span class=\"n\">x</span> <span class=\"o\">}</span>\n</pre></div>\n\n\n<p>which seems fine in of itself, but when I try adding this below:</p>\n<div class=\"codehilite\"><pre><span></span><span class=\"kn\">instance</span> <span class=\"o\">(</span><span class=\"n\">K</span> <span class=\"n\">k</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">)</span> <span class=\"o\">[</span><span class=\"n\">discrete_field</span> <span class=\"n\">k</span><span class=\"o\">]</span> <span class=\"o\">[</span><span class=\"n\">discrete_field</span> <span class=\"n\">K</span><span class=\"o\">]</span> <span class=\"o\">(</span><span class=\"n\">K_k</span> <span class=\"o\">:</span> <span class=\"n\">field_extension</span> <span class=\"n\">K</span> <span class=\"n\">k</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">has_coe</span> <span class=\"n\">k</span> <span class=\"n\">K</span> <span class=\"o\">:=</span> <span class=\"bp\">⟨</span><span class=\"n\">K_k</span><span class=\"bp\">⟩</span>\n\n\n<span class=\"kn\">variable</span> <span class=\"n\">K</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span> <span class=\"n\">u</span>\n<span class=\"kn\">variable</span> <span class=\"n\">k</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span> <span class=\"n\">u</span>\n<span class=\"kn\">variable</span> <span class=\"n\">f</span> <span class=\"o\">:</span> <span class=\"n\">K</span> <span class=\"bp\">→</span> <span class=\"n\">K</span>\n<span class=\"kn\">variable</span> <span class=\"o\">[</span><span class=\"n\">discrete_field</span> <span class=\"n\">k</span><span class=\"o\">]</span>\n<span class=\"kn\">variable</span> <span class=\"o\">[</span><span class=\"n\">discrete_field</span> <span class=\"n\">K</span><span class=\"o\">]</span>\n\n<span class=\"bp\">#</span><span class=\"kn\">check</span> <span class=\"n\">f</span> <span class=\"o\">(</span><span class=\"n\">discrete_field</span><span class=\"bp\">.</span><span class=\"n\">one</span> <span class=\"n\">k</span><span class=\"o\">)</span>\n</pre></div>\n\n\n<p>I get a peculiar (to me) error where it complains that it can't automatically synthesise a name for the <code>has_coe</code> instance, which is odd since no other has_coe instance I've seen has needed an explicit name. Adding an explicit name fixes that error, but the check in the last line doesn't seem to find the coercion from k to K and complains that <code>discrete_field one k</code> isn't a <code>K</code>.</p>\n<p>Any thoughts? Have I made another obvious mistake somewhere?</p>",
        "id": 184596607,
        "sender_full_name": "James Weaver",
        "timestamp": 1577882536
    },
    {
        "content": "<p>every ring hom between two fields is injective</p>",
        "id": 184596624,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1577882597
    },
    {
        "content": "<p>Of course it is. Shows how long it's been since I was doing maths regularly.</p>",
        "id": 184596667,
        "sender_full_name": "James Weaver",
        "timestamp": 1577882650
    },
    {
        "content": "<p>Ok, right, so that being the case, this seems sufficient:</p>\n<div class=\"codehilite\"><pre><span></span><span class=\"kn\">import</span> <span class=\"n\">algebra</span><span class=\"bp\">.</span><span class=\"n\">ring</span>\n<span class=\"kn\">import</span> <span class=\"n\">data</span><span class=\"bp\">.</span><span class=\"n\">equiv</span><span class=\"bp\">.</span><span class=\"n\">algebra</span>\n<span class=\"kn\">import</span> <span class=\"n\">field_theory</span><span class=\"bp\">.</span><span class=\"n\">subfield</span>\n\n<span class=\"n\">universes</span> <span class=\"n\">u</span>\n\n<span class=\"c1\">-- Causes ring automorphisms K ≃+* K to be coercible to functions K → K</span>\n<span class=\"c1\">-- credit Kevin Buzzard</span>\n<span class=\"kn\">instance</span> <span class=\"o\">(</span><span class=\"n\">α</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">)</span> <span class=\"o\">[</span><span class=\"n\">ring</span> <span class=\"n\">α</span><span class=\"o\">]</span> <span class=\"o\">:</span> <span class=\"n\">has_coe_to_fun</span> <span class=\"o\">(</span><span class=\"n\">ring_aut</span> <span class=\"n\">α</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"bp\">⟨_</span><span class=\"o\">,</span> <span class=\"n\">ring_equiv</span><span class=\"bp\">.</span><span class=\"n\">to_fun</span><span class=\"bp\">⟩</span>\n\n\n<span class=\"c1\">-- Define fixes k f for any f : ring_aut K.</span>\n<span class=\"n\">def</span> <span class=\"n\">fixes</span>\n    <span class=\"o\">{</span><span class=\"n\">K</span> <span class=\"n\">k</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span> <span class=\"n\">u</span><span class=\"o\">}</span> <span class=\"o\">[</span><span class=\"n\">discrete_field</span> <span class=\"n\">k</span><span class=\"o\">]</span> <span class=\"o\">[</span><span class=\"n\">discrete_field</span> <span class=\"n\">K</span><span class=\"o\">]</span>\n    <span class=\"o\">(</span><span class=\"n\">ext</span><span class=\"o\">:</span> <span class=\"n\">k</span> <span class=\"bp\">→+*</span> <span class=\"n\">K</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">f</span> <span class=\"o\">:</span> <span class=\"n\">ring_aut</span> <span class=\"n\">K</span><span class=\"o\">)</span>\n        <span class=\"o\">:</span> <span class=\"kt\">Prop</span> <span class=\"o\">:=</span> <span class=\"bp\">∀</span> <span class=\"n\">x</span> <span class=\"o\">:</span> <span class=\"n\">k</span><span class=\"o\">,</span> <span class=\"n\">f</span> <span class=\"o\">(</span><span class=\"n\">ext</span> <span class=\"n\">x</span><span class=\"o\">)</span> <span class=\"bp\">=</span> <span class=\"n\">ext</span> <span class=\"n\">x</span>\n\n<span class=\"c1\">-- Define gal for an extension</span>\n<span class=\"n\">def</span> <span class=\"n\">gal</span>\n    <span class=\"o\">{</span><span class=\"n\">K</span> <span class=\"n\">k</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span> <span class=\"n\">u</span><span class=\"o\">}</span> <span class=\"o\">[</span><span class=\"n\">discrete_field</span> <span class=\"n\">k</span><span class=\"o\">]</span> <span class=\"o\">[</span><span class=\"n\">discrete_field</span> <span class=\"n\">K</span><span class=\"o\">]</span>\n    <span class=\"o\">(</span><span class=\"n\">K_k</span><span class=\"o\">:</span> <span class=\"n\">k</span> <span class=\"bp\">→+*</span> <span class=\"n\">K</span><span class=\"o\">)</span>\n        <span class=\"o\">:=</span> <span class=\"o\">{</span> <span class=\"n\">α</span> <span class=\"o\">:</span> <span class=\"n\">ring_aut</span> <span class=\"n\">K</span> <span class=\"bp\">//</span> <span class=\"n\">fixes</span> <span class=\"n\">K_k</span> <span class=\"n\">α</span> <span class=\"o\">}</span>\n\n<span class=\"c1\">-- Define a coercion from gal K_k to ring_aut K</span>\n<span class=\"c1\">-- This in turn will allow coercions further including to K → K</span>\n<span class=\"kn\">instance</span>\n    <span class=\"o\">{</span><span class=\"n\">K</span> <span class=\"n\">k</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span> <span class=\"n\">u</span><span class=\"o\">}</span> <span class=\"o\">[</span><span class=\"n\">discrete_field</span> <span class=\"n\">k</span><span class=\"o\">]</span> <span class=\"o\">[</span><span class=\"n\">discrete_field</span> <span class=\"n\">K</span><span class=\"o\">]</span>\n    <span class=\"o\">(</span><span class=\"n\">K_k</span><span class=\"o\">:</span> <span class=\"n\">k</span> <span class=\"bp\">→+*</span> <span class=\"n\">K</span><span class=\"o\">)</span> <span class=\"o\">:</span>\n        <span class=\"n\">has_coe</span> <span class=\"o\">(</span><span class=\"n\">gal</span> <span class=\"n\">K_k</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">ring_aut</span> <span class=\"n\">K</span><span class=\"o\">)</span> <span class=\"o\">:=</span>\n            <span class=\"bp\">⟨λ</span> <span class=\"n\">s</span><span class=\"o\">,</span> <span class=\"n\">s</span><span class=\"bp\">.</span><span class=\"n\">val</span><span class=\"bp\">⟩</span>\n\n<span class=\"c1\">-- Prove that gal K_k is a group under composition</span>\n<span class=\"kn\">instance</span>\n    <span class=\"o\">{</span><span class=\"n\">K</span> <span class=\"n\">k</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span> <span class=\"n\">u</span><span class=\"o\">}</span> <span class=\"o\">[</span><span class=\"n\">discrete_field</span> <span class=\"n\">k</span><span class=\"o\">]</span> <span class=\"o\">[</span><span class=\"n\">discrete_field</span> <span class=\"n\">K</span><span class=\"o\">]</span>\n    <span class=\"o\">(</span><span class=\"n\">K_k</span><span class=\"o\">:</span> <span class=\"n\">k</span> <span class=\"bp\">→+*</span> <span class=\"n\">K</span><span class=\"o\">)</span> <span class=\"o\">:</span>\n        <span class=\"n\">group</span> <span class=\"o\">(</span><span class=\"n\">gal</span> <span class=\"n\">K_k</span><span class=\"o\">)</span> <span class=\"o\">:=</span>\n<span class=\"bp\">@</span><span class=\"n\">subtype</span><span class=\"bp\">.</span><span class=\"n\">group</span> <span class=\"o\">(</span><span class=\"n\">ring_aut</span> <span class=\"n\">K</span><span class=\"o\">)</span> <span class=\"bp\">_</span> <span class=\"o\">{</span> <span class=\"n\">f</span> <span class=\"bp\">|</span> <span class=\"n\">fixes</span> <span class=\"n\">K_k</span> <span class=\"n\">f</span> <span class=\"o\">}</span>\n<span class=\"o\">{</span> <span class=\"n\">mul_mem</span> <span class=\"o\">:=</span> <span class=\"bp\">λ</span> <span class=\"n\">f</span> <span class=\"n\">g</span> <span class=\"n\">hf</span> <span class=\"n\">hg</span> <span class=\"n\">x</span><span class=\"o\">,</span> <span class=\"k\">show</span> <span class=\"n\">f</span> <span class=\"o\">(</span><span class=\"n\">g</span> <span class=\"err\">$</span> <span class=\"n\">K_k</span> <span class=\"n\">x</span><span class=\"o\">)</span> <span class=\"bp\">=</span> <span class=\"n\">K_k</span> <span class=\"n\">x</span><span class=\"o\">,</span> <span class=\"k\">by</span> <span class=\"n\">rw</span> <span class=\"n\">hg</span> <span class=\"n\">x</span><span class=\"bp\">;</span> <span class=\"n\">exact</span> <span class=\"n\">hf</span> <span class=\"n\">x</span><span class=\"o\">,</span>\n  <span class=\"n\">one_mem</span> <span class=\"o\">:=</span> <span class=\"bp\">λ</span> <span class=\"n\">x</span><span class=\"o\">,</span> <span class=\"k\">by</span> <span class=\"n\">refl</span><span class=\"o\">,</span>\n  <span class=\"n\">inv_mem</span> <span class=\"o\">:=</span> <span class=\"bp\">λ</span> <span class=\"n\">f</span> <span class=\"n\">hf</span> <span class=\"n\">x</span><span class=\"o\">,</span> <span class=\"o\">(</span><span class=\"n\">equiv</span><span class=\"bp\">.</span><span class=\"n\">symm_apply_eq</span> <span class=\"bp\">_</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"mi\">2</span> <span class=\"err\">$</span> <span class=\"n\">eq</span><span class=\"bp\">.</span><span class=\"n\">symm</span> <span class=\"err\">$</span> <span class=\"n\">hf</span> <span class=\"n\">x</span> <span class=\"o\">}</span>\n</pre></div>",
        "id": 184596981,
        "sender_full_name": "James Weaver",
        "timestamp": 1577883222
    },
    {
        "content": "<p>Still running into a problem with</p>\n<div class=\"codehilite\"><pre><span></span><span class=\"c1\">-- introduce an example</span>\n<span class=\"kn\">variable</span> <span class=\"n\">K</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span> <span class=\"n\">u</span>\n<span class=\"kn\">variable</span> <span class=\"n\">k</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span> <span class=\"n\">u</span>\n<span class=\"kn\">variable</span> <span class=\"o\">[</span><span class=\"n\">discrete_field</span> <span class=\"n\">k</span><span class=\"o\">]</span>\n<span class=\"kn\">variable</span> <span class=\"o\">[</span><span class=\"n\">discrete_field</span> <span class=\"n\">K</span><span class=\"o\">]</span>\n<span class=\"kn\">variable</span> <span class=\"n\">i</span> <span class=\"o\">:</span> <span class=\"n\">k</span> <span class=\"bp\">→+*</span> <span class=\"n\">K</span>\n\n<span class=\"kn\">instance</span> <span class=\"n\">n</span><span class=\"o\">:</span><span class=\"n\">has_coe</span> <span class=\"n\">k</span> <span class=\"n\">K</span> <span class=\"o\">:=</span> <span class=\"bp\">⟨</span><span class=\"n\">i</span><span class=\"bp\">⟩</span>\n\n<span class=\"kn\">variable</span> <span class=\"n\">f</span> <span class=\"o\">:</span> <span class=\"n\">K</span> <span class=\"bp\">→</span> <span class=\"n\">K</span>\n\n<span class=\"bp\">#</span><span class=\"kn\">check</span> <span class=\"n\">f</span> <span class=\"o\">(</span><span class=\"mi\">1</span> <span class=\"o\">:</span> <span class=\"n\">k</span><span class=\"o\">)</span>\n</pre></div>\n\n\n<p>though.  The has_coe instance demands an explicit name and isn't found by the #check command.</p>",
        "id": 184597213,
        "sender_full_name": "James Weaver",
        "timestamp": 1577883679
    },
    {
        "content": "<p>I think your problem is that i is a variable, the following works</p>\n<div class=\"codehilite\"><pre><span></span><span class=\"kn\">universe</span> <span class=\"n\">u</span>\n\n\n<span class=\"kn\">variable</span> <span class=\"n\">K</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span><span class=\"bp\">*</span>\n<span class=\"kn\">variable</span> <span class=\"n\">k</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span><span class=\"bp\">*</span>\n<span class=\"kn\">variable</span> <span class=\"o\">[</span><span class=\"n\">discrete_field</span> <span class=\"n\">k</span><span class=\"o\">]</span>\n<span class=\"kn\">variable</span> <span class=\"o\">[</span><span class=\"n\">discrete_field</span> <span class=\"n\">K</span><span class=\"o\">]</span>\n<span class=\"n\">def</span> <span class=\"n\">i</span> <span class=\"o\">:</span> <span class=\"n\">k</span> <span class=\"bp\">→+*</span> <span class=\"n\">K</span> <span class=\"o\">:=</span> <span class=\"n\">sorry</span>\n\n<span class=\"kn\">instance</span> <span class=\"n\">n</span> <span class=\"o\">:</span> <span class=\"n\">has_coe</span> <span class=\"n\">k</span> <span class=\"n\">K</span> <span class=\"o\">:=</span> <span class=\"bp\">⟨</span><span class=\"n\">i</span> <span class=\"n\">K</span> <span class=\"n\">k</span><span class=\"bp\">⟩</span>\n<span class=\"kn\">variable</span> <span class=\"n\">f</span> <span class=\"o\">:</span> <span class=\"n\">K</span> <span class=\"bp\">→</span> <span class=\"n\">K</span>\n\n<span class=\"bp\">#</span><span class=\"kn\">check</span> <span class=\"n\">f</span> <span class=\"o\">(</span><span class=\"mi\">1</span> <span class=\"o\">:</span> <span class=\"n\">k</span><span class=\"o\">)</span>\n</pre></div>",
        "id": 184597515,
        "sender_full_name": "Alex J. Best",
        "timestamp": 1577884259
    },
    {
        "content": "<p>I don't know exactly what your use case is so maybe this isnt that useful? But before you had <code>n</code> depending on <code>i</code> so the coercion couldn't just pick one <code>i</code>to make the coercion from?</p>",
        "id": 184597640,
        "sender_full_name": "Alex J. Best",
        "timestamp": 1577884443
    }
]