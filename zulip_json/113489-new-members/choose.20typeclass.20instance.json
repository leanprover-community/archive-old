[
    {
        "content": "<p>Hi,<br>\nI am just learning lean 4 syntax from the docs.<br>\nI am in the chapter on Typeclasses and Default Instances of <a href=\"https://leanprover.github.io/lean4/doc/typeclass.html\">https://leanprover.github.io/lean4/doc/typeclass.html</a></p>\n<p>I was trying to understand the <code>outParam</code> keyword and why it is needed, and I also was experimenting with having two different versions of hMul that differ only in the outParam. One for Nat Nat Nat and one for Nat Nat Int.</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code>       <span class=\"c1\">-- start with my own version of HMul</span>\n      <span class=\"kd\">class</span> <span class=\"n\">HMul'</span> <span class=\"o\">(</span><span class=\"n\">α</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span> <span class=\"n\">u</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">β</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span> <span class=\"n\">v</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">γ</span> <span class=\"o\">:</span> <span class=\"n\">outParam</span> <span class=\"o\">(</span><span class=\"kt\">Type</span> <span class=\"n\">w</span><span class=\"o\">))</span> <span class=\"n\">where</span>\n        <span class=\"n\">hMul</span> <span class=\"o\">:</span> <span class=\"n\">α</span> <span class=\"bp\">→</span> <span class=\"n\">β</span> <span class=\"bp\">→</span> <span class=\"n\">γ</span>\n\n      <span class=\"c1\">-- Mulitplication Nat Nat Nat as ususal</span>\n      <span class=\"kd\">instance</span> <span class=\"o\">:</span> <span class=\"n\">HMul'</span> <span class=\"n\">Nat</span> <span class=\"n\">Nat</span> <span class=\"n\">Nat</span> <span class=\"n\">where</span>\n        <span class=\"n\">hMul</span> <span class=\"o\">:=</span> <span class=\"n\">Nat.mul</span>\n\n      <span class=\"c1\">-- With a weird one for Nat Nat Int.</span>\n      <span class=\"kd\">@[defaultInstance]</span>\n      <span class=\"kd\">instance</span> <span class=\"o\">:</span> <span class=\"n\">HMul'</span> <span class=\"n\">Nat</span> <span class=\"n\">Nat</span> <span class=\"n\">Int</span> <span class=\"n\">where</span>\n        <span class=\"n\">hMul</span> <span class=\"n\">x</span> <span class=\"n\">y</span> <span class=\"o\">:=</span> <span class=\"bp\">-</span><span class=\"mi\">3</span>\n\n      <span class=\"c1\">-- This uses the default instance as expected</span>\n      <span class=\"k\">#eval</span> <span class=\"n\">HMul'.hMul</span> <span class=\"mi\">4</span> <span class=\"mi\">5</span>\n       <span class=\"c1\">-- -3</span>\n\n      <span class=\"c1\">--</span>\n      <span class=\"c1\">-- but how do I specify when I want the other one?</span>\n      <span class=\"c1\">-- If I do</span>\n      <span class=\"k\">#check</span> <span class=\"bp\">@</span><span class=\"n\">HMul'.hMul</span> <span class=\"n\">Nat</span> <span class=\"n\">Nat</span> <span class=\"n\">Nat</span> <span class=\"n\">_</span> <span class=\"mi\">3</span> <span class=\"mi\">4</span>\n        <span class=\"c1\">-- failed to synthesize instance HMul' Nat Nat Nat</span>\n       <span class=\"c1\">-- and if I do</span>\n       <span class=\"k\">#check</span> <span class=\"bp\">@</span><span class=\"n\">HMul'.hMul</span> <span class=\"n\">Nat</span> <span class=\"n\">Nat</span> <span class=\"n\">Nat</span> <span class=\"n\">Nat.mul</span> <span class=\"mi\">3</span> <span class=\"mi\">4</span>\n       <span class=\"c1\">-- I get</span>\n       <span class=\"c1\">-- argument  Nat.mul has type Nat → Nat → Nat : Type but is expected to have type  HMul' Nat Nat Nat : Type</span>\n       <span class=\"c1\">-- How do I choose the typeclass instance I want?</span>\n</code></pre></div>",
        "id": 234499440,
        "sender_full_name": "Aron Fischer",
        "timestamp": 1618407287
    },
    {
        "content": "<p>Typeclasses are supposed to have a unique solution, not counting outParams. So those two instances are conflicting, and you will only ever get one of them (determined by the priority on the instances, or the declaration order). The other one can only be accessed via <code>@</code>, so it's not recommended to do this at all.</p>",
        "id": 234499879,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1618407466
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"404323\">@Aron Fischer</span> <code>outParam</code> means the following: If you see <code>a * b</code>, then you can figure out the type of <code>a</code> and <code>b</code>, let's call them <code>A</code> and <code>B</code>. Now search for an instance <code>HMul' A B ???</code>.</p>\n<p>Important: this should have a unique solution. In particular, the <code>???</code> will be filled in by some type <code>C</code> that should be uniquely determined by <code>A</code> and <code>B</code>.</p>\n<p>Result: <code>a * b</code> will have type <code>C</code>.</p>",
        "id": 234500359,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1618407631
    },
    {
        "content": "<blockquote>\n<p>Typeclasses are supposed to have a unique solution, not counting outParams</p>\n</blockquote>\n<p>good to know. thanks</p>\n<blockquote>\n<p>Important: this should have a unique solution</p>\n</blockquote>\n<p><span aria-label=\"+1\" class=\"emoji emoji-1f44d\" role=\"img\" title=\"+1\">:+1:</span></p>",
        "id": 234500459,
        "sender_full_name": "Aron Fischer",
        "timestamp": 1618407669
    }
]