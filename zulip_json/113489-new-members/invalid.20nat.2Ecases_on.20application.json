[
    {
        "content": "<p>Hi, I'm just getting my head around Lean 3, and working through the Logic and Proof book on the Lean github page.  I'm trying to prove that \\le is a total order on the naturals, but my code gives an error which I'm struggling to make sense of.  Any help would be much appreciated!   The code is below.  (Yes, I know my coding style is very rudimentary, and I haven't yet learnt how to use rw effectively.  I'll get there!  Any pointers in that direction would be helpful, but in the meantime, what is this bizarre error?  It would be good to have a \"minimal example\", but I don't know how to trim this one down, I'm afraid.)</p>\n<p>The error message reads:</p>\n<div class=\"codehilite\"><pre><span></span>error: invalid &#39;nat.cases_on&#39; application, elaborator has special support for this kind of application (it is handled as an &quot;eliminator&quot;), but expected type must not contain metavariables\n  ?m_1\n</pre></div>\n\n\n<p>and here is my code:</p>\n<div class=\"codehilite\"><pre><span></span><span class=\"kn\">open</span> <span class=\"n\">nat</span>\n\n<span class=\"c1\">-- we define ≼ to mean less than or equal to, using the following definition</span>\n<span class=\"c1\">-- rather than the inductive definition lean uses; yes, they&#39;re equivalent,</span>\n<span class=\"c1\">-- but let&#39;s see how this one goes!</span>\n<span class=\"n\">def</span> <span class=\"n\">leq</span> <span class=\"o\">(</span><span class=\"n\">a</span> <span class=\"n\">b</span> <span class=\"o\">:</span> <span class=\"n\">nat</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"bp\">∃</span> <span class=\"n\">c</span> <span class=\"o\">:</span> <span class=\"n\">nat</span><span class=\"o\">,</span> <span class=\"n\">a</span> <span class=\"bp\">+</span> <span class=\"n\">c</span> <span class=\"bp\">=</span> <span class=\"n\">b</span>\n<span class=\"kn\">infix</span> <span class=\"bp\">`</span> <span class=\"err\">≼</span> <span class=\"bp\">`</span><span class=\"o\">:</span><span class=\"mi\">50</span> <span class=\"o\">:=</span> <span class=\"n\">leq</span>\n\n<span class=\"kn\">theorem</span> <span class=\"n\">ineq_totality</span> <span class=\"o\">:</span> <span class=\"bp\">∀</span> <span class=\"n\">m</span> <span class=\"n\">n</span> <span class=\"o\">:</span> <span class=\"n\">nat</span><span class=\"o\">,</span> <span class=\"n\">n</span> <span class=\"err\">≼</span> <span class=\"n\">m</span> <span class=\"bp\">∨</span> <span class=\"n\">m</span> <span class=\"err\">≼</span> <span class=\"n\">n</span> <span class=\"o\">:=</span>\n<span class=\"k\">assume</span> <span class=\"n\">m</span> <span class=\"n\">n</span><span class=\"o\">,</span>\n<span class=\"n\">nat</span><span class=\"bp\">.</span><span class=\"n\">rec_on</span> <span class=\"n\">n</span>\n  <span class=\"o\">(</span><span class=\"k\">have</span> <span class=\"n\">h</span> <span class=\"o\">:</span> <span class=\"mi\">0</span> <span class=\"bp\">+</span> <span class=\"n\">m</span> <span class=\"bp\">=</span> <span class=\"n\">m</span><span class=\"o\">,</span> <span class=\"k\">by</span> <span class=\"n\">rw</span> <span class=\"n\">zero_add</span><span class=\"o\">,</span>\n   <span class=\"k\">have</span> <span class=\"n\">hi</span> <span class=\"o\">:</span> <span class=\"mi\">0</span> <span class=\"err\">≼</span> <span class=\"n\">m</span><span class=\"o\">,</span> <span class=\"k\">from</span> <span class=\"n\">exists</span><span class=\"bp\">.</span><span class=\"n\">intro</span> <span class=\"n\">m</span> <span class=\"n\">h</span><span class=\"o\">,</span>\n   <span class=\"k\">show</span> <span class=\"mi\">0</span> <span class=\"err\">≼</span> <span class=\"n\">m</span> <span class=\"bp\">∨</span> <span class=\"n\">m</span> <span class=\"err\">≼</span> <span class=\"mi\">0</span><span class=\"o\">,</span> <span class=\"k\">from</span> <span class=\"n\">or</span><span class=\"bp\">.</span><span class=\"n\">inl</span> <span class=\"n\">hi</span><span class=\"o\">)</span>\n  <span class=\"o\">(</span><span class=\"k\">assume</span> <span class=\"n\">n</span><span class=\"o\">,</span>\n   <span class=\"k\">assume</span> <span class=\"n\">ih</span> <span class=\"o\">:</span> <span class=\"n\">n</span> <span class=\"err\">≼</span> <span class=\"n\">m</span> <span class=\"bp\">∨</span> <span class=\"n\">m</span> <span class=\"err\">≼</span> <span class=\"n\">n</span><span class=\"o\">,</span>\n   <span class=\"n\">or</span><span class=\"bp\">.</span><span class=\"n\">elim</span>\n     <span class=\"o\">(</span><span class=\"k\">assume</span> <span class=\"n\">h1</span> <span class=\"o\">:</span> <span class=\"n\">n</span> <span class=\"err\">≼</span> <span class=\"n\">m</span><span class=\"o\">,</span>\n      <span class=\"n\">exists</span><span class=\"bp\">.</span><span class=\"n\">elim</span> <span class=\"n\">h1</span> <span class=\"err\">$</span>\n        <span class=\"k\">assume</span> <span class=\"n\">c</span> <span class=\"o\">(</span><span class=\"n\">hc</span> <span class=\"o\">:</span> <span class=\"n\">n</span> <span class=\"bp\">+</span> <span class=\"n\">c</span> <span class=\"bp\">=</span> <span class=\"n\">m</span><span class=\"o\">),</span>\n        <span class=\"n\">nat</span><span class=\"bp\">.</span><span class=\"n\">cases_on</span> <span class=\"n\">c</span>\n         <span class=\"o\">(</span><span class=\"k\">have</span> <span class=\"n\">he</span> <span class=\"o\">:</span> <span class=\"n\">succ</span> <span class=\"n\">m</span> <span class=\"bp\">=</span> <span class=\"n\">succ</span> <span class=\"n\">n</span><span class=\"o\">,</span> <span class=\"k\">by</span> <span class=\"k\">calc</span>\n              <span class=\"n\">succ</span> <span class=\"n\">m</span> <span class=\"bp\">=</span> <span class=\"n\">succ</span><span class=\"o\">(</span><span class=\"n\">n</span> <span class=\"bp\">+</span> <span class=\"mi\">0</span><span class=\"o\">)</span>    <span class=\"o\">:</span> <span class=\"k\">by</span> <span class=\"n\">rw</span> <span class=\"n\">eq</span><span class=\"bp\">.</span><span class=\"n\">subst</span> <span class=\"o\">(</span><span class=\"n\">eq</span><span class=\"bp\">.</span><span class=\"n\">symm</span> <span class=\"n\">hc</span><span class=\"o\">)</span>\n                 <span class=\"bp\">...</span> <span class=\"bp\">=</span> <span class=\"n\">succ</span> <span class=\"n\">n</span>         <span class=\"o\">:</span> <span class=\"n\">rfl</span><span class=\"o\">,</span>\n          <span class=\"k\">have</span> <span class=\"n\">hi</span> <span class=\"o\">:</span> <span class=\"n\">m</span> <span class=\"err\">≼</span> <span class=\"n\">succ</span> <span class=\"n\">n</span><span class=\"o\">,</span> <span class=\"k\">from</span> <span class=\"n\">exists</span><span class=\"bp\">.</span><span class=\"n\">intro</span> <span class=\"mi\">1</span> <span class=\"n\">he</span><span class=\"o\">,</span>\n          <span class=\"k\">show</span> <span class=\"n\">succ</span> <span class=\"n\">n</span> <span class=\"err\">≼</span> <span class=\"n\">m</span> <span class=\"bp\">∨</span> <span class=\"n\">m</span> <span class=\"err\">≼</span> <span class=\"n\">succ</span> <span class=\"n\">n</span><span class=\"o\">,</span> <span class=\"k\">from</span> <span class=\"n\">or</span><span class=\"bp\">.</span><span class=\"n\">inr</span> <span class=\"n\">hi</span><span class=\"o\">)</span>\n         <span class=\"o\">(</span><span class=\"k\">assume</span> <span class=\"n\">c</span><span class=\"o\">,</span>\n          <span class=\"k\">have</span> <span class=\"n\">he</span> <span class=\"o\">:</span> <span class=\"n\">succ</span> <span class=\"n\">n</span> <span class=\"bp\">+</span> <span class=\"n\">c</span> <span class=\"bp\">=</span> <span class=\"n\">m</span><span class=\"o\">,</span> <span class=\"k\">by</span> <span class=\"k\">calc</span>\n              <span class=\"n\">succ</span> <span class=\"n\">n</span> <span class=\"bp\">+</span> <span class=\"n\">c</span> <span class=\"bp\">=</span> <span class=\"n\">succ</span> <span class=\"o\">(</span><span class=\"n\">n</span> <span class=\"bp\">+</span> <span class=\"n\">c</span><span class=\"o\">)</span>   <span class=\"o\">:</span> <span class=\"k\">by</span> <span class=\"n\">rw</span> <span class=\"n\">succ_add</span>\n                     <span class=\"bp\">...</span> <span class=\"bp\">=</span> <span class=\"n\">succ</span> <span class=\"o\">(</span><span class=\"n\">c</span> <span class=\"bp\">+</span> <span class=\"n\">n</span><span class=\"o\">)</span>   <span class=\"o\">:</span> <span class=\"k\">by</span> <span class=\"n\">rw</span> <span class=\"n\">add_symm</span>\n                     <span class=\"bp\">...</span> <span class=\"bp\">=</span> <span class=\"n\">succ</span> <span class=\"n\">c</span> <span class=\"bp\">+</span> <span class=\"n\">n</span>     <span class=\"o\">:</span> <span class=\"k\">by</span> <span class=\"n\">rw</span> <span class=\"n\">succ_add</span>\n                     <span class=\"bp\">...</span> <span class=\"bp\">=</span> <span class=\"n\">n</span> <span class=\"bp\">+</span> <span class=\"n\">succ</span> <span class=\"n\">c</span>     <span class=\"o\">:</span> <span class=\"k\">by</span> <span class=\"n\">rw</span> <span class=\"n\">add_symm</span>\n                     <span class=\"bp\">...</span> <span class=\"bp\">=</span> <span class=\"n\">m</span>              <span class=\"o\">:</span> <span class=\"k\">by</span> <span class=\"n\">rw</span> <span class=\"n\">hc</span><span class=\"o\">,</span>\n          <span class=\"k\">have</span> <span class=\"n\">hi</span> <span class=\"o\">:</span> <span class=\"n\">succ</span> <span class=\"n\">n</span> <span class=\"err\">≼</span> <span class=\"n\">m</span><span class=\"o\">,</span> <span class=\"k\">from</span> <span class=\"n\">exists</span><span class=\"bp\">.</span><span class=\"n\">intro</span> <span class=\"n\">c</span> <span class=\"n\">he</span><span class=\"o\">,</span>\n          <span class=\"k\">show</span> <span class=\"n\">succ</span> <span class=\"n\">n</span> <span class=\"err\">≼</span> <span class=\"n\">m</span> <span class=\"bp\">∨</span> <span class=\"n\">m</span> <span class=\"err\">≼</span> <span class=\"n\">succ</span> <span class=\"n\">n</span><span class=\"o\">,</span> <span class=\"k\">from</span> <span class=\"n\">or</span><span class=\"bp\">.</span><span class=\"n\">inl</span> <span class=\"n\">hi</span><span class=\"o\">))</span>\n     <span class=\"o\">(</span><span class=\"k\">assume</span> <span class=\"n\">h1</span> <span class=\"o\">:</span> <span class=\"n\">m</span> <span class=\"err\">≼</span> <span class=\"n\">n</span><span class=\"o\">,</span>\n      <span class=\"n\">exists</span><span class=\"bp\">.</span><span class=\"n\">elim</span> <span class=\"n\">h1</span> <span class=\"err\">$</span>\n        <span class=\"k\">assume</span> <span class=\"n\">c</span> <span class=\"o\">(</span><span class=\"n\">hc</span> <span class=\"o\">:</span> <span class=\"n\">m</span> <span class=\"bp\">+</span> <span class=\"n\">c</span> <span class=\"bp\">=</span> <span class=\"n\">n</span><span class=\"o\">),</span>\n        <span class=\"k\">have</span> <span class=\"n\">he</span> <span class=\"o\">:</span> <span class=\"n\">m</span> <span class=\"bp\">+</span> <span class=\"n\">succ</span> <span class=\"n\">c</span> <span class=\"bp\">=</span> <span class=\"n\">succ</span> <span class=\"n\">n</span><span class=\"o\">,</span> <span class=\"k\">by</span> <span class=\"k\">calc</span>\n            <span class=\"n\">m</span> <span class=\"bp\">+</span> <span class=\"n\">succ</span> <span class=\"n\">c</span> <span class=\"bp\">=</span> <span class=\"n\">succ</span> <span class=\"o\">(</span><span class=\"n\">m</span> <span class=\"bp\">+</span> <span class=\"n\">c</span><span class=\"o\">)</span>   <span class=\"o\">:</span> <span class=\"k\">by</span> <span class=\"n\">rw</span> <span class=\"n\">succ_add</span>\n                   <span class=\"bp\">...</span> <span class=\"bp\">=</span> <span class=\"n\">succ</span> <span class=\"n\">n</span>         <span class=\"o\">:</span> <span class=\"k\">by</span> <span class=\"n\">rw</span> <span class=\"n\">h</span><span class=\"o\">,</span>\n        <span class=\"k\">have</span> <span class=\"n\">hi</span> <span class=\"o\">:</span> <span class=\"n\">m</span> <span class=\"err\">≼</span> <span class=\"n\">succ</span> <span class=\"n\">n</span><span class=\"o\">,</span> <span class=\"k\">from</span> <span class=\"n\">exists</span><span class=\"bp\">.</span><span class=\"n\">intro</span> <span class=\"n\">c</span> <span class=\"n\">he</span><span class=\"o\">,</span>\n        <span class=\"k\">show</span> <span class=\"n\">succ</span> <span class=\"n\">n</span> <span class=\"err\">≼</span> <span class=\"n\">m</span> <span class=\"bp\">∨</span> <span class=\"n\">m</span> <span class=\"err\">≼</span> <span class=\"n\">succ</span> <span class=\"n\">n</span><span class=\"o\">,</span> <span class=\"k\">from</span> <span class=\"n\">or</span><span class=\"bp\">.</span><span class=\"n\">inr</span> <span class=\"n\">hi</span><span class=\"o\">))</span>\n</pre></div>\n\n\n<p>Many thanks!</p>",
        "id": 179237461,
        "sender_full_name": "Julian Gilbey",
        "timestamp": 1572274043
    },
    {
        "content": "<p>The step where you use <code>or.elim</code> looks wrong to me. If I insert <code>by {}; exact</code> before <code>or.elim</code> (a handy trick from <span class=\"user-mention\" data-user-id=\"110049\">@Mario Carneiro</span> to inspect the goal in \"term-mode\" proofs), I see:</p>\n<div class=\"codehilite\"><pre><span></span>1 goal\nm n n : ℕ,\nih : n ≼ m ∨ m ≼ n\n⊢ succ n ≼ m ∨ m ≼ succ n\n</pre></div>\n\n\n<p><del>But <code>or.elim</code> has type <code>∀ {a b c : Prop}, a ∨ b → (a → c) → (b → c) → c</code> which doesn't clear something like this. Naïvely, you would want to use <code>or.inl</code> or <code>or.inr</code> instead. But in fact that won't work because you don't know which case you're in. So I think you need to apply classical logic somewhere, maybe <code>classical.em : ∀ (p : Prop), p ∨ ¬p</code>.</del></p>\n<p><del>(Not sure about this, but I think the error appears because Lean introduces a metavariable when trying to unify the <code>or.elim</code> stuff with the goal and these aren't allowed in the goal when you use <code>nat.cases_on</code>.)</del></p>\n<p><strong>Edit</strong>: whoops, I was way off. Sorry, see the messages below!</p>",
        "id": 179240233,
        "sender_full_name": "Bryan Gin-ge Chen",
        "timestamp": 1572275733
    },
    {
        "content": "<p>This is just horrible. Beginners writing their proofs with all that have, show, assume stuff. Tactic mode is absolutely the canonical way to prove something like this. This exercise makes a beginner think that using a theorem prover is hell.</p>",
        "id": 179241079,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1572276182
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"242660\">@Julian Gilbey</span> the line <code>or.elim</code> (L17) should be <code>or.elim ih</code></p>",
        "id": 179241561,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1572276428
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span><span class=\"kn\">import</span> <span class=\"n\">tactic</span><span class=\"bp\">.</span><span class=\"n\">interactive</span> <span class=\"c1\">-- mathlib tactics</span>\n\n<span class=\"kn\">open</span> <span class=\"n\">nat</span>\n\n<span class=\"c1\">-- we define ≼ to mean less than or equal to, using the following definition</span>\n<span class=\"c1\">-- rather than the inductive definition lean uses; yes, they&#39;re equivalent,</span>\n<span class=\"c1\">-- but let&#39;s see how this one goes!</span>\n<span class=\"n\">def</span> <span class=\"n\">leq</span> <span class=\"o\">(</span><span class=\"n\">a</span> <span class=\"n\">b</span> <span class=\"o\">:</span> <span class=\"n\">nat</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"bp\">∃</span> <span class=\"n\">c</span> <span class=\"o\">:</span> <span class=\"n\">nat</span><span class=\"o\">,</span> <span class=\"n\">a</span> <span class=\"bp\">+</span> <span class=\"n\">c</span> <span class=\"bp\">=</span> <span class=\"n\">b</span>\n<span class=\"kn\">infix</span> <span class=\"bp\">`</span> <span class=\"err\">≼</span> <span class=\"bp\">`</span><span class=\"o\">:</span><span class=\"mi\">50</span> <span class=\"o\">:=</span> <span class=\"n\">leq</span>\n\n<span class=\"kn\">theorem</span> <span class=\"n\">ineq_totality</span> <span class=\"o\">:</span> <span class=\"bp\">∀</span> <span class=\"n\">m</span> <span class=\"n\">n</span> <span class=\"o\">:</span> <span class=\"n\">nat</span><span class=\"o\">,</span> <span class=\"n\">n</span> <span class=\"err\">≼</span> <span class=\"n\">m</span> <span class=\"bp\">∨</span> <span class=\"n\">m</span> <span class=\"err\">≼</span> <span class=\"n\">n</span> <span class=\"o\">:=</span>\n<span class=\"k\">begin</span>\n  <span class=\"n\">intro</span> <span class=\"n\">m</span><span class=\"o\">,</span>\n  <span class=\"n\">induction</span> <span class=\"n\">m</span> <span class=\"k\">with</span> <span class=\"n\">d</span> <span class=\"n\">hd</span><span class=\"o\">,</span>\n  <span class=\"o\">{</span> <span class=\"c1\">-- base case</span>\n    <span class=\"n\">intro</span> <span class=\"n\">n</span><span class=\"o\">,</span>\n    <span class=\"n\">right</span><span class=\"o\">,</span>\n    <span class=\"n\">use</span> <span class=\"n\">n</span><span class=\"o\">,</span>\n    <span class=\"n\">simp</span><span class=\"o\">,</span>\n  <span class=\"o\">},</span>\n  <span class=\"o\">{</span> <span class=\"c1\">-- inductive step,</span>\n    <span class=\"n\">intro</span> <span class=\"n\">n</span><span class=\"o\">,</span>\n    <span class=\"n\">cases</span> <span class=\"n\">n</span> <span class=\"k\">with</span> <span class=\"n\">n&#39;</span><span class=\"o\">,</span>\n      <span class=\"n\">left</span><span class=\"o\">,</span> <span class=\"n\">use</span> <span class=\"n\">succ</span> <span class=\"n\">d</span><span class=\"o\">,</span> <span class=\"n\">simp</span><span class=\"o\">,</span>\n    <span class=\"n\">cases</span> <span class=\"n\">hd</span> <span class=\"n\">n&#39;</span><span class=\"o\">,</span>\n      <span class=\"n\">left</span><span class=\"o\">,</span>\n      <span class=\"n\">cases</span> <span class=\"n\">h</span> <span class=\"k\">with</span> <span class=\"n\">e</span> <span class=\"n\">he</span><span class=\"o\">,</span>\n      <span class=\"n\">use</span> <span class=\"n\">e</span><span class=\"o\">,</span>\n      <span class=\"n\">simp</span> <span class=\"o\">[</span><span class=\"n\">he</span><span class=\"o\">,</span> <span class=\"n\">add_succ</span><span class=\"o\">],</span>\n    <span class=\"n\">right</span><span class=\"o\">,</span>\n    <span class=\"n\">cases</span> <span class=\"n\">h</span> <span class=\"k\">with</span> <span class=\"n\">e</span> <span class=\"n\">he</span><span class=\"o\">,</span>\n    <span class=\"n\">use</span> <span class=\"n\">e</span><span class=\"o\">,</span>\n    <span class=\"n\">simp</span> <span class=\"o\">[</span><span class=\"n\">he</span><span class=\"o\">,</span> <span class=\"n\">add_succ</span><span class=\"o\">],</span>\n  <span class=\"o\">}</span>\n<span class=\"kn\">end</span>\n</pre></div>",
        "id": 179241570,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1572276430
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"242660\">@Julian Gilbey</span> the real problem is that the entire thing should be in tactic mode so you can see what you're doing.</p>",
        "id": 179241613,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1572276453
    },
    {
        "content": "<p>Check out chapter 5 of Theorem Proving In Lean to get you out of this assume, show, have hell.</p>",
        "id": 179241698,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1572276492
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"242660\">@Julian Gilbey</span> and if you insist using term mode you can use some syntactic sugars to make it look nicer:</p>\n<div class=\"codehilite\"><pre><span></span><span class=\"kn\">open</span> <span class=\"n\">nat</span>\n\n<span class=\"c1\">-- we define ≼ to mean less than or equal to, using the following definition</span>\n<span class=\"c1\">-- rather than the inductive definition lean uses; yes, they&#39;re equivalent,</span>\n<span class=\"c1\">-- but let&#39;s see how this one goes!</span>\n<span class=\"n\">def</span> <span class=\"n\">leq</span> <span class=\"o\">(</span><span class=\"n\">a</span> <span class=\"n\">b</span> <span class=\"o\">:</span> <span class=\"n\">nat</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"bp\">∃</span> <span class=\"n\">c</span> <span class=\"o\">:</span> <span class=\"n\">nat</span><span class=\"o\">,</span> <span class=\"n\">a</span> <span class=\"bp\">+</span> <span class=\"n\">c</span> <span class=\"bp\">=</span> <span class=\"n\">b</span>\n<span class=\"kn\">infix</span> <span class=\"bp\">`</span> <span class=\"err\">≼</span> <span class=\"bp\">`</span><span class=\"o\">:</span><span class=\"mi\">50</span> <span class=\"o\">:=</span> <span class=\"n\">leq</span>\n\n<span class=\"kn\">theorem</span> <span class=\"n\">ineq_totality</span> <span class=\"o\">:</span> <span class=\"bp\">∀</span> <span class=\"n\">m</span> <span class=\"n\">n</span> <span class=\"o\">:</span> <span class=\"n\">nat</span><span class=\"o\">,</span> <span class=\"n\">n</span> <span class=\"err\">≼</span> <span class=\"n\">m</span> <span class=\"bp\">∨</span> <span class=\"n\">m</span> <span class=\"err\">≼</span> <span class=\"n\">n</span>\n<span class=\"bp\">|</span> <span class=\"n\">m</span> <span class=\"mi\">0</span>     <span class=\"o\">:=</span> <span class=\"n\">or</span><span class=\"bp\">.</span><span class=\"n\">inl</span> <span class=\"bp\">⟨</span><span class=\"n\">m</span><span class=\"o\">,</span> <span class=\"n\">nat</span><span class=\"bp\">.</span><span class=\"n\">zero_add</span> <span class=\"n\">m</span><span class=\"bp\">⟩</span>\n<span class=\"bp\">|</span> <span class=\"n\">m</span> <span class=\"o\">(</span><span class=\"n\">n</span><span class=\"bp\">+</span><span class=\"mi\">1</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"k\">match</span> <span class=\"n\">ineq_totality</span> <span class=\"n\">m</span> <span class=\"n\">n</span> <span class=\"k\">with</span>\n    <span class=\"bp\">|</span> <span class=\"n\">or</span><span class=\"bp\">.</span><span class=\"n\">inl</span> <span class=\"bp\">⟨</span><span class=\"mi\">0</span><span class=\"o\">,</span>   <span class=\"n\">hc</span><span class=\"bp\">⟩</span> <span class=\"o\">:=</span> <span class=\"n\">or</span><span class=\"bp\">.</span><span class=\"n\">inr</span> <span class=\"bp\">⟨</span><span class=\"mi\">1</span><span class=\"o\">,</span> <span class=\"k\">by</span> <span class=\"n\">rw</span> <span class=\"o\">[</span><span class=\"err\">←</span> <span class=\"n\">hc</span><span class=\"o\">,</span> <span class=\"n\">nat</span><span class=\"bp\">.</span><span class=\"n\">add_zero</span> <span class=\"n\">n</span><span class=\"o\">]</span><span class=\"bp\">⟩</span>\n    <span class=\"bp\">|</span> <span class=\"n\">or</span><span class=\"bp\">.</span><span class=\"n\">inl</span> <span class=\"bp\">⟨</span><span class=\"n\">c</span><span class=\"bp\">+</span><span class=\"mi\">1</span><span class=\"o\">,</span> <span class=\"n\">hc</span><span class=\"bp\">⟩</span> <span class=\"o\">:=</span> <span class=\"n\">or</span><span class=\"bp\">.</span><span class=\"n\">inl</span> <span class=\"bp\">⟨</span><span class=\"n\">c</span><span class=\"o\">,</span> <span class=\"k\">by</span> <span class=\"n\">rw</span> <span class=\"o\">[</span><span class=\"n\">nat</span><span class=\"bp\">.</span><span class=\"n\">add_assoc</span><span class=\"o\">,</span> <span class=\"n\">nat</span><span class=\"bp\">.</span><span class=\"n\">add_comm</span> <span class=\"mi\">1</span> <span class=\"n\">c</span><span class=\"o\">,</span> <span class=\"n\">hc</span><span class=\"o\">]</span><span class=\"bp\">⟩</span>\n    <span class=\"bp\">|</span> <span class=\"n\">or</span><span class=\"bp\">.</span><span class=\"n\">inr</span> <span class=\"bp\">⟨</span><span class=\"n\">c</span><span class=\"o\">,</span>   <span class=\"n\">hc</span><span class=\"bp\">⟩</span> <span class=\"o\">:=</span> <span class=\"n\">or</span><span class=\"bp\">.</span><span class=\"n\">inr</span> <span class=\"bp\">⟨</span><span class=\"n\">c</span><span class=\"bp\">+</span><span class=\"mi\">1</span><span class=\"o\">,</span> <span class=\"k\">by</span> <span class=\"n\">rw</span> <span class=\"o\">[</span><span class=\"err\">←</span> <span class=\"n\">nat</span><span class=\"bp\">.</span><span class=\"n\">add_assoc</span><span class=\"o\">,</span> <span class=\"n\">hc</span><span class=\"o\">]</span><span class=\"bp\">⟩</span>\n    <span class=\"kn\">end</span>\n</pre></div>",
        "id": 179242163,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1572276763
    },
    {
        "content": "<blockquote>\n<p>This is just horrible. Beginners writing their proofs with all that have, show, assume stuff. Tactic mode is absolutely the canonical way to prove something like this. This exercise makes a beginner think that using a theorem prover is hell.</p>\n</blockquote>\n<p>Yes, quite! And I am a complete beginner <span aria-label=\"rolling on the floor laughing\" class=\"emoji emoji-1f923\" role=\"img\" title=\"rolling on the floor laughing\">:rolling_on_the_floor_laughing:</span>   So I'm looking forward to learning tactic mode!</p>",
        "id": 179242432,
        "sender_full_name": "Julian Gilbey",
        "timestamp": 1572276926
    },
    {
        "content": "<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"242660\">Julian Gilbey</span> the line <code>or.elim</code> (L17) should be <code>or.elim ih</code></p>\n</blockquote>\n<p>Thanks!  And then I can correct my remaining errors which now appear...</p>",
        "id": 179242486,
        "sender_full_name": "Julian Gilbey",
        "timestamp": 1572276954
    },
    {
        "content": "<p>In tactic mode you can see all goals at all times and exactly what you are assuming.</p>",
        "id": 179242493,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1572276959
    },
    {
        "content": "<p>Let me stress that this is not your fault! This is just the method that Avigad uses to teach people, perhaps because it's more suited to the kind of elementary questions that beginner CS people have.</p>",
        "id": 179242578,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1572276996
    },
    {
        "content": "<p>But you're working on a very natural maths question so you should try tactic mode.</p>",
        "id": 179242604,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1572277013
    },
    {
        "content": "<p>I think this question is somewhere in world 5 on <a href=\"http://wwwf.imperial.ac.uk/~buzzard/xena/natural_number_game/\" target=\"_blank\" title=\"http://wwwf.imperial.ac.uk/~buzzard/xena/natural_number_game/\">http://wwwf.imperial.ac.uk/~buzzard/xena/natural_number_game/</a></p>",
        "id": 179242627,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1572277033
    },
    {
        "content": "<p>oh no it's not quite there yet. It's coming up in v1.1, to be released this weekend.</p>",
        "id": 179242658,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1572277059
    },
    {
        "content": "<p>Inequality world DLC</p>",
        "id": 179243217,
        "sender_full_name": "Reid Barton",
        "timestamp": 1572277403
    },
    {
        "content": "<p>I think the use of this style in Jeremy's proofs reflects influence from the Isar proofs in Isabelle</p>",
        "id": 179243417,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1572277543
    },
    {
        "content": "<p>If you really really want to use <code>cases_on</code>: The error comes from the fact that the elaborator can't figure out the motive because it doesn't appear in the type signature. You need to perform <code>cases_on</code> <em>before</em>  <code>assume (hc : n + c = m)</code> so that <code>c</code> can be replaced by zero or <code>succ c</code> in the two case branches.</p>\n<div class=\"codehilite\"><pre><span></span>        <span class=\"k\">assume</span> <span class=\"n\">c</span><span class=\"o\">,</span>\n        <span class=\"bp\">@</span><span class=\"n\">nat</span><span class=\"bp\">.</span><span class=\"n\">cases_on</span> <span class=\"o\">(</span><span class=\"bp\">λ</span> <span class=\"n\">c</span><span class=\"o\">,</span> <span class=\"n\">n</span> <span class=\"bp\">+</span> <span class=\"n\">c</span> <span class=\"bp\">=</span> <span class=\"n\">m</span> <span class=\"bp\">→</span> <span class=\"n\">succ</span> <span class=\"n\">n</span> <span class=\"err\">≼</span> <span class=\"n\">m</span> <span class=\"bp\">∨</span> <span class=\"n\">m</span> <span class=\"err\">≼</span> <span class=\"n\">succ</span> <span class=\"n\">n</span><span class=\"o\">)</span> <span class=\"n\">c</span>\n            <span class=\"o\">(</span><span class=\"k\">assume</span> <span class=\"n\">h</span><span class=\"o\">,</span> <span class=\"bp\">_</span><span class=\"o\">)</span>\n            <span class=\"o\">(</span><span class=\"k\">assume</span> <span class=\"n\">c</span> <span class=\"n\">h</span><span class=\"o\">,</span> <span class=\"bp\">_</span><span class=\"o\">)</span>\n</pre></div>",
        "id": 179243437,
        "sender_full_name": "Edward Ayers",
        "timestamp": 1572277559
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span><span class=\"kn\">import</span> <span class=\"n\">tactic</span><span class=\"bp\">.</span><span class=\"n\">interactive</span>\n\n<span class=\"kn\">open</span> <span class=\"n\">nat</span>\n\n<span class=\"c1\">-- we define ≼ to mean less than or equal to, using the following definition</span>\n<span class=\"c1\">-- rather than the inductive definition lean uses; yes, they&#39;re equivalent,</span>\n<span class=\"c1\">-- but let&#39;s see how this one goes!</span>\n<span class=\"n\">def</span> <span class=\"n\">leq</span> <span class=\"o\">(</span><span class=\"n\">a</span> <span class=\"n\">b</span> <span class=\"o\">:</span> <span class=\"n\">nat</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"bp\">∃</span> <span class=\"n\">c</span> <span class=\"o\">:</span> <span class=\"n\">nat</span><span class=\"o\">,</span> <span class=\"n\">a</span> <span class=\"bp\">+</span> <span class=\"n\">c</span> <span class=\"bp\">=</span> <span class=\"n\">b</span>\n<span class=\"kn\">infix</span> <span class=\"bp\">`</span> <span class=\"err\">≼</span> <span class=\"bp\">`</span><span class=\"o\">:</span><span class=\"mi\">50</span> <span class=\"o\">:=</span> <span class=\"n\">leq</span>\n\n<span class=\"kn\">theorem</span> <span class=\"n\">ineq_totality</span> <span class=\"o\">:</span> <span class=\"bp\">∀</span> <span class=\"n\">m</span> <span class=\"n\">n</span> <span class=\"o\">:</span> <span class=\"n\">nat</span><span class=\"o\">,</span> <span class=\"n\">n</span> <span class=\"err\">≼</span> <span class=\"n\">m</span> <span class=\"bp\">∨</span> <span class=\"n\">m</span> <span class=\"err\">≼</span> <span class=\"n\">n</span> <span class=\"o\">:=</span>\n<span class=\"k\">begin</span>\n  <span class=\"c1\">-- The goal is ∀ so we intro everything.</span>\n  <span class=\"n\">intros</span> <span class=\"n\">m</span> <span class=\"n\">n</span><span class=\"o\">,</span>\n  <span class=\"c1\">-- We do induction on n.</span>\n  <span class=\"n\">induction</span> <span class=\"n\">n</span><span class=\"o\">,</span>\n  <span class=\"c1\">-- Now there are two cases.</span>\n  <span class=\"n\">case</span> <span class=\"n\">nat</span><span class=\"bp\">.</span><span class=\"n\">zero</span> <span class=\"o\">{</span>\n    <span class=\"c1\">-- The goal is ∨ and we know that the left one is true.</span>\n    <span class=\"n\">left</span><span class=\"o\">,</span>\n    <span class=\"c1\">-- The goal is 0 ≼ m but is secretly an ∃ so I use m.</span>\n    <span class=\"n\">use</span> <span class=\"n\">m</span><span class=\"o\">,</span>\n    <span class=\"c1\">-- The goal is 0 + m = m which we know is nat.zero_add.</span>\n    <span class=\"n\">exact</span> <span class=\"n\">nat</span><span class=\"bp\">.</span><span class=\"n\">zero_add</span> <span class=\"n\">m</span> <span class=\"o\">},</span>\n  <span class=\"c1\">-- Now we go to the second case.</span>\n  <span class=\"n\">case</span> <span class=\"n\">nat</span><span class=\"bp\">.</span><span class=\"n\">succ</span> <span class=\"o\">:</span> <span class=\"n\">n</span> <span class=\"n\">ih</span> <span class=\"o\">{</span>\n    <span class=\"c1\">-- We case on ih.</span>\n    <span class=\"n\">cases</span> <span class=\"n\">ih</span><span class=\"o\">,</span>\n    <span class=\"c1\">-- We now have two cases.</span>\n    <span class=\"n\">case</span> <span class=\"n\">or</span><span class=\"bp\">.</span><span class=\"n\">inl</span> <span class=\"o\">:</span> <span class=\"n\">h1</span> <span class=\"o\">{</span>\n      <span class=\"c1\">-- h1 says n ≼ m but is secretly an ∃ so we cases on it.</span>\n      <span class=\"n\">cases</span> <span class=\"n\">h1</span> <span class=\"k\">with</span> <span class=\"n\">c</span> <span class=\"n\">hc</span><span class=\"o\">,</span>\n      <span class=\"c1\">-- We case on c instead of induction because we don&#39;t need an induction hypothesis.</span>\n      <span class=\"n\">cases</span> <span class=\"n\">c</span><span class=\"o\">,</span>\n      <span class=\"c1\">-- Now we have two cases.</span>\n      <span class=\"n\">case</span> <span class=\"n\">nat</span><span class=\"bp\">.</span><span class=\"n\">zero</span> <span class=\"o\">{</span>\n        <span class=\"c1\">-- The goal is ∨ and the right hand side is true.</span>\n        <span class=\"n\">right</span><span class=\"o\">,</span>\n        <span class=\"c1\">-- The goal is m ≼ succ n but is secretly an ∃.</span>\n        <span class=\"n\">use</span> <span class=\"mi\">1</span><span class=\"o\">,</span>\n        <span class=\"c1\">-- From n + 0 = m we readily derive m + 1 = succ n.</span>\n        <span class=\"n\">rw</span> <span class=\"o\">[</span><span class=\"err\">←</span> <span class=\"n\">hc</span><span class=\"o\">,</span> <span class=\"n\">nat</span><span class=\"bp\">.</span><span class=\"n\">add_zero</span> <span class=\"n\">n</span><span class=\"o\">]</span> <span class=\"o\">},</span>\n      <span class=\"c1\">-- We proceed to the second case.</span>\n      <span class=\"n\">case</span> <span class=\"n\">nat</span><span class=\"bp\">.</span><span class=\"n\">succ</span> <span class=\"o\">:</span> <span class=\"n\">c</span> <span class=\"o\">{</span>\n        <span class=\"c1\">-- The goal is ∨ and the left hand side is true.</span>\n        <span class=\"n\">left</span><span class=\"o\">,</span>\n        <span class=\"c1\">-- The goal is succ n ≼ m but is secretly an ∃.</span>\n        <span class=\"n\">use</span> <span class=\"n\">c</span><span class=\"o\">,</span>\n        <span class=\"c1\">-- From n + succ c = m we readily derive succ n + c = m.</span>\n        <span class=\"n\">rw</span> <span class=\"o\">[</span><span class=\"err\">←</span> <span class=\"n\">hc</span><span class=\"o\">,</span> <span class=\"n\">nat</span><span class=\"bp\">.</span><span class=\"n\">succ_add</span><span class=\"o\">]</span> <span class=\"o\">}</span> <span class=\"o\">},</span>\n    <span class=\"c1\">-- We are now in the second case.</span>\n    <span class=\"n\">case</span> <span class=\"n\">or</span><span class=\"bp\">.</span><span class=\"n\">inr</span> <span class=\"o\">:</span> <span class=\"n\">h1</span> <span class=\"o\">{</span>\n      <span class=\"c1\">-- h1 says m ≼ n but is secretly an ∃.</span>\n      <span class=\"n\">cases</span> <span class=\"n\">h1</span> <span class=\"k\">with</span> <span class=\"n\">c</span> <span class=\"n\">hc</span><span class=\"o\">,</span>\n      <span class=\"c1\">-- The goal is ∨ and the right hand side is true.</span>\n      <span class=\"n\">right</span><span class=\"o\">,</span>\n      <span class=\"c1\">-- The goal is m ≼ succ n but is secretly and ∃.</span>\n      <span class=\"n\">use</span> <span class=\"n\">c</span><span class=\"bp\">+</span><span class=\"mi\">1</span><span class=\"o\">,</span>\n      <span class=\"c1\">-- From m + c = n we readily derive m + (c + 1) = succ n.</span>\n      <span class=\"n\">rw</span> <span class=\"o\">[</span><span class=\"err\">←</span> <span class=\"n\">hc</span><span class=\"o\">,</span> <span class=\"err\">←</span> <span class=\"n\">nat</span><span class=\"bp\">.</span><span class=\"n\">add_assoc</span><span class=\"o\">]</span>\n    <span class=\"o\">}</span> <span class=\"o\">}</span>\n<span class=\"kn\">end</span>\n</pre></div>",
        "id": 179243499,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1572277573
    },
    {
        "content": "<p>(deleted)</p>",
        "id": 179243521,
        "sender_full_name": "Edward Ayers",
        "timestamp": 1572277585
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"242660\">@Julian Gilbey</span> annotated tactics</p>",
        "id": 179243526,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1572277586
    },
    {
        "content": "<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"242660\">Julian Gilbey</span> annotated tactics</p>\n</blockquote>\n<p>Wow, thanks!  This will take some getting used to... chapter 5, here I come (or at least once I've finished my marking and the paper I'm drafting!)</p>",
        "id": 179243957,
        "sender_full_name": "Julian Gilbey",
        "timestamp": 1572277853
    },
    {
        "content": "<p>Thanks Kenny! Julian -- I hope this is giving you some indication that this sort of question can actually be worked on in Lean using a much easier-to-use framework than the one you are attempting to use, where 9 times out of 10 the error is \"missing comma\" and the user never recovers</p>",
        "id": 179243964,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1572277859
    },
    {
        "content": "<p>To counter Kevin's negativity, I would like to say that your initial proof is very nicely formatted</p>",
        "id": 179244323,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1572278056
    },
    {
        "content": "<p>Also you can also always see the goals in term mode by using underscores</p>",
        "id": 179244387,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1572278092
    },
    {
        "content": "<p>All this is true, but it's still completely impossible for a beginner to debug. That's why he's asking the question in the first place.</p>",
        "id": 179244446,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1572278123
    },
    {
        "content": "<p>Ah, I answered way too hastily. <span aria-label=\"face palm\" class=\"emoji emoji-1f926\" role=\"img\" title=\"face palm\">:face_palm:</span>‍♂️ Sorry for posting nonsense and thanks to everyone else for jumping in with great explanations!</p>",
        "id": 179245778,
        "sender_full_name": "Bryan Gin-ge Chen",
        "timestamp": 1572278777
    }
]