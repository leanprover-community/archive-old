[
    {
        "content": "<p>I want to bring attention to a new \"feature\" of mathport (really just some shell script wrangling), oneshot execution, added in <a href=\"https://github.com/leanprover-community/mathport/pull/191\">mathport#191</a>. You can now write a lean 3 file, add some <code>#align</code>s in a lean 4 file, and run <code>make oneshot</code> and in less than a second it will do all the work to compile everything and produce a lean 4 output file. This is useful both for mathport developers testing out changes, as well as end users who want to add <code>#align</code>s and get immediate feedback in the rest of the file.</p>",
        "id": 305816645,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1666617412
    },
    {
        "content": "<p>Oh this is super helpful, thanks! I'd been doing all this manually and it was a bit tedious</p>",
        "id": 305901800,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1666640696
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"110049\">@Mario Carneiro</span>, do you have an elan override that is making this work? I'm getting</p>\n<div class=\"codehilite\" data-code-language=\"Text only\"><pre><span></span><code>% make oneshot\ncd sources/lean &amp;&amp; lean --make --recursive --ast --tlean ../../Oneshot/lean3-in\nlean: unrecognized option `--make'\nUnknown command line option\nLean (version 4.0.0-nightly-2022-10-29, commit 62ec0bfdb02e, Release)\n</code></pre></div>",
        "id": 307630548,
        "sender_full_name": "Scott Morrison",
        "timestamp": 1667429050
    },
    {
        "content": "<p>Even if I add an override in <code>sources/lean</code>, I get:</p>\n<div class=\"codehilite\" data-code-language=\"Text only\"><pre><span></span><code>% make oneshot\ncd sources/lean &amp;&amp; lean --make --recursive --ast --tlean ../../Oneshot/lean3-in\n./build/bin/mathport config.oneshot.json Oneshot::main &gt;&gt; Logs/oneshot.out 2&gt; &gt;(tee -a Logs/oneshot.err &gt;&amp;2)\nporting Main\nuncaught exception: [resolveMod3] failed to resolve 'init'\nmake: *** [Outputs/src/oneshot/Oneshot/Main.lean] Error 1\n</code></pre></div>",
        "id": 307631129,
        "sender_full_name": "Scott Morrison",
        "timestamp": 1667429390
    },
    {
        "content": "<p>I thought that this override had already been set up by mathport's default installation. <code>make lean3-predata</code> is doing the same thing</p>",
        "id": 307664366,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1667456947
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"110087\">@Scott Morrison</span></p>",
        "id": 307664375,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1667456953
    },
    {
        "content": "<p>Ah, I see, the makefile target for <code>lean3-predata</code> is creating that elan override, but I guess I have a checked out copy in which I've never run that target.</p>",
        "id": 307664621,
        "sender_full_name": "Scott Morrison",
        "timestamp": 1667457078
    },
    {
        "content": "<p>oh, <code>lean3-predata</code> does an <code>elan override</code> immediately prior, I'll make the <code>oneshot</code> command do that as well</p>",
        "id": 307664623,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1667457081
    },
    {
        "content": "<p>Lake build fails if I want to run <code>oneshot</code> on a fresh clone of mathport after running <code>make predata</code> (which was successful).</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"bp\">└─$</span> <span class=\"n\">make</span> <span class=\"n\">oneshot</span>\n<span class=\"n\">cd</span> <span class=\"n\">Oneshot</span><span class=\"bp\">/</span><span class=\"n\">lean3</span><span class=\"bp\">-</span><span class=\"k\">in</span> <span class=\"bp\">&amp;&amp;</span> <span class=\"n\">elan</span> <span class=\"n\">override</span> <span class=\"n\">set</span> <span class=\"bp\">`</span><span class=\"n\">cat</span> <span class=\"bp\">../../</span><span class=\"n\">sources</span><span class=\"bp\">/</span><span class=\"n\">mathlib</span><span class=\"bp\">/</span><span class=\"n\">leanpkg.toml</span> <span class=\"bp\">|</span> <span class=\"n\">grep</span> <span class=\"n\">lean_version</span> <span class=\"bp\">|</span> <span class=\"n\">cut</span> <span class=\"bp\">-</span><span class=\"n\">d</span> <span class=\"sc\">'\"'</span> <span class=\"bp\">-</span><span class=\"n\">f2</span><span class=\"bp\">`</span>\n<span class=\"n\">info</span><span class=\"o\">:</span> <span class=\"n\">using</span> <span class=\"n\">existing</span> <span class=\"n\">install</span> <span class=\"n\">for</span> <span class=\"bp\">'</span><span class=\"n\">leanprover</span><span class=\"bp\">-</span><span class=\"n\">community</span><span class=\"bp\">/</span><span class=\"n\">lean</span><span class=\"o\">:</span><span class=\"mi\">3</span><span class=\"bp\">.</span><span class=\"mi\">48</span><span class=\"bp\">.</span><span class=\"mi\">0</span><span class=\"bp\">'</span>\n<span class=\"n\">info</span><span class=\"o\">:</span> <span class=\"n\">override</span> <span class=\"n\">toolchain</span> <span class=\"n\">for</span> <span class=\"bp\">'/</span><span class=\"n\">home</span><span class=\"bp\">/</span><span class=\"n\">moritz</span><span class=\"bp\">/</span><span class=\"n\">coding</span><span class=\"bp\">/</span><span class=\"n\">lean</span><span class=\"bp\">/</span><span class=\"n\">mathport</span><span class=\"bp\">/</span><span class=\"n\">Oneshot</span><span class=\"bp\">/</span><span class=\"n\">lean3</span><span class=\"bp\">-</span><span class=\"k\">in</span><span class=\"bp\">'</span> <span class=\"n\">set</span> <span class=\"n\">to</span> <span class=\"bp\">'</span><span class=\"n\">leanprover</span><span class=\"bp\">-</span><span class=\"n\">community</span><span class=\"bp\">/</span><span class=\"n\">lean</span><span class=\"o\">:</span><span class=\"mi\">3</span><span class=\"bp\">.</span><span class=\"mi\">48</span><span class=\"bp\">.</span><span class=\"mi\">0</span><span class=\"bp\">'</span>\n\n  <span class=\"n\">leanprover</span><span class=\"bp\">-</span><span class=\"n\">community</span><span class=\"bp\">/</span><span class=\"n\">lean</span><span class=\"o\">:</span><span class=\"mi\">3</span><span class=\"bp\">.</span><span class=\"mi\">48</span><span class=\"bp\">.</span><span class=\"mi\">0</span> <span class=\"n\">unchanged</span> <span class=\"bp\">-</span> <span class=\"n\">Lean</span> <span class=\"o\">(</span><span class=\"n\">version</span> <span class=\"mi\">3</span><span class=\"bp\">.</span><span class=\"mi\">48</span><span class=\"bp\">.</span><span class=\"mi\">0</span><span class=\"o\">,</span> <span class=\"n\">commit</span> <span class=\"mi\">283</span><span class=\"n\">f6ed8083a</span><span class=\"o\">,</span> <span class=\"n\">Release</span><span class=\"o\">)</span>\n\n<span class=\"n\">cd</span> <span class=\"n\">Oneshot</span><span class=\"bp\">/</span><span class=\"n\">lean3</span><span class=\"bp\">-</span><span class=\"k\">in</span> <span class=\"bp\">&amp;&amp;</span> <span class=\"n\">lean</span> <span class=\"c1\">--make --recursive --ast --tlean .</span>\n<span class=\"n\">cd</span> <span class=\"n\">Oneshot</span><span class=\"bp\">/</span><span class=\"n\">lean4</span><span class=\"bp\">-</span><span class=\"k\">in</span> <span class=\"bp\">&amp;&amp;</span> <span class=\"n\">lake</span> <span class=\"n\">build</span>\n<span class=\"n\">error</span><span class=\"o\">:</span> <span class=\"n\">no</span> <span class=\"n\">such</span> <span class=\"n\">file</span> <span class=\"n\">or</span> <span class=\"n\">directory</span> <span class=\"o\">(</span><span class=\"n\">error</span> <span class=\"n\">code</span><span class=\"o\">:</span> <span class=\"mi\">2</span><span class=\"o\">)</span>\n  <span class=\"n\">file</span><span class=\"o\">:</span> <span class=\"bp\">./../../</span><span class=\"n\">lean_packages</span><span class=\"bp\">/</span><span class=\"n\">mathlib</span><span class=\"bp\">/</span><span class=\"n\">lakefile.lean</span>\n<span class=\"n\">make</span><span class=\"o\">:</span> <span class=\"bp\">***</span> <span class=\"o\">[</span><span class=\"n\">Makefile</span><span class=\"o\">:</span><span class=\"mi\">127</span><span class=\"o\">:</span> <span class=\"n\">Oneshot</span><span class=\"bp\">/</span><span class=\"n\">lean4</span><span class=\"bp\">-</span><span class=\"k\">in</span><span class=\"bp\">/</span><span class=\"n\">build</span><span class=\"bp\">/</span><span class=\"n\">lib</span><span class=\"bp\">/</span><span class=\"n\">Oneshot.trace</span><span class=\"o\">]</span> <span class=\"n\">Error</span> <span class=\"mi\">1</span>\n</code></pre></div>",
        "id": 309143574,
        "sender_full_name": "Moritz Doll",
        "timestamp": 1668153082
    },
    {
        "content": "<p>you also need to build mathport itself (<code>make build</code> or <code>lake build</code>)</p>",
        "id": 309188076,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1668171617
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"110049\">@Mario Carneiro</span> can you (or someone else who knows how) add some step-by-step instructions for using mathport oneshot to the mathlib4 wiki? I know it was covered in the meeting last week but that audio was really hard to hear in the recording on YouTube, and it would be nice to have them written somewhere anyway.</p>",
        "id": 310712268,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1668724482
    },
    {
        "content": "<p>Hey, i'm getting this error</p>\n<div class=\"codehilite\" data-code-language=\"Bash\"><pre><span></span><code>r@pc-60 ~/P/mathport <span class=\"o\">(</span>master<span class=\"o\">)</span>&gt; make oneshot\n<span class=\"nb\">cd</span> Oneshot/lean4-in <span class=\"o\">&amp;&amp;</span> lake build\nwarning: manifest out of date: <span class=\"nb\">source</span> kind <span class=\"o\">(</span>git/path<span class=\"o\">)</span> of dependency mathlib changed, use <span class=\"sb\">`</span>lake update<span class=\"sb\">`</span> to update\nwarning: manifest out of date: <span class=\"nb\">source</span> kind <span class=\"o\">(</span>git/path<span class=\"o\">)</span> of dependency std changed, use <span class=\"sb\">`</span>lake update<span class=\"sb\">`</span> to update\nwarning: manifest out of date: <span class=\"nb\">source</span> kind <span class=\"o\">(</span>git/path<span class=\"o\">)</span> of dependency Qq changed, use <span class=\"sb\">`</span>lake update<span class=\"sb\">`</span> to update\n./build/bin/mathport config.oneshot.json Oneshot::main &gt;&gt; Logs/oneshot.out <span class=\"m\">2</span>&gt; &gt;<span class=\"o\">(</span>tee -a Logs/oneshot.err &gt;<span class=\"p\">&amp;</span><span class=\"m\">2</span><span class=\"o\">)</span>\nbash: line <span class=\"m\">1</span>: Logs/oneshot.out: No such file or directory\nmake: *** <span class=\"o\">[</span>Makefile:127: Outputs/src/oneshot/Oneshot/Main.lean<span class=\"o\">]</span> Error <span class=\"m\">1</span>\n</code></pre></div>\n<p>I've done <code>lake build</code> and <code>make lean3-predata</code> beforehand. Any idea what's wrong?</p>",
        "id": 315519159,
        "sender_full_name": "Rémi Bottinelli",
        "timestamp": 1670912478
    },
    {
        "content": "<p><code>mkdir -p Logs/</code> first should help</p>",
        "id": 315519718,
        "sender_full_name": "Reid Barton",
        "timestamp": 1670912810
    },
    {
        "content": "<p>It would get created automatically by some of the other targets, but not this one</p>",
        "id": 315519739,
        "sender_full_name": "Reid Barton",
        "timestamp": 1670912831
    },
    {
        "content": "<p>ah thanks! i did mkdir the  <code>Logs</code> at some point but I guess there were other issues at that point, and now that really is the problem/solution.</p>",
        "id": 315519935,
        "sender_full_name": "Rémi Bottinelli",
        "timestamp": 1670912904
    },
    {
        "content": "<p>Mmh, I put <a href=\"https://github.com/leanprover-community/mathlib/blob/e64d8a5bffaef322a12ddb9240fc6c399846f683/src/combinatorics/quiver/symmetric.lean\">this file</a> in <code>main.lean</code> and nothing in the <code>Oneshot.lean</code> part and got: </p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"bp\">./</span><span class=\"n\">build</span><span class=\"bp\">/</span><span class=\"n\">bin</span><span class=\"bp\">/</span><span class=\"n\">mathport</span> <span class=\"n\">config.oneshot.json</span> <span class=\"n\">Oneshot</span><span class=\"o\">::</span><span class=\"n\">main</span> <span class=\"bp\">&gt;&gt;</span> <span class=\"n\">Logs</span><span class=\"bp\">/</span><span class=\"n\">oneshot.out</span> <span class=\"mi\">2</span><span class=\"bp\">&gt;</span> <span class=\"bp\">&gt;</span><span class=\"o\">(</span><span class=\"n\">tee</span> <span class=\"bp\">-</span><span class=\"n\">a</span> <span class=\"n\">Logs</span><span class=\"bp\">/</span><span class=\"n\">oneshot.err</span> <span class=\"bp\">&gt;&amp;</span><span class=\"mi\">2</span><span class=\"o\">)</span>\n<span class=\"n\">porting</span> <span class=\"n\">Main</span>\n<span class=\"n\">uncaught</span> <span class=\"n\">exception</span><span class=\"o\">:</span> <span class=\"o\">[</span><span class=\"n\">resolveMod3</span><span class=\"o\">]</span> <span class=\"n\">failed</span> <span class=\"n\">to</span> <span class=\"n\">resolve</span> <span class=\"bp\">'</span><span class=\"n\">combinatorics.quiver.basic'</span>\n<span class=\"n\">make</span><span class=\"o\">:</span> <span class=\"bp\">***</span> <span class=\"o\">[</span><span class=\"n\">Makefile</span><span class=\"o\">:</span><span class=\"mi\">127</span><span class=\"o\">:</span> <span class=\"n\">Outputs</span><span class=\"bp\">/</span><span class=\"n\">src</span><span class=\"bp\">/</span><span class=\"n\">oneshot</span><span class=\"bp\">/</span><span class=\"n\">Oneshot</span><span class=\"bp\">/</span><span class=\"n\">Main.lean</span><span class=\"o\">]</span> <span class=\"n\">Error</span> <span class=\"mi\">1</span>\n</code></pre></div>\n<p>Should I synchronize manually or something?</p>",
        "id": 315520447,
        "sender_full_name": "Rémi Bottinelli",
        "timestamp": 1670913137
    },
    {
        "content": "<p>you need to get the mathlib release data if you want to import mathlib files</p>",
        "id": 315526518,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1670916500
    },
    {
        "content": "<p><code>./download-release.sh nightly-YYYY-MM-DD</code></p>",
        "id": 315526541,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1670916521
    },
    {
        "content": "<p>Thanks! how do I know which release I want?</p>",
        "id": 315526638,
        "sender_full_name": "Rémi Bottinelli",
        "timestamp": 1670916580
    },
    {
        "content": "<p>either that or compile them yourself:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"bp\">./</span><span class=\"n\">build</span><span class=\"bp\">/</span><span class=\"n\">bin</span><span class=\"bp\">/</span><span class=\"n\">mathport</span> <span class=\"c1\">--make config.json Mathbin::combinatorics.quiver.basic &gt;&gt; Logs/mathport.out</span>\n</code></pre></div>",
        "id": 315526741,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1670916605
    },
    {
        "content": "<p>I just get yesterday's release</p>",
        "id": 315526792,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1670916627
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathport/tags\">https://github.com/leanprover-community/mathport/tags</a></p>",
        "id": 315526900,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1670916680
    },
    {
        "content": "<p>oh, the syntax might have changed since they are now more than nightly</p>",
        "id": 315526923,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1670916694
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"n\">r</span><span class=\"bp\">@</span><span class=\"n\">pc</span><span class=\"bp\">-</span><span class=\"mi\">60</span> <span class=\"bp\">~/</span><span class=\"n\">P</span><span class=\"bp\">/</span><span class=\"n\">mathport</span> <span class=\"o\">(</span><span class=\"n\">master</span><span class=\"o\">)</span> <span class=\"o\">[</span><span class=\"mi\">2</span><span class=\"o\">]</span><span class=\"bp\">&gt;</span>\n\n                                   <span class=\"bp\">./</span><span class=\"n\">download</span><span class=\"bp\">-</span><span class=\"n\">release.sh</span> <span class=\"n\">nightly</span><span class=\"bp\">-</span><span class=\"mi\">2022</span><span class=\"bp\">-</span><span class=\"mi\">12</span><span class=\"bp\">-</span><span class=\"mi\">12</span>\n\n<span class=\"bp\">+</span> <span class=\"bp\">./</span><span class=\"n\">download</span><span class=\"bp\">-</span><span class=\"n\">ported.sh</span> <span class=\"n\">nightly</span><span class=\"bp\">-</span><span class=\"mi\">2022</span><span class=\"bp\">-</span><span class=\"mi\">12</span><span class=\"bp\">-</span><span class=\"mi\">12</span>\n<span class=\"bp\">+</span> <span class=\"n\">mkdir</span> <span class=\"bp\">-</span><span class=\"n\">p</span> <span class=\"n\">Outputs</span><span class=\"bp\">/</span><span class=\"n\">oleans</span><span class=\"bp\">/</span><span class=\"n\">leanbin</span><span class=\"bp\">/</span>\n<span class=\"bp\">+</span> <span class=\"n\">pushd</span> <span class=\"n\">Outputs</span><span class=\"bp\">/</span><span class=\"n\">oleans</span><span class=\"bp\">/</span><span class=\"n\">leanbin</span><span class=\"bp\">/</span>\n<span class=\"bp\">~/</span><span class=\"n\">Projects</span><span class=\"bp\">/</span><span class=\"n\">mathport</span><span class=\"bp\">/</span><span class=\"n\">Outputs</span><span class=\"bp\">/</span><span class=\"n\">oleans</span><span class=\"bp\">/</span><span class=\"n\">leanbin</span> <span class=\"bp\">~/</span><span class=\"n\">Projects</span><span class=\"bp\">/</span><span class=\"n\">mathport</span>\n<span class=\"bp\">+</span> <span class=\"n\">curl</span> <span class=\"bp\">-</span><span class=\"n\">L</span> <span class=\"n\">https</span><span class=\"o\">:</span><span class=\"bp\">//</span><span class=\"n\">github.com</span><span class=\"bp\">/</span><span class=\"n\">leanprover</span><span class=\"bp\">-</span><span class=\"n\">community</span><span class=\"bp\">/</span><span class=\"n\">mathport</span><span class=\"bp\">/</span><span class=\"n\">releases</span><span class=\"bp\">/</span><span class=\"n\">download</span><span class=\"bp\">/</span><span class=\"n\">nightly</span><span class=\"bp\">-</span><span class=\"mi\">2022</span><span class=\"bp\">-</span><span class=\"mi\">12</span><span class=\"bp\">-</span><span class=\"mi\">12</span><span class=\"bp\">/</span><span class=\"n\">lean3</span><span class=\"bp\">-</span><span class=\"n\">binport.tar.gz</span>\n<span class=\"bp\">+</span> <span class=\"n\">tar</span> <span class=\"n\">xz</span>\n  <span class=\"bp\">%</span> <span class=\"n\">Total</span>    <span class=\"bp\">%</span> <span class=\"n\">Received</span> <span class=\"bp\">%</span> <span class=\"n\">Xferd</span>  <span class=\"n\">Average</span> <span class=\"n\">Speed</span>   <span class=\"n\">Time</span>    <span class=\"n\">Time</span>     <span class=\"n\">Time</span>  <span class=\"n\">Current</span>\n                                 <span class=\"n\">Dload</span>  <span class=\"n\">Upload</span>   <span class=\"n\">Total</span>   <span class=\"n\">Spent</span>    <span class=\"n\">Left</span>  <span class=\"n\">Speed</span>\n<span class=\"mi\">100</span>     <span class=\"mi\">9</span>  <span class=\"mi\">100</span>     <span class=\"mi\">9</span>    <span class=\"mi\">0</span>     <span class=\"mi\">0</span>     <span class=\"mi\">45</span>      <span class=\"mi\">0</span> <span class=\"c1\">--:--:-- --:--:-- --:--:--    46</span>\n\n<span class=\"n\">gzip</span><span class=\"o\">:</span> <span class=\"n\">stdin</span><span class=\"o\">:</span> <span class=\"n\">not</span> <span class=\"k\">in</span> <span class=\"n\">gzip</span> <span class=\"n\">format</span>\n<span class=\"n\">tar</span><span class=\"o\">:</span> <span class=\"n\">Child</span> <span class=\"n\">returned</span> <span class=\"n\">status</span> <span class=\"mi\">1</span>\n<span class=\"n\">tar</span><span class=\"o\">:</span> <span class=\"n\">Error</span> <span class=\"n\">is</span> <span class=\"n\">not</span> <span class=\"n\">recoverable</span><span class=\"o\">:</span> <span class=\"n\">exiting</span> <span class=\"n\">now</span>\n</code></pre></div>",
        "id": 315527027,
        "sender_full_name": "Rémi Bottinelli",
        "timestamp": 1670916731
    },
    {
        "content": "<p>let me see</p>",
        "id": 315527033,
        "sender_full_name": "Rémi Bottinelli",
        "timestamp": 1670916734
    },
    {
        "content": "<p>you should pick a name that shows up on that list</p>",
        "id": 315527073,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1670916753
    },
    {
        "content": "<p>(it would be nice if <code>download-release</code> just automatically got the latest version)</p>",
        "id": 315527135,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1670916787
    },
    {
        "content": "<p>I get the same error with <code>predata-nightly-2022-12-13-01</code></p>",
        "id": 315527202,
        "sender_full_name": "Rémi Bottinelli",
        "timestamp": 1670916814
    },
    {
        "content": "<p>OK, let me recap the process to get Oneshot running:</p>\n<ol>\n<li>\n<p>Clone <code>https://github.com/leanprover-community/mathport/</code><br>\n<code>\n   git clone https://github.com/leanprover-community/mathport/\n   </code></p>\n</li>\n<li>\n<p>get in the folder:<br>\n<code>\n   cd mathport\n   </code></p>\n</li>\n<li>\n<p>I had to install <code>cmake</code> and <code>gmp</code> <br>\n<code>\n   sudo dnf install cmake gmp gmp-devel\n   </code></p>\n</li>\n<li>\n<p>Run <code>make build</code></p>\n</li>\n<li>Run <code>make lean3-predata</code></li>\n<li>Get a mathport release with <code>./download_release $my_choice</code>.</li>\n<li>Modify the <code>Oneshot/lean3-in/main.lean</code> file to my wishes.</li>\n<li>Run <code>make oneshot</code></li>\n</ol>",
        "id": 315528001,
        "sender_full_name": "Rémi Bottinelli",
        "timestamp": 1670917219
    },
    {
        "content": "<p>I see the URL for <code>mathlib-predata</code> is </p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"n\">https</span><span class=\"o\">:</span><span class=\"bp\">//</span><span class=\"n\">github.com</span><span class=\"bp\">/</span><span class=\"n\">leanprover</span><span class=\"bp\">-</span><span class=\"n\">community</span><span class=\"bp\">/</span><span class=\"n\">mathport</span><span class=\"bp\">/</span><span class=\"n\">releases</span><span class=\"bp\">/</span><span class=\"n\">download</span><span class=\"bp\">/</span><span class=\"n\">predata</span><span class=\"bp\">-</span><span class=\"n\">nightly</span><span class=\"bp\">-</span><span class=\"mi\">2022</span><span class=\"bp\">-</span><span class=\"mi\">12</span><span class=\"bp\">-</span><span class=\"mi\">13</span><span class=\"bp\">-</span><span class=\"mi\">01</span><span class=\"bp\">/</span><span class=\"n\">mathlib3</span><span class=\"bp\">-</span><span class=\"n\">predata.tar.gz</span>\n</code></pre></div>\n<p>while the script tries to get</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"n\">https</span><span class=\"o\">:</span><span class=\"bp\">//</span><span class=\"n\">github.com</span><span class=\"bp\">/</span><span class=\"n\">leanprover</span><span class=\"bp\">-</span><span class=\"n\">community</span><span class=\"bp\">/</span><span class=\"n\">mathport</span><span class=\"bp\">/</span><span class=\"n\">releases</span><span class=\"bp\">/</span><span class=\"n\">download</span><span class=\"bp\">/</span><span class=\"n\">predata</span><span class=\"bp\">-</span><span class=\"n\">nightly</span><span class=\"bp\">-</span><span class=\"mi\">2022</span><span class=\"bp\">-</span><span class=\"mi\">12</span><span class=\"bp\">-</span><span class=\"mi\">13</span><span class=\"bp\">-</span><span class=\"mi\">01</span><span class=\"bp\">/</span><span class=\"n\">lean3</span><span class=\"bp\">-</span><span class=\"n\">binport.tar.gz</span>\n</code></pre></div>\n<p>is that what's going wrong?</p>",
        "id": 315529730,
        "sender_full_name": "Rémi Bottinelli",
        "timestamp": 1670918070
    },
    {
        "content": "<p>No these are different things. e.g. the most recent mathport output appears to be <a href=\"https://github.com/leanprover-community/mathport/releases/tag/nightly-2022-12-13-04\">https://github.com/leanprover-community/mathport/releases/tag/nightly-2022-12-13-04</a></p>",
        "id": 315530655,
        "sender_full_name": "Reid Barton",
        "timestamp": 1670918487
    },
    {
        "content": "<p>Ah, I just chose wrong!</p>",
        "id": 315530918,
        "sender_full_name": "Rémi Bottinelli",
        "timestamp": 1670918623
    },
    {
        "content": "<p>For <code>download_release.sh</code> I think you should use one of those version strings e.g. <code>nightly-2022-12-13-04</code> (one without <code>predata</code>).</p>",
        "id": 315530937,
        "sender_full_name": "Reid Barton",
        "timestamp": 1670918633
    },
    {
        "content": "<p>Don't know why github lists the \"releases\" in an unhelpful order</p>",
        "id": 315531110,
        "sender_full_name": "Reid Barton",
        "timestamp": 1670918701
    },
    {
        "content": "<p>how did you find the correct one to use?</p>",
        "id": 315531223,
        "sender_full_name": "Rémi Bottinelli",
        "timestamp": 1670918756
    },
    {
        "content": "<p>because choosing <code>nightly-2022-12-13-01</code>, which I see at the top of the <code>tag</code> page, does not work</p>",
        "id": 315531305,
        "sender_full_name": "Rémi Bottinelli",
        "timestamp": 1670918784
    },
    {
        "content": "<p>I used the \"Next\" button.</p>",
        "id": 315531358,
        "sender_full_name": "Reid Barton",
        "timestamp": 1670918814
    },
    {
        "content": "<p>Are you sure you don't see <code>predata-nightly-2022-12-13-01</code>?</p>",
        "id": 315531375,
        "sender_full_name": "Reid Barton",
        "timestamp": 1670918823
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"n\">r</span><span class=\"bp\">@</span><span class=\"n\">pc</span><span class=\"bp\">-</span><span class=\"mi\">60</span> <span class=\"bp\">~/</span><span class=\"n\">P</span><span class=\"bp\">/</span><span class=\"n\">mathport</span> <span class=\"o\">(</span><span class=\"n\">master</span><span class=\"o\">)</span><span class=\"bp\">&gt;</span> <span class=\"n\">make</span> <span class=\"n\">oneshot</span>\n<span class=\"bp\">./</span><span class=\"n\">build</span><span class=\"bp\">/</span><span class=\"n\">bin</span><span class=\"bp\">/</span><span class=\"n\">mathport</span> <span class=\"n\">config.oneshot.json</span> <span class=\"n\">Oneshot</span><span class=\"o\">::</span><span class=\"n\">main</span> <span class=\"bp\">&gt;&gt;</span> <span class=\"n\">Logs</span><span class=\"bp\">/</span><span class=\"n\">oneshot.out</span> <span class=\"mi\">2</span><span class=\"bp\">&gt;</span> <span class=\"bp\">&gt;</span><span class=\"o\">(</span><span class=\"n\">tee</span> <span class=\"bp\">-</span><span class=\"n\">a</span> <span class=\"n\">Logs</span><span class=\"bp\">/</span><span class=\"n\">oneshot.err</span> <span class=\"bp\">&gt;&amp;</span><span class=\"mi\">2</span><span class=\"o\">)</span>\n<span class=\"n\">porting</span> <span class=\"n\">Main</span>\n<span class=\"bp\">#</span> <span class=\"n\">output</span> <span class=\"n\">is</span> <span class=\"k\">in</span> <span class=\"n\">Outputs</span><span class=\"bp\">/</span><span class=\"n\">src</span><span class=\"bp\">/</span><span class=\"n\">oneshot</span><span class=\"bp\">/</span><span class=\"n\">Oneshot</span><span class=\"bp\">/</span><span class=\"n\">Main.lean</span>\n</code></pre></div>",
        "id": 315531399,
        "sender_full_name": "Rémi Bottinelli",
        "timestamp": 1670918836
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110032\">Reid Barton</span> <a href=\"#narrow/stream/287929-mathlib4/topic/Mathport.20oneshot/near/315531375\">said</a>:</p>\n<blockquote>\n<p>Are you sure you don't see <code>predata-nightly-2022-12-13-01</code>?</p>\n</blockquote>\n<p>Ah, I do, actually. I thought I just had to <strong>strip</strong> the <code>predata</code> part!</p>",
        "id": 315531524,
        "sender_full_name": "Rémi Bottinelli",
        "timestamp": 1670918885
    },
    {
        "content": "<p>I'm not sure what you need to download specifically for Oneshot to work, but the <code>predata-</code> ones should be used with <code>download-predata.sh</code> and the others with <code>download-release.sh</code></p>",
        "id": 315531538,
        "sender_full_name": "Reid Barton",
        "timestamp": 1670918893
    },
    {
        "content": "<p>You need to download any release which is compatible with the mathlib4 version used to compile mathport</p>",
        "id": 315531606,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1670918935
    },
    {
        "content": "<p>Ahh I think github is basing the release \"date\" on the git commit of mathport itself, so it doesn't realize that newer releases (which are based on more recent versions of mathlib) are better, and should be shown on the first page</p>",
        "id": 315531773,
        "sender_full_name": "Reid Barton",
        "timestamp": 1670919002
    },
    {
        "content": "<p>incompatibilities usually manifest as an error saying that the mathport environment could not be loaded because some definition already exists</p>",
        "id": 315531776,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1670919005
    },
    {
        "content": "<p>I was just about to push a fix to download-release which uses the github API to get the releases and takes the last one, but this is yielding <code>nightly-2022-12-13-01</code> so it sounds like it is not correct</p>",
        "id": 315531885,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1670919076
    },
    {
        "content": "<p><code>predata-nightly-2022-12-13-01</code> is the most recent one of those</p>",
        "id": 315532139,
        "sender_full_name": "Reid Barton",
        "timestamp": 1670919204
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"461830\">@Rémi Bottinelli</span> Just checking, you're not doing this for the mathlib port, are you?  If you want to port a mathlib file, the mathport output is already available at <br>\n<a href=\"https://github.com/leanprover-community/mathlib3port/tree/master/Mathbin\">https://github.com/leanprover-community/mathlib3port/tree/master/Mathbin</a></p>",
        "id": 315532707,
        "sender_full_name": "Heather Macbeth",
        "timestamp": 1670919478
    },
    {
        "content": "<p>I want to port a PR that I made and that got in conflict with some port first.<br>\nBut then, that's good info: If I want to port an existing file (in master), I can just start with your link (?)</p>",
        "id": 315532890,
        "sender_full_name": "Rémi Bottinelli",
        "timestamp": 1670919547
    },
    {
        "content": "<p>ok it's now getting <code>nightly-2022-12-13-04</code> via</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"n\">curl</span> <span class=\"bp\">-</span><span class=\"n\">H</span> <span class=\"s2\">\"Accept: application/vnd.github+json\"</span> <span class=\"bp\">-</span><span class=\"n\">H</span> <span class=\"s2\">\"X-GitHub-Api-Version: 2022-11-28\"</span> <span class=\"bp\">\\</span>\n  <span class=\"n\">https</span><span class=\"o\">:</span><span class=\"bp\">//</span><span class=\"n\">api.github.com</span><span class=\"bp\">/</span><span class=\"n\">repos</span><span class=\"bp\">/</span><span class=\"n\">leanprover</span><span class=\"bp\">-</span><span class=\"n\">community</span><span class=\"bp\">/</span><span class=\"n\">mathport</span><span class=\"bp\">/</span><span class=\"n\">releases</span> <span class=\"bp\">\\</span>\n<span class=\"bp\">|</span> <span class=\"n\">jq</span> <span class=\"bp\">'</span><span class=\"n\">last</span><span class=\"o\">([</span><span class=\"bp\">.</span><span class=\"o\">[]</span><span class=\"bp\">.</span><span class=\"n\">tag_name</span> <span class=\"bp\">|</span> <span class=\"n\">select</span><span class=\"o\">(</span><span class=\"n\">startswith</span><span class=\"o\">(</span><span class=\"s2\">\"nightly-\"</span><span class=\"o\">))]</span> <span class=\"bp\">|</span> <span class=\"n\">sort</span> <span class=\"bp\">|</span> <span class=\"bp\">.</span><span class=\"o\">[])</span><span class=\"bp\">'</span> <span class=\"bp\">-</span><span class=\"n\">r</span>\n</code></pre></div>",
        "id": 315533047,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1670919607
    },
    {
        "content": "<p>So I can update my recap with just <code>./download_release</code> ?</p>",
        "id": 315534640,
        "sender_full_name": "Rémi Bottinelli",
        "timestamp": 1670920241
    },
    {
        "content": "<p>yes</p>",
        "id": 315536379,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1670920856
    },
    {
        "content": "<p>Can we add some instructions on how to use oneshot on the porting wiki, <a href=\"https://github.com/leanprover-community/mathlib4/wiki/Porting-wiki\">https://github.com/leanprover-community/mathlib4/wiki/Porting-wiki</a>?</p>",
        "id": 318848895,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1672574671
    },
    {
        "content": "<p>In particular, it would be great if there were a streamlined process for \"get the mathport output for a mathlib3 PR\"</p>",
        "id": 318849302,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1672574859
    },
    {
        "content": "<p>Note that I tried to improve the documentation of oneshot in <a href=\"https://github.com/leanprover-community/mathport/pull/213\">https://github.com/leanprover-community/mathport/pull/213</a> but that PR is somehow stuck because I don't understand Mario's suggestion.</p>",
        "id": 318849549,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1672574965
    },
    {
        "content": "<p>I just pushed a fix that I think addressed Mario's comment; your list was <code>1, 2, 3, 5, 6, 7, 8</code> with no 4.</p>",
        "id": 318849936,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1672575150
    },
    {
        "content": "<p>I understood the numbering thing (although I think it would have rendered correctly). But my impression was that Mario also meant something else.</p>",
        "id": 318853720,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1672577191
    },
    {
        "content": "<p>no, that's what I meant</p>",
        "id": 318906760,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1672607955
    },
    {
        "content": "<p>Failure of the day:</p>\n<div class=\"codehilite\" data-code-language=\"Text only\"><pre><span></span><code>mkdir -p Logs/\n./build/bin/mathport config.oneshot.json Oneshot::main &gt;&gt; Logs/oneshot.out 2&gt; &gt;(tee -a Logs/oneshot.err &gt;&amp;2)\nporting Main\nuncaught exception: failed to port Oneshot:Main with imports [Leanbin.Init.Default, Oneshot]:\nimport Leanbin.Init.Data.Nat.Lemmas failed, environment already contains 'Nat.findX' from Mathlib.Init.Data.Nat.Lemmas\nmake: *** [Makefile:134: Outputs/src/oneshot/Oneshot/Main.lean] Error 1\n</code></pre></div>",
        "id": 319234665,
        "sender_full_name": "Reid Barton",
        "timestamp": 1672764152
    },
    {
        "content": "<p>Any idea about this?</p>",
        "id": 319234755,
        "sender_full_name": "Reid Barton",
        "timestamp": 1672764176
    },
    {
        "content": "<p>My first guess is mismatched Lean/std4/etc. versions.  You need to have the same mathport commit (which fixes the dependencies) as the release.</p>",
        "id": 319256207,
        "sender_full_name": "Gabriel Ebner",
        "timestamp": 1672770865
    },
    {
        "content": "<p>omg it worked!</p>",
        "id": 319678206,
        "sender_full_name": "Reid Barton",
        "timestamp": 1672955172
    },
    {
        "content": "<p>It would be nice if it took less than 45 minutes to get a working setup</p>",
        "id": 319678234,
        "sender_full_name": "Reid Barton",
        "timestamp": 1672955182
    },
    {
        "content": "<p>... I wasn't supposed to <code>rm -rf Outputs/</code>, was I.</p>",
        "id": 319678973,
        "sender_full_name": "Reid Barton",
        "timestamp": 1672955471
    },
    {
        "content": "<p>Has anyone seen the following oneshot error before?  This is my first time trying it.</p>\n<div class=\"codehilite\" data-code-language=\"Text only\"><pre><span></span><code>% make oneshot\ncd Oneshot/lean3-in &amp;&amp; elan override set `cat ../../sources/mathlib/leanpkg.toml | grep lean_version | cut -d '\"' -f2`\ncat: ../../sources/mathlib/leanpkg.toml: No such file or directory\nerror: The following required arguments were not provided:\n    &lt;toolchain&gt;\n\nUSAGE:\n    elan override set &lt;toolchain&gt;\n\nFor more information try --help\n</code></pre></div>",
        "id": 320022009,
        "sender_full_name": "Heather Macbeth",
        "timestamp": 1673139367
    },
    {
        "content": "<p>That message suggests that <code>sources/mathlib</code> doesn't exist or doesn't have a <code>leanpkg.toml</code> file</p>",
        "id": 320022525,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1673139813
    },
    {
        "content": "<p>you have to run <code>./download-release.sh</code> to get a download of mathlib3 first</p>",
        "id": 320022604,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1673139864
    },
    {
        "content": "<p>It would be great if we could setup a gitpod or something that had everything setup in a way that Just Works; but maybe there's too much configuration for that to make sense</p>",
        "id": 320022648,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1673139913
    },
    {
        "content": "<p>oh, that would be nice</p>",
        "id": 320022674,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1673139937
    },
    {
        "content": "<p>there is a lot of downloading but not a lot of (mandatory) configuration</p>",
        "id": 320022698,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1673139952
    },
    {
        "content": "<p>I don't know whether that belongs in <a href=\"https://github.com/leanprover-community/mathlib4/pull/1419\">the gitpod config for mathlib4</a>, or maybe in the mathport repo instead</p>",
        "id": 320022777,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1673140013
    },
    {
        "content": "<p>I would put it in the mathport repo</p>",
        "id": 320022812,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1673140031
    },
    {
        "content": "<p>It's possible to set up gitpod to open multiple repos in single workspace, if that's at all useful</p>",
        "id": 320022838,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1673140056
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"260507\">@Heather Macbeth</span> Did you follow the directions at <a href=\"https://github.com/leanprover-community/mathport/tree/master/Oneshot\">https://github.com/leanprover-community/mathport/tree/master/Oneshot</a> ? We may need to make adjustments if the directions don't work</p>",
        "id": 320022844,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1673140064
    },
    {
        "content": "<p>I did follow the directions.  And this is correct:</p>\n<p><span class=\"user-mention silent\" data-user-id=\"110049\">Mario Carneiro</span> <a href=\"#narrow/stream/287929-mathlib4/topic/Mathport.20oneshot/near/320022525\">said</a>:</p>\n<blockquote>\n<p>That message suggests that <code>sources/mathlib</code> doesn't exist or doesn't have a <code>leanpkg.toml</code> file</p>\n</blockquote>",
        "id": 320023410,
        "sender_full_name": "Heather Macbeth",
        "timestamp": 1673140557
    },
    {
        "content": "<p>Earlier I had got this:</p>\n<div class=\"codehilite\" data-code-language=\"Text only\"><pre><span></span><code>% ./download-release.sh\n./download-release.sh: line 11: jq: command not found\n</code></pre></div>",
        "id": 320023469,
        "sender_full_name": "Heather Macbeth",
        "timestamp": 1673140589
    },
    {
        "content": "<p>But later I tried this and it seemed to work:</p>\n<div class=\"codehilite\" data-code-language=\"Text only\"><pre><span></span><code>% ./download-release.sh nightly-2022-12-13-04\ngetting release nightly-2022-12-13-04\n+ ./download-ported.sh nightly-2022-12-13-04\n+ mkdir -p Outputs/oleans/leanbin/\n+ pushd Outputs/oleans/leanbin/\n[... tons more stuff ...]\n</code></pre></div>",
        "id": 320023491,
        "sender_full_name": "Heather Macbeth",
        "timestamp": 1673140625
    },
    {
        "content": "<p>aha, you don't have <code>jq</code></p>",
        "id": 320023673,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1673140775
    },
    {
        "content": "<p>are you on a debian such that you can follow the <code>sudo apt ...</code> install instructions?</p>",
        "id": 320023702,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1673140801
    },
    {
        "content": "<p>mac</p>",
        "id": 320023751,
        "sender_full_name": "Heather Macbeth",
        "timestamp": 1673140807
    },
    {
        "content": "<p>hm, we need something similar for macs</p>",
        "id": 320023768,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1673140821
    },
    {
        "content": "<p><code>brew install jq</code>?</p>",
        "id": 320023793,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1673140851
    },
    {
        "content": "<p>even if you can get the release by specifying it directly, <code>jq</code> is used later in the oneshot script so you will probably want to get it</p>",
        "id": 320023828,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1673140888
    },
    {
        "content": "<p>OK, <code>./download_release.sh</code> seems to be doing something now.  Thanks!</p>",
        "id": 320024028,
        "sender_full_name": "Heather Macbeth",
        "timestamp": 1673141051
    }
]