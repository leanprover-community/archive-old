[
    {
        "content": "<p>There are a few pieces of CI automation that would help smooth the process for people porting files from mathlib3 to mathlib4. </p>\n<ol>\n<li>when someone creates the PR mathlib4#NNN which ports file <code>XXX</code>, automatically update the <code>XXX</code> line in <a href=\"https://github.com/leanprover-community/mathlib/wiki/mathlib4-port-status\">#port-status</a> to say <code>No: PR'd as mathlib4#NNN</code></li>\n<li>when the PR mathlib4#NNN which ports file <code>XXX</code> is merged, update the <code>XXX</code> line in <a href=\"https://github.com/leanprover-community/mathlib/wiki/mathlib4-port-status\">#port-status</a> to say <code>Yes mathlib4#NNN</code> (checking that it doesn't already say <code>Yes mathlib4#MMM AAAAAA</code>).</li>\n<li>when the mathlib4 PR which ports file <code>XXX</code> is merged, automatically create the mathlib3 PR which adds the <code>SYNCHRONIZED</code> label to the module-doc</li>\n</ol>\n<p>and something which I think can't / shouldn't be automated</p>\n<ol start=\"4\">\n<li>after all those steps, a human needs to open mathlib3 master (say at commit AAAAAA, and mathlib4 master, and verify that everything actually made it across, then update <a href=\"https://github.com/leanprover-community/mathlib/wiki/mathlib4-port-status\">#port-status</a> to say <code>Yes mathlib4#MMM AAAAAA</code>, to record that someone has checked that the file was fully ported as of that commit.</li>\n</ol>\n<p>and finally, for automation</p>\n<ol start=\"5\">\n<li>a bot, that at some interval sends a reminder to zulip about any files in mathlib3 which have been modified after their recorded verification commit (so a human can either verify that nothing really changed, and update the verification hash, or make the corresponding changes in mathlib4)</li>\n</ol>",
        "id": 305940289,
        "sender_full_name": "Scott Morrison",
        "timestamp": 1666659880
    },
    {
        "content": "<p>Some discussion points:</p>\n<ol start=\"0\">\n<li>Perhaps <a href=\"https://github.com/leanprover-community/mathlib/wiki/mathlib4-port-status\">#port-status</a> should be something more structured than a wiki page!</li>\n<li>Do we need labels for mathlib4 PRs that say they are a porting PR?</li>\n<li>How does CI look at a mathlib4 PR and work out which (multiple?) files it is claiming to completely port.</li>\n<li>Do we need labels for mathlib3 PRs that are just adding synchronization comments? (We have <a href=\"https://github.com/leanprover-community/mathlib/pulls?q=is%3Apr+label%3Amathlib4-synchronization+\"><code>mathlib4-synchronization</code></a>.)</li>\n</ol>",
        "id": 305940290,
        "sender_full_name": "Scott Morrison",
        "timestamp": 1666659883
    },
    {
        "content": "<p>The only automation we currently have is the very ad-hoc <code>scripts/port-status.py</code> in mathlib3, which as well as telling you what you can currently work on, emits warnings like:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"bp\">#</span> <span class=\"n\">The</span> <span class=\"n\">following</span> <span class=\"n\">files</span> <span class=\"n\">are</span> <span class=\"n\">marked</span> <span class=\"n\">as</span> <span class=\"n\">ported</span><span class=\"o\">,</span> <span class=\"n\">but</span> <span class=\"k\">do</span> <span class=\"n\">not</span> <span class=\"k\">have</span> <span class=\"n\">a</span> <span class=\"n\">SYNCHRONIZED</span> <span class=\"n\">WITH</span> <span class=\"n\">MATHLIB4</span> <span class=\"n\">label.</span>\n<span class=\"n\">logic.basic</span>\n<span class=\"n\">logic.is_empty</span>\n<span class=\"n\">data.prod.pprod</span>\n<span class=\"n\">data.fin.fin2</span>\n\n<span class=\"bp\">#</span> <span class=\"n\">The</span> <span class=\"n\">following</span> <span class=\"n\">files</span> <span class=\"n\">are</span> <span class=\"n\">marked</span> <span class=\"n\">as</span> <span class=\"n\">ported</span><span class=\"o\">,</span> <span class=\"n\">but</span> <span class=\"k\">have</span> <span class=\"n\">not</span> <span class=\"n\">been</span> <span class=\"n\">verified</span> <span class=\"n\">against</span> <span class=\"n\">a</span> <span class=\"n\">commit</span> <span class=\"n\">hash</span> <span class=\"k\">from</span> <span class=\"n\">mathlib.</span>\n<span class=\"n\">logic.basic</span>\n<span class=\"n\">logic.is_empty</span>\n<span class=\"n\">data.prod.pprod</span>\n<span class=\"n\">data.fin.fin2</span>\n<span class=\"n\">algebra.abs</span>\n<span class=\"n\">algebra.covariant_and_contravariant</span>\n<span class=\"n\">algebra.group.basic</span>\n<span class=\"n\">algebra.group.defs</span>\n\n<span class=\"bp\">#</span> <span class=\"n\">The</span> <span class=\"n\">following</span> <span class=\"n\">files</span> <span class=\"k\">have</span> <span class=\"n\">been</span> <span class=\"n\">modified</span> <span class=\"n\">since</span> <span class=\"n\">the</span> <span class=\"n\">commit</span> <span class=\"n\">at</span> <span class=\"n\">which</span> <span class=\"n\">they</span> <span class=\"n\">were</span> <span class=\"n\">verified.</span>\n<span class=\"n\">logic.relator</span>\n</code></pre></div>",
        "id": 305940412,
        "sender_full_name": "Scott Morrison",
        "timestamp": 1666659971
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"504487\">@Sarah Smith</span>, notifying you as you wanted to be part of this discussion.</p>",
        "id": 305940441,
        "sender_full_name": "Scott Morrison",
        "timestamp": 1666659997
    },
    {
        "content": "<p>How about a mathlib3 branch that is just one file, on which we track commits?</p>",
        "id": 305940909,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1666660350
    },
    {
        "content": "<p>I mean, I'm not sure a text file in a git branch is really that much different from a wiki page. In particular you can get the wiki via</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"n\">git</span> <span class=\"n\">clone</span> <span class=\"n\">git</span><span class=\"bp\">@</span><span class=\"n\">github.com</span><span class=\"o\">:</span><span class=\"n\">leanprover</span><span class=\"bp\">-</span><span class=\"n\">community</span><span class=\"bp\">/</span><span class=\"n\">mathlib.wiki.git</span>\n</code></pre></div>",
        "id": 305941402,
        "sender_full_name": "Scott Morrison",
        "timestamp": 1666660793
    },
    {
        "content": "<p>Ah, great</p>",
        "id": 305941546,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1666660896
    },
    {
        "content": "<p>Step 4 can be automated if the bot creates a link to the github changes page from the initial mathlib commit to master as of the PR</p>",
        "id": 305959022,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1666676983
    },
    {
        "content": "<p>I have another feature request for port-status: files that have been started / have incomplete work in mathlib4 should also be colored in some way. We could either track that manually or make mathport produce a file listing as part of CI (since it knows the naming convention and can tell whether a <code>Mathbin</code> file it translates has a matching file in <code>Mathlib</code>).</p>",
        "id": 306161538,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1666757290
    },
    {
        "content": "<p>Does this status indicate presence of a Mathlib4 file? Mathbin file?</p>",
        "id": 306161673,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1666757392
    },
    {
        "content": "<p>A mathlib4 file. A mathbin file will exist for everything in mathlib</p>",
        "id": 306165033,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1666759929
    },
    {
        "content": "<p>What's the function we use that does the <code>snake_case</code> to <code>CamelCase</code>? The usual one?</p>",
        "id": 306165530,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1666760393
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathport/blob/master/Mathport/Util/String.lean#L8-L21\">https://github.com/leanprover-community/mathport/blob/master/Mathport/Util/String.lean#L8-L21</a></p>",
        "id": 306165858,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1666760634
    },
    {
        "content": "<p>The fact you linked to a lean4 file reinforces the thought I had that this parser/tracker should be written in lean4 =)</p>",
        "id": 306165965,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1666760712
    },
    {
        "content": "<p>Files that exist in my mathlib4 dir:<br>\n<a href=\"/user_uploads/3121/vCeam6P3NWaqfbXXZ14fB_IC/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/vCeam6P3NWaqfbXXZ14fB_IC/image.png\" title=\"image.png\"><img src=\"/user_uploads/3121/vCeam6P3NWaqfbXXZ14fB_IC/image.png\"></a></div>",
        "id": 306166076,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1666760775
    },
    {
        "content": "<p>Like so?</p>",
        "id": 306166088,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1666760780
    },
    {
        "content": "<p>Existing files have a red outline</p>",
        "id": 306166110,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1666760786
    },
    {
        "content": "<p>Available from <a href=\"https://github.com/pechersky/mathlib-tools/commit/6e4e07b75e19afd01664ac342200c4e7f625dc66\">https://github.com/pechersky/mathlib-tools/commit/6e4e07b75e19afd01664ac342200c4e7f625dc66</a></p>",
        "id": 306167063,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1666761473
    },
    {
        "content": "<p>Do we have a bot that labels mathlib3 PRs with <code>touches-frozen-files</code> if they touch frozen files?</p>",
        "id": 306511071,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1666894975
    },
    {
        "content": "<p>That would immensely help reviewing PRs, I think.</p>",
        "id": 306511108,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1666894986
    },
    {
        "content": "<p>I wanted to check that I am using correctly the import graph tool for porting.  I had the impression that there was supposed to be an orange colour on the graph for files whose status is \"no\" but with a further comment:<br>\n<a href=\"https://github.com/leanprover-community/mathlib-tools/blob/3886f16c04492c768ed821a2d2fc9f583493d5d9/mathlibtools/file_status.py#L50\">https://github.com/leanprover-community/mathlib-tools/blob/3886f16c04492c768ed821a2d2fc9f583493d5d9/mathlibtools/file_status.py#L50</a><br>\nSo the following three files ought to be orange given the current <a href=\"https://github.com/leanprover-community/mathlib/wiki/mathlib4-port-status\">#port-status</a> :</p>\n<ul>\n<li>data.option.basic: 'No: PRd as <a href=\"https://github.com/leanprover-community/mathlib4/pull/493\">mathlib4#493</a>'</li>\n<li>logic.function.basic: 'No: <a href=\"https://github.com/leanprover-community/mathlib4/pull/511\">mathlib4#511</a>'</li>\n<li>logic.unique: 'No: WIP PR <a href=\"https://github.com/leanprover-community/mathlib4/pull/512\">mathlib4#512</a>'</li>\n</ul>\n<p>When I tried the import graph porting tool just now I got <a href=\"/user_uploads/3121/v6wBX-7F1wUrF7OFN9ulNWQp/import_graph.pdf\">this</a>, which has those files in turquoise.  Did I do something wrong?</p>",
        "id": 307015042,
        "sender_full_name": "Heather Macbeth",
        "timestamp": 1667169886
    },
    {
        "content": "<p>My reading of the intention is that</p>\n<ul>\n<li>anything with <code>No</code> and also <code>WIP</code> or <code>PR</code> should be <code>lightskyblue</code></li>\n<li>anything with <code>No</code> and some nonempty comment that does not contain  <code>WIP</code> or <code>PR</code> should be <code>orange</code>.</li>\n</ul>\n<p>However according to that <code>logic.function.basic</code> should currently be orange. (Because we forgot to write <code>No: PR mathlib4#511</code> there, rather than just <code>No: mathlib4#511</code>...) <span class=\"user-mention\" data-user-id=\"308899\">@Yakov Pechersky</span>.</p>\n<p>Obviously this behaviour is too fragile, and we need something better eventually.</p>",
        "id": 307015680,
        "sender_full_name": "Scott Morrison",
        "timestamp": 1667170450
    },
    {
        "content": "<p>I'm actually quite confused.  I'd have thought that these two should be the same colour:</p>\n<ul>\n<li>algebra.order.ring_lemmas: 'No: PRd as <a href=\"https://github.com/leanprover-community/mathlib4/pull/482\">mathlib4#482</a>'</li>\n<li>data.option.basic: 'No: PRd as <a href=\"https://github.com/leanprover-community/mathlib4/pull/493\">mathlib4#493</a>'</li>\n</ul>\n<p>but on my graph they are different colours.  (Both are blue-ish but I'm not sure which one is <code>lightskyblue</code>.)</p>",
        "id": 307016026,
        "sender_full_name": "Heather Macbeth",
        "timestamp": 1667170760
    },
    {
        "content": "<p>Can we pick some colors that are better differentiated? Also, if a file is ready for porting (all reqs ported), does that supersede, or does the PR supersede in coloring?</p>",
        "id": 307016385,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1667171058
    },
    {
        "content": "<p>I can also add that the PR nodes link directly to the PR</p>",
        "id": 307016431,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1667171111
    },
    {
        "content": "<p>Yes, I'd just come to the same hypothesis.  I'm guessing that currently a file being tagged as \"ready\" supersedes its designation as \"WIP\", \"PR\" or \"No-for-complicated-reason\".  And it should (probably?) be the other way around.</p>",
        "id": 307016439,
        "sender_full_name": "Heather Macbeth",
        "timestamp": 1667171123
    },
    {
        "content": "<p>I also was in a middle of refactor, then yak-shaved myself in trying to write this in lean4, which yak-shaved into writing a yaml parser, which yak-shaved into trying to understand WF recursion termination in lean4...</p>",
        "id": 307016572,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1667171275
    },
    {
        "content": "<p>Anyway, to make <code>ready</code> defer to <code>PR</code>, one just has to add two lines here: <a href=\"https://github.com/leanprover-community/mathlib-tools/blob/67f1bda7637d17a9f765ecade305d3f9ffc93e7c/mathlibtools/lib.py#L1047-L1050\">https://github.com/leanprover-community/mathlib-tools/blob/67f1bda7637d17a9f765ecade305d3f9ffc93e7c/mathlibtools/lib.py#L1047-L1050</a><br>\nSpecifically:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"k\">if</span> <span class=\"n\">not</span> <span class=\"n\">target_node.get</span><span class=\"o\">(</span><span class=\"s2\">\"status\"</span><span class=\"o\">):</span>\n  <span class=\"n\">continue</span>\n</code></pre></div>",
        "id": 307016762,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1667171421
    },
    {
        "content": "<p>For those that want to add links in PDF, the suggested data is</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"n\">node</span><span class=\"o\">[</span><span class=\"s2\">\"href\"</span><span class=\"o\">]</span> <span class=\"bp\">=</span> <span class=\"n\">url_here</span>\n<span class=\"n\">node</span><span class=\"o\">[</span><span class=\"s2\">\"target\"</span><span class=\"o\">]</span> <span class=\"bp\">=</span> <span class=\"s2\">\"_top\"</span>  <span class=\"bp\">#</span> <span class=\"n\">or</span> <span class=\"s2\">\"_blank\"</span><span class=\"o\">,</span> <span class=\"n\">depending</span> <span class=\"n\">on</span> <span class=\"n\">the</span> <span class=\"n\">new</span><span class=\"bp\">-</span><span class=\"n\">tab</span> <span class=\"n\">semantics</span> <span class=\"n\">you</span> <span class=\"n\">want</span>\n<span class=\"n\">node</span><span class=\"o\">[</span><span class=\"s2\">\"tooltip\"</span><span class=\"o\">]</span> <span class=\"bp\">=</span> <span class=\"bp\">...</span>\n</code></pre></div>\n<p>But right now, the data structure for <code>FileStatus</code> doesn't really support it.<br>\nMy refactor in <a href=\"https://github.com/pechersky/mathlib-tools/tree/pechersky/schematized-port\">https://github.com/pechersky/mathlib-tools/tree/pechersky/schematized-port</a> likely makes it easier</p>",
        "id": 307016997,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1667171726
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"308899\">Yakov Pechersky</span> <a href=\"#narrow/stream/287929-mathlib4/topic/some.20useful.20automation/near/307016572\">said</a>:</p>\n<blockquote>\n<p>I also was in a middle of refactor, then yak-shaved myself in trying to write this in lean4, which yak-shaved into writing a yaml parser, which yak-shaved into trying to understand WF recursion termination in lean4...</p>\n</blockquote>\n<p>Just some advice: skip the termination proof, just use <code>partial</code> and get on with life. Removing <code>partial</code> should usually be treated as a v2 thing</p>",
        "id": 307033449,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1667189514
    },
    {
        "content": "<p>Don't hesitate to open PRs to leanproject for anything that helps porting. Releasing new versions of leanproject is very cheap.</p>",
        "id": 307071623,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1667211781
    },
    {
        "content": "<p>On the Lean side, would it be easy to have more checks that we are doing things correctly? Can we have a Lean 4 program that checks that a mathlib4 PR indeed ports everything from the Lean3 side in the correct order (modulo autogenerated declarartions) and indeed uses <code>#align</code> whenever mathport had another name? We could have a command flagging declarations that have been omitted and providing an explanation.</p>",
        "id": 307071980,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1667211929
    },
    {
        "content": "<p>Oops, I accidentally did <a href=\"https://github.com/leanprover-community/mathlib-tools/pull/133\">mathlib-tools#133</a>, which made the \"ready\" colour defer to human-specified colours (e.g. for \"PR\"), although this was separately done in the larger <a href=\"https://github.com/leanprover-community/mathlib-tools/pull/132\">mathlib-tools#132</a>.</p>",
        "id": 309296770,
        "sender_full_name": "Scott Morrison",
        "timestamp": 1668234099
    },
    {
        "content": "<p>Alternatives:</p>\n<ul>\n<li>We just merge <a href=\"https://github.com/leanprover-community/mathlib-tools/pull/132\">mathlib-tools#132</a> (but it does other things I don't yet understand the point of)</li>\n<li>We merge <a href=\"https://github.com/leanprover-community/mathlib-tool/pull/133\">mathlib-tool#133</a> first, and <a href=\"https://github.com/leanprover-community/mathlib-tools/pull/132\">mathlib-tools#132</a> can come afterwards.</li>\n</ul>",
        "id": 309296854,
        "sender_full_name": "Scott Morrison",
        "timestamp": 1668234188
    },
    {
        "content": "<p>I've also just made <a href=\"https://github.com/leanprover-community/mathlib-tools/pull/134\">mathlib-tools#134</a>, which corrects a previous problem with the <code>--exclude-tactics</code> flag, that files that were only imported by tactics files were also being dropped. Instead I just add all the necessary edges \"bridging over\" the tactics files before deleting them. To make the graphs slightly saner, I've decided to leave in <code>tactic.core</code> and <code>tactic.basic</code>, even if you ask for <code>--exclude-tactics</code>.</p>",
        "id": 309296928,
        "sender_full_name": "Scott Morrison",
        "timestamp": 1668234276
    },
    {
        "content": "<p>I've also just made <a href=\"https://github.com/leanprover-community/mathlib-tools/pull/135\">mathlib-tools#135</a>, which enables:</p>\n<div class=\"codehilite\" data-code-language=\"Text only\"><pre><span></span><code>% leanproject port-progress\nTotal files in mathlib:           2723\nLongest import path in mathlib:   148\nUnported files in mathlib:        2693\nLongest unported path in mathlib: 138\n['logic.equiv.defs', 'order.synonym', 'order.compare', 'order.monotone', 'order.lattice', 'order.bounded_order', 'algebra.order.monoid.defs', 'algebra.order.sub.defs', 'algebra.order.group.defs', 'algebra.order.ring.defs', 'algebra.order.ring.canonical', 'data.nat.order.basic', 'data.nat.order.lemmas', 'algebra.group_power.ring', 'algebra.group_power.order', 'data.nat.pow', 'algebra.group_power.lemmas', 'algebra.group_power.default', 'data.list.big_operators', 'data.list.count', 'data.list.lattice', 'data.list.nodup', 'data.list.dedup', 'data.list.perm', 'data.multiset.basic', 'algebra.big_operators.multiset', 'data.multiset.bind', 'data.multiset.powerset', 'data.multiset.nodup', 'data.multiset.dedup', 'data.multiset.finset_ops', 'data.finset.basic', 'data.finset.card', 'data.finset.option', 'data.finset.lattice', 'data.finset.powerset', 'data.fintype.basic', 'data.finset.sort', 'data.set.finite', 'order.conditionally_complete_lattice', 'data.nat.lattice', 'order.order_iso_nat', 'order.well_founded_set', 'group_theory.submonoid.pointwise', 'group_theory.subgroup.basic', 'ring_theory.subring.basic', 'algebra.group_ring_action', 'algebra.ring.aut', 'algebra.star.basic', 'algebra.module.linear_map', 'algebra.module.equiv', 'algebra.module.submodule.basic', 'algebra.module.submodule.lattice', 'linear_algebra.basic', 'linear_algebra.span', 'algebra.algebra.basic', 'linear_algebra.prod', 'linear_algebra.linear_independent', 'linear_algebra.basis', 'linear_algebra.bilinear_map', 'algebra.module.submodule.bilinear', 'linear_algebra.tensor_product', 'algebra.algebra.bilinear', 'algebra.algebra.operations', 'ring_theory.ideal.operations', 'algebra.algebra.subalgebra.basic', 'algebra.algebra.tower', 'ring_theory.adjoin.basic', 'data.mv_polynomial.basic', 'data.mv_polynomial.rename', 'data.mv_polynomial.monad', 'data.mv_polynomial.variables', 'data.mv_polynomial.comm_ring', 'ring_theory.polynomial.basic', 'ring_theory.adjoin.fg', 'ring_theory.algebra_tower', 'ring_theory.finiteness', 'field_theory.finiteness', 'linear_algebra.finite_dimensional', 'linear_algebra.matrix.finite_dimensional', 'linear_algebra.matrix.to_lin', 'linear_algebra.matrix.basis', 'linear_algebra.determinant', 'topology.algebra.module.basic', 'analysis.normed.field.basic', 'analysis.normed_space.basic', 'analysis.normed.order.basic', 'analysis.locally_convex.basic', 'analysis.locally_convex.balanced_core_hull', 'topology.algebra.module.finite_dimension', 'analysis.convex.topology', 'topology.algebra.module.locally_convex', 'analysis.seminorm', 'analysis.locally_convex.bounded', 'topology.algebra.uniform_convergence', 'topology.algebra.module.strong_topology', 'analysis.normed_space.operator_norm', 'analysis.normed_space.multilinear', 'analysis.normed_space.bounded_linear_maps', 'analysis.calculus.fderiv', 'analysis.calculus.deriv', 'analysis.calculus.local_extr', 'analysis.calculus.mean_value', 'analysis.calculus.cont_diff', 'analysis.calculus.inverse', 'analysis.special_functions.exp_deriv', 'analysis.special_functions.complex.log_deriv', 'analysis.special_functions.pow_deriv', 'analysis.convex.specific_functions', 'analysis.special_functions.trigonometric.complex', 'analysis.special_functions.trigonometric.arctan', 'measure_theory.function.special_functions', 'measure_theory.integral.mean_inequalities', 'measure_theory.function.simple_func_dense', 'measure_theory.function.strongly_measurable', 'measure_theory.function.ae_eq_fun', 'measure_theory.function.lp_space', 'measure_theory.function.lp_order', 'measure_theory.function.l1_space', 'measure_theory.function.simple_func_dense_lp', 'measure_theory.integral.set_to_l1', 'measure_theory.integral.bochner', 'measure_theory.integral.set_integral', 'measure_theory.function.ae_eq_of_integral', 'measure_theory.measure.with_density_vector_measure', 'measure_theory.decomposition.lebesgue', 'measure_theory.decomposition.radon_nikodym', 'measure_theory.function.conditional_expectation.basic', 'measure_theory.function.conditional_expectation.indicator', 'measure_theory.function.conditional_expectation.real', 'probability.process.filtration', 'probability.process.adapted', 'probability.process.stopping', 'probability.process.hitting_time', 'probability.martingale.basic', 'probability.martingale.upcrossing', 'probability.martingale.convergence', 'probability.martingale.borel_cantelli', 'probability.borel_cantelli']\n</code></pre></div>",
        "id": 309300214,
        "sender_full_name": "Scott Morrison",
        "timestamp": 1668237764
    },
    {
        "content": "<p>Perhaps without any information about what the longest unported path is, I'll propose a bot that posts regularly in the CI stream with this information. (In fact, there's already a test post.)</p>",
        "id": 309300253,
        "sender_full_name": "Scott Morrison",
        "timestamp": 1668237829
    },
    {
        "content": "<p>What other information would be useful or interesting?</p>",
        "id": 309300261,
        "sender_full_name": "Scott Morrison",
        "timestamp": 1668237841
    },
    {
        "content": "<p>Perhaps it's even nice to present these numbers also as percentages (i.e. <code>X% of mathlib has been ported</code> and <code>The longest unported chain is Y% as long as the long chain in mathlib</code>.)</p>",
        "id": 309300331,
        "sender_full_name": "Scott Morrison",
        "timestamp": 1668237894
    },
    {
        "content": "<p>It could even calculate estimated completion dates counting from some arbitrary starting point a few weeks ago. :-) Everyone loves a linearly extrapolated progress meter.</p>",
        "id": 309300366,
        "sender_full_name": "Scott Morrison",
        "timestamp": 1668237941
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110087\">Scott Morrison</span> <a href=\"#narrow/stream/287929-mathlib4/topic/some.20useful.20automation/near/309296770\">said</a>:</p>\n<blockquote>\n<p>Oops, I accidentally did <a href=\"https://github.com/leanprover-community/mathlib-tools/pull/133\">mathlib-tools#133</a>, which made the \"ready\" colour defer to human-specified colours (e.g. for \"PR\"), although this was separately done in the larger <a href=\"https://github.com/leanprover-community/mathlib-tools/pull/132\">mathlib-tools#132</a>.</p>\n</blockquote>\n<p>Yes, merge <a href=\"https://github.com/leanprover-community/mathlib-tools/pull/133\">mathlib-tools#133</a> first. I messed up and included more commits in <a href=\"https://github.com/leanprover-community/mathlib-tools/pull/132\">mathlib-tools#132</a> than I intended, it was meant to be equivalent to <a href=\"https://github.com/leanprover-community/mathlib-tools/pull/133\">mathlib-tools#133</a> <span aria-label=\"upside down\" class=\"emoji emoji-1f643\" role=\"img\" title=\"upside down\">:upside_down:</span></p>",
        "id": 309323563,
        "sender_full_name": "Jon Eugster",
        "timestamp": 1668252255
    },
    {
        "content": "<p>There are MacOS issues in the tests that are unrelated to this work. Can some MacOS user have a look at <a href=\"https://github.com/leanprover-community/mathlib-tools/actions/runs/3449749724/jobs/5757954364#step:3:83\">https://github.com/leanprover-community/mathlib-tools/actions/runs/3449749724/jobs/5757954364#step:3:83</a>?</p>",
        "id": 309325132,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1668253065
    },
    {
        "content": "<p>I merged <a href=\"https://github.com/leanprover-community/mathlib-tools/pull/133\">mathlib-tools#133</a> and <a href=\"https://github.com/leanprover-community/mathlib-tools/pull/134\">mathlib-tools#134</a> anyway. The MacOS error is probably purely a conflict between CI config and changes on MacOS.</p>",
        "id": 309326155,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1668253513
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"110087\">@Scott Morrison</span> I rebased <a href=\"https://github.com/leanprover-community/mathlib-tools/pull/135\">mathlib-tools#135</a> and added a commit counting lines in the relevant files. The current output (eliding the long import chain) is:</p>\n<div class=\"codehilite\" data-code-language=\"plain\"><pre><span></span><code>Total files in mathlib:            2677\nLongest import chain in mathlib:   156\nPorted files in mathlib:           30 (1.1% of total)\nPorted lines in mathlib:           9091 (1.0% of total)\nLongest unported chain in mathlib: 147\n['logic.equiv.defs', ...]\n</code></pre></div>",
        "id": 309334114,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1668257272
    },
    {
        "content": "<p>If this is good enough for you then I can merge a release on pypi.</p>",
        "id": 309334324,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1668257345
    },
    {
        "content": "<p>The line count is about the same files that the other statistics, and there are raw line numbers (including comments and blank lines). This is a rough measure anyway. Note that it seems we reached the 1% milestone!</p>",
        "id": 309334529,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1668257418
    },
    {
        "content": "<p>Looks good to me.</p>",
        "id": 309390277,
        "sender_full_name": "Scott Morrison",
        "timestamp": 1668289129
    },
    {
        "content": "<p>Merged and released.</p>",
        "id": 309396952,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1668294374
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110031\">Patrick Massot</span> <a href=\"#narrow/stream/287929-mathlib4/topic/some.20useful.20automation/near/309325132\">said</a>:</p>\n<blockquote>\n<p>There are MacOS issues in the tests that are unrelated to this work. Can some MacOS user have a look at <a href=\"https://github.com/leanprover-community/mathlib-tools/actions/runs/3449749724/jobs/5757954364#step:3:83\">https://github.com/leanprover-community/mathlib-tools/actions/runs/3449749724/jobs/5757954364#step:3:83</a>?</p>\n</blockquote>\n<p>Let me mention again that it would be really useful to have some MacOS user investigating this. It's really annoying to be unable to quickly check whether tests are still passing in this period where lots of leanproject PRs are made to support the port. Alternatively I could simply disable MacOS tests in CI but that could seem a bit hostile towards Mac users.</p>",
        "id": 310105689,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1668470077
    },
    {
        "content": "<p><a href=\"https://github.com/actions/runner-images/issues/6459#issuecomment-1310535069\">https://github.com/actions/runner-images/issues/6459#issuecomment-1310535069</a> seems to be the same thing</p>",
        "id": 310110681,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1668473064
    },
    {
        "content": "<p>I’m on a Mac - haven’t seen a failure. What’s the test needed?</p>",
        "id": 310111185,
        "sender_full_name": "Arien Malec",
        "timestamp": 1668473468
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"542196\">@Arien Malec</span>, this is the build failure Patrick is concerned about: <a href=\"https://github.com/leanprover-community/mathlib-tools/actions/runs/3466186474/jobs/5789737532\">https://github.com/leanprover-community/mathlib-tools/actions/runs/3466186474/jobs/5789737532</a></p>",
        "id": 310111983,
        "sender_full_name": "Scott Morrison",
        "timestamp": 1668474079
    },
    {
        "content": "<p>I have an old (2011) Mac running MacOS 10.13, but I don't do any Lean on it. Point being, Patrick, if you need me to fire it up and build and install, but I would prefer if someone else (e.g., Arlen) do it, especially because my OS isn't the latest anyway so the results may not match current user experience.</p>",
        "id": 310112555,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1668474550
    },
    {
        "content": "<p>I think <code>leanproject</code> is working fine for everyone on a mac. The problem is that the CI task that checks things work on a mac is failing (and has been for a while!) so we don't have an active guarantee of this.</p>",
        "id": 310112795,
        "sender_full_name": "Scott Morrison",
        "timestamp": 1668474747
    },
    {
        "content": "<p>That is, the task is to work out why it fails <em>in CI</em>, rather than on an end-users computer.</p>",
        "id": 310112806,
        "sender_full_name": "Scott Morrison",
        "timestamp": 1668474766
    },
    {
        "content": "<p>Ah I see.</p>",
        "id": 310113756,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1668475525
    },
    {
        "content": "<p>I tried a few things (editing the <code>scripts/install_macos.sh</code> script and opening a PR), but couldn't work it out.</p>",
        "id": 310115271,
        "sender_full_name": "Scott Morrison",
        "timestamp": 1668476708
    },
    {
        "content": "<p>homebrew wants to install <code>python3</code>, even though it is already present on the github macos runners.</p>",
        "id": 310115291,
        "sender_full_name": "Scott Morrison",
        "timestamp": 1668476736
    },
    {
        "content": "<p>while installing it runs into existing files:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"bp\">==&gt;</span> <span class=\"n\">Pouring</span> <span class=\"n\">python</span><span class=\"bp\">@</span><span class=\"mi\">3</span><span class=\"bp\">.</span><span class=\"mi\">11</span><span class=\"c1\">--3.11.0.monterey.bottle.tar.gz</span>\n<span class=\"n\">Error</span><span class=\"o\">:</span> <span class=\"n\">The</span> <span class=\"bp\">`</span><span class=\"n\">brew</span> <span class=\"n\">link</span><span class=\"bp\">`</span> <span class=\"n\">step</span> <span class=\"n\">did</span> <span class=\"n\">not</span> <span class=\"n\">complete</span> <span class=\"n\">successfully</span>\n<span class=\"n\">The</span> <span class=\"n\">formula</span> <span class=\"n\">built</span><span class=\"o\">,</span> <span class=\"n\">but</span> <span class=\"n\">is</span> <span class=\"n\">not</span> <span class=\"n\">symlinked</span> <span class=\"n\">into</span> <span class=\"bp\">/</span><span class=\"n\">usr</span><span class=\"bp\">/</span><span class=\"kn\">local</span>\n<span class=\"n\">Could</span> <span class=\"n\">not</span> <span class=\"n\">symlink</span> <span class=\"n\">bin</span><span class=\"bp\">/</span><span class=\"mi\">2</span><span class=\"n\">to3</span><span class=\"bp\">-</span><span class=\"mi\">3</span><span class=\"bp\">.</span><span class=\"mi\">11</span>\n<span class=\"n\">Target</span> <span class=\"bp\">/</span><span class=\"n\">usr</span><span class=\"bp\">/</span><span class=\"kn\">local</span><span class=\"bp\">/</span><span class=\"n\">bin</span><span class=\"bp\">/</span><span class=\"mi\">2</span><span class=\"n\">to3</span><span class=\"bp\">-</span><span class=\"mi\">3</span><span class=\"bp\">.</span><span class=\"mi\">11</span>\n<span class=\"n\">already</span> <span class=\"n\">exists.</span> <span class=\"n\">You</span> <span class=\"n\">may</span> <span class=\"n\">want</span> <span class=\"n\">to</span> <span class=\"n\">remove</span> <span class=\"n\">it</span><span class=\"o\">:</span>\n  <span class=\"n\">rm</span> <span class=\"bp\">'/</span><span class=\"n\">usr</span><span class=\"bp\">/</span><span class=\"kn\">local</span><span class=\"bp\">/</span><span class=\"n\">bin</span><span class=\"bp\">/</span><span class=\"mi\">2</span><span class=\"n\">to3</span><span class=\"bp\">-</span><span class=\"mi\">3</span><span class=\"bp\">.</span><span class=\"mi\">11</span><span class=\"bp\">'</span>\n\n<span class=\"n\">To</span> <span class=\"n\">force</span> <span class=\"n\">the</span> <span class=\"n\">link</span> <span class=\"n\">and</span> <span class=\"n\">overwrite</span> <span class=\"n\">all</span> <span class=\"n\">conflicting</span> <span class=\"n\">files</span><span class=\"o\">:</span>\n  <span class=\"n\">brew</span> <span class=\"n\">link</span> <span class=\"c1\">--overwrite python@3.11</span>\n</code></pre></div>",
        "id": 310115359,
        "sender_full_name": "Scott Morrison",
        "timestamp": 1668476769
    },
    {
        "content": "<p>I don't have time to look tonight (and possibly not tomorrow either), but a hacky thing to try if no one's said it already is to run <code>brew install python@3.11 &amp;&amp; brew link --overwrite python@3.11</code> explicitly before running the install step</p>",
        "id": 310115724,
        "sender_full_name": "Julian Berman",
        "timestamp": 1668477059
    },
    {
        "content": "<p>If no one figures it out by then I'm happy to look on Wednesdayish</p>",
        "id": 310115737,
        "sender_full_name": "Julian Berman",
        "timestamp": 1668477075
    },
    {
        "content": "<p>(I think it's unlikely the <code>install_macos.sh</code> needs changing -- this is probably some transient thing, but that's also a guess)</p>",
        "id": 310115766,
        "sender_full_name": "Julian Berman",
        "timestamp": 1668477110
    },
    {
        "content": "<p>Or even safer given that this is meant to check the install script works would be to instead run <code>brew uninstall</code> on whichever version of Python is the conflicting one -- I've had to do that this week for unrelated formulae that are now present on macOS runners (Firefox I think?).</p>",
        "id": 310115888,
        "sender_full_name": "Julian Berman",
        "timestamp": 1668477214
    },
    {
        "content": "<p><a href=\"https://github.com/actions/runner-images/issues/4033\">https://github.com/actions/runner-images/issues/4033</a></p>",
        "id": 310118002,
        "sender_full_name": "Arien Malec",
        "timestamp": 1668479155
    },
    {
        "content": "<p>Per <a href=\"https://github.com/actions/runner-images/issues/4020\">https://github.com/actions/runner-images/issues/4020</a> fixed by updating the image version.</p>",
        "id": 310118186,
        "sender_full_name": "Arien Malec",
        "timestamp": 1668479319
    },
    {
        "content": "<p>From issue 6459, seems to be a recurrence of the issues noted above.</p>",
        "id": 310118560,
        "sender_full_name": "Arien Malec",
        "timestamp": 1668479652
    },
    {
        "content": "<p>As noted, hacking it is probably the best short term action: <code>brew install --overwrite python@3.10 python@3.11</code> forces an overwrite.</p>",
        "id": 310118707,
        "sender_full_name": "Arien Malec",
        "timestamp": 1668479820
    },
    {
        "content": "<p>It's been broken for quite a while, so I'm dubious that just waiting for an image update will help.</p>",
        "id": 310122852,
        "sender_full_name": "Scott Morrison",
        "timestamp": 1668483593
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"542196\">@Arien Malec</span>, could you make a PR with that extra line in <code>install_macos.sh</code> and see if CI likes it?</p>",
        "id": 310122912,
        "sender_full_name": "Scott Morrison",
        "timestamp": 1668483610
    },
    {
        "content": "<p>Can do via fork &amp; PR</p>",
        "id": 310123168,
        "sender_full_name": "Arien Malec",
        "timestamp": 1668483928
    },
    {
        "content": "<p>PR <a href=\"https://github.com/leanprover-community/mathlib/pull/142\">#142</a></p>",
        "id": 310123514,
        "sender_full_name": "Arien Malec",
        "timestamp": 1668484310
    },
    {
        "content": "<p>might not work if the issue is with the <code>brew update</code> step above it, in which case might need to swap</p>",
        "id": 310123792,
        "sender_full_name": "Arien Malec",
        "timestamp": 1668484608
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib-tools/pull/142\">mathlib-tools#142</a></p>",
        "id": 310124062,
        "sender_full_name": "Scott Morrison",
        "timestamp": 1668484908
    }
]