[
    {
        "content": "<p>The script <code>start_port.sh</code> fails midway on my macOS Ventura 13.1 (M1). Here is the full transcript:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"n\">Algorithmi</span><span class=\"o\">:</span><span class=\"n\">mathlib4</span> <span class=\"n\">roblot</span><span class=\"bp\">$</span> <span class=\"bp\">./</span><span class=\"n\">scripts</span><span class=\"bp\">/</span><span class=\"n\">start_port.sh</span> <span class=\"n\">Mathlib</span><span class=\"bp\">/</span><span class=\"n\">Algebra</span><span class=\"bp\">/</span><span class=\"n\">Regular</span><span class=\"bp\">/</span><span class=\"n\">Pow.lean</span>\n<span class=\"bp\">+</span> <span class=\"n\">set</span> <span class=\"bp\">-</span><span class=\"n\">o</span> <span class=\"n\">pipefail</span>\n<span class=\"bp\">+</span> <span class=\"n\">MATHLIB3PORT_BASE_URL</span><span class=\"bp\">=</span><span class=\"n\">https</span><span class=\"o\">:</span><span class=\"bp\">//</span><span class=\"n\">raw.githubusercontent.com</span><span class=\"bp\">/</span><span class=\"n\">leanprover</span><span class=\"bp\">-</span><span class=\"n\">community</span><span class=\"bp\">/</span><span class=\"n\">mathlib3port</span><span class=\"bp\">/</span><span class=\"n\">master</span>\n<span class=\"bp\">+</span> <span class=\"n\">PORT_STATUS_YAML</span><span class=\"bp\">=</span><span class=\"n\">https</span><span class=\"o\">:</span><span class=\"bp\">//</span><span class=\"n\">raw.githubusercontent.com</span><span class=\"bp\">/</span><span class=\"n\">wiki</span><span class=\"bp\">/</span><span class=\"n\">leanprover</span><span class=\"bp\">-</span><span class=\"n\">community</span><span class=\"bp\">/</span><span class=\"n\">mathlib</span><span class=\"bp\">/</span><span class=\"n\">mathlib4</span><span class=\"bp\">-</span><span class=\"n\">port</span><span class=\"bp\">-</span><span class=\"n\">status.md</span>\n<span class=\"bp\">+</span> <span class=\"n\">TMP_FILE</span><span class=\"bp\">=</span><span class=\"n\">start_port_tmp.lean</span>\n<span class=\"bp\">+</span> <span class=\"n\">mathlib4_path</span><span class=\"bp\">=</span><span class=\"n\">Mathlib</span><span class=\"bp\">/</span><span class=\"n\">Algebra</span><span class=\"bp\">/</span><span class=\"n\">Regular</span><span class=\"bp\">/</span><span class=\"n\">Pow.lean</span>\n<span class=\"bp\">+++</span> <span class=\"n\">echo</span> <span class=\"n\">Mathlib</span><span class=\"bp\">/</span><span class=\"n\">Algebra</span><span class=\"bp\">/</span><span class=\"n\">Regular</span><span class=\"bp\">/</span><span class=\"n\">Pow.lean</span>\n<span class=\"bp\">+++</span> <span class=\"n\">tr</span> <span class=\"bp\">/</span> <span class=\"bp\">.</span>\n<span class=\"bp\">++</span> <span class=\"n\">basename</span> <span class=\"n\">Mathlib.Algebra.Regular.Pow.lean</span> <span class=\"bp\">.</span><span class=\"n\">lean</span>\n<span class=\"bp\">+</span> <span class=\"n\">mathlib4_mod</span><span class=\"bp\">=</span><span class=\"n\">Mathlib.Algebra.Regular.Pow</span>\n<span class=\"bp\">+</span> <span class=\"n\">mathlib3port_url</span><span class=\"bp\">=</span><span class=\"n\">https</span><span class=\"o\">:</span><span class=\"bp\">//</span><span class=\"n\">raw.githubusercontent.com</span><span class=\"bp\">/</span><span class=\"n\">leanprover</span><span class=\"bp\">-</span><span class=\"n\">community</span><span class=\"bp\">/</span><span class=\"n\">mathlib3port</span><span class=\"bp\">/</span><span class=\"n\">master</span><span class=\"bp\">/</span><span class=\"n\">Mathbin</span><span class=\"bp\">/</span><span class=\"n\">Algebra</span><span class=\"bp\">/</span><span class=\"n\">Regular</span><span class=\"bp\">/</span><span class=\"n\">Pow.lean</span>\n<span class=\"bp\">+</span> <span class=\"n\">curl</span> <span class=\"c1\">--silent --show-error -o start_port_tmp.lean https://raw.githubusercontent.com/leanprover-community/mathlib3port/master/Mathbin/Algebra/Regular/Pow.lean</span>\n<span class=\"bp\">++</span> <span class=\"n\">grep</span> <span class=\"bp\">'^!</span> <span class=\"bp\">.*</span><span class=\"n\">source</span> <span class=\"n\">module</span> <span class=\"bp\">'</span>\n<span class=\"bp\">++</span> <span class=\"n\">sed</span> <span class=\"bp\">'</span><span class=\"n\">s</span><span class=\"bp\">/.*</span><span class=\"n\">source</span> <span class=\"n\">module</span> <span class=\"bp\">\\</span><span class=\"o\">(</span><span class=\"bp\">.*\\</span><span class=\"o\">)</span><span class=\"bp\">$/\\</span><span class=\"mi\">1</span><span class=\"bp\">/'</span>\n<span class=\"bp\">+</span> <span class=\"n\">mathlib3_module</span><span class=\"bp\">=</span><span class=\"n\">algebra.regular.pow</span>\n<span class=\"bp\">+</span> <span class=\"n\">curl</span> <span class=\"c1\">--silent --show-error https://raw.githubusercontent.com/wiki/leanprover-community/mathlib/mathlib4-port-status.md</span>\n<span class=\"bp\">+</span> <span class=\"n\">grep</span> <span class=\"bp\">-</span><span class=\"n\">F</span> <span class=\"bp\">'</span><span class=\"n\">algebra.regular.pow</span><span class=\"o\">:</span> <span class=\"bp\">'</span>\n<span class=\"bp\">+</span> <span class=\"n\">grep</span> <span class=\"n\">mathlib4</span><span class=\"bp\">#</span>\n<span class=\"bp\">++</span> <span class=\"n\">dirname</span> <span class=\"n\">Mathlib</span><span class=\"bp\">/</span><span class=\"n\">Algebra</span><span class=\"bp\">/</span><span class=\"n\">Regular</span><span class=\"bp\">/</span><span class=\"n\">Pow.lean</span>\n<span class=\"bp\">+</span> <span class=\"n\">mkdir</span> <span class=\"bp\">-</span><span class=\"n\">p</span> <span class=\"n\">Mathlib</span><span class=\"bp\">/</span><span class=\"n\">Algebra</span><span class=\"bp\">/</span><span class=\"n\">Regular</span>\n<span class=\"bp\">+</span> <span class=\"n\">mv</span> <span class=\"n\">start_port_tmp.lean</span> <span class=\"n\">Mathlib</span><span class=\"bp\">/</span><span class=\"n\">Algebra</span><span class=\"bp\">/</span><span class=\"n\">Regular</span><span class=\"bp\">/</span><span class=\"n\">Pow.lean</span>\n<span class=\"bp\">+</span> <span class=\"n\">git</span> <span class=\"n\">fetch</span>\n<span class=\"n\">remote</span><span class=\"o\">:</span> <span class=\"n\">Enumerating</span> <span class=\"n\">objects</span><span class=\"o\">:</span> <span class=\"mi\">6</span><span class=\"o\">,</span> <span class=\"n\">done.</span>\n<span class=\"n\">remote</span><span class=\"o\">:</span> <span class=\"n\">Counting</span> <span class=\"n\">objects</span><span class=\"o\">:</span> <span class=\"mi\">100</span><span class=\"bp\">%</span> <span class=\"o\">(</span><span class=\"mi\">6</span><span class=\"bp\">/</span><span class=\"mi\">6</span><span class=\"o\">),</span> <span class=\"n\">done.</span>\n<span class=\"n\">remote</span><span class=\"o\">:</span> <span class=\"n\">Total</span> <span class=\"mi\">6</span> <span class=\"o\">(</span><span class=\"n\">delta</span> <span class=\"mi\">5</span><span class=\"o\">),</span> <span class=\"n\">reused</span> <span class=\"mi\">6</span> <span class=\"o\">(</span><span class=\"n\">delta</span> <span class=\"mi\">5</span><span class=\"o\">),</span> <span class=\"n\">pack</span><span class=\"bp\">-</span><span class=\"n\">reused</span> <span class=\"mi\">0</span>\n<span class=\"n\">Unpacking</span> <span class=\"n\">objects</span><span class=\"o\">:</span> <span class=\"mi\">100</span><span class=\"bp\">%</span> <span class=\"o\">(</span><span class=\"mi\">6</span><span class=\"bp\">/</span><span class=\"mi\">6</span><span class=\"o\">),</span> <span class=\"mi\">496</span> <span class=\"n\">bytes</span> <span class=\"bp\">|</span> <span class=\"mi\">70</span><span class=\"bp\">.</span><span class=\"mi\">00</span> <span class=\"n\">KiB</span><span class=\"bp\">/</span><span class=\"n\">s</span><span class=\"o\">,</span> <span class=\"n\">done.</span>\n<span class=\"n\">From</span> <span class=\"n\">https</span><span class=\"o\">:</span><span class=\"bp\">//</span><span class=\"n\">github.com</span><span class=\"bp\">/</span><span class=\"n\">leanprover</span><span class=\"bp\">-</span><span class=\"n\">community</span><span class=\"bp\">/</span><span class=\"n\">mathlib4</span>\n   <span class=\"n\">fa20385e..796b4ed7</span>  <span class=\"n\">AD_PORT_Logic_Equiv_Nat</span> <span class=\"bp\">-&gt;</span> <span class=\"n\">origin</span><span class=\"bp\">/</span><span class=\"n\">AD_PORT_Logic_Equiv_Nat</span>\n<span class=\"bp\">+</span> <span class=\"n\">branch_name</span><span class=\"bp\">=</span><span class=\"n\">port</span><span class=\"bp\">/</span><span class=\"n\">Algebra.Regular.Pow</span>\n<span class=\"bp\">+</span> <span class=\"n\">git</span> <span class=\"n\">checkout</span> <span class=\"c1\">--no-track -b port/Algebra.Regular.Pow origin/master</span>\n<span class=\"n\">Switched</span> <span class=\"n\">to</span> <span class=\"n\">a</span> <span class=\"n\">new</span> <span class=\"n\">branch</span> <span class=\"bp\">'</span><span class=\"n\">port</span><span class=\"bp\">/</span><span class=\"n\">Algebra.Regular.Pow'</span>\n<span class=\"bp\">+</span> <span class=\"n\">git</span> <span class=\"n\">add</span> <span class=\"n\">Mathlib</span><span class=\"bp\">/</span><span class=\"n\">Algebra</span><span class=\"bp\">/</span><span class=\"n\">Regular</span><span class=\"bp\">/</span><span class=\"n\">Pow.lean</span>\n<span class=\"bp\">+</span> <span class=\"n\">git</span> <span class=\"n\">commit</span> <span class=\"bp\">-</span><span class=\"n\">m</span> <span class=\"bp\">'</span><span class=\"n\">Initial</span> <span class=\"n\">file</span> <span class=\"n\">copy</span> <span class=\"k\">from</span> <span class=\"n\">mathport'</span>\n<span class=\"o\">[</span><span class=\"n\">port</span><span class=\"bp\">/</span><span class=\"n\">Algebra.Regular.Pow</span> <span class=\"mi\">4</span><span class=\"n\">c97e99c</span><span class=\"o\">]</span> <span class=\"n\">Initial</span> <span class=\"n\">file</span> <span class=\"n\">copy</span> <span class=\"k\">from</span> <span class=\"n\">mathport</span>\n <span class=\"mi\">1</span> <span class=\"n\">file</span> <span class=\"n\">changed</span><span class=\"o\">,</span> <span class=\"mi\">72</span> <span class=\"n\">insertions</span><span class=\"o\">(</span><span class=\"bp\">+</span><span class=\"o\">)</span>\n <span class=\"n\">create</span> <span class=\"n\">mode</span> <span class=\"mi\">100644</span> <span class=\"n\">Mathlib</span><span class=\"bp\">/</span><span class=\"n\">Algebra</span><span class=\"bp\">/</span><span class=\"n\">Regular</span><span class=\"bp\">/</span><span class=\"n\">Pow.lean</span>\n<span class=\"bp\">+</span> <span class=\"n\">sed</span> <span class=\"bp\">-</span><span class=\"n\">i</span> <span class=\"bp\">'</span><span class=\"n\">s</span><span class=\"bp\">/</span><span class=\"n\">Mathbin</span><span class=\"bp\">\\./</span><span class=\"n\">Mathlib</span><span class=\"bp\">\\./</span><span class=\"n\">g'</span> <span class=\"n\">Mathlib</span><span class=\"bp\">/</span><span class=\"n\">Algebra</span><span class=\"bp\">/</span><span class=\"n\">Regular</span><span class=\"bp\">/</span><span class=\"n\">Pow.lean</span>\n<span class=\"n\">sed</span><span class=\"o\">:</span> <span class=\"mi\">1</span><span class=\"o\">:</span> <span class=\"s2\">\"Mathlib/Algebra/Regular ...\"</span><span class=\"o\">:</span> <span class=\"n\">invalid</span> <span class=\"n\">command</span> <span class=\"n\">code</span> <span class=\"n\">M</span>\n</code></pre></div>",
        "id": 318465371,
        "sender_full_name": "Xavier Roblot",
        "timestamp": 1672337860
    },
    {
        "content": "<p>The <code>sed</code> on my computer is the standard version included in <code>macOS</code>, as far as I can tell, it doesn't come with a version number...</p>",
        "id": 318465653,
        "sender_full_name": "Xavier Roblot",
        "timestamp": 1672337980
    },
    {
        "content": "<p><a href=\"https://stackoverflow.com/a/21470675\">https://stackoverflow.com/a/21470675</a> suggests that we should pass an argument to <code>-i</code>.</p>",
        "id": 318466110,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1672338145
    },
    {
        "content": "<p>Could you please try editing the script and changing <code>-i</code> into <code>-ibak</code>?</p>",
        "id": 318466175,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1672338177
    },
    {
        "content": "<p>It seems that it works. The script terminates without any error </p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"n\">Algorithmi</span><span class=\"o\">:</span><span class=\"n\">mathlib4</span> <span class=\"n\">roblot</span><span class=\"bp\">$</span> <span class=\"bp\">./</span><span class=\"n\">scripts</span><span class=\"bp\">/</span><span class=\"n\">start_port.sh</span> <span class=\"n\">Mathlib</span><span class=\"bp\">/</span><span class=\"n\">Algebra</span><span class=\"bp\">/</span><span class=\"n\">Hom</span><span class=\"bp\">/</span><span class=\"n\">Centroid.lean</span>\n<span class=\"bp\">+</span> <span class=\"n\">set</span> <span class=\"bp\">-</span><span class=\"n\">o</span> <span class=\"n\">pipefail</span>\n<span class=\"bp\">+</span> <span class=\"n\">MATHLIB3PORT_BASE_URL</span><span class=\"bp\">=</span><span class=\"n\">https</span><span class=\"o\">:</span><span class=\"bp\">//</span><span class=\"n\">raw.githubusercontent.com</span><span class=\"bp\">/</span><span class=\"n\">leanprover</span><span class=\"bp\">-</span><span class=\"n\">community</span><span class=\"bp\">/</span><span class=\"n\">mathlib3port</span><span class=\"bp\">/</span><span class=\"n\">master</span>\n<span class=\"bp\">+</span> <span class=\"n\">PORT_STATUS_YAML</span><span class=\"bp\">=</span><span class=\"n\">https</span><span class=\"o\">:</span><span class=\"bp\">//</span><span class=\"n\">raw.githubusercontent.com</span><span class=\"bp\">/</span><span class=\"n\">wiki</span><span class=\"bp\">/</span><span class=\"n\">leanprover</span><span class=\"bp\">-</span><span class=\"n\">community</span><span class=\"bp\">/</span><span class=\"n\">mathlib</span><span class=\"bp\">/</span><span class=\"n\">mathlib4</span><span class=\"bp\">-</span><span class=\"n\">port</span><span class=\"bp\">-</span><span class=\"n\">status.md</span>\n<span class=\"bp\">+</span> <span class=\"n\">TMP_FILE</span><span class=\"bp\">=</span><span class=\"n\">start_port_tmp.lean</span>\n<span class=\"bp\">+</span> <span class=\"n\">mathlib4_path</span><span class=\"bp\">=</span><span class=\"n\">Mathlib</span><span class=\"bp\">/</span><span class=\"n\">Algebra</span><span class=\"bp\">/</span><span class=\"n\">Hom</span><span class=\"bp\">/</span><span class=\"n\">Centroid.lean</span>\n<span class=\"bp\">+++</span> <span class=\"n\">echo</span> <span class=\"n\">Mathlib</span><span class=\"bp\">/</span><span class=\"n\">Algebra</span><span class=\"bp\">/</span><span class=\"n\">Hom</span><span class=\"bp\">/</span><span class=\"n\">Centroid.lean</span>\n<span class=\"bp\">+++</span> <span class=\"n\">tr</span> <span class=\"bp\">/</span> <span class=\"bp\">.</span>\n<span class=\"bp\">++</span> <span class=\"n\">basename</span> <span class=\"n\">Mathlib.Algebra.Hom.Centroid.lean</span> <span class=\"bp\">.</span><span class=\"n\">lean</span>\n<span class=\"bp\">+</span> <span class=\"n\">mathlib4_mod</span><span class=\"bp\">=</span><span class=\"n\">Mathlib.Algebra.Hom.Centroid</span>\n<span class=\"bp\">+</span> <span class=\"n\">mathlib3port_url</span><span class=\"bp\">=</span><span class=\"n\">https</span><span class=\"o\">:</span><span class=\"bp\">//</span><span class=\"n\">raw.githubusercontent.com</span><span class=\"bp\">/</span><span class=\"n\">leanprover</span><span class=\"bp\">-</span><span class=\"n\">community</span><span class=\"bp\">/</span><span class=\"n\">mathlib3port</span><span class=\"bp\">/</span><span class=\"n\">master</span><span class=\"bp\">/</span><span class=\"n\">Mathbin</span><span class=\"bp\">/</span><span class=\"n\">Algebra</span><span class=\"bp\">/</span><span class=\"n\">Hom</span><span class=\"bp\">/</span><span class=\"n\">Centroid.lean</span>\n<span class=\"bp\">+</span> <span class=\"n\">curl</span> <span class=\"c1\">--silent --show-error -o start_port_tmp.lean https://raw.githubusercontent.com/leanprover-community/mathlib3port/master/Mathbin/Algebra/Hom/Centroid.lean</span>\n<span class=\"bp\">++</span> <span class=\"n\">grep</span> <span class=\"bp\">'^!</span> <span class=\"bp\">.*</span><span class=\"n\">source</span> <span class=\"n\">module</span> <span class=\"bp\">'</span>\n<span class=\"bp\">++</span> <span class=\"n\">sed</span> <span class=\"bp\">'</span><span class=\"n\">s</span><span class=\"bp\">/.*</span><span class=\"n\">source</span> <span class=\"n\">module</span> <span class=\"bp\">\\</span><span class=\"o\">(</span><span class=\"bp\">.*\\</span><span class=\"o\">)</span><span class=\"bp\">$/\\</span><span class=\"mi\">1</span><span class=\"bp\">/'</span>\n<span class=\"bp\">+</span> <span class=\"n\">mathlib3_module</span><span class=\"bp\">=</span><span class=\"n\">algebra.hom.centroid</span>\n<span class=\"bp\">+</span> <span class=\"n\">curl</span> <span class=\"c1\">--silent --show-error https://raw.githubusercontent.com/wiki/leanprover-community/mathlib/mathlib4-port-status.md</span>\n<span class=\"bp\">+</span> <span class=\"n\">grep</span> <span class=\"bp\">-</span><span class=\"n\">F</span> <span class=\"bp\">'</span><span class=\"n\">algebra.hom.centroid</span><span class=\"o\">:</span> <span class=\"bp\">'</span>\n<span class=\"bp\">+</span> <span class=\"n\">grep</span> <span class=\"n\">mathlib4</span><span class=\"bp\">#</span>\n<span class=\"bp\">++</span> <span class=\"n\">dirname</span> <span class=\"n\">Mathlib</span><span class=\"bp\">/</span><span class=\"n\">Algebra</span><span class=\"bp\">/</span><span class=\"n\">Hom</span><span class=\"bp\">/</span><span class=\"n\">Centroid.lean</span>\n<span class=\"bp\">+</span> <span class=\"n\">mkdir</span> <span class=\"bp\">-</span><span class=\"n\">p</span> <span class=\"n\">Mathlib</span><span class=\"bp\">/</span><span class=\"n\">Algebra</span><span class=\"bp\">/</span><span class=\"n\">Hom</span>\n<span class=\"bp\">+</span> <span class=\"n\">mv</span> <span class=\"n\">start_port_tmp.lean</span> <span class=\"n\">Mathlib</span><span class=\"bp\">/</span><span class=\"n\">Algebra</span><span class=\"bp\">/</span><span class=\"n\">Hom</span><span class=\"bp\">/</span><span class=\"n\">Centroid.lean</span>\n<span class=\"bp\">+</span> <span class=\"n\">git</span> <span class=\"n\">fetch</span>\n<span class=\"bp\">+</span> <span class=\"n\">branch_name</span><span class=\"bp\">=</span><span class=\"n\">port</span><span class=\"bp\">/</span><span class=\"n\">Algebra.Hom.Centroid</span>\n<span class=\"bp\">+</span> <span class=\"n\">git</span> <span class=\"n\">checkout</span> <span class=\"c1\">--no-track -b port/Algebra.Hom.Centroid origin/master</span>\n<span class=\"n\">M</span>   <span class=\"n\">lake</span><span class=\"bp\">-</span><span class=\"n\">manifest.json</span>\n<span class=\"n\">M</span>   <span class=\"n\">scripts</span><span class=\"bp\">/</span><span class=\"n\">start_port.sh</span>\n<span class=\"n\">Switched</span> <span class=\"n\">to</span> <span class=\"n\">a</span> <span class=\"n\">new</span> <span class=\"n\">branch</span> <span class=\"bp\">'</span><span class=\"n\">port</span><span class=\"bp\">/</span><span class=\"n\">Algebra.Hom.Centroid'</span>\n<span class=\"bp\">+</span> <span class=\"n\">git</span> <span class=\"n\">add</span> <span class=\"n\">Mathlib</span><span class=\"bp\">/</span><span class=\"n\">Algebra</span><span class=\"bp\">/</span><span class=\"n\">Hom</span><span class=\"bp\">/</span><span class=\"n\">Centroid.lean</span>\n<span class=\"bp\">+</span> <span class=\"n\">git</span> <span class=\"n\">commit</span> <span class=\"bp\">-</span><span class=\"n\">m</span> <span class=\"bp\">'</span><span class=\"n\">Initial</span> <span class=\"n\">file</span> <span class=\"n\">copy</span> <span class=\"k\">from</span> <span class=\"n\">mathport'</span>\n<span class=\"o\">[</span><span class=\"n\">port</span><span class=\"bp\">/</span><span class=\"n\">Algebra.Hom.Centroid</span> <span class=\"mi\">5</span><span class=\"n\">f6153dc</span><span class=\"o\">]</span> <span class=\"n\">Initial</span> <span class=\"n\">file</span> <span class=\"n\">copy</span> <span class=\"k\">from</span> <span class=\"n\">mathport</span>\n <span class=\"mi\">1</span> <span class=\"n\">file</span> <span class=\"n\">changed</span><span class=\"o\">,</span> <span class=\"mi\">516</span> <span class=\"n\">insertions</span><span class=\"o\">(</span><span class=\"bp\">+</span><span class=\"o\">)</span>\n <span class=\"n\">create</span> <span class=\"n\">mode</span> <span class=\"mi\">100644</span> <span class=\"n\">Mathlib</span><span class=\"bp\">/</span><span class=\"n\">Algebra</span><span class=\"bp\">/</span><span class=\"n\">Hom</span><span class=\"bp\">/</span><span class=\"n\">Centroid.lean</span>\n<span class=\"bp\">+</span> <span class=\"n\">sed</span> <span class=\"bp\">-</span><span class=\"n\">ibak</span> <span class=\"bp\">'</span><span class=\"n\">s</span><span class=\"bp\">/</span><span class=\"n\">Mathbin</span><span class=\"bp\">\\./</span><span class=\"n\">Mathlib</span><span class=\"bp\">\\./</span><span class=\"n\">g'</span> <span class=\"n\">Mathlib</span><span class=\"bp\">/</span><span class=\"n\">Algebra</span><span class=\"bp\">/</span><span class=\"n\">Hom</span><span class=\"bp\">/</span><span class=\"n\">Centroid.lean</span>\n<span class=\"bp\">+</span> <span class=\"n\">echo</span> <span class=\"bp\">'</span><span class=\"kn\">import</span> <span class=\"n\">Mathlib.Algebra.Hom.Centroid'</span>\n<span class=\"bp\">+</span> <span class=\"n\">cat</span> <span class=\"n\">Mathlib.lean</span>\n<span class=\"bp\">+</span> <span class=\"n\">LC_ALL</span><span class=\"bp\">=</span><span class=\"n\">C</span>\n<span class=\"bp\">+</span> <span class=\"n\">sort</span>\n<span class=\"bp\">+</span> <span class=\"n\">mv</span> <span class=\"bp\">-</span><span class=\"n\">f</span> <span class=\"n\">Mathlib.lean.tmp</span> <span class=\"n\">Mathlib.lean</span>\n<span class=\"bp\">+</span> <span class=\"n\">git</span> <span class=\"n\">add</span> <span class=\"n\">Mathlib.lean</span> <span class=\"n\">Mathlib</span><span class=\"bp\">/</span><span class=\"n\">Algebra</span><span class=\"bp\">/</span><span class=\"n\">Hom</span><span class=\"bp\">/</span><span class=\"n\">Centroid.lean</span>\n<span class=\"bp\">+</span> <span class=\"n\">git</span> <span class=\"n\">commit</span> <span class=\"bp\">-</span><span class=\"n\">m</span> <span class=\"bp\">'</span><span class=\"n\">Mathbin</span> <span class=\"bp\">-&gt;</span> <span class=\"n\">Mathlib</span><span class=\"bp\">;</span> <span class=\"n\">add</span> <span class=\"kn\">import</span> <span class=\"n\">to</span> <span class=\"n\">Mathlib.lean'</span>\n<span class=\"o\">[</span><span class=\"n\">port</span><span class=\"bp\">/</span><span class=\"n\">Algebra.Hom.Centroid</span> <span class=\"mi\">00146657</span><span class=\"o\">]</span> <span class=\"n\">Mathbin</span> <span class=\"bp\">-&gt;</span> <span class=\"n\">Mathlib</span><span class=\"bp\">;</span> <span class=\"n\">add</span> <span class=\"kn\">import</span> <span class=\"n\">to</span> <span class=\"n\">Mathlib.lean</span>\n <span class=\"mi\">2</span> <span class=\"n\">files</span> <span class=\"n\">changed</span><span class=\"o\">,</span> <span class=\"mi\">3</span> <span class=\"n\">insertions</span><span class=\"o\">(</span><span class=\"bp\">+</span><span class=\"o\">),</span> <span class=\"mi\">2</span> <span class=\"n\">deletions</span><span class=\"o\">(</span><span class=\"bp\">-</span><span class=\"o\">)</span>\n</code></pre></div>",
        "id": 318467275,
        "sender_full_name": "Xavier Roblot",
        "timestamp": 1672338625
    },
    {
        "content": "<p>Thanks!</p>",
        "id": 318467317,
        "sender_full_name": "Xavier Roblot",
        "timestamp": 1672338647
    },
    {
        "content": "<p>Also see <a href=\"https://stackoverflow.com/questions/4247068/sed-command-with-i-option-failing-on-mac-but-works-on-linux\">https://stackoverflow.com/questions/4247068/sed-command-with-i-option-failing-on-mac-but-works-on-linux</a></p>",
        "id": 318467982,
        "sender_full_name": "Reid Barton",
        "timestamp": 1672338968
    },
    {
        "content": "<p>We assumed when we were writing this script that it would fail somehow on Macs, but we didn't have any way to find out specifically how--thanks for the report.</p>",
        "id": 318468020,
        "sender_full_name": "Reid Barton",
        "timestamp": 1672338997
    },
    {
        "content": "<p>I installed gnu-sed and aliased to sed ffwiw</p>",
        "id": 318468187,
        "sender_full_name": "Arien Malec",
        "timestamp": 1672339078
    },
    {
        "content": "<p>It looks like <code>sed -ibak</code> (or better, <code>sed -i.bak</code>) will leave behind a <code>.bak</code> file, that we maybe then want to delete</p>",
        "id": 318468277,
        "sender_full_name": "Reid Barton",
        "timestamp": 1672339110
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110032\">Reid Barton</span> <a href=\"#narrow/stream/287929-mathlib4/topic/start_port.2Esh.20fails/near/318468020\">said</a>:</p>\n<blockquote>\n<p>We assumed when we were writing this script that it would fail somehow on Macs, but we didn't have any way to find out specifically how--thanks for the report.</p>\n</blockquote>\n<p>In general BSD sed and GNU sed don't exactly like each other, however BSD sed is a strict subset of GNU sed (at least in the way it accepts -i arguments) you can also to the <code>-ibak</code> in GNU sed what you can also do is pass an empty backup file ending! <code>sed -i '' 's/foo/bar/g' file</code></p>",
        "id": 318468656,
        "sender_full_name": "Henrik Böving",
        "timestamp": 1672339290
    },
    {
        "content": "<p>I guess if you wanted to test next time you could install some FreeBSD or OpenBSD in a VM and give it a shot :D</p>",
        "id": 318468803,
        "sender_full_name": "Henrik Böving",
        "timestamp": 1672339345
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"395550\">Henrik Böving</span> <a href=\"#narrow/stream/287929-mathlib4/topic/start_port.2Esh.20fails/near/318468656\">said</a>:</p>\n<blockquote>\n<p>what you can also do is pass an empty backup file ending! <code>sed -i '' 's/foo/bar/g' file</code></p>\n</blockquote>\n<p>This doesn't work on my (Ubuntu Linux) system</p>",
        "id": 318468837,
        "sender_full_name": "Reid Barton",
        "timestamp": 1672339371
    },
    {
        "content": "<p>:(</p>",
        "id": 318468889,
        "sender_full_name": "Henrik Böving",
        "timestamp": 1672339398
    },
    {
        "content": "<p>I do remember some trick like this working out though, hmmmm</p>",
        "id": 318468926,
        "sender_full_name": "Henrik Böving",
        "timestamp": 1672339422
    },
    {
        "content": "<p>Ah of course a whitespace mistake: <code>sed -i'' 's/foo/bar/g' file</code></p>",
        "id": 318469198,
        "sender_full_name": "Henrik Böving",
        "timestamp": 1672339519
    },
    {
        "content": "<p>Can't make this type of stuff too easy</p>",
        "id": 318469373,
        "sender_full_name": "Henrik Böving",
        "timestamp": 1672339578
    },
    {
        "content": "<p>Isn't <code>sed -i''</code> the same as <code>sed -i</code>?</p>",
        "id": 318469377,
        "sender_full_name": "Reid Barton",
        "timestamp": 1672339580
    },
    {
        "content": "<p>Hmmm, my OpenBSD seems to like it, but that might already have been infected by a GNU sed lets see</p>",
        "id": 318469485,
        "sender_full_name": "Henrik Böving",
        "timestamp": 1672339632
    },
    {
        "content": "<p>Indeed a GNU sed /o\\</p>",
        "id": 318469703,
        "sender_full_name": "Henrik Böving",
        "timestamp": 1672339704
    },
    {
        "content": "<p>I tried on my Haiku VM but it also has GNU sed</p>",
        "id": 318470182,
        "sender_full_name": "Reid Barton",
        "timestamp": 1672339896
    },
    {
        "content": "<p>fwiw, I ran into this in my Mac as well and just made gnu-sed be the default <code>sed</code></p>",
        "id": 318478583,
        "sender_full_name": "Eric Rodriguez",
        "timestamp": 1672343776
    },
    {
        "content": "<p>after <code>brew install gnu-sed</code> there should be a link in  <code>/opt/homebrew/opt/gnu-sed/libexec/gnubin</code> (or <code>/usr/local/opt/gnu-sed/libexec/gnubin</code> if Intel mac) so just prepend that to your path and it should work</p>",
        "id": 318478725,
        "sender_full_name": "Eric Rodriguez",
        "timestamp": 1672343867
    },
    {
        "content": "<p>but it's annoying that this sort of incomaptibility exists :/</p>",
        "id": 318478744,
        "sender_full_name": "Eric Rodriguez",
        "timestamp": 1672343876
    },
    {
        "content": "<p>Bash is a terrible language to write cross-platform code</p>",
        "id": 318487713,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1672348680
    },
    {
        "content": "<p>Unfortunately, so are all the others.</p>",
        "id": 318582715,
        "sender_full_name": "Reid Barton",
        "timestamp": 1672405704
    },
    {
        "content": "<p>It's safer to write it in Lean, if possible. Because that would trigger a self-contained run, always using the same executor for everyone, at any point, modulo eventual differences in the execution of binaries generated for each OS (which should always be reported and are in the scope of the core devs)</p>",
        "id": 318583208,
        "sender_full_name": "Arthur Paulino",
        "timestamp": 1672405870
    },
    {
        "content": "<p><del>Lean OS on the way.</del></p>",
        "id": 318591471,
        "sender_full_name": "Trebor Huang",
        "timestamp": 1672408596
    },
    {
        "content": "<p>A Lean reimplementation is of course welcome, if someone would like to contribute one.</p>",
        "id": 318594587,
        "sender_full_name": "Reid Barton",
        "timestamp": 1672409513
    },
    {
        "content": "<p>IIRC, the dependency for  Lean implementation is a safe HTTP &amp; TLS client</p>",
        "id": 318619872,
        "sender_full_name": "Arien Malec",
        "timestamp": 1672418350
    },
    {
        "content": "<p>The script already calls <code>curl</code> anyway, so you might as well call it in Lean</p>",
        "id": 318623514,
        "sender_full_name": "Arthur Paulino",
        "timestamp": 1672419363
    },
    {
        "content": "<p>Or we could just bundle it into mathlibtools, since pretty much everyone involved in the port had a working installation of that</p>",
        "id": 318632566,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1672423209
    },
    {
        "content": "<p>I don't have an installation of mathlibtools</p>",
        "id": 318633641,
        "sender_full_name": "Reid Barton",
        "timestamp": 1672423670
    },
    {
        "content": "<p>You don't use <code>leanproject</code>?</p>",
        "id": 318636347,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1672424981
    },
    {
        "content": "<p>Nope</p>",
        "id": 318636392,
        "sender_full_name": "Reid Barton",
        "timestamp": 1672425000
    },
    {
        "content": "<p>How do you get your caches for lean3?</p>",
        "id": 318638446,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1672425957
    },
    {
        "content": "<p>My what?</p>",
        "id": 318638952,
        "sender_full_name": "Reid Barton",
        "timestamp": 1672426174
    },
    {
        "content": "<p>He already upgraded</p>",
        "id": 318639583,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1672426464
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"542196\">Arien Malec</span> <a href=\"#narrow/stream/287929-mathlib4/topic/start_port.2Esh.20fails/near/318468187\">said</a>:</p>\n<blockquote>\n<p>I installed gnu-sed and aliased to sed ffwiw</p>\n</blockquote>\n<p>As an update,  <code>brew</code>'d<code>gsed</code> still fails</p>",
        "id": 321725407,
        "sender_full_name": "Arien Malec",
        "timestamp": 1673907464
    },
    {
        "content": "<p>how do you do the alias?</p>",
        "id": 321725424,
        "sender_full_name": "Eric Rodriguez",
        "timestamp": 1673907477
    },
    {
        "content": "<p><code>alias sed=gsed</code></p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"bp\">%</span> <span class=\"n\">which</span> <span class=\"n\">sed</span>\n<span class=\"n\">sed</span><span class=\"o\">:</span> <span class=\"n\">aliased</span> <span class=\"n\">to</span> <span class=\"n\">gsed</span>\n<span class=\"bp\">%</span> <span class=\"n\">sed</span> <span class=\"c1\">--version</span>\n<span class=\"n\">gsed</span> <span class=\"o\">(</span><span class=\"n\">GNU</span> <span class=\"n\">sed</span><span class=\"o\">)</span> <span class=\"mi\">4</span><span class=\"bp\">.</span><span class=\"mi\">9</span>\n</code></pre></div>",
        "id": 321905534,
        "sender_full_name": "Arien Malec",
        "timestamp": 1673982580
    },
    {
        "content": "<p>do you <code>export</code> that?</p>",
        "id": 321910469,
        "sender_full_name": "Eric Rodriguez",
        "timestamp": 1673983980
    },
    {
        "content": "<p>Judging from your prompt, you might be using a non-<code>sh</code> shell. Then I'm not sure if whatever customization you have set up will apply to <code>start_port.sh</code>.</p>",
        "id": 321910968,
        "sender_full_name": "Reid Barton",
        "timestamp": 1673984134
    },
    {
        "content": "<p>I'm using <code>zsh</code> which is standard for OS X; I elided the computer name, etc from the prompt. But yeah, it's possible my alias only takes effect for <code>zsh</code>...</p>",
        "id": 321911946,
        "sender_full_name": "Arien Malec",
        "timestamp": 1673984459
    },
    {
        "content": "<p>and that the shell script defaults to <code>bash</code> -- sigh.</p>",
        "id": 321912046,
        "sender_full_name": "Arien Malec",
        "timestamp": 1673984496
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"284160\">Eric Rodriguez</span> <a href=\"#narrow/stream/287929-mathlib4/topic/start_port.2Esh.20fails/near/318478725\">said</a>:</p>\n<blockquote>\n<p>after <code>brew install gnu-sed</code> there should be a link in  <code>/opt/homebrew/opt/gnu-sed/libexec/gnubin</code> (or <code>/usr/local/opt/gnu-sed/libexec/gnubin</code> if Intel mac) so just prepend that to your path and it should work</p>\n</blockquote>\n<p>have you tried adding this to your <code>path</code> <span class=\"user-mention\" data-user-id=\"542196\">@Arien Malec</span> ?</p>",
        "id": 321912478,
        "sender_full_name": "Eric Rodriguez",
        "timestamp": 1673984673
    },
    {
        "content": "<p>the issue is where -- I think I can update this so deeply that <code>/bin/sh</code> picks it up as well.</p>",
        "id": 321912608,
        "sender_full_name": "Arien Malec",
        "timestamp": 1673984733
    },
    {
        "content": "<p>Try adding the <code>alias</code> line to <code>.bashrc</code>? or put a gnu sed on the path, yeah</p>",
        "id": 321912635,
        "sender_full_name": "Reid Barton",
        "timestamp": 1673984746
    },
    {
        "content": "<p>no, it's on zshrc</p>",
        "id": 321915228,
        "sender_full_name": "Eric Rodriguez",
        "timestamp": 1673985630
    },
    {
        "content": "<p>bash doesn't run bashrc when it  runs only a script, just for interactive sessions</p>",
        "id": 321915306,
        "sender_full_name": "Eric Rodriguez",
        "timestamp": 1673985658
    },
    {
        "content": "<p>Oh whoops you're right</p>",
        "id": 321916431,
        "sender_full_name": "Reid Barton",
        "timestamp": 1673986050
    },
    {
        "content": "<p>i've dealt with this fiasco already so I know the rundown :b</p>",
        "id": 321916655,
        "sender_full_name": "Eric Rodriguez",
        "timestamp": 1673986126
    },
    {
        "content": "<p>added to <code>/etc/paths</code> <span aria-label=\"fingers crossed\" class=\"emoji emoji-1f91e\" role=\"img\" title=\"fingers crossed\">:fingers_crossed:</span></p>",
        "id": 321918464,
        "sender_full_name": "Arien Malec",
        "timestamp": 1673986755
    },
    {
        "content": "<p>note that now you'll need gnu awk too (<code>brew install gawk</code>) and also similar extra steps</p>",
        "id": 322347080,
        "sender_full_name": "Eric Rodriguez",
        "timestamp": 1674152264
    }
]