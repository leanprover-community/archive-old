[
    {
        "content": "<p>Can someone talk me through how to use mathlib4 as a dependency in a lean4 project? On Thursday evenings I goof around with mini Lean 4 experiments and I'm sick of copying Data.Set.Basic around from repo to repo.</p>",
        "id": 238643198,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1620922343
    },
    {
        "content": "<p>Do your goofing in a directory in mathlib4 that you don't commit?</p>",
        "id": 238643282,
        "sender_full_name": "Daniel Selsam",
        "timestamp": 1620922392
    },
    {
        "content": "<p>Are you saying it's not possible right now?</p>",
        "id": 238652432,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1620926633
    },
    {
        "content": "<p>It is definitely possible. I use a custom setup though so I am unable to advise on the canonical way to do it. I thought this local-directory trick might be a satisfactory workaround for you for the very short-term.</p>",
        "id": 238652693,
        "sender_full_name": "Daniel Selsam",
        "timestamp": 1620926753
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110038\">Kevin Buzzard</span> <a href=\"#narrow/stream/287929-mathlib4/topic/mathlib4.20as.20a.20dependency.3F/near/238643198\">said</a>:</p>\n<blockquote>\n<p>Can someone talk me through how to use mathlib4 as a dependency in a lean4 project? On Thursday evenings I goof around with mini Lean 4 experiments and I'm sick of copying Data.Set.Basic around from repo to repo.</p>\n</blockquote>\n<p>You should be able to add it as a dependency to your <code>leanpkg.toml</code> like here:<br>\n<a href=\"https://github.com/mhuisi/lean4-cli/blob/main/leanpkg.toml\">https://github.com/mhuisi/lean4-cli/blob/main/leanpkg.toml</a></p>",
        "id": 238652774,
        "sender_full_name": "Marc Huisinga",
        "timestamp": 1620926782
    },
    {
        "content": "<p>That's been working since January but the parser had issues with line breaks and spacing, maybe that can be fixed easily so we can put <code>rev=</code> on a separate line. In your <code>leanpkg.toml</code> add:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"o\">[</span><span class=\"n\">dependencies</span><span class=\"o\">]</span>\n<span class=\"n\">MathLib4</span> <span class=\"bp\">=</span> <span class=\"o\">{</span><span class=\"n\">git</span> <span class=\"bp\">=</span> <span class=\"s2\">\"https://github.com/leanprover-community/mathlib4\"</span><span class=\"o\">,</span> <span class=\"n\">rev</span> <span class=\"bp\">=</span> <span class=\"s2\">\"&lt;fill_me_in&gt;\"</span><span class=\"o\">}</span>\n</code></pre></div>",
        "id": 238702490,
        "sender_full_name": "François G. Dorais",
        "timestamp": 1620953466
    },
    {
        "content": "<p>regarding line breaks, that's just the way <a href=\"https://github.com/toml-lang/toml\">toml</a> works. If you want multiple lines you can use something like</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"o\">[</span><span class=\"n\">dependencies.MathLib4</span><span class=\"o\">]</span>\n<span class=\"n\">git</span> <span class=\"bp\">=</span> <span class=\"s2\">\"https://github.com/leanprover-community/mathlib\"</span>\n<span class=\"n\">rev</span> <span class=\"bp\">=</span> <span class=\"s2\">\"&lt;fill_me_in&gt;\"</span>\n</code></pre></div>\n<p>(IIRC)</p>",
        "id": 238702600,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1620953562
    },
    {
        "content": "<p>Hi is this supported currently? I tried creating a new empty package and importing mathlib4 like so --</p>\n<p>lakefile.lean:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kn\">import</span> <span class=\"n\">Lake</span>\n<span class=\"kn\">open</span> <span class=\"n\">Lake</span> <span class=\"n\">DSL</span>\n\n<span class=\"n\">package</span> <span class=\"n\">scratch5</span> <span class=\"o\">{</span>\n  <span class=\"n\">dependencies</span> <span class=\"o\">:=</span> <span class=\"bp\">#</span><span class=\"o\">[{</span>\n    <span class=\"n\">name</span> <span class=\"o\">:=</span> <span class=\"bp\">`</span><span class=\"n\">mathlib</span>\n    <span class=\"n\">src</span> <span class=\"o\">:=</span> <span class=\"n\">Source.git</span> <span class=\"s2\">\"https://github.com/leanprover-community/mathlib4.git\"</span> <span class=\"s2\">\"master\"</span>\n  <span class=\"o\">}]</span>\n<span class=\"o\">}</span>\n</code></pre></div>\n<p>Scratch5.lean:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kn\">import</span> <span class=\"n\">Mathlib.Logic.Basic</span>\n<span class=\"kd\">def</span> <span class=\"n\">hello</span> <span class=\"o\">:=</span> <span class=\"s2\">\"world\"</span>\n</code></pre></div>\n<p>and \"lake build\" gives:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"n\">info</span><span class=\"o\">:</span> <span class=\"n\">mathlib</span><span class=\"o\">:</span> <span class=\"n\">trying</span> <span class=\"n\">to</span> <span class=\"n\">update</span> <span class=\"bp\">./</span><span class=\"n\">lean_packages</span><span class=\"bp\">/</span><span class=\"n\">mathlib</span> <span class=\"n\">to</span> <span class=\"n\">revision</span> <span class=\"n\">master</span>\n<span class=\"bp\">&gt;</span> <span class=\"n\">LEAN_PATH</span><span class=\"bp\">=./</span><span class=\"n\">build</span><span class=\"bp\">/</span><span class=\"n\">lib</span><span class=\"o\">:</span><span class=\"bp\">./</span><span class=\"n\">lean_packages</span><span class=\"bp\">/</span><span class=\"n\">mathlib</span><span class=\"bp\">/./</span><span class=\"n\">build</span><span class=\"bp\">/</span><span class=\"n\">lib</span> <span class=\"bp\">/</span><span class=\"n\">root</span><span class=\"bp\">/.</span><span class=\"n\">elan</span><span class=\"bp\">/</span><span class=\"n\">toolchains</span><span class=\"bp\">/</span><span class=\"n\">leanprover</span><span class=\"c1\">--lean4---stable/bin/lean ./lean_packages/mathlib/././Mathlib/Tactic/OpenPrivate.lean -R ./lean_packages/mathlib/./. -o ./lean_packages/mathlib/./build/lib/Mathlib/Tactic/OpenPrivate.olean -i ./lean_packages/mathlib/./build/lib/Mathlib/Tactic/OpenPrivate.ilean -c ./lean_packages/mathlib/./build/ir/Mathlib/Tactic/OpenPrivate.c</span>\n<span class=\"bp\">&gt;</span> <span class=\"n\">LEAN_PATH</span><span class=\"bp\">=./</span><span class=\"n\">build</span><span class=\"bp\">/</span><span class=\"n\">lib</span><span class=\"o\">:</span><span class=\"bp\">./</span><span class=\"n\">lean_packages</span><span class=\"bp\">/</span><span class=\"n\">mathlib</span><span class=\"bp\">/./</span><span class=\"n\">build</span><span class=\"bp\">/</span><span class=\"n\">lib</span> <span class=\"bp\">/</span><span class=\"n\">root</span><span class=\"bp\">/.</span><span class=\"n\">elan</span><span class=\"bp\">/</span><span class=\"n\">toolchains</span><span class=\"bp\">/</span><span class=\"n\">leanprover</span><span class=\"c1\">--lean4---stable/bin/lean ./lean_packages/mathlib/././Mathlib/Tactic/RCases.lean -R ./lean_packages/mathlib/./. -o ./lean_packages/mathlib/./build/lib/Mathlib/Tactic/RCases.olean -i ./lean_packages/mathlib/./build/lib/Mathlib/Tactic/RCases.ilean -c ./lean_packages/mathlib/./build/ir/Mathlib/Tactic/RCases.c</span>\n<span class=\"bp\">./</span><span class=\"n\">lean_packages</span><span class=\"bp\">/</span><span class=\"n\">mathlib</span><span class=\"bp\">/././</span><span class=\"n\">Mathlib</span><span class=\"bp\">/</span><span class=\"n\">Tactic</span><span class=\"bp\">/</span><span class=\"n\">OpenPrivate.lean</span><span class=\"o\">:</span><span class=\"mi\">36</span><span class=\"o\">:</span><span class=\"mi\">24</span><span class=\"o\">:</span> <span class=\"n\">error</span><span class=\"o\">:</span> <span class=\"n\">cannot</span> <span class=\"n\">lift</span> <span class=\"bp\">`</span><span class=\"o\">(</span><span class=\"bp\">&lt;-</span> <span class=\"bp\">...</span><span class=\"o\">)</span><span class=\"bp\">`</span> <span class=\"n\">over</span> <span class=\"n\">a</span> <span class=\"n\">binder</span><span class=\"o\">,</span> <span class=\"n\">this</span> <span class=\"n\">error</span> <span class=\"n\">usually</span> <span class=\"n\">happens</span> <span class=\"n\">when</span> <span class=\"n\">you</span> <span class=\"n\">are</span> <span class=\"n\">trying</span> <span class=\"n\">to</span> <span class=\"n\">lift</span> <span class=\"n\">a</span> <span class=\"n\">method</span> <span class=\"n\">nested</span> <span class=\"k\">in</span> <span class=\"n\">a</span> <span class=\"bp\">`</span><span class=\"k\">fun</span><span class=\"bp\">`</span><span class=\"o\">,</span> <span class=\"bp\">`</span><span class=\"k\">let</span><span class=\"bp\">`</span><span class=\"o\">,</span> <span class=\"n\">or</span> <span class=\"bp\">`</span><span class=\"k\">match</span><span class=\"bp\">`-</span><span class=\"n\">alternative</span><span class=\"o\">,</span> <span class=\"n\">and</span> <span class=\"n\">it</span> <span class=\"n\">can</span> <span class=\"n\">often</span> <span class=\"n\">be</span> <span class=\"n\">fixed</span> <span class=\"kd\">by</span> <span class=\"n\">adding</span> <span class=\"n\">a</span> <span class=\"n\">missing</span> <span class=\"bp\">`</span><span class=\"k\">do</span><span class=\"bp\">`</span>\n<span class=\"bp\">./</span><span class=\"n\">lean_packages</span><span class=\"bp\">/</span><span class=\"n\">mathlib</span><span class=\"bp\">/././</span><span class=\"n\">Mathlib</span><span class=\"bp\">/</span><span class=\"n\">Tactic</span><span class=\"bp\">/</span><span class=\"n\">OpenPrivate.lean</span><span class=\"o\">:</span><span class=\"mi\">37</span><span class=\"o\">:</span><span class=\"mi\">6</span><span class=\"o\">:</span> <span class=\"n\">error</span><span class=\"o\">:</span> <span class=\"n\">expected</span> <span class=\"n\">command</span>\n\n<span class=\"n\">error</span><span class=\"o\">:</span> <span class=\"n\">external</span> <span class=\"n\">command</span> <span class=\"bp\">/</span><span class=\"n\">root</span><span class=\"bp\">/.</span><span class=\"n\">elan</span><span class=\"bp\">/</span><span class=\"n\">toolchains</span><span class=\"bp\">/</span><span class=\"n\">leanprover</span><span class=\"c1\">--lean4---stable/bin/lean exited with status 1</span>\n<span class=\"bp\">./</span><span class=\"n\">lean_packages</span><span class=\"bp\">/</span><span class=\"n\">mathlib</span><span class=\"bp\">/././</span><span class=\"n\">Mathlib</span><span class=\"bp\">/</span><span class=\"n\">Tactic</span><span class=\"bp\">/</span><span class=\"n\">RCases.lean</span><span class=\"o\">:</span><span class=\"mi\">328</span><span class=\"o\">:</span><span class=\"mi\">8</span><span class=\"o\">:</span> <span class=\"n\">error</span><span class=\"o\">:</span> <span class=\"n\">expected</span> <span class=\"bp\">'=&gt;'</span>\n<span class=\"bp\">./</span><span class=\"n\">lean_packages</span><span class=\"bp\">/</span><span class=\"n\">mathlib</span><span class=\"bp\">/././</span><span class=\"n\">Mathlib</span><span class=\"bp\">/</span><span class=\"n\">Tactic</span><span class=\"bp\">/</span><span class=\"n\">RCases.lean</span><span class=\"o\">:</span><span class=\"mi\">371</span><span class=\"o\">:</span><span class=\"mi\">0</span><span class=\"o\">:</span> <span class=\"n\">error</span><span class=\"o\">:</span> <span class=\"n\">invalid</span> <span class=\"bp\">'</span><span class=\"kd\">end</span><span class=\"bp\">'</span><span class=\"o\">,</span> <span class=\"n\">name</span> <span class=\"n\">is</span> <span class=\"n\">missing</span>\n<span class=\"bp\">./</span><span class=\"n\">lean_packages</span><span class=\"bp\">/</span><span class=\"n\">mathlib</span><span class=\"bp\">/././</span><span class=\"n\">Mathlib</span><span class=\"bp\">/</span><span class=\"n\">Tactic</span><span class=\"bp\">/</span><span class=\"n\">RCases.lean</span><span class=\"o\">:</span><span class=\"mi\">386</span><span class=\"o\">:</span><span class=\"mi\">24</span><span class=\"o\">:</span> <span class=\"n\">error</span><span class=\"o\">:</span> <span class=\"n\">unknown</span> <span class=\"n\">identifier</span> <span class=\"bp\">'</span><span class=\"n\">TermElabM'</span>\n<span class=\"bp\">./</span><span class=\"n\">lean_packages</span><span class=\"bp\">/</span><span class=\"n\">mathlib</span><span class=\"bp\">/././</span><span class=\"n\">Mathlib</span><span class=\"bp\">/</span><span class=\"n\">Tactic</span><span class=\"bp\">/</span><span class=\"n\">RCases.lean</span><span class=\"o\">:</span><span class=\"mi\">393</span><span class=\"o\">:</span><span class=\"mi\">52</span><span class=\"o\">:</span> <span class=\"n\">error</span><span class=\"o\">:</span> <span class=\"n\">unknown</span> <span class=\"n\">identifier</span> <span class=\"bp\">'</span><span class=\"n\">RCasesPatt'</span>\n<span class=\"bp\">./</span><span class=\"n\">lean_packages</span><span class=\"bp\">/</span><span class=\"n\">mathlib</span><span class=\"bp\">/././</span><span class=\"n\">Mathlib</span><span class=\"bp\">/</span><span class=\"n\">Tactic</span><span class=\"bp\">/</span><span class=\"n\">RCases.lean</span><span class=\"o\">:</span><span class=\"mi\">396</span><span class=\"o\">:</span><span class=\"mi\">11</span><span class=\"o\">:</span> <span class=\"n\">error</span><span class=\"o\">:</span> <span class=\"n\">unknown</span> <span class=\"n\">identifier</span> <span class=\"bp\">'</span><span class=\"n\">RCasesPatt.alts''</span>\n<span class=\"bp\">./</span><span class=\"n\">lean_packages</span><span class=\"bp\">/</span><span class=\"n\">mathlib</span><span class=\"bp\">/././</span><span class=\"n\">Mathlib</span><span class=\"bp\">/</span><span class=\"n\">Tactic</span><span class=\"bp\">/</span><span class=\"n\">RCases.lean</span><span class=\"o\">:</span><span class=\"mi\">398</span><span class=\"o\">:</span><span class=\"mi\">11</span><span class=\"o\">:</span> <span class=\"n\">error</span><span class=\"o\">:</span> <span class=\"n\">unknown</span> <span class=\"n\">identifier</span> <span class=\"bp\">'</span><span class=\"n\">RCasesPatt.typed'</span>\n<span class=\"bp\">./</span><span class=\"n\">lean_packages</span><span class=\"bp\">/</span><span class=\"n\">mathlib</span><span class=\"bp\">/././</span><span class=\"n\">Mathlib</span><span class=\"bp\">/</span><span class=\"n\">Tactic</span><span class=\"bp\">/</span><span class=\"n\">RCases.lean</span><span class=\"o\">:</span><span class=\"mi\">400</span><span class=\"o\">:</span><span class=\"mi\">30</span><span class=\"o\">:</span> <span class=\"n\">error</span><span class=\"o\">:</span> <span class=\"n\">unknown</span> <span class=\"n\">identifier</span> <span class=\"bp\">'</span><span class=\"n\">RCasesPatt.one'</span>\n<span class=\"bp\">./</span><span class=\"n\">lean_packages</span><span class=\"bp\">/</span><span class=\"n\">mathlib</span><span class=\"bp\">/././</span><span class=\"n\">Mathlib</span><span class=\"bp\">/</span><span class=\"n\">Tactic</span><span class=\"bp\">/</span><span class=\"n\">RCases.lean</span><span class=\"o\">:</span><span class=\"mi\">401</span><span class=\"o\">:</span><span class=\"mi\">37</span><span class=\"o\">:</span> <span class=\"n\">error</span><span class=\"o\">:</span> <span class=\"n\">unknown</span> <span class=\"n\">identifier</span> <span class=\"bp\">'</span><span class=\"n\">RCasesPatt.one'</span>\n<span class=\"bp\">./</span><span class=\"n\">lean_packages</span><span class=\"bp\">/</span><span class=\"n\">mathlib</span><span class=\"bp\">/././</span><span class=\"n\">Mathlib</span><span class=\"bp\">/</span><span class=\"n\">Tactic</span><span class=\"bp\">/</span><span class=\"n\">RCases.lean</span><span class=\"o\">:</span><span class=\"mi\">402</span><span class=\"o\">:</span><span class=\"mi\">30</span><span class=\"o\">:</span> <span class=\"n\">error</span><span class=\"o\">:</span> <span class=\"n\">unknown</span> <span class=\"n\">identifier</span> <span class=\"bp\">'</span><span class=\"n\">RCasesPatt.clear'</span>\n<span class=\"bp\">./</span><span class=\"n\">lean_packages</span><span class=\"bp\">/</span><span class=\"n\">mathlib</span><span class=\"bp\">/././</span><span class=\"n\">Mathlib</span><span class=\"bp\">/</span><span class=\"n\">Tactic</span><span class=\"bp\">/</span><span class=\"n\">RCases.lean</span><span class=\"o\">:</span><span class=\"mi\">404</span><span class=\"o\">:</span><span class=\"mi\">11</span><span class=\"o\">:</span> <span class=\"n\">error</span><span class=\"o\">:</span> <span class=\"n\">unknown</span> <span class=\"n\">identifier</span> <span class=\"bp\">'</span><span class=\"n\">RCasesPatt.tuple'</span>\n<span class=\"bp\">./</span><span class=\"n\">lean_packages</span><span class=\"bp\">/</span><span class=\"n\">mathlib</span><span class=\"bp\">/././</span><span class=\"n\">Mathlib</span><span class=\"bp\">/</span><span class=\"n\">Tactic</span><span class=\"bp\">/</span><span class=\"n\">RCases.lean</span><span class=\"o\">:</span><span class=\"mi\">425</span><span class=\"o\">:</span><span class=\"mi\">9</span><span class=\"o\">:</span> <span class=\"n\">error</span><span class=\"o\">:</span> <span class=\"n\">unknown</span> <span class=\"n\">identifier</span> <span class=\"bp\">'</span><span class=\"n\">RCasesPatt'</span>\n<span class=\"bp\">./</span><span class=\"n\">lean_packages</span><span class=\"bp\">/</span><span class=\"n\">mathlib</span><span class=\"bp\">/././</span><span class=\"n\">Mathlib</span><span class=\"bp\">/</span><span class=\"n\">Tactic</span><span class=\"bp\">/</span><span class=\"n\">RCases.lean</span><span class=\"o\">:</span><span class=\"mi\">432</span><span class=\"o\">:</span><span class=\"mi\">6</span><span class=\"o\">:</span> <span class=\"n\">error</span><span class=\"o\">:</span> <span class=\"n\">unsupported</span> <span class=\"n\">pattern</span> <span class=\"k\">in</span> <span class=\"n\">syntax</span> <span class=\"k\">match</span>\n  <span class=\"n\">RCasesPatt.typed</span> <span class=\"n\">ref</span> <span class=\"n\">pat</span> <span class=\"n\">ty</span>\n<span class=\"bp\">./</span><span class=\"n\">lean_packages</span><span class=\"bp\">/</span><span class=\"n\">mathlib</span><span class=\"bp\">/././</span><span class=\"n\">Mathlib</span><span class=\"bp\">/</span><span class=\"n\">Tactic</span><span class=\"bp\">/</span><span class=\"n\">RCases.lean</span><span class=\"o\">:</span><span class=\"mi\">429</span><span class=\"o\">:</span><span class=\"mi\">15</span><span class=\"o\">:</span> <span class=\"n\">error</span><span class=\"o\">:</span> <span class=\"n\">unknown</span> <span class=\"n\">identifier</span> <span class=\"bp\">'</span><span class=\"n\">processConstructor'</span>\n<span class=\"bp\">./</span><span class=\"n\">lean_packages</span><span class=\"bp\">/</span><span class=\"n\">mathlib</span><span class=\"bp\">/././</span><span class=\"n\">Mathlib</span><span class=\"bp\">/</span><span class=\"n\">Tactic</span><span class=\"bp\">/</span><span class=\"n\">RCases.lean</span><span class=\"o\">:</span><span class=\"mi\">437</span><span class=\"o\">:</span><span class=\"mi\">11</span><span class=\"o\">:</span> <span class=\"n\">error</span><span class=\"o\">:</span> <span class=\"n\">unknown</span> <span class=\"n\">identifier</span> <span class=\"bp\">'</span><span class=\"n\">rcasesContinue'</span>\n<span class=\"bp\">./</span><span class=\"n\">lean_packages</span><span class=\"bp\">/</span><span class=\"n\">mathlib</span><span class=\"bp\">/././</span><span class=\"n\">Mathlib</span><span class=\"bp\">/</span><span class=\"n\">Tactic</span><span class=\"bp\">/</span><span class=\"n\">RCases.lean</span><span class=\"o\">:</span><span class=\"mi\">438</span><span class=\"o\">:</span><span class=\"mi\">7</span><span class=\"o\">:</span> <span class=\"n\">error</span><span class=\"o\">:</span> <span class=\"n\">invalid</span> <span class=\"n\">field</span> <span class=\"kd\">notation</span><span class=\"o\">,</span> <span class=\"n\">type</span> <span class=\"n\">is</span> <span class=\"n\">not</span> <span class=\"n\">of</span> <span class=\"n\">the</span> <span class=\"n\">form</span> <span class=\"o\">(</span><span class=\"n\">C</span> <span class=\"bp\">...</span><span class=\"o\">)</span> <span class=\"n\">where</span> <span class=\"n\">C</span> <span class=\"n\">is</span> <span class=\"n\">a</span> <span class=\"kd\">constant</span>\n  <span class=\"n\">gs</span>\n<span class=\"n\">has</span> <span class=\"n\">type</span>\n  <span class=\"bp\">?</span><span class=\"n\">m.19077</span>\n<span class=\"bp\">./</span><span class=\"n\">lean_packages</span><span class=\"bp\">/</span><span class=\"n\">mathlib</span><span class=\"bp\">/././</span><span class=\"n\">Mathlib</span><span class=\"bp\">/</span><span class=\"n\">Tactic</span><span class=\"bp\">/</span><span class=\"n\">RCases.lean</span><span class=\"o\">:</span><span class=\"mi\">443</span><span class=\"o\">:</span><span class=\"mi\">22</span><span class=\"o\">:</span> <span class=\"n\">error</span><span class=\"o\">:</span> <span class=\"n\">unknown</span> <span class=\"n\">identifier</span> <span class=\"bp\">'</span><span class=\"n\">RCasesPatt'</span>\n<span class=\"bp\">./</span><span class=\"n\">lean_packages</span><span class=\"bp\">/</span><span class=\"n\">mathlib</span><span class=\"bp\">/././</span><span class=\"n\">Mathlib</span><span class=\"bp\">/</span><span class=\"n\">Tactic</span><span class=\"bp\">/</span><span class=\"n\">RCases.lean</span><span class=\"o\">:</span><span class=\"mi\">447</span><span class=\"o\">:</span><span class=\"mi\">11</span><span class=\"o\">:</span> <span class=\"n\">error</span><span class=\"o\">:</span> <span class=\"n\">unknown</span> <span class=\"n\">identifier</span> <span class=\"bp\">'</span><span class=\"n\">rcasesCore'</span>\n<span class=\"bp\">./</span><span class=\"n\">lean_packages</span><span class=\"bp\">/</span><span class=\"n\">mathlib</span><span class=\"bp\">/././</span><span class=\"n\">Mathlib</span><span class=\"bp\">/</span><span class=\"n\">Tactic</span><span class=\"bp\">/</span><span class=\"n\">RCases.lean</span><span class=\"o\">:</span><span class=\"mi\">448</span><span class=\"o\">:</span><span class=\"mi\">22</span><span class=\"o\">:</span> <span class=\"n\">error</span><span class=\"o\">:</span> <span class=\"n\">invalid</span> <span class=\"n\">field</span> <span class=\"kd\">notation</span><span class=\"o\">,</span> <span class=\"n\">type</span> <span class=\"n\">is</span> <span class=\"n\">not</span> <span class=\"n\">of</span> <span class=\"n\">the</span> <span class=\"n\">form</span> <span class=\"o\">(</span><span class=\"n\">C</span> <span class=\"bp\">...</span><span class=\"o\">)</span> <span class=\"n\">where</span> <span class=\"n\">C</span> <span class=\"n\">is</span> <span class=\"n\">a</span> <span class=\"kd\">constant</span>\n  <span class=\"n\">gs</span>\n<span class=\"n\">has</span> <span class=\"n\">type</span>\n  <span class=\"bp\">?</span><span class=\"n\">m.19643</span> <span class=\"n\">pat</span> <span class=\"n\">ty</span><span class=\"bp\">✝</span> <span class=\"n\">g</span> <span class=\"n\">ty</span> <span class=\"n\">g₁</span> <span class=\"n\">a</span><span class=\"bp\">✝</span> <span class=\"n\">discr</span><span class=\"bp\">✝</span> <span class=\"n\">v</span> <span class=\"n\">g₂</span>\n<span class=\"bp\">./</span><span class=\"n\">lean_packages</span><span class=\"bp\">/</span><span class=\"n\">mathlib</span><span class=\"bp\">/././</span><span class=\"n\">Mathlib</span><span class=\"bp\">/</span><span class=\"n\">Tactic</span><span class=\"bp\">/</span><span class=\"n\">RCases.lean</span><span class=\"o\">:</span><span class=\"mi\">459</span><span class=\"o\">:</span><span class=\"mi\">4</span><span class=\"o\">:</span> <span class=\"n\">error</span><span class=\"o\">:</span> <span class=\"n\">unknown</span> <span class=\"n\">identifier</span> <span class=\"bp\">'</span><span class=\"n\">rcasesCore'</span>\n<span class=\"bp\">./</span><span class=\"n\">lean_packages</span><span class=\"bp\">/</span><span class=\"n\">mathlib</span><span class=\"bp\">/././</span><span class=\"n\">Mathlib</span><span class=\"bp\">/</span><span class=\"n\">Tactic</span><span class=\"bp\">/</span><span class=\"n\">RCases.lean</span><span class=\"o\">:</span><span class=\"mi\">458</span><span class=\"o\">:</span><span class=\"mi\">26</span><span class=\"o\">:</span> <span class=\"n\">error</span><span class=\"o\">:</span> <span class=\"n\">invalid</span> <span class=\"n\">field</span> <span class=\"kd\">notation</span><span class=\"o\">,</span> <span class=\"n\">type</span> <span class=\"n\">is</span> <span class=\"n\">not</span> <span class=\"n\">of</span> <span class=\"n\">the</span> <span class=\"n\">form</span> <span class=\"o\">(</span><span class=\"n\">C</span> <span class=\"bp\">...</span><span class=\"o\">)</span> <span class=\"n\">where</span> <span class=\"n\">C</span> <span class=\"n\">is</span> <span class=\"n\">a</span> <span class=\"kd\">constant</span>\n  <span class=\"n\">pat</span>\n<span class=\"n\">has</span> <span class=\"n\">type</span>\n  <span class=\"bp\">?</span><span class=\"n\">m.20541</span> <span class=\"n\">g</span> <span class=\"n\">fs</span> <span class=\"n\">clears</span> <span class=\"n\">a</span> <span class=\"n\">ref</span> <span class=\"n\">pat</span><span class=\"bp\">✝¹</span> <span class=\"n\">ty</span><span class=\"bp\">?</span> <span class=\"n\">cont</span> <span class=\"n\">a</span><span class=\"bp\">✝</span>\n<span class=\"bp\">./</span><span class=\"n\">lean_packages</span><span class=\"bp\">/</span><span class=\"n\">mathlib</span><span class=\"bp\">/././</span><span class=\"n\">Mathlib</span><span class=\"bp\">/</span><span class=\"n\">Tactic</span><span class=\"bp\">/</span><span class=\"n\">RCases.lean</span><span class=\"o\">:</span><span class=\"mi\">480</span><span class=\"o\">:</span><span class=\"mi\">0</span><span class=\"o\">:</span> <span class=\"n\">error</span><span class=\"o\">:</span> <span class=\"n\">invalid</span> <span class=\"bp\">'</span><span class=\"kd\">end</span><span class=\"bp\">'</span><span class=\"o\">,</span> <span class=\"n\">insufficient</span> <span class=\"n\">scopes</span>\n<span class=\"bp\">./</span><span class=\"n\">lean_packages</span><span class=\"bp\">/</span><span class=\"n\">mathlib</span><span class=\"bp\">/././</span><span class=\"n\">Mathlib</span><span class=\"bp\">/</span><span class=\"n\">Tactic</span><span class=\"bp\">/</span><span class=\"n\">RCases.lean</span><span class=\"o\">:</span><span class=\"mi\">496</span><span class=\"o\">:</span><span class=\"mi\">23</span><span class=\"o\">:</span> <span class=\"n\">error</span><span class=\"o\">:</span> <span class=\"n\">unknown</span> <span class=\"n\">identifier</span> <span class=\"bp\">'</span><span class=\"n\">RCases.rcases'</span>\n<span class=\"bp\">./</span><span class=\"n\">lean_packages</span><span class=\"bp\">/</span><span class=\"n\">mathlib</span><span class=\"bp\">/././</span><span class=\"n\">Mathlib</span><span class=\"bp\">/</span><span class=\"n\">Tactic</span><span class=\"bp\">/</span><span class=\"n\">RCases.lean</span><span class=\"o\">:</span><span class=\"mi\">507</span><span class=\"o\">:</span><span class=\"mi\">25</span><span class=\"o\">:</span> <span class=\"n\">error</span><span class=\"o\">:</span> <span class=\"n\">unknown</span> <span class=\"n\">identifier</span> <span class=\"bp\">'</span><span class=\"n\">RCases.obtainNone'</span>\n<span class=\"bp\">./</span><span class=\"n\">lean_packages</span><span class=\"bp\">/</span><span class=\"n\">mathlib</span><span class=\"bp\">/././</span><span class=\"n\">Mathlib</span><span class=\"bp\">/</span><span class=\"n\">Tactic</span><span class=\"bp\">/</span><span class=\"n\">RCases.lean</span><span class=\"o\">:</span><span class=\"mi\">513</span><span class=\"o\">:</span><span class=\"mi\">25</span><span class=\"o\">:</span> <span class=\"n\">error</span><span class=\"o\">:</span> <span class=\"n\">unknown</span> <span class=\"n\">identifier</span> <span class=\"bp\">'</span><span class=\"n\">RCases.rcases'</span>\n<span class=\"bp\">./</span><span class=\"n\">lean_packages</span><span class=\"bp\">/</span><span class=\"n\">mathlib</span><span class=\"bp\">/././</span><span class=\"n\">Mathlib</span><span class=\"bp\">/</span><span class=\"n\">Tactic</span><span class=\"bp\">/</span><span class=\"n\">RCases.lean</span><span class=\"o\">:</span><span class=\"mi\">521</span><span class=\"o\">:</span><span class=\"mi\">23</span><span class=\"o\">:</span> <span class=\"n\">error</span><span class=\"o\">:</span> <span class=\"n\">unknown</span> <span class=\"n\">identifier</span> <span class=\"bp\">'</span><span class=\"n\">RCases.rintro'</span>\n\n<span class=\"n\">error</span><span class=\"o\">:</span> <span class=\"n\">external</span> <span class=\"n\">command</span> <span class=\"bp\">/</span><span class=\"n\">root</span><span class=\"bp\">/.</span><span class=\"n\">elan</span><span class=\"bp\">/</span><span class=\"n\">toolchains</span><span class=\"bp\">/</span><span class=\"n\">leanprover</span><span class=\"c1\">--lean4---stable/bin/lean exited with status 1</span>\n<span class=\"n\">error</span><span class=\"o\">:</span> <span class=\"n\">build</span> <span class=\"n\">failed</span>\n</code></pre></div>\n<p>should this work?</p>",
        "id": 272539827,
        "sender_full_name": "Mark Wilhelm",
        "timestamp": 1645301627
    },
    {
        "content": "<p>mathport uses mathlib4 as a dependency, you might use that as an example</p>",
        "id": 272540208,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1645302014
    },
    {
        "content": "<p>My guess is that you are compiling mathlib with the wrong lean version. Mathport has a <code>lean-toolchain</code> file in the project root which is used by lake to select the right nightly version; right now it says <code>leanprover/lean4:nightly-2022-02-17</code>, which matches the <code>lean-toolchain</code> version inside the selected version of mathlib4</p>",
        "id": 272540375,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1645302194
    },
    {
        "content": "<p>yes! that fixed it, thank you</p>",
        "id": 272540615,
        "sender_full_name": "Mark Wilhelm",
        "timestamp": 1645302454
    }
]