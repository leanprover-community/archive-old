[
    {
        "content": "<p>How do I correctly build a shared library that uses mathlib4? I want to include all the mathlib symbols in that shared library.</p>\n<p>Previously I solved this by adding additional roots:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kd\">@[default_target]</span>\n<span class=\"n\">lean_lib</span> <span class=\"n\">HouLean</span> <span class=\"o\">{</span>\n  <span class=\"n\">roots</span> <span class=\"o\">:=</span> <span class=\"bp\">#</span><span class=\"o\">[</span><span class=\"bp\">`</span><span class=\"n\">HouLean</span><span class=\"o\">,</span> <span class=\"bp\">`</span><span class=\"n\">SciLean</span><span class=\"o\">,</span> <span class=\"bp\">`</span><span class=\"n\">Std</span><span class=\"o\">,</span> <span class=\"bp\">`</span><span class=\"n\">Mathlib</span><span class=\"o\">]</span>\n  <span class=\"n\">buildType</span> <span class=\"o\">:=</span> <span class=\"bp\">.</span><span class=\"n\">release</span>\n  <span class=\"n\">precompileModules</span> <span class=\"o\">:=</span> <span class=\"n\">true</span>\n<span class=\"o\">}</span>\n<span class=\"n\">require</span> <span class=\"n\">scilean</span> <span class=\"k\">from</span> <span class=\"n\">git</span> <span class=\"s2\">\"https://github.com/lecopivo/SciLean\"</span> <span class=\"bp\">@</span> <span class=\"s2\">\"master\"</span>\n</code></pre></div>\n<p>However, I have updated to <code>nightly-10-20</code>. After the update, if I try to load the share library I get an error</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"n\">home</span><span class=\"bp\">/</span><span class=\"n\">tomass</span><span class=\"bp\">/</span><span class=\"n\">houdini19.5</span><span class=\"bp\">/</span><span class=\"n\">lib</span><span class=\"bp\">/</span><span class=\"n\">libHouLean.so</span><span class=\"o\">:</span> <span class=\"n\">undefined</span> <span class=\"n\">symbol</span><span class=\"o\">:</span> <span class=\"n\">l_Qq_inferTypeQ</span>\n</code></pre></div>\n<p>Ok, so I need to include <code>Qq</code> library too, but changing roots to <code>roots := #[`HouLean, `SciLean, `Std, `Mathlib, `Qq]</code> produces a compilation error:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"n\">error</span><span class=\"o\">:</span> <span class=\"n\">no</span> <span class=\"n\">such</span> <span class=\"n\">file</span> <span class=\"n\">or</span> <span class=\"n\">directory</span> <span class=\"o\">(</span><span class=\"n\">error</span> <span class=\"n\">code</span><span class=\"o\">:</span> <span class=\"mi\">2</span><span class=\"o\">)</span>\n  <span class=\"n\">file</span><span class=\"o\">:</span> <span class=\"bp\">./././</span><span class=\"n\">Qq</span><span class=\"bp\">/</span><span class=\"n\">MetaM.lean</span>\n</code></pre></div>\n<p>I do not understand why this file can't be found.</p>\n<hr>\n<p>What is the intended way to include all the symbols from dependencies to one shared library?</p>",
        "id": 306288435,
        "sender_full_name": "Tomas Skrivan",
        "timestamp": 1666804045
    }
]