[
    {
        "content": "<p>I need to compile the c file with the extra arguments: <code>\"-I /usr/include/mysql -lmysqlclient\"</code>.</p>\n<p>In the <code>lakefile.lean</code> file I did:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"n\">package</span> <span class=\"n\">LeanMySQL</span> <span class=\"o\">(</span><span class=\"n\">pkgDir</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n  <span class=\"c1\">-- customize layout</span>\n  <span class=\"n\">srcDir</span> <span class=\"o\">:=</span> <span class=\"s2\">\"lib\"</span>\n  <span class=\"n\">libRoots</span> <span class=\"o\">:=</span> <span class=\"bp\">#</span><span class=\"o\">[</span><span class=\"bp\">`</span><span class=\"n\">Ffi</span><span class=\"o\">]</span>\n  <span class=\"c1\">-- specify the lib as an additional target</span>\n  <span class=\"n\">moreLibTargets</span> <span class=\"o\">:=</span> <span class=\"bp\">#</span><span class=\"o\">[</span><span class=\"n\">cLibTarget</span> <span class=\"n\">pkgDir</span><span class=\"o\">]</span>\n  <span class=\"n\">moreLeancArgs</span> <span class=\"o\">:=</span> <span class=\"bp\">#</span><span class=\"o\">[</span><span class=\"s2\">\"-I /usr/include/mysql\"</span><span class=\"o\">,</span> <span class=\"s2\">\"-lmysqlclient\"</span><span class=\"o\">]</span>\n  <span class=\"c1\">-- moreLinkArgs := #[]</span>\n<span class=\"o\">}</span>\n</code></pre></div>\n<p>But when I run <code>lake build</code> it doesn't seem like the extra arguments are being passed:</p>\n<div class=\"codehilite\" data-code-language=\"Bash\"><pre><span></span><code>$ lake build\n&gt; c++ -c -o ./build/cpp/ffi.o ./cpp/ffi.cpp -I /home/arthur/.elan/toolchains/leanprover--lean4---nightly-2021-10-20/include\n</code></pre></div>",
        "id": 262201198,
        "sender_full_name": "Arthur Paulino",
        "timestamp": 1637438024
    },
    {
        "content": "<p>As a result, <code>mysql.h</code> cannot be found. Has anyone experienced anything similar?</p>",
        "id": 262201380,
        "sender_full_name": "Arthur Paulino",
        "timestamp": 1637438229
    },
    {
        "content": "<p>Ah, got it. The linking args have to be stated using <code>moreLinkArgs</code>:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"n\">package</span> <span class=\"n\">LeanMySQL</span> <span class=\"o\">(</span><span class=\"n\">pkgDir</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n  <span class=\"n\">srcDir</span> <span class=\"o\">:=</span> <span class=\"s2\">\"lib\"</span>\n  <span class=\"n\">libRoots</span> <span class=\"o\">:=</span> <span class=\"bp\">#</span><span class=\"o\">[</span><span class=\"bp\">`</span><span class=\"n\">Ffi</span><span class=\"o\">]</span>\n  <span class=\"n\">moreLibTargets</span> <span class=\"o\">:=</span> <span class=\"bp\">#</span><span class=\"o\">[</span><span class=\"n\">cLibTarget</span> <span class=\"n\">pkgDir</span><span class=\"o\">]</span>\n  <span class=\"n\">moreLeancArgs</span> <span class=\"o\">:=</span> <span class=\"bp\">#</span><span class=\"o\">[</span><span class=\"s2\">\"-I /usr/include/mysql\"</span><span class=\"o\">]</span>\n  <span class=\"n\">moreLinkArgs</span> <span class=\"o\">:=</span> <span class=\"bp\">#</span><span class=\"o\">[</span><span class=\"s2\">\"-lmysqlclient\"</span><span class=\"o\">]</span>\n<span class=\"o\">}</span>\n</code></pre></div>",
        "id": 262202094,
        "sender_full_name": "Arthur Paulino",
        "timestamp": 1637439022
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"451983\">Arthur Paulino</span> has marked this topic as resolved.</p>",
        "id": 262202096,
        "sender_full_name": "Notification Bot",
        "timestamp": 1637439027
    },
    {
        "content": "<p>Yes, that confused me as well yesterday</p>",
        "id": 262206271,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1637444612
    },
    {
        "content": "<p>Turns out that solution that I posted doesn't work. I got confused because it had built properly before and then I changed the config and it built again instantly (I hadn't changed the source files).<br>\nI will post the right configuration when I get home <span aria-label=\"+1\" class=\"emoji emoji-1f44d\" role=\"img\" title=\"+1\">:+1:</span></p>",
        "id": 262208297,
        "sender_full_name": "Arthur Paulino",
        "timestamp": 1637447298
    },
    {
        "content": "<p>This is the config that works:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kn\">import</span> <span class=\"n\">Lake</span>\n<span class=\"kn\">open</span> <span class=\"n\">System</span> <span class=\"n\">Lake</span> <span class=\"n\">DSL</span>\n\n<span class=\"kd\">def</span> <span class=\"n\">cppDir</span> <span class=\"o\">:</span> <span class=\"n\">FilePath</span> <span class=\"o\">:=</span> <span class=\"s2\">\"cpp\"</span>\n<span class=\"kd\">def</span> <span class=\"n\">ffiSrc</span> <span class=\"o\">:=</span> <span class=\"n\">cppDir</span> <span class=\"bp\">/</span> <span class=\"s2\">\"ffi.cpp\"</span>\n<span class=\"kd\">def</span> <span class=\"n\">mySQLIncludeDir</span> <span class=\"o\">:=</span> <span class=\"s2\">\"/usr/include/mysql\"</span>\n<span class=\"kd\">def</span> <span class=\"n\">mySQLLinkArg</span> <span class=\"o\">:=</span> <span class=\"s2\">\"-lmysqlclient\"</span>\n\n<span class=\"kd\">def</span> <span class=\"n\">ffiOTarget</span> <span class=\"o\">(</span><span class=\"n\">pkgDir</span> <span class=\"o\">:</span> <span class=\"n\">FilePath</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">FileTarget</span> <span class=\"o\">:=</span>\n  <span class=\"k\">let</span> <span class=\"n\">oFile</span> <span class=\"o\">:=</span> <span class=\"n\">pkgDir</span> <span class=\"bp\">/</span> <span class=\"n\">defaultBuildDir</span> <span class=\"bp\">/</span> <span class=\"n\">cppDir</span> <span class=\"bp\">/</span> <span class=\"s2\">\"ffi.o\"</span>\n  <span class=\"k\">let</span> <span class=\"n\">srcTarget</span> <span class=\"o\">:=</span> <span class=\"n\">inputFileTarget</span> <span class=\"bp\">&lt;|</span> <span class=\"n\">pkgDir</span> <span class=\"bp\">/</span> <span class=\"n\">ffiSrc</span>\n  <span class=\"n\">fileTargetWithDep</span> <span class=\"n\">oFile</span> <span class=\"n\">srcTarget</span> <span class=\"k\">fun</span> <span class=\"n\">srcFile</span> <span class=\"bp\">=&gt;</span> <span class=\"k\">do</span>\n    <span class=\"n\">compileO</span> <span class=\"n\">oFile</span> <span class=\"n\">srcFile</span>\n      <span class=\"bp\">#</span><span class=\"o\">[</span><span class=\"s2\">\"-I\"</span><span class=\"o\">,</span> <span class=\"o\">(</span><span class=\"bp\">‚Üê</span> <span class=\"n\">getLeanIncludeDir</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">toString</span><span class=\"o\">,</span> <span class=\"s2\">\"-I\"</span><span class=\"o\">,</span> <span class=\"n\">mySQLIncludeDir</span><span class=\"o\">]</span> <span class=\"s2\">\"g++\"</span>\n\n<span class=\"kd\">def</span> <span class=\"n\">cLibTarget</span> <span class=\"o\">(</span><span class=\"n\">pkgDir</span> <span class=\"o\">:</span> <span class=\"n\">FilePath</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">FileTarget</span> <span class=\"o\">:=</span>\n  <span class=\"k\">let</span> <span class=\"n\">libFile</span> <span class=\"o\">:=</span> <span class=\"n\">pkgDir</span> <span class=\"bp\">/</span> <span class=\"n\">defaultBuildDir</span> <span class=\"bp\">/</span> <span class=\"n\">cppDir</span> <span class=\"bp\">/</span> <span class=\"s2\">\"libffi.a\"</span>\n  <span class=\"n\">staticLibTarget</span> <span class=\"n\">libFile</span> <span class=\"bp\">#</span><span class=\"o\">[</span><span class=\"n\">ffiOTarget</span> <span class=\"n\">pkgDir</span><span class=\"o\">]</span>\n\n<span class=\"n\">package</span> <span class=\"n\">LeanMySQL</span> <span class=\"o\">(</span><span class=\"n\">pkgDir</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n  <span class=\"n\">srcDir</span> <span class=\"o\">:=</span> <span class=\"s2\">\"lib\"</span>\n  <span class=\"n\">libRoots</span> <span class=\"o\">:=</span> <span class=\"bp\">#</span><span class=\"o\">[</span><span class=\"bp\">`</span><span class=\"n\">Ffi</span><span class=\"o\">]</span>\n  <span class=\"n\">moreLibTargets</span> <span class=\"o\">:=</span> <span class=\"bp\">#</span><span class=\"o\">[</span><span class=\"n\">cLibTarget</span> <span class=\"n\">pkgDir</span><span class=\"o\">]</span>\n  <span class=\"n\">moreLinkArgs</span> <span class=\"o\">:=</span> <span class=\"bp\">#</span><span class=\"o\">[</span><span class=\"n\">mySQLLinkArg</span><span class=\"o\">]</span>\n<span class=\"o\">}</span>\n</code></pre></div>",
        "id": 262241932,
        "sender_full_name": "Arthur Paulino",
        "timestamp": 1637503080
    }
]