[
    {
        "content": "<p>I'm trying to get started again with porting now that I'm back on my windows machine but I'm having real trouble getting aesop to build. I keep getting errors like this when viewing files in mathlib4 that depend on aesop:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"bp\">`</span><span class=\"n\">c</span><span class=\"o\">:</span><span class=\"bp\">\\</span><span class=\"n\">Users</span><span class=\"bp\">\\</span><span class=\"n\">skywi</span><span class=\"bp\">\\.</span><span class=\"n\">elan</span><span class=\"bp\">\\</span><span class=\"n\">toolchains</span><span class=\"bp\">\\</span><span class=\"n\">leanprover</span><span class=\"c1\">--lean4---nightly-2022-12-13\\bin\\lake.exe print-paths Init Mathlib.Data.Rat.Defs Mathlib.Algebra.Order.Ring.Defs` failed:</span>\n\n<span class=\"n\">stderr</span><span class=\"o\">:</span>\n<span class=\"n\">warning</span><span class=\"o\">:</span> <span class=\"n\">manifest</span> <span class=\"n\">out</span> <span class=\"n\">of</span> <span class=\"n\">date</span><span class=\"o\">:</span> <span class=\"n\">package</span> <span class=\"n\">directory</span> <span class=\"n\">changed</span><span class=\"o\">,</span> <span class=\"n\">use</span> <span class=\"bp\">`</span><span class=\"n\">lake</span> <span class=\"n\">update</span><span class=\"bp\">`</span> <span class=\"n\">to</span> <span class=\"n\">update</span>\n<span class=\"n\">warning</span><span class=\"o\">:</span> <span class=\"n\">wanted</span> <span class=\"n\">prebuilt</span> <span class=\"n\">release</span><span class=\"o\">,</span> <span class=\"n\">but</span> <span class=\"n\">release</span> <span class=\"n\">repository</span> <span class=\"n\">and</span> <span class=\"n\">tag</span> <span class=\"n\">was</span> <span class=\"n\">not</span> <span class=\"n\">known</span>\n<span class=\"n\">info</span><span class=\"o\">:</span> <span class=\"n\">Building</span> <span class=\"n\">Aesop.Constants</span>\n<span class=\"n\">info</span><span class=\"o\">:</span> <span class=\"n\">Building</span> <span class=\"n\">Aesop.Tracing</span>\n<span class=\"n\">info</span><span class=\"o\">:</span> <span class=\"n\">Building</span> <span class=\"n\">Aesop.Util.Basic</span>\n<span class=\"n\">error</span><span class=\"o\">:</span> <span class=\"bp\">&gt;</span> <span class=\"n\">LEAN_PATH</span><span class=\"bp\">=.\\</span><span class=\"n\">build</span><span class=\"bp\">\\</span><span class=\"n\">lib</span><span class=\"bp\">;.\\./</span><span class=\"n\">lake</span><span class=\"bp\">-</span><span class=\"n\">packages</span><span class=\"bp\">\\</span><span class=\"n\">Qq</span><span class=\"bp\">\\</span><span class=\"n\">build</span><span class=\"bp\">\\</span><span class=\"n\">lib</span><span class=\"bp\">;.\\./</span><span class=\"n\">lake</span><span class=\"bp\">-</span><span class=\"n\">packages</span><span class=\"bp\">\\</span><span class=\"n\">aesop</span><span class=\"bp\">\\</span><span class=\"n\">build</span><span class=\"bp\">\\</span><span class=\"n\">lib</span><span class=\"bp\">;.\\./</span><span class=\"n\">lake</span><span class=\"bp\">-</span><span class=\"n\">packages</span><span class=\"bp\">\\</span><span class=\"n\">std</span><span class=\"bp\">\\</span><span class=\"n\">build</span><span class=\"bp\">\\</span><span class=\"n\">lib</span> <span class=\"n\">PATH</span> <span class=\"n\">c</span><span class=\"o\">:</span><span class=\"bp\">\\</span><span class=\"n\">Users</span><span class=\"bp\">\\</span><span class=\"n\">skywi</span><span class=\"bp\">\\.</span><span class=\"n\">elan</span><span class=\"bp\">\\</span><span class=\"n\">toolchains</span><span class=\"bp\">\\</span><span class=\"n\">leanprover</span><span class=\"c1\">--lean4---nightly-2022-12-13\\bin\\lean.exe .\\./lake-packages\\aesop\\.\\.\\Aesop\\Util\\Basic.lean -R .\\./lake-packages\\aesop\\.\\. -o .\\./lake-packages\\aesop\\build\\lib\\Aesop\\Util\\Basic.olean -i .\\./lake-packages\\aesop\\build\\lib\\Aesop\\Util\\Basic.ilean -c .\\./lake-packages\\aesop\\build\\ir\\Aesop\\Util\\Basic.c --load-dynlib=Aesop-Nanos.dll --load-dynlib=Std-Classes-BEq.dll --load-dynlib=Std-Lean-Delaborator.dll --load-dynlib=Std-Tactic-CoeExt.dll --load-dynlib=Std-Util-LibraryNote.dll --load-dynlib=Std-Classes-Cast.dll --load-dynlib=Std-Classes-Dvd.dll --load-dynlib=Std-Tactic-Unreachable.dll --load-dynlib=Std-Linter-UnreachableTactic.dll --load-dynlib=Std-Lean-TagAttribute.dll --load-dynlib=Std-Lean-AttributeExtra.dll --load-dynlib=Std-Linter-UnnecessarySeqFocus.dll --load-dynlib=Std-Linter.dll --load-dynlib=Std-Tactic-OpenPrivate.dll --load-dynlib=Std-Tactic-NoMatch.dll --load-dynlib=Std-Tactic-GuardExpr.dll --load-dynlib=Std-Tactic-ByCases.dll --load-dynlib=Std-Tactic-SeqFocus.dll --load-dynlib=Std-Tactic-TryThis.dll --load-dynlib=Std-Tactic-ShowTerm.dll --load-dynlib=Std-Lean-Parser.dll --load-dynlib=Std-Tactic-SimpTrace.dll --load-dynlib=Std-Lean-Meta-Basic.dll --load-dynlib=Std-Lean-Tactic.dll --load-dynlib=Std-Tactic-Basic.dll --load-dynlib=Std-Util-TermUnsafe.dll --load-dynlib=Std-Lean-NameMapAttribute.dll --load-dynlib=Std-Tactic-Lint-Basic.dll --load-dynlib=Std-Data-List-Init-Lemmas.dll --load-dynlib=Std-Data-Array-Init-Basic.dll --load-dynlib=Std-Data-Array-Basic.dll --load-dynlib=Std-Tactic-Lint-Misc.dll --load-dynlib=Std-Logic.dll --load-dynlib=Std-Classes-LawfulMonad.dll --load-dynlib=Std-Lean-Meta-LCtx.dll --load-dynlib=Std-Tactic-Simpa.dll --load-dynlib=Std-Classes-Order.dll --load-dynlib=Std-Util-ExtendedBinder.dll --load-dynlib=Std-Classes-SetNotation.dll --load-dynlib=Std-Control-ForInStep-Basic.dll --load-dynlib=Std-Control-ForInStep-Lemmas.dll --load-dynlib=Std-Control-ForInStep.dll --load-dynlib=Std-Tactic-HaveI.dll --load-dynlib=Std-Data-Array-Init-Lemmas.dll --load-dynlib=Std-Data-Nat-Basic.dll --load-dynlib=Std-Data-Nat-Lemmas.dll --load-dynlib=Std-Data-Option-Init-Lemmas.dll --load-dynlib=Std-Data-List-Basic.dll --load-dynlib=Std-Data-Option-Basic.dll --load-dynlib=Std-Tactic-RCases.dll --load-dynlib=Std-Lean-Command.dll --load-dynlib=Std-Tactic-Ext-Attr.dll --load-dynlib=Std-Data-Option-Lemmas.dll --load-dynlib=Std-Tactic-Ext.dll --load-dynlib=Std-Data-List-Lemmas.dll --load-dynlib=Std-Data-Array-Lemmas.dll --load-dynlib=Std-Data-AssocList.dll --load-dynlib=Std-Data-BinomialHeap.dll --load-dynlib=Std-Data-Char.dll --load-dynlib=Std-Data-DList.dll --load-dynlib=Std-Data-Fin-Lemmas.dll --load-dynlib=Std-Data-HashMap-Basic.dll --load-dynlib=Std-Data-HashMap-WF.dll --load-dynlib=Std-Data-HashMap.dll --load-dynlib=Std-Data-Int-Basic.dll --load-dynlib=Std-Tactic-NormCast-Ext.dll --load-dynlib=Std-Tactic-NormCast-Lemmas.dll --load-dynlib=Std-Data-Int-Lemmas.dll --load-dynlib=Std-Data-Int-DivMod.dll --load-dynlib=Std-Data-Nat-Gcd.dll --load-dynlib=Std-Data-PairingHeap.dll --load-dynlib=Std-Data-RBMap-Basic.dll --load-dynlib=Std-Data-RBMap-WF.dll --load-dynlib=Std-Data-RBMap.dll --load-dynlib=Std-Data-RBMap-Alter.dll --load-dynlib=Std-Data-RBMap-Lemmas.dll --load-dynlib=Std-Data-Rat-Basic.dll --load-dynlib=Std-Data-Rat-Lemmas.dll --load-dynlib=Std-Data-Rat.dll --load-dynlib=Std-Data-String.dll --load-dynlib=Std-Lean-Expr.dll --load-dynlib=Std-Lean-Meta-AssertHypotheses.dll --load-dynlib=Std-Lean-Meta-Clear.dll --load-dynlib=Std-Lean-Meta-Inaccessible.dll --load-dynlib=Std-Lean-Meta-InstantiateMVars.dll --load-dynlib=Std-Lean-MonadBacktrack.dll --load-dynlib=Std-Lean-Meta-SavedState.dll --load-dynlib=Std-Lean-Meta-UnusedNames.dll --load-dynlib=Std-Tactic-Congr.dll --load-dynlib=Std-Tactic-Lint-Simp.dll --load-dynlib=Std-Tactic-Lint-TypeClass.dll --load-dynlib=Std-Tactic-Lint-Frontend.dll --load-dynlib=Std-Tactic-Lint.dll --load-dynlib=Std-Tactic-SqueezeScope.dll --load-dynlib=Std.dll --load-dynlib=Aesop-Util-UnionFind.dll</span>\n<span class=\"n\">error</span><span class=\"o\">:</span> <span class=\"n\">stderr</span><span class=\"o\">:</span>\n<span class=\"n\">libc</span><span class=\"bp\">++</span><span class=\"n\">abi</span><span class=\"o\">:</span> <span class=\"n\">terminating</span> <span class=\"n\">due</span> <span class=\"n\">to</span> <span class=\"n\">uncaught</span> <span class=\"n\">exception</span> <span class=\"n\">of</span> <span class=\"n\">type</span> <span class=\"n\">lean</span><span class=\"o\">::</span><span class=\"n\">exception</span><span class=\"o\">:</span> <span class=\"n\">error</span> <span class=\"n\">loading</span> <span class=\"n\">library</span> <span class=\"n\">Aesop</span><span class=\"bp\">-</span><span class=\"n\">Nanos.dll</span><span class=\"o\">:</span> <span class=\"mi\">126</span>\n<span class=\"n\">error</span><span class=\"o\">:</span> <span class=\"n\">external</span> <span class=\"n\">command</span> <span class=\"bp\">`</span><span class=\"n\">c</span><span class=\"o\">:</span><span class=\"bp\">\\</span><span class=\"n\">Users</span><span class=\"bp\">\\</span><span class=\"n\">skywi</span><span class=\"bp\">\\.</span><span class=\"n\">elan</span><span class=\"bp\">\\</span><span class=\"n\">toolchains</span><span class=\"bp\">\\</span><span class=\"n\">leanprover</span><span class=\"c1\">--lean4---nightly-2022-12-13\\bin\\lean.exe` exited with code 3221226505</span>\n<span class=\"n\">error</span><span class=\"o\">:</span> <span class=\"bp\">&gt;</span> <span class=\"n\">LEAN_PATH</span><span class=\"bp\">=.\\</span><span class=\"n\">build</span><span class=\"bp\">\\</span><span class=\"n\">lib</span><span class=\"bp\">;.\\./</span><span class=\"n\">lake</span><span class=\"bp\">-</span><span class=\"n\">packages</span><span class=\"bp\">\\</span><span class=\"n\">Qq</span><span class=\"bp\">\\</span><span class=\"n\">build</span><span class=\"bp\">\\</span><span class=\"n\">lib</span><span class=\"bp\">;.\\./</span><span class=\"n\">lake</span><span class=\"bp\">-</span><span class=\"n\">packages</span><span class=\"bp\">\\</span><span class=\"n\">aesop</span><span class=\"bp\">\\</span><span class=\"n\">build</span><span class=\"bp\">\\</span><span class=\"n\">lib</span><span class=\"bp\">;.\\./</span><span class=\"n\">lake</span><span class=\"bp\">-</span><span class=\"n\">packages</span><span class=\"bp\">\\</span><span class=\"n\">std</span><span class=\"bp\">\\</span><span class=\"n\">build</span><span class=\"bp\">\\</span><span class=\"n\">lib</span> <span class=\"n\">PATH</span> <span class=\"n\">c</span><span class=\"o\">:</span><span class=\"bp\">\\</span><span class=\"n\">Users</span><span class=\"bp\">\\</span><span class=\"n\">skywi</span><span class=\"bp\">\\.</span><span class=\"n\">elan</span><span class=\"bp\">\\</span><span class=\"n\">toolchains</span><span class=\"bp\">\\</span><span class=\"n\">leanprover</span><span class=\"c1\">--lean4---nightly-2022-12-13\\bin\\lean.exe .\\./lake-packages\\aesop\\.\\.\\Aesop\\Constants.lean -R .\\./lake-packages\\aesop\\.\\. -o .\\./lake-packages\\aesop\\build\\lib\\Aesop\\Constants.olean -i .\\./lake-packages\\aesop\\build\\lib\\Aesop\\Constants.ilean -c .\\./lake-packages\\aesop\\build\\ir\\Aesop\\Constants.c --load-dynlib=Aesop-Percent.dll</span>\n<span class=\"n\">error</span><span class=\"o\">:</span> <span class=\"n\">stderr</span><span class=\"o\">:</span>\n<span class=\"n\">libc</span><span class=\"bp\">++</span><span class=\"n\">abi</span><span class=\"o\">:</span> <span class=\"n\">terminating</span> <span class=\"n\">due</span> <span class=\"n\">to</span> <span class=\"n\">uncaught</span> <span class=\"n\">exception</span> <span class=\"n\">of</span> <span class=\"n\">type</span> <span class=\"n\">lean</span><span class=\"o\">::</span><span class=\"n\">exception</span><span class=\"o\">:</span> <span class=\"n\">error</span> <span class=\"n\">loading</span> <span class=\"n\">library</span> <span class=\"n\">Aesop</span><span class=\"bp\">-</span><span class=\"n\">Percent.dll</span><span class=\"o\">:</span> <span class=\"mi\">126</span>\n<span class=\"n\">error</span><span class=\"o\">:</span> <span class=\"n\">external</span> <span class=\"n\">command</span> <span class=\"bp\">`</span><span class=\"n\">c</span><span class=\"o\">:</span><span class=\"bp\">\\</span><span class=\"n\">Users</span><span class=\"bp\">\\</span><span class=\"n\">skywi</span><span class=\"bp\">\\.</span><span class=\"n\">elan</span><span class=\"bp\">\\</span><span class=\"n\">toolchains</span><span class=\"bp\">\\</span><span class=\"n\">leanprover</span><span class=\"c1\">--lean4---nightly-2022-12-13\\bin\\lean.exe` exited with code 3221226505</span>\n<span class=\"n\">error</span><span class=\"o\">:</span> <span class=\"bp\">&gt;</span> <span class=\"n\">LEAN_PATH</span><span class=\"bp\">=.\\</span><span class=\"n\">build</span><span class=\"bp\">\\</span><span class=\"n\">lib</span><span class=\"bp\">;.\\./</span><span class=\"n\">lake</span><span class=\"bp\">-</span><span class=\"n\">packages</span><span class=\"bp\">\\</span><span class=\"n\">Qq</span><span class=\"bp\">\\</span><span class=\"n\">build</span><span class=\"bp\">\\</span><span class=\"n\">lib</span><span class=\"bp\">;.\\./</span><span class=\"n\">lake</span><span class=\"bp\">-</span><span class=\"n\">packages</span><span class=\"bp\">\\</span><span class=\"n\">aesop</span><span class=\"bp\">\\</span><span class=\"n\">build</span><span class=\"bp\">\\</span><span class=\"n\">lib</span><span class=\"bp\">;.\\./</span><span class=\"n\">lake</span><span class=\"bp\">-</span><span class=\"n\">packages</span><span class=\"bp\">\\</span><span class=\"n\">std</span><span class=\"bp\">\\</span><span class=\"n\">build</span><span class=\"bp\">\\</span><span class=\"n\">lib</span> <span class=\"n\">PATH</span> <span class=\"n\">c</span><span class=\"o\">:</span><span class=\"bp\">\\</span><span class=\"n\">Users</span><span class=\"bp\">\\</span><span class=\"n\">skywi</span><span class=\"bp\">\\.</span><span class=\"n\">elan</span><span class=\"bp\">\\</span><span class=\"n\">toolchains</span><span class=\"bp\">\\</span><span class=\"n\">leanprover</span><span class=\"c1\">--lean4---nightly-2022-12-13\\bin\\lean.exe .\\./lake-packages\\aesop\\.\\.\\Aesop\\Tracing.lean -R .\\./lake-packages\\aesop\\.\\. -o .\\./lake-packages\\aesop\\build\\lib\\Aesop\\Tracing.olean -i .\\./lake-packages\\aesop\\build\\lib\\Aesop\\Tracing.ilean -c .\\./lake-packages\\aesop\\build\\ir\\Aesop\\Tracing.c --load-dynlib=Aesop-Tracing-Init.dll</span>\n<span class=\"n\">error</span><span class=\"o\">:</span> <span class=\"n\">stderr</span><span class=\"o\">:</span>\n<span class=\"n\">libc</span><span class=\"bp\">++</span><span class=\"n\">abi</span><span class=\"o\">:</span> <span class=\"n\">terminating</span> <span class=\"n\">due</span> <span class=\"n\">to</span> <span class=\"n\">uncaught</span> <span class=\"n\">exception</span> <span class=\"n\">of</span> <span class=\"n\">type</span> <span class=\"n\">lean</span><span class=\"o\">::</span><span class=\"n\">exception</span><span class=\"o\">:</span> <span class=\"n\">error</span> <span class=\"n\">loading</span> <span class=\"n\">library</span> <span class=\"n\">Aesop</span><span class=\"bp\">-</span><span class=\"n\">Tracing</span><span class=\"bp\">-</span><span class=\"n\">Init.dll</span><span class=\"o\">:</span> <span class=\"mi\">126</span>\n<span class=\"n\">error</span><span class=\"o\">:</span> <span class=\"n\">external</span> <span class=\"n\">command</span> <span class=\"bp\">`</span><span class=\"n\">c</span><span class=\"o\">:</span><span class=\"bp\">\\</span><span class=\"n\">Users</span><span class=\"bp\">\\</span><span class=\"n\">skywi</span><span class=\"bp\">\\.</span><span class=\"n\">elan</span><span class=\"bp\">\\</span><span class=\"n\">toolchains</span><span class=\"bp\">\\</span><span class=\"n\">leanprover</span><span class=\"c1\">--lean4---nightly-2022-12-13\\bin\\lean.exe` exited with code 3221226505</span>\n</code></pre></div>\n<p>Running <code>lake build</code> gives a similar error:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"n\">error</span><span class=\"o\">:</span> <span class=\"bp\">&gt;</span> <span class=\"n\">LEAN_PATH</span><span class=\"bp\">=.\\</span><span class=\"n\">build</span><span class=\"bp\">\\</span><span class=\"n\">lib</span><span class=\"bp\">;.\\./</span><span class=\"n\">lake</span><span class=\"bp\">-</span><span class=\"n\">packages</span><span class=\"bp\">\\</span><span class=\"n\">Qq</span><span class=\"bp\">\\</span><span class=\"n\">build</span><span class=\"bp\">\\</span><span class=\"n\">lib</span><span class=\"bp\">;.\\./</span><span class=\"n\">lake</span><span class=\"bp\">-</span><span class=\"n\">packages</span><span class=\"bp\">\\</span><span class=\"n\">aesop</span><span class=\"bp\">\\</span><span class=\"n\">build</span><span class=\"bp\">\\</span><span class=\"n\">lib</span><span class=\"bp\">;.\\./</span><span class=\"n\">lake</span><span class=\"bp\">-</span><span class=\"n\">packages</span><span class=\"bp\">\\</span><span class=\"n\">std</span><span class=\"bp\">\\</span><span class=\"n\">build</span><span class=\"bp\">\\</span><span class=\"n\">lib</span> <span class=\"n\">PATH</span> <span class=\"n\">c</span><span class=\"o\">:</span><span class=\"bp\">\\</span><span class=\"n\">Users</span><span class=\"bp\">\\</span><span class=\"n\">skywi</span><span class=\"bp\">\\.</span><span class=\"n\">elan</span><span class=\"bp\">\\</span><span class=\"n\">toolchains</span><span class=\"bp\">\\</span><span class=\"n\">leanprover</span><span class=\"c1\">--lean4---nightly-2022-12-13\\bin\\lean.exe .\\./lake-packages\\aesop\\.\\.\\Aesop\\Constants.lean -R .\\./lake-packages\\aesop\\.\\. -o .\\./lake-packages\\aesop\\build\\lib\\Aesop\\Constants.olean -i .\\./lake-packages\\aesop\\build\\lib\\Aesop\\Constants.ilean -c .\\./lake-packages\\aesop\\build\\ir\\Aesop\\Constants.c --load-dynlib=Aesop-Percent.dll</span>\n<span class=\"n\">error</span><span class=\"o\">:</span> <span class=\"n\">stderr</span><span class=\"o\">:</span>\n<span class=\"n\">libc</span><span class=\"bp\">++</span><span class=\"n\">abi</span><span class=\"o\">:</span> <span class=\"n\">terminating</span> <span class=\"n\">due</span> <span class=\"n\">to</span> <span class=\"n\">uncaught</span> <span class=\"n\">exception</span> <span class=\"n\">of</span> <span class=\"n\">type</span> <span class=\"n\">lean</span><span class=\"o\">::</span><span class=\"n\">exception</span><span class=\"o\">:</span> <span class=\"n\">error</span> <span class=\"n\">loading</span> <span class=\"n\">library</span> <span class=\"n\">Aesop</span><span class=\"bp\">-</span><span class=\"n\">Percent.dll</span><span class=\"o\">:</span> <span class=\"mi\">126</span>\n<span class=\"n\">error</span><span class=\"o\">:</span> <span class=\"n\">external</span> <span class=\"n\">command</span> <span class=\"bp\">`</span><span class=\"n\">c</span><span class=\"o\">:</span><span class=\"bp\">\\</span><span class=\"n\">Users</span><span class=\"bp\">\\</span><span class=\"n\">skywi</span><span class=\"bp\">\\.</span><span class=\"n\">elan</span><span class=\"bp\">\\</span><span class=\"n\">toolchains</span><span class=\"bp\">\\</span><span class=\"n\">leanprover</span><span class=\"c1\">--lean4---nightly-2022-12-13\\bin\\lean.exe` exited with code 3221226505</span>\n</code></pre></div>",
        "id": 316512297,
        "sender_full_name": "Sky Wilshaw",
        "timestamp": 1671312480
    },
    {
        "content": "<p>update your <code>lean-toolchain</code> to match mathlib/aesop</p>",
        "id": 316512400,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1671312536
    },
    {
        "content": "<p>Ah, I'm not on master so perhaps the toolchain in this branch is old.</p>",
        "id": 316512483,
        "sender_full_name": "Sky Wilshaw",
        "timestamp": 1671312603
    },
    {
        "content": "<p>you should also try deleting the <code>lake-packages</code> directory, it might be using incompatible build data</p>",
        "id": 316512616,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1671312663
    },
    {
        "content": "<p>I'd also run <code>lake clean</code>, presumably it does the same thing. Currently waiting for it to try building with the <code>lean-toolchain</code> from master, hopefully this works...</p>",
        "id": 316512669,
        "sender_full_name": "Sky Wilshaw",
        "timestamp": 1671312694
    },
    {
        "content": "<p>Unfortunately this still doesn't work. This error is from <code>CategoryTheory.NatIso</code> (just because it uses aesop) on current <code>master</code>, after a <code>lake clean</code>:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"bp\">`</span><span class=\"n\">c</span><span class=\"o\">:</span><span class=\"bp\">\\</span><span class=\"n\">Users</span><span class=\"bp\">\\</span><span class=\"n\">skywi</span><span class=\"bp\">\\.</span><span class=\"n\">elan</span><span class=\"bp\">\\</span><span class=\"n\">toolchains</span><span class=\"bp\">\\</span><span class=\"n\">leanprover</span><span class=\"c1\">--lean4---nightly-2022-12-13\\bin\\lake.exe print-paths Init Mathlib.CategoryTheory.Functor.Category Mathlib.CategoryTheory.Iso` failed:</span>\n\n<span class=\"n\">stderr</span><span class=\"o\">:</span>\n<span class=\"n\">warning</span><span class=\"o\">:</span> <span class=\"n\">manifest</span> <span class=\"n\">out</span> <span class=\"n\">of</span> <span class=\"n\">date</span><span class=\"o\">:</span> <span class=\"n\">package</span> <span class=\"n\">directory</span> <span class=\"n\">changed</span><span class=\"o\">,</span> <span class=\"n\">use</span> <span class=\"bp\">`</span><span class=\"n\">lake</span> <span class=\"n\">update</span><span class=\"bp\">`</span> <span class=\"n\">to</span> <span class=\"n\">update</span>\n<span class=\"n\">warning</span><span class=\"o\">:</span> <span class=\"n\">wanted</span> <span class=\"n\">prebuilt</span> <span class=\"n\">release</span><span class=\"o\">,</span> <span class=\"n\">but</span> <span class=\"n\">release</span> <span class=\"n\">repository</span> <span class=\"n\">and</span> <span class=\"n\">tag</span> <span class=\"n\">was</span> <span class=\"n\">not</span> <span class=\"n\">known</span>\n<span class=\"n\">info</span><span class=\"o\">:</span> <span class=\"n\">Building</span> <span class=\"n\">Aesop.Constants</span>\n<span class=\"n\">info</span><span class=\"o\">:</span> <span class=\"n\">Building</span> <span class=\"n\">Aesop.Tracing</span>\n<span class=\"n\">info</span><span class=\"o\">:</span> <span class=\"n\">Building</span> <span class=\"n\">Mathlib.Combinatorics.Quiver.Basic</span>\n<span class=\"n\">info</span><span class=\"o\">:</span> <span class=\"n\">Linking</span> <span class=\"n\">Std.Data.HashMap</span>\n<span class=\"n\">info</span><span class=\"o\">:</span> <span class=\"n\">Linking</span> <span class=\"n\">Std</span>\n<span class=\"n\">info</span><span class=\"o\">:</span> <span class=\"n\">Linking</span> <span class=\"n\">Aesop.Util.UnionFind</span>\n<span class=\"n\">info</span><span class=\"o\">:</span> <span class=\"n\">Building</span> <span class=\"n\">Aesop.Util.Basic</span>\n<span class=\"n\">error</span><span class=\"o\">:</span> <span class=\"bp\">&gt;</span> <span class=\"n\">LEAN_PATH</span><span class=\"bp\">=.\\</span><span class=\"n\">build</span><span class=\"bp\">\\</span><span class=\"n\">lib</span><span class=\"bp\">;.\\./</span><span class=\"n\">lake</span><span class=\"bp\">-</span><span class=\"n\">packages</span><span class=\"bp\">\\</span><span class=\"n\">Qq</span><span class=\"bp\">\\</span><span class=\"n\">build</span><span class=\"bp\">\\</span><span class=\"n\">lib</span><span class=\"bp\">;.\\./</span><span class=\"n\">lake</span><span class=\"bp\">-</span><span class=\"n\">packages</span><span class=\"bp\">\\</span><span class=\"n\">aesop</span><span class=\"bp\">\\</span><span class=\"n\">build</span><span class=\"bp\">\\</span><span class=\"n\">lib</span><span class=\"bp\">;.\\./</span><span class=\"n\">lake</span><span class=\"bp\">-</span><span class=\"n\">packages</span><span class=\"bp\">\\</span><span class=\"n\">std</span><span class=\"bp\">\\</span><span class=\"n\">build</span><span class=\"bp\">\\</span><span class=\"n\">lib</span> <span class=\"n\">PATH</span> <span class=\"n\">c</span><span class=\"o\">:</span><span class=\"bp\">\\</span><span class=\"n\">Users</span><span class=\"bp\">\\</span><span class=\"n\">skywi</span><span class=\"bp\">\\.</span><span class=\"n\">elan</span><span class=\"bp\">\\</span><span class=\"n\">toolchains</span><span class=\"bp\">\\</span><span class=\"n\">leanprover</span><span class=\"c1\">--lean4---nightly-2022-12-13\\bin\\lean.exe .\\./lake-packages\\aesop\\.\\.\\Aesop\\Tracing.lean -R .\\./lake-packages\\aesop\\.\\. -o .\\./lake-packages\\aesop\\build\\lib\\Aesop\\Tracing.olean -i .\\./lake-packages\\aesop\\build\\lib\\Aesop\\Tracing.ilean -c .\\./lake-packages\\aesop\\build\\ir\\Aesop\\Tracing.c --load-dynlib=Aesop-Tracing-Init.dll</span>\n<span class=\"n\">error</span><span class=\"o\">:</span> <span class=\"n\">stderr</span><span class=\"o\">:</span>\n<span class=\"n\">libc</span><span class=\"bp\">++</span><span class=\"n\">abi</span><span class=\"o\">:</span> <span class=\"n\">terminating</span> <span class=\"n\">due</span> <span class=\"n\">to</span> <span class=\"n\">uncaught</span> <span class=\"n\">exception</span> <span class=\"n\">of</span> <span class=\"n\">type</span> <span class=\"n\">lean</span><span class=\"o\">::</span><span class=\"n\">exception</span><span class=\"o\">:</span> <span class=\"n\">error</span> <span class=\"n\">loading</span> <span class=\"n\">library</span> <span class=\"n\">Aesop</span><span class=\"bp\">-</span><span class=\"n\">Tracing</span><span class=\"bp\">-</span><span class=\"n\">Init.dll</span><span class=\"o\">:</span> <span class=\"mi\">126</span>\n<span class=\"n\">error</span><span class=\"o\">:</span> <span class=\"n\">external</span> <span class=\"n\">command</span> <span class=\"bp\">`</span><span class=\"n\">c</span><span class=\"o\">:</span><span class=\"bp\">\\</span><span class=\"n\">Users</span><span class=\"bp\">\\</span><span class=\"n\">skywi</span><span class=\"bp\">\\.</span><span class=\"n\">elan</span><span class=\"bp\">\\</span><span class=\"n\">toolchains</span><span class=\"bp\">\\</span><span class=\"n\">leanprover</span><span class=\"c1\">--lean4---nightly-2022-12-13\\bin\\lean.exe` exited with code 3221226505</span>\n<span class=\"n\">error</span><span class=\"o\">:</span> <span class=\"bp\">&gt;</span> <span class=\"n\">LEAN_PATH</span><span class=\"bp\">=.\\</span><span class=\"n\">build</span><span class=\"bp\">\\</span><span class=\"n\">lib</span><span class=\"bp\">;.\\./</span><span class=\"n\">lake</span><span class=\"bp\">-</span><span class=\"n\">packages</span><span class=\"bp\">\\</span><span class=\"n\">Qq</span><span class=\"bp\">\\</span><span class=\"n\">build</span><span class=\"bp\">\\</span><span class=\"n\">lib</span><span class=\"bp\">;.\\./</span><span class=\"n\">lake</span><span class=\"bp\">-</span><span class=\"n\">packages</span><span class=\"bp\">\\</span><span class=\"n\">aesop</span><span class=\"bp\">\\</span><span class=\"n\">build</span><span class=\"bp\">\\</span><span class=\"n\">lib</span><span class=\"bp\">;.\\./</span><span class=\"n\">lake</span><span class=\"bp\">-</span><span class=\"n\">packages</span><span class=\"bp\">\\</span><span class=\"n\">std</span><span class=\"bp\">\\</span><span class=\"n\">build</span><span class=\"bp\">\\</span><span class=\"n\">lib</span> <span class=\"n\">PATH</span> <span class=\"n\">c</span><span class=\"o\">:</span><span class=\"bp\">\\</span><span class=\"n\">Users</span><span class=\"bp\">\\</span><span class=\"n\">skywi</span><span class=\"bp\">\\.</span><span class=\"n\">elan</span><span class=\"bp\">\\</span><span class=\"n\">toolchains</span><span class=\"bp\">\\</span><span class=\"n\">leanprover</span><span class=\"c1\">--lean4---nightly-2022-12-13\\bin\\lean.exe .\\./lake-packages\\aesop\\.\\.\\Aesop\\Constants.lean -R .\\./lake-packages\\aesop\\.\\. -o .\\./lake-packages\\aesop\\build\\lib\\Aesop\\Constants.olean -i .\\./lake-packages\\aesop\\build\\lib\\Aesop\\Constants.ilean -c .\\./lake-packages\\aesop\\build\\ir\\Aesop\\Constants.c --load-dynlib=Aesop-Percent.dll</span>\n<span class=\"n\">error</span><span class=\"o\">:</span> <span class=\"n\">stderr</span><span class=\"o\">:</span>\n<span class=\"n\">libc</span><span class=\"bp\">++</span><span class=\"n\">abi</span><span class=\"o\">:</span> <span class=\"n\">terminating</span> <span class=\"n\">due</span> <span class=\"n\">to</span> <span class=\"n\">uncaught</span> <span class=\"n\">exception</span> <span class=\"n\">of</span> <span class=\"n\">type</span> <span class=\"n\">lean</span><span class=\"o\">::</span><span class=\"n\">exception</span><span class=\"o\">:</span> <span class=\"n\">error</span> <span class=\"n\">loading</span> <span class=\"n\">library</span> <span class=\"n\">Aesop</span><span class=\"bp\">-</span><span class=\"n\">Percent.dll</span><span class=\"o\">:</span> <span class=\"mi\">126</span>\n<span class=\"n\">error</span><span class=\"o\">:</span> <span class=\"n\">external</span> <span class=\"n\">command</span> <span class=\"bp\">`</span><span class=\"n\">c</span><span class=\"o\">:</span><span class=\"bp\">\\</span><span class=\"n\">Users</span><span class=\"bp\">\\</span><span class=\"n\">skywi</span><span class=\"bp\">\\.</span><span class=\"n\">elan</span><span class=\"bp\">\\</span><span class=\"n\">toolchains</span><span class=\"bp\">\\</span><span class=\"n\">leanprover</span><span class=\"c1\">--lean4---nightly-2022-12-13\\bin\\lean.exe` exited with code 3221226505</span>\n<span class=\"n\">error</span><span class=\"o\">:</span> <span class=\"bp\">&gt;</span> <span class=\"n\">LEAN_PATH</span><span class=\"bp\">=.\\</span><span class=\"n\">build</span><span class=\"bp\">\\</span><span class=\"n\">lib</span><span class=\"bp\">;.\\./</span><span class=\"n\">lake</span><span class=\"bp\">-</span><span class=\"n\">packages</span><span class=\"bp\">\\</span><span class=\"n\">Qq</span><span class=\"bp\">\\</span><span class=\"n\">build</span><span class=\"bp\">\\</span><span class=\"n\">lib</span><span class=\"bp\">;.\\./</span><span class=\"n\">lake</span><span class=\"bp\">-</span><span class=\"n\">packages</span><span class=\"bp\">\\</span><span class=\"n\">aesop</span><span class=\"bp\">\\</span><span class=\"n\">build</span><span class=\"bp\">\\</span><span class=\"n\">lib</span><span class=\"bp\">;.\\./</span><span class=\"n\">lake</span><span class=\"bp\">-</span><span class=\"n\">packages</span><span class=\"bp\">\\</span><span class=\"n\">std</span><span class=\"bp\">\\</span><span class=\"n\">build</span><span class=\"bp\">\\</span><span class=\"n\">lib</span> <span class=\"n\">PATH</span> <span class=\"n\">c</span><span class=\"o\">:</span><span class=\"bp\">\\</span><span class=\"n\">Users</span><span class=\"bp\">\\</span><span class=\"n\">skywi</span><span class=\"bp\">\\.</span><span class=\"n\">elan</span><span class=\"bp\">\\</span><span class=\"n\">toolchains</span><span class=\"bp\">\\</span><span class=\"n\">leanprover</span><span class=\"c1\">--lean4---nightly-2022-12-13\\bin\\lean.exe .\\./lake-packages\\aesop\\.\\.\\Aesop\\Util\\Basic.lean -R .\\./lake-packages\\aesop\\.\\. -o .\\./lake-packages\\aesop\\build\\lib\\Aesop\\Util\\Basic.olean -i .\\./lake-packages\\aesop\\build\\lib\\Aesop\\Util\\Basic.ilean -c .\\./lake-packages\\aesop\\build\\ir\\Aesop\\Util\\Basic.c --load-dynlib=Aesop-Nanos.dll --load-dynlib=Std-Classes-BEq.dll --load-dynlib=Std-Lean-Delaborator.dll --load-dynlib=Std-Tactic-CoeExt.dll --load-dynlib=Std-Util-LibraryNote.dll --load-dynlib=Std-Classes-Cast.dll --load-dynlib=Std-Classes-Dvd.dll --load-dynlib=Std-Tactic-Unreachable.dll --load-dynlib=Std-Linter-UnreachableTactic.dll --load-dynlib=Std-Lean-TagAttribute.dll --load-dynlib=Std-Lean-AttributeExtra.dll --load-dynlib=Std-Linter-UnnecessarySeqFocus.dll --load-dynlib=Std-Linter.dll --load-dynlib=Std-Tactic-OpenPrivate.dll --load-dynlib=Std-Tactic-NoMatch.dll --load-dynlib=Std-Tactic-GuardExpr.dll --load-dynlib=Std-Tactic-ByCases.dll --load-dynlib=Std-Tactic-SeqFocus.dll --load-dynlib=Std-Tactic-TryThis.dll --load-dynlib=Std-Tactic-ShowTerm.dll --load-dynlib=Std-Lean-Parser.dll --load-dynlib=Std-Tactic-SimpTrace.dll --load-dynlib=Std-Lean-Meta-Basic.dll --load-dynlib=Std-Lean-Tactic.dll --load-dynlib=Std-Tactic-Basic.dll --load-dynlib=Std-Util-TermUnsafe.dll --load-dynlib=Std-Lean-NameMapAttribute.dll --load-dynlib=Std-Tactic-Lint-Basic.dll --load-dynlib=Std-Data-List-Init-Lemmas.dll --load-dynlib=Std-Data-Array-Init-Basic.dll --load-dynlib=Std-Data-Array-Basic.dll --load-dynlib=Std-Tactic-Lint-Misc.dll --load-dynlib=Std-Logic.dll --load-dynlib=Std-Classes-LawfulMonad.dll --load-dynlib=Std-Lean-Meta-LCtx.dll --load-dynlib=Std-Tactic-Simpa.dll --load-dynlib=Std-Classes-Order.dll --load-dynlib=Std-Util-ExtendedBinder.dll --load-dynlib=Std-Classes-SetNotation.dll --load-dynlib=Std-Control-ForInStep-Basic.dll --load-dynlib=Std-Control-ForInStep-Lemmas.dll --load-dynlib=Std-Control-ForInStep.dll --load-dynlib=Std-Tactic-HaveI.dll --load-dynlib=Std-Data-Array-Init-Lemmas.dll --load-dynlib=Std-Data-Nat-Basic.dll --load-dynlib=Std-Data-Nat-Lemmas.dll --load-dynlib=Std-Data-Option-Init-Lemmas.dll --load-dynlib=Std-Data-List-Basic.dll --load-dynlib=Std-Data-Option-Basic.dll --load-dynlib=Std-Tactic-RCases.dll --load-dynlib=Std-Lean-Command.dll --load-dynlib=Std-Tactic-Ext-Attr.dll --load-dynlib=Std-Data-Option-Lemmas.dll --load-dynlib=Std-Tactic-Ext.dll --load-dynlib=Std-Data-List-Lemmas.dll --load-dynlib=Std-Data-Array-Lemmas.dll --load-dynlib=Std-Data-AssocList.dll --load-dynlib=Std-Data-BinomialHeap.dll --load-dynlib=Std-Data-Char.dll --load-dynlib=Std-Data-DList.dll --load-dynlib=Std-Data-Fin-Lemmas.dll --load-dynlib=Std-Data-HashMap-Basic.dll --load-dynlib=Std-Data-HashMap-WF.dll --load-dynlib=Std-Data-HashMap.dll --load-dynlib=Std-Data-Int-Basic.dll --load-dynlib=Std-Tactic-NormCast-Ext.dll --load-dynlib=Std-Tactic-NormCast-Lemmas.dll --load-dynlib=Std-Data-Int-Lemmas.dll --load-dynlib=Std-Data-Int-DivMod.dll --load-dynlib=Std-Data-Nat-Gcd.dll --load-dynlib=Std-Data-PairingHeap.dll --load-dynlib=Std-Data-RBMap-Basic.dll --load-dynlib=Std-Data-RBMap-WF.dll --load-dynlib=Std-Data-RBMap.dll --load-dynlib=Std-Data-RBMap-Alter.dll --load-dynlib=Std-Data-RBMap-Lemmas.dll --load-dynlib=Std-Data-Rat-Basic.dll --load-dynlib=Std-Data-Rat-Lemmas.dll --load-dynlib=Std-Data-Rat.dll --load-dynlib=Std-Data-String.dll --load-dynlib=Std-Lean-Expr.dll --load-dynlib=Std-Lean-Meta-AssertHypotheses.dll --load-dynlib=Std-Lean-Meta-Clear.dll --load-dynlib=Std-Lean-Meta-Inaccessible.dll --load-dynlib=Std-Lean-Meta-InstantiateMVars.dll --load-dynlib=Std-Lean-MonadBacktrack.dll --load-dynlib=Std-Lean-Meta-SavedState.dll --load-dynlib=Std-Lean-Meta-UnusedNames.dll --load-dynlib=Std-Tactic-Congr.dll --load-dynlib=Std-Tactic-Lint-Simp.dll --load-dynlib=Std-Tactic-Lint-TypeClass.dll --load-dynlib=Std-Tactic-Lint-Frontend.dll --load-dynlib=Std-Tactic-Lint.dll --load-dynlib=Std-Tactic-SqueezeScope.dll --load-dynlib=Std.dll --load-dynlib=Aesop-Util-UnionFind.dll</span>\n<span class=\"n\">error</span><span class=\"o\">:</span> <span class=\"n\">stderr</span><span class=\"o\">:</span>\n<span class=\"n\">libc</span><span class=\"bp\">++</span><span class=\"n\">abi</span><span class=\"o\">:</span> <span class=\"n\">terminating</span> <span class=\"n\">due</span> <span class=\"n\">to</span> <span class=\"n\">uncaught</span> <span class=\"n\">exception</span> <span class=\"n\">of</span> <span class=\"n\">type</span> <span class=\"n\">lean</span><span class=\"o\">::</span><span class=\"n\">exception</span><span class=\"o\">:</span> <span class=\"n\">error</span> <span class=\"n\">loading</span> <span class=\"n\">library</span> <span class=\"n\">Aesop</span><span class=\"bp\">-</span><span class=\"n\">Nanos.dll</span><span class=\"o\">:</span> <span class=\"mi\">126</span>\n<span class=\"n\">error</span><span class=\"o\">:</span> <span class=\"n\">external</span> <span class=\"n\">command</span> <span class=\"bp\">`</span><span class=\"n\">c</span><span class=\"o\">:</span><span class=\"bp\">\\</span><span class=\"n\">Users</span><span class=\"bp\">\\</span><span class=\"n\">skywi</span><span class=\"bp\">\\.</span><span class=\"n\">elan</span><span class=\"bp\">\\</span><span class=\"n\">toolchains</span><span class=\"bp\">\\</span><span class=\"n\">leanprover</span><span class=\"c1\">--lean4---nightly-2022-12-13\\bin\\lean.exe` exited with code 3221226505</span>\n</code></pre></div>",
        "id": 316513730,
        "sender_full_name": "Sky Wilshaw",
        "timestamp": 1671313451
    },
    {
        "content": "<p>Someone reported a similar issue in <a href=\"https://github.com/JLimperg/aesop/pull/33\">JLimperg/aesop#33</a>. No idea what causes it I'm afraid.</p>",
        "id": 316519471,
        "sender_full_name": "Jannis Limperg",
        "timestamp": 1671317768
    },
    {
        "content": "<p>Also, <a href=\"#narrow/stream/270676-lean4/topic/Error.20loading.20library.20126.20when.20building\">https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Error.20loading.20library.20126.20when.20building</a></p>",
        "id": 316520139,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1671318264
    },
    {
        "content": "<p>Ah, that's unfortunate. I may be unable to contribute until this bug gets fixed, I'm pretty much stuck working on Windows for now.</p>",
        "id": 316520315,
        "sender_full_name": "Sky Wilshaw",
        "timestamp": 1671318415
    },
    {
        "content": "<p>Maybe we should disable precompiled modules in aesop for now?  (That is, until the bug is fixed.)</p>",
        "id": 316529638,
        "sender_full_name": "Gabriel Ebner",
        "timestamp": 1671325899
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110043\">Gabriel Ebner</span> <a href=\"#narrow/stream/270676-lean4/topic/error.20loading.20library.20Aesop-Nanos.2Edll/near/316529638\">said</a>:</p>\n<blockquote>\n<p>Maybe we should disable precompiled modules in aesop for now?  (That is, until the bug is fixed.)</p>\n</blockquote>\n<p>Good idea, done.</p>",
        "id": 316767700,
        "sender_full_name": "Jannis Limperg",
        "timestamp": 1671463246
    },
    {
        "content": "<p>Thank you, I'm now able to compile mathlib!</p>",
        "id": 317059880,
        "sender_full_name": "Sky Wilshaw",
        "timestamp": 1671579298
    },
    {
        "content": "<p>Is this being tracked somewhere? I'd like to follow it <span aria-label=\"eyes\" class=\"emoji emoji-1f440\" role=\"img\" title=\"eyes\">:eyes:</span> <br>\nI've been hit by this issue when importing a <a href=\"https://github.com/yatima-inc/YatimaStdLib.lean/blob/704823e421b333ea9960347e305c60f654618422/lakefile.lean#L7-L9\">different package</a></p>",
        "id": 320669491,
        "sender_full_name": "Arthur Paulino",
        "timestamp": 1673434813
    },
    {
        "content": "<p>Please open a Lake issue, I don't there is one yet</p>",
        "id": 320678077,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1673437271
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover/lake/issues/146\">https://github.com/leanprover/lake/issues/146</a></p>",
        "id": 320680797,
        "sender_full_name": "Arthur Paulino",
        "timestamp": 1673437693
    },
    {
        "content": "<p>So I was debugging this issue and found some interesting behavior. Passing the library name to <code>--load-dynlib</code> and augmenting the environment  library path works to build modules every EXCEPT from within the Lean server for some reason (at least on Windows). I even verified the  environment path from <code>lake print-paths</code> on the terminal and <code>lake print-paths</code> in the server are the same and it still did not work.</p>\n<p>To fix this, I am providing the full library path to <code>--load-dynlib</code>. This does mean we are likely to run into command line length limit sooner though.</p>",
        "id": 320797271,
        "sender_full_name": "Mac",
        "timestamp": 1673471084
    },
    {
        "content": "<p>I'm not sure what you mean by environment path. There is no shared object search path in <code>print-paths</code>, is there? It's just immediate file names.</p>",
        "id": 320799037,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1673471773
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"110024\">@Sebastian Ullrich</span> When Lake builds modules in <code>print-paths</code> it augments the environment of the <code>lean</code> command. One thing it does is add the directories of shared libraries (e.g. <code>build.lib</code>) tot the platform-specific shared library path environment variable (e.g., <code>LD_LIBRARY_PATH</code> on Linux, <code>PATH</code> on Windows). This allowed it to get away with using just <code>load-dynlib=Mod-Name.so</code> instead of <code>load-dynlib=build/lib/Mod-Name.so</code>. However, for some reason this does not work when run from the server (at least on Windows). It does work when <code>print-paths</code> is run directly from the command line though.</p>",
        "id": 320811707,
        "sender_full_name": "Mac",
        "timestamp": 1673477058
    },
    {
        "content": "<p>Another issue I just ran into is that Linux requires an augmented environment even if a full path is provided to <code>--load-dynlib</code> to load nested linked dynlibs  (MacOS and Windows allow nested libraries to be preloaded to avoid this check). This is a problem for external libraries  loaded by the server because we don't know the path of the library until the build completes and by thus we cannot ahead-of-time augment the Lean server's environment to include those paths.</p>",
        "id": 320811980,
        "sender_full_name": "Mac",
        "timestamp": 1673477188
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"315577\">Mac</span> <a href=\"#narrow/stream/270676-lean4/topic/error.20loading.20library.20Aesop-Nanos.2Edll/near/320811707\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"110024\">Sebastian Ullrich</span> When Lake builds modules in <code>print-paths</code> it augments the environment of the <code>lean</code> command.</p>\n</blockquote>\n<p>Are you thinking of <code>lake env</code>? There is no way for the current <code>print-paths</code> to affect the environment of the calling process, especially since changing the environment of a running process is Problematic anyway on certain platforms and thus not exposed in the IO API.</p>",
        "id": 320879813,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1673512939
    },
    {
        "content": "<blockquote>\n<p>However, for some reason this does not work when run from the server (at least on Windows).</p>\n</blockquote>\n<p>Did you check that the worker process has the expected <code>PATH</code>? I suppose there's also Dependency Walker, but I don't know if that's convenient to use in this multi-process scenario.</p>",
        "id": 320882770,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1673513364
    }
]