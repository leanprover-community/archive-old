[
    {
        "content": "<p>If you write <code>b + a</code> for <code>(a : α) (b : β)</code>,  Lean will try to synthesize <code>CoeHTCT α β</code> and <code>CoeHTCT β α</code>. Why is this happening? There is an <a href=\"#narrow/stream/270676-lean4/topic/heterogenous.20operators.20and.20coercions\">old thread</a> about this, but the problematic instances do not exist anymore.</p>\n<p>I'm asking this, because heterogenout operations fail if you add and instance of <code>Coe (Id α) α</code>.</p>\n<p>mwe</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kd\">instance</span> <span class=\"o\">:</span> <span class=\"n\">Coe</span> <span class=\"o\">(</span><span class=\"n\">Id</span> <span class=\"n\">α</span><span class=\"o\">)</span> <span class=\"n\">α</span> <span class=\"o\">:=</span> <span class=\"o\">⟨(</span><span class=\"bp\">λ</span> <span class=\"n\">x</span> <span class=\"bp\">=&gt;</span> <span class=\"n\">x</span><span class=\"o\">)⟩</span>\n\n<span class=\"kd\">variable</span> <span class=\"o\">{</span><span class=\"n\">α</span> <span class=\"n\">β</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span><span class=\"o\">}</span> <span class=\"o\">(</span><span class=\"n\">a</span> <span class=\"o\">:</span> <span class=\"n\">α</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">b</span> <span class=\"o\">:</span> <span class=\"n\">β</span><span class=\"o\">)</span> <span class=\"o\">[</span><span class=\"n\">HAdd</span> <span class=\"n\">β</span> <span class=\"n\">α</span> <span class=\"n\">α</span><span class=\"o\">]</span>\n\n<span class=\"kd\">set_option</span> <span class=\"n\">synthInstance.maxHeartbeats</span> <span class=\"mi\">150</span>\n<span class=\"kd\">set_option</span> <span class=\"n\">trace.Meta.synthInstance</span> <span class=\"n\">true</span>\n<span class=\"k\">#check</span> <span class=\"n\">b</span> <span class=\"bp\">+</span> <span class=\"n\">a</span>\n</code></pre></div>\n<p>The problem is resolved when you replace <code>Coe</code> with <code>CoeHead</code> or <code>CoeHTCT</code>, which one should be used?</p>",
        "id": 276677888,
        "sender_full_name": "Tomas Skrivan",
        "timestamp": 1648241772
    }
]