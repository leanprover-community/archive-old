[
    {
        "content": "<p>Hi,</p>\n<p>I often find myself in the situation that many useful tactics fail to work if there are dependent types involved:</p>\n<ul>\n<li><code>conv</code> refuses to select arguments if there are dependencies</li>\n<li><code>rw</code>, <code>generalize</code>, <code>cases</code> ... do not work either</li>\n</ul>\n<p>I understand why; if I just naively replace some expressions with some equal (but not defeq) expressions, some types which depend on it may not be definitional equal to what they are suppossed to be. In many cases, I manage to use dependent elimination, but not always.</p>\n<p>Consider the following simple example: I have a filtered list, and I want to prove that getting something out of the filtered list is the same as getting something (possible at a different index) from the original list:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kd\">theorem</span> <span class=\"n\">get_from_filtered</span> <span class=\"o\">{</span><span class=\"n\">T</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span> <span class=\"n\">u</span><span class=\"o\">}</span> <span class=\"o\">(</span><span class=\"n\">l</span> <span class=\"o\">:</span> <span class=\"n\">List</span> <span class=\"n\">T</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">pred</span> <span class=\"o\">:</span> <span class=\"n\">T</span> <span class=\"bp\">-&gt;</span> <span class=\"n\">Bool</span><span class=\"o\">)</span>\n  <span class=\"o\">(</span><span class=\"n\">idx</span> <span class=\"o\">:</span> <span class=\"n\">Fin</span> <span class=\"o\">(</span><span class=\"n\">l.filter</span> <span class=\"n\">pred</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">length</span><span class=\"o\">)</span>\n  <span class=\"o\">:</span> <span class=\"bp\">âˆƒ</span> <span class=\"n\">idx'</span> <span class=\"o\">:</span> <span class=\"n\">Fin</span> <span class=\"n\">l.length</span><span class=\"o\">,</span> <span class=\"o\">(</span><span class=\"n\">l.filter</span> <span class=\"n\">pred</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">get</span> <span class=\"n\">idx</span> <span class=\"bp\">=</span> <span class=\"n\">l.get</span> <span class=\"n\">idx'</span> <span class=\"o\">:=</span><span class=\"kd\">by</span>\n  <span class=\"n\">induction</span> <span class=\"n\">l</span>\n  <span class=\"bp\">.</span> <span class=\"k\">have</span> <span class=\"o\">:</span> <span class=\"n\">idx.val</span> <span class=\"bp\">&lt;</span> <span class=\"mi\">0</span> <span class=\"o\">:=</span><span class=\"n\">idx.isLt</span>\n    <span class=\"n\">contradiction</span>\n  <span class=\"bp\">.</span> <span class=\"n\">rename_i</span> <span class=\"n\">head</span> <span class=\"n\">tail</span> <span class=\"n\">IH</span>\n\n    <span class=\"n\">simp</span> <span class=\"n\">only</span> <span class=\"o\">[</span><span class=\"n\">List.filter</span><span class=\"o\">]</span>\n\n    <span class=\"c1\">-- how to continue from here?</span>\n    <span class=\"n\">cases</span> <span class=\"n\">pred</span> <span class=\"n\">head</span> <span class=\"c1\">-- does not work, result is not type correct</span>\n\n    <span class=\"gr\">sorry</span>\n</code></pre></div>\n<p>Intuitively, the rest of the proof is clear. For example, if <code>pred head</code> is false and <code>idx.val &gt; 0</code>, I can use the induction hypothesis.</p>\n<p>However, I fail to simplify <code>List.filter pred (head :: tail)</code> given the value of <code>pred head</code>.</p>\n<p>Do you have any tips how to continue here?</p>",
        "id": 304042828,
        "sender_full_name": "Jan-Mirko Otter",
        "timestamp": 1665757192
    }
]