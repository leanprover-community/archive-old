[
    {
        "content": "<p>How does one use \"whitespace\" separators for <code>sepBy</code>, such as spaces and newlines?</p>\n<p>The code below works with the (commented) <code>;</code> based separators, and does not with the (uncomment) space (<code> </code>) based separator. In particular, the declaration <code>$kvs *</code> is problematic. Is there some way to name the variable with the space?</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"n\">declare_syntax_cat</span> <span class=\"n\">dict</span>\n<span class=\"c1\">-- syntax \"&lt;[\" sepBy(str, \";\") \"]&gt;\" : dict</span>\n<span class=\"n\">syntax</span> <span class=\"s2\">\"&lt;[\"</span> <span class=\"n\">sepBy</span><span class=\"o\">(</span><span class=\"n\">str</span><span class=\"o\">,</span> <span class=\"s2\">\" \"</span><span class=\"o\">)</span> <span class=\"s2\">\"]&gt;\"</span> <span class=\"o\">:</span> <span class=\"n\">dict</span>\n\n<span class=\"kd\">set_option</span> <span class=\"n\">trace.Elab.definition</span> <span class=\"n\">true</span> <span class=\"k\">in</span>\n<span class=\"n\">syntax</span> <span class=\"s2\">\"dict% \"</span> <span class=\"n\">dict</span> <span class=\"o\">:</span> <span class=\"n\">term</span>\n\n<span class=\"n\">macro_rules</span>\n  <span class=\"c1\">-- | `(dict% &lt;[ $kvs;* ]&gt; ) =&gt; do</span>\n  <span class=\"bp\">|</span> <span class=\"bp\">`</span><span class=\"o\">(</span><span class=\"n\">dict</span><span class=\"bp\">%</span> <span class=\"bp\">&lt;</span><span class=\"o\">[</span> <span class=\"bp\">$</span><span class=\"n\">kvs</span> <span class=\"bp\">*</span> <span class=\"o\">]</span><span class=\"bp\">&gt;</span> <span class=\"o\">)</span> <span class=\"bp\">=&gt;</span> <span class=\"k\">do</span>\n     <span class=\"k\">let</span> <span class=\"n\">initList</span> <span class=\"bp\">&lt;-</span> <span class=\"bp\">`</span><span class=\"o\">([])</span>\n     <span class=\"n\">kvs.getElems.foldlM</span> <span class=\"o\">(</span><span class=\"n\">init</span> <span class=\"o\">:=</span> <span class=\"n\">initList</span><span class=\"o\">)</span> <span class=\"k\">fun</span> <span class=\"n\">xs</span> <span class=\"n\">kv</span> <span class=\"bp\">=&gt;</span> <span class=\"bp\">`</span><span class=\"o\">(</span><span class=\"bp\">$</span><span class=\"n\">kv</span> <span class=\"o\">::</span> <span class=\"bp\">$</span><span class=\"n\">xs</span> <span class=\"o\">)</span>\n\n<span class=\"kd\">def</span> <span class=\"n\">dict0</span> <span class=\"o\">:</span> <span class=\"n\">List</span> <span class=\"o\">(</span><span class=\"n\">String</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"n\">dict</span><span class=\"bp\">%</span> <span class=\"bp\">&lt;</span><span class=\"o\">[</span>  <span class=\"o\">]</span><span class=\"bp\">&gt;</span>\n<span class=\"k\">#print</span> <span class=\"n\">dict0</span>\n\n<span class=\"kd\">def</span> <span class=\"n\">dict1</span> <span class=\"o\">:</span> <span class=\"n\">List</span> <span class=\"n\">String</span> <span class=\"o\">:=</span> <span class=\"n\">dict</span><span class=\"bp\">%</span> <span class=\"bp\">&lt;</span><span class=\"o\">[</span> <span class=\"s2\">\"a\"</span> <span class=\"bp\">;</span> <span class=\"s2\">\"b\"</span> <span class=\"bp\">;</span> <span class=\"s2\">\"c\"</span> <span class=\"o\">]</span><span class=\"bp\">&gt;</span>\n<span class=\"k\">#print</span> <span class=\"n\">dict1</span>\n</code></pre></div>\n<p>Errors:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"n\">crash.lean</span><span class=\"o\">:</span><span class=\"mi\">4</span><span class=\"o\">:</span><span class=\"mi\">0</span><span class=\"o\">:</span> <span class=\"n\">error</span><span class=\"o\">:</span> <span class=\"n\">invalid</span> <span class=\"n\">parser</span> <span class=\"bp\">'«</span><span class=\"n\">dict</span><span class=\"bp\">&lt;</span><span class=\"o\">[</span><span class=\"n\">_</span><span class=\"o\">]</span><span class=\"bp\">&gt;»'</span><span class=\"o\">,</span> <span class=\"n\">invalid</span> <span class=\"n\">empty</span> <span class=\"n\">symbol</span>\n<span class=\"n\">crash.lean</span><span class=\"o\">:</span><span class=\"mi\">10</span><span class=\"o\">:</span><span class=\"mi\">12</span><span class=\"o\">:</span> <span class=\"n\">error</span><span class=\"o\">:</span> <span class=\"n\">expected</span> <span class=\"n\">dict</span>\n<span class=\"n\">crash.lean</span><span class=\"o\">:</span><span class=\"mi\">14</span><span class=\"o\">:</span><span class=\"mi\">35</span><span class=\"o\">:</span> <span class=\"n\">error</span><span class=\"o\">:</span> <span class=\"n\">expected</span> <span class=\"n\">dict</span>\n<span class=\"n\">crash.lean</span><span class=\"o\">:</span><span class=\"mi\">15</span><span class=\"o\">:</span><span class=\"mi\">7</span><span class=\"o\">:</span> <span class=\"n\">error</span><span class=\"o\">:</span> <span class=\"n\">unknown</span> <span class=\"kd\">constant</span> <span class=\"bp\">'</span><span class=\"n\">dict0'</span>\n<span class=\"n\">crash.lean</span><span class=\"o\">:</span><span class=\"mi\">17</span><span class=\"o\">:</span><span class=\"mi\">33</span><span class=\"o\">:</span> <span class=\"n\">error</span><span class=\"o\">:</span> <span class=\"n\">expected</span> <span class=\"n\">dict</span>\n<span class=\"n\">crash.lean</span><span class=\"o\">:</span><span class=\"mi\">18</span><span class=\"o\">:</span><span class=\"mi\">7</span><span class=\"o\">:</span> <span class=\"n\">error</span><span class=\"o\">:</span> <span class=\"n\">unknown</span> <span class=\"kd\">constant</span> <span class=\"bp\">'</span><span class=\"n\">dict1'</span>\n</code></pre></div>",
        "id": 255685536,
        "sender_full_name": "Siddharth Bhat",
        "timestamp": 1633059998
    },
    {
        "content": "<p>You can just use<code>str*</code> or (if you wish to demand whitespace) <code>(ws str ws)*</code></p>",
        "id": 255686798,
        "sender_full_name": "Mac",
        "timestamp": 1633061081
    },
    {
        "content": "<p>For example:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"n\">declare_syntax_cat</span> <span class=\"n\">dict</span>\n<span class=\"n\">syntax</span> <span class=\"s2\">\"&lt;[\"</span> <span class=\"o\">(</span><span class=\"n\">ws</span> <span class=\"n\">str</span> <span class=\"n\">ws</span><span class=\"o\">)</span><span class=\"bp\">*</span> <span class=\"s2\">\"]&gt;\"</span> <span class=\"o\">:</span> <span class=\"n\">dict</span>\n\n<span class=\"kd\">set_option</span> <span class=\"n\">trace.Elab.definition</span> <span class=\"n\">true</span> <span class=\"k\">in</span>\n<span class=\"n\">syntax</span> <span class=\"s2\">\"dict% \"</span> <span class=\"n\">dict</span> <span class=\"o\">:</span> <span class=\"n\">term</span>\n\n<span class=\"n\">macro_rules</span>\n  <span class=\"bp\">|</span> <span class=\"bp\">`</span><span class=\"o\">(</span><span class=\"n\">dict</span><span class=\"bp\">%</span> <span class=\"bp\">&lt;</span><span class=\"o\">[</span> <span class=\"bp\">$</span><span class=\"o\">[</span> <span class=\"bp\">$</span><span class=\"n\">kvs</span> <span class=\"o\">]</span><span class=\"bp\">*</span> <span class=\"o\">]</span><span class=\"bp\">&gt;</span> <span class=\"o\">)</span> <span class=\"bp\">=&gt;</span> <span class=\"k\">do</span>\n     <span class=\"k\">let</span> <span class=\"n\">initList</span> <span class=\"bp\">&lt;-</span> <span class=\"bp\">`</span><span class=\"o\">([])</span>\n     <span class=\"n\">kvs.foldlM</span> <span class=\"o\">(</span><span class=\"n\">init</span> <span class=\"o\">:=</span> <span class=\"n\">initList</span><span class=\"o\">)</span> <span class=\"k\">fun</span> <span class=\"n\">xs</span> <span class=\"n\">kv</span> <span class=\"bp\">=&gt;</span> <span class=\"bp\">`</span><span class=\"o\">(</span><span class=\"bp\">$</span><span class=\"n\">kv</span> <span class=\"o\">::</span> <span class=\"bp\">$</span><span class=\"n\">xs</span> <span class=\"o\">)</span>\n\n<span class=\"kd\">def</span> <span class=\"n\">dict0</span> <span class=\"o\">:</span> <span class=\"n\">List</span> <span class=\"o\">(</span><span class=\"n\">String</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"n\">dict</span><span class=\"bp\">%</span> <span class=\"bp\">&lt;</span><span class=\"o\">[</span>  <span class=\"o\">]</span><span class=\"bp\">&gt;</span>\n<span class=\"k\">#print</span> <span class=\"n\">dict0</span>\n\n<span class=\"kd\">def</span> <span class=\"n\">dict1</span> <span class=\"o\">:</span> <span class=\"n\">List</span> <span class=\"n\">String</span> <span class=\"o\">:=</span> <span class=\"n\">dict</span><span class=\"bp\">%</span> <span class=\"bp\">&lt;</span><span class=\"o\">[</span> <span class=\"s2\">\"a\"</span> <span class=\"s2\">\"b\"</span> <span class=\"s2\">\"c\"</span> <span class=\"o\">]</span><span class=\"bp\">&gt;</span>\n<span class=\"k\">#print</span> <span class=\"n\">dict1</span>\n</code></pre></div>",
        "id": 255686958,
        "sender_full_name": "Mac",
        "timestamp": 1633061211
    }
]