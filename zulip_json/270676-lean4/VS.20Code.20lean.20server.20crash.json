[
    {
        "content": "<p>Hi - am new to Lean so apologies if this is a dumb question. I am trying to us Visual Studio Code to write and run a Lean 4 sample file. However, the InfoView window reports that the Lean server crashes:</p>\n<p>Lean (version 4.0.0-nightly-2022-05-08, commit 0fd47fd817eb, Release)<br>\nLean (version 4.0.0-nightly-2022-05-08, commit 0fd47fd817eb, Release)<br>\n[Info  - 9:21:18 AM] Connection to server got closed. Server will restart.<br>\n[Info  - 9:21:24 AM] Connection to server got closed. Server will restart.<br>\n[Info  - 9:21:30 AM] Connection to server got closed. Server will restart.<br>\n[Info  - 9:21:35 AM] Connection to server got closed. Server will restart.<br>\n[Error - 9:21:41 AM] The Lean 4 server crashed 5 times in the last 3 minutes. The server will not be restarted. See the output for more information.<br>\nError: Connection to server got closed. Server will not be restarted.</p>\n<p>Here's info about my environment:</p>\n<p>Windows 10<br>\nVisual Studio Code 1.67.1 (April 2022)<br>\nLean version 4.0.0-nightly-2022-05-08<br>\nlean4 extension installed v0.0.72</p>\n<p>Thanks in advance for any help! Martin</p>",
        "id": 282417232,
        "sender_full_name": "Martin Gilchrist",
        "timestamp": 1652632702
    },
    {
        "content": "<p>Hello <span class=\"user-mention\" data-user-id=\"500714\">@Martin Gilchrist</span>,<br>\nCan you post the code you're trying to run?</p>",
        "id": 282482954,
        "sender_full_name": "Arthur Paulino",
        "timestamp": 1652701312
    },
    {
        "content": "<p>Hi - it's the example file Foo.lean when you run the lake init foo command. So the contents of the Foo.lean file are:<br>\ndef hello := \"world\"</p>\n<p>I'll include a screenshot to help give an idea of what I see.</p>\n<p><a href=\"/user_uploads/3121/CKqu1dGQ3fp5x4UZcrOcLTRr/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/CKqu1dGQ3fp5x4UZcrOcLTRr/image.png\" title=\"image.png\"><img src=\"/user_uploads/3121/CKqu1dGQ3fp5x4UZcrOcLTRr/image.png\"></a></div>",
        "id": 282566317,
        "sender_full_name": "Martin Gilchrist",
        "timestamp": 1652738285
    },
    {
        "content": "<p>I think that this is also relevant: the Windows Event Viewer reports an error:</p>\n<p>Faulting application name: lake.exe, version: 0.0.0.0, time stamp: 0x62777050<br>\nFaulting module name: libleanshared.dll, version: 0.0.0.0, time stamp: 0x62777026<br>\nException code: 0xc0000005<br>\nFault offset: 0x0000000000271fb1<br>\nFaulting process id: 0x31fc<br>\nFaulting application start time: 0x01d868dd8b4a5778<br>\nFaulting application path: C:\\Users\\martinpg\\.elan\\toolchains\\leanprover--lean4---nightly\\bin\\lake.exe<br>\nFaulting module path: C:\\Users\\martinpg\\.elan\\toolchains\\leanprover--lean4---nightly\\bin\\libleanshared.dll<br>\nReport Id: c8907e50-32a6-4f37-a803-f6a0ef7e774f<br>\nFaulting package full name: <br>\nFaulting package-relative application ID:</p>",
        "id": 282566611,
        "sender_full_name": "Martin Gilchrist",
        "timestamp": 1652738431
    },
    {
        "content": "<p>I just tried installing the <code>leanprover--lean4---nightly</code> on windows and it works fine, does your install directory look like this? </p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code> <span class=\"n\">Directory</span> <span class=\"n\">of</span> <span class=\"n\">C</span><span class=\"o\">:</span><span class=\"bp\">\\</span><span class=\"n\">Users</span><span class=\"bp\">\\</span><span class=\"n\">clovett</span><span class=\"bp\">\\.</span><span class=\"n\">elan</span><span class=\"bp\">\\</span><span class=\"n\">toolchains</span><span class=\"bp\">\\</span><span class=\"n\">leanprover</span><span class=\"c1\">--lean4---nightly\\bin</span>\n\n<span class=\"mi\">05</span><span class=\"bp\">/</span><span class=\"mi\">16</span><span class=\"bp\">/</span><span class=\"mi\">2022</span>  <span class=\"mi\">04</span><span class=\"o\">:</span><span class=\"mi\">36</span> <span class=\"n\">PM</span>    <span class=\"bp\">&lt;</span><span class=\"n\">DIR</span><span class=\"bp\">&gt;</span>          <span class=\"bp\">.</span>\n<span class=\"mi\">05</span><span class=\"bp\">/</span><span class=\"mi\">16</span><span class=\"bp\">/</span><span class=\"mi\">2022</span>  <span class=\"mi\">04</span><span class=\"o\">:</span><span class=\"mi\">36</span> <span class=\"n\">PM</span>    <span class=\"bp\">&lt;</span><span class=\"n\">DIR</span><span class=\"bp\">&gt;</span>          <span class=\"bp\">..</span>\n<span class=\"mi\">05</span><span class=\"bp\">/</span><span class=\"mi\">14</span><span class=\"bp\">/</span><span class=\"mi\">2022</span>  <span class=\"mi\">12</span><span class=\"o\">:</span><span class=\"mi\">13</span> <span class=\"n\">AM</span>           <span class=\"mi\">231</span><span class=\"o\">,</span><span class=\"mi\">936</span> <span class=\"n\">clang.exe</span>\n<span class=\"mi\">05</span><span class=\"bp\">/</span><span class=\"mi\">14</span><span class=\"bp\">/</span><span class=\"mi\">2022</span>  <span class=\"mi\">12</span><span class=\"o\">:</span><span class=\"mi\">35</span> <span class=\"n\">AM</span>         <span class=\"mi\">1</span><span class=\"o\">,</span><span class=\"mi\">526</span><span class=\"o\">,</span><span class=\"mi\">272</span> <span class=\"n\">lake.exe</span>\n<span class=\"mi\">05</span><span class=\"bp\">/</span><span class=\"mi\">14</span><span class=\"bp\">/</span><span class=\"mi\">2022</span>  <span class=\"mi\">12</span><span class=\"o\">:</span><span class=\"mi\">13</span> <span class=\"n\">AM</span>         <span class=\"mi\">7</span><span class=\"o\">,</span><span class=\"mi\">415</span><span class=\"o\">,</span><span class=\"mi\">296</span> <span class=\"n\">ld.lld.exe</span>\n<span class=\"mi\">05</span><span class=\"bp\">/</span><span class=\"mi\">14</span><span class=\"bp\">/</span><span class=\"mi\">2022</span>  <span class=\"mi\">12</span><span class=\"o\">:</span><span class=\"mi\">34</span> <span class=\"n\">AM</span>            <span class=\"mi\">77</span><span class=\"o\">,</span><span class=\"mi\">312</span> <span class=\"n\">lean.exe</span>\n<span class=\"mi\">05</span><span class=\"bp\">/</span><span class=\"mi\">14</span><span class=\"bp\">/</span><span class=\"mi\">2022</span>  <span class=\"mi\">12</span><span class=\"o\">:</span><span class=\"mi\">34</span> <span class=\"n\">AM</span>            <span class=\"mi\">97</span><span class=\"o\">,</span><span class=\"mi\">280</span> <span class=\"n\">leanc.exe</span>\n<span class=\"mi\">05</span><span class=\"bp\">/</span><span class=\"mi\">14</span><span class=\"bp\">/</span><span class=\"mi\">2022</span>  <span class=\"mi\">12</span><span class=\"o\">:</span><span class=\"mi\">11</span> <span class=\"n\">AM</span>               <span class=\"mi\">860</span> <span class=\"n\">leanmake</span>\n<span class=\"mi\">05</span><span class=\"bp\">/</span><span class=\"mi\">14</span><span class=\"bp\">/</span><span class=\"mi\">2022</span>  <span class=\"mi\">12</span><span class=\"o\">:</span><span class=\"mi\">13</span> <span class=\"n\">AM</span>         <span class=\"mi\">1</span><span class=\"o\">,</span><span class=\"mi\">274</span><span class=\"o\">,</span><span class=\"mi\">880</span> <span class=\"n\">libc</span><span class=\"bp\">++.</span><span class=\"n\">dll</span>\n<span class=\"mi\">05</span><span class=\"bp\">/</span><span class=\"mi\">14</span><span class=\"bp\">/</span><span class=\"mi\">2022</span>  <span class=\"mi\">12</span><span class=\"o\">:</span><span class=\"mi\">13</span> <span class=\"n\">AM</span>        <span class=\"mi\">99</span><span class=\"o\">,</span><span class=\"mi\">091</span><span class=\"o\">,</span><span class=\"mi\">456</span> <span class=\"n\">libclang</span><span class=\"bp\">-</span><span class=\"n\">cpp.dll</span>\n<span class=\"mi\">05</span><span class=\"bp\">/</span><span class=\"mi\">14</span><span class=\"bp\">/</span><span class=\"mi\">2022</span>  <span class=\"mi\">12</span><span class=\"o\">:</span><span class=\"mi\">34</span> <span class=\"n\">AM</span>        <span class=\"mi\">51</span><span class=\"o\">,</span><span class=\"mi\">060</span><span class=\"o\">,</span><span class=\"mi\">736</span> <span class=\"n\">libleanshared.dll</span>\n<span class=\"mi\">05</span><span class=\"bp\">/</span><span class=\"mi\">14</span><span class=\"bp\">/</span><span class=\"mi\">2022</span>  <span class=\"mi\">12</span><span class=\"o\">:</span><span class=\"mi\">13</span> <span class=\"n\">AM</span>        <span class=\"mi\">95</span><span class=\"o\">,</span><span class=\"mi\">203</span><span class=\"o\">,</span><span class=\"mi\">328</span> <span class=\"n\">libLLVM</span><span class=\"bp\">-</span><span class=\"mi\">14</span><span class=\"bp\">.</span><span class=\"n\">dll</span>\n<span class=\"mi\">05</span><span class=\"bp\">/</span><span class=\"mi\">14</span><span class=\"bp\">/</span><span class=\"mi\">2022</span>  <span class=\"mi\">12</span><span class=\"o\">:</span><span class=\"mi\">13</span> <span class=\"n\">AM</span>           <span class=\"mi\">103</span><span class=\"o\">,</span><span class=\"mi\">936</span> <span class=\"n\">libunwind.dll</span>\n<span class=\"mi\">05</span><span class=\"bp\">/</span><span class=\"mi\">14</span><span class=\"bp\">/</span><span class=\"mi\">2022</span>  <span class=\"mi\">12</span><span class=\"o\">:</span><span class=\"mi\">13</span> <span class=\"n\">AM</span>         <span class=\"mi\">7</span><span class=\"o\">,</span><span class=\"mi\">415</span><span class=\"o\">,</span><span class=\"mi\">296</span> <span class=\"n\">lld.exe</span>\n<span class=\"mi\">05</span><span class=\"bp\">/</span><span class=\"mi\">14</span><span class=\"bp\">/</span><span class=\"mi\">2022</span>  <span class=\"mi\">12</span><span class=\"o\">:</span><span class=\"mi\">13</span> <span class=\"n\">AM</span>           <span class=\"mi\">167</span><span class=\"o\">,</span><span class=\"mi\">424</span> <span class=\"n\">llvm</span><span class=\"bp\">-</span><span class=\"n\">ar.exe</span>\n<span class=\"mi\">05</span><span class=\"bp\">/</span><span class=\"mi\">14</span><span class=\"bp\">/</span><span class=\"mi\">2022</span>  <span class=\"mi\">12</span><span class=\"o\">:</span><span class=\"mi\">13</span> <span class=\"n\">AM</span>           <span class=\"mi\">105</span><span class=\"o\">,</span><span class=\"mi\">984</span> <span class=\"n\">zlib1.dll</span>\n</code></pre></div>\n<p>and can you print out the following environment variables?</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"n\">PROCESSOR_ARCHITECTURE</span><span class=\"bp\">=</span><span class=\"n\">AMD64</span>\n<span class=\"n\">PROCESSOR_IDENTIFIER</span><span class=\"bp\">=</span><span class=\"n\">AMD64</span> <span class=\"n\">Family</span> <span class=\"mi\">23</span> <span class=\"n\">Model</span> <span class=\"mi\">113</span> <span class=\"n\">Stepping</span> <span class=\"mi\">0</span><span class=\"o\">,</span> <span class=\"n\">AuthenticAMD</span>\n<span class=\"n\">PROCESSOR_LEVEL</span><span class=\"bp\">=</span><span class=\"mi\">23</span>\n<span class=\"n\">PROCESSOR_REVISION</span><span class=\"bp\">=</span><span class=\"mi\">7100</span>\n</code></pre></div>",
        "id": 282574583,
        "sender_full_name": "Chris Lovett",
        "timestamp": 1652744261
    },
    {
        "content": "<p>Here is my install directory:<br>\nC:\\Users\\martinpg\\.elan\\toolchains\\leanprover--lean4---nightly\\bin&gt;dir<br>\n Volume in drive C has no label.<br>\n Volume Serial Number is 184C-2440</p>\n<p>Directory of C:\\Users\\martinpg\\.elan\\toolchains\\leanprover--lean4---nightly\\bin</p>\n<p>05/08/2022  05:44 AM    &lt;DIR&gt;          .<br>\n05/08/2022  05:44 AM    &lt;DIR&gt;          ..<br>\n05/08/2022  12:08 AM           231,936 clang.exe<br>\n05/08/2022  12:25 AM         1,526,272 lake.exe<br>\n05/08/2022  12:08 AM         7,415,296 ld.lld.exe<br>\n05/08/2022  12:24 AM            77,312 lean.exe<br>\n05/08/2022  12:24 AM            97,280 leanc.exe<br>\n05/08/2022  12:06 AM               860 leanmake<br>\n05/08/2022  12:08 AM         1,274,880 libc++.dll<br>\n05/08/2022  12:08 AM        99,091,456 libclang-cpp.dll<br>\n05/08/2022  12:24 AM        51,346,432 libleanshared.dll<br>\n05/08/2022  12:08 AM        95,203,328 libLLVM-14.dll<br>\n05/08/2022  12:08 AM           103,936 libunwind.dll<br>\n05/08/2022  12:08 AM         7,415,296 lld.exe<br>\n05/08/2022  12:08 AM           167,424 llvm-ar.exe<br>\n05/08/2022  12:08 AM           105,984 zlib1.dll<br>\n              14 File(s)    264,057,692 bytes<br>\n               2 Dir(s)  705,302,437,888 bytes free</p>\n<p>and here are my PROCESSOR environment variables:</p>\n<p>PROCESSOR_ARCHITECTURE=AMD64<br>\nPROCESSOR_IDENTIFIER=Intel64 Family 6 Model 37 Stepping 2, GenuineIntel<br>\nPROCESSOR_LEVEL=6<br>\nPROCESSOR_REVISION=2502</p>",
        "id": 282583096,
        "sender_full_name": "Martin Gilchrist",
        "timestamp": 1652751883
    },
    {
        "content": "<p>You can use <a href=\"https://github.com/leanprover-community/mathlib/wiki/Code-in-backticks\">#backticks</a> for code</p>",
        "id": 282607392,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1652776172
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"500714\">@Martin Gilchrist</span> can you try and wipe C:\\Users\\martinpg\\.elan then restart VS code and follow the prompts as per <a href=\"https://leanprover.github.io/lean4/doc/quickstart.html\">https://leanprover.github.io/lean4/doc/quickstart.html</a> and let me know what happens?</p>",
        "id": 284808203,
        "sender_full_name": "Chris Lovett",
        "timestamp": 1654205710
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"434989\">@Chris Lovett</span> Thank you,  I think that has fixed my problem. I now have a relatively simple project and Lean infoview window which is not complaining about server crashes! That said, I now cannot work out how to create a project that references mathlib4, but will try a different thread for that.</p>",
        "id": 285333912,
        "sender_full_name": "Martin Gilchrist",
        "timestamp": 1654651054
    },
    {
        "content": "<p>Something like this should work in your <code>lakefile.lean</code>:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kn\">import</span> <span class=\"n\">Lake</span>\n<span class=\"kn\">open</span> <span class=\"n\">Lake</span> <span class=\"n\">DSL</span>\n\n<span class=\"n\">package</span> <span class=\"n\">MathTest</span> <span class=\"o\">{</span>\n  <span class=\"c1\">-- add configuration options here</span>\n  <span class=\"n\">dependencies</span> <span class=\"o\">:=</span> <span class=\"bp\">#</span><span class=\"o\">[</span>\n    <span class=\"o\">{</span>\n      <span class=\"n\">name</span> <span class=\"o\">:=</span> <span class=\"bp\">`</span><span class=\"n\">mathlib</span>\n      <span class=\"n\">src</span> <span class=\"o\">:=</span> <span class=\"n\">Source.git</span> <span class=\"s2\">\"https://github.com/leanprover-community/mathlib4.git\"</span> <span class=\"s2\">\"6895646674b04c0d7bcd085b4da3f7bb354ceaa9\"</span>\n    <span class=\"o\">}</span>\n  <span class=\"o\">]</span>\n<span class=\"o\">}</span>\n</code></pre></div>\n<p>Then your Main.lean can do some mathlib magic:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kn\">import</span> <span class=\"n\">Mathlib.Data.Nat.Gcd</span>\n<span class=\"k\">#eval</span> <span class=\"n\">Nat.gcd</span> <span class=\"mi\">12</span> <span class=\"mi\">15</span> <span class=\"c1\">-- 3</span>\n</code></pre></div>",
        "id": 285460781,
        "sender_full_name": "Chris Lovett",
        "timestamp": 1654726898
    }
]