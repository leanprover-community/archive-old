[
    {
        "content": "<p>One thing I would like to experiment with (but I won't have time until teaching is done ~ 4 weeks from now) is the add-vs-mul stuff.</p>\n<ul>\n<li>Does fully-bundled + unification hints make it easier to have only <code>Group</code>?</li>\n<li>What are the 37 problems we will hit, when there are 2 paths from <code>Semiring</code> to <code>Monoid</code>?</li>\n<li>Can we have notation agnostic <code>Group</code>/<code>Semiring</code>/<code>Monoid</code>, and use the new macro system to have nice and readable notation anyway?</li>\n<li>...</li>\n</ul>",
        "id": 221861331,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1610000895
    },
    {
        "content": "<p>What advantage does a notation agnostic <code>Group</code> have, if the theory is still being duplicated for add/mul? It would just mean 3 copies instead of 2, and with really awkward naming and notation for one of them</p>",
        "id": 221861485,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1610001144
    },
    {
        "content": "<p>No... I would want to know if it's possible to do with just 1 copy.</p>",
        "id": 221862518,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1610002593
    },
    {
        "content": "<p>Are there new Lean features that we can leverage to make that happen, and still have readable code?</p>",
        "id": 221862530,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1610002619
    },
    {
        "content": "<p>We need theorems named <code>add_assoc</code> and <code>mul_assoc</code> independent of any behind the scenes shenanigans</p>",
        "id": 221862789,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1610002935
    },
    {
        "content": "<p>so we are already committed to some amount of duplication, even if it's only instantiating one as the other</p>",
        "id": 221862807,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1610002979
    },
    {
        "content": "<p>we already have the means to create readable, non-duplicated code that generates 2 copies, via <code>@[to_additive]</code></p>",
        "id": 221862886,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1610003066
    },
    {
        "content": "<p>but we could invest in a tactic to allow applying e.g. <code>mul_assoc</code> even when the application does not use <code>mul</code>, both to make the proof of the additive version not require replaying the whole proof, and also to allow using it in situations that use neither notation, e.g. <code>\\comp</code> or <code>++</code></p>",
        "id": 221862979,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1610003217
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110049\">Mario Carneiro</span> <a href=\"#narrow/stream/270676-lean4/topic/to_additive/near/221862789\">said</a>:</p>\n<blockquote>\n<p>We need theorems named <code>add_assoc</code> and <code>mul_assoc</code> independent of any behind the scenes shenanigans</p>\n</blockquote>\n<p>Why exactly do we need this? It's not clear to me that in theory we can't get away with <code>assoc</code>.</p>",
        "id": 221863262,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1610003613
    },
    {
        "content": "<p>I don't know what problems we are trying to solve with bundled structures + canonical instances, but I think that typeclasses are way nicer.</p>\n<p>Suppose I write everything multiplicative for now (not worrying about additive stuff). Suppose I want to rewrite with <code>mul_assoc</code>. I'm looking for <code>(_ * _) * _</code>. What does <code>*</code> mean here? <code>Group.mul</code>, i.e. one of the fields for <code>Group</code>? That of course doesn't work, since I will also have <code>CommGroup.mul</code>, <code>Ring.mul</code> etc.</p>",
        "id": 221863687,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1610004144
    },
    {
        "content": "<p>Isn't it going to be <code>SemiGroup.mul</code>? And then you need coercions to kick in?</p>",
        "id": 221863736,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1610004234
    },
    {
        "content": "<p>But the issue you're raising has certainly been solved in mathcomp</p>",
        "id": 221863781,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1610004256
    },
    {
        "content": "<p>While I won't discourage any experiments with any of this, I would not put your hopes too high. </p>\n<p>Here is a paper that is about packed classes, used in mathcomp: <a href=\"https://arxiv.org/pdf/2002.00620.pdf\">https://arxiv.org/pdf/2002.00620.pdf</a></p>\n<p>Here is a paragraph from page 2:</p>\n<blockquote>\n<p>In spite of its success, the packed classes methodology is hard to master<br>\nfor library designers and requires a substantial amount of work to maintain as<br>\nlibraries evolve. For instance, the strict application of packed classes requires<br>\ndefining quadratically many implicit coercions and unification hints in the number of structures. <br>\nTo give some figures, the MathComp library 1.10.0 uses this<br>\nmethodology ubiquitously to define the 51 mathematical structures depicted in<br>\nFig. 1, and declares 554 implicit coercions and 746 unification hints to implement their inheritance. <br>\nMoreover, defining new intermediate structures between<br>\nexisting ones requires fixing their subclasses and their inheritance accordingly;<br>\nthus, it can be a challenging task</p>\n</blockquote>",
        "id": 221864482,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1610005129
    },
    {
        "content": "<p>Hmm, thanks for that quote.</p>",
        "id": 221864672,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1610005388
    },
    {
        "content": "<p>This \"quadratically many implicit coercions and unification hints\" is pretty bad, but I'm not even sure if that is the worst. We can limit the number of classes we have by having multiple classes on 1 type, e.g. <code>[fintype F] [field F]</code>. If you do everything bundled you need to define a bundled structure for every combination. For example, in Figure 1 you see that there is <code>ringType</code>, <code>groupType</code> and <code>fieldType</code>, but also <code>finRingType</code>, <code>finGroupType</code>, <code>countRingType</code>, <code>decFieldType</code>, etc. <br>\nI think that requires exponentially many structures, which would be already be <em>way</em> too large for the current size of mathlib.</p>",
        "id": 221864851,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1610005575
    },
    {
        "content": "<p>Imagine having <code>topologicalGroup</code>, <code>topologicalCommGroup</code>, <code>hausdorffTopologicalGroup</code> <code>compactSecondCountableTopologicalRing</code>, ...</p>",
        "id": 221865099,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1610005854
    },
    {
        "content": "<p>I don't think the \"quadratically many implicit coercions and unification hints\" is actually that bad. That's the amount of extra setup you have to do to set up the hierarchy itself; it is basically precomputing all shortcut instances. The benefit is that the equivalent of typeclass instance searches become way shorter. Plus I think it would be quite reasonable, if we were to implement this strategy, to have a similar \"hierarchy builder\" tactic to what mathcomp itself uses (now, after a long manual history)</p>",
        "id": 221866049,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1610006802
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"111080\">Floris van Doorn</span> <a href=\"#narrow/stream/270676-lean4/topic/to_additive/near/221865099\">said</a>:</p>\n<blockquote>\n<p>Imagine having <code>topologicalGroup</code>, <code>topologicalCommGroup</code>, <code>hausdorffTopologicalGroup</code> <code>compactSecondCountableTopologicalRing</code>, ...</p>\n</blockquote>\n<p>I believe the coq answer to this is mixins. They work pretty similar to the instances like <code>second_countable A</code> that we already use</p>",
        "id": 221866199,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1610006951
    },
    {
        "content": "<p>(None of this is to say that I advocate switching, but I can believe that lean 4 makes it possible to actually build a working mathcomp style hierarchy)</p>",
        "id": 221866267,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1610007004
    },
    {
        "content": "<p>My impression was that mixins were used only to define new bundled structures, but I might be wrong with that. But if I'm wrong, then I'm wondering why they duplicated all their structures with finite structures.<br>\nIf you use a mixin in a theorem statement, it better be a type class (right?). And now you're doing both type-class inference and unification hints.</p>",
        "id": 221866961,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1610007652
    },
    {
        "content": "<p>Of course we've also been floating around this idea of having <code>[[topological_group G]]</code> do something like:</p>\n<ul>\n<li>Observe that <code>[topological_group G]</code> needs <code>G : Type*</code>, <code>[topological_space G]</code> and <code>[group G]</code> to make sense.</li>\n<li>Check if <code>G</code> exists as <code>variable</code>. If not, add it (at least locally).</li>\n<li>Use typeclass resolution to check if <code>[topological_space G]</code> can be derived from the current environment. If not, add the assumption locally.</li>\n<li>Idem dito for <code>[group G]</code>.</li>\n</ul>\n<p><span class=\"user-mention\" data-user-id=\"110024\">@Sebastian Ullrich</span> does <span aria-label=\"up\" class=\"emoji emoji-2b06\" role=\"img\" title=\"up\">:up:</span> sound like something that is in scope for a macro?</p>",
        "id": 221924006,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1610013992
    },
    {
        "content": "<p>This could potentially be an elaborator in the <code>binder</code> category, though none of these exist ATM. Note that your second point should be covered by <a href=\"https://leanprover.github.io/lean4/doc/autobound.html\">https://leanprover.github.io/lean4/doc/autobound.html</a>. AFAIR, <span class=\"user-mention\" data-user-id=\"112857\">@Leonardo de Moura</span> and I consciously decided <em>not</em> to auto-bind typeclass instance arguments since it's hard to tell whether a user deliberately elided them or <em>thinks</em> they should be implied by the current assumptions, in which case we would unexpectedly add new ones. Perhaps a new notation for that isn't the worst idea, especially when it can be implemented and experimented with outside of core.</p>",
        "id": 221933549,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1610020825
    },
    {
        "content": "<p>I can read that you only autobound \"a single lower case or greek letter\". We tend to use upper case letters as types (or weird letters such as <code>𝕜</code>, for which I don't know how it counts). Is this something we will be able to customize in mathlib?</p>",
        "id": 221934478,
        "sender_full_name": "Sebastien Gouezel",
        "timestamp": 1610021491
    },
    {
        "content": "<p>Ah, that's true...</p>",
        "id": 221934702,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1610021654
    },
    {
        "content": "<p>Along these lines, I was wondering about having \"abbreviation classes.\"  These would be classes that extend some number of classes and have no members themselves, and whenever they appear they should behave as if they are replaced by all the classes they extend.</p>\n<p>A bit more precisely,</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kd\">abbreviation</span> <span class=\"kd\">class</span> <span class=\"n\">Foo</span> <span class=\"o\">(</span><span class=\"n\">α</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">)</span> <span class=\"kd\">extends</span> <span class=\"n\">C1</span> <span class=\"n\">α</span><span class=\"o\">,</span> <span class=\"n\">C2</span> <span class=\"n\">α</span><span class=\"o\">,</span> <span class=\"n\">C3</span> <span class=\"n\">α</span>\n</code></pre></div>\n<p>indicates that a <code>[Foo α]</code> should mean <code>[C1 α] [C2 α] [C3 α]</code>, and whenever a class extends <code>Foo</code>, it would actually extend these three classes.  Under the hood, there should be an actual class for <code>Foo</code> that records the instances, so the typeclass resolution can be more easily cached -- there would be an instance for <code>Foo α</code> whenever instances for the classes being extended exist, so <code>abbreviation class</code> should mean something like:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kd\">class</span> <span class=\"n\">Foo</span> <span class=\"o\">(</span><span class=\"n\">α</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">)</span> <span class=\"kd\">extends</span> <span class=\"n\">C1</span> <span class=\"n\">α</span><span class=\"o\">,</span> <span class=\"n\">C2</span> <span class=\"n\">α</span><span class=\"o\">,</span> <span class=\"n\">C3</span> <span class=\"n\">α</span>\n<span class=\"kd\">instance</span> <span class=\"o\">(</span><span class=\"n\">α</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">)</span> <span class=\"o\">[</span><span class=\"n\">C1</span> <span class=\"n\">α</span><span class=\"o\">]</span> <span class=\"o\">[</span><span class=\"n\">C2</span> <span class=\"n\">α</span><span class=\"o\">]</span> <span class=\"o\">[</span><span class=\"n\">C3</span> <span class=\"n\">α</span><span class=\"o\">]</span> <span class=\"o\">:</span> <span class=\"n\">Foo</span> <span class=\"n\">α</span> <span class=\"o\">:=</span> <span class=\"o\">{}</span>\n</code></pre></div>\n<p>It can't be exactly this because it would create infinite loops in typeclass resolution: <code>Foo</code> provides, for example, a <code>C1</code> instance, so if you need a <code>C1</code> instance then typeclass resolution would try to find a <code>Foo</code> instance, which needs a <code>C1</code> instance, and so on.  The automatic instance for abbreviation classes needs to be special in some way to prevent this infinite loop.</p>\n<p>What this feature would support is having all algebraic structures being mixins of basic operations and axioms.  The Lean 3 mockup below illustrates how a commutative monoid would automatically be a monoid, a commutative semigroup, and a semigroup.  This is just because <code>[comm_monoid α]</code> would be roughly equivalent to saying <code>[has_mul α] [has_mul_assoc α] [has_one α] [has_mul_one α] [has_mul_comm α]</code> (though, again, you'd probably only want to pass a single <code>comm_monoid</code> instance argument in the implementation).  This setup should also make it easier to generate automatic universal algebra constructions (forgetful functors are completely trivial, and the right adjoints to these should be macro-ize-able -- I've done them by hand for a few cases).</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kn\">namespace</span> <span class=\"n\">flat_structures</span>\n<span class=\"kd\">universes</span> <span class=\"n\">u</span> <span class=\"n\">v</span>\n\n<span class=\"c\">/-</span><span class=\"cm\"> from core:</span>\n<span class=\"cm\">class has_one      (α : Type u) := (one : α)</span>\n<span class=\"cm\">class has_mul      (α : Type u) := (mul : α → α → α)</span>\n<span class=\"cm\">-/</span>\n\n<span class=\"kd\">class</span> <span class=\"n\">has_mul_assoc</span> <span class=\"o\">(</span><span class=\"n\">α</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span> <span class=\"n\">u</span><span class=\"o\">)</span> <span class=\"o\">[</span><span class=\"n\">has_mul</span> <span class=\"n\">α</span><span class=\"o\">]</span> <span class=\"o\">:=</span>\n<span class=\"o\">(</span><span class=\"n\">mul_assoc</span> <span class=\"o\">:</span> <span class=\"bp\">Π</span> <span class=\"o\">(</span><span class=\"n\">a</span> <span class=\"n\">b</span> <span class=\"n\">c</span> <span class=\"o\">:</span> <span class=\"n\">α</span><span class=\"o\">),</span> <span class=\"n\">a</span> <span class=\"bp\">*</span> <span class=\"n\">b</span> <span class=\"bp\">*</span> <span class=\"n\">c</span> <span class=\"bp\">=</span> <span class=\"n\">a</span> <span class=\"bp\">*</span> <span class=\"o\">(</span><span class=\"n\">b</span> <span class=\"bp\">*</span> <span class=\"n\">c</span><span class=\"o\">))</span>\n\n<span class=\"kd\">class</span> <span class=\"n\">has_mul_one</span> <span class=\"o\">(</span><span class=\"n\">α</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span> <span class=\"n\">u</span><span class=\"o\">)</span> <span class=\"o\">[</span><span class=\"n\">has_mul</span> <span class=\"n\">α</span><span class=\"o\">]</span> <span class=\"o\">[</span><span class=\"n\">has_one</span> <span class=\"n\">α</span><span class=\"o\">]</span> <span class=\"o\">:=</span>\n<span class=\"o\">(</span><span class=\"n\">one_mul</span> <span class=\"o\">:</span> <span class=\"bp\">Π</span> <span class=\"o\">(</span><span class=\"n\">a</span> <span class=\"o\">:</span> <span class=\"n\">α</span><span class=\"o\">),</span> <span class=\"mi\">1</span> <span class=\"bp\">*</span> <span class=\"n\">a</span> <span class=\"bp\">=</span> <span class=\"n\">a</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">mul_one</span> <span class=\"o\">:</span> <span class=\"bp\">Π</span> <span class=\"o\">(</span><span class=\"n\">a</span> <span class=\"o\">:</span> <span class=\"n\">α</span><span class=\"o\">),</span> <span class=\"n\">a</span> <span class=\"bp\">*</span> <span class=\"mi\">1</span> <span class=\"bp\">=</span> <span class=\"n\">a</span><span class=\"o\">)</span>\n\n<span class=\"kd\">class</span> <span class=\"n\">has_mul_comm</span> <span class=\"o\">(</span><span class=\"n\">α</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span> <span class=\"n\">u</span><span class=\"o\">)</span> <span class=\"o\">[</span><span class=\"n\">has_mul</span> <span class=\"n\">α</span><span class=\"o\">]</span> <span class=\"o\">:=</span>\n<span class=\"o\">(</span><span class=\"n\">mul_comm</span> <span class=\"o\">:</span> <span class=\"bp\">Π</span> <span class=\"o\">(</span><span class=\"n\">a</span> <span class=\"n\">b</span> <span class=\"o\">:</span> <span class=\"n\">α</span><span class=\"o\">),</span> <span class=\"n\">a</span> <span class=\"bp\">*</span> <span class=\"n\">b</span> <span class=\"bp\">=</span> <span class=\"n\">b</span> <span class=\"bp\">*</span> <span class=\"n\">a</span><span class=\"o\">)</span>\n\n<span class=\"kd\">abbreviation</span> <span class=\"kd\">class</span> <span class=\"n\">semigroup</span> <span class=\"o\">(</span><span class=\"n\">α</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span> <span class=\"n\">u</span><span class=\"o\">)</span> <span class=\"kd\">extends</span> <span class=\"n\">has_mul</span> <span class=\"n\">α</span><span class=\"o\">,</span> <span class=\"n\">has_mul_assoc</span> <span class=\"n\">α</span>\n<span class=\"kd\">abbreviation</span> <span class=\"kd\">class</span> <span class=\"n\">monoid</span> <span class=\"o\">(</span><span class=\"n\">α</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span> <span class=\"n\">u</span><span class=\"o\">)</span> <span class=\"kd\">extends</span> <span class=\"n\">semigroup</span> <span class=\"n\">α</span><span class=\"o\">,</span> <span class=\"n\">has_one</span> <span class=\"n\">α</span><span class=\"o\">,</span> <span class=\"n\">has_mul_one</span> <span class=\"n\">α</span>\n<span class=\"kd\">abbreviation</span> <span class=\"kd\">class</span> <span class=\"n\">comm_semigroup</span> <span class=\"o\">(</span><span class=\"n\">α</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span> <span class=\"n\">u</span><span class=\"o\">)</span> <span class=\"kd\">extends</span> <span class=\"n\">semigroup</span> <span class=\"n\">α</span><span class=\"o\">,</span> <span class=\"n\">has_mul_comm</span> <span class=\"n\">α</span>\n<span class=\"kd\">abbreviation</span> <span class=\"kd\">class</span> <span class=\"n\">comm_monoid</span> <span class=\"o\">(</span><span class=\"n\">α</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span> <span class=\"n\">u</span><span class=\"o\">)</span> <span class=\"kd\">extends</span> <span class=\"n\">monoid</span> <span class=\"n\">α</span><span class=\"o\">,</span> <span class=\"n\">has_mul_comm</span> <span class=\"n\">α</span>\n\n<span class=\"kn\">section</span> <span class=\"n\">inferences</span>\n<span class=\"kd\">variables</span> <span class=\"o\">(</span><span class=\"n\">α</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span> <span class=\"n\">u</span><span class=\"o\">)</span> <span class=\"o\">[</span><span class=\"n\">comm_monoid</span> <span class=\"n\">α</span><span class=\"o\">]</span>\n<span class=\"kd\">example</span> <span class=\"o\">:</span> <span class=\"n\">semigroup</span> <span class=\"n\">α</span> <span class=\"o\">:=</span> <span class=\"n\">infer_instance</span>\n<span class=\"kd\">example</span> <span class=\"o\">:</span> <span class=\"n\">monoid</span> <span class=\"n\">α</span> <span class=\"o\">:=</span> <span class=\"n\">infer_instance</span>\n<span class=\"kd\">example</span> <span class=\"o\">:</span> <span class=\"n\">comm_semigroup</span> <span class=\"n\">α</span> <span class=\"o\">:=</span> <span class=\"n\">infer_instance</span>  <span class=\"c1\">-- Cannot infer this using usual `extends`</span>\n<span class=\"kd\">end</span> <span class=\"n\">inferences</span>\n\n<span class=\"kd\">end</span> <span class=\"n\">flat_structures</span>\n</code></pre></div>",
        "id": 222119200,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1610136550
    },
    {
        "content": "<p>Abbreviation classes make it easier to use a certain solution to the so-called \"expression problem,\" where functions can specify exactly which properties of an object they make use of.  Furthermore, it seems it allows property classes to be refactored without changing user code.</p>",
        "id": 222122808,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1610138400
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"306601\">Kyle Miller</span> <a href=\"#narrow/stream/270676-lean4/topic/to_additive/near/222119200\">said</a>:</p>\n<blockquote>\n<p>It can't be exactly this because it would create infinite loops in typeclass resolution</p>\n</blockquote>\n<p>Not an issue for the Lean 4 typeclass inference</p>",
        "id": 222164350,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1610187587
    },
    {
        "content": "<p>Wait until you also want to put loops, racks, quandles, squags, dioids, spindles and shelfs in the same library, in a backwards compatible manner.  Just because they are not yet 'mainstream' mathematics makes them no less mathematics. </p>\n<p>It's also quite fun to formalize the very large set of modal logics out there. It's a fun exercise in meta-mathematics, because any mathematician that values elegance in the least bit will bridle at the amount of duplication they're forced to do in any system that does handle (6+ dimensional!) diamonds seamlessly.</p>\n<p>The problem with <code>assoc</code> that <span class=\"user-mention\" data-user-id=\"110049\">@Mario Carneiro</span> mentions is huge. And it of course is not specific to <code>assoc</code>, but a symptom of every law: they end up needing to be either human-duplicated, or the 'renaming' problem involved in transporting them from their origin to their use site (where there might be multiple uses) is quite large. I've implemented a couple of hacky solutions in 2 of my systems - and I would not recommend either of those 'solutions' to anyone.</p>\n<p>[tiny rant: The thing with proof systems is that the effort of doing all the proofs is quite significant, so that tends to swallow all the air available, and that's not unreasonable. The problem is that it doesn't leave room left for people to notice just how much duplication there is in their tapestry of theories, definitions and lemmas.  end rant]</p>",
        "id": 222227551,
        "sender_full_name": "Jacques Carette",
        "timestamp": 1610293137
    },
    {
        "content": "<p>We at least have <a href=\"https://leanprover-community.github.io/mathlib_docs/find/shelf\">docs#shelf</a>, <a href=\"https://leanprover-community.github.io/mathlib_docs/find/rack\">docs#rack</a>, and <a href=\"https://leanprover-community.github.io/mathlib_docs/find/quandle\">docs#quandle</a> (and the conjugation quandle <a href=\"https://leanprover-community.github.io/mathlib_docs/find/quandle.conj\">docs#quandle.conj</a> of a group) -- I've heard of loops and spindles, but the other two <em>must</em> be made up! <span aria-label=\"smile\" class=\"emoji emoji-1f642\" role=\"img\" title=\"smile\">:smile:</span>   (Note: shelves are only halfheartedly implemented, and they're only left shelves.)</p>\n<p>Just to add some more complexity to your list, how about also having biracks and biquandles in the same library? (It would be nice to eventually have these: they are actually studied in quantum topology to describe factorizations in quantum groups.)</p>",
        "id": 222229978,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1610296894
    },
    {
        "content": "<p>I’ve always thought that in DTTs, classes should take their operations as parameters, because the identities, inverses, and laws are propositionally-uniquely determined from that, and of course the type can be unification-inferred from the operation (or vice-versa: you need to fix the type to say the operation). That is, instead of <code>Group Nat</code> you would have <code>Group Nat (+)</code> (or maybe just <code>Group (+)</code>). I think it might even play nicely with <code>has_add</code> and <code>has_mul</code>, which are allowed to pick canonical operations for types, while <code>Group</code> would always be told its operation. But of course I don’t spend enough time in proof assistants these days to evaluate my proposal myself ...</p>",
        "id": 222264294,
        "sender_full_name": "Nick Scheel",
        "timestamp": 1610347242
    },
    {
        "content": "<p>I have been surprised myself about how effective the lean approach to this has been. It makes code more readable and seems to have surprisingly few disadvantages.</p>",
        "id": 222265512,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1610349072
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"111651\">@Nick Scheel</span> I think the problem with that approach is that it leads to exponential blow-up in term sizes. Let me try to find the blogpost that explains that.</p>",
        "id": 222265521,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1610349088
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"111651\">@Nick Scheel</span> voila: <a href=\"https://www.ralfj.de/blog/2019/05/15/typeclasses-exponential-blowup.html\">https://www.ralfj.de/blog/2019/05/15/typeclasses-exponential-blowup.html</a></p>",
        "id": 222265681,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1610349324
    },
    {
        "content": "<p>Oh I was just going to ask if it was that post. My understanding is that the style discussed there is just <code>Group A</code> not <code>Group A (+)</code>, i.e. mathlib’s current style.</p>",
        "id": 222265757,
        "sender_full_name": "Nick Scheel",
        "timestamp": 1610349449
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"111651\">@Nick Scheel</span> no, it seems to be the other way round</p>",
        "id": 222267495,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1610351502
    },
    {
        "content": "<p>Oh, I see. I misunderstood arguments vs superclasses. I was only proposing that the operation be an argument, and the rest of the hierarchy would be superclasses (or fields), so it would only be quadratic, I believe.</p>",
        "id": 222269863,
        "sender_full_name": "Nick Scheel",
        "timestamp": 1610353498
    },
    {
        "content": "<p>Am I right in thinking that the blow-up is irrelevant as long we define <code>AddGroup A := Group A (+)</code> at some level in the API, and use that for higher-level things?</p>",
        "id": 222294241,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1610370403
    },
    {
        "content": "<p>From that blog post:</p>\n<blockquote>\n<p>Taking the superclasses as indices instead of embedding them as fields simplifies typeclass search and is necessary to support diamonds in the hierarchy</p>\n</blockquote>\n<p>This sounds like a coq problem that may not translate to lean, unless I'm missing something - my impression is only <code>Op</code>, <code>Unit</code> and <code>Inv</code> need to be arguments, which means that instead of a monster term like <code>Group A (_ : Monoid A (_ : SemiGroup A (*)) 1 inv)</code> as that blog seems to suggest, we can use a shorter <code>Group A (*) 1 inv</code> - so the blow-up does not increase with the depth of the heirarchy, it just increases by one over what we currently have</p>",
        "id": 222295009,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1610370892
    },
    {
        "content": "<p>BTW, I added an example showing how to use unification hints and type classes simultaneously. It creates a bridge between the bundled (<code>Magma</code> in the example) and unbundled (<code>Mul</code> in the example) worlds.<br>\n<a href=\"https://github.com/leanprover/lean4/blob/master/tests/lean/unifHintAndTC.lean#L46-L53\">https://github.com/leanprover/lean4/blob/master/tests/lean/unifHintAndTC.lean#L46-L53</a><br>\nDisclaimer: we don't need this feature to implement Lean. So, we don't know how reliable it is.</p>",
        "id": 222444583,
        "sender_full_name": "Leonardo de Moura",
        "timestamp": 1610464546
    },
    {
        "content": "<p>Thanks to Lean 4's typeclass resolution algorithms, it's possible to make typeclasses that represent when certain operations and axioms are available for a type -- there's no difference between a commutative monoid and a monoid with commutative multiplication.  The pattern automatically gives you the full poset of algebraic structures with the given operations and axioms.</p>\n<p>Before going to that code, I should mention that I tried combining multiplication and addition into single classes with things like</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kd\">class</span> <span class=\"n\">HasComm</span> <span class=\"o\">(</span><span class=\"n\">α</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span> <span class=\"n\">u</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">op</span> <span class=\"o\">:</span> <span class=\"n\">α</span> <span class=\"bp\">→</span> <span class=\"n\">α</span> <span class=\"bp\">→</span> <span class=\"n\">α</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"kt\">Prop</span> <span class=\"n\">where</span>\n    <span class=\"n\">comm</span> <span class=\"o\">:</span> <span class=\"bp\">∀</span> <span class=\"n\">x</span> <span class=\"n\">y</span><span class=\"o\">,</span> <span class=\"n\">op</span> <span class=\"n\">x</span> <span class=\"n\">y</span> <span class=\"bp\">=</span> <span class=\"n\">op</span> <span class=\"n\">y</span> <span class=\"n\">x</span>\n<span class=\"kn\">export</span> <span class=\"n\">HasComm</span> <span class=\"o\">(</span><span class=\"n\">comm</span><span class=\"o\">)</span>\n\n<span class=\"kd\">class</span> <span class=\"n\">HasMulComm</span> <span class=\"o\">(</span><span class=\"n\">α</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span> <span class=\"n\">u</span><span class=\"o\">)</span> <span class=\"o\">[</span><span class=\"n\">Mul</span> <span class=\"n\">α</span><span class=\"o\">]</span> <span class=\"kd\">extends</span> <span class=\"n\">HasComm</span> <span class=\"n\">α</span> <span class=\"n\">HMul.hMul</span>\n<span class=\"kd\">def</span> <span class=\"n\">mulComm</span> <span class=\"o\">[</span><span class=\"n\">Mul</span> <span class=\"n\">α</span><span class=\"o\">]</span> <span class=\"o\">[</span><span class=\"n\">h</span> <span class=\"o\">:</span> <span class=\"n\">HasMulComm</span> <span class=\"n\">α</span><span class=\"o\">]</span> <span class=\"o\">:=</span> <span class=\"n\">h.comm</span>\n\n<span class=\"kd\">class</span> <span class=\"n\">HasAddComm</span> <span class=\"o\">(</span><span class=\"n\">α</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span> <span class=\"n\">u</span><span class=\"o\">)</span> <span class=\"o\">[</span><span class=\"n\">Add</span> <span class=\"n\">α</span><span class=\"o\">]</span> <span class=\"kd\">extends</span> <span class=\"n\">HasComm</span> <span class=\"n\">α</span> <span class=\"n\">HAdd.hAdd</span>\n<span class=\"kd\">def</span> <span class=\"n\">addComm</span> <span class=\"o\">[</span><span class=\"n\">Add</span> <span class=\"n\">α</span><span class=\"o\">]</span> <span class=\"o\">[</span><span class=\"n\">h</span> <span class=\"o\">:</span> <span class=\"n\">HasAddComm</span> <span class=\"n\">α</span><span class=\"o\">]</span> <span class=\"o\">:=</span> <span class=\"n\">h.comm</span>\n</code></pre></div>\n<p>but the issue I ran into is that you get name conflicts when you try to extend both <code>HasMulComm</code> and <code>HasAddComm</code>.</p>\n<p>Anyway, here's the algebraic hierarchy I was experimenting with.  The pattern is to (1) split off all axioms as classes and (2) give the constructors for the algebraic objects the <code>instance</code> attribute so that they are automatically constructed when all the axioms are available.  If it's not too expensive, you can add instances when certain collections of axioms imply others to help \"coerce\" algebraic objects.  Below I made it so that a <code>Ring</code> is a <code>Semiring</code> by adding the instance that a <code>Ring</code> has <code>ZeroMul</code>.</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"c\">/-</span><span class=\"cm\"> from core:</span>\n<span class=\"cm\">class OfNat (α : Type u) (n : Nat) where</span>\n<span class=\"cm\">  ofNat : α</span>\n<span class=\"cm\">class Mul (α : Type u) where</span>\n<span class=\"cm\">  mul : α → α → α</span>\n<span class=\"cm\">class Add (α : Type u) where</span>\n<span class=\"cm\">  add : α → α → α</span>\n<span class=\"cm\">-/</span>\n\n<span class=\"kd\">class</span> <span class=\"n\">Inv</span> <span class=\"o\">(</span><span class=\"n\">α</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span> <span class=\"n\">u</span><span class=\"o\">)</span> <span class=\"n\">where</span>\n    <span class=\"n\">inv</span> <span class=\"o\">:</span> <span class=\"n\">α</span> <span class=\"bp\">→</span> <span class=\"n\">α</span>\n\n<span class=\"kd\">postfix</span><span class=\"o\">:</span><span class=\"n\">max</span> <span class=\"s2\">\"⁻¹\"</span> <span class=\"bp\">=&gt;</span> <span class=\"n\">Inv.inv</span>\n\n<span class=\"kd\">class</span> <span class=\"n\">One</span> <span class=\"o\">(</span><span class=\"n\">α</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span> <span class=\"n\">u</span><span class=\"o\">)</span> <span class=\"n\">where</span>\n    <span class=\"n\">one</span> <span class=\"o\">:</span> <span class=\"n\">α</span>\n<span class=\"kn\">export</span> <span class=\"n\">One</span> <span class=\"o\">(</span><span class=\"n\">one</span><span class=\"o\">)</span>\n\n<span class=\"kd\">instance</span> <span class=\"o\">[</span><span class=\"n\">One</span> <span class=\"n\">α</span><span class=\"o\">]</span> <span class=\"o\">:</span> <span class=\"n\">OfNat</span> <span class=\"n\">α</span> <span class=\"o\">(</span><span class=\"n\">natLit</span><span class=\"bp\">!</span> <span class=\"mi\">1</span><span class=\"o\">)</span> <span class=\"n\">where</span>\n    <span class=\"n\">ofNat</span> <span class=\"o\">:=</span> <span class=\"n\">one</span>\n\n<span class=\"kd\">class</span> <span class=\"n\">Zero</span> <span class=\"o\">(</span><span class=\"n\">α</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span> <span class=\"n\">u</span><span class=\"o\">)</span> <span class=\"n\">where</span>\n    <span class=\"n\">zero</span> <span class=\"o\">:</span> <span class=\"n\">α</span>\n<span class=\"kn\">export</span> <span class=\"n\">Zero</span> <span class=\"o\">(</span><span class=\"n\">zero</span><span class=\"o\">)</span>\n\n<span class=\"kd\">instance</span> <span class=\"o\">[</span><span class=\"n\">Zero</span> <span class=\"n\">α</span><span class=\"o\">]</span> <span class=\"o\">:</span> <span class=\"n\">OfNat</span> <span class=\"n\">α</span> <span class=\"o\">(</span><span class=\"n\">natLit</span><span class=\"bp\">!</span> <span class=\"mi\">0</span><span class=\"o\">)</span> <span class=\"n\">where</span>\n    <span class=\"n\">ofNat</span> <span class=\"o\">:=</span> <span class=\"n\">zero</span>\n\n<span class=\"kd\">class</span> <span class=\"n\">MulComm</span> <span class=\"o\">(</span><span class=\"n\">α</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span> <span class=\"n\">u</span><span class=\"o\">)</span> <span class=\"o\">[</span><span class=\"n\">Mul</span> <span class=\"n\">α</span><span class=\"o\">]</span> <span class=\"o\">:</span> <span class=\"kt\">Prop</span> <span class=\"n\">where</span>\n    <span class=\"n\">mulComm</span> <span class=\"o\">:</span> <span class=\"o\">{</span><span class=\"n\">a</span> <span class=\"n\">b</span> <span class=\"o\">:</span> <span class=\"n\">α</span><span class=\"o\">}</span> <span class=\"bp\">→</span> <span class=\"n\">a</span> <span class=\"bp\">*</span> <span class=\"n\">b</span> <span class=\"bp\">=</span> <span class=\"n\">b</span> <span class=\"bp\">*</span> <span class=\"n\">a</span>\n<span class=\"kn\">export</span> <span class=\"n\">MulComm</span> <span class=\"o\">(</span><span class=\"n\">mulComm</span><span class=\"o\">)</span>\n\n<span class=\"kd\">class</span> <span class=\"n\">MulAssoc</span> <span class=\"o\">(</span><span class=\"n\">α</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span> <span class=\"n\">u</span><span class=\"o\">)</span> <span class=\"o\">[</span><span class=\"n\">Mul</span> <span class=\"n\">α</span><span class=\"o\">]</span> <span class=\"o\">:</span> <span class=\"kt\">Prop</span> <span class=\"n\">where</span>\n    <span class=\"n\">mulAssoc</span> <span class=\"o\">:</span> <span class=\"o\">{</span><span class=\"n\">a</span> <span class=\"n\">b</span> <span class=\"n\">c</span> <span class=\"o\">:</span> <span class=\"n\">α</span><span class=\"o\">}</span> <span class=\"bp\">→</span> <span class=\"n\">a</span> <span class=\"bp\">*</span> <span class=\"n\">b</span> <span class=\"bp\">*</span> <span class=\"n\">c</span> <span class=\"bp\">=</span> <span class=\"n\">a</span> <span class=\"bp\">*</span> <span class=\"o\">(</span><span class=\"n\">b</span> <span class=\"bp\">*</span> <span class=\"n\">c</span><span class=\"o\">)</span>\n<span class=\"kn\">export</span> <span class=\"n\">MulAssoc</span> <span class=\"o\">(</span><span class=\"n\">mulAssoc</span><span class=\"o\">)</span>\n\n<span class=\"kd\">class</span> <span class=\"n\">OneUnit</span> <span class=\"o\">(</span><span class=\"n\">α</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span> <span class=\"n\">u</span><span class=\"o\">)</span> <span class=\"o\">[</span><span class=\"n\">Mul</span> <span class=\"n\">α</span><span class=\"o\">]</span> <span class=\"o\">[</span><span class=\"n\">One</span> <span class=\"n\">α</span><span class=\"o\">]</span> <span class=\"o\">:</span> <span class=\"kt\">Prop</span> <span class=\"n\">where</span>\n    <span class=\"n\">oneMul</span> <span class=\"o\">:</span> <span class=\"o\">{</span><span class=\"n\">a</span> <span class=\"o\">:</span> <span class=\"n\">α</span><span class=\"o\">}</span> <span class=\"bp\">→</span> <span class=\"mi\">1</span> <span class=\"bp\">*</span> <span class=\"n\">a</span> <span class=\"bp\">=</span> <span class=\"n\">a</span>\n    <span class=\"n\">mulOne</span> <span class=\"o\">:</span> <span class=\"o\">{</span><span class=\"n\">a</span> <span class=\"o\">:</span> <span class=\"n\">α</span><span class=\"o\">}</span> <span class=\"bp\">→</span> <span class=\"n\">a</span> <span class=\"bp\">*</span> <span class=\"mi\">1</span> <span class=\"bp\">=</span> <span class=\"n\">a</span>\n<span class=\"kn\">export</span> <span class=\"n\">OneUnit</span> <span class=\"o\">(</span><span class=\"n\">oneMul</span> <span class=\"n\">mulOne</span><span class=\"o\">)</span>\n\n<span class=\"kd\">class</span> <span class=\"n\">AddComm</span> <span class=\"o\">(</span><span class=\"n\">α</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span> <span class=\"n\">u</span><span class=\"o\">)</span> <span class=\"o\">[</span><span class=\"n\">Add</span> <span class=\"n\">α</span><span class=\"o\">]</span> <span class=\"o\">:</span> <span class=\"kt\">Prop</span> <span class=\"n\">where</span>\n    <span class=\"n\">addComm</span> <span class=\"o\">:</span> <span class=\"o\">{</span><span class=\"n\">a</span> <span class=\"n\">b</span> <span class=\"o\">:</span> <span class=\"n\">α</span><span class=\"o\">}</span> <span class=\"bp\">→</span> <span class=\"n\">a</span> <span class=\"bp\">+</span> <span class=\"n\">b</span> <span class=\"bp\">=</span> <span class=\"n\">b</span> <span class=\"bp\">+</span> <span class=\"n\">a</span>\n<span class=\"kn\">export</span> <span class=\"n\">AddComm</span> <span class=\"o\">(</span><span class=\"n\">addComm</span><span class=\"o\">)</span>\n\n<span class=\"kd\">class</span> <span class=\"n\">AddAssoc</span> <span class=\"o\">(</span><span class=\"n\">α</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span> <span class=\"n\">u</span><span class=\"o\">)</span> <span class=\"o\">[</span><span class=\"n\">Add</span> <span class=\"n\">α</span><span class=\"o\">]</span> <span class=\"o\">:</span> <span class=\"kt\">Prop</span> <span class=\"n\">where</span>\n    <span class=\"n\">addAssoc</span> <span class=\"o\">:</span> <span class=\"o\">{</span><span class=\"n\">a</span> <span class=\"n\">b</span> <span class=\"n\">c</span> <span class=\"o\">:</span> <span class=\"n\">α</span><span class=\"o\">}</span> <span class=\"bp\">→</span> <span class=\"n\">a</span> <span class=\"bp\">+</span> <span class=\"n\">b</span> <span class=\"bp\">+</span> <span class=\"n\">c</span> <span class=\"bp\">=</span> <span class=\"n\">a</span> <span class=\"bp\">+</span> <span class=\"o\">(</span><span class=\"n\">b</span> <span class=\"bp\">+</span> <span class=\"n\">c</span><span class=\"o\">)</span>\n<span class=\"kn\">export</span> <span class=\"n\">AddAssoc</span> <span class=\"o\">(</span><span class=\"n\">addAssoc</span><span class=\"o\">)</span>\n\n<span class=\"kd\">class</span> <span class=\"n\">ZeroUnit</span> <span class=\"o\">(</span><span class=\"n\">α</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span> <span class=\"n\">u</span><span class=\"o\">)</span> <span class=\"o\">[</span><span class=\"n\">Add</span> <span class=\"n\">α</span><span class=\"o\">]</span> <span class=\"o\">[</span><span class=\"n\">Zero</span> <span class=\"n\">α</span><span class=\"o\">]</span> <span class=\"o\">:</span> <span class=\"kt\">Prop</span> <span class=\"n\">where</span>\n    <span class=\"n\">zeroAdd</span> <span class=\"o\">:</span> <span class=\"o\">{</span><span class=\"n\">a</span> <span class=\"o\">:</span> <span class=\"n\">α</span><span class=\"o\">}</span> <span class=\"bp\">→</span> <span class=\"mi\">0</span> <span class=\"bp\">+</span> <span class=\"n\">a</span> <span class=\"bp\">=</span> <span class=\"n\">a</span>\n    <span class=\"n\">addZero</span> <span class=\"o\">:</span> <span class=\"o\">{</span><span class=\"n\">a</span> <span class=\"o\">:</span> <span class=\"n\">α</span><span class=\"o\">}</span> <span class=\"bp\">→</span> <span class=\"n\">a</span> <span class=\"bp\">+</span> <span class=\"mi\">0</span> <span class=\"bp\">=</span> <span class=\"n\">a</span>\n<span class=\"kn\">export</span> <span class=\"n\">ZeroUnit</span> <span class=\"o\">(</span><span class=\"n\">zeroAdd</span> <span class=\"n\">addZero</span><span class=\"o\">)</span>\n\n<span class=\"kd\">class</span> <span class=\"n\">InvMul</span> <span class=\"o\">(</span><span class=\"n\">α</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span> <span class=\"n\">u</span><span class=\"o\">)</span> <span class=\"o\">[</span><span class=\"n\">Mul</span> <span class=\"n\">α</span><span class=\"o\">]</span> <span class=\"o\">[</span><span class=\"n\">One</span> <span class=\"n\">α</span><span class=\"o\">]</span> <span class=\"o\">[</span><span class=\"n\">Inv</span> <span class=\"n\">α</span><span class=\"o\">]</span> <span class=\"o\">:</span> <span class=\"kt\">Prop</span> <span class=\"n\">where</span>\n    <span class=\"n\">invMul</span> <span class=\"o\">:</span> <span class=\"o\">{</span><span class=\"n\">a</span> <span class=\"o\">:</span> <span class=\"n\">α</span><span class=\"o\">}</span> <span class=\"bp\">→</span> <span class=\"n\">a</span><span class=\"bp\">⁻¹</span> <span class=\"bp\">*</span> <span class=\"n\">a</span> <span class=\"bp\">=</span> <span class=\"mi\">1</span>\n<span class=\"kn\">export</span> <span class=\"n\">InvMul</span> <span class=\"o\">(</span><span class=\"n\">invMul</span><span class=\"o\">)</span>\n\n<span class=\"kd\">class</span> <span class=\"n\">NegAdd</span> <span class=\"o\">(</span><span class=\"n\">α</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span> <span class=\"n\">u</span><span class=\"o\">)</span> <span class=\"o\">[</span><span class=\"n\">Add</span> <span class=\"n\">α</span><span class=\"o\">]</span> <span class=\"o\">[</span><span class=\"n\">Zero</span> <span class=\"n\">α</span><span class=\"o\">]</span> <span class=\"o\">[</span><span class=\"n\">Neg</span> <span class=\"n\">α</span><span class=\"o\">]</span> <span class=\"o\">:</span> <span class=\"kt\">Prop</span> <span class=\"n\">where</span>\n    <span class=\"n\">negAdd</span> <span class=\"o\">:</span> <span class=\"o\">{</span><span class=\"n\">a</span> <span class=\"o\">:</span> <span class=\"n\">α</span><span class=\"o\">}</span> <span class=\"bp\">→</span> <span class=\"bp\">-</span><span class=\"n\">a</span> <span class=\"bp\">+</span> <span class=\"n\">a</span> <span class=\"bp\">=</span> <span class=\"mi\">0</span>\n<span class=\"kn\">export</span> <span class=\"n\">NegAdd</span> <span class=\"o\">(</span><span class=\"n\">negAdd</span><span class=\"o\">)</span>\n\n<span class=\"kd\">class</span> <span class=\"n\">ZeroMul</span> <span class=\"o\">(</span><span class=\"n\">α</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span> <span class=\"n\">u</span><span class=\"o\">)</span> <span class=\"o\">[</span><span class=\"n\">Mul</span> <span class=\"n\">α</span><span class=\"o\">]</span> <span class=\"o\">[</span><span class=\"n\">Zero</span> <span class=\"n\">α</span><span class=\"o\">]</span> <span class=\"o\">:</span> <span class=\"kt\">Prop</span> <span class=\"n\">where</span>\n    <span class=\"n\">zeroMul</span> <span class=\"o\">:</span> <span class=\"o\">{</span><span class=\"n\">a</span> <span class=\"o\">:</span> <span class=\"n\">α</span><span class=\"o\">}</span> <span class=\"bp\">→</span> <span class=\"mi\">0</span> <span class=\"bp\">*</span> <span class=\"n\">a</span> <span class=\"bp\">=</span> <span class=\"mi\">0</span>\n<span class=\"kn\">export</span> <span class=\"n\">ZeroMul</span> <span class=\"o\">(</span><span class=\"n\">zeroMul</span><span class=\"o\">)</span>\n\n<span class=\"kd\">class</span> <span class=\"n\">Distrib</span> <span class=\"o\">(</span><span class=\"n\">α</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span> <span class=\"n\">u</span><span class=\"o\">)</span> <span class=\"o\">[</span><span class=\"n\">Add</span> <span class=\"n\">α</span><span class=\"o\">]</span> <span class=\"o\">[</span><span class=\"n\">Mul</span> <span class=\"n\">α</span><span class=\"o\">]</span> <span class=\"o\">:</span> <span class=\"kt\">Prop</span> <span class=\"n\">where</span>\n    <span class=\"n\">leftDistrib</span> <span class=\"o\">:</span> <span class=\"o\">{</span><span class=\"n\">a</span> <span class=\"n\">b</span> <span class=\"n\">c</span> <span class=\"o\">:</span> <span class=\"n\">α</span><span class=\"o\">}</span> <span class=\"bp\">→</span> <span class=\"n\">a</span> <span class=\"bp\">*</span> <span class=\"o\">(</span><span class=\"n\">b</span> <span class=\"bp\">+</span> <span class=\"n\">c</span><span class=\"o\">)</span> <span class=\"bp\">=</span> <span class=\"n\">a</span> <span class=\"bp\">*</span> <span class=\"n\">b</span> <span class=\"bp\">+</span> <span class=\"n\">a</span> <span class=\"bp\">*</span> <span class=\"n\">c</span>\n    <span class=\"n\">rightDistrib</span> <span class=\"o\">:</span> <span class=\"o\">{</span><span class=\"n\">a</span> <span class=\"n\">b</span> <span class=\"n\">c</span> <span class=\"o\">:</span> <span class=\"n\">α</span><span class=\"o\">}</span> <span class=\"bp\">→</span> <span class=\"o\">(</span><span class=\"n\">a</span> <span class=\"bp\">+</span> <span class=\"n\">b</span><span class=\"o\">)</span> <span class=\"bp\">*</span> <span class=\"n\">c</span> <span class=\"bp\">=</span> <span class=\"n\">a</span> <span class=\"bp\">*</span> <span class=\"n\">c</span> <span class=\"bp\">+</span> <span class=\"n\">b</span> <span class=\"bp\">*</span> <span class=\"n\">c</span>\n<span class=\"kn\">export</span> <span class=\"n\">Distrib</span> <span class=\"o\">(</span><span class=\"n\">leftDistrib</span> <span class=\"n\">rightDistrib</span><span class=\"o\">)</span>\n\n<span class=\"kd\">class</span> <span class=\"n\">Domain</span> <span class=\"o\">(</span><span class=\"n\">α</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span> <span class=\"n\">u</span><span class=\"o\">)</span> <span class=\"o\">[</span><span class=\"n\">Mul</span> <span class=\"n\">α</span><span class=\"o\">]</span> <span class=\"o\">[</span><span class=\"n\">Zero</span> <span class=\"n\">α</span><span class=\"o\">]</span> <span class=\"o\">:</span> <span class=\"kt\">Prop</span> <span class=\"n\">where</span>\n    <span class=\"n\">eqZeroOrEqZeroOfMulEqZero</span> <span class=\"o\">:</span> <span class=\"o\">{</span><span class=\"n\">a</span> <span class=\"n\">b</span> <span class=\"o\">:</span> <span class=\"n\">α</span><span class=\"o\">}</span> <span class=\"bp\">→</span> <span class=\"n\">a</span> <span class=\"bp\">*</span> <span class=\"n\">b</span> <span class=\"bp\">=</span> <span class=\"mi\">0</span> <span class=\"bp\">→</span> <span class=\"n\">a</span> <span class=\"bp\">=</span> <span class=\"mi\">0</span> <span class=\"bp\">∨</span> <span class=\"n\">b</span> <span class=\"bp\">=</span> <span class=\"mi\">0</span>\n<span class=\"kn\">export</span> <span class=\"n\">Domain</span> <span class=\"o\">(</span><span class=\"n\">eqZeroOrEqZeroOfMulEqZero</span><span class=\"o\">)</span>\n\n<span class=\"kd\">class</span> <span class=\"n\">Semigroup</span> <span class=\"o\">(</span><span class=\"n\">α</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span> <span class=\"n\">u</span><span class=\"o\">)</span> <span class=\"kd\">extends</span> <span class=\"n\">Mul</span> <span class=\"n\">α</span><span class=\"o\">,</span> <span class=\"n\">MulAssoc</span> <span class=\"n\">α</span>\n<span class=\"kn\">attribute</span> <span class=\"o\">[</span><span class=\"kd\">instance</span><span class=\"o\">]</span> <span class=\"n\">Semigroup.mk</span>\n\n<span class=\"kd\">class</span> <span class=\"n\">AddSemigroup</span> <span class=\"o\">(</span><span class=\"n\">α</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span> <span class=\"n\">u</span><span class=\"o\">)</span> <span class=\"kd\">extends</span> <span class=\"n\">Add</span> <span class=\"n\">α</span><span class=\"o\">,</span> <span class=\"n\">AddAssoc</span> <span class=\"n\">α</span>\n<span class=\"kn\">attribute</span> <span class=\"o\">[</span><span class=\"kd\">instance</span><span class=\"o\">]</span> <span class=\"n\">AddSemigroup.mk</span>\n\n<span class=\"kd\">class</span> <span class=\"n\">Monoid</span> <span class=\"o\">(</span><span class=\"n\">α</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span> <span class=\"n\">u</span><span class=\"o\">)</span> <span class=\"kd\">extends</span> <span class=\"n\">Semigroup</span> <span class=\"n\">α</span><span class=\"o\">,</span> <span class=\"n\">One</span> <span class=\"n\">α</span><span class=\"o\">,</span> <span class=\"n\">OneUnit</span> <span class=\"n\">α</span>\n<span class=\"kn\">attribute</span> <span class=\"o\">[</span><span class=\"kd\">instance</span><span class=\"o\">]</span> <span class=\"n\">Monoid.mk</span>\n\n<span class=\"kd\">class</span> <span class=\"n\">AddMonoid</span> <span class=\"o\">(</span><span class=\"n\">α</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span> <span class=\"n\">u</span><span class=\"o\">)</span> <span class=\"kd\">extends</span> <span class=\"n\">AddSemigroup</span> <span class=\"n\">α</span><span class=\"o\">,</span> <span class=\"n\">Zero</span> <span class=\"n\">α</span><span class=\"o\">,</span> <span class=\"n\">ZeroUnit</span> <span class=\"n\">α</span>\n<span class=\"kn\">attribute</span> <span class=\"o\">[</span><span class=\"kd\">instance</span><span class=\"o\">]</span> <span class=\"n\">AddMonoid.mk</span>\n\n<span class=\"kd\">class</span> <span class=\"n\">CommSemigroup</span> <span class=\"o\">(</span><span class=\"n\">α</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span> <span class=\"n\">u</span><span class=\"o\">)</span> <span class=\"kd\">extends</span> <span class=\"n\">Semigroup</span> <span class=\"n\">α</span><span class=\"o\">,</span> <span class=\"n\">MulComm</span> <span class=\"n\">α</span>\n<span class=\"kn\">attribute</span> <span class=\"o\">[</span><span class=\"kd\">instance</span><span class=\"o\">]</span> <span class=\"n\">CommSemigroup.mk</span>\n\n<span class=\"kd\">class</span> <span class=\"n\">CommMonoid</span> <span class=\"o\">(</span><span class=\"n\">α</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span> <span class=\"n\">u</span><span class=\"o\">)</span> <span class=\"kd\">extends</span> <span class=\"n\">Monoid</span> <span class=\"n\">α</span><span class=\"o\">,</span> <span class=\"n\">MulComm</span> <span class=\"n\">α</span>\n<span class=\"kn\">attribute</span> <span class=\"o\">[</span><span class=\"kd\">instance</span><span class=\"o\">]</span> <span class=\"n\">CommMonoid.mk</span>\n\n<span class=\"kd\">class</span> <span class=\"n\">Group</span> <span class=\"o\">(</span><span class=\"n\">α</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span> <span class=\"n\">u</span><span class=\"o\">)</span> <span class=\"kd\">extends</span> <span class=\"n\">Monoid</span> <span class=\"n\">α</span><span class=\"o\">,</span> <span class=\"n\">Inv</span> <span class=\"n\">α</span><span class=\"o\">,</span> <span class=\"n\">InvMul</span> <span class=\"n\">α</span>\n<span class=\"kn\">attribute</span> <span class=\"o\">[</span><span class=\"kd\">instance</span><span class=\"o\">]</span> <span class=\"n\">Group.mk</span>\n\n<span class=\"kd\">class</span> <span class=\"n\">AddGroup</span> <span class=\"o\">(</span><span class=\"n\">α</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span> <span class=\"n\">u</span><span class=\"o\">)</span> <span class=\"kd\">extends</span> <span class=\"n\">AddMonoid</span> <span class=\"n\">α</span><span class=\"o\">,</span> <span class=\"n\">Neg</span> <span class=\"n\">α</span><span class=\"o\">,</span> <span class=\"n\">NegAdd</span> <span class=\"n\">α</span>\n<span class=\"kn\">attribute</span> <span class=\"o\">[</span><span class=\"kd\">instance</span><span class=\"o\">]</span> <span class=\"n\">AddGroup.mk</span>\n\n<span class=\"kd\">class</span> <span class=\"n\">Semiring</span> <span class=\"o\">(</span><span class=\"n\">α</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span> <span class=\"n\">u</span><span class=\"o\">)</span> <span class=\"kd\">extends</span> <span class=\"n\">AddMonoid</span> <span class=\"n\">α</span><span class=\"o\">,</span> <span class=\"n\">Monoid</span> <span class=\"n\">α</span><span class=\"o\">,</span> <span class=\"n\">AddComm</span> <span class=\"n\">α</span><span class=\"o\">,</span> <span class=\"n\">ZeroMul</span> <span class=\"n\">α</span><span class=\"o\">,</span> <span class=\"n\">Distrib</span> <span class=\"n\">α</span>\n<span class=\"kn\">attribute</span> <span class=\"o\">[</span><span class=\"kd\">instance</span><span class=\"o\">]</span> <span class=\"n\">Semiring.mk</span>\n\n<span class=\"kd\">class</span> <span class=\"n\">Ring</span> <span class=\"o\">(</span><span class=\"n\">α</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span> <span class=\"n\">u</span><span class=\"o\">)</span> <span class=\"kd\">extends</span> <span class=\"n\">AddGroup</span> <span class=\"n\">α</span><span class=\"o\">,</span> <span class=\"n\">Monoid</span> <span class=\"n\">α</span><span class=\"o\">,</span> <span class=\"n\">AddComm</span> <span class=\"n\">α</span><span class=\"o\">,</span> <span class=\"n\">Distrib</span> <span class=\"n\">α</span>\n<span class=\"kn\">attribute</span> <span class=\"o\">[</span><span class=\"kd\">instance</span><span class=\"o\">]</span> <span class=\"n\">Ring.mk</span>\n\n<span class=\"kd\">class</span> <span class=\"n\">CommRing</span> <span class=\"o\">(</span><span class=\"n\">α</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span> <span class=\"n\">u</span><span class=\"o\">)</span> <span class=\"kd\">extends</span> <span class=\"n\">Ring</span> <span class=\"n\">α</span><span class=\"o\">,</span> <span class=\"n\">MulComm</span> <span class=\"n\">α</span>\n<span class=\"kn\">attribute</span> <span class=\"o\">[</span><span class=\"kd\">instance</span><span class=\"o\">]</span> <span class=\"n\">CommRing.mk</span>\n\n<span class=\"kd\">class</span> <span class=\"n\">IntegralDomain</span> <span class=\"o\">(</span><span class=\"n\">α</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span> <span class=\"n\">u</span><span class=\"o\">)</span> <span class=\"kd\">extends</span> <span class=\"n\">CommRing</span> <span class=\"n\">α</span><span class=\"o\">,</span> <span class=\"n\">Domain</span> <span class=\"n\">α</span>\n<span class=\"kn\">attribute</span> <span class=\"o\">[</span><span class=\"kd\">instance</span><span class=\"o\">]</span> <span class=\"n\">IntegralDomain.mk</span>\n\n<span class=\"kn\">section</span> <span class=\"n\">test1</span>\n<span class=\"kd\">variables</span> <span class=\"o\">(</span><span class=\"n\">α</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span> <span class=\"n\">u</span><span class=\"o\">)</span> <span class=\"o\">[</span><span class=\"n\">h</span> <span class=\"o\">:</span> <span class=\"n\">CommMonoid</span> <span class=\"n\">α</span><span class=\"o\">]</span>\n<span class=\"kd\">example</span> <span class=\"o\">:</span> <span class=\"n\">Semigroup</span> <span class=\"n\">α</span> <span class=\"o\">:=</span> <span class=\"n\">inferInstance</span>\n<span class=\"kd\">example</span> <span class=\"o\">:</span> <span class=\"n\">Monoid</span> <span class=\"n\">α</span> <span class=\"o\">:=</span> <span class=\"n\">inferInstance</span>\n<span class=\"kd\">example</span> <span class=\"o\">:</span> <span class=\"n\">CommSemigroup</span> <span class=\"n\">α</span> <span class=\"o\">:=</span> <span class=\"n\">inferInstance</span>\n<span class=\"kd\">end</span> <span class=\"n\">test1</span>\n\n<span class=\"kn\">section</span> <span class=\"n\">test2</span>\n<span class=\"kd\">variables</span> <span class=\"o\">(</span><span class=\"n\">β</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span> <span class=\"n\">u</span><span class=\"o\">)</span> <span class=\"o\">[</span><span class=\"n\">CommSemigroup</span> <span class=\"n\">β</span><span class=\"o\">]</span> <span class=\"o\">[</span><span class=\"n\">One</span> <span class=\"n\">β</span><span class=\"o\">]</span> <span class=\"o\">[</span><span class=\"n\">OneUnit</span> <span class=\"n\">β</span><span class=\"o\">]</span>\n<span class=\"kd\">example</span> <span class=\"o\">:</span> <span class=\"n\">Monoid</span> <span class=\"n\">β</span> <span class=\"o\">:=</span> <span class=\"n\">inferInstance</span>\n<span class=\"kd\">example</span> <span class=\"o\">:</span> <span class=\"n\">CommMonoid</span> <span class=\"n\">β</span> <span class=\"o\">:=</span> <span class=\"n\">inferInstance</span>\n<span class=\"kd\">example</span> <span class=\"o\">:</span> <span class=\"n\">Semigroup</span> <span class=\"n\">β</span> <span class=\"o\">:=</span> <span class=\"n\">inferInstance</span>\n<span class=\"kd\">end</span> <span class=\"n\">test2</span>\n\n<span class=\"kn\">section</span> <span class=\"n\">test3</span>\n<span class=\"kd\">variables</span> <span class=\"o\">(</span><span class=\"n\">β</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span> <span class=\"n\">u</span><span class=\"o\">)</span> <span class=\"o\">[</span><span class=\"n\">Mul</span> <span class=\"n\">β</span><span class=\"o\">]</span> <span class=\"o\">[</span><span class=\"n\">One</span> <span class=\"n\">β</span><span class=\"o\">]</span> <span class=\"o\">[</span><span class=\"n\">MulAssoc</span> <span class=\"n\">β</span><span class=\"o\">]</span> <span class=\"o\">[</span><span class=\"n\">OneUnit</span> <span class=\"n\">β</span><span class=\"o\">]</span>\n<span class=\"kd\">example</span> <span class=\"o\">:</span> <span class=\"n\">Monoid</span> <span class=\"n\">β</span> <span class=\"o\">:=</span> <span class=\"n\">inferInstance</span>\n<span class=\"kd\">example</span> <span class=\"o\">:</span> <span class=\"n\">Semigroup</span> <span class=\"n\">β</span> <span class=\"o\">:=</span> <span class=\"n\">inferInstance</span>\n<span class=\"kd\">end</span> <span class=\"n\">test3</span>\n\n<span class=\"kd\">theorem</span> <span class=\"n\">negZero</span> <span class=\"o\">[</span><span class=\"n\">AddGroup</span> <span class=\"n\">α</span><span class=\"o\">]</span> <span class=\"o\">:</span> <span class=\"bp\">-</span><span class=\"o\">(</span><span class=\"mi\">0</span> <span class=\"o\">:</span> <span class=\"n\">α</span><span class=\"o\">)</span> <span class=\"bp\">=</span> <span class=\"mi\">0</span> <span class=\"o\">:=</span> <span class=\"kd\">by</span>\n    <span class=\"n\">rw</span> <span class=\"o\">[</span><span class=\"bp\">←</span><span class=\"n\">addZero</span> <span class=\"o\">(</span><span class=\"n\">a</span> <span class=\"o\">:=</span> <span class=\"bp\">-</span><span class=\"o\">(</span><span class=\"mi\">0</span> <span class=\"o\">:</span> <span class=\"n\">α</span><span class=\"o\">)),</span> <span class=\"n\">negAdd</span><span class=\"o\">]</span>\n\n<span class=\"kd\">theorem</span> <span class=\"n\">subZero</span> <span class=\"o\">[</span><span class=\"n\">AddGroup</span> <span class=\"n\">α</span><span class=\"o\">]</span> <span class=\"o\">{</span><span class=\"n\">a</span> <span class=\"o\">:</span> <span class=\"n\">α</span><span class=\"o\">}</span> <span class=\"o\">:</span> <span class=\"n\">a</span> <span class=\"bp\">+</span> <span class=\"bp\">-</span><span class=\"o\">(</span><span class=\"mi\">0</span> <span class=\"o\">:</span> <span class=\"n\">α</span><span class=\"o\">)</span> <span class=\"bp\">=</span> <span class=\"n\">a</span> <span class=\"o\">:=</span> <span class=\"kd\">by</span>\n    <span class=\"n\">rw</span> <span class=\"o\">[</span><span class=\"bp\">←</span><span class=\"n\">addZero</span> <span class=\"o\">(</span><span class=\"n\">a</span> <span class=\"o\">:=</span> <span class=\"n\">a</span><span class=\"o\">),</span> <span class=\"n\">addAssoc</span><span class=\"o\">,</span> <span class=\"n\">negZero</span><span class=\"o\">,</span> <span class=\"n\">addZero</span><span class=\"o\">]</span>\n\n<span class=\"kd\">theorem</span> <span class=\"n\">negNeg</span> <span class=\"o\">[</span><span class=\"n\">AddGroup</span> <span class=\"n\">α</span><span class=\"o\">]</span> <span class=\"o\">{</span><span class=\"n\">a</span> <span class=\"o\">:</span> <span class=\"n\">α</span><span class=\"o\">}</span> <span class=\"o\">:</span> <span class=\"bp\">-</span><span class=\"o\">(</span><span class=\"bp\">-</span><span class=\"n\">a</span><span class=\"o\">)</span> <span class=\"bp\">=</span> <span class=\"n\">a</span> <span class=\"o\">:=</span> <span class=\"kd\">by</span> <span class=\"o\">{</span>\n    <span class=\"n\">rw</span> <span class=\"bp\">←</span><span class=\"n\">addZero</span> <span class=\"o\">(</span><span class=\"n\">a</span> <span class=\"o\">:=</span> <span class=\"bp\">-</span> <span class=\"bp\">-</span><span class=\"n\">a</span><span class=\"o\">)</span><span class=\"bp\">;</span>\n    <span class=\"n\">rw</span> <span class=\"bp\">←</span><span class=\"n\">negAdd</span> <span class=\"o\">(</span><span class=\"n\">a</span> <span class=\"o\">:=</span> <span class=\"n\">a</span><span class=\"o\">)</span><span class=\"bp\">;</span>\n    <span class=\"n\">rw</span> <span class=\"bp\">←</span><span class=\"n\">addAssoc</span><span class=\"bp\">;</span>\n    <span class=\"n\">rw</span> <span class=\"n\">negAdd</span><span class=\"bp\">;</span>\n    <span class=\"n\">rw</span> <span class=\"n\">zeroAdd</span><span class=\"bp\">;</span>\n<span class=\"o\">}</span>\n\n<span class=\"kd\">theorem</span> <span class=\"n\">addNeg</span> <span class=\"o\">[</span><span class=\"n\">AddGroup</span> <span class=\"n\">α</span><span class=\"o\">]</span> <span class=\"o\">{</span><span class=\"n\">a</span> <span class=\"o\">:</span> <span class=\"n\">α</span><span class=\"o\">}</span> <span class=\"o\">:</span> <span class=\"n\">a</span> <span class=\"bp\">+</span> <span class=\"bp\">-</span><span class=\"n\">a</span> <span class=\"bp\">=</span> <span class=\"mi\">0</span> <span class=\"o\">:=</span> <span class=\"kd\">by</span> <span class=\"o\">{</span>\n    <span class=\"k\">have</span> <span class=\"n\">h</span> <span class=\"o\">:</span> <span class=\"bp\">-</span> <span class=\"bp\">-</span><span class=\"n\">a</span> <span class=\"bp\">+</span> <span class=\"bp\">-</span><span class=\"n\">a</span> <span class=\"bp\">=</span> <span class=\"mi\">0</span> <span class=\"o\">:=</span> <span class=\"kd\">by</span> <span class=\"o\">{</span> <span class=\"n\">rw</span> <span class=\"n\">negAdd</span> <span class=\"o\">}</span><span class=\"bp\">;</span>\n    <span class=\"n\">rw</span> <span class=\"n\">negNeg</span> <span class=\"n\">at</span> <span class=\"n\">h</span><span class=\"bp\">;</span>\n    <span class=\"n\">exact</span> <span class=\"n\">h</span>\n<span class=\"o\">}</span>\n\n<span class=\"kd\">theorem</span> <span class=\"n\">addIdemIffZero</span> <span class=\"o\">[</span><span class=\"n\">AddGroup</span> <span class=\"n\">α</span><span class=\"o\">]</span> <span class=\"o\">{</span><span class=\"n\">a</span> <span class=\"o\">:</span> <span class=\"n\">α</span><span class=\"o\">}</span> <span class=\"o\">:</span> <span class=\"n\">a</span> <span class=\"bp\">+</span> <span class=\"n\">a</span> <span class=\"bp\">=</span> <span class=\"n\">a</span> <span class=\"bp\">↔</span> <span class=\"n\">a</span> <span class=\"bp\">=</span> <span class=\"mi\">0</span> <span class=\"o\">:=</span> <span class=\"kd\">by</span>\n    <span class=\"n\">apply</span> <span class=\"n\">Iff.intro</span>\n    <span class=\"n\">focus</span>\n        <span class=\"n\">intro</span> <span class=\"n\">h</span>\n        <span class=\"k\">have</span> <span class=\"n\">h'</span> <span class=\"o\">:=</span> <span class=\"n\">congrArg</span> <span class=\"o\">(</span><span class=\"bp\">λ</span> <span class=\"n\">x</span> <span class=\"bp\">=&gt;</span> <span class=\"n\">x</span> <span class=\"bp\">+</span> <span class=\"bp\">-</span><span class=\"n\">a</span><span class=\"o\">)</span> <span class=\"n\">h</span>\n        <span class=\"n\">simp</span> <span class=\"n\">at</span> <span class=\"n\">h'</span>\n        <span class=\"n\">rw</span> <span class=\"o\">[</span><span class=\"n\">addAssoc</span><span class=\"o\">,</span> <span class=\"n\">addNeg</span><span class=\"o\">,</span> <span class=\"n\">addZero</span><span class=\"o\">]</span> <span class=\"n\">at</span> <span class=\"n\">h'</span>\n        <span class=\"n\">exact</span> <span class=\"n\">h'</span>\n    <span class=\"n\">focus</span>\n        <span class=\"n\">intro</span> <span class=\"n\">h</span>\n        <span class=\"n\">subst</span> <span class=\"n\">a</span>\n        <span class=\"n\">rw</span> <span class=\"n\">addZero</span>\n\n<span class=\"kd\">instance</span> <span class=\"o\">[</span><span class=\"n\">Ring</span> <span class=\"n\">α</span><span class=\"o\">]</span> <span class=\"o\">:</span> <span class=\"n\">ZeroMul</span> <span class=\"n\">α</span> <span class=\"o\">:=</span> <span class=\"kd\">by</span> <span class=\"o\">{</span>\n    <span class=\"n\">apply</span> <span class=\"n\">ZeroMul.mk</span><span class=\"bp\">;</span>\n    <span class=\"n\">intro</span> <span class=\"n\">a</span><span class=\"bp\">;</span>\n    <span class=\"k\">have</span> <span class=\"n\">h</span> <span class=\"o\">:</span> <span class=\"mi\">0</span> <span class=\"bp\">*</span> <span class=\"n\">a</span> <span class=\"bp\">+</span> <span class=\"mi\">0</span> <span class=\"bp\">*</span> <span class=\"n\">a</span> <span class=\"bp\">=</span> <span class=\"mi\">0</span> <span class=\"bp\">*</span> <span class=\"n\">a</span> <span class=\"o\">:=</span> <span class=\"kd\">by</span> <span class=\"o\">{</span> <span class=\"n\">rw</span> <span class=\"o\">[</span><span class=\"bp\">←</span><span class=\"n\">rightDistrib</span><span class=\"o\">,</span> <span class=\"n\">addZero</span><span class=\"o\">]</span> <span class=\"o\">}</span><span class=\"bp\">;</span>\n    <span class=\"n\">rw</span> <span class=\"n\">addIdemIffZero</span> <span class=\"o\">(</span><span class=\"n\">a</span> <span class=\"o\">:=</span> <span class=\"mi\">0</span> <span class=\"bp\">*</span> <span class=\"n\">a</span><span class=\"o\">)</span> <span class=\"n\">at</span> <span class=\"n\">h</span><span class=\"bp\">;</span>\n    <span class=\"n\">rw</span> <span class=\"n\">h</span><span class=\"bp\">;</span>\n<span class=\"o\">}</span>\n\n<span class=\"kd\">example</span> <span class=\"o\">[</span><span class=\"n\">Ring</span> <span class=\"n\">α</span><span class=\"o\">]</span> <span class=\"o\">:</span> <span class=\"n\">Semiring</span> <span class=\"n\">α</span> <span class=\"o\">:=</span> <span class=\"n\">inferInstance</span>\n</code></pre></div>",
        "id": 223422846,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1611170993
    },
    {
        "content": "<p>This looks like exactly the design that someone complained gives exponential blow-up due to every type in the heirarchy being indexed by all the previous types. Perhaps that applies only to Coq / whatever language the blog they linked complained about</p>",
        "id": 223425196,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1611172081
    },
    {
        "content": "<p>I think a difference is that this is able to cache intermediate instances.  If you have a <code>Ring</code> and a <code>MulComm</code>, then the term for <code>CommRing</code> is that pair of instances -- it doesn't have to go all the way down to the basic operations and axioms every time.  There is a \"fast path\" for coercion depending on which objects you extend to define the new object.  (I'd only looked at a couple of terms to see whether the exponential blowup happened. By my non-expert eye it didn't <em>look</em> like it happened, but I'm really not sure.  It probably would happen when the object being coerced doesn't have a nearby common ancestor.)</p>",
        "id": 223425870,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1611172387
    },
    {
        "content": "<p>To be clear, the blow up I'm recalling is in term size, not typeclass search duration</p>",
        "id": 223426713,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1611172754
    },
    {
        "content": "<p>Yeah, that's what I was referring to.</p>",
        "id": 223426790,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1611172799
    },
    {
        "content": "<p>Here's a quick test of this.  I added instances for products of groups, mirroring the one in the article, and then I printed out <code>#reduce</code> of the instance with <code>set_option pp.all true</code>.  I then counted the characters in the message (excluding spaces, since the pretty printer does indenting) and got this graph:</p>\n<p><a href=\"/user_uploads/3121/ix1yscQRBVZ_GXg9JsLSnHgJ/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/ix1yscQRBVZ_GXg9JsLSnHgJ/image.png\" title=\"image.png\"><img src=\"/user_uploads/3121/ix1yscQRBVZ_GXg9JsLSnHgJ/image.png\"></a></div><p>Code:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kn\">section</span> <span class=\"n\">prod</span>\n\n<span class=\"kd\">instance</span> <span class=\"o\">[</span><span class=\"n\">Mul</span> <span class=\"n\">α</span><span class=\"o\">]</span> <span class=\"o\">[</span><span class=\"n\">Mul</span> <span class=\"n\">β</span><span class=\"o\">]</span> <span class=\"o\">:</span> <span class=\"n\">Mul</span> <span class=\"o\">(</span><span class=\"n\">α</span> <span class=\"bp\">×</span> <span class=\"n\">β</span><span class=\"o\">)</span> <span class=\"n\">where</span>\n    <span class=\"n\">mul</span> <span class=\"n\">p</span> <span class=\"n\">p'</span> <span class=\"o\">:=</span> <span class=\"o\">(</span><span class=\"n\">p.1</span> <span class=\"bp\">*</span> <span class=\"n\">p'.1</span><span class=\"o\">,</span> <span class=\"n\">p.2</span> <span class=\"bp\">*</span> <span class=\"n\">p'.2</span><span class=\"o\">)</span>\n\n<span class=\"kd\">instance</span> <span class=\"o\">[</span><span class=\"n\">Inv</span> <span class=\"n\">α</span><span class=\"o\">]</span> <span class=\"o\">[</span><span class=\"n\">Inv</span> <span class=\"n\">β</span><span class=\"o\">]</span> <span class=\"o\">:</span> <span class=\"n\">Inv</span> <span class=\"o\">(</span><span class=\"n\">α</span> <span class=\"bp\">×</span> <span class=\"n\">β</span><span class=\"o\">)</span> <span class=\"n\">where</span>\n    <span class=\"n\">inv</span> <span class=\"n\">p</span> <span class=\"o\">:=</span> <span class=\"o\">(</span><span class=\"n\">p.1</span><span class=\"bp\">⁻¹</span><span class=\"o\">,</span> <span class=\"n\">p.2</span><span class=\"bp\">⁻¹</span><span class=\"o\">)</span>\n\n<span class=\"kd\">instance</span> <span class=\"o\">[</span><span class=\"n\">One</span> <span class=\"n\">α</span><span class=\"o\">]</span> <span class=\"o\">[</span><span class=\"n\">One</span> <span class=\"n\">β</span><span class=\"o\">]</span> <span class=\"o\">:</span> <span class=\"n\">One</span> <span class=\"o\">(</span><span class=\"n\">α</span> <span class=\"bp\">×</span> <span class=\"n\">β</span><span class=\"o\">)</span> <span class=\"n\">where</span>\n    <span class=\"n\">one</span> <span class=\"o\">:=</span> <span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"o\">,</span> <span class=\"mi\">1</span><span class=\"o\">)</span>\n\n<span class=\"kd\">theorem</span> <span class=\"n\">Product.ext</span> <span class=\"o\">:</span> <span class=\"o\">{</span><span class=\"n\">p</span> <span class=\"n\">q</span> <span class=\"o\">:</span> <span class=\"n\">α</span> <span class=\"bp\">×</span> <span class=\"n\">β</span><span class=\"o\">}</span> <span class=\"bp\">→</span> <span class=\"n\">p.1</span> <span class=\"bp\">=</span> <span class=\"n\">q.1</span> <span class=\"bp\">→</span> <span class=\"n\">p.2</span> <span class=\"bp\">=</span> <span class=\"n\">q.2</span> <span class=\"bp\">→</span> <span class=\"n\">p</span> <span class=\"bp\">=</span> <span class=\"n\">q</span>\n    <span class=\"bp\">|</span> <span class=\"o\">(</span><span class=\"n\">a</span><span class=\"o\">,</span> <span class=\"n\">b</span><span class=\"o\">),</span> <span class=\"o\">(</span><span class=\"n\">c</span><span class=\"o\">,</span> <span class=\"n\">d</span><span class=\"o\">)</span> <span class=\"bp\">=&gt;</span> <span class=\"kd\">by</span> <span class=\"n\">simp</span><span class=\"bp\">;</span> <span class=\"n\">intro</span> <span class=\"n\">h</span><span class=\"bp\">;</span> <span class=\"n\">subst</span> <span class=\"n\">a</span><span class=\"bp\">;</span> <span class=\"n\">intro</span> <span class=\"n\">h</span><span class=\"bp\">;</span> <span class=\"n\">subst</span> <span class=\"n\">b</span><span class=\"bp\">;</span> <span class=\"n\">rfl</span>\n\n<span class=\"kd\">instance</span> <span class=\"o\">[</span><span class=\"n\">Semigroup</span> <span class=\"n\">α</span><span class=\"o\">]</span> <span class=\"o\">[</span><span class=\"n\">Semigroup</span> <span class=\"n\">β</span><span class=\"o\">]</span> <span class=\"o\">:</span> <span class=\"n\">Semigroup</span> <span class=\"o\">(</span><span class=\"n\">α</span> <span class=\"bp\">×</span> <span class=\"n\">β</span><span class=\"o\">)</span> <span class=\"n\">where</span>\n    <span class=\"n\">mulAssoc</span> <span class=\"o\">:=</span> <span class=\"kd\">by</span>\n        <span class=\"n\">apply</span> <span class=\"n\">Product.ext</span>\n        <span class=\"n\">apply</span> <span class=\"n\">mulAssoc</span>\n        <span class=\"n\">apply</span> <span class=\"n\">mulAssoc</span>\n\n<span class=\"kd\">instance</span> <span class=\"o\">[</span><span class=\"n\">Monoid</span> <span class=\"n\">α</span><span class=\"o\">]</span> <span class=\"o\">[</span><span class=\"n\">Monoid</span> <span class=\"n\">β</span><span class=\"o\">]</span> <span class=\"o\">:</span> <span class=\"n\">Monoid</span> <span class=\"o\">(</span><span class=\"n\">α</span> <span class=\"bp\">×</span> <span class=\"n\">β</span><span class=\"o\">)</span> <span class=\"n\">where</span>\n    <span class=\"n\">oneMul</span> <span class=\"o\">:=</span> <span class=\"kd\">by</span>\n        <span class=\"n\">apply</span> <span class=\"n\">Product.ext</span>\n        <span class=\"n\">apply</span> <span class=\"n\">oneMul</span>\n        <span class=\"n\">apply</span> <span class=\"n\">oneMul</span>\n    <span class=\"n\">mulOne</span> <span class=\"o\">:=</span> <span class=\"kd\">by</span>\n        <span class=\"n\">apply</span> <span class=\"n\">Product.ext</span>\n        <span class=\"n\">apply</span> <span class=\"n\">mulOne</span>\n        <span class=\"n\">apply</span> <span class=\"n\">mulOne</span>\n\n<span class=\"kd\">instance</span> <span class=\"o\">[</span><span class=\"n\">Group</span> <span class=\"n\">α</span><span class=\"o\">]</span> <span class=\"o\">[</span><span class=\"n\">Group</span> <span class=\"n\">β</span><span class=\"o\">]</span> <span class=\"o\">:</span> <span class=\"n\">Group</span> <span class=\"o\">(</span><span class=\"n\">α</span> <span class=\"bp\">×</span> <span class=\"n\">β</span><span class=\"o\">)</span> <span class=\"n\">where</span>\n    <span class=\"n\">invMul</span> <span class=\"o\">:=</span> <span class=\"kd\">by</span>\n        <span class=\"n\">apply</span> <span class=\"n\">Product.ext</span>\n        <span class=\"n\">apply</span> <span class=\"n\">invMul</span>\n        <span class=\"n\">apply</span> <span class=\"n\">invMul</span>\n\n<span class=\"kd\">end</span> <span class=\"n\">prod</span>\n\n<span class=\"kd\">def</span> <span class=\"n\">test1</span> <span class=\"o\">{</span><span class=\"n\">G</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span> <span class=\"n\">_</span><span class=\"o\">}</span> <span class=\"o\">[</span><span class=\"n\">Group</span> <span class=\"n\">G</span><span class=\"o\">]:</span> <span class=\"n\">Group</span> <span class=\"o\">(</span><span class=\"n\">G</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"n\">inferInstance</span>\n<span class=\"kd\">def</span> <span class=\"n\">test2</span> <span class=\"o\">{</span><span class=\"n\">G</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span> <span class=\"n\">_</span><span class=\"o\">}</span> <span class=\"o\">[</span><span class=\"n\">Group</span> <span class=\"n\">G</span><span class=\"o\">]:</span> <span class=\"n\">Group</span> <span class=\"o\">(</span><span class=\"n\">G</span> <span class=\"bp\">×</span> <span class=\"n\">G</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"n\">inferInstance</span>\n<span class=\"kd\">def</span> <span class=\"n\">test3</span> <span class=\"o\">{</span><span class=\"n\">G</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span> <span class=\"n\">_</span><span class=\"o\">}</span> <span class=\"o\">[</span><span class=\"n\">Group</span> <span class=\"n\">G</span><span class=\"o\">]:</span> <span class=\"n\">Group</span> <span class=\"o\">(</span><span class=\"n\">G</span> <span class=\"bp\">×</span> <span class=\"n\">G</span> <span class=\"bp\">×</span> <span class=\"n\">G</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"n\">inferInstance</span>\n<span class=\"kd\">def</span> <span class=\"n\">test4</span> <span class=\"o\">{</span><span class=\"n\">G</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span> <span class=\"n\">_</span><span class=\"o\">}</span> <span class=\"o\">[</span><span class=\"n\">Group</span> <span class=\"n\">G</span><span class=\"o\">]:</span> <span class=\"n\">Group</span> <span class=\"o\">(</span><span class=\"n\">G</span> <span class=\"bp\">×</span> <span class=\"n\">G</span> <span class=\"bp\">×</span> <span class=\"n\">G</span> <span class=\"bp\">×</span> <span class=\"n\">G</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"n\">inferInstance</span>\n<span class=\"kd\">def</span> <span class=\"n\">test5</span> <span class=\"o\">{</span><span class=\"n\">G</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span> <span class=\"n\">_</span><span class=\"o\">}</span> <span class=\"o\">[</span><span class=\"n\">Group</span> <span class=\"n\">G</span><span class=\"o\">]:</span> <span class=\"n\">Group</span> <span class=\"o\">(</span><span class=\"n\">G</span> <span class=\"bp\">×</span> <span class=\"n\">G</span> <span class=\"bp\">×</span> <span class=\"n\">G</span> <span class=\"bp\">×</span> <span class=\"n\">G</span> <span class=\"bp\">×</span> <span class=\"n\">G</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"n\">inferInstance</span>\n<span class=\"kd\">def</span> <span class=\"n\">test6</span> <span class=\"o\">{</span><span class=\"n\">G</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span> <span class=\"n\">_</span><span class=\"o\">}</span> <span class=\"o\">[</span><span class=\"n\">Group</span> <span class=\"n\">G</span><span class=\"o\">]:</span> <span class=\"n\">Group</span> <span class=\"o\">(</span><span class=\"n\">G</span> <span class=\"bp\">×</span> <span class=\"n\">G</span> <span class=\"bp\">×</span> <span class=\"n\">G</span> <span class=\"bp\">×</span> <span class=\"n\">G</span> <span class=\"bp\">×</span> <span class=\"n\">G</span> <span class=\"bp\">×</span> <span class=\"n\">G</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"n\">inferInstance</span>\n<span class=\"kd\">def</span> <span class=\"n\">test7</span> <span class=\"o\">{</span><span class=\"n\">G</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span> <span class=\"n\">_</span><span class=\"o\">}</span> <span class=\"o\">[</span><span class=\"n\">Group</span> <span class=\"n\">G</span><span class=\"o\">]:</span> <span class=\"n\">Group</span> <span class=\"o\">(</span><span class=\"n\">G</span> <span class=\"bp\">×</span> <span class=\"n\">G</span> <span class=\"bp\">×</span> <span class=\"n\">G</span> <span class=\"bp\">×</span> <span class=\"n\">G</span> <span class=\"bp\">×</span> <span class=\"n\">G</span> <span class=\"bp\">×</span> <span class=\"n\">G</span> <span class=\"bp\">×</span> <span class=\"n\">G</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"n\">inferInstance</span>\n<span class=\"kd\">def</span> <span class=\"n\">test8</span> <span class=\"o\">{</span><span class=\"n\">G</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span> <span class=\"n\">_</span><span class=\"o\">}</span> <span class=\"o\">[</span><span class=\"n\">Group</span> <span class=\"n\">G</span><span class=\"o\">]:</span> <span class=\"n\">Group</span> <span class=\"o\">(</span><span class=\"n\">G</span> <span class=\"bp\">×</span> <span class=\"n\">G</span> <span class=\"bp\">×</span> <span class=\"n\">G</span> <span class=\"bp\">×</span> <span class=\"n\">G</span> <span class=\"bp\">×</span> <span class=\"n\">G</span> <span class=\"bp\">×</span> <span class=\"n\">G</span> <span class=\"bp\">×</span> <span class=\"n\">G</span> <span class=\"bp\">×</span> <span class=\"n\">G</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"n\">inferInstance</span>\n\n<span class=\"kd\">set_option</span> <span class=\"n\">pp.all</span> <span class=\"n\">true</span>\n<span class=\"k\">#reduce</span> <span class=\"bp\">@</span><span class=\"n\">test8</span>\n</code></pre></div>\n<p>This is what the term for <code>test8</code> looked like:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"k\">fun</span> <span class=\"o\">{</span><span class=\"n\">G</span><span class=\"o\">}</span> <span class=\"o\">[</span><span class=\"n\">inst</span> <span class=\"o\">:</span> <span class=\"n\">Group.</span><span class=\"o\">{</span><span class=\"n\">u_1</span><span class=\"o\">}</span> <span class=\"n\">G</span><span class=\"o\">]</span> <span class=\"bp\">=&gt;</span>\n  <span class=\"bp\">@</span><span class=\"n\">Group.mk.</span><span class=\"o\">{</span><span class=\"n\">u_1</span><span class=\"o\">}</span>\n    <span class=\"o\">(</span><span class=\"n\">Prod.</span><span class=\"o\">{</span><span class=\"n\">u_1</span><span class=\"o\">,</span> <span class=\"n\">u_1</span><span class=\"o\">}</span> <span class=\"n\">G</span>\n      <span class=\"o\">(</span><span class=\"n\">Prod.</span><span class=\"o\">{</span><span class=\"n\">u_1</span><span class=\"o\">,</span> <span class=\"n\">u_1</span><span class=\"o\">}</span> <span class=\"n\">G</span>\n        <span class=\"o\">(</span><span class=\"n\">Prod.</span><span class=\"o\">{</span><span class=\"n\">u_1</span><span class=\"o\">,</span> <span class=\"n\">u_1</span><span class=\"o\">}</span> <span class=\"n\">G</span> <span class=\"o\">(</span><span class=\"n\">Prod.</span><span class=\"o\">{</span><span class=\"n\">u_1</span><span class=\"o\">,</span> <span class=\"n\">u_1</span><span class=\"o\">}</span> <span class=\"n\">G</span> <span class=\"o\">(</span><span class=\"n\">Prod.</span><span class=\"o\">{</span><span class=\"n\">u_1</span><span class=\"o\">,</span> <span class=\"n\">u_1</span><span class=\"o\">}</span> <span class=\"n\">G</span> <span class=\"o\">(</span><span class=\"n\">Prod.</span><span class=\"o\">{</span><span class=\"n\">u_1</span><span class=\"o\">,</span> <span class=\"n\">u_1</span><span class=\"o\">}</span> <span class=\"n\">G</span> <span class=\"o\">(</span><span class=\"n\">Prod.</span><span class=\"o\">{</span><span class=\"n\">u_1</span><span class=\"o\">,</span> <span class=\"n\">u_1</span><span class=\"o\">}</span> <span class=\"n\">G</span> <span class=\"n\">G</span><span class=\"o\">)))))))</span>\n    <span class=\"o\">(</span><span class=\"bp\">@</span><span class=\"n\">instMonoidProd.</span><span class=\"o\">{</span><span class=\"n\">u_1</span><span class=\"o\">,</span> <span class=\"n\">u_1</span><span class=\"o\">}</span> <span class=\"n\">G</span>\n      <span class=\"o\">(</span><span class=\"n\">Prod.</span><span class=\"o\">{</span><span class=\"n\">u_1</span><span class=\"o\">,</span> <span class=\"n\">u_1</span><span class=\"o\">}</span> <span class=\"n\">G</span>\n        <span class=\"o\">(</span><span class=\"n\">Prod.</span><span class=\"o\">{</span><span class=\"n\">u_1</span><span class=\"o\">,</span> <span class=\"n\">u_1</span><span class=\"o\">}</span> <span class=\"n\">G</span> <span class=\"o\">(</span><span class=\"n\">Prod.</span><span class=\"o\">{</span><span class=\"n\">u_1</span><span class=\"o\">,</span> <span class=\"n\">u_1</span><span class=\"o\">}</span> <span class=\"n\">G</span> <span class=\"o\">(</span><span class=\"n\">Prod.</span><span class=\"o\">{</span><span class=\"n\">u_1</span><span class=\"o\">,</span> <span class=\"n\">u_1</span><span class=\"o\">}</span> <span class=\"n\">G</span> <span class=\"o\">(</span><span class=\"n\">Prod.</span><span class=\"o\">{</span><span class=\"n\">u_1</span><span class=\"o\">,</span> <span class=\"n\">u_1</span><span class=\"o\">}</span> <span class=\"n\">G</span> <span class=\"o\">(</span><span class=\"n\">Prod.</span><span class=\"o\">{</span><span class=\"n\">u_1</span><span class=\"o\">,</span> <span class=\"n\">u_1</span><span class=\"o\">}</span> <span class=\"n\">G</span> <span class=\"n\">G</span><span class=\"o\">))))))</span>\n      <span class=\"o\">(</span><span class=\"bp\">@</span><span class=\"n\">Group.toMonoid.</span><span class=\"o\">{</span><span class=\"n\">u_1</span><span class=\"o\">}</span> <span class=\"n\">G</span> <span class=\"n\">inst</span><span class=\"o\">)</span>\n      <span class=\"o\">(</span><span class=\"bp\">@</span><span class=\"n\">Group.toMonoid.</span><span class=\"o\">{</span><span class=\"n\">u_1</span><span class=\"o\">}</span>\n        <span class=\"o\">(</span><span class=\"n\">Prod.</span><span class=\"o\">{</span><span class=\"n\">u_1</span><span class=\"o\">,</span> <span class=\"n\">u_1</span><span class=\"o\">}</span> <span class=\"n\">G</span>\n          <span class=\"o\">(</span><span class=\"n\">Prod.</span><span class=\"o\">{</span><span class=\"n\">u_1</span><span class=\"o\">,</span> <span class=\"n\">u_1</span><span class=\"o\">}</span> <span class=\"n\">G</span> <span class=\"o\">(</span><span class=\"n\">Prod.</span><span class=\"o\">{</span><span class=\"n\">u_1</span><span class=\"o\">,</span> <span class=\"n\">u_1</span><span class=\"o\">}</span> <span class=\"n\">G</span> <span class=\"o\">(</span><span class=\"n\">Prod.</span><span class=\"o\">{</span><span class=\"n\">u_1</span><span class=\"o\">,</span> <span class=\"n\">u_1</span><span class=\"o\">}</span> <span class=\"n\">G</span> <span class=\"o\">(</span><span class=\"n\">Prod.</span><span class=\"o\">{</span><span class=\"n\">u_1</span><span class=\"o\">,</span> <span class=\"n\">u_1</span><span class=\"o\">}</span> <span class=\"n\">G</span> <span class=\"o\">(</span><span class=\"n\">Prod.</span><span class=\"o\">{</span><span class=\"n\">u_1</span><span class=\"o\">,</span> <span class=\"n\">u_1</span><span class=\"o\">}</span> <span class=\"n\">G</span> <span class=\"n\">G</span><span class=\"o\">))))))</span>\n        <span class=\"o\">(</span><span class=\"bp\">@</span><span class=\"n\">instGroupProd.</span><span class=\"o\">{</span><span class=\"n\">u_1</span><span class=\"o\">,</span> <span class=\"n\">u_1</span><span class=\"o\">}</span> <span class=\"n\">G</span>\n          <span class=\"o\">(</span><span class=\"n\">Prod.</span><span class=\"o\">{</span><span class=\"n\">u_1</span><span class=\"o\">,</span> <span class=\"n\">u_1</span><span class=\"o\">}</span> <span class=\"n\">G</span> <span class=\"o\">(</span><span class=\"n\">Prod.</span><span class=\"o\">{</span><span class=\"n\">u_1</span><span class=\"o\">,</span> <span class=\"n\">u_1</span><span class=\"o\">}</span> <span class=\"n\">G</span> <span class=\"o\">(</span><span class=\"n\">Prod.</span><span class=\"o\">{</span><span class=\"n\">u_1</span><span class=\"o\">,</span> <span class=\"n\">u_1</span><span class=\"o\">}</span> <span class=\"n\">G</span> <span class=\"o\">(</span><span class=\"n\">Prod.</span><span class=\"o\">{</span><span class=\"n\">u_1</span><span class=\"o\">,</span> <span class=\"n\">u_1</span><span class=\"o\">}</span> <span class=\"n\">G</span> <span class=\"o\">(</span><span class=\"n\">Prod.</span><span class=\"o\">{</span><span class=\"n\">u_1</span><span class=\"o\">,</span> <span class=\"n\">u_1</span><span class=\"o\">}</span> <span class=\"n\">G</span> <span class=\"n\">G</span><span class=\"o\">)))))</span> <span class=\"n\">inst</span>\n          <span class=\"o\">(</span><span class=\"bp\">@</span><span class=\"n\">instGroupProd.</span><span class=\"o\">{</span><span class=\"n\">u_1</span><span class=\"o\">,</span> <span class=\"n\">u_1</span><span class=\"o\">}</span> <span class=\"n\">G</span> <span class=\"o\">(</span><span class=\"n\">Prod.</span><span class=\"o\">{</span><span class=\"n\">u_1</span><span class=\"o\">,</span> <span class=\"n\">u_1</span><span class=\"o\">}</span> <span class=\"n\">G</span> <span class=\"o\">(</span><span class=\"n\">Prod.</span><span class=\"o\">{</span><span class=\"n\">u_1</span><span class=\"o\">,</span> <span class=\"n\">u_1</span><span class=\"o\">}</span> <span class=\"n\">G</span> <span class=\"o\">(</span><span class=\"n\">Prod.</span><span class=\"o\">{</span><span class=\"n\">u_1</span><span class=\"o\">,</span> <span class=\"n\">u_1</span><span class=\"o\">}</span> <span class=\"n\">G</span> <span class=\"o\">(</span><span class=\"n\">Prod.</span><span class=\"o\">{</span><span class=\"n\">u_1</span><span class=\"o\">,</span> <span class=\"n\">u_1</span><span class=\"o\">}</span> <span class=\"n\">G</span> <span class=\"n\">G</span><span class=\"o\">))))</span>\n            <span class=\"n\">inst</span>\n            <span class=\"o\">(</span><span class=\"bp\">@</span><span class=\"n\">instGroupProd.</span><span class=\"o\">{</span><span class=\"n\">u_1</span><span class=\"o\">,</span> <span class=\"n\">u_1</span><span class=\"o\">}</span> <span class=\"n\">G</span> <span class=\"o\">(</span><span class=\"n\">Prod.</span><span class=\"o\">{</span><span class=\"n\">u_1</span><span class=\"o\">,</span> <span class=\"n\">u_1</span><span class=\"o\">}</span> <span class=\"n\">G</span> <span class=\"o\">(</span><span class=\"n\">Prod.</span><span class=\"o\">{</span><span class=\"n\">u_1</span><span class=\"o\">,</span> <span class=\"n\">u_1</span><span class=\"o\">}</span> <span class=\"n\">G</span> <span class=\"o\">(</span><span class=\"n\">Prod.</span><span class=\"o\">{</span><span class=\"n\">u_1</span><span class=\"o\">,</span> <span class=\"n\">u_1</span><span class=\"o\">}</span> <span class=\"n\">G</span> <span class=\"n\">G</span><span class=\"o\">)))</span> <span class=\"n\">inst</span>\n              <span class=\"o\">(</span><span class=\"bp\">@</span><span class=\"n\">instGroupProd.</span><span class=\"o\">{</span><span class=\"n\">u_1</span><span class=\"o\">,</span> <span class=\"n\">u_1</span><span class=\"o\">}</span> <span class=\"n\">G</span> <span class=\"o\">(</span><span class=\"n\">Prod.</span><span class=\"o\">{</span><span class=\"n\">u_1</span><span class=\"o\">,</span> <span class=\"n\">u_1</span><span class=\"o\">}</span> <span class=\"n\">G</span> <span class=\"o\">(</span><span class=\"n\">Prod.</span><span class=\"o\">{</span><span class=\"n\">u_1</span><span class=\"o\">,</span> <span class=\"n\">u_1</span><span class=\"o\">}</span> <span class=\"n\">G</span> <span class=\"n\">G</span><span class=\"o\">))</span> <span class=\"n\">inst</span>\n                <span class=\"o\">(</span><span class=\"bp\">@</span><span class=\"n\">instGroupProd.</span><span class=\"o\">{</span><span class=\"n\">u_1</span><span class=\"o\">,</span> <span class=\"n\">u_1</span><span class=\"o\">}</span> <span class=\"n\">G</span> <span class=\"o\">(</span><span class=\"n\">Prod.</span><span class=\"o\">{</span><span class=\"n\">u_1</span><span class=\"o\">,</span> <span class=\"n\">u_1</span><span class=\"o\">}</span> <span class=\"n\">G</span> <span class=\"n\">G</span><span class=\"o\">)</span> <span class=\"n\">inst</span> <span class=\"o\">(</span><span class=\"bp\">@</span><span class=\"n\">instGroupProd.</span><span class=\"o\">{</span><span class=\"n\">u_1</span><span class=\"o\">,</span> <span class=\"n\">u_1</span><span class=\"o\">}</span> <span class=\"n\">G</span> <span class=\"n\">G</span> <span class=\"n\">inst</span> <span class=\"n\">inst</span><span class=\"o\">))))))))</span>\n    <span class=\"o\">(</span><span class=\"bp\">@</span><span class=\"n\">instInvProd.</span><span class=\"o\">{</span><span class=\"n\">u_1</span><span class=\"o\">,</span> <span class=\"n\">u_1</span><span class=\"o\">}</span> <span class=\"n\">G</span>\n      <span class=\"o\">(</span><span class=\"n\">Prod.</span><span class=\"o\">{</span><span class=\"n\">u_1</span><span class=\"o\">,</span> <span class=\"n\">u_1</span><span class=\"o\">}</span> <span class=\"n\">G</span>\n        <span class=\"o\">(</span><span class=\"n\">Prod.</span><span class=\"o\">{</span><span class=\"n\">u_1</span><span class=\"o\">,</span> <span class=\"n\">u_1</span><span class=\"o\">}</span> <span class=\"n\">G</span> <span class=\"o\">(</span><span class=\"n\">Prod.</span><span class=\"o\">{</span><span class=\"n\">u_1</span><span class=\"o\">,</span> <span class=\"n\">u_1</span><span class=\"o\">}</span> <span class=\"n\">G</span> <span class=\"o\">(</span><span class=\"n\">Prod.</span><span class=\"o\">{</span><span class=\"n\">u_1</span><span class=\"o\">,</span> <span class=\"n\">u_1</span><span class=\"o\">}</span> <span class=\"n\">G</span> <span class=\"o\">(</span><span class=\"n\">Prod.</span><span class=\"o\">{</span><span class=\"n\">u_1</span><span class=\"o\">,</span> <span class=\"n\">u_1</span><span class=\"o\">}</span> <span class=\"n\">G</span> <span class=\"o\">(</span><span class=\"n\">Prod.</span><span class=\"o\">{</span><span class=\"n\">u_1</span><span class=\"o\">,</span> <span class=\"n\">u_1</span><span class=\"o\">}</span> <span class=\"n\">G</span> <span class=\"n\">G</span><span class=\"o\">))))))</span>\n      <span class=\"o\">(</span><span class=\"bp\">@</span><span class=\"n\">Group.toInv.</span><span class=\"o\">{</span><span class=\"n\">u_1</span><span class=\"o\">}</span> <span class=\"n\">G</span> <span class=\"n\">inst</span><span class=\"o\">)</span>\n      <span class=\"o\">(</span><span class=\"bp\">@</span><span class=\"n\">Group.toInv.</span><span class=\"o\">{</span><span class=\"n\">u_1</span><span class=\"o\">}</span>\n        <span class=\"o\">(</span><span class=\"n\">Prod.</span><span class=\"o\">{</span><span class=\"n\">u_1</span><span class=\"o\">,</span> <span class=\"n\">u_1</span><span class=\"o\">}</span> <span class=\"n\">G</span>\n          <span class=\"o\">(</span><span class=\"n\">Prod.</span><span class=\"o\">{</span><span class=\"n\">u_1</span><span class=\"o\">,</span> <span class=\"n\">u_1</span><span class=\"o\">}</span> <span class=\"n\">G</span> <span class=\"o\">(</span><span class=\"n\">Prod.</span><span class=\"o\">{</span><span class=\"n\">u_1</span><span class=\"o\">,</span> <span class=\"n\">u_1</span><span class=\"o\">}</span> <span class=\"n\">G</span> <span class=\"o\">(</span><span class=\"n\">Prod.</span><span class=\"o\">{</span><span class=\"n\">u_1</span><span class=\"o\">,</span> <span class=\"n\">u_1</span><span class=\"o\">}</span> <span class=\"n\">G</span> <span class=\"o\">(</span><span class=\"n\">Prod.</span><span class=\"o\">{</span><span class=\"n\">u_1</span><span class=\"o\">,</span> <span class=\"n\">u_1</span><span class=\"o\">}</span> <span class=\"n\">G</span> <span class=\"o\">(</span><span class=\"n\">Prod.</span><span class=\"o\">{</span><span class=\"n\">u_1</span><span class=\"o\">,</span> <span class=\"n\">u_1</span><span class=\"o\">}</span> <span class=\"n\">G</span> <span class=\"n\">G</span><span class=\"o\">))))))</span>\n        <span class=\"o\">(</span><span class=\"bp\">@</span><span class=\"n\">instGroupProd.</span><span class=\"o\">{</span><span class=\"n\">u_1</span><span class=\"o\">,</span> <span class=\"n\">u_1</span><span class=\"o\">}</span> <span class=\"n\">G</span>\n          <span class=\"o\">(</span><span class=\"n\">Prod.</span><span class=\"o\">{</span><span class=\"n\">u_1</span><span class=\"o\">,</span> <span class=\"n\">u_1</span><span class=\"o\">}</span> <span class=\"n\">G</span> <span class=\"o\">(</span><span class=\"n\">Prod.</span><span class=\"o\">{</span><span class=\"n\">u_1</span><span class=\"o\">,</span> <span class=\"n\">u_1</span><span class=\"o\">}</span> <span class=\"n\">G</span> <span class=\"o\">(</span><span class=\"n\">Prod.</span><span class=\"o\">{</span><span class=\"n\">u_1</span><span class=\"o\">,</span> <span class=\"n\">u_1</span><span class=\"o\">}</span> <span class=\"n\">G</span> <span class=\"o\">(</span><span class=\"n\">Prod.</span><span class=\"o\">{</span><span class=\"n\">u_1</span><span class=\"o\">,</span> <span class=\"n\">u_1</span><span class=\"o\">}</span> <span class=\"n\">G</span> <span class=\"o\">(</span><span class=\"n\">Prod.</span><span class=\"o\">{</span><span class=\"n\">u_1</span><span class=\"o\">,</span> <span class=\"n\">u_1</span><span class=\"o\">}</span> <span class=\"n\">G</span> <span class=\"n\">G</span><span class=\"o\">)))))</span> <span class=\"n\">inst</span>\n          <span class=\"o\">(</span><span class=\"bp\">@</span><span class=\"n\">instGroupProd.</span><span class=\"o\">{</span><span class=\"n\">u_1</span><span class=\"o\">,</span> <span class=\"n\">u_1</span><span class=\"o\">}</span> <span class=\"n\">G</span> <span class=\"o\">(</span><span class=\"n\">Prod.</span><span class=\"o\">{</span><span class=\"n\">u_1</span><span class=\"o\">,</span> <span class=\"n\">u_1</span><span class=\"o\">}</span> <span class=\"n\">G</span> <span class=\"o\">(</span><span class=\"n\">Prod.</span><span class=\"o\">{</span><span class=\"n\">u_1</span><span class=\"o\">,</span> <span class=\"n\">u_1</span><span class=\"o\">}</span> <span class=\"n\">G</span> <span class=\"o\">(</span><span class=\"n\">Prod.</span><span class=\"o\">{</span><span class=\"n\">u_1</span><span class=\"o\">,</span> <span class=\"n\">u_1</span><span class=\"o\">}</span> <span class=\"n\">G</span> <span class=\"o\">(</span><span class=\"n\">Prod.</span><span class=\"o\">{</span><span class=\"n\">u_1</span><span class=\"o\">,</span> <span class=\"n\">u_1</span><span class=\"o\">}</span> <span class=\"n\">G</span> <span class=\"n\">G</span><span class=\"o\">))))</span>\n            <span class=\"n\">inst</span>\n            <span class=\"o\">(</span><span class=\"bp\">@</span><span class=\"n\">instGroupProd.</span><span class=\"o\">{</span><span class=\"n\">u_1</span><span class=\"o\">,</span> <span class=\"n\">u_1</span><span class=\"o\">}</span> <span class=\"n\">G</span> <span class=\"o\">(</span><span class=\"n\">Prod.</span><span class=\"o\">{</span><span class=\"n\">u_1</span><span class=\"o\">,</span> <span class=\"n\">u_1</span><span class=\"o\">}</span> <span class=\"n\">G</span> <span class=\"o\">(</span><span class=\"n\">Prod.</span><span class=\"o\">{</span><span class=\"n\">u_1</span><span class=\"o\">,</span> <span class=\"n\">u_1</span><span class=\"o\">}</span> <span class=\"n\">G</span> <span class=\"o\">(</span><span class=\"n\">Prod.</span><span class=\"o\">{</span><span class=\"n\">u_1</span><span class=\"o\">,</span> <span class=\"n\">u_1</span><span class=\"o\">}</span> <span class=\"n\">G</span> <span class=\"n\">G</span><span class=\"o\">)))</span> <span class=\"n\">inst</span>\n              <span class=\"o\">(</span><span class=\"bp\">@</span><span class=\"n\">instGroupProd.</span><span class=\"o\">{</span><span class=\"n\">u_1</span><span class=\"o\">,</span> <span class=\"n\">u_1</span><span class=\"o\">}</span> <span class=\"n\">G</span> <span class=\"o\">(</span><span class=\"n\">Prod.</span><span class=\"o\">{</span><span class=\"n\">u_1</span><span class=\"o\">,</span> <span class=\"n\">u_1</span><span class=\"o\">}</span> <span class=\"n\">G</span> <span class=\"o\">(</span><span class=\"n\">Prod.</span><span class=\"o\">{</span><span class=\"n\">u_1</span><span class=\"o\">,</span> <span class=\"n\">u_1</span><span class=\"o\">}</span> <span class=\"n\">G</span> <span class=\"n\">G</span><span class=\"o\">))</span> <span class=\"n\">inst</span>\n                <span class=\"o\">(</span><span class=\"bp\">@</span><span class=\"n\">instGroupProd.</span><span class=\"o\">{</span><span class=\"n\">u_1</span><span class=\"o\">,</span> <span class=\"n\">u_1</span><span class=\"o\">}</span> <span class=\"n\">G</span> <span class=\"o\">(</span><span class=\"n\">Prod.</span><span class=\"o\">{</span><span class=\"n\">u_1</span><span class=\"o\">,</span> <span class=\"n\">u_1</span><span class=\"o\">}</span> <span class=\"n\">G</span> <span class=\"n\">G</span><span class=\"o\">)</span> <span class=\"n\">inst</span> <span class=\"o\">(</span><span class=\"bp\">@</span><span class=\"n\">instGroupProd.</span><span class=\"o\">{</span><span class=\"n\">u_1</span><span class=\"o\">,</span> <span class=\"n\">u_1</span><span class=\"o\">}</span> <span class=\"n\">G</span> <span class=\"n\">G</span> <span class=\"n\">inst</span> <span class=\"n\">inst</span><span class=\"o\">))))))))</span>\n    <span class=\"o\">(</span><span class=\"bp\">@</span><span class=\"n\">instGroupProd.proof_1.</span><span class=\"o\">{</span><span class=\"n\">u_1</span><span class=\"o\">,</span> <span class=\"n\">u_1</span><span class=\"o\">}</span> <span class=\"n\">G</span>\n      <span class=\"o\">(</span><span class=\"n\">Prod.</span><span class=\"o\">{</span><span class=\"n\">u_1</span><span class=\"o\">,</span> <span class=\"n\">u_1</span><span class=\"o\">}</span> <span class=\"n\">G</span>\n        <span class=\"o\">(</span><span class=\"n\">Prod.</span><span class=\"o\">{</span><span class=\"n\">u_1</span><span class=\"o\">,</span> <span class=\"n\">u_1</span><span class=\"o\">}</span> <span class=\"n\">G</span> <span class=\"o\">(</span><span class=\"n\">Prod.</span><span class=\"o\">{</span><span class=\"n\">u_1</span><span class=\"o\">,</span> <span class=\"n\">u_1</span><span class=\"o\">}</span> <span class=\"n\">G</span> <span class=\"o\">(</span><span class=\"n\">Prod.</span><span class=\"o\">{</span><span class=\"n\">u_1</span><span class=\"o\">,</span> <span class=\"n\">u_1</span><span class=\"o\">}</span> <span class=\"n\">G</span> <span class=\"o\">(</span><span class=\"n\">Prod.</span><span class=\"o\">{</span><span class=\"n\">u_1</span><span class=\"o\">,</span> <span class=\"n\">u_1</span><span class=\"o\">}</span> <span class=\"n\">G</span> <span class=\"o\">(</span><span class=\"n\">Prod.</span><span class=\"o\">{</span><span class=\"n\">u_1</span><span class=\"o\">,</span> <span class=\"n\">u_1</span><span class=\"o\">}</span> <span class=\"n\">G</span> <span class=\"n\">G</span><span class=\"o\">))))))</span>\n      <span class=\"n\">inst</span>\n      <span class=\"o\">(</span><span class=\"bp\">@</span><span class=\"n\">instGroupProd.</span><span class=\"o\">{</span><span class=\"n\">u_1</span><span class=\"o\">,</span> <span class=\"n\">u_1</span><span class=\"o\">}</span> <span class=\"n\">G</span>\n        <span class=\"o\">(</span><span class=\"n\">Prod.</span><span class=\"o\">{</span><span class=\"n\">u_1</span><span class=\"o\">,</span> <span class=\"n\">u_1</span><span class=\"o\">}</span> <span class=\"n\">G</span> <span class=\"o\">(</span><span class=\"n\">Prod.</span><span class=\"o\">{</span><span class=\"n\">u_1</span><span class=\"o\">,</span> <span class=\"n\">u_1</span><span class=\"o\">}</span> <span class=\"n\">G</span> <span class=\"o\">(</span><span class=\"n\">Prod.</span><span class=\"o\">{</span><span class=\"n\">u_1</span><span class=\"o\">,</span> <span class=\"n\">u_1</span><span class=\"o\">}</span> <span class=\"n\">G</span> <span class=\"o\">(</span><span class=\"n\">Prod.</span><span class=\"o\">{</span><span class=\"n\">u_1</span><span class=\"o\">,</span> <span class=\"n\">u_1</span><span class=\"o\">}</span> <span class=\"n\">G</span> <span class=\"o\">(</span><span class=\"n\">Prod.</span><span class=\"o\">{</span><span class=\"n\">u_1</span><span class=\"o\">,</span> <span class=\"n\">u_1</span><span class=\"o\">}</span> <span class=\"n\">G</span> <span class=\"n\">G</span><span class=\"o\">)))))</span> <span class=\"n\">inst</span>\n        <span class=\"o\">(</span><span class=\"bp\">@</span><span class=\"n\">instGroupProd.</span><span class=\"o\">{</span><span class=\"n\">u_1</span><span class=\"o\">,</span> <span class=\"n\">u_1</span><span class=\"o\">}</span> <span class=\"n\">G</span> <span class=\"o\">(</span><span class=\"n\">Prod.</span><span class=\"o\">{</span><span class=\"n\">u_1</span><span class=\"o\">,</span> <span class=\"n\">u_1</span><span class=\"o\">}</span> <span class=\"n\">G</span> <span class=\"o\">(</span><span class=\"n\">Prod.</span><span class=\"o\">{</span><span class=\"n\">u_1</span><span class=\"o\">,</span> <span class=\"n\">u_1</span><span class=\"o\">}</span> <span class=\"n\">G</span> <span class=\"o\">(</span><span class=\"n\">Prod.</span><span class=\"o\">{</span><span class=\"n\">u_1</span><span class=\"o\">,</span> <span class=\"n\">u_1</span><span class=\"o\">}</span> <span class=\"n\">G</span> <span class=\"o\">(</span><span class=\"n\">Prod.</span><span class=\"o\">{</span><span class=\"n\">u_1</span><span class=\"o\">,</span> <span class=\"n\">u_1</span><span class=\"o\">}</span> <span class=\"n\">G</span> <span class=\"n\">G</span><span class=\"o\">))))</span>\n          <span class=\"n\">inst</span>\n          <span class=\"o\">(</span><span class=\"bp\">@</span><span class=\"n\">instGroupProd.</span><span class=\"o\">{</span><span class=\"n\">u_1</span><span class=\"o\">,</span> <span class=\"n\">u_1</span><span class=\"o\">}</span> <span class=\"n\">G</span> <span class=\"o\">(</span><span class=\"n\">Prod.</span><span class=\"o\">{</span><span class=\"n\">u_1</span><span class=\"o\">,</span> <span class=\"n\">u_1</span><span class=\"o\">}</span> <span class=\"n\">G</span> <span class=\"o\">(</span><span class=\"n\">Prod.</span><span class=\"o\">{</span><span class=\"n\">u_1</span><span class=\"o\">,</span> <span class=\"n\">u_1</span><span class=\"o\">}</span> <span class=\"n\">G</span> <span class=\"o\">(</span><span class=\"n\">Prod.</span><span class=\"o\">{</span><span class=\"n\">u_1</span><span class=\"o\">,</span> <span class=\"n\">u_1</span><span class=\"o\">}</span> <span class=\"n\">G</span> <span class=\"n\">G</span><span class=\"o\">)))</span> <span class=\"n\">inst</span>\n            <span class=\"o\">(</span><span class=\"bp\">@</span><span class=\"n\">instGroupProd.</span><span class=\"o\">{</span><span class=\"n\">u_1</span><span class=\"o\">,</span> <span class=\"n\">u_1</span><span class=\"o\">}</span> <span class=\"n\">G</span> <span class=\"o\">(</span><span class=\"n\">Prod.</span><span class=\"o\">{</span><span class=\"n\">u_1</span><span class=\"o\">,</span> <span class=\"n\">u_1</span><span class=\"o\">}</span> <span class=\"n\">G</span> <span class=\"o\">(</span><span class=\"n\">Prod.</span><span class=\"o\">{</span><span class=\"n\">u_1</span><span class=\"o\">,</span> <span class=\"n\">u_1</span><span class=\"o\">}</span> <span class=\"n\">G</span> <span class=\"n\">G</span><span class=\"o\">))</span> <span class=\"n\">inst</span>\n              <span class=\"o\">(</span><span class=\"bp\">@</span><span class=\"n\">instGroupProd.</span><span class=\"o\">{</span><span class=\"n\">u_1</span><span class=\"o\">,</span> <span class=\"n\">u_1</span><span class=\"o\">}</span> <span class=\"n\">G</span> <span class=\"o\">(</span><span class=\"n\">Prod.</span><span class=\"o\">{</span><span class=\"n\">u_1</span><span class=\"o\">,</span> <span class=\"n\">u_1</span><span class=\"o\">}</span> <span class=\"n\">G</span> <span class=\"n\">G</span><span class=\"o\">)</span> <span class=\"n\">inst</span> <span class=\"o\">(</span><span class=\"bp\">@</span><span class=\"n\">instGroupProd.</span><span class=\"o\">{</span><span class=\"n\">u_1</span><span class=\"o\">,</span> <span class=\"n\">u_1</span><span class=\"o\">}</span> <span class=\"n\">G</span> <span class=\"n\">G</span> <span class=\"n\">inst</span> <span class=\"n\">inst</span><span class=\"o\">)))))))</span>\n</code></pre></div>",
        "id": 223433431,
        "sender_full_name": "Kyle Miller",
        "timestamp": 1611175941
    },
    {
        "content": "<p>Nevermind, I now see how this avoids the limitations of the versions I was thinking of - you're taking advantage of dependent types in the extends clause</p>",
        "id": 223439481,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1611178752
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"306601\">@Kyle Miller</span> Thanks. This is a useful experiment. I added it to the test suite. BTW, the internal expressions are much smaller since they are shared. Here is your example + code for computing the actual \"number of <code>Expr</code> objects used by Lean\"<br>\n<a href=\"https://github.com/leanprover/lean4/blob/c78a06d9a5553e8ffc5ffeeb7ba75fd271bc272e/tests/lean/run/KyleAlg.lean#L262-L278\">https://github.com/leanprover/lean4/blob/c78a06d9a5553e8ffc5ffeeb7ba75fd271bc272e/tests/lean/run/KyleAlg.lean#L262-L278</a></p>",
        "id": 223552643,
        "sender_full_name": "Leonardo de Moura",
        "timestamp": 1611254596
    },
    {
        "content": "<p>Suppose I use this technique and fill out the appropriate instances for Bool. Is there a more efficient way of writing the following?</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kd\">instance</span> <span class=\"o\">:</span> <span class=\"n\">Semiring</span> <span class=\"n\">Bool</span> <span class=\"o\">:=</span>\n <span class=\"o\">{</span> <span class=\"n\">zero</span> <span class=\"o\">:=</span> <span class=\"n\">Zero.zero</span><span class=\"o\">,</span> <span class=\"n\">one</span> <span class=\"o\">:=</span> <span class=\"n\">One.one</span><span class=\"o\">,</span> <span class=\"n\">mul</span> <span class=\"o\">:=</span> <span class=\"n\">Mul.mul</span><span class=\"o\">,</span> <span class=\"n\">add</span> <span class=\"o\">:=</span> <span class=\"n\">Add.add</span><span class=\"o\">,</span> <span class=\"n\">addComm</span> <span class=\"o\">:=</span> <span class=\"n\">AddComm.addComm</span><span class=\"o\">,</span>\n   <span class=\"n\">oneMul</span> <span class=\"o\">:=</span> <span class=\"n\">OneUnit.oneMul</span><span class=\"o\">,</span> <span class=\"n\">mulOne</span> <span class=\"o\">:=</span> <span class=\"n\">OneUnit.mulOne</span> <span class=\"o\">}</span>\n</code></pre></div>",
        "id": 236016077,
        "sender_full_name": "Scott Viteri",
        "timestamp": 1619305752
    },
    {
        "content": "<p>nevermind thx Mario <code>instance : Semiring Bool := {}</code></p>",
        "id": 236031517,
        "sender_full_name": "Scott Viteri",
        "timestamp": 1619319235
    }
]