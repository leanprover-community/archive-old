[
    {
        "content": "<p>I'm trying to install Lean 4 on an M1 Mac (I already have Lean 3 setup). I tried following the <a href=\"https://leanprover.github.io/lean4/doc/quickstart.html\">Quick Start</a> page and run:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"n\">curl</span> <span class=\"n\">https</span><span class=\"o\">:</span><span class=\"bp\">//</span><span class=\"n\">raw.githubusercontent.com</span><span class=\"bp\">/</span><span class=\"n\">leanprover</span><span class=\"bp\">/</span><span class=\"n\">elan</span><span class=\"bp\">/</span><span class=\"n\">master</span><span class=\"bp\">/</span><span class=\"n\">elan</span><span class=\"bp\">-</span><span class=\"n\">init.sh</span> <span class=\"bp\">-</span><span class=\"n\">sSf</span> <span class=\"bp\">|</span> <span class=\"n\">sh</span> <span class=\"bp\">-</span><span class=\"n\">s</span> <span class=\"c1\">-- --default-toolchain leanprover/lean4:nightly</span>\n</code></pre></div>\n<p>But I get: <code>elan: unknown CPU type: arm64</code>.</p>\n<p>Following the <a href=\"https://leanprover.github.io/lean4/doc/setup.html#basic-setup\">Basic Setup</a> seems to work. That is, I can get <code>leanprover/lean4:stable</code> as the active toolchain:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"bp\">$</span> <span class=\"n\">elan</span> <span class=\"k\">show</span>\n<span class=\"n\">installed</span> <span class=\"n\">toolchains</span>\n<span class=\"c1\">--------------------</span>\n\n<span class=\"n\">stable</span>\n<span class=\"n\">leanprover</span><span class=\"bp\">-</span><span class=\"n\">community</span><span class=\"bp\">-</span><span class=\"n\">lean</span><span class=\"bp\">-</span><span class=\"mi\">3</span><span class=\"bp\">.</span><span class=\"mi\">24</span><span class=\"bp\">.</span><span class=\"mi\">0</span>\n<span class=\"n\">leanprover</span><span class=\"bp\">-</span><span class=\"n\">community</span><span class=\"bp\">/</span><span class=\"n\">lean</span><span class=\"o\">:</span><span class=\"mi\">3</span><span class=\"bp\">.</span><span class=\"mi\">27</span><span class=\"bp\">.</span><span class=\"mi\">0</span>\n<span class=\"n\">leanprover</span><span class=\"bp\">/</span><span class=\"n\">lean4</span><span class=\"o\">:</span><span class=\"n\">stable</span> <span class=\"o\">(</span><span class=\"n\">default</span><span class=\"o\">)</span>\n\n<span class=\"n\">active</span> <span class=\"n\">toolchain</span>\n<span class=\"c1\">----------------</span>\n\n<span class=\"n\">leanprover</span><span class=\"bp\">/</span><span class=\"n\">lean4</span><span class=\"o\">:</span><span class=\"n\">stable</span> <span class=\"o\">(</span><span class=\"n\">default</span><span class=\"o\">)</span>\n<span class=\"n\">Lean</span> <span class=\"o\">(</span><span class=\"n\">version</span> <span class=\"mi\">4</span><span class=\"bp\">.</span><span class=\"mi\">0</span><span class=\"bp\">.</span><span class=\"mi\">0</span><span class=\"bp\">-</span><span class=\"n\">m2</span><span class=\"o\">,</span> <span class=\"n\">commit</span> <span class=\"mi\">26</span><span class=\"n\">dda3f63d88</span><span class=\"o\">,</span> <span class=\"n\">Release</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>But creating a new project via <code>leanpkg init</code> still uses Lean 3:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"bp\">$</span><span class=\"o\">:</span> <span class=\"n\">leanpkg</span> <span class=\"n\">init</span> <span class=\"n\">test</span>\n<span class=\"n\">Move</span> <span class=\"n\">existing</span> <span class=\"bp\">.</span><span class=\"n\">lean</span> <span class=\"n\">files</span> <span class=\"n\">into</span> <span class=\"n\">the</span> <span class=\"bp\">'</span><span class=\"n\">src'</span> <span class=\"n\">folder.</span>\n<span class=\"bp\">&gt;</span> <span class=\"n\">git</span> <span class=\"n\">init</span> <span class=\"bp\">-</span><span class=\"n\">q</span>\n<span class=\"bp\">&gt;</span> <span class=\"n\">git</span> <span class=\"n\">checkout</span> <span class=\"bp\">-</span><span class=\"n\">b</span> <span class=\"n\">lean</span><span class=\"bp\">-</span><span class=\"mi\">3</span><span class=\"bp\">.</span><span class=\"mi\">30</span><span class=\"bp\">.</span><span class=\"mi\">0</span>\n<span class=\"n\">Switched</span> <span class=\"n\">to</span> <span class=\"n\">a</span> <span class=\"n\">new</span> <span class=\"n\">branch</span> <span class=\"bp\">'</span><span class=\"n\">lean</span><span class=\"bp\">-</span><span class=\"mi\">3</span><span class=\"bp\">.</span><span class=\"mi\">30</span><span class=\"bp\">.</span><span class=\"mi\">0</span><span class=\"bp\">'</span>\n<span class=\"n\">configuring</span> <span class=\"n\">test</span> <span class=\"mi\">0</span><span class=\"bp\">.</span><span class=\"mi\">1</span>\n</code></pre></div>\n<p>This also matches the <code>lean -v</code>: <code>Lean (version 3.30.0, Release)</code>.</p>\n<hr>\n<p>Quite frankly, with <code>lean</code>, <code>elan</code>, <code>leanpkg</code> and <code>leanproject</code>, I'm massively confused about what each component does.<br>\nWhat needs to be installed in order to get a working Lean 4 project?</p>",
        "id": 246829532,
        "sender_full_name": "Marcus Rossel",
        "timestamp": 1626949132
    },
    {
        "content": "<p>I think you need <code>elan override leanprover/lean4:stable</code> in your project directory</p>",
        "id": 246829992,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1626949454
    },
    {
        "content": "<p>I'm guessing you mean <code>elan override set leanprover/lean4:stable</code>?</p>",
        "id": 246830062,
        "sender_full_name": "Marcus Rossel",
        "timestamp": 1626949508
    },
    {
        "content": "<p>that locally overrides the <code>lean</code> executable in your directory (it's actually a symlink to <code>elan</code> which redirects to the right <code>lean</code> installation)</p>",
        "id": 246830066,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1626949512
    },
    {
        "content": "<p>yes that</p>",
        "id": 246830077,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1626949515
    },
    {
        "content": "<p>I think the problem is that I don't have a Lean 4 executable, because <code>curl https://raw.githubusercontent.com/leanprover/elan/master/elan-init.sh -sSf | sh -s -- --default-toolchain leanprover/lean4:nightly</code> failed.</p>",
        "id": 246830102,
        "sender_full_name": "Marcus Rossel",
        "timestamp": 1626949542
    },
    {
        "content": "<p>You shouldn't use that line if you already have elan installed</p>",
        "id": 246830165,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1626949565
    },
    {
        "content": "<p>Ok, so I'm in a directory <code>lean4test</code>. I do:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"n\">marcus</span><span class=\"bp\">@</span><span class=\"n\">lean4test</span><span class=\"o\">:</span> <span class=\"n\">elan</span> <span class=\"n\">override</span> <span class=\"n\">set</span> <span class=\"n\">leanprover</span><span class=\"bp\">/</span><span class=\"n\">lean4</span><span class=\"o\">:</span><span class=\"n\">stable</span>\n<span class=\"n\">info</span><span class=\"o\">:</span> <span class=\"n\">using</span> <span class=\"n\">existing</span> <span class=\"n\">install</span> <span class=\"n\">for</span> <span class=\"bp\">'</span><span class=\"n\">leanprover</span><span class=\"bp\">/</span><span class=\"n\">lean4</span><span class=\"o\">:</span><span class=\"n\">stable'</span>\n<span class=\"n\">info</span><span class=\"o\">:</span> <span class=\"n\">override</span> <span class=\"n\">toolchain</span> <span class=\"n\">for</span> <span class=\"bp\">'/</span><span class=\"n\">Users</span><span class=\"bp\">/</span><span class=\"n\">marcus</span><span class=\"bp\">/</span><span class=\"n\">Arbeit</span><span class=\"bp\">/</span><span class=\"n\">lean4test'</span> <span class=\"n\">set</span> <span class=\"n\">to</span> <span class=\"bp\">'</span><span class=\"n\">leanprover</span><span class=\"bp\">/</span><span class=\"n\">lean4</span><span class=\"o\">:</span><span class=\"n\">stable'</span>\n\n  <span class=\"n\">leanprover</span><span class=\"bp\">/</span><span class=\"n\">lean4</span><span class=\"o\">:</span><span class=\"n\">stable</span> <span class=\"n\">unchanged</span> <span class=\"bp\">-</span> <span class=\"n\">Lean</span> <span class=\"o\">(</span><span class=\"n\">version</span> <span class=\"mi\">4</span><span class=\"bp\">.</span><span class=\"mi\">0</span><span class=\"bp\">.</span><span class=\"mi\">0</span><span class=\"bp\">-</span><span class=\"n\">m2</span><span class=\"o\">,</span> <span class=\"n\">commit</span> <span class=\"mi\">26</span><span class=\"n\">dda3f63d88</span><span class=\"o\">,</span> <span class=\"n\">Release</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>Then:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"n\">marcus</span><span class=\"bp\">@</span><span class=\"n\">lean4test</span><span class=\"o\">:</span> <span class=\"n\">leanpkg</span> <span class=\"n\">init</span> <span class=\"n\">lean4test</span>\n<span class=\"n\">Move</span> <span class=\"n\">existing</span> <span class=\"bp\">.</span><span class=\"n\">lean</span> <span class=\"n\">files</span> <span class=\"n\">into</span> <span class=\"n\">the</span> <span class=\"bp\">'</span><span class=\"n\">src'</span> <span class=\"n\">folder.</span>\n<span class=\"bp\">&gt;</span> <span class=\"n\">git</span> <span class=\"n\">init</span> <span class=\"bp\">-</span><span class=\"n\">q</span>\n<span class=\"bp\">&gt;</span> <span class=\"n\">git</span> <span class=\"n\">checkout</span> <span class=\"bp\">-</span><span class=\"n\">b</span> <span class=\"n\">lean</span><span class=\"bp\">-</span><span class=\"mi\">3</span><span class=\"bp\">.</span><span class=\"mi\">30</span><span class=\"bp\">.</span><span class=\"mi\">0</span>\n<span class=\"n\">Switched</span> <span class=\"n\">to</span> <span class=\"n\">a</span> <span class=\"n\">new</span> <span class=\"n\">branch</span> <span class=\"bp\">'</span><span class=\"n\">lean</span><span class=\"bp\">-</span><span class=\"mi\">3</span><span class=\"bp\">.</span><span class=\"mi\">30</span><span class=\"bp\">.</span><span class=\"mi\">0</span><span class=\"bp\">'</span>\n<span class=\"n\">configuring</span> <span class=\"n\">lean4test</span> <span class=\"mi\">0</span><span class=\"bp\">.</span><span class=\"mi\">1</span>\n</code></pre></div>\n<p>That still uses Lean 3 ¯\\_(ツ)_/¯</p>",
        "id": 246830374,
        "sender_full_name": "Marcus Rossel",
        "timestamp": 1626949725
    },
    {
        "content": "<p>The generated leanpkg.toml will take care of selecting the correct Lean version, no need for <code>override</code>. To select a custom version temporarily, use <code> leanpkg +leanprover/lean4:nightly init test</code>.</p>",
        "id": 246830426,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1626949767
    },
    {
        "content": "<p>That command just prints the help screen for me:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"n\">marcus</span><span class=\"bp\">@</span><span class=\"n\">lean4test</span><span class=\"o\">:</span> <span class=\"n\">leanpkg</span> <span class=\"bp\">+</span><span class=\"n\">leanprover</span><span class=\"bp\">/</span><span class=\"n\">lean4</span><span class=\"o\">:</span><span class=\"n\">stable</span> <span class=\"n\">init</span> <span class=\"n\">test</span>\n<span class=\"n\">Lean</span> <span class=\"n\">package</span> <span class=\"n\">manager</span><span class=\"o\">,</span> <span class=\"n\">version</span> <span class=\"mi\">3</span><span class=\"bp\">.</span><span class=\"mi\">30</span><span class=\"bp\">.</span><span class=\"mi\">0</span>\n\n<span class=\"n\">Usage</span><span class=\"o\">:</span> <span class=\"n\">leanpkg</span> <span class=\"bp\">&lt;</span><span class=\"n\">command</span><span class=\"bp\">&gt;</span>\n\n<span class=\"n\">configure</span>              <span class=\"n\">download</span> <span class=\"n\">dependencies</span>\n<span class=\"n\">build</span> <span class=\"o\">[</span><span class=\"c1\">-- &lt;lean-args&gt;] download dependencies and build *.olean files</span>\n<span class=\"n\">test</span>  <span class=\"o\">[</span><span class=\"c1\">-- &lt;lean-args&gt;] download dependencies, build *.olean files, and run test files</span>\n\n<span class=\"n\">new</span> <span class=\"bp\">&lt;</span><span class=\"n\">dir</span><span class=\"bp\">&gt;</span>              <span class=\"n\">create</span> <span class=\"n\">a</span> <span class=\"n\">Lean</span> <span class=\"n\">package</span> <span class=\"k\">in</span> <span class=\"n\">a</span> <span class=\"n\">new</span> <span class=\"n\">directory</span>\n<span class=\"n\">init</span> <span class=\"bp\">&lt;</span><span class=\"n\">name</span><span class=\"bp\">&gt;</span>            <span class=\"n\">create</span> <span class=\"n\">a</span> <span class=\"n\">Lean</span> <span class=\"n\">package</span> <span class=\"k\">in</span> <span class=\"n\">the</span> <span class=\"n\">current</span> <span class=\"n\">directory</span>\n\n<span class=\"n\">add</span> <span class=\"bp\">&lt;</span><span class=\"n\">url</span><span class=\"bp\">&gt;</span> <span class=\"o\">[</span><span class=\"n\">branch</span><span class=\"o\">]</span>     <span class=\"n\">add</span> <span class=\"n\">a</span> <span class=\"n\">dependency</span> <span class=\"k\">from</span> <span class=\"n\">a</span> <span class=\"n\">git</span> <span class=\"n\">repository</span> <span class=\"o\">(</span><span class=\"n\">uses</span> <span class=\"n\">latest</span> <span class=\"n\">upstream</span> <span class=\"n\">revision</span><span class=\"o\">)</span>\n<span class=\"n\">add</span> <span class=\"bp\">&lt;</span><span class=\"n\">dir</span><span class=\"bp\">&gt;</span>              <span class=\"n\">add</span> <span class=\"n\">a</span> <span class=\"kn\">local</span> <span class=\"n\">dependency</span>\n<span class=\"n\">upgrade</span>                <span class=\"n\">upgrade</span> <span class=\"n\">all</span> <span class=\"n\">git</span> <span class=\"n\">dependencies</span> <span class=\"n\">to</span> <span class=\"n\">the</span> <span class=\"n\">latest</span> <span class=\"n\">upstream</span> <span class=\"n\">version</span>\n\n<span class=\"n\">install</span> <span class=\"bp\">&lt;</span><span class=\"n\">url</span><span class=\"bp\">&gt;</span> <span class=\"o\">[</span><span class=\"n\">branch</span><span class=\"o\">]</span> <span class=\"n\">install</span> <span class=\"n\">a</span> <span class=\"n\">user</span><span class=\"bp\">-</span><span class=\"n\">wide</span> <span class=\"n\">package</span> <span class=\"k\">from</span> <span class=\"n\">git</span>\n<span class=\"n\">install</span> <span class=\"bp\">&lt;</span><span class=\"n\">dir</span><span class=\"bp\">&gt;</span>          <span class=\"n\">install</span> <span class=\"n\">a</span> <span class=\"n\">user</span><span class=\"bp\">-</span><span class=\"n\">wide</span> <span class=\"n\">package</span> <span class=\"k\">from</span> <span class=\"n\">a</span> <span class=\"kn\">local</span> <span class=\"n\">directory</span>\n\n<span class=\"n\">dump</span>                   <span class=\"n\">print</span> <span class=\"n\">the</span> <span class=\"n\">parsed</span> <span class=\"n\">leanpkg.toml</span> <span class=\"n\">file</span> <span class=\"o\">(</span><span class=\"n\">for</span> <span class=\"n\">debugging</span><span class=\"o\">)</span>\n\n<span class=\"n\">See</span> <span class=\"bp\">`</span><span class=\"n\">leanpkg</span> <span class=\"n\">help</span> <span class=\"bp\">&lt;</span><span class=\"n\">command</span><span class=\"bp\">&gt;`</span> <span class=\"n\">for</span> <span class=\"n\">more</span> <span class=\"n\">information</span> <span class=\"n\">on</span> <span class=\"n\">a</span> <span class=\"n\">specific</span> <span class=\"n\">command.</span>\n</code></pre></div>",
        "id": 246830556,
        "sender_full_name": "Marcus Rossel",
        "timestamp": 1626949853
    },
    {
        "content": "<p>Then your <code>leanpkg</code> is not from <code>elan</code>. Try <code>which leanpkg</code>.</p>",
        "id": 246830680,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1626949958
    },
    {
        "content": "<p>Ahhh, homebrew: <code>/opt/homebrew/bin/leanpkg</code></p>",
        "id": 246830707,
        "sender_full_name": "Marcus Rossel",
        "timestamp": 1626949980
    },
    {
        "content": "<p>Ok, so my <code>$PATH</code>had the following order: <code>/opt/homebrew/bin:/opt/homebrew/sbin:/Users/marcus/.elan</code>.<br>\nChanging that order to <code>/Users/marcus/.elan:/opt/homebrew/bin:/opt/homebrew/sbin</code> fixed the problem :)</p>",
        "id": 246831477,
        "sender_full_name": "Marcus Rossel",
        "timestamp": 1626950528
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"372804\">Marcus Rossel</span> has marked this topic as resolved.</p>",
        "id": 246831515,
        "sender_full_name": "Notification Bot",
        "timestamp": 1626950563
    }
]