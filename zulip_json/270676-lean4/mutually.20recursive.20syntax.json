[
    {
        "content": "<p>Hi! I'm trying to define mutually recursive syntax and that seems to confuse the syntax extension algorithm:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"n\">declare_syntax_cat</span> <span class=\"n\">foo</span>\n<span class=\"n\">declare_syntax_cat</span> <span class=\"n\">bar</span>\n<span class=\"n\">syntax</span> <span class=\"s2\">\"fooval\"</span> <span class=\"o\">:</span> <span class=\"n\">foo</span>\n<span class=\"c1\">--syntax bar : foo</span>\n<span class=\"n\">syntax</span> <span class=\"n\">foo</span> <span class=\"o\">:</span> <span class=\"n\">bar</span>\n<span class=\"n\">syntax</span> <span class=\"s2\">\"[bar|\"</span> <span class=\"n\">bar</span> <span class=\"s2\">\"]\"</span><span class=\"o\">:</span> <span class=\"n\">term</span>\n<span class=\"n\">syntax</span> <span class=\"s2\">\"[foo|\"</span> <span class=\"n\">foo</span> <span class=\"s2\">\"]\"</span><span class=\"o\">:</span> <span class=\"n\">term</span>\n\n<span class=\"n\">macro_rules</span>\n <span class=\"bp\">|</span> <span class=\"bp\">`</span><span class=\"o\">([</span><span class=\"n\">foo</span><span class=\"bp\">|</span> <span class=\"n\">fooval</span> <span class=\"o\">])</span> <span class=\"bp\">=&gt;</span> <span class=\"bp\">`</span><span class=\"o\">(</span><span class=\"mi\">42</span><span class=\"o\">)</span>\n <span class=\"bp\">|</span> <span class=\"bp\">`</span><span class=\"o\">([</span><span class=\"n\">bar</span><span class=\"bp\">|</span> <span class=\"bp\">$</span><span class=\"n\">x</span><span class=\"o\">:</span><span class=\"n\">foo</span><span class=\"o\">])</span> <span class=\"bp\">=&gt;</span> <span class=\"bp\">`</span><span class=\"o\">([</span><span class=\"n\">foo</span><span class=\"bp\">|</span> <span class=\"bp\">$</span><span class=\"n\">x</span><span class=\"o\">])</span>\n<span class=\"c1\">-- | `([foo| $x:bar ]) =&gt; `([bar| $x])</span>\n\n<span class=\"k\">#eval</span> <span class=\"o\">[</span><span class=\"n\">bar</span><span class=\"bp\">|</span> <span class=\"n\">fooval</span> <span class=\"o\">]</span>\n</code></pre></div>\n<p>If I uncomment the first line here (<code>syntax bar: foo</code>), Lean gets stuck (emacs just hangs evaluating it, vscode says potentially a stack overflow), probably because it gets caught up in the recursion that <code>foo : bar</code> and <code>bar : foo</code>. In theory, with the line commented below in the macro rules, this should work well, as the delaborator would not get caught in an infinite loop if the mutual recursion is the last call. I guess if there's some syntax error then it could fall through the infinite loop...</p>\n<p>Is there away around this? E.g. defining some custom parser combinator?</p>",
        "id": 284998530,
        "sender_full_name": "Andrés Goens",
        "timestamp": 1654374523
    },
    {
        "content": "<p>If you have <code>syntax foo: bar</code> and <code>syntax bar: foo</code>, then you really only have a single syntax category with two different names. Do you not have any guards around the sub-foo in bar and the sub-bar in foo in your use case?</p>",
        "id": 284998906,
        "sender_full_name": "Sébastien Michelland",
        "timestamp": 1654375141
    },
    {
        "content": "<p>oh, that's because I reduced my MWE, in the real example I really do have two distinct syntax categories with different syntax. I actually don't have any guards there, nope. To be concrete, I was trying to define <a href=\"https://en.wikipedia.org/wiki/CTL*#Syntax\">CTL* syntax</a> and there you don't really have guards either, would be pretty unnatural to have them</p>",
        "id": 284999303,
        "sender_full_name": "Andrés Goens",
        "timestamp": 1654375755
    },
    {
        "content": "<p>I can see in that piece of grammar that you have <code>ϕ ::= Φ</code>, but where do you have the other one? I can only see <code>Φ ::= Aϕ | Eϕ</code>, which has leading symbols <code>A</code> and <code>E</code> that would prevent the left recursion (acting as what I called guards).</p>",
        "id": 284999608,
        "sender_full_name": "Sébastien Michelland",
        "timestamp": 1654376255
    },
    {
        "content": "<p>As Sebastien said if you write this grammar down in Lean:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kn\">import</span> <span class=\"n\">Lean</span>\n\n<span class=\"kd\">mutual</span>\n\n<span class=\"kd\">inductive</span> <span class=\"n\">State</span> <span class=\"n\">where</span>\n  <span class=\"bp\">|</span> <span class=\"n\">bot</span> <span class=\"o\">:</span> <span class=\"n\">State</span>\n  <span class=\"bp\">|</span> <span class=\"n\">top</span> <span class=\"o\">:</span> <span class=\"n\">State</span>\n  <span class=\"bp\">|</span> <span class=\"n\">var</span> <span class=\"o\">:</span> <span class=\"n\">Lean.Name</span> <span class=\"bp\">→</span> <span class=\"n\">State</span>\n  <span class=\"bp\">|</span> <span class=\"n\">neg</span> <span class=\"o\">:</span> <span class=\"n\">State</span> <span class=\"bp\">→</span> <span class=\"n\">State</span>\n  <span class=\"bp\">|</span> <span class=\"n\">and</span> <span class=\"o\">:</span> <span class=\"n\">State</span> <span class=\"bp\">→</span> <span class=\"n\">State</span> <span class=\"bp\">→</span> <span class=\"n\">State</span>\n  <span class=\"bp\">|</span> <span class=\"n\">or</span> <span class=\"o\">:</span> <span class=\"n\">State</span> <span class=\"bp\">→</span> <span class=\"n\">State</span> <span class=\"bp\">→</span> <span class=\"n\">State</span>\n  <span class=\"bp\">|</span> <span class=\"n\">imp</span> <span class=\"o\">:</span> <span class=\"n\">State</span> <span class=\"bp\">→</span> <span class=\"n\">State</span> <span class=\"bp\">→</span> <span class=\"n\">State</span>\n  <span class=\"bp\">|</span> <span class=\"n\">iff</span> <span class=\"o\">:</span> <span class=\"n\">State</span> <span class=\"bp\">→</span> <span class=\"n\">State</span> <span class=\"bp\">→</span> <span class=\"n\">State</span>\n  <span class=\"bp\">|</span> <span class=\"n\">aPath</span> <span class=\"o\">:</span> <span class=\"n\">Path</span> <span class=\"bp\">→</span> <span class=\"n\">State</span>\n  <span class=\"bp\">|</span> <span class=\"n\">ePath</span> <span class=\"o\">:</span> <span class=\"n\">Path</span> <span class=\"bp\">→</span> <span class=\"n\">State</span>\n\n<span class=\"kd\">inductive</span> <span class=\"n\">Path</span> <span class=\"n\">where</span>\n  <span class=\"bp\">|</span> <span class=\"n\">state</span> <span class=\"o\">:</span> <span class=\"n\">State</span> <span class=\"bp\">→</span> <span class=\"n\">Path</span>\n  <span class=\"bp\">|</span> <span class=\"n\">neg</span> <span class=\"o\">:</span> <span class=\"n\">Path</span> <span class=\"bp\">→</span> <span class=\"n\">Path</span>\n  <span class=\"bp\">|</span> <span class=\"n\">and</span> <span class=\"o\">:</span> <span class=\"n\">Path</span> <span class=\"bp\">→</span> <span class=\"n\">Path</span> <span class=\"bp\">→</span> <span class=\"n\">Path</span>\n  <span class=\"bp\">|</span> <span class=\"n\">or</span> <span class=\"o\">:</span> <span class=\"n\">Path</span> <span class=\"bp\">→</span> <span class=\"n\">Path</span> <span class=\"bp\">→</span> <span class=\"n\">Path</span>\n  <span class=\"bp\">|</span> <span class=\"n\">imp</span> <span class=\"o\">:</span> <span class=\"n\">Path</span> <span class=\"bp\">→</span> <span class=\"n\">Path</span> <span class=\"bp\">→</span> <span class=\"n\">Path</span>\n  <span class=\"bp\">|</span> <span class=\"n\">iff</span> <span class=\"o\">:</span> <span class=\"n\">Path</span> <span class=\"bp\">→</span> <span class=\"n\">Path</span> <span class=\"bp\">→</span> <span class=\"n\">Path</span>\n  <span class=\"bp\">|</span> <span class=\"n\">x</span> <span class=\"o\">:</span> <span class=\"n\">Path</span> <span class=\"bp\">→</span> <span class=\"n\">Path</span>\n  <span class=\"bp\">|</span> <span class=\"n\">f</span> <span class=\"o\">:</span> <span class=\"n\">Path</span> <span class=\"bp\">→</span> <span class=\"n\">Path</span>\n  <span class=\"bp\">|</span> <span class=\"n\">g</span> <span class=\"o\">:</span> <span class=\"n\">Path</span> <span class=\"bp\">→</span> <span class=\"n\">Path</span>\n  <span class=\"bp\">|</span> <span class=\"n\">u</span> <span class=\"o\">:</span> <span class=\"n\">Path</span> <span class=\"bp\">→</span> <span class=\"n\">Path</span> <span class=\"bp\">→</span> <span class=\"n\">Path</span>\n  <span class=\"bp\">|</span> <span class=\"n\">r</span> <span class=\"o\">:</span> <span class=\"n\">Path</span> <span class=\"bp\">→</span> <span class=\"n\">Path</span> <span class=\"bp\">→</span> <span class=\"n\">Path</span>\n\n<span class=\"kd\">end</span>\n\n<span class=\"n\">declare_syntax_cat</span> <span class=\"n\">state</span>\n<span class=\"n\">declare_syntax_cat</span> <span class=\"n\">path</span>\n\n<span class=\"n\">syntax</span> <span class=\"s2\">\"⊥\"</span> <span class=\"o\">:</span> <span class=\"n\">state</span>\n<span class=\"n\">syntax</span> <span class=\"s2\">\"⊤\"</span> <span class=\"o\">:</span> <span class=\"n\">state</span>\n<span class=\"n\">syntax</span> <span class=\"n\">ident</span> <span class=\"o\">:</span> <span class=\"n\">state</span>\n<span class=\"n\">syntax</span> <span class=\"s2\">\"¬\"</span> <span class=\"n\">state</span> <span class=\"o\">:</span> <span class=\"n\">state</span>\n<span class=\"n\">syntax</span> <span class=\"n\">state</span> <span class=\"s2\">\" ∧ \"</span> <span class=\"n\">state</span> <span class=\"o\">:</span> <span class=\"n\">state</span>\n<span class=\"n\">syntax</span> <span class=\"n\">state</span> <span class=\"s2\">\" ∨ \"</span> <span class=\"n\">state</span> <span class=\"o\">:</span> <span class=\"n\">state</span>\n<span class=\"n\">syntax</span> <span class=\"n\">state</span> <span class=\"s2\">\" → \"</span> <span class=\"n\">state</span> <span class=\"o\">:</span> <span class=\"n\">state</span>\n<span class=\"n\">syntax</span> <span class=\"n\">state</span> <span class=\"s2\">\" ↔ \"</span> <span class=\"n\">state</span> <span class=\"o\">:</span> <span class=\"n\">state</span>\n<span class=\"n\">syntax</span> <span class=\"s2\">\"A \"</span> <span class=\"n\">path</span> <span class=\"o\">:</span> <span class=\"n\">state</span>\n<span class=\"n\">syntax</span> <span class=\"s2\">\"E \"</span> <span class=\"n\">path</span> <span class=\"o\">:</span> <span class=\"n\">state</span>\n\n<span class=\"n\">syntax</span> <span class=\"n\">state</span> <span class=\"o\">:</span> <span class=\"n\">path</span>\n<span class=\"n\">syntax</span> <span class=\"s2\">\"¬\"</span> <span class=\"n\">path</span> <span class=\"o\">:</span> <span class=\"n\">path</span>\n<span class=\"n\">syntax</span> <span class=\"n\">path</span> <span class=\"s2\">\" ∧ \"</span> <span class=\"n\">path</span> <span class=\"o\">:</span> <span class=\"n\">path</span>\n<span class=\"n\">syntax</span> <span class=\"n\">path</span> <span class=\"s2\">\" ∨ \"</span> <span class=\"n\">path</span> <span class=\"o\">:</span> <span class=\"n\">path</span>\n<span class=\"n\">syntax</span> <span class=\"n\">path</span> <span class=\"s2\">\" → \"</span> <span class=\"n\">path</span> <span class=\"o\">:</span> <span class=\"n\">path</span>\n<span class=\"n\">syntax</span> <span class=\"n\">path</span> <span class=\"s2\">\" ↔ \"</span> <span class=\"n\">path</span> <span class=\"o\">:</span> <span class=\"n\">path</span>\n<span class=\"n\">syntax</span> <span class=\"s2\">\"X \"</span> <span class=\"n\">path</span> <span class=\"o\">:</span> <span class=\"n\">path</span>\n<span class=\"n\">syntax</span> <span class=\"s2\">\"F \"</span> <span class=\"n\">path</span> <span class=\"o\">:</span> <span class=\"n\">path</span>\n<span class=\"n\">syntax</span> <span class=\"s2\">\"G \"</span> <span class=\"n\">path</span> <span class=\"o\">:</span> <span class=\"n\">path</span>\n<span class=\"n\">syntax</span> <span class=\"n\">path</span> <span class=\"s2\">\" U \"</span> <span class=\"n\">path</span> <span class=\"o\">:</span> <span class=\"n\">path</span>\n<span class=\"n\">syntax</span> <span class=\"n\">path</span> <span class=\"s2\">\" R \"</span> <span class=\"n\">path</span> <span class=\"o\">:</span> <span class=\"n\">path</span>\n\n<span class=\"n\">syntax</span> <span class=\"s2\">\"[state|\"</span> <span class=\"n\">state</span> <span class=\"s2\">\"]\"</span> <span class=\"o\">:</span> <span class=\"n\">term</span>\n<span class=\"n\">syntax</span> <span class=\"s2\">\"[path|\"</span> <span class=\"n\">path</span> <span class=\"s2\">\"]\"</span> <span class=\"o\">:</span> <span class=\"n\">term</span>\n\n<span class=\"n\">macro_rules</span>\n  <span class=\"bp\">|</span> <span class=\"bp\">`</span><span class=\"o\">([</span><span class=\"n\">state</span><span class=\"bp\">|</span> <span class=\"bp\">⊥</span><span class=\"o\">])</span> <span class=\"bp\">=&gt;</span> <span class=\"bp\">`</span><span class=\"o\">(</span><span class=\"n\">State.bot</span><span class=\"o\">)</span>\n  <span class=\"bp\">|</span> <span class=\"bp\">`</span><span class=\"o\">([</span><span class=\"n\">state</span><span class=\"bp\">|</span> <span class=\"bp\">⊤</span><span class=\"o\">])</span> <span class=\"bp\">=&gt;</span> <span class=\"bp\">`</span><span class=\"o\">(</span><span class=\"n\">State.top</span><span class=\"o\">)</span>\n  <span class=\"bp\">|</span> <span class=\"bp\">`</span><span class=\"o\">([</span><span class=\"n\">state</span><span class=\"bp\">|</span> <span class=\"bp\">$</span><span class=\"n\">x</span><span class=\"o\">:</span><span class=\"n\">ident</span><span class=\"o\">])</span> <span class=\"bp\">=&gt;</span> <span class=\"bp\">`</span><span class=\"o\">(</span><span class=\"n\">State.var</span> <span class=\"bp\">$</span><span class=\"n\">x</span><span class=\"o\">:</span><span class=\"n\">ident</span><span class=\"o\">)</span>\n  <span class=\"bp\">|</span> <span class=\"bp\">`</span><span class=\"o\">([</span><span class=\"n\">state</span><span class=\"bp\">|</span> <span class=\"bp\">¬</span> <span class=\"bp\">$</span><span class=\"n\">x</span><span class=\"o\">:</span><span class=\"n\">state</span><span class=\"o\">])</span> <span class=\"bp\">=&gt;</span> <span class=\"bp\">`</span><span class=\"o\">(</span><span class=\"n\">State.neg</span> <span class=\"o\">[</span><span class=\"n\">state</span><span class=\"bp\">|</span> <span class=\"bp\">$</span><span class=\"n\">x</span><span class=\"o\">:</span><span class=\"n\">state</span><span class=\"o\">])</span>\n  <span class=\"bp\">|</span> <span class=\"bp\">`</span><span class=\"o\">([</span><span class=\"n\">state</span><span class=\"bp\">|</span> <span class=\"bp\">$</span><span class=\"n\">l</span><span class=\"o\">:</span><span class=\"n\">state</span> <span class=\"bp\">∧</span> <span class=\"bp\">$</span><span class=\"n\">r</span><span class=\"o\">:</span><span class=\"n\">state</span><span class=\"o\">])</span> <span class=\"bp\">=&gt;</span> <span class=\"bp\">`</span><span class=\"o\">(</span><span class=\"n\">State.and</span> <span class=\"o\">[</span><span class=\"n\">state</span><span class=\"bp\">|</span> <span class=\"bp\">$</span><span class=\"n\">l</span><span class=\"o\">]</span> <span class=\"o\">[</span><span class=\"n\">state</span><span class=\"bp\">|</span> <span class=\"bp\">$</span><span class=\"n\">r</span><span class=\"o\">])</span>\n  <span class=\"bp\">|</span> <span class=\"bp\">`</span><span class=\"o\">([</span><span class=\"n\">state</span><span class=\"bp\">|</span> <span class=\"bp\">$</span><span class=\"n\">l</span><span class=\"o\">:</span><span class=\"n\">state</span> <span class=\"bp\">∨</span> <span class=\"bp\">$</span><span class=\"n\">r</span><span class=\"o\">:</span><span class=\"n\">state</span><span class=\"o\">])</span> <span class=\"bp\">=&gt;</span> <span class=\"bp\">`</span><span class=\"o\">(</span><span class=\"n\">State.or</span> <span class=\"o\">[</span><span class=\"n\">state</span><span class=\"bp\">|</span> <span class=\"bp\">$</span><span class=\"n\">l</span><span class=\"o\">]</span> <span class=\"o\">[</span><span class=\"n\">state</span><span class=\"bp\">|</span> <span class=\"bp\">$</span><span class=\"n\">r</span><span class=\"o\">])</span>\n  <span class=\"bp\">|</span> <span class=\"bp\">`</span><span class=\"o\">([</span><span class=\"n\">state</span><span class=\"bp\">|</span> <span class=\"bp\">$</span><span class=\"n\">l</span><span class=\"o\">:</span><span class=\"n\">state</span> <span class=\"bp\">→</span> <span class=\"bp\">$</span><span class=\"n\">r</span><span class=\"o\">:</span><span class=\"n\">state</span><span class=\"o\">])</span> <span class=\"bp\">=&gt;</span> <span class=\"bp\">`</span><span class=\"o\">(</span><span class=\"n\">State.imp</span> <span class=\"o\">[</span><span class=\"n\">state</span><span class=\"bp\">|</span> <span class=\"bp\">$</span><span class=\"n\">l</span><span class=\"o\">]</span> <span class=\"o\">[</span><span class=\"n\">state</span><span class=\"bp\">|</span> <span class=\"bp\">$</span><span class=\"n\">r</span><span class=\"o\">])</span>\n  <span class=\"bp\">|</span> <span class=\"bp\">`</span><span class=\"o\">([</span><span class=\"n\">state</span><span class=\"bp\">|</span> <span class=\"bp\">$</span><span class=\"n\">l</span><span class=\"o\">:</span><span class=\"n\">state</span> <span class=\"bp\">↔</span> <span class=\"bp\">$</span><span class=\"n\">r</span><span class=\"o\">:</span><span class=\"n\">state</span><span class=\"o\">])</span> <span class=\"bp\">=&gt;</span> <span class=\"bp\">`</span><span class=\"o\">(</span><span class=\"n\">State.iff</span> <span class=\"o\">[</span><span class=\"n\">state</span><span class=\"bp\">|</span> <span class=\"bp\">$</span><span class=\"n\">l</span><span class=\"o\">]</span> <span class=\"o\">[</span><span class=\"n\">state</span><span class=\"bp\">|</span> <span class=\"bp\">$</span><span class=\"n\">r</span><span class=\"o\">])</span>\n  <span class=\"bp\">|</span> <span class=\"bp\">`</span><span class=\"o\">([</span><span class=\"n\">state</span><span class=\"bp\">|</span> <span class=\"n\">A</span> <span class=\"bp\">$</span><span class=\"n\">x</span><span class=\"o\">:</span><span class=\"n\">path</span><span class=\"o\">])</span> <span class=\"bp\">=&gt;</span> <span class=\"bp\">`</span><span class=\"o\">(</span><span class=\"n\">State.aPath</span> <span class=\"o\">[</span><span class=\"n\">path</span><span class=\"bp\">|</span> <span class=\"bp\">$</span><span class=\"n\">x</span><span class=\"o\">:</span><span class=\"n\">path</span><span class=\"o\">])</span>\n  <span class=\"bp\">|</span> <span class=\"bp\">`</span><span class=\"o\">([</span><span class=\"n\">state</span><span class=\"bp\">|</span> <span class=\"n\">E</span> <span class=\"bp\">$</span><span class=\"n\">x</span><span class=\"o\">:</span><span class=\"n\">path</span><span class=\"o\">])</span> <span class=\"bp\">=&gt;</span> <span class=\"bp\">`</span><span class=\"o\">(</span><span class=\"n\">State.ePath</span> <span class=\"o\">[</span><span class=\"n\">path</span><span class=\"bp\">|</span> <span class=\"bp\">$</span><span class=\"n\">x</span><span class=\"o\">:</span><span class=\"n\">path</span><span class=\"o\">])</span>\n  <span class=\"bp\">|</span> <span class=\"bp\">`</span><span class=\"o\">([</span><span class=\"n\">path</span><span class=\"bp\">|</span> <span class=\"bp\">¬</span> <span class=\"bp\">$</span><span class=\"n\">x</span><span class=\"o\">:</span><span class=\"n\">path</span><span class=\"o\">])</span> <span class=\"bp\">=&gt;</span> <span class=\"bp\">`</span><span class=\"o\">(</span><span class=\"n\">State.neg</span> <span class=\"o\">[</span><span class=\"n\">state</span><span class=\"bp\">|</span> <span class=\"bp\">$</span><span class=\"n\">x</span><span class=\"o\">:</span><span class=\"n\">state</span><span class=\"o\">])</span>\n  <span class=\"bp\">|</span> <span class=\"bp\">`</span><span class=\"o\">([</span><span class=\"n\">path</span><span class=\"bp\">|</span> <span class=\"bp\">$</span><span class=\"n\">l</span><span class=\"o\">:</span><span class=\"n\">path</span> <span class=\"bp\">∧</span> <span class=\"bp\">$</span><span class=\"n\">r</span><span class=\"o\">:</span><span class=\"n\">path</span><span class=\"o\">])</span> <span class=\"bp\">=&gt;</span> <span class=\"bp\">`</span><span class=\"o\">(</span><span class=\"n\">Path.and</span> <span class=\"o\">[</span><span class=\"n\">path</span><span class=\"bp\">|</span> <span class=\"bp\">$</span><span class=\"n\">l</span><span class=\"o\">]</span> <span class=\"o\">[</span><span class=\"n\">path</span><span class=\"bp\">|</span> <span class=\"bp\">$</span><span class=\"n\">r</span><span class=\"o\">])</span>\n  <span class=\"bp\">|</span> <span class=\"bp\">`</span><span class=\"o\">([</span><span class=\"n\">path</span><span class=\"bp\">|</span> <span class=\"bp\">$</span><span class=\"n\">l</span><span class=\"o\">:</span><span class=\"n\">path</span> <span class=\"bp\">∨</span> <span class=\"bp\">$</span><span class=\"n\">r</span><span class=\"o\">:</span><span class=\"n\">path</span><span class=\"o\">])</span> <span class=\"bp\">=&gt;</span> <span class=\"bp\">`</span><span class=\"o\">(</span><span class=\"n\">Path.or</span> <span class=\"o\">[</span><span class=\"n\">path</span><span class=\"bp\">|</span> <span class=\"bp\">$</span><span class=\"n\">l</span><span class=\"o\">]</span> <span class=\"o\">[</span><span class=\"n\">path</span><span class=\"bp\">|</span> <span class=\"bp\">$</span><span class=\"n\">r</span><span class=\"o\">])</span>\n  <span class=\"bp\">|</span> <span class=\"bp\">`</span><span class=\"o\">([</span><span class=\"n\">path</span><span class=\"bp\">|</span> <span class=\"bp\">$</span><span class=\"n\">l</span><span class=\"o\">:</span><span class=\"n\">path</span> <span class=\"bp\">→</span> <span class=\"bp\">$</span><span class=\"n\">r</span><span class=\"o\">:</span><span class=\"n\">path</span><span class=\"o\">])</span> <span class=\"bp\">=&gt;</span> <span class=\"bp\">`</span><span class=\"o\">(</span><span class=\"n\">Path.imp</span> <span class=\"o\">[</span><span class=\"n\">path</span><span class=\"bp\">|</span> <span class=\"bp\">$</span><span class=\"n\">l</span><span class=\"o\">]</span> <span class=\"o\">[</span><span class=\"n\">path</span><span class=\"bp\">|</span> <span class=\"bp\">$</span><span class=\"n\">r</span><span class=\"o\">])</span>\n  <span class=\"bp\">|</span> <span class=\"bp\">`</span><span class=\"o\">([</span><span class=\"n\">path</span><span class=\"bp\">|</span> <span class=\"bp\">$</span><span class=\"n\">l</span><span class=\"o\">:</span><span class=\"n\">path</span> <span class=\"bp\">↔</span> <span class=\"bp\">$</span><span class=\"n\">r</span><span class=\"o\">:</span><span class=\"n\">path</span><span class=\"o\">])</span> <span class=\"bp\">=&gt;</span> <span class=\"bp\">`</span><span class=\"o\">(</span><span class=\"n\">Path.iff</span> <span class=\"o\">[</span><span class=\"n\">path</span><span class=\"bp\">|</span> <span class=\"bp\">$</span><span class=\"n\">l</span><span class=\"o\">]</span> <span class=\"o\">[</span><span class=\"n\">path</span><span class=\"bp\">|</span> <span class=\"bp\">$</span><span class=\"n\">r</span><span class=\"o\">])</span>\n  <span class=\"bp\">|</span> <span class=\"bp\">`</span><span class=\"o\">([</span><span class=\"n\">path</span><span class=\"bp\">|</span> <span class=\"n\">X</span> <span class=\"bp\">$</span><span class=\"n\">x</span><span class=\"o\">:</span><span class=\"n\">path</span><span class=\"o\">])</span> <span class=\"bp\">=&gt;</span> <span class=\"bp\">`</span><span class=\"o\">(</span><span class=\"n\">Path.x</span> <span class=\"o\">[</span><span class=\"n\">path</span><span class=\"bp\">|</span> <span class=\"bp\">$</span><span class=\"n\">x</span><span class=\"o\">:</span><span class=\"n\">path</span><span class=\"o\">])</span>\n  <span class=\"bp\">|</span> <span class=\"bp\">`</span><span class=\"o\">([</span><span class=\"n\">path</span><span class=\"bp\">|</span> <span class=\"n\">F</span> <span class=\"bp\">$</span><span class=\"n\">x</span><span class=\"o\">:</span><span class=\"n\">path</span><span class=\"o\">])</span> <span class=\"bp\">=&gt;</span> <span class=\"bp\">`</span><span class=\"o\">(</span><span class=\"n\">Path.f</span> <span class=\"o\">[</span><span class=\"n\">path</span><span class=\"bp\">|</span> <span class=\"bp\">$</span><span class=\"n\">x</span><span class=\"o\">:</span><span class=\"n\">path</span><span class=\"o\">])</span>\n  <span class=\"bp\">|</span> <span class=\"bp\">`</span><span class=\"o\">([</span><span class=\"n\">path</span><span class=\"bp\">|</span> <span class=\"bp\">$</span><span class=\"n\">l</span><span class=\"o\">:</span><span class=\"n\">path</span> <span class=\"n\">U</span> <span class=\"bp\">$</span><span class=\"n\">r</span><span class=\"o\">:</span><span class=\"n\">path</span><span class=\"o\">])</span> <span class=\"bp\">=&gt;</span> <span class=\"bp\">`</span><span class=\"o\">(</span><span class=\"n\">Path.u</span> <span class=\"o\">[</span><span class=\"n\">path</span><span class=\"bp\">|</span> <span class=\"bp\">$</span><span class=\"n\">l</span><span class=\"o\">:</span><span class=\"n\">path</span><span class=\"o\">]</span> <span class=\"o\">[</span><span class=\"n\">path</span><span class=\"bp\">|</span> <span class=\"bp\">$</span><span class=\"n\">r</span><span class=\"o\">:</span><span class=\"n\">path</span><span class=\"o\">])</span>\n  <span class=\"bp\">|</span> <span class=\"bp\">`</span><span class=\"o\">([</span><span class=\"n\">path</span><span class=\"bp\">|</span> <span class=\"bp\">$</span><span class=\"n\">l</span><span class=\"o\">:</span><span class=\"n\">path</span> <span class=\"n\">R</span> <span class=\"bp\">$</span><span class=\"n\">r</span><span class=\"o\">:</span><span class=\"n\">path</span><span class=\"o\">])</span> <span class=\"bp\">=&gt;</span> <span class=\"bp\">`</span><span class=\"o\">(</span><span class=\"n\">Path.r</span> <span class=\"o\">[</span><span class=\"n\">path</span><span class=\"bp\">|</span> <span class=\"bp\">$</span><span class=\"n\">l</span><span class=\"o\">:</span><span class=\"n\">path</span><span class=\"o\">]</span> <span class=\"o\">[</span><span class=\"n\">path</span><span class=\"bp\">|</span> <span class=\"bp\">$</span><span class=\"n\">r</span><span class=\"o\">:</span><span class=\"n\">path</span><span class=\"o\">])</span>\n</code></pre></div>\n<p>I also can't quite see how the mechanism you demonstrated above would occur here.</p>",
        "id": 285000079,
        "sender_full_name": "Henrik Böving",
        "timestamp": 1654376913
    },
    {
        "content": "<p>Interesting, I was using the definition from somewhere else that did have that extra one, thanks for pointing that out! I'd still be curious wether it's possible (even if it won't matter for my concrete example)</p>",
        "id": 285000084,
        "sender_full_name": "Andrés Goens",
        "timestamp": 1654376928
    },
    {
        "content": "<p>(edited: I realized I just read it wrong)</p>",
        "id": 285000115,
        "sender_full_name": "Andrés Goens",
        "timestamp": 1654376996
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"315434\">Andrés Goens</span> <a href=\"#narrow/stream/270676-lean4/topic/mutually.20recursive.20syntax/near/284998530\">said</a>:</p>\n<blockquote>\n<p>Because it gets caught up in the recursion that <code>foo : bar</code> and <code>bar : foo</code>.</p>\n</blockquote>\n<p>Yes, the parser looping indefinitely seems like the expected behavior here. How were you envisioning this working? <span aria-label=\"thinking\" class=\"emoji emoji-1f914\" role=\"img\" title=\"thinking\">:thinking:</span></p>",
        "id": 285007224,
        "sender_full_name": "Mac",
        "timestamp": 1654388794
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"315577\">Mac</span> <a href=\"#narrow/stream/270676-lean4/topic/mutually.20recursive.20syntax/near/285007224\">said</a>:</p>\n<blockquote>\n<p>Yes, the parser looping indefinitely seems like the expected behavior here. How were you envisioning this working? <span aria-label=\"thinking\" class=\"emoji emoji-1f914\" role=\"img\" title=\"thinking\">:thinking:</span></p>\n</blockquote>\n<p>I didn't expect it to work 'out of the box', but I imagined I could have extended the parser to explicitly handle that case <span aria-label=\"thinking\" class=\"emoji emoji-1f914\" role=\"img\" title=\"thinking\">:thinking:</span></p>",
        "id": 285027207,
        "sender_full_name": "Andrés Goens",
        "timestamp": 1654421235
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"315434\">Andrés Goens</span> <a href=\"#narrow/stream/270676-lean4/topic/mutually.20recursive.20syntax/near/285027207\">said</a>:</p>\n<blockquote>\n<p>I imagined I could have extended the parser to explicitly handle that case</p>\n</blockquote>\n<p>Sorry, that was kind of my question. How were you hoping to resolve the loop? That is, what extension did you want to write to solve it? I am having a hard time imagining what such a solution would look like.</p>",
        "id": 285047130,
        "sender_full_name": "Mac",
        "timestamp": 1654450565
    }
]