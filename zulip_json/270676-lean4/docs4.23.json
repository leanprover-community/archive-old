[
    {
        "content": "<p>I just ported the doc-gen search over to doc-gen4 (<a href=\"https://leanprover-community.github.io/mathlib4_docs/\">https://leanprover-community.github.io/mathlib4_docs/</a>), including the <code>/find/decl</code> endpoints so in theory someone with the correct permissions should be able to set up something similar to this docs# stuff the Lean 3 people are using (I propose docs4#)</p>",
        "id": 271750091,
        "sender_full_name": "Henrik Böving",
        "timestamp": 1644764596
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"395550\">Henrik Böving</span> has marked this topic as unresolved.</p>",
        "id": 272011509,
        "sender_full_name": "Notification Bot",
        "timestamp": 1644947221
    },
    {
        "content": "<p>I think that should be fine for a first PoC yes, but we should definitely try to swap it out for a pure Lean 4 parser at some point.</p>",
        "id": 272011572,
        "sender_full_name": "Henrik Böving",
        "timestamp": 1644947253
    },
    {
        "content": "<p>References that might help:</p>\n<ul>\n<li><a href=\"https://github.com/Neilshweky/Haskell-Markdown-Parser\">https://github.com/Neilshweky/Haskell-Markdown-Parser</a></li>\n<li><a href=\"https://github.com/Riphal/haskell-markdown-parser\">https://github.com/Riphal/haskell-markdown-parser</a></li>\n<li><a href=\"https://github.com/hashanp/haskell-markdown\">https://github.com/hashanp/haskell-markdown</a></li>\n</ul>",
        "id": 272012211,
        "sender_full_name": "Arthur Paulino",
        "timestamp": 1644947539
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"395550\">Henrik Böving</span> <a href=\"#narrow/stream/270676-lean4/topic/docs4.23/near/272011572\">said</a>:</p>\n<blockquote>\n<p>I think that should be fine for a first PoC yes, but we should definitely try to swap it out for a pure Lean 4 parser at some point.</p>\n</blockquote>\n<p>I agree with it, but as I have started a new semester, it will take more time than I have expected.</p>\n<p><span class=\"user-mention\" data-user-id=\"451983\">@Arthur Paulino</span> Thanks, I will read about that.</p>",
        "id": 272019022,
        "sender_full_name": "Xubai Wang",
        "timestamp": 1644950447
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"414345\">@Xubai Wang</span> if/when you start the pure Lean 4 parser, feel free to ping me and I will help</p>",
        "id": 272019479,
        "sender_full_name": "Arthur Paulino",
        "timestamp": 1644950652
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110038\">Kevin Buzzard</span> <a href=\"#narrow/stream/270676-lean4/topic/docs4.23/near/271771892\">said</a>:</p>\n<blockquote>\n<p>That definition doesn't have a docstring!</p>\n</blockquote>\n<p>Both doc string and mod doc rendering has been done <a href=\"https://github.com/leanprover/doc-gen4/pull/33/files\">here</a>, based on <a href=\"https://github.com/xubaiw/CMark.lean\">cmark</a> and <a href=\"#narrow/stream/270676-lean4/topic/Add.20position.20info.20to.20module.20doc\">positioned mod doc</a>. Once lean supports the latter feature, we can immediately merge these commits.</p>",
        "id": 272019938,
        "sender_full_name": "Xubai Wang",
        "timestamp": 1644950880
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"451983\">@Arthur Paulino</span> Sure!</p>",
        "id": 272019989,
        "sender_full_name": "Xubai Wang",
        "timestamp": 1644950890
    },
    {
        "content": "<p>I went ahead and defined a markdown DSL inspired by those Haskell references that I posted.<br>\nHowever, if I am to parse the string, I might do it in a \"try hard\" way.</p>\n<p>What's a smarter way of doing so? I've searched on Lean 4 repo and I couldn't find an API for regular expressions</p>",
        "id": 272246413,
        "sender_full_name": "Arthur Paulino",
        "timestamp": 1645097653
    },
    {
        "content": "<p>I would try using these parser combinators: <a href=\"https://github.com/leanprover/lean4/blob/6b1297fe85575c91cf613640bdd96cd1241d1a9e/src/Lean/Data/Parsec.lean\">https://github.com/leanprover/lean4/blob/6b1297fe85575c91cf613640bdd96cd1241d1a9e/src/Lean/Data/Parsec.lean</a> (example XML parser: <a href=\"https://github.com/leanprover/lean4/blob/95aec2cf93762530a9c69dfc98c165a8b54238e2/src/Lean/Data/Xml/Parser.lean\">https://github.com/leanprover/lean4/blob/95aec2cf93762530a9c69dfc98c165a8b54238e2/src/Lean/Data/Xml/Parser.lean</a>)</p>",
        "id": 272246649,
        "sender_full_name": "Gabriel Ebner",
        "timestamp": 1645097819
    },
    {
        "content": "<p>We don't have regular expressions (yet).</p>",
        "id": 272246664,
        "sender_full_name": "Gabriel Ebner",
        "timestamp": 1645097827
    },
    {
        "content": "<p>Thanks! Will check those out</p>",
        "id": 272247192,
        "sender_full_name": "Arthur Paulino",
        "timestamp": 1645098151
    },
    {
        "content": "<p>I would recommend looking at <a href=\"https://github.com/pzp1997/harkdown\">harkdown</a> and <a href=\"https://github.com/jgm/commonmark-hs\">commonmark-hs</a> (especially the latter one for its extensibility, we may need more features like equations and diagrams). They both implement CommonMark, using Parsec and following the two stage (block -&gt; inline) approach.</p>\n<p><span class=\"user-mention silent\" data-user-id=\"110043\">Gabriel Ebner</span> <a href=\"#narrow/stream/270676-lean4/topic/docs4.23/near/272246649\">said</a>:</p>\n<blockquote>\n<p>I would try using these parser combinators: <a href=\"https://github.com/leanprover/lean4/blob/6b1297fe85575c91cf613640bdd96cd1241d1a9e/src/Lean/Data/Parsec.lean\">https://github.com/leanprover/lean4/blob/6b1297fe85575c91cf613640bdd96cd1241d1a9e/src/Lean/Data/Parsec.lean</a> (example XML parser: <a href=\"https://github.com/leanprover/lean4/blob/95aec2cf93762530a9c69dfc98c165a8b54238e2/src/Lean/Data/Xml/Parser.lean\">https://github.com/leanprover/lean4/blob/95aec2cf93762530a9c69dfc98c165a8b54238e2/src/Lean/Data/Xml/Parser.lean</a>)</p>\n</blockquote>\n<p>The Lean Parsec itself cannot fit in this job, as the <a href=\"https://spec.commonmark.org/0.30/#link-reference-definitions\">link reference definitions</a> element in CommonMark requires recording user state. One approach I can think of (and tried) is to extend <code>Parsec</code> with <code>StateT</code>:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kd\">def</span> <span class=\"n\">LinkRefMap</span> <span class=\"o\">:=</span> <span class=\"n\">HashMap</span> <span class=\"n\">String</span> <span class=\"o\">(</span><span class=\"n\">String</span> <span class=\"bp\">×</span> <span class=\"n\">Option</span> <span class=\"n\">String</span><span class=\"o\">)</span>\n\n<span class=\"kd\">def</span> <span class=\"n\">StateParsec</span> <span class=\"n\">σ</span> <span class=\"o\">:=</span> <span class=\"n\">StateT</span> <span class=\"n\">σ</span> <span class=\"n\">Parsec</span>\n\n<span class=\"kd\">instance</span> <span class=\"o\">:</span> <span class=\"n\">MonadLift</span> <span class=\"n\">Parsec</span> <span class=\"o\">(</span><span class=\"n\">StateParsec</span> <span class=\"n\">σ</span><span class=\"o\">)</span> <span class=\"n\">where</span>   <span class=\"c1\">-- to reuse current Parsec code</span>\n  <span class=\"n\">monadLift</span> <span class=\"n\">p</span> <span class=\"o\">:=</span> <span class=\"k\">match</span> <span class=\"n\">p</span> <span class=\"n\">s</span> <span class=\"k\">with</span>\n  <span class=\"bp\">|</span> <span class=\"n\">Parsec.ParseResult.success</span> <span class=\"n\">it</span> <span class=\"n\">res</span> <span class=\"bp\">=&gt;</span> <span class=\"n\">Parsec.ParseResult.success</span> <span class=\"n\">it</span> <span class=\"o\">(</span><span class=\"n\">res</span><span class=\"o\">,</span> <span class=\"n\">st</span><span class=\"o\">)</span>\n  <span class=\"bp\">|</span> <span class=\"n\">Parsec.ParseResult.error</span> <span class=\"n\">it</span> <span class=\"n\">err</span> <span class=\"bp\">=&gt;</span> <span class=\"n\">Parsec.ParseResult.error</span> <span class=\"n\">it</span> <span class=\"n\">err</span>\n\n<span class=\"kd\">def</span> <span class=\"n\">Parser</span> <span class=\"o\">:=</span> <span class=\"n\">StateParsec</span> <span class=\"n\">LinkRefMap</span>\n\n<span class=\"kd\">def</span> <span class=\"n\">partial</span> <span class=\"o\">:</span> <span class=\"n\">Parser</span> <span class=\"n\">Partial</span> <span class=\"o\">:=</span> <span class=\"gr\">sorry</span>  <span class=\"c1\">-- block only</span>\n\n<span class=\"kd\">def</span> <span class=\"n\">markdown</span> <span class=\"o\">:</span> <span class=\"n\">Parser</span> <span class=\"n\">Markdown</span> <span class=\"o\">:=</span> <span class=\"gr\">sorry</span>  <span class=\"c1\">-- full with both block and inline elements</span>\n</code></pre></div>",
        "id": 272251114,
        "sender_full_name": "Xubai Wang",
        "timestamp": 1645100576
    },
    {
        "content": "<p>You also don't have to limit yourself to haskell libraries (all the examples given thus far seem to have this in common so I guess it's not a coincidence). Better to use a good / well tested library than an FP library as basis</p>",
        "id": 272251538,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1645100804
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"414345\">@Xubai Wang</span> It should be enough to <code>abbrev Parser := StateT LinkRefMap Parsec</code>.  If you make it an abbrev, then you get the MonadLift/etc. instances automatically.</p>",
        "id": 272251886,
        "sender_full_name": "Gabriel Ebner",
        "timestamp": 1645101003
    },
    {
        "content": "<p>Just for the record, this is the DSL I wrote yesterday:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kd\">inductive</span> <span class=\"n\">Inline</span>\n  <span class=\"bp\">|</span> <span class=\"n\">text</span>   <span class=\"o\">:</span> <span class=\"n\">String</span> <span class=\"bp\">→</span> <span class=\"n\">Inline</span>\n  <span class=\"bp\">|</span> <span class=\"n\">bold</span>   <span class=\"o\">:</span> <span class=\"n\">String</span> <span class=\"bp\">→</span> <span class=\"n\">Inline</span>\n  <span class=\"bp\">|</span> <span class=\"n\">italic</span> <span class=\"o\">:</span> <span class=\"n\">String</span> <span class=\"bp\">→</span> <span class=\"n\">Inline</span>\n  <span class=\"bp\">|</span> <span class=\"n\">link</span>   <span class=\"o\">:</span> <span class=\"n\">String</span> <span class=\"bp\">→</span> <span class=\"n\">String</span> <span class=\"bp\">→</span> <span class=\"n\">Inline</span>\n  <span class=\"bp\">|</span> <span class=\"n\">image</span>  <span class=\"o\">:</span> <span class=\"n\">String</span> <span class=\"bp\">→</span> <span class=\"n\">String</span> <span class=\"bp\">→</span> <span class=\"n\">Inline</span>\n  <span class=\"bp\">|</span> <span class=\"n\">code</span>   <span class=\"o\">:</span> <span class=\"n\">String</span> <span class=\"bp\">→</span> <span class=\"n\">Inline</span>\n\n<span class=\"kd\">inductive</span> <span class=\"n\">HeaderLevel</span>\n  <span class=\"bp\">|</span> <span class=\"n\">h1</span> <span class=\"bp\">|</span> <span class=\"n\">h2</span> <span class=\"bp\">|</span> <span class=\"n\">h3</span> <span class=\"bp\">|</span> <span class=\"n\">h4</span> <span class=\"bp\">|</span> <span class=\"n\">h5</span> <span class=\"bp\">|</span> <span class=\"n\">h6</span>\n\n<span class=\"n\">abbrev</span> <span class=\"n\">Content</span> <span class=\"o\">:=</span> <span class=\"n\">List</span> <span class=\"n\">Inline</span>\n\n<span class=\"kd\">inductive</span> <span class=\"n\">Block</span>\n  <span class=\"bp\">|</span> <span class=\"n\">header</span>    <span class=\"o\">:</span> <span class=\"n\">HeaderLevel</span> <span class=\"bp\">→</span> <span class=\"n\">Content</span> <span class=\"bp\">→</span> <span class=\"n\">Block</span>\n  <span class=\"bp\">|</span> <span class=\"n\">paragraph</span> <span class=\"o\">:</span> <span class=\"n\">Content</span>     <span class=\"bp\">→</span> <span class=\"n\">Block</span>\n  <span class=\"bp\">|</span> <span class=\"n\">quote</span>     <span class=\"o\">:</span> <span class=\"n\">Content</span>     <span class=\"bp\">→</span> <span class=\"n\">Block</span>\n  <span class=\"bp\">|</span> <span class=\"n\">itemize</span>   <span class=\"o\">:</span> <span class=\"n\">List</span> <span class=\"n\">Block</span>  <span class=\"bp\">→</span> <span class=\"n\">Block</span>\n  <span class=\"bp\">|</span> <span class=\"n\">enumerate</span> <span class=\"o\">:</span> <span class=\"n\">List</span> <span class=\"n\">Block</span>  <span class=\"bp\">→</span> <span class=\"n\">Block</span>\n  <span class=\"bp\">|</span> <span class=\"n\">codeBlock</span> <span class=\"o\">:</span> <span class=\"n\">String</span>      <span class=\"bp\">→</span> <span class=\"n\">String</span>  <span class=\"bp\">→</span> <span class=\"n\">Block</span>\n  <span class=\"bp\">|</span> <span class=\"n\">divider</span>   <span class=\"o\">:</span> <span class=\"n\">Block</span>\n</code></pre></div>",
        "id": 272251989,
        "sender_full_name": "Arthur Paulino",
        "timestamp": 1645101081
    },
    {
        "content": "<p>Yes, <a href=\"https://github.com/markdown-it/markdown-it\">markdown-it</a> is also an good option to look at, and it provides the highest flexibility among all the packages I have looked at. commonmark-hs is limited due to its <code>SyntaxSpec</code> definitions, while markdown-it uses a chain of rules. But in order to imitate it we need more flexible data structure, and I don't know how to get this done in a strongly typed functional language.</p>",
        "id": 272252152,
        "sender_full_name": "Xubai Wang",
        "timestamp": 1645101198
    },
    {
        "content": "<p>Can latex be included in documentation for either v3 or v4?</p>",
        "id": 272265386,
        "sender_full_name": "Matthew Ballard",
        "timestamp": 1645107572
    },
    {
        "content": "<p>In doc-gen3 the mathjax is used (see this <a href=\"https://leanprover-community.github.io/mathlib_docs/analysis/mean_inequalities.html\">page</a>). And in doc-gen4 we will continue to use mathjax since mathml is not supported by Chrome.</p>",
        "id": 272266036,
        "sender_full_name": "Xubai Wang",
        "timestamp": 1645107870
    },
    {
        "content": "<p>Great! I assume it is rendered client side?</p>",
        "id": 272266291,
        "sender_full_name": "Matthew Ballard",
        "timestamp": 1645107967
    },
    {
        "content": "<p>Yeah, more info <a href=\"https://www.mathjax.org/\">here</a></p>",
        "id": 272266352,
        "sender_full_name": "Arthur Paulino",
        "timestamp": 1645107995
    },
    {
        "content": "<p>I use katex for course notes and render it on my machine before pushing (now using mdbook, before I did it client-side). What I would give for an extended markdown language that provides support for theorem environments and easy cross-linking...</p>",
        "id": 272266597,
        "sender_full_name": "Matthew Ballard",
        "timestamp": 1645108085
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"306577\">@Matthew Ballard</span> offtopic, but <a href=\"https://github.com/arthurpaulino/arthurpaulino.github.io/blob/fe0df02bad00910e551785e367a1e8f0d5531119/_includes/head.html#L17\">this is how</a> I set MathJax in my blog. If your repo has templates, you can just add that line inside the <code>&lt;head&gt;</code> of your pages and they will render LaTeX automagically.<br>\nOr you can follow <a href=\"https://www.mathjax.org/#gettingstarted\">these instructions</a></p>\n<p>Then <a href=\"https://github.com/arthurpaulino/arthurpaulino.github.io/blob/fe0df02bad00910e551785e367a1e8f0d5531119/_posts/2017-12-28-backpropagation.md?plain=1#L67\">this is how</a> you can type stuff that will be rendered in LaTeX. It's written in Brazilian portuguese, but you'll get what I mean</p>",
        "id": 272268576,
        "sender_full_name": "Arthur Paulino",
        "timestamp": 1645108931
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"306577\">@Matthew Ballard</span>  I wrote a plugin for Gitit that uses Pandoc's native divs to support these features. The Gitit server keeps a database (just a text file) of information used for cross-linking and it has support for automatic numbering within each page. The code is kind of garbage and you have to run your own server, but I used it for a few semesters with students and I keep it for my private use too. If you want, I'll give you access to the code.</p>",
        "id": 272285032,
        "sender_full_name": "Jireh Loreaux",
        "timestamp": 1645115464
    },
    {
        "content": "<p>Hey, guys. I would like to collect some feedback on intra-documentation links.</p>\n<p>I have rendered my Socket.lean package to GitHub Pages, and such a <a href=\"https://github.com/xubaiw/Socket.lean/blob/b1407dbffe84ac920db24a312f48ba9e4820ab76/Socket/Basic.lean#L24-L44\">definition</a></p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"sd\">/--</span>\n<span class=\"sd\">  Opaque reference to underlying platform specific socket.</span>\n<span class=\"sd\">  To create a `Socket`, refer to [`Socket.mk`](#Socket.Socket.mk). Then you</span>\n<span class=\"sd\">  can manipulate the `Socket` using common socket functions like</span>\n<span class=\"sd\">  [`Socket.bind`](#Socket.Socket.bind),[`Socket.connect`](#Socket.Socket.connect),</span>\n<span class=\"sd\">  etc. For all functions available, refer to the [`Socket` module](Socket/Socket.html).</span>\n<span class=\"sd\">  *NOTE*: `NonemptyType` is used to implement `Inhabited` for `Socket`. [detailed explanation](#explanation-usage-of-nonemptytype)</span>\n<span class=\"sd\">  ```lean</span>\n<span class=\"sd\">  import Socket</span>\n<span class=\"sd\">  open Socket</span>\n<span class=\"sd\">  def main : IO Unit := do</span>\n<span class=\"sd\">    let s ← Socket.mk</span>\n<span class=\"sd\">    -- some socket operations</span>\n<span class=\"sd\">    s.close</span>\n<span class=\"sd\">  ```</span>\n<span class=\"sd\">-/</span>\n<span class=\"kd\">def</span> <span class=\"n\">Socket</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span> <span class=\"o\">:=</span> <span class=\"n\">Socket.Nonempty.type</span>\n</code></pre></div>\n<p>renders to <a href=\"https://xubaiw.github.io/Socket.lean/Socket/Basic.html#Socket.Socket\">https://xubaiw.github.io/Socket.lean/Socket/Basic.html#Socket.Socket</a>, with the following screen capture</p>\n<p><a href=\"/user_uploads/3121/j0reajyOPS_tyKLxJ4XvU4OP/截屏2022-02-18-上午1.42.58.png\">Socket.Socket</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/j0reajyOPS_tyKLxJ4XvU4OP/截屏2022-02-18-上午1.42.58.png\" title=\"Socket.Socket\"><img src=\"/user_uploads/3121/j0reajyOPS_tyKLxJ4XvU4OP/截屏2022-02-18-上午1.42.58.png\"></a></div><p>So the plain code spans <code> ` Socket ` </code> and <code> ` Inhabited ` </code> automatically turns into links, <code>[`Socket.mk`](#Socket.Socket.mk)</code> automatically get linked to <code>Socket.mk</code> in another page (note that there is a <code>#</code> prefix),<br>\n<code>[</code>Socket<code> module](Socket/Socket.html)</code> is prefixed with baseUrl, and<code>[detailed explanation](#explanation-usage-of-nonemptytype)</code> get linked to that id in this page.</p>\n<p>I'm not very familiar with old doc-gen3 (and fail to find some intra documentation links in mathlib), and not sure whether this design is \"correct\", good enough or not, but it feels more consistent than the Rust <a href=\"https://stackoverflow.com/questions/31582064/how-to-link-to-other-fns-structs-enums-traits-in-rustdoc#answer-53504254\">way</a>. These are the pseudo processing steps:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"c1\">-- parse as name or id</span>\n<span class=\"k\">if</span> <span class=\"n\">link</span> <span class=\"n\">starts</span> <span class=\"k\">with</span> <span class=\"s2\">\"#\"</span>\n    <span class=\"k\">if</span> <span class=\"n\">name</span> <span class=\"n\">found</span> <span class=\"n\">globally</span> <span class=\"o\">(</span><span class=\"n\">precise</span><span class=\"o\">)</span> <span class=\"n\">or</span> <span class=\"k\">in</span> <span class=\"n\">current</span> <span class=\"n\">module</span>\n        <span class=\"bp\">|</span> <span class=\"n\">yes</span> <span class=\"bp\">=&gt;</span> <span class=\"n\">link</span> <span class=\"n\">it</span> <span class=\"n\">to</span> <span class=\"n\">the</span> <span class=\"n\">name</span>\n        <span class=\"bp\">|</span> <span class=\"n\">no</span> <span class=\"bp\">=&gt;</span> <span class=\"k\">do</span> <span class=\"n\">not</span> <span class=\"n\">modify</span> <span class=\"o\">(</span><span class=\"n\">id</span> <span class=\"n\">on</span> <span class=\"n\">the</span> <span class=\"n\">same</span> <span class=\"n\">page</span><span class=\"o\">)</span>\n<span class=\"c1\">-- parse as absolute or relative url</span>\n<span class=\"k\">else</span>\n    <span class=\"bp\">|</span> <span class=\"n\">absolute</span>  <span class=\"bp\">=&gt;</span> <span class=\"k\">do</span> <span class=\"n\">not</span> <span class=\"n\">modify</span>\n    <span class=\"bp\">|</span> <span class=\"n\">relative</span> <span class=\"bp\">=&gt;</span> <span class=\"n\">add</span> <span class=\"n\">module</span> <span class=\"n\">base</span>\n</code></pre></div>",
        "id": 272296165,
        "sender_full_name": "Xubai Wang",
        "timestamp": 1645119837
    },
    {
        "content": "<p>I also wonder if there are some other missing doc string features that someone can remind me of (except for code highlighting and equations, I will work on them tomorrow).</p>",
        "id": 272296669,
        "sender_full_name": "Xubai Wang",
        "timestamp": 1645120034
    },
    {
        "content": "<p>I don't think we have a special way to link to definitions in doc-gen 3 (except for writing the full definition name).  The proposed syntax looks reasonable enough, although it would be nice if it didn't fail silently if the declaration can't be found.</p>",
        "id": 272299951,
        "sender_full_name": "Gabriel Ebner",
        "timestamp": 1645121326
    },
    {
        "content": "<p>BTW:</p>\n<blockquote>\n<p>NOTE: NonemptyType is used to implement Inhabited for Socket. detailed explanation</p>\n</blockquote>\n<p>This is Nonempty now, not Inhabited.</p>",
        "id": 272300038,
        "sender_full_name": "Gabriel Ebner",
        "timestamp": 1645121376
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110043\">Gabriel Ebner</span> <a href=\"#narrow/stream/270676-lean4/topic/docs4.23/near/272299951\">said</a>:</p>\n<blockquote>\n<p>I don't think we have a special way to link to definitions in doc-gen 3 (except for writing the full definition name).  The proposed syntax looks reasonable enough, although it would be nice if it didn't fail silently if the declaration can't be found.</p>\n</blockquote>\n<p>But we also need to link to headings (#id), in this example the <code>#explanation-usage-of-nonemptytype</code>.</p>\n<p>Since id and name share the same syntax, so if explicit failure is required we may pick another syntax for name first.</p>",
        "id": 272300608,
        "sender_full_name": "Xubai Wang",
        "timestamp": 1645121608
    },
    {
        "content": "<p>That's what I was hinting at.</p>",
        "id": 272301297,
        "sender_full_name": "Gabriel Ebner",
        "timestamp": 1645121935
    },
    {
        "content": "<p>I cannot come up with a good alternative, maybe <code>@</code>, <code>%</code>, <code>~</code> or <code>-&gt;</code>?</p>",
        "id": 272301849,
        "sender_full_name": "Xubai Wang",
        "timestamp": 1645122173
    },
    {
        "content": "<p><code>@decl</code> has the advantage that it is valid Lean syntax.  My other suggestion would have been <code>##decl</code>.</p>",
        "id": 272304947,
        "sender_full_name": "Gabriel Ebner",
        "timestamp": 1645123538
    },
    {
        "content": "<p><code>##decl</code> looks great!</p>",
        "id": 272306003,
        "sender_full_name": "Xubai Wang",
        "timestamp": 1645124031
    },
    {
        "content": "<p>My <a href=\"https://github.com/xubaiw/Unicode.lean\">Unicode.lean</a> package may do some help to CommonMark parsing, as the specification involves <a href=\"https://spec.commonmark.org/0.30/#unicode-punctuation-character\">some unicode stuff</a>.</p>",
        "id": 272521172,
        "sender_full_name": "Xubai Wang",
        "timestamp": 1645280472
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110038\">Kevin Buzzard</span> <a href=\"#narrow/stream/270676-lean4/topic/docs4.23/near/271771892\">said</a>:</p>\n<blockquote>\n<p>That definition doesn't have a docstring!</p>\n</blockquote>\n<p><a href=\"https://leanprover-community.github.io/mathlib4_docs/Mathlib/Data/List/Basic.html\">https://leanprover-community.github.io/mathlib4_docs/Mathlib/Data/List/Basic.html</a> doc strings are alive thanks to <span class=\"user-mention\" data-user-id=\"414345\">@Xubai Wang</span> <span aria-label=\"octopus\" class=\"emoji emoji-1f419\" role=\"img\" title=\"octopus\">:octopus:</span></p>",
        "id": 272584588,
        "sender_full_name": "Henrik Böving",
        "timestamp": 1645355088
    },
    {
        "content": "<p>Before we merge <a href=\"https://github.com/leanprover/doc-gen4/pull/38#issuecomment-1046287290\">https://github.com/leanprover/doc-gen4/pull/38#issuecomment-1046287290</a> is it possible to change the src# and docs# links to support this format? <span class=\"user-mention\" data-user-id=\"110024\">@Sebastian Ullrich</span> I don't know how powerful Zulip is in this regard so just to make sure we don't have to revert it right away.</p>",
        "id": 272606342,
        "sender_full_name": "Henrik Böving",
        "timestamp": 1645379388
    },
    {
        "content": "<p>What's changed, just the <code>#</code>? The current rules look like this:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"n\">docs4</span><span class=\"bp\">#</span><span class=\"o\">(</span><span class=\"bp\">?</span><span class=\"n\">P</span><span class=\"bp\">&lt;</span><span class=\"n\">decl</span><span class=\"bp\">&gt;</span><span class=\"o\">[</span><span class=\"bp\">\\</span><span class=\"n\">w_.'</span><span class=\"bp\">-</span><span class=\"o\">]</span><span class=\"bp\">*</span><span class=\"o\">[</span><span class=\"bp\">\\</span><span class=\"n\">w_'</span><span class=\"bp\">-</span><span class=\"o\">])</span>    <span class=\"n\">https</span><span class=\"o\">:</span><span class=\"bp\">//</span><span class=\"n\">leanprover</span><span class=\"bp\">-</span><span class=\"n\">community.github.io</span><span class=\"bp\">/</span><span class=\"n\">mathlib4_docs</span><span class=\"bp\">/</span><span class=\"n\">find</span><span class=\"bp\">/%</span><span class=\"o\">(</span><span class=\"n\">decl</span><span class=\"o\">)</span><span class=\"n\">s</span>\n</code></pre></div>",
        "id": 272606730,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1645379786
    },
    {
        "content": "<p>Yeah and for the src# you'd need to append the /src to it</p>",
        "id": 272606755,
        "sender_full_name": "Henrik Böving",
        "timestamp": 1645379829
    },
    {
        "content": "<p>That's how src# links already work, so if you are doing the same thing then it should just work</p>",
        "id": 272639639,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1645417311
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110049\">Mario Carneiro</span> <a href=\"#narrow/stream/270676-lean4/topic/docs4.23/near/272639639\">said</a>:</p>\n<blockquote>\n<p>That's how src# links already work, so if you are doing the same thing then it should just work</p>\n</blockquote>\n<p>There is a bit difference. We now need an extra <code>#</code> number hash before declaration name, like <code>&lt;base&gt;/find/#mul_le_mul</code> and <code>&lt;base&gt;/find/#mul_le_mul/src</code>. The original way is not Windows friendly, and <code>#</code> is inevitable as we are limited to static serving.</p>",
        "id": 272641804,
        "sender_full_name": "Xubai Wang",
        "timestamp": 1645419865
    },
    {
        "content": "<p>Doesn't <code>?</code> also have a special meaning in URL strings?</p>",
        "id": 272642656,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1645420893
    },
    {
        "content": "<p>although this is after the fragment specifier so maybe it's okay</p>",
        "id": 272642673,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1645420920
    },
    {
        "content": "<p>Does that mean that <code>&lt;base&gt;/find/</code> is now a huge page with every definition in it?</p>",
        "id": 272642752,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1645420986
    },
    {
        "content": "<p>No, it just works the same way of search. It fetches the \"every definition\" and then do the search.</p>",
        "id": 272645208,
        "sender_full_name": "Xubai Wang",
        "timestamp": 1645423541
    },
    {
        "content": "<p>It doesn't lead to obvious time delay when I test it on Mathlib4 locally. But if you are worried about the performance, we can then store the \"every definition\" in browser cache (indexedDB) and add a hash file to check if it needs to be updated.</p>",
        "id": 272645414,
        "sender_full_name": "Xubai Wang",
        "timestamp": 1645423735
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110049\">Mario Carneiro</span> <a href=\"#narrow/stream/270676-lean4/topic/docs4.23/near/272642656\">said</a>:</p>\n<blockquote>\n<p>Doesn't <code>?</code> also have a special meaning in URL strings?</p>\n</blockquote>\n<p>Oh yes, I forgot about that. And <code>?</code> is a definitely more extensible solution. We may use <code>/find/?query=&lt;decl&gt;&amp;type=src</code>, and may add more options to that later (e.g. <code>type=interactive</code> for LeanInk integration). <span class=\"user-mention\" data-user-id=\"395550\">@Henrik Böving</span>  How do you think about that?</p>",
        "id": 272646373,
        "sender_full_name": "Xubai Wang",
        "timestamp": 1645424680
    },
    {
        "content": "<p>I was going to suggest that myself, but <code>?</code> itself causes a problem with that</p>",
        "id": 272646736,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1645425066
    },
    {
        "content": "<p>You would need the linkifier to do percent encoding</p>",
        "id": 272646751,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1645425081
    },
    {
        "content": "<p>(I'm wondering whether any of this is making Leo and Sebastian reconsider <code>?</code> in identifiers...)</p>",
        "id": 272646820,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1645425124
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"110049\">Mario Carneiro</span> <a href=\"#narrow/stream/270676-lean4/topic/docs4.23/near/272646751\">said</a>:</p>\n<blockquote>\n<p>You would need the linkifier to do percent encoding</p>\n</blockquote>\n<p>I think it's not a problem for modern browsers?</p>\n<p><a href=\"/user_uploads/3121/jED69XkdHdYWNJllILESpL88/截屏2022-02-21-下午2.36.23.png\">screen capture</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/jED69XkdHdYWNJllILESpL88/截屏2022-02-21-下午2.36.23.png\" title=\"screen capture\"><img src=\"/user_uploads/3121/jED69XkdHdYWNJllILESpL88/截屏2022-02-21-下午2.36.23.png\"></a></div>",
        "id": 272647124,
        "sender_full_name": "Xubai Wang",
        "timestamp": 1645425442
    },
    {
        "content": "<p>well, depending on how precise the parser is, that string might be rejected as not a URL</p>",
        "id": 272648166,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1645426486
    },
    {
        "content": "<p>Read RFC 3986: <a href=\"https://datatracker.ietf.org/doc/html/rfc3986/#section-3.4\">https://datatracker.ietf.org/doc/html/rfc3986/#section-3.4</a>  The question mark is not an issue; the query string begins with the first question mark and only ends with a <code>#</code> character.  As long as we don't get Haskell-style <code>UInt8#</code> identifiers we should be fine.</p>",
        "id": 272659823,
        "sender_full_name": "Gabriel Ebner",
        "timestamp": 1645434502
    },
    {
        "content": "<p>We could also put the query in the fragment identifier, which has no such restriction.  That is, <code>/find/src/#&lt;decl&gt;</code>.</p>",
        "id": 272659900,
        "sender_full_name": "Gabriel Ebner",
        "timestamp": 1645434558
    },
    {
        "content": "<p>Comparing these two, personally I would stand behind the <code>?</code> query syntax:</p>\n<ol>\n<li><code>?</code> Query has a clearer semantic, we are requesting for a redirect service rather than some element on one page.</li>\n<li><code>#</code> Fragment is path based and can not be combined with each other, which is less extensible.</li>\n<li>For developing, <code>#</code> requires writing one more Lean module (and corresponding JS module) for that, while for <code>?</code> we only need to modify the endpoint JS file.</li>\n</ol>\n<p>I also suggest renaming the endpoint from <code>/find</code> to <code>/endpoint</code> in case we need to change the Zulip linkifier in future.</p>",
        "id": 272667219,
        "sender_full_name": "Xubai Wang",
        "timestamp": 1645438317
    },
    {
        "content": "<blockquote>\n<p>For developing, # requires writing one more Lean module (and corresponding JS module) for that, while for ? we only need to modify the endpoint JS file.</p>\n</blockquote>\n<p>I'm not sure I understand this point, you can access both <code>#</code> and <code>?</code> from javascript.  You could even do <code>/find/#src/&lt;decl&gt;</code> if you don't want to do two pages.</p>",
        "id": 272667395,
        "sender_full_name": "Gabriel Ebner",
        "timestamp": 1645438403
    },
    {
        "content": "<p>That's true.</p>",
        "id": 272668735,
        "sender_full_name": "Xubai Wang",
        "timestamp": 1645439076
    },
    {
        "content": "<p>not a fan of <code>/endpoint</code>, that's a bit too jargon for my taste</p>",
        "id": 272669264,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1645439344
    },
    {
        "content": "<p>Reading about the fragment <a href=\"https://datatracker.ietf.org/doc/html/rfc3986/#section-3.5\">part</a> of RFC 3986, fragment is used to represent a portion or a view of the primary resource. <br>\nSo semantically best syntax might be <code>/find?q=Nat.add#src</code> and <code>/find?q=Nat.add#doc</code> <span aria-label=\"upside down\" class=\"emoji emoji-1f643\" role=\"img\" title=\"upside down\">:upside_down:</span></p>",
        "id": 272673427,
        "sender_full_name": "Xubai Wang",
        "timestamp": 1645441454
    },
    {
        "content": "<p>That intention is long gone, <code>#</code> is used for many other things today.</p>",
        "id": 272673700,
        "sender_full_name": "Gabriel Ebner",
        "timestamp": 1645441604
    },
    {
        "content": "<p>heh, just look up at the url of this zulip page</p>",
        "id": 272673921,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1645441736
    },
    {
        "content": "<p>That also follows the portion meaning, and as zulip is not statically served, it won't conflict with the semantic for html.</p>\n<p>Well, I think we are now some bit off the topic. The actual syntax of <code>find</code> doesn't matter a lot, as users will not interact with it directly. Any windows-compatible way is good enough. :D</p>",
        "id": 272677236,
        "sender_full_name": "Xubai Wang",
        "timestamp": 1645443931
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"110024\">@Sebastian Ullrich</span> the search syntax was now changed as explained here <a href=\"https://github.com/leanprover/doc-gen4/pull/38#issuecomment-1048238235\">https://github.com/leanprover/doc-gen4/pull/38#issuecomment-1048238235</a>, src stuff should work as well now, furthermore generating documentation under Windows should now work flawlessly as well since we no longer create the problematic files @windows users feel free to try.</p>",
        "id": 272994544,
        "sender_full_name": "Henrik Böving",
        "timestamp": 1645642229
    },
    {
        "content": "<p>are the links live now?</p>",
        "id": 272994596,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1645642257
    },
    {
        "content": "<p>Ehh, sebastian or someone with the correct permissions would need to change the way Zulip links the docs4# and src4# stuff but the github pages end should work yes</p>",
        "id": 272994725,
        "sender_full_name": "Henrik Böving",
        "timestamp": 1645642322
    },
    {
        "content": "<p>that's me, I'm looking for the syntax to add</p>",
        "id": 272994824,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1645642356
    },
    {
        "content": "<p>I lost track of what syntax got implemented in the end</p>",
        "id": 272994925,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1645642407
    },
    {
        "content": "<p>That's the one linked in the issue comment above ^ (well both work now :p, pick your poison)</p>",
        "id": 272994969,
        "sender_full_name": "Henrik Böving",
        "timestamp": 1645642432
    },
    {
        "content": "<p><a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Nat.add#doc\">docs4#Nat.add</a> <a href=\"https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Nat.add#src\">src4#Nat.add</a></p>",
        "id": 272995170,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1645642547
    },
    {
        "content": "<p>So now where we got all the \"easy\" features implemented we can start looking into the fancy stuff <span aria-label=\"eyes\" class=\"emoji emoji-1f440\" role=\"img\" title=\"eyes\">:eyes:</span>, how is leanink doing? <span class=\"user-mention\" data-user-id=\"451040\">@Niklas Bülow</span></p>",
        "id": 272995431,
        "sender_full_name": "Henrik Böving",
        "timestamp": 1645642676
    },
    {
        "content": "<p>Sorry, for the slight delay in responding. I'm currently in the process of writing down my bachelor thesis, but I'll probably complete it in the next few weeks. Do you already have something in mind on how we can integrate both tools with each other? or a preferred interface point in doc-gen4 from where you would like to interact with LeanInk?</p>",
        "id": 273432611,
        "sender_full_name": "Niklas Bülow",
        "timestamp": 1646006137
    },
    {
        "content": "<p>Can we put it in a <code>&lt;details&gt;</code> fold like <code>Equations</code> and <code>Instances</code>? Or a separate page to be linked to like <code>source</code>?</p>",
        "id": 273448856,
        "sender_full_name": "Xubai Wang",
        "timestamp": 1646027805
    },
    {
        "content": "<p>Yes, a (separate) <code>source</code> link (or moving the current one to a GH icon or something) like in Haddock sounds good &amp; simple to me.<br>\n<a href=\"https://hackage.haskell.org/package/transformers-0.6.0.4/docs/Control-Monad-Trans-State-Lazy.html#t:StateT\">https://hackage.haskell.org/package/transformers-0.6.0.4/docs/Control-Monad-Trans-State-Lazy.html#t:StateT</a><br>\n<a href=\"https://hackage.haskell.org/package/transformers-0.6.0.4/docs/src/Control.Monad.Trans.State.Lazy.html#StateT\">https://hackage.haskell.org/package/transformers-0.6.0.4/docs/src/Control.Monad.Trans.State.Lazy.html#StateT</a></p>",
        "id": 273458836,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1646037556
    },
    {
        "content": "<p>How about naming it <code>interactive</code> or simply <code>ink</code>, rather than replacing  the <code>source</code>?  There seems to be lots of interactive widgets in Alectryon.</p>",
        "id": 273462219,
        "sender_full_name": "Xubai Wang",
        "timestamp": 1646039613
    },
    {
        "content": "<p>The interactive source would be superior to the GitHub link in every aspect, I don't really see why we would want to keep both. The interactive source could still include a link to GitHub just in case, but there is no need to clutter the docs4 page.</p>",
        "id": 273464630,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1646041036
    },
    {
        "content": "<p>The github page allows you to see the list of commits touching the file, the git-blame output, etc., which is not in the interactive source.  But I agree, the default link should go to the interactive source.</p>",
        "id": 273467646,
        "sender_full_name": "Gabriel Ebner",
        "timestamp": 1646042809
    }
]