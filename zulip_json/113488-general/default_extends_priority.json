[
    {
        "content": "<p>Various instances like <code>ring_hom.monoid : monoid (α →+* α)</code> have the wrong priority (100) because they are defined in files with <code>set_option default_priority 100</code> at the top and don't specifically override the priority back to 1000.<br>\nRather than go through and try to fix these all or add a linter to try to catch it, what if we add an option to Lean controlling the default priority used for instances generated by <code>extends</code>, since this seems to be the main usage of setting <code>default_priority</code>?</p>",
        "id": 206814398,
        "sender_full_name": "Reid Barton",
        "timestamp": 1597325382
    },
    {
        "content": "<p>These instances having the wrong priority is not such a big deal, but it partially defeats the purpose of lowering the instance priority of overlapping instances in the first place.<br>\nBut the bigger reason for the change would be to reduce the amount of priority-related noise and especially to avoid semi-global effects like <code>set_option default_priority</code>--the remaining cases where a lowered priority is needed can be handled on a per-<code>instance</code> basis using <code>@[priority 100] instance ...</code>.</p>",
        "id": 206814736,
        "sender_full_name": "Reid Barton",
        "timestamp": 1597325536
    },
    {
        "content": "<p>The purpose of adding the option wouldn't be to modify it, rather to just make the default value 100.</p>",
        "id": 206814839,
        "sender_full_name": "Reid Barton",
        "timestamp": 1597325608
    },
    {
        "content": "<p>As a dumb check right now one can look for all occurences of <code>default_priority</code> in mathlib which don't have <code>section</code> in the line directly above -- these are the worrisome ones</p>",
        "id": 206815632,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1597326042
    },
    {
        "content": "<p>minor quibble: it's not really <code>default_extends_priority</code> but rather <code>extends_priority</code> because there isn't a way to set the priority directly except after the fact AFAIK</p>",
        "id": 206819769,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1597328149
    },
    {
        "content": "<p>I see what you mean</p>",
        "id": 206819909,
        "sender_full_name": "Reid Barton",
        "timestamp": 1597328200
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/lean/issues/440\">lean#440</a></p>",
        "id": 206846173,
        "sender_full_name": "Reid Barton",
        "timestamp": 1597340516
    }
]