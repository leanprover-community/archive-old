[
    {
        "content": "<p>I added a lean-3.4.1 branch to mathlib, which I think should fix the issues with elan/leanpkg (assuming I spelled everything correctly). <span class=\"user-mention\" data-user-id=\"110024\">@Sebastian Ullrich</span> Will there be any problem with just keeping the branch up to date with master (although I don't think branch symlinks are a thing)? I don't see any reason not to.</p>",
        "id": 127073781,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1527242450
    },
    {
        "content": "<p>Mario -- many thanks!</p>",
        "id": 127073806,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1527242514
    },
    {
        "content": "<p>You did not keep the 3.3.0 branch up to date with mathlib master -- why do you want to keep the 3.4.1 branch up to date?</p>",
        "id": 127073849,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1527242534
    },
    {
        "content": "<p>Why not just have a release version for 3.4.1?</p>",
        "id": 127073866,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1527242543
    },
    {
        "content": "<p>because lean does not have nearly enough versions</p>",
        "id": 127074034,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1527242819
    },
    {
        "content": "<p>mathlib does not develop on lean's schedule</p>",
        "id": 127074040,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1527242837
    },
    {
        "content": "<p>and there is a huge range of commits that are compatible with 3.4.1</p>",
        "id": 127074044,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1527242861
    },
    {
        "content": "<p>I understand the argument.</p>",
        "id": 127074083,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1527242883
    },
    {
        "content": "<p>As I explained to you in email -- I would ideally like to be able to point people to a \"3.4.1 release\" version of mathlib which is \"the canonical version of mathlib to run with the 3.4.1 release version of Lean\"</p>",
        "id": 127074102,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1527242940
    },
    {
        "content": "<p>And your argument is</p>",
        "id": 127074106,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1527242944
    },
    {
        "content": "<p>that the canonical version is the latest version</p>",
        "id": 127074110,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1527242952
    },
    {
        "content": "<p>right?</p>",
        "id": 127074113,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1527242954
    },
    {
        "content": "<p>OTOH I am _forced_ to point certain people (the IT people here, the CoCalc people) to a canonical version of mathlib which goes with Lean 3.4.1 release, because both of these organisations refuse to work with moving targets</p>",
        "id": 127074187,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1527243020
    },
    {
        "content": "<p>so I am going to tell them both to point to the very first commit in the 3.4.1 branch.</p>",
        "id": 127074190,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1527243033
    },
    {
        "content": "<p>I cannot envisage any problems with this, and it sounds like the best compromise.</p>",
        "id": 127074194,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1527243051
    },
    {
        "content": "<p>You can point them to the latest version, and they can take that at any point</p>",
        "id": 127074201,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1527243063
    },
    {
        "content": "<p>The problem with that idea</p>",
        "id": 127074206,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1527243081
    },
    {
        "content": "<p>is that then it will be hard for people to work out exactly which version they are running</p>",
        "id": 127074207,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1527243099
    },
    {
        "content": "<p>and it is very much in my interest that code runs on CoCalc if and only if it runs on the machines here</p>",
        "id": 127074211,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1527243115
    },
    {
        "content": "<p>so I would very much like CoCalc and the machines here to be running exactly the same code</p>",
        "id": 127074251,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1527243126
    },
    {
        "content": "<p>We have a lean-3.3.0 branch as well, which is not a tag but a branch because it incorporates new bugfixes and such which are compatible with 3.3.0</p>",
        "id": 127074252,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1527243128
    },
    {
        "content": "<p>Oh -- so 3.3.0 moves?</p>",
        "id": 127074253,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1527243139
    },
    {
        "content": "<p>There nothing like \"the very first commit in the 3.4.1 branch\" in git</p>",
        "id": 127074254,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1527243143
    },
    {
        "content": "<p>Oh!</p>",
        "id": 127074255,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1527243150
    },
    {
        "content": "<p>not much, but yes</p>",
        "id": 127074256,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1527243157
    },
    {
        "content": "<p>You can tag a commit</p>",
        "id": 127074259,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1527243162
    },
    {
        "content": "<p>Aah</p>",
        "id": 127074261,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1527243168
    },
    {
        "content": "<p>Mario -- last question then</p>",
        "id": 127074262,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1527243177
    },
    {
        "content": "<p>can I persuade you to tag a commit?</p>",
        "id": 127074272,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1527243191
    },
    {
        "content": "<p>But a branch is only some moving marker attached to some moving commit</p>",
        "id": 127074273,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1527243192
    },
    {
        "content": "<p>What you want is Mario creating a release tag</p>",
        "id": 127074288,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1527243230
    },
    {
        "content": "<p>not a branch</p>",
        "id": 127074292,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1527243236
    },
    {
        "content": "<p>Thanks for clarifying Patrick.</p>",
        "id": 127074332,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1527243248
    },
    {
        "content": "<p>mathlib doesn't do releases like that</p>",
        "id": 127074333,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1527243252
    },
    {
        "content": "<p>Sorry that my poor understanding of git is just adding to the noise</p>",
        "id": 127074341,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1527243269
    },
    {
        "content": "<p>Kevin kindly asks to change this</p>",
        "id": 127074344,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1527243273
    },
    {
        "content": "<p>if you want a commit, then it will be an artificial stopping point anyway, so just pick a point and write down the hash</p>",
        "id": 127074347,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1527243279
    },
    {
        "content": "<p>I can do this</p>",
        "id": 127074348,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1527243286
    },
    {
        "content": "<p>but it will look confusing</p>",
        "id": 127074349,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1527243290
    },
    {
        "content": "<p>I am not asking for this for me</p>",
        "id": 127074356,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1527243302
    },
    {
        "content": "<p>I am asking for this for other people</p>",
        "id": 127074362,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1527243309
    },
    {
        "content": "<p>who want \"Lean + Mathlib version 3.4.1\"</p>",
        "id": 127074366,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1527243321
    },
    {
        "content": "<p>That's what the branch is for</p>",
        "id": 127074369,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1527243329
    },
    {
        "content": "<p>no</p>",
        "id": 127074370,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1527243332
    },
    {
        "content": "<p>They want a canonical uniquely defined thing</p>",
        "id": 127074372,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1527243341
    },
    {
        "content": "<p>not a moving target</p>",
        "id": 127074374,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1527243347
    },
    {
        "content": "<p>because both refuse to move</p>",
        "id": 127074379,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1527243351
    },
    {
        "content": "<p>I will give them a hash</p>",
        "id": 127074420,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1527243369
    },
    {
        "content": "<p>It is not ideal, but it is the best solution if there is to be no release tag</p>",
        "id": 127074434,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1527243392
    },
    {
        "content": "<p>Thanks both of you for clarifying what I should be doing :-)</p>",
        "id": 127074452,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1527243428
    },
    {
        "content": "<p>I think 78d28c5cb58f6a22fbb8fc940cc6f97bc0111602 is the last \"update to lean\" commit</p>",
        "id": 127074458,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1527243449
    },
    {
        "content": "<p>but I don't know what leanpkg does with tags v branches, so I don't want to carelessly tag it</p>",
        "id": 127074505,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1527243511
    },
    {
        "content": "<p>because I want leanpkg to find the branch</p>",
        "id": 127074507,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1527243523
    },
    {
        "content": "<p>If creating a tag causes problems for other people then clearly this is an argument against creating a tag</p>",
        "id": 127074512,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1527243545
    },
    {
        "content": "<p>I don't understand the potential problem here</p>",
        "id": 127074517,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1527243567
    },
    {
        "content": "<p>with a tagged release</p>",
        "id": 127074519,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1527243574
    },
    {
        "content": "<p>Just don't tag it with <code>lean-3.4.1</code></p>",
        "id": 127074566,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1527243615
    },
    {
        "content": "<p>if you ask for elan to give you lean + mathlib 3.4.1, you should get the latest mathlib that is compatible with 3.4.1, which is master</p>",
        "id": 127074567,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1527243615
    },
    {
        "content": "<p>Right, Kevin, maybe you can trick them.</p>",
        "id": 127074575,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1527243654
    },
    {
        "content": "<p>You ask them to install elan, and use elan to install mathlib 3.4.1</p>",
        "id": 127074581,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1527243675
    },
    {
        "content": "<p>And they won't realise they just installed a moving target...</p>",
        "id": 127074583,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1527243687
    },
    {
        "content": "<p>that's what travis did for a long time, and it worked pretty well</p>",
        "id": 127074625,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1527243724
    },
    {
        "content": "<blockquote>\n<p>Just don't tag it with <code>lean-3.4.1</code></p>\n</blockquote>\n<p>Sure, the tag would need to be something like: spring2018</p>",
        "id": 127074628,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1527243737
    },
    {
        "content": "<p>Otoh, if users start complaining, you're in trouble anyway...</p>",
        "id": 127074631,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1527243757
    },
    {
        "content": "<p>Because they will say: hey, why is this stuff not in your mathlib...</p>",
        "id": 127074641,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1527243779
    },
    {
        "content": "<p>I don't mind having mathlib versions (which would be different from lean versions), but I would like leanpkg to work with them if possible</p>",
        "id": 127074648,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1527243787
    },
    {
        "content": "<p>Right, so <span class=\"user-mention\" data-user-id=\"110024\">@Sebastian Ullrich</span> can you make <code>elan</code> to listen to some tags as well?</p>",
        "id": 127074658,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1527243818
    },
    {
        "content": "<p>We probably need to wait for <span class=\"user-mention\" data-user-id=\"110024\">@Sebastian Ullrich</span> then</p>",
        "id": 127074660,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1527243821
    },
    {
        "content": "<p>oops</p>",
        "id": 127074661,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1527243828
    },
    {
        "content": "<p>We pinged him at the same time</p>",
        "id": 127074664,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1527243839
    },
    {
        "content": "<p>sorry about the harassment</p>",
        "id": 127074706,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1527243855
    },
    {
        "content": "<p>Urgent matters (-;</p>",
        "id": 127074707,
        "sender_full_name": "Johan Commelin",
        "timestamp": 1527243855
    },
    {
        "content": "<blockquote>\n<p>Will there be any problem with just keeping the branch up to date with master (although I don't think branch symlinks are a thing)? I don't see any reason not to.</p>\n</blockquote>\n<p>Yes, I think it's either that or saying \"Nobody should use nightlies right now anyway\", setting <code>lean-3.4.1</code> as the default branch, and not updating or outright removing <code>master</code></p>",
        "id": 127075441,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1527245358
    },
    {
        "content": "<p>I did set the mathlib dependency to lean-3.4.1 as well</p>",
        "id": 127075447,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1527245394
    },
    {
        "content": "<p>Uh, where?</p>",
        "id": 127075502,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1527245434
    },
    {
        "content": "<p>leanpkg.toml</p>",
        "id": 127075506,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1527245456
    },
    {
        "content": "<p>lean_version = \"3.4.1\"</p>",
        "id": 127075511,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1527245467
    },
    {
        "content": "<p>Ah, I see. Yeah, it's a bit weird to do that on the <code>master</code> branch since it means Lean nightly people using mathlib will get warnings, which is why I would slightly prefer the latter option I listed. But I guess it's okay either way.</p>",
        "id": 127075627,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1527245645
    },
    {
        "content": "<p>I mean, right now there's no difference, and it seems like lean repo is frozen for the foreseeable future so I guess it's fine to officially run 3.4.1</p>",
        "id": 127075662,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1527245748
    },
    {
        "content": "<p>Is there any Lean nightly though?</p>",
        "id": 127075666,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1527245755
    },
    {
        "content": "<p>if and when nightlies start back up again we can switch back</p>",
        "id": 127075706,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1527245766
    },
    {
        "content": "<p>Yes, both ways should work fine</p>",
        "id": 127075715,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1527245791
    },
    {
        "content": "<p>As Mario said, tag support would have to be added to <code>leanpkg</code>, unless we'd want <code>elan</code> to more or less reimplement and supersede the former. Which is possibly, and <a href=\"https://github.com/Kha/elan/issues/7\" target=\"_blank\" title=\"https://github.com/Kha/elan/issues/7\">https://github.com/Kha/elan/issues/7</a> already points in that direction, but... not something I want to do right now</p>",
        "id": 127075796,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1527245954
    }
]