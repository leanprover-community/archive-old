[
    {
        "content": "<p>Is there a reason why <code>leanproject get mathlib</code> defaults to https instead of ssh, for the git repo remote url? I was having issues pushing, which were resolved once I switched the origin url to use ssh. Maybe there should be a <code>--ssh</code> flag to pull in the repo with the ssh url.</p>",
        "id": 202224715,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1593329987
    },
    {
        "content": "<p>It doesn't.</p>",
        "id": 202224892,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1593330323
    },
    {
        "content": "<p>If leanproject used https it's because it failed when trying to use ssh, either because your python install is broken or your ssh setup is broken or there is a bug in leanproject.</p>",
        "id": 202224948,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1593330366
    },
    {
        "content": "<p>I tried using <code>--debug</code> to show the codepath, but didn't see anything regarding ssh:</p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"err\">➜</span>  <span class=\"n\">python3</span> <span class=\"c1\">--version</span>\n<span class=\"n\">Python</span> <span class=\"mi\">3</span><span class=\"bp\">.</span><span class=\"mi\">6</span><span class=\"bp\">.</span><span class=\"mi\">9</span>\n<span class=\"err\">➜</span>  <span class=\"n\">pip3</span> <span class=\"c1\">--version</span>\n<span class=\"n\">pip</span> <span class=\"mi\">9</span><span class=\"bp\">.</span><span class=\"mi\">0</span><span class=\"bp\">.</span><span class=\"mi\">1</span> <span class=\"k\">from</span> <span class=\"bp\">/</span><span class=\"n\">usr</span><span class=\"bp\">/</span><span class=\"n\">lib</span><span class=\"bp\">/</span><span class=\"n\">python3</span><span class=\"bp\">/</span><span class=\"n\">dist</span><span class=\"bp\">-</span><span class=\"n\">packages</span> <span class=\"o\">(</span><span class=\"n\">python</span> <span class=\"mi\">3</span><span class=\"bp\">.</span><span class=\"mi\">6</span><span class=\"o\">)</span>\n<span class=\"err\">➜</span>  <span class=\"n\">leanproject</span> <span class=\"c1\">--debug get mathlib</span>\n<span class=\"n\">Cloning</span> <span class=\"k\">from</span> <span class=\"n\">https</span><span class=\"o\">:</span><span class=\"bp\">//</span><span class=\"n\">github</span><span class=\"bp\">.</span><span class=\"n\">com</span><span class=\"bp\">/</span><span class=\"n\">leanprover</span><span class=\"bp\">-</span><span class=\"n\">community</span><span class=\"bp\">/</span><span class=\"n\">mathlib</span><span class=\"bp\">.</span><span class=\"n\">git</span>\n<span class=\"n\">configuring</span> <span class=\"n\">mathlib</span> <span class=\"mi\">0</span><span class=\"bp\">.</span><span class=\"mi\">1</span>\n<span class=\"n\">Looking</span> <span class=\"n\">for</span> <span class=\"n\">local</span> <span class=\"n\">mathlib</span> <span class=\"n\">oleans</span>\n<span class=\"n\">Found</span> <span class=\"n\">local</span> <span class=\"n\">mathlib</span> <span class=\"n\">oleans</span>\n<span class=\"err\">➜</span>  <span class=\"n\">cd</span> <span class=\"n\">mathlib</span>\n<span class=\"err\">➜</span>  <span class=\"n\">git</span> <span class=\"n\">log</span> <span class=\"bp\">|</span> <span class=\"n\">head</span>\n<span class=\"n\">commit</span> <span class=\"n\">a220286ac49a16bee74e85d9d2b308ce0d30d858</span>\n<span class=\"n\">Author</span><span class=\"o\">:</span> <span class=\"n\">Floris</span> <span class=\"n\">van</span> <span class=\"n\">Doorn</span> <span class=\"bp\">&lt;</span><span class=\"n\">fpvdoorn</span><span class=\"bp\">@</span><span class=\"n\">gmail</span><span class=\"bp\">.</span><span class=\"n\">com</span><span class=\"bp\">&gt;</span>\n<span class=\"n\">Date</span><span class=\"o\">:</span>   <span class=\"n\">Sun</span> <span class=\"n\">Jun</span> <span class=\"mi\">28</span> <span class=\"mi\">06</span><span class=\"o\">:</span><span class=\"mi\">01</span><span class=\"o\">:</span><span class=\"mi\">24</span> <span class=\"mi\">2020</span> <span class=\"bp\">+</span><span class=\"mi\">0000</span>\n\n    <span class=\"n\">feat</span><span class=\"o\">(</span><span class=\"n\">subtype</span><span class=\"o\">):</span> <span class=\"n\">standardize</span> <span class=\"o\">(</span><span class=\"bp\">#</span><span class=\"mi\">3204</span><span class=\"o\">)</span>\n\n    <span class=\"n\">Add</span> <span class=\"n\">simp</span> <span class=\"kn\">lemma</span> <span class=\"k\">from</span> <span class=\"n\">x</span><span class=\"bp\">.</span><span class=\"n\">val</span> <span class=\"n\">to</span> <span class=\"n\">coe</span> <span class=\"n\">x</span>\n    <span class=\"n\">Use</span> <span class=\"n\">correct</span> <span class=\"n\">ext</span><span class=\"bp\">/</span><span class=\"n\">ext_iff</span> <span class=\"n\">naming</span> <span class=\"n\">scheme</span>\n    <span class=\"n\">Use</span> <span class=\"n\">coe</span> <span class=\"k\">in</span> <span class=\"n\">more</span> <span class=\"n\">places</span> <span class=\"k\">in</span> <span class=\"n\">the</span> <span class=\"n\">library</span>\n</code></pre></div>",
        "id": 202225407,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1593331225
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span><code><span class=\"n\">git</span> <span class=\"n\">remote</span> <span class=\"k\">show</span> <span class=\"n\">origin</span> <span class=\"bp\">|</span> <span class=\"n\">grep</span> <span class=\"n\">mathlib</span>\n  <span class=\"n\">Fetch</span> <span class=\"n\">URL</span><span class=\"o\">:</span> <span class=\"n\">https</span><span class=\"o\">:</span><span class=\"bp\">//</span><span class=\"n\">github</span><span class=\"bp\">.</span><span class=\"n\">com</span><span class=\"bp\">/</span><span class=\"n\">leanprover</span><span class=\"bp\">-</span><span class=\"n\">community</span><span class=\"bp\">/</span><span class=\"n\">mathlib</span><span class=\"bp\">.</span><span class=\"n\">git</span>\n  <span class=\"n\">Push</span>  <span class=\"n\">URL</span><span class=\"o\">:</span> <span class=\"n\">https</span><span class=\"o\">:</span><span class=\"bp\">//</span><span class=\"n\">github</span><span class=\"bp\">.</span><span class=\"n\">com</span><span class=\"bp\">/</span><span class=\"n\">leanprover</span><span class=\"bp\">-</span><span class=\"n\">community</span><span class=\"bp\">/</span><span class=\"n\">mathlib</span><span class=\"bp\">.</span><span class=\"n\">git</span>\n    <span class=\"n\">mathlib</span><span class=\"bp\">-</span><span class=\"n\">cache</span>                    <span class=\"n\">tracked</span>\n</code></pre></div>",
        "id": 202225465,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1593331302
    },
    {
        "content": "<p><code>--debug</code> will only help when <code>leanproject</code> crashes.</p>",
        "id": 202225563,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1593331390
    },
    {
        "content": "<p>What does <code>leanproject --version</code> says?</p>",
        "id": 202225574,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1593331430
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span><code><span class=\"n\">leanproject</span> <span class=\"c1\">--version</span>\n<span class=\"n\">leanproject</span><span class=\"o\">,</span> <span class=\"n\">version</span> <span class=\"mi\">0</span><span class=\"bp\">.</span><span class=\"mi\">0</span><span class=\"bp\">.</span><span class=\"mi\">8</span>\n</code></pre></div>",
        "id": 202225627,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1593331473
    },
    {
        "content": "<p>Also try lauching python and <code>import paramiko</code></p>",
        "id": 202225628,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1593331481
    },
    {
        "content": "<p>and <code>from paramiko.ssh_exception import AuthenticationException, SSHException</code></p>",
        "id": 202225652,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1593331520
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span><code><span class=\"err\">➜</span>  <span class=\"n\">mathlib</span> <span class=\"n\">git</span><span class=\"o\">:(</span><span class=\"n\">master</span><span class=\"o\">)</span> <span class=\"n\">python</span> <span class=\"bp\">-</span><span class=\"n\">c</span> <span class=\"err\">&#39;</span><span class=\"kn\">import</span> <span class=\"n\">paramiko&#39;</span>\n<span class=\"n\">Traceback</span> <span class=\"o\">(</span><span class=\"n\">most</span> <span class=\"n\">recent</span> <span class=\"n\">call</span> <span class=\"n\">last</span><span class=\"o\">):</span>\n  <span class=\"n\">File</span> <span class=\"s2\">&quot;&lt;string&gt;&quot;</span><span class=\"o\">,</span> <span class=\"n\">line</span> <span class=\"mi\">1</span><span class=\"o\">,</span> <span class=\"k\">in</span> <span class=\"bp\">&lt;</span><span class=\"n\">module</span><span class=\"bp\">&gt;</span>\n<span class=\"n\">ImportError</span><span class=\"o\">:</span> <span class=\"n\">No</span> <span class=\"n\">module</span> <span class=\"n\">named</span> <span class=\"n\">paramiko</span>\n<span class=\"err\">➜</span>  <span class=\"n\">mathlib</span> <span class=\"n\">git</span><span class=\"o\">:(</span><span class=\"n\">master</span><span class=\"o\">)</span> <span class=\"n\">python3</span> <span class=\"bp\">-</span><span class=\"n\">c</span> <span class=\"err\">&#39;</span><span class=\"kn\">import</span> <span class=\"n\">paramiko&#39;</span>\n</code></pre></div>",
        "id": 202225654,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1593331528
    },
    {
        "content": "<p>so it works for python3, not python</p>",
        "id": 202225658,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1593331543
    },
    {
        "content": "<p>This is 2020, when people say python you need to understand python3.</p>",
        "id": 202225700,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1593331576
    },
    {
        "content": "<p>This is on a mostly clean new install of 18.04</p>",
        "id": 202225725,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1593331647
    },
    {
        "content": "<p>You should upgrade to 20.04 to get rid of python2.</p>",
        "id": 202225780,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1593331708
    },
    {
        "content": "<p>Anyway, please open <code>ipython</code>, type the two import lines I wrote, and then try typing <a href=\"https://github.com/leanprover-community/mathlib-tools/blob/master/mathlibtools/leanproject.py#L167-L170\">https://github.com/leanprover-community/mathlib-tools/blob/master/mathlibtools/leanproject.py#L167-L170</a></p>",
        "id": 202225785,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1593331737
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span><code><span class=\"n\">In</span> <span class=\"o\">[</span><span class=\"mi\">7</span><span class=\"o\">]:</span> <span class=\"n\">client</span><span class=\"bp\">.</span><span class=\"n\">connect</span><span class=\"o\">(</span><span class=\"err\">&#39;</span><span class=\"n\">github</span><span class=\"bp\">.</span><span class=\"n\">com&#39;</span><span class=\"o\">,</span> <span class=\"n\">username</span><span class=\"bp\">=</span><span class=\"err\">&#39;</span><span class=\"n\">git&#39;</span><span class=\"o\">)</span>\n<span class=\"c1\">---------------------------------------------------------------------------</span>\n<span class=\"n\">PasswordRequiredException</span>                 <span class=\"n\">Traceback</span> <span class=\"o\">(</span><span class=\"n\">most</span> <span class=\"n\">recent</span> <span class=\"n\">call</span> <span class=\"n\">last</span><span class=\"o\">)</span>\n<span class=\"bp\">&lt;</span><span class=\"n\">ipython</span><span class=\"bp\">-</span><span class=\"n\">input</span><span class=\"bp\">-</span><span class=\"mi\">7</span><span class=\"bp\">-</span><span class=\"n\">f64e6b4b50fa</span><span class=\"bp\">&gt;</span> <span class=\"k\">in</span> <span class=\"bp\">&lt;</span><span class=\"n\">module</span><span class=\"bp\">&gt;</span><span class=\"o\">()</span>\n<span class=\"c1\">----&gt; 1 client.connect(&#39;github.com&#39;, username=&#39;git&#39;)</span>\n\n<span class=\"bp\">/</span><span class=\"n\">usr</span><span class=\"bp\">/</span><span class=\"n\">local</span><span class=\"bp\">/</span><span class=\"n\">lib</span><span class=\"bp\">/</span><span class=\"n\">python3</span><span class=\"bp\">.</span><span class=\"mi\">6</span><span class=\"bp\">/</span><span class=\"n\">dist</span><span class=\"bp\">-</span><span class=\"n\">packages</span><span class=\"bp\">/</span><span class=\"n\">paramiko</span><span class=\"bp\">/</span><span class=\"n\">client</span><span class=\"bp\">.</span><span class=\"n\">py</span> <span class=\"k\">in</span> <span class=\"n\">connect</span><span class=\"o\">(</span><span class=\"n\">self</span><span class=\"o\">,</span> <span class=\"n\">hostname</span><span class=\"o\">,</span> <span class=\"n\">port</span><span class=\"o\">,</span> <span class=\"n\">username</span><span class=\"o\">,</span> <span class=\"n\">password</span><span class=\"o\">,</span> <span class=\"n\">pkey</span><span class=\"o\">,</span> <span class=\"n\">key_filename</span><span class=\"o\">,</span> <span class=\"n\">timeout</span><span class=\"o\">,</span> <span class=\"n\">allow_agent</span><span class=\"o\">,</span> <span class=\"n\">look_for_keys</span><span class=\"o\">,</span> <span class=\"n\">compress</span><span class=\"o\">,</span> <span class=\"n\">sock</span><span class=\"o\">,</span> <span class=\"n\">gss_auth</span><span class=\"o\">,</span> <span class=\"n\">gss_kex</span><span class=\"o\">,</span> <span class=\"n\">gss_deleg_creds</span><span class=\"o\">,</span> <span class=\"n\">gss_host</span><span class=\"o\">,</span> <span class=\"n\">banner_timeout</span><span class=\"o\">,</span> <span class=\"n\">auth_timeout</span><span class=\"o\">,</span> <span class=\"n\">gss_trust_dns</span><span class=\"o\">,</span> <span class=\"n\">passphrase</span><span class=\"o\">,</span> <span class=\"n\">disabled_algorithms</span><span class=\"o\">)</span>\n    <span class=\"mi\">444</span>             <span class=\"n\">gss_deleg_creds</span><span class=\"o\">,</span>\n    <span class=\"mi\">445</span>             <span class=\"n\">t</span><span class=\"bp\">.</span><span class=\"n\">gss_host</span><span class=\"o\">,</span>\n<span class=\"c1\">--&gt; 446             passphrase,</span>\n    <span class=\"mi\">447</span>         <span class=\"o\">)</span>\n    <span class=\"mi\">448</span>\n\n<span class=\"bp\">/</span><span class=\"n\">usr</span><span class=\"bp\">/</span><span class=\"n\">local</span><span class=\"bp\">/</span><span class=\"n\">lib</span><span class=\"bp\">/</span><span class=\"n\">python3</span><span class=\"bp\">.</span><span class=\"mi\">6</span><span class=\"bp\">/</span><span class=\"n\">dist</span><span class=\"bp\">-</span><span class=\"n\">packages</span><span class=\"bp\">/</span><span class=\"n\">paramiko</span><span class=\"bp\">/</span><span class=\"n\">client</span><span class=\"bp\">.</span><span class=\"n\">py</span> <span class=\"k\">in</span> <span class=\"bp\">_</span><span class=\"n\">auth</span><span class=\"o\">(</span><span class=\"n\">self</span><span class=\"o\">,</span> <span class=\"n\">username</span><span class=\"o\">,</span> <span class=\"n\">password</span><span class=\"o\">,</span> <span class=\"n\">pkey</span><span class=\"o\">,</span> <span class=\"n\">key_filenames</span><span class=\"o\">,</span> <span class=\"n\">allow_agent</span><span class=\"o\">,</span> <span class=\"n\">look_for_keys</span><span class=\"o\">,</span> <span class=\"n\">gss_auth</span><span class=\"o\">,</span> <span class=\"n\">gss_kex</span><span class=\"o\">,</span> <span class=\"n\">gss_deleg_creds</span><span class=\"o\">,</span> <span class=\"n\">gss_host</span><span class=\"o\">,</span> <span class=\"n\">passphrase</span><span class=\"o\">)</span>\n    <span class=\"mi\">762</span>         <span class=\"bp\">#</span> <span class=\"k\">if</span> <span class=\"n\">we</span> <span class=\"n\">got</span> <span class=\"n\">an</span> <span class=\"n\">auth</span><span class=\"bp\">-</span><span class=\"n\">failed</span> <span class=\"n\">exception</span> <span class=\"n\">earlier</span><span class=\"o\">,</span> <span class=\"n\">re</span><span class=\"bp\">-</span><span class=\"n\">raise</span> <span class=\"n\">it</span>\n    <span class=\"mi\">763</span>         <span class=\"k\">if</span> <span class=\"n\">saved_exception</span> <span class=\"n\">is</span> <span class=\"n\">not</span> <span class=\"n\">None</span><span class=\"o\">:</span>\n<span class=\"c1\">--&gt; 764             raise saved_exception</span>\n    <span class=\"mi\">765</span>         <span class=\"n\">raise</span> <span class=\"n\">SSHException</span><span class=\"o\">(</span><span class=\"s2\">&quot;No authentication methods available&quot;</span><span class=\"o\">)</span>\n    <span class=\"mi\">766</span>\n\n<span class=\"bp\">/</span><span class=\"n\">usr</span><span class=\"bp\">/</span><span class=\"n\">local</span><span class=\"bp\">/</span><span class=\"n\">lib</span><span class=\"bp\">/</span><span class=\"n\">python3</span><span class=\"bp\">.</span><span class=\"mi\">6</span><span class=\"bp\">/</span><span class=\"n\">dist</span><span class=\"bp\">-</span><span class=\"n\">packages</span><span class=\"bp\">/</span><span class=\"n\">paramiko</span><span class=\"bp\">/</span><span class=\"n\">client</span><span class=\"bp\">.</span><span class=\"n\">py</span> <span class=\"k\">in</span> <span class=\"bp\">_</span><span class=\"n\">auth</span><span class=\"o\">(</span><span class=\"n\">self</span><span class=\"o\">,</span> <span class=\"n\">username</span><span class=\"o\">,</span> <span class=\"n\">password</span><span class=\"o\">,</span> <span class=\"n\">pkey</span><span class=\"o\">,</span> <span class=\"n\">key_filenames</span><span class=\"o\">,</span> <span class=\"n\">allow_agent</span><span class=\"o\">,</span> <span class=\"n\">look_for_keys</span><span class=\"o\">,</span> <span class=\"n\">gss_auth</span><span class=\"o\">,</span> <span class=\"n\">gss_kex</span><span class=\"o\">,</span> <span class=\"n\">gss_deleg_creds</span><span class=\"o\">,</span> <span class=\"n\">gss_host</span><span class=\"o\">,</span> <span class=\"n\">passphrase</span><span class=\"o\">)</span>\n    <span class=\"mi\">733</span>                 <span class=\"n\">try</span><span class=\"o\">:</span>\n    <span class=\"mi\">734</span>                     <span class=\"n\">key</span> <span class=\"bp\">=</span> <span class=\"n\">self</span><span class=\"bp\">._</span><span class=\"n\">key_from_filepath</span><span class=\"o\">(</span>\n<span class=\"c1\">--&gt; 735                         filename, pkey_class, passphrase</span>\n    <span class=\"mi\">736</span>                     <span class=\"o\">)</span>\n    <span class=\"mi\">737</span>                     <span class=\"bp\">#</span> <span class=\"n\">for</span> <span class=\"mi\">2</span><span class=\"bp\">-</span><span class=\"n\">factor</span> <span class=\"n\">auth</span> <span class=\"n\">a</span> <span class=\"n\">successfully</span> <span class=\"n\">auth&#39;d</span> <span class=\"n\">key</span> <span class=\"n\">will</span> <span class=\"n\">result</span>\n\n<span class=\"bp\">/</span><span class=\"n\">usr</span><span class=\"bp\">/</span><span class=\"n\">local</span><span class=\"bp\">/</span><span class=\"n\">lib</span><span class=\"bp\">/</span><span class=\"n\">python3</span><span class=\"bp\">.</span><span class=\"mi\">6</span><span class=\"bp\">/</span><span class=\"n\">dist</span><span class=\"bp\">-</span><span class=\"n\">packages</span><span class=\"bp\">/</span><span class=\"n\">paramiko</span><span class=\"bp\">/</span><span class=\"n\">client</span><span class=\"bp\">.</span><span class=\"n\">py</span> <span class=\"k\">in</span> <span class=\"bp\">_</span><span class=\"n\">key_from_filepath</span><span class=\"o\">(</span><span class=\"n\">self</span><span class=\"o\">,</span> <span class=\"n\">filename</span><span class=\"o\">,</span> <span class=\"n\">klass</span><span class=\"o\">,</span> <span class=\"n\">password</span><span class=\"o\">)</span>\n    <span class=\"mi\">584</span>             <span class=\"n\">cert_path</span> <span class=\"bp\">=</span> <span class=\"n\">filename</span> <span class=\"bp\">+</span> <span class=\"n\">cert_suffix</span>\n    <span class=\"mi\">585</span>         <span class=\"bp\">#</span> <span class=\"n\">Blindly</span> <span class=\"n\">try</span> <span class=\"n\">the</span> <span class=\"n\">key</span> <span class=\"n\">path</span><span class=\"bp\">;</span> <span class=\"k\">if</span> <span class=\"n\">no</span> <span class=\"kn\">private</span> <span class=\"n\">key</span><span class=\"o\">,</span> <span class=\"n\">nothing</span> <span class=\"n\">will</span> <span class=\"n\">work</span><span class=\"bp\">.</span>\n<span class=\"c1\">--&gt; 586         key = klass.from_private_key_file(key_path, password)</span>\n    <span class=\"mi\">587</span>         <span class=\"bp\">#</span> <span class=\"n\">TODO</span><span class=\"o\">:</span> <span class=\"n\">change</span> <span class=\"n\">this</span> <span class=\"n\">to</span> <span class=\"err\">&#39;</span><span class=\"n\">Loading&#39;</span> <span class=\"n\">instead</span> <span class=\"n\">of</span> <span class=\"err\">&#39;</span><span class=\"n\">Trying&#39;</span> <span class=\"n\">sometime</span><span class=\"bp\">;</span> <span class=\"n\">probably</span>\n    <span class=\"mi\">588</span>         <span class=\"bp\">#</span> <span class=\"n\">when</span> <span class=\"bp\">#</span><span class=\"mi\">387</span> <span class=\"n\">is</span> <span class=\"n\">released</span><span class=\"o\">,</span> <span class=\"n\">since</span> <span class=\"n\">this</span> <span class=\"n\">is</span> <span class=\"n\">a</span> <span class=\"n\">critical</span> <span class=\"n\">log</span> <span class=\"n\">message</span> <span class=\"n\">users</span> <span class=\"n\">are</span>\n\n<span class=\"bp\">/</span><span class=\"n\">usr</span><span class=\"bp\">/</span><span class=\"n\">local</span><span class=\"bp\">/</span><span class=\"n\">lib</span><span class=\"bp\">/</span><span class=\"n\">python3</span><span class=\"bp\">.</span><span class=\"mi\">6</span><span class=\"bp\">/</span><span class=\"n\">dist</span><span class=\"bp\">-</span><span class=\"n\">packages</span><span class=\"bp\">/</span><span class=\"n\">paramiko</span><span class=\"bp\">/</span><span class=\"n\">pkey</span><span class=\"bp\">.</span><span class=\"n\">py</span> <span class=\"k\">in</span> <span class=\"n\">from_private_key_file</span><span class=\"o\">(</span><span class=\"n\">cls</span><span class=\"o\">,</span> <span class=\"n\">filename</span><span class=\"o\">,</span> <span class=\"n\">password</span><span class=\"o\">)</span>\n    <span class=\"mi\">233</span>         <span class=\"o\">:</span><span class=\"n\">raises</span><span class=\"o\">:</span> <span class=\"bp\">`.</span><span class=\"n\">SSHException</span><span class=\"bp\">`</span> <span class=\"c1\">-- if the key file is invalid</span>\n    <span class=\"mi\">234</span>         <span class=\"s2\">&quot;&quot;&quot;</span>\n<span class=\"s2\">--&gt; 235         key = cls(filename=filename, password=password)</span>\n<span class=\"s2\">    236         return key</span>\n<span class=\"s2\">    237</span>\n\n<span class=\"s2\">/usr/local/lib/python3.6/dist-packages/paramiko/rsakey.py in __init__(self, msg, data, filename, password, key, file_obj)</span>\n<span class=\"s2\">     53             return</span>\n<span class=\"s2\">     54         if filename is not None:</span>\n<span class=\"s2\">---&gt; 55             self._from_private_key_file(filename, password)</span>\n<span class=\"s2\">     56             return</span>\n<span class=\"s2\">     57         if (msg is None) and (data is not None):</span>\n\n<span class=\"s2\">/usr/local/lib/python3.6/dist-packages/paramiko/rsakey.py in _from_private_key_file(self, filename, password)</span>\n<span class=\"s2\">    173</span>\n<span class=\"s2\">    174     def _from_private_key_file(self, filename, password):</span>\n<span class=\"s2\">--&gt; 175         data = self._read_private_key_file(&quot;</span><span class=\"n\">RSA</span><span class=\"s2\">&quot;, filename, password)</span>\n<span class=\"s2\">    176         self._decode_key(data)</span>\n<span class=\"s2\">    177</span>\n\n<span class=\"s2\">/usr/local/lib/python3.6/dist-packages/paramiko/pkey.py in _read_private_key_file(self, tag, filename, password)</span>\n<span class=\"s2\">    306         &quot;&quot;&quot;</span>\n    <span class=\"mi\">307</span>         <span class=\"k\">with</span> <span class=\"kn\">open</span><span class=\"o\">(</span><span class=\"n\">filename</span><span class=\"o\">,</span> <span class=\"s2\">&quot;r&quot;</span><span class=\"o\">)</span> <span class=\"n\">as</span> <span class=\"n\">f</span><span class=\"o\">:</span>\n<span class=\"c1\">--&gt; 308             data = self._read_private_key(tag, f, password)</span>\n    <span class=\"mi\">309</span>         <span class=\"n\">return</span> <span class=\"n\">data</span>\n    <span class=\"mi\">310</span>\n\n<span class=\"bp\">/</span><span class=\"n\">usr</span><span class=\"bp\">/</span><span class=\"n\">local</span><span class=\"bp\">/</span><span class=\"n\">lib</span><span class=\"bp\">/</span><span class=\"n\">python3</span><span class=\"bp\">.</span><span class=\"mi\">6</span><span class=\"bp\">/</span><span class=\"n\">dist</span><span class=\"bp\">-</span><span class=\"n\">packages</span><span class=\"bp\">/</span><span class=\"n\">paramiko</span><span class=\"bp\">/</span><span class=\"n\">pkey</span><span class=\"bp\">.</span><span class=\"n\">py</span> <span class=\"k\">in</span> <span class=\"bp\">_</span><span class=\"n\">read_private_key</span><span class=\"o\">(</span><span class=\"n\">self</span><span class=\"o\">,</span> <span class=\"n\">tag</span><span class=\"o\">,</span> <span class=\"n\">f</span><span class=\"o\">,</span> <span class=\"n\">password</span><span class=\"o\">)</span>\n    <span class=\"mi\">332</span>\n    <span class=\"mi\">333</span>         <span class=\"k\">if</span> <span class=\"n\">keytype</span> <span class=\"bp\">==</span> <span class=\"n\">tag</span><span class=\"o\">:</span>\n<span class=\"c1\">--&gt; 334             data = self._read_private_key_pem(lines, end, password)</span>\n    <span class=\"mi\">335</span>             <span class=\"n\">pkformat</span> <span class=\"bp\">=</span> <span class=\"n\">self</span><span class=\"bp\">._</span><span class=\"n\">PRIVATE_KEY_FORMAT_ORIGINAL</span>\n    <span class=\"mi\">336</span>         <span class=\"n\">elif</span> <span class=\"n\">keytype</span> <span class=\"bp\">==</span> <span class=\"s2\">&quot;OPENSSH&quot;</span><span class=\"o\">:</span>\n\n<span class=\"bp\">/</span><span class=\"n\">usr</span><span class=\"bp\">/</span><span class=\"n\">local</span><span class=\"bp\">/</span><span class=\"n\">lib</span><span class=\"bp\">/</span><span class=\"n\">python3</span><span class=\"bp\">.</span><span class=\"mi\">6</span><span class=\"bp\">/</span><span class=\"n\">dist</span><span class=\"bp\">-</span><span class=\"n\">packages</span><span class=\"bp\">/</span><span class=\"n\">paramiko</span><span class=\"bp\">/</span><span class=\"n\">pkey</span><span class=\"bp\">.</span><span class=\"n\">py</span> <span class=\"k\">in</span> <span class=\"bp\">_</span><span class=\"n\">read_private_key_pem</span><span class=\"o\">(</span><span class=\"n\">self</span><span class=\"o\">,</span> <span class=\"n\">lines</span><span class=\"o\">,</span> <span class=\"kn\">end</span><span class=\"o\">,</span> <span class=\"n\">password</span><span class=\"o\">)</span>\n    <span class=\"mi\">384</span>         <span class=\"bp\">#</span> <span class=\"n\">raise</span> <span class=\"n\">an</span> <span class=\"n\">exception</span> <span class=\"n\">pointing</span> <span class=\"n\">out</span> <span class=\"n\">that</span> <span class=\"n\">we</span> <span class=\"n\">need</span> <span class=\"n\">one</span>\n    <span class=\"mi\">385</span>         <span class=\"k\">if</span> <span class=\"n\">password</span> <span class=\"n\">is</span> <span class=\"n\">None</span><span class=\"o\">:</span>\n<span class=\"c1\">--&gt; 386             raise PasswordRequiredException(&quot;Private key file is encrypted&quot;)</span>\n    <span class=\"mi\">387</span>         <span class=\"n\">cipher</span> <span class=\"bp\">=</span> <span class=\"n\">self</span><span class=\"bp\">._</span><span class=\"n\">CIPHER_TABLE</span><span class=\"o\">[</span><span class=\"n\">encryption_type</span><span class=\"o\">][</span><span class=\"s2\">&quot;cipher&quot;</span><span class=\"o\">]</span>\n    <span class=\"mi\">388</span>         <span class=\"n\">keysize</span> <span class=\"bp\">=</span> <span class=\"n\">self</span><span class=\"bp\">._</span><span class=\"n\">CIPHER_TABLE</span><span class=\"o\">[</span><span class=\"n\">encryption_type</span><span class=\"o\">][</span><span class=\"s2\">&quot;keysize&quot;</span><span class=\"o\">]</span>\n\n<span class=\"n\">PasswordRequiredException</span><span class=\"o\">:</span> <span class=\"n\">Private</span> <span class=\"n\">key</span> <span class=\"n\">file</span> <span class=\"n\">is</span> <span class=\"n\">encrypted</span>\n</code></pre></div>",
        "id": 202225950,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1593332047
    },
    {
        "content": "<p>So you have your answer: the problem is in your ssh setup.</p>",
        "id": 202225966,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1593332102
    },
    {
        "content": "<p>Do you use a passphrase for the SSH key that you use on GitHub?</p>",
        "id": 202226023,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1593332216
    },
    {
        "content": "<p>Yes, that's the case</p>",
        "id": 202226029,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1593332257
    },
    {
        "content": "<p>Then you're in totally untested territory. Arguably this should be possible, but I'm not surprised at all that it fails.</p>",
        "id": 202226094,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1593332364
    },
    {
        "content": "<p>Feel free to open a PR to mathlibtools fixing that if you can.</p>",
        "id": 202226099,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1593332398
    },
    {
        "content": "<p>Note there is no need to dig into leanproject code, you simply need to make the above lines to work.</p>",
        "id": 202226150,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1593332486
    },
    {
        "content": "<p>I'm sure paramiko's documentation will help.</p>",
        "id": 202226157,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1593332505
    },
    {
        "content": "<p>FWIW my workflow where I just explicitly <code>leanproject get-cache</code> Just Works (tm), I've got a passphrase on my SSH key on macOS</p>",
        "id": 202226718,
        "sender_full_name": "Patrick Stevens",
        "timestamp": 1593333469
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib-tools/pull/61\">https://github.com/leanprover-community/mathlib-tools/pull/61</a></p>",
        "id": 202227350,
        "sender_full_name": "Yakov Pechersky",
        "timestamp": 1593334612
    }
]