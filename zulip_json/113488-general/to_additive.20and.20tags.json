[
    {
        "content": "<div class=\"codehilite\"><pre><span></span><span class=\"kn\">import</span> <span class=\"n\">group_theory</span><span class=\"bp\">.</span><span class=\"n\">submonoid</span>\n\n<span class=\"bp\">@</span><span class=\"o\">[</span><span class=\"n\">to_additive</span> <span class=\"n\">bar1</span><span class=\"o\">]</span>\n<span class=\"kn\">theorem</span> <span class=\"n\">foo1</span> <span class=\"o\">(</span><span class=\"n\">α</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">)</span> <span class=\"o\">[</span><span class=\"n\">monoid</span> <span class=\"n\">α</span><span class=\"o\">]</span> <span class=\"o\">:</span> <span class=\"o\">(</span><span class=\"mi\">1</span> <span class=\"o\">:</span> <span class=\"n\">α</span><span class=\"o\">)</span> <span class=\"bp\">=</span> <span class=\"mi\">1</span> <span class=\"o\">:=</span> <span class=\"n\">sorry</span>\n\n<span class=\"bp\">#</span><span class=\"kn\">check</span> <span class=\"n\">bar1</span> <span class=\"c1\">-- ∀ (α : Type u_1) [_inst_1 : add_monoid α], 0 = 0</span>\n\n\n<span class=\"bp\">@</span><span class=\"o\">[</span><span class=\"n\">to_additive</span> <span class=\"n\">bar2</span><span class=\"o\">,</span> <span class=\"n\">simp</span><span class=\"o\">]</span>\n<span class=\"kn\">theorem</span> <span class=\"n\">foo2</span> <span class=\"o\">(</span><span class=\"n\">α</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">)</span> <span class=\"o\">[</span><span class=\"n\">monoid</span> <span class=\"n\">α</span><span class=\"o\">]</span> <span class=\"o\">:</span> <span class=\"o\">(</span><span class=\"mi\">1</span> <span class=\"o\">:</span> <span class=\"n\">α</span><span class=\"o\">)</span> <span class=\"bp\">*</span> <span class=\"mi\">1</span> <span class=\"bp\">=</span> <span class=\"mi\">1</span> <span class=\"o\">:=</span> <span class=\"n\">sorry</span>\n\n<span class=\"bp\">#</span><span class=\"kn\">print</span> <span class=\"n\">bar2</span> <span class=\"c1\">-- no simp tag</span>\n\n\n<span class=\"bp\">@</span><span class=\"o\">[</span><span class=\"n\">simp</span><span class=\"o\">,</span> <span class=\"n\">to_additive</span> <span class=\"n\">bar3</span><span class=\"o\">]</span>\n<span class=\"kn\">theorem</span> <span class=\"n\">foo3</span> <span class=\"o\">(</span><span class=\"n\">α</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">)</span> <span class=\"o\">[</span><span class=\"n\">monoid</span> <span class=\"n\">α</span><span class=\"o\">]</span> <span class=\"o\">:</span> <span class=\"o\">(</span><span class=\"mi\">1</span> <span class=\"o\">:</span> <span class=\"n\">α</span><span class=\"o\">)</span> <span class=\"bp\">*</span> <span class=\"mi\">1</span> <span class=\"bp\">=</span> <span class=\"mi\">1</span> <span class=\"o\">:=</span> <span class=\"n\">sorry</span>\n\n<span class=\"bp\">#</span><span class=\"kn\">print</span> <span class=\"n\">bar3</span> <span class=\"c1\">-- has a simp tag</span>\n\n<span class=\"bp\">@</span><span class=\"o\">[</span><span class=\"n\">extensionality</span><span class=\"o\">,</span> <span class=\"n\">to_additive</span> <span class=\"n\">bar4</span><span class=\"o\">]</span>\n<span class=\"kn\">theorem</span> <span class=\"n\">foo4</span> <span class=\"o\">{</span><span class=\"n\">α</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span> <span class=\"o\">[</span><span class=\"n\">monoid</span> <span class=\"n\">α</span><span class=\"o\">]</span> <span class=\"o\">{</span><span class=\"n\">β</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span> <span class=\"o\">[</span><span class=\"n\">monoid</span> <span class=\"n\">β</span><span class=\"o\">]</span> <span class=\"o\">(</span><span class=\"n\">h</span> <span class=\"o\">:</span> <span class=\"n\">α</span> <span class=\"bp\">=</span> <span class=\"n\">β</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">α</span> <span class=\"bp\">=</span> <span class=\"n\">β</span> <span class=\"o\">:=</span> <span class=\"n\">sorry</span>\n\n<span class=\"bp\">#</span><span class=\"kn\">print</span> <span class=\"n\">foo4</span> <span class=\"c1\">-- has extensionality tag</span>\n<span class=\"bp\">#</span><span class=\"kn\">print</span> <span class=\"n\">bar4</span> <span class=\"c1\">-- no extensionality tag</span>\n</pre></div>\n\n\n<p><code>to_additive</code> can move <code>simp</code> tags if they're put in the right place. Can it move extensionality tags? I just had to tag a couple of things manually, so there's an easy workaround, but it made me wonder.</p>",
        "id": 172845919,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1565353018
    },
    {
        "content": "<p>Unrelated: the output of <code>#print</code> is quite something if the lemma is tagged with the extensionality tag.</p>",
        "id": 172845997,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1565353095
    },
    {
        "content": "<p>The attribute list is processed in left to right order, and when the <code>to_additive</code> attribute is called it will copy any attributes on the theorem to the additive version. So <code>to_additive</code> should always go at the end</p>",
        "id": 172846113,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1565353217
    },
    {
        "content": "<p>But <code>bar4</code> is not getting the extensionality tag.</p>",
        "id": 172846257,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1565353342
    },
    {
        "content": "<p>ugh, lean core failed me again</p>\n<div class=\"codehilite\"><pre><span></span><span class=\"n\">meta</span> <span class=\"n\">def</span> <span class=\"n\">transport_with_dict</span> <span class=\"o\">(</span><span class=\"n\">dict</span> <span class=\"o\">:</span> <span class=\"n\">name_map</span> <span class=\"n\">name</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">src</span> <span class=\"o\">:</span> <span class=\"n\">name</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">tgt</span> <span class=\"o\">:</span> <span class=\"n\">name</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">command</span> <span class=\"o\">:=</span>\n<span class=\"n\">copy_decl_using</span> <span class=\"n\">dict</span> <span class=\"n\">src</span> <span class=\"n\">tgt</span>\n<span class=\"bp\">&gt;&gt;</span> <span class=\"n\">copy_attribute</span> <span class=\"bp\">`</span><span class=\"kn\">reducible</span> <span class=\"n\">src</span> <span class=\"n\">tt</span> <span class=\"n\">tgt</span>\n<span class=\"bp\">&gt;&gt;</span> <span class=\"n\">copy_attribute</span> <span class=\"bp\">`</span><span class=\"n\">simp</span> <span class=\"n\">src</span> <span class=\"n\">tt</span> <span class=\"n\">tgt</span>\n<span class=\"bp\">&gt;&gt;</span> <span class=\"n\">copy_attribute</span> <span class=\"bp\">`</span><span class=\"kn\">instance</span> <span class=\"n\">src</span> <span class=\"n\">tt</span> <span class=\"n\">tgt</span>\n</pre></div>",
        "id": 172846300,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1565353401
    },
    {
        "content": "<p>then again, there is probably a reason why it isn't copying <em>all</em> attributes on the original. For instance it would be a bad idea to copy <code>to_additive</code></p>",
        "id": 172846452,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1565353527
    },
    {
        "content": "<p><code>to_additive</code> is better than nothing, but it is still rather inadequate. I have got 30 definitions and theorems about submonoids with a PR which is ready to go other than the fact that I have to to-additive everything. I have namespaces and variables and it would be wonderful just to get everything working with <code>@[to_additive ...]</code> because that way one doesn't have to write the proofs twice.  But there are many obstructions to doing this. Here's an example of a definition with problems:</p>\n<div class=\"codehilite\"><pre><span></span><span class=\"c\">/-</span><span class=\"cm\">- A submonoid is closed under multiplication. -/</span>\n<span class=\"bp\">@</span><span class=\"o\">[</span><span class=\"n\">to_additive</span> <span class=\"n\">add_submonoid</span><span class=\"bp\">.</span><span class=\"n\">add_mem</span><span class=\"o\">]</span>\n<span class=\"n\">def</span> <span class=\"n\">mul_mem</span> <span class=\"o\">{</span><span class=\"n\">x</span> <span class=\"n\">y</span> <span class=\"o\">:</span> <span class=\"n\">M</span><span class=\"o\">}</span> <span class=\"o\">:</span> <span class=\"n\">x</span> <span class=\"err\">∈</span> <span class=\"n\">S</span> <span class=\"bp\">→</span> <span class=\"n\">y</span> <span class=\"err\">∈</span> <span class=\"n\">S</span> <span class=\"bp\">→</span> <span class=\"n\">x</span> <span class=\"bp\">*</span> <span class=\"n\">y</span> <span class=\"err\">∈</span> <span class=\"n\">S</span> <span class=\"o\">:=</span> <span class=\"n\">submonoid</span><span class=\"bp\">.</span><span class=\"n\">mul_mem&#39;</span> <span class=\"n\">S</span>\n<span class=\"n\">attribute</span> <span class=\"o\">[</span><span class=\"n\">to_additive</span> <span class=\"n\">add_submonoid</span><span class=\"bp\">.</span><span class=\"n\">add_mem</span><span class=\"bp\">.</span><span class=\"n\">equations</span><span class=\"bp\">._</span><span class=\"n\">eqn_1</span><span class=\"o\">]</span> <span class=\"n\">submonoid</span><span class=\"bp\">.</span><span class=\"n\">mul_mem</span><span class=\"bp\">.</span><span class=\"n\">equations</span><span class=\"bp\">._</span><span class=\"n\">eqn_1</span>\n</pre></div>\n\n\n<p><code>to_additive</code> defines <code>add_mem</code>, but I have to manually tag <code>eqn_1</code>. The other problem with this approach is that add_mem does not get a docstring.</p>\n<p>Here's a worse issue; a complicated definition.</p>\n<div class=\"codehilite\"><pre><span></span><span class=\"c\">/-</span><span class=\"cm\">- A directed union of submonoids is a submonoid. -/</span>\n<span class=\"bp\">@</span><span class=\"o\">[</span><span class=\"n\">to_additive</span> <span class=\"n\">add_submonoid</span><span class=\"bp\">.</span><span class=\"n\">Union_of_directed</span><span class=\"o\">]</span>\n<span class=\"n\">def</span> <span class=\"n\">Union_of_directed</span> <span class=\"o\">{</span><span class=\"n\">ι</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span> <span class=\"o\">[</span><span class=\"n\">hι</span> <span class=\"o\">:</span> <span class=\"n\">nonempty</span> <span class=\"n\">ι</span><span class=\"o\">]</span>\n  <span class=\"o\">(</span><span class=\"n\">s</span> <span class=\"o\">:</span> <span class=\"n\">ι</span> <span class=\"bp\">→</span> <span class=\"n\">submonoid</span> <span class=\"n\">M</span><span class=\"o\">)</span>\n  <span class=\"o\">(</span><span class=\"n\">directed</span> <span class=\"o\">:</span> <span class=\"bp\">∀</span> <span class=\"n\">i</span> <span class=\"n\">j</span><span class=\"o\">,</span> <span class=\"bp\">∃</span> <span class=\"n\">k</span><span class=\"o\">,</span> <span class=\"n\">s</span> <span class=\"n\">i</span> <span class=\"bp\">≤</span> <span class=\"n\">s</span> <span class=\"n\">k</span> <span class=\"bp\">∧</span> <span class=\"n\">s</span> <span class=\"n\">j</span> <span class=\"bp\">≤</span> <span class=\"n\">s</span> <span class=\"n\">k</span><span class=\"o\">)</span> <span class=\"o\">:</span>\n  <span class=\"n\">submonoid</span> <span class=\"n\">M</span> <span class=\"o\">:=</span>\n<span class=\"o\">{</span> <span class=\"n\">carrier</span> <span class=\"o\">:=</span> <span class=\"o\">(</span><span class=\"err\">⋃</span><span class=\"n\">i</span><span class=\"o\">,</span> <span class=\"n\">s</span> <span class=\"n\">i</span><span class=\"o\">),</span>\n  <span class=\"n\">one_mem&#39;</span> <span class=\"o\">:=</span> <span class=\"k\">let</span> <span class=\"bp\">⟨</span><span class=\"n\">i</span><span class=\"bp\">⟩</span> <span class=\"o\">:=</span> <span class=\"n\">hι</span> <span class=\"k\">in</span> <span class=\"n\">set</span><span class=\"bp\">.</span><span class=\"n\">mem_Union</span><span class=\"bp\">.</span><span class=\"mi\">2</span> <span class=\"bp\">⟨</span><span class=\"n\">i</span><span class=\"o\">,</span> <span class=\"n\">submonoid</span><span class=\"bp\">.</span><span class=\"n\">one_mem</span> <span class=\"bp\">_⟩</span><span class=\"o\">,</span>\n  <span class=\"n\">mul_mem&#39;</span> <span class=\"o\">:=</span> <span class=\"bp\">λ</span> <span class=\"n\">a</span> <span class=\"n\">b</span> <span class=\"n\">ha</span> <span class=\"n\">hb</span><span class=\"o\">,</span>\n    <span class=\"k\">let</span> <span class=\"bp\">⟨</span><span class=\"n\">i</span><span class=\"o\">,</span> <span class=\"n\">hi</span><span class=\"bp\">⟩</span> <span class=\"o\">:=</span> <span class=\"n\">set</span><span class=\"bp\">.</span><span class=\"n\">mem_Union</span><span class=\"bp\">.</span><span class=\"mi\">1</span> <span class=\"n\">ha</span> <span class=\"k\">in</span>\n    <span class=\"k\">let</span> <span class=\"bp\">⟨</span><span class=\"n\">j</span><span class=\"o\">,</span> <span class=\"n\">hj</span><span class=\"bp\">⟩</span> <span class=\"o\">:=</span> <span class=\"n\">set</span><span class=\"bp\">.</span><span class=\"n\">mem_Union</span><span class=\"bp\">.</span><span class=\"mi\">1</span> <span class=\"n\">hb</span> <span class=\"k\">in</span>\n    <span class=\"k\">let</span> <span class=\"bp\">⟨</span><span class=\"n\">k</span><span class=\"o\">,</span> <span class=\"n\">hk</span><span class=\"bp\">⟩</span> <span class=\"o\">:=</span> <span class=\"n\">directed</span> <span class=\"n\">i</span> <span class=\"n\">j</span> <span class=\"k\">in</span>\n    <span class=\"n\">set</span><span class=\"bp\">.</span><span class=\"n\">mem_Union</span><span class=\"bp\">.</span><span class=\"mi\">2</span> <span class=\"bp\">⟨</span><span class=\"n\">k</span><span class=\"o\">,</span> <span class=\"o\">(</span><span class=\"n\">s</span> <span class=\"n\">k</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">mul_mem</span> <span class=\"o\">(</span><span class=\"n\">hk</span><span class=\"bp\">.</span><span class=\"mi\">1</span> <span class=\"n\">hi</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">hk</span><span class=\"bp\">.</span><span class=\"mi\">2</span> <span class=\"n\">hj</span><span class=\"o\">)</span><span class=\"bp\">⟩</span> <span class=\"o\">}</span>\n</pre></div>\n\n\n<p>Here <code>to_additive</code> fails to port the theorem, and my understanding of the error is that <code>submonoid.Union_of_directed._match_1</code> has not been tagged with <code>to_additive</code> -- but I don't see anywhere where I have a chance to tag this. If I close the namespace now and add the additive version manually (copying and pasting the code, which in my mind already indicates something is wrong) then I have to set up all my variables again. If instead I decide to close the namespace after I've formalised all 20 lemmas/definitions then it gets to the point where even the lemmas stop working because not enough earlier stuff has been tagged. Together with the docstring issue it seems to me that currently the best way to deal with this is simply to prove a bunch of stuff in a submonoid namespace and then simply prove everything again in an add_submonoid namespace and port the proofs manually. That way I can get docstrings as well. But then I have to go through all this rigmarole of tagging all the _match and _eqn1 stuff , and, more importantly, <em>I never use <code>to_additive</code> myself at all</em>.</p>",
        "id": 172846906,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1565353966
    },
    {
        "content": "<p>In short: it seems to me that Lean best practice is to avoid to_additive when the going gets tough.</p>",
        "id": 172847028,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1565354045
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"110193\">@Cyril Cohen</span> do you have these problems in Coq? Do you have additive groups and multiplicative groups, and a system for porting definitions / theorems in one domain to the other?</p>",
        "id": 172847067,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1565354099
    },
    {
        "content": "<p>I am bundling submonoids and add_submonoids and coming to the conclusion that our infrastructure for helping is giving me literally nothing more than the fact that the work I have to do is <em>more</em> than doubled, instead of just doubled.</p>",
        "id": 172847145,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1565354166
    },
    {
        "content": "<p>why is <code>mul_mem</code> a def?</p>",
        "id": 172847213,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1565354273
    },
    {
        "content": "<p>Because I'm a twit.</p>",
        "id": 172847258,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1565354286
    },
    {
        "content": "<p>if it's a theorem there is no eqn_1 to worry about</p>",
        "id": 172847275,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1565354302
    },
    {
        "content": "<p>I can dig out another example if you like.</p>",
        "id": 172847288,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1565354324
    },
    {
        "content": "<p>The docstring thing would be nice, but what should it say?</p>",
        "id": 172847303,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1565354338
    },
    {
        "content": "<p>It's possible to create a docstring for the copy</p>",
        "id": 172847317,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1565354348
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span><span class=\"bp\">@</span><span class=\"o\">[</span><span class=\"n\">to_additive</span> <span class=\"n\">add_submonoid</span><span class=\"bp\">.</span><span class=\"n\">univ</span><span class=\"o\">]</span>\n<span class=\"n\">def</span> <span class=\"n\">univ</span> <span class=\"o\">:</span> <span class=\"n\">submonoid</span> <span class=\"n\">M</span> <span class=\"o\">:=</span>\n<span class=\"o\">{</span> <span class=\"n\">carrier</span> <span class=\"o\">:=</span> <span class=\"n\">set</span><span class=\"bp\">.</span><span class=\"n\">univ</span><span class=\"o\">,</span>\n  <span class=\"n\">one_mem&#39;</span> <span class=\"o\">:=</span> <span class=\"n\">set</span><span class=\"bp\">.</span><span class=\"n\">mem_univ</span> <span class=\"mi\">1</span><span class=\"o\">,</span>\n  <span class=\"n\">mul_mem&#39;</span> <span class=\"o\">:=</span> <span class=\"bp\">λ</span> <span class=\"bp\">_</span> <span class=\"bp\">_</span> <span class=\"bp\">_</span> <span class=\"bp\">_</span><span class=\"o\">,</span> <span class=\"n\">set</span><span class=\"bp\">.</span><span class=\"n\">mem_univ</span> <span class=\"bp\">_</span> <span class=\"o\">}</span>\n</pre></div>",
        "id": 172847412,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1565354412
    },
    {
        "content": "<p>This one fails  -- </p>\n<div class=\"codehilite\"><pre><span></span>type mismatch at application\n  univ._proof_1 M _inst_3\nterm\n  _inst_3\nhas type\n  add_monoid M\nbut is expected to have type\n  monoid M\n</pre></div>",
        "id": 172847421,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1565354432
    },
    {
        "content": "<p>yeah, that happens</p>",
        "id": 172847427,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1565354440
    },
    {
        "content": "<p>There's nothing I can do about this, right?</p>",
        "id": 172847436,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1565354452
    },
    {
        "content": "<p>You have to transfer more things</p>",
        "id": 172847445,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1565354461
    },
    {
        "content": "<p>What do you mean? I have transferred everything up unto this point I think.</p>",
        "id": 172847469,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1565354480
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span><span class=\"c\">/-</span><span class=\"cm\">- A submonoid of a monoid α is a subset containing 1 and closed under multiplication. -/</span>\n<span class=\"kn\">structure</span> <span class=\"n\">submonoid</span> <span class=\"o\">(</span><span class=\"n\">α</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">)</span> <span class=\"o\">[</span><span class=\"n\">monoid</span> <span class=\"n\">α</span><span class=\"o\">]</span> <span class=\"o\">:=</span>\n<span class=\"o\">(</span><span class=\"n\">carrier</span> <span class=\"o\">:</span> <span class=\"n\">set</span> <span class=\"n\">α</span><span class=\"o\">)</span>\n<span class=\"o\">(</span><span class=\"n\">one_mem&#39;</span> <span class=\"o\">:</span> <span class=\"o\">(</span><span class=\"mi\">1</span> <span class=\"o\">:</span> <span class=\"n\">α</span><span class=\"o\">)</span> <span class=\"err\">∈</span> <span class=\"n\">carrier</span><span class=\"o\">)</span>\n<span class=\"o\">(</span><span class=\"n\">mul_mem&#39;</span> <span class=\"o\">{</span><span class=\"n\">a</span> <span class=\"n\">b</span><span class=\"o\">}</span> <span class=\"o\">:</span> <span class=\"n\">a</span> <span class=\"err\">∈</span> <span class=\"n\">carrier</span> <span class=\"bp\">→</span> <span class=\"n\">b</span> <span class=\"err\">∈</span> <span class=\"n\">carrier</span> <span class=\"bp\">→</span> <span class=\"n\">a</span> <span class=\"bp\">*</span> <span class=\"n\">b</span> <span class=\"err\">∈</span> <span class=\"n\">carrier</span><span class=\"o\">)</span>\n\n<span class=\"c\">/-</span><span class=\"cm\">- An  additive submonoid of an additive monoid α is a subset containing 0 and</span>\n<span class=\"cm\">  closed under addition. -/</span>\n<span class=\"kn\">structure</span> <span class=\"n\">add_submonoid</span> <span class=\"o\">(</span><span class=\"n\">α</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">)</span> <span class=\"o\">[</span><span class=\"n\">add_monoid</span> <span class=\"n\">α</span><span class=\"o\">]</span> <span class=\"o\">:=</span>\n<span class=\"o\">(</span><span class=\"n\">carrier</span> <span class=\"o\">:</span> <span class=\"n\">set</span> <span class=\"n\">α</span><span class=\"o\">)</span>\n<span class=\"o\">(</span><span class=\"n\">zero_mem&#39;</span> <span class=\"o\">:</span> <span class=\"o\">(</span><span class=\"mi\">0</span> <span class=\"o\">:</span> <span class=\"n\">α</span><span class=\"o\">)</span> <span class=\"err\">∈</span> <span class=\"n\">carrier</span><span class=\"o\">)</span>\n<span class=\"o\">(</span><span class=\"n\">add_mem&#39;</span> <span class=\"o\">{</span><span class=\"n\">a</span> <span class=\"n\">b</span><span class=\"o\">}</span> <span class=\"o\">:</span> <span class=\"n\">a</span> <span class=\"err\">∈</span> <span class=\"n\">carrier</span> <span class=\"bp\">→</span> <span class=\"n\">b</span> <span class=\"err\">∈</span> <span class=\"n\">carrier</span> <span class=\"bp\">→</span> <span class=\"n\">a</span> <span class=\"bp\">+</span> <span class=\"n\">b</span> <span class=\"err\">∈</span> <span class=\"n\">carrier</span><span class=\"o\">)</span>\n\n<span class=\"n\">attribute</span> <span class=\"o\">[</span><span class=\"n\">to_additive</span> <span class=\"n\">add_submonoid</span><span class=\"o\">]</span> <span class=\"n\">submonoid</span>\n<span class=\"n\">attribute</span> <span class=\"o\">[</span><span class=\"n\">to_additive</span> <span class=\"n\">add_submonoid</span><span class=\"bp\">.</span><span class=\"n\">carrier</span><span class=\"o\">]</span> <span class=\"n\">submonoid</span><span class=\"bp\">.</span><span class=\"n\">carrier</span>\n<span class=\"n\">attribute</span> <span class=\"o\">[</span><span class=\"n\">to_additive</span> <span class=\"n\">add_submonoid</span><span class=\"bp\">.</span><span class=\"n\">cases_on</span><span class=\"o\">]</span> <span class=\"n\">submonoid</span><span class=\"bp\">.</span><span class=\"n\">cases_on</span>\n<span class=\"n\">attribute</span> <span class=\"o\">[</span><span class=\"n\">to_additive</span> <span class=\"n\">add_submonoid</span><span class=\"bp\">.</span><span class=\"n\">has_sizeof_inst</span><span class=\"o\">]</span> <span class=\"n\">submonoid</span><span class=\"bp\">.</span><span class=\"n\">has_sizeof_inst</span>\n<span class=\"n\">attribute</span> <span class=\"o\">[</span><span class=\"n\">to_additive</span> <span class=\"n\">add_submonoid</span><span class=\"bp\">.</span><span class=\"n\">mk</span><span class=\"o\">]</span> <span class=\"n\">submonoid</span><span class=\"bp\">.</span><span class=\"n\">mk</span>\n<span class=\"n\">attribute</span> <span class=\"o\">[</span><span class=\"n\">to_additive</span> <span class=\"n\">add_submonoid</span><span class=\"bp\">.</span><span class=\"n\">mk</span><span class=\"bp\">.</span><span class=\"n\">inj</span><span class=\"o\">]</span> <span class=\"n\">submonoid</span><span class=\"bp\">.</span><span class=\"n\">mk</span><span class=\"bp\">.</span><span class=\"n\">inj</span>\n<span class=\"n\">attribute</span> <span class=\"o\">[</span><span class=\"n\">to_additive</span> <span class=\"n\">add_submonoid</span><span class=\"bp\">.</span><span class=\"n\">mk</span><span class=\"bp\">.</span><span class=\"n\">inj_arrow</span><span class=\"o\">]</span> <span class=\"n\">submonoid</span><span class=\"bp\">.</span><span class=\"n\">mk</span><span class=\"bp\">.</span><span class=\"n\">inj_arrow</span>\n<span class=\"n\">attribute</span> <span class=\"o\">[</span><span class=\"n\">to_additive</span> <span class=\"n\">add_submonoid</span><span class=\"bp\">.</span><span class=\"n\">mk</span><span class=\"bp\">.</span><span class=\"n\">inj_eq</span><span class=\"o\">]</span> <span class=\"n\">submonoid</span><span class=\"bp\">.</span><span class=\"n\">mk</span><span class=\"bp\">.</span><span class=\"n\">inj_eq</span>\n<span class=\"n\">attribute</span> <span class=\"o\">[</span><span class=\"n\">to_additive</span> <span class=\"n\">add_submonoid</span><span class=\"bp\">.</span><span class=\"n\">mk</span><span class=\"bp\">.</span><span class=\"n\">sizeof_spec</span><span class=\"o\">]</span> <span class=\"n\">submonoid</span><span class=\"bp\">.</span><span class=\"n\">mk</span><span class=\"bp\">.</span><span class=\"n\">sizeof_spec</span>\n<span class=\"n\">attribute</span> <span class=\"o\">[</span><span class=\"n\">to_additive</span> <span class=\"n\">add_submonoid</span><span class=\"bp\">.</span><span class=\"n\">add_mem&#39;</span><span class=\"o\">]</span> <span class=\"n\">submonoid</span><span class=\"bp\">.</span><span class=\"n\">mul_mem&#39;</span>\n<span class=\"n\">attribute</span> <span class=\"o\">[</span><span class=\"n\">to_additive</span> <span class=\"n\">add_submonoid</span><span class=\"bp\">.</span><span class=\"n\">no_confusion</span><span class=\"o\">]</span> <span class=\"n\">submonoid</span><span class=\"bp\">.</span><span class=\"n\">no_confusion</span>\n<span class=\"n\">attribute</span> <span class=\"o\">[</span><span class=\"n\">to_additive</span> <span class=\"n\">add_submonoid</span><span class=\"bp\">.</span><span class=\"n\">no_confusion_type</span><span class=\"o\">]</span> <span class=\"n\">submonoid</span><span class=\"bp\">.</span><span class=\"n\">no_confusion_type</span>\n<span class=\"n\">attribute</span> <span class=\"o\">[</span><span class=\"n\">to_additive</span> <span class=\"n\">add_submonoid</span><span class=\"bp\">.</span><span class=\"n\">zero_mem&#39;</span><span class=\"o\">]</span> <span class=\"n\">submonoid</span><span class=\"bp\">.</span><span class=\"n\">one_mem&#39;</span>\n<span class=\"n\">attribute</span> <span class=\"o\">[</span><span class=\"n\">to_additive</span> <span class=\"n\">add_submonoid</span><span class=\"bp\">.</span><span class=\"n\">rec</span><span class=\"o\">]</span> <span class=\"n\">submonoid</span><span class=\"bp\">.</span><span class=\"n\">rec</span>\n<span class=\"n\">attribute</span> <span class=\"o\">[</span><span class=\"n\">to_additive</span> <span class=\"n\">add_submonoid</span><span class=\"bp\">.</span><span class=\"n\">rec_on</span><span class=\"o\">]</span> <span class=\"n\">submonoid</span><span class=\"bp\">.</span><span class=\"n\">rec_on</span>\n<span class=\"n\">attribute</span> <span class=\"o\">[</span><span class=\"n\">to_additive</span> <span class=\"n\">add_submonoid</span><span class=\"bp\">.</span><span class=\"n\">sizeof</span><span class=\"o\">]</span> <span class=\"n\">submonoid</span><span class=\"bp\">.</span><span class=\"n\">sizeof</span>\n</pre></div>",
        "id": 172847490,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1565354505
    },
    {
        "content": "<p>I have been doing this extremely anally, trying to get the system to work.</p>",
        "id": 172847495,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1565354521
    },
    {
        "content": "<p>I have tagged things which will never ever be used.</p>",
        "id": 172847547,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1565354535
    },
    {
        "content": "<p>Oh, I see, you have to do an after the fact annotation</p>",
        "id": 172847606,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1565354575
    },
    {
        "content": "<p>like this one</p>\n<div class=\"codehilite\"><pre><span></span><span class=\"n\">def</span> <span class=\"n\">left_rel</span> <span class=\"o\">[</span><span class=\"n\">group</span> <span class=\"n\">α</span><span class=\"o\">]</span> <span class=\"o\">(</span><span class=\"n\">s</span> <span class=\"o\">:</span> <span class=\"n\">set</span> <span class=\"n\">α</span><span class=\"o\">)</span> <span class=\"o\">[</span><span class=\"n\">is_subgroup</span> <span class=\"n\">s</span><span class=\"o\">]</span> <span class=\"o\">:</span> <span class=\"n\">setoid</span> <span class=\"n\">α</span> <span class=\"o\">:=</span>\n<span class=\"bp\">⟨λ</span> <span class=\"n\">x</span> <span class=\"n\">y</span><span class=\"o\">,</span> <span class=\"n\">x</span><span class=\"bp\">⁻¹</span> <span class=\"bp\">*</span> <span class=\"n\">y</span> <span class=\"err\">∈</span> <span class=\"n\">s</span><span class=\"o\">,</span>\n  <span class=\"k\">assume</span> <span class=\"n\">x</span><span class=\"o\">,</span> <span class=\"k\">by</span> <span class=\"n\">simp</span> <span class=\"o\">[</span><span class=\"n\">is_submonoid</span><span class=\"bp\">.</span><span class=\"n\">one_mem</span><span class=\"o\">],</span>\n  <span class=\"k\">assume</span> <span class=\"n\">x</span> <span class=\"n\">y</span> <span class=\"n\">hxy</span><span class=\"o\">,</span>\n  <span class=\"k\">have</span> <span class=\"o\">(</span><span class=\"n\">x</span><span class=\"bp\">⁻¹</span> <span class=\"bp\">*</span> <span class=\"n\">y</span><span class=\"o\">)</span><span class=\"bp\">⁻¹</span> <span class=\"err\">∈</span> <span class=\"n\">s</span><span class=\"o\">,</span> <span class=\"k\">from</span> <span class=\"n\">is_subgroup</span><span class=\"bp\">.</span><span class=\"n\">inv_mem</span> <span class=\"n\">hxy</span><span class=\"o\">,</span>\n  <span class=\"k\">by</span> <span class=\"n\">simpa</span> <span class=\"kn\">using</span> <span class=\"n\">this</span><span class=\"o\">,</span>\n  <span class=\"k\">assume</span> <span class=\"n\">x</span> <span class=\"n\">y</span> <span class=\"n\">z</span> <span class=\"n\">hxy</span> <span class=\"n\">hyz</span><span class=\"o\">,</span>\n  <span class=\"k\">have</span> <span class=\"n\">x</span><span class=\"bp\">⁻¹</span> <span class=\"bp\">*</span> <span class=\"n\">y</span> <span class=\"bp\">*</span> <span class=\"o\">(</span><span class=\"n\">y</span><span class=\"bp\">⁻¹</span> <span class=\"bp\">*</span> <span class=\"n\">z</span><span class=\"o\">)</span> <span class=\"err\">∈</span> <span class=\"n\">s</span><span class=\"o\">,</span> <span class=\"k\">from</span> <span class=\"n\">is_submonoid</span><span class=\"bp\">.</span><span class=\"n\">mul_mem</span> <span class=\"n\">hxy</span> <span class=\"n\">hyz</span><span class=\"o\">,</span>\n  <span class=\"k\">by</span> <span class=\"n\">simpa</span> <span class=\"o\">[</span><span class=\"n\">mul_assoc</span><span class=\"o\">]</span> <span class=\"kn\">using</span> <span class=\"n\">this</span><span class=\"bp\">⟩</span>\n<span class=\"n\">attribute</span> <span class=\"o\">[</span><span class=\"n\">to_additive</span> <span class=\"n\">quotient_add_group</span><span class=\"bp\">.</span><span class=\"n\">left_rel</span><span class=\"bp\">._</span><span class=\"n\">proof_1</span><span class=\"o\">]</span> <span class=\"n\">left_rel</span><span class=\"bp\">._</span><span class=\"n\">proof_1</span>\n<span class=\"n\">attribute</span> <span class=\"o\">[</span><span class=\"n\">to_additive</span> <span class=\"n\">quotient_add_group</span><span class=\"bp\">.</span><span class=\"n\">left_rel</span><span class=\"o\">]</span> <span class=\"n\">left_rel</span>\n<span class=\"n\">attribute</span> <span class=\"o\">[</span><span class=\"n\">to_additive</span> <span class=\"n\">quotient_add_group</span><span class=\"bp\">.</span><span class=\"n\">left_rel</span><span class=\"bp\">.</span><span class=\"n\">equations</span><span class=\"bp\">._</span><span class=\"n\">eqn_1</span><span class=\"o\">]</span> <span class=\"n\">left_rel</span><span class=\"bp\">.</span><span class=\"n\">equations</span><span class=\"bp\">._</span><span class=\"n\">eqn_1</span>\n</pre></div>",
        "id": 172847621,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1565354586
    },
    {
        "content": "<p>But then will the additive version be auto-generated?</p>",
        "id": 172847628,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1565354592
    },
    {
        "content": "<p>yes</p>",
        "id": 172847641,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1565354603
    },
    {
        "content": "<p>you just have to make sure to tag <code>foo._proof_1</code> before you tag <code>foo</code></p>",
        "id": 172847653,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1565354624
    },
    {
        "content": "<p>Why am I being left to discover these things myself? [because nobody wrote the docs I guess]</p>",
        "id": 172847732,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1565354660
    },
    {
        "content": "<p>I agree that tagging new structures is horrible, because lean generates a ton of definitions and doesn't let user code know what it did</p>",
        "id": 172847760,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1565354681
    },
    {
        "content": "<p>I just run <code>#print prefix</code> after everything. I have been writing the code in emacs because I can automate much of the procedure which does all the post hoc tagging.</p>",
        "id": 172847866,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1565354748
    },
    {
        "content": "<p>But it's still a pain.</p>",
        "id": 172847870,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1565354752
    },
    {
        "content": "<p>I tried setting up <code>to_additive</code> so that it would copy everything in the namespace, but this turns out to be really slow because there is no index for that so you have to basically go through every definition in the environment to find which ones were added just a few lines ago</p>",
        "id": 172847937,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1565354778
    },
    {
        "content": "<p>basically we're painted into a corner by lean 3</p>",
        "id": 172847963,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1565354803
    },
    {
        "content": "<p>Is it slower than a human copying everything in the namespace?</p>",
        "id": 172847977,
        "sender_full_name": "Chris Hughes",
        "timestamp": 1565354819
    },
    {
        "content": "<p>Ha ha!</p>",
        "id": 172847984,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1565354826
    },
    {
        "content": "<p>we might be able to do it with a hole command?</p>",
        "id": 172847988,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1565354842
    },
    {
        "content": "<p>[gets back to tagging]</p>",
        "id": 172848002,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1565354856
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span><span class=\"c\">/-</span><span class=\"cm\">- `univ` is the submonoid M of the monoid M -/</span>\n<span class=\"n\">def</span> <span class=\"n\">univ</span> <span class=\"o\">:</span> <span class=\"n\">submonoid</span> <span class=\"n\">M</span> <span class=\"o\">:=</span>\n<span class=\"o\">{</span> <span class=\"n\">carrier</span> <span class=\"o\">:=</span> <span class=\"n\">set</span><span class=\"bp\">.</span><span class=\"n\">univ</span><span class=\"o\">,</span>\n  <span class=\"n\">one_mem&#39;</span> <span class=\"o\">:=</span> <span class=\"n\">set</span><span class=\"bp\">.</span><span class=\"n\">mem_univ</span> <span class=\"mi\">1</span><span class=\"o\">,</span>\n  <span class=\"n\">mul_mem&#39;</span> <span class=\"o\">:=</span> <span class=\"bp\">λ</span> <span class=\"bp\">_</span> <span class=\"bp\">_</span> <span class=\"bp\">_</span> <span class=\"bp\">_</span><span class=\"o\">,</span> <span class=\"n\">set</span><span class=\"bp\">.</span><span class=\"n\">mem_univ</span> <span class=\"bp\">_</span> <span class=\"o\">}</span>\n<span class=\"n\">attribute</span> <span class=\"o\">[</span><span class=\"n\">to_additive</span> <span class=\"n\">add_submonoid</span><span class=\"bp\">.</span><span class=\"n\">univ</span><span class=\"bp\">._</span><span class=\"n\">proof_1</span><span class=\"o\">]</span> <span class=\"n\">submonoid</span><span class=\"bp\">.</span><span class=\"n\">univ</span><span class=\"bp\">._</span><span class=\"n\">proof_1</span>\n<span class=\"n\">attribute</span> <span class=\"o\">[</span><span class=\"n\">to_additive</span> <span class=\"n\">add_submonoid</span><span class=\"bp\">.</span><span class=\"n\">univ</span><span class=\"bp\">._</span><span class=\"n\">proof_2</span><span class=\"o\">]</span> <span class=\"n\">submonoid</span><span class=\"bp\">.</span><span class=\"n\">univ</span><span class=\"bp\">._</span><span class=\"n\">proof_2</span>\n<span class=\"n\">attribute</span> <span class=\"o\">[</span><span class=\"n\">to_additive</span> <span class=\"n\">add_submonoid</span><span class=\"bp\">.</span><span class=\"n\">univ</span><span class=\"o\">]</span> <span class=\"n\">submonoid</span><span class=\"bp\">.</span><span class=\"n\">univ</span>\n<span class=\"n\">attribute</span> <span class=\"o\">[</span><span class=\"n\">to_additive</span> <span class=\"n\">add_submonoid</span><span class=\"bp\">.</span><span class=\"n\">univ</span><span class=\"bp\">.</span><span class=\"n\">equations</span><span class=\"bp\">._</span><span class=\"n\">eqn_1</span><span class=\"o\">]</span> <span class=\"n\">submonoid</span><span class=\"bp\">.</span><span class=\"n\">univ</span><span class=\"bp\">.</span><span class=\"n\">equations</span><span class=\"bp\">._</span><span class=\"n\">eqn_1</span>\n</pre></div>\n\n\n<p>So this does work and the additive version is indeed auto-generated; I hadn't understood that I could do that after the fact. Now how do I do the docstring?</p>",
        "id": 172848280,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1565355105
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span><span class=\"bp\">#</span><span class=\"kn\">check</span> <span class=\"n\">submonoid</span><span class=\"bp\">.</span><span class=\"n\">univ</span> <span class=\"c1\">-- hover to see docstring</span>\n<span class=\"bp\">#</span><span class=\"kn\">check</span> <span class=\"n\">add_submonoid</span><span class=\"bp\">.</span><span class=\"n\">univ</span> <span class=\"c1\">-- works but no docstring</span>\n</pre></div>",
        "id": 172848431,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1565355226
    },
    {
        "content": "<p>[The point here is that the attributes have to be set in the right order]</p>",
        "id": 172848534,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1565355301
    },
    {
        "content": "<p>Before:</p>\n<div class=\"codehilite\"><pre><span></span><span class=\"n\">attribute</span> <span class=\"o\">[</span><span class=\"n\">to_additive</span> <span class=\"n\">add_submonoid</span><span class=\"bp\">.</span><span class=\"n\">Union_of_directed</span><span class=\"o\">]</span> <span class=\"n\">submonoid</span><span class=\"bp\">.</span><span class=\"n\">Union_of_directed</span>\n<span class=\"n\">attribute</span> <span class=\"o\">[</span><span class=\"n\">to_additive</span> <span class=\"n\">add_submonoid</span><span class=\"bp\">.</span><span class=\"n\">Union_of_directed</span><span class=\"bp\">._</span><span class=\"n\">match_1</span><span class=\"o\">]</span> <span class=\"n\">submonoid</span><span class=\"bp\">.</span><span class=\"n\">Union_of_directed</span><span class=\"bp\">._</span><span class=\"n\">match_1</span>\n<span class=\"n\">attribute</span> <span class=\"o\">[</span><span class=\"n\">to_additive</span> <span class=\"n\">add_submonoid</span><span class=\"bp\">.</span><span class=\"n\">Union_of_directed</span><span class=\"bp\">._</span><span class=\"n\">match_1</span><span class=\"bp\">.</span><span class=\"n\">equations</span><span class=\"bp\">._</span><span class=\"n\">eqn_1</span><span class=\"o\">]</span> <span class=\"n\">submonoid</span><span class=\"bp\">.</span><span class=\"n\">Union_of_directed</span><span class=\"bp\">._</span><span class=\"n\">match_1</span><span class=\"bp\">.</span><span class=\"n\">equations</span><span class=\"bp\">._</span><span class=\"n\">eqn_1</span>\n<span class=\"n\">attribute</span> <span class=\"o\">[</span><span class=\"n\">to_additive</span> <span class=\"n\">add_submonoid</span><span class=\"bp\">.</span><span class=\"n\">Union_of_directed</span><span class=\"bp\">._</span><span class=\"n\">match_2</span><span class=\"o\">]</span> <span class=\"n\">submonoid</span><span class=\"bp\">.</span><span class=\"n\">Union_of_directed</span><span class=\"bp\">._</span><span class=\"n\">match_2</span>\n<span class=\"n\">attribute</span> <span class=\"o\">[</span><span class=\"n\">to_additive</span> <span class=\"n\">add_submonoid</span><span class=\"bp\">.</span><span class=\"n\">Union_of_directed</span><span class=\"bp\">._</span><span class=\"n\">match_2</span><span class=\"bp\">.</span><span class=\"n\">equations</span><span class=\"bp\">._</span><span class=\"n\">eqn_1</span><span class=\"o\">]</span> <span class=\"n\">submonoid</span><span class=\"bp\">.</span><span class=\"n\">Union_of_directed</span><span class=\"bp\">._</span><span class=\"n\">match_2</span><span class=\"bp\">.</span><span class=\"n\">equations</span><span class=\"bp\">._</span><span class=\"n\">eqn_1</span>\n<span class=\"n\">attribute</span> <span class=\"o\">[</span><span class=\"n\">to_additive</span> <span class=\"n\">add_submonoid</span><span class=\"bp\">.</span><span class=\"n\">Union_of_directed</span><span class=\"bp\">._</span><span class=\"n\">match_3</span><span class=\"o\">]</span> <span class=\"n\">submonoid</span><span class=\"bp\">.</span><span class=\"n\">Union_of_directed</span><span class=\"bp\">._</span><span class=\"n\">match_3</span>\n<span class=\"n\">attribute</span> <span class=\"o\">[</span><span class=\"n\">to_additive</span> <span class=\"n\">add_submonoid</span><span class=\"bp\">.</span><span class=\"n\">Union_of_directed</span><span class=\"bp\">._</span><span class=\"n\">match_3</span><span class=\"bp\">.</span><span class=\"n\">equations</span><span class=\"bp\">._</span><span class=\"n\">eqn_1</span><span class=\"o\">]</span> <span class=\"n\">submonoid</span><span class=\"bp\">.</span><span class=\"n\">Union_of_directed</span><span class=\"bp\">._</span><span class=\"n\">match_3</span><span class=\"bp\">.</span><span class=\"n\">equations</span><span class=\"bp\">._</span><span class=\"n\">eqn_1</span>\n<span class=\"n\">attribute</span> <span class=\"o\">[</span><span class=\"n\">to_additive</span> <span class=\"n\">add_submonoid</span><span class=\"bp\">.</span><span class=\"n\">Union_of_directed</span><span class=\"bp\">._</span><span class=\"n\">match_4</span><span class=\"o\">]</span> <span class=\"n\">submonoid</span><span class=\"bp\">.</span><span class=\"n\">Union_of_directed</span><span class=\"bp\">._</span><span class=\"n\">match_4</span>\n<span class=\"n\">attribute</span> <span class=\"o\">[</span><span class=\"n\">to_additive</span> <span class=\"n\">add_submonoid</span><span class=\"bp\">.</span><span class=\"n\">Union_of_directed</span><span class=\"bp\">._</span><span class=\"n\">match_4</span><span class=\"bp\">.</span><span class=\"n\">equations</span><span class=\"bp\">._</span><span class=\"n\">eqn_1</span><span class=\"o\">]</span> <span class=\"n\">submonoid</span><span class=\"bp\">.</span><span class=\"n\">Union_of_directed</span><span class=\"bp\">._</span><span class=\"n\">match_4</span><span class=\"bp\">.</span><span class=\"n\">equations</span><span class=\"bp\">._</span><span class=\"n\">eqn_1</span>\n<span class=\"n\">attribute</span> <span class=\"o\">[</span><span class=\"n\">to_additive</span> <span class=\"n\">add_submonoid</span><span class=\"bp\">.</span><span class=\"n\">Union_of_directed</span><span class=\"bp\">._</span><span class=\"n\">proof_1</span><span class=\"o\">]</span> <span class=\"n\">submonoid</span><span class=\"bp\">.</span><span class=\"n\">Union_of_directed</span><span class=\"bp\">._</span><span class=\"n\">proof_1</span>\n<span class=\"n\">attribute</span> <span class=\"o\">[</span><span class=\"n\">to_additive</span> <span class=\"n\">add_submonoid</span><span class=\"bp\">.</span><span class=\"n\">Union_of_directed</span><span class=\"bp\">.</span><span class=\"n\">equations</span><span class=\"bp\">._</span><span class=\"n\">eqn_1</span><span class=\"o\">]</span> <span class=\"n\">submonoid</span><span class=\"bp\">.</span><span class=\"n\">Union_of_directed</span><span class=\"bp\">.</span><span class=\"n\">equations</span><span class=\"bp\">._</span><span class=\"n\">eqn_1</span>\n</pre></div>\n\n\n<p>(auto-generated by emacs, with added errors)</p>",
        "id": 172849072,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1565355734
    },
    {
        "content": "<p>That requires modifying the <code>to_additive</code> code. If you want to write a docstring rather than have an autogenerated one, there is some <code>run_cmd</code> thing you can do</p>",
        "id": 172849094,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1565355770
    },
    {
        "content": "<p>Yeah I'm happy to do the run_cmd. It's been mentioned before. In some sense I am trying to write a \"best practice\" to_additive thing here. I've noticed looking through other people's code in mathlib that there are others who don't know all the tricks either.</p>",
        "id": 172849145,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1565355826
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span><span class=\"n\">def</span> <span class=\"n\">foo</span> <span class=\"o\">:=</span> <span class=\"bp\">ℕ</span>\n\n<span class=\"n\">run_cmd</span> <span class=\"n\">tactic</span><span class=\"bp\">.</span><span class=\"n\">add_doc_string</span> <span class=\"bp\">`</span><span class=\"n\">foo</span> <span class=\"s2\">&quot;*This* is a docstring for `foo`.&quot;</span>\n\n<span class=\"bp\">#</span><span class=\"kn\">print</span> <span class=\"n\">foo</span>\n</pre></div>",
        "id": 172849237,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1565355878
    },
    {
        "content": "<p>Thanks. I think that's everything.</p>",
        "id": 172849250,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1565355893
    },
    {
        "content": "<p>Thanks a lot, in fact.</p>",
        "id": 172849258,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1565355902
    },
    {
        "content": "<p>After:</p>\n<div class=\"codehilite\"><pre><span></span><span class=\"n\">attribute</span> <span class=\"o\">[</span><span class=\"n\">to_additive</span> <span class=\"n\">add_submonoid</span><span class=\"bp\">.</span><span class=\"n\">Union_of_directed</span><span class=\"bp\">._</span><span class=\"n\">match_1</span><span class=\"o\">]</span> <span class=\"n\">submonoid</span><span class=\"bp\">.</span><span class=\"n\">Union_of_directed</span><span class=\"bp\">._</span><span class=\"n\">match_1</span>\n<span class=\"n\">attribute</span> <span class=\"o\">[</span><span class=\"n\">to_additive</span> <span class=\"n\">add_submonoid</span><span class=\"bp\">.</span><span class=\"n\">Union_of_directed</span><span class=\"bp\">._</span><span class=\"n\">match_2</span><span class=\"o\">]</span> <span class=\"n\">submonoid</span><span class=\"bp\">.</span><span class=\"n\">Union_of_directed</span><span class=\"bp\">._</span><span class=\"n\">match_2</span>\n<span class=\"n\">attribute</span> <span class=\"o\">[</span><span class=\"n\">to_additive</span> <span class=\"n\">add_submonoid</span><span class=\"bp\">.</span><span class=\"n\">Union_of_directed</span><span class=\"bp\">._</span><span class=\"n\">match_3</span><span class=\"o\">]</span> <span class=\"n\">submonoid</span><span class=\"bp\">.</span><span class=\"n\">Union_of_directed</span><span class=\"bp\">._</span><span class=\"n\">match_3</span>\n<span class=\"n\">attribute</span> <span class=\"o\">[</span><span class=\"n\">to_additive</span> <span class=\"n\">add_submonoid</span><span class=\"bp\">.</span><span class=\"n\">Union_of_directed</span><span class=\"bp\">._</span><span class=\"n\">match_4</span><span class=\"o\">]</span> <span class=\"n\">submonoid</span><span class=\"bp\">.</span><span class=\"n\">Union_of_directed</span><span class=\"bp\">._</span><span class=\"n\">match_4</span>\n<span class=\"n\">attribute</span> <span class=\"o\">[</span><span class=\"n\">to_additive</span> <span class=\"n\">add_submonoid</span><span class=\"bp\">.</span><span class=\"n\">Union_of_directed</span><span class=\"bp\">._</span><span class=\"n\">proof_1</span><span class=\"o\">]</span> <span class=\"n\">submonoid</span><span class=\"bp\">.</span><span class=\"n\">Union_of_directed</span><span class=\"bp\">._</span><span class=\"n\">proof_1</span>\n<span class=\"n\">attribute</span> <span class=\"o\">[</span><span class=\"n\">to_additive</span> <span class=\"n\">add_submonoid</span><span class=\"bp\">.</span><span class=\"n\">Union_of_directed</span><span class=\"o\">]</span> <span class=\"n\">submonoid</span><span class=\"bp\">.</span><span class=\"n\">Union_of_directed</span>\n<span class=\"n\">attribute</span> <span class=\"o\">[</span><span class=\"n\">to_additive</span> <span class=\"n\">add_submonoid</span><span class=\"bp\">.</span><span class=\"n\">Union_of_directed</span><span class=\"bp\">._</span><span class=\"n\">match_1</span><span class=\"bp\">.</span><span class=\"n\">equations</span><span class=\"bp\">._</span><span class=\"n\">eqn_1</span><span class=\"o\">]</span> <span class=\"n\">submonoid</span><span class=\"bp\">.</span><span class=\"n\">Union_of_directed</span><span class=\"bp\">._</span><span class=\"n\">match_1</span><span class=\"bp\">.</span><span class=\"n\">equations</span><span class=\"bp\">._</span><span class=\"n\">eqn_1</span>\n<span class=\"n\">attribute</span> <span class=\"o\">[</span><span class=\"n\">to_additive</span> <span class=\"n\">add_submonoid</span><span class=\"bp\">.</span><span class=\"n\">Union_of_directed</span><span class=\"bp\">._</span><span class=\"n\">match_2</span><span class=\"bp\">.</span><span class=\"n\">equations</span><span class=\"bp\">._</span><span class=\"n\">eqn_1</span><span class=\"o\">]</span> <span class=\"n\">submonoid</span><span class=\"bp\">.</span><span class=\"n\">Union_of_directed</span><span class=\"bp\">._</span><span class=\"n\">match_2</span><span class=\"bp\">.</span><span class=\"n\">equations</span><span class=\"bp\">._</span><span class=\"n\">eqn_1</span>\n<span class=\"n\">attribute</span> <span class=\"o\">[</span><span class=\"n\">to_additive</span> <span class=\"n\">add_submonoid</span><span class=\"bp\">.</span><span class=\"n\">Union_of_directed</span><span class=\"bp\">._</span><span class=\"n\">match_3</span><span class=\"bp\">.</span><span class=\"n\">equations</span><span class=\"bp\">._</span><span class=\"n\">eqn_1</span><span class=\"o\">]</span> <span class=\"n\">submonoid</span><span class=\"bp\">.</span><span class=\"n\">Union_of_directed</span><span class=\"bp\">._</span><span class=\"n\">match_3</span><span class=\"bp\">.</span><span class=\"n\">equations</span><span class=\"bp\">._</span><span class=\"n\">eqn_1</span>\n<span class=\"n\">attribute</span> <span class=\"o\">[</span><span class=\"n\">to_additive</span> <span class=\"n\">add_submonoid</span><span class=\"bp\">.</span><span class=\"n\">Union_of_directed</span><span class=\"bp\">._</span><span class=\"n\">match_4</span><span class=\"bp\">.</span><span class=\"n\">equations</span><span class=\"bp\">._</span><span class=\"n\">eqn_1</span><span class=\"o\">]</span> <span class=\"n\">submonoid</span><span class=\"bp\">.</span><span class=\"n\">Union_of_directed</span><span class=\"bp\">._</span><span class=\"n\">match_4</span><span class=\"bp\">.</span><span class=\"n\">equations</span><span class=\"bp\">._</span><span class=\"n\">eqn_1</span>\n<span class=\"n\">attribute</span> <span class=\"o\">[</span><span class=\"n\">to_additive</span> <span class=\"n\">add_submonoid</span><span class=\"bp\">.</span><span class=\"n\">Union_of_directed</span><span class=\"bp\">.</span><span class=\"n\">equations</span><span class=\"bp\">._</span><span class=\"n\">eqn_1</span><span class=\"o\">]</span> <span class=\"n\">submonoid</span><span class=\"bp\">.</span><span class=\"n\">Union_of_directed</span><span class=\"bp\">.</span><span class=\"n\">equations</span><span class=\"bp\">._</span><span class=\"n\">eqn_1</span>\n</pre></div>\n\n\n<p>You just keep looking at the first error, see what Lean is complaining about, find the corresponding line and then move it above where the error was. I cannot guarantee that this terminates in general but it's just terminated for this complicated lemma so that's a positive sign.</p>",
        "id": 172849395,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1565356042
    },
    {
        "content": "<p>I will remark that whilst the answer clearly has some structure, the moves taken to get there were match 1, match 4, proof 1, match 3, match 2 (or something -- I'm doing this from memory; it works now and I'm not going back)</p>",
        "id": 172849490,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1565356114
    },
    {
        "content": "<p>Oh cool, you can really confuse VS Code by editing an open file in emacs ;-)</p>",
        "id": 172849630,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1565356218
    },
    {
        "content": "<p>dammit now I'm back to doing emacs command line shortcuts in VS Code :-/ It took me months to shake this off the first time around...</p>",
        "id": 172849924,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1565356457
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span><span class=\"n\">attribute</span> <span class=\"o\">[</span><span class=\"n\">to_additive</span> <span class=\"n\">add_monoid</span><span class=\"bp\">.</span><span class=\"n\">mul</span><span class=\"bp\">._</span><span class=\"n\">main</span><span class=\"o\">]</span> <span class=\"n\">monoid</span><span class=\"bp\">.</span><span class=\"n\">pow</span><span class=\"bp\">._</span><span class=\"n\">main</span>\n<span class=\"n\">attribute</span> <span class=\"o\">[</span><span class=\"n\">to_additive</span> <span class=\"n\">add_monoid</span><span class=\"bp\">.</span><span class=\"n\">mul</span><span class=\"o\">]</span> <span class=\"n\">monoid</span><span class=\"bp\">.</span><span class=\"n\">pow</span>\n<span class=\"n\">attribute</span> <span class=\"o\">[</span><span class=\"n\">to_additive</span> <span class=\"n\">add_monoid</span><span class=\"bp\">.</span><span class=\"n\">has_mul</span><span class=\"o\">]</span> <span class=\"n\">monoid</span><span class=\"bp\">.</span><span class=\"n\">has_pow</span>\n<span class=\"n\">attribute</span> <span class=\"o\">[</span><span class=\"n\">to_additive</span> <span class=\"n\">multiples</span><span class=\"bp\">._</span><span class=\"n\">proof_1</span><span class=\"o\">]</span> <span class=\"n\">powers</span><span class=\"bp\">._</span><span class=\"n\">proof_1</span>\n<span class=\"n\">attribute</span> <span class=\"o\">[</span><span class=\"n\">to_additive</span> <span class=\"n\">multiples</span><span class=\"bp\">._</span><span class=\"n\">proof_2</span><span class=\"o\">]</span> <span class=\"n\">powers</span><span class=\"bp\">._</span><span class=\"n\">proof_2</span>\n</pre></div>\n\n\n<p>Thanks a bunch, other people.</p>",
        "id": 172851111,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1565357360
    },
    {
        "content": "<p>I'm quite getting into this :-) Someone could write a script to figure out which attributes are missing. There's just some dictionary monoid-&gt;add_monoid, powers-&gt;multiples, mul-&gt;add etc and then you scan every namespace and try and spot what's missing.</p>",
        "id": 172851199,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1565357424
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span><span class=\"bp\">@</span><span class=\"o\">[</span><span class=\"n\">to_additive</span> <span class=\"n\">add_submonoid</span><span class=\"bp\">.</span><span class=\"n\">multiples</span><span class=\"bp\">.</span><span class=\"n\">self_mem</span><span class=\"o\">]</span>\n<span class=\"kn\">lemma</span> <span class=\"n\">powers</span><span class=\"bp\">.</span><span class=\"n\">self_mem</span> <span class=\"o\">{</span><span class=\"n\">x</span> <span class=\"o\">:</span> <span class=\"n\">M</span><span class=\"o\">}</span> <span class=\"o\">:</span> <span class=\"n\">x</span> <span class=\"err\">∈</span> <span class=\"n\">powers</span> <span class=\"n\">x</span> <span class=\"o\">:=</span> <span class=\"bp\">⟨</span><span class=\"mi\">1</span><span class=\"o\">,</span> <span class=\"n\">pow_one</span> <span class=\"bp\">_⟩</span>\n<span class=\"c\">/-</span><span class=\"cm\"></span>\n<span class=\"cm\">type mismatch at application</span>\n<span class=\"cm\">  0</span>\n<span class=\"cm\">term</span>\n<span class=\"cm\">  nat.has_one</span>\n<span class=\"cm\">has type</span>\n<span class=\"cm\">  has_one ℕ</span>\n<span class=\"cm\">but is expected to have type</span>\n<span class=\"cm\">  has_zero ℕ</span>\n<span class=\"cm\">-/</span>\n</pre></div>\n\n\n<p><em>d'oh</em> Lean -- don't change _that_ 1!</p>",
        "id": 172851488,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1565357654
    },
    {
        "content": "<p>This one has me stumped. The algorithm fails, and it is not unreasonable that it fail because how is Lean supposed to know which 1's to change to 0's and which ones not to change? We're proving x^1=x here and I want that translated into 1*x=x for the additive thing but the translation fails. So now I have to write <code>add_monoid.multiples.self_mem</code> myself, but if I don't do it now then maybe the next thing will fail, and if I do do it now then I have to close the namespace, open a new one, set up some variables, prove the lemma, close it and then open the old one. Thank goodness for <code>#where</code> ;-)</p>",
        "id": 172851813,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1565357911
    },
    {
        "content": "<p>See <code>group_power</code> for examples of this</p>",
        "id": 172852264,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1565358250
    },
    {
        "content": "<p>We just don't use <code>to_additive</code> to define the copy in this case</p>",
        "id": 172852286,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1565358274
    },
    {
        "content": "<p>Notice also that <code>x^1</code> and <code>1*x</code> are not even written in the same order, <code>to_additive</code> can't handle that kind of thing</p>",
        "id": 172852352,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1565358343
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span><span class=\"c\">/-</span><span class=\"cm\">- x is in the submonoid generated by x. -/</span>\n<span class=\"kn\">lemma</span> <span class=\"n\">powers</span><span class=\"bp\">.</span><span class=\"n\">self_mem</span> <span class=\"o\">{</span><span class=\"n\">x</span> <span class=\"o\">:</span> <span class=\"n\">M</span><span class=\"o\">}</span> <span class=\"o\">:</span> <span class=\"n\">x</span> <span class=\"err\">∈</span> <span class=\"n\">powers</span> <span class=\"n\">x</span> <span class=\"o\">:=</span> <span class=\"bp\">⟨</span><span class=\"mi\">1</span><span class=\"o\">,</span> <span class=\"n\">pow_one</span> <span class=\"bp\">_⟩</span>\n\n<span class=\"kn\">end</span> <span class=\"n\">submonoid</span>\n\n<span class=\"c\">/-</span><span class=\"cm\">- x is in the add_submonoid generated by x. -/</span>\n<span class=\"kn\">lemma</span> <span class=\"n\">add_submonoid</span><span class=\"bp\">.</span><span class=\"n\">multiples</span><span class=\"bp\">.</span><span class=\"n\">self_mem</span> <span class=\"o\">{</span><span class=\"n\">M</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span> <span class=\"o\">[</span><span class=\"n\">add_monoid</span> <span class=\"n\">M</span><span class=\"o\">]</span> <span class=\"o\">{</span><span class=\"n\">x</span> <span class=\"o\">:</span> <span class=\"n\">M</span><span class=\"o\">}</span> <span class=\"o\">:</span>\n  <span class=\"n\">x</span> <span class=\"err\">∈</span> <span class=\"n\">add_submonoid</span><span class=\"bp\">.</span><span class=\"n\">multiples</span> <span class=\"n\">x</span> <span class=\"o\">:=</span>\n<span class=\"bp\">⟨</span><span class=\"mi\">1</span><span class=\"o\">,</span> <span class=\"n\">add_monoid</span><span class=\"bp\">.</span><span class=\"n\">one_smul</span> <span class=\"n\">x</span><span class=\"bp\">⟩</span>\n\n<span class=\"n\">attribute</span> <span class=\"o\">[</span><span class=\"n\">to_additive</span> <span class=\"n\">add_submonoid</span><span class=\"bp\">.</span><span class=\"n\">multiples</span><span class=\"bp\">.</span><span class=\"n\">self_mem</span><span class=\"o\">]</span> <span class=\"n\">submonoid</span><span class=\"bp\">.</span><span class=\"n\">powers</span><span class=\"bp\">.</span><span class=\"n\">self_mem</span>\n\n<span class=\"kn\">namespace</span> <span class=\"n\">submonoid</span>\n\n<span class=\"kn\">variables</span> <span class=\"o\">{</span><span class=\"n\">M</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span> <span class=\"o\">[</span><span class=\"n\">monoid</span> <span class=\"n\">M</span><span class=\"o\">]</span> <span class=\"o\">(</span><span class=\"n\">S</span> <span class=\"o\">:</span> <span class=\"n\">submonoid</span> <span class=\"n\">M</span><span class=\"o\">)</span>\n</pre></div>\n\n\n<p>[grumble]</p>",
        "id": 172852505,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1565358472
    },
    {
        "content": "<blockquote>\n<p>See <code>group_power</code> for examples of this</p>\n</blockquote>\n<p>Aah -- so it was you who didn't to_additive <code>monoid.has_pow</code>!</p>",
        "id": 172852945,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1565358806
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span><span class=\"kn\">theorem</span> <span class=\"n\">pow_add</span> <span class=\"o\">(</span><span class=\"n\">a</span> <span class=\"o\">:</span> <span class=\"n\">α</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">m</span> <span class=\"n\">n</span> <span class=\"o\">:</span> <span class=\"bp\">ℕ</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">a</span><span class=\"err\">^</span><span class=\"o\">(</span><span class=\"n\">m</span> <span class=\"bp\">+</span> <span class=\"n\">n</span><span class=\"o\">)</span> <span class=\"bp\">=</span> <span class=\"n\">a</span><span class=\"err\">^</span><span class=\"n\">m</span> <span class=\"bp\">*</span> <span class=\"n\">a</span><span class=\"err\">^</span><span class=\"n\">n</span> <span class=\"o\">:=</span>\n<span class=\"k\">by</span> <span class=\"n\">induction</span> <span class=\"n\">n</span> <span class=\"k\">with</span> <span class=\"n\">n</span> <span class=\"n\">ih</span><span class=\"bp\">;</span> <span class=\"o\">[</span><span class=\"n\">rw</span> <span class=\"o\">[</span><span class=\"n\">add_zero</span><span class=\"o\">,</span> <span class=\"n\">pow_zero</span><span class=\"o\">,</span> <span class=\"n\">mul_one</span><span class=\"o\">],</span>\n  <span class=\"n\">rw</span> <span class=\"o\">[</span><span class=\"n\">pow_succ</span><span class=\"o\">,</span> <span class=\"err\">←</span> <span class=\"n\">pow_mul_comm&#39;</span><span class=\"o\">,</span> <span class=\"err\">←</span> <span class=\"n\">mul_assoc</span><span class=\"o\">,</span> <span class=\"err\">←</span> <span class=\"n\">ih</span><span class=\"o\">,</span> <span class=\"err\">←</span> <span class=\"n\">pow_succ&#39;</span><span class=\"o\">]]</span><span class=\"bp\">;</span> <span class=\"n\">refl</span>\n<span class=\"kn\">theorem</span> <span class=\"n\">add_monoid</span><span class=\"bp\">.</span><span class=\"n\">add_smul</span> <span class=\"o\">:</span> <span class=\"bp\">∀</span> <span class=\"o\">(</span><span class=\"n\">a</span> <span class=\"o\">:</span> <span class=\"n\">β</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">m</span> <span class=\"n\">n</span> <span class=\"o\">:</span> <span class=\"bp\">ℕ</span><span class=\"o\">),</span> <span class=\"o\">(</span><span class=\"n\">m</span> <span class=\"bp\">+</span> <span class=\"n\">n</span><span class=\"o\">)</span><span class=\"err\">•</span><span class=\"n\">a</span> <span class=\"bp\">=</span> <span class=\"n\">m</span><span class=\"err\">•</span><span class=\"n\">a</span> <span class=\"bp\">+</span> <span class=\"n\">n</span><span class=\"err\">•</span><span class=\"n\">a</span> <span class=\"o\">:=</span>\n<span class=\"bp\">@</span><span class=\"n\">pow_add</span> <span class=\"o\">(</span><span class=\"n\">multiplicative</span> <span class=\"n\">β</span><span class=\"o\">)</span> <span class=\"bp\">_</span>\n<span class=\"n\">attribute</span> <span class=\"o\">[</span><span class=\"n\">to_additive</span> <span class=\"n\">add_monoid</span><span class=\"bp\">.</span><span class=\"n\">add_smul</span><span class=\"o\">]</span> <span class=\"n\">pow_add</span>\n</pre></div>\n\n\n<p>Aah I see. So the point is that you just try and port the proofs using <code>multiplicative</code> in this case.</p>",
        "id": 172853047,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1565358891
    }
]