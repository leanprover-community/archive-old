[
    {
        "content": "<p>Preparing some number theory for my course, and experimenting to try and figure out which of the four ways <code>n \\| b - c</code>, <code>b \\== c [ZMOD n]</code>, <code>b % n = c % n</code> and <code>(b : zmod n) = c</code> is most convenient to use in practice when b,c are integers and n is a natural (often coerced to an integer). I ran into the below though: is this a bug in <code>calc</code>?</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kn\">import</span> <span class=\"n\">data.int.modeq</span>\n\n<span class=\"c1\">-- typechecks</span>\n<span class=\"kd\">example</span> <span class=\"o\">(</span><span class=\"n\">m</span> <span class=\"o\">:</span> <span class=\"n\">ℤ</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"mi\">4</span> <span class=\"bp\">*</span> <span class=\"n\">m</span> <span class=\"bp\">+</span> <span class=\"mi\">3</span> <span class=\"bp\">≡</span> <span class=\"mi\">7</span> <span class=\"o\">[</span><span class=\"n\">ZMOD</span> <span class=\"mi\">4</span><span class=\"o\">]</span> <span class=\"o\">:=</span>\n<span class=\"k\">calc</span>\n<span class=\"mi\">4</span> <span class=\"bp\">*</span> <span class=\"n\">m</span> <span class=\"bp\">+</span> <span class=\"mi\">3</span> <span class=\"bp\">≡</span> <span class=\"mi\">3</span>         <span class=\"o\">[</span><span class=\"n\">ZMOD</span> <span class=\"mi\">4</span><span class=\"o\">]</span> <span class=\"o\">:</span> <span class=\"gr\">sorry</span>\n<span class=\"bp\">...</span>       <span class=\"bp\">≡</span> <span class=\"mi\">7</span>         <span class=\"o\">[</span><span class=\"n\">ZMOD</span> <span class=\"mi\">4</span><span class=\"o\">]</span> <span class=\"o\">:</span> <span class=\"gr\">sorry</span>\n\n<span class=\"c1\">-- fails to typecheck</span>\n<span class=\"c1\">-- goal at first sorry is `4 * m + 3 ≡ 3 [ZMOD ?m_1]`</span>\n<span class=\"kd\">example</span> <span class=\"o\">(</span><span class=\"n\">m</span> <span class=\"o\">:</span> <span class=\"n\">ℤ</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"mi\">4</span> <span class=\"bp\">*</span> <span class=\"n\">m</span> <span class=\"bp\">+</span> <span class=\"mi\">3</span> <span class=\"bp\">≡</span> <span class=\"mi\">7</span> <span class=\"o\">[</span><span class=\"n\">ZMOD</span> <span class=\"mi\">4</span><span class=\"o\">]</span> <span class=\"o\">:=</span>\n<span class=\"k\">calc</span>\n<span class=\"mi\">4</span> <span class=\"bp\">*</span> <span class=\"n\">m</span> <span class=\"bp\">+</span> <span class=\"mi\">3</span> <span class=\"bp\">≡</span> <span class=\"mi\">3</span>         <span class=\"o\">[</span><span class=\"n\">ZMOD</span> <span class=\"mi\">4</span><span class=\"o\">]</span> <span class=\"o\">:</span> <span class=\"kd\">by</span> <span class=\"o\">{</span> <span class=\"gr\">sorry</span> <span class=\"o\">}</span> <span class=\"c1\">-- tactic failed, result contains meta-variables</span>\n<span class=\"bp\">...</span>       <span class=\"bp\">≡</span> <span class=\"mi\">7</span>         <span class=\"o\">[</span><span class=\"n\">ZMOD</span> <span class=\"mi\">4</span><span class=\"o\">]</span> <span class=\"o\">:</span> <span class=\"kd\">by</span> <span class=\"o\">{</span> <span class=\"gr\">sorry</span> <span class=\"o\">}</span>\n\n<span class=\"c1\">-- typechecks</span>\n<span class=\"kd\">example</span> <span class=\"o\">(</span><span class=\"n\">m</span> <span class=\"o\">:</span> <span class=\"n\">ℤ</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"mi\">4</span> <span class=\"bp\">*</span> <span class=\"n\">m</span> <span class=\"bp\">+</span> <span class=\"mi\">3</span> <span class=\"bp\">≡</span> <span class=\"mi\">7</span> <span class=\"o\">[</span><span class=\"n\">ZMOD</span> <span class=\"mi\">4</span><span class=\"o\">]</span> <span class=\"o\">:=</span>\n<span class=\"k\">calc</span>\n<span class=\"mi\">4</span> <span class=\"bp\">*</span> <span class=\"n\">m</span> <span class=\"bp\">+</span> <span class=\"mi\">3</span> <span class=\"bp\">≡</span> <span class=\"mi\">3</span>         <span class=\"o\">[</span><span class=\"n\">ZMOD</span> <span class=\"mi\">4</span><span class=\"o\">]</span> <span class=\"o\">:</span> <span class=\"kd\">by</span> <span class=\"o\">{</span> <span class=\"k\">show</span> <span class=\"n\">_</span> <span class=\"bp\">≡</span> <span class=\"n\">_</span> <span class=\"o\">[</span><span class=\"n\">ZMOD</span> <span class=\"mi\">4</span><span class=\"o\">],</span> <span class=\"gr\">sorry</span> <span class=\"o\">}</span>\n<span class=\"bp\">...</span>       <span class=\"bp\">≡</span> <span class=\"mi\">7</span>         <span class=\"o\">[</span><span class=\"n\">ZMOD</span> <span class=\"mi\">4</span><span class=\"o\">]</span> <span class=\"o\">:</span> <span class=\"kd\">by</span> <span class=\"o\">{</span> <span class=\"gr\">sorry</span> <span class=\"o\">}</span>\n\n<span class=\"c1\">-- typechecks, but change either `: sorry` to `: by sorry`</span>\n<span class=\"c1\">-- and it fails</span>\n<span class=\"kd\">example</span> <span class=\"o\">(</span><span class=\"n\">m</span> <span class=\"n\">n</span> <span class=\"o\">:</span> <span class=\"n\">ℤ</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"mi\">4</span> <span class=\"bp\">*</span> <span class=\"n\">m</span> <span class=\"bp\">+</span> <span class=\"mi\">3</span> <span class=\"bp\">≡</span> <span class=\"mi\">8</span> <span class=\"bp\">*</span> <span class=\"n\">n</span> <span class=\"bp\">+</span> <span class=\"mi\">7</span> <span class=\"o\">[</span><span class=\"n\">ZMOD</span> <span class=\"mi\">4</span><span class=\"o\">]</span> <span class=\"o\">:=</span>\n<span class=\"k\">calc</span>\n<span class=\"mi\">4</span> <span class=\"bp\">*</span> <span class=\"n\">m</span> <span class=\"bp\">+</span> <span class=\"mi\">3</span> <span class=\"bp\">≡</span> <span class=\"mi\">3</span>         <span class=\"o\">[</span><span class=\"n\">ZMOD</span> <span class=\"mi\">4</span><span class=\"o\">]</span> <span class=\"o\">:</span> <span class=\"gr\">sorry</span>\n<span class=\"bp\">...</span>       <span class=\"bp\">≡</span> <span class=\"mi\">7</span>         <span class=\"o\">[</span><span class=\"n\">ZMOD</span> <span class=\"mi\">4</span><span class=\"o\">]</span> <span class=\"o\">:</span> <span class=\"kd\">by</span> <span class=\"gr\">sorry</span>\n<span class=\"bp\">...</span>       <span class=\"bp\">≡</span> <span class=\"mi\">8</span> <span class=\"bp\">*</span> <span class=\"n\">n</span> <span class=\"bp\">+</span> <span class=\"mi\">7</span> <span class=\"o\">[</span><span class=\"n\">ZMOD</span> <span class=\"mi\">4</span><span class=\"o\">]</span> <span class=\"o\">:</span> <span class=\"gr\">sorry</span>\n</code></pre></div>",
        "id": 272408274,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1645194660
    }
]