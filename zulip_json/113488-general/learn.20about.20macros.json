[
    {
        "content": "<p>Hi everyone,</p>\n<p>I've heard about macros in Lean, but I don't exactly know what they are or how they work, except that you can assimilate them with various trust levels. They are not mentioned in the lean tutorial, so what would be a good place to read about them?</p>",
        "id": 168304858,
        "sender_full_name": "Paul-Nicolas Madelaine",
        "timestamp": 1560774016
    },
    {
        "content": "<p>To build macros, you really have to work inside Lean itself. It's not really exposed to meta programming</p>",
        "id": 168315412,
        "sender_full_name": "Simon Hudon",
        "timestamp": 1560782017
    },
    {
        "content": "<p>What application do you have in mind?</p>",
        "id": 168315432,
        "sender_full_name": "Simon Hudon",
        "timestamp": 1560782036
    },
    {
        "content": "<p>I wrote a tactic working by reflexivity, inspired from the ring tactic in Coq.<br>\nbut it's using rationals as constants and can be quite slow.<br>\n<span class=\"user-mention\" data-user-id=\"110596\">@Rob Lewis</span> mentioned that macros could be used to do the computation more efficiently, running the tactic in the kernel only if that's required, depending on the level of trust.</p>",
        "id": 168317565,
        "sender_full_name": "Paul-Nicolas Madelaine",
        "timestamp": 1560783493
    },
    {
        "content": "<p>of course a more direct solution would be to first write a more efficient definition of rat, but he mentioned the macros and I wanted to learn more about them</p>",
        "id": 168317642,
        "sender_full_name": "Paul-Nicolas Madelaine",
        "timestamp": 1560783579
    },
    {
        "content": "<p>I've had some limited rational programming experience, and there were huge speedups by locally inlining the rat computation functions if I recall</p>",
        "id": 168317729,
        "sender_full_name": "Keeley Hoek",
        "timestamp": 1560783615
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"110111\">@Keeley Hoek</span> how can I do this? I've never used inlining</p>",
        "id": 168319972,
        "sender_full_name": "Paul-Nicolas Madelaine",
        "timestamp": 1560785122
    },
    {
        "content": "<p><code>local attribute [inline] &lt;idents&gt;</code> is all there is too it, that has to appear before the functions using the functions you are inlining are defined. It is useful to look at the generated bytecode to see if more should be inlined after. To do that, use <code>set_option trace.compiler.code_gen true</code></p>",
        "id": 168320545,
        "sender_full_name": "Keeley Hoek",
        "timestamp": 1560785500
    },
    {
        "content": "<p>thanks!</p>",
        "id": 168320814,
        "sender_full_name": "Paul-Nicolas Madelaine",
        "timestamp": 1560785646
    },
    {
        "content": "<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"110596\">Rob Lewis</span> mentioned that macros could be used to do the computation more efficiently, running the tactic in the kernel only if that's required, depending on the level of trust.</p>\n</blockquote>\n<p>Could possibly be used. I don't actually know if there's any way to do this in practice.</p>",
        "id": 168321706,
        "sender_full_name": "Rob Lewis",
        "timestamp": 1560786293
    },
    {
        "content": "<blockquote>\n<p>I've had some limited rational programming experience, and there were huge speedups by locally inlining the rat computation functions if I recall</p>\n</blockquote>\n<p>Inlining will only affect computation in the VM though, right? This is good to know for future reference, but unfortunately we're dealing with kernel computation here.</p>",
        "id": 168321821,
        "sender_full_name": "Rob Lewis",
        "timestamp": 1560786364
    },
    {
        "content": "<blockquote>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"110596\">Rob Lewis</span> mentioned that macros could be used to do the computation more efficiently, running the tactic in the kernel only if that's required, depending on the level of trust.</p>\n</blockquote>\n<p>Could possibly be used. I don't actually know if there's any way to do this in practice.</p>\n</blockquote>\n<p>yes, sorry that's what I meant.<br>\nI meant to use the past as conditional, but in this case I guess it doesn't work</p>",
        "id": 168322634,
        "sender_full_name": "Paul-Nicolas Madelaine",
        "timestamp": 1560786932
    }
]