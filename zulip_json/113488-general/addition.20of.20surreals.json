[
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"110049\">@Mario Carneiro</span>,</p>\n<p>I have a question about your definition of addition for surreal numbers. My student <span class=\"user-mention\" data-user-id=\"209437\">@Isabel Longbottom</span>  has been<br>\ntrying to use it when working on combinatorial games, and we'd really like to have a siplification lemma<br>\nthat spells out addition in a more familiar form. We'd like to be able to prove the following lemma:</p>\n<div class=\"codehilite\"><pre><span></span>@[simp] lemma add_def {xl xr xL xR yl yr yL yR} :\n  add (mk xl xr xL xR) (mk yl yr yL yR) =\n    mk (xl ⊕ yl) (xr ⊕ yr)\n    (λ xy, sum.cases_on xy (λ x : xl, add (xL x) (mk yl yr yL yR))\n                           (λ y : yl, add (mk xl xr xL xR) (yL y)))\n    (λ xy, sum.cases_on xy (λ x : xr, add (xR x) (mk yl yr yL yR))\n                           (λ y : yr, add (mk xl xr xL xR) (yR y))) := sorry\n</pre></div>\n\n\n<p>immediately after the definition of <code>add</code> (say at <a href=\"https://github.com/leanprover-community/mathlib/blob/master/src/set_theory/surreal.lean#L189\" target=\"_blank\" title=\"https://github.com/leanprover-community/mathlib/blob/master/src/set_theory/surreal.lean#L189\">l. 189 of <code>surreal.lean</code></a>).</p>\n<p>Is it reasonably to want this? How does one prove such a lemma? Neither of us have had much luck...</p>",
        "id": 166725755,
        "sender_full_name": "Scott Morrison",
        "timestamp": 1559056079
    },
    {
        "content": "<p>It should be <code>rfl</code> if you got it right</p>",
        "id": 166726183,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1559056330
    },
    {
        "content": "<p>Or if I got it right... The definition is wrong. Use this instead</p>\n<div class=\"codehilite\"><pre><span></span><span class=\"n\">def</span> <span class=\"n\">add</span> <span class=\"o\">(</span><span class=\"n\">x</span> <span class=\"n\">y</span> <span class=\"o\">:</span> <span class=\"n\">pSurreal</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">pSurreal</span> <span class=\"o\">:=</span>\n<span class=\"k\">begin</span>\n  <span class=\"n\">induction</span> <span class=\"n\">x</span> <span class=\"k\">with</span> <span class=\"n\">xl</span> <span class=\"n\">xr</span> <span class=\"n\">xL</span> <span class=\"n\">xR</span> <span class=\"n\">IHxl</span> <span class=\"n\">IHxr</span> <span class=\"n\">generalizing</span> <span class=\"n\">y</span><span class=\"o\">,</span>\n  <span class=\"n\">induction</span> <span class=\"n\">y</span> <span class=\"k\">with</span> <span class=\"n\">yl</span> <span class=\"n\">yr</span> <span class=\"n\">yL</span> <span class=\"n\">yR</span> <span class=\"n\">IHyl</span> <span class=\"n\">IHyr</span><span class=\"o\">,</span>\n  <span class=\"k\">have</span> <span class=\"n\">y</span> <span class=\"o\">:=</span> <span class=\"n\">mk</span> <span class=\"n\">yl</span> <span class=\"n\">yr</span> <span class=\"n\">yL</span> <span class=\"n\">yR</span><span class=\"o\">,</span>\n  <span class=\"n\">refine</span> <span class=\"bp\">⟨</span><span class=\"n\">xl</span> <span class=\"err\">⊕</span> <span class=\"n\">yl</span><span class=\"o\">,</span> <span class=\"n\">xr</span> <span class=\"err\">⊕</span> <span class=\"n\">yr</span><span class=\"o\">,</span> <span class=\"n\">sum</span><span class=\"bp\">.</span><span class=\"n\">rec</span> <span class=\"bp\">_</span> <span class=\"bp\">_</span><span class=\"o\">,</span> <span class=\"n\">sum</span><span class=\"bp\">.</span><span class=\"n\">rec</span> <span class=\"bp\">_</span> <span class=\"bp\">_⟩</span><span class=\"o\">,</span>\n  <span class=\"o\">{</span> <span class=\"n\">exact</span> <span class=\"bp\">λ</span> <span class=\"n\">i</span><span class=\"o\">,</span> <span class=\"n\">IHxl</span> <span class=\"n\">i</span> <span class=\"n\">y</span> <span class=\"o\">},</span>\n  <span class=\"o\">{</span> <span class=\"n\">exact</span> <span class=\"bp\">λ</span> <span class=\"n\">i</span><span class=\"o\">,</span> <span class=\"n\">IHyl</span> <span class=\"n\">i</span> <span class=\"o\">},</span>\n  <span class=\"o\">{</span> <span class=\"n\">exact</span> <span class=\"bp\">λ</span> <span class=\"n\">i</span><span class=\"o\">,</span> <span class=\"n\">IHxr</span> <span class=\"n\">i</span> <span class=\"n\">y</span> <span class=\"o\">},</span>\n  <span class=\"o\">{</span> <span class=\"n\">exact</span> <span class=\"bp\">λ</span> <span class=\"n\">i</span><span class=\"o\">,</span> <span class=\"n\">IHyr</span> <span class=\"n\">i</span> <span class=\"o\">}</span>\n<span class=\"kn\">end</span>\n\n<span class=\"kn\">instance</span> <span class=\"o\">:</span> <span class=\"n\">has_add</span> <span class=\"n\">pSurreal</span> <span class=\"o\">:=</span> <span class=\"bp\">⟨</span><span class=\"n\">add</span><span class=\"bp\">⟩</span>\n\n<span class=\"bp\">@</span><span class=\"o\">[</span><span class=\"n\">simp</span><span class=\"o\">]</span> <span class=\"kn\">lemma</span> <span class=\"n\">add_def</span> <span class=\"o\">{</span><span class=\"n\">xl</span> <span class=\"n\">xr</span> <span class=\"n\">xL</span> <span class=\"n\">xR</span> <span class=\"n\">yl</span> <span class=\"n\">yr</span> <span class=\"n\">yL</span> <span class=\"n\">yR</span><span class=\"o\">}</span> <span class=\"o\">:</span>\n    <span class=\"n\">mk</span> <span class=\"n\">xl</span> <span class=\"n\">xr</span> <span class=\"n\">xL</span> <span class=\"n\">xR</span> <span class=\"bp\">+</span> <span class=\"n\">mk</span> <span class=\"n\">yl</span> <span class=\"n\">yr</span> <span class=\"n\">yL</span> <span class=\"n\">yR</span> <span class=\"bp\">=</span>\n    <span class=\"n\">mk</span> <span class=\"o\">(</span><span class=\"n\">xl</span> <span class=\"err\">⊕</span> <span class=\"n\">yl</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">xr</span> <span class=\"err\">⊕</span> <span class=\"n\">yr</span><span class=\"o\">)</span>\n    <span class=\"o\">(</span><span class=\"bp\">λ</span> <span class=\"n\">xy</span><span class=\"o\">,</span> <span class=\"n\">sum</span><span class=\"bp\">.</span><span class=\"n\">cases_on</span> <span class=\"n\">xy</span> <span class=\"o\">(</span><span class=\"bp\">λ</span> <span class=\"n\">x</span> <span class=\"o\">:</span> <span class=\"n\">xl</span><span class=\"o\">,</span> <span class=\"n\">xL</span> <span class=\"n\">x</span> <span class=\"bp\">+</span> <span class=\"n\">mk</span> <span class=\"n\">yl</span> <span class=\"n\">yr</span> <span class=\"n\">yL</span> <span class=\"n\">yR</span><span class=\"o\">)</span>\n                           <span class=\"o\">(</span><span class=\"bp\">λ</span> <span class=\"n\">y</span> <span class=\"o\">:</span> <span class=\"n\">yl</span><span class=\"o\">,</span> <span class=\"n\">mk</span> <span class=\"n\">xl</span> <span class=\"n\">xr</span> <span class=\"n\">xL</span> <span class=\"n\">xR</span> <span class=\"bp\">+</span> <span class=\"n\">yL</span> <span class=\"n\">y</span><span class=\"o\">))</span>\n    <span class=\"o\">(</span><span class=\"bp\">λ</span> <span class=\"n\">xy</span><span class=\"o\">,</span> <span class=\"n\">sum</span><span class=\"bp\">.</span><span class=\"n\">cases_on</span> <span class=\"n\">xy</span> <span class=\"o\">(</span><span class=\"bp\">λ</span> <span class=\"n\">x</span> <span class=\"o\">:</span> <span class=\"n\">xr</span><span class=\"o\">,</span> <span class=\"n\">xR</span> <span class=\"n\">x</span> <span class=\"bp\">+</span> <span class=\"n\">mk</span> <span class=\"n\">yl</span> <span class=\"n\">yr</span> <span class=\"n\">yL</span> <span class=\"n\">yR</span><span class=\"o\">)</span>\n                           <span class=\"o\">(</span><span class=\"bp\">λ</span> <span class=\"n\">y</span> <span class=\"o\">:</span> <span class=\"n\">yr</span><span class=\"o\">,</span> <span class=\"n\">mk</span> <span class=\"n\">xl</span> <span class=\"n\">xr</span> <span class=\"n\">xL</span> <span class=\"n\">xR</span> <span class=\"bp\">+</span> <span class=\"n\">yR</span> <span class=\"n\">y</span><span class=\"o\">))</span> <span class=\"o\">:=</span> <span class=\"n\">rfl</span>\n</pre></div>",
        "id": 166728376,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1559057830
    },
    {
        "content": "<p>By the way, I diagnosed this by adding some names for the intermediate functions and proving the equation lemmas for them, then using <code>congr</code> on the target lemma to see what went wrong</p>\n<div class=\"codehilite\"><pre><span></span><span class=\"n\">def</span> <span class=\"n\">add2</span>\n  <span class=\"o\">{</span><span class=\"n\">xl</span> <span class=\"n\">xr</span><span class=\"o\">}</span> <span class=\"o\">(</span><span class=\"n\">xL</span> <span class=\"o\">:</span> <span class=\"n\">xl</span> <span class=\"bp\">→</span> <span class=\"n\">pSurreal</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">xR</span> <span class=\"o\">:</span> <span class=\"n\">xr</span> <span class=\"bp\">→</span> <span class=\"n\">pSurreal</span><span class=\"o\">)</span>\n  <span class=\"o\">(</span><span class=\"n\">IHxl</span> <span class=\"o\">:</span> <span class=\"n\">xl</span> <span class=\"bp\">→</span> <span class=\"n\">pSurreal</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">IHxr</span> <span class=\"o\">:</span> <span class=\"n\">xr</span> <span class=\"bp\">→</span> <span class=\"n\">pSurreal</span><span class=\"o\">)</span>\n  <span class=\"o\">{</span><span class=\"n\">yl</span> <span class=\"n\">yr</span><span class=\"o\">}</span> <span class=\"o\">(</span><span class=\"n\">yL</span> <span class=\"o\">:</span> <span class=\"n\">yl</span> <span class=\"bp\">→</span> <span class=\"n\">pSurreal</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">yR</span> <span class=\"o\">:</span> <span class=\"n\">yr</span> <span class=\"bp\">→</span> <span class=\"n\">pSurreal</span><span class=\"o\">)</span>\n  <span class=\"o\">(</span><span class=\"n\">IHyl</span> <span class=\"o\">:</span> <span class=\"n\">yl</span> <span class=\"bp\">→</span> <span class=\"n\">pSurreal</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">IHyr</span> <span class=\"o\">:</span> <span class=\"n\">yr</span> <span class=\"bp\">→</span> <span class=\"n\">pSurreal</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">pSurreal</span> <span class=\"o\">:=</span>\n<span class=\"bp\">⟨</span><span class=\"n\">xl</span> <span class=\"err\">⊕</span> <span class=\"n\">yl</span><span class=\"o\">,</span> <span class=\"n\">xr</span> <span class=\"err\">⊕</span> <span class=\"n\">yr</span><span class=\"o\">,</span>\n  <span class=\"bp\">λ</span> <span class=\"n\">xy</span><span class=\"o\">,</span> <span class=\"n\">sum</span><span class=\"bp\">.</span><span class=\"n\">cases_on</span> <span class=\"n\">xy</span> <span class=\"o\">(</span><span class=\"bp\">λ</span> <span class=\"n\">i</span><span class=\"o\">,</span> <span class=\"n\">IHxl</span> <span class=\"n\">i</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"bp\">λ</span> <span class=\"n\">i</span><span class=\"o\">,</span> <span class=\"n\">IHyl</span> <span class=\"n\">i</span><span class=\"o\">),</span>\n  <span class=\"bp\">λ</span> <span class=\"n\">xy</span><span class=\"o\">,</span> <span class=\"n\">sum</span><span class=\"bp\">.</span><span class=\"n\">cases_on</span> <span class=\"n\">xy</span> <span class=\"o\">(</span><span class=\"bp\">λ</span> <span class=\"n\">i</span><span class=\"o\">,</span> <span class=\"n\">IHxr</span> <span class=\"n\">i</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"bp\">λ</span> <span class=\"n\">i</span><span class=\"o\">,</span> <span class=\"n\">IHyr</span> <span class=\"n\">i</span><span class=\"o\">)</span><span class=\"bp\">⟩</span>\n\n<span class=\"n\">def</span> <span class=\"n\">add1</span> <span class=\"o\">{</span><span class=\"n\">xl</span> <span class=\"n\">xr</span><span class=\"o\">}</span> <span class=\"o\">(</span><span class=\"n\">xL</span> <span class=\"o\">:</span> <span class=\"n\">xl</span> <span class=\"bp\">→</span> <span class=\"n\">pSurreal</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">xR</span> <span class=\"o\">:</span> <span class=\"n\">xr</span> <span class=\"bp\">→</span> <span class=\"n\">pSurreal</span><span class=\"o\">)</span>\n  <span class=\"o\">(</span><span class=\"n\">IHxl</span> <span class=\"o\">:</span> <span class=\"n\">xl</span> <span class=\"bp\">→</span> <span class=\"n\">pSurreal</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">IHxr</span> <span class=\"o\">:</span> <span class=\"n\">xr</span> <span class=\"bp\">→</span> <span class=\"n\">pSurreal</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">y</span> <span class=\"o\">:</span> <span class=\"n\">pSurreal</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">pSurreal</span> <span class=\"o\">:=</span>\n<span class=\"k\">begin</span>\n  <span class=\"n\">induction</span> <span class=\"n\">y</span> <span class=\"k\">with</span> <span class=\"n\">yl</span> <span class=\"n\">yr</span> <span class=\"n\">yL</span> <span class=\"n\">yR</span> <span class=\"n\">IHyl</span> <span class=\"n\">IHyr</span><span class=\"o\">,</span>\n  <span class=\"n\">refine</span> <span class=\"bp\">⟨</span><span class=\"n\">xl</span> <span class=\"err\">⊕</span> <span class=\"n\">yl</span><span class=\"o\">,</span> <span class=\"n\">xr</span> <span class=\"err\">⊕</span> <span class=\"n\">yr</span><span class=\"o\">,</span> <span class=\"bp\">λ</span> <span class=\"n\">xy</span><span class=\"o\">,</span> <span class=\"n\">sum</span><span class=\"bp\">.</span><span class=\"n\">cases_on</span> <span class=\"n\">xy</span> <span class=\"bp\">_</span> <span class=\"bp\">_</span><span class=\"o\">,</span> <span class=\"bp\">λ</span> <span class=\"n\">xy</span><span class=\"o\">,</span> <span class=\"n\">sum</span><span class=\"bp\">.</span><span class=\"n\">cases_on</span> <span class=\"n\">xy</span> <span class=\"bp\">_</span> <span class=\"bp\">_⟩</span><span class=\"o\">,</span>\n  <span class=\"o\">{</span> <span class=\"n\">exact</span> <span class=\"bp\">λ</span> <span class=\"n\">i</span><span class=\"o\">,</span> <span class=\"n\">IHxl</span> <span class=\"n\">i</span> <span class=\"o\">},</span>\n  <span class=\"o\">{</span> <span class=\"n\">exact</span> <span class=\"bp\">λ</span> <span class=\"n\">i</span><span class=\"o\">,</span> <span class=\"n\">IHyl</span> <span class=\"n\">i</span> <span class=\"o\">},</span>\n  <span class=\"o\">{</span> <span class=\"n\">exact</span> <span class=\"bp\">λ</span> <span class=\"n\">i</span><span class=\"o\">,</span> <span class=\"n\">IHxr</span> <span class=\"n\">i</span> <span class=\"o\">},</span>\n  <span class=\"o\">{</span> <span class=\"n\">exact</span> <span class=\"bp\">λ</span> <span class=\"n\">i</span><span class=\"o\">,</span> <span class=\"n\">IHyr</span> <span class=\"n\">i</span> <span class=\"o\">}</span>\n<span class=\"kn\">end</span>\n\n<span class=\"c\">/-</span><span class=\"cm\">- The sum of `x = {xL | xR}` and `y = {yL | yR}` is `{xL + y, x + yL | xR + y, x + yR}`. -/</span>\n<span class=\"n\">def</span> <span class=\"n\">add</span> <span class=\"o\">(</span><span class=\"n\">x</span> <span class=\"n\">y</span> <span class=\"o\">:</span> <span class=\"n\">pSurreal</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">pSurreal</span> <span class=\"o\">:=</span>\n<span class=\"k\">begin</span>\n  <span class=\"n\">induction</span> <span class=\"n\">x</span> <span class=\"k\">with</span> <span class=\"n\">xl</span> <span class=\"n\">xr</span> <span class=\"n\">xL</span> <span class=\"n\">xR</span> <span class=\"n\">IHxl</span> <span class=\"n\">IHxr</span><span class=\"o\">,</span>\n  <span class=\"n\">induction</span> <span class=\"n\">y</span> <span class=\"k\">with</span> <span class=\"n\">yl</span> <span class=\"n\">yr</span> <span class=\"n\">yL</span> <span class=\"n\">yR</span> <span class=\"n\">IHyl</span> <span class=\"n\">IHyr</span><span class=\"o\">,</span>\n  <span class=\"n\">refine</span> <span class=\"bp\">⟨</span><span class=\"n\">xl</span> <span class=\"err\">⊕</span> <span class=\"n\">yl</span><span class=\"o\">,</span> <span class=\"n\">xr</span> <span class=\"err\">⊕</span> <span class=\"n\">yr</span><span class=\"o\">,</span> <span class=\"n\">sum</span><span class=\"bp\">.</span><span class=\"n\">rec</span> <span class=\"bp\">_</span> <span class=\"bp\">_</span><span class=\"o\">,</span> <span class=\"n\">sum</span><span class=\"bp\">.</span><span class=\"n\">rec</span> <span class=\"bp\">_</span> <span class=\"bp\">_⟩</span><span class=\"o\">,</span>\n  <span class=\"o\">{</span> <span class=\"n\">exact</span> <span class=\"bp\">λ</span> <span class=\"n\">i</span><span class=\"o\">,</span> <span class=\"n\">IHxl</span> <span class=\"n\">i</span> <span class=\"o\">},</span>\n  <span class=\"o\">{</span> <span class=\"n\">exact</span> <span class=\"bp\">λ</span> <span class=\"n\">i</span><span class=\"o\">,</span> <span class=\"n\">IHyl</span> <span class=\"n\">i</span> <span class=\"o\">},</span>\n  <span class=\"o\">{</span> <span class=\"n\">exact</span> <span class=\"bp\">λ</span> <span class=\"n\">i</span><span class=\"o\">,</span> <span class=\"n\">IHxr</span> <span class=\"n\">i</span> <span class=\"o\">},</span>\n  <span class=\"o\">{</span> <span class=\"n\">exact</span> <span class=\"bp\">λ</span> <span class=\"n\">i</span><span class=\"o\">,</span> <span class=\"n\">IHyr</span> <span class=\"n\">i</span> <span class=\"o\">}</span>\n<span class=\"kn\">end</span>\n\n<span class=\"kn\">instance</span> <span class=\"o\">:</span> <span class=\"n\">has_add</span> <span class=\"n\">pSurreal</span> <span class=\"o\">:=</span> <span class=\"bp\">⟨</span><span class=\"n\">add</span><span class=\"bp\">⟩</span>\n\n<span class=\"kn\">lemma</span> <span class=\"n\">add_def2</span> <span class=\"o\">{</span><span class=\"n\">xl</span> <span class=\"n\">xr</span> <span class=\"n\">xL</span> <span class=\"n\">xR</span> <span class=\"n\">IHxl</span> <span class=\"n\">IHxr</span> <span class=\"n\">yl</span> <span class=\"n\">yr</span> <span class=\"n\">yL</span> <span class=\"n\">yR</span><span class=\"o\">}</span> <span class=\"o\">:</span>\n  <span class=\"bp\">@</span><span class=\"n\">add1</span> <span class=\"n\">xl</span> <span class=\"n\">xr</span> <span class=\"n\">xL</span> <span class=\"n\">xR</span> <span class=\"n\">IHxl</span> <span class=\"n\">IHxr</span> <span class=\"o\">(</span><span class=\"n\">mk</span> <span class=\"n\">yl</span> <span class=\"n\">yr</span> <span class=\"n\">yL</span> <span class=\"n\">yR</span><span class=\"o\">)</span> <span class=\"bp\">=</span>\n  <span class=\"n\">add2</span> <span class=\"n\">xL</span> <span class=\"n\">xR</span> <span class=\"n\">IHxl</span> <span class=\"n\">IHxr</span> <span class=\"n\">yL</span> <span class=\"n\">yR</span>\n    <span class=\"o\">(</span><span class=\"bp\">λ</span> <span class=\"n\">i</span><span class=\"o\">,</span> <span class=\"n\">add1</span> <span class=\"n\">xL</span> <span class=\"n\">xR</span> <span class=\"n\">IHxl</span> <span class=\"n\">IHxr</span> <span class=\"o\">(</span><span class=\"n\">yL</span> <span class=\"n\">i</span><span class=\"o\">))</span>\n    <span class=\"o\">(</span><span class=\"bp\">λ</span> <span class=\"n\">i</span><span class=\"o\">,</span> <span class=\"n\">add1</span> <span class=\"n\">xL</span> <span class=\"n\">xR</span> <span class=\"n\">IHxl</span> <span class=\"n\">IHxr</span> <span class=\"o\">(</span><span class=\"n\">yR</span> <span class=\"n\">i</span><span class=\"o\">))</span> <span class=\"o\">:=</span> <span class=\"n\">rfl</span>\n\n<span class=\"kn\">lemma</span> <span class=\"n\">add_def1</span> <span class=\"o\">{</span><span class=\"n\">xl</span> <span class=\"n\">xr</span> <span class=\"n\">xL</span> <span class=\"n\">xR</span> <span class=\"n\">y</span><span class=\"o\">}</span> <span class=\"o\">:</span>\n  <span class=\"n\">mk</span> <span class=\"n\">xl</span> <span class=\"n\">xr</span> <span class=\"n\">xL</span> <span class=\"n\">xR</span> <span class=\"bp\">+</span> <span class=\"n\">y</span> <span class=\"bp\">=</span> <span class=\"n\">add1</span> <span class=\"n\">xL</span> <span class=\"n\">xR</span> <span class=\"o\">(</span><span class=\"bp\">λ</span> <span class=\"n\">i</span><span class=\"o\">,</span> <span class=\"n\">xL</span> <span class=\"n\">i</span> <span class=\"bp\">+</span> <span class=\"n\">y</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"bp\">λ</span> <span class=\"n\">i</span><span class=\"o\">,</span> <span class=\"n\">xR</span> <span class=\"n\">i</span> <span class=\"bp\">+</span> <span class=\"n\">y</span><span class=\"o\">)</span> <span class=\"n\">y</span> <span class=\"o\">:=</span> <span class=\"n\">rfl</span>\n\n<span class=\"bp\">@</span><span class=\"o\">[</span><span class=\"n\">simp</span><span class=\"o\">]</span> <span class=\"kn\">lemma</span> <span class=\"n\">add_def</span> <span class=\"o\">{</span><span class=\"n\">xl</span> <span class=\"n\">xr</span> <span class=\"n\">xL</span> <span class=\"n\">xR</span> <span class=\"n\">yl</span> <span class=\"n\">yr</span> <span class=\"n\">yL</span> <span class=\"n\">yR</span><span class=\"o\">}</span> <span class=\"o\">:</span>\n    <span class=\"n\">mk</span> <span class=\"n\">xl</span> <span class=\"n\">xr</span> <span class=\"n\">xL</span> <span class=\"n\">xR</span> <span class=\"bp\">+</span> <span class=\"n\">mk</span> <span class=\"n\">yl</span> <span class=\"n\">yr</span> <span class=\"n\">yL</span> <span class=\"n\">yR</span> <span class=\"bp\">=</span>\n    <span class=\"n\">mk</span> <span class=\"o\">(</span><span class=\"n\">xl</span> <span class=\"err\">⊕</span> <span class=\"n\">yl</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">xr</span> <span class=\"err\">⊕</span> <span class=\"n\">yr</span><span class=\"o\">)</span>\n    <span class=\"o\">(</span><span class=\"bp\">λ</span> <span class=\"n\">xy</span><span class=\"o\">,</span> <span class=\"n\">sum</span><span class=\"bp\">.</span><span class=\"n\">cases_on</span> <span class=\"n\">xy</span> <span class=\"o\">(</span><span class=\"bp\">λ</span> <span class=\"n\">x</span> <span class=\"o\">:</span> <span class=\"n\">xl</span><span class=\"o\">,</span> <span class=\"n\">xL</span> <span class=\"n\">x</span> <span class=\"bp\">+</span> <span class=\"n\">mk</span> <span class=\"n\">yl</span> <span class=\"n\">yr</span> <span class=\"n\">yL</span> <span class=\"n\">yR</span><span class=\"o\">)</span>\n                           <span class=\"o\">(</span><span class=\"bp\">λ</span> <span class=\"n\">y</span> <span class=\"o\">:</span> <span class=\"n\">yl</span><span class=\"o\">,</span> <span class=\"n\">mk</span> <span class=\"n\">xl</span> <span class=\"n\">xr</span> <span class=\"n\">xL</span> <span class=\"n\">xR</span> <span class=\"bp\">+</span> <span class=\"n\">yL</span> <span class=\"n\">y</span><span class=\"o\">))</span>\n    <span class=\"o\">(</span><span class=\"bp\">λ</span> <span class=\"n\">xy</span><span class=\"o\">,</span> <span class=\"n\">sum</span><span class=\"bp\">.</span><span class=\"n\">cases_on</span> <span class=\"n\">xy</span> <span class=\"o\">(</span><span class=\"bp\">λ</span> <span class=\"n\">x</span> <span class=\"o\">:</span> <span class=\"n\">xr</span><span class=\"o\">,</span> <span class=\"n\">xR</span> <span class=\"n\">x</span> <span class=\"bp\">+</span> <span class=\"n\">mk</span> <span class=\"n\">yl</span> <span class=\"n\">yr</span> <span class=\"n\">yL</span> <span class=\"n\">yR</span><span class=\"o\">)</span>\n                           <span class=\"o\">(</span><span class=\"bp\">λ</span> <span class=\"n\">y</span> <span class=\"o\">:</span> <span class=\"n\">yr</span><span class=\"o\">,</span> <span class=\"n\">mk</span> <span class=\"n\">xl</span> <span class=\"n\">xr</span> <span class=\"n\">xL</span> <span class=\"n\">xR</span> <span class=\"bp\">+</span> <span class=\"n\">yR</span> <span class=\"n\">y</span><span class=\"o\">))</span> <span class=\"o\">:=</span>\n<span class=\"k\">begin</span>\n  <span class=\"n\">rw</span> <span class=\"o\">[</span><span class=\"n\">add_def1</span><span class=\"o\">,</span> <span class=\"n\">add_def2</span><span class=\"o\">,</span> <span class=\"n\">add2</span><span class=\"o\">],</span>\n  <span class=\"n\">congr</span><span class=\"bp\">;</span> <span class=\"n\">funext</span><span class=\"bp\">;</span> <span class=\"n\">congr</span><span class=\"bp\">;</span> <span class=\"n\">funext</span> <span class=\"n\">j</span><span class=\"o\">,</span> <span class=\"n\">dsimp</span><span class=\"o\">,</span> <span class=\"n\">rw</span> <span class=\"n\">add_def1</span><span class=\"o\">,</span>\n<span class=\"kn\">end</span>\n</pre></div>",
        "id": 166728822,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1559058086
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"110087\">@Scott Morrison</span> Actually, if you really want a nice equation lemma for this, I recommend the following:</p>\n<div class=\"codehilite\"><pre><span></span><span class=\"n\">def</span> <span class=\"n\">addL</span> <span class=\"o\">{</span><span class=\"n\">xl</span> <span class=\"n\">xr</span> <span class=\"n\">yl</span> <span class=\"n\">yr</span><span class=\"o\">}</span> <span class=\"o\">(</span><span class=\"n\">xL</span> <span class=\"o\">:</span> <span class=\"n\">xl</span> <span class=\"bp\">→</span> <span class=\"n\">pSurreal</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">xR</span> <span class=\"n\">yL</span> <span class=\"n\">yR</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">xy</span> <span class=\"o\">:</span> <span class=\"n\">xl</span> <span class=\"err\">⊕</span> <span class=\"n\">yl</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">pSurreal</span> <span class=\"o\">:=</span>\n<span class=\"n\">sum</span><span class=\"bp\">.</span><span class=\"n\">cases_on</span> <span class=\"n\">xy</span> <span class=\"o\">(</span><span class=\"bp\">λ</span> <span class=\"n\">i</span><span class=\"o\">,</span> <span class=\"n\">xL</span> <span class=\"n\">i</span> <span class=\"bp\">+</span> <span class=\"n\">mk</span> <span class=\"n\">yl</span> <span class=\"n\">yr</span> <span class=\"n\">yL</span> <span class=\"n\">yR</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"bp\">λ</span> <span class=\"n\">i</span><span class=\"o\">,</span> <span class=\"n\">mk</span> <span class=\"n\">xl</span> <span class=\"n\">xr</span> <span class=\"n\">xL</span> <span class=\"n\">xR</span> <span class=\"bp\">+</span> <span class=\"n\">yL</span> <span class=\"n\">i</span><span class=\"o\">)</span>\n\n<span class=\"bp\">@</span><span class=\"o\">[</span><span class=\"n\">simp</span><span class=\"o\">]</span> <span class=\"kn\">lemma</span> <span class=\"n\">addL_inl</span> <span class=\"o\">{</span><span class=\"n\">xl</span> <span class=\"n\">xr</span> <span class=\"n\">yl</span> <span class=\"n\">yr</span><span class=\"o\">}</span> <span class=\"o\">(</span><span class=\"n\">xL</span> <span class=\"n\">xR</span> <span class=\"n\">yL</span> <span class=\"n\">yR</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">i</span> <span class=\"o\">:</span> <span class=\"n\">xl</span><span class=\"o\">)</span> <span class=\"o\">:</span>\n  <span class=\"bp\">@</span><span class=\"n\">addL</span> <span class=\"n\">xl</span> <span class=\"n\">xr</span> <span class=\"n\">yl</span> <span class=\"n\">yr</span> <span class=\"n\">xL</span> <span class=\"n\">xR</span> <span class=\"n\">yL</span> <span class=\"n\">yR</span> <span class=\"o\">(</span><span class=\"n\">sum</span><span class=\"bp\">.</span><span class=\"n\">inl</span> <span class=\"n\">i</span><span class=\"o\">)</span> <span class=\"bp\">=</span> <span class=\"n\">xL</span> <span class=\"n\">i</span> <span class=\"bp\">+</span> <span class=\"n\">mk</span> <span class=\"n\">yl</span> <span class=\"n\">yr</span> <span class=\"n\">yL</span> <span class=\"n\">yR</span> <span class=\"o\">:=</span> <span class=\"n\">rfl</span>\n\n<span class=\"bp\">@</span><span class=\"o\">[</span><span class=\"n\">simp</span><span class=\"o\">]</span> <span class=\"kn\">lemma</span> <span class=\"n\">addL_inr</span> <span class=\"o\">{</span><span class=\"n\">xl</span> <span class=\"n\">xr</span> <span class=\"n\">yl</span> <span class=\"n\">yr</span><span class=\"o\">}</span> <span class=\"o\">(</span><span class=\"n\">xL</span> <span class=\"n\">xR</span> <span class=\"n\">yL</span> <span class=\"n\">yR</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">i</span> <span class=\"o\">:</span> <span class=\"n\">yl</span><span class=\"o\">)</span> <span class=\"o\">:</span>\n  <span class=\"bp\">@</span><span class=\"n\">addL</span> <span class=\"n\">xl</span> <span class=\"n\">xr</span> <span class=\"n\">yl</span> <span class=\"n\">yr</span> <span class=\"n\">xL</span> <span class=\"n\">xR</span> <span class=\"n\">yL</span> <span class=\"n\">yR</span> <span class=\"o\">(</span><span class=\"n\">sum</span><span class=\"bp\">.</span><span class=\"n\">inr</span> <span class=\"n\">i</span><span class=\"o\">)</span> <span class=\"bp\">=</span> <span class=\"n\">mk</span> <span class=\"n\">xl</span> <span class=\"n\">xr</span> <span class=\"n\">xL</span> <span class=\"n\">xR</span> <span class=\"bp\">+</span> <span class=\"n\">yL</span> <span class=\"n\">i</span> <span class=\"o\">:=</span> <span class=\"n\">rfl</span>\n\n<span class=\"n\">def</span> <span class=\"n\">addR</span> <span class=\"o\">{</span><span class=\"n\">xl</span> <span class=\"n\">xr</span> <span class=\"n\">yl</span> <span class=\"n\">yr</span><span class=\"o\">}</span> <span class=\"o\">(</span><span class=\"n\">xL</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">xR</span> <span class=\"o\">:</span> <span class=\"n\">xr</span> <span class=\"bp\">→</span> <span class=\"n\">pSurreal</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">yL</span> <span class=\"n\">yR</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">xy</span> <span class=\"o\">:</span> <span class=\"n\">xr</span> <span class=\"err\">⊕</span> <span class=\"n\">yr</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">pSurreal</span> <span class=\"o\">:=</span>\n<span class=\"n\">sum</span><span class=\"bp\">.</span><span class=\"n\">cases_on</span> <span class=\"n\">xy</span> <span class=\"o\">(</span><span class=\"bp\">λ</span> <span class=\"n\">i</span><span class=\"o\">,</span> <span class=\"n\">xR</span> <span class=\"n\">i</span> <span class=\"bp\">+</span> <span class=\"n\">mk</span> <span class=\"n\">yl</span> <span class=\"n\">yr</span> <span class=\"n\">yL</span> <span class=\"n\">yR</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"bp\">λ</span> <span class=\"n\">i</span><span class=\"o\">,</span> <span class=\"n\">mk</span> <span class=\"n\">xl</span> <span class=\"n\">xr</span> <span class=\"n\">xL</span> <span class=\"n\">xR</span> <span class=\"bp\">+</span> <span class=\"n\">yR</span> <span class=\"n\">i</span><span class=\"o\">)</span>\n\n<span class=\"bp\">@</span><span class=\"o\">[</span><span class=\"n\">simp</span><span class=\"o\">]</span> <span class=\"kn\">lemma</span> <span class=\"n\">addR_inl</span> <span class=\"o\">{</span><span class=\"n\">xl</span> <span class=\"n\">xr</span> <span class=\"n\">yl</span> <span class=\"n\">yr</span><span class=\"o\">}</span> <span class=\"o\">(</span><span class=\"n\">xL</span> <span class=\"n\">xR</span> <span class=\"n\">yL</span> <span class=\"n\">yR</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">i</span> <span class=\"o\">:</span> <span class=\"n\">xr</span><span class=\"o\">)</span> <span class=\"o\">:</span>\n  <span class=\"bp\">@</span><span class=\"n\">addR</span> <span class=\"n\">xl</span> <span class=\"n\">xr</span> <span class=\"n\">yl</span> <span class=\"n\">yr</span> <span class=\"n\">xL</span> <span class=\"n\">xR</span> <span class=\"n\">yL</span> <span class=\"n\">yR</span> <span class=\"o\">(</span><span class=\"n\">sum</span><span class=\"bp\">.</span><span class=\"n\">inl</span> <span class=\"n\">i</span><span class=\"o\">)</span> <span class=\"bp\">=</span> <span class=\"n\">xR</span> <span class=\"n\">i</span> <span class=\"bp\">+</span> <span class=\"n\">mk</span> <span class=\"n\">yl</span> <span class=\"n\">yr</span> <span class=\"n\">yL</span> <span class=\"n\">yR</span> <span class=\"o\">:=</span> <span class=\"n\">rfl</span>\n\n<span class=\"bp\">@</span><span class=\"o\">[</span><span class=\"n\">simp</span><span class=\"o\">]</span> <span class=\"kn\">lemma</span> <span class=\"n\">addR_inr</span> <span class=\"o\">{</span><span class=\"n\">xl</span> <span class=\"n\">xr</span> <span class=\"n\">yl</span> <span class=\"n\">yr</span><span class=\"o\">}</span> <span class=\"o\">(</span><span class=\"n\">xL</span> <span class=\"n\">xR</span> <span class=\"n\">yL</span> <span class=\"n\">yR</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">i</span> <span class=\"o\">:</span> <span class=\"n\">yr</span><span class=\"o\">)</span> <span class=\"o\">:</span>\n  <span class=\"bp\">@</span><span class=\"n\">addR</span> <span class=\"n\">xl</span> <span class=\"n\">xr</span> <span class=\"n\">yl</span> <span class=\"n\">yr</span> <span class=\"n\">xL</span> <span class=\"n\">xR</span> <span class=\"n\">yL</span> <span class=\"n\">yR</span> <span class=\"o\">(</span><span class=\"n\">sum</span><span class=\"bp\">.</span><span class=\"n\">inr</span> <span class=\"n\">i</span><span class=\"o\">)</span> <span class=\"bp\">=</span> <span class=\"n\">mk</span> <span class=\"n\">xl</span> <span class=\"n\">xr</span> <span class=\"n\">xL</span> <span class=\"n\">xR</span> <span class=\"bp\">+</span> <span class=\"n\">yR</span> <span class=\"n\">i</span> <span class=\"o\">:=</span> <span class=\"n\">rfl</span>\n\n<span class=\"bp\">@</span><span class=\"o\">[</span><span class=\"n\">simp</span><span class=\"o\">]</span> <span class=\"kn\">lemma</span> <span class=\"n\">add_def</span> <span class=\"o\">{</span><span class=\"n\">xl</span> <span class=\"n\">xr</span> <span class=\"n\">xL</span> <span class=\"n\">xR</span> <span class=\"n\">yl</span> <span class=\"n\">yr</span> <span class=\"n\">yL</span> <span class=\"n\">yR</span><span class=\"o\">}</span> <span class=\"o\">:</span>\n  <span class=\"n\">mk</span> <span class=\"n\">xl</span> <span class=\"n\">xr</span> <span class=\"n\">xL</span> <span class=\"n\">xR</span> <span class=\"bp\">+</span> <span class=\"n\">mk</span> <span class=\"n\">yl</span> <span class=\"n\">yr</span> <span class=\"n\">yL</span> <span class=\"n\">yR</span> <span class=\"bp\">=</span>\n  <span class=\"n\">mk</span> <span class=\"o\">(</span><span class=\"n\">xl</span> <span class=\"err\">⊕</span> <span class=\"n\">yl</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">xr</span> <span class=\"err\">⊕</span> <span class=\"n\">yr</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">addL</span> <span class=\"n\">xL</span> <span class=\"n\">xR</span> <span class=\"n\">yL</span> <span class=\"n\">yR</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">addR</span> <span class=\"n\">xL</span> <span class=\"n\">xR</span> <span class=\"n\">yL</span> <span class=\"n\">yR</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"n\">rfl</span>\n</pre></div>",
        "id": 166732847,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1559060291
    },
    {
        "content": "<p>Oh sorry, I made a mistake when reviewing your PR, I thought these definitions were definitionally equal. My bad!</p>",
        "id": 166734625,
        "sender_full_name": "Floris van Doorn",
        "timestamp": 1559061603
    }
]