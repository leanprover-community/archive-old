[
    {
        "content": "<p>sneak peek: <a href=\"https://github.com/leanprover/lean-nightly/releases\" target=\"_blank\" title=\"https://github.com/leanprover/lean-nightly/releases\">https://github.com/leanprover/lean-nightly/releases</a></p>",
        "id": 123270930,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1520189395
    },
    {
        "content": "<p>cool! Are you autogenerating the chglog diffs?</p>",
        "id": 123271176,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1520189997
    },
    {
        "content": "<p>Yep!</p>",
        "id": 123278141,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1520206024
    },
    {
        "content": "<p>After wasting hours and hours of cloud build time on fixing broken bash scripts, the pre-monad-PR nightly has finally landed for all platforms: <a href=\"https://github.com/leanprover/lean-nightly/releases/tag/nightly-2018-03-19\" target=\"_blank\" title=\"https://github.com/leanprover/lean-nightly/releases/tag/nightly-2018-03-19\">https://github.com/leanprover/lean-nightly/releases/tag/nightly-2018-03-19</a><br>\nNow building the latest commit. Regular daily (well, nightly) builds should work starting tomorrow.</p>",
        "id": 124221663,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1522061289
    },
    {
        "content": "<p>Monad nightly: <a href=\"https://github.com/leanprover/lean-nightly/releases\" target=\"_blank\" title=\"https://github.com/leanprover/lean-nightly/releases\">https://github.com/leanprover/lean-nightly/releases</a></p>",
        "id": 124224825,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1522067414
    },
    {
        "content": "<p>Nice! Thanks for doing it!</p>",
        "id": 124224904,
        "sender_full_name": "Simon Hudon",
        "timestamp": 1522067604
    },
    {
        "content": "<p>So feel free to discuss now how leanpkg should interact with all that :)</p>",
        "id": 124225247,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1522068244
    },
    {
        "content": "<p><em>stretches</em> alrighty!</p>",
        "id": 124226089,
        "sender_full_name": "Simon Hudon",
        "timestamp": 1522069682
    },
    {
        "content": "<p>For starter, it might be good to have a separate <code>leanpkg</code> project with a separate way of installing it.</p>",
        "id": 124226137,
        "sender_full_name": "Simon Hudon",
        "timestamp": 1522069763
    },
    {
        "content": "<p>Then I think we should have a field in <code>leanpkg.toml</code></p>",
        "id": 124226267,
        "sender_full_name": "Simon Hudon",
        "timestamp": 1522069957
    },
    {
        "content": "<p>I think in general we should be able to choose a version of Lean (in the project file) and have the version of the packages worked out for us. The most difficult part would be to let multiple versions of Lean exist on your system. I recognize that we talked about this before but this might be a good time to separate <code>leanpkg</code> and <code>lean</code></p>",
        "id": 124229253,
        "sender_full_name": "Simon Hudon",
        "timestamp": 1522074853
    },
    {
        "content": "<p>Or ... that would mean install a \"master\" version of Lean which <code>leanpkg</code> uses  as its interpreter and then curate a collection of nightlies</p>",
        "id": 124229281,
        "sender_full_name": "Simon Hudon",
        "timestamp": 1522074932
    },
    {
        "content": "<p>Yes, in absence of a native backend that may be the best solution. Though nightly releases may lose their importance until Lean 4 is merged into master.</p>",
        "id": 124229353,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1522075028
    },
    {
        "content": "<p>Note that you can now store a nightly version string in the <code>lean_version</code> config variable, and leanpkg will warn you about a mismatch</p>",
        "id": 124229424,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1522075165
    },
    {
        "content": "<p>That's nice to know! Can you give me an example of the syntax?</p>",
        "id": 124229488,
        "sender_full_name": "Simon Hudon",
        "timestamp": 1522075255
    },
    {
        "content": "<p><code>lean_version = \"nightly-2018-03-26\"</code>, same string as in the release names and tags</p>",
        "id": 124229527,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1522075317
    },
    {
        "content": "<p>Nice! What I've been using lately is a file called <code>lean_version</code> with the exact hash that my project is using. Travis uses it to compile the right version of Lean and I have git hooks that block commits if that version doesn't match my system's version</p>",
        "id": 124229613,
        "sender_full_name": "Simon Hudon",
        "timestamp": 1522075435
    },
    {
        "content": "<blockquote>\n<p>have the version of the packages worked out for us </p>\n</blockquote>\n<p>I believe this part isn't exactly trivial either. Do we grep through the repository for a commit with a fitting leanpkg.toml, or do we use tags for that (certainly not branches like for the stable releases)? What if there is no commit for that exact nightly?</p>",
        "id": 124229664,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1522075486
    },
    {
        "content": "<p>I assume if <code>mathlib</code> was to be tagged with the nightly it was built with, upgrade would upgrade to the right version</p>",
        "id": 124229679,
        "sender_full_name": "Simon Hudon",
        "timestamp": 1522075521
    },
    {
        "content": "<p>You're right</p>",
        "id": 124229757,
        "sender_full_name": "Simon Hudon",
        "timestamp": 1522075629
    },
    {
        "content": "<p>It might require discipline from the maintainers so that if they skip versions, they still tag a commit that will build with that version. That sounds cumbersome</p>",
        "id": 124229814,
        "sender_full_name": "Simon Hudon",
        "timestamp": 1522075687
    },
    {
        "content": "<p>The other possibility is to work in one of two modes: flexible or strict. In a strict mode, you ask leanpkg what is the latest nightly that all your dependencies work with and you upgrade to that one</p>",
        "id": 124229845,
        "sender_full_name": "Simon Hudon",
        "timestamp": 1522075762
    },
    {
        "content": "<p>Flexible would be a more relaxed form of that rule ... or just say \"screw it\" and get something that works with a more recent version of Lean and hope for the best</p>",
        "id": 124229914,
        "sender_full_name": "Simon Hudon",
        "timestamp": 1522075851
    },
    {
        "content": "<p>ahh, versioning. i just read a blog post about it in go <a href=\"https://blog.golang.org/versioning-proposal\" target=\"_blank\" title=\"https://blog.golang.org/versioning-proposal\">https://blog.golang.org/versioning-proposal</a></p>",
        "id": 124235668,
        "sender_full_name": "Andrew Ashworth",
        "timestamp": 1522084372
    },
    {
        "content": "<p>I've been trying to come up with a sensible notion of semantic versioning for Lean but the <code>meta</code> language usually doesn't fit in well</p>",
        "id": 124236309,
        "sender_full_name": "Simon Hudon",
        "timestamp": 1522085437
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"110049\">@Mario Carneiro</span> What do you think would be a realistic Lean versioning scheme for mathlib? Store the nightly version in the toml/a tag, then upgrade only when important upstream fixes/features are available?</p>",
        "id": 124423475,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1522434328
    },
    {
        "content": "<p>I think that's a fine idea. Assuming that old nightlies are now tracked, which it sounds like is working now, we could just put an appropriate nightly or lean git commit hash in the <code>lean_version</code> field or wherever, and update it when mathlib updates to lean</p>",
        "id": 124423579,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1522434473
    },
    {
        "content": "<p>Yea, see <a href=\"#narrow/stream/113488-general/subject/nightly.20version.20stapling/near/124229424\" title=\"#narrow/stream/113488-general/subject/nightly.20version.20stapling/near/124229424\">https://leanprover.zulipchat.com/#narrow/stream/113488-general/subject/nightly.20version.20stapling/near/124229424</a></p>",
        "id": 124423654,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1522434555
    },
    {
        "content": "<p>Oh, nice, days are nicer than hashes for this</p>",
        "id": 124423741,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1522434650
    },
    {
        "content": "<p>So we can implement this in mathlib now?</p>",
        "id": 124423762,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1522434685
    },
    {
        "content": "<p>Yep, you can manually set that field right now and leanpkg will warn people about any mismatch</p>",
        "id": 124423925,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1522434872
    },
    {
        "content": "<p>The only thing missing is a tool that automates that and setting up the correct Lean version. I've almost accidentally started a Twitter thread about that: <a href=\"https://twitter.com/derKha/status/979385452506550272\" target=\"_blank\" title=\"https://twitter.com/derKha/status/979385452506550272\">https://twitter.com/derKha/status/979385452506550272</a></p>\n<div class=\"inline-preview-twitter\"><div class=\"twitter-tweet\"><a href=\"https://twitter.com/derKha/status/979385452506550272\" target=\"_blank\"><img class=\"twitter-avatar\" src=\"https://uploads.zulipusercontent.net/eed2c5a7af22b4ad0091fa38a5bef677be9295f1/687474703a2f2f7062732e7477696d672e636f6d2f70726f66696c655f696d616765732f3739313833303132353830393530303136302f344e5a62634475635f6e6f726d616c2e6a7067\"></a><p>Naming suggestions for an application that downloads and manages your installed Lean versions (think rustup)?</p><span>- Sebastian Ullrich (@derKha)</span></div></div>",
        "id": 124424040,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1522435005
    },
    {
        "content": "<p><code>leanup</code> makes me giggle</p>",
        "id": 124424138,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1522435124
    },
    {
        "content": "<p>I feel like most puns/connotations are completely flying over my head :)</p>",
        "id": 124424217,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1522435245
    },
    {
        "content": "<p>But I'm confused why this is distinct from <code>leanpkg</code></p>",
        "id": 124424224,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1522435262
    },
    {
        "content": "<p>See <a href=\"https://twitter.com/derKha/status/979422420653297666\" target=\"_blank\" title=\"https://twitter.com/derKha/status/979422420653297666\">https://twitter.com/derKha/status/979422420653297666</a></p>\n<div class=\"inline-preview-twitter\"><div class=\"twitter-tweet\"><a href=\"https://twitter.com/derKha/status/979422420653297666\" target=\"_blank\"><img class=\"twitter-avatar\" src=\"https://uploads.zulipusercontent.net/eed2c5a7af22b4ad0091fa38a5bef677be9295f1/687474703a2f2f7062732e7477696d672e636f6d2f70726f66696c655f696d616765732f3739313833303132353830393530303136302f344e5a62634475635f6e6f726d616c2e6a7067\"></a><p><a href=\"https://twitter.com/graydon_pub\" target=\"_blank\" title=\"https://twitter.com/graydon_pub\">@graydon_pub</a> I think I agree with you, but in our case the package manager is written in Lean. Since we still lack good FFI for e.g. downloading files, or even native compilation, I'm inclined to write the meta installer in Rust for now. Not rewriting the kernel in Lean either anytime soon...</p><span>- Sebastian Ullrich (@derKha)</span></div></div>",
        "id": 124424294,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1522435351
    },
    {
        "content": "<p>so it's a bootstrapping issue?</p>",
        "id": 124424321,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1522435382
    },
    {
        "content": "<p>More like a \"our current interpreter and object file format aren't exactly standalone and also calling out to <code>curl</code> isn't very platform independent\" issue</p>",
        "id": 124424513,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1522435590
    },
    {
        "content": "<p>I.e. \"probably the wrong tool for the job\"</p>",
        "id": 124424525,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1522435625
    },
    {
        "content": "<p>What's wrong with having separate install instructions for each platform, as long as you can keep it to one line for each?</p>",
        "id": 124424541,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1522435648
    },
    {
        "content": "<p>It's not install instructions, the tool is supposed to download the correct Lean version by itself</p>",
        "id": 124424643,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1522435731
    },
    {
        "content": "<p>The current leanpkg code is already quite ham-fisted in a few ways, it's really not fun to program with such a minimal API</p>",
        "id": 124424767,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1522435861
    },
    {
        "content": "<p>What has a minimal API here? Lean or leanpkg?</p>",
        "id": 124424784,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1522435899
    },
    {
        "content": "<p>Lean</p>",
        "id": 124424789,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1522435919
    },
    {
        "content": "<p>Like... the most basic string functions</p>",
        "id": 124424838,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1522435932
    },
    {
        "content": "<p>There are a lot of list functions, can those be repurposed? Or do they have to be implemented in C</p>",
        "id": 124424894,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1522436012
    },
    {
        "content": "<p>I'd be happy to write what I can in lean, but I lack some necessary primitives</p>",
        "id": 124424899,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1522436035
    },
    {
        "content": "<p>Thanks, but that still leaves the other two issues... I suppose we could bundle wget for Windows with it if we really wanted to</p>",
        "id": 124425386,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1522436743
    },
    {
        "content": "<p>do you enjoy working on leanpkg? a quick and dirty solution is to use a cross-platform package manager that already exists</p>",
        "id": 124425428,
        "sender_full_name": "Andrew Ashworth",
        "timestamp": 1522436773
    },
    {
        "content": "<p>I guess I don't exactly... but I believe even the current leanpkg satisfies our specific needs better than a generic package manager ever could</p>",
        "id": 124425501,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1522436903
    },
    {
        "content": "<p>For another example, we'll probably have to parse the JSON returned from Github's Releases API</p>",
        "id": 124429614,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1522443574
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"110043\">@Gabriel Ebner</span> Thoughts?</p>",
        "id": 124429810,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1522443851
    },
    {
        "content": "<p><code>leanup</code> sounds reasonable to me.  I agree that it should be separately distributed.  It could even provide <code>lean</code> and <code>leanpkg</code> executables that automatically use the correct version depending on the <code>leanpkg.toml</code> (or download them if necessary).  Then we wouldn't even need to change any tooling that already uses <code>lean</code> or <code>leanpkg</code>.</p>",
        "id": 124453211,
        "sender_full_name": "Gabriel Ebner",
        "timestamp": 1522498221
    },
    {
        "content": "<p>In the long run, I think it should be written in Lean as well.  With code generation on the horizon, this shouldn't pose a problem for distribution.  And API-wise I guess there is some demand for networking functionality in Lean anyhow.  Parsing JSON is the easiest part, we have parser combinators. <span class=\"emoji emoji-1f604\" title=\"smile\">:smile:</span></p>",
        "id": 124453262,
        "sender_full_name": "Gabriel Ebner",
        "timestamp": 1522498420
    },
    {
        "content": "<p>For now, I believe that a rust implementation is fine.  It's probably even easier to distribute than a python script.</p>",
        "id": 124453308,
        "sender_full_name": "Gabriel Ebner",
        "timestamp": 1522498532
    },
    {
        "content": "<p>There should probably be a way to use local git builds via leanup as well.</p>",
        "id": 124453355,
        "sender_full_name": "Gabriel Ebner",
        "timestamp": 1522498653
    },
    {
        "content": "<p>Since we switched to static linking, the nightlies even work on NixOS.  So no complaints from my sides.  And if we switch back to dynamic linking, I'll just PR what we do in rustup: <a href=\"https://github.com/NixOS/nixpkgs/blob/599a2238386b6f1f293f888d068122b46e1bde23/pkgs/development/tools/rust/rustup/0001-dynamically-patchelf-binaries.patch\" target=\"_blank\" title=\"https://github.com/NixOS/nixpkgs/blob/599a2238386b6f1f293f888d068122b46e1bde23/pkgs/development/tools/rust/rustup/0001-dynamically-patchelf-binaries.patch\">https://github.com/NixOS/nixpkgs/blob/599a2238386b6f1f293f888d068122b46e1bde23/pkgs/development/tools/rust/rustup/0001-dynamically-patchelf-binaries.patch</a></p>",
        "id": 124453450,
        "sender_full_name": "Gabriel Ebner",
        "timestamp": 1522498830
    },
    {
        "content": "<blockquote>\n<p>In the long run, I think it should be written in Lean as well. </p>\n</blockquote>\n<p>I agree.</p>\n<blockquote>\n<p>It's probably even easier to distribute than a python script.</p>\n</blockquote>\n<p>Exactly, that was my main motivation.</p>\n<blockquote>\n<p>There should probably be a way to use local git builds via leanup as well. </p>\n</blockquote>\n<p>Yes, though I'm not yet sure what it should look like.</p>",
        "id": 124457614,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1522509508
    },
    {
        "content": "<blockquote>\n<p>Then we wouldn't even need to change any tooling that already uses <code>lean</code> or <code>leanpkg</code>. </p>\n</blockquote>\n<p>Right, though then I'd like to \"hijack\" <code>leanpkg configure</code> etc to also take care of setting up the correct Lean version.  I'm really not sure if that would be less confusing than telling people to use <code>leanup configure</code> instead of <code>leanpkg configure</code>.</p>",
        "id": 124457707,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1522509739
    },
    {
        "content": "<blockquote>\n<p>I'd like to \"hijack\" leanpkg configure etc to also take care of setting up the correct Lean version.</p>\n</blockquote>\n<p>My suggestion was to hijack <em>everything</em>, i.e., even if you call just <code>lean</code>, then <code>leanup</code>automatically determines the correct version in the background, downloads the binaries, and then runs the correct <code>lean</code> binary.</p>",
        "id": 124457812,
        "sender_full_name": "Gabriel Ebner",
        "timestamp": 1522510077
    },
    {
        "content": "<p>I think that's the easiest solution to support multiple lean versions in the editors.</p>",
        "id": 124457851,
        "sender_full_name": "Gabriel Ebner",
        "timestamp": 1522510108
    },
    {
        "content": "<p>Okay, bad example. What I meant was hijacking and changing the _semantics_ of e.g. <code>leanpkg add/upgrade</code> so that they respect nightly versions</p>",
        "id": 124457954,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1522510437
    },
    {
        "content": "<p>I think <em>everything</em> should respect the nightly versions.  That is, when you run <code>lean</code>, <code>leanup</code> looks for a <code>leanpkg.toml</code>, checks the <code>version</code> field, and then executes the correct <code>lean</code> executable.  How else would you work with two packages that require different Lean versions?</p>",
        "id": 124458003,
        "sender_full_name": "Gabriel Ebner",
        "timestamp": 1522510554
    },
    {
        "content": "<p>Or did you mean that <code>leanpkg upgrade</code> upgrades the version field as well?</p>",
        "id": 124458047,
        "sender_full_name": "Gabriel Ebner",
        "timestamp": 1522510626
    },
    {
        "content": "<p>No, I think there should be a separate command for upgrading the Lean version (just on <code>leanup</code> or should it be injected into <code>leanpkg</code> too??). I was thinking of <code>leanpkg upgrade</code> looking at the dependencies' Lean versions when deciding which commit to upgrade to. But perhaps that isn't really necessary - when <code>leanpkg</code> warns you that the Lean versions are out of sync when building an upgraded package, perhaps you're just supposed to run <code>lean-upgrade</code> afterwards.</p>",
        "id": 124458342,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1522511370
    },
    {
        "content": "<p>Ah, I see what you're talking about.  This is hard.  I don't think leanpkg warns you at the moment if one of the dependencies' Lean version is wrong.  It's also not clear which nightly version to pick (the one for dependency A, or the one for dependency B, or their maximum??).  If <code>leanpkg</code> however adjusts the <code>version</code> field correctly, then everything would just work with my proposal.</p>",
        "id": 124458442,
        "sender_full_name": "Gabriel Ebner",
        "timestamp": 1522511624
    },
    {
        "content": "<p>I.e. our main goal should be reproducibility when not touching the leanpkg.toml file. But when you want to upgrade either your Lean nightly version or a dependency's version, we probably shouldn't try to be \"clever\" but just jump to the upstream head of everything.</p>",
        "id": 124458483,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1522511677
    },
    {
        "content": "<blockquote>\n<p>I don't think leanpkg warns you at the moment if one of the dependencies' Lean version is wrong. </p>\n</blockquote>\n<p>Right. This would work automatically when we start building dependencies eagerly on <code>configure</code>.</p>",
        "id": 124458570,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1522511939
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"110024\">@Sebastian Ullrich</span> How can you tell what lean commit a nightly corresponds to? The bot botson commit doesn't say the commit hash anymore (and is now Leo?)</p>",
        "id": 124508035,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1522632862
    },
    {
        "content": "<p>Yes, Leo is now a bot <span class=\"emoji emoji-1f606\" title=\"laughing\">:laughing:</span></p>",
        "id": 124518628,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1522658118
    },
    {
        "content": "<p>The commit hash is next to the release description <a href=\"https://github.com/leanprover/lean-nightly/releases\" target=\"_blank\" title=\"https://github.com/leanprover/lean-nightly/releases\">https://github.com/leanprover/lean-nightly/releases</a></p>",
        "id": 124518667,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1522658194
    },
    {
        "content": "<p>Not sure why I removed it from the cmdline output...</p>",
        "id": 124518811,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1522658539
    },
    {
        "content": "<p>If anyone's wondering where the Windows nightlies are: Apparently you have to ask the AppVeyor guys personally to enable cron builds...</p>",
        "id": 124519318,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1522659635
    },
    {
        "content": "<p>I'm more wondering when will the mathlib have a tick mark</p>",
        "id": 124519322,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1522659659
    },
    {
        "content": "<p>Does anyone know a working combination of Lean nightly + mathlib which includes the <code>wlog</code> tactic?</p>",
        "id": 124530618,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1522681748
    },
    {
        "content": "<p>linux nighly of course</p>",
        "id": 124530628,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1522681787
    },
    {
        "content": "<p>so... leanpkg now helpfully says things like: <code> WARNING: Lean version mismatch: installed version is master, but package requires nightly-2018-04-06</code>.</p>",
        "id": 124785403,
        "sender_full_name": "Scott Morrison",
        "timestamp": 1523159822
    },
    {
        "content": "<p>Is there any automatic help installing the right version of Lean? (Or do I need to learn how to install nightlies, after happily working off master all this time?)</p>",
        "id": 124785409,
        "sender_full_name": "Scott Morrison",
        "timestamp": 1523159850
    },
    {
        "content": "<p>Sorry not answering your question but: is the warning about one of your dependencies or about your own package?</p>",
        "id": 124785503,
        "sender_full_name": "Simon Hudon",
        "timestamp": 1523160090
    },
    {
        "content": "<p>Attempting to learn how to install nightlies...<br>\n1) The first google result for \"lean nightly\" is the rather unhelpful &lt;<a href=\"https://github.com/leanprover/lean-nightly\" target=\"_blank\" title=\"https://github.com/leanprover/lean-nightly\">https://github.com/leanprover/lean-nightly</a>&gt;.<br>\n2) I downloaded the latest Lean nightly from &lt;<a href=\"https://leanprover.github.io/download/\" target=\"_blank\" title=\"https://leanprover.github.io/download/\">https://leanprover.github.io/download/</a>&gt;, but there's no way to determine which date it's from, and it still gives the same error.</p>",
        "id": 124785504,
        "sender_full_name": "Scott Morrison",
        "timestamp": 1523160105
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"110026\">@Simon Hudon</span>  --- sorry, should have specified this is trying to compile mathlib.</p>",
        "id": 124785505,
        "sender_full_name": "Scott Morrison",
        "timestamp": 1523160117
    },
    {
        "content": "<p>Am I meant to be installing nightlies from somewhere else?</p>",
        "id": 124785545,
        "sender_full_name": "Scott Morrison",
        "timestamp": 1523160147
    },
    {
        "content": "<p>Thanks! I can help if you just need help installing nightlies</p>",
        "id": 124785553,
        "sender_full_name": "Simon Hudon",
        "timestamp": 1523160226
    },
    {
        "content": "<p>Ah, I found &lt;<a href=\"https://github.com/leanprover/lean-nightly/releases\" target=\"_blank\" title=\"https://github.com/leanprover/lean-nightly/releases\">https://github.com/leanprover/lean-nightly/releases</a>&gt;.</p>",
        "id": 124785590,
        "sender_full_name": "Scott Morrison",
        "timestamp": 1523160245
    },
    {
        "content": "<p>Often, I just leech off of Mario's knowledge and look at <code>mathlib</code>'s travis file for that kind of stuff</p>",
        "id": 124785594,
        "sender_full_name": "Simon Hudon",
        "timestamp": 1523160262
    },
    {
        "content": "<p>The main README.md for that repository desperately needs to contain a link to the releases page.</p>",
        "id": 124785595,
        "sender_full_name": "Scott Morrison",
        "timestamp": 1523160264
    },
    {
        "content": "<p>(I've just made a pull request.)</p>",
        "id": 124785656,
        "sender_full_name": "Scott Morrison",
        "timestamp": 1523160479
    },
    {
        "content": "<p>To lean-nightly? It hasn't crossed the ocean yet, it seems. I don't see it</p>",
        "id": 124785744,
        "sender_full_name": "Simon Hudon",
        "timestamp": 1523160616
    },
    {
        "content": "<p>I fixed the leanpkg warnings for one of my projects by changing the obvious line in <code>leanpkg.toml</code> to <code>lean_version = \"nightly-2018-04-02\"</code></p>",
        "id": 124793413,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1523180153
    },
    {
        "content": "<p>Is anyone using a lean-nightly on OS X? When I try to use lean from a nightly, I just get:</p>\n<div class=\"codehilite\"><pre><span></span>dyld: Library not loaded: /usr/local/opt/gmp/lib/libgmp.10.dylib\n</pre></div>",
        "id": 124795679,
        "sender_full_name": "Scott Morrison",
        "timestamp": 1523185938
    },
    {
        "content": "<p>I'm pretty sure <code>gmp</code> is installed; plenty of other things are using it.</p>",
        "id": 124795682,
        "sender_full_name": "Scott Morrison",
        "timestamp": 1523185959
    },
    {
        "content": "<p>It seems for me that file is at <code>/opt/local/lib/libgmp.10.dylib</code> instead.</p>",
        "id": 124795747,
        "sender_full_name": "Scott Morrison",
        "timestamp": 1523186146
    },
    {
        "content": "<p>Is this some homebrew vs macports incompatibility?</p>",
        "id": 124795748,
        "sender_full_name": "Scott Morrison",
        "timestamp": 1523186157
    },
    {
        "content": "<p>Yup, with <code>gmp</code> provided by homebrew instead of macports, everything works.</p>",
        "id": 124795999,
        "sender_full_name": "Scott Morrison",
        "timestamp": 1523186737
    },
    {
        "content": "<p>In case you haven't seen the mathlib commits: <a href=\"https://github.com/Kha/elan\" target=\"_blank\" title=\"https://github.com/Kha/elan\">https://github.com/Kha/elan</a></p>",
        "id": 124950344,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1523480413
    },
    {
        "content": "<p>Thank you very much!</p>",
        "id": 124950367,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1523480459
    },
    {
        "content": "<p>Is this something we can already try?</p>",
        "id": 124950381,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1523480468
    },
    {
        "content": "<p>What does elan mean? Apart from being an anagram of lean?</p>",
        "id": 124950459,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1523480536
    },
    {
        "content": "<p>Ã©lan :) . Not an acronym... yet</p>",
        "id": 124950791,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1523480989
    },
    {
        "content": "<p>There may be some bugs and missing features, but I do believe it's usable already. mathlib's Travis config is now using it.</p>",
        "id": 124950868,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1523481072
    },
    {
        "content": "<p>Is there any kind of documentation?</p>",
        "id": 124950938,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1523481163
    },
    {
        "content": "<p>apart from mathlib travis?</p>",
        "id": 124950945,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1523481172
    },
    {
        "content": "<p>The individual commands are documented inside the tool, and, as the readme hopefully implies, you shouldn't even need to worry about those if you just want to use the right version of <code>leanpkg</code> for a package. Doc contributions are welcome, you guys seem to be very prolific in that.</p>",
        "id": 124951075,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1523481349
    },
    {
        "content": "<p><code>error: invalid channel name 'master' in 'lean-scratchpad/leanpkg.toml'\ninfo: caused by: invalid toolchain name: 'master'</code></p>",
        "id": 124951417,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1523481808
    },
    {
        "content": "<p>This is what I get when I try <code>leanpkg upgrade</code> after installing elan</p>",
        "id": 124951429,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1523481841
    },
    {
        "content": "<p>Right, <code>lean_version = \"master\"</code> used to be a thing... the preferred way is to set a specific nightly there now, but I guess we should still make <code>master</code> default to the <code>nightly</code> channel.</p>",
        "id": 124951521,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1523481951
    },
    {
        "content": "<p>what would be the syntax to specify a nightly?</p>",
        "id": 124951580,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1523481990
    },
    {
        "content": "<p>What if my specification is: whatever nightly works with that given mathlib version?</p>",
        "id": 124951588,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1523482012
    },
    {
        "content": "<p>Then you should copy the version from mathlib's config in your <code>_target</code> dir. I have plans to document how to deal with <code>elan</code> and <code>leanpkg upgrade</code>, but I first need to change <code>leanpkg</code> for that.</p>",
        "id": 124951743,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1523482221
    },
    {
        "content": "<p>Btw, you can also select toolchains like this: <code>leanpkg +nightly ...</code></p>",
        "id": 124951842,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1523482405
    },
    {
        "content": "<p>Ok, let me check my understanding. Currently this helps if I have different projects requiring different versions of Lean. But it does not help me if I have one project and I want to upgrade Lean+mathlib while keeping them in a consistent state?</p>",
        "id": 124951850,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1523482427
    },
    {
        "content": "<p>Or does it?</p>",
        "id": 124951910,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1523482524
    },
    {
        "content": "<p>I'm confused and I need to sleep</p>",
        "id": 124951913,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1523482532
    },
    {
        "content": "<p>Need to teach how to prove existence of <a href=\"https://www.youtube.com/watch?v=RYH_KXhF1SY\" target=\"_blank\" title=\"https://www.youtube.com/watch?v=RYH_KXhF1SY\">https://www.youtube.com/watch?v=RYH_KXhF1SY</a> tomorrow morning</p>\n<div class=\"youtube-video message_inline_image\"><a data-id=\"RYH_KXhF1SY\" href=\"https://www.youtube.com/watch?v=RYH_KXhF1SY\" target=\"_blank\" title=\"https://www.youtube.com/watch?v=RYH_KXhF1SY\"><img src=\"https://i.ytimg.com/vi/RYH_KXhF1SY/default.jpg\"></a></div>",
        "id": 124951965,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1523482608
    },
    {
        "content": "<p>It doesn't help you with selecting the best nightly version suitable for all your dependencies (which gets complicated with more than one dependency) _yet_. It does help you to then download and install that version after you've changed your leanpkg.toml.</p>",
        "id": 124952037,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1523482698
    },
    {
        "content": "<p>Yes, it seems it did that</p>",
        "id": 124952065,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1523482786
    },
    {
        "content": "<p>Any reson why leanpkg uses <code>upgrade</code> and elan uses <code>update</code>?</p>",
        "id": 124952116,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1523482806
    },
    {
        "content": "<p>Now I'm bound to hit the wrong one at least half the time</p>",
        "id": 124952123,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1523482817
    },
    {
        "content": "<p>Heh, I guess you're right. I didn't name either of them and am open to changing one of them.</p>",
        "id": 124952211,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1523482986
    },
    {
        "content": "<p>I have a slight preference for upgrade, because it's what apt uses when you actually want some change to installed stuff. But I wouldn't mind having update</p>",
        "id": 124952284,
        "sender_full_name": "Patrick Massot",
        "timestamp": 1523483088
    },
    {
        "content": "<p>I'm really excited to see Elan happen!</p>",
        "id": 124952922,
        "sender_full_name": "Simon Hudon",
        "timestamp": 1523484031
    },
    {
        "content": "<p>I tried to install it and got the following:</p>\n<div class=\"codehilite\"><pre><span></span>info: downloading component &#39;lean&#39;\n 18.1 MiB /  18.1 MiB (100 %) 210.8 KiB/s ETA:   0 s\ninfo: installing component &#39;lean&#39;\ninfo: rolling back changes\nerror: failed to extract package\ninfo: caused by: invalid gzip header\n</pre></div>",
        "id": 124952934,
        "sender_full_name": "Simon Hudon",
        "timestamp": 1523484045
    },
    {
        "content": "<p>Huh, that's a new one. OS X?</p>",
        "id": 124953252,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1523484490
    },
    {
        "content": "<p>Yes! Sorry, I should have said that</p>",
        "id": 124953261,
        "sender_full_name": "Simon Hudon",
        "timestamp": 1523484516
    },
    {
        "content": "<p>Oops, I thought we were using <code>.tar.gz</code> for OS X instead of <code>.zip</code> <span class=\"emoji emoji-1f606\" title=\"laughing\">:laughing:</span></p>",
        "id": 124953304,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1523484596
    },
    {
        "content": "<p>tsk tsk</p>",
        "id": 124953379,
        "sender_full_name": "Simon Hudon",
        "timestamp": 1523484641
    },
    {
        "content": "<p>On a slightly related note: any chance that <code>leanpkg</code> will get some <code>flycheck</code> support in the future?</p>",
        "id": 124953406,
        "sender_full_name": "Simon Hudon",
        "timestamp": 1523484679
    },
    {
        "content": "<p>What do you mean by that? The <code>leanpkg.toml</code>?</p>",
        "id": 124953415,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1523484717
    },
    {
        "content": "<p>I mean when you call <code>leanpkg build</code>, get the errors that you get in the flycheck error list buffer</p>",
        "id": 124953546,
        "sender_full_name": "Simon Hudon",
        "timestamp": 1523484849
    },
    {
        "content": "<p>Shouldn't it show the same errors already...? Or do you mean the format...?</p>",
        "id": 124953611,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1523484956
    },
    {
        "content": "<p>Okay, I'll have to fix OS X (and Windows) support tomorrow. The crazy thing is, the <code>elan</code> OS X release builds actually use <code>.tar.gz</code>. I took that from a CI template.</p>",
        "id": 124953693,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1523485031
    },
    {
        "content": "<p>Let me take you through a use case. I'm editting foo.lean which imports foobar.lean, bar.lean, barfoo.lean foo.lean, etc. I upgrade Lean and then mathlib and my project no longer type check so I do <code>M-x lean-leanpkg-build</code> to find the first thing that breaks and follow the series of breakages until I fixed everything. I want to fix stuff in the topological order of imports so that I don't have to fix the same file twice.</p>",
        "id": 124953770,
        "sender_full_name": "Simon Hudon",
        "timestamp": 1523485153
    },
    {
        "content": "<p>Thanks!</p>",
        "id": 124953772,
        "sender_full_name": "Simon Hudon",
        "timestamp": 1523485180
    },
    {
        "content": "<p>I believe I fixed elan, hopefully? <span class=\"emoji emoji-1f642\" title=\"simple smile\">:simple_smile:</span> /cc <span class=\"user-mention\" data-user-id=\"110026\">@Simon Hudon</span> <span class=\"user-mention\" data-user-id=\"110064\">@Kenny Lau</span></p>",
        "id": 124996475,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1523556576
    },
    {
        "content": "<p><a href=\"#narrow/stream/113488-general/topic/mathlib.20nightly.20dependence\" title=\"#narrow/stream/113488-general/topic/mathlib.20nightly.20dependence\">link to convo</a></p>",
        "id": 124996524,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1523556606
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span>$ curl https://raw.githubusercontent.com/Kha/elan/master/elan-init.sh -sSf | sh\ninfo: downloading installer\nsh: line 105: unzip: command not found\nchmod: cannot access &#39;/tmp/tmp.DIauNKqwfZ/elan-init.exe&#39;: No such file or directory\nelan: command failed: chmod u+x /tmp/tmp.DIauNKqwfZ/elan-init.exe\n</pre></div>",
        "id": 124996539,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1523556650
    },
    {
        "content": "<p>It now works! Thanks!</p>",
        "id": 124996610,
        "sender_full_name": "Simon Hudon",
        "timestamp": 1523556742
    },
    {
        "content": "<p>i guess i have to turn on the linux subsystem in windows, wait</p>",
        "id": 124996618,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1523556760
    },
    {
        "content": "<p>I just tried <code>install nightly</code> and got the following:</p>\n<div class=\"codehilite\"><pre><span></span>$ elan toolchain install nightly\n 51.3 KiB /  51.3 KiB (100 %)  40.5 KiB/s ETA:   0 s\ninfo: downloading component &#39;lean&#39;\n 16.8 MiB /  16.8 MiB (100 %) 176.8 KiB/s ETA:   0 s\ninfo: installing component &#39;lean&#39;\n\n  nightly-x86_64-apple-darwin installed - (error reading lean version)\n</pre></div>",
        "id": 124996911,
        "sender_full_name": "Simon Hudon",
        "timestamp": 1523557162
    },
    {
        "content": "<p>Lean seems sort of installed but here is what happens when I try to call it:</p>\n<div class=\"codehilite\"><pre><span></span>$ lean -v\nerror: command failed: &#39;lean&#39;\ninfo: caused by: Permission denied (os error 13)\n</pre></div>",
        "id": 124999701,
        "sender_full_name": "Simon Hudon",
        "timestamp": 1523560893
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"110026\">@Simon Hudon</span> But the initial stable installation worked o.o? What are the permissions on <code>~/.elan/toolchains/nightly-*/bin/lean</code>?</p>",
        "id": 125003682,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1523566160
    },
    {
        "content": "<p>Actually when installing elan, I also get trouble from <code>stable</code>:</p>\n<div class=\"codehilite\"><pre><span></span>1) Proceed with installation (default)\n2) Customize installation\n3) Cancel installation\n1\n\ninfo: downloading component &#39;lean&#39;\n 18.1 MiB /  18.1 MiB (100 %) 136.0 KiB/s ETA:   0 s\ninfo: installing component &#39;lean&#39;\ninfo: default toolchain set to &#39;stable&#39;\n\n  stable installed - (error reading lean version)\n\n\nElan is installed now. Great!\n</pre></div>\n\n\n<p>But I can call Lean: <code>lean -v</code></p>\n<div class=\"codehilite\"><pre><span></span>$ lean -v\nLean (version 3.3.1, commit d36b859c6579, RELEASE)\n</pre></div>",
        "id": 125004215,
        "sender_full_name": "Simon Hudon",
        "timestamp": 1523566976
    },
    {
        "content": "<p>To answer your question, here are the permission on <code>lean</code>:</p>\n<div class=\"codehilite\"><pre><span></span>$ ls -la ~/.elan/toolchains/nightly-*/bin/lean\n-rw-r--r--  1 simon  staff  12248272 12 Apr 17:04 /Users/simon/.elan/toolchains/nightly-x86_64-apple-darwin/bin/lean\n</pre></div>",
        "id": 125004376,
        "sender_full_name": "Simon Hudon",
        "timestamp": 1523567210
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"110026\">@Simon Hudon</span> Thanks, this should be fixed in 0.3.2. You can <code>elan self update</code> in a few minutes and reinstall the broken toolchains after removing them, or you can just do <code>chmod u+x ~/.elan/toolchains/*/bin/*</code> yourself of course.</p>",
        "id": 125006764,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1523570576
    },
    {
        "content": "<p>Thanks!</p>",
        "id": 125006775,
        "sender_full_name": "Simon Hudon",
        "timestamp": 1523570601
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"110064\">@Kenny Lau</span> What prompt were you using for that (mingw/cygwin/git bash)? Can't you install unzip there?</p>",
        "id": 125006927,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1523570807
    },
    {
        "content": "<p>I'm not sure what the best Windows installation method would be. Perhaps it's just \"download the latest Windows release, unpack it and run the exe in a cmd prompt\"?</p>",
        "id": 125007026,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1523570967
    },
    {
        "content": "<p>i think all the options for non-technical users kinda stink on windows, beyond vending a self-extracting zip or exe</p>",
        "id": 125008079,
        "sender_full_name": "Andrew Ashworth",
        "timestamp": 1523572682
    },
    {
        "content": "<p>Which commit does <code>stable</code> correspond to?</p>",
        "id": 125008355,
        "sender_full_name": "Simon Hudon",
        "timestamp": 1523573087
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"110024\">@Sebastian Ullrich</span> my antivirus goes into panic mode when i try to elan</p>",
        "id": 125014147,
        "sender_full_name": "Kenny Lau",
        "timestamp": 1523584506
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"110064\">@Kenny Lau</span> Gah. I don't think I can help with that.</p>",
        "id": 125022137,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1523602295
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"110026\">@Simon Hudon</span> The latest release at <a href=\"https://github.com/leanprover/lean/releases\" target=\"_blank\" title=\"https://github.com/leanprover/lean/releases\">https://github.com/leanprover/lean/releases</a>. Hopefully it should also be displayed by now?</p>",
        "id": 125022193,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1523602419
    },
    {
        "content": "<p>Huh, turns out elan can actually be installed by <a href=\"/user_uploads/3121/aTr--iw7q3zuQPTrImdZX9-x/pasted_image.png\" target=\"_blank\" title=\"pasted_image.png\">double-clicking it</a> on Windows</p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/3121/aTr--iw7q3zuQPTrImdZX9-x/pasted_image.png\" target=\"_blank\" title=\"double-clicking it\"><img src=\"/user_uploads/3121/aTr--iw7q3zuQPTrImdZX9-x/pasted_image.png\"></a></div>",
        "id": 125084643,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1523731753
    },
    {
        "content": "<p>So I think we're fine :)</p>",
        "id": 125084646,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1523731778
    },
    {
        "content": "<p>How does elan setup differ from previous leanpkg setup layout? I.e. locations of lean and leanpkg and installed repos</p>",
        "id": 125084833,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1523732203
    },
    {
        "content": "<p>The package and Lean root layout is the same. The only difference is that the binaries in <code>~/.elan/bin</code> are just shims pointing to a spefic Lean root in <code>~/.elan/toolchains</code>.</p>",
        "id": 125084932,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1523732413
    },
    {
        "content": "<p>Windows nightlies _finally_ working now <a href=\"https://github.com/leanprover/lean-nightly/releases/tag/nightly-2018-04-14\" target=\"_blank\" title=\"https://github.com/leanprover/lean-nightly/releases/tag/nightly-2018-04-14\">https://github.com/leanprover/lean-nightly/releases/tag/nightly-2018-04-14</a></p>",
        "id": 125107319,
        "sender_full_name": "Sebastian Ullrich",
        "timestamp": 1523788877
    }
]