[
    {
        "content": "<p>I'm trying to make a variant of one of the tactics in <a href=\"https://github.com/leanprover-community/mathlib/blob/master/docs/extras/tactic_writing.md\" target=\"_blank\" title=\"https://github.com/leanprover-community/mathlib/blob/master/docs/extras/tactic_writing.md\">tactic_writing.md</a>.  This example from the documentation works fine:</p>\n<div class=\"codehilite\"><pre><span></span><span class=\"n\">meta</span> <span class=\"n\">def</span> <span class=\"n\">trace_goal_is_eq</span> <span class=\"o\">:</span> <span class=\"n\">tactic</span> <span class=\"n\">unit</span> <span class=\"o\">:=</span>\n<span class=\"n\">do</span> <span class=\"o\">{</span> <span class=\"bp\">`</span><span class=\"o\">(</span><span class=\"err\">%%</span><span class=\"n\">l</span> <span class=\"bp\">=</span> <span class=\"err\">%%</span><span class=\"n\">r</span><span class=\"o\">)</span> <span class=\"err\">←</span> <span class=\"n\">tactic</span><span class=\"bp\">.</span><span class=\"n\">target</span><span class=\"o\">,</span>\n     <span class=\"n\">tactic</span><span class=\"bp\">.</span><span class=\"n\">trace</span> <span class=\"err\">$</span> <span class=\"s2\">&quot;Goal is equality between &quot;</span> <span class=\"bp\">++</span> <span class=\"o\">(</span><span class=\"n\">to_string</span> <span class=\"n\">l</span><span class=\"o\">)</span> <span class=\"bp\">++</span> <span class=\"s2\">&quot; and &quot;</span> <span class=\"bp\">++</span> <span class=\"o\">(</span><span class=\"n\">to_string</span> <span class=\"n\">r</span><span class=\"o\">)</span> <span class=\"o\">}</span>\n   <span class=\"bp\">&lt;|&gt;</span> <span class=\"n\">tactic</span><span class=\"bp\">.</span><span class=\"n\">trace</span> <span class=\"s2\">&quot;Goal is not an equality&quot;</span>\n</pre></div>\n\n\n<p>My proposed variant would pattern-match a quadratic <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>a</mi><msup><mi>x</mi><mn>2</mn></msup><mo>+</mo><mi>b</mi><mi>x</mi><mo>+</mo><mi>c</mi></mrow><annotation encoding=\"application/x-tex\">ax^2+bx+c</annotation></semantics></math></span><span aria-hidden=\"true\" class=\"katex-html\"><span class=\"strut\" style=\"height:0.8141079999999999em;\"></span><span class=\"strut bottom\" style=\"height:0.897438em;vertical-align:-0.08333em;\"></span><span class=\"base\"><span class=\"mord mathit\">a</span><span class=\"mord\"><span class=\"mord mathit\">x</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathrm mtight\">2</span></span></span></span></span></span></span></span><span class=\"mbin\">+</span><span class=\"mord mathit\">b</span><span class=\"mord mathit\">x</span><span class=\"mbin\">+</span><span class=\"mord mathit\">c</span></span></span></span> on the left hand side.  I tried this:</p>\n<div class=\"codehilite\"><pre><span></span><span class=\"n\">meta</span> <span class=\"n\">def</span> <span class=\"n\">trace_goal_is_quad_eq</span> <span class=\"o\">:</span> <span class=\"n\">tactic</span> <span class=\"n\">unit</span> <span class=\"o\">:=</span>\n<span class=\"n\">do</span> <span class=\"o\">{</span> <span class=\"bp\">`</span><span class=\"o\">(</span><span class=\"err\">%%</span><span class=\"n\">A</span> <span class=\"bp\">*</span> <span class=\"n\">x</span><span class=\"err\">^</span><span class=\"mi\">2</span> <span class=\"bp\">+</span> <span class=\"err\">%%</span><span class=\"n\">B</span> <span class=\"bp\">*</span> <span class=\"n\">x</span> <span class=\"bp\">+</span> <span class=\"err\">%%</span><span class=\"n\">C</span> <span class=\"bp\">=</span> <span class=\"err\">%%</span><span class=\"n\">r</span><span class=\"o\">)</span> <span class=\"err\">←</span> <span class=\"n\">tactic</span><span class=\"bp\">.</span><span class=\"n\">target</span><span class=\"o\">,</span>\n     <span class=\"n\">tactic</span><span class=\"bp\">.</span><span class=\"n\">trace</span> <span class=\"err\">$</span> <span class=\"s2\">&quot;Goal is equality between the quadratic &quot;</span>\n                     <span class=\"bp\">++</span> <span class=\"o\">(</span><span class=\"n\">to_string</span> <span class=\"n\">A</span><span class=\"o\">)</span> <span class=\"bp\">++</span> <span class=\"s2\">&quot;x^2 &quot;</span>\n                     <span class=\"bp\">++</span> <span class=\"o\">(</span><span class=\"n\">to_string</span> <span class=\"n\">B</span><span class=\"o\">)</span> <span class=\"bp\">++</span> <span class=\"s2\">&quot;x &quot;</span>\n                     <span class=\"bp\">++</span> <span class=\"o\">(</span><span class=\"n\">to_string</span> <span class=\"n\">C</span><span class=\"o\">)</span> <span class=\"bp\">++</span> <span class=\"s2\">&quot; and &quot;</span> <span class=\"bp\">++</span> <span class=\"o\">(</span><span class=\"n\">to_string</span> <span class=\"n\">r</span><span class=\"o\">)</span> <span class=\"o\">}</span>\n   <span class=\"bp\">&lt;|&gt;</span> <span class=\"n\">tactic</span><span class=\"bp\">.</span><span class=\"n\">trace</span> <span class=\"s2\">&quot;Goal is not an equality&quot;</span>\n</pre></div>\n\n\n<p>Here I get the error:</p>\n<blockquote>\n<p>unknown identifier ’x’<br>\ninvalid quotation, unsupported macro ’sorry’</p>\n</blockquote>\n<p>I also tried this:</p>\n<div class=\"codehilite\"><pre><span></span><span class=\"n\">meta</span> <span class=\"n\">def</span> <span class=\"n\">trace_goal_is_quad_eq&#39;</span> <span class=\"o\">:</span> <span class=\"n\">tactic</span> <span class=\"n\">unit</span> <span class=\"o\">:=</span>\n<span class=\"n\">do</span> <span class=\"o\">{</span> <span class=\"bp\">`</span><span class=\"o\">(</span><span class=\"err\">%%</span><span class=\"n\">A</span> <span class=\"bp\">*</span> <span class=\"err\">%%</span><span class=\"n\">x</span> <span class=\"err\">^</span> <span class=\"mi\">2</span> <span class=\"bp\">+</span> <span class=\"err\">%%</span><span class=\"n\">B</span> <span class=\"bp\">*</span> <span class=\"err\">%%</span><span class=\"n\">y</span> <span class=\"bp\">+</span> <span class=\"err\">%%</span><span class=\"n\">C</span> <span class=\"bp\">=</span> <span class=\"err\">%%</span><span class=\"n\">r</span><span class=\"o\">)</span> <span class=\"err\">←</span> <span class=\"n\">tactic</span><span class=\"bp\">.</span><span class=\"n\">target</span><span class=\"o\">,</span>\n     <span class=\"n\">tactic</span><span class=\"bp\">.</span><span class=\"n\">trace</span> <span class=\"err\">$</span> <span class=\"s2\">&quot;Goal is equality between the quadratic &quot;</span>\n                     <span class=\"bp\">++</span> <span class=\"o\">(</span><span class=\"n\">to_string</span> <span class=\"n\">A</span><span class=\"o\">)</span> <span class=\"bp\">++</span> <span class=\"s2\">&quot;x^2 &quot;</span>\n                     <span class=\"bp\">++</span> <span class=\"o\">(</span><span class=\"n\">to_string</span> <span class=\"n\">B</span><span class=\"o\">)</span> <span class=\"bp\">++</span> <span class=\"s2\">&quot;x &quot;</span>\n                     <span class=\"bp\">++</span> <span class=\"o\">(</span><span class=\"n\">to_string</span> <span class=\"n\">C</span><span class=\"o\">)</span> <span class=\"bp\">++</span> <span class=\"s2\">&quot; and &quot;</span> <span class=\"bp\">++</span> <span class=\"o\">(</span><span class=\"n\">to_string</span> <span class=\"n\">r</span><span class=\"o\">)</span> <span class=\"o\">}</span>\n   <span class=\"bp\">&lt;|&gt;</span> <span class=\"n\">tactic</span><span class=\"bp\">.</span><span class=\"n\">trace</span> <span class=\"s2\">&quot;Goal is not an equality&quot;</span>\n</pre></div>\n\n\n<blockquote>\n<p>equation compiler failed, maximum number of steps (2048) exceeded (possible solution: use ’set_option eqn_compiler.max_steps &lt;new-threshold&gt;’) (use ’set_option trace.eqn_compiler.elim_match true’ for additional details)</p>\n</blockquote>",
        "id": 162996015,
        "sender_full_name": "Joseph Corneli",
        "timestamp": 1554896318
    },
    {
        "content": "<p>If I remove the <code>^2</code>, the tactic definition is accepted.</p>",
        "id": 162996161,
        "sender_full_name": "Joseph Corneli",
        "timestamp": 1554896485
    },
    {
        "content": "<p>But this isn't accepted:</p>\n<div class=\"codehilite\"><pre><span></span><span class=\"n\">meta</span> <span class=\"n\">def</span> <span class=\"n\">trace_goal_is_quad_eq&#39;&#39;</span> <span class=\"o\">:</span> <span class=\"n\">tactic</span> <span class=\"n\">unit</span> <span class=\"o\">:=</span>\n<span class=\"n\">do</span> <span class=\"o\">{</span> <span class=\"bp\">`</span><span class=\"o\">(</span><span class=\"err\">%%</span><span class=\"n\">A</span> <span class=\"bp\">*</span> <span class=\"err\">%%</span><span class=\"n\">x</span> <span class=\"err\">^</span> <span class=\"err\">%%</span><span class=\"n\">e</span> <span class=\"bp\">+</span> <span class=\"err\">%%</span><span class=\"n\">B</span> <span class=\"bp\">*</span> <span class=\"err\">%%</span><span class=\"n\">y</span> <span class=\"bp\">+</span> <span class=\"err\">%%</span><span class=\"n\">C</span> <span class=\"bp\">=</span> <span class=\"err\">%%</span><span class=\"n\">r</span><span class=\"o\">)</span> <span class=\"err\">←</span> <span class=\"n\">tactic</span><span class=\"bp\">.</span><span class=\"n\">target</span><span class=\"o\">,</span>\n     <span class=\"n\">tactic</span><span class=\"bp\">.</span><span class=\"n\">trace</span> <span class=\"err\">$</span> <span class=\"s2\">&quot;Goal is equality between the quadratic &quot;</span>\n                     <span class=\"bp\">++</span> <span class=\"o\">(</span><span class=\"n\">to_string</span> <span class=\"n\">A</span><span class=\"o\">)</span> <span class=\"bp\">++</span> <span class=\"s2\">&quot;x^2 &quot;</span>\n                     <span class=\"bp\">++</span> <span class=\"o\">(</span><span class=\"n\">to_string</span> <span class=\"n\">B</span><span class=\"o\">)</span> <span class=\"bp\">++</span> <span class=\"s2\">&quot;x &quot;</span>\n                     <span class=\"bp\">++</span> <span class=\"o\">(</span><span class=\"n\">to_string</span> <span class=\"n\">C</span><span class=\"o\">)</span> <span class=\"bp\">++</span> <span class=\"s2\">&quot; and &quot;</span> <span class=\"bp\">++</span> <span class=\"o\">(</span><span class=\"n\">to_string</span> <span class=\"n\">r</span><span class=\"o\">)</span> <span class=\"o\">}</span>\n   <span class=\"bp\">&lt;|&gt;</span> <span class=\"n\">tactic</span><span class=\"bp\">.</span><span class=\"n\">trace</span> <span class=\"s2\">&quot;Goal is not an equality&quot;</span>\n</pre></div>",
        "id": 162996362,
        "sender_full_name": "Joseph Corneli",
        "timestamp": 1554896669
    },
    {
        "content": "<p>Curiously, this works:</p>",
        "id": 162996624,
        "sender_full_name": "Keeley Hoek",
        "timestamp": 1554896889
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span><span class=\"n\">meta</span> <span class=\"n\">def</span> <span class=\"n\">trace_goal_is_quad_eq</span> <span class=\"o\">:</span> <span class=\"n\">tactic</span> <span class=\"n\">unit</span> <span class=\"o\">:=</span>\n<span class=\"n\">do</span> <span class=\"o\">{</span> <span class=\"bp\">`</span><span class=\"o\">(</span><span class=\"err\">%%</span><span class=\"n\">A</span> <span class=\"bp\">*</span> <span class=\"n\">nat</span><span class=\"bp\">.</span><span class=\"n\">pow</span> <span class=\"err\">%%</span><span class=\"n\">n</span> <span class=\"err\">%%</span><span class=\"n\">x</span> <span class=\"bp\">+</span> <span class=\"err\">%%</span><span class=\"n\">B</span> <span class=\"bp\">*</span> <span class=\"err\">%%</span><span class=\"n\">y</span> <span class=\"bp\">+</span> <span class=\"err\">%%</span><span class=\"n\">C</span> <span class=\"bp\">=</span> <span class=\"err\">%%</span><span class=\"n\">r</span><span class=\"o\">)</span> <span class=\"err\">←</span> <span class=\"n\">tactic</span><span class=\"bp\">.</span><span class=\"n\">target</span><span class=\"o\">,</span>\n     <span class=\"n\">tactic</span><span class=\"bp\">.</span><span class=\"n\">trace</span> <span class=\"err\">$</span> <span class=\"s2\">&quot;Goal is equality between the quadratic &quot;</span>\n                     <span class=\"bp\">++</span> <span class=\"o\">(</span><span class=\"n\">to_string</span> <span class=\"n\">A</span><span class=\"o\">)</span> <span class=\"bp\">++</span> <span class=\"s2\">&quot;x^2 &quot;</span>\n                     <span class=\"bp\">++</span> <span class=\"o\">(</span><span class=\"n\">to_string</span> <span class=\"n\">B</span><span class=\"o\">)</span> <span class=\"bp\">++</span> <span class=\"s2\">&quot;x &quot;</span>\n                     <span class=\"bp\">++</span> <span class=\"o\">(</span><span class=\"n\">to_string</span> <span class=\"n\">C</span><span class=\"o\">)</span> <span class=\"bp\">++</span> <span class=\"s2\">&quot; and &quot;</span> <span class=\"bp\">++</span> <span class=\"o\">(</span><span class=\"n\">to_string</span> <span class=\"n\">r</span><span class=\"o\">)</span> <span class=\"o\">}</span>\n   <span class=\"bp\">&lt;|&gt;</span> <span class=\"n\">tactic</span><span class=\"bp\">.</span><span class=\"n\">trace</span> <span class=\"s2\">&quot;Goal is not an equality&quot;</span>\n</pre></div>",
        "id": 162996629,
        "sender_full_name": "Keeley Hoek",
        "timestamp": 1554896892
    },
    {
        "content": "<p>ah!</p>",
        "id": 162996631,
        "sender_full_name": "Joseph Corneli",
        "timestamp": 1554896901
    },
    {
        "content": "<p>(But you have to manually write out the pow)</p>",
        "id": 162996666,
        "sender_full_name": "Keeley Hoek",
        "timestamp": 1554896950
    },
    {
        "content": "<p>From that, it seems <code>*</code> and <code>+</code> are acceptable as \"sugar\" inside of such expressions, and <code>^</code> is not...?  Is there a place to find the list of sugared variants?</p>",
        "id": 162996676,
        "sender_full_name": "Joseph Corneli",
        "timestamp": 1554896970
    },
    {
        "content": "<p>Anyway thanks for helping me get going here <span class=\"user-mention\" data-user-id=\"110111\">@Keeley Hoek</span></p>",
        "id": 162996695,
        "sender_full_name": "Joseph Corneli",
        "timestamp": 1554897001
    },
    {
        "content": "<p>I don't think it's so simple, because this compiles as well:</p>\n<div class=\"codehilite\"><pre><span></span><span class=\"n\">meta</span> <span class=\"n\">def</span> <span class=\"n\">trace_goal_is_quad_eq&#39;&#39;</span> <span class=\"o\">:</span> <span class=\"n\">tactic</span> <span class=\"n\">unit</span> <span class=\"o\">:=</span>\n<span class=\"n\">do</span> <span class=\"o\">{</span> <span class=\"bp\">`</span><span class=\"o\">(</span><span class=\"err\">%%</span><span class=\"n\">A</span> <span class=\"bp\">*</span> <span class=\"err\">%%</span><span class=\"n\">x</span> <span class=\"err\">^</span> <span class=\"err\">%%</span><span class=\"n\">e</span> <span class=\"bp\">+</span> <span class=\"err\">%%</span><span class=\"n\">C</span> <span class=\"bp\">=</span> <span class=\"err\">%%</span><span class=\"n\">r</span><span class=\"o\">)</span> <span class=\"err\">←</span> <span class=\"n\">tactic</span><span class=\"bp\">.</span><span class=\"n\">target</span><span class=\"o\">,</span>\n     <span class=\"n\">tactic</span><span class=\"bp\">.</span><span class=\"n\">trace</span> <span class=\"err\">$</span> <span class=\"s2\">&quot;Goal is equality between the quadratic &quot;</span>\n                     <span class=\"bp\">++</span> <span class=\"o\">(</span><span class=\"n\">to_string</span> <span class=\"n\">A</span><span class=\"o\">)</span> <span class=\"bp\">++</span> <span class=\"s2\">&quot;x^2 &quot;</span>\n                     <span class=\"bp\">++</span> <span class=\"o\">(</span><span class=\"n\">to_string</span> <span class=\"n\">C</span><span class=\"o\">)</span> <span class=\"bp\">++</span> <span class=\"s2\">&quot; and &quot;</span> <span class=\"bp\">++</span> <span class=\"o\">(</span><span class=\"n\">to_string</span> <span class=\"n\">r</span><span class=\"o\">)</span> <span class=\"o\">}</span>\n   <span class=\"bp\">&lt;|&gt;</span> <span class=\"n\">tactic</span><span class=\"bp\">.</span><span class=\"n\">trace</span> <span class=\"s2\">&quot;Goal is not an equality&quot;</span>\n</pre></div>",
        "id": 162996775,
        "sender_full_name": "Keeley Hoek",
        "timestamp": 1554897029
    },
    {
        "content": "<p><span aria-label=\"queasy\" class=\"emoji emoji-1f922\" role=\"img\" title=\"queasy\">:queasy:</span></p>",
        "id": 162996796,
        "sender_full_name": "Joseph Corneli",
        "timestamp": 1554897061
    },
    {
        "content": "<p>Ohk, I think I'm understanding. This is just a guess, but: I think the equation compiler might be doing something crazy like making a pattern for all the possible <code>had_add</code>, etc... instances which it knows about. Or maybe there are just somehow a lot of cases.<br>\nRegardless, </p>\n<div class=\"codehilite\"><pre><span></span>set_option eqn_compiler.max_steps 10000\n</pre></div>\n\n\n<p>really does make your original code work...</p>",
        "id": 162996908,
        "sender_full_name": "Keeley Hoek",
        "timestamp": 1554897139
    },
    {
        "content": "<p>:O</p>",
        "id": 162996915,
        "sender_full_name": "Keeley Hoek",
        "timestamp": 1554897144
    },
    {
        "content": "<p>\"When in doubt follow the instructions\" ???</p>",
        "id": 162996967,
        "sender_full_name": "Joseph Corneli",
        "timestamp": 1554897186
    },
    {
        "content": "<p>\"And when making wild guesses follow the instructions more\"? :D <code>\nset_option trace.eqn_compiler.elim_match true</code> lets you see what's actually happening</p>",
        "id": 162997065,
        "sender_full_name": "Keeley Hoek",
        "timestamp": 1554897220
    },
    {
        "content": "<p>It really is just a massive case bash on all of the <code>expr</code> constructors</p>",
        "id": 162997229,
        "sender_full_name": "Keeley Hoek",
        "timestamp": 1554897286
    },
    {
        "content": "<p>I'mma let you finish but </p>\n<div class=\"codehilite\"><pre><span></span><span class=\"o\">[</span><span class=\"n\">eqn_compiler</span><span class=\"bp\">.</span><span class=\"n\">elim_match</span><span class=\"o\">]</span> <span class=\"n\">depth</span> <span class=\"o\">[</span><span class=\"mi\">1</span><span class=\"o\">]</span>\n<span class=\"k\">match</span> <span class=\"n\">trace_goal_is_quad_eq&#39;&#39;</span> <span class=\"o\">:</span> <span class=\"n\">tactic</span> <span class=\"n\">unit</span><span class=\"o\">[]</span>\n   <span class=\"o\">:=</span>\n    <span class=\"o\">(</span><span class=\"n\">tactic</span><span class=\"bp\">.</span><span class=\"n\">target</span> <span class=\"bp\">&gt;&gt;=</span>\n         <span class=\"bp\">λ</span> <span class=\"o\">(</span><span class=\"bp\">_</span><span class=\"n\">p</span> <span class=\"o\">:</span> <span class=\"n\">expr</span><span class=\"o\">),</span>\n           <span class=\"o\">(</span><span class=\"bp\">λ</span> <span class=\"o\">(</span><span class=\"bp\">_</span><span class=\"n\">a</span> <span class=\"o\">:</span> <span class=\"n\">expr</span><span class=\"o\">),</span>\n              <span class=\"n\">expr</span><span class=\"bp\">.</span><span class=\"n\">cases_on</span> <span class=\"bp\">_</span><span class=\"n\">a</span> <span class=\"o\">(</span><span class=\"bp\">λ</span> <span class=\"o\">(</span><span class=\"n\">a</span> <span class=\"o\">:</span> <span class=\"bp\">ℕ</span><span class=\"o\">),</span> <span class=\"n\">id_rhs</span> <span class=\"o\">(</span><span class=\"n\">tactic</span> <span class=\"n\">unit</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">match_failed</span> <span class=\"n\">interaction_monad</span><span class=\"bp\">.</span><span class=\"n\">monad_fail</span><span class=\"o\">))</span>\n                <span class=\"o\">(</span><span class=\"bp\">λ</span> <span class=\"o\">(</span><span class=\"n\">a</span> <span class=\"o\">:</span> <span class=\"n\">level</span><span class=\"o\">),</span> <span class=\"n\">id_rhs</span> <span class=\"o\">(</span><span class=\"n\">tactic</span> <span class=\"n\">unit</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">match_failed</span> <span class=\"n\">interaction_monad</span><span class=\"bp\">.</span><span class=\"n\">monad_fail</span><span class=\"o\">))</span>\n                <span class=\"o\">(</span><span class=\"bp\">λ</span> <span class=\"o\">(</span><span class=\"n\">a</span> <span class=\"o\">:</span> <span class=\"n\">name</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">a_1</span> <span class=\"o\">:</span> <span class=\"n\">list</span> <span class=\"n\">level</span><span class=\"o\">),</span> <span class=\"n\">id_rhs</span> <span class=\"o\">(</span><span class=\"n\">tactic</span> <span class=\"n\">unit</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">match_failed</span> <span class=\"n\">interaction_monad</span><span class=\"bp\">.</span><span class=\"n\">monad_fail</span><span class=\"o\">))</span>\n                <span class=\"o\">(</span><span class=\"bp\">λ</span> <span class=\"o\">(</span><span class=\"n\">a</span> <span class=\"n\">a_1</span> <span class=\"o\">:</span> <span class=\"n\">name</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">a_2</span> <span class=\"o\">:</span> <span class=\"n\">expr</span><span class=\"o\">),</span> <span class=\"n\">id_rhs</span> <span class=\"o\">(</span><span class=\"n\">tactic</span> <span class=\"n\">unit</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">match_failed</span> <span class=\"n\">interaction_monad</span><span class=\"bp\">.</span><span class=\"n\">monad_fail</span><span class=\"o\">))</span>\n                <span class=\"o\">(</span><span class=\"bp\">λ</span> <span class=\"o\">(</span><span class=\"n\">a</span> <span class=\"n\">a_1</span> <span class=\"o\">:</span> <span class=\"n\">name</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">a_2</span> <span class=\"o\">:</span> <span class=\"n\">binder_info</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">a_3</span> <span class=\"o\">:</span> <span class=\"n\">expr</span><span class=\"o\">),</span>\n                   <span class=\"n\">id_rhs</span> <span class=\"o\">(</span><span class=\"n\">tactic</span> <span class=\"n\">unit</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">match_failed</span> <span class=\"n\">interaction_monad</span><span class=\"bp\">.</span><span class=\"n\">monad_fail</span><span class=\"o\">))</span>\n                <span class=\"o\">(</span><span class=\"bp\">λ</span> <span class=\"o\">(</span><span class=\"n\">a</span> <span class=\"n\">a_1</span> <span class=\"o\">:</span> <span class=\"n\">expr</span><span class=\"o\">),</span>\n                   <span class=\"n\">expr</span><span class=\"bp\">.</span><span class=\"n\">cases_on</span> <span class=\"n\">a</span> <span class=\"o\">(</span><span class=\"bp\">λ</span> <span class=\"o\">(</span><span class=\"n\">a</span> <span class=\"o\">:</span> <span class=\"bp\">ℕ</span><span class=\"o\">),</span> <span class=\"n\">id_rhs</span> <span class=\"o\">(</span><span class=\"n\">tactic</span> <span class=\"n\">unit</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">match_failed</span> <span class=\"n\">interaction_monad</span><span class=\"bp\">.</span><span class=\"n\">monad_fail</span><span class=\"o\">))</span>\n                     <span class=\"o\">(</span><span class=\"bp\">λ</span> <span class=\"o\">(</span><span class=\"n\">a</span> <span class=\"o\">:</span> <span class=\"n\">level</span><span class=\"o\">),</span> <span class=\"n\">id_rhs</span> <span class=\"o\">(</span><span class=\"n\">tactic</span> <span class=\"n\">unit</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">match_failed</span> <span class=\"n\">interaction_monad</span><span class=\"bp\">.</span><span class=\"n\">monad_fail</span><span class=\"o\">))</span>\n                     <span class=\"o\">(</span><span class=\"bp\">λ</span> <span class=\"o\">(</span><span class=\"n\">a_a</span> <span class=\"o\">:</span> <span class=\"n\">name</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">a_a_1</span> <span class=\"o\">:</span> <span class=\"n\">list</span> <span class=\"n\">level</span><span class=\"o\">),</span>\n                        <span class=\"n\">id_rhs</span> <span class=\"o\">(</span><span class=\"n\">tactic</span> <span class=\"n\">unit</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">match_failed</span> <span class=\"n\">interaction_monad</span><span class=\"bp\">.</span><span class=\"n\">monad_fail</span><span class=\"o\">))</span>\n                     <span class=\"o\">(</span><span class=\"bp\">λ</span> <span class=\"o\">(</span><span class=\"n\">a_a</span> <span class=\"n\">a_a_1</span> <span class=\"o\">:</span> <span class=\"n\">name</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">a_a_2</span> <span class=\"o\">:</span> <span class=\"n\">expr</span><span class=\"o\">),</span>\n                        <span class=\"n\">id_rhs</span> <span class=\"o\">(</span><span class=\"n\">tactic</span> <span class=\"n\">unit</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">match_failed</span> <span class=\"n\">interaction_monad</span><span class=\"bp\">.</span><span class=\"n\">monad_fail</span><span class=\"o\">))</span>\n                     <span class=\"o\">(</span><span class=\"bp\">λ</span> <span class=\"o\">(</span><span class=\"n\">a_a</span> <span class=\"n\">a_a_1</span> <span class=\"o\">:</span> <span class=\"n\">name</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">a_a_2</span> <span class=\"o\">:</span> <span class=\"n\">binder_info</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">a_a_3</span> <span class=\"o\">:</span> <span class=\"n\">expr</span><span class=\"o\">),</span>\n                        <span class=\"n\">id_rhs</span> <span class=\"o\">(</span><span class=\"n\">tactic</span> <span class=\"n\">unit</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">match_failed</span> <span class=\"n\">interaction_monad</span><span class=\"bp\">.</span><span class=\"n\">monad_fail</span><span class=\"o\">))</span>\n                     <span class=\"o\">(</span><span class=\"bp\">λ</span> <span class=\"o\">(</span><span class=\"n\">a_a</span> <span class=\"n\">a_a_1</span> <span class=\"o\">:</span> <span class=\"n\">expr</span><span class=\"o\">),</span>\n                        <span class=\"n\">expr</span><span class=\"bp\">.</span><span class=\"n\">cases_on</span> <span class=\"n\">a_a</span>\n                          <span class=\"o\">(</span><span class=\"bp\">λ</span> <span class=\"o\">(</span><span class=\"n\">a_a</span> <span class=\"o\">:</span> <span class=\"bp\">ℕ</span><span class=\"o\">),</span> <span class=\"n\">id_rhs</span> <span class=\"o\">(</span><span class=\"n\">tactic</span> <span class=\"n\">unit</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">match_failed</span> <span class=\"n\">interaction_monad</span><span class=\"bp\">.</span><span class=\"n\">monad_fail</span><span class=\"o\">))</span>\n                          <span class=\"o\">(</span><span class=\"bp\">λ</span> <span class=\"o\">(</span><span class=\"n\">a_a</span> <span class=\"o\">:</span> <span class=\"n\">level</span><span class=\"o\">),</span> <span class=\"n\">id_rhs</span> <span class=\"o\">(</span><span class=\"n\">tactic</span> <span class=\"n\">unit</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">match_failed</span> <span class=\"n\">interaction_monad</span><span class=\"bp\">.</span><span class=\"n\">monad_fail</span><span class=\"o\">))</span>\n                          <span class=\"o\">(</span><span class=\"bp\">λ</span> <span class=\"o\">(</span><span class=\"n\">a_a_a</span> <span class=\"o\">:</span> <span class=\"n\">name</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">a_a_a_1</span> <span class=\"o\">:</span> <span class=\"n\">list</span> <span class=\"n\">level</span><span class=\"o\">),</span>\n                             <span class=\"n\">id_rhs</span> <span class=\"o\">(</span><span class=\"n\">tactic</span> <span class=\"n\">unit</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">match_failed</span> <span class=\"n\">interaction_monad</span><span class=\"bp\">.</span><span class=\"n\">monad_fail</span><span class=\"o\">))</span>\n                          <span class=\"o\">(</span><span class=\"bp\">λ</span> <span class=\"o\">(</span><span class=\"n\">a_a_a</span> <span class=\"n\">a_a_a_1</span> <span class=\"o\">:</span> <span class=\"n\">name</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">a_a_a_2</span> <span class=\"o\">:</span> <span class=\"n\">expr</span><span class=\"o\">),</span>\n                             <span class=\"n\">id_rhs</span> <span class=\"o\">(</span><span class=\"n\">tactic</span> <span class=\"n\">unit</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">match_failed</span> <span class=\"n\">interaction_monad</span><span class=\"bp\">.</span><span class=\"n\">monad_fail</span><span class=\"o\">))</span>\n                          <span class=\"o\">(</span><span class=\"bp\">λ</span> <span class=\"o\">(</span><span class=\"n\">a_a_a</span> <span class=\"n\">a_a_a_1</span> <span class=\"o\">:</span> <span class=\"n\">name</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">a_a_a_2</span> <span class=\"o\">:</span> <span class=\"n\">binder_info</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">a_a_a_3</span> <span class=\"o\">:</span> <span class=\"n\">expr</span><span class=\"o\">),</span>\n                             <span class=\"n\">id_rhs</span> <span class=\"o\">(</span><span class=\"n\">tactic</span> <span class=\"n\">unit</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">match_failed</span> <span class=\"n\">interaction_monad</span><span class=\"bp\">.</span><span class=\"n\">monad_fail</span><span class=\"o\">))</span>\n                          <span class=\"o\">(</span><span class=\"bp\">λ</span> <span class=\"o\">(</span><span class=\"n\">a_a_a</span> <span class=\"n\">a_a_a_1</span> <span class=\"o\">:</span> <span class=\"n\">expr</span><span class=\"o\">),</span>\n                             <span class=\"n\">expr</span><span class=\"bp\">.</span><span class=\"n\">cases_on</span> <span class=\"n\">a_a_a</span>\n                               <span class=\"o\">(</span><span class=\"bp\">λ</span> <span class=\"o\">(</span><span class=\"n\">a_a_a</span> <span class=\"o\">:</span> <span class=\"bp\">ℕ</span><span class=\"o\">),</span> <span class=\"n\">id_rhs</span> <span class=\"o\">(</span><span class=\"n\">tactic</span> <span class=\"n\">unit</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">match_failed</span> <span class=\"n\">interaction_monad</span><span class=\"bp\">.</span><span class=\"n\">monad_fail</span><span class=\"o\">))</span>\n                               <span class=\"o\">(</span><span class=\"bp\">λ</span> <span class=\"o\">(</span><span class=\"n\">a_a_a</span> <span class=\"o\">:</span> <span class=\"n\">level</span><span class=\"o\">),</span> <span class=\"n\">id_rhs</span> <span class=\"o\">(</span><span class=\"n\">tactic</span> <span class=\"n\">unit</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">match_failed</span> <span class=\"n\">interaction_monad</span><span class=\"bp\">.</span><span class=\"n\">monad_fail</span><span class=\"o\">))</span>\n                               <span class=\"o\">(</span><span class=\"bp\">λ</span> <span class=\"o\">(</span><span class=\"n\">a_a_a_a</span> <span class=\"o\">:</span> <span class=\"n\">name</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">a_a_a_a_1</span> <span class=\"o\">:</span> <span class=\"n\">list</span> <span class=\"n\">level</span><span class=\"o\">),</span>\n                                  <span class=\"n\">ite</span> <span class=\"o\">(</span><span class=\"n\">a_a_a_a</span> <span class=\"bp\">=</span> <span class=\"n\">name</span><span class=\"bp\">.</span><span class=\"n\">mk_string</span> <span class=\"s2\">&quot;eq&quot;</span> <span class=\"n\">name</span><span class=\"bp\">.</span><span class=\"n\">anonymous</span><span class=\"o\">)</span>\n                                    <span class=\"o\">(</span><span class=\"n\">expr</span><span class=\"bp\">.</span><span class=\"n\">cases_on</span> <span class=\"n\">a_a_1</span>\n                                       <span class=\"o\">(</span><span class=\"bp\">λ</span> <span class=\"o\">(</span><span class=\"n\">a_a_1</span> <span class=\"o\">:</span> <span class=\"bp\">ℕ</span><span class=\"o\">),</span>\n                                          <span class=\"n\">id_rhs</span> <span class=\"o\">(</span><span class=\"n\">tactic</span> <span class=\"n\">unit</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">match_failed</span> <span class=\"n\">interaction_monad</span><span class=\"bp\">.</span><span class=\"n\">monad_fail</span><span class=\"o\">))</span>\n                                       <span class=\"o\">(</span><span class=\"bp\">λ</span> <span class=\"o\">(</span><span class=\"n\">a_a_1</span> <span class=\"o\">:</span> <span class=\"n\">level</span><span class=\"o\">),</span>\n                                          <span class=\"n\">id_rhs</span> <span class=\"o\">(</span><span class=\"n\">tactic</span> <span class=\"n\">unit</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">match_failed</span> <span class=\"n\">interaction_monad</span><span class=\"bp\">.</span><span class=\"n\">monad_fail</span><span class=\"o\">))</span>\n                                       <span class=\"o\">(</span><span class=\"bp\">λ</span> <span class=\"o\">(</span><span class=\"n\">a_a_1_a</span> <span class=\"o\">:</span> <span class=\"n\">name</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">a_a_1_a_1</span> <span class=\"o\">:</span> <span class=\"n\">list</span> <span class=\"n\">level</span><span class=\"o\">),</span>\n                                          <span class=\"n\">id_rhs</span> <span class=\"o\">(</span><span class=\"n\">tactic</span> <span class=\"n\">unit</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">match_failed</span> <span class=\"n\">interaction_monad</span><span class=\"bp\">.</span><span class=\"n\">monad_fail</span><span class=\"o\">))</span>\n                                       <span class=\"o\">(</span><span class=\"bp\">λ</span> <span class=\"o\">(</span><span class=\"n\">a_a_1_a</span> <span class=\"n\">a_a_1_a_1</span> <span class=\"o\">:</span> <span class=\"n\">name</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">a_a_1_a_2</span> <span class=\"o\">:</span> <span class=\"n\">expr</span><span class=\"o\">),</span>\n                                          <span class=\"n\">id_rhs</span> <span class=\"o\">(</span><span class=\"n\">tactic</span> <span class=\"n\">unit</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">match_failed</span> <span class=\"n\">interaction_monad</span><span class=\"bp\">.</span><span class=\"n\">monad_fail</span><span class=\"o\">))</span>\n                                       <span class=\"o\">(</span><span class=\"bp\">λ</span> <span class=\"o\">(</span><span class=\"n\">a_a_1_a</span> <span class=\"n\">a_a_1_a_1</span> <span class=\"o\">:</span> <span class=\"n\">name</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">a_a_1_a_2</span> <span class=\"o\">:</span> <span class=\"n\">binder_info</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">a_a_1_a_3</span> <span class=\"o\">:</span> <span class=\"n\">expr</span><span class=\"o\">),</span>\n                                          <span class=\"n\">id_rhs</span> <span class=\"o\">(</span><span class=\"n\">tactic</span> <span class=\"n\">unit</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">match_failed</span> <span class=\"n\">interaction_monad</span><span class=\"bp\">.</span><span class=\"n\">monad_fail</span><span class=\"o\">))</span>\n                                       <span class=\"o\">(</span><span class=\"bp\">λ</span> <span class=\"o\">(</span><span class=\"n\">a_a_1_a</span> <span class=\"n\">a_a_1_a_1</span> <span class=\"o\">:</span> <span class=\"n\">expr</span><span class=\"o\">),</span>\n                                          <span class=\"n\">expr</span><span class=\"bp\">.</span><span class=\"n\">cases_on</span> <span class=\"n\">a_a_1_a</span>\n                                            <span class=\"o\">(</span><span class=\"bp\">λ</span> <span class=\"o\">(</span><span class=\"n\">a_a_1_a</span> <span class=\"o\">:</span> <span class=\"bp\">ℕ</span><span class=\"o\">),</span>\n                                               <span class=\"n\">id_rhs</span> <span class=\"o\">(</span><span class=\"n\">tactic</span> <span class=\"n\">unit</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">match_failed</span> <span class=\"n\">interaction_monad</span><span class=\"bp\">.</span><span class=\"n\">monad_fail</span><span class=\"o\">))</span>\n                                            <span class=\"o\">(</span><span class=\"bp\">λ</span> <span class=\"o\">(</span><span class=\"n\">a_a_1_a</span> <span class=\"o\">:</span> <span class=\"n\">level</span><span class=\"o\">),</span>\n                                               <span class=\"n\">id_rhs</span> <span class=\"o\">(</span><span class=\"n\">tactic</span> <span class=\"n\">unit</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">match_failed</span> <span class=\"n\">interaction_monad</span><span class=\"bp\">.</span><span class=\"n\">monad_fail</span><span class=\"o\">))</span>\n                                            <span class=\"o\">(</span><span class=\"bp\">λ</span> <span class=\"o\">(</span><span class=\"n\">a_a_1_a_a</span> <span class=\"o\">:</span> <span class=\"n\">name</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">a_a_1_a_a_1</span> <span class=\"o\">:</span> <span class=\"n\">list</span> <span class=\"n\">level</span><span class=\"o\">),</span>\n                                               <span class=\"n\">id_rhs</span> <span class=\"o\">(</span><span class=\"n\">tactic</span> <span class=\"n\">unit</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">match_failed</span> <span class=\"n\">interaction_monad</span><span class=\"bp\">.</span><span class=\"n\">monad_fail</span><span class=\"o\">))</span>\n                                            <span class=\"o\">(</span><span class=\"bp\">λ</span> <span class=\"o\">(</span><span class=\"n\">a_a_1_a_a</span> <span class=\"n\">a_a_1_a_a_1</span> <span class=\"o\">:</span> <span class=\"n\">name</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">a_a_1_a_a_2</span> <span class=\"o\">:</span> <span class=\"n\">expr</span><span class=\"o\">),</span>\n                                               <span class=\"n\">id_rhs</span> <span class=\"o\">(</span><span class=\"n\">tactic</span> <span class=\"n\">unit</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">match_failed</span> <span class=\"n\">interaction_monad</span><span class=\"bp\">.</span><span class=\"n\">monad_fail</span><span class=\"o\">))</span>\n                                            <span class=\"o\">(</span><span class=\"bp\">λ</span> <span class=\"o\">(</span><span class=\"n\">a_a_1_a_a</span> <span class=\"n\">a_a_1_a_a_1</span> <span class=\"o\">:</span> <span class=\"n\">name</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">a_a_1_a_a_2</span> <span class=\"o\">:</span> <span class=\"n\">binder_info</span><span class=\"o\">)</span>\n                                             <span class=\"o\">(</span><span class=\"n\">a_a_1_a_a_3</span> <span class=\"o\">:</span> <span class=\"n\">expr</span><span class=\"o\">),</span>\n                                               <span class=\"n\">id_rhs</span> <span class=\"o\">(</span><span class=\"n\">tactic</span> <span class=\"n\">unit</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">match_failed</span> <span class=\"n\">interaction_monad</span><span class=\"bp\">.</span><span class=\"n\">monad_fail</span><span class=\"o\">))</span>\n                                            <span class=\"o\">(</span><span class=\"bp\">λ</span> <span class=\"o\">(</span><span class=\"n\">a_a_1_a_a</span> <span class=\"n\">a_a_1_a_a_1</span> <span class=\"o\">:</span> <span class=\"n\">expr</span><span class=\"o\">),</span>\n                                               <span class=\"n\">expr</span><span class=\"bp\">.</span><span class=\"n\">cases_on</span> <span class=\"n\">a_a_1_a_a</span>\n                                                 <span class=\"o\">(</span><span class=\"bp\">λ</span> <span class=\"o\">(</span><span class=\"n\">a_a_1_a_a</span> <span class=\"o\">:</span> <span class=\"bp\">ℕ</span><span class=\"o\">),</span>\n                                                    <span class=\"n\">id_rhs</span> <span class=\"o\">(</span><span class=\"n\">tactic</span> <span class=\"n\">unit</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">match_failed</span> <span class=\"n\">interaction_monad</span><span class=\"bp\">.</span><span class=\"n\">monad_fail</span><span class=\"o\">))</span>\n                                                 <span class=\"o\">(</span><span class=\"bp\">λ</span> <span class=\"o\">(</span><span class=\"n\">a_a_1_a_a</span> <span class=\"o\">:</span> <span class=\"n\">level</span><span class=\"o\">),</span>\n                                                    <span class=\"n\">id_rhs</span> <span class=\"o\">(</span><span class=\"n\">tactic</span> <span class=\"n\">unit</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">match_failed</span> <span class=\"n\">interaction_monad</span><span class=\"bp\">.</span><span class=\"n\">monad_fail</span><span class=\"o\">))</span>\n                                                 <span class=\"o\">(</span><span class=\"bp\">λ</span> <span class=\"o\">(</span><span class=\"n\">a_a_1_a_a_a</span> <span class=\"o\">:</span> <span class=\"n\">name</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">a_a_1_a_a_a_1</span> <span class=\"o\">:</span> <span class=\"n\">list</span> <span class=\"n\">level</span><span class=\"o\">),</span>\n                                                    <span class=\"n\">id_rhs</span> <span class=\"o\">(</span><span class=\"n\">tactic</span> <span class=\"n\">unit</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">match_failed</span> <span class=\"n\">interaction_monad</span><span class=\"bp\">.</span><span class=\"n\">monad_fail</span><span class=\"o\">))</span>\n                                                 <span class=\"o\">(</span><span class=\"bp\">λ</span> <span class=\"o\">(</span><span class=\"n\">a_a_1_a_a_a</span> <span class=\"n\">a_a_1_a_a_a_1</span> <span class=\"o\">:</span> <span class=\"n\">name</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">a_a_1_a_a_a_2</span> <span class=\"o\">:</span> <span class=\"n\">expr</span><span class=\"o\">),</span>\n                                                    <span class=\"n\">id_rhs</span> <span class=\"o\">(</span><span class=\"n\">tactic</span> <span class=\"n\">unit</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">match_failed</span> <span class=\"n\">interaction_monad</span><span class=\"bp\">.</span><span class=\"n\">monad_fail</span><span class=\"o\">))</span>\n                                                 <span class=\"o\">(</span><span class=\"bp\">λ</span> <span class=\"o\">(</span><span class=\"n\">a_a_1_a_a_a</span> <span class=\"n\">a_a_1_a_a_a_1</span> <span class=\"o\">:</span> <span class=\"n\">name</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">a_a_1_a_a_a_2</span> <span class=\"o\">:</span> <span class=\"n\">binder_info</span><span class=\"o\">)</span>\n                                                  <span class=\"o\">(</span><span class=\"n\">a_a_1_a_a_a_3</span> <span class=\"o\">:</span> <span class=\"n\">expr</span><span class=\"o\">),</span>\n                                                    <span class=\"n\">id_rhs</span> <span class=\"o\">(</span><span class=\"n\">tactic</span> <span class=\"n\">unit</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">match_failed</span> <span class=\"n\">interaction_monad</span><span class=\"bp\">.</span><span class=\"n\">monad_fail</span><span class=\"o\">))</span>\n                                                 <span class=\"o\">(</span><span class=\"bp\">λ</span> <span class=\"o\">(</span><span class=\"n\">a_a_1_a_a_a</span> <span class=\"n\">a_a_1_a_a_a_1</span> <span class=\"o\">:</span> <span class=\"n\">expr</span><span class=\"o\">),</span>\n                                                    <span class=\"n\">expr</span><span class=\"bp\">.</span><span class=\"n\">cases_on</span> <span class=\"n\">a_a_1_a_a_a</span> <span class=\"o\">(</span><span class=\"bp\">λ</span> <span class=\"o\">(</span><span class=\"n\">a_a_1_a_a_a</span> <span class=\"o\">:</span> <span class=\"bp\">ℕ</span><span class=\"o\">),</span> <span class=\"err\">…</span> <span class=\"err\">…</span><span class=\"o\">)</span>\n                                                      <span class=\"o\">(</span><span class=\"bp\">λ</span> <span class=\"o\">(</span><span class=\"n\">a_a_1_a_a_a</span> <span class=\"o\">:</span> <span class=\"n\">level</span><span class=\"o\">),</span> <span class=\"n\">id_rhs</span> <span class=\"err\">…</span> <span class=\"err\">…</span><span class=\"o\">)</span>\n                                                      <span class=\"o\">(</span><span class=\"bp\">λ</span> <span class=\"o\">(</span><span class=\"n\">a_a_1_a_a_a_a</span> <span class=\"o\">:</span> <span class=\"n\">name</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">a_a_1_a_a_a_a_1</span> <span class=\"o\">:</span> <span class=\"n\">list</span> <span class=\"n\">level</span><span class=\"o\">),</span>\n                                                         <span class=\"n\">id_rhs</span> <span class=\"o\">(</span><span class=\"n\">tactic</span> <span class=\"n\">unit</span><span class=\"o\">)</span>\n                                                           <span class=\"o\">(</span><span class=\"n\">match_failed</span> <span class=\"n\">interaction_monad</span><span class=\"bp\">.</span><span class=\"n\">monad_fail</span><span class=\"o\">))</span>\n                                                      <span class=\"o\">(</span><span class=\"bp\">λ</span> <span class=\"o\">(</span><span class=\"n\">a_a_1_a_a_a_a</span> <span class=\"n\">a_a_1_a_a_a_a_1</span> <span class=\"o\">:</span> <span class=\"n\">name</span><span class=\"o\">)</span>\n                                                       <span class=\"o\">(</span><span class=\"n\">a_a_1_a_a_a_a_2</span> <span class=\"o\">:</span> <span class=\"n\">expr</span><span class=\"o\">),</span>\n                                                         <span class=\"n\">id_rhs</span> <span class=\"o\">(</span><span class=\"n\">tactic</span> <span class=\"n\">unit</span><span class=\"o\">)</span>\n                                                           <span class=\"o\">(</span><span class=\"n\">match_failed</span> <span class=\"n\">interaction_monad</span><span class=\"bp\">.</span><span class=\"n\">monad_fail</span><span class=\"o\">))</span>\n                                                      <span class=\"o\">(</span><span class=\"bp\">λ</span> <span class=\"o\">(</span><span class=\"n\">a_a_1_a_a_a_a</span> <span class=\"n\">a_a_1_a_a_a_a_1</span> <span class=\"o\">:</span> <span class=\"n\">name</span><span class=\"o\">)</span>\n                                                       <span class=\"o\">(</span><span class=\"n\">a_a_1_a_a_a_a_2</span> <span class=\"o\">:</span> <span class=\"n\">binder_info</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">a_a_1_a_a_a_a_3</span> <span class=\"o\">:</span> <span class=\"n\">expr</span><span class=\"o\">),</span>\n                                                         <span class=\"n\">id_rhs</span> <span class=\"o\">(</span><span class=\"n\">tactic</span> <span class=\"n\">unit</span><span class=\"o\">)</span>\n                                                           <span class=\"o\">(</span><span class=\"n\">match_failed</span> <span class=\"n\">interaction_monad</span><span class=\"bp\">.</span><span class=\"n\">monad_fail</span><span class=\"o\">))</span>\n                                                      <span class=\"o\">(</span><span class=\"bp\">λ</span> <span class=\"o\">(</span><span class=\"n\">a_a_1_a_a_a_a</span> <span class=\"n\">a_a_1_a_a_a_a_1</span> <span class=\"o\">:</span> <span class=\"n\">expr</span><span class=\"o\">),</span>\n                                                         <span class=\"err\">…</span> <span class=\"err\">…</span> <span class=\"o\">(</span><span class=\"bp\">λ</span> <span class=\"o\">(</span><span class=\"n\">a_a_1_a_a_a_a_a</span> <span class=\"n\">a_a_1_a_a_a_a_a_1</span> <span class=\"o\">:</span> <span class=\"err\">…</span><span class=\"o\">),</span> <span class=\"err\">…</span><span class=\"o\">)</span>\n                                                           <span class=\"o\">(</span><span class=\"bp\">λ</span> <span class=\"o\">(</span><span class=\"n\">a_a_1_a_a_a_a_a</span> <span class=\"o\">:</span> <span class=\"n\">name</span><span class=\"o\">)</span>\n                                                            <span class=\"o\">(</span><span class=\"n\">a_a_1_a_a_a_a_a_1</span> <span class=\"o\">:</span> <span class=\"n\">binder_info</span><span class=\"o\">)</span>\n                                                            <span class=\"o\">(</span><span class=\"n\">a_a_1_a_a_a_a_a_2</span> <span class=\"n\">a_a_1_a_a_a_a_a_3</span> <span class=\"o\">:</span> <span class=\"n\">expr</span><span class=\"o\">),</span> <span class=\"err\">…</span> <span class=\"err\">…</span><span class=\"o\">)</span>\n                                                           <span class=\"o\">(</span><span class=\"bp\">λ</span> <span class=\"o\">(</span><span class=\"n\">a_a_1_a_a_a_a_a</span> <span class=\"o\">:</span> <span class=\"n\">name</span><span class=\"o\">)</span>\n                                                            <span class=\"o\">(</span><span class=\"n\">a_a_1_a_a_a_a_a_1</span> <span class=\"o\">:</span> <span class=\"n\">binder_info</span><span class=\"o\">)</span>\n                                                            <span class=\"o\">(</span><span class=\"n\">a_a_1_a_a_a_a_a_2</span> <span class=\"n\">a_a_1_a_a_a_a_a_3</span> <span class=\"o\">:</span> <span class=\"n\">expr</span><span class=\"o\">),</span>\n                                                              <span class=\"n\">id_rhs</span> <span class=\"err\">…</span> <span class=\"err\">…</span><span class=\"o\">)</span>\n                                                           <span class=\"o\">(</span><span class=\"bp\">λ</span> <span class=\"o\">(</span><span class=\"n\">a_a_1_a_a_a_a_a</span> <span class=\"o\">:</span> <span class=\"n\">name</span><span class=\"o\">)</span>\n                                                            <span class=\"o\">(</span><span class=\"n\">a_a_1_a_a_a_a_a_1</span> <span class=\"n\">a_a_1_a_a_a_a_a_2</span> <span class=\"n\">a_a_1_a_a_a_a_a_3</span> <span class=\"o\">:</span>\n                                                              <span class=\"n\">expr</span><span class=\"o\">),</span>\n                                                              <span class=\"n\">id_rhs</span> <span class=\"o\">(</span><span class=\"n\">tactic</span> <span class=\"n\">unit</span><span class=\"o\">)</span>\n                                                                <span class=\"o\">(</span><span class=\"n\">match_failed</span> <span class=\"n\">interaction_monad</span><span class=\"bp\">.</span><span class=\"n\">monad_fail</span><span class=\"o\">))</span>\n                                                           <span class=\"o\">(</span><span class=\"bp\">λ</span> <span class=\"o\">(</span><span class=\"n\">a_a_1_a_a_a_a_a</span> <span class=\"o\">:</span> <span class=\"n\">macro_def</span><span class=\"o\">)</span>\n                                                            <span class=\"o\">(</span><span class=\"n\">a_a_1_a_a_a_a_a_1</span> <span class=\"o\">:</span> <span class=\"n\">list</span> <span class=\"n\">expr</span><span class=\"o\">),</span>\n                                                              <span class=\"n\">id_rhs</span> <span class=\"o\">(</span><span class=\"n\">tactic</span> <span class=\"n\">unit</span><span class=\"o\">)</span>\n                                                                <span class=\"o\">(</span><span class=\"n\">match_failed</span> <span class=\"n\">interaction_monad</span><span class=\"bp\">.</span><span class=\"n\">monad_fail</span><span class=\"o\">)))</span>\n                                                      <span class=\"o\">(</span><span class=\"bp\">λ</span> <span class=\"o\">(</span><span class=\"n\">a_a_1_a_a_a_a</span> <span class=\"o\">:</span> <span class=\"n\">name</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">a_a_1_a_a_a_a_1</span> <span class=\"o\">:</span> <span class=\"n\">binder_info</span><span class=\"o\">)</span>\n                                                       <span class=\"o\">(</span><span class=\"n\">a_a_1_a_a_a_a_2</span> <span class=\"n\">a_a_1_a_a_a_a_3</span> <span class=\"o\">:</span> <span class=\"n\">expr</span><span class=\"o\">),</span>\n                                                         <span class=\"n\">id_rhs</span> <span class=\"o\">(</span><span class=\"n\">tactic</span> <span class=\"n\">unit</span><span class=\"o\">)</span>\n                                                           <span class=\"o\">(</span><span class=\"n\">match_failed</span> <span class=\"n\">interaction_monad</span><span class=\"bp\">.</span><span class=\"n\">monad_fail</span><span class=\"o\">))</span>\n                                                      <span class=\"o\">(</span><span class=\"bp\">λ</span> <span class=\"o\">(</span><span class=\"n\">a_a_1_a_a_a_a</span> <span class=\"o\">:</span> <span class=\"n\">name</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">a_a_1_a_a_a_a_1</span> <span class=\"o\">:</span> <span class=\"n\">binder_info</span><span class=\"o\">)</span>\n                                                       <span class=\"o\">(</span><span class=\"n\">a_a_1_a_a_a_a_2</span> <span class=\"n\">a_a_1_a_a_a_a_3</span> <span class=\"o\">:</span> <span class=\"n\">expr</span><span class=\"o\">),</span>\n                                                         <span class=\"n\">id_rhs</span> <span class=\"o\">(</span>\n</pre></div>",
        "id": 162997334,
        "sender_full_name": "Joseph Corneli",
        "timestamp": 1554897388
    },
    {
        "content": "<p><code>aaaaaaaaaaaaaaaaaaaaaaa</code> indeed</p>",
        "id": 162997372,
        "sender_full_name": "Keeley Hoek",
        "timestamp": 1554897440
    },
    {
        "content": "<p>Can you try:</p>\n<div class=\"codehilite\"><pre><span></span><span class=\"n\">meta</span> <span class=\"n\">def</span> <span class=\"n\">trace_goal_is_quad_eq&#39;&#39;</span> <span class=\"o\">:</span> <span class=\"n\">tactic</span> <span class=\"n\">unit</span> <span class=\"o\">:=</span>\n<span class=\"n\">do</span> <span class=\"o\">{</span> <span class=\"bp\">`</span><span class=\"o\">(</span><span class=\"err\">%%</span><span class=\"n\">A</span> <span class=\"bp\">*</span> <span class=\"err\">%%</span><span class=\"n\">x</span> <span class=\"err\">^</span> <span class=\"o\">(</span><span class=\"mi\">2</span> <span class=\"o\">:</span> <span class=\"n\">nat</span><span class=\"o\">)</span> <span class=\"bp\">+</span> <span class=\"err\">%%</span><span class=\"n\">C</span> <span class=\"bp\">=</span> <span class=\"err\">%%</span><span class=\"n\">r</span><span class=\"o\">)</span> <span class=\"err\">←</span> <span class=\"n\">tactic</span><span class=\"bp\">.</span><span class=\"n\">target</span><span class=\"o\">,</span>\n     <span class=\"n\">tactic</span><span class=\"bp\">.</span><span class=\"n\">trace</span> <span class=\"err\">$</span> <span class=\"s2\">&quot;Goal is equality between the quadratic &quot;</span>\n                     <span class=\"bp\">++</span> <span class=\"o\">(</span><span class=\"n\">to_string</span> <span class=\"n\">A</span><span class=\"o\">)</span> <span class=\"bp\">++</span> <span class=\"s2\">&quot;x^2 &quot;</span>\n                     <span class=\"bp\">++</span> <span class=\"o\">(</span><span class=\"n\">to_string</span> <span class=\"n\">C</span><span class=\"o\">)</span> <span class=\"bp\">++</span> <span class=\"s2\">&quot; and &quot;</span> <span class=\"bp\">++</span> <span class=\"o\">(</span><span class=\"n\">to_string</span> <span class=\"n\">r</span><span class=\"o\">)</span> <span class=\"o\">}</span>\n   <span class=\"bp\">&lt;|&gt;</span> <span class=\"n\">tactic</span><span class=\"bp\">.</span><span class=\"n\">trace</span> <span class=\"s2\">&quot;Goal is not an equality&quot;</span>\n</pre></div>",
        "id": 163009394,
        "sender_full_name": "Simon Hudon",
        "timestamp": 1554906602
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"110026\">@Simon Hudon</span> that one gives me </p>\n<blockquote>\n<p>equation compiler failed, maximum number of steps (2048) exceeded (possible solution: use 'set_option eqn_compiler.max_steps &lt;new-threshold&gt;') (use 'set_option trace.eqn_compiler.elim_match true' for additional details)</p>\n</blockquote>",
        "id": 163012177,
        "sender_full_name": "Joseph Corneli",
        "timestamp": 1554908278
    },
    {
        "content": "<p>I was able to take it apart to this level:</p>\n<div class=\"codehilite\"><pre><span></span><span class=\"n\">meta</span> <span class=\"n\">def</span> <span class=\"n\">trace_goal_is_quad_eq&#39;&#39;</span> <span class=\"o\">:</span> <span class=\"n\">tactic</span> <span class=\"n\">unit</span> <span class=\"o\">:=</span>\n<span class=\"n\">do</span> <span class=\"o\">{</span> <span class=\"bp\">`</span><span class=\"o\">(</span><span class=\"err\">%%</span><span class=\"n\">A</span><span class=\"bp\">*</span><span class=\"err\">%%</span><span class=\"n\">Q</span> <span class=\"bp\">+</span> <span class=\"err\">%%</span><span class=\"n\">B</span><span class=\"bp\">*</span><span class=\"err\">%%</span><span class=\"n\">L</span> <span class=\"bp\">+</span> <span class=\"err\">%%</span><span class=\"n\">C</span> <span class=\"bp\">=</span> <span class=\"err\">%%</span><span class=\"n\">r</span><span class=\"o\">)</span> <span class=\"err\">←</span> <span class=\"n\">tactic</span><span class=\"bp\">.</span><span class=\"n\">target</span><span class=\"o\">,</span>\n     <span class=\"n\">tactic</span><span class=\"bp\">.</span><span class=\"n\">trace</span> <span class=\"err\">$</span> <span class=\"s2\">&quot;Goal is equality between the quadratic &quot;</span>\n                     <span class=\"bp\">++</span> <span class=\"o\">(</span><span class=\"n\">to_string</span> <span class=\"n\">A</span><span class=\"o\">)</span> <span class=\"bp\">++</span> <span class=\"s2\">&quot;/-quadratic part...-/ &quot;</span>\n                     <span class=\"bp\">++</span> <span class=\"o\">(</span><span class=\"n\">to_string</span> <span class=\"n\">Q</span><span class=\"o\">)</span> <span class=\"bp\">++</span> <span class=\"s2\">&quot;/-...--AND-/ &quot;</span>\n                     <span class=\"bp\">++</span> <span class=\"o\">(</span><span class=\"n\">to_string</span> <span class=\"n\">B</span><span class=\"o\">)</span> <span class=\"bp\">++</span> <span class=\"s2\">&quot;/-linear part...-/ &quot;</span>\n                     <span class=\"bp\">++</span> <span class=\"o\">(</span><span class=\"n\">to_string</span> <span class=\"n\">L</span><span class=\"o\">)</span> <span class=\"bp\">++</span> <span class=\"s2\">&quot;/-...--AND-/ &quot;</span>\n                     <span class=\"bp\">++</span> <span class=\"o\">(</span><span class=\"n\">to_string</span> <span class=\"n\">C</span><span class=\"o\">)</span> <span class=\"bp\">++</span> <span class=\"s2\">&quot;/-constant part-/ &quot;</span>\n   <span class=\"o\">}</span>\n   <span class=\"bp\">&lt;|&gt;</span> <span class=\"n\">tactic</span><span class=\"bp\">.</span><span class=\"n\">trace</span> <span class=\"s2\">&quot;Goal is not an equality&quot;</span>\n</pre></div>",
        "id": 163012261,
        "sender_full_name": "Joseph Corneli",
        "timestamp": 1554908320
    },
    {
        "content": "<p>That gave me this debug message:</p>\n<blockquote>\n<p>Goal is equality between the quadratic a/-quadratic part...-/ has_pow.pow.{0 0} real nat (monoid.has_pow.{0} real real.monoid) x (bit0.{0} nat nat.has_add (has_one.one.{0} nat nat.has_one))/-...--AND-/ b/-linear part...-/ x/-...--AND-/ c/-constant part-/ </p>\n</blockquote>\n<p>when applied via</p>\n<div class=\"codehilite\"><pre><span></span><span class=\"kn\">example</span> <span class=\"o\">(</span><span class=\"n\">a</span> <span class=\"n\">b</span> <span class=\"n\">c</span> <span class=\"o\">:</span> <span class=\"n\">ℝ</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"bp\">∀</span> <span class=\"o\">(</span><span class=\"n\">x</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">),</span> <span class=\"n\">a</span><span class=\"bp\">*</span><span class=\"n\">x</span><span class=\"err\">^</span><span class=\"mi\">2</span><span class=\"bp\">+</span><span class=\"n\">b</span><span class=\"bp\">*</span><span class=\"n\">x</span><span class=\"bp\">+</span><span class=\"n\">c</span> <span class=\"bp\">=</span> <span class=\"n\">a</span><span class=\"bp\">*</span><span class=\"o\">(</span><span class=\"n\">x</span> <span class=\"bp\">+</span> <span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"bp\">/</span><span class=\"o\">(</span><span class=\"mi\">2</span><span class=\"bp\">*</span><span class=\"n\">a</span><span class=\"o\">))</span><span class=\"bp\">*</span> <span class=\"n\">b</span><span class=\"o\">)</span><span class=\"err\">^</span><span class=\"mi\">2</span> <span class=\"bp\">+</span> <span class=\"o\">(</span><span class=\"n\">c</span><span class=\"bp\">-</span><span class=\"n\">b</span><span class=\"err\">^</span><span class=\"mi\">2</span><span class=\"bp\">/</span><span class=\"o\">(</span><span class=\"mi\">4</span><span class=\"bp\">*</span><span class=\"n\">a</span><span class=\"o\">))</span> <span class=\"o\">:=</span>\n<span class=\"k\">begin</span>\n  <span class=\"n\">intro</span><span class=\"o\">,</span>\n  <span class=\"n\">trace_goal_is_quad_eq&#39;&#39;</span><span class=\"o\">,</span>\n<span class=\"kn\">end</span>\n</pre></div>",
        "id": 163012420,
        "sender_full_name": "Joseph Corneli",
        "timestamp": 1554908409
    },
    {
        "content": "<p>Is 2 supposed to be a natural number or a real number?</p>",
        "id": 163012546,
        "sender_full_name": "Simon Hudon",
        "timestamp": 1554908514
    },
    {
        "content": "<p>Personally I think natural is the right choice.</p>",
        "id": 163012630,
        "sender_full_name": "Joseph Corneli",
        "timestamp": 1554908569
    },
    {
        "content": "<p>this might not be true if a=0</p>",
        "id": 163012775,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1554908661
    },
    {
        "content": "<p>Oops!  Even if <code>a=1</code>, though, the parsing might still be tricky. I'll set up a variant like that and test it.</p>",
        "id": 163013004,
        "sender_full_name": "Joseph Corneli",
        "timestamp": 1554908794
    },
    {
        "content": "<p>A simple way to avoid the threshold is to break the pattern match down:</p>\n<div class=\"codehilite\"><pre><span></span><span class=\"kn\">open</span> <span class=\"n\">tactic</span>\n<span class=\"n\">meta</span> <span class=\"n\">def</span> <span class=\"n\">trace_goal_is_quad_eq&#39;&#39;</span> <span class=\"o\">:</span> <span class=\"n\">tactic</span> <span class=\"n\">unit</span> <span class=\"o\">:=</span>\n<span class=\"n\">do</span> <span class=\"o\">{</span> <span class=\"bp\">`</span><span class=\"o\">(</span><span class=\"err\">%%</span><span class=\"n\">e₁</span> <span class=\"bp\">=</span> <span class=\"err\">%%</span><span class=\"n\">r</span><span class=\"o\">)</span> <span class=\"err\">←</span> <span class=\"n\">target</span><span class=\"o\">,</span>\n     <span class=\"bp\">`</span><span class=\"o\">(</span><span class=\"err\">%%</span><span class=\"n\">A</span> <span class=\"bp\">*</span> <span class=\"err\">%%</span><span class=\"n\">x</span> <span class=\"err\">^</span> <span class=\"err\">%%</span><span class=\"n\">e</span> <span class=\"bp\">+</span> <span class=\"err\">%%</span><span class=\"n\">B</span> <span class=\"bp\">*</span> <span class=\"err\">%%</span><span class=\"n\">y</span> <span class=\"bp\">+</span> <span class=\"err\">%%</span><span class=\"n\">C</span><span class=\"o\">)</span> <span class=\"err\">←</span> <span class=\"n\">return</span> <span class=\"n\">e₁</span><span class=\"o\">,</span>\n     <span class=\"n\">guard</span> <span class=\"o\">(</span><span class=\"n\">x</span> <span class=\"bp\">=</span><span class=\"err\">ₐ</span> <span class=\"n\">y</span><span class=\"o\">),</span>\n     <span class=\"n\">guard</span> <span class=\"o\">(</span><span class=\"n\">e</span> <span class=\"bp\">=</span><span class=\"err\">ₐ</span> <span class=\"bp\">`</span><span class=\"o\">(</span><span class=\"mi\">2</span><span class=\"o\">:</span><span class=\"bp\">ℕ</span><span class=\"o\">)),</span>\n     <span class=\"n\">pA</span> <span class=\"err\">←</span> <span class=\"n\">pp</span> <span class=\"n\">A</span><span class=\"o\">,</span> <span class=\"n\">pB</span> <span class=\"err\">←</span> <span class=\"n\">pp</span> <span class=\"n\">B</span><span class=\"o\">,</span> <span class=\"n\">pC</span> <span class=\"err\">←</span> <span class=\"n\">pp</span> <span class=\"n\">C</span><span class=\"o\">,</span> <span class=\"n\">pr</span> <span class=\"err\">←</span> <span class=\"n\">pp</span> <span class=\"n\">r</span><span class=\"o\">,</span>\n     <span class=\"n\">tactic</span><span class=\"bp\">.</span><span class=\"n\">trace</span> <span class=\"err\">$</span> <span class=\"err\">↑</span><span class=\"s2\">&quot;Goal is equality between the quadratic &quot;</span>\n                     <span class=\"bp\">++</span> <span class=\"n\">pA</span> <span class=\"bp\">++</span> <span class=\"s2\">&quot; x^2 + &quot;</span>\n                     <span class=\"bp\">++</span> <span class=\"n\">pB</span> <span class=\"bp\">++</span> <span class=\"s2\">&quot; x + &quot;</span>\n                     <span class=\"bp\">++</span> <span class=\"n\">pC</span> <span class=\"bp\">++</span> <span class=\"s2\">&quot; and &quot;</span> <span class=\"bp\">++</span> <span class=\"n\">pr</span> <span class=\"o\">}</span>\n   <span class=\"bp\">&lt;|&gt;</span> <span class=\"n\">tactic</span><span class=\"bp\">.</span><span class=\"n\">trace</span> <span class=\"s2\">&quot;Goal is not an equality&quot;</span>\n<span class=\"kn\">example</span> <span class=\"o\">(</span><span class=\"n\">a</span> <span class=\"n\">b</span> <span class=\"n\">c</span> <span class=\"o\">:</span> <span class=\"n\">ℝ</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"bp\">∀</span> <span class=\"o\">(</span><span class=\"n\">x</span><span class=\"o\">:</span><span class=\"n\">ℝ</span><span class=\"o\">),</span> <span class=\"n\">a</span><span class=\"bp\">*</span><span class=\"n\">x</span><span class=\"err\">^</span><span class=\"mi\">2</span><span class=\"bp\">+</span><span class=\"n\">b</span><span class=\"bp\">*</span><span class=\"n\">x</span><span class=\"bp\">+</span><span class=\"n\">c</span> <span class=\"bp\">=</span> <span class=\"n\">a</span><span class=\"bp\">*</span><span class=\"o\">(</span><span class=\"n\">x</span> <span class=\"bp\">+</span> <span class=\"o\">(</span><span class=\"mi\">1</span><span class=\"bp\">/</span><span class=\"o\">(</span><span class=\"mi\">2</span><span class=\"bp\">*</span><span class=\"n\">a</span><span class=\"o\">))</span><span class=\"bp\">*</span> <span class=\"n\">b</span><span class=\"o\">)</span><span class=\"err\">^</span><span class=\"mi\">2</span> <span class=\"bp\">+</span> <span class=\"o\">(</span><span class=\"n\">c</span><span class=\"bp\">-</span><span class=\"n\">b</span><span class=\"err\">^</span><span class=\"mi\">2</span><span class=\"bp\">/</span><span class=\"o\">(</span><span class=\"mi\">4</span><span class=\"bp\">*</span><span class=\"n\">a</span><span class=\"o\">))</span> <span class=\"o\">:=</span>\n<span class=\"k\">begin</span>\n  <span class=\"n\">intro</span><span class=\"o\">,</span>\n  <span class=\"n\">trace_goal_is_quad_eq&#39;&#39;</span><span class=\"o\">,</span>\n<span class=\"kn\">end</span>\n</pre></div>",
        "id": 163058187,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1554941868
    },
    {
        "content": "<p>But I think this kind of parsing is probably not a good idea in any case. It's very brittle</p>",
        "id": 163058477,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1554942204
    }
]