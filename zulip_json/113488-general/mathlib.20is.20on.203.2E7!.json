[
    {
        "content": "<p>Wow, I only just noticed: mathlib is now running on Lean 3.7.</p>\n<p>Even cooler, I barely noticed the change; after running <code>leanproject up</code> on a branch that I'd just merged master into, VS Code told me it was downloading Lean, and everything _just worked_.</p>",
        "id": 191069346,
        "sender_full_name": "Scott Morrison",
        "timestamp": 1584589288
    },
    {
        "content": "<p>Thanks everyone for coordinating this amazing infrastructure work (both 3.7, and all the tooling).</p>",
        "id": 191069352,
        "sender_full_name": "Scott Morrison",
        "timestamp": 1584589316
    },
    {
        "content": "<p>I need some help here.</p>\n<div class=\"codehilite\"><pre><span></span><span class=\"n\">PS</span> <span class=\"n\">C</span><span class=\"o\">:</span><span class=\"err\">\\</span><span class=\"n\">Users</span><span class=\"err\">\\</span><span class=\"n\">Sebastien</span><span class=\"err\">\\</span><span class=\"n\">Desktop</span><span class=\"err\">\\</span><span class=\"n\">mathlib</span><span class=\"bp\">&gt;</span> <span class=\"n\">leanproject</span> <span class=\"n\">up</span>\n<span class=\"n\">Looking</span> <span class=\"n\">for</span> <span class=\"n\">local</span> <span class=\"n\">mathlib</span> <span class=\"n\">oleans</span>\n<span class=\"n\">Looking</span> <span class=\"n\">for</span> <span class=\"n\">remote</span> <span class=\"n\">mathlib</span> <span class=\"n\">oleans</span>\n<span class=\"n\">Trying</span> <span class=\"n\">to</span> <span class=\"n\">download</span> <span class=\"n\">https</span><span class=\"o\">:</span><span class=\"bp\">//</span><span class=\"n\">oleanstorage</span><span class=\"bp\">.</span><span class=\"n\">azureedge</span><span class=\"bp\">.</span><span class=\"n\">net</span><span class=\"bp\">/</span><span class=\"n\">mathlib</span><span class=\"bp\">/</span><span class=\"mi\">1</span><span class=\"n\">a398a7212f9d81e33436008594727bfb5724053</span><span class=\"bp\">.</span><span class=\"n\">tar</span><span class=\"bp\">.</span><span class=\"n\">gz</span> <span class=\"n\">to</span> <span class=\"n\">C</span><span class=\"o\">:</span><span class=\"err\">\\</span><span class=\"n\">Users</span><span class=\"err\">\\</span><span class=\"n\">Sebastien</span><span class=\"err\">\\</span><span class=\"bp\">.</span><span class=\"n\">mathlib</span><span class=\"err\">\\</span><span class=\"mi\">1</span><span class=\"n\">a398a7212f9d81e33436008594727bfb5724053</span><span class=\"bp\">.</span><span class=\"n\">tar</span><span class=\"bp\">.</span><span class=\"n\">gz</span>\n<span class=\"mi\">100</span><span class=\"err\">%</span><span class=\"bp\">|</span><span class=\"err\">█████████████████████████████████████████████████████████████████████████████</span><span class=\"bp\">|</span> <span class=\"mi\">24</span><span class=\"bp\">.</span><span class=\"mi\">0</span><span class=\"n\">M</span><span class=\"bp\">/</span><span class=\"mi\">24</span><span class=\"bp\">.</span><span class=\"mi\">0</span><span class=\"n\">M</span> <span class=\"o\">[</span><span class=\"mi\">01</span><span class=\"o\">:</span><span class=\"mi\">15</span><span class=\"bp\">&lt;</span><span class=\"mi\">00</span><span class=\"o\">:</span><span class=\"mi\">00</span><span class=\"o\">,</span> <span class=\"mi\">319</span><span class=\"n\">kiB</span><span class=\"bp\">/</span><span class=\"n\">s</span><span class=\"o\">]</span>\n<span class=\"n\">Found</span> <span class=\"n\">mathlib</span> <span class=\"n\">oleans</span> <span class=\"n\">at</span> <span class=\"n\">https</span><span class=\"o\">:</span><span class=\"bp\">//</span><span class=\"n\">oleanstorage</span><span class=\"bp\">.</span><span class=\"n\">azureedge</span><span class=\"bp\">.</span><span class=\"n\">net</span><span class=\"bp\">/</span><span class=\"n\">mathlib</span><span class=\"bp\">/</span>\n<span class=\"n\">PS</span> <span class=\"n\">C</span><span class=\"o\">:</span><span class=\"err\">\\</span><span class=\"n\">Users</span><span class=\"err\">\\</span><span class=\"n\">Sebastien</span><span class=\"err\">\\</span><span class=\"n\">Desktop</span><span class=\"err\">\\</span><span class=\"n\">mathlib</span><span class=\"bp\">&gt;</span> <span class=\"n\">lean</span> <span class=\"c1\">--version</span>\n<span class=\"n\">Lean</span> <span class=\"o\">(</span><span class=\"n\">version</span> <span class=\"mi\">3</span><span class=\"bp\">.</span><span class=\"mi\">7</span><span class=\"bp\">.</span><span class=\"mi\">1</span><span class=\"o\">,</span> <span class=\"n\">commit</span> <span class=\"mi\">4</span><span class=\"n\">bc3b6d65ed4</span><span class=\"o\">,</span> <span class=\"n\">Release</span><span class=\"o\">)</span>\n<span class=\"n\">PS</span> <span class=\"n\">C</span><span class=\"o\">:</span><span class=\"err\">\\</span><span class=\"n\">Users</span><span class=\"err\">\\</span><span class=\"n\">Sebastien</span><span class=\"err\">\\</span><span class=\"n\">Desktop</span><span class=\"err\">\\</span><span class=\"n\">mathlib</span><span class=\"bp\">&gt;</span> <span class=\"n\">lean</span> <span class=\"c1\">--make src</span>\n<span class=\"n\">C</span><span class=\"o\">:</span><span class=\"err\">\\</span><span class=\"n\">programmation</span><span class=\"err\">\\</span><span class=\"n\">lean</span><span class=\"err\">\\</span><span class=\"n\">lib</span><span class=\"err\">\\</span><span class=\"n\">lean</span><span class=\"err\">\\</span><span class=\"n\">library</span><span class=\"err\">\\</span><span class=\"n\">init</span><span class=\"err\">\\</span><span class=\"n\">data</span><span class=\"err\">\\</span><span class=\"n\">list</span><span class=\"err\">\\</span><span class=\"n\">basic</span><span class=\"bp\">.</span><span class=\"n\">lean</span><span class=\"o\">:</span> <span class=\"n\">parsing</span> <span class=\"n\">at</span> <span class=\"n\">line</span> <span class=\"mi\">283</span><span class=\"err\">\u001b</span><span class=\"o\">[</span><span class=\"mi\">2</span><span class=\"n\">K</span>\n</pre></div>\n\n\n<p>I have updated my Lean to 3.7.1 (copying the release from the website), then updated my mathlib with <code>leanproject up</code>. But still if I start <code>lean --make src</code>, it starts recompiling stuff in core. Any idea of what I might be doing wrong?</p>",
        "id": 191181589,
        "sender_full_name": "Sebastien Gouezel",
        "timestamp": 1584655766
    },
    {
        "content": "<p>Did you try <code>leanproject check</code>?</p>",
        "id": 191181755,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1584655905
    },
    {
        "content": "<p><code>Everything looks fine</code></p>",
        "id": 191181839,
        "sender_full_name": "Sebastien Gouezel",
        "timestamp": 1584655936
    },
    {
        "content": "<p>And each time I type again <code>lean --make src</code>, it starts recompiling the very same files from core it has just successfully compiled on the previous run.</p>",
        "id": 191181967,
        "sender_full_name": "Sebastien Gouezel",
        "timestamp": 1584656025
    },
    {
        "content": "<p>1a398a7212f9d81e33436008594727bfb5724053 was only committed 17 minutes ago and it has an orange blob in the list of commits</p>",
        "id": 191182059,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1584656065
    },
    {
        "content": "<p>so it's maybe a bit surprising that there are oleans on the azure server, but I don't really understand how this new tooling works</p>",
        "id": 191182095,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1584656093
    },
    {
        "content": "<p>oh but maybe the olean files were made when the PR was made, not when it was accepted?</p>",
        "id": 191182172,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1584656153
    },
    {
        "content": "<p>I had already the same issue with the previous commit, so I don't think this is related to this specific commit, rather something with my config. Are things working smoothly with 3.7.1 for all of you, especially on windows?</p>",
        "id": 191182223,
        "sender_full_name": "Sebastien Gouezel",
        "timestamp": 1584656168
    },
    {
        "content": "<p>oh -- it's recompiling stuff in <em>core</em>??</p>",
        "id": 191182410,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1584656337
    },
    {
        "content": "<p>Yes, core (just two or three files), and then from mathlib (also two or three files), and then it is done. Doing <code>lean --make src</code> leads to recompilation of the very same files, again and again and again.</p>",
        "id": 191182517,
        "sender_full_name": "Sebastien Gouezel",
        "timestamp": 1584656422
    },
    {
        "content": "<p>I can't reproduce, but I will note that <code>leanproject up</code> for me gives me <code>034685b9f3e3aba7c9972162d7201ed1473213e0</code>which is about 9 commits ago.</p>",
        "id": 191182688,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1584656556
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span>buzzard@bob:~/crap/test$ more leanpkg.toml\n[package]\nname = &quot;test&quot;\nversion = &quot;0.1&quot;\nlean_version = &quot;leanprover-community/lean:3.7.1&quot;\npath = &quot;src&quot;\n\n[dependencies]\nmathlib = {git = &quot;https://github.com/leanprover-community/mathlib&quot;, rev = &quot;034685b9f3e3aba7c9972162d7201ed1473213e0&quot;}\n</pre></div>",
        "id": 191182724,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1584656600
    },
    {
        "content": "<p>Is your filesystem OK? I've had weird issues like this when using some wacky encrypted filesystem which was being stored in dropbox and i had a dropbox conflict which caused the encrypted filesystem to get a bit confused</p>",
        "id": 191182852,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1584656697
    },
    {
        "content": "<p>My filesystem looks perfectly ok, from what I can tell...</p>",
        "id": 191183193,
        "sender_full_name": "Sebastien Gouezel",
        "timestamp": 1584657001
    },
    {
        "content": "<blockquote>\n<p>I have updated my Lean to 3.7.1 (copying the release from the website)</p>\n</blockquote>\n<p>Hmm, does this mean you are not using <code>elan</code>?</p>",
        "id": 191183752,
        "sender_full_name": "Bryan Gin-ge Chen",
        "timestamp": 1584657438
    },
    {
        "content": "<p>Actually, I think <code>elan</code> downloads the same files, so even if you're not using <code>elan</code> I don't see how that could be the issue.</p>\n<p>I was going to say that maybe the timestamps are affected, but I think Lean 3.7.1 no longer checks timestamps.</p>",
        "id": 191183922,
        "sender_full_name": "Bryan Gin-ge Chen",
        "timestamp": 1584657600
    },
    {
        "content": "<p>I use <code>elan</code> and have the same commit hash for my 3.7.1. Isn't it a bit surprising that <code>leanproject up</code> does a different thing for me though? Or not?</p>",
        "id": 191184445,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1584658047
    },
    {
        "content": "<p>I think the difference is that Sebastien was working on mathlib, so <code>leanproject up</code> gets master, whereas you were working on a project with <code>mathlib</code> as a dependency, so it gets the <code>lean-3.7.1</code> branch.</p>",
        "id": 191185395,
        "sender_full_name": "Bryan Gin-ge Chen",
        "timestamp": 1584658859
    },
    {
        "content": "<p>I see. So indeed I get <code>https://oleanstorage.azureedge.net/mathlib/1a398a7212f9d81e33436008594727bfb5724053.tar.gz</code> if I make a new mathlib clone but nothing compiles when I make it, it's all compiled already. Maybe it's a bad local copy of lean somehow?</p>",
        "id": 191186053,
        "sender_full_name": "Kevin Buzzard",
        "timestamp": 1584659369
    },
    {
        "content": "<p>Oh dear, more 3.7 trouble! Indeed we no longer rely on timestamps, looking at the hashes of .lean sources instead, but the aim is to recompile <em>less</em>, not more. I looked into the issue and believe the root cause lies in a change I introduced. To my defense, my code is actually correct, it just happens to have triggered a bug in another part of the codebase. In fact, strangely while my local compiler has nothing to say about it, the windows version of that <em>same</em> compiler actually caught the issue in the build logs, so perhaps it highlights a need for using some stricter compilation options. In the meantime though, we'll need a 3.7.2 release which I'll PR asap.</p>",
        "id": 191228869,
        "sender_full_name": "Wojciech Nawrocki",
        "timestamp": 1584703359
    },
    {
        "content": "<p>Thanks for investigating this!</p>",
        "id": 191230746,
        "sender_full_name": "Sebastien Gouezel",
        "timestamp": 1584704460
    },
    {
        "content": "<p>3.7.2 build failed on windows :(</p>",
        "id": 191296374,
        "sender_full_name": "Sebastien Gouezel",
        "timestamp": 1584735157
    },
    {
        "content": "<p>Where do you see this?  The windows build hasn't even started for the v3.7.2 tag: <a href=\"https://ci.appveyor.com/project/cipher1024/lean/builds/31606100\" target=\"_blank\" title=\"https://ci.appveyor.com/project/cipher1024/lean/builds/31606100\">https://ci.appveyor.com/project/cipher1024/lean/builds/31606100</a><br>\nIt already passed for the corresponding commit on master: <a href=\"https://ci.appveyor.com/project/cipher1024/lean/builds/31605182\" target=\"_blank\" title=\"https://ci.appveyor.com/project/cipher1024/lean/builds/31605182\">https://ci.appveyor.com/project/cipher1024/lean/builds/31605182</a></p>",
        "id": 191296887,
        "sender_full_name": "Gabriel Ebner",
        "timestamp": 1584735444
    },
    {
        "content": "<p>Please stay calm.  Appveyor---the windows CI solution that we use---takes a <em>long</em> time to run.  The windows binaries should be available within the next 24 hours.</p>",
        "id": 191297003,
        "sender_full_name": "Gabriel Ebner",
        "timestamp": 1584735496
    },
    {
        "content": "<p>All right, thanks. I just noticed that on the release page all builds are available but the windows one, and that the commit was marked with a red cross on <a href=\"https://github.com/leanprover-community/lean/commits/master\" target=\"_blank\" title=\"https://github.com/leanprover-community/lean/commits/master\">https://github.com/leanprover-community/lean/commits/master</a>, so I guessed something had gone wrong. Happy to hear this is not the case!</p>",
        "id": 191297636,
        "sender_full_name": "Sebastien Gouezel",
        "timestamp": 1584735873
    },
    {
        "content": "<p>Noted the slowness of our builds in <a href=\"https://github.com/leanprover-community/lean/issues/156\" target=\"_blank\" title=\"https://github.com/leanprover-community/lean/issues/156\">lean#156</a> .</p>",
        "id": 191299709,
        "sender_full_name": "Wojciech Nawrocki",
        "timestamp": 1584736948
    },
    {
        "content": "<p>The Windows build seems to be available now!</p>",
        "id": 191307980,
        "sender_full_name": "Wojciech Nawrocki",
        "timestamp": 1584741496
    }
]