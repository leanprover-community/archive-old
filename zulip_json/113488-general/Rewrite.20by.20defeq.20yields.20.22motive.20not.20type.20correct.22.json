[
    {
        "content": "<p><a href=\"https://leanprover-community.github.io/mwe.html\">#mwe</a></p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kn\">import</span> <span class=\"n\">category_theory.functor_category</span>\n<span class=\"kn\">open</span> <span class=\"n\">category_theory</span>\n<span class=\"kd\">variables</span> <span class=\"o\">{</span><span class=\"n\">C</span> <span class=\"n\">D</span> <span class=\"n\">E</span> <span class=\"n\">F</span> <span class=\"n\">G</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span> <span class=\"o\">[</span><span class=\"n\">category</span> <span class=\"n\">C</span><span class=\"o\">]</span> <span class=\"o\">[</span><span class=\"n\">category</span> <span class=\"n\">D</span><span class=\"o\">]</span> <span class=\"o\">[</span><span class=\"n\">category</span> <span class=\"n\">E</span><span class=\"o\">]</span> <span class=\"o\">[</span><span class=\"n\">category</span> <span class=\"n\">F</span><span class=\"o\">]</span> <span class=\"o\">[</span><span class=\"n\">category</span> <span class=\"n\">G</span><span class=\"o\">]</span>\n<span class=\"o\">(</span><span class=\"n\">H</span> <span class=\"o\">:</span> <span class=\"n\">C</span> <span class=\"bp\">⥤</span> <span class=\"n\">D</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">I</span> <span class=\"o\">:</span> <span class=\"n\">D</span> <span class=\"bp\">⥤</span> <span class=\"n\">E</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">J₁</span> <span class=\"n\">J₂</span> <span class=\"o\">:</span> <span class=\"n\">E</span> <span class=\"bp\">⥤</span> <span class=\"n\">F</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">α</span> <span class=\"o\">:</span> <span class=\"n\">J₁</span> <span class=\"bp\">⟶</span> <span class=\"n\">J₂</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">K</span> <span class=\"o\">:</span> <span class=\"n\">F</span> <span class=\"bp\">⥤</span> <span class=\"n\">G</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">c</span> <span class=\"o\">:</span> <span class=\"n\">C</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">g</span> <span class=\"o\">:</span> <span class=\"n\">G</span><span class=\"o\">)</span>\n<span class=\"o\">(</span><span class=\"n\">f</span> <span class=\"o\">:</span> <span class=\"n\">K.obj</span> <span class=\"o\">(</span><span class=\"n\">J₂.obj</span> <span class=\"o\">(</span><span class=\"n\">I.obj</span> <span class=\"o\">(</span><span class=\"n\">H.obj</span> <span class=\"n\">c</span><span class=\"o\">)))</span> <span class=\"bp\">⟶</span> <span class=\"n\">g</span><span class=\"o\">)</span>\n\n<span class=\"kd\">example</span> <span class=\"o\">:</span> <span class=\"n\">α.app</span> <span class=\"o\">(</span><span class=\"n\">I.obj</span> <span class=\"o\">(</span><span class=\"n\">H.obj</span> <span class=\"n\">c</span><span class=\"o\">))</span> <span class=\"bp\">=</span> <span class=\"n\">α.app</span> <span class=\"o\">((</span><span class=\"n\">H</span> <span class=\"bp\">⋙</span> <span class=\"n\">I</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">obj</span> <span class=\"n\">c</span><span class=\"o\">)</span> <span class=\"o\">:=</span>\n<span class=\"kd\">by</span> <span class=\"o\">{</span> <span class=\"n\">rw</span> <span class=\"n\">H.comp_obj</span> <span class=\"o\">}</span> <span class=\"c\">/-</span><span class=\"cm\"> motive not type correct -/</span>\n\n<span class=\"kd\">example</span> <span class=\"o\">:</span> <span class=\"n\">α.app</span> <span class=\"o\">(</span><span class=\"n\">I.obj</span> <span class=\"o\">(</span><span class=\"n\">H.obj</span> <span class=\"n\">c</span><span class=\"o\">))</span> <span class=\"bp\">=</span> <span class=\"n\">α.app</span> <span class=\"o\">((</span><span class=\"n\">H</span> <span class=\"bp\">⋙</span> <span class=\"n\">I</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">obj</span> <span class=\"n\">c</span><span class=\"o\">)</span> <span class=\"o\">:=</span>\n<span class=\"kd\">by</span> <span class=\"o\">{</span> <span class=\"n\">erw</span> <span class=\"n\">H.comp_obj</span> <span class=\"o\">}</span> <span class=\"c\">/-</span><span class=\"cm\"> goals accomplished -/</span>\n\n<span class=\"kd\">example</span> <span class=\"o\">:</span> <span class=\"n\">K.map</span> <span class=\"o\">(</span><span class=\"n\">α.app</span> <span class=\"o\">(</span><span class=\"n\">I.obj</span> <span class=\"o\">(</span><span class=\"n\">H.obj</span> <span class=\"n\">c</span><span class=\"o\">)))</span> <span class=\"bp\">=</span> <span class=\"n\">K.map</span> <span class=\"o\">(</span><span class=\"n\">α.app</span> <span class=\"o\">((</span><span class=\"n\">H</span> <span class=\"bp\">⋙</span> <span class=\"n\">I</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">obj</span> <span class=\"n\">c</span><span class=\"o\">))</span> <span class=\"o\">:=</span>\n<span class=\"kd\">by</span> <span class=\"o\">{</span> <span class=\"n\">erw</span> <span class=\"n\">H.comp_obj</span> <span class=\"o\">}</span> <span class=\"c\">/-</span><span class=\"cm\"> goals accomplished -/</span>\n\n<span class=\"kd\">example</span> <span class=\"o\">:</span> <span class=\"n\">K.map</span> <span class=\"o\">(</span><span class=\"n\">α.app</span> <span class=\"o\">(</span><span class=\"n\">I.obj</span> <span class=\"o\">(</span><span class=\"n\">H.obj</span> <span class=\"n\">c</span><span class=\"o\">)))</span> <span class=\"bp\">≫</span> <span class=\"n\">f</span> <span class=\"bp\">=</span> <span class=\"n\">K.map</span> <span class=\"o\">(</span><span class=\"n\">α.app</span> <span class=\"o\">((</span><span class=\"n\">H</span> <span class=\"bp\">⋙</span> <span class=\"n\">I</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">obj</span> <span class=\"n\">c</span><span class=\"o\">))</span> <span class=\"bp\">≫</span> <span class=\"n\">f</span> <span class=\"o\">:=</span>\n<span class=\"kd\">by</span> <span class=\"o\">{</span> <span class=\"n\">erw</span> <span class=\"n\">H.comp_obj</span> <span class=\"o\">}</span> <span class=\"c\">/-</span><span class=\"cm\"> motive not type correct !! -/</span>\n</code></pre></div>\n<p>All goals can actually be solved by <code>rfl</code>, but not being able to use <code>rw</code> means I have to write down the whole equality. Is there any way to improve <code>rw</code> to work in these circumstances? Or maybe another <code>eerw</code> tactic? The last example naturally arises in my attempt to show that a family of adjunctions (e.g. presheaf pullback-pushforward adjunction for each morphism in <code>Top</code>) transfers a pseudofunctor to a pseudofunctor, using results in <code>adjunction/mates</code>.</p>",
        "id": 261926841,
        "sender_full_name": "Junyan Xu",
        "timestamp": 1637242252
    },
    {
        "content": "<p>just tried <code>dsimp only [H.comp_obj]</code> and it fails to simplify ...</p>",
        "id": 261927591,
        "sender_full_name": "Junyan Xu",
        "timestamp": 1637242661
    },
    {
        "content": "<p><code>dsimp</code> works alone or with <code>only [category_theory.functor.comp_obj]</code>, not sure why it doesn't work with <code>only [H.comp_obj]</code>. Also not sure why <code>erw</code> ever <em>would</em> work.</p>",
        "id": 261934514,
        "sender_full_name": "Reid Barton",
        "timestamp": 1637245966
    },
    {
        "content": "<p>Maybe we should have some kind of <code>drw</code> or <code>dsimp_rw</code></p>",
        "id": 261934793,
        "sender_full_name": "Reid Barton",
        "timestamp": 1637246073
    },
    {
        "content": "<p>This also doesn't work</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kd\">example</span> <span class=\"o\">{</span><span class=\"n\">n</span> <span class=\"o\">:</span> <span class=\"n\">ℕ</span><span class=\"o\">}</span> <span class=\"o\">:</span> <span class=\"n\">n</span> <span class=\"bp\">+</span> <span class=\"mi\">0</span> <span class=\"bp\">=</span> <span class=\"n\">n</span> <span class=\"o\">:=</span> <span class=\"kd\">by</span> <span class=\"o\">{</span> <span class=\"n\">dsimp</span> <span class=\"o\">[</span><span class=\"n\">nat.add_zero</span> <span class=\"n\">n</span><span class=\"o\">],</span> <span class=\"o\">}</span>\n</code></pre></div>\n<p>Maybe passing arguments to lemmas for <code>dsimp</code> messes up its <code>rfl</code>-lemma thing?</p>",
        "id": 261935043,
        "sender_full_name": "Reid Barton",
        "timestamp": 1637246184
    },
    {
        "content": "<p>My strategy for this kind of reasoning was normally to get into a state where something like <code>simp, dsimp, simp</code> would work (= close the goal)</p>",
        "id": 261935201,
        "sender_full_name": "Reid Barton",
        "timestamp": 1637246264
    },
    {
        "content": "<p>another style that would work is</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kd\">example</span> <span class=\"o\">:</span> <span class=\"n\">K.map</span> <span class=\"o\">(</span><span class=\"n\">α.app</span> <span class=\"o\">(</span><span class=\"n\">I.obj</span> <span class=\"o\">(</span><span class=\"n\">H.obj</span> <span class=\"n\">c</span><span class=\"o\">)))</span> <span class=\"bp\">≫</span> <span class=\"n\">f</span> <span class=\"bp\">=</span> <span class=\"n\">K.map</span> <span class=\"o\">(</span><span class=\"n\">α.app</span> <span class=\"o\">((</span><span class=\"n\">H</span> <span class=\"bp\">⋙</span> <span class=\"n\">I</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">obj</span> <span class=\"n\">c</span><span class=\"o\">))</span> <span class=\"bp\">≫</span> <span class=\"n\">f</span> <span class=\"o\">:=</span>\n<span class=\"kd\">by</span> <span class=\"o\">{</span> <span class=\"n\">change</span> <span class=\"n\">I.obj</span> <span class=\"o\">(</span><span class=\"n\">H.obj</span> <span class=\"n\">c</span><span class=\"o\">)</span> <span class=\"k\">with</span> <span class=\"o\">(</span><span class=\"n\">H</span> <span class=\"bp\">⋙</span> <span class=\"n\">I</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">obj</span> <span class=\"n\">c</span><span class=\"o\">,</span> <span class=\"gr\">sorry</span> <span class=\"o\">}</span>\n</code></pre></div>",
        "id": 261935795,
        "sender_full_name": "Reid Barton",
        "timestamp": 1637246514
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"n\">dsimp</span> <span class=\"n\">works</span> <span class=\"k\">with</span> <span class=\"n\">only</span> <span class=\"o\">[</span><span class=\"n\">category_theory.functor.comp_obj</span><span class=\"o\">]</span>\n</code></pre></div>\n<p>Thank you! This is gonna be a life saver. I didn't even know <code>change</code> can be used with <code>with</code> to specify where to change; I <a href=\"https://github.com/leanprover-community/mathlib/blob/c920a07a2d01ff34619afa523954076853311310/src/category_theory/adjunction/mates.lean#L344\">tried <code>change</code> once</a> but it didn't work. Here I actually need to rewrite in the reverse direction then apply naturality (can't rw or erw naturality directly) in the reverse direction, and after that still need to rewrite by map_comp, assoc, and a triangle identity, and those can be done by simp (if it doesn't undo the rw &lt;- naturality). Unfortuantley I don't have time to complete the proofs until ~7 hours later.</p>",
        "id": 261946194,
        "sender_full_name": "Junyan Xu",
        "timestamp": 1637250867
    },
    {
        "content": "<p>The relevant part of the goal at this step is</p>\n<p>((adj f').unit.app ((Rmap f').obj ((Rmap (𝟙 X)).obj x)) ≫ <br>\n(Rmap f').map ((L.map_id X).app (<strong>(<a href=\"http://L.to_prefunctor.map\">L.to_prefunctor.map</a> f').obj ((Rmap f').obj</strong> ((Rmap (𝟙 X)).obj x))) ≫ (<br>\n<a href=\"http://L.to_prefunctor.map\">L.to_prefunctor.map</a> (𝟙 X)).map ((adj f').counit.app ((Rmap (𝟙 X)).obj x)) ≫ <br>\n(adj (𝟙 X)).counit.app x))</p>\n<p>The middle two lines are gonna be rewritten by naturality, and then cancel with the first line by triangle identity. The <code>(Rmap f').obj ((Rmap (𝟙 X)).obj</code> came from <code>Rmap (𝟙 X) ⋙ Rmap f'</code> via dsimp.</p>",
        "id": 261947117,
        "sender_full_name": "Junyan Xu",
        "timestamp": 1637251197
    },
    {
        "content": "<p>I guess it would go smoothly with simps after rewriting the right hand side with triangle identity ...</p>",
        "id": 261951553,
        "sender_full_name": "Junyan Xu",
        "timestamp": 1637252836
    }
]