---
layout: archive
title: Zulip Chat Archive
permalink: /stream/330515-LftCM22/topic/Formal.20power.20series.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/330515-LftCM22/index.html">LftCM22</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/330515-LftCM22/topic/Formal.20power.20series.html">Formal power series</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="289253400"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/330515-LftCM22/topic/Formal%20power%20series/near/289253400" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thomas Browning <a href="https://leanprover-community.github.io/archive/stream/330515-LftCM22/topic/Formal.20power.20series.html#289253400">(Jul 11 2022 at 21:39)</a>:</h4>
<p>Here's a thread for the formal power series project (I'll dump some code here when it's a bit more polished)</p>



<a name="289266897"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/330515-LftCM22/topic/Formal%20power%20series/near/289266897" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Tyler Raven Billingsley <a href="https://leanprover-community.github.io/archive/stream/330515-LftCM22/topic/Formal.20power.20series.html#289266897">(Jul 12 2022 at 00:44)</a>:</h4>
<p>Hi power series people! I have the first part (sine identity) down to proving the following:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code> <span class="bp">∀</span> <span class="n">k</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">,</span> <span class="o">(</span><span class="n">coeff</span> <span class="n">ℂ</span> <span class="o">(</span><span class="mi">2</span> <span class="bp">*</span> <span class="n">k</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">))</span> <span class="o">(</span><span class="n">sin</span> <span class="n">ℂ</span><span class="o">)</span> <span class="bp">=</span> <span class="o">(</span><span class="bp">-</span><span class="mi">1</span><span class="o">)</span> <span class="bp">^</span> <span class="n">k</span> <span class="bp">*</span> <span class="o">(</span><span class="n">coeff</span> <span class="n">ℂ</span> <span class="o">(</span><span class="mi">2</span> <span class="bp">*</span> <span class="n">k</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">))</span> <span class="o">(</span><span class="n">exp</span> <span class="n">ℂ</span><span class="o">)</span>
</code></pre></div>
<p>I'm not sure how to manipulate the relevant power series coefficients.</p>



<a name="289270323"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/330515-LftCM22/topic/Formal%20power%20series/near/289270323" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sam van G <a href="https://leanprover-community.github.io/archive/stream/330515-LftCM22/topic/Formal.20power.20series.html#289270323">(Jul 12 2022 at 01:53)</a>:</h4>
<p><span class="user-mention" data-user-id="268315">@Anatole Dedecker</span> <span class="user-mention" data-user-id="513593">@Phil Wood</span> and I worked on this a little bit and we eventually got somewhere, but the code is on Phil's computer.</p>



<a name="289271203"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/330515-LftCM22/topic/Formal%20power%20series/near/289271203" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Anatole Dedecker <a href="https://leanprover-community.github.io/archive/stream/330515-LftCM22/topic/Formal.20power.20series.html#289271203">(Jul 12 2022 at 02:11)</a>:</h4>
<p>Oh yeah we should definitely meet tomorrow to talk about it. Are you working on a common repo/branch, or completely separately ? As Sam said we solved a problem like that on Phil's code, and it was a bit painful because it's all "obvious stuff" and because the coefficients of the sine power series are defined in a strange way, exploiting the fact than natural number division floors the result, but we should be able to replicate it pretty easily now that we've identified the key lemmas for manipulating this</p>



<a name="289271629"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/330515-LftCM22/topic/Formal%20power%20series/near/289271629" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Anatole Dedecker <a href="https://leanprover-community.github.io/archive/stream/330515-LftCM22/topic/Formal.20power.20series.html#289271629">(Jul 12 2022 at 02:18)</a>:</h4>
<p>I hope we'll be able to get through the frustrating part of dealing with coercions and <a href="https://leanprover-community.github.io/mathlib_docs/find/algebra_map">docs#algebra_map</a> without too much damage, and if we manage that then it's kind of a good thing because knowing how to work around these kind of things is somewhat of a skill on its own imho</p>



<a name="289287657"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/330515-LftCM22/topic/Formal%20power%20series/near/289287657" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thomas Browning <a href="https://leanprover-community.github.io/archive/stream/330515-LftCM22/topic/Formal.20power.20series.html#289287657">(Jul 12 2022 at 07:25)</a>:</h4>
<p>Here's my code from yesterday, including the lemma that <span class="user-mention" data-user-id="410725">@Tyler Raven Billingsley</span> needs. I think I managed to avoid the worst of the algebra map pain.</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">ring_theory.power_series.well_known</span>
<span class="kn">import</span> <span class="n">data.complex.basic</span>

<span class="kn">namespace</span> <span class="n">power_series</span>

<span class="kn">open</span> <span class="n">complex</span>

<span class="kd">variables</span> <span class="o">{</span><span class="n">A</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">ring</span> <span class="n">A</span><span class="o">]</span> <span class="o">[</span><span class="n">algebra</span> <span class="n">ℚ</span> <span class="n">A</span><span class="o">]</span>

<span class="kd">lemma</span> <span class="n">coeff_sin_bit0</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="o">:</span> <span class="n">coeff</span> <span class="n">A</span> <span class="o">(</span><span class="n">bit0</span> <span class="n">n</span><span class="o">)</span> <span class="o">(</span><span class="n">sin</span> <span class="n">A</span><span class="o">)</span> <span class="bp">=</span> <span class="mi">0</span> <span class="o">:=</span>
<span class="kd">by</span> <span class="n">rw</span> <span class="o">[</span><span class="n">sin</span><span class="o">,</span> <span class="n">coeff_mk</span><span class="o">,</span> <span class="n">if_pos</span> <span class="o">(</span><span class="n">even_bit0</span> <span class="n">n</span><span class="o">)]</span>

<span class="kd">lemma</span> <span class="n">nat.bit1_div_bit0</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="o">:</span> <span class="n">bit1</span> <span class="n">a</span> <span class="bp">/</span> <span class="n">bit0</span> <span class="n">b</span> <span class="bp">=</span> <span class="n">a</span> <span class="bp">/</span> <span class="n">b</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="k">have</span> <span class="o">:=</span> <span class="n">nat.div_two_mul_two_add_one_of_odd</span> <span class="o">(</span><span class="n">odd_bit1</span> <span class="n">a</span><span class="o">),</span>
  <span class="n">rw</span> <span class="o">[</span><span class="n">mul_two</span><span class="o">,</span> <span class="bp">←</span><span class="n">bit0</span><span class="o">,</span> <span class="bp">←</span><span class="n">bit1</span><span class="o">,</span> <span class="n">nat.bit1_eq_bit1</span><span class="o">]</span> <span class="n">at</span> <span class="n">this</span><span class="o">,</span>
  <span class="n">rw</span> <span class="o">[</span><span class="n">bit0_eq_two_mul</span><span class="o">,</span> <span class="bp">←</span><span class="n">nat.div_div_eq_div_mul</span><span class="o">,</span> <span class="n">this</span><span class="o">],</span>
<span class="kd">end</span>

<span class="kd">lemma</span> <span class="n">coeff_sin_bit1</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="o">:</span> <span class="n">coeff</span> <span class="n">A</span> <span class="o">(</span><span class="n">bit1</span> <span class="n">n</span><span class="o">)</span> <span class="o">(</span><span class="n">sin</span> <span class="n">A</span><span class="o">)</span> <span class="bp">=</span> <span class="o">(</span><span class="bp">-</span><span class="mi">1</span><span class="o">)</span> <span class="bp">^</span> <span class="n">n</span> <span class="bp">*</span> <span class="n">coeff</span> <span class="n">A</span> <span class="o">(</span><span class="n">bit1</span> <span class="n">n</span><span class="o">)</span> <span class="o">(</span><span class="n">exp</span> <span class="n">A</span><span class="o">)</span> <span class="o">:=</span>
<span class="kd">by</span> <span class="n">rw</span> <span class="o">[</span><span class="n">sin</span><span class="o">,</span> <span class="n">coeff_mk</span><span class="o">,</span> <span class="n">if_neg</span> <span class="o">(</span><span class="n">nat.not_even_bit1</span> <span class="n">n</span><span class="o">),</span> <span class="n">nat.bit1_div_bit0</span><span class="o">,</span> <span class="n">nat.div_one</span><span class="o">,</span>
  <span class="bp">←</span><span class="n">mul_one_div</span><span class="o">,</span> <span class="n">map_mul</span><span class="o">,</span> <span class="n">map_pow</span><span class="o">,</span> <span class="n">map_neg</span><span class="o">,</span> <span class="n">map_one</span><span class="o">,</span> <span class="n">coeff_exp</span><span class="o">]</span>

<span class="kd">example</span> <span class="o">:</span> <span class="n">sin</span> <span class="n">ℂ</span> <span class="bp">=</span> <span class="o">(</span><span class="mi">2</span> <span class="bp">*</span> <span class="n">I</span><span class="o">)</span><span class="bp">⁻¹</span> <span class="bp">•</span> <span class="o">(</span><span class="n">rescale</span> <span class="n">I</span> <span class="o">(</span><span class="n">exp</span> <span class="n">ℂ</span><span class="o">)</span> <span class="bp">-</span> <span class="n">rescale</span> <span class="o">(</span><span class="bp">-</span><span class="n">I</span><span class="o">)</span> <span class="o">(</span><span class="n">exp</span> <span class="n">ℂ</span><span class="o">))</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="n">ext1</span> <span class="n">n</span><span class="o">,</span>
  <span class="n">rw</span> <span class="o">[</span><span class="n">map_smul</span><span class="o">,</span> <span class="n">map_sub</span><span class="o">,</span> <span class="n">coeff_rescale</span><span class="o">,</span> <span class="n">coeff_rescale</span><span class="o">,</span> <span class="n">neg_pow</span> <span class="n">I</span><span class="o">,</span> <span class="n">mul_assoc</span><span class="o">,</span> <span class="bp">←</span><span class="n">one_sub_mul</span><span class="o">],</span>
  <span class="n">rcases</span> <span class="n">n.even_or_odd</span> <span class="k">with</span> <span class="o">(⟨</span><span class="n">k</span><span class="o">,</span> <span class="n">rfl</span><span class="o">⟩</span> <span class="bp">|</span> <span class="o">⟨</span><span class="n">k</span><span class="o">,</span> <span class="n">rfl</span><span class="o">⟩),</span>
  <span class="o">{</span> <span class="n">rw</span> <span class="o">[</span><span class="bp">←</span><span class="n">bit0</span><span class="o">,</span> <span class="n">I_pow_bit0</span><span class="o">,</span> <span class="n">neg_pow_bit0</span><span class="o">,</span> <span class="n">one_pow</span><span class="o">,</span> <span class="n">sub_self</span><span class="o">,</span> <span class="n">zero_mul</span><span class="o">,</span> <span class="n">smul_zero</span><span class="o">,</span> <span class="n">coeff_sin_bit0</span><span class="o">]</span> <span class="o">},</span>
  <span class="o">{</span> <span class="n">rw</span> <span class="o">[</span><span class="n">two_mul</span><span class="o">,</span> <span class="bp">←</span><span class="n">bit0</span><span class="o">,</span> <span class="bp">←</span><span class="n">bit1</span><span class="o">,</span> <span class="n">neg_pow_bit1</span><span class="o">,</span> <span class="n">one_pow</span><span class="o">,</span> <span class="n">sub_neg_eq_add</span><span class="o">,</span> <span class="bp">←</span><span class="n">bit0</span><span class="o">],</span>
    <span class="n">rw</span> <span class="o">[</span><span class="n">I_pow_bit1</span><span class="o">,</span> <span class="n">mul_comm</span> <span class="o">((</span><span class="bp">-</span><span class="mi">1</span><span class="o">)</span> <span class="bp">^</span> <span class="n">k</span><span class="o">)</span> <span class="n">I</span><span class="o">,</span> <span class="n">mul_assoc</span><span class="o">,</span> <span class="bp">←</span><span class="n">mul_assoc</span><span class="o">,</span> <span class="n">smul_eq_mul</span><span class="o">,</span>
        <span class="n">inv_mul_cancel_left₀</span><span class="o">,</span> <span class="n">coeff_sin_bit1</span><span class="o">],</span>
    <span class="n">exact</span> <span class="n">mul_ne_zero</span> <span class="n">two_ne_zero'</span> <span class="n">I_ne_zero</span> <span class="o">},</span>
<span class="kd">end</span>

<span class="kd">end</span> <span class="n">power_series</span>
</code></pre></div>



<a name="289326108"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/330515-LftCM22/topic/Formal%20power%20series/near/289326108" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Anatole Dedecker <a href="https://leanprover-community.github.io/archive/stream/330515-LftCM22/topic/Formal.20power.20series.html#289326108">(Jul 12 2022 at 13:49)</a>:</h4>
<p>Okay so it seems like you are all working separately, right ? Would you be interested in setting up a lean project to put that in common (or at least set up a branch in mathlib) ? That would be a really good occasion to get some experience with GitHub if you aren't already sed to it (and I should say that, even when working alone on a project, you are still encouraged to set up a lean project / branch of mathlib to be able to share your code later)</p>



<a name="289327325"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/330515-LftCM22/topic/Formal%20power%20series/near/289327325" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sam van G <a href="https://leanprover-community.github.io/archive/stream/330515-LftCM22/topic/Formal.20power.20series.html#289327325">(Jul 12 2022 at 13:57)</a>:</h4>
<p>could we get non-master-branch write permissions (samvang, tyler-billingsley) please ? <span aria-label="smile" class="emoji emoji-1f642" role="img" title="smile">:smile:</span></p>



<a name="289327735"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/330515-LftCM22/topic/Formal%20power%20series/near/289327735" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thomas Browning <a href="https://leanprover-community.github.io/archive/stream/330515-LftCM22/topic/Formal.20power.20series.html#289327735">(Jul 12 2022 at 14:00)</a>:</h4>
<p>philmwood as well</p>



<a name="289327813"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/330515-LftCM22/topic/Formal%20power%20series/near/289327813" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Oliver Nash <a href="https://leanprover-community.github.io/archive/stream/330515-LftCM22/topic/Formal.20power.20series.html#289327813">(Jul 12 2022 at 14:00)</a>:</h4>
<p>I've just sent an invite to <code>samvang</code> I'll do the others now.</p>



<a name="289328110"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/330515-LftCM22/topic/Formal%20power%20series/near/289328110" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Oliver Nash <a href="https://leanprover-community.github.io/archive/stream/330515-LftCM22/topic/Formal.20power.20series.html#289328110">(Jul 12 2022 at 14:02)</a>:</h4>
<p>OK I've sent invites to Tyler and Phil now also. (This is actually the first time I've sent invites --- I believe I've clicked the right buttons but LMK if any issues.)</p>



<a name="289330356"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/330515-LftCM22/topic/Formal%20power%20series/near/289330356" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Oliver Nash <a href="https://leanprover-community.github.io/archive/stream/330515-LftCM22/topic/Formal.20power.20series.html#289330356">(Jul 12 2022 at 14:17)</a>:</h4>
<p>(I did mess up the invites but I believe I have done it correctly now --- you may get some confusing emails from GitHub but hopefully all should work.)</p>



<a name="289331640"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/330515-LftCM22/topic/Formal%20power%20series/near/289331640" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jake Levinson <a href="https://leanprover-community.github.io/archive/stream/330515-LftCM22/topic/Formal.20power.20series.html#289331640">(Jul 12 2022 at 14:25)</a>:</h4>
<p><span class="user-mention" data-user-id="240862">@Oliver Nash</span> Can I get non-master-branch write permissions as well? My github username is <code>jakelev</code>.</p>



<a name="289331785"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/330515-LftCM22/topic/Formal%20power%20series/near/289331785" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Oliver Nash <a href="https://leanprover-community.github.io/archive/stream/330515-LftCM22/topic/Formal.20power.20series.html#289331785">(Jul 12 2022 at 14:26)</a>:</h4>
<p>Done</p>



<a name="289332935"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/330515-LftCM22/topic/Formal%20power%20series/near/289332935" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sam van G <a href="https://leanprover-community.github.io/archive/stream/330515-LftCM22/topic/Formal.20power.20series.html#289332935">(Jul 12 2022 at 14:33)</a>:</h4>
<p>It worked for me, thanks <span class="user-mention" data-user-id="240862">@Oliver Nash</span></p>



<a name="289787611"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/330515-LftCM22/topic/Formal%20power%20series/near/289787611" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Tyler Raven Billingsley <a href="https://leanprover-community.github.io/archive/stream/330515-LftCM22/topic/Formal.20power.20series.html#289787611">(Jul 15 2022 at 21:50)</a>:</h4>
<p><span class="user-mention" data-user-id="513593">@Phil Wood</span> Just realized that your alternate Catalan number recursion formula might be good for the Catalan file in mathlib!</p>



<a name="289788516"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/330515-LftCM22/topic/Formal%20power%20series/near/289788516" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Phil Wood <a href="https://leanprover-community.github.io/archive/stream/330515-LftCM22/topic/Formal.20power.20series.html#289788516">(Jul 15 2022 at 22:00)</a>:</h4>
<p>That is a good thought!  I need to think a bit on the proof though, since it is a huge mess of rw and nth_rewrite commands at the moment.  But if I can get that cleaned up, I may well give PR-ing a try!</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>