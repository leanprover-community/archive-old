---
layout: archive
title: Zulip Chat Archive
permalink: /stream/288720-mathlib-documentation/topic/searching.20through.20docs.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/288720-mathlib-documentation/index.html">mathlib documentation</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/288720-mathlib-documentation/topic/searching.20through.20docs.html">searching through docs</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="238892191"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/288720-mathlib%20documentation/topic/searching%20through%20docs/near/238892191" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Polina Boneva <a href="https://leanprover-community.github.io/archive/stream/288720-mathlib-documentation/topic/searching.20through.20docs.html#238892191">(May 15 2021 at 11:55)</a>:</h4>
<p>Hello, I'm starting this topic in a documentation-only oriented stream because having a written overview (the docs) of everything old and new in mathlib seems important enough on its own, independent from the specifics of lean's version or mathlib's changes in the future. I hope this was the right way to go here, I'm sorry if a new stream is not the best approach - let's change it if there is a better place :)</p>
<p>Just a sidenote - to introduce myself, I am a student at the Vrije Universiteit Amsterdam currently and for the future residing in Sofia, Bulgaria. For my bachelor's finishing lane I took a thesis project that describes the needs of the documentation of a library for formal proofs, mainly for the purposes of destructing, re-organizing in a concise and simple way, and traversing the whole load of data the full library holds for all kinds of users: from novice to experts. As some of you know, there has been some progress in the search capabilities of mathlib - from a Google search to a search through the names of all declarations, and now a search through the names of the declarations, the name of the modules they are in, and the descriptions for each declaration, if there is any of course.  Filtering by attributes and kind has also been added, in a demo for now only.<br>
The separate data used for the search holds a list of all declarations, each of which carries the following properties: name, module, description, attributes, kind. <br>
Please check out the demo here: <a href="https://leanprover-community.github.io/mathlib_docs_demo/">https://leanprover-community.github.io/mathlib_docs_demo/</a> and share your observations and concerns, especially if there are any issues. Some issues have been found and are being discussed in the PR: <a href="https://github.com/leanprover-community/doc-gen/pull/131">https://github.com/leanprover-community/doc-gen/pull/131</a><br>
Naturally, it might be better to discuss the specifics of each issue (mainly connected to the differences in operating systems and their apps it seems) in this stream in a topic specific for this milestone of the search method and indexed data, or in a private message with me - where we can delve deeper into the problem to find a solution :) . </p>
<p>This topic here is more general about your needs, as users and maintainers of the mathlib library, regarding the search capabilities and features for the future. Please don't hesitate to call forth what you imagine would be useful or absolutely necessary.</p>



<a name="238894238"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/288720-mathlib%20documentation/topic/searching%20through%20docs/near/238894238" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/288720-mathlib-documentation/topic/searching.20through.20docs.html#238894238">(May 15 2021 at 12:28)</a>:</h4>
<p><span class="user-mention" data-user-id="362431">@Polina Boneva</span> Thanks a lot for working on this! The docs are already very useful, and it's great that you are making them even better!</p>



<a name="238913647"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/288720-mathlib%20documentation/topic/searching%20through%20docs/near/238913647" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Floris van Doorn <a href="https://leanprover-community.github.io/archive/stream/288720-mathlib-documentation/topic/searching.20through.20docs.html#238913647">(May 15 2021 at 17:37)</a>:</h4>
<p>There are some features related to searching I would really like. Btw, the only way I search through the docs is via a link like <br>
<a href="https://leanprover-community.github.io/mathlib_docs/find/foo">https://leanprover-community.github.io/mathlib_docs/find/foo</a><br>
(which I made a standard search engine in my browser with a convenient <code>ml</code> shortcut).</p>
<p>I regularly search for names, but I don't know in what namespace this name is (when copying a name from anywhere on Zulip/Github/uncompiled file in VSCode). Therefore, I am most interested in my search term in various namespaces. So if I search for <code>foo</code>, I'm most interested in any declaration whose name <em>ends</em> with <code>.foo</code>. Ideally:</p>
<ul>
<li>If there is one such declaration: redirect automatically to that declaration.</li>
<li>If there are more than one such declaration, the page shows a list <code>Declarations in namespaces matching the name exactly:</code> above the current list of suggestions.</li>
<li>If there are no matches, give the current list of suggestions.</li>
</ul>



<a name="238971878"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/288720-mathlib%20documentation/topic/searching%20through%20docs/near/238971878" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Polina Boneva <a href="https://leanprover-community.github.io/archive/stream/288720-mathlib-documentation/topic/searching.20through.20docs.html#238971878">(May 16 2021 at 11:59)</a>:</h4>
<p>I'm glad you turned my attention to this example exactly because I find it weird how the webpages for <a href="https://leanprover-community.github.io/mathlib_docs/counterexamples/linear_order_with_pos_mul_pos_eq_zero.html">counterexamples</a>  is created in the list of mathlib directories and modules, since it's neither <code>foo.has_zero</code>, nor <code>foo.has_one</code> can be found in the export.json and <code>foo.inhabited</code> is only found as part of a description of instances for <code>cathegory_theory.ulift_functor_full</code>.  Searching for <code>foo</code> in the current search (that is by names only) does find them all though, which means they must be in the data structure (loc_map) generated from the export.json in the first place. I'm sure I'm missing something, but I can't see it. Are you able to pinpoint where and how are those extra names added to the data structure (loc_map) used for generating the names list that works in the search that is currently live?</p>
<p>Regarding the search capabilities on the basis of partial-matching inside namespaces, this is a great suggestion and should be implemented indeed. Maybe a partial match in the descriptions of each declaration, and an exact match in the namespaces? Or the opposite? Maybe it will be even better if it's a choice given to the user to select before searching. <br>
I don't think automatic redirecting is a good idea in a place where most of the results from an action don't redirect and only a very small amount of them would. Isn't it usually best if the user experience is easy to anticipate and understand for first-comers too?</p>
<p>What kind of suggestions do you mean exactly? The current list offers matches in namespaces exactly. Do you mean this or a list of results of a similar query, if none for the current query are found?</p>



<a name="238998543"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/288720-mathlib%20documentation/topic/searching%20through%20docs/near/238998543" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Floris van Doorn <a href="https://leanprover-community.github.io/archive/stream/288720-mathlib-documentation/topic/searching.20through.20docs.html#238998543">(May 16 2021 at 18:52)</a>:</h4>
<p>Oh, my example searching for <code>foo</code> was confusing: the declaration <code>foo</code> didn't exist when I wrote my comment, so I didn't mean <code>foo</code> specifically, but just an arbitrary search term.</p>
<p>When I search for a name, say <code>my_name</code>, and there is a declaration <code>list.my_name</code> or even <code>measure_theory.measure.regular.my_name</code>, I always mean one of those possibilities: I have just copied the name without its namespace from somewhere, and that is the declaration I'm interested in. Redirecting would definitely be my preferred behavior (if there is exactly one match inside some namespace), but I can live with it being the top result.</p>
<p>Here is the current "problem".<br>
If I currently search for <a href="https://leanprover-community.github.io/mathlib_docs/find/map_update">docs#map_update</a>, the exact match in of a declaration in a namespace is <a href="https://leanprover-community.github.io/mathlib_docs/find/list.nodup.map_update">docs#list.nodup.map_update</a>, but it is only the 10th showing result. Even worse is <a href="https://leanprover-community.github.io/mathlib_docs/find/to_list_nodup">docs#to_list_nodup</a>, which matches <a href="https://leanprover-community.github.io/mathlib_docs/find/option.to_list_nodup">docs#option.to_list_nodup</a>, but that is not one of the 20 displayed suggestions.</p>



<a name="238999197"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/288720-mathlib%20documentation/topic/searching%20through%20docs/near/238999197" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/288720-mathlib-documentation/topic/searching.20through.20docs.html#238999197">(May 16 2021 at 19:03)</a>:</h4>
<p>+1 from me -- I sometimes run into exactly this problem (when reading Lean but not having access to a Lean session).</p>



<a name="239001393"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/288720-mathlib%20documentation/topic/searching%20through%20docs/near/239001393" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Polina Boneva <a href="https://leanprover-community.github.io/archive/stream/288720-mathlib-documentation/topic/searching.20through.20docs.html#239001393">(May 16 2021 at 19:43)</a>:</h4>
<p>Aha, I understand you a bit better now. Since you mention the 20 results that are currently displayed from the search results, I guess you haven't tried using the search that is currently under PR: <a href="https://leanprover-community.github.io/mathlib_docs_demo/">https://leanprover-community.github.io/mathlib_docs_demo/</a> <br>
Try it and let me know if it's better for your purposes. <br>
For now I see that the ending part of the declaration names holds more value than any other, thank you. I will see what can be done to prioritize it because it is indeed the most specific part of the namespace. Overall for now in the demo above the namespace of the declaration holds a higher priority than any findings in the description or name of the module the declaration is in, but there can definitely be done more for a more specific prioritization criteria.</p>



<a name="239023481"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/288720-mathlib%20documentation/topic/searching%20through%20docs/near/239023481" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Floris van Doorn <a href="https://leanprover-community.github.io/archive/stream/288720-mathlib-documentation/topic/searching.20through.20docs.html#239023481">(May 17 2021 at 02:01)</a>:</h4>
<p>I was indeed not using your search function. <br>
I tried it: your search function gets the "correct" first result with <code>to_list_nodup</code>. With <code>to_list_nodup</code> the "correct" result is at number 8. So it's indeed better, but I think it would be good to build in this heuristic that the namespaces of a name are less valuable when searching.</p>
<p>When using your search function, I had a problem that my search query actually started with a zero-width space (U+200B), and it gave me 0 results back. Presumably that character got there when I copy-pasted some text in there (I'm not quite sure where I copied from). Can you strip out all space-like characters before searching? (Lean might allow some zero-width-space characters in declaration names, but I'd wager we're not going to use them in mathlib.)</p>



<a name="239043299"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/288720-mathlib%20documentation/topic/searching%20through%20docs/near/239043299" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/288720-mathlib-documentation/topic/searching.20through.20docs.html#239043299">(May 17 2021 at 07:12)</a>:</h4>
<p><span class="user-mention silent" data-user-id="111080">Floris van Doorn</span> <a href="#narrow/stream/288720-mathlib-documentation/topic/searching.20through.20docs/near/239023481">said</a>:</p>
<blockquote>
<p>I'm not quite sure where I copied from</p>
</blockquote>
<p>From the documentation, probably.  We used to insert zero-width spaces after every dot (to allow linebreaks).  I believe Alex Peattie changed this to  use a CSS-based solution instead for most of the documentation, but the 404 page was still using them.</p>



<a name="239044665"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/288720-mathlib%20documentation/topic/searching%20through%20docs/near/239044665" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Polina Boneva <a href="https://leanprover-community.github.io/archive/stream/288720-mathlib-documentation/topic/searching.20through.20docs.html#239044665">(May 17 2021 at 07:26)</a>:</h4>
<p>That's a good point! I pushed a fix that trims the query before searching :) it's generally a good idea to treat strings this way</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>