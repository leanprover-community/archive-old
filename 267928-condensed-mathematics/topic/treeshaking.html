---
layout: archive
title: Zulip Chat Archive
permalink: /stream/267928-condensed-mathematics/topic/treeshaking.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/index.html">condensed mathematics</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/treeshaking.html">treeshaking</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="236457577"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/treeshaking/near/236457577" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/treeshaking.html#236457577">(Apr 28 2021 at 06:38)</a>:</h4>
<p>I think it would be useful to have a list of all declarations in LTE that are currently not in the dependency tree of <code>thm95</code>.<br>
I've done a fair amount of refactoring, and I think there's quite a lot of old code that can now be removed. Of course we can prune the system manually, but if someone wants to automate generating this list, that would be cool.<br>
(We should probably still manually do the actual deletion, because some things on the list might actually be useful in the future.)</p>



<a name="236594545"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/treeshaking/near/236594545" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/treeshaking.html#236594545">(Apr 28 2021 at 23:13)</a>:</h4>
<p><span class="user-mention" data-user-id="110026">@Simon Hudon</span> added a tactic to mathlib for doing precisely this.<br>
If you <code>import tactic.unused_decls</code> and add <code>@[main_declaration]</code> to the theorem you want and then call <code>#list_unused_decls []</code> below it finds all the unused decls in the current file. Assuming you want all of them you can add</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="bp">#</span><span class="n">list_unused_decls</span> <span class="o">[</span><span class="s2">"src/breen_deligne/category.lean"</span><span class="o">,</span><span class="s2">"src/breen_deligne/constants.lean"</span><span class="o">,</span><span class="s2">"src/breen_deligne/eg.lean"</span><span class="o">,</span><span class="s2">"src/breen_deligne/functorial_map.lean"</span><span class="o">,</span><span class="s2">"src/breen_deligne/suitable.lean"</span><span class="o">,</span><span class="s2">"src/breen_deligne/universal_map.lean"</span><span class="o">,</span><span class="s2">"src/combinatorial_lemma.lean"</span><span class="o">,</span><span class="s2">"src/facts/default.lean"</span><span class="o">,</span><span class="s2">"src/facts/int.lean"</span><span class="o">,</span><span class="s2">"src/facts/nnreal.lean"</span><span class="o">,</span><span class="s2">"src/facts/normed_group.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/additive_functor.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/add_monoid_hom.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/arrow.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/big_operators_basic.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/category.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/curry.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/dfinsupp.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/equalizers.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/extend_from_nat.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/filter_at_top_bot.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/finsupp.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/Fintype/basic.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/free_abelian_group.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/Gordan.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/grading.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/grading_examples.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/grading_monoid_algebra.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/int_grading_lemma.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/kronecker.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/linear_algebra.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/nnreal.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/normed_group.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/normed_group_hom.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/normed_group_hom_bound_by.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/normed_group_hom_completion.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/normed_group_hom_equalizer.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/normed_group_quotient.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/order_basic.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/pi_nat_apply.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/preadditive_category.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/Profinite/basic.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/Profinite/functorial_limit.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/Profinite/limits.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/Profinite/locally_constant.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/Profinite/nhds.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/Profinite.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/pseudo_metric.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/quotient_group.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/real_Inf.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/simplicial/augmented.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/simplicial/complex.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/specific_limit.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/Top/limits.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/tsum.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/uniform_space_cauchy.lean"</span><span class="o">,</span><span class="s2">"src/hacks_and_tricks/by_exactI_hack.lean"</span><span class="o">,</span><span class="s2">"src/hacks_and_tricks/type_pow.lean"</span><span class="o">,</span><span class="s2">"src/lem97.lean"</span><span class="o">,</span><span class="s2">"src/liquid.lean"</span><span class="o">,</span><span class="s2">"src/locally_constant/analysis.lean"</span><span class="o">,</span><span class="s2">"src/locally_constant/NormedGroup.lean"</span><span class="o">,</span><span class="s2">"src/locally_constant/Vhat.lean"</span><span class="o">,</span><span class="s2">"src/Mbar/basic.lean"</span><span class="o">,</span><span class="s2">"src/Mbar/bounded.lean"</span><span class="o">,</span><span class="s2">"src/Mbar/Mbar_le.lean"</span><span class="o">,</span><span class="s2">"src/Mbar/pseudo_normed_group.lean"</span><span class="o">,</span><span class="s2">"src/normed_group/controlled_exactness.lean"</span><span class="o">,</span><span class="s2">"src/normed_group/NormedGroup.lean"</span><span class="o">,</span><span class="s2">"src/normed_group/normed_with_aut.lean"</span><span class="o">,</span><span class="s2">"src/normed_group/pseudo_normed_group.lean"</span><span class="o">,</span><span class="s2">"src/normed_snake.lean"</span><span class="o">,</span><span class="s2">"src/normed_spectral.lean"</span><span class="o">,</span><span class="s2">"src/partition.lean"</span><span class="o">,</span><span class="s2">"src/polyhedral_lattice/basic.lean"</span><span class="o">,</span><span class="s2">"src/polyhedral_lattice/category.lean"</span><span class="o">,</span><span class="s2">"src/polyhedral_lattice/cech.lean"</span><span class="o">,</span><span class="s2">"src/polyhedral_lattice/cosimplicial.lean"</span><span class="o">,</span><span class="s2">"src/polyhedral_lattice/direct_sum.lean"</span><span class="o">,</span><span class="s2">"src/polyhedral_lattice/finsupp.lean"</span><span class="o">,</span><span class="s2">"src/polyhedral_lattice/Hom.lean"</span><span class="o">,</span><span class="s2">"src/polyhedral_lattice/int.lean"</span><span class="o">,</span><span class="s2">"src/polyhedral_lattice/pseudo_normed_group.lean"</span><span class="o">,</span><span class="s2">"src/polyhedral_lattice/topology.lean"</span><span class="o">,</span><span class="s2">"src/prop_92.lean"</span><span class="o">,</span><span class="s2">"src/pseudo_normed_group/basic.lean"</span><span class="o">,</span><span class="s2">"src/pseudo_normed_group/breen_deligne.lean"</span><span class="o">,</span><span class="s2">"src/pseudo_normed_group/category.lean"</span><span class="o">,</span><span class="s2">"src/pseudo_normed_group/CLC.lean"</span><span class="o">,</span><span class="s2">"src/pseudo_normed_group/FiltrationPow.lean"</span><span class="o">,</span><span class="s2">"src/pseudo_normed_group/homotopy.lean"</span><span class="o">,</span><span class="s2">"src/pseudo_normed_group/LC.lean"</span><span class="o">,</span><span class="s2">"src/pseudo_normed_group/profinitely_filtered.lean"</span><span class="o">,</span><span class="s2">"src/pseudo_normed_group/system_of_complexes.lean"</span><span class="o">,</span><span class="s2">"src/pseudo_normed_group/Tinv.lean"</span><span class="o">,</span><span class="s2">"src/pseudo_normed_group/with_Tinv.lean"</span><span class="o">,</span><span class="s2">"src/rescale/basic.lean"</span><span class="o">,</span><span class="s2">"src/rescale/CLC.lean"</span><span class="o">,</span><span class="s2">"src/rescale/FiltrationPow.lean"</span><span class="o">,</span><span class="s2">"src/rescale/LC.lean"</span><span class="o">,</span><span class="s2">"src/rescale/normed_group.lean"</span><span class="o">,</span><span class="s2">"src/rescale/polyhedral_lattice.lean"</span><span class="o">,</span><span class="s2">"src/rescale/pseudo_normed_group.lean"</span><span class="o">,</span><span class="s2">"src/rescale/Tinv.lean"</span><span class="o">,</span><span class="s2">"src/simplicial/alternating_face_map.lean"</span><span class="o">,</span><span class="s2">"src/system_of_complexes/basic.lean"</span><span class="o">,</span><span class="s2">"src/system_of_complexes/completion.lean"</span><span class="o">,</span><span class="s2">"src/system_of_complexes/complex.lean"</span><span class="o">,</span><span class="s2">"src/system_of_complexes/double.lean"</span><span class="o">,</span><span class="s2">"src/system_of_complexes/rescale.lean"</span><span class="o">,</span><span class="s2">"src/system_of_complexes/truncate.lean"</span><span class="o">,</span><span class="s2">"src/thm95/constants.lean"</span><span class="o">,</span><span class="s2">"src/thm95/default.lean"</span><span class="o">,</span><span class="s2">"src/thm95/double_complex.lean"</span><span class="o">,</span><span class="s2">"src/thm95/modify_complex.lean"</span><span class="o">,</span><span class="s2">"src/thm95/polyhedral_iso.lean"</span><span class="o">,</span><span class="s2">"src/thm95/row_iso.lean"</span><span class="o">]</span>
</code></pre></div>
<p>the output i got tagging <code>thm95</code> as the main declaration is at:<br>
<a href="https://gist.github.com/alexjbest/57d5fead003dddd6931e8c0edcccc364">https://gist.github.com/alexjbest/57d5fead003dddd6931e8c0edcccc364</a></p>



<a name="236594999"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/treeshaking/near/236594999" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/treeshaking.html#236594999">(Apr 28 2021 at 23:18)</a>:</h4>
<p>I don't know how sensible the output is tbh, there looks like a huge amount of stuff at present</p>



<a name="236612107"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/treeshaking/near/236612107" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/treeshaking.html#236612107">(Apr 29 2021 at 03:04)</a>:</h4>
<p>Thanks. I'm actually not surprised that the list is long (-;</p>



<a name="236612118"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/treeshaking/near/236612118" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/treeshaking.html#236612118">(Apr 29 2021 at 03:05)</a>:</h4>
<p>I'll sort the list, and then start working on the cleanup (-;</p>



<a name="236612874"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/treeshaking/near/236612874" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/treeshaking.html#236612874">(Apr 29 2021 at 03:16)</a>:</h4>
<p>There are also lots of entries generated by <code>@[simps]</code>. Of course it would be cool if those can be filtered out. But I don't think it's too important.<br>
The sorted output looks pretty useful to me. I'll report back how many of the 840 lines remain after a first go at cleaning up (-;</p>



<a name="236614536"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/treeshaking/near/236614536" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/treeshaking.html#236614536">(Apr 29 2021 at 03:43)</a>:</h4>
<p>Oooh, one reason why the output is so long is because <code>thm95/default.lean</code> currently doesn't import and use the main result of <code>thm95/row_iso.lean</code>. But when I try to do that import, I get timeouts )-;</p>



<a name="236614602"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/treeshaking/near/236614602" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/treeshaking.html#236614602">(Apr 29 2021 at 03:44)</a>:</h4>
<p>One reason I want to do the treeshaking now, is to make the entire project faster to compile again. Hopefully that will help in debugging what is wrong with that import between two of the high-level files in the project.</p>



<a name="236617151"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/treeshaking/near/236617151" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/treeshaking.html#236617151">(Apr 29 2021 at 04:25)</a>:</h4>
<p>Wow, with</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">tactic.find_unused</span>
<span class="kn">import</span> <span class="n">thm95.default</span>
<span class="kn">import</span> <span class="n">thm95.row_iso</span>
<span class="bp">#</span><span class="n">list_unused_decls</span> <span class="o">[</span><span class="s2">"src/breen_deligne/category.lean"</span><span class="o">,</span><span class="s2">"src/breen_deligne/constants.lean"</span><span class="o">,</span><span class="s2">"src/breen_deligne/eg.lean"</span><span class="o">,</span><span class="s2">"src/breen_deligne/functorial_map.lean"</span><span class="o">,</span><span class="s2">"src/breen_deligne/suitable.lean"</span><span class="o">,</span><span class="s2">"src/breen_deligne/universal_map.lean"</span><span class="o">,</span><span class="s2">"src/combinatorial_lemma.lean"</span><span class="o">,</span><span class="s2">"src/facts/default.lean"</span><span class="o">,</span><span class="s2">"src/facts/int.lean"</span><span class="o">,</span><span class="s2">"src/facts/nnreal.lean"</span><span class="o">,</span><span class="s2">"src/facts/normed_group.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/additive_functor.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/add_monoid_hom.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/arrow.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/big_operators_basic.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/category.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/curry.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/dfinsupp.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/equalizers.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/extend_from_nat.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/filter_at_top_bot.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/finsupp.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/Fintype/basic.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/free_abelian_group.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/Gordan.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/grading.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/grading_examples.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/grading_monoid_algebra.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/int_grading_lemma.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/kronecker.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/linear_algebra.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/nnreal.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/normed_group.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/normed_group_hom.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/normed_group_hom_bound_by.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/normed_group_hom_completion.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/normed_group_hom_equalizer.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/normed_group_quotient.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/order_basic.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/pi_nat_apply.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/preadditive_category.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/Profinite/basic.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/Profinite/functorial_limit.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/Profinite/limits.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/Profinite/locally_constant.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/Profinite/nhds.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/Profinite.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/pseudo_metric.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/quotient_group.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/real_Inf.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/simplicial/augmented.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/simplicial/complex.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/specific_limit.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/Top/limits.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/tsum.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/uniform_space_cauchy.lean"</span><span class="o">,</span><span class="s2">"src/hacks_and_tricks/by_exactI_hack.lean"</span><span class="o">,</span><span class="s2">"src/hacks_and_tricks/type_pow.lean"</span><span class="o">,</span><span class="s2">"src/lem97.lean"</span><span class="o">,</span><span class="s2">"src/liquid.lean"</span><span class="o">,</span><span class="s2">"src/locally_constant/analysis.lean"</span><span class="o">,</span><span class="s2">"src/locally_constant/NormedGroup.lean"</span><span class="o">,</span><span class="s2">"src/locally_constant/Vhat.lean"</span><span class="o">,</span><span class="s2">"src/Mbar/basic.lean"</span><span class="o">,</span><span class="s2">"src/Mbar/bounded.lean"</span><span class="o">,</span><span class="s2">"src/Mbar/Mbar_le.lean"</span><span class="o">,</span><span class="s2">"src/Mbar/pseudo_normed_group.lean"</span><span class="o">,</span><span class="s2">"src/normed_group/controlled_exactness.lean"</span><span class="o">,</span><span class="s2">"src/normed_group/NormedGroup.lean"</span><span class="o">,</span><span class="s2">"src/normed_group/normed_with_aut.lean"</span><span class="o">,</span><span class="s2">"src/normed_group/pseudo_normed_group.lean"</span><span class="o">,</span><span class="s2">"src/normed_snake.lean"</span><span class="o">,</span><span class="s2">"src/normed_spectral.lean"</span><span class="o">,</span><span class="s2">"src/partition.lean"</span><span class="o">,</span><span class="s2">"src/polyhedral_lattice/basic.lean"</span><span class="o">,</span><span class="s2">"src/polyhedral_lattice/category.lean"</span><span class="o">,</span><span class="s2">"src/polyhedral_lattice/cech.lean"</span><span class="o">,</span><span class="s2">"src/polyhedral_lattice/cosimplicial.lean"</span><span class="o">,</span><span class="s2">"src/polyhedral_lattice/direct_sum.lean"</span><span class="o">,</span><span class="s2">"src/polyhedral_lattice/finsupp.lean"</span><span class="o">,</span><span class="s2">"src/polyhedral_lattice/Hom.lean"</span><span class="o">,</span><span class="s2">"src/polyhedral_lattice/int.lean"</span><span class="o">,</span><span class="s2">"src/polyhedral_lattice/pseudo_normed_group.lean"</span><span class="o">,</span><span class="s2">"src/polyhedral_lattice/topology.lean"</span><span class="o">,</span><span class="s2">"src/prop_92.lean"</span><span class="o">,</span><span class="s2">"src/pseudo_normed_group/basic.lean"</span><span class="o">,</span><span class="s2">"src/pseudo_normed_group/breen_deligne.lean"</span><span class="o">,</span><span class="s2">"src/pseudo_normed_group/category.lean"</span><span class="o">,</span><span class="s2">"src/pseudo_normed_group/CLC.lean"</span><span class="o">,</span><span class="s2">"src/pseudo_normed_group/FiltrationPow.lean"</span><span class="o">,</span><span class="s2">"src/pseudo_normed_group/homotopy.lean"</span><span class="o">,</span><span class="s2">"src/pseudo_normed_group/LC.lean"</span><span class="o">,</span><span class="s2">"src/pseudo_normed_group/profinitely_filtered.lean"</span><span class="o">,</span><span class="s2">"src/pseudo_normed_group/system_of_complexes.lean"</span><span class="o">,</span><span class="s2">"src/pseudo_normed_group/Tinv.lean"</span><span class="o">,</span><span class="s2">"src/pseudo_normed_group/with_Tinv.lean"</span><span class="o">,</span><span class="s2">"src/rescale/basic.lean"</span><span class="o">,</span><span class="s2">"src/rescale/CLC.lean"</span><span class="o">,</span><span class="s2">"src/rescale/FiltrationPow.lean"</span><span class="o">,</span><span class="s2">"src/rescale/LC.lean"</span><span class="o">,</span><span class="s2">"src/rescale/normed_group.lean"</span><span class="o">,</span><span class="s2">"src/rescale/polyhedral_lattice.lean"</span><span class="o">,</span><span class="s2">"src/rescale/pseudo_normed_group.lean"</span><span class="o">,</span><span class="s2">"src/rescale/Tinv.lean"</span><span class="o">,</span><span class="s2">"src/simplicial/alternating_face_map.lean"</span><span class="o">,</span><span class="s2">"src/system_of_complexes/basic.lean"</span><span class="o">,</span><span class="s2">"src/system_of_complexes/completion.lean"</span><span class="o">,</span><span class="s2">"src/system_of_complexes/complex.lean"</span><span class="o">,</span><span class="s2">"src/system_of_complexes/double.lean"</span><span class="o">,</span><span class="s2">"src/system_of_complexes/rescale.lean"</span><span class="o">,</span><span class="s2">"src/system_of_complexes/truncate.lean"</span><span class="o">,</span><span class="s2">"src/thm95/constants.lean"</span><span class="o">,</span><span class="s2">"src/thm95/default.lean"</span><span class="o">,</span><span class="s2">"src/thm95/double_complex.lean"</span><span class="o">,</span><span class="s2">"src/thm95/modify_complex.lean"</span><span class="o">,</span><span class="s2">"src/thm95/polyhedral_iso.lean"</span><span class="o">,</span><span class="s2">"src/thm95/row_iso.lean"</span><span class="o">]</span>
</code></pre></div>
<p>at the top of my file (and <code>thm95</code> and <code>thm95.row_map_eq_sum_comp</code> marked as <code>main_declaration</code>) I get ~1800 lines of output <span aria-label="shock" class="emoji emoji-1f628" role="img" title="shock">:shock:</span></p>



<a name="236617274"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/treeshaking/near/236617274" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/treeshaking.html#236617274">(Apr 29 2021 at 04:26)</a>:</h4>
<p>Ooh, I used it wrong. I added the attribute in the files directly. But there they are unknown (-;</p>



<a name="236617307"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/treeshaking/near/236617307" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/treeshaking.html#236617307">(Apr 29 2021 at 04:27)</a>:</h4>
<p>So this is what you need:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">tactic.find_unused</span>

<span class="kn">import</span> <span class="n">breen_deligne.eg</span>
<span class="kn">import</span> <span class="n">combinatorial_lemma</span>
<span class="kn">import</span> <span class="n">thm95.row_iso</span>
<span class="kn">import</span> <span class="n">liquid</span>

<span class="kn">attribute</span> <span class="o">[</span><span class="n">main_declaration</span><span class="o">]</span> <span class="n">thm95</span> <span class="n">thm95.row_map_eq_sum_comp</span> <span class="n">first_target</span> <span class="n">lem98</span>
<span class="kn">attribute</span> <span class="o">[</span><span class="n">main_declaration</span><span class="o">]</span> <span class="n">breen_deligne.eg.adept</span> <span class="n">breen_deligne.eg.very_suitable</span>

<span class="bp">#</span><span class="n">list_unused_decls</span> <span class="o">[</span><span class="s2">"src/breen_deligne/category.lean"</span><span class="o">,</span><span class="s2">"src/breen_deligne/constants.lean"</span><span class="o">,</span><span class="s2">"src/breen_deligne/eg.lean"</span><span class="o">,</span><span class="s2">"src/breen_deligne/functorial_map.lean"</span><span class="o">,</span><span class="s2">"src/breen_deligne/suitable.lean"</span><span class="o">,</span><span class="s2">"src/breen_deligne/universal_map.lean"</span><span class="o">,</span><span class="s2">"src/combinatorial_lemma.lean"</span><span class="o">,</span><span class="s2">"src/facts/default.lean"</span><span class="o">,</span><span class="s2">"src/facts/int.lean"</span><span class="o">,</span><span class="s2">"src/facts/nnreal.lean"</span><span class="o">,</span><span class="s2">"src/facts/normed_group.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/additive_functor.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/add_monoid_hom.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/arrow.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/big_operators_basic.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/category.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/curry.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/dfinsupp.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/equalizers.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/extend_from_nat.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/filter_at_top_bot.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/finsupp.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/Fintype/basic.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/free_abelian_group.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/Gordan.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/grading.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/grading_examples.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/grading_monoid_algebra.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/int_grading_lemma.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/kronecker.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/linear_algebra.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/nnreal.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/normed_group.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/normed_group_hom.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/normed_group_hom_bound_by.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/normed_group_hom_completion.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/normed_group_hom_equalizer.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/normed_group_quotient.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/order_basic.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/pi_nat_apply.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/preadditive_category.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/Profinite/basic.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/Profinite/functorial_limit.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/Profinite/limits.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/Profinite/locally_constant.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/Profinite/nhds.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/Profinite.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/pseudo_metric.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/quotient_group.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/real_Inf.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/simplicial/augmented.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/simplicial/complex.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/specific_limit.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/Top/limits.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/tsum.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/uniform_space_cauchy.lean"</span><span class="o">,</span><span class="s2">"src/hacks_and_tricks/by_exactI_hack.lean"</span><span class="o">,</span><span class="s2">"src/hacks_and_tricks/type_pow.lean"</span><span class="o">,</span><span class="s2">"src/lem97.lean"</span><span class="o">,</span><span class="s2">"src/liquid.lean"</span><span class="o">,</span><span class="s2">"src/locally_constant/analysis.lean"</span><span class="o">,</span><span class="s2">"src/locally_constant/NormedGroup.lean"</span><span class="o">,</span><span class="s2">"src/locally_constant/Vhat.lean"</span><span class="o">,</span><span class="s2">"src/Mbar/basic.lean"</span><span class="o">,</span><span class="s2">"src/Mbar/bounded.lean"</span><span class="o">,</span><span class="s2">"src/Mbar/Mbar_le.lean"</span><span class="o">,</span><span class="s2">"src/Mbar/pseudo_normed_group.lean"</span><span class="o">,</span><span class="s2">"src/normed_group/controlled_exactness.lean"</span><span class="o">,</span><span class="s2">"src/normed_group/NormedGroup.lean"</span><span class="o">,</span><span class="s2">"src/normed_group/normed_with_aut.lean"</span><span class="o">,</span><span class="s2">"src/normed_group/pseudo_normed_group.lean"</span><span class="o">,</span><span class="s2">"src/normed_snake.lean"</span><span class="o">,</span><span class="s2">"src/normed_spectral.lean"</span><span class="o">,</span><span class="s2">"src/partition.lean"</span><span class="o">,</span><span class="s2">"src/polyhedral_lattice/basic.lean"</span><span class="o">,</span><span class="s2">"src/polyhedral_lattice/category.lean"</span><span class="o">,</span><span class="s2">"src/polyhedral_lattice/cech.lean"</span><span class="o">,</span><span class="s2">"src/polyhedral_lattice/cosimplicial.lean"</span><span class="o">,</span><span class="s2">"src/polyhedral_lattice/direct_sum.lean"</span><span class="o">,</span><span class="s2">"src/polyhedral_lattice/finsupp.lean"</span><span class="o">,</span><span class="s2">"src/polyhedral_lattice/Hom.lean"</span><span class="o">,</span><span class="s2">"src/polyhedral_lattice/int.lean"</span><span class="o">,</span><span class="s2">"src/polyhedral_lattice/pseudo_normed_group.lean"</span><span class="o">,</span><span class="s2">"src/polyhedral_lattice/topology.lean"</span><span class="o">,</span><span class="s2">"src/prop_92.lean"</span><span class="o">,</span><span class="s2">"src/pseudo_normed_group/basic.lean"</span><span class="o">,</span><span class="s2">"src/pseudo_normed_group/breen_deligne.lean"</span><span class="o">,</span><span class="s2">"src/pseudo_normed_group/category.lean"</span><span class="o">,</span><span class="s2">"src/pseudo_normed_group/CLC.lean"</span><span class="o">,</span><span class="s2">"src/pseudo_normed_group/FiltrationPow.lean"</span><span class="o">,</span><span class="s2">"src/pseudo_normed_group/homotopy.lean"</span><span class="o">,</span><span class="s2">"src/pseudo_normed_group/LC.lean"</span><span class="o">,</span><span class="s2">"src/pseudo_normed_group/profinitely_filtered.lean"</span><span class="o">,</span><span class="s2">"src/pseudo_normed_group/system_of_complexes.lean"</span><span class="o">,</span><span class="s2">"src/pseudo_normed_group/Tinv.lean"</span><span class="o">,</span><span class="s2">"src/pseudo_normed_group/with_Tinv.lean"</span><span class="o">,</span><span class="s2">"src/rescale/basic.lean"</span><span class="o">,</span><span class="s2">"src/rescale/CLC.lean"</span><span class="o">,</span><span class="s2">"src/rescale/FiltrationPow.lean"</span><span class="o">,</span><span class="s2">"src/rescale/LC.lean"</span><span class="o">,</span><span class="s2">"src/rescale/normed_group.lean"</span><span class="o">,</span><span class="s2">"src/rescale/polyhedral_lattice.lean"</span><span class="o">,</span><span class="s2">"src/rescale/pseudo_normed_group.lean"</span><span class="o">,</span><span class="s2">"src/rescale/Tinv.lean"</span><span class="o">,</span><span class="s2">"src/simplicial/alternating_face_map.lean"</span><span class="o">,</span><span class="s2">"src/system_of_complexes/basic.lean"</span><span class="o">,</span><span class="s2">"src/system_of_complexes/completion.lean"</span><span class="o">,</span><span class="s2">"src/system_of_complexes/complex.lean"</span><span class="o">,</span><span class="s2">"src/system_of_complexes/double.lean"</span><span class="o">,</span><span class="s2">"src/system_of_complexes/rescale.lean"</span><span class="o">,</span><span class="s2">"src/system_of_complexes/truncate.lean"</span><span class="o">,</span><span class="s2">"src/thm95/constants.lean"</span><span class="o">,</span><span class="s2">"src/thm95/default.lean"</span><span class="o">,</span><span class="s2">"src/thm95/double_complex.lean"</span><span class="o">,</span><span class="s2">"src/thm95/modify_complex.lean"</span><span class="o">,</span><span class="s2">"src/thm95/polyhedral_iso.lean"</span><span class="o">,</span><span class="s2">"src/thm95/row_iso.lean"</span><span class="o">]</span>
</code></pre></div>



<a name="236618602"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/treeshaking/near/236618602" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/treeshaking.html#236618602">(Apr 29 2021 at 04:47)</a>:</h4>
<p>And then</p>
<div class="codehilite" data-code-language="Bash"><pre><span></span><code>cat unused-liquid-presort.lean <span class="p">|</span> cut -f2 -d<span class="s1">' '</span> &gt; unused-liquid-col2
git grep -ohf unused-liquid-col2.lean <span class="p">|</span> sort <span class="p">|</span> uniq &gt; unused-liquid.sorted
</code></pre></div>
<p>which gives a file with ~150 lines</p>



<a name="236618808"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/treeshaking/near/236618808" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/treeshaking.html#236618808">(Apr 29 2021 at 04:50)</a>:</h4>
<p>Hmm, that's of course dangerous, because some of the lines might not have matched due to open namespaces...</p>



<a name="236618825"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/treeshaking/near/236618825" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/treeshaking.html#236618825">(Apr 29 2021 at 04:50)</a>:</h4>
<p>So it's not a very good way of filtering out the auto-generated stuff</p>



<a name="236620451"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/treeshaking/near/236620451" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/treeshaking.html#236620451">(Apr 29 2021 at 05:14)</a>:</h4>
<p>I think it would be really useful if Lean could also filter this list so that it only prints <code>def</code>s</p>



<a name="236620467"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/treeshaking/near/236620467" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/treeshaking.html#236620467">(Apr 29 2021 at 05:14)</a>:</h4>
<p><span class="user-mention" data-user-id="127136">@Alex J. Best</span> do you know if you can check whether a decl is def or lemma via metaprogramming?</p>



<a name="236620572"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/treeshaking/near/236620572" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/treeshaking.html#236620572">(Apr 29 2021 at 05:16)</a>:</h4>
<p>That would also get rid of all the autogenerated stuff, because I don't think there are autogenerated defs.</p>



<a name="236620629"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/treeshaking/near/236620629" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/treeshaking.html#236620629">(Apr 29 2021 at 05:17)</a>:</h4>
<p>Yes you can check with <a href="https://leanprover-community.github.io/mathlib_docs/find/declaration.is_definition">docs#declaration.is_definition</a> or <a href="https://leanprover-community.github.io/mathlib_docs/find/declaration.is_theorem">docs#declaration.is_theorem</a> (this matches lemmas too)</p>



<a name="236620715"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/treeshaking/near/236620715" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/treeshaking.html#236620715">(Apr 29 2021 at 05:19)</a>:</h4>
<p>There is also <a href="https://leanprover-community.github.io/mathlib_docs/find/declaration.is_auto_generated">docs#declaration.is_auto_generated</a> and <a href="https://leanprover-community.github.io/mathlib_docs/find/declaration.is_auto_or_internal">docs#declaration.is_auto_or_internal</a> which may be useful?</p>



<a name="236620867"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/treeshaking/near/236620867" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/treeshaking.html#236620867">(Apr 29 2021 at 05:21)</a>:</h4>
<p>aah, thanks...</p>



<a name="236620896"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/treeshaking/near/236620896" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/treeshaking.html#236620896">(Apr 29 2021 at 05:21)</a>:</h4>
<p>Is there a way to get a list out of <code>unused_decls</code>? instead of manually copy-pasting the output message with all the <code>#print</code> bla?</p>



<a name="236620950"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/treeshaking/near/236620950" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/treeshaking.html#236620950">(Apr 29 2021 at 05:22)</a>:</h4>
<p>Aside: it looks like we never use the category <code>ProFiltPseuNormGrp</code>, only <code>ProFiltPseuNormGrpWithTinv</code>. This list is pretty useful.</p>



<a name="236620954"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/treeshaking/near/236620954" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/treeshaking.html#236620954">(Apr 29 2021 at 05:22)</a>:</h4>
<p>I've already removed &gt; 600 lines from the project.</p>



<a name="236621065"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/treeshaking/near/236621065" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/treeshaking.html#236621065">(Apr 29 2021 at 05:24)</a>:</h4>
<p>I just pushed</p>



<a name="236621749"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/treeshaking/near/236621749" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/treeshaking.html#236621749">(Apr 29 2021 at 05:35)</a>:</h4>
<p>does something like this do what you want?</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">tactic.find_unused</span>

<span class="kn">open</span> <span class="n">tactic</span>

<span class="kd">run_cmd</span> <span class="o">(</span>
<span class="k">do</span> <span class="n">ds</span> <span class="bp">←</span> <span class="n">all_unused</span> <span class="o">[</span><span class="n">none</span><span class="o">,</span> <span class="s2">"src/breen_deligne/category.lean"</span><span class="o">,</span><span class="s2">"src/breen_deligne/constants.lean"</span><span class="o">,</span><span class="s2">"src/breen_deligne/eg.lean"</span><span class="o">,</span><span class="s2">"src/breen_deligne/functorial_map.lean"</span><span class="o">,</span><span class="s2">"src/breen_deligne/suitable.lean"</span><span class="o">,</span><span class="s2">"src/breen_deligne/universal_map.lean"</span><span class="o">,</span><span class="s2">"src/combinatorial_lemma.lean"</span><span class="o">,</span><span class="s2">"src/facts/default.lean"</span><span class="o">,</span><span class="s2">"src/facts/int.lean"</span><span class="o">,</span><span class="s2">"src/facts/nnreal.lean"</span><span class="o">,</span><span class="s2">"src/facts/normed_group.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/additive_functor.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/add_monoid_hom.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/arrow.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/big_operators_basic.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/category.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/curry.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/dfinsupp.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/equalizers.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/extend_from_nat.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/filter_at_top_bot.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/finsupp.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/Fintype/basic.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/free_abelian_group.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/Gordan.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/grading.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/grading_examples.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/grading_monoid_algebra.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/int_grading_lemma.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/kronecker.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/linear_algebra.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/nnreal.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/normed_group.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/normed_group_hom.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/normed_group_hom_bound_by.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/normed_group_hom_completion.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/normed_group_hom_equalizer.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/normed_group_quotient.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/order_basic.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/pi_nat_apply.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/preadditive_category.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/Profinite/basic.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/Profinite/functorial_limit.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/Profinite/limits.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/Profinite/locally_constant.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/Profinite/nhds.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/Profinite.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/pseudo_metric.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/quotient_group.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/real_Inf.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/simplicial/augmented.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/simplicial/complex.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/specific_limit.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/Top/limits.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/tsum.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/uniform_space_cauchy.lean"</span><span class="o">,</span><span class="s2">"src/hacks_and_tricks/by_exactI_hack.lean"</span><span class="o">,</span><span class="s2">"src/hacks_and_tricks/type_pow.lean"</span><span class="o">,</span><span class="s2">"src/lem97.lean"</span><span class="o">,</span><span class="s2">"src/liquid.lean"</span><span class="o">,</span><span class="s2">"src/locally_constant/analysis.lean"</span><span class="o">,</span><span class="s2">"src/locally_constant/NormedGroup.lean"</span><span class="o">,</span><span class="s2">"src/locally_constant/Vhat.lean"</span><span class="o">,</span><span class="s2">"src/Mbar/basic.lean"</span><span class="o">,</span><span class="s2">"src/Mbar/bounded.lean"</span><span class="o">,</span><span class="s2">"src/Mbar/Mbar_le.lean"</span><span class="o">,</span><span class="s2">"src/Mbar/pseudo_normed_group.lean"</span><span class="o">,</span><span class="s2">"src/normed_group/controlled_exactness.lean"</span><span class="o">,</span><span class="s2">"src/normed_group/NormedGroup.lean"</span><span class="o">,</span><span class="s2">"src/normed_group/normed_with_aut.lean"</span><span class="o">,</span><span class="s2">"src/normed_group/pseudo_normed_group.lean"</span><span class="o">,</span><span class="s2">"src/normed_snake.lean"</span><span class="o">,</span><span class="s2">"src/normed_spectral.lean"</span><span class="o">,</span><span class="s2">"src/partition.lean"</span><span class="o">,</span><span class="s2">"src/polyhedral_lattice/basic.lean"</span><span class="o">,</span><span class="s2">"src/polyhedral_lattice/category.lean"</span><span class="o">,</span><span class="s2">"src/polyhedral_lattice/cech.lean"</span><span class="o">,</span><span class="s2">"src/polyhedral_lattice/cosimplicial.lean"</span><span class="o">,</span><span class="s2">"src/polyhedral_lattice/direct_sum.lean"</span><span class="o">,</span><span class="s2">"src/polyhedral_lattice/finsupp.lean"</span><span class="o">,</span><span class="s2">"src/polyhedral_lattice/Hom.lean"</span><span class="o">,</span><span class="s2">"src/polyhedral_lattice/int.lean"</span><span class="o">,</span><span class="s2">"src/polyhedral_lattice/pseudo_normed_group.lean"</span><span class="o">,</span><span class="s2">"src/polyhedral_lattice/topology.lean"</span><span class="o">,</span><span class="s2">"src/prop_92.lean"</span><span class="o">,</span><span class="s2">"src/pseudo_normed_group/basic.lean"</span><span class="o">,</span><span class="s2">"src/pseudo_normed_group/breen_deligne.lean"</span><span class="o">,</span><span class="s2">"src/pseudo_normed_group/category.lean"</span><span class="o">,</span><span class="s2">"src/pseudo_normed_group/CLC.lean"</span><span class="o">,</span><span class="s2">"src/pseudo_normed_group/FiltrationPow.lean"</span><span class="o">,</span><span class="s2">"src/pseudo_normed_group/homotopy.lean"</span><span class="o">,</span><span class="s2">"src/pseudo_normed_group/LC.lean"</span><span class="o">,</span><span class="s2">"src/pseudo_normed_group/profinitely_filtered.lean"</span><span class="o">,</span><span class="s2">"src/pseudo_normed_group/system_of_complexes.lean"</span><span class="o">,</span><span class="s2">"src/pseudo_normed_group/Tinv.lean"</span><span class="o">,</span><span class="s2">"src/pseudo_normed_group/with_Tinv.lean"</span><span class="o">,</span><span class="s2">"src/rescale/basic.lean"</span><span class="o">,</span><span class="s2">"src/rescale/CLC.lean"</span><span class="o">,</span><span class="s2">"src/rescale/FiltrationPow.lean"</span><span class="o">,</span><span class="s2">"src/rescale/LC.lean"</span><span class="o">,</span><span class="s2">"src/rescale/normed_group.lean"</span><span class="o">,</span><span class="s2">"src/rescale/polyhedral_lattice.lean"</span><span class="o">,</span><span class="s2">"src/rescale/pseudo_normed_group.lean"</span><span class="o">,</span><span class="s2">"src/rescale/Tinv.lean"</span><span class="o">,</span><span class="s2">"src/simplicial/alternating_face_map.lean"</span><span class="o">,</span><span class="s2">"src/system_of_complexes/basic.lean"</span><span class="o">,</span><span class="s2">"src/system_of_complexes/completion.lean"</span><span class="o">,</span><span class="s2">"src/system_of_complexes/complex.lean"</span><span class="o">,</span><span class="s2">"src/system_of_complexes/double.lean"</span><span class="o">,</span><span class="s2">"src/system_of_complexes/rescale.lean"</span><span class="o">,</span><span class="s2">"src/system_of_complexes/truncate.lean"</span><span class="o">,</span><span class="s2">"src/thm95/constants.lean"</span><span class="o">,</span><span class="s2">"src/thm95/default.lean"</span><span class="o">,</span><span class="s2">"src/thm95/double_complex.lean"</span><span class="o">,</span><span class="s2">"src/thm95/modify_complex.lean"</span><span class="o">,</span><span class="s2">"src/thm95/polyhedral_iso.lean"</span><span class="o">,</span><span class="s2">"src/thm95/row_iso.lean"</span><span class="o">],</span>
<span class="k">let</span> <span class="n">ds</span> <span class="o">:=</span> <span class="n">ds.filter</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">t</span><span class="o">,</span> <span class="n">declaration.is_theorem</span> <span class="n">t</span><span class="o">),</span>
<span class="n">tactic.trace</span> <span class="o">(</span><span class="n">ds.to_list.map</span> <span class="bp">$</span> <span class="bp">λ</span> <span class="o">⟨</span><span class="n">n</span><span class="o">,</span><span class="n">_</span><span class="o">⟩,</span> <span class="n">n</span><span class="o">))</span>
</code></pre></div>



<a name="236621784"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/treeshaking/near/236621784" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/treeshaking.html#236621784">(Apr 29 2021 at 05:35)</a>:</h4>
<p><a href="https://leanprover-community.github.io/mathlib_docs/find/all_unused">docs#all_unused</a> already filters by <code>is_auto_or_internal</code> it seems</p>



<a name="236624288"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/treeshaking/near/236624288" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/treeshaking.html#236624288">(Apr 29 2021 at 06:12)</a>:</h4>
<p><span class="user-mention" data-user-id="127136">@Alex J. Best</span>  Let me try it out! Are simp-lemmas generated by <code>@[simps]</code> tagged as <code>is_auto</code>?</p>



<a name="236624424"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/treeshaking/near/236624424" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/treeshaking.html#236624424">(Apr 29 2021 at 06:15)</a>:</h4>
<p>I don't think they are, I believe auto-generated in this context just means the rec_on and no_confusion sort of auto-generated things. Not things added by mathlib tactics like simps.</p>



<a name="236624576"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/treeshaking/near/236624576" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/treeshaking.html#236624576">(Apr 29 2021 at 06:17)</a>:</h4>
<p>Hmm, you were filtering for theorems, I changed that to defs. The result looks useful.</p>



<a name="236624872"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/treeshaking/near/236624872" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/treeshaking.html#236624872">(Apr 29 2021 at 06:21)</a>:</h4>
<p><span class="user-mention" data-user-id="127136">@Alex J. Best</span> can you make the trace output print one decl per line, without the <code>[.., ..]</code> list brackets and commas?</p>



<a name="236625154"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/treeshaking/near/236625154" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/treeshaking.html#236625154">(Apr 29 2021 at 06:25)</a>:</h4>
<p>My attempt:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">meta</span> <span class="kd">def</span> <span class="n">file_list</span> <span class="o">:</span> <span class="n">list</span> <span class="o">(</span><span class="n">option</span> <span class="n">string</span><span class="o">)</span> <span class="o">:=</span>
<span class="o">[</span><span class="s2">"src/breen_deligne/category.lean"</span><span class="o">,</span><span class="s2">"src/breen_deligne/constants.lean"</span><span class="o">,</span><span class="s2">"src/breen_deligne/eg.lean"</span><span class="o">,</span><span class="s2">"src/breen_deligne/functorial_map.lean"</span><span class="o">,</span><span class="s2">"src/breen_deligne/suitable.lean"</span><span class="o">,</span><span class="s2">"src/breen_deligne/universal_map.lean"</span><span class="o">,</span><span class="s2">"src/combinatorial_lemma.lean"</span><span class="o">,</span><span class="s2">"src/facts/default.lean"</span><span class="o">,</span><span class="s2">"src/facts/int.lean"</span><span class="o">,</span><span class="s2">"src/facts/nnreal.lean"</span><span class="o">,</span><span class="s2">"src/facts/normed_group.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/additive_functor.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/add_monoid_hom.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/arrow.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/big_operators_basic.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/category.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/curry.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/dfinsupp.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/equalizers.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/extend_from_nat.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/filter_at_top_bot.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/finsupp.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/Fintype/basic.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/free_abelian_group.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/Gordan.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/grading.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/grading_examples.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/grading_monoid_algebra.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/int_grading_lemma.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/kronecker.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/linear_algebra.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/nnreal.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/normed_group.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/normed_group_hom.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/normed_group_hom_bound_by.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/normed_group_hom_completion.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/normed_group_hom_equalizer.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/normed_group_quotient.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/order_basic.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/pi_nat_apply.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/preadditive_category.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/Profinite/basic.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/Profinite/functorial_limit.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/Profinite/limits.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/Profinite/locally_constant.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/Profinite/nhds.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/Profinite.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/pseudo_metric.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/quotient_group.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/real_Inf.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/simplicial/augmented.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/simplicial/complex.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/specific_limit.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/Top/limits.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/tsum.lean"</span><span class="o">,</span><span class="s2">"src/for_mathlib/uniform_space_cauchy.lean"</span><span class="o">,</span><span class="s2">"src/hacks_and_tricks/by_exactI_hack.lean"</span><span class="o">,</span><span class="s2">"src/hacks_and_tricks/type_pow.lean"</span><span class="o">,</span><span class="s2">"src/lem97.lean"</span><span class="o">,</span><span class="s2">"src/liquid.lean"</span><span class="o">,</span><span class="s2">"src/locally_constant/analysis.lean"</span><span class="o">,</span><span class="s2">"src/locally_constant/NormedGroup.lean"</span><span class="o">,</span><span class="s2">"src/locally_constant/Vhat.lean"</span><span class="o">,</span><span class="s2">"src/Mbar/basic.lean"</span><span class="o">,</span><span class="s2">"src/Mbar/bounded.lean"</span><span class="o">,</span><span class="s2">"src/Mbar/Mbar_le.lean"</span><span class="o">,</span><span class="s2">"src/Mbar/pseudo_normed_group.lean"</span><span class="o">,</span><span class="s2">"src/normed_group/controlled_exactness.lean"</span><span class="o">,</span><span class="s2">"src/normed_group/NormedGroup.lean"</span><span class="o">,</span><span class="s2">"src/normed_group/normed_with_aut.lean"</span><span class="o">,</span><span class="s2">"src/normed_group/pseudo_normed_group.lean"</span><span class="o">,</span><span class="s2">"src/normed_snake.lean"</span><span class="o">,</span><span class="s2">"src/normed_spectral.lean"</span><span class="o">,</span><span class="s2">"src/partition.lean"</span><span class="o">,</span><span class="s2">"src/polyhedral_lattice/basic.lean"</span><span class="o">,</span><span class="s2">"src/polyhedral_lattice/category.lean"</span><span class="o">,</span><span class="s2">"src/polyhedral_lattice/cech.lean"</span><span class="o">,</span><span class="s2">"src/polyhedral_lattice/cosimplicial.lean"</span><span class="o">,</span><span class="s2">"src/polyhedral_lattice/direct_sum.lean"</span><span class="o">,</span><span class="s2">"src/polyhedral_lattice/finsupp.lean"</span><span class="o">,</span><span class="s2">"src/polyhedral_lattice/Hom.lean"</span><span class="o">,</span><span class="s2">"src/polyhedral_lattice/int.lean"</span><span class="o">,</span><span class="s2">"src/polyhedral_lattice/pseudo_normed_group.lean"</span><span class="o">,</span><span class="s2">"src/polyhedral_lattice/topology.lean"</span><span class="o">,</span><span class="s2">"src/prop_92.lean"</span><span class="o">,</span><span class="s2">"src/pseudo_normed_group/basic.lean"</span><span class="o">,</span><span class="s2">"src/pseudo_normed_group/breen_deligne.lean"</span><span class="o">,</span><span class="s2">"src/pseudo_normed_group/category.lean"</span><span class="o">,</span><span class="s2">"src/pseudo_normed_group/CLC.lean"</span><span class="o">,</span><span class="s2">"src/pseudo_normed_group/FiltrationPow.lean"</span><span class="o">,</span><span class="s2">"src/pseudo_normed_group/homotopy.lean"</span><span class="o">,</span><span class="s2">"src/pseudo_normed_group/LC.lean"</span><span class="o">,</span><span class="s2">"src/pseudo_normed_group/profinitely_filtered.lean"</span><span class="o">,</span><span class="s2">"src/pseudo_normed_group/system_of_complexes.lean"</span><span class="o">,</span><span class="s2">"src/pseudo_normed_group/Tinv.lean"</span><span class="o">,</span><span class="s2">"src/pseudo_normed_group/with_Tinv.lean"</span><span class="o">,</span><span class="s2">"src/rescale/basic.lean"</span><span class="o">,</span><span class="s2">"src/rescale/CLC.lean"</span><span class="o">,</span><span class="s2">"src/rescale/FiltrationPow.lean"</span><span class="o">,</span><span class="s2">"src/rescale/LC.lean"</span><span class="o">,</span><span class="s2">"src/rescale/normed_group.lean"</span><span class="o">,</span><span class="s2">"src/rescale/polyhedral_lattice.lean"</span><span class="o">,</span><span class="s2">"src/rescale/pseudo_normed_group.lean"</span><span class="o">,</span><span class="s2">"src/rescale/Tinv.lean"</span><span class="o">,</span><span class="s2">"src/simplicial/alternating_face_map.lean"</span><span class="o">,</span><span class="s2">"src/system_of_complexes/basic.lean"</span><span class="o">,</span><span class="s2">"src/system_of_complexes/completion.lean"</span><span class="o">,</span><span class="s2">"src/system_of_complexes/complex.lean"</span><span class="o">,</span><span class="s2">"src/system_of_complexes/double.lean"</span><span class="o">,</span><span class="s2">"src/system_of_complexes/rescale.lean"</span><span class="o">,</span><span class="s2">"src/system_of_complexes/truncate.lean"</span><span class="o">,</span><span class="s2">"src/thm95/constants.lean"</span><span class="o">,</span><span class="s2">"src/thm95/default.lean"</span><span class="o">,</span><span class="s2">"src/thm95/double_complex.lean"</span><span class="o">,</span><span class="s2">"src/thm95/modify_complex.lean"</span><span class="o">,</span><span class="s2">"src/thm95/polyhedral_iso.lean"</span><span class="o">,</span><span class="s2">"src/thm95/row_iso.lean"</span><span class="o">]</span>

<span class="kn">open</span> <span class="n">tactic</span>

<span class="kd">meta</span> <span class="kd">def</span> <span class="n">unused_defs</span> <span class="o">(</span><span class="n">fs</span> <span class="o">:</span> <span class="n">list</span> <span class="o">(</span><span class="n">option</span> <span class="n">string</span><span class="o">))</span> <span class="o">:</span> <span class="n">tactic</span> <span class="n">unit</span> <span class="o">:=</span>
<span class="k">do</span> <span class="n">ds</span> <span class="bp">←</span> <span class="n">all_unused</span> <span class="n">fs</span><span class="o">,</span>
<span class="k">let</span> <span class="n">ds</span> <span class="o">:=</span> <span class="n">ds.filter</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">t</span><span class="o">,</span> <span class="n">declaration.is_definition</span> <span class="n">t</span><span class="o">),</span>
<span class="k">let</span> <span class="n">ds'</span> <span class="o">:=</span> <span class="o">(</span><span class="n">ds.to_list.map</span> <span class="bp">$</span> <span class="bp">λ</span> <span class="o">⟨</span><span class="n">n</span><span class="o">,</span><span class="n">_</span><span class="o">⟩,</span> <span class="n">n.to_string</span><span class="o">),</span>
<span class="k">let</span> <span class="n">ds''</span> <span class="o">:=</span> <span class="n">string.intercalate</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span> <span class="n">ds'</span><span class="o">,</span>
<span class="n">tactic.trace</span> <span class="n">ds''</span>

<span class="kd">run_cmd</span> <span class="n">unused_defs</span> <span class="n">file_list</span>
</code></pre></div>



<a name="236625299"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/treeshaking/near/236625299" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/treeshaking.html#236625299">(Apr 29 2021 at 06:27)</a>:</h4>
<p>Seems to work. 172 definitions aren't being used <span aria-label="rofl" class="emoji emoji-1f923" role="img" title="rofl">:rofl:</span></p>



<a name="236628434"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/treeshaking/near/236628434" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/treeshaking.html#236628434">(Apr 29 2021 at 07:05)</a>:</h4>
<p><span class="user-mention silent" data-user-id="112680">Johan Commelin</span> <a href="#narrow/stream/267928-condensed-mathematics/topic/treeshaking/near/236624576">said</a>:</p>
<blockquote>
<p>Hmm, you were filtering for theorems, I changed that to defs. The result looks useful.</p>
</blockquote>
<p>Oops I misread what you wrote earlier yes.<br>
And yes that looks good to me! I guess the reason <code>none</code> was in the original file list was that none represented the current file, but seeing as the list includes thm95/default.lean anyway it was actually duplicated.</p>



<a name="236631283"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/treeshaking/near/236631283" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/treeshaking.html#236631283">(Apr 29 2021 at 07:33)</a>:</h4>
<p><span aria-label="tada" class="emoji emoji-1f389" role="img" title="tada">:tada:</span> I found the timeout issue between <code>row_iso.lean</code> and <code>default.lean</code></p>



<a name="236631372"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/treeshaking/near/236631372" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/treeshaking.html#236631372">(Apr 29 2021 at 07:34)</a>:</h4>
<p>I had to mark some things as <code>irreducible</code> because I made them <code>reducible</code> but forgot the <code>local</code> prefix.</p>



<a name="236660270"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/treeshaking/near/236660270" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/treeshaking.html#236660270">(Apr 29 2021 at 11:55)</a>:</h4>
<p>Oh that's great news!</p>



<a name="289967977"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/treeshaking/near/289967977" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/treeshaking.html#289967977">(Jul 18 2022 at 13:53)</a>:</h4>
<p>Just bumping this thread to remind me that we should try to do some treeshaking again.</p>



<a name="290199504"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/treeshaking/near/290199504" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/treeshaking.html#290199504">(Jul 20 2022 at 06:47)</a>:</h4>
<p>I'm running the treeshake on the mathlib bump thread atm.</p>



<a name="290200238"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/treeshaking/near/290200238" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/treeshaking.html#290200238">(Jul 20 2022 at 06:59)</a>:</h4>
<p>Here's the output <a href="https://gist.github.com/jcommelin/90b42c047ec1959abe8a359ae5fd0d57">https://gist.github.com/jcommelin/90b42c047ec1959abe8a359ae5fd0d57</a></p>



<a name="290200253"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/treeshaking/near/290200253" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/treeshaking.html#290200253">(Jul 20 2022 at 06:59)</a>:</h4>
<p>Note that this only lists unused <em>definitions</em>!</p>



<a name="290200403"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/treeshaking/near/290200403" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/treeshaking.html#290200403">(Jul 20 2022 at 07:01)</a>:</h4>
<p>Some surprising entries!</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">ExtrDisc.topological_space</span>
</code></pre></div>



<a name="290200749"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/treeshaking/near/290200749" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/treeshaking.html#290200749">(Jul 20 2022 at 07:06)</a>:</h4>
<p>Here is the Lean file I used: based on <span class="user-mention" data-user-id="127136">@Alex J. Best</span>'s code upstairs<br>
<a href="https://gist.github.com/jcommelin/54a31030dba0511cb2efaf66082f7694">https://gist.github.com/jcommelin/54a31030dba0511cb2efaf66082f7694</a></p>



<a name="290202089"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/treeshaking/near/290202089" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/treeshaking.html#290202089">(Jul 20 2022 at 07:26)</a>:</h4>
<p>Another surprise:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">thm95.universal_constants.K₀</span>
</code></pre></div>
<p>Looks like we are making life more complicated than necessary, when computing those constants.</p>



<a name="290210333"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/treeshaking/near/290210333" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/treeshaking.html#290210333">(Jul 20 2022 at 09:08)</a>:</h4>
<p>Here is a way to get the file list automatically, by asking lean to call <code>find</code> rather than copypasta</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">tactic</span>
<span class="bp">.</span>

<span class="kn">open</span> <span class="n">tactic</span>
<span class="kd">def</span> <span class="n">tree_args</span> <span class="o">(</span><span class="n">src</span> <span class="o">:</span> <span class="n">string</span><span class="o">)</span> <span class="o">:</span> <span class="n">io.process.spawn_args</span> <span class="o">:=</span>
<span class="o">{</span> <span class="n">cmd</span> <span class="o">:=</span> <span class="s2">"find"</span><span class="o">,</span>
  <span class="n">args</span> <span class="o">:=</span> <span class="n">src</span> <span class="o">::</span> <span class="o">[</span><span class="s2">"-type"</span><span class="o">,</span> <span class="s2">"f"</span><span class="o">,</span> <span class="s2">"-name"</span><span class="o">,</span> <span class="s2">"*.lean"</span><span class="o">,</span> <span class="s2">"-print"</span><span class="o">],</span> <span class="o">}</span>

<span class="kd">run_cmd</span> <span class="k">do</span>
  <span class="n">s</span> <span class="bp">←</span> <span class="n">unsafe_run_io</span> <span class="bp">$</span> <span class="n">io.cmd</span> <span class="bp">$</span> <span class="n">tree_args</span> <span class="s2">"src"</span><span class="o">,</span>
  <span class="k">let</span> <span class="n">fs</span> <span class="o">:=</span> <span class="n">s.split_on</span> <span class="sc">'\n'</span><span class="o">,</span>
  <span class="n">trace</span> <span class="n">fs</span>
</code></pre></div>



<a name="290213841"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/treeshaking/near/290213841" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/treeshaking.html#290213841">(Jul 20 2022 at 09:52)</a>:</h4>
<p>Nice! That's a lot cleaner.</p>



<a name="290218521"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/treeshaking/near/290218521" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/treeshaking.html#290218521">(Jul 20 2022 at 10:46)</a>:</h4>
<p>Can you emit file and line numbers too so that you can link to github for each def?</p>



<a name="290219144"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/treeshaking/near/290219144" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/treeshaking.html#290219144">(Jul 20 2022 at 10:54)</a>:</h4>
<p><span class="user-mention" data-user-id="310045">@Eric Wieser</span> Do you know how to grab that info using meta-programming?</p>



<a name="290219195"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/treeshaking/near/290219195" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/treeshaking.html#290219195">(Jul 20 2022 at 10:54)</a>:</h4>
<p>Yes, I do it here: <a href="https://github.com/eric-wieser/lean-graded-rings/blob/9812eb5ec02962fa1e3ce22a9418eb9439b8d2b7/export.lean#L25">https://github.com/eric-wieser/lean-graded-rings/blob/9812eb5ec02962fa1e3ce22a9418eb9439b8d2b7/export.lean#L25</a></p>



<a name="290219238"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/treeshaking/near/290219238" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/treeshaking.html#290219238">(Jul 20 2022 at 10:55)</a>:</h4>
<p><a href="https://leanprover-community.github.io/mathlib_docs/find/environment.decl_pos">docs#environment.decl_pos</a> and <a href="https://leanprover-community.github.io/mathlib_docs/find/environment.decl_olean">docs#environment.decl_olean</a></p>



<a name="290220005"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/treeshaking/near/290220005" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/treeshaking.html#290220005">(Jul 20 2022 at 11:05)</a>:</h4>
<p>Once the mathlib bump is merged, I'll add <code>scripts/treeshake.lean</code> using both suggestions.</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>