---
layout: archive
title: Zulip Chat Archive
permalink: /stream/267928-condensed-mathematics/topic/universal.20map.20refactor.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/index.html">condensed mathematics</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/universal.20map.20refactor.html">universal map refactor</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="243656539"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/universal%20map%20refactor/near/243656539" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/universal.20map.20refactor.html#243656539">(Jun 23 2021 at 14:06)</a>:</h4>
<p>In the Breen-Deligne section of LTE we are using <code>free_abelian_group</code>. But we might want to switch to <code>finsupp</code>, because will allow us to reuse constructions that Scott has been adding to mathlib. However, when I tried that this afternoon, I got really weird behaviour with the equation compiler. It probably has something to do with <code>free_abelian_group</code> being computable, whereas <code>finsupp</code> is not.</p>
<p>I pushed to the <code>BD-refactor</code> branch. If you want to take a look, the error shows up around<br>
<code>src/breen_deligne/category.lean:182</code><br>
where I need to <code>dsimp</code> in a definition.</p>



<a name="243668367"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/universal%20map%20refactor/near/243668367" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/universal.20map.20refactor.html#243668367">(Jun 23 2021 at 15:24)</a>:</h4>
<p>I'll try to look at this later today, if it's still an issue</p>



<a name="243698982"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/universal%20map%20refactor/near/243698982" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/universal.20map.20refactor.html#243698982">(Jun 23 2021 at 19:13)</a>:</h4>
<p><span class="user-mention" data-user-id="112680">@Johan Commelin</span> do I understand correctly that the main change from <code>free_abelian_group</code> to <code>finsupp</code> happened in the definition of <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="double-struck">Z</mi><mo stretchy="false">[</mo><mi>A</mi><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">\mathbb{Z}[A]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathbb">Z</span><span class="mopen">[</span><span class="mord mathnormal">A</span><span class="mclose">]</span></span></span></span>?</p>



<a name="243699308"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/universal%20map%20refactor/near/243699308" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/universal.20map.20refactor.html#243699308">(Jun 23 2021 at 19:16)</a>:</h4>
<p>Right, and now the rest of the project needs to adept to that change</p>



<a name="243699322"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/universal%20map%20refactor/near/243699322" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/universal.20map.20refactor.html#243699322">(Jun 23 2021 at 19:16)</a>:</h4>
<p>But if it is too much work... I wouldn't worry too much.</p>



<a name="243699347"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/universal%20map%20refactor/near/243699347" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/universal.20map.20refactor.html#243699347">(Jun 23 2021 at 19:17)</a>:</h4>
<p>Scott's code isn't all in mathlib yet. So it isn't urgent.</p>



<a name="243699416"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/universal%20map%20refactor/near/243699416" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/universal.20map.20refactor.html#243699416">(Jun 23 2021 at 19:17)</a>:</h4>
<p>Gotcha. I have a bit of time now so I wanted to get my bearings straight. I'll play more with this branch later</p>



<a name="243727138"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/universal%20map%20refactor/near/243727138" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/universal.20map.20refactor.html#243727138">(Jun 23 2021 at 23:45)</a>:</h4>
<p>Ooof... this proof in <code>hom_pow'_sum</code> is really annoying... I can't make progress at all! Even replacing the first <code>dsimp [...]</code> with </p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">change</span> <span class="o">((</span><span class="n">BD.mul_mul_iso</span> <span class="mi">2</span> <span class="o">(</span><span class="mi">2</span> <span class="bp">^</span> <span class="n">N</span><span class="o">))</span><span class="bp">.</span><span class="n">inv</span> <span class="bp">≫</span> <span class="o">(</span><span class="n">mul</span> <span class="mi">2</span><span class="o">)</span><span class="bp">.</span><span class="n">map</span> <span class="o">(</span><span class="n">BD.pow'_iso_mul</span> <span class="n">N</span><span class="o">)</span><span class="bp">.</span><span class="n">inv</span><span class="o">)</span> <span class="bp">≫</span>
    <span class="o">(</span><span class="n">mul</span> <span class="mi">2</span><span class="o">)</span><span class="bp">.</span><span class="n">map</span> <span class="o">(</span><span class="n">hom_pow'</span> <span class="o">(</span><span class="n">BD.sum</span> <span class="mi">2</span><span class="o">)</span> <span class="n">N</span><span class="o">)</span> <span class="bp">≫</span> <span class="n">BD.sum</span> <span class="mi">2</span> <span class="bp">=</span> <span class="n">BD.sum</span> <span class="o">(</span><span class="mi">2</span> <span class="bp">^</span> <span class="o">(</span><span class="n">N</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)),</span>
</code></pre></div>
<p>(which is what it should be) gives me a timeout.</p>



<a name="243732400"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/universal%20map%20refactor/near/243732400" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/universal.20map.20refactor.html#243732400">(Jun 24 2021 at 01:19)</a>:</h4>
<p>Okay, I made some progress. The trick seems to be to avoid using the equation compiler and use <code>nat.rec_on</code> manually.<br>
I pushed my code to the branch <code>BD-refactor-2</code>.</p>



<a name="243732453"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/universal%20map%20refactor/near/243732453" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/universal.20map.20refactor.html#243732453">(Jun 24 2021 at 01:20)</a>:</h4>
<p>So far I got <code>breen_deligne/category.lean</code> to compile, but I  haven't worked on any of the other files</p>



<a name="243737560"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/universal%20map%20refactor/near/243737560" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/universal.20map.20refactor.html#243737560">(Jun 24 2021 at 03:21)</a>:</h4>
<p><span class="user-mention" data-user-id="243562">@Adam Topaz</span> ooh, thanks for the progress!</p>



<a name="243737570"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/universal%20map%20refactor/near/243737570" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/universal.20map.20refactor.html#243737570">(Jun 24 2021 at 03:21)</a>:</h4>
<p>Still, I'm quite surprised that switching from <code>free_abelian_group</code> to <code>finsupp</code> causes this sort of problems.<br>
<span class="user-mention" data-user-id="110049">@Mario Carneiro</span> Are you interested/do you have time to take a look at what's going on? I don't understand this weird behaviour.</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>