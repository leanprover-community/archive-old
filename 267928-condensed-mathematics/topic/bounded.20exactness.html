---
layout: archive
title: Zulip Chat Archive
permalink: /stream/267928-condensed-mathematics/topic/bounded.20exactness.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/index.html">condensed mathematics</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html">bounded exactness</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="224569494"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/bounded%20exactness/near/224569494" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html#224569494">(Jan 30 2021 at 06:41)</a>:</h4>
<p>In a long list of remarks on the blueprint (sent in a PM, I've fixed almost all of them), Kevin raised the following question. In the definition of (weak) bounded exactness, we have <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi><mo>&gt;</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">k &gt; 0</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.73354em;vertical-align:-0.0391em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span></span></span></span> and <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi><mo>≥</mo><msubsup><mi>c</mi><mn>0</mn><mo lspace="0em" mathvariant="normal" rspace="0em">′</mo></msubsup></mrow><annotation encoding="application/x-tex">c \ge c'_0</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.7719400000000001em;vertical-align:-0.13597em;"></span><span class="mord mathnormal">c</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">≥</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.24810799999999997em;"></span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.751892em;"><span style="top:-2.4518920000000004em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.24810799999999997em;"><span></span></span></span></span></span></span></span></span></span>. After that, the text refers to <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi><mo>∈</mo><msubsup><mi>C</mi><mrow><mi>k</mi><mi>c</mi></mrow><mi>i</mi></msubsup></mrow><annotation encoding="application/x-tex">x \in C_{kc}^i</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.1077719999999998em;vertical-align:-0.2831079999999999em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.824664em;"><span style="top:-2.4168920000000003em;margin-left:-0.07153em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span><span class="mord mathnormal mtight">c</span></span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2831079999999999em;"><span></span></span></span></span></span></span></span></span></span>. Do we want <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi><mi>c</mi><mo>≥</mo><msubsup><mi>c</mi><mn>0</mn><mo lspace="0em" mathvariant="normal" rspace="0em">′</mo></msubsup></mrow><annotation encoding="application/x-tex">kc \ge c'_0</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.83041em;vertical-align:-0.13597em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mord mathnormal">c</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">≥</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.24810799999999997em;"></span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.751892em;"><span style="top:-2.4518920000000004em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.24810799999999997em;"><span></span></span></span></span></span></span></span></span></span>?</p>
<p>For the normed snake lemma, the definition as is, certainly worked fine.</p>



<a name="224575777"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/bounded%20exactness/near/224575777" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html#224575777">(Jan 30 2021 at 09:29)</a>:</h4>
<p>We need restriction from <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi><mi>c</mi></mrow><annotation encoding="application/x-tex">kc</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mord mathnormal">c</span></span></span></span> to <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi></mrow><annotation encoding="application/x-tex">c</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">c</span></span></span></span>, don't we? So I have the impression that <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi><mo>≥</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">k \geq 1</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.83041em;vertical-align:-0.13597em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">≥</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span> is necessary</p>



<a name="224578441"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/bounded%20exactness/near/224578441" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html#224578441">(Jan 30 2021 at 10:25)</a>:</h4>
<p>Ooh, you are right. We actually have that in the Lean repo.</p>



<a name="224578630"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/bounded%20exactness/near/224578630" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html#224578630">(Jan 30 2021 at 10:29)</a>:</h4>
<p><a href="https://github.com/PeterScholze/Analytic/pull/2">https://github.com/PeterScholze/Analytic/pull/2</a></p>



<a name="224579108"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/bounded%20exactness/near/224579108" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html#224579108">(Jan 30 2021 at 10:43)</a>:</h4>
<p>Johan, aren't you forgetting <a href="https://leanprover-community.github.io/mathlib_docs/find/nat.succ_le_of_lt">docs#nat.succ_le_of_lt</a>?</p>



<a name="224579157"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/bounded%20exactness/near/224579157" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html#224579157">(Jan 30 2021 at 10:44)</a>:</h4>
<p>Or maybe k isn't a natural number.</p>



<a name="224579168"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/bounded%20exactness/near/224579168" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html#224579168">(Jan 30 2021 at 10:45)</a>:</h4>
<p>Oh, yes k is a norm constraint, not a graduation one, forget about that. I should have read the context instead of relying only on notations...</p>



<a name="224585537"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/bounded%20exactness/near/224585537" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Peter Scholze <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html#224585537">(Jan 30 2021 at 13:38)</a>:</h4>
<p>Yes sorry, <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi><mo>≥</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">k\geq 1</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.83041em;vertical-align:-0.13597em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">≥</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span> always. One sometimes forgets to mention this when in fact <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi><mo>≫</mo><mn>100000</mn></mrow><annotation encoding="application/x-tex">k\gg 100000</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.73354em;vertical-align:-0.0391em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">≫</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span><span class="mord">0</span><span class="mord">0</span><span class="mord">0</span><span class="mord">0</span><span class="mord">0</span></span></span></span> is implicit in your head ;-)</p>



<a name="224695943"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/bounded%20exactness/near/224695943" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html#224695943">(Feb 01 2021 at 08:16)</a>:</h4>
<p>I've thought a bit about the weak exactness lemmas yesterday night. I'm pretty confident the <a href="https://leanprover-community.github.io/liquid/index.html#completion_is_weakexact">first lemma</a> will be not so bad, there are clear sublemmas to extract there. However, before pressing on,  I feel like we should discuss whether we really want to keep a single <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span></span></span></span> in the definition of weak exactness. Currently <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span></span></span></span> is used both a the restriction depth factor and the norm bound. This is a bit confusing to me. When I first read that definition I only remembered that it was a definition about a subtle relation between restriction depth and norm bounds. Now I feel this is completely artificial. And if we are interested in explicit bounds on <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span></span></span></span> then probably we should track both uses of <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span></span></span></span> independently.</p>



<a name="224705139"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/bounded%20exactness/near/224705139" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Peter Scholze <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html#224705139">(Feb 01 2021 at 09:59)</a>:</h4>
<p><span class="user-mention" data-user-id="110031">@Patrick Massot</span> You are absolutely right, <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span></span></span></span> plays two roles that have nothing to do with each other. I was just too lazy and didn't want to have yet another variable.</p>



<a name="224705190"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/bounded%20exactness/near/224705190" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Peter Scholze <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html#224705190">(Feb 01 2021 at 10:00)</a>:</h4>
<p>It definitely makes sense to turn it into two variables, it will also improve estimates</p>



<a name="225286106"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/bounded%20exactness/near/225286106" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html#225286106">(Feb 05 2021 at 11:14)</a>:</h4>
<p>I'll have time this afternoon to tackle these lemmas relating weak exactness and exactness for complexes of <em>complete</em> normed groups. Is this still relevant or were there changes that made them obsolete?</p>



<a name="225286485"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/bounded%20exactness/near/225286485" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Peter Scholze <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html#225286485">(Feb 05 2021 at 11:19)</a>:</h4>
<p>I think that's still relevant!</p>



<a name="225355943"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/bounded%20exactness/near/225355943" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html#225355943">(Feb 05 2021 at 21:00)</a>:</h4>
<p>I didn't have time for Lean code in the end, but I did went through the LaTeX code. Riccardo, could you have a look at the beginning of the newly created Section 4 of <a href="/user_uploads/3121/7Z46k-pICMuxWWvM7I3ukBJQ/blueprint.pdf">blueprint.pdf</a> up to the bottom of Page 7?</p>



<a name="225356185"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/bounded%20exactness/near/225356185" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html#225356185">(Feb 05 2021 at 21:02)</a>:</h4>
<p>I am looking at it</p>



<a name="225356356"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/bounded%20exactness/near/225356356" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html#225356356">(Feb 05 2021 at 21:03)</a>:</h4>
<p>Recent changes to the blueprint:</p>
<ul>
<li>Gather all normed homological algebra in a dedicated Section 4 instead of splitting it between the main text and an appendix (which was simply following the structure of the lecture notes where it made sense to hide technical stuff).</li>
<li>Split off the two uses of <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span></span></span></span> in the definition of (weak)-exactness</li>
<li>State two extra small technical lemmas split off the proof of our previous pair of technical lemma (I can see some fractal appearing there)</li>
<li>Simplify notations in the normed homological algebra stuff.</li>
<li>Slightly rephrase the first two technical proofs so that we don't choose magic sequences of positive real numbers upfront.</li>
</ul>



<a name="225356573"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/bounded%20exactness/near/225356573" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html#225356573">(Feb 05 2021 at 21:05)</a>:</h4>
<p>Is "closed element" standard terminology?</p>



<a name="225357491"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/bounded%20exactness/near/225357491" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html#225357491">(Feb 05 2021 at 21:06)</a>:</h4>
<p>I'm only pretending to know complexes that are not the de Rham complex maybe?</p>



<a name="225357579"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/bounded%20exactness/near/225357579" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html#225357579">(Feb 05 2021 at 21:06)</a>:</h4>
<p>Closed differential form is certainly a standard terminology.</p>



<a name="225357710"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/bounded%20exactness/near/225357710" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html#225357710">(Feb 05 2021 at 21:07)</a>:</h4>
<p>Ah, sure</p>



<a name="225357805"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/bounded%20exactness/near/225357805" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html#225357805">(Feb 05 2021 at 21:07)</a>:</h4>
<p>Anyway, the fact that you asked means we should avoid this terminology. There are enough unusual things going on here.</p>



<a name="225358514"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/bounded%20exactness/near/225358514" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html#225358514">(Feb 05 2021 at 21:14)</a>:</h4>
<p>Looks good to me</p>



<a name="225358709"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/bounded%20exactness/near/225358709" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html#225358709">(Feb 05 2021 at 21:16)</a>:</h4>
<p>Would "cocycle" and "coboundary" be better?</p>



<a name="225358761"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/bounded%20exactness/near/225358761" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html#225358761">(Feb 05 2021 at 21:16)</a>:</h4>
<p>Probably</p>



<a name="225359171"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/bounded%20exactness/near/225359171" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html#225359171">(Feb 05 2021 at 21:20)</a>:</h4>
<p>I still find it weird that you are happy to use "exact" but not "closed".</p>



<a name="225359315"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/bounded%20exactness/near/225359315" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html#225359315">(Feb 05 2021 at 21:22)</a>:</h4>
<p>Anyway, I'll try to Lean that soon. Hopefully those little reformulation will make it slightly easier (at least it's less frightening).</p>



<a name="225359369"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/bounded%20exactness/near/225359369" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html#225359369">(Feb 05 2021 at 21:22)</a>:</h4>
<p>Probably because exact is less used, so my mind only find one "instance". Closed relates to closed subspaces (that were relevant for the story of weak exactness) and complete... but this is just how my brain works</p>



<a name="225420594"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/bounded%20exactness/near/225420594" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html#225420594">(Feb 06 2021 at 17:02)</a>:</h4>
<p>I pushed the Zeeman effect refactor. It splits the role of <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span></span></span></span> in the bounded exactness definitions into a depth factor and norm bound. The <a href="https://github.com/leanprover-community/lean-liquid/blob/5381dbb4fd42bddef5f72ad91f46c166a9696266/src/system_of_complexes.lean#L184-L195">new definitions</a> are:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">def</span> <span class="n">is_bdd_exact_for_bdd_degree_above_idx</span>
  <span class="o">(</span><span class="n">k</span> <span class="n">K</span> <span class="o">:</span> <span class="n">ℝ</span><span class="bp">≥</span><span class="mi">0</span><span class="o">)</span> <span class="o">(</span><span class="n">m</span> <span class="o">:</span> <span class="n">ℤ</span><span class="o">)</span> <span class="o">[</span><span class="n">hk</span> <span class="o">:</span> <span class="n">fact</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">≤</span> <span class="n">k</span><span class="o">)]</span> <span class="o">(</span><span class="n">c₀</span> <span class="o">:</span> <span class="n">ℝ</span><span class="bp">≥</span><span class="mi">0</span><span class="o">)</span> <span class="o">:</span> <span class="kt">Prop</span> <span class="o">:=</span>
<span class="bp">∀</span> <span class="n">c</span> <span class="bp">≥</span> <span class="n">c₀</span><span class="o">,</span> <span class="bp">∀</span> <span class="n">i</span> <span class="bp">&lt;</span> <span class="n">m</span><span class="o">,</span>
<span class="bp">∀</span> <span class="n">x</span> <span class="o">:</span> <span class="n">C</span> <span class="o">(</span><span class="n">k</span> <span class="bp">*</span> <span class="n">c</span><span class="o">)</span> <span class="o">(</span><span class="n">i</span><span class="bp">+</span><span class="mi">1</span><span class="o">),</span>
<span class="bp">∃</span> <span class="n">y</span> <span class="o">:</span> <span class="n">C</span> <span class="n">c</span> <span class="n">i</span><span class="o">,</span> <span class="bp">∥</span><span class="n">res</span> <span class="n">x</span> <span class="bp">-</span> <span class="n">d</span> <span class="n">y</span><span class="bp">∥</span> <span class="bp">≤</span> <span class="n">K</span> <span class="bp">*</span> <span class="bp">∥</span><span class="n">d</span> <span class="n">x</span><span class="bp">∥</span>

<span class="kd">def</span> <span class="n">is_weak_bdd_exact_for_bdd_degree_above_idx</span>
  <span class="o">(</span><span class="n">k</span> <span class="n">K</span> <span class="o">:</span> <span class="n">ℝ</span><span class="bp">≥</span><span class="mi">0</span><span class="o">)</span> <span class="o">(</span><span class="n">m</span> <span class="o">:</span> <span class="n">ℤ</span><span class="o">)</span> <span class="o">[</span><span class="n">hk</span> <span class="o">:</span> <span class="n">fact</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">≤</span> <span class="n">k</span><span class="o">)]</span> <span class="o">(</span><span class="n">c₀</span> <span class="o">:</span> <span class="n">ℝ</span><span class="bp">≥</span><span class="mi">0</span><span class="o">)</span> <span class="o">:</span> <span class="kt">Prop</span> <span class="o">:=</span>
<span class="bp">∀</span> <span class="n">c</span> <span class="bp">≥</span> <span class="n">c₀</span><span class="o">,</span> <span class="bp">∀</span> <span class="n">i</span> <span class="bp">&lt;</span> <span class="n">m</span><span class="o">,</span>
<span class="bp">∀</span> <span class="n">x</span> <span class="o">:</span> <span class="n">C</span> <span class="o">(</span><span class="n">k</span> <span class="bp">*</span> <span class="n">c</span><span class="o">)</span> <span class="o">(</span><span class="n">i</span><span class="bp">+</span><span class="mi">1</span><span class="o">),</span>
<span class="bp">∀</span> <span class="n">ε</span> <span class="bp">&gt;</span> <span class="mi">0</span><span class="o">,</span> <span class="bp">∃</span> <span class="n">y</span> <span class="o">:</span> <span class="n">C</span> <span class="n">c</span> <span class="n">i</span><span class="o">,</span> <span class="bp">∥</span><span class="n">res</span> <span class="n">x</span> <span class="bp">-</span> <span class="n">d</span> <span class="n">y</span><span class="bp">∥</span> <span class="bp">≤</span> <span class="n">K</span> <span class="bp">*</span> <span class="bp">∥</span><span class="n">d</span> <span class="n">x</span><span class="bp">∥</span> <span class="bp">+</span> <span class="n">ε</span>
</code></pre></div>
<p>Along the way, note also how new coercions to functions and smarter implicit arguments allow to write things like <code>x : C (k * c) (i+1)</code> or <code>∥res x - d y∥ ≤ K * ∥d x∥</code> (Peter, this is part of what Lean's elaborator can do, no need for decorations here).</p>



<a name="225420680"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/bounded%20exactness/near/225420680" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html#225420680">(Feb 06 2021 at 17:04)</a>:</h4>
<p>The normed snake lemma (weak bounded exactness version) <a href="https://github.com/leanprover-community/lean-liquid/blob/5381dbb4fd42bddef5f72ad91f46c166a9696266/src/normed_snake.lean#L13-L24">becomes</a>:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">lemma</span> <span class="n">weak_normed_snake</span> <span class="o">{</span><span class="n">k</span> <span class="n">k'</span> <span class="n">k''</span> <span class="n">K</span> <span class="n">K'</span> <span class="n">K''</span> <span class="o">:</span> <span class="n">ℝ</span><span class="bp">≥</span><span class="mi">0</span><span class="o">}</span>
  <span class="o">[</span><span class="n">hk</span> <span class="o">:</span> <span class="n">fact</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">≤</span> <span class="n">k</span><span class="o">)]</span> <span class="o">[</span><span class="n">hk'</span> <span class="o">:</span> <span class="n">fact</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">≤</span> <span class="n">k'</span><span class="o">)]</span> <span class="o">[</span><span class="n">hk''</span> <span class="o">:</span> <span class="n">fact</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">≤</span> <span class="n">k''</span><span class="o">)]</span>
  <span class="o">{</span><span class="n">m</span> <span class="o">:</span> <span class="n">ℤ</span><span class="o">}</span> <span class="o">{</span><span class="n">c₀</span> <span class="o">:</span> <span class="n">ℝ</span><span class="bp">≥</span><span class="mi">0</span><span class="o">}</span>
  <span class="o">(</span><span class="n">hM</span> <span class="o">:</span> <span class="n">M.is_weak_bdd_exact_for_bdd_degree_above_idx</span> <span class="n">k</span> <span class="n">K</span> <span class="n">m</span> <span class="n">c₀</span><span class="o">)</span>
  <span class="o">(</span><span class="n">hM'</span> <span class="o">:</span> <span class="n">M'.is_weak_bdd_exact_for_bdd_degree_above_idx</span> <span class="n">k'</span> <span class="n">K'</span> <span class="n">m</span> <span class="n">c₀</span><span class="o">)</span>
  <span class="o">(</span><span class="n">hM'_adm</span> <span class="o">:</span> <span class="n">M'.admissible</span><span class="o">)</span>
  <span class="o">(</span><span class="n">hf</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">c</span> <span class="n">i</span><span class="o">,</span> <span class="n">is_strict</span> <span class="o">(</span><span class="n">f.apply</span> <span class="o">:</span> <span class="n">M</span> <span class="n">c</span> <span class="n">i</span> <span class="bp">⟶</span> <span class="n">M'</span> <span class="n">c</span> <span class="n">i</span><span class="o">))</span>
  <span class="o">(</span><span class="n">Hf</span> <span class="o">:</span> <span class="bp">∀</span> <span class="o">(</span><span class="n">c</span> <span class="o">:</span> <span class="n">ℝ</span><span class="bp">≥</span><span class="mi">0</span><span class="o">)</span> <span class="o">(</span><span class="n">i</span> <span class="o">:</span> <span class="n">ℤ</span><span class="o">)</span> <span class="o">(</span><span class="n">hi</span> <span class="o">:</span> <span class="n">i</span> <span class="bp">≤</span> <span class="n">m</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="n">M</span> <span class="o">(</span><span class="n">k''</span> <span class="bp">*</span> <span class="n">c</span><span class="o">)</span> <span class="n">i</span><span class="o">),</span>
    <span class="bp">∥</span><span class="o">(</span><span class="n">res</span> <span class="n">x</span> <span class="o">:</span> <span class="n">M</span> <span class="n">c</span> <span class="n">i</span><span class="o">)</span><span class="bp">∥</span> <span class="bp">≤</span> <span class="n">K''</span> <span class="bp">*</span> <span class="bp">∥</span><span class="n">f</span> <span class="n">x</span><span class="bp">∥</span><span class="o">)</span>
  <span class="o">(</span><span class="n">hg</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">c</span> <span class="n">i</span><span class="o">,</span> <span class="o">(</span><span class="n">g.apply</span> <span class="o">:</span> <span class="n">M'</span> <span class="n">c</span> <span class="n">i</span> <span class="bp">⟶</span> <span class="n">N</span> <span class="n">c</span> <span class="n">i</span><span class="o">)</span><span class="bp">.</span><span class="n">ker</span> <span class="bp">=</span> <span class="n">f.apply.range</span><span class="o">)</span>
  <span class="o">(</span><span class="n">hgquot</span> <span class="o">:</span> <span class="n">system_of_complexes.is_quotient</span> <span class="n">g</span><span class="o">)</span> <span class="o">:</span>
  <span class="n">N.is_weak_bdd_exact_for_bdd_degree_above_idx</span> <span class="o">(</span><span class="n">k''</span><span class="bp">*</span><span class="n">k</span><span class="bp">*</span><span class="n">k'</span><span class="o">)</span> <span class="o">(</span><span class="n">K'</span><span class="bp">*</span><span class="o">(</span><span class="n">K</span><span class="bp">*</span><span class="n">K''</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">))</span> <span class="o">(</span><span class="n">m</span> <span class="bp">-</span> <span class="mi">1</span><span class="o">)</span> <span class="n">c₀</span>
</code></pre></div>



<a name="225420715"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/bounded%20exactness/near/225420715" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html#225420715">(Feb 06 2021 at 17:05)</a>:</h4>
<p>Note that I also took the opportunity to stop assuming the restriction depth factor for both systems of complexes and <code>f</code>, and same for the norm bounds.</p>



<a name="225420765"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/bounded%20exactness/near/225420765" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html#225420765">(Feb 06 2021 at 17:06)</a>:</h4>
<p>It doesn't cost anything anyway since separating both uses of <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span></span></span></span> means that we don't have to align constants anymore.</p>



<a name="225420966"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/bounded%20exactness/near/225420966" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html#225420966">(Feb 06 2021 at 17:10)</a>:</h4>
<p>Technical note: the coercion that allows to write <code>x : C c i</code> for <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi><mo>∈</mo><msubsup><mi>C</mi><mi>c</mi><mi>i</mi></msubsup></mrow><annotation encoding="application/x-tex">x \in C^i_c</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.071664em;vertical-align:-0.247em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.824664em;"><span style="top:-2.4530000000000003em;margin-left:-0.07153em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">c</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span></span></span></span> is completely smooth. The coercion from morphisms of system of complexes to functions is less efficient. It works great when applying a morphism to an element. But the elaborator doesn't understand <code>(f : M c i ⟶ M' c i)</code>. That's why <code>f.apply</code> still appears in the statement above, and this causing some pain in the proof.</p>



<a name="225420983"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/bounded%20exactness/near/225420983" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html#225420983">(Feb 06 2021 at 17:11)</a>:</h4>
<p>One could argue that writing <code>f.apply</code> everywhere is less painful. This would be easy to revert (although I wasn't careful enough to have a commit containing only that move...).</p>



<a name="225421100"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/bounded%20exactness/near/225421100" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html#225421100">(Feb 06 2021 at 17:14)</a>:</h4>
<p>Important note: the statement of Proposition 9.6 now has a random constant. It hasn't been updated.</p>



<a name="225422047"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/bounded%20exactness/near/225422047" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html#225422047">(Feb 06 2021 at 17:34)</a>:</h4>
<p><span class="user-mention" data-user-id="110031">@Patrick Massot</span> thanks a lot for this refactor!</p>



<a name="225422073"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/bounded%20exactness/near/225422073" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html#225422073">(Feb 06 2021 at 17:35)</a>:</h4>
<p>(Today I learned about the Zeeman effect <span aria-label="laughing" class="emoji emoji-1f606" role="img" title="laughing">:laughing:</span>)</p>



<a name="225554481"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/bounded%20exactness/near/225554481" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html#225554481">(Feb 08 2021 at 14:52)</a>:</h4>
<p>Is someone (and I mean <span class="user-mention" data-user-id="110031">@Patrick Massot</span> ) working on lemmas like <code>system_of_complexes.controlled_y</code>? If not I think I can prove it during the week.</p>



<a name="225555472"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/bounded%20exactness/near/225555472" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html#225555472">(Feb 08 2021 at 14:59)</a>:</h4>
<p>Yes, Patrick has been looking at this. But he also hit some DTT troubles. We need a principled solution to the following issue: if <code>x : C c i</code> and you want to say that <code>x</code> is in the image of <code>d</code>, then you get some <code>y : C c (i - 1)</code> such that <code>d y = x</code>. Except that this doesn't typecheck, because <code>d y : C c (i - 1 + 1)</code>.<br>
And <code>i - 1 + 1</code> is not defeq to <code>i</code>. This is of course a very annoying stupidity. But we'll need to find a smooth solution, or otherwise we'll have a lot of very painful hours ahead of us, and the resulting code will be awful to read.</p>



<a name="225556109"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/bounded%20exactness/near/225556109" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bhavik Mehta <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html#225556109">(Feb 08 2021 at 15:02)</a>:</h4>
<p>Does the eq_to_hom sort of idea work here? Specifically, does it work to make a morphism C c i -&gt; C c j given i = j, and insert it in the equality? I think this idea has been successful in abstract categories, perhaps it's appropriate here as well</p>



<a name="225556456"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/bounded%20exactness/near/225556456" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html#225556456">(Feb 08 2021 at 15:05)</a>:</h4>
<p>We already have <code>system_of_complexes.congr</code> that does that. It has been written by Johan, so I guess he sees some troubles in using it a lot</p>



<a name="225556921"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/bounded%20exactness/near/225556921" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html#225556921">(Feb 08 2021 at 15:08)</a>:</h4>
<p>Just thinking out loud here: What if we redefine complexes so that the <code>d</code> is defined on the whole complex at once, not on the individual graded components? This is the usual thing we do on paper, where <code>d</code>is defined on the direct sum of the graded components.</p>



<a name="225556969"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/bounded%20exactness/near/225556969" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html#225556969">(Feb 08 2021 at 15:08)</a>:</h4>
<p><span class="user-mention" data-user-id="246273">@Bhavik Mehta</span> it doesn't make the code pleasant to look at. Once you start chasing elements through diagrams, you don't want to constantly tell Lean that <code>eq_to_hom</code> commutes with foo, bar, and quux.</p>



<a name="225556986"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/bounded%20exactness/near/225556986" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html#225556986">(Feb 08 2021 at 15:08)</a>:</h4>
<p>I know that these complexes were defined elsewhere (in mathlib), so this would be a significant change.</p>



<a name="225557094"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/bounded%20exactness/near/225557094" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html#225557094">(Feb 08 2021 at 15:09)</a>:</h4>
<p>Why not just take the direct sum of all the objects?</p>



<a name="225557703"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/bounded%20exactness/near/225557703" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html#225557703">(Feb 08 2021 at 15:12)</a>:</h4>
<p>And endow it with the sup norm? Maybe it works... we'll have to experiment</p>



<a name="225557860"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/bounded%20exactness/near/225557860" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html#225557860">(Feb 08 2021 at 15:13)</a>:</h4>
<p>The fix which Mario sometimes advertises is the sigma type,i.e. the disjoint union of the objects. But because these things are groups, the direct sum seems more natural.</p>



<a name="225558083"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/bounded%20exactness/near/225558083" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html#225558083">(Feb 08 2021 at 15:15)</a>:</h4>
<p>Or you can have the best of both worlds: Define a new thing, called <code>D</code> or something, on the sigma type (or direct sum, whatever), and add an axiom that it agrees with <code>d</code> on the graded components.</p>



<a name="225558108"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/bounded%20exactness/near/225558108" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html#225558108">(Feb 08 2021 at 15:15)</a>:</h4>
<p>Then just restate things in terms of <code>D</code>.</p>



<a name="225558358"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/bounded%20exactness/near/225558358" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html#225558358">(Feb 08 2021 at 15:16)</a>:</h4>
<p>Currently, my idea was to have <code>d</code> take to arguments <code>i j</code> and mover from <code>C c i</code> to <code>C c j</code>. It should automatically infer a proof that <code>j = i + 1</code>. However, auto_params don't play well with bundled functions, I just discovered. See the question in <a class="stream" data-stream-id="113488" href="/#narrow/stream/113488-general">#general</a></p>



<a name="225561719"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/bounded%20exactness/near/225561719" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html#225561719">(Feb 08 2021 at 15:39)</a>:</h4>
<p>We can maybe have two version, one like the current one and one like the one you want, but where we write the proof that <code>j = i + 1</code> by hand, so most of the time we use the normal one, and when needed we use the other one.</p>



<a name="225562050"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/bounded%20exactness/near/225562050" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html#225562050">(Feb 08 2021 at 15:41)</a>:</h4>
<p>I think the direct-sum idea is also interesting, but I would like to see some code to know what it would really look like</p>



<a name="225562086"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/bounded%20exactness/near/225562086" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html#225562086">(Feb 08 2021 at 15:41)</a>:</h4>
<p>Mmm, I see that then we will have to chose which one to use in the definition of <code>exact</code>, that is probably not a good thing</p>



<a name="225565090"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/bounded%20exactness/near/225565090" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastien Gouezel <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html#225565090">(Feb 08 2021 at 16:02)</a>:</h4>
<p>Would something like <code>d {i} {j} (h : j = i + 1 . my_tactic) (x : C i) : C j := ...</code> be fine, where <code>my_tactic</code> would try <code>refl</code> and <code>j = j - 1 + 1</code> and so on (where the "and so on" would not need to be able to treat everything, only what comes up in practice)? Or is it the problem you mention in the other thread that prevents this from working?</p>



<a name="225565301"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/bounded%20exactness/near/225565301" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html#225565301">(Feb 08 2021 at 16:03)</a>:</h4>
<p>Right, but then we no longer have a bundled morphism...</p>



<a name="225568126"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/bounded%20exactness/near/225568126" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html#225568126">(Feb 08 2021 at 16:22)</a>:</h4>
<p>I apologize for the secret work shared only in private messages with Johan. This is a bad habit inherited from the perfectoid project when we were only three contributors. Indeed I started to work on those lemmas and hit issues with dependent types. The following is a piece of not quite working code for people who want to play with those issues:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">data.real.nnreal</span>

<span class="n">open_locale</span> <span class="n">nnreal</span>

<span class="kd">structure</span> <span class="n">mock_complex</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">obj</span> <span class="o">:</span> <span class="n">ℝ</span><span class="bp">≥</span><span class="mi">0</span> <span class="bp">→</span> <span class="n">ℤ</span> <span class="bp">→</span> <span class="kt">Type</span><span class="o">)</span>
<span class="o">(</span><span class="n">differential</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">c</span> <span class="n">i</span><span class="o">,</span> <span class="n">obj</span> <span class="n">c</span> <span class="n">i</span> <span class="bp">→</span> <span class="n">obj</span> <span class="n">c</span> <span class="o">(</span><span class="n">i</span><span class="bp">+</span><span class="mi">1</span><span class="o">))</span>
<span class="o">(</span><span class="n">restriction</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">c'</span> <span class="n">c</span> <span class="n">i</span><span class="o">,</span> <span class="n">c</span> <span class="bp">≤</span> <span class="n">c'</span> <span class="bp">→</span> <span class="n">obj</span> <span class="n">c'</span> <span class="n">i</span> <span class="bp">→</span> <span class="n">obj</span> <span class="n">c</span> <span class="n">i</span><span class="o">)</span>
<span class="o">(</span><span class="n">restriction_func</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">c</span> <span class="n">c'</span> <span class="n">c''</span> <span class="n">i</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="n">c</span> <span class="bp">≤</span> <span class="n">c'</span><span class="o">)</span> <span class="o">(</span><span class="n">h'</span> <span class="o">:</span> <span class="n">c'</span> <span class="bp">≤</span> <span class="n">c''</span><span class="o">)</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="n">obj</span> <span class="n">c''</span> <span class="n">i</span><span class="o">),</span>
  <span class="n">restriction</span> <span class="n">c'</span> <span class="n">c</span> <span class="n">i</span> <span class="n">h</span> <span class="o">(</span><span class="n">restriction</span> <span class="n">c''</span> <span class="n">c'</span> <span class="n">i</span> <span class="n">h'</span> <span class="n">x</span><span class="o">)</span> <span class="bp">=</span> <span class="n">restriction</span> <span class="n">c''</span> <span class="n">c</span> <span class="n">i</span> <span class="o">(</span><span class="n">h.trans</span> <span class="n">h'</span><span class="o">)</span> <span class="n">x</span><span class="o">)</span>
<span class="o">(</span><span class="n">commute</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">c</span> <span class="n">c'</span> <span class="n">i</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="n">c</span> <span class="bp">≤</span> <span class="n">c'</span><span class="o">)</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="n">obj</span> <span class="n">c'</span> <span class="n">i</span><span class="o">),</span>
  <span class="n">differential</span> <span class="n">c</span> <span class="n">i</span> <span class="o">(</span><span class="n">restriction</span> <span class="n">c'</span> <span class="n">c</span> <span class="n">i</span> <span class="n">h</span> <span class="n">x</span><span class="o">)</span> <span class="bp">=</span> <span class="n">restriction</span> <span class="n">c'</span> <span class="n">c</span> <span class="o">(</span><span class="n">i</span><span class="bp">+</span><span class="mi">1</span><span class="o">)</span> <span class="n">h</span> <span class="o">(</span><span class="n">differential</span> <span class="n">c'</span> <span class="n">i</span> <span class="n">x</span><span class="o">))</span>

<span class="kd">instance</span> <span class="o">:</span> <span class="n">has_coe_to_fun</span> <span class="n">mock_complex</span> <span class="o">:=</span>
<span class="o">⟨</span><span class="bp">λ</span> <span class="n">C</span><span class="o">,</span> <span class="n">ℝ</span><span class="bp">≥</span><span class="mi">0</span> <span class="bp">→</span> <span class="n">ℤ</span> <span class="bp">→</span> <span class="kt">Type</span><span class="o">,</span> <span class="bp">λ</span> <span class="n">C</span><span class="o">,</span> <span class="n">C.obj</span> <span class="o">⟩</span>

<span class="kn">section</span>
<span class="kn">open</span> <span class="n">tactic</span>

<span class="kd">example</span> <span class="o">{</span><span class="n">c</span> <span class="n">c'</span> <span class="n">c''</span> <span class="o">:</span> <span class="n">ℝ</span><span class="bp">≥</span><span class="mi">0</span><span class="o">}</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="n">c</span> <span class="bp">≤</span> <span class="n">c'</span><span class="o">)</span> <span class="o">(</span><span class="n">h'</span> <span class="o">:</span> <span class="n">c'</span> <span class="bp">≤</span> <span class="n">c''</span><span class="o">)</span> <span class="o">:</span> <span class="n">c</span> <span class="bp">≤</span> <span class="n">c''</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="n">rw</span> <span class="bp">←</span> <span class="n">nnreal.coe_le_coe</span> <span class="n">at</span> <span class="bp">*</span><span class="o">,</span>
  <span class="n">linarith</span><span class="o">,</span>
<span class="kd">end</span>

<span class="kd">lemma</span> <span class="n">stupid_one</span> <span class="o">{</span><span class="n">c</span> <span class="n">k</span> <span class="o">:</span> <span class="n">ℝ</span><span class="bp">≥</span><span class="mi">0</span><span class="o">}</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="mi">1</span> <span class="bp">≤</span> <span class="n">k</span><span class="o">)</span> <span class="o">:</span> <span class="n">c</span> <span class="bp">≤</span> <span class="n">k</span><span class="bp">*</span><span class="n">c</span><span class="o">:=</span>
<span class="kd">begin</span>
  <span class="n">conv_lhs</span> <span class="o">{</span> <span class="n">rw</span> <span class="bp">←</span> <span class="n">one_mul</span> <span class="n">c</span> <span class="o">},</span>
  <span class="n">exact</span> <span class="n">mul_le_mul_right'</span> <span class="n">h</span> <span class="n">c</span>
<span class="kd">end</span>

<span class="kd">lemma</span> <span class="n">stupid_two</span> <span class="o">{</span><span class="n">c</span> <span class="n">k</span> <span class="o">:</span> <span class="n">ℝ</span><span class="bp">≥</span><span class="mi">0</span><span class="o">}</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="mi">1</span> <span class="bp">≤</span> <span class="n">k</span><span class="o">)</span> <span class="o">:</span> <span class="n">c</span> <span class="bp">≤</span> <span class="n">k</span><span class="bp">^</span><span class="mi">2</span><span class="bp">*</span><span class="n">c</span><span class="o">:=</span>
<span class="kd">begin</span>
  <span class="n">rw</span> <span class="o">[</span><span class="n">pow_two</span><span class="o">,</span> <span class="n">mul_assoc</span><span class="o">],</span>
  <span class="k">have</span> <span class="o">:</span> <span class="n">c</span> <span class="bp">≤</span> <span class="n">k</span><span class="bp">*</span><span class="n">c</span> <span class="o">:=</span> <span class="n">stupid_one</span> <span class="n">h</span><span class="o">,</span>
  <span class="n">conv_lhs</span> <span class="o">{</span> <span class="n">rw</span> <span class="bp">←</span> <span class="n">one_mul</span> <span class="n">c</span> <span class="o">},</span>
  <span class="n">apply</span> <span class="n">mul_le_mul</span> <span class="bp">;</span> <span class="n">try</span> <span class="o">{</span> <span class="n">assumption</span> <span class="o">}</span> <span class="bp">;</span> <span class="n">exact</span> <span class="n">nnreal.zero_le_coe</span>
<span class="kd">end</span>

<span class="kd">lemma</span> <span class="n">stupid_three</span> <span class="o">{</span><span class="n">c</span> <span class="n">k</span> <span class="o">:</span> <span class="n">ℝ</span><span class="bp">≥</span><span class="mi">0</span><span class="o">}</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="mi">1</span> <span class="bp">≤</span> <span class="n">k</span><span class="o">)</span> <span class="o">:</span> <span class="n">k</span><span class="bp">*</span><span class="n">c</span> <span class="bp">≤</span> <span class="n">k</span><span class="bp">^</span><span class="mi">2</span><span class="bp">*</span><span class="n">c</span><span class="o">:=</span>
<span class="kd">begin</span>
  <span class="n">rw</span> <span class="o">[</span><span class="n">pow_two</span><span class="o">,</span> <span class="n">mul_assoc</span><span class="o">],</span>
  <span class="n">exact</span> <span class="n">stupid_one</span> <span class="n">h</span><span class="o">,</span>
<span class="kd">end</span>

<span class="kd">meta</span> <span class="kd">def</span> <span class="n">magic</span> <span class="o">:</span> <span class="n">tactic</span> <span class="n">unit</span> <span class="o">:=</span>
<span class="k">do</span> <span class="o">(</span><span class="n">assumption</span> <span class="bp">&lt;|&gt;</span>
   <span class="bp">`</span><span class="o">[</span><span class="n">rw</span> <span class="bp">←</span> <span class="n">nnreal.coe_le_coe</span> <span class="n">at</span> <span class="bp">*</span><span class="o">,</span> <span class="n">linarith</span><span class="o">])</span> <span class="bp">&lt;|&gt;</span>
   <span class="bp">`</span><span class="o">[</span><span class="n">simp</span> <span class="o">[</span><span class="n">stupid_one</span><span class="o">,</span> <span class="n">stupid_two</span><span class="o">,</span> <span class="n">stupid_three</span><span class="o">,</span> <span class="bp">*</span><span class="o">]]</span> <span class="bp">&lt;|&gt;</span>
   <span class="n">target</span> <span class="bp">&gt;&gt;=</span> <span class="n">trace</span>

<span class="kd">end</span>

<span class="kd">def</span> <span class="n">res</span> <span class="o">{</span><span class="n">C</span> <span class="o">:</span> <span class="n">mock_complex</span><span class="o">}</span> <span class="o">{</span><span class="n">c</span> <span class="n">c'</span> <span class="o">:</span> <span class="n">ℝ</span><span class="bp">≥</span><span class="mi">0</span><span class="o">}</span> <span class="o">{</span><span class="n">i</span> <span class="o">:</span> <span class="n">ℤ</span><span class="o">}</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="n">C</span> <span class="n">c'</span> <span class="n">i</span><span class="o">)</span> <span class="o">(</span><span class="n">hc</span> <span class="o">:</span> <span class="n">c</span> <span class="bp">≤</span> <span class="n">c'</span> <span class="bp">.</span> <span class="n">magic</span><span class="o">)</span> <span class="o">:</span> <span class="n">C</span> <span class="n">c</span> <span class="n">i</span> <span class="o">:=</span>
<span class="n">C.restriction</span> <span class="n">c'</span> <span class="n">c</span> <span class="n">i</span> <span class="n">hc</span> <span class="n">x</span>

<span class="kd">def</span> <span class="n">d</span> <span class="o">{</span><span class="n">C</span> <span class="o">:</span> <span class="n">mock_complex</span><span class="o">}</span> <span class="o">{</span><span class="n">c</span> <span class="o">:</span> <span class="n">ℝ</span><span class="bp">≥</span><span class="mi">0</span><span class="o">}</span> <span class="o">{</span><span class="n">i</span> <span class="o">:</span> <span class="n">ℤ</span><span class="o">}</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="n">C</span> <span class="n">c</span> <span class="n">i</span><span class="o">)</span> <span class="o">:</span> <span class="n">C</span> <span class="n">c</span> <span class="o">(</span><span class="n">i</span><span class="bp">+</span><span class="mi">1</span><span class="o">)</span> <span class="o">:=</span>
<span class="n">C.differential</span> <span class="n">c</span> <span class="n">i</span> <span class="n">x</span>

<span class="kd">lemma</span> <span class="n">d_res</span> <span class="o">{</span><span class="n">C</span> <span class="o">:</span> <span class="n">mock_complex</span><span class="o">}</span> <span class="o">{</span><span class="n">c</span> <span class="n">c'</span> <span class="o">:</span> <span class="n">ℝ</span><span class="bp">≥</span><span class="mi">0</span><span class="o">}</span> <span class="o">{</span><span class="n">i</span> <span class="o">:</span> <span class="n">ℤ</span><span class="o">}</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="n">C</span> <span class="n">c'</span> <span class="n">i</span><span class="o">)</span> <span class="o">(</span><span class="n">hc</span> <span class="o">:</span> <span class="n">c</span> <span class="bp">≤</span> <span class="n">c'</span><span class="o">)</span> <span class="o">:</span>
  <span class="n">d</span> <span class="o">(</span><span class="n">res</span> <span class="n">x</span><span class="o">)</span> <span class="bp">=</span> <span class="n">res</span> <span class="o">(</span><span class="n">d</span> <span class="n">x</span><span class="o">)</span> <span class="o">:=</span>
<span class="kd">by</span> <span class="n">apply</span> <span class="n">C.commute</span>

<span class="kd">lemma</span> <span class="n">res_res</span> <span class="o">{</span><span class="n">C</span> <span class="o">:</span> <span class="n">mock_complex</span><span class="o">}</span> <span class="o">{</span><span class="n">c</span> <span class="n">c'</span> <span class="n">c''</span> <span class="o">:</span> <span class="n">ℝ</span><span class="bp">≥</span><span class="mi">0</span><span class="o">}</span> <span class="o">{</span><span class="n">i</span> <span class="o">:</span> <span class="n">ℤ</span><span class="o">}</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="n">C</span> <span class="n">c''</span> <span class="n">i</span><span class="o">)</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="n">c</span> <span class="bp">≤</span> <span class="n">c'</span><span class="o">)</span> <span class="o">(</span><span class="n">h'</span> <span class="o">:</span> <span class="n">c'</span> <span class="bp">≤</span> <span class="n">c''</span><span class="o">)</span> <span class="o">:</span>
  <span class="n">res</span> <span class="o">(</span><span class="n">res</span>  <span class="n">x</span><span class="o">)</span> <span class="bp">=</span> <span class="n">res</span> <span class="n">x</span> <span class="o">:=</span>
<span class="kd">by</span> <span class="n">apply</span> <span class="n">C.restriction_func</span>

<span class="kd">lemma</span> <span class="n">res_res_mul</span> <span class="o">{</span><span class="n">C</span> <span class="o">:</span> <span class="n">mock_complex</span><span class="o">}</span> <span class="o">{</span><span class="n">c</span> <span class="n">k</span> <span class="o">:</span> <span class="n">ℝ</span><span class="bp">≥</span><span class="mi">0</span><span class="o">}</span> <span class="o">{</span><span class="n">i</span> <span class="o">:</span> <span class="n">ℤ</span><span class="o">}</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="n">C</span> <span class="o">(</span><span class="n">k</span><span class="bp">^</span><span class="mi">2</span><span class="bp">*</span><span class="n">c</span><span class="o">)</span> <span class="n">i</span><span class="o">)</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="mi">1</span> <span class="bp">≤</span> <span class="n">k</span><span class="o">)</span> <span class="o">:</span>
  <span class="bp">@</span><span class="n">res</span> <span class="n">C</span> <span class="n">c</span> <span class="o">(</span><span class="n">k</span><span class="bp">*</span><span class="n">c</span><span class="o">)</span> <span class="n">i</span> <span class="o">(</span><span class="n">res</span> <span class="n">x</span> <span class="o">:</span> <span class="n">C</span> <span class="o">(</span><span class="n">k</span><span class="bp">*</span><span class="n">c</span><span class="o">)</span> <span class="n">i</span><span class="o">)</span> <span class="o">(</span><span class="kd">by</span> <span class="n">simp</span> <span class="o">[</span><span class="n">stupid_one</span><span class="o">,</span> <span class="n">stupid_two</span><span class="o">,</span> <span class="n">stupid_three</span><span class="o">,</span> <span class="bp">*</span><span class="o">])</span> <span class="bp">=</span> <span class="n">res</span> <span class="n">x</span> <span class="o">:=</span>
<span class="kd">by</span> <span class="n">apply</span> <span class="n">C.restriction_func</span>
</code></pre></div>



<a name="225572578"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/bounded%20exactness/near/225572578" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html#225572578">(Feb 08 2021 at 16:49)</a>:</h4>
<p>If we're playing with these auto param tricks, why not just play the <code>[fact (j = i + 1)]</code> game again?</p>



<a name="225573527"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/bounded%20exactness/near/225573527" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html#225573527">(Feb 08 2021 at 16:55)</a>:</h4>
<p>We tried this game already. It doesn't seem to be powerful enough.</p>



<a name="225573560"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/bounded%20exactness/near/225573560" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html#225573560">(Feb 08 2021 at 16:55)</a>:</h4>
<p>Ah okay.</p>



<a name="225573572"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/bounded%20exactness/near/225573572" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html#225573572">(Feb 08 2021 at 16:55)</a>:</h4>
<p>We need a more powerful proof search.</p>



<a name="225573818"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/bounded%20exactness/near/225573818" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html#225573818">(Feb 08 2021 at 16:56)</a>:</h4>
<p>In principle the auto parameter trick is allowed to run any tactic you want. I write "in principle" because there are issues. Part of the issue is with implicit vs explicit but the main one is elaboration order: at which stage of the elaboration does the tactic kicks in?</p>



<a name="225573903"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/bounded%20exactness/near/225573903" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html#225573903">(Feb 08 2021 at 16:57)</a>:</h4>
<p>In the case that doesn't work at the very end of the above snippet, the tactic gets <code>c \le ?m_1</code> as its goal, and obviously this is not very promising.</p>



<a name="225573947"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/bounded%20exactness/near/225573947" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html#225573947">(Feb 08 2021 at 16:57)</a>:</h4>
<p>So adding an instance like the following is not enough?</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">instance</span> <span class="o">{</span><span class="n">i</span> <span class="n">j</span> <span class="o">:</span> <span class="n">ℤ</span><span class="o">}</span> <span class="o">[</span><span class="n">h</span> <span class="o">:</span> <span class="n">fact</span> <span class="o">(</span><span class="n">j</span> <span class="bp">=</span> <span class="n">i</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)]</span> <span class="o">:</span> <span class="n">fact</span> <span class="o">(</span><span class="n">j</span><span class="bp">-</span><span class="mi">1</span> <span class="bp">=</span> <span class="n">i</span><span class="o">)</span> <span class="o">:=</span> <span class="gr">sorry</span>
</code></pre></div>



<a name="225574313"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/bounded%20exactness/near/225574313" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html#225574313">(Feb 08 2021 at 16:59)</a>:</h4>
<p>I'm getting no errors with the code snippet above. Am I supposed to?</p>



<a name="225574485"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/bounded%20exactness/near/225574485" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html#225574485">(Feb 08 2021 at 17:00)</a>:</h4>
<p>You'll get an error if you replace the last statement by something readable.</p>



<a name="225574533"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/bounded%20exactness/near/225574533" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html#225574533">(Feb 08 2021 at 17:01)</a>:</h4>
<p>Oh :)</p>



<a name="225579884"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/bounded%20exactness/near/225579884" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html#225579884">(Feb 08 2021 at 17:36)</a>:</h4>
<p>This is slightly more readable, IMO:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">data.real.nnreal</span>

<span class="n">open_locale</span> <span class="n">nnreal</span>

<span class="kd">structure</span> <span class="n">mock_complex</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">obj</span> <span class="o">:</span> <span class="n">ℝ</span><span class="bp">≥</span><span class="mi">0</span> <span class="bp">→</span> <span class="n">ℤ</span> <span class="bp">→</span> <span class="kt">Type</span><span class="o">)</span>
<span class="o">(</span><span class="n">differential</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">c</span> <span class="n">i</span><span class="o">,</span> <span class="n">obj</span> <span class="n">c</span> <span class="n">i</span> <span class="bp">→</span> <span class="n">obj</span> <span class="n">c</span> <span class="o">(</span><span class="n">i</span><span class="bp">+</span><span class="mi">1</span><span class="o">))</span>
<span class="o">(</span><span class="n">restriction</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">c'</span> <span class="n">c</span> <span class="n">i</span><span class="o">,</span> <span class="n">c</span> <span class="bp">≤</span> <span class="n">c'</span> <span class="bp">→</span> <span class="n">obj</span> <span class="n">c'</span> <span class="n">i</span> <span class="bp">→</span> <span class="n">obj</span> <span class="n">c</span> <span class="n">i</span><span class="o">)</span>
<span class="o">(</span><span class="n">restriction_func</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">c</span> <span class="n">c'</span> <span class="n">c''</span> <span class="n">i</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="n">c</span> <span class="bp">≤</span> <span class="n">c'</span><span class="o">)</span> <span class="o">(</span><span class="n">h'</span> <span class="o">:</span> <span class="n">c'</span> <span class="bp">≤</span> <span class="n">c''</span><span class="o">)</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="n">obj</span> <span class="n">c''</span> <span class="n">i</span><span class="o">),</span>
  <span class="n">restriction</span> <span class="n">c'</span> <span class="n">c</span> <span class="n">i</span> <span class="n">h</span> <span class="o">(</span><span class="n">restriction</span> <span class="n">c''</span> <span class="n">c'</span> <span class="n">i</span> <span class="n">h'</span> <span class="n">x</span><span class="o">)</span> <span class="bp">=</span> <span class="n">restriction</span> <span class="n">c''</span> <span class="n">c</span> <span class="n">i</span> <span class="o">(</span><span class="n">h.trans</span> <span class="n">h'</span><span class="o">)</span> <span class="n">x</span><span class="o">)</span>
<span class="o">(</span><span class="n">commute</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">c</span> <span class="n">c'</span> <span class="n">i</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="n">c</span> <span class="bp">≤</span> <span class="n">c'</span><span class="o">)</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="n">obj</span> <span class="n">c'</span> <span class="n">i</span><span class="o">),</span>
  <span class="n">differential</span> <span class="n">c</span> <span class="n">i</span> <span class="o">(</span><span class="n">restriction</span> <span class="n">c'</span> <span class="n">c</span> <span class="n">i</span> <span class="n">h</span> <span class="n">x</span><span class="o">)</span> <span class="bp">=</span> <span class="n">restriction</span> <span class="n">c'</span> <span class="n">c</span> <span class="o">(</span><span class="n">i</span><span class="bp">+</span><span class="mi">1</span><span class="o">)</span> <span class="n">h</span> <span class="o">(</span><span class="n">differential</span> <span class="n">c'</span> <span class="n">i</span> <span class="n">x</span><span class="o">))</span>

<span class="kd">instance</span> <span class="o">:</span> <span class="n">has_coe_to_fun</span> <span class="n">mock_complex</span> <span class="o">:=</span>
<span class="o">⟨</span><span class="bp">λ</span> <span class="n">C</span><span class="o">,</span> <span class="n">ℝ</span><span class="bp">≥</span><span class="mi">0</span> <span class="bp">→</span> <span class="n">ℤ</span> <span class="bp">→</span> <span class="kt">Type</span><span class="o">,</span> <span class="bp">λ</span> <span class="n">C</span><span class="o">,</span> <span class="n">C.obj</span> <span class="o">⟩</span>

<span class="kn">section</span>
<span class="kn">open</span> <span class="n">tactic</span>

<span class="kd">example</span> <span class="o">{</span><span class="n">c</span> <span class="n">c'</span> <span class="n">c''</span> <span class="o">:</span> <span class="n">ℝ</span><span class="bp">≥</span><span class="mi">0</span><span class="o">}</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="n">c</span> <span class="bp">≤</span> <span class="n">c'</span><span class="o">)</span> <span class="o">(</span><span class="n">h'</span> <span class="o">:</span> <span class="n">c'</span> <span class="bp">≤</span> <span class="n">c''</span><span class="o">)</span> <span class="o">:</span> <span class="n">c</span> <span class="bp">≤</span> <span class="n">c''</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="n">rw</span> <span class="bp">←</span> <span class="n">nnreal.coe_le_coe</span> <span class="n">at</span> <span class="bp">*</span><span class="o">,</span>
  <span class="n">linarith</span><span class="o">,</span>
<span class="kd">end</span>

<span class="kd">lemma</span> <span class="n">stupid_one</span> <span class="o">{</span><span class="n">c</span> <span class="n">k</span> <span class="o">:</span> <span class="n">ℝ</span><span class="bp">≥</span><span class="mi">0</span><span class="o">}</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="mi">1</span> <span class="bp">≤</span> <span class="n">k</span><span class="o">)</span> <span class="o">:</span> <span class="n">c</span> <span class="bp">≤</span> <span class="n">k</span><span class="bp">*</span><span class="n">c</span><span class="o">:=</span>
<span class="kd">begin</span>
  <span class="n">conv_lhs</span> <span class="o">{</span> <span class="n">rw</span> <span class="bp">←</span> <span class="n">one_mul</span> <span class="n">c</span> <span class="o">},</span>
  <span class="n">exact</span> <span class="n">mul_le_mul_right'</span> <span class="n">h</span> <span class="n">c</span>
<span class="kd">end</span>

<span class="kd">lemma</span> <span class="n">stupid_two</span> <span class="o">{</span><span class="n">c</span> <span class="n">k</span> <span class="o">:</span> <span class="n">ℝ</span><span class="bp">≥</span><span class="mi">0</span><span class="o">}</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="mi">1</span> <span class="bp">≤</span> <span class="n">k</span><span class="o">)</span> <span class="o">:</span> <span class="n">c</span> <span class="bp">≤</span> <span class="n">k</span><span class="bp">^</span><span class="mi">2</span><span class="bp">*</span><span class="n">c</span><span class="o">:=</span>
<span class="kd">begin</span>
  <span class="n">rw</span> <span class="o">[</span><span class="n">pow_two</span><span class="o">,</span> <span class="n">mul_assoc</span><span class="o">],</span>
  <span class="k">have</span> <span class="o">:</span> <span class="n">c</span> <span class="bp">≤</span> <span class="n">k</span><span class="bp">*</span><span class="n">c</span> <span class="o">:=</span> <span class="n">stupid_one</span> <span class="n">h</span><span class="o">,</span>
  <span class="n">conv_lhs</span> <span class="o">{</span> <span class="n">rw</span> <span class="bp">←</span> <span class="n">one_mul</span> <span class="n">c</span> <span class="o">},</span>
  <span class="n">apply</span> <span class="n">mul_le_mul</span> <span class="bp">;</span> <span class="n">try</span> <span class="o">{</span> <span class="n">assumption</span> <span class="o">}</span> <span class="bp">;</span> <span class="n">exact</span> <span class="n">nnreal.zero_le_coe</span>
<span class="kd">end</span>

<span class="kd">lemma</span> <span class="n">stupid_three</span> <span class="o">{</span><span class="n">c</span> <span class="n">k</span> <span class="o">:</span> <span class="n">ℝ</span><span class="bp">≥</span><span class="mi">0</span><span class="o">}</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="mi">1</span> <span class="bp">≤</span> <span class="n">k</span><span class="o">)</span> <span class="o">:</span> <span class="n">k</span><span class="bp">*</span><span class="n">c</span> <span class="bp">≤</span> <span class="n">k</span><span class="bp">^</span><span class="mi">2</span><span class="bp">*</span><span class="n">c</span><span class="o">:=</span>
<span class="kd">begin</span>
  <span class="n">rw</span> <span class="o">[</span><span class="n">pow_two</span><span class="o">,</span> <span class="n">mul_assoc</span><span class="o">],</span>
  <span class="n">exact</span> <span class="n">stupid_one</span> <span class="n">h</span><span class="o">,</span>
<span class="kd">end</span>

<span class="kd">meta</span> <span class="kd">def</span> <span class="n">magic</span> <span class="o">:</span> <span class="n">tactic</span> <span class="n">unit</span> <span class="o">:=</span>
<span class="k">do</span> <span class="o">(</span><span class="n">assumption</span> <span class="bp">&lt;|&gt;</span>
   <span class="bp">`</span><span class="o">[</span><span class="n">rw</span> <span class="bp">←</span> <span class="n">nnreal.coe_le_coe</span> <span class="n">at</span> <span class="bp">*</span><span class="o">,</span> <span class="n">linarith</span><span class="o">])</span> <span class="bp">&lt;|&gt;</span>
   <span class="bp">`</span><span class="o">[</span><span class="n">simp</span> <span class="o">[</span><span class="n">stupid_one</span><span class="o">,</span> <span class="n">stupid_two</span><span class="o">,</span> <span class="n">stupid_three</span><span class="o">,</span> <span class="bp">*</span><span class="o">]]</span> <span class="bp">&lt;|&gt;</span>
   <span class="n">target</span> <span class="bp">&gt;&gt;=</span> <span class="n">trace</span>

<span class="kd">end</span>

<span class="kd">def</span> <span class="n">res</span> <span class="o">{</span><span class="n">C</span> <span class="o">:</span> <span class="n">mock_complex</span><span class="o">}</span> <span class="o">{</span><span class="n">c</span> <span class="n">c'</span> <span class="o">:</span> <span class="n">ℝ</span><span class="bp">≥</span><span class="mi">0</span><span class="o">}</span> <span class="o">{</span><span class="n">i</span> <span class="o">:</span> <span class="n">ℤ</span><span class="o">}</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="n">C</span> <span class="n">c'</span> <span class="n">i</span><span class="o">)</span> <span class="o">(</span><span class="n">hc</span> <span class="o">:</span> <span class="n">c</span> <span class="bp">≤</span> <span class="n">c'</span> <span class="bp">.</span> <span class="n">magic</span><span class="o">)</span> <span class="o">:</span> <span class="n">C</span> <span class="n">c</span> <span class="n">i</span> <span class="o">:=</span>
<span class="n">C.restriction</span> <span class="n">c'</span> <span class="n">c</span> <span class="n">i</span> <span class="n">hc</span> <span class="n">x</span>

<span class="kd">def</span> <span class="n">res'</span> <span class="o">{</span><span class="n">C</span> <span class="o">:</span> <span class="n">mock_complex</span><span class="o">}</span> <span class="o">(</span><span class="n">c</span> <span class="o">:</span> <span class="n">ℝ</span><span class="bp">≥</span><span class="mi">0</span><span class="o">)</span> <span class="o">{</span><span class="n">c'</span> <span class="o">:</span> <span class="n">ℝ</span><span class="bp">≥</span><span class="mi">0</span><span class="o">}</span> <span class="o">{</span><span class="n">i</span> <span class="o">:</span> <span class="n">ℤ</span><span class="o">}</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="n">C</span> <span class="n">c'</span> <span class="n">i</span><span class="o">)</span> <span class="o">(</span><span class="n">hc</span> <span class="o">:</span> <span class="n">c</span> <span class="bp">≤</span> <span class="n">c'</span> <span class="bp">.</span> <span class="n">magic</span><span class="o">)</span> <span class="o">:</span> <span class="n">C</span> <span class="n">c</span> <span class="n">i</span> <span class="o">:=</span>
<span class="n">C.restriction</span> <span class="n">c'</span> <span class="n">c</span> <span class="n">i</span> <span class="n">hc</span> <span class="n">x</span>

<span class="kd">def</span> <span class="n">res''</span> <span class="o">{</span><span class="n">C</span> <span class="o">:</span> <span class="n">mock_complex</span><span class="o">}</span> <span class="o">(</span><span class="n">c</span> <span class="n">c'</span> <span class="o">:</span> <span class="n">ℝ</span><span class="bp">≥</span><span class="mi">0</span><span class="o">)</span> <span class="o">{</span><span class="n">i</span> <span class="o">:</span> <span class="n">ℤ</span><span class="o">}</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="n">C</span> <span class="n">c'</span> <span class="n">i</span><span class="o">)</span> <span class="o">(</span><span class="n">hc</span> <span class="o">:</span> <span class="n">c</span> <span class="bp">≤</span> <span class="n">c'</span> <span class="bp">.</span> <span class="n">magic</span><span class="o">)</span> <span class="o">:</span> <span class="n">C</span> <span class="n">c</span> <span class="n">i</span> <span class="o">:=</span>
<span class="n">C.restriction</span> <span class="n">c'</span> <span class="n">c</span> <span class="n">i</span> <span class="n">hc</span> <span class="n">x</span>

<span class="kd">def</span> <span class="n">d</span> <span class="o">{</span><span class="n">C</span> <span class="o">:</span> <span class="n">mock_complex</span><span class="o">}</span> <span class="o">{</span><span class="n">c</span> <span class="o">:</span> <span class="n">ℝ</span><span class="bp">≥</span><span class="mi">0</span><span class="o">}</span> <span class="o">{</span><span class="n">i</span> <span class="o">:</span> <span class="n">ℤ</span><span class="o">}</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="n">C</span> <span class="n">c</span> <span class="n">i</span><span class="o">)</span> <span class="o">:</span> <span class="n">C</span> <span class="n">c</span> <span class="o">(</span><span class="n">i</span><span class="bp">+</span><span class="mi">1</span><span class="o">)</span> <span class="o">:=</span>
<span class="n">C.differential</span> <span class="n">c</span> <span class="n">i</span> <span class="n">x</span>

<span class="kd">lemma</span> <span class="n">d_res</span> <span class="o">{</span><span class="n">C</span> <span class="o">:</span> <span class="n">mock_complex</span><span class="o">}</span> <span class="o">{</span><span class="n">c</span> <span class="n">c'</span> <span class="o">:</span> <span class="n">ℝ</span><span class="bp">≥</span><span class="mi">0</span><span class="o">}</span> <span class="o">{</span><span class="n">i</span> <span class="o">:</span> <span class="n">ℤ</span><span class="o">}</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="n">C</span> <span class="n">c'</span> <span class="n">i</span><span class="o">)</span> <span class="o">(</span><span class="n">hc</span> <span class="o">:</span> <span class="n">c</span> <span class="bp">≤</span> <span class="n">c'</span><span class="o">)</span> <span class="o">:</span>
  <span class="n">d</span> <span class="o">(</span><span class="n">res</span> <span class="n">x</span><span class="o">)</span> <span class="bp">=</span> <span class="n">res</span> <span class="o">(</span><span class="n">d</span> <span class="n">x</span><span class="o">)</span> <span class="o">:=</span>
<span class="kd">by</span> <span class="n">apply</span> <span class="n">C.commute</span>

<span class="kd">lemma</span> <span class="n">res_res</span> <span class="o">{</span><span class="n">C</span> <span class="o">:</span> <span class="n">mock_complex</span><span class="o">}</span> <span class="o">{</span><span class="n">c</span> <span class="n">c'</span> <span class="n">c''</span> <span class="o">:</span> <span class="n">ℝ</span><span class="bp">≥</span><span class="mi">0</span><span class="o">}</span> <span class="o">{</span><span class="n">i</span> <span class="o">:</span> <span class="n">ℤ</span><span class="o">}</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="n">C</span> <span class="n">c''</span> <span class="n">i</span><span class="o">)</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="n">c</span> <span class="bp">≤</span> <span class="n">c'</span><span class="o">)</span> <span class="o">(</span><span class="n">h'</span> <span class="o">:</span> <span class="n">c'</span> <span class="bp">≤</span> <span class="n">c''</span><span class="o">)</span> <span class="o">:</span>
  <span class="n">res</span> <span class="o">(</span><span class="n">res</span>  <span class="n">x</span><span class="o">)</span> <span class="bp">=</span> <span class="n">res</span> <span class="n">x</span> <span class="o">:=</span>
<span class="kd">by</span> <span class="n">apply</span> <span class="n">C.restriction_func</span>

<span class="kd">lemma</span> <span class="n">res_res_mul</span> <span class="o">{</span><span class="n">C</span> <span class="o">:</span> <span class="n">mock_complex</span><span class="o">}</span> <span class="o">{</span><span class="n">c</span> <span class="n">k</span> <span class="o">:</span> <span class="n">ℝ</span><span class="bp">≥</span><span class="mi">0</span><span class="o">}</span> <span class="o">{</span><span class="n">i</span> <span class="o">:</span> <span class="n">ℤ</span><span class="o">}</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="n">C</span> <span class="o">(</span><span class="n">k</span><span class="bp">^</span><span class="mi">2</span><span class="bp">*</span><span class="n">c</span><span class="o">)</span> <span class="n">i</span><span class="o">)</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="mi">1</span> <span class="bp">≤</span> <span class="n">k</span><span class="o">)</span> <span class="o">:</span>
  <span class="n">res''</span> <span class="n">c</span> <span class="o">(</span><span class="n">k</span> <span class="bp">*</span> <span class="n">c</span><span class="o">)</span> <span class="o">(</span><span class="n">res</span> <span class="n">x</span><span class="o">)</span> <span class="bp">=</span> <span class="n">res</span> <span class="n">x</span> <span class="o">:=</span>
<span class="kd">by</span> <span class="n">apply</span> <span class="n">C.restriction_func</span>
</code></pre></div>



<a name="225579942"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/bounded%20exactness/near/225579942" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html#225579942">(Feb 08 2021 at 17:37)</a>:</h4>
<p>But of course the user should know that <code>res'</code> and <code>res''</code> are just <code>res</code> with more variables being made explicit.</p>



<a name="225580023"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/bounded%20exactness/near/225580023" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html#225580023">(Feb 08 2021 at 17:37)</a>:</h4>
<p>I tried using <code>res'</code> for the last lemma as well, but I (obviously...) ran into the same metavariable issue that <span class="user-mention" data-user-id="110031">@Patrick Massot</span> mentioned.</p>



<a name="225580333"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/bounded%20exactness/near/225580333" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html#225580333">(Feb 08 2021 at 17:39)</a>:</h4>
<p>Yes, this issue is independent of what variables are made explicit. On paper Peter explicits both c and c'. In Lean it would be fair to explicit the one that cannot be inferred by looking at the type of x. But we could also put type annotations when needed. This is orthogonal to the issue at hand.</p>



<a name="225599366"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/bounded%20exactness/near/225599366" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Peter Scholze <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html#225599366">(Feb 08 2021 at 20:01)</a>:</h4>
<p>Is it possible to explain (to a layperson like me) why <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi><mo>−</mo><mn>1</mn><mo>+</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">i-1+1</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.74285em;vertical-align:-0.08333em;"></span><span class="mord mathnormal">i</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span> causes such problems? Would <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi><mo>+</mo><mn>1</mn><mo>+</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">i+1+1</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.74285em;vertical-align:-0.08333em;"></span><span class="mord mathnormal">i</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span> vs. <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi><mo>+</mo><mn>2</mn></mrow><annotation encoding="application/x-tex">i+2</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.74285em;vertical-align:-0.08333em;"></span><span class="mord mathnormal">i</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">2</span></span></span></span> also cause such issues?</p>



<a name="225600715"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/bounded%20exactness/near/225600715" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html#225600715">(Feb 08 2021 at 20:12)</a>:</h4>
<p>The issue is that we're working with dependent types <code>C i</code> which depend on <code>i</code>. We then have some term <code>x : C i</code>, and we want to view it as a term of type <code>C (i-1+1)</code>. But <code>i-1+1</code> is not definitionally equal to <code>i</code>, so <code>C i</code> and <code>C (i-1+1)</code> are not "the same" by definition. You can do what essentially amounts to rewriting along the equality <code>i - 1 + 1 = i</code>, but then you have to carry around the fact that you did this rewriting and it gets messy and annoying very quickly.</p>



<a name="225600756"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/bounded%20exactness/near/225600756" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html#225600756">(Feb 08 2021 at 20:12)</a>:</h4>
<p>At least for nat, <code>i+1+1</code> is defeq to <code>i+2</code> so you are okay there</p>



<a name="225600769"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/bounded%20exactness/near/225600769" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html#225600769">(Feb 08 2021 at 20:12)</a>:</h4>
<p>That's not the case for integers, is it?</p>



<a name="225600774"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/bounded%20exactness/near/225600774" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html#225600774">(Feb 08 2021 at 20:12)</a>:</h4>
<p>(It's true for nat)</p>



<a name="225600812"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/bounded%20exactness/near/225600812" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html#225600812">(Feb 08 2021 at 20:13)</a>:</h4>
<p>I think the associativity part might cause a problem over int</p>



<a name="225600849"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/bounded%20exactness/near/225600849" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Peter Scholze <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html#225600849">(Feb 08 2021 at 20:13)</a>:</h4>
<p>But I guess <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn><mo>+</mo><mi>i</mi></mrow><annotation encoding="application/x-tex">1+i</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.65952em;vertical-align:0em;"></span><span class="mord mathnormal">i</span></span></span></span> and <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi><mo>+</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">i+1</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.74285em;vertical-align:-0.08333em;"></span><span class="mord mathnormal">i</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span> are not "defeq", even in nat?</p>



<a name="225600857"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/bounded%20exactness/near/225600857" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html#225600857">(Feb 08 2021 at 20:13)</a>:</h4>
<p>Right:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">example</span> <span class="o">{</span><span class="n">i</span> <span class="o">:</span> <span class="n">ℤ</span><span class="o">}</span> <span class="o">:</span> <span class="n">i</span> <span class="bp">+</span> <span class="mi">2</span> <span class="bp">=</span> <span class="n">i</span> <span class="bp">+</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)</span> <span class="o">:=</span> <span class="n">rfl</span> <span class="c1">-- works</span>
<span class="kd">example</span> <span class="o">{</span><span class="n">i</span> <span class="o">:</span> <span class="n">ℤ</span><span class="o">}</span> <span class="o">:</span> <span class="n">i</span> <span class="bp">+</span> <span class="mi">2</span> <span class="bp">=</span> <span class="n">i</span> <span class="bp">+</span> <span class="mi">1</span> <span class="bp">+</span> <span class="mi">1</span> <span class="o">:=</span> <span class="n">rfl</span> <span class="c1">-- fails</span>
</code></pre></div>



<a name="225600933"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/bounded%20exactness/near/225600933" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html#225600933">(Feb 08 2021 at 20:14)</a>:</h4>
<p>no, defeq doesn't have most equalities you would want</p>



<a name="225600985"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/bounded%20exactness/near/225600985" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html#225600985">(Feb 08 2021 at 20:14)</a>:</h4>
<p>so it's best practice to structure things such that you don't need to rely on what is and isn't defeq</p>



<a name="225601188"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/bounded%20exactness/near/225601188" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Peter Scholze <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html#225601188">(Feb 08 2021 at 20:16)</a>:</h4>
<p>but this certainly sounds like the kind of thing that ought to be automatable (is that a word?). What is the problem with writing a tactic taking care of such issues?</p>



<a name="225601226"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/bounded%20exactness/near/225601226" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html#225601226">(Feb 08 2021 at 20:17)</a>:</h4>
<p>That's more-or-less what <span class="user-mention" data-user-id="110031">@Patrick Massot</span>  and <span class="user-mention" data-user-id="112680">@Johan Commelin</span> were trying to do in the code above.</p>



<a name="225601254"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/bounded%20exactness/near/225601254" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html#225601254">(Feb 08 2021 at 20:17)</a>:</h4>
<p>For me the problem is that I'm still not good enough at writing robust tactics <span aria-label="see no evil" class="emoji emoji-1f648" role="img" title="see no evil">:see_no_evil:</span></p>



<a name="225601346"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/bounded%20exactness/near/225601346" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Peter Scholze <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html#225601346">(Feb 08 2021 at 20:18)</a>:</h4>
<p>OK, but it should be standard practice to have a dependent type over integers, and this issue should always come up then, it seems? So I would have expected that's the kind of thing somebody has already written a tactic for</p>



<a name="225601386"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/bounded%20exactness/near/225601386" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html#225601386">(Feb 08 2021 at 20:18)</a>:</h4>
<p>But once we (Patrick, Adam, me) can write down a precise description of what the tactic should do, then there are enough people around here that can help us out</p>



<a name="225601502"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/bounded%20exactness/near/225601502" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html#225601502">(Feb 08 2021 at 20:19)</a>:</h4>
<p>Unfortunately it isn't there yet. We regularly consider things like <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi mathvariant="double-struck">R</mi><mi>n</mi></msup></mrow><annotation encoding="application/x-tex">\R^n</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.68889em;vertical-align:0em;"></span><span class="mord"><span class="mord"><span class="mord mathbb">R</span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.664392em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span></span></span></span></span></span></span>, where in principle the same problem occurs. But usually there are "easy" solutions.</p>



<a name="225601528"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/bounded%20exactness/near/225601528" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html#225601528">(Feb 08 2021 at 20:19)</a>:</h4>
<p>I think homological algebra is the first place where this bites you hard.</p>



<a name="225601558"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/bounded%20exactness/near/225601558" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Peter Scholze <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html#225601558">(Feb 08 2021 at 20:19)</a>:</h4>
<p>Aha, I see!</p>



<a name="225601601"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/bounded%20exactness/near/225601601" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html#225601601">(Feb 08 2021 at 20:19)</a>:</h4>
<p>And we've done a little bit of homological algebra before. But nothing as serious as chasing elements through complexes of normed groups.</p>



<a name="225601712"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/bounded%20exactness/near/225601712" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html#225601712">(Feb 08 2021 at 20:20)</a>:</h4>
<p>Part of the issue is that even with the best tactics you can't hide this from the user, once you have a dependent type over integers the issues already become apparent, and a tactic can't actually make things defeq in order to make the desired statements typecheck</p>



<a name="225601729"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/bounded%20exactness/near/225601729" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Peter Scholze <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html#225601729">(Feb 08 2021 at 20:20)</a>:</h4>
<p>I know, that's serious business! <span aria-label="stuck out tongue" class="emoji emoji-1f61b" role="img" title="stuck out tongue">:stuck_out_tongue:</span></p>



<a name="225601800"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/bounded%20exactness/near/225601800" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html#225601800">(Feb 08 2021 at 20:21)</a>:</h4>
<p><span class="user-mention" data-user-id="110049">@Mario Carneiro</span> Is that really true? I think there must be ways to make it almost transparent.</p>



<a name="225601865"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/bounded%20exactness/near/225601865" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html#225601865">(Feb 08 2021 at 20:21)</a>:</h4>
<p>What we need is a sort of <code>renormalize</code> tactic, that will put all the indices in some normal form.</p>



<a name="225601890"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/bounded%20exactness/near/225601890" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html#225601890">(Feb 08 2021 at 20:21)</a>:</h4>
<p>You have to insert a cast to apply a non-definitional equality, and the user has to see and manipulate this</p>



<a name="225601994"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/bounded%20exactness/near/225601994" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html#225601994">(Feb 08 2021 at 20:22)</a>:</h4>
<p>So <code>x : C (k * c) (i - 1 + 1)</code> gets replaced with <code>x : C (k * c) i</code></p>



<a name="225602008"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/bounded%20exactness/near/225602008" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html#225602008">(Feb 08 2021 at 20:22)</a>:</h4>
<p>maybe if the tactic pulled everything back into a nondependent type this could be made more ergonomic</p>



<a name="225602021"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/bounded%20exactness/near/225602021" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html#225602021">(Feb 08 2021 at 20:22)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110049">Mario Carneiro</span> <a href="#narrow/stream/267928-condensed-mathematics/topic/bounded.20exactness/near/225601890">said</a>:</p>
<blockquote>
<p>You have to insert a cast to apply a non-definitional equality, and the user has to see and manipulate this</p>
</blockquote>
<p>No, I claim that we can hide this behind an api.</p>



<a name="225602029"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/bounded%20exactness/near/225602029" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html#225602029">(Feb 08 2021 at 20:22)</a>:</h4>
<p>aka "<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">Σ</mi></mrow><annotation encoding="application/x-tex">\Sigma</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord">Σ</span></span></span></span> = <span aria-label="rainbow" class="emoji emoji-1f308" role="img" title="rainbow">:rainbow:</span> "</p>



<a name="225602169"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/bounded%20exactness/near/225602169" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html#225602169">(Feb 08 2021 at 20:23)</a>:</h4>
<p>I'm still not there yet on what exactly the automation task is that a hypothetical <code>renormalize</code> tactic would do</p>



<a name="225602186"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/bounded%20exactness/near/225602186" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html#225602186">(Feb 08 2021 at 20:24)</a>:</h4>
<p>Here's a final part of a goal (I've turned on all implicit arguments):</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">hy</span> <span class="o">:</span>
  <span class="bp">∥⇑</span><span class="o">(</span><span class="bp">@</span><span class="n">res</span> <span class="n">C</span> <span class="o">(</span><span class="n">k</span> <span class="bp">*</span> <span class="n">c</span><span class="o">)</span> <span class="n">c</span> <span class="o">(</span><span class="n">i</span> <span class="bp">-</span> <span class="mi">1</span> <span class="bp">+</span> <span class="mi">1</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)</span> <span class="n">_</span><span class="o">)</span> <span class="o">(</span><span class="bp">@</span><span class="n">congr</span> <span class="n">C</span> <span class="o">(</span><span class="n">k</span> <span class="bp">*</span> <span class="n">c</span><span class="o">)</span> <span class="o">(</span><span class="n">k</span> <span class="bp">*</span> <span class="n">c</span><span class="o">)</span> <span class="o">(</span><span class="n">i</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)</span> <span class="o">(</span><span class="n">i</span> <span class="bp">-</span> <span class="mi">1</span> <span class="bp">+</span> <span class="mi">1</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)</span> <span class="n">x</span> <span class="n">_</span> <span class="n">_</span><span class="o">)</span> <span class="bp">-</span>
        <span class="bp">⇑</span><span class="o">(</span><span class="bp">@</span><span class="n">d</span> <span class="n">C</span> <span class="n">c</span> <span class="o">(</span><span class="n">i</span> <span class="bp">-</span> <span class="mi">1</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)</span> <span class="o">(</span><span class="n">i</span> <span class="bp">-</span> <span class="mi">1</span> <span class="bp">+</span> <span class="mi">1</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)</span> <span class="n">_</span><span class="o">)</span> <span class="n">y</span><span class="bp">∥</span> <span class="bp">≤</span>
    <span class="bp">↑</span><span class="n">K</span> <span class="bp">*</span> <span class="bp">∥⇑</span><span class="o">(</span><span class="bp">@</span><span class="n">d</span> <span class="n">C</span> <span class="o">(</span><span class="n">k</span> <span class="bp">*</span> <span class="n">c</span><span class="o">)</span> <span class="o">(</span><span class="n">i</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)</span> <span class="o">(</span><span class="n">i</span> <span class="bp">-</span> <span class="mi">1</span> <span class="bp">+</span> <span class="mi">1</span> <span class="bp">+</span> <span class="mi">1</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)</span> <span class="n">_</span><span class="o">)</span> <span class="n">x</span><span class="bp">∥</span>
<span class="bp">⊢</span> <span class="bp">∥⇑</span><span class="o">(</span><span class="bp">@</span><span class="n">res</span> <span class="n">C</span> <span class="o">(</span><span class="n">k</span> <span class="bp">*</span> <span class="n">c</span><span class="o">)</span> <span class="n">c</span> <span class="o">(</span><span class="n">i</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)</span> <span class="n">_</span><span class="o">)</span> <span class="n">x</span> <span class="bp">-</span> <span class="bp">⇑</span><span class="o">(</span><span class="bp">@</span><span class="n">d</span> <span class="n">C</span> <span class="n">c</span> <span class="o">(</span><span class="n">i</span> <span class="bp">-</span> <span class="mi">1</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)</span> <span class="o">(</span><span class="n">i</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)</span> <span class="n">_</span><span class="o">)</span> <span class="n">y</span><span class="bp">∥</span> <span class="bp">≤</span>
    <span class="bp">↑</span><span class="n">K</span> <span class="bp">*</span> <span class="bp">∥⇑</span><span class="o">(</span><span class="bp">@</span><span class="n">d</span> <span class="n">C</span> <span class="o">(</span><span class="n">k</span> <span class="bp">*</span> <span class="n">c</span><span class="o">)</span> <span class="o">(</span><span class="n">i</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)</span> <span class="o">(</span><span class="n">i</span> <span class="bp">+</span> <span class="mi">1</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)</span> <span class="n">_</span><span class="o">)</span> <span class="n">x</span><span class="bp">∥</span>
</code></pre></div>



<a name="225602328"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/bounded%20exactness/near/225602328" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html#225602328">(Feb 08 2021 at 20:24)</a>:</h4>
<p>what are the types of <code>res</code>, <code>d</code> and <code>congr</code></p>



<a name="225602450"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/bounded%20exactness/near/225602450" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html#225602450">(Feb 08 2021 at 20:25)</a>:</h4>
<p>But until that point, everything is taken care of by an api.</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">def</span> <span class="n">congr</span> <span class="o">{</span><span class="n">C</span> <span class="o">:</span> <span class="n">system_of_complexes</span><span class="o">}</span> <span class="o">{</span><span class="n">c</span> <span class="n">c'</span> <span class="o">:</span> <span class="n">ℝ</span><span class="bp">≥</span><span class="mi">0</span><span class="o">}</span> <span class="o">{</span><span class="n">i</span> <span class="n">i'</span> <span class="o">:</span> <span class="n">ℤ</span><span class="o">}</span>
  <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="n">C</span> <span class="n">c</span> <span class="n">i</span><span class="o">)</span> <span class="o">(</span><span class="n">hc</span> <span class="o">:</span> <span class="n">c</span> <span class="bp">=</span> <span class="n">c'</span> <span class="bp">.</span> <span class="n">magic</span><span class="o">)</span> <span class="o">(</span><span class="n">hi</span> <span class="o">:</span> <span class="n">i</span> <span class="bp">=</span> <span class="n">i'</span> <span class="bp">.</span> <span class="n">magic'</span><span class="o">)</span> <span class="o">:</span>
  <span class="n">C</span> <span class="n">c'</span> <span class="n">i'</span> <span class="o">:=</span>
<span class="n">congr_hom</span> <span class="n">_</span> <span class="n">hc</span> <span class="n">hi</span> <span class="n">x</span>

<span class="sd">/-- `C.d` is the differential `C c i ⟶ C c (i+1)` for a system of complexes `C`. -/</span>
<span class="kd">def</span> <span class="n">d</span> <span class="o">{</span><span class="n">C</span> <span class="o">:</span> <span class="n">system_of_complexes</span><span class="o">}</span> <span class="o">{</span><span class="n">c</span> <span class="o">:</span> <span class="n">ℝ</span><span class="bp">≥</span><span class="mi">0</span><span class="o">}</span> <span class="o">{</span><span class="n">i</span> <span class="n">j</span> <span class="o">:</span> <span class="n">ℤ</span><span class="o">}</span> <span class="o">[</span><span class="n">hj</span> <span class="o">:</span> <span class="n">fact</span> <span class="o">(</span><span class="n">j</span> <span class="bp">=</span> <span class="n">i</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)]</span> <span class="o">:</span>
  <span class="n">C</span> <span class="n">c</span> <span class="n">i</span> <span class="bp">⟶</span> <span class="n">C</span> <span class="n">c</span> <span class="n">j</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">C.obj</span> <span class="bp">$</span> <span class="n">op</span> <span class="n">c</span><span class="o">)</span><span class="bp">.</span><span class="n">d</span> <span class="n">i</span> <span class="bp">≫</span> <span class="n">congr_hom</span> <span class="n">_</span> <span class="n">rfl</span> <span class="n">hj.symm</span>

<span class="kd">def</span> <span class="n">res</span> <span class="o">{</span><span class="n">C</span> <span class="o">:</span> <span class="n">system_of_complexes</span><span class="o">}</span> <span class="o">{</span><span class="n">c'</span> <span class="n">c</span> <span class="o">:</span> <span class="n">ℝ</span><span class="bp">≥</span><span class="mi">0</span><span class="o">}</span> <span class="o">{</span><span class="n">i</span> <span class="o">:</span> <span class="n">ℤ</span><span class="o">}</span> <span class="o">[</span><span class="n">h</span> <span class="o">:</span> <span class="n">fact</span> <span class="o">(</span><span class="n">c</span> <span class="bp">≤</span> <span class="n">c'</span><span class="o">)]</span> <span class="o">:</span>
  <span class="n">C</span> <span class="n">c'</span> <span class="n">i</span> <span class="bp">⟶</span> <span class="n">C</span> <span class="n">c</span> <span class="n">i</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">C.map</span> <span class="o">(</span><span class="n">hom_of_le</span> <span class="n">h</span><span class="o">)</span><span class="bp">.</span><span class="n">op</span><span class="o">)</span><span class="bp">.</span><span class="n">f</span> <span class="n">i</span>
</code></pre></div>



<a name="225602584"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/bounded%20exactness/near/225602584" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html#225602584">(Feb 08 2021 at 20:26)</a>:</h4>
<p>This means that in statements like</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">def</span> <span class="n">is_bdd_exact_for_bdd_degree_above_idx</span>
  <span class="o">(</span><span class="n">k</span> <span class="n">K</span> <span class="o">:</span> <span class="n">ℝ</span><span class="bp">≥</span><span class="mi">0</span><span class="o">)</span> <span class="o">(</span><span class="n">m</span> <span class="o">:</span> <span class="n">ℤ</span><span class="o">)</span> <span class="o">[</span><span class="n">hk</span> <span class="o">:</span> <span class="n">fact</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">≤</span> <span class="n">k</span><span class="o">)]</span> <span class="o">(</span><span class="n">c₀</span> <span class="o">:</span> <span class="n">ℝ</span><span class="bp">≥</span><span class="mi">0</span><span class="o">)</span> <span class="o">:</span> <span class="kt">Prop</span> <span class="o">:=</span>
<span class="bp">∀</span> <span class="n">c</span> <span class="bp">≥</span> <span class="n">c₀</span><span class="o">,</span> <span class="bp">∀</span> <span class="n">i</span> <span class="bp">&lt;</span> <span class="n">m</span><span class="o">,</span>
<span class="bp">∀</span> <span class="n">x</span> <span class="o">:</span> <span class="n">C</span> <span class="o">(</span><span class="n">k</span> <span class="bp">*</span> <span class="n">c</span><span class="o">)</span> <span class="o">(</span><span class="n">i</span><span class="bp">+</span><span class="mi">1</span><span class="o">),</span>
<span class="bp">∃</span> <span class="n">y</span> <span class="o">:</span> <span class="n">C</span> <span class="n">c</span> <span class="n">i</span><span class="o">,</span> <span class="bp">∥</span><span class="n">res</span> <span class="n">x</span> <span class="bp">-</span> <span class="n">d</span> <span class="n">y</span><span class="bp">∥</span> <span class="bp">≤</span> <span class="n">K</span> <span class="bp">*</span> <span class="bp">∥</span><span class="o">(</span><span class="n">d</span> <span class="n">x</span> <span class="o">:</span> <span class="n">C</span> <span class="n">_</span> <span class="o">(</span><span class="n">i</span><span class="bp">+</span><span class="mi">1</span><span class="bp">+</span><span class="mi">1</span><span class="o">))</span><span class="bp">∥</span>
</code></pre></div>
<p>The <code>res x</code> and <code>d y</code> help each other to figure out the indices.</p>



<a name="225602701"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/bounded%20exactness/near/225602701" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html#225602701">(Feb 08 2021 at 20:27)</a>:</h4>
<p>Probably, with the Lean4 elaborator, we could make things even better. But Lean4 doesn't have mathlib <span aria-label="sad" class="emoji emoji-2639" role="img" title="sad">:sad:</span>  So we can't transition to that before summer.</p>



<a name="225602762"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/bounded%20exactness/near/225602762" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html#225602762">(Feb 08 2021 at 20:27)</a>:</h4>
<p>Okay, these look good; but then why is <code>i-1+1+1</code> an index in your goal?</p>



<a name="225602878"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/bounded%20exactness/near/225602878" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html#225602878">(Feb 08 2021 at 20:28)</a>:</h4>
<p>you mean in <code>hy</code>?</p>



<a name="225602883"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/bounded%20exactness/near/225602883" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html#225602883">(Feb 08 2021 at 20:28)</a>:</h4>
<p>yeah</p>



<a name="225602958"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/bounded%20exactness/near/225602958" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html#225602958">(Feb 08 2021 at 20:29)</a>:</h4>
<p>I would keep all indices in the <code>C c i</code> to natural things like <code>i+1</code>, <code>i</code>, <code>i-1</code> etc</p>



<a name="225602992"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/bounded%20exactness/near/225602992" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html#225602992">(Feb 08 2021 at 20:29)</a>:</h4>
<p><code>cases H c hc (i-1) (by linarith) (congr x rfl) with y hy,</code><br>
gives me<br>
<code>y : ↥(⇑C c (i - 1 + 1)),</code></p>



<a name="225603012"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/bounded%20exactness/near/225603012" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html#225603012">(Feb 08 2021 at 20:29)</a>:</h4>
<p>don't use <code>rfl</code></p>



<a name="225603057"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/bounded%20exactness/near/225603057" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html#225603057">(Feb 08 2021 at 20:29)</a>:</h4>
<p><code>congr x (_ : i-1+1+1=i+1)</code> or so</p>



<a name="225603132"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/bounded%20exactness/near/225603132" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html#225603132">(Feb 08 2021 at 20:30)</a>:</h4>
<p>nope, that <code>rfl</code> is taking care of <code>k * c = k * c</code>.</p>



<a name="225603178"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/bounded%20exactness/near/225603178" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html#225603178">(Feb 08 2021 at 20:30)</a>:</h4>
<p>I don't know why the auto_param doesn't kick in. The elaboration order isn't optimal there.</p>



<a name="225603217"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/bounded%20exactness/near/225603217" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html#225603217">(Feb 08 2021 at 20:31)</a>:</h4>
<p>But I guess your point is that we should help lean with the second auto_param anyway.</p>



<a name="225603233"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/bounded%20exactness/near/225603233" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html#225603233">(Feb 08 2021 at 20:31)</a>:</h4>
<p>There is a type ascription you could put on something, but not knowing the types of things it's hard to say exactly what</p>



<a name="225603307"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/bounded%20exactness/near/225603307" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html#225603307">(Feb 08 2021 at 20:31)</a>:</h4>
<p>Well... here is <code>H</code></p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">H</span> <span class="o">:</span>
  <span class="bp">∀</span> <span class="o">(</span><span class="n">c</span> <span class="o">:</span> <span class="n">ℝ</span><span class="bp">≥</span><span class="mi">0</span><span class="o">),</span>
    <span class="n">c</span> <span class="bp">≥</span> <span class="n">c₀</span> <span class="bp">→</span>
    <span class="bp">∀</span> <span class="o">(</span><span class="n">i</span> <span class="o">:</span> <span class="n">ℤ</span><span class="o">),</span>
      <span class="n">i</span> <span class="bp">&lt;</span> <span class="n">m</span> <span class="bp">-</span> <span class="mi">1</span> <span class="bp">→</span>
      <span class="bp">∀</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="bp">↥</span><span class="o">(</span><span class="bp">⇑</span><span class="n">C</span> <span class="o">(</span><span class="n">k</span> <span class="bp">*</span> <span class="n">c</span><span class="o">)</span> <span class="o">(</span><span class="n">i</span> <span class="bp">+</span> <span class="mi">1</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">))),</span>
        <span class="bp">∃</span> <span class="o">(</span><span class="n">y</span> <span class="o">:</span> <span class="bp">↥</span><span class="o">(</span><span class="bp">⇑</span><span class="n">C</span> <span class="n">c</span> <span class="o">(</span><span class="n">i</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">))),</span>
          <span class="bp">∥⇑</span><span class="o">(</span><span class="bp">@</span><span class="n">res</span> <span class="n">C</span> <span class="o">(</span><span class="n">k</span> <span class="bp">*</span> <span class="n">c</span><span class="o">)</span> <span class="n">c</span> <span class="o">(</span><span class="n">i</span> <span class="bp">+</span> <span class="mi">1</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)</span> <span class="n">_</span><span class="o">)</span> <span class="n">x</span> <span class="bp">-</span> <span class="bp">⇑</span><span class="o">(</span><span class="bp">@</span><span class="n">d</span> <span class="n">C</span> <span class="n">c</span> <span class="o">(</span><span class="n">i</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)</span> <span class="o">(</span><span class="n">i</span> <span class="bp">+</span> <span class="mi">1</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)</span> <span class="n">_</span><span class="o">)</span> <span class="n">y</span><span class="bp">∥</span> <span class="bp">≤</span>
            <span class="bp">↑</span><span class="n">K</span> <span class="bp">*</span> <span class="bp">∥⇑</span><span class="o">(</span><span class="bp">@</span><span class="n">d</span> <span class="n">C</span> <span class="o">(</span><span class="n">k</span> <span class="bp">*</span> <span class="n">c</span><span class="o">)</span> <span class="o">(</span><span class="n">i</span> <span class="bp">+</span> <span class="mi">1</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)</span> <span class="o">(</span><span class="n">i</span> <span class="bp">+</span> <span class="mi">1</span> <span class="bp">+</span> <span class="mi">1</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)</span> <span class="n">_</span><span class="o">)</span> <span class="n">x</span><span class="bp">∥</span><span class="o">,</span>
</code></pre></div>



<a name="225603410"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/bounded%20exactness/near/225603410" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html#225603410">(Feb 08 2021 at 20:32)</a>:</h4>
<p>And as you can see, it talks about <code>i + 1</code> in the type of <code>y</code>, but then we feed it <code>i - 1</code> as argument to <code>H</code></p>



<a name="225603432"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/bounded%20exactness/near/225603432" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html#225603432">(Feb 08 2021 at 20:32)</a>:</h4>
<p>So you are bound to get a <code>y : C _ (i - 1 + 1)</code></p>



<a name="225603434"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/bounded%20exactness/near/225603434" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html#225603434">(Feb 08 2021 at 20:32)</a>:</h4>
<p>Does the auto_param try to reduce <code>i+1+1</code> to <code>i+2</code> (without being told the term<code>i+2</code>)?</p>



<a name="225603479"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/bounded%20exactness/near/225603479" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html#225603479">(Feb 08 2021 at 20:33)</a>:</h4>
<p>That auto_param only tries <code>refl, assumption, ring</code> because I don't know how to do better</p>



<a name="225603584"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/bounded%20exactness/near/225603584" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html#225603584">(Feb 08 2021 at 20:33)</a>:</h4>
<p><code>simp</code> with lemmas like <code>i + a + b = i + (a + b)</code> and then norm_num might work</p>



<a name="225603613"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/bounded%20exactness/near/225603613" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html#225603613">(Feb 08 2021 at 20:34)</a>:</h4>
<p>at <code>y</code>?</p>



<a name="225603667"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/bounded%20exactness/near/225603667" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html#225603667">(Feb 08 2021 at 20:34)</a>:</h4>
<p>at everything</p>



<a name="225603782"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/bounded%20exactness/near/225603782" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html#225603782">(Feb 08 2021 at 20:35)</a>:</h4>
<p>I mean I guess it's fine to have these terms around for a little while but they should be cleaned up, either by a cleanup tactic that you call when things are getting out of hand or in the <code>magic</code> auto_params</p>



<a name="225603841"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/bounded%20exactness/near/225603841" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html#225603841">(Feb 08 2021 at 20:35)</a>:</h4>
<p>yes, so I think we need that cleanup tactic.</p>



<a name="225603973"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/bounded%20exactness/near/225603973" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html#225603973">(Feb 08 2021 at 20:36)</a>:</h4>
<p>Is this the kind of thing that you write in your lunch break?</p>



<a name="225603999"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/bounded%20exactness/near/225603999" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html#225603999">(Feb 08 2021 at 20:37)</a>:</h4>
<p>It is my lunch break <span aria-label="grinning face with smiling eyes" class="emoji emoji-1f601" role="img" title="grinning face with smiling eyes">:grinning_face_with_smiling_eyes:</span></p>



<a name="225604031"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/bounded%20exactness/near/225604031" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html#225604031">(Feb 08 2021 at 20:37)</a>:</h4>
<p>I pushed these experiments to <code>wip_dtt_d_magic</code> of the LTE repo</p>



<a name="225604043"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/bounded%20exactness/near/225604043" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html#225604043">(Feb 08 2021 at 20:37)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110049">Mario Carneiro</span> <a href="#narrow/stream/267928-condensed-mathematics/topic/bounded.20exactness/near/225603999">said</a>:</p>
<blockquote>
<p>It is my lunch break <span aria-label="grinning face with smiling eyes" class="emoji emoji-1f601" role="img" title="grinning face with smiling eyes">:grinning_face_with_smiling_eyes:</span></p>
</blockquote>
<p>I know, hence my question <span aria-label="laughing" class="emoji emoji-1f606" role="img" title="laughing">:laughing:</span></p>



<a name="225604084"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/bounded%20exactness/near/225604084" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html#225604084">(Feb 08 2021 at 20:37)</a>:</h4>
<p>I think that it's possible for a carefully crafted <code>rw</code> to simplify away all instances of <code>i+1+1</code> to <code>i+2</code> in <code>H</code></p>



<a name="225604165"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/bounded%20exactness/near/225604165" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html#225604165">(Feb 08 2021 at 20:38)</a>:</h4>
<p>But that's not the issue, right? Those are defeq anyway.</p>



<a name="225604191"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/bounded%20exactness/near/225604191" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html#225604191">(Feb 08 2021 at 20:38)</a>:</h4>
<p>no, this is <code>int</code></p>



<a name="225604234"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/bounded%20exactness/near/225604234" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html#225604234">(Feb 08 2021 at 20:38)</a>:</h4>
<p>We need a cleanup tactic that replaces <code>y : C _ (i - 1 + 1)</code> by <code>y : C _ i</code></p>



<a name="225604240"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/bounded%20exactness/near/225604240" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html#225604240">(Feb 08 2021 at 20:38)</a>:</h4>
<p>but that doesn't particularly matter, I can say the same about other int expressions</p>



<a name="225604314"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/bounded%20exactness/near/225604314" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html#225604314">(Feb 08 2021 at 20:39)</a>:</h4>
<p>but I'm talking specifically about <code>H</code>, where everything is still bound. Once you put it in your context with <code>cases</code> it gets harder</p>



<a name="225604361"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/bounded%20exactness/near/225604361" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html#225604361">(Feb 08 2021 at 20:39)</a>:</h4>
<p>Aha, I see. Well, I don't care about having all expressions be of the form <code>i-1-1-1</code> or <code>i +1+1+1+1+1</code></p>



<a name="225604392"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/bounded%20exactness/near/225604392" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html#225604392">(Feb 08 2021 at 20:39)</a>:</h4>
<p>As long as they are all in <em>some</em> normal form</p>



<a name="225604416"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/bounded%20exactness/near/225604416" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html#225604416">(Feb 08 2021 at 20:39)</a>:</h4>
<p>I was thinking more like <code>i+2</code>, <code>i+1</code>, <code>i</code>, <code>i-1</code></p>



<a name="225604478"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/bounded%20exactness/near/225604478" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html#225604478">(Feb 08 2021 at 20:40)</a>:</h4>
<p>sure, if that is easier (-;</p>



<a name="225604537"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/bounded%20exactness/near/225604537" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html#225604537">(Feb 08 2021 at 20:40)</a>:</h4>
<p>But what can you do in <code>H</code>, if it talks about <code>i + 1</code>, and then you feed it <code>i := i' - 1</code>.</p>



<a name="225604561"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/bounded%20exactness/near/225604561" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html#225604561">(Feb 08 2021 at 20:40)</a>:</h4>
<p>then you call the cleanup tactic on the result</p>



<a name="225604576"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/bounded%20exactness/near/225604576" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html#225604576">(Feb 08 2021 at 20:40)</a>:</h4>
<p>I think we need to work more on my baby version before getting Mario's help</p>



<a name="225604592"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/bounded%20exactness/near/225604592" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html#225604592">(Feb 08 2021 at 20:41)</a>:</h4>
<p>Aah, you mean I first specialize to <code>H (i' - 1)</code>, then clean up, then do <code>cases</code>?</p>



<a name="225604600"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/bounded%20exactness/near/225604600" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html#225604600">(Feb 08 2021 at 20:41)</a>:</h4>
<p>yes</p>



<a name="225604636"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/bounded%20exactness/near/225604636" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html#225604636">(Feb 08 2021 at 20:41)</a>:</h4>
<p>In particular that version doesn't depend on anything from the project (or even from the category theory part of mathlib).</p>



<a name="225604666"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/bounded%20exactness/near/225604666" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html#225604666">(Feb 08 2021 at 20:41)</a>:</h4>
<p>actually H is <em>too</em> bound atm, it is best if <code>i</code> is free but <code>x</code> and <code>y</code> are not</p>



<a name="225604694"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/bounded%20exactness/near/225604694" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html#225604694">(Feb 08 2021 at 20:41)</a>:</h4>
<p>We need a normalization for expressions which are elements the ring of integer polynomials in <code>i</code>, <code>i'</code>, <code>j</code>, etc, modulo a certain number of polynomial identities.</p>



<a name="225604702"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/bounded%20exactness/near/225604702" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html#225604702">(Feb 08 2021 at 20:41)</a>:</h4>
<p><span class="user-mention" data-user-id="110031">@Patrick Massot</span> But we need to upgrade it slightly to use bundled functions.</p>



<a name="225604707"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/bounded%20exactness/near/225604707" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html#225604707">(Feb 08 2021 at 20:41)</a>:</h4>
<p>because rw "doesn't work under binders"</p>



<a name="225604873"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/bounded%20exactness/near/225604873" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html#225604873">(Feb 08 2021 at 20:43)</a>:</h4>
<p>Yes, we need to upgrade it, that's why I wrote: we need to work more before asking for specific help.</p>



<a name="225604906"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/bounded%20exactness/near/225604906" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html#225604906">(Feb 08 2021 at 20:43)</a>:</h4>
<p>but like <span class="user-mention" data-user-id="110031">@Patrick Massot</span> says, I'm very close to suggesting that you make a standalone version of this problem that I can hack on</p>



<a name="225605836"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/bounded%20exactness/near/225605836" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html#225605836">(Feb 08 2021 at 20:49)</a>:</h4>
<p><span class="user-mention" data-user-id="110049">@Mario Carneiro</span> you are a genius!</p>



<a name="225605844"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/bounded%20exactness/near/225605844" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html#225605844">(Feb 08 2021 at 20:49)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">lemma</span> <span class="n">is_bdd_exact_for_bdd_degree_above_idx_of_shift</span>  <span class="o">{</span><span class="n">k</span> <span class="n">K</span> <span class="o">:</span> <span class="n">ℝ</span><span class="bp">≥</span><span class="mi">0</span><span class="o">}</span> <span class="o">{</span><span class="n">m</span> <span class="o">:</span> <span class="n">ℤ</span><span class="o">}</span> <span class="o">[</span><span class="n">hk</span> <span class="o">:</span> <span class="n">fact</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">≤</span> <span class="n">k</span><span class="o">)]</span> <span class="o">{</span><span class="n">c₀</span> <span class="o">:</span> <span class="n">ℝ</span><span class="bp">≥</span><span class="mi">0</span><span class="o">}</span>
  <span class="o">(</span><span class="n">H</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">c</span> <span class="bp">≥</span> <span class="n">c₀</span><span class="o">,</span> <span class="bp">∀</span> <span class="n">i</span> <span class="bp">&lt;</span> <span class="n">m</span> <span class="bp">-</span> <span class="mi">1</span><span class="o">,</span> <span class="bp">∀</span> <span class="n">x</span> <span class="o">:</span> <span class="n">C</span> <span class="o">(</span><span class="n">k</span> <span class="bp">*</span> <span class="n">c</span><span class="o">)</span> <span class="o">(</span><span class="n">i</span> <span class="bp">+</span> <span class="mi">1</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">),</span>
   <span class="bp">∃</span> <span class="n">y</span> <span class="o">:</span> <span class="n">C</span> <span class="n">c</span> <span class="o">(</span><span class="n">i</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">),</span> <span class="bp">∥</span><span class="n">res</span> <span class="n">x</span> <span class="bp">-</span> <span class="n">d</span> <span class="n">y</span><span class="bp">∥</span> <span class="bp">≤</span> <span class="n">K</span> <span class="bp">*</span> <span class="bp">∥</span><span class="o">(</span><span class="n">d</span> <span class="n">x</span> <span class="o">:</span> <span class="n">C</span> <span class="n">_</span> <span class="o">(</span><span class="n">i</span><span class="bp">+</span><span class="mi">1</span><span class="bp">+</span><span class="mi">1</span><span class="bp">+</span><span class="mi">1</span><span class="o">))</span><span class="bp">∥</span><span class="o">)</span> <span class="o">:</span>
   <span class="n">C.is_bdd_exact_for_bdd_degree_above_idx</span> <span class="n">k</span> <span class="n">K</span> <span class="n">m</span> <span class="n">c₀</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="n">intros</span> <span class="n">c</span> <span class="n">hc</span> <span class="n">i</span> <span class="n">hi</span> <span class="n">x</span><span class="o">,</span>
  <span class="n">specialize</span> <span class="n">H</span> <span class="n">c</span> <span class="n">hc</span> <span class="o">(</span><span class="n">i</span><span class="bp">-</span><span class="mi">1</span><span class="o">)</span> <span class="o">(</span><span class="kd">by</span> <span class="n">linarith</span><span class="o">),</span>
  <span class="n">rw</span> <span class="o">[</span><span class="n">sub_add_cancel</span><span class="o">]</span> <span class="n">at</span> <span class="n">H</span><span class="o">,</span>
  <span class="n">exact</span> <span class="n">H</span> <span class="n">x</span><span class="o">,</span>
<span class="kd">end</span>
</code></pre></div>



<a name="225605874"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/bounded%20exactness/near/225605874" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html#225605874">(Feb 08 2021 at 20:49)</a>:</h4>
<p>Works like a charm <span aria-label="tada" class="emoji emoji-1f389" role="img" title="tada">:tada:</span> <span aria-label="octopus" class="emoji emoji-1f419" role="img" title="octopus">:octopus:</span></p>



<a name="225606689"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/bounded%20exactness/near/225606689" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Peter Scholze <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html#225606689">(Feb 08 2021 at 20:55)</a>:</h4>
<p>It's been great fun reading along, thanks for the explanations!</p>



<a name="225607915"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/bounded%20exactness/near/225607915" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html#225607915">(Feb 08 2021 at 21:03)</a>:</h4>
<p><span class="user-mention silent" data-user-id="369530">Peter Scholze</span> <a href="#narrow/stream/267928-condensed-mathematics/topic/bounded.20exactness/near/225606689">said</a>:</p>
<blockquote>
<p>It's been great fun reading along, thanks for the explanations!</p>
</blockquote>
<p>As you can see, we're not yet at a stage where such a software can be used while ignoring ugly implementations details that have no mathematical content at all. But we'll get there eventually.</p>



<a name="225608122"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/bounded%20exactness/near/225608122" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html#225608122">(Feb 08 2021 at 21:04)</a>:</h4>
<p>It's nice that this lemma works but I'm a bit worried that we get tempted to use it to push back the moment where the issue will have to be solved for real (and then we'll have to redo thousands of lines of code).</p>



<a name="225608267"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/bounded%20exactness/near/225608267" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html#225608267">(Feb 08 2021 at 21:05)</a>:</h4>
<p>I don't think we know what the solution looks like yet though. We need a decent amount of test code before we can see what works</p>



<a name="225951967"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/bounded%20exactness/near/225951967" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html#225951967">(Feb 11 2021 at 06:05)</a>:</h4>
<p>What do people think of renaming <code>is_bdd_exact_for_bdd_degree_above_idx</code> to <code>is_bounded_exact</code> (and similarly for weak exactness). I think it helps with readability, and it should be clear that the other conditions are implied.</p>



<a name="226012966"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/bounded%20exactness/near/226012966" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html#226012966">(Feb 11 2021 at 16:00)</a>:</h4>
<p>Done</p>



<a name="227474982"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/bounded%20exactness/near/227474982" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html#227474982">(Feb 23 2021 at 18:00)</a>:</h4>
<p>I stopped working on this for a while because I was hoping that DTT issues with complexes would improve. But this doesn't seem to be coming soon, so I pushed in our broken setup and proved complete weakly bounded exact complexes are bounded exact: <a href="https://github.com/leanprover-community/lean-liquid/commit/fefeb5e9cb7ea2edb55371882e944f4a1e774586">https://github.com/leanprover-community/lean-liquid/commit/fefeb5e9cb7ea2edb55371882e944f4a1e774586</a></p>



<a name="227475115"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/bounded%20exactness/near/227475115" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html#227475115">(Feb 23 2021 at 18:02)</a>:</h4>
<p>I'd very interested in seeing a tactic, or at least a user guide, simplifying the endless stream of stupid inequalities. Clearly we don't have a usable tool there yet.</p>



<a name="227475515"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/bounded%20exactness/near/227475515" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html#227475515">(Feb 23 2021 at 18:04)</a>:</h4>
<p>The proof is 110 lines long and <em>most</em> of it should be completely automatic.</p>



<a name="227476244"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/bounded%20exactness/near/227476244" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html#227476244">(Feb 23 2021 at 18:08)</a>:</h4>
<p>Also for the record: the blueprint proof is not correct because we don't ask that $K$ is positive (actually we don't even ask that it's nonnegative, whereas it could well be negative if all the normed groups involved are trivial). So I had to replace some <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>K</mi></mrow><annotation encoding="application/x-tex">K</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">K</span></span></span></span> by <code>if K &gt; 0 then K else 1</code>. And the formal statement that I wrote a couple of weeks ago missed the completeness assumption...</p>



<a name="227476528"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/bounded%20exactness/near/227476528" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html#227476528">(Feb 23 2021 at 18:10)</a>:</h4>
<p>Oh, and I almost forgot: the blueprint was also missing an argument invoking <a href="https://github.com/leanprover-community/lean-liquid/blob/fefeb5e9cb7ea2edb55371882e944f4a1e774586/src/system_of_complexes/basic.lean#L211-L213">https://github.com/leanprover-community/lean-liquid/blob/fefeb5e9cb7ea2edb55371882e944f4a1e774586/src/system_of_complexes/basic.lean#L211-L213</a></p>



<a name="227477254"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/bounded%20exactness/near/227477254" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html#227477254">(Feb 23 2021 at 18:14)</a>:</h4>
<p>For those who did not follow: this proof is not in the lecture notes, it was sketched by Peter as a little tactical change in the main proofs and details were (almost) filled in by Riccardo and myself.</p>



<a name="227479800"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/bounded%20exactness/near/227479800" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastien Gouezel <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html#227479800">(Feb 23 2021 at 18:30)</a>:</h4>
<p>I didn't follow the discussion on complexes closely, but I was pretty convinced by a suggestion by Johan, if I remember correctly. Which was: define a group morphism <code>d' i j</code> for all <code>i j</code>, which is equal to <code>0</code> if <code>j</code> is not <code>i + 1</code>, and to the usual <code>d</code> followed by a cast if <code>j = i+1</code>. Possibly with variations in which the <code>i</code> could be implicit when you apply it to <code>x : C i</code>. Did it turn out to be not so practical?</p>



<a name="227481772"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/bounded%20exactness/near/227481772" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html#227481772">(Feb 23 2021 at 18:41)</a>:</h4>
<p>If I recall correctly this approach didn't really improve anything.</p>



<a name="227482006"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/bounded%20exactness/near/227482006" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html#227482006">(Feb 23 2021 at 18:42)</a>:</h4>
<p>Same goes for the approach where you define it as a functor from <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="double-struck">Z</mi></mrow><annotation encoding="application/x-tex">\mathbb{Z}</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.68889em;vertical-align:0em;"></span><span class="mord"><span class="mord mathbb">Z</span></span></span></span></span> (with the poset structure) to abelian groups satisfying some condition.</p>



<a name="227482922"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/bounded%20exactness/near/227482922" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html#227482922">(Feb 23 2021 at 18:48)</a>:</h4>
<p>It seems the moral of this story is that one should think of complexes as functors from some indexing category, and equality in this index category just like any other isomorphism, and hope that automation will eventually save the day.</p>



<a name="227483380"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/bounded%20exactness/near/227483380" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html#227483380">(Feb 23 2021 at 18:51)</a>:</h4>
<p>I think the proposal that Sebastian is talking about hasn't really been tried yet.</p>



<a name="227483462"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/bounded%20exactness/near/227483462" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html#227483462">(Feb 23 2021 at 18:52)</a>:</h4>
<p>At least I haven't properly tested it... but I have been to distracted by other things lately <span aria-label="expressionless" class="emoji emoji-1f611" role="img" title="expressionless">:expressionless:</span></p>



<a name="227490140"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/bounded%20exactness/near/227490140" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Peter Scholze <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html#227490140">(Feb 23 2021 at 19:35)</a>:</h4>
<p><span class="user-mention" data-user-id="110031">@Patrick Massot</span> I'm glad this implication worked out! Now I'm eagerly waiting for the next trouble ya'll find :-)</p>



<a name="227496066"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/bounded%20exactness/near/227496066" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastien Gouezel <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html#227496066">(Feb 23 2021 at 20:14)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110050">Sebastien Gouezel</span> <a href="#narrow/stream/267928-condensed-mathematics/topic/bounded.20exactness/near/227479800">said</a>:</p>
<blockquote>
<p>I didn't follow the discussion on complexes closely, but I was pretty convinced by a suggestion by Johan, if I remember correctly. Which was: define a group morphism <code>d' i j</code> for all <code>i j</code>, which is equal to <code>0</code> if <code>j</code> is not <code>i + 1</code>, and to the usual <code>d</code> followed by a cast if <code>j = i+1</code>. Possibly with variations in which the <code>i</code> could be implicit when you apply it to <code>x : C i</code>. Did it turn out to be not so practical?</p>
</blockquote>
<p>There's something I like with this proposition: in degree <code>i</code>, you can define the closed guys as <code>(d' i (i+1)).ker</code>, and the exact guys as <code>(d' (i-1) i).range</code>, and then the cohomology as their quotient, without having ever to check that <code>(i-1) + 1 = i</code>. And in fact it also works in degree <code>i = 0</code>, where this equality fails because of <code>nat</code> subtraction (but still <code>(d' (0-1) 0).range</code> is the zero submodule, so everything is fine). This means that for <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="double-struck">N</mi></mrow><annotation encoding="application/x-tex">\N</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.68889em;vertical-align:0em;"></span><span class="mord"><span class="mord mathbb">N</span></span></span></span></span>-indexed complexes you don't need to define things in a specific way at <code>i = 0</code>.</p>



<a name="227497044"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/bounded%20exactness/near/227497044" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html#227497044">(Feb 23 2021 at 20:20)</a>:</h4>
<p>Is there something subtle in the definition of completion of a system of complexes I am missing? It  is a <code>sorry</code>  at the moment, but we have completion of normed groups, so  it seems easy to write</p>



<a name="227497620"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/bounded%20exactness/near/227497620" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html#227497620">(Feb 23 2021 at 20:24)</a>:</h4>
<p><a href="https://github.com/leanprover-community/lean-liquid/blob/fd2e905e64fad39a0650f3cea374f55357842a45/src/system_of_complexes/completion.lean#L17">https://github.com/leanprover-community/lean-liquid/blob/fd2e905e64fad39a0650f3cea374f55357842a45/src/system_of_complexes/completion.lean#L17</a></p>



<a name="227497669"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/bounded%20exactness/near/227497669" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html#227497669">(Feb 23 2021 at 20:24)</a>:</h4>
<p>I have a mathlib PR open with additive functors. I'll merge this branch of LTE into master once that gets into mathlib.</p>



<a name="227497992"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/bounded%20exactness/near/227497992" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html#227497992">(Feb 23 2021 at 20:26)</a>:</h4>
<p>Ah we want it as an additive functor!</p>



<a name="227498054"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/bounded%20exactness/near/227498054" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html#227498054">(Feb 23 2021 at 20:27)</a>:</h4>
<p>Yeah, the completion is an additive functor. And you can pushforward a complex with respect to an additive functor.</p>



<a name="227500591"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/bounded%20exactness/near/227500591" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html#227500591">(Feb 23 2021 at 20:47)</a>:</h4>
<p>Indeed we already know how to complete a normed group, but it's nicer if we can say directly the completion of a complex is a complex.</p>



<a name="227505821"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/bounded%20exactness/near/227505821" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html#227505821">(Feb 23 2021 at 21:24)</a>:</h4>
<p>By the way, I would be interested to try to restructure one of the proofs in this area to see if I can spot some tricks to make working with complexes easier. It will be easiest for this if the theorem is already formalized, so that it's really a refactoring job and I don't have to learn too much of the prerequisites. Let me know if you have a good theorem or collection of theorems to try this on.</p>



<a name="227506292"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/bounded%20exactness/near/227506292" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html#227506292">(Feb 23 2021 at 21:27)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110050">Sebastien Gouezel</span> <a href="#narrow/stream/267928-condensed-mathematics/topic/bounded.20exactness/near/227496066">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="110050">Sebastien Gouezel</span> <a href="#narrow/stream/267928-condensed-mathematics/topic/bounded.20exactness/near/227479800">said</a>:</p>
<blockquote>
<p>I didn't follow the discussion on complexes closely, but I was pretty convinced by a suggestion by Johan, if I remember correctly. Which was: define a group morphism <code>d' i j</code> for all <code>i j</code>, which is equal to <code>0</code> if <code>j</code> is not <code>i + 1</code>, and to the usual <code>d</code> followed by a cast if <code>j = i+1</code>. Possibly with variations in which the <code>i</code> could be implicit when you apply it to <code>x : C i</code>. Did it turn out to be not so practical?</p>
</blockquote>
<p>There's something I like with this proposition: in degree <code>i</code>, you can define the closed guys as <code>(d' i (i+1)).ker</code>, and the exact guys as <code>(d' (i-1) i).range</code>, and then the cohomology as their quotient, without having ever to check that <code>(i-1) + 1 = i</code>. And in fact it also works in degree <code>i = 0</code>, where this equality fails because of <code>nat</code> subtraction (but still <code>(d' (0-1) 0).range</code> is the zero submodule, so everything is fine). This means that for <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="double-struck">N</mi></mrow><annotation encoding="application/x-tex">\N</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.68889em;vertical-align:0em;"></span><span class="mord"><span class="mord mathbb">N</span></span></span></span></span>-indexed complexes you don't need to define things in a specific way at <code>i = 0</code>.</p>
</blockquote>
<p>I like these observations.</p>



<a name="227506395"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/bounded%20exactness/near/227506395" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html#227506395">(Feb 23 2021 at 21:28)</a>:</h4>
<p><span class="user-mention" data-user-id="110049">@Mario Carneiro</span> thanks! I'm sure we have several complete proofs scattered around on some branches. We can put those together in one file for you to play with.</p>



<a name="227614529"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/bounded%20exactness/near/227614529" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/bounded.20exactness.html#227614529">(Feb 24 2021 at 15:21)</a>:</h4>
<p>Another small mathlib PR with the pushforward of a complex w.r.t. an additive functor. This should get rid of the <code>additive_functor.lean</code> file in the <code>additive</code> branch of <code>lean-liquid</code>. <a href="https://github.com/leanprover-community/mathlib/issues/6403">#6403</a></p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>