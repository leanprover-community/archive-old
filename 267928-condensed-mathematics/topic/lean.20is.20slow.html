---
layout: archive
title: Zulip Chat Archive
permalink: /stream/267928-condensed-mathematics/topic/lean.20is.20slow.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/index.html">condensed mathematics</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/lean.20is.20slow.html">lean is slow</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="230183243"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/lean%20is%20slow/near/230183243" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/lean.20is.20slow.html#230183243">(Mar 13 2021 at 19:21)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">system_of_complexes.lean</span><span class="o">:</span><span class="mi">56</span><span class="o">:</span><span class="mi">4</span>
<span class="n">parsing</span> <span class="n">took</span> <span class="mi">0</span><span class="bp">.</span><span class="mi">882</span><span class="n">ms</span>
<span class="n">system_of_complexes.lean</span><span class="o">:</span><span class="mi">56</span><span class="o">:</span><span class="mi">4</span>
<span class="n">elaboration</span> <span class="n">of</span> <span class="n">complex</span> <span class="n">took</span> <span class="mi">1</span><span class="bp">.</span><span class="mi">59</span><span class="n">s</span>
<span class="n">system_of_complexes.lean</span><span class="o">:</span><span class="mi">56</span><span class="o">:</span><span class="mi">4</span>
<span class="n">type</span> <span class="n">checking</span> <span class="n">of</span> <span class="n">complex</span> <span class="n">took</span> <span class="mi">2</span><span class="bp">.</span><span class="mi">45</span><span class="n">ms</span>
<span class="n">system_of_complexes.lean</span><span class="o">:</span><span class="mi">56</span><span class="o">:</span><span class="mi">4</span>
<span class="n">decl</span> <span class="n">post</span><span class="bp">-</span><span class="n">processing</span> <span class="n">of</span> <span class="n">complex</span> <span class="n">took</span> <span class="mi">12</span><span class="bp">.</span><span class="mi">5</span><span class="n">s</span>
</code></pre></div>



<a name="230183248"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/lean%20is%20slow/near/230183248" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/lean.20is.20slow.html#230183248">(Mar 13 2021 at 19:21)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="sd">/-- The complex of normed groups `V-hat(M_{≤c})^{T⁻¹} ⟶ V-hat(M_{≤c_1c}^2)^{T⁻¹} ⟶ …` -/</span>
<span class="kd">@[simps]</span>
<span class="kd">def</span> <span class="n">complex</span> <span class="o">(</span><span class="n">r</span> <span class="o">:</span> <span class="n">ℝ</span><span class="bp">≥</span><span class="mi">0</span><span class="o">)</span> <span class="o">(</span><span class="n">V</span> <span class="o">:</span> <span class="n">NormedGroup</span><span class="o">)</span> <span class="o">[</span><span class="n">normed_with_aut</span> <span class="n">r</span> <span class="n">V</span><span class="o">]</span> <span class="o">[</span><span class="n">fact</span> <span class="o">(</span><span class="mi">0</span> <span class="bp">&lt;</span> <span class="n">r</span><span class="o">)]</span>
  <span class="o">(</span><span class="n">r'</span> <span class="o">:</span> <span class="n">ℝ</span><span class="bp">≥</span><span class="mi">0</span><span class="o">)</span> <span class="o">[</span><span class="n">fact</span> <span class="o">(</span><span class="mi">0</span> <span class="bp">&lt;</span> <span class="n">r'</span><span class="o">)]</span> <span class="o">[</span><span class="n">fact</span> <span class="o">(</span><span class="n">r'</span> <span class="bp">≤</span> <span class="mi">1</span><span class="o">)]</span> <span class="o">(</span><span class="n">M</span> <span class="o">:</span> <span class="n">ProFiltPseuNormGrpWithTinv</span> <span class="n">r'</span><span class="o">)</span> <span class="o">(</span><span class="n">c</span> <span class="o">:</span> <span class="n">ℝ</span><span class="bp">≥</span><span class="mi">0</span><span class="o">)</span> <span class="o">:</span>
  <span class="n">cochain_complex</span> <span class="n">ℕ</span> <span class="n">NormedGroup</span> <span class="o">:=</span>
<span class="n">cochain_complex.mk'</span>
  <span class="o">(</span><span class="n">BD.complex_X</span> <span class="n">c'</span> <span class="n">r</span> <span class="n">V</span> <span class="n">M</span> <span class="n">c</span><span class="o">)</span>
  <span class="o">(</span><span class="n">BD.complex_d</span> <span class="n">c'</span> <span class="n">r</span> <span class="n">V</span> <span class="n">M</span> <span class="n">c</span><span class="o">)</span>
  <span class="o">(</span><span class="n">BD.complex_d_comp_d</span> <span class="n">c'</span> <span class="n">r</span> <span class="n">V</span> <span class="n">M</span> <span class="n">c</span><span class="o">)</span>
</code></pre></div>



<a name="230183290"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/lean%20is%20slow/near/230183290" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/lean.20is.20slow.html#230183290">(Mar 13 2021 at 19:22)</a>:</h4>
<p><a href="https://github.com/leanprover-community/lean-liquid/blob/master/src/pseudo_normed_group/system_of_complexes.lean#L52-L60">https://github.com/leanprover-community/lean-liquid/blob/master/src/pseudo_normed_group/system_of_complexes.lean#L52-L60</a></p>



<a name="230183312"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/lean%20is%20slow/near/230183312" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/lean.20is.20slow.html#230183312">(Mar 13 2021 at 19:22)</a>:</h4>
<p>Does anybody know why this innocent looking <code>def</code> should take &gt; 12s?</p>



<a name="230183838"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/lean%20is%20slow/near/230183838" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/lean.20is.20slow.html#230183838">(Mar 13 2021 at 19:32)</a>:</h4>
<p>Did you try removing <code>@[simps]</code> as a first investigation step?</p>



<a name="230184308"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/lean%20is%20slow/near/230184308" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/lean.20is.20slow.html#230184308">(Mar 13 2021 at 19:41)</a>:</h4>
<p>On my machine it certainly looks like <code>simps</code> is the piece taking up a lot of time.</p>



<a name="230184361"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/lean%20is%20slow/near/230184361" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/lean.20is.20slow.html#230184361">(Mar 13 2021 at 19:42)</a>:</h4>
<p>Did you have a look at the generated simp lemmas?</p>



<a name="230184387"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/lean%20is%20slow/near/230184387" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/lean.20is.20slow.html#230184387">(Mar 13 2021 at 19:42)</a>:</h4>
<p>I agree that <code>@[simps]</code> seems to account for the 12s post-processing</p>



<a name="230184486"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/267928-condensed%20mathematics/topic/lean%20is%20slow/near/230184486" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/267928-condensed-mathematics/topic/lean.20is.20slow.html#230184486">(Mar 13 2021 at 19:44)</a>:</h4>
<p>You can also try to <code>#check</code> all three arguments to <code>cochain_complex.mk'</code> (all the required variables are already defined) and see they are elaborated instantly.</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>