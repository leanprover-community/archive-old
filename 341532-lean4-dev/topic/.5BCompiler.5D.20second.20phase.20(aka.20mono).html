---
layout: archive
title: Zulip Chat Archive
permalink: /stream/341532-lean4-dev/topic/.5BCompiler.5D.20second.20phase.20(aka.20mono).html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/341532-lean4-dev/index.html">lean4 dev</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/341532-lean4-dev/topic/.5BCompiler.5D.20second.20phase.20(aka.20mono).html">[Compiler] second phase (aka mono)</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="302671507"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/341532-lean4%20dev/topic/%5BCompiler%5D%20second%20phase%20%28aka%20mono%29/near/302671507" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Leonardo de Moura <a href="https://leanprover-community.github.io/archive/stream/341532-lean4-dev/topic/.5BCompiler.5D.20second.20phase.20(aka.20mono).html#302671507">(Oct 06 2022 at 14:54)</a>:</h4>
<p>We have activated the new compiler second phase. It has only one pass now, but we will be adding new passes in the next following days.<br>
The <code>.olean</code> files for the Lean 4 library now have an extra 70 Mb. This is a temporary overhead until we delete the old code generator.<br>
We are also planning to use a more compact representation for storing code in the .olean files.</p>



<a name="302683231"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/341532-lean4%20dev/topic/%5BCompiler%5D%20second%20phase%20%28aka%20mono%29/near/302683231" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Henrik BÃ¶ving <a href="https://leanprover-community.github.io/archive/stream/341532-lean4-dev/topic/.5BCompiler.5D.20second.20phase.20(aka.20mono).html#302683231">(Oct 06 2022 at 15:45)</a>:</h4>
<p>What are the plans for that more compact representation?</p>
<p>Also have you tested/reenabled the JP context pass on Gabriel's example yet? If not shall I do it?</p>



<a name="302692630"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/341532-lean4%20dev/topic/%5BCompiler%5D%20second%20phase%20%28aka%20mono%29/near/302692630" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Leonardo de Moura <a href="https://leanprover-community.github.io/archive/stream/341532-lean4-dev/topic/.5BCompiler.5D.20second.20phase.20(aka.20mono).html#302692630">(Oct 06 2022 at 16:28)</a>:</h4>
<blockquote>
<p>What are the plans for that more compact representation?</p>
</blockquote>
<p>No concrete plans yet, we should discuss it in tomorrow's meeting. The plan is based on a simple observation: we don't use the locally nameless approach in the code generator and we already have an internalization step in the code generator. Since we have to internalize anyway, we could store the code in a more compact (serialized) format and "decode" it during internalization.</p>
<blockquote>
<p>Also have you tested/reenabled the JP context pass on Gabriel's example yet? If not shall I do it?</p>
</blockquote>
<p>I did not test it yet. I am still testing the <code>toMono</code> pass. The test suite is passing and we can compile lean with <code>toMono</code> enabled, but I found a few small issues today.</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>