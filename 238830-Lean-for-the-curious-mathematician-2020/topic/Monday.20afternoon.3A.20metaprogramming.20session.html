---
layout: archive
title: Zulip Chat Archive
permalink: /stream/238830-Lean-for-the-curious-mathematician-2020/topic/Monday.20afternoon.3A.20metaprogramming.20session.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/238830-Lean-for-the-curious-mathematician-2020/index.html">Lean for the curious mathematician 2020</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/238830-Lean-for-the-curious-mathematician-2020/topic/Monday.20afternoon.3A.20metaprogramming.20session.html">Monday afternoon: metaprogramming session</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="203696144"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/238830-Lean%20for%20the%20curious%20mathematician%202020/topic/Monday%20afternoon%3A%20metaprogramming%20session/near/203696144" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/238830-Lean-for-the-curious-mathematician-2020/topic/Monday.20afternoon.3A.20metaprogramming.20session.html#203696144">(Jul 13 2020 at 09:53)</a>:</h4>
<p>Hi everyone! The "intermediate track" for the afternoon is a tutorial about metaprogramming (i.e. writing your own tactics). We expect most people to follow the other track; this is aimed at people who have some familiarity with Lean already. If that sounds like you, and you're interested in metaprogramming, read on.</p>



<a name="203696209"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/238830-Lean%20for%20the%20curious%20mathematician%202020/topic/Monday%20afternoon%3A%20metaprogramming%20session/near/203696209" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/238830-Lean-for-the-curious-mathematician-2020/topic/Monday.20afternoon.3A.20metaprogramming.20session.html#203696209">(Jul 13 2020 at 09:54)</a>:</h4>
<p>Under the assumption that many more people will watch these recorded than live, I pre-recorded the videos. They're all on YouTube for you to watch at your leisure. <a href="https://www.youtube.com/playlist?list=PLlF-CfQhukNnq2kDCw2P_vI5AfXN7egP2">https://www.youtube.com/playlist?list=PLlF-CfQhukNnq2kDCw2P_vI5AfXN7egP2</a></p>



<a name="203696241"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/238830-Lean%20for%20the%20curious%20mathematician%202020/topic/Monday%20afternoon%3A%20metaprogramming%20session/near/203696241" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/238830-Lean-for-the-curious-mathematician-2020/topic/Monday.20afternoon.3A.20metaprogramming.20session.html#203696241">(Jul 13 2020 at 09:54)</a>:</h4>
<p>I'll be around this afternoon if anyone has questions, comments, or wants to try something out.</p>



<a name="203696261"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/238830-Lean%20for%20the%20curious%20mathematician%202020/topic/Monday%20afternoon%3A%20metaprogramming%20session/near/203696261" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Carl Friedrich Bolz-Tereick <a href="https://leanprover-community.github.io/archive/stream/238830-Lean-for-the-curious-mathematician-2020/topic/Monday.20afternoon.3A.20metaprogramming.20session.html#203696261">(Jul 13 2020 at 09:54)</a>:</h4>
<p>Thanks a lot for doing the recording!</p>



<a name="203703840"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/238830-Lean%20for%20the%20curious%20mathematician%202020/topic/Monday%20afternoon%3A%20metaprogramming%20session/near/203703840" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Antoine Chambert-Loir <a href="https://leanprover-community.github.io/archive/stream/238830-Lean-for-the-curious-mathematician-2020/topic/Monday.20afternoon.3A.20metaprogramming.20session.html#203703840">(Jul 13 2020 at 11:33)</a>:</h4>
<p>When/where does this session take place?</p>



<a name="203703909"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/238830-Lean%20for%20the%20curious%20mathematician%202020/topic/Monday%20afternoon%3A%20metaprogramming%20session/near/203703909" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/238830-Lean-for-the-curious-mathematician-2020/topic/Monday.20afternoon.3A.20metaprogramming.20session.html#203703909">(Jul 13 2020 at 11:34)</a>:</h4>
<p><span class="user-mention" data-user-id="110596">@Rob Lewis</span></p>



<a name="203703930"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/238830-Lean%20for%20the%20curious%20mathematician%202020/topic/Monday%20afternoon%3A%20metaprogramming%20session/near/203703930" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/238830-Lean-for-the-curious-mathematician-2020/topic/Monday.20afternoon.3A.20metaprogramming.20session.html#203703930">(Jul 13 2020 at 11:34)</a>:</h4>
<p>One sec! Zoom link is coming.</p>



<a name="203703940"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/238830-Lean%20for%20the%20curious%20mathematician%202020/topic/Monday%20afternoon%3A%20metaprogramming%20session/near/203703940" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/238830-Lean-for-the-curious-mathematician-2020/topic/Monday.20afternoon.3A.20metaprogramming.20session.html#203703940">(Jul 13 2020 at 11:34)</a>:</h4>
<p>But the obvious place to start is the YouTube videos :)</p>



<a name="203703945"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/238830-Lean%20for%20the%20curious%20mathematician%202020/topic/Monday%20afternoon%3A%20metaprogramming%20session/near/203703945" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/238830-Lean-for-the-curious-mathematician-2020/topic/Monday.20afternoon.3A.20metaprogramming.20session.html#203703945">(Jul 13 2020 at 11:34)</a>:</h4>
<p>There's like 90 minutes of stuff there.</p>



<a name="203703971"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/238830-Lean%20for%20the%20curious%20mathematician%202020/topic/Monday%20afternoon%3A%20metaprogramming%20session/near/203703971" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/238830-Lean-for-the-curious-mathematician-2020/topic/Monday.20afternoon.3A.20metaprogramming.20session.html#203703971">(Jul 13 2020 at 11:35)</a>:</h4>
<p><a href="https://vu-live.zoom.us/j/99368691219">https://vu-live.zoom.us/j/99368691219</a> (Password: 654479)</p>



<a name="203703980"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/238830-Lean%20for%20the%20curious%20mathematician%202020/topic/Monday%20afternoon%3A%20metaprogramming%20session/near/203703980" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/238830-Lean-for-the-curious-mathematician-2020/topic/Monday.20afternoon.3A.20metaprogramming.20session.html#203703980">(Jul 13 2020 at 11:35)</a>:</h4>
<p>Rob, what we need to know is when people can do exercises.</p>



<a name="203704132"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/238830-Lean%20for%20the%20curious%20mathematician%202020/topic/Monday%20afternoon%3A%20metaprogramming%20session/near/203704132" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/238830-Lean-for-the-curious-mathematician-2020/topic/Monday.20afternoon.3A.20metaprogramming.20session.html#203704132">(Jul 13 2020 at 11:37)</a>:</h4>
<p>Video 5 gets you to the point where you can tackle the first couple exercises I posted, as well as many from the Hitchhiker's Guide.</p>



<a name="203704161"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/238830-Lean%20for%20the%20curious%20mathematician%202020/topic/Monday%20afternoon%3A%20metaprogramming%20session/near/203704161" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/238830-Lean-for-the-curious-mathematician-2020/topic/Monday.20afternoon.3A.20metaprogramming.20session.html#203704161">(Jul 13 2020 at 11:37)</a>:</h4>
<p>I'm happy to answer questions in the Zoom chat.</p>



<a name="203704218"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/238830-Lean%20for%20the%20curious%20mathematician%202020/topic/Monday%20afternoon%3A%20metaprogramming%20session/near/203704218" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/238830-Lean-for-the-curious-mathematician-2020/topic/Monday.20afternoon.3A.20metaprogramming.20session.html#203704218">(Jul 13 2020 at 11:38)</a>:</h4>
<p>If people have watched the videos and want to work on exercises together, I can set that up too.</p>



<a name="203704270"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/238830-Lean%20for%20the%20curious%20mathematician%202020/topic/Monday%20afternoon%3A%20metaprogramming%20session/near/203704270" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/238830-Lean-for-the-curious-mathematician-2020/topic/Monday.20afternoon.3A.20metaprogramming.20session.html#203704270">(Jul 13 2020 at 11:39)</a>:</h4>
<p>People who want the exercises can run <code>leanproject get lftcm2020</code> then <code>cp -r lftcm2020/src/exercises_sources/ lftcm2020/src/my_exercises
</code> before <code>code lftcm2020</code> and see whatever sits in <code>src/my_exercises/monday</code></p>



<a name="203704679"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/238830-Lean%20for%20the%20curious%20mathematician%202020/topic/Monday%20afternoon%3A%20metaprogramming%20session/near/203704679" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Amos Turchet <a href="https://leanprover-community.github.io/archive/stream/238830-Lean-for-the-curious-mathematician-2020/topic/Monday.20afternoon.3A.20metaprogramming.20session.html#203704679">(Jul 13 2020 at 11:45)</a>:</h4>
<p>is this "suggested" for those who already completed the NNG?</p>



<a name="203704696"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/238830-Lean%20for%20the%20curious%20mathematician%202020/topic/Monday%20afternoon%3A%20metaprogramming%20session/near/203704696" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/238830-Lean-for-the-curious-mathematician-2020/topic/Monday.20afternoon.3A.20metaprogramming.20session.html#203704696">(Jul 13 2020 at 11:45)</a>:</h4>
<p>To clarify again for people joining this session: there's no "live presentation." I'll be hanging out in the Zoom room to answer questions. If you'd like to collaborate with people on the exercises, we can set that up too.</p>



<a name="203704704"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/238830-Lean%20for%20the%20curious%20mathematician%202020/topic/Monday%20afternoon%3A%20metaprogramming%20session/near/203704704" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/238830-Lean-for-the-curious-mathematician-2020/topic/Monday.20afternoon.3A.20metaprogramming.20session.html#203704704">(Jul 13 2020 at 11:45)</a>:</h4>
<p>There is quite a gap from NNG to this session</p>



<a name="203704710"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/238830-Lean%20for%20the%20curious%20mathematician%202020/topic/Monday%20afternoon%3A%20metaprogramming%20session/near/203704710" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/238830-Lean-for-the-curious-mathematician-2020/topic/Monday.20afternoon.3A.20metaprogramming.20session.html#203704710">(Jul 13 2020 at 11:45)</a>:</h4>
<p><span class="user-mention" data-user-id="319141">@Amos Turchet</span>, it might still be a jump.</p>



<a name="203704751"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/238830-Lean%20for%20the%20curious%20mathematician%202020/topic/Monday%20afternoon%3A%20metaprogramming%20session/near/203704751" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/238830-Lean-for-the-curious-mathematician-2020/topic/Monday.20afternoon.3A.20metaprogramming.20session.html#203704751">(Jul 13 2020 at 11:46)</a>:</h4>
<p>But I have nothing to say if you don't have anything to ask :)</p>



<a name="203704781"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/238830-Lean%20for%20the%20curious%20mathematician%202020/topic/Monday%20afternoon%3A%20metaprogramming%20session/near/203704781" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/238830-Lean-for-the-curious-mathematician-2020/topic/Monday.20afternoon.3A.20metaprogramming.20session.html#203704781">(Jul 13 2020 at 11:46)</a>:</h4>
<p>If you have done NNG but nothing else, then you should probably wait for tomorrow morning session.</p>



<a name="203704808"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/238830-Lean%20for%20the%20curious%20mathematician%202020/topic/Monday%20afternoon%3A%20metaprogramming%20session/near/203704808" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/238830-Lean-for-the-curious-mathematician-2020/topic/Monday.20afternoon.3A.20metaprogramming.20session.html#203704808">(Jul 13 2020 at 11:46)</a>:</h4>
<p><span class="user-mention" data-user-id="319141">@Amos Turchet</span> There is also the "complex number game"</p>



<a name="203704822"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/238830-Lean%20for%20the%20curious%20mathematician%202020/topic/Monday%20afternoon%3A%20metaprogramming%20session/near/203704822" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/238830-Lean-for-the-curious-mathematician-2020/topic/Monday.20afternoon.3A.20metaprogramming.20session.html#203704822">(Jul 13 2020 at 11:47)</a>:</h4>
<p>There are perhaps four levels of things to do:</p>
<ol>
<li>the natural numbers game</li>
<li><code>leanproject get tutorial</code></li>
<li><code>leanproject get lftcm2020</code> and have a go at the exercises (really intended for later in the week)</li>
<li>Rob's meta-programming tutorials</li>
</ol>



<a name="203704823"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/238830-Lean%20for%20the%20curious%20mathematician%202020/topic/Monday%20afternoon%3A%20metaprogramming%20session/near/203704823" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/238830-Lean-for-the-curious-mathematician-2020/topic/Monday.20afternoon.3A.20metaprogramming.20session.html#203704823">(Jul 13 2020 at 11:47)</a>:</h4>
<p>And I think Kevin has some more games up his sleeve</p>



<a name="203704844"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/238830-Lean%20for%20the%20curious%20mathematician%202020/topic/Monday%20afternoon%3A%20metaprogramming%20session/near/203704844" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/238830-Lean-for-the-curious-mathematician-2020/topic/Monday.20afternoon.3A.20metaprogramming.20session.html#203704844">(Jul 13 2020 at 11:47)</a>:</h4>
<p>And the natural numbers game also includes hanging out with Kevin and helping people who are working through the NNG.</p>



<a name="203704853"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/238830-Lean%20for%20the%20curious%20mathematician%202020/topic/Monday%20afternoon%3A%20metaprogramming%20session/near/203704853" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Amos Turchet <a href="https://leanprover-community.github.io/archive/stream/238830-Lean-for-the-curious-mathematician-2020/topic/Monday.20afternoon.3A.20metaprogramming.20session.html#203704853">(Jul 13 2020 at 11:47)</a>:</h4>
<p>yeah Kevin just gave stuff to do, I'll try that first and then follow the suggestions. Thanks!</p>



<a name="203704860"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/238830-Lean%20for%20the%20curious%20mathematician%202020/topic/Monday%20afternoon%3A%20metaprogramming%20session/near/203704860" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/238830-Lean-for-the-curious-mathematician-2020/topic/Monday.20afternoon.3A.20metaprogramming.20session.html#203704860">(Jul 13 2020 at 11:47)</a>:</h4>
<p>Kevin is also saying right now that he has some extra levels/worlds available for people finished with the NNG but not ready to go on to more advanced things.</p>



<a name="203705681"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/238830-Lean%20for%20the%20curious%20mathematician%202020/topic/Monday%20afternoon%3A%20metaprogramming%20session/near/203705681" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Amos Turchet <a href="https://leanprover-community.github.io/archive/stream/238830-Lean-for-the-curious-mathematician-2020/topic/Monday.20afternoon.3A.20metaprogramming.20session.html#203705681">(Jul 13 2020 at 11:59)</a>:</h4>
<p>the "lost levels" are perfect to do after the NNG thanks!</p>



<a name="203706167"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/238830-Lean%20for%20the%20curious%20mathematician%202020/topic/Monday%20afternoon%3A%20metaprogramming%20session/near/203706167" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/238830-Lean-for-the-curious-mathematician-2020/topic/Monday.20afternoon.3A.20metaprogramming.20session.html#203706167">(Jul 13 2020 at 12:05)</a>:</h4>
<p>I should add: even if you're not interested in writing metaprograms, the first two videos of the metaprogramming session should be reasonably accessible. They won't get you to the stage where you can do anything. But you could still learn something.</p>



<a name="203706234"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/238830-Lean%20for%20the%20curious%20mathematician%202020/topic/Monday%20afternoon%3A%20metaprogramming%20session/near/203706234" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/238830-Lean-for-the-curious-mathematician-2020/topic/Monday.20afternoon.3A.20metaprogramming.20session.html#203706234">(Jul 13 2020 at 12:06)</a>:</h4>
<p>Seconding this --- the first two videos are useful as soon as you've done a few levels of the natural numbers game.</p>



<a name="203706282"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/238830-Lean%20for%20the%20curious%20mathematician%202020/topic/Monday%20afternoon%3A%20metaprogramming%20session/near/203706282" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jeremy Avigad <a href="https://leanprover-community.github.io/archive/stream/238830-Lean-for-the-curious-mathematician-2020/topic/Monday.20afternoon.3A.20metaprogramming.20session.html#203706282">(Jul 13 2020 at 12:07)</a>:</h4>
<p>Can someone post the address for getting the local version of the natural numbers game?</p>



<a name="203706342"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/238830-Lean%20for%20the%20curious%20mathematician%202020/topic/Monday%20afternoon%3A%20metaprogramming%20session/near/203706342" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jeremy Avigad <a href="https://leanprover-community.github.io/archive/stream/238830-Lean-for-the-curious-mathematician-2020/topic/Monday.20afternoon.3A.20metaprogramming.20session.html#203706342">(Jul 13 2020 at 12:07)</a>:</h4>
<p>(the lost levels)</p>



<a name="203706593"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/238830-Lean%20for%20the%20curious%20mathematician%202020/topic/Monday%20afternoon%3A%20metaprogramming%20session/near/203706593" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Amos Turchet <a href="https://leanprover-community.github.io/archive/stream/238830-Lean-for-the-curious-mathematician-2020/topic/Monday.20afternoon.3A.20metaprogramming.20session.html#203706593">(Jul 13 2020 at 12:10)</a>:</h4>
<p>you can see the link here</p>



<a name="203706595"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/238830-Lean%20for%20the%20curious%20mathematician%202020/topic/Monday%20afternoon%3A%20metaprogramming%20session/near/203706595" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Amos Turchet <a href="https://leanprover-community.github.io/archive/stream/238830-Lean-for-the-curious-mathematician-2020/topic/Monday.20afternoon.3A.20metaprogramming.20session.html#203706595">(Jul 13 2020 at 12:10)</a>:</h4>
<p><a href="#narrow/stream/238830-Lean-for.20the.20curious.20mathematician.202020/topic/Mon.20afternoon.3A.20natural.20number.20game/near/203703423">https://leanprover.zulipchat.com/#narrow/stream/238830-Lean-for.20the.20curious.20mathematician.202020/topic/Mon.20afternoon.3A.20natural.20number.20game/near/203703423</a></p>



<a name="203717843"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/238830-Lean%20for%20the%20curious%20mathematician%202020/topic/Monday%20afternoon%3A%20metaprogramming%20session/near/203717843" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Vaibhav Karve <a href="https://leanprover-community.github.io/archive/stream/238830-Lean-for-the-curious-mathematician-2020/topic/Monday.20afternoon.3A.20metaprogramming.20session.html#203717843">(Jul 13 2020 at 13:59)</a>:</h4>
<p><span class="user-mention" data-user-id="110596">@Rob Lewis</span> Thank you for creating these videos. I have only watched <a href="https://github.com/leanprover-community/mathlib/issues/1">#1</a> and <a href="https://github.com/leanprover-community/mathlib/issues/2">#2</a> so far but they are so clearly explained. <span aria-label="clap" class="emoji emoji-1f44f" role="img" title="clap">:clap:</span> My plan is to get through all of your videos as my own pace spread out over this week.</p>



<a name="203718557"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/238830-Lean%20for%20the%20curious%20mathematician%202020/topic/Monday%20afternoon%3A%20metaprogramming%20session/near/203718557" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/238830-Lean-for-the-curious-mathematician-2020/topic/Monday.20afternoon.3A.20metaprogramming.20session.html#203718557">(Jul 13 2020 at 14:05)</a>:</h4>
<p>You're welcome! I hope the clarity stays throughout the series, but no promises ;)</p>



<a name="203732764"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/238830-Lean%20for%20the%20curious%20mathematician%202020/topic/Monday%20afternoon%3A%20metaprogramming%20session/near/203732764" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Matt Earnshaw <a href="https://leanprover-community.github.io/archive/stream/238830-Lean-for-the-curious-mathematician-2020/topic/Monday.20afternoon.3A.20metaprogramming.20session.html#203732764">(Jul 13 2020 at 15:53)</a>:</h4>
<p>yes, thanks very much <span class="user-mention" data-user-id="110596">@Rob Lewis</span>. I have watched 1-4 so far, just what I was looking for to break into lean metaprogramming properly</p>



<a name="203739128"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/238830-Lean%20for%20the%20curious%20mathematician%202020/topic/Monday%20afternoon%3A%20metaprogramming%20session/near/203739128" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/238830-Lean-for-the-curious-mathematician-2020/topic/Monday.20afternoon.3A.20metaprogramming.20session.html#203739128">(Jul 13 2020 at 16:49)</a>:</h4>
<p>Regarding the <code>add_nonneg_proof</code> exercise - after I've done <code>d ← get_decl n</code>, how can I inspect the <code>d</code> object? Neither<code>trace d</code> nor <code>trace (expr.to_raw_fmt d)</code> work, and that exhausts my list of inspection tools.</p>



<a name="203739335"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/238830-Lean%20for%20the%20curious%20mathematician%202020/topic/Monday%20afternoon%3A%20metaprogramming%20session/near/203739335" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/238830-Lean-for-the-curious-mathematician-2020/topic/Monday.20afternoon.3A.20metaprogramming.20session.html#203739335">(Jul 13 2020 at 16:51)</a>:</h4>
<p>Ah, I didn't realize <code>declaration</code> doesn't have a formatting instance. <code>trace d</code> really should work. We can fix that. In the meantime, if you look around <a href="https://leanprover-community.github.io/mathlib_docs/find/declaration">docs#declaration</a> you'll see lots of functions operating on declarations. You can trace <code>d.to_name</code>, <code>d.type</code>, things like that.</p>



<a name="203770249"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/238830-Lean%20for%20the%20curious%20mathematician%202020/topic/Monday%20afternoon%3A%20metaprogramming%20session/near/203770249" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damien Thomine <a href="https://leanprover-community.github.io/archive/stream/238830-Lean-for-the-curious-mathematician-2020/topic/Monday.20afternoon.3A.20metaprogramming.20session.html#203770249">(Jul 13 2020 at 20:57)</a>:</h4>
<p>Nice videos, and I can work on it at my own pace. There is one thing I don't <del>quite</del> understand, on the first exercise (write a tactic for finding contradictions), the following works :</p>
<p><code>do ctx ← local_context,
  exfalso,
  ctx.mfirst ( λ x, do apply x, ctx.mfirst ( λ y, exact y ) )</code></p>
<p>while this doesn't (nor does any variation I tried on this second version):</p>
<p><code>do ctx ← local_context,
  exfalso,
  ctx.mfirst ( λ x, do ctx.mfirst ( λ y, exact (x y) ) )</code></p>
<p>How come?</p>



<a name="203789230"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/238830-Lean%20for%20the%20curious%20mathematician%202020/topic/Monday%20afternoon%3A%20metaprogramming%20session/near/203789230" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/238830-Lean-for-the-curious-mathematician-2020/topic/Monday.20afternoon.3A.20metaprogramming.20session.html#203789230">(Jul 14 2020 at 01:00)</a>:</h4>
<p>What error messages are you getting? Could you post a <a href="https://leanprover-community.github.io/mwe.html">#mwe</a>?</p>



<a name="203798153"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/238830-Lean%20for%20the%20curious%20mathematician%202020/topic/Monday%20afternoon%3A%20metaprogramming%20session/near/203798153" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/238830-Lean-for-the-curious-mathematician-2020/topic/Monday.20afternoon.3A.20metaprogramming.20session.html#203798153">(Jul 14 2020 at 04:38)</a>:</h4>
<p><span class="user-mention" data-user-id="320882">@Damien Thomine</span> My guess (but I'm at about the same level as you) is that you can't simply write <code>(x y)</code>, and you need something like <code>mk_app x [y]</code>.</p>



<a name="203798182"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/238830-Lean%20for%20the%20curious%20mathematician%202020/topic/Monday%20afternoon%3A%20metaprogramming%20session/near/203798182" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/238830-Lean-for-the-curious-mathematician-2020/topic/Monday.20afternoon.3A.20metaprogramming.20session.html#203798182">(Jul 14 2020 at 04:38)</a>:</h4>
<p>Of maybe <code>exact ``(x y)</code> will work?</p>



<a name="203800572"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/238830-Lean%20for%20the%20curious%20mathematician%202020/topic/Monday%20afternoon%3A%20metaprogramming%20session/near/203800572" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/238830-Lean-for-the-curious-mathematician-2020/topic/Monday.20afternoon.3A.20metaprogramming.20session.html#203800572">(Jul 14 2020 at 05:41)</a>:</h4>
<p>maybe with some antiquotations?</p>



<a name="203800617"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/238830-Lean%20for%20the%20curious%20mathematician%202020/topic/Monday%20afternoon%3A%20metaprogramming%20session/near/203800617" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/238830-Lean-for-the-curious-mathematician-2020/topic/Monday.20afternoon.3A.20metaprogramming.20session.html#203800617">(Jul 14 2020 at 05:42)</a>:</h4>
<p>Aah, probably... like I said: I'm very much a beginner myself. So you mean <code>exact ``(%%x %%y)</code> ?</p>



<a name="203800633"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/238830-Lean%20for%20the%20curious%20mathematician%202020/topic/Monday%20afternoon%3A%20metaprogramming%20session/near/203800633" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/238830-Lean-for-the-curious-mathematician-2020/topic/Monday.20afternoon.3A.20metaprogramming.20session.html#203800633">(Jul 14 2020 at 05:43)</a>:</h4>
<p>Yes, but perhaps you need to elaborate it first, with <code>to_expr ``(%%x %%y) &gt;&gt;= exact</code>? I'd have to actually run the code to know.</p>



<a name="203804792"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/238830-Lean%20for%20the%20curious%20mathematician%202020/topic/Monday%20afternoon%3A%20metaprogramming%20session/near/203804792" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Billy Price <a href="https://leanprover-community.github.io/archive/stream/238830-Lean-for-the-curious-mathematician-2020/topic/Monday.20afternoon.3A.20metaprogramming.20session.html#203804792">(Jul 14 2020 at 07:13)</a>:</h4>
<p>Just practicing metaprogramming and I have an issue. As a warmup to what I actually want to do, I'd like to find and print everything in the context that look like this <code>WF Γ A a</code>. It looks like my "is_WF" function is wrong, since the filtered list is always empty. Is it because <code>WF Γ A a</code> actually has the structure <code>((WF Γ) A) a</code>?</p>
<div class="codehilite"><pre><span></span><code><span class="n">meta</span> <span class="n">def</span> <span class="n">is_WF</span> <span class="o">:</span> <span class="n">expr</span> <span class="bp">→</span> <span class="n">bool</span>
<span class="bp">|</span> <span class="bp">`</span><span class="o">(</span><span class="n">TT</span><span class="bp">.</span><span class="n">WF</span> <span class="err">%%</span> <span class="bp">_</span><span class="o">)</span> <span class="o">:=</span> <span class="n">tt</span>
<span class="bp">|</span> <span class="bp">_</span> <span class="o">:=</span> <span class="n">ff</span>

<span class="n">meta</span> <span class="n">def</span> <span class="n">tactic</span><span class="bp">.</span><span class="n">interactive</span><span class="bp">.</span><span class="n">print_WFs</span> <span class="o">:</span> <span class="n">tactic</span> <span class="n">unit</span> <span class="o">:=</span>
<span class="n">do</span>
  <span class="n">x</span> <span class="err">←</span> <span class="n">local_context</span> <span class="bp">&gt;&gt;=</span> <span class="n">list</span><span class="bp">.</span><span class="n">mfilter</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">h</span><span class="o">,</span> <span class="n">do</span> <span class="n">H</span> <span class="err">←</span> <span class="n">infer_type</span> <span class="n">h</span><span class="o">,</span> <span class="n">return</span> <span class="o">(</span><span class="n">is_WF</span> <span class="n">H</span><span class="o">)),</span>
  <span class="n">trace</span> <span class="n">x</span><span class="o">,</span>
  <span class="n">skip</span>
</code></pre></div>



<a name="203804814"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/238830-Lean%20for%20the%20curious%20mathematician%202020/topic/Monday%20afternoon%3A%20metaprogramming%20session/near/203804814" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/238830-Lean-for-the-curious-mathematician-2020/topic/Monday.20afternoon.3A.20metaprogramming.20session.html#203804814">(Jul 14 2020 at 07:13)</a>:</h4>
<p><span class="user-mention" data-user-id="320882">@Damien Thomine</span> You've actually stumbled onto something pretty subtle here.</p>
<p>Your second version should be fine, in principle. <code>x y</code> is equivalent to <code>expr.app x y</code>. Most of the time in your tactic, this is a badly formed expression -- it's something like a proof of B applied to a proof of A, which is type incorrect. Using <code>expr.app</code> doesn't give you any checks on whether your expressions are type correct. But this should be alright, because <code>exact</code> should realize the expression is badly formed and fail.</p>
<p>However, <code>exact</code> takes some shortcuts for efficiency reasons. The vast majority of expressions it gets are well typed. So it doesn't do a full check for correctness. It will notice that the proof of B applied to the proof of A is bad. But if you give it a proof of ¬B applied to a proof of A, I think, it will recognize that you have a function (B → false) applied to an argument and assume the result is of type false, without checking the argument.</p>
<p>So your tactic is actually succeeding. It's closing the goal with a badly formed proof. Of course this isn't valid. When the tactic is done running, the kernel gets its result, and needs to check that it's a term with the type you claim. But it isn't, so the kernel fails. Notice how in your failing example, the error is reported at the word <code>example</code> instead of at the tactic call <code>by contr</code>. Normally, if your tactic was bad, it would report the error at the tactic call.</p>
<div class="codehilite"><pre><span></span><code><span class="n">meta</span> <span class="n">def</span> <span class="n">contr</span> <span class="o">:</span> <span class="n">tactic</span> <span class="n">unit</span> <span class="o">:=</span>
<span class="n">do</span> <span class="n">ctx</span> <span class="err">←</span> <span class="n">local_context</span><span class="o">,</span> <span class="n">exfalso</span><span class="o">,</span> <span class="n">ctx</span><span class="bp">.</span><span class="n">mfirst</span> <span class="o">(</span> <span class="bp">λ</span> <span class="n">x</span><span class="o">,</span> <span class="n">do</span> <span class="n">ctx</span><span class="bp">.</span><span class="n">mfirst</span> <span class="o">(</span> <span class="bp">λ</span> <span class="n">y</span><span class="o">,</span> <span class="n">exact</span> <span class="o">(</span><span class="n">x</span> <span class="n">y</span><span class="o">)</span> <span class="o">)</span> <span class="o">)</span>

<span class="kn">example</span> <span class="o">(</span><span class="n">A</span> <span class="n">B</span> <span class="n">C</span> <span class="o">:</span> <span class="kt">Prop</span><span class="o">)</span> <span class="o">(</span><span class="n">ha</span> <span class="o">:</span> <span class="n">A</span><span class="o">)</span> <span class="o">(</span><span class="n">hb</span> <span class="o">:</span> <span class="n">B</span><span class="o">)</span> <span class="o">(</span><span class="n">hna</span> <span class="o">:</span> <span class="bp">¬</span> <span class="n">A</span><span class="o">)</span> <span class="o">:</span> <span class="n">false</span> <span class="o">:=</span>
<span class="k">by</span> <span class="n">contr</span>
</code></pre></div>


<p>One workaround to this: you can ask the tactic to fully type check the term before feeding it into <code>exact</code>.</p>
<div class="codehilite"><pre><span></span><code><span class="n">meta</span> <span class="n">def</span> <span class="n">contr</span> <span class="o">:</span> <span class="n">tactic</span> <span class="n">unit</span> <span class="o">:=</span>
<span class="n">do</span> <span class="n">ctx</span> <span class="err">←</span> <span class="n">local_context</span><span class="o">,</span> <span class="n">exfalso</span><span class="o">,</span> <span class="n">ctx</span><span class="bp">.</span><span class="n">mfirst</span> <span class="o">(</span> <span class="bp">λ</span> <span class="n">x</span><span class="o">,</span> <span class="n">do</span> <span class="n">ctx</span><span class="bp">.</span><span class="n">mfirst</span> <span class="o">(</span> <span class="bp">λ</span> <span class="n">y</span><span class="o">,</span> <span class="n">do</span> <span class="n">type_check</span> <span class="o">(</span><span class="n">x</span> <span class="n">y</span><span class="o">),</span> <span class="n">exact</span> <span class="o">(</span><span class="n">x</span> <span class="n">y</span><span class="o">)</span> <span class="o">)</span> <span class="o">)</span>

<span class="kn">example</span> <span class="o">(</span><span class="n">A</span> <span class="n">B</span> <span class="n">C</span> <span class="o">:</span> <span class="kt">Prop</span><span class="o">)</span> <span class="o">(</span><span class="n">ha</span> <span class="o">:</span> <span class="n">A</span><span class="o">)</span> <span class="o">(</span><span class="n">hb</span> <span class="o">:</span> <span class="n">B</span><span class="o">)</span> <span class="o">(</span><span class="n">hna</span> <span class="o">:</span> <span class="bp">¬</span> <span class="n">A</span><span class="o">)</span> <span class="o">:</span> <span class="n">false</span> <span class="o">:=</span>
<span class="k">by</span> <span class="n">contr</span>
</code></pre></div>



<a name="203804864"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/238830-Lean%20for%20the%20curious%20mathematician%202020/topic/Monday%20afternoon%3A%20metaprogramming%20session/near/203804864" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/238830-Lean-for-the-curious-mathematician-2020/topic/Monday.20afternoon.3A.20metaprogramming.20session.html#203804864">(Jul 14 2020 at 07:14)</a>:</h4>
<p>This is a very slick solution to the exercise, by the way!</p>



<a name="203804977"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/238830-Lean%20for%20the%20curious%20mathematician%202020/topic/Monday%20afternoon%3A%20metaprogramming%20session/near/203804977" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/238830-Lean-for-the-curious-mathematician-2020/topic/Monday.20afternoon.3A.20metaprogramming.20session.html#203804977">(Jul 14 2020 at 07:16)</a>:</h4>
<p><span class="user-mention" data-user-id="255481">@Billy Price</span> <code>TT.WF</code> takes three arguments? You probably want your match to be <code>`(TT.WF _ _ _) </code>.</p>



<a name="203805007"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/238830-Lean%20for%20the%20curious%20mathematician%202020/topic/Monday%20afternoon%3A%20metaprogramming%20session/near/203805007" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/238830-Lean-for-the-curious-mathematician-2020/topic/Monday.20afternoon.3A.20metaprogramming.20session.html#203805007">(Jul 14 2020 at 07:16)</a>:</h4>
<p>The double <code>%%</code> in that position is used for binding a variable.</p>



<a name="203805029"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/238830-Lean%20for%20the%20curious%20mathematician%202020/topic/Monday%20afternoon%3A%20metaprogramming%20session/near/203805029" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/238830-Lean-for-the-curious-mathematician-2020/topic/Monday.20afternoon.3A.20metaprogramming.20session.html#203805029">(Jul 14 2020 at 07:17)</a>:</h4>
<p>i.e. <code>``(TT.WF %%a %%b _) </code>would let you use <code>a</code> and <code>b</code> on the right hand side.</p>



<a name="203805287"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/238830-Lean%20for%20the%20curious%20mathematician%202020/topic/Monday%20afternoon%3A%20metaprogramming%20session/near/203805287" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Billy Price <a href="https://leanprover-community.github.io/archive/stream/238830-Lean-for-the-curious-mathematician-2020/topic/Monday.20afternoon.3A.20metaprogramming.20session.html#203805287">(Jul 14 2020 at 07:21)</a>:</h4>
<p>Got it</p>



<a name="203805428"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/238830-Lean%20for%20the%20curious%20mathematician%202020/topic/Monday%20afternoon%3A%20metaprogramming%20session/near/203805428" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Billy Price <a href="https://leanprover-community.github.io/archive/stream/238830-Lean-for-the-curious-mathematician-2020/topic/Monday.20afternoon.3A.20metaprogramming.20session.html#203805428">(Jul 14 2020 at 07:24)</a>:</h4>
<p>thanks</p>



<a name="203807250"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/238830-Lean%20for%20the%20curious%20mathematician%202020/topic/Monday%20afternoon%3A%20metaprogramming%20session/near/203807250" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Billy Price <a href="https://leanprover-community.github.io/archive/stream/238830-Lean-for-the-curious-mathematician-2020/topic/Monday.20afternoon.3A.20metaprogramming.20session.html#203807250">(Jul 14 2020 at 07:56)</a>:</h4>
<p>Wow I made something that works, it finds any proofs of well-formedness of complex terms in the context, and uses <code>cases</code> to break it down and bring the simpler well-formedness proofs into the context, which will be caught by my WF_prover tactic.</p>
<div class="codehilite"><pre><span></span><code><span class="n">meta</span> <span class="n">def</span> <span class="n">is_complex_WF</span> <span class="o">:</span> <span class="n">expr</span> <span class="bp">→</span> <span class="n">bool</span>
<span class="bp">|</span> <span class="bp">`</span><span class="o">(</span><span class="n">TT</span><span class="bp">.</span><span class="n">WF</span> <span class="bp">_</span> <span class="bp">_</span> <span class="n">TT</span><span class="bp">.</span><span class="n">term</span><span class="bp">.</span><span class="n">star</span><span class="o">)</span> <span class="o">:=</span> <span class="n">ff</span>
<span class="bp">|</span> <span class="bp">`</span><span class="o">(</span><span class="n">TT</span><span class="bp">.</span><span class="n">WF</span> <span class="bp">_</span> <span class="bp">_</span> <span class="n">TT</span><span class="bp">.</span><span class="n">term</span><span class="bp">.</span><span class="n">top</span><span class="o">)</span> <span class="o">:=</span> <span class="n">ff</span>
<span class="bp">|</span> <span class="bp">`</span><span class="o">(</span><span class="n">TT</span><span class="bp">.</span><span class="n">WF</span> <span class="bp">_</span> <span class="bp">_</span> <span class="n">TT</span><span class="bp">.</span><span class="n">term</span><span class="bp">.</span><span class="n">bot</span><span class="o">)</span> <span class="o">:=</span> <span class="n">ff</span>
<span class="bp">|</span> <span class="bp">`</span><span class="o">(</span><span class="n">TT</span><span class="bp">.</span><span class="n">WF</span> <span class="bp">_</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">)</span> <span class="o">:=</span> <span class="n">tt</span>
<span class="bp">|</span> <span class="bp">_</span> <span class="o">:=</span> <span class="n">ff</span>

<span class="n">meta</span> <span class="n">def</span> <span class="n">tactic</span><span class="bp">.</span><span class="n">interactive</span><span class="bp">.</span><span class="n">reduce_WFs</span> <span class="o">:</span> <span class="n">tactic</span> <span class="n">unit</span> <span class="o">:=</span>
<span class="n">do</span>
  <span class="n">local_context</span> <span class="bp">&gt;&gt;=</span> <span class="n">list</span><span class="bp">.</span><span class="n">mmap&#39;</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">h</span><span class="o">,</span> <span class="n">do</span> <span class="n">H</span> <span class="err">←</span> <span class="n">infer_type</span> <span class="n">h</span><span class="o">,</span> <span class="k">if</span> <span class="o">(</span><span class="n">is_complex_WF</span> <span class="n">H</span><span class="o">)</span> <span class="k">then</span> <span class="o">(</span><span class="n">do</span> <span class="n">cases</span> <span class="n">h</span><span class="o">,</span> <span class="n">skip</span><span class="o">)</span> <span class="k">else</span> <span class="n">skip</span><span class="o">)</span>
</code></pre></div>


<p>Here's a very simple use case,</p>
<div class="codehilite"><pre><span></span><code><span class="kn">example</span> <span class="o">{</span><span class="err">Γ</span> <span class="n">p</span> <span class="n">q</span><span class="o">}</span> <span class="o">:</span> <span class="n">WF</span> <span class="err">Γ</span> <span class="err">Ω</span> <span class="o">(</span><span class="n">p</span> <span class="err">⋀</span> <span class="n">q</span><span class="o">)</span> <span class="bp">→</span> <span class="n">WF</span> <span class="err">Γ</span> <span class="err">Ω</span> <span class="o">(</span><span class="n">p</span> <span class="err">⋁</span> <span class="n">q</span><span class="o">)</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="n">intro</span> <span class="n">wfpq</span><span class="o">,</span>
  <span class="n">reduce_WFs</span><span class="o">,</span>
  <span class="n">WF_prover</span><span class="o">,</span>
<span class="kn">end</span>
</code></pre></div>


<p>edit: forgot my WF_prover in the example proofs, which will essentially just apply <code>WF.or</code> and then grab the two well-formedness proofs we just extracted</p>



<a name="203807582"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/238830-Lean%20for%20the%20curious%20mathematician%202020/topic/Monday%20afternoon%3A%20metaprogramming%20session/near/203807582" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Billy Price <a href="https://leanprover-community.github.io/archive/stream/238830-Lean-for-the-curious-mathematician-2020/topic/Monday.20afternoon.3A.20metaprogramming.20session.html#203807582">(Jul 14 2020 at 08:00)</a>:</h4>
<p>My ambition is to have this work recursively and only pull out the WF proofs which are on variables, like getting just  <code>WF Γ Ω p</code> and <code>WF Γ Ω q</code> from <code>WF Γ Ω (⊤ ⋁ p ⋁ q)</code>. Does this already exist as a tactic?</p>



<a name="203809309"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/238830-Lean%20for%20the%20curious%20mathematician%202020/topic/Monday%20afternoon%3A%20metaprogramming%20session/near/203809309" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/238830-Lean-for-the-curious-mathematician-2020/topic/Monday.20afternoon.3A.20metaprogramming.20session.html#203809309">(Jul 14 2020 at 08:23)</a>:</h4>
<p>There are a few ways you could do that. One way: your tactic could fail if it doesn't destruct anything. Then you can call <code>repeat {reduce_WFs}</code>, which will keep looking for things to destruct until nothing is left. A more efficient way: the <code>cases</code> tactic returns a list of the things it creates. So <code>reduce_WFs</code> could collect all of the new hypotheses that it creates using <code>cases</code>, and recurse on these. You'll want something with <code>list.mfoldl</code> instead of <code>mmap'</code>.</p>



<a name="203810272"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/238830-Lean%20for%20the%20curious%20mathematician%202020/topic/Monday%20afternoon%3A%20metaprogramming%20session/near/203810272" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Billy Price <a href="https://leanprover-community.github.io/archive/stream/238830-Lean-for-the-curious-mathematician-2020/topic/Monday.20afternoon.3A.20metaprogramming.20session.html#203810272">(Jul 14 2020 at 08:36)</a>:</h4>
<p>Can I prevent the <code>cases</code> tactic from adding the results to the context? And can I make it so that <code>apply_rules WF_rules</code> has access to the local context and also that list of well-formedness things I extracted?</p>



<a name="203810722"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/238830-Lean%20for%20the%20curious%20mathematician%202020/topic/Monday%20afternoon%3A%20metaprogramming%20session/near/203810722" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/238830-Lean-for-the-curious-mathematician-2020/topic/Monday.20afternoon.3A.20metaprogramming.20session.html#203810722">(Jul 14 2020 at 08:42)</a>:</h4>
<p>I may be missing some context here... But no, I don't think you can stop <code>cases</code> from adding things to the context. Maybe you could <code>clear</code> things you don't want after. I'm not sure where <code>apply_rule</code> first into the picture.</p>



<a name="203814534"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/238830-Lean%20for%20the%20curious%20mathematician%202020/topic/Monday%20afternoon%3A%20metaprogramming%20session/near/203814534" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damien Thomine <a href="https://leanprover-community.github.io/archive/stream/238830-Lean-for-the-curious-mathematician-2020/topic/Monday.20afternoon.3A.20metaprogramming.20session.html#203814534">(Jul 14 2020 at 09:37)</a>:</h4>
<p>Thank you very much for the explanation!</p>



<a name="203818231"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/238830-Lean%20for%20the%20curious%20mathematician%202020/topic/Monday%20afternoon%3A%20metaprogramming%20session/near/203818231" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Billy Price <a href="https://leanprover-community.github.io/archive/stream/238830-Lean-for-the-curious-mathematician-2020/topic/Monday.20afternoon.3A.20metaprogramming.20session.html#203818231">(Jul 14 2020 at 10:31)</a>:</h4>
<p><code>WF_rules</code> contains things like <code>WF.or   {Γ p q}     : WF Γ Ω p → WF Γ Ω q → WF Γ Ω (p ⋁ q)</code>, so <code>apply_rules WF_rules</code> keeps hitting the target and resulting targets with appropriate rules (or assumption) until it can't make any more progress. In <br>
 the process of explaining that - I've found what apply_rules is under the hood, and I think I can pick this apart to do what I want. Thanks for introducing me to metaprogramming! I can read this stuff now.</p>



<a name="203819133"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/238830-Lean%20for%20the%20curious%20mathematician%202020/topic/Monday%20afternoon%3A%20metaprogramming%20session/near/203819133" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Billy Price <a href="https://leanprover-community.github.io/archive/stream/238830-Lean-for-the-curious-mathematician-2020/topic/Monday.20afternoon.3A.20metaprogramming.20session.html#203819133">(Jul 14 2020 at 10:43)</a>:</h4>
<p>Does <code>meta constant</code> mean it was implemented in C++?</p>
<p><code>meta constant cases_core (h : expr) (ns : list name := []) (md := semireducible) : tactic (list (name × list expr × list (name × expr)))</code></p>



<a name="203819248"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/238830-Lean%20for%20the%20curious%20mathematician%202020/topic/Monday%20afternoon%3A%20metaprogramming%20session/near/203819248" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/238830-Lean-for-the-curious-mathematician-2020/topic/Monday.20afternoon.3A.20metaprogramming.20session.html#203819248">(Jul 14 2020 at 10:45)</a>:</h4>
<p>yes</p>



<a name="203819325"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/238830-Lean%20for%20the%20curious%20mathematician%202020/topic/Monday%20afternoon%3A%20metaprogramming%20session/near/203819325" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/238830-Lean-for-the-curious-mathematician-2020/topic/Monday.20afternoon.3A.20metaprogramming.20session.html#203819325">(Jul 14 2020 at 10:46)</a>:</h4>
<p>well, it's not a necessity but a pretty strong correlation. Pretty much all <code>meta constant</code>s in lean core have built in implementations in C++</p>



<a name="203819395"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/238830-Lean%20for%20the%20curious%20mathematician%202020/topic/Monday%20afternoon%3A%20metaprogramming%20session/near/203819395" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/238830-Lean-for-the-curious-mathematician-2020/topic/Monday.20afternoon.3A.20metaprogramming.20session.html#203819395">(Jul 14 2020 at 10:47)</a>:</h4>
<p><a href="https://github.com/leanprover-community/lean/blob/master/src/library/tactic/cases_tactic.cpp#L648-L678">https://github.com/leanprover-community/lean/blob/master/src/library/tactic/cases_tactic.cpp#L648-L678</a></p>



<a name="203819482"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/238830-Lean%20for%20the%20curious%20mathematician%202020/topic/Monday%20afternoon%3A%20metaprogramming%20session/near/203819482" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Billy Price <a href="https://leanprover-community.github.io/archive/stream/238830-Lean-for-the-curious-mathematician-2020/topic/Monday.20afternoon.3A.20metaprogramming.20session.html#203819482">(Jul 14 2020 at 10:49)</a>:</h4>
<p>Is is possible to do what cases does without spilling the results into the local context? Just collect them into a list?</p>



<a name="203819575"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/238830-Lean%20for%20the%20curious%20mathematician%202020/topic/Monday%20afternoon%3A%20metaprogramming%20session/near/203819575" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/238830-Lean-for-the-curious-mathematician-2020/topic/Monday.20afternoon.3A.20metaprogramming.20session.html#203819575">(Jul 14 2020 at 10:50)</a>:</h4>
<p>collect what?</p>



<a name="203819593"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/238830-Lean%20for%20the%20curious%20mathematician%202020/topic/Monday%20afternoon%3A%20metaprogramming%20session/near/203819593" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/238830-Lean-for-the-curious-mathematician-2020/topic/Monday.20afternoon.3A.20metaprogramming.20session.html#203819593">(Jul 14 2020 at 10:51)</a>:</h4>
<p>the metavariables that cases produces exist in an extended context</p>



<a name="203819625"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/238830-Lean%20for%20the%20curious%20mathematician%202020/topic/Monday%20afternoon%3A%20metaprogramming%20session/near/203819625" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Billy Price <a href="https://leanprover-community.github.io/archive/stream/238830-Lean-for-the-curious-mathematician-2020/topic/Monday.20afternoon.3A.20metaprogramming.20session.html#203819625">(Jul 14 2020 at 10:51)</a>:</h4>
<p>In my mind, if I have <code>h : WF Γ Ω (p ⋁ q)</code>, cases is a magic machine that gives me <code>h_1 : WF Γ Ω q</code> and <code>h_2 : WF Γ Ω p</code>. That's all I want out of it.</p>



<a name="203819687"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/238830-Lean%20for%20the%20curious%20mathematician%202020/topic/Monday%20afternoon%3A%20metaprogramming%20session/near/203819687" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/238830-Lean-for-the-curious-mathematician-2020/topic/Monday.20afternoon.3A.20metaprogramming.20session.html#203819687">(Jul 14 2020 at 10:52)</a>:</h4>
<p>What do you get instead?</p>



<a name="203819981"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/238830-Lean%20for%20the%20curious%20mathematician%202020/topic/Monday%20afternoon%3A%20metaprogramming%20session/near/203819981" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Billy Price <a href="https://leanprover-community.github.io/archive/stream/238830-Lean-for-the-curious-mathematician-2020/topic/Monday.20afternoon.3A.20metaprogramming.20session.html#203819981">(Jul 14 2020 at 10:56)</a>:</h4>
<p>I want the machine to deliver that as a <code>list expr</code> (I think) in my meta code so that I can feed it to <code>meta def apply_rules (hs : list pexpr) (n : nat) : tactic unit</code> (the one in tactic.core), and not dump all the results into the interactive context.</p>



<a name="203820108"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/238830-Lean%20for%20the%20curious%20mathematician%202020/topic/Monday%20afternoon%3A%20metaprogramming%20session/near/203820108" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Billy Price <a href="https://leanprover-community.github.io/archive/stream/238830-Lean-for-the-curious-mathematician-2020/topic/Monday.20afternoon.3A.20metaprogramming.20session.html#203820108">(Jul 14 2020 at 10:58)</a>:</h4>
<p>To directly answer your question it does work as I described - I just want it to not put the results into the context, just use them to prove stuff and then throw them away.</p>



<a name="203820179"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/238830-Lean%20for%20the%20curious%20mathematician%202020/topic/Monday%20afternoon%3A%20metaprogramming%20session/near/203820179" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/238830-Lean-for-the-curious-mathematician-2020/topic/Monday.20afternoon.3A.20metaprogramming.20session.html#203820179">(Jul 14 2020 at 10:59)</a>:</h4>
<p>perhaps you should prove theorems like <code>WF Γ Ω (p ⋁ q) -&gt; WF Γ Ω p</code> and use them as necessary</p>



<a name="203820248"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/238830-Lean%20for%20the%20curious%20mathematician%202020/topic/Monday%20afternoon%3A%20metaprogramming%20session/near/203820248" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Billy Price <a href="https://leanprover-community.github.io/archive/stream/238830-Lean-for-the-curious-mathematician-2020/topic/Monday.20afternoon.3A.20metaprogramming.20session.html#203820248">(Jul 14 2020 at 11:00)</a>:</h4>
<p>Oh of course! Thanks :)</p>



<a name="203820274"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/238830-Lean%20for%20the%20curious%20mathematician%202020/topic/Monday%20afternoon%3A%20metaprogramming%20session/near/203820274" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/238830-Lean-for-the-curious-mathematician-2020/topic/Monday.20afternoon.3A.20metaprogramming.20session.html#203820274">(Jul 14 2020 at 11:00)</a>:</h4>
<p>you can also scope subproofs so that the cases is only used to prove an intermediate statement</p>



<a name="203820322"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/238830-Lean%20for%20the%20curious%20mathematician%202020/topic/Monday%20afternoon%3A%20metaprogramming%20session/near/203820322" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/238830-Lean-for-the-curious-mathematician-2020/topic/Monday.20afternoon.3A.20metaprogramming.20session.html#203820322">(Jul 14 2020 at 11:01)</a>:</h4>
<p>i.e. <code>have : WF Γ Ω p, { cases h, assumption }</code></p>



<a name="204053042"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/238830-Lean%20for%20the%20curious%20mathematician%202020/topic/Monday%20afternoon%3A%20metaprogramming%20session/near/204053042" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Billy Price <a href="https://leanprover-community.github.io/archive/stream/238830-Lean-for-the-curious-mathematician-2020/topic/Monday.20afternoon.3A.20metaprogramming.20session.html#204053042">(Jul 16 2020 at 07:25)</a>:</h4>
<p>I can't do this because <code>h</code> is an expr, what am I supposed to do? I ambivalent to the use of cases, can I just retrieve the result of applying this function?</p>
<div class="codehilite"><pre><span></span><code><span class="kn">lemma</span> <span class="n">WF</span><span class="bp">.</span><span class="n">and_elim</span>  <span class="o">:</span> <span class="n">WF</span> <span class="err">Γ</span> <span class="err">Ω&#39;</span> <span class="o">(</span><span class="n">p</span> <span class="err">⋀</span> <span class="n">q</span><span class="o">)</span> <span class="bp">→</span> <span class="n">WF</span> <span class="err">Γ</span> <span class="err">Ω&#39;</span> <span class="n">p</span> <span class="bp">∧</span> <span class="n">WF</span> <span class="err">Γ</span> <span class="err">Ω&#39;</span> <span class="n">q</span> <span class="o">:=</span> <span class="k">by</span> <span class="o">{</span><span class="n">intro</span> <span class="n">h</span><span class="o">,</span> <span class="n">cases</span> <span class="n">h</span><span class="o">,</span> <span class="n">tidy</span><span class="o">}</span>

<span class="n">meta</span> <span class="n">def</span> <span class="n">decompose_WF</span> <span class="o">:</span> <span class="n">expr</span> <span class="bp">→</span> <span class="n">expr</span> <span class="bp">→</span> <span class="n">list</span> <span class="n">expr</span>
<span class="bp">|</span> <span class="bp">_</span> <span class="bp">`</span><span class="o">(</span><span class="n">TT</span><span class="bp">.</span><span class="n">WF</span> <span class="bp">_</span> <span class="bp">_</span> <span class="n">TT</span><span class="bp">.</span><span class="n">term</span><span class="bp">.</span><span class="n">star</span><span class="o">)</span> <span class="o">:=</span> <span class="o">[]</span>
<span class="bp">|</span> <span class="bp">_</span> <span class="bp">`</span><span class="o">(</span><span class="n">TT</span><span class="bp">.</span><span class="n">WF</span> <span class="bp">_</span> <span class="bp">_</span> <span class="n">TT</span><span class="bp">.</span><span class="n">term</span><span class="bp">.</span><span class="n">top</span><span class="o">)</span> <span class="o">:=</span> <span class="o">[]</span>
<span class="bp">|</span> <span class="bp">_</span> <span class="bp">`</span><span class="o">(</span><span class="n">TT</span><span class="bp">.</span><span class="n">WF</span> <span class="bp">_</span> <span class="bp">_</span> <span class="n">TT</span><span class="bp">.</span><span class="n">term</span><span class="bp">.</span><span class="n">bot</span><span class="o">)</span> <span class="o">:=</span> <span class="o">[]</span>
<span class="bp">|</span> <span class="n">h</span> <span class="bp">`</span><span class="o">(</span><span class="n">TT</span><span class="bp">.</span><span class="n">WF</span> <span class="bp">_</span> <span class="bp">_</span> <span class="o">(</span><span class="n">TT</span><span class="bp">.</span><span class="n">term</span><span class="bp">.</span><span class="n">and</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">))</span> <span class="o">:=</span> <span class="n">cases</span> <span class="o">(</span><span class="n">TT</span><span class="bp">.</span><span class="n">WF</span><span class="bp">.</span><span class="n">and_elim</span> <span class="n">h</span><span class="o">)</span>
<span class="c1">-- other cases omitted</span>
</code></pre></div>



<a name="204054135"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/238830-Lean%20for%20the%20curious%20mathematician%202020/topic/Monday%20afternoon%3A%20metaprogramming%20session/near/204054135" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Billy Price <a href="https://leanprover-community.github.io/archive/stream/238830-Lean-for-the-curious-mathematician-2020/topic/Monday.20afternoon.3A.20metaprogramming.20session.html#204054135">(Jul 16 2020 at 07:40)</a>:</h4>
<p>Here's an improved version, thought now I get errors (pasted below) why can't it figure out those implicit arguments?</p>
<div class="codehilite"><pre><span></span><code><span class="n">meta</span> <span class="n">def</span> <span class="n">decompose_WF</span> <span class="o">:</span> <span class="n">expr</span> <span class="bp">→</span> <span class="n">expr</span> <span class="bp">→</span> <span class="n">tactic</span> <span class="o">(</span><span class="n">list</span> <span class="o">(</span><span class="n">name</span> <span class="bp">×</span> <span class="n">list</span> <span class="n">expr</span><span class="o">))</span>
<span class="bp">|</span> <span class="bp">_</span> <span class="bp">`</span><span class="o">(</span><span class="n">TT</span><span class="bp">.</span><span class="n">WF</span> <span class="bp">_</span> <span class="bp">_</span> <span class="n">TT</span><span class="bp">.</span><span class="n">term</span><span class="bp">.</span><span class="n">star</span><span class="o">)</span> <span class="o">:=</span> <span class="n">return</span> <span class="o">[]</span>
<span class="bp">|</span> <span class="bp">_</span> <span class="bp">`</span><span class="o">(</span><span class="n">TT</span><span class="bp">.</span><span class="n">WF</span> <span class="bp">_</span> <span class="bp">_</span> <span class="n">TT</span><span class="bp">.</span><span class="n">term</span><span class="bp">.</span><span class="n">top</span><span class="o">)</span> <span class="o">:=</span> <span class="n">return</span> <span class="o">[]</span>
<span class="bp">|</span> <span class="bp">_</span> <span class="bp">`</span><span class="o">(</span><span class="n">TT</span><span class="bp">.</span><span class="n">WF</span> <span class="bp">_</span> <span class="bp">_</span> <span class="n">TT</span><span class="bp">.</span><span class="n">term</span><span class="bp">.</span><span class="n">bot</span><span class="o">)</span> <span class="o">:=</span> <span class="n">return</span> <span class="o">[]</span>
<span class="bp">|</span> <span class="n">h</span> <span class="bp">`</span><span class="o">(</span><span class="n">TT</span><span class="bp">.</span><span class="n">WF</span> <span class="bp">_</span> <span class="bp">_</span> <span class="o">(</span><span class="n">TT</span><span class="bp">.</span><span class="n">term</span><span class="bp">.</span><span class="n">and</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">))</span> <span class="o">:=</span> <span class="n">cases</span> <span class="o">(</span><span class="n">expr</span><span class="bp">.</span><span class="n">app</span> <span class="bp">`</span><span class="o">(</span><span class="n">TT</span><span class="bp">.</span><span class="n">WF</span><span class="bp">.</span><span class="n">and_elim</span><span class="o">)</span> <span class="n">h</span><span class="o">)</span>
<span class="bp">|</span> <span class="n">h</span> <span class="bp">`</span><span class="o">(</span><span class="n">TT</span><span class="bp">.</span><span class="n">WF</span> <span class="bp">_</span> <span class="bp">_</span> <span class="o">(</span><span class="n">TT</span><span class="bp">.</span><span class="n">term</span><span class="bp">.</span><span class="n">or</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">))</span> <span class="o">:=</span> <span class="n">cases</span> <span class="o">(</span><span class="n">expr</span><span class="bp">.</span><span class="n">app</span> <span class="bp">`</span><span class="o">(</span><span class="n">TT</span><span class="bp">.</span><span class="n">WF</span><span class="bp">.</span><span class="n">or_elim</span><span class="o">)</span> <span class="n">h</span><span class="o">)</span>
<span class="bp">|</span> <span class="n">h</span> <span class="bp">`</span><span class="o">(</span><span class="n">TT</span><span class="bp">.</span><span class="n">WF</span> <span class="bp">_</span> <span class="bp">_</span> <span class="o">(</span><span class="n">TT</span><span class="bp">.</span><span class="n">term</span><span class="bp">.</span><span class="n">imp</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">))</span> <span class="o">:=</span> <span class="n">cases</span> <span class="o">(</span><span class="n">expr</span><span class="bp">.</span><span class="n">app</span> <span class="bp">`</span><span class="o">(</span><span class="n">TT</span><span class="bp">.</span><span class="n">WF</span><span class="bp">.</span><span class="n">imp_elim</span><span class="o">)</span> <span class="n">h</span><span class="o">)</span>
<span class="bp">|</span> <span class="n">h</span> <span class="bp">`</span><span class="o">(</span><span class="n">TT</span><span class="bp">.</span><span class="n">WF</span> <span class="bp">_</span> <span class="bp">_</span> <span class="o">(</span><span class="n">TT</span><span class="bp">.</span><span class="n">term</span><span class="bp">.</span><span class="n">pair</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">))</span> <span class="o">:=</span> <span class="n">cases</span> <span class="o">(</span><span class="n">expr</span><span class="bp">.</span><span class="n">app</span> <span class="bp">`</span><span class="o">(</span><span class="n">TT</span><span class="bp">.</span><span class="n">WF</span><span class="bp">.</span><span class="n">pair_elim</span><span class="o">)</span> <span class="n">h</span><span class="o">)</span>
<span class="bp">|</span> <span class="n">h</span> <span class="bp">`</span><span class="o">(</span><span class="n">TT</span><span class="bp">.</span><span class="n">WF</span> <span class="bp">_</span> <span class="bp">_</span> <span class="o">(</span><span class="n">TT</span><span class="bp">.</span><span class="n">term</span><span class="bp">.</span><span class="n">comp</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">))</span> <span class="o">:=</span> <span class="n">cases</span> <span class="o">(</span><span class="n">expr</span><span class="bp">.</span><span class="n">app</span> <span class="bp">`</span><span class="o">(</span><span class="n">TT</span><span class="bp">.</span><span class="n">WF</span><span class="bp">.</span><span class="n">comp_elim</span><span class="o">)</span> <span class="n">h</span><span class="o">)</span>
<span class="bp">|</span> <span class="n">h</span> <span class="bp">`</span><span class="o">(</span><span class="n">TT</span><span class="bp">.</span><span class="n">WF</span> <span class="bp">_</span> <span class="bp">_</span> <span class="o">(</span><span class="n">TT</span><span class="bp">.</span><span class="n">term</span><span class="bp">.</span><span class="n">all</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">))</span> <span class="o">:=</span> <span class="n">cases</span> <span class="o">(</span><span class="n">expr</span><span class="bp">.</span><span class="n">app</span> <span class="bp">`</span><span class="o">(</span><span class="n">TT</span><span class="bp">.</span><span class="n">WF</span><span class="bp">.</span><span class="n">all_elim</span><span class="o">)</span> <span class="n">h</span><span class="o">)</span>
<span class="bp">|</span> <span class="n">h</span> <span class="bp">`</span><span class="o">(</span><span class="n">TT</span><span class="bp">.</span><span class="n">WF</span> <span class="bp">_</span> <span class="bp">_</span> <span class="o">(</span><span class="n">TT</span><span class="bp">.</span><span class="n">term</span><span class="bp">.</span><span class="n">ex</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">))</span> <span class="o">:=</span> <span class="n">cases</span> <span class="o">(</span><span class="n">expr</span><span class="bp">.</span><span class="n">app</span> <span class="bp">`</span><span class="o">(</span><span class="n">TT</span><span class="bp">.</span><span class="n">WF</span><span class="bp">.</span><span class="n">ex_elim</span><span class="o">)</span> <span class="n">h</span><span class="o">)</span>
<span class="bp">|</span> <span class="bp">_</span> <span class="bp">_</span> <span class="o">:=</span> <span class="n">return</span> <span class="o">[]</span>
</code></pre></div>


<div class="codehilite"><pre><span></span><code><span class="n">TT</span><span class="bp">.</span><span class="n">WF</span><span class="bp">.</span><span class="n">and_elim</span> <span class="o">:</span> <span class="bp">∀</span> <span class="o">{</span><span class="err">Γ</span> <span class="o">:</span> <span class="n">list</span> <span class="n">TT</span><span class="bp">.</span><span class="n">type</span><span class="o">}</span> <span class="o">{</span><span class="n">p</span> <span class="n">q</span> <span class="o">:</span> <span class="n">TT</span><span class="bp">.</span><span class="n">term</span><span class="o">}</span> <span class="o">{</span><span class="err">Ω&#39;</span> <span class="o">:</span> <span class="n">TT</span><span class="bp">.</span><span class="n">type</span><span class="o">},</span> <span class="n">TT</span><span class="bp">.</span><span class="n">WF</span> <span class="err">Γ</span> <span class="err">Ω&#39;</span> <span class="o">(</span><span class="n">p</span> <span class="err">⋀</span> <span class="n">q</span><span class="o">)</span> <span class="bp">→</span> <span class="n">TT</span><span class="bp">.</span><span class="n">WF</span> <span class="err">Γ</span> <span class="err">Ω&#39;</span> <span class="n">p</span> <span class="bp">∧</span> <span class="n">TT</span><span class="bp">.</span><span class="n">WF</span> <span class="err">Γ</span> <span class="err">Ω&#39;</span> <span class="n">q</span>
<span class="n">don&#39;t</span> <span class="n">know</span> <span class="n">how</span> <span class="n">to</span> <span class="n">synthesize</span> <span class="n">placeholder</span>
<span class="kn">context</span><span class="o">:</span>
<span class="n">decompose_WF</span> <span class="o">:</span> <span class="n">expr</span> <span class="bp">→</span> <span class="n">expr</span> <span class="bp">→</span> <span class="n">tactic</span> <span class="o">(</span><span class="n">list</span> <span class="o">(</span><span class="n">name</span> <span class="bp">×</span> <span class="n">list</span> <span class="n">expr</span><span class="o">)),</span>
<span class="n">h</span> <span class="o">:</span> <span class="n">expr</span><span class="o">,</span>
<span class="bp">_</span><span class="n">x</span> <span class="o">:</span> <span class="n">list</span> <span class="n">level</span><span class="o">,</span>
<span class="bp">_</span><span class="n">x</span> <span class="bp">_</span><span class="n">x</span> <span class="o">:</span> <span class="n">expr</span><span class="o">,</span>
<span class="bp">_</span><span class="n">x</span> <span class="o">:</span> <span class="n">list</span> <span class="n">level</span><span class="o">,</span>
<span class="bp">_</span><span class="n">x</span> <span class="bp">_</span><span class="n">x</span> <span class="o">:</span> <span class="n">expr</span>
<span class="err">⊢</span> <span class="n">list</span> <span class="n">TT</span><span class="bp">.</span><span class="n">typeLean</span>

<span class="n">don&#39;t</span> <span class="n">know</span> <span class="n">how</span> <span class="n">to</span> <span class="n">synthesize</span> <span class="n">placeholder</span>
<span class="kn">context</span><span class="o">:</span>
<span class="n">decompose_WF</span> <span class="o">:</span> <span class="n">expr</span> <span class="bp">→</span> <span class="n">expr</span> <span class="bp">→</span> <span class="n">tactic</span> <span class="o">(</span><span class="n">list</span> <span class="o">(</span><span class="n">name</span> <span class="bp">×</span> <span class="n">list</span> <span class="n">expr</span><span class="o">)),</span>
<span class="n">h</span> <span class="o">:</span> <span class="n">expr</span><span class="o">,</span>
<span class="bp">_</span><span class="n">x</span> <span class="o">:</span> <span class="n">list</span> <span class="n">level</span><span class="o">,</span>
<span class="bp">_</span><span class="n">x</span> <span class="bp">_</span><span class="n">x</span> <span class="o">:</span> <span class="n">expr</span><span class="o">,</span>
<span class="bp">_</span><span class="n">x</span> <span class="o">:</span> <span class="n">list</span> <span class="n">level</span><span class="o">,</span>
<span class="bp">_</span><span class="n">x</span> <span class="bp">_</span><span class="n">x</span> <span class="o">:</span> <span class="n">expr</span>
<span class="err">⊢</span> <span class="n">TT</span><span class="bp">.</span><span class="n">typeLean</span>

<span class="n">don&#39;t</span> <span class="n">know</span> <span class="n">how</span> <span class="n">to</span> <span class="n">synthesize</span> <span class="n">placeholder</span>
<span class="kn">context</span><span class="o">:</span>
<span class="n">decompose_WF</span> <span class="o">:</span> <span class="n">expr</span> <span class="bp">→</span> <span class="n">expr</span> <span class="bp">→</span> <span class="n">tactic</span> <span class="o">(</span><span class="n">list</span> <span class="o">(</span><span class="n">name</span> <span class="bp">×</span> <span class="n">list</span> <span class="n">expr</span><span class="o">)),</span>
<span class="n">h</span> <span class="o">:</span> <span class="n">expr</span><span class="o">,</span>
<span class="bp">_</span><span class="n">x</span> <span class="o">:</span> <span class="n">list</span> <span class="n">level</span><span class="o">,</span>
<span class="bp">_</span><span class="n">x</span> <span class="bp">_</span><span class="n">x</span> <span class="o">:</span> <span class="n">expr</span><span class="o">,</span>
<span class="bp">_</span><span class="n">x</span> <span class="o">:</span> <span class="n">list</span> <span class="n">level</span><span class="o">,</span>
<span class="bp">_</span><span class="n">x</span> <span class="bp">_</span><span class="n">x</span> <span class="o">:</span> <span class="n">expr</span>
<span class="err">⊢</span> <span class="n">TT</span><span class="bp">.</span><span class="n">termLean</span>

<span class="n">don&#39;t</span> <span class="n">know</span> <span class="n">how</span> <span class="n">to</span> <span class="n">synthesize</span> <span class="n">placeholder</span>
<span class="kn">context</span><span class="o">:</span>
<span class="n">decompose_WF</span> <span class="o">:</span> <span class="n">expr</span> <span class="bp">→</span> <span class="n">expr</span> <span class="bp">→</span> <span class="n">tactic</span> <span class="o">(</span><span class="n">list</span> <span class="o">(</span><span class="n">name</span> <span class="bp">×</span> <span class="n">list</span> <span class="n">expr</span><span class="o">)),</span>
<span class="n">h</span> <span class="o">:</span> <span class="n">expr</span><span class="o">,</span>
<span class="bp">_</span><span class="n">x</span> <span class="o">:</span> <span class="n">list</span> <span class="n">level</span><span class="o">,</span>
<span class="bp">_</span><span class="n">x</span> <span class="bp">_</span><span class="n">x</span> <span class="o">:</span> <span class="n">expr</span><span class="o">,</span>
<span class="bp">_</span><span class="n">x</span> <span class="o">:</span> <span class="n">list</span> <span class="n">level</span><span class="o">,</span>
<span class="bp">_</span><span class="n">x</span> <span class="bp">_</span><span class="n">x</span> <span class="o">:</span> <span class="n">expr</span>
<span class="err">⊢</span> <span class="n">TT</span><span class="bp">.</span><span class="n">termLean</span>
</code></pre></div>



<a name="204057493"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/238830-Lean%20for%20the%20curious%20mathematician%202020/topic/Monday%20afternoon%3A%20metaprogramming%20session/near/204057493" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/238830-Lean-for-the-curious-mathematician-2020/topic/Monday.20afternoon.3A.20metaprogramming.20session.html#204057493">(Jul 16 2020 at 08:25)</a>:</h4>
<p>Remember that using <code>expr.app</code> directly doesn't do any kind of unification or type inference at all. When you write <code>`(TT.WF.and_elim)</code> Lean has no idea what the implicit arguments should be, and using <code>expr.app</code> to apply it to <code>h</code> won't help.</p>



<a name="204057565"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/238830-Lean%20for%20the%20curious%20mathematician%202020/topic/Monday%20afternoon%3A%20metaprogramming%20session/near/204057565" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/238830-Lean-for-the-curious-mathematician-2020/topic/Monday.20afternoon.3A.20metaprogramming.20session.html#204057565">(Jul 16 2020 at 08:26)</a>:</h4>
<p>You probably want something like <code>e ← mk_app `TT.WF.and_elim [h], cases e</code></p>



<a name="204059687"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/238830-Lean%20for%20the%20curious%20mathematician%202020/topic/Monday%20afternoon%3A%20metaprogramming%20session/near/204059687" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/238830-Lean-for-the-curious-mathematician-2020/topic/Monday.20afternoon.3A.20metaprogramming.20session.html#204059687">(Jul 16 2020 at 08:54)</a>:</h4>
<p>For anyone who followed my metaprogramming tutorial and is looking for more practice: I posted <a href="#narrow/stream/239415-metaprogramming-.2F.20tactics/topic/linarith.20preprocessing">a topic in the metaprogramming stream here</a> with a proposal that came up yesterday. With what you learned from the videos and a bit of ingenuity, this project is totally in scope.</p>



<a name="204065842"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/238830-Lean%20for%20the%20curious%20mathematician%202020/topic/Monday%20afternoon%3A%20metaprogramming%20session/near/204065842" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Billy Price <a href="https://leanprover-community.github.io/archive/stream/238830-Lean-for-the-curious-mathematician-2020/topic/Monday.20afternoon.3A.20metaprogramming.20session.html#204065842">(Jul 16 2020 at 10:13)</a>:</h4>
<p>Cool thanks :). While debugging, I noticed my tactic wouldn't update its behaviour in other files that import it, after I make a change. Once I restart the lean server, it updates. Is this expected behaviour, something wrong with my setup or a bug in Lean?</p>



<a name="204074559"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/238830-Lean%20for%20the%20curious%20mathematician%202020/topic/Monday%20afternoon%3A%20metaprogramming%20session/near/204074559" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/238830-Lean-for-the-curious-mathematician-2020/topic/Monday.20afternoon.3A.20metaprogramming.20session.html#204074559">(Jul 16 2020 at 12:12)</a>:</h4>
<p>This isn't expected and I haven't seen it before. Are you using any custom flags for the Lean process?</p>



<a name="204074600"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/238830-Lean%20for%20the%20curious%20mathematician%202020/topic/Monday%20afternoon%3A%20metaprogramming%20session/near/204074600" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Billy Price <a href="https://leanprover-community.github.io/archive/stream/238830-Lean-for-the-curious-mathematician-2020/topic/Monday.20afternoon.3A.20metaprogramming.20session.html#204074600">(Jul 16 2020 at 12:12)</a>:</h4>
<p>I don't know what that is</p>



<a name="204074624"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/238830-Lean%20for%20the%20curious%20mathematician%202020/topic/Monday%20afternoon%3A%20metaprogramming%20session/near/204074624" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/238830-Lean-for-the-curious-mathematician-2020/topic/Monday.20afternoon.3A.20metaprogramming.20session.html#204074624">(Jul 16 2020 at 12:12)</a>:</h4>
<p>Then probably not.</p>



<a name="204074706"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/238830-Lean%20for%20the%20curious%20mathematician%202020/topic/Monday%20afternoon%3A%20metaprogramming%20session/near/204074706" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/238830-Lean-for-the-curious-mathematician-2020/topic/Monday.20afternoon.3A.20metaprogramming.20session.html#204074706">(Jul 16 2020 at 12:13)</a>:</h4>
<p>What if you change the type of a declaration that's used in an imported file, does it notice that?</p>



<a name="204075047"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/238830-Lean%20for%20the%20curious%20mathematician%202020/topic/Monday%20afternoon%3A%20metaprogramming%20session/near/204075047" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Billy Price <a href="https://leanprover-community.github.io/archive/stream/238830-Lean-for-the-curious-mathematician-2020/topic/Monday.20afternoon.3A.20metaprogramming.20session.html#204075047">(Jul 16 2020 at 12:17)</a>:</h4>
<p>It doesn't notice that, in fact it doesn't even recognise anything newly declared in the imported file until I restart the lean server</p>



<a name="204075134"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/238830-Lean%20for%20the%20curious%20mathematician%202020/topic/Monday%20afternoon%3A%20metaprogramming%20session/near/204075134" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/238830-Lean-for-the-curious-mathematician-2020/topic/Monday.20afternoon.3A.20metaprogramming.20session.html#204075134">(Jul 16 2020 at 12:18)</a>:</h4>
<p>Is this in VSCode?</p>



<a name="204075140"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/238830-Lean%20for%20the%20curious%20mathematician%202020/topic/Monday%20afternoon%3A%20metaprogramming%20session/near/204075140" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Billy Price <a href="https://leanprover-community.github.io/archive/stream/238830-Lean-for-the-curious-mathematician-2020/topic/Monday.20afternoon.3A.20metaprogramming.20session.html#204075140">(Jul 16 2020 at 12:18)</a>:</h4>
<p>yes</p>



<a name="204075279"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/238830-Lean%20for%20the%20curious%20mathematician%202020/topic/Monday%20afternoon%3A%20metaprogramming%20session/near/204075279" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Billy Price <a href="https://leanprover-community.github.io/archive/stream/238830-Lean-for-the-curious-mathematician-2020/topic/Monday.20afternoon.3A.20metaprogramming.20session.html#204075279">(Jul 16 2020 at 12:20)</a>:</h4>
<p>I tried to recreate the error with two fresh files, and the error doesn't occur.</p>



<a name="204075310"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/238830-Lean%20for%20the%20curious%20mathematician%202020/topic/Monday%20afternoon%3A%20metaprogramming%20session/near/204075310" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Billy Price <a href="https://leanprover-community.github.io/archive/stream/238830-Lean-for-the-curious-mathematician-2020/topic/Monday.20afternoon.3A.20metaprogramming.20session.html#204075310">(Jul 16 2020 at 12:21)</a>:</h4>
<p>Is it because I use sorry in some places in the file?</p>



<a name="204075396"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/238830-Lean%20for%20the%20curious%20mathematician%202020/topic/Monday%20afternoon%3A%20metaprogramming%20session/near/204075396" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/238830-Lean-for-the-curious-mathematician-2020/topic/Monday.20afternoon.3A.20metaprogramming.20session.html#204075396">(Jul 16 2020 at 12:22)</a>:</h4>
<p>I don't think so. I don't remember seeing this behavior before.</p>



<a name="204075414"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/238830-Lean%20for%20the%20curious%20mathematician%202020/topic/Monday%20afternoon%3A%20metaprogramming%20session/near/204075414" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/238830-Lean-for-the-curious-mathematician-2020/topic/Monday.20afternoon.3A.20metaprogramming.20session.html#204075414">(Jul 16 2020 at 12:22)</a>:</h4>
<p>I need to go in a second. Maybe if you post a <a href="https://leanprover-community.github.io/mwe.html">#mwe</a> someone can try to reproduce.</p>



<a name="204089557"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/238830-Lean%20for%20the%20curious%20mathematician%202020/topic/Monday%20afternoon%3A%20metaprogramming%20session/near/204089557" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Billy Price <a href="https://leanprover-community.github.io/archive/stream/238830-Lean-for-the-curious-mathematician-2020/topic/Monday.20afternoon.3A.20metaprogramming.20session.html#204089557">(Jul 16 2020 at 14:19)</a>:</h4>
<p>I've figured out the issue, part of it is a vs-code bug, but it could possibly be fixed on the lean side?</p>
<p>Steps to reproduce</p>
<ol>
<li><code>leanproject new bugtest</code></li>
<li>create <code>src/file1.Lean</code> and <code>src/file2.lean</code> within vs code (pay attention to capitalisation)</li>
<li>in <code>file2.lean</code> put <code>import file1</code></li>
<li>Rename <code>file1.Lean</code> to <code>file1.lean</code> (remove the capitalisation), either in vs-code's browser or elsewhere</li>
<li>Observe vs-code does not detect this change in the opened tab-name (this can be fixed by reopening the tab, but regardless the following issues still occur)</li>
<li>Put <code>def foo : ℕ := 3</code> in <code>file1.lean</code> in vs-code </li>
<li>do <code>#check foo</code> in <code>file2.lean</code> and observe it doesn't recognise it.</li>
<li>Restart the lean server and observe it now recognises it</li>
<li>Make any change to <code>file1.lean</code> (like change the type of <code>foo</code> or just delete <code>foo</code>) and observe it doesn't update in <code>file2.lean</code> until the lean server or vs code is restarted (after which the problem still persists).</li>
</ol>
<p>There seems to be nothing you can do to fix this broken import relationship. I got it working again by changing the file name of <code>file1.lean</code> beyond capitalisation, say to <code>file0.lean</code>, in my normal non-vs-code file browser, after which vs-code recognises <code>file1.lean</code> has been deleted from the disk, and then the import relationship is fixed again, once the import is changed to <code>import file0</code></p>
<p>This issue also occurs when capitalising or uncapitalising other parts of the filename, say <code>File1.lean</code> vs <code>file1.lean</code>, which is arguably more likely to occur.</p>
<p>Can anyone else reproduce this, and is this something I should register as an issue on the vscode github or the vscode-lean<br>
github?</p>



<a name="204090956"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/238830-Lean%20for%20the%20curious%20mathematician%202020/topic/Monday%20afternoon%3A%20metaprogramming%20session/near/204090956" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Billy Price <a href="https://leanprover-community.github.io/archive/stream/238830-Lean-for-the-curious-mathematician-2020/topic/Monday.20afternoon.3A.20metaprogramming.20session.html#204090956">(Jul 16 2020 at 14:29)</a>:</h4>
<p>I think this might be the lean extension, since I've just noticed at the top of the Lean Infoview, it never updates the filename from <code>file1.Lean</code>, even after restarting the lean server and restarting vs-code. Once the file name is changed beyond just uncapitalisation, it recognises the change and fixes the link.</p>



<a name="204091451"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/238830-Lean%20for%20the%20curious%20mathematician%202020/topic/Monday%20afternoon%3A%20metaprogramming%20session/near/204091451" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/238830-Lean-for-the-curious-mathematician-2020/topic/Monday.20afternoon.3A.20metaprogramming.20session.html#204091451">(Jul 16 2020 at 14:32)</a>:</h4>
<p>The VSCode  Lean extension has changed a lot in the last few weeks (with great results!), so having a new bug in this area is rather plausible.</p>



<a name="204092642"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/238830-Lean%20for%20the%20curious%20mathematician%202020/topic/Monday%20afternoon%3A%20metaprogramming%20session/near/204092642" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Billy Price <a href="https://leanprover-community.github.io/archive/stream/238830-Lean-for-the-curious-mathematician-2020/topic/Monday.20afternoon.3A.20metaprogramming.20session.html#204092642">(Jul 16 2020 at 14:40)</a>:</h4>
<p>Is the lean extension responsible for the lean server? Because it's not just the info-view that fails to update the import.</p>



<a name="204093859"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/238830-Lean%20for%20the%20curious%20mathematician%202020/topic/Monday%20afternoon%3A%20metaprogramming%20session/near/204093859" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/238830-Lean-for-the-curious-mathematician-2020/topic/Monday.20afternoon.3A.20metaprogramming.20session.html#204093859">(Jul 16 2020 at 14:49)</a>:</h4>
<p>No, the Lean extension is not responsible for the Lean server. However there were also changes on the Lean side to accommodate the new fancy widgets.</p>



<a name="204094149"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/238830-Lean%20for%20the%20curious%20mathematician%202020/topic/Monday%20afternoon%3A%20metaprogramming%20session/near/204094149" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Billy Price <a href="https://leanprover-community.github.io/archive/stream/238830-Lean-for-the-curious-mathematician-2020/topic/Monday.20afternoon.3A.20metaprogramming.20session.html#204094149">(Jul 16 2020 at 14:50)</a>:</h4>
<p>Where should I submit this as an issue? It’s not clear to me where the source of the problem is</p>



<a name="204094859"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/238830-Lean%20for%20the%20curious%20mathematician%202020/topic/Monday%20afternoon%3A%20metaprogramming%20session/near/204094859" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/238830-Lean-for-the-curious-mathematician-2020/topic/Monday.20afternoon.3A.20metaprogramming.20session.html#204094859">(Jul 16 2020 at 14:55)</a>:</h4>
<p>If you can't reproduce the issue without VSCode I would put it in the vscode-lean repo. In any case you expect Gabriel to handle it, and he is currently unavailable.</p>



<a name="204095030"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/238830-Lean%20for%20the%20curious%20mathematician%202020/topic/Monday%20afternoon%3A%20metaprogramming%20session/near/204095030" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/238830-Lean-for-the-curious-mathematician-2020/topic/Monday.20afternoon.3A.20metaprogramming.20session.html#204095030">(Jul 16 2020 at 14:56)</a>:</h4>
<p>I also think this conversation has drifted and should not be in that stream. <span class="user-mention" data-user-id="110049">@Mario Carneiro</span> could you move this to the general stream (since the first message of Billy mentioning this bug)?</p>



<a name="204097961"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/238830-Lean%20for%20the%20curious%20mathematician%202020/topic/Monday%20afternoon%3A%20metaprogramming%20session/near/204097961" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Notification Bot <a href="https://leanprover-community.github.io/archive/stream/238830-Lean-for-the-curious-mathematician-2020/topic/Monday.20afternoon.3A.20metaprogramming.20session.html#204097961">(Jul 16 2020 at 15:16)</a>:</h4>
<p>This topic was moved by <span class="user-mention silent" data-user-id="110087">Scott Morrison</span> to <a class="stream-topic" data-stream-id="113488" href="/#narrow/stream/113488-general/topic/VS.20code.20updating.20bug.3F">#general &gt; VS code updating bug?</a></p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>