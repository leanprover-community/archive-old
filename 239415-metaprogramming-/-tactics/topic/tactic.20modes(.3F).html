---
layout: archive
title: Zulip Chat Archive
permalink: /stream/239415-metaprogramming-/-tactics/topic/tactic.20modes(.3F).html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/index.html">metaprogramming / tactics</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/tactic.20modes(.3F).html">tactic modes(?)</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="210552702"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/tactic%20modes%28%3F%29/near/210552702" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/tactic.20modes(.3F).html#210552702">(Sep 18 2020 at 17:44)</a>:</h4>
<p>Is there documentation on (or, failing that, some examples of) writing new tactic modes such as <code>conv</code>?</p>



<a name="210552775"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/tactic%20modes%28%3F%29/near/210552775" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/tactic.20modes(.3F).html#210552775">(Sep 18 2020 at 17:44)</a>:</h4>
<p><span class="user-mention" data-user-id="110026">@Simon Hudon</span> what's the link to your temporal logic tactic? I poked around your github repos but didn't see it</p>



<a name="210552991"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/tactic%20modes%28%3F%29/near/210552991" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/tactic.20modes(.3F).html#210552991">(Sep 18 2020 at 17:46)</a>:</h4>
<p>I've followed the smt mode from core as an example, the handful of times I've tried to do this</p>



<a name="210553017"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/tactic%20modes%28%3F%29/near/210553017" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Simon Hudon <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/tactic.20modes(.3F).html#210553017">(Sep 18 2020 at 17:46)</a>:</h4>
<p>Here it is: <a href="https://github.com/unitb/temporal-logic">https://github.com/unitb/temporal-logic</a></p>



<a name="210553058"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/tactic%20modes%28%3F%29/near/210553058" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/tactic.20modes(.3F).html#210553058">(Sep 18 2020 at 17:47)</a>:</h4>
<p>The natural number game used some kind of modded tactic mode <code>begin [natnumgame]</code> and Rob Lewis wrote some code which ported most of the tactics over and let me redefine a few</p>



<a name="210553114"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/tactic%20modes%28%3F%29/near/210553114" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/tactic.20modes(.3F).html#210553114">(Sep 18 2020 at 17:47)</a>:</h4>
<p><span aria-label="up" class="emoji emoji-2b06" role="img" title="up">:up:</span> that's one of the handful</p>



<a name="210553231"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/tactic%20modes%28%3F%29/near/210553231" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/tactic.20modes(.3F).html#210553231">(Sep 18 2020 at 17:48)</a>:</h4>
<p><a href="https://github.com/ImperialCollegeLondon/natural_number_game/blob/master/src/tactic/nat_num_game.lean">https://github.com/ImperialCollegeLondon/natural_number_game/blob/master/src/tactic/nat_num_game.lean</a></p>



<a name="210553825"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/tactic%20modes%28%3F%29/near/210553825" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/tactic.20modes(.3F).html#210553825">(Sep 18 2020 at 17:53)</a>:</h4>
<p>Thanks all. So I gather <code>begin [smt] ... end</code> means something like <code>smt.interactive.execute t</code> where <code>t</code> is the result of parsing the <code>begin-end</code> block using the <code>smt.interactive</code> namespace. And I guess if I want to support something like <code>conv { ... }</code>, then I just need to define <code>my_tac.interactive.itactic := my_tac unit</code> to represent the body and the parser will automatically use the <code>my_tac</code> parser for it?</p>



<a name="210554411"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/tactic%20modes%28%3F%29/near/210554411" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Simon Hudon <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/tactic.20modes(.3F).html#210554411">(Sep 18 2020 at 17:58)</a>:</h4>
<p>Yes</p>



<a name="210556760"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/tactic%20modes%28%3F%29/near/210556760" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/tactic.20modes(.3F).html#210556760">(Sep 18 2020 at 18:17)</a>:</h4>
<p>There are a few tiny examples in the Lean tests as well: <a href="https://github.com/leanprover-community/lean/blob/ec1613aef1eee72e601f192b16740629c6d49690/tests/lean/interactive/my_tac_class.lean">tests/lean/interactive/my_tac_class.lean</a>, <a href="https://github.com/leanprover-community/lean/blob/ec1613aef1eee72e601f192b16740629c6d49690/tests/lean/run/my_tac_class.lean">tests/lean/run/my_tac_class.lean</a>, <a href="https://github.com/leanprover-community/lean/blob/ec1613aef1eee72e601f192b16740629c6d49690/tests/lean/interactive/rb_map_ts.lean">tests/lean/interactive/rb_map_ts.lean</a></p>



<a name="210556910"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/tactic%20modes%28%3F%29/near/210556910" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/tactic.20modes(.3F).html#210556910">(Sep 18 2020 at 18:18)</a>:</h4>
<p>I found a helpful comment at <a href="https://github.com/unitb/temporal-logic/blob/master/src/temporal_logic/tactic.lean#L17-L31">https://github.com/unitb/temporal-logic/blob/master/src/temporal_logic/tactic.lean#L17-L31</a><br>
clearly copied from somewhere else, but that's where I found it</p>



<a name="210556977"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/tactic%20modes%28%3F%29/near/210556977" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/tactic.20modes(.3F).html#210556977">(Sep 18 2020 at 18:19)</a>:</h4>
<p>ah, it's indeed in the Lean C++ code somewhere</p>



<a name="210557215"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/tactic%20modes%28%3F%29/near/210557215" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/tactic.20modes(.3F).html#210557215">(Sep 18 2020 at 18:21)</a>:</h4>
<p><a href="https://github.com/leanprover-community/lean/blob/d907e6aed0b399f6512139c751b908979bf45eaf/src/frontends/lean/tactic_notation.cpp#L33-L52">https://github.com/leanprover-community/lean/blob/d907e6aed0b399f6512139c751b908979bf45eaf/src/frontends/lean/tactic_notation.cpp#L33-L52</a></p>



<a name="210558432"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/tactic%20modes%28%3F%29/near/210558432" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/tactic.20modes(.3F).html#210558432">(Sep 18 2020 at 18:31)</a>:</h4>
<p>So with <code>save_info</code>, although all the examples I've found ultimately use <code>tactic.to_format</code>to format the tactic state, I can also pass any old nonsense I like to <code>save_info_thunk</code>, right?</p>



<a name="210558540"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/tactic%20modes%28%3F%29/near/210558540" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/tactic.20modes(.3F).html#210558540">(Sep 18 2020 at 18:32)</a>:</h4>
<p>(with the possible exception of the smt tactic which uses a different built-in formatter)</p>



<a name="210558695"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/tactic%20modes%28%3F%29/near/210558695" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Simon Hudon <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/tactic.20modes(.3F).html#210558695">(Sep 18 2020 at 18:34)</a>:</h4>
<p>Yes that's right, that's where you feed in whatever you want to display</p>



<a name="210572477"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/tactic%20modes%28%3F%29/near/210572477" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/tactic.20modes(.3F).html#210572477">(Sep 18 2020 at 20:37)</a>:</h4>
<p>To correct what I wrote earlier, Simon's <code>temporal</code> tactic does produce a custom format for the tactic state, it just does such a good job of imitating the standard one that I didn't notice <span aria-label="upside down" class="emoji emoji-1f643" role="img" title="upside down">:upside_down:</span></p>



<a name="210572687"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/tactic%20modes%28%3F%29/near/210572687" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Simon Hudon <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/tactic.20modes(.3F).html#210572687">(Sep 18 2020 at 20:39)</a>:</h4>
<p>Ha! Sorry to mislead you like this!</p>



<a name="210572861"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/tactic%20modes%28%3F%29/near/210572861" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Simon Hudon <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/tactic.20modes(.3F).html#210572861">(Sep 18 2020 at 20:40)</a>:</h4>
<p>Mainly what my pretty printing does is print hypotheses of the form <code>h : Γ ⊢ φ</code> as <code>h : φ</code> and omit the variable <code>Γ</code> from the context.</p>



<a name="210572937"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/tactic%20modes%28%3F%29/near/210572937" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Simon Hudon <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/tactic.20modes(.3F).html#210572937">(Sep 18 2020 at 20:41)</a>:</h4>
<p>Was it hard to get it to build? I haven't ungraded it in a while (still in the process of upgrading the dependencies)</p>



<a name="210573007"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/tactic%20modes%28%3F%29/near/210573007" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/tactic.20modes(.3F).html#210573007">(Sep 18 2020 at 20:42)</a>:</h4>
<p>Let's say it was not hard to get it to build to the point where I could inspect at least one <code>[temporal]</code> proof interactively</p>



<a name="210577457"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/tactic%20modes%28%3F%29/near/210577457" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/tactic.20modes(.3F).html#210577457">(Sep 18 2020 at 21:28)</a>:</h4>
<p>In fact, what I want to do is broadly similar--basically I want to pretend that I have a variable <code>x : X</code>, while actually representing it by <code>x : Γ → X</code>.</p>



<a name="210577705"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/tactic%20modes%28%3F%29/near/210577705" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/tactic.20modes(.3F).html#210577705">(Sep 18 2020 at 21:30)</a>:</h4>
<p>One thing I don't understand yet is what controls the environment that <code>texpr</code> gets parsed/typechecked in. When <code>texpr</code> is an argument of an interactive tactic, is the <code>pexpr</code> that gets passed to the tactic really independent of the environment? If it does depend on the environment, can I set the environment somehow?</p>



<a name="210580821"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/tactic%20modes%28%3F%29/near/210580821" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/tactic.20modes(.3F).html#210580821">(Sep 18 2020 at 22:12)</a>:</h4>
<p>Oh, looking up a few inches I see</p>
<div class="codehilite"><pre><span></span><code><span class="n">meta</span> <span class="kn">constant</span> <span class="n">set_env</span> <span class="o">:</span> <span class="n">environment</span> <span class="bp">→</span> <span class="n">parser</span> <span class="n">unit</span>
</code></pre></div>


<p>Can I run this from the <code>tactic</code> monad somehow? Or am I supposed to create a custom <code>parser</code> for my interactive tactics which manipulates the environment first? I see <code>meta constant of_tactic : tactic α → parser α</code>...</p>



<a name="210580865"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/tactic%20modes%28%3F%29/near/210580865" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/tactic.20modes(.3F).html#210580865">(Sep 18 2020 at 22:13)</a>:</h4>
<p>sorry, that path only goes one way</p>



<a name="210580911"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/tactic%20modes%28%3F%29/near/210580911" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/tactic.20modes(.3F).html#210580911">(Sep 18 2020 at 22:14)</a>:</h4>
<p>tactics can't run parsers</p>



<a name="210580966"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/tactic%20modes%28%3F%29/near/210580966" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/tactic.20modes(.3F).html#210580966">(Sep 18 2020 at 22:15)</a>:</h4>
<p>Do you really want to replace the environment and not just the local context?</p>



<a name="210580989"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/tactic%20modes%28%3F%29/near/210580989" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/tactic.20modes(.3F).html#210580989">(Sep 18 2020 at 22:15)</a>:</h4>
<p>I do just want to replace the local context but I don't understand how I'd do so</p>



<a name="210581072"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/tactic%20modes%28%3F%29/near/210581072" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/tactic.20modes(.3F).html#210581072">(Sep 18 2020 at 22:16)</a>:</h4>
<p>An easy way is to <code>revert_all</code> and then backtrack when you are done</p>



<a name="210581101"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/tactic%20modes%28%3F%29/near/210581101" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/tactic.20modes(.3F).html#210581101">(Sep 18 2020 at 22:17)</a>:</h4>
<p>that is, I want to have an underlying tactic state somewhere containing <code>x : Γ → X</code> but present to the user the illusion that <code>x : X</code>, and have my tactics fix up the <code>expr</code> in a certain way</p>



<a name="210581124"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/tactic%20modes%28%3F%29/near/210581124" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/tactic.20modes(.3F).html#210581124">(Sep 18 2020 at 22:18)</a>:</h4>
<p>I guess what I don't really understand is how the parser knows what the local context is at all--couldn't I use some monad totally unrelated to <code>tactic_state</code> as my custom tactic monad?</p>



<a name="210581178"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/tactic%20modes%28%3F%29/near/210581178" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/tactic.20modes(.3F).html#210581178">(Sep 18 2020 at 22:18)</a>:</h4>
<p>the parser doesn't have to care since it only produces pre-expressions</p>



<a name="210581217"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/tactic%20modes%28%3F%29/near/210581217" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/tactic.20modes(.3F).html#210581217">(Sep 18 2020 at 22:19)</a>:</h4>
<p>If you are okay with the extra work the usual way I do more radical type reinterpretation is to perform post-processing directly on the pexpr, without calling <code>to_expr</code> on it</p>



<a name="210581219"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/tactic%20modes%28%3F%29/near/210581219" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/tactic.20modes(.3F).html#210581219">(Sep 18 2020 at 22:19)</a>:</h4>
<p>ok, so does this mean a pre-expression might contain things like unresolved <code>.</code> syntax, overloaded notation, etc.?</p>



<a name="210581282"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/tactic%20modes%28%3F%29/near/210581282" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/tactic.20modes(.3F).html#210581282">(Sep 18 2020 at 22:20)</a>:</h4>
<p>presumably as macros or something?</p>



<a name="210581283"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/tactic%20modes%28%3F%29/near/210581283" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/tactic.20modes(.3F).html#210581283">(Sep 18 2020 at 22:20)</a>:</h4>
<p>yes, it has those things</p>



<a name="210581287"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/tactic%20modes%28%3F%29/near/210581287" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/tactic.20modes(.3F).html#210581287">(Sep 18 2020 at 22:20)</a>:</h4>
<p>I see</p>



<a name="210581312"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/tactic%20modes%28%3F%29/near/210581312" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/tactic.20modes(.3F).html#210581312">(Sep 18 2020 at 22:21)</a>:</h4>
<p>If you need to change name resolution then things get a bit more tricky</p>



<a name="210581339"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/tactic%20modes%28%3F%29/near/210581339" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/tactic.20modes(.3F).html#210581339">(Sep 18 2020 at 22:21)</a>:</h4>
<p>I guess that's fine for the "operate directly on the <code>pexpr</code>" approach since I want to replace <code>x.foo</code> by <code>(x i).foo</code> or whatever anyways</p>



<a name="210581418"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/tactic%20modes%28%3F%29/near/210581418" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/tactic.20modes(.3F).html#210581418">(Sep 18 2020 at 22:22)</a>:</h4>
<p>in  your case you can probably send it to <code>to_expr</code> after your fixups to still get most of lean goodness</p>



<a name="210581422"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/tactic%20modes%28%3F%29/near/210581422" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/tactic.20modes(.3F).html#210581422">(Sep 18 2020 at 22:22)</a>:</h4>
<p>in fact, I basically just want to do a bunch of substitutions of the form "replace <code>x</code> by <code>x i</code>" so maybe this functionality already exists</p>



<a name="210581427"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/tactic%20modes%28%3F%29/near/210581427" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/tactic.20modes(.3F).html#210581427">(Sep 18 2020 at 22:22)</a>:</h4>
<p>and then use <code>to_expr</code> right</p>



<a name="210581433"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/tactic%20modes%28%3F%29/near/210581433" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/tactic.20modes(.3F).html#210581433">(Sep 18 2020 at 22:22)</a>:</h4>
<p>Isn't that exactly what a <code>parameter</code> does?</p>



<a name="210581541"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/tactic%20modes%28%3F%29/near/210581541" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/tactic.20modes(.3F).html#210581541">(Sep 18 2020 at 22:25)</a>:</h4>
<p>I guess so? though here the parameter <code>i</code> will be another local constant</p>



<a name="210581561"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/tactic%20modes%28%3F%29/near/210581561" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/tactic.20modes(.3F).html#210581561">(Sep 18 2020 at 22:25)</a>:</h4>
<p>I was thinking more along the lines of Lean knowing how perform substitution in general</p>



<a name="210581566"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/tactic%20modes%28%3F%29/near/210581566" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/tactic.20modes(.3F).html#210581566">(Sep 18 2020 at 22:25)</a>:</h4>
<p>well technically if you are in a section then the parameter is in your local context</p>



<a name="210581632"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/tactic%20modes%28%3F%29/near/210581632" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/tactic.20modes(.3F).html#210581632">(Sep 18 2020 at 22:26)</a>:</h4>
<p>There is <code>expr.replace</code> I think</p>



<a name="210581642"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/tactic%20modes%28%3F%29/near/210581642" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/tactic.20modes(.3F).html#210581642">(Sep 18 2020 at 22:26)</a>:</h4>
<p>which was updated to work on pexprs at some point</p>



<a name="210581750"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/tactic%20modes%28%3F%29/near/210581750" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/tactic.20modes(.3F).html#210581750">(Sep 18 2020 at 22:28)</a>:</h4>
<p>this looks fancy</p>



<a name="210581850"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/tactic%20modes%28%3F%29/near/210581850" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/tactic.20modes(.3F).html#210581850">(Sep 18 2020 at 22:30)</a>:</h4>
<p>but, it also looks like it only works on <code>expr</code></p>



<a name="210581884"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/tactic%20modes%28%3F%29/near/210581884" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/tactic.20modes(.3F).html#210581884">(Sep 18 2020 at 22:31)</a>:</h4>
<p>anyways, this is more than enough to keep me busy for a while</p>



<a name="210581917"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/tactic%20modes%28%3F%29/near/210581917" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/tactic.20modes(.3F).html#210581917">(Sep 18 2020 at 22:31)</a>:</h4>
<p><span class="user-mention" data-user-id="110596">@Rob Lewis</span> Didn't you PR something like this?</p>



<a name="210581926"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/tactic%20modes%28%3F%29/near/210581926" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/tactic.20modes(.3F).html#210581926">(Sep 18 2020 at 22:31)</a>:</h4>
<p>Not me</p>



<a name="210581970"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/tactic%20modes%28%3F%29/near/210581970" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/tactic.20modes(.3F).html#210581970">(Sep 18 2020 at 22:32)</a>:</h4>
<p>IIUC the only thing needed to make <code>expr.replace</code> work on pexprs is to generalize the signature</p>



<a name="210581990"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/tactic%20modes%28%3F%29/near/210581990" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/tactic.20modes(.3F).html#210581990">(Sep 18 2020 at 22:32)</a>:</h4>
<p>this was something like 18 months ago or so</p>



<a name="210582028"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/tactic%20modes%28%3F%29/near/210582028" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/tactic.20modes(.3F).html#210582028">(Sep 18 2020 at 22:33)</a>:</h4>
<p>pexprs need a general overhaul to make them more lean friendly</p>



<a name="210582115"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/tactic%20modes%28%3F%29/near/210582115" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Simon Hudon <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/tactic.20modes(.3F).html#210582115">(Sep 18 2020 at 22:34)</a>:</h4>
<p>I think I made such adjustment for <code>expr.fold</code> the same should work for <code>expr.replace</code></p>



<a name="210582231"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/tactic%20modes%28%3F%29/near/210582231" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/tactic.20modes(.3F).html#210582231">(Sep 18 2020 at 22:36)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110049">Mario Carneiro</span> <a href="#narrow/stream/239415-metaprogramming-.2F.20tactics/topic/tactic.20modes(.3F)/near/210581970">said</a>:</p>
<blockquote>
<p>IIUC the only thing needed to make <code>expr.replace</code> work on pexprs is to generalize the signature</p>
</blockquote>
<p>so, you're saying I can just <code>unchecked_cast</code> it <span aria-label="smiling devil" class="emoji emoji-1f608" role="img" title="smiling devil">:smiling_devil:</span></p>



<a name="210582242"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/tactic%20modes%28%3F%29/near/210582242" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/tactic.20modes(.3F).html#210582242">(Sep 18 2020 at 22:37)</a>:</h4>
<p>yes, that will work</p>



<a name="210582319"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/tactic%20modes%28%3F%29/near/210582319" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/tactic.20modes(.3F).html#210582319">(Sep 18 2020 at 22:38)</a>:</h4>
<p>is this the formal version of proof by reference to personal communication</p>



<a name="210587230"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/tactic%20modes%28%3F%29/near/210587230" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/tactic.20modes(.3F).html#210587230">(Sep 19 2020 at 00:06)</a>:</h4>
<p>Is there a tactic for that?</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>