---
layout: archive
title: Zulip Chat Archive
permalink: /stream/239415-metaprogramming-/-tactics/topic/.60.3F.60.20exercises.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/index.html">metaprogramming / tactics</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/.60.3F.60.20exercises.html">`?` exercises</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="198831415"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/%60%3F%60%20exercises/near/198831415" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jalex Stark <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/.60.3F.60.20exercises.html#198831415">(May 26 2020 at 22:53)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110049">Mario Carneiro</span> <a href="#narrow/stream/113489-new-members/topic/Achievement.3A.20multiply.20convergent.20sequences/near/198830593">said</a>:</p>
<blockquote>
<p>An <code>assumption?</code> would also be cool (producing a <code>Try this: exact h</code>)</p>
</blockquote>



<a name="198831812"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/%60%3F%60%20exercises/near/198831812" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jalex Stark <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/.60.3F.60.20exercises.html#198831812">(May 26 2020 at 22:56)</a>:</h4>
<p>probably anyone who opens the source code for both <code>assumption</code> and something that provides a <code>?</code> (e.g. <code>tidy</code> though there's probably a simpler example) could either figure out how to make this work or would come away with a concrete thing they're confused about in <code>meta</code> land</p>



<a name="198832388"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/%60%3F%60%20exercises/near/198832388" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/.60.3F.60.20exercises.html#198832388">(May 26 2020 at 23:02)</a>:</h4>
<p><code>assumption</code> is already used as the example tactic in many tactic tutorials</p>



<a name="198832438"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/%60%3F%60%20exercises/near/198832438" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/.60.3F.60.20exercises.html#198832438">(May 26 2020 at 23:03)</a>:</h4>
<p>There are only two things to making <code>?</code> work: parsing <code>?</code> and printing the words <code>Try this:</code> followed by the desired replacement</p>



<a name="198832566"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/%60%3F%60%20exercises/near/198832566" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jalex Stark <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/.60.3F.60.20exercises.html#198832566">(May 26 2020 at 23:04)</a>:</h4>
<p>yep, I'm looking at the <code>tidy</code> source and I think i understand how it does both of those things</p>



<a name="198834830"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/%60%3F%60%20exercises/near/198834830" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jalex Stark <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/.60.3F.60.20exercises.html#198834830">(May 26 2020 at 23:37)</a>:</h4>
<p>This is an assumption tactic that I think always prints out <code>try exact h</code> when it succeeds. Still trying to understand the question mark. </p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="n">tactic</span>
<span class="kn">open</span> <span class="n">lean</span><span class="bp">.</span><span class="n">parser</span> <span class="n">interactive</span>
<span class="kn">open</span> <span class="n">tactic</span>

<span class="kn">namespace</span> <span class="n">my_assumption</span>

<span class="n">meta</span> <span class="kn">structure</span> <span class="n">cfg</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">trace_result</span> <span class="o">:</span> <span class="n">bool</span>            <span class="o">:=</span> <span class="n">tt</span><span class="o">)</span>
<span class="o">(</span><span class="n">trace_result_prefix</span> <span class="o">:</span> <span class="n">string</span>   <span class="o">:=</span> <span class="s2">&quot;Try this: exact &quot;</span><span class="o">)</span>

<span class="n">meta</span> <span class="n">def</span> <span class="n">find_matching_type</span> <span class="o">(</span><span class="n">e</span> <span class="o">:</span> <span class="n">expr</span><span class="o">)</span> <span class="o">:</span> <span class="n">list</span> <span class="n">expr</span> <span class="bp">→</span> <span class="n">tactic</span> <span class="n">expr</span>
<span class="bp">|</span> <span class="o">[]</span>         <span class="o">:=</span> <span class="n">tactic</span><span class="bp">.</span><span class="n">failed</span>
<span class="bp">|</span> <span class="o">(</span><span class="n">H</span> <span class="bp">::</span> <span class="n">Hs</span><span class="o">)</span>  <span class="o">:=</span> <span class="n">do</span> <span class="n">t</span> <span class="err">←</span> <span class="n">tactic</span><span class="bp">.</span><span class="n">infer_type</span> <span class="n">H</span><span class="o">,</span>
                   <span class="o">(</span><span class="n">tactic</span><span class="bp">.</span><span class="n">unify</span> <span class="n">e</span> <span class="n">t</span> <span class="bp">&gt;&gt;</span> <span class="n">return</span> <span class="n">H</span><span class="o">)</span> <span class="bp">&lt;|&gt;</span> <span class="n">find_matching_type</span> <span class="n">Hs</span>

<span class="n">meta</span> <span class="n">def</span> <span class="n">my_assumption_aux</span> <span class="o">(</span><span class="n">cfg</span> <span class="o">:</span> <span class="n">my_assumption</span><span class="bp">.</span><span class="n">cfg</span> <span class="o">:=</span> <span class="o">{})</span> <span class="o">:</span> <span class="n">tactic</span> <span class="n">unit</span> <span class="o">:=</span>
<span class="n">do</span> <span class="o">{</span> <span class="n">ctx</span> <span class="err">←</span> <span class="n">tactic</span><span class="bp">.</span><span class="n">local_context</span><span class="o">,</span>
     <span class="n">t</span>   <span class="err">←</span> <span class="n">tactic</span><span class="bp">.</span><span class="n">target</span><span class="o">,</span>
     <span class="n">hyp</span> <span class="err">←</span> <span class="n">find_matching_type</span> <span class="n">t</span> <span class="n">ctx</span><span class="o">,</span>
     <span class="n">when</span> <span class="o">(</span><span class="n">cfg</span><span class="bp">.</span><span class="n">trace_result</span><span class="o">)</span> <span class="err">$</span>
      <span class="n">trace</span> <span class="o">(</span><span class="n">cfg</span><span class="bp">.</span><span class="n">trace_result_prefix</span> <span class="bp">++</span> <span class="n">to_string</span> <span class="n">hyp</span><span class="o">),</span>
     <span class="n">tactic</span><span class="bp">.</span><span class="n">exact</span> <span class="n">hyp</span> <span class="o">}</span>
<span class="bp">&lt;|&gt;</span> <span class="n">tactic</span><span class="bp">.</span><span class="n">fail</span> <span class="s2">&quot;my_assumption tactic failed&quot;</span>
</code></pre></div>



<a name="198834922"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/%60%3F%60%20exercises/near/198834922" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/.60.3F.60.20exercises.html#198834922">(May 26 2020 at 23:38)</a>:</h4>
<p>You need to be in the <code>tactic.interactive</code> namespace to make an interactive tactic, and arguments to the tactic should have the form <code>parse p</code> where <code>p</code> is an appropriate parser</p>



<a name="198835043"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/%60%3F%60%20exercises/near/198835043" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/.60.3F.60.20exercises.html#198835043">(May 26 2020 at 23:40)</a>:</h4>
<p>You should also use <code>pp hyp</code> instead of <code>to_string hyp</code> because it can print expressions better (although possibly in this case there won't be much difference because the expression is a local constant)</p>



<a name="198835136"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/%60%3F%60%20exercises/near/198835136" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jalex Stark <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/.60.3F.60.20exercises.html#198835136">(May 26 2020 at 23:41)</a>:</h4>
<p>I tried this after the above</p>
<div class="codehilite"><pre><span></span><code><span class="kn">open</span> <span class="n">tactic</span><span class="bp">.</span><span class="n">interactive</span>
<span class="n">meta</span> <span class="n">def</span> <span class="n">my_assumption</span> <span class="o">(</span><span class="n">trace</span> <span class="o">:</span> <span class="n">parse</span> <span class="err">$</span> <span class="n">optional</span> <span class="o">(</span><span class="n">tk</span> <span class="s2">&quot;?&quot;</span><span class="o">))</span> <span class="o">(</span><span class="n">cfg</span> <span class="o">:</span> <span class="n">cfg</span> <span class="o">:=</span> <span class="o">{})</span> <span class="o">:=</span>
<span class="n">my_assumption_aux</span> <span class="o">{</span> <span class="n">trace_result</span> <span class="o">:=</span> <span class="n">trace</span><span class="bp">.</span><span class="n">is_some</span><span class="o">,</span> <span class="bp">..</span><span class="n">cfg</span> <span class="o">}</span>

<span class="kn">example</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="mi">1</span> <span class="bp">=</span> <span class="mi">1</span><span class="o">)</span> <span class="o">:</span> <span class="mi">1</span> <span class="bp">=</span> <span class="mi">1</span> <span class="o">:=</span> <span class="k">begin</span>
<span class="n">my_assumption</span><span class="o">,</span>
<span class="kn">end</span>
</code></pre></div>



<a name="198835147"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/%60%3F%60%20exercises/near/198835147" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/.60.3F.60.20exercises.html#198835147">(May 26 2020 at 23:41)</a>:</h4>
<p><code>tidy.cfg</code>?</p>



<a name="198835157"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/%60%3F%60%20exercises/near/198835157" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jalex Stark <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/.60.3F.60.20exercises.html#198835157">(May 26 2020 at 23:42)</a>:</h4>
<p>oops</p>



<a name="198835209"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/%60%3F%60%20exercises/near/198835209" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/.60.3F.60.20exercises.html#198835209">(May 26 2020 at 23:42)</a>:</h4>
<p>I don't think you need any cfg argument</p>



<a name="198835217"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/%60%3F%60%20exercises/near/198835217" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/.60.3F.60.20exercises.html#198835217">(May 26 2020 at 23:42)</a>:</h4>
<p>that's kind of heavy handed</p>



<a name="198835246"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/%60%3F%60%20exercises/near/198835246" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jalex Stark <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/.60.3F.60.20exercises.html#198835246">(May 26 2020 at 23:42)</a>:</h4>
<p>i agree, but already the parse argument doesn't work</p>



<a name="198835248"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/%60%3F%60%20exercises/near/198835248" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/.60.3F.60.20exercises.html#198835248">(May 26 2020 at 23:42)</a>:</h4>
<p>There is no need to change the print prefix because <code>Try this:</code> is a keyword</p>



<a name="198835297"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/%60%3F%60%20exercises/near/198835297" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/.60.3F.60.20exercises.html#198835297">(May 26 2020 at 23:43)</a>:</h4>
<p>You also didn't put <code>my_assumption</code> in the tactic.interactive namespace</p>



<a name="198835352"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/%60%3F%60%20exercises/near/198835352" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jalex Stark <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/.60.3F.60.20exercises.html#198835352">(May 26 2020 at 23:44)</a>:</h4>
<p>ah does that translate to <code>namespace tactic.interactive</code>?</p>



<a name="198835355"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/%60%3F%60%20exercises/near/198835355" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/.60.3F.60.20exercises.html#198835355">(May 26 2020 at 23:44)</a>:</h4>
<p>yes</p>



<a name="198835359"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/%60%3F%60%20exercises/near/198835359" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jalex Stark <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/.60.3F.60.20exercises.html#198835359">(May 26 2020 at 23:44)</a>:</h4>
<p>I tried <code>open tactic.interactive</code> without thinking hard about what you meant</p>



<a name="198835366"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/%60%3F%60%20exercises/near/198835366" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/.60.3F.60.20exercises.html#198835366">(May 26 2020 at 23:44)</a>:</h4>
<p>or <code>meta def tactic.interactive.my_assumption</code></p>



<a name="198835573"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/%60%3F%60%20exercises/near/198835573" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jalex Stark <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/.60.3F.60.20exercises.html#198835573">(May 26 2020 at 23:48)</a>:</h4>
<p>(i had a namespaces error that resulted from opening an extra namespace at the start of the file and not closing it when i thought i had)</p>



<a name="198835833"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/%60%3F%60%20exercises/near/198835833" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jalex Stark <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/.60.3F.60.20exercises.html#198835833">(May 26 2020 at 23:52)</a>:</h4>
<p>This works on one test case</p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="n">tactic</span>

<span class="kn">open</span> <span class="n">lean</span><span class="bp">.</span><span class="n">parser</span> <span class="n">interactive</span>
<span class="kn">open</span> <span class="n">tactic</span>

<span class="n">meta</span> <span class="n">def</span> <span class="n">find_matching_type</span> <span class="o">(</span><span class="n">e</span> <span class="o">:</span> <span class="n">expr</span><span class="o">)</span> <span class="o">:</span> <span class="n">list</span> <span class="n">expr</span> <span class="bp">→</span> <span class="n">tactic</span> <span class="n">expr</span>
<span class="bp">|</span> <span class="o">[]</span>         <span class="o">:=</span> <span class="n">tactic</span><span class="bp">.</span><span class="n">failed</span>
<span class="bp">|</span> <span class="o">(</span><span class="n">H</span> <span class="bp">::</span> <span class="n">Hs</span><span class="o">)</span>  <span class="o">:=</span> <span class="n">do</span> <span class="n">t</span> <span class="err">←</span> <span class="n">tactic</span><span class="bp">.</span><span class="n">infer_type</span> <span class="n">H</span><span class="o">,</span>
                   <span class="o">(</span><span class="n">tactic</span><span class="bp">.</span><span class="n">unify</span> <span class="n">e</span> <span class="n">t</span> <span class="bp">&gt;&gt;</span> <span class="n">return</span> <span class="n">H</span><span class="o">)</span> <span class="bp">&lt;|&gt;</span> <span class="n">find_matching_type</span> <span class="n">Hs</span>

<span class="n">meta</span> <span class="n">def</span> <span class="n">my_assumption_aux</span> <span class="o">(</span><span class="n">trace_result</span> <span class="o">:</span> <span class="n">bool</span> <span class="o">:=</span> <span class="n">ff</span><span class="o">)</span> <span class="o">:</span> <span class="n">tactic</span> <span class="n">unit</span> <span class="o">:=</span>
<span class="n">do</span> <span class="o">{</span> <span class="n">ctx</span> <span class="err">←</span> <span class="n">tactic</span><span class="bp">.</span><span class="n">local_context</span><span class="o">,</span>
     <span class="n">t</span>   <span class="err">←</span> <span class="n">tactic</span><span class="bp">.</span><span class="n">target</span><span class="o">,</span>
     <span class="n">hyp</span> <span class="err">←</span> <span class="n">find_matching_type</span> <span class="n">t</span> <span class="n">ctx</span><span class="o">,</span>
     <span class="n">when</span> <span class="n">trace_result</span> <span class="err">$</span>
      <span class="n">trace</span> <span class="o">(</span><span class="s2">&quot;Try this: exact &quot;</span> <span class="bp">++</span> <span class="o">(</span><span class="n">to_string</span> <span class="err">$</span> <span class="n">hyp</span><span class="o">)),</span>
      <span class="c1">-- trace (&quot;Try this: exact &quot; ++ (to_string $ pp hyp)),</span>
     <span class="n">tactic</span><span class="bp">.</span><span class="n">exact</span> <span class="n">hyp</span> <span class="o">}</span>
<span class="bp">&lt;|&gt;</span> <span class="n">tactic</span><span class="bp">.</span><span class="n">fail</span> <span class="s2">&quot;my_assumption tactic failed&quot;</span>

<span class="n">meta</span> <span class="n">def</span> <span class="n">tactic</span><span class="bp">.</span><span class="n">interactive</span><span class="bp">.</span><span class="n">my_assumption</span> <span class="o">(</span><span class="n">trace_result</span> <span class="o">:</span> <span class="n">parse</span> <span class="err">$</span> <span class="n">optional</span> <span class="o">(</span><span class="n">tk</span> <span class="s2">&quot;?&quot;</span><span class="o">))</span> <span class="o">:=</span>
<span class="n">my_assumption_aux</span> <span class="n">trace_result</span><span class="bp">.</span><span class="n">is_some</span>

<span class="kn">example</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="mi">1</span> <span class="bp">=</span> <span class="mi">1</span><span class="o">)</span> <span class="o">:</span> <span class="mi">1</span> <span class="bp">=</span> <span class="mi">1</span> <span class="o">:=</span> <span class="k">begin</span>
<span class="n">my_assumption</span><span class="err">?</span><span class="o">,</span>
<span class="kn">end</span>
</code></pre></div>



<a name="198835869"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/%60%3F%60%20exercises/near/198835869" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/.60.3F.60.20exercises.html#198835869">(May 26 2020 at 23:52)</a>:</h4>
<p><code>pp</code> is a tactic</p>



<a name="198835884"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/%60%3F%60%20exercises/near/198835884" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/.60.3F.60.20exercises.html#198835884">(May 26 2020 at 23:53)</a>:</h4>
<p>you have to call it in a <code>do</code> block</p>



<a name="198836042"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/%60%3F%60%20exercises/near/198836042" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jalex Stark <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/.60.3F.60.20exercises.html#198836042">(May 26 2020 at 23:55)</a>:</h4>
<p>thanks<br>
I'm still not sure how to get from something of type <code>tactic format</code> to something of type <code>string</code></p>



<a name="198836106"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/%60%3F%60%20exercises/near/198836106" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/.60.3F.60.20exercises.html#198836106">(May 26 2020 at 23:56)</a>:</h4>
<p>Actually I just thought of one place where <code>pp</code> would be important here even though you are just printing a local constant: if <code>h</code> has a type like <code>\forall {x : A}, P x</code> then <code>exact h</code> won't work, and <code>pp</code> should produce <code>@h</code> so that you get the correct output which is <code>exact @h</code></p>



<a name="198836112"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/%60%3F%60%20exercises/near/198836112" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jalex Stark <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/.60.3F.60.20exercises.html#198836112">(May 26 2020 at 23:56)</a>:</h4>
<p>well i guess <code>trace</code> can take things of type <code>tactic format</code></p>



<a name="198836117"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/%60%3F%60%20exercises/near/198836117" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/.60.3F.60.20exercises.html#198836117">(May 26 2020 at 23:56)</a>:</h4>
<p>convert the string to a format using coe</p>



<a name="198836131"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/%60%3F%60%20exercises/near/198836131" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jalex Stark <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/.60.3F.60.20exercises.html#198836131">(May 26 2020 at 23:56)</a>:</h4>
<p>the thing i don't know is how to concatenate things of type <code>tactic format</code>, but now that the question is that precise i can probably find it</p>



<a name="198836134"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/%60%3F%60%20exercises/near/198836134" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/.60.3F.60.20exercises.html#198836134">(May 26 2020 at 23:56)</a>:</h4>
<p>format also <code>has_append</code></p>



<a name="198836151"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/%60%3F%60%20exercises/near/198836151" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/.60.3F.60.20exercises.html#198836151">(May 26 2020 at 23:57)</a>:</h4>
<p>so you can use <code>++</code> just like with strings</p>



<a name="198836188"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/%60%3F%60%20exercises/near/198836188" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jalex Stark <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/.60.3F.60.20exercises.html#198836188">(May 26 2020 at 23:57)</a>:</h4>
<p>ah okay, so i need to get out of the tactic monad and just get the thing of type <code>format</code></p>



<a name="198836271"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/%60%3F%60%20exercises/near/198836271" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jalex Stark <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/.60.3F.60.20exercises.html#198836271">(May 26 2020 at 23:58)</a>:</h4>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="n">tactic</span>

<span class="kn">open</span> <span class="n">lean</span><span class="bp">.</span><span class="n">parser</span> <span class="n">interactive</span>
<span class="kn">open</span> <span class="n">tactic</span>

<span class="n">meta</span> <span class="n">def</span> <span class="n">find_matching_type</span> <span class="o">(</span><span class="n">e</span> <span class="o">:</span> <span class="n">expr</span><span class="o">)</span> <span class="o">:</span> <span class="n">list</span> <span class="n">expr</span> <span class="bp">→</span> <span class="n">tactic</span> <span class="n">expr</span>
<span class="bp">|</span> <span class="o">[]</span>         <span class="o">:=</span> <span class="n">tactic</span><span class="bp">.</span><span class="n">failed</span>
<span class="bp">|</span> <span class="o">(</span><span class="n">H</span> <span class="bp">::</span> <span class="n">Hs</span><span class="o">)</span>  <span class="o">:=</span> <span class="n">do</span> <span class="n">t</span> <span class="err">←</span> <span class="n">tactic</span><span class="bp">.</span><span class="n">infer_type</span> <span class="n">H</span><span class="o">,</span>
                   <span class="o">(</span><span class="n">tactic</span><span class="bp">.</span><span class="n">unify</span> <span class="n">e</span> <span class="n">t</span> <span class="bp">&gt;&gt;</span> <span class="n">return</span> <span class="n">H</span><span class="o">)</span> <span class="bp">&lt;|&gt;</span> <span class="n">find_matching_type</span> <span class="n">Hs</span>

<span class="n">meta</span> <span class="n">def</span> <span class="n">my_assumption_aux</span> <span class="o">(</span><span class="n">trace_result</span> <span class="o">:</span> <span class="n">bool</span> <span class="o">:=</span> <span class="n">ff</span><span class="o">)</span> <span class="o">:</span> <span class="n">tactic</span> <span class="n">unit</span> <span class="o">:=</span>
<span class="n">do</span> <span class="o">{</span> <span class="n">ctx</span> <span class="err">←</span> <span class="n">tactic</span><span class="bp">.</span><span class="n">local_context</span><span class="o">,</span>
     <span class="n">t</span>   <span class="err">←</span> <span class="n">tactic</span><span class="bp">.</span><span class="n">target</span><span class="o">,</span>
     <span class="n">hyp</span> <span class="err">←</span> <span class="n">find_matching_type</span> <span class="n">t</span> <span class="n">ctx</span><span class="o">,</span>
     <span class="n">pp_hyp</span> <span class="err">←</span> <span class="n">pp</span> <span class="n">hyp</span><span class="o">,</span>
     <span class="n">when</span> <span class="n">trace_result</span> <span class="err">$</span>
       <span class="n">trace</span> <span class="o">(</span> <span class="o">(</span><span class="s2">&quot;Try this: exact &quot;</span> <span class="o">:</span> <span class="n">format</span><span class="o">)</span> <span class="bp">++</span> <span class="n">pp_hyp</span><span class="o">),</span>
     <span class="n">tactic</span><span class="bp">.</span><span class="n">exact</span> <span class="n">hyp</span> <span class="o">}</span>
<span class="bp">&lt;|&gt;</span> <span class="n">tactic</span><span class="bp">.</span><span class="n">fail</span> <span class="s2">&quot;my_assumption tactic failed&quot;</span>

<span class="n">meta</span> <span class="n">def</span> <span class="n">tactic</span><span class="bp">.</span><span class="n">interactive</span><span class="bp">.</span><span class="n">my_assumption</span> <span class="o">(</span><span class="n">trace_result</span> <span class="o">:</span> <span class="n">parse</span> <span class="err">$</span> <span class="n">optional</span> <span class="o">(</span><span class="n">tk</span> <span class="s2">&quot;?&quot;</span><span class="o">))</span> <span class="o">:=</span>
<span class="n">my_assumption_aux</span> <span class="n">trace_result</span><span class="bp">.</span><span class="n">is_some</span>

<span class="kn">example</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="mi">1</span> <span class="bp">=</span> <span class="mi">1</span><span class="o">)</span> <span class="o">:</span> <span class="mi">1</span> <span class="bp">=</span> <span class="mi">1</span> <span class="o">:=</span> <span class="k">begin</span>
<span class="n">my_assumption</span><span class="err">?</span><span class="o">,</span>
<span class="kn">end</span>
</code></pre></div>



<a name="198836295"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/%60%3F%60%20exercises/near/198836295" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/.60.3F.60.20exercises.html#198836295">(May 26 2020 at 23:59)</a>:</h4>
<p>you use bind to get values from inside the tactic monad</p>
<div class="codehilite"><pre><span></span><code><span class="n">do</span> <span class="n">fmt</span> <span class="bp">&lt;-</span> <span class="n">pp</span> <span class="n">hyp</span><span class="o">,</span>
   <span class="n">trace</span> <span class="o">(</span><span class="err">\</span><span class="n">u</span> <span class="s2">&quot;bla&quot;</span> <span class="bp">++</span> <span class="n">fmt</span><span class="o">)</span>
</code></pre></div>



<a name="198836314"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/%60%3F%60%20exercises/near/198836314" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jalex Stark <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/.60.3F.60.20exercises.html#198836314">(May 26 2020 at 23:59)</a>:</h4>
<p>I think that's the same as what I did?</p>



<a name="198836374"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/%60%3F%60%20exercises/near/198836374" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/.60.3F.60.20exercises.html#198836374">(May 27 2020 at 00:00)</a>:</h4>
<p>I don't see a left arrow in your code</p>



<a name="198836406"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/%60%3F%60%20exercises/near/198836406" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jalex Stark <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/.60.3F.60.20exercises.html#198836406">(May 27 2020 at 00:00)</a>:</h4>
<div class="codehilite"><pre><span></span><code>     <span class="n">pp_hyp</span> <span class="err">←</span> <span class="n">pp</span> <span class="n">hyp</span><span class="o">,</span>
     <span class="n">when</span> <span class="n">trace_result</span> <span class="err">$</span>
       <span class="n">trace</span> <span class="o">(</span> <span class="o">(</span><span class="s2">&quot;Try this: exact &quot;</span> <span class="o">:</span> <span class="n">format</span><span class="o">)</span> <span class="bp">++</span> <span class="n">pp_hyp</span><span class="o">),</span>
</code></pre></div>



<a name="198836432"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/%60%3F%60%20exercises/near/198836432" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/.60.3F.60.20exercises.html#198836432">(May 27 2020 at 00:00)</a>:</h4>
<p>That should work, yes?</p>



<a name="198836442"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/%60%3F%60%20exercises/near/198836442" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jalex Stark <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/.60.3F.60.20exercises.html#198836442">(May 27 2020 at 00:00)</a>:</h4>
<p>it does</p>



<a name="198836471"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/%60%3F%60%20exercises/near/198836471" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/.60.3F.60.20exercises.html#198836471">(May 27 2020 at 00:01)</a>:</h4>
<p>if you put the call in the <code>when</code> then it won't construct the format unless it's actually going to print</p>



<a name="198836567"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/%60%3F%60%20exercises/near/198836567" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jalex Stark <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/.60.3F.60.20exercises.html#198836567">(May 27 2020 at 00:02)</a>:</h4>
<p>good point, thanks</p>



<a name="198836570"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/%60%3F%60%20exercises/near/198836570" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jalex Stark <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/.60.3F.60.20exercises.html#198836570">(May 27 2020 at 00:02)</a>:</h4>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="n">tactic</span>

<span class="kn">open</span> <span class="n">lean</span><span class="bp">.</span><span class="n">parser</span> <span class="n">interactive</span>
<span class="kn">open</span> <span class="n">tactic</span>

<span class="n">meta</span> <span class="n">def</span> <span class="n">find_matching_type</span> <span class="o">(</span><span class="n">e</span> <span class="o">:</span> <span class="n">expr</span><span class="o">)</span> <span class="o">:</span> <span class="n">list</span> <span class="n">expr</span> <span class="bp">→</span> <span class="n">tactic</span> <span class="n">expr</span>
<span class="bp">|</span> <span class="o">[]</span>         <span class="o">:=</span> <span class="n">tactic</span><span class="bp">.</span><span class="n">failed</span>
<span class="bp">|</span> <span class="o">(</span><span class="n">H</span> <span class="bp">::</span> <span class="n">Hs</span><span class="o">)</span>  <span class="o">:=</span> <span class="n">do</span> <span class="n">t</span> <span class="err">←</span> <span class="n">tactic</span><span class="bp">.</span><span class="n">infer_type</span> <span class="n">H</span><span class="o">,</span>
                   <span class="o">(</span><span class="n">tactic</span><span class="bp">.</span><span class="n">unify</span> <span class="n">e</span> <span class="n">t</span> <span class="bp">&gt;&gt;</span> <span class="n">return</span> <span class="n">H</span><span class="o">)</span> <span class="bp">&lt;|&gt;</span> <span class="n">find_matching_type</span> <span class="n">Hs</span>

<span class="n">meta</span> <span class="n">def</span> <span class="n">my_assumption_aux</span> <span class="o">(</span><span class="n">trace_result</span> <span class="o">:</span> <span class="n">bool</span> <span class="o">:=</span> <span class="n">ff</span><span class="o">)</span> <span class="o">:</span> <span class="n">tactic</span> <span class="n">unit</span> <span class="o">:=</span>
<span class="n">do</span> <span class="o">{</span> <span class="n">ctx</span> <span class="err">←</span> <span class="n">tactic</span><span class="bp">.</span><span class="n">local_context</span><span class="o">,</span>
     <span class="n">t</span>   <span class="err">←</span> <span class="n">tactic</span><span class="bp">.</span><span class="n">target</span><span class="o">,</span>
     <span class="n">hyp</span> <span class="err">←</span> <span class="n">find_matching_type</span> <span class="n">t</span> <span class="n">ctx</span><span class="o">,</span>
     <span class="n">when</span> <span class="n">trace_result</span> <span class="err">$</span>
      <span class="n">do</span> <span class="o">{</span> <span class="n">pp_hyp</span> <span class="err">←</span> <span class="n">pp</span> <span class="n">hyp</span><span class="o">,</span>
      <span class="n">trace</span> <span class="o">(</span> <span class="o">(</span><span class="s2">&quot;Try this: exact &quot;</span> <span class="o">:</span> <span class="n">format</span><span class="o">)</span> <span class="bp">++</span> <span class="n">pp_hyp</span><span class="o">)</span> <span class="o">},</span>
     <span class="n">tactic</span><span class="bp">.</span><span class="n">exact</span> <span class="n">hyp</span> <span class="o">}</span>
<span class="bp">&lt;|&gt;</span> <span class="n">tactic</span><span class="bp">.</span><span class="n">fail</span> <span class="s2">&quot;my_assumption tactic failed&quot;</span>

<span class="n">meta</span> <span class="n">def</span> <span class="n">tactic</span><span class="bp">.</span><span class="n">interactive</span><span class="bp">.</span><span class="n">my_assumption</span> <span class="o">(</span><span class="n">trace_result</span> <span class="o">:</span> <span class="n">parse</span> <span class="err">$</span> <span class="n">optional</span> <span class="o">(</span><span class="n">tk</span> <span class="s2">&quot;?&quot;</span><span class="o">))</span> <span class="o">:=</span>
<span class="n">my_assumption_aux</span> <span class="n">trace_result</span><span class="bp">.</span><span class="n">is_some</span>

<span class="kn">example</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="mi">1</span> <span class="bp">=</span> <span class="mi">1</span><span class="o">)</span> <span class="o">:</span> <span class="mi">1</span> <span class="bp">=</span> <span class="mi">1</span> <span class="o">:=</span> <span class="k">begin</span>
<span class="n">my_assumption</span><span class="o">,</span>
<span class="kn">end</span>
</code></pre></div>



<a name="198836608"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/%60%3F%60%20exercises/near/198836608" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/.60.3F.60.20exercises.html#198836608">(May 27 2020 at 00:03)</a>:</h4>
<p>lgtm</p>



<a name="198836629"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/%60%3F%60%20exercises/near/198836629" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jalex Stark <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/.60.3F.60.20exercises.html#198836629">(May 27 2020 at 00:03)</a>:</h4>
<p>so <code>assumption</code> is defined in core, I think</p>



<a name="198836674"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/%60%3F%60%20exercises/near/198836674" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/.60.3F.60.20exercises.html#198836674">(May 27 2020 at 00:04)</a>:</h4>
<p>Indeed it is</p>



<a name="198836682"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/%60%3F%60%20exercises/near/198836682" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jalex Stark <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/.60.3F.60.20exercises.html#198836682">(May 27 2020 at 00:04)</a>:</h4>
<p>which makes PRing it significantly harder, right?</p>



<a name="198836691"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/%60%3F%60%20exercises/near/198836691" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/.60.3F.60.20exercises.html#198836691">(May 27 2020 at 00:04)</a>:</h4>
<p>not particularly, I think</p>



<a name="198836700"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/%60%3F%60%20exercises/near/198836700" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/.60.3F.60.20exercises.html#198836700">(May 27 2020 at 00:04)</a>:</h4>
<p>not anymore, at least</p>



<a name="198836729"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/%60%3F%60%20exercises/near/198836729" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/.60.3F.60.20exercises.html#198836729">(May 27 2020 at 00:05)</a>:</h4>
<p>it will go into the next release of lean and then everyone will be happier</p>



<a name="198836772"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/%60%3F%60%20exercises/near/198836772" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/.60.3F.60.20exercises.html#198836772">(May 27 2020 at 00:05)</a>:</h4>
<p>you will have to write tests for it too</p>



<a name="198837202"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/%60%3F%60%20exercises/near/198837202" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jalex Stark <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/.60.3F.60.20exercises.html#198837202">(May 27 2020 at 00:11)</a>:</h4>
<p>hmm our effort with <code>pp</code> was not enough</p>



<a name="198837209"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/%60%3F%60%20exercises/near/198837209" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jalex Stark <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/.60.3F.60.20exercises.html#198837209">(May 27 2020 at 00:11)</a>:</h4>
<div class="codehilite"><pre><span></span><code><span class="kn">example</span> <span class="o">(</span><span class="n">red_herring</span> <span class="o">:</span> <span class="mi">1</span> <span class="bp">=</span> <span class="mi">1</span><span class="o">)</span> <span class="o">(</span><span class="n">h2</span> <span class="o">:</span> <span class="bp">∀</span><span class="o">{</span><span class="n">x</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">},</span> <span class="n">x</span> <span class="bp">=</span> <span class="n">x</span><span class="o">)</span> <span class="o">:</span>
<span class="bp">∀</span><span class="n">x</span> <span class="o">:</span> <span class="bp">ℕ</span> <span class="o">,</span><span class="n">x</span> <span class="bp">=</span> <span class="n">x</span> <span class="o">:=</span> <span class="k">begin</span>
<span class="n">my_assumption</span><span class="err">?</span><span class="o">,</span>
<span class="kn">end</span>
</code></pre></div>



<a name="198837218"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/%60%3F%60%20exercises/near/198837218" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jalex Stark <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/.60.3F.60.20exercises.html#198837218">(May 27 2020 at 00:11)</a>:</h4>
<p>this prints <code>exact h2</code> instead of <code>exact @h2</code></p>



<a name="198837291"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/%60%3F%60%20exercises/near/198837291" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jalex Stark <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/.60.3F.60.20exercises.html#198837291">(May 27 2020 at 00:12)</a>:</h4>
<p>i guess the <code>find_matching_type</code> needs to do more than it currently is</p>



<a name="198837319"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/%60%3F%60%20exercises/near/198837319" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jalex Stark <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/.60.3F.60.20exercises.html#198837319">(May 27 2020 at 00:13)</a>:</h4>
<p>it's just returning <code>h2</code>, which can be <code>tactic.unify</code>ed with the goal</p>



<a name="198837331"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/%60%3F%60%20exercises/near/198837331" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jalex Stark <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/.60.3F.60.20exercises.html#198837331">(May 27 2020 at 00:13)</a>:</h4>
<p>but we really need like, the result of that unification</p>



<a name="198837338"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/%60%3F%60%20exercises/near/198837338" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jalex Stark <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/.60.3F.60.20exercises.html#198837338">(May 27 2020 at 00:13)</a>:</h4>
<p>(but doesn't exact do some unifying?)</p>



<a name="198837356"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/%60%3F%60%20exercises/near/198837356" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/.60.3F.60.20exercises.html#198837356">(May 27 2020 at 00:13)</a>:</h4>
<p>h2 is the correct answer</p>



<a name="198837413"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/%60%3F%60%20exercises/near/198837413" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/.60.3F.60.20exercises.html#198837413">(May 27 2020 at 00:14)</a>:</h4>
<p>but it needs to be printed properly so that <code>exact</code> also knows we are talking about <code>h2</code> and not <code>h2 _</code></p>



<a name="198837416"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/%60%3F%60%20exercises/near/198837416" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jalex Stark <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/.60.3F.60.20exercises.html#198837416">(May 27 2020 at 00:14)</a>:</h4>
<p>oh but this gives me an error</p>
<div class="codehilite"><pre><span></span><code><span class="kn">example</span> <span class="o">(</span><span class="n">red_herring</span> <span class="o">:</span> <span class="mi">1</span> <span class="bp">=</span> <span class="mi">1</span><span class="o">)</span> <span class="o">(</span><span class="n">h2</span> <span class="o">:</span> <span class="bp">∀</span><span class="o">{</span><span class="n">x</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">},</span> <span class="n">x</span> <span class="bp">=</span> <span class="n">x</span><span class="o">)</span> <span class="o">:</span>
<span class="bp">∀</span><span class="n">x</span> <span class="o">:</span> <span class="bp">ℕ</span> <span class="o">,</span><span class="n">x</span> <span class="bp">=</span> <span class="n">x</span> <span class="o">:=</span> <span class="k">begin</span>
<span class="n">exact</span> <span class="n">h2</span><span class="o">,</span>
<span class="kn">end</span>
</code></pre></div>



<a name="198837452"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/%60%3F%60%20exercises/near/198837452" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jalex Stark <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/.60.3F.60.20exercises.html#198837452">(May 27 2020 at 00:14)</a>:</h4>
<p>hmm ok</p>



<a name="198837534"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/%60%3F%60%20exercises/near/198837534" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jalex Stark <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/.60.3F.60.20exercises.html#198837534">(May 27 2020 at 00:15)</a>:</h4>
<p>i guess we can close the goal with <code>tactic.exact hyp</code> inside of the execution of <code>my_assumption</code><br>
but not with <code>exact &lt;k&gt;</code> where <code>&lt;k&gt;</code> is the output of <code>pp hyp</code></p>



<a name="198837536"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/%60%3F%60%20exercises/near/198837536" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/.60.3F.60.20exercises.html#198837536">(May 27 2020 at 00:15)</a>:</h4>
<p>if this pp thing isn't working, the low tech way to do this is to just check if it starts with an implicit binder and put <code>@</code> in front if so</p>



<a name="198837588"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/%60%3F%60%20exercises/near/198837588" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/.60.3F.60.20exercises.html#198837588">(May 27 2020 at 00:16)</a>:</h4>
<p>sure, <code>assumption</code> itself is not affected</p>



<a name="198837601"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/%60%3F%60%20exercises/near/198837601" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/.60.3F.60.20exercises.html#198837601">(May 27 2020 at 00:16)</a>:</h4>
<p>the issue is with the replacement tactic that is printed, turned into a string, written into the input file and then run</p>



<a name="198837627"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/%60%3F%60%20exercises/near/198837627" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jalex Stark <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/.60.3F.60.20exercises.html#198837627">(May 27 2020 at 00:17)</a>:</h4>
<p>maybe i'll try passing options to <code>pp</code> before going with the low-tech solution</p>



<a name="198837653"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/%60%3F%60%20exercises/near/198837653" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/.60.3F.60.20exercises.html#198837653">(May 27 2020 at 00:17)</a>:</h4>
<p>I'm not actually sure if the expression pretty printer correctly handles putting <code>@</code> when needed</p>



<a name="198837742"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/%60%3F%60%20exercises/near/198837742" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jalex Stark <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/.60.3F.60.20exercises.html#198837742">(May 27 2020 at 00:18)</a>:</h4>
<p>okay, I also realized I have no idea what I mean by "pass options to <code>pp</code>", so i'll start on that low-tech solution</p>



<a name="198837838"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/%60%3F%60%20exercises/near/198837838" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/.60.3F.60.20exercises.html#198837838">(May 27 2020 at 00:20)</a>:</h4>
<p><code>pp</code> does have options, they are set via the <code>options</code> struct that can be edited by users using <code>set_option</code> - I'm sure you've heard of <code>pp.all</code> - but I don't think they will solve this problem</p>



<a name="198838022"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/%60%3F%60%20exercises/near/198838022" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jalex Stark <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/.60.3F.60.20exercises.html#198838022">(May 27 2020 at 00:23)</a>:</h4>
<p>Is the thing we want "check if <code>expr = mvar _</code>"? where <code>mvar</code> is one of the type constructors?</p>
<div class="codehilite"><pre><span></span><code><span class="n">meta</span> <span class="kn">inductive</span> <span class="n">expr</span> <span class="o">(</span><span class="n">elaborated</span> <span class="o">:</span> <span class="n">bool</span> <span class="o">:=</span> <span class="n">tt</span><span class="o">)</span>
<span class="c">/-</span><span class="cm"> A bound variable with a de-Bruijn index. -/</span>
<span class="bp">|</span> <span class="n">var</span>         <span class="o">:</span> <span class="n">nat</span> <span class="bp">→</span> <span class="n">expr</span>
<span class="c">/-</span><span class="cm"> A type universe: `Sort u` -/</span>
<span class="bp">|</span> <span class="n">sort</span>        <span class="o">:</span> <span class="n">level</span> <span class="bp">→</span> <span class="n">expr</span>
<span class="c">/-</span><span class="cm"> A global constant. These include definitions, constants and inductive type stuff present</span>
<span class="cm">in the environment as well as hard-coded definitions. -/</span>
<span class="bp">|</span> <span class="n">const</span>       <span class="o">:</span> <span class="n">name</span> <span class="bp">→</span> <span class="n">list</span> <span class="n">level</span> <span class="bp">→</span> <span class="n">expr</span>
<span class="c">/-</span><span class="cm"> [WARNING] Do not trust the types for `mvar` and `local_const`,</span>
<span class="cm">they are sometimes dummy values. Use `tactic.infer_type` instead. -/</span>
<span class="c">/-</span><span class="cm"> An `mvar` is a &#39;hole&#39; yet to be filled in by the elaborator or tactic state. -/</span>
<span class="bp">|</span> <span class="n">mvar</span>        <span class="o">(</span><span class="n">unique</span> <span class="o">:</span> <span class="n">name</span><span class="o">)</span>  <span class="o">(</span><span class="n">pretty</span> <span class="o">:</span> <span class="n">name</span><span class="o">)</span>  <span class="o">(</span><span class="n">type</span> <span class="o">:</span> <span class="n">expr</span><span class="o">)</span> <span class="o">:</span> <span class="n">expr</span>
<span class="c">/-</span><span class="cm"> A local constant. For example, if our tactic state was `h : P ⊢ Q`, `h` would be a local constant. -/</span>
<span class="bp">|</span> <span class="n">local_const</span> <span class="o">(</span><span class="n">unique</span> <span class="o">:</span> <span class="n">name</span><span class="o">)</span> <span class="o">(</span><span class="n">pretty</span> <span class="o">:</span> <span class="n">name</span><span class="o">)</span> <span class="o">(</span><span class="n">bi</span> <span class="o">:</span> <span class="n">binder_info</span><span class="o">)</span> <span class="o">(</span><span class="n">type</span> <span class="o">:</span> <span class="n">expr</span><span class="o">)</span> <span class="o">:</span> <span class="n">expr</span>
<span class="c">/-</span><span class="cm"> Function application. -/</span>
<span class="bp">|</span> <span class="n">app</span>         <span class="o">:</span> <span class="n">expr</span> <span class="bp">→</span> <span class="n">expr</span> <span class="bp">→</span> <span class="n">expr</span>
<span class="c">/-</span><span class="cm"> Lambda abstraction. eg ```(λ a : α, x)`` -/</span>
<span class="bp">|</span> <span class="n">lam</span>        <span class="o">(</span><span class="n">var_name</span> <span class="o">:</span> <span class="n">name</span><span class="o">)</span> <span class="o">(</span><span class="n">bi</span> <span class="o">:</span> <span class="n">binder_info</span><span class="o">)</span> <span class="o">(</span><span class="n">var_type</span> <span class="o">:</span> <span class="n">expr</span><span class="o">)</span> <span class="o">(</span><span class="n">body</span> <span class="o">:</span> <span class="n">expr</span><span class="o">)</span> <span class="o">:</span> <span class="n">expr</span>
<span class="c">/-</span><span class="cm"> Pi type constructor. eg ```(Π a : α, x)`` and ```(α → β)`` -/</span>
<span class="bp">|</span> <span class="n">pi</span>         <span class="o">(</span><span class="n">var_name</span> <span class="o">:</span> <span class="n">name</span><span class="o">)</span> <span class="o">(</span><span class="n">bi</span> <span class="o">:</span> <span class="n">binder_info</span><span class="o">)</span> <span class="o">(</span><span class="n">var_type</span> <span class="o">:</span> <span class="n">expr</span><span class="o">)</span> <span class="o">(</span><span class="n">body</span> <span class="o">:</span> <span class="n">expr</span><span class="o">)</span> <span class="o">:</span> <span class="n">expr</span>
<span class="c">/-</span><span class="cm"> An explicit let binding. -/</span>
<span class="bp">|</span> <span class="n">elet</span>       <span class="o">(</span><span class="n">var_name</span> <span class="o">:</span> <span class="n">name</span><span class="o">)</span> <span class="o">(</span><span class="n">type</span> <span class="o">:</span> <span class="n">expr</span><span class="o">)</span> <span class="o">(</span><span class="n">assignment</span> <span class="o">:</span> <span class="n">expr</span><span class="o">)</span> <span class="o">(</span><span class="n">body</span> <span class="o">:</span> <span class="n">expr</span><span class="o">)</span> <span class="o">:</span> <span class="n">expr</span>
<span class="c">/-</span><span class="cm"> A macro, see the docstring for `macro_def`.</span>
<span class="cm">  The list of expressions are local constants and metavariables that the macro depends on.</span>
<span class="cm">  -/</span>
<span class="bp">|</span> <span class="n">macro</span>       <span class="o">:</span> <span class="n">macro_def</span> <span class="bp">→</span> <span class="n">list</span> <span class="n">expr</span> <span class="bp">→</span> <span class="n">expr</span>
</code></pre></div>



<a name="198838149"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/%60%3F%60%20exercises/near/198838149" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/.60.3F.60.20exercises.html#198838149">(May 27 2020 at 00:25)</a>:</h4>
<p>You want to check if the type of <code>hyp</code> matches <code>expr.pi _ binder_info.implicit _ _</code></p>



<a name="198838447"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/%60%3F%60%20exercises/near/198838447" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jalex Stark <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/.60.3F.60.20exercises.html#198838447">(May 27 2020 at 00:28)</a>:</h4>
<p>is it possible to do this by writing something like <code>tactic.unify hyp (expr.pi _ binder_info.implicit _ _)</code>?</p>



<a name="198838485"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/%60%3F%60%20exercises/near/198838485" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jalex Stark <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/.60.3F.60.20exercises.html#198838485">(May 27 2020 at 00:29)</a>:</h4>
<p>probably not, I guess it wants there to be an <code>expr</code> in both places there, and it would need to actually fill in the holes to do that, instead of leaving them as patterns</p>



<a name="198838537"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/%60%3F%60%20exercises/near/198838537" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jalex Stark <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/.60.3F.60.20exercises.html#198838537">(May 27 2020 at 00:30)</a>:</h4>
<p>maybe the equation compiler can do it</p>



<a name="198838614"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/%60%3F%60%20exercises/near/198838614" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jalex Stark <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/.60.3F.60.20exercises.html#198838614">(May 27 2020 at 00:31)</a>:</h4>
<p>this doesn't work, haven't yet figured out if it can't work or if I got it slightly wrong :</p>
<div class="codehilite"><pre><span></span><code><span class="n">meta</span> <span class="kn">example</span> <span class="o">(</span><span class="n">hyp</span> <span class="o">:</span> <span class="n">expr</span><span class="o">)</span> <span class="o">:</span> <span class="n">bool</span>
<span class="bp">|</span> <span class="n">expr</span><span class="bp">.</span><span class="n">pi</span> <span class="bp">_</span> <span class="n">binder_info</span><span class="bp">.</span><span class="n">implicit</span> <span class="bp">_</span> <span class="bp">_</span> <span class="o">:=</span> <span class="n">tt</span>
<span class="bp">|</span> <span class="bp">_</span> <span class="o">:=</span> <span class="n">ff</span>
</code></pre></div>



<a name="198838914"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/%60%3F%60%20exercises/near/198838914" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jalex Stark <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/.60.3F.60.20exercises.html#198838914">(May 27 2020 at 00:36)</a>:</h4>
<p>this also doesn't work, so I should go learn what the equation compiler does</p>
<div class="codehilite"><pre><span></span><code><span class="kn">example</span> <span class="o">:</span> <span class="n">nat</span> <span class="bp">→</span> <span class="n">bool</span>
<span class="bp">|</span> <span class="n">nat</span><span class="bp">.</span><span class="n">zero</span> <span class="o">:=</span> <span class="n">tt</span>
<span class="bp">|</span> <span class="n">nat</span><span class="bp">.</span><span class="n">succ</span> <span class="bp">_</span> <span class="o">:=</span> <span class="n">ff</span>
</code></pre></div>



<a name="198839060"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/%60%3F%60%20exercises/near/198839060" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/.60.3F.60.20exercises.html#198839060">(May 27 2020 at 00:39)</a>:</h4>
<p>You're missing parentheses.</p>



<a name="198839115"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/%60%3F%60%20exercises/near/198839115" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/.60.3F.60.20exercises.html#198839115">(May 27 2020 at 00:40)</a>:</h4>
<p><span class="user-mention silent" data-user-id="252300">Jalex Stark</span> <a href="#narrow/stream/239415-metaprogramming-.2F.20tactics/topic/.60.3F.60.20exercises/near/198838914">said</a>:</p>
<blockquote>
<div class="codehilite"><pre><span></span><code><span class="kn">example</span> <span class="o">:</span> <span class="n">nat</span> <span class="bp">→</span> <span class="n">bool</span>
<span class="bp">|</span> <span class="n">nat</span><span class="bp">.</span><span class="n">zero</span> <span class="o">:=</span> <span class="n">tt</span>
<span class="bp">|</span> <span class="o">(</span><span class="n">nat</span><span class="bp">.</span><span class="n">succ</span> <span class="bp">_</span><span class="o">)</span> <span class="o">:=</span> <span class="n">ff</span>
<span class="bp">````</span>
</code></pre></div>


</blockquote>



<a name="198839118"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/%60%3F%60%20exercises/near/198839118" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/.60.3F.60.20exercises.html#198839118">(May 27 2020 at 00:40)</a>:</h4>
<p>(Pattern matching can be used with multiple arguments.)</p>



<a name="198839128"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/%60%3F%60%20exercises/near/198839128" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jalex Stark <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/.60.3F.60.20exercises.html#198839128">(May 27 2020 at 00:41)</a>:</h4>
<p>ah that makes sense, thanks</p>



<a name="198839197"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/%60%3F%60%20exercises/near/198839197" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jalex Stark <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/.60.3F.60.20exercises.html#198839197">(May 27 2020 at 00:42)</a>:</h4>
<p>Nice, this almost works</p>
<div class="codehilite"><pre><span></span><code><span class="n">meta</span> <span class="kn">example</span> <span class="o">:</span> <span class="n">expr</span> <span class="bp">→</span> <span class="n">bool</span>
<span class="bp">|</span> <span class="o">(</span><span class="n">expr</span><span class="bp">.</span><span class="n">pi</span> <span class="bp">_</span> <span class="bp">_</span> <span class="n">binder_info</span><span class="bp">.</span><span class="n">implicit</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">)</span> <span class="o">:=</span> <span class="n">tt</span>
<span class="bp">|</span> <span class="bp">_</span> <span class="o">:=</span> <span class="n">ff</span>
</code></pre></div>



<a name="198839286"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/%60%3F%60%20exercises/near/198839286" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jalex Stark <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/.60.3F.60.20exercises.html#198839286">(May 27 2020 at 00:44)</a>:</h4>
<p>I think this is what we wanted</p>
<div class="codehilite"><pre><span></span><code><span class="n">meta</span> <span class="kn">example</span> <span class="o">:</span> <span class="n">expr</span> <span class="bp">→</span> <span class="n">bool</span>
<span class="bp">|</span> <span class="o">(</span><span class="n">expr</span><span class="bp">.</span><span class="n">pi</span> <span class="bp">_</span> <span class="n">binder_info</span><span class="bp">.</span><span class="n">implicit</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">)</span> <span class="o">:=</span> <span class="n">tt</span>
<span class="bp">|</span> <span class="bp">_</span> <span class="o">:=</span> <span class="n">ff</span>
</code></pre></div>



<a name="198839776"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/%60%3F%60%20exercises/near/198839776" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jalex Stark <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/.60.3F.60.20exercises.html#198839776">(May 27 2020 at 00:54)</a>:</h4>
<p>except that lean can't infer <code>decidable (is_implicit hyp)</code></p>



<a name="198840184"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/%60%3F%60%20exercises/near/198840184" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/.60.3F.60.20exercises.html#198840184">(May 27 2020 at 01:03)</a>:</h4>
<p>what is <code>is_implicit</code>?</p>



<a name="198840312"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/%60%3F%60%20exercises/near/198840312" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jalex Stark <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/.60.3F.60.20exercises.html#198840312">(May 27 2020 at 01:06)</a>:</h4>
<p>hah, sorry, I was pretending that I was just talking to myself</p>
<div class="codehilite"><pre><span></span><code><span class="n">meta</span> <span class="n">def</span> <span class="n">is_implicit</span> <span class="o">:</span> <span class="n">expr</span> <span class="bp">→</span> <span class="n">bool</span>
<span class="bp">|</span> <span class="o">(</span><span class="n">expr</span><span class="bp">.</span><span class="n">pi</span> <span class="bp">_</span> <span class="n">binder_info</span><span class="bp">.</span><span class="n">implicit</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">)</span> <span class="o">:=</span> <span class="n">tt</span>
<span class="bp">|</span> <span class="bp">_</span> <span class="o">:=</span> <span class="n">ff</span>
</code></pre></div>



<a name="198840338"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/%60%3F%60%20exercises/near/198840338" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jalex Stark <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/.60.3F.60.20exercises.html#198840338">(May 27 2020 at 01:07)</a>:</h4>
<p>currently I think <code>is_implicit</code> is not firing when we expect it to</p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="n">tactic</span>

<span class="kn">open</span> <span class="n">lean</span><span class="bp">.</span><span class="n">parser</span> <span class="n">interactive</span>
<span class="kn">open</span> <span class="n">tactic</span>

<span class="n">meta</span> <span class="n">def</span> <span class="n">find_matching_type</span> <span class="o">(</span><span class="n">e</span> <span class="o">:</span> <span class="n">expr</span><span class="o">)</span> <span class="o">:</span> <span class="n">list</span> <span class="n">expr</span> <span class="bp">→</span> <span class="n">tactic</span> <span class="n">expr</span>
<span class="bp">|</span> <span class="o">[]</span>         <span class="o">:=</span> <span class="n">tactic</span><span class="bp">.</span><span class="n">failed</span>
<span class="bp">|</span> <span class="o">(</span><span class="n">H</span> <span class="bp">::</span> <span class="n">Hs</span><span class="o">)</span>  <span class="o">:=</span> <span class="n">do</span> <span class="n">t</span> <span class="err">←</span> <span class="n">tactic</span><span class="bp">.</span><span class="n">infer_type</span> <span class="n">H</span><span class="o">,</span>
                   <span class="o">(</span><span class="n">tactic</span><span class="bp">.</span><span class="n">unify</span> <span class="n">e</span> <span class="n">t</span> <span class="bp">&gt;&gt;</span> <span class="n">return</span> <span class="n">H</span><span class="o">)</span> <span class="bp">&lt;|&gt;</span> <span class="n">find_matching_type</span> <span class="n">Hs</span>

<span class="n">meta</span> <span class="n">def</span> <span class="n">is_implicit</span> <span class="o">:</span> <span class="n">expr</span> <span class="bp">→</span> <span class="n">bool</span>
<span class="bp">|</span> <span class="o">(</span><span class="n">expr</span><span class="bp">.</span><span class="n">pi</span> <span class="bp">_</span> <span class="n">binder_info</span><span class="bp">.</span><span class="n">implicit</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">)</span> <span class="o">:=</span> <span class="n">tt</span>
<span class="bp">|</span> <span class="bp">_</span> <span class="o">:=</span> <span class="n">ff</span>

<span class="n">meta</span> <span class="n">def</span> <span class="n">my_assumption_aux</span> <span class="o">(</span><span class="n">trace_result</span> <span class="o">:</span> <span class="n">bool</span> <span class="o">:=</span> <span class="n">ff</span><span class="o">)</span> <span class="o">:</span> <span class="n">tactic</span> <span class="n">unit</span> <span class="o">:=</span>
<span class="n">do</span> <span class="o">{</span> <span class="n">ctx</span> <span class="err">←</span> <span class="n">tactic</span><span class="bp">.</span><span class="n">local_context</span><span class="o">,</span>
     <span class="n">t</span>   <span class="err">←</span> <span class="n">tactic</span><span class="bp">.</span><span class="n">target</span><span class="o">,</span>
     <span class="n">hyp</span> <span class="err">←</span> <span class="n">find_matching_type</span> <span class="n">t</span> <span class="n">ctx</span><span class="o">,</span>
     <span class="n">when</span> <span class="n">trace_result</span> <span class="err">$</span>
      <span class="n">do</span> <span class="o">{</span> <span class="n">pp_hyp</span> <span class="err">←</span> <span class="n">pp</span> <span class="n">hyp</span><span class="o">,</span>
      <span class="c1">-- when (tt) $ do { trace &quot;@&quot; },</span>
      <span class="n">when</span> <span class="o">(</span><span class="n">is_implicit</span> <span class="n">hyp</span><span class="o">)</span> <span class="err">$</span> <span class="n">do</span> <span class="o">{</span> <span class="n">trace</span> <span class="s2">&quot;@&quot;</span> <span class="o">},</span>
      <span class="n">trace</span> <span class="o">(</span> <span class="o">(</span><span class="s2">&quot;Try this: exact &quot;</span> <span class="o">:</span> <span class="n">format</span><span class="o">)</span> <span class="bp">++</span> <span class="n">pp_hyp</span><span class="o">)</span> <span class="o">},</span>
     <span class="n">tactic</span><span class="bp">.</span><span class="n">exact</span> <span class="n">hyp</span> <span class="o">}</span>
<span class="bp">&lt;|&gt;</span> <span class="n">tactic</span><span class="bp">.</span><span class="n">fail</span> <span class="s2">&quot;my_assumption tactic failed&quot;</span>

<span class="n">meta</span> <span class="n">def</span> <span class="n">tactic</span><span class="bp">.</span><span class="n">interactive</span><span class="bp">.</span><span class="n">my_assumption</span> <span class="o">(</span><span class="n">trace_result</span> <span class="o">:</span> <span class="n">parse</span> <span class="err">$</span> <span class="n">optional</span> <span class="o">(</span><span class="n">tk</span> <span class="s2">&quot;?&quot;</span><span class="o">))</span> <span class="o">:=</span>
<span class="n">my_assumption_aux</span> <span class="n">trace_result</span><span class="bp">.</span><span class="n">is_some</span>


<span class="kn">example</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="mi">1</span> <span class="bp">=</span> <span class="mi">1</span><span class="o">)</span> <span class="o">:</span> <span class="mi">1</span> <span class="bp">=</span> <span class="mi">1</span> <span class="o">:=</span> <span class="k">begin</span>
<span class="n">my_assumption</span><span class="err">?</span><span class="o">,</span>
<span class="kn">end</span>

<span class="n">expr</span>

<span class="kn">example</span> <span class="o">(</span><span class="n">red_herring</span> <span class="o">:</span> <span class="mi">1</span> <span class="bp">=</span> <span class="mi">1</span><span class="o">)</span> <span class="o">(</span><span class="n">h2</span> <span class="o">:</span> <span class="bp">∀</span><span class="o">{</span><span class="n">x</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">},</span> <span class="n">x</span> <span class="bp">=</span> <span class="n">x</span><span class="o">)</span> <span class="o">:</span>
<span class="bp">∀</span><span class="n">x</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">,</span> <span class="n">x</span> <span class="bp">=</span> <span class="n">x</span> <span class="o">:=</span> <span class="k">begin</span>
<span class="n">my_assumption</span><span class="err">?</span><span class="o">,</span>
<span class="kn">end</span>
</code></pre></div>



<a name="198840409"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/%60%3F%60%20exercises/near/198840409" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/.60.3F.60.20exercises.html#198840409">(May 27 2020 at 01:08)</a>:</h4>
<p>I think ratther than call <code>trace</code> directly you should construct a different <code>format</code> to pass to <code>trace</code></p>



<a name="198840414"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/%60%3F%60%20exercises/near/198840414" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/.60.3F.60.20exercises.html#198840414">(May 27 2020 at 01:08)</a>:</h4>
<p>so that you can append stuff in the right order</p>



<a name="198840427"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/%60%3F%60%20exercises/near/198840427" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jalex Stark <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/.60.3F.60.20exercises.html#198840427">(May 27 2020 at 01:09)</a>:</h4>
<p>I agree, right now the point of the <code>trace "@"</code> statement is to show that the <code>when</code> condition is not firing</p>



<a name="198840430"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/%60%3F%60%20exercises/near/198840430" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jalex Stark <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/.60.3F.60.20exercises.html#198840430">(May 27 2020 at 01:09)</a>:</h4>
<p>(i tried but haven't yet succeeded at writing code that will prepend a "@" to <code>hyp</code>)</p>



<a name="198840441"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/%60%3F%60%20exercises/near/198840441" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/.60.3F.60.20exercises.html#198840441">(May 27 2020 at 01:09)</a>:</h4>
<p>it's the same as with appending <code>format</code> in the trace call</p>



<a name="198840531"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/%60%3F%60%20exercises/near/198840531" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/.60.3F.60.20exercises.html#198840531">(May 27 2020 at 01:10)</a>:</h4>
<p>Also you need to call <code>is_implicit</code> on the type of <code>hyp</code>, not <code>hyp</code> itself</p>



<a name="198840533"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/%60%3F%60%20exercises/near/198840533" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/.60.3F.60.20exercises.html#198840533">(May 27 2020 at 01:10)</a>:</h4>
<p><code>hyp</code> is not a pi type, it is a local constant</p>



<a name="198840743"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/%60%3F%60%20exercises/near/198840743" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jalex Stark <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/.60.3F.60.20exercises.html#198840743">(May 27 2020 at 01:14)</a>:</h4>
<p>that makes sense. I guess I want something with a type signature like <code>expr \r Type*</code>? and its name should be something like <code>eval</code>?</p>



<a name="198840796"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/%60%3F%60%20exercises/near/198840796" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/.60.3F.60.20exercises.html#198840796">(May 27 2020 at 01:15)</a>:</h4>
<p>No</p>



<a name="198840839"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/%60%3F%60%20exercises/near/198840839" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/.60.3F.60.20exercises.html#198840839">(May 27 2020 at 01:16)</a>:</h4>
<p>Hint: The function that gets the type of an expr is already used in your code</p>



<a name="198840934"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/%60%3F%60%20exercises/near/198840934" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jalex Stark <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/.60.3F.60.20exercises.html#198840934">(May 27 2020 at 01:18)</a>:</h4>
<p>Nice, thanks</p>



<a name="198840949"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/%60%3F%60%20exercises/near/198840949" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jalex Stark <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/.60.3F.60.20exercises.html#198840949">(May 27 2020 at 01:19)</a>:</h4>
<p>I have all of the pieces and just need to put them together</p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="n">tactic</span>

<span class="kn">open</span> <span class="n">lean</span><span class="bp">.</span><span class="n">parser</span> <span class="n">interactive</span>
<span class="kn">open</span> <span class="n">tactic</span>

<span class="n">meta</span> <span class="n">def</span> <span class="n">find_matching_type</span> <span class="o">(</span><span class="n">e</span> <span class="o">:</span> <span class="n">expr</span><span class="o">)</span> <span class="o">:</span> <span class="n">list</span> <span class="n">expr</span> <span class="bp">→</span> <span class="n">tactic</span> <span class="n">expr</span>
<span class="bp">|</span> <span class="o">[]</span>         <span class="o">:=</span> <span class="n">tactic</span><span class="bp">.</span><span class="n">failed</span>
<span class="bp">|</span> <span class="o">(</span><span class="n">H</span> <span class="bp">::</span> <span class="n">Hs</span><span class="o">)</span>  <span class="o">:=</span> <span class="n">do</span> <span class="n">t</span> <span class="err">←</span> <span class="n">tactic</span><span class="bp">.</span><span class="n">infer_type</span> <span class="n">H</span><span class="o">,</span>
                   <span class="o">(</span><span class="n">tactic</span><span class="bp">.</span><span class="n">unify</span> <span class="n">e</span> <span class="n">t</span> <span class="bp">&gt;&gt;</span> <span class="n">return</span> <span class="n">H</span><span class="o">)</span> <span class="bp">&lt;|&gt;</span> <span class="n">find_matching_type</span> <span class="n">Hs</span>

<span class="n">meta</span> <span class="n">def</span> <span class="n">is_implicit</span> <span class="o">:</span> <span class="n">expr</span> <span class="bp">→</span> <span class="n">bool</span>
<span class="bp">|</span> <span class="o">(</span><span class="n">expr</span><span class="bp">.</span><span class="n">pi</span> <span class="bp">_</span> <span class="n">binder_info</span><span class="bp">.</span><span class="n">implicit</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">)</span> <span class="o">:=</span> <span class="n">tt</span>
<span class="bp">|</span> <span class="bp">_</span> <span class="o">:=</span> <span class="n">ff</span>

<span class="n">meta</span> <span class="n">def</span> <span class="n">my_assumption_aux</span> <span class="o">(</span><span class="n">trace_result</span> <span class="o">:</span> <span class="n">bool</span> <span class="o">:=</span> <span class="n">ff</span><span class="o">)</span> <span class="o">:</span> <span class="n">tactic</span> <span class="n">unit</span> <span class="o">:=</span>
<span class="n">do</span> <span class="o">{</span> <span class="n">ctx</span> <span class="err">←</span> <span class="n">tactic</span><span class="bp">.</span><span class="n">local_context</span><span class="o">,</span>
     <span class="n">t</span>   <span class="err">←</span> <span class="n">tactic</span><span class="bp">.</span><span class="n">target</span><span class="o">,</span>
     <span class="n">hyp</span> <span class="err">←</span> <span class="n">find_matching_type</span> <span class="n">t</span> <span class="n">ctx</span><span class="o">,</span>
     <span class="n">when</span> <span class="n">trace_result</span> <span class="err">$</span>
      <span class="n">do</span> <span class="o">{</span> <span class="n">pp_hyp</span> <span class="err">←</span> <span class="n">pp</span> <span class="n">hyp</span><span class="o">,</span>
      <span class="n">hyp_type</span> <span class="err">←</span> <span class="n">tactic</span><span class="bp">.</span><span class="n">infer_type</span> <span class="n">hyp</span><span class="o">,</span>
      <span class="n">when</span> <span class="o">(</span><span class="n">is_implicit</span> <span class="n">hyp_type</span> <span class="o">)</span> <span class="err">$</span>
        <span class="n">do</span> <span class="o">{</span> <span class="n">pp_hyp</span> <span class="err">←</span> <span class="n">pp</span> <span class="err">$</span> <span class="o">(</span><span class="s2">&quot;@&quot;</span> <span class="o">:</span> <span class="n">format</span><span class="o">)</span> <span class="bp">++</span> <span class="n">pp_hyp</span><span class="o">,</span> <span class="n">trace</span> <span class="s2">&quot;code reached&quot;</span> <span class="o">},</span>
      <span class="n">trace</span> <span class="o">(</span> <span class="o">(</span><span class="s2">&quot;Try this: exact &quot;</span> <span class="o">:</span> <span class="n">format</span><span class="o">)</span> <span class="bp">++</span> <span class="n">pp_hyp</span><span class="o">)</span> <span class="o">},</span>
     <span class="n">tactic</span><span class="bp">.</span><span class="n">exact</span> <span class="n">hyp</span> <span class="o">}</span>
<span class="bp">&lt;|&gt;</span> <span class="n">tactic</span><span class="bp">.</span><span class="n">fail</span> <span class="s2">&quot;my_assumption tactic failed&quot;</span>

<span class="n">meta</span> <span class="n">def</span> <span class="n">tactic</span><span class="bp">.</span><span class="n">interactive</span><span class="bp">.</span><span class="n">my_assumption</span> <span class="o">(</span><span class="n">trace_result</span> <span class="o">:</span> <span class="n">parse</span> <span class="err">$</span> <span class="n">optional</span> <span class="o">(</span><span class="n">tk</span> <span class="s2">&quot;?&quot;</span><span class="o">))</span> <span class="o">:=</span>
<span class="n">my_assumption_aux</span> <span class="n">trace_result</span><span class="bp">.</span><span class="n">is_some</span>


<span class="kn">example</span> <span class="o">(</span><span class="n">red_herring</span> <span class="o">:</span> <span class="mi">1</span> <span class="bp">=</span> <span class="mi">1</span><span class="o">)</span> <span class="o">(</span><span class="n">h2</span> <span class="o">:</span> <span class="bp">∀</span><span class="o">{</span><span class="n">x</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">},</span> <span class="n">x</span> <span class="bp">=</span> <span class="n">x</span><span class="o">)</span> <span class="o">:</span>
<span class="bp">∀</span><span class="n">x</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">,</span> <span class="n">x</span> <span class="bp">=</span> <span class="n">x</span> <span class="o">:=</span> <span class="k">begin</span>
<span class="n">my_assumption</span><span class="err">?</span><span class="o">,</span>
<span class="kn">end</span>
</code></pre></div>



<a name="198841063"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/%60%3F%60%20exercises/near/198841063" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jalex Stark <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/.60.3F.60.20exercises.html#198841063">(May 27 2020 at 01:21)</a>:</h4>
<p>in the above, when i run the tactic in the example, I get the "code reached" message, but I don't have "@" appended to the front of "h2"</p>



<a name="198841115"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/%60%3F%60%20exercises/near/198841115" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jalex Stark <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/.60.3F.60.20exercises.html#198841115">(May 27 2020 at 01:22)</a>:</h4>
<p>and I meant for this line to do both of those things</p>
<div class="codehilite"><pre><span></span><code><span class="n">do</span> <span class="o">{</span> <span class="n">pp_hyp</span> <span class="err">←</span> <span class="n">pp</span> <span class="err">$</span> <span class="o">(</span><span class="s2">&quot;@&quot;</span> <span class="o">:</span> <span class="n">format</span><span class="o">)</span> <span class="bp">++</span> <span class="n">pp_hyp</span><span class="o">,</span> <span class="n">trace</span> <span class="s2">&quot;code reached&quot;</span> <span class="o">}</span>
</code></pre></div>



<a name="198841132"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/%60%3F%60%20exercises/near/198841132" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/.60.3F.60.20exercises.html#198841132">(May 27 2020 at 01:22)</a>:</h4>
<p>You don't want to <code>pp</code>the at sign</p>



<a name="198841144"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/%60%3F%60%20exercises/near/198841144" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/.60.3F.60.20exercises.html#198841144">(May 27 2020 at 01:23)</a>:</h4>
<p>that's the function for turning an <code>expr</code> into a format</p>



<a name="198841149"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/%60%3F%60%20exercises/near/198841149" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/.60.3F.60.20exercises.html#198841149">(May 27 2020 at 01:23)</a>:</h4>
<p>the function that turns a string into a format is coe</p>



<a name="198841157"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/%60%3F%60%20exercises/near/198841157" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jalex Stark <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/.60.3F.60.20exercises.html#198841157">(May 27 2020 at 01:23)</a>:</h4>
<p>i was <code>pp</code>ing the whole <code>format</code> after appending them</p>



<a name="198841204"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/%60%3F%60%20exercises/near/198841204" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jalex Stark <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/.60.3F.60.20exercises.html#198841204">(May 27 2020 at 01:24)</a>:</h4>
<p>I tried replacing <code>pp</code> with <code>return</code> and it didn't give better results, though <code>return</code> is probably still better</p>



<a name="198841205"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/%60%3F%60%20exercises/near/198841205" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/.60.3F.60.20exercises.html#198841205">(May 27 2020 at 01:24)</a>:</h4>
<p>try <code>let hyp_format := if is_implicit hyp_type then \u"@" ++ pp_hyp else pp_hyp</code></p>



<a name="198841213"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/%60%3F%60%20exercises/near/198841213" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jalex Stark <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/.60.3F.60.20exercises.html#198841213">(May 27 2020 at 01:24)</a>:</h4>
<p>ooh</p>



<a name="198841217"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/%60%3F%60%20exercises/near/198841217" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jalex Stark <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/.60.3F.60.20exercises.html#198841217">(May 27 2020 at 01:24)</a>:</h4>
<p>but <code>ite</code> will want a <code>Prop</code> right? I guess it will coerce</p>



<a name="198841222"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/%60%3F%60%20exercises/near/198841222" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/.60.3F.60.20exercises.html#198841222">(May 27 2020 at 01:24)</a>:</h4>
<p>yep</p>



<a name="198841238"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/%60%3F%60%20exercises/near/198841238" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/.60.3F.60.20exercises.html#198841238">(May 27 2020 at 01:25)</a>:</h4>
<p>you can use <code>cond</code> instead if you find that distasteful, but the syntax is not as nice</p>



<a name="198841340"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/%60%3F%60%20exercises/near/198841340" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jalex Stark <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/.60.3F.60.20exercises.html#198841340">(May 27 2020 at 01:27)</a>:</h4>
<p>no this is fine; i was on alert about Prop vs bool because <br>
earlier i made the mistake of defining <code>is_implicit</code> as <code>expr \to Prop</code>; then it wanted a proof of decidability</p>



<a name="198841366"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/%60%3F%60%20exercises/near/198841366" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jalex Stark <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/.60.3F.60.20exercises.html#198841366">(May 27 2020 at 01:27)</a>:</h4>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="n">tactic</span>

<span class="kn">open</span> <span class="n">lean</span><span class="bp">.</span><span class="n">parser</span> <span class="n">interactive</span>
<span class="kn">open</span> <span class="n">tactic</span>

<span class="n">meta</span> <span class="n">def</span> <span class="n">find_matching_type</span> <span class="o">(</span><span class="n">e</span> <span class="o">:</span> <span class="n">expr</span><span class="o">)</span> <span class="o">:</span> <span class="n">list</span> <span class="n">expr</span> <span class="bp">→</span> <span class="n">tactic</span> <span class="n">expr</span>
<span class="bp">|</span> <span class="o">[]</span>         <span class="o">:=</span> <span class="n">tactic</span><span class="bp">.</span><span class="n">failed</span>
<span class="bp">|</span> <span class="o">(</span><span class="n">H</span> <span class="bp">::</span> <span class="n">Hs</span><span class="o">)</span>  <span class="o">:=</span> <span class="n">do</span> <span class="n">t</span> <span class="err">←</span> <span class="n">tactic</span><span class="bp">.</span><span class="n">infer_type</span> <span class="n">H</span><span class="o">,</span>
                   <span class="o">(</span><span class="n">tactic</span><span class="bp">.</span><span class="n">unify</span> <span class="n">e</span> <span class="n">t</span> <span class="bp">&gt;&gt;</span> <span class="n">return</span> <span class="n">H</span><span class="o">)</span> <span class="bp">&lt;|&gt;</span> <span class="n">find_matching_type</span> <span class="n">Hs</span>

<span class="n">meta</span> <span class="n">def</span> <span class="n">is_implicit</span> <span class="o">:</span> <span class="n">expr</span> <span class="bp">→</span> <span class="n">bool</span>
<span class="bp">|</span> <span class="o">(</span><span class="n">expr</span><span class="bp">.</span><span class="n">pi</span> <span class="bp">_</span> <span class="n">binder_info</span><span class="bp">.</span><span class="n">implicit</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">)</span> <span class="o">:=</span> <span class="n">tt</span>
<span class="bp">|</span> <span class="bp">_</span> <span class="o">:=</span> <span class="n">ff</span>

<span class="n">meta</span> <span class="n">def</span> <span class="n">my_assumption_aux</span> <span class="o">(</span><span class="n">trace_result</span> <span class="o">:</span> <span class="n">bool</span> <span class="o">:=</span> <span class="n">ff</span><span class="o">)</span> <span class="o">:</span> <span class="n">tactic</span> <span class="n">unit</span> <span class="o">:=</span>
<span class="n">do</span> <span class="o">{</span> <span class="n">ctx</span> <span class="err">←</span> <span class="n">tactic</span><span class="bp">.</span><span class="n">local_context</span><span class="o">,</span>
     <span class="n">t</span>   <span class="err">←</span> <span class="n">tactic</span><span class="bp">.</span><span class="n">target</span><span class="o">,</span>
     <span class="n">hyp</span> <span class="err">←</span> <span class="n">find_matching_type</span> <span class="n">t</span> <span class="n">ctx</span><span class="o">,</span>
     <span class="n">when</span> <span class="n">trace_result</span> <span class="err">$</span>
      <span class="n">do</span> <span class="o">{</span> <span class="n">pp_hyp</span> <span class="err">←</span> <span class="n">pp</span> <span class="n">hyp</span><span class="o">,</span>
      <span class="n">hyp_type</span> <span class="err">←</span> <span class="n">tactic</span><span class="bp">.</span><span class="n">infer_type</span> <span class="n">hyp</span><span class="o">,</span>
      <span class="k">let</span> <span class="n">hyp_format</span> <span class="o">:=</span> <span class="k">if</span> <span class="n">is_implicit</span> <span class="n">hyp_type</span> <span class="k">then</span> <span class="err">↑</span><span class="s2">&quot;@&quot;</span> <span class="bp">++</span> <span class="n">pp_hyp</span> <span class="k">else</span> <span class="n">pp_hyp</span><span class="o">,</span>
      <span class="n">trace</span> <span class="o">(</span> <span class="o">(</span><span class="s2">&quot;Try this: exact &quot;</span> <span class="o">:</span> <span class="n">format</span><span class="o">)</span> <span class="bp">++</span> <span class="n">hyp_format</span><span class="o">)</span> <span class="o">},</span>
     <span class="n">tactic</span><span class="bp">.</span><span class="n">exact</span> <span class="n">hyp</span> <span class="o">}</span>
<span class="bp">&lt;|&gt;</span> <span class="n">tactic</span><span class="bp">.</span><span class="n">fail</span> <span class="s2">&quot;my_assumption tactic failed&quot;</span>

<span class="n">meta</span> <span class="n">def</span> <span class="n">tactic</span><span class="bp">.</span><span class="n">interactive</span><span class="bp">.</span><span class="n">my_assumption</span> <span class="o">(</span><span class="n">trace_result</span> <span class="o">:</span> <span class="n">parse</span> <span class="err">$</span> <span class="n">optional</span> <span class="o">(</span><span class="n">tk</span> <span class="s2">&quot;?&quot;</span><span class="o">))</span> <span class="o">:=</span>
<span class="n">my_assumption_aux</span> <span class="n">trace_result</span><span class="bp">.</span><span class="n">is_some</span>


<span class="kn">example</span> <span class="o">(</span><span class="n">a</span> <span class="o">:</span> <span class="mi">1</span> <span class="bp">=</span> <span class="mi">1</span><span class="o">)</span> <span class="o">:</span> <span class="mi">1</span> <span class="bp">=</span> <span class="mi">1</span> <span class="o">:=</span>
<span class="k">begin</span>
<span class="n">my_assumption</span><span class="err">?</span><span class="o">,</span>
<span class="kn">end</span>

<span class="kn">example</span> <span class="o">(</span><span class="n">red_herring</span> <span class="o">:</span> <span class="mi">1</span> <span class="bp">=</span> <span class="mi">1</span><span class="o">)</span> <span class="o">(</span><span class="n">h2</span> <span class="o">:</span> <span class="bp">∀</span><span class="o">{</span><span class="n">x</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">},</span> <span class="n">x</span> <span class="bp">=</span> <span class="n">x</span><span class="o">)</span> <span class="o">:</span>
<span class="bp">∀</span><span class="n">x</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">,</span> <span class="n">x</span> <span class="bp">=</span> <span class="n">x</span> <span class="o">:=</span> <span class="k">begin</span>
<span class="n">my_assumption</span><span class="err">?</span><span class="o">,</span>
<span class="kn">end</span>
</code></pre></div>



<a name="198841425"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/%60%3F%60%20exercises/near/198841425" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jalex Stark <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/.60.3F.60.20exercises.html#198841425">(May 27 2020 at 01:28)</a>:</h4>
<p>this works, I have a trivial test case and a test case with the implicit binder feature</p>



<a name="198841436"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/%60%3F%60%20exercises/near/198841436" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jannis Limperg <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/.60.3F.60.20exercises.html#198841436">(May 27 2020 at 01:28)</a>:</h4>
<p>(The root of your previous error was a confusion about scope in <code>do</code> blocks. In the expression</p>
<div class="codehilite"><pre><span></span><code><span class="n">do</span> <span class="o">{</span>
  <span class="n">pp_hyp</span> <span class="bp">&lt;-</span> <span class="bp">...</span><span class="o">,</span>
  <span class="n">when</span> <span class="bp">...</span> <span class="err">$</span> <span class="n">do</span> <span class="o">{</span>
    <span class="n">pp_hyp</span> <span class="bp">&lt;-</span> <span class="bp">...</span>
  <span class="o">},</span>
  <span class="n">trace</span> <span class="o">(</span><span class="bp">...</span> <span class="n">pp_hyp</span><span class="o">)</span>
<span class="o">}</span>
</code></pre></div>


<p>the final pp_hyp refers to the first binding, not the second one. When you leave a <code>do</code> block, its bindings go out of scope.)</p>



<a name="198841469"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/%60%3F%60%20exercises/near/198841469" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jalex Stark <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/.60.3F.60.20exercises.html#198841469">(May 27 2020 at 01:29)</a>:</h4>
<p>the code above works now, it has two test cases. <br>
I guess it should inherit all of the test cases of <code>assumption</code> also</p>



<a name="198841519"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/%60%3F%60%20exercises/near/198841519" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/.60.3F.60.20exercises.html#198841519">(May 27 2020 at 01:30)</a>:</h4>
<p>If you want to use <code>pp_hyp</code> outside the block, you have to do something like </p>
<div class="codehilite"><pre><span></span><code><span class="n">do</span>
  <span class="n">pp_hyp</span> <span class="bp">&lt;-</span> <span class="bp">...</span><span class="o">,</span>
  <span class="n">pp_hyp</span> <span class="bp">&lt;-</span> <span class="k">if</span> <span class="bp">...</span> <span class="k">then</span> <span class="n">do</span>
    <span class="n">pp_hyp</span> <span class="bp">&lt;-</span> <span class="bp">...</span><span class="o">,</span>
    <span class="n">return</span> <span class="n">pp_hyp</span>
  <span class="k">else</span> <span class="n">return</span> <span class="n">pp_hyp</span><span class="o">,</span>
  <span class="n">use</span> <span class="n">pp_hyp</span>
</code></pre></div>



<a name="198842559"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/%60%3F%60%20exercises/near/198842559" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jalex Stark <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/.60.3F.60.20exercises.html#198842559">(May 27 2020 at 01:53)</a>:</h4>
<p>I think I'm supposed to add tests here<br>
<a href="https://github.com/leanprover-community/lean/tree/master/tests/lean/interactive">https://github.com/leanprover-community/lean/tree/master/tests/lean/interactive</a><br>
I guess in a new file?</p>



<a name="198842624"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/%60%3F%60%20exercises/near/198842624" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jalex Stark <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/.60.3F.60.20exercises.html#198842624">(May 27 2020 at 01:55)</a>:</h4>
<p>I didn't find any tests for <code>assumption</code> by just poking around in tests/lean/*</p>



<a name="198842632"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/%60%3F%60%20exercises/near/198842632" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jalex Stark <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/.60.3F.60.20exercises.html#198842632">(May 27 2020 at 01:55)</a>:</h4>
<p>(but i admit I didn't try using a real search tool like grep)</p>



<a name="198842703"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/%60%3F%60%20exercises/near/198842703" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jalex Stark <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/.60.3F.60.20exercises.html#198842703">(May 27 2020 at 01:56)</a>:</h4>
<p>I guess I also don't have permission to push a PR to leanprover-community/lean</p>



<a name="198842726"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/%60%3F%60%20exercises/near/198842726" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jalex Stark <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/.60.3F.60.20exercises.html#198842726">(May 27 2020 at 01:57)</a>:</h4>
<p>(i'll move this conversation back out into the open, it's not about fiddly <code>meta</code> code details anymore)</p>



<a name="204063371"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/%60%3F%60%20exercises/near/204063371" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Nicolò Cavalleri <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/.60.3F.60.20exercises.html#204063371">(Jul 16 2020 at 09:41)</a>:</h4>
<p>Since I am always working with goals like this one:</p>
<div class="codehilite"><pre><span></span><code><span class="o">(((</span><span class="bp">∃</span> <span class="o">(</span><span class="n">y</span> <span class="o">:</span> <span class="n">H</span><span class="o">),</span> <span class="err">⇑</span><span class="n">I</span> <span class="n">y</span> <span class="bp">=</span> <span class="n">z</span><span class="bp">.</span><span class="n">fst</span><span class="o">)</span> <span class="bp">∧</span> <span class="err">⇑</span><span class="o">(</span><span class="n">I</span><span class="bp">.</span><span class="n">symm</span><span class="o">)</span> <span class="n">z</span><span class="bp">.</span><span class="n">fst</span>
<span class="err">∈</span> <span class="o">(</span><span class="n">chart_at</span> <span class="n">H</span> <span class="n">x</span><span class="bp">.</span><span class="n">fst</span><span class="o">)</span><span class="bp">.</span><span class="n">to_local_equiv</span><span class="bp">.</span><span class="n">target</span><span class="o">)</span> <span class="bp">∧</span>
<span class="n">f</span> <span class="o">(</span><span class="err">⇑</span><span class="o">((</span><span class="n">chart_at</span> <span class="n">H</span> <span class="n">x</span><span class="bp">.</span><span class="n">fst</span><span class="o">)</span><span class="bp">.</span><span class="n">symm</span><span class="o">)</span> <span class="o">(</span><span class="err">⇑</span><span class="o">(</span><span class="n">I</span><span class="bp">.</span><span class="n">symm</span><span class="o">)</span> <span class="n">z</span><span class="bp">.</span><span class="n">fst</span><span class="o">))</span>
<span class="err">∈</span> <span class="o">(</span><span class="n">chart_at</span> <span class="n">H&#39;</span> <span class="n">y</span><span class="bp">.</span><span class="n">fst</span><span class="o">)</span><span class="bp">.</span><span class="n">to_local_equiv</span><span class="bp">.</span><span class="n">source</span><span class="o">)</span> <span class="bp">∧</span>
<span class="o">((</span><span class="bp">∃</span> <span class="o">(</span><span class="n">y</span> <span class="o">:</span> <span class="n">G</span><span class="o">),</span> <span class="err">⇑</span><span class="n">J</span> <span class="n">y</span> <span class="bp">=</span> <span class="n">z</span><span class="bp">.</span><span class="n">snd</span><span class="o">)</span> <span class="bp">∧</span> <span class="err">⇑</span><span class="o">(</span><span class="n">J</span><span class="bp">.</span><span class="n">symm</span><span class="o">)</span> <span class="n">z</span><span class="bp">.</span><span class="n">snd</span>
<span class="err">∈</span> <span class="o">(</span><span class="n">chart_at</span> <span class="n">G</span> <span class="n">x</span><span class="bp">.</span><span class="n">snd</span><span class="o">)</span><span class="bp">.</span><span class="n">to_local_equiv</span><span class="bp">.</span><span class="n">target</span><span class="o">)</span>
<span class="bp">∧</span> <span class="n">g</span> <span class="o">(</span><span class="err">⇑</span><span class="o">((</span><span class="n">chart_at</span> <span class="n">G</span> <span class="n">x</span><span class="bp">.</span><span class="n">snd</span><span class="o">)</span><span class="bp">.</span><span class="n">symm</span><span class="o">)</span> <span class="o">(</span><span class="err">⇑</span><span class="o">(</span><span class="n">J</span><span class="bp">.</span><span class="n">symm</span><span class="o">)</span> <span class="n">z</span><span class="bp">.</span><span class="n">snd</span><span class="o">))</span>
<span class="err">∈</span> <span class="o">(</span><span class="n">chart_at</span> <span class="n">G&#39;</span> <span class="n">y</span><span class="bp">.</span><span class="n">snd</span><span class="o">)</span><span class="bp">.</span><span class="n">to_local_equiv</span><span class="bp">.</span><span class="n">source</span>
</code></pre></div>


<p>and I always need to manually use refine to split all the ands in multiple subgoals, loosing a lot of time, I was wondering if there were anybody here who is good at writing tactics able, without too much effort,  to write a tactic <code>refine?</code> that does this automatically?</p>



<a name="204063900"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/%60%3F%60%20exercises/near/204063900" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastien Gouezel <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/.60.3F.60.20exercises.html#204063900">(Jul 16 2020 at 09:48)</a>:</h4>
<p>Normally, when you get to a goal like that the simplifier should help you clear most of it. Two remarks:</p>
<ul>
<li>you have probably simplified with <code>simp</code>. If you use <code>simp with mfld_simps</code> it won't use <code>mem_range_iff</code> that screwed things a little bit (you can see this existential quantifier in the goal, it's never good news).</li>
<li>If you are trying to prove that sets are equal to one another or included in one another, <code>mfld_set_tac</code> (that I have introduced in my recent manifold commit) can help you.</li>
</ul>
<p>If you have a <a href="https://leanprover-community.github.io/mwe.html">#mwe</a>, I can have a look.</p>



<a name="204064135"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/%60%3F%60%20exercises/near/204064135" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/.60.3F.60.20exercises.html#204064135">(Jul 16 2020 at 09:51)</a>:</h4>
<p>The general question is still legitimate</p>



<a name="204064593"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/%60%3F%60%20exercises/near/204064593" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Nicolò Cavalleri <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/.60.3F.60.20exercises.html#204064593">(Jul 16 2020 at 09:57)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110050">Sebastien Gouezel</span> <a href="#narrow/stream/239415-metaprogramming-.2F.20tactics/topic/.60.3F.60.20exercises/near/204063900">said</a>:</p>
<blockquote>
<p>Normally, when you get to a goal like that the simplifier should help you clear most of it. Two remarks:</p>
<ul>
<li>you have probably simplified with <code>simp</code>. If you use <code>simp with mfld_simps</code> it won't use <code>mem_range_iff</code> that screwed things a little bit (you can see this existential quantifier in the goal, it's never good news).</li>
<li>If you are trying to prove that sets are equal to one another or included in one another, <code>mfld_set_tac</code> (that I have introduced in my recent manifold commit) can help you.</li>
</ul>
<p>If you have a <a href="https://leanprover-community.github.io/mwe.html">#mwe</a>, I can have a look.</p>
</blockquote>
<p>I am using <code>mfld_simps</code> only and I did try <code>mfld_set_tac</code> (I read your new PR!) but it does not work in my case unfortunately. I am basically just rewriting in a shorter way the proofs about standard product maps you saw already. I will push everything in the branch Lie groups as soon as I am done and I will tell you so that you can tell me if you have tips for smarter proofs.</p>



<a name="204064698"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/%60%3F%60%20exercises/near/204064698" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Nicolò Cavalleri <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/.60.3F.60.20exercises.html#204064698">(Jul 16 2020 at 09:58)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110031">Patrick Massot</span> <a href="#narrow/stream/239415-metaprogramming-.2F.20tactics/topic/.60.3F.60.20exercises/near/204064135">said</a>:</p>
<blockquote>
<p>The general question is still legitimate</p>
</blockquote>
<p>In any case yeah I would still love this tactic and if <code>assumption?</code> were ready it'd be sooo cool if it could already close with the corect hypotheses the goals that can be closed with <code>assumption</code></p>



<a name="204064741"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/%60%3F%60%20exercises/near/204064741" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/.60.3F.60.20exercises.html#204064741">(Jul 16 2020 at 09:59)</a>:</h4>
<p>this sounds more like a <code>splits</code> tactic</p>



<a name="204064774"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/%60%3F%60%20exercises/near/204064774" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/.60.3F.60.20exercises.html#204064774">(Jul 16 2020 at 09:59)</a>:</h4>
<p>Yes, the original question was about <code>splits</code></p>



<a name="204064850"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/%60%3F%60%20exercises/near/204064850" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/.60.3F.60.20exercises.html#204064850">(Jul 16 2020 at 10:00)</a>:</h4>
<p><code>refine?</code> sounds a bit ambiguous because <code>refine</code> is the everything tactic</p>



<a name="204065316"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/%60%3F%60%20exercises/near/204065316" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Nicolò Cavalleri <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/.60.3F.60.20exercises.html#204065316">(Jul 16 2020 at 10:06)</a>:</h4>
<p>I don' know the name but sometimes I have a long goal like this one:</p>
<div class="codehilite"><pre><span></span><code><span class="o">(((</span><span class="bp">∃</span> <span class="o">(</span><span class="n">y</span> <span class="o">:</span> <span class="n">H</span><span class="o">),</span> <span class="err">⇑</span><span class="n">I</span> <span class="n">y</span> <span class="bp">=</span> <span class="n">z</span><span class="bp">.</span><span class="n">fst</span><span class="o">)</span> <span class="bp">∧</span> <span class="err">⇑</span><span class="o">(</span><span class="n">I</span><span class="bp">.</span><span class="n">symm</span><span class="o">)</span> <span class="n">z</span><span class="bp">.</span><span class="n">fst</span>
<span class="err">∈</span> <span class="o">(</span><span class="n">chart_at</span> <span class="n">H</span> <span class="n">x</span><span class="bp">.</span><span class="n">fst</span><span class="o">)</span><span class="bp">.</span><span class="n">to_local_equiv</span><span class="bp">.</span><span class="n">target</span><span class="o">)</span>
<span class="bp">∧</span> <span class="o">(</span><span class="bp">∃</span> <span class="o">(</span><span class="n">y</span> <span class="o">:</span> <span class="n">G</span><span class="o">),</span> <span class="err">⇑</span><span class="n">J</span> <span class="n">y</span> <span class="bp">=</span> <span class="n">z</span><span class="bp">.</span><span class="n">snd</span><span class="o">)</span> <span class="bp">∧</span> <span class="err">⇑</span><span class="o">(</span><span class="n">J</span><span class="bp">.</span><span class="n">symm</span><span class="o">)</span> <span class="n">z</span><span class="bp">.</span><span class="n">snd</span>
<span class="err">∈</span> <span class="o">(</span><span class="n">chart_at</span> <span class="n">G</span> <span class="n">x</span><span class="bp">.</span><span class="n">snd</span><span class="o">)</span><span class="bp">.</span><span class="n">to_local_equiv</span><span class="bp">.</span><span class="n">target</span><span class="o">)</span>
<span class="bp">∧</span> <span class="err">⇑</span><span class="o">((</span><span class="n">chart_at</span> <span class="n">H</span> <span class="n">x</span><span class="bp">.</span><span class="n">fst</span><span class="o">)</span><span class="bp">.</span><span class="n">symm</span><span class="o">)</span> <span class="o">(</span><span class="err">⇑</span><span class="o">(</span><span class="n">I</span><span class="bp">.</span><span class="n">symm</span><span class="o">)</span> <span class="n">z</span><span class="bp">.</span><span class="n">fst</span><span class="o">)</span>
<span class="err">∈</span> <span class="o">(</span><span class="n">chart_at</span> <span class="n">H</span> <span class="n">y</span><span class="o">)</span><span class="bp">.</span><span class="n">to_local_equiv</span><span class="bp">.</span><span class="n">source</span> <span class="bp">→</span>
<span class="o">(((</span><span class="err">⇑</span><span class="o">(</span><span class="n">I</span><span class="bp">.</span><span class="n">symm</span><span class="o">)</span> <span class="n">z</span><span class="bp">.</span><span class="n">fst</span> <span class="err">∈</span>
<span class="o">(</span><span class="n">chart_at</span> <span class="n">H</span> <span class="n">x</span><span class="bp">.</span><span class="n">fst</span><span class="o">)</span><span class="bp">.</span><span class="n">to_local_equiv</span><span class="bp">.</span><span class="n">target</span>
<span class="bp">∧</span> <span class="err">⇑</span><span class="o">((</span><span class="n">chart_at</span> <span class="n">H</span> <span class="n">x</span><span class="bp">.</span><span class="n">fst</span><span class="o">)</span><span class="bp">.</span><span class="n">symm</span><span class="o">)</span> <span class="o">(</span><span class="err">⇑</span><span class="o">(</span><span class="n">I</span><span class="bp">.</span><span class="n">symm</span><span class="o">)</span> <span class="n">z</span><span class="bp">.</span><span class="n">fst</span><span class="o">)</span>
<span class="err">∈</span> <span class="o">(</span><span class="n">chart_at</span> <span class="n">H</span> <span class="n">y</span><span class="o">)</span><span class="bp">.</span><span class="n">to_local_equiv</span><span class="bp">.</span><span class="n">source</span><span class="o">)</span>
<span class="bp">∧</span> <span class="err">⇑</span><span class="o">(</span><span class="n">J</span><span class="bp">.</span><span class="n">symm</span><span class="o">)</span> <span class="n">z</span><span class="bp">.</span><span class="n">snd</span>
<span class="err">∈</span> <span class="o">(</span><span class="n">chart_at</span> <span class="n">G</span> <span class="n">x</span><span class="bp">.</span><span class="n">snd</span><span class="o">)</span><span class="bp">.</span><span class="n">to_local_equiv</span><span class="bp">.</span><span class="n">target</span>
<span class="bp">∧</span> <span class="err">⇑</span><span class="o">((</span><span class="n">chart_at</span> <span class="n">G</span> <span class="n">x</span><span class="bp">.</span><span class="n">snd</span><span class="o">)</span><span class="bp">.</span><span class="n">symm</span><span class="o">)</span> <span class="o">(</span><span class="err">⇑</span><span class="o">(</span><span class="n">J</span><span class="bp">.</span><span class="n">symm</span><span class="o">)</span> <span class="n">z</span><span class="bp">.</span><span class="n">snd</span><span class="o">)</span>
<span class="err">∈</span> <span class="o">(</span><span class="n">chart_at</span> <span class="n">G</span> <span class="n">x</span><span class="bp">.</span><span class="n">snd</span><span class="o">)</span><span class="bp">.</span><span class="n">to_local_equiv</span><span class="bp">.</span><span class="n">source</span><span class="o">)</span> <span class="bp">∧</span>
<span class="bp">∃</span> <span class="o">(</span><span class="n">y</span> <span class="o">:</span> <span class="n">model_prod</span> <span class="n">H</span> <span class="n">G</span><span class="o">),</span> <span class="o">(</span><span class="err">⇑</span><span class="n">I</span> <span class="n">y</span><span class="bp">.</span><span class="n">fst</span><span class="o">,</span> <span class="err">⇑</span><span class="n">J</span> <span class="n">y</span><span class="bp">.</span><span class="n">snd</span><span class="o">)</span> <span class="bp">=</span> <span class="n">z</span><span class="o">)</span>
</code></pre></div>


<p>and with <code>rintros</code>, and by taking some time to rewrite the long <code>rintros</code> names, get</p>
<div class="codehilite"><pre><span></span><code><span class="n">rintro</span> <span class="bp">⟨⟨⟨⟨</span><span class="n">a</span><span class="o">,</span> <span class="n">ha</span><span class="bp">⟩</span><span class="o">,</span> <span class="n">h1</span><span class="bp">⟩</span><span class="o">,</span> <span class="bp">⟨</span><span class="n">b</span><span class="o">,</span> <span class="n">hb</span><span class="bp">⟩</span><span class="o">,</span> <span class="n">h2</span><span class="bp">⟩</span><span class="o">,</span> <span class="n">h3</span><span class="bp">⟩</span><span class="o">,</span>
</code></pre></div>


<p>and the above goal. At this point the goal can be almost always closed with just one refine like</p>
<div class="codehilite"><pre><span></span><code><span class="n">refine</span> <span class="bp">⟨⟨⟨⟨</span><span class="n">a</span><span class="o">,</span> <span class="n">rfl</span><span class="bp">⟩</span><span class="o">,</span> <span class="n">h1</span><span class="bp">⟩</span><span class="o">,</span> <span class="bp">⟨⟨</span><span class="n">b</span><span class="o">,</span> <span class="n">rfl</span><span class="bp">⟩</span><span class="o">,</span> <span class="n">h3</span><span class="bp">⟩⟩</span><span class="o">,</span> <span class="n">h2</span><span class="bp">⟩</span><span class="o">,</span>
</code></pre></div>


<p>or at most with something like</p>
<div class="codehilite"><pre><span></span><code><span class="n">refine</span> <span class="bp">⟨⟨⟨</span><span class="n">h1</span><span class="o">,</span> <span class="n">h3</span><span class="bp">⟩</span><span class="o">,</span> <span class="bp">⟨</span><span class="n">h2</span><span class="o">,</span> <span class="bp">_⟩⟩</span><span class="o">,</span> <span class="bp">⟨⟨</span><span class="n">a</span><span class="o">,</span> <span class="n">b</span><span class="bp">⟩</span><span class="o">,</span> <span class="bp">_⟩⟩</span><span class="o">,</span>
    <span class="o">{</span> <span class="n">apply</span> <span class="n">local_homeomorph</span><span class="bp">.</span><span class="n">map_target</span><span class="o">,</span>
      <span class="n">exact</span> <span class="n">h2</span><span class="o">,</span> <span class="o">},</span>
    <span class="o">{</span> <span class="n">ext</span><span class="o">,</span> <span class="n">exacts</span> <span class="o">[</span><span class="n">ha</span><span class="o">,</span> <span class="n">hb</span><span class="o">],</span> <span class="o">}</span>
</code></pre></div>


<p>I wish the tactic could automatically write the part</p>
<div class="codehilite"><pre><span></span><code><span class="n">refine</span> <span class="bp">⟨⟨⟨</span><span class="n">h1</span><span class="o">,</span> <span class="n">h3</span><span class="bp">⟩</span><span class="o">,</span> <span class="bp">⟨</span><span class="n">h2</span><span class="o">,</span> <span class="bp">_⟩⟩</span><span class="o">,</span> <span class="bp">⟨⟨</span><span class="n">a</span><span class="o">,</span> <span class="n">b</span><span class="bp">⟩</span><span class="o">,</span> <span class="bp">_⟩⟩</span>
</code></pre></div>


<p>and I only had to deal with the rest.<br>
I wouldn't know how to give it a better name then <code>refine?</code></p>



<a name="204065380"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/%60%3F%60%20exercises/near/204065380" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/.60.3F.60.20exercises.html#204065380">(Jul 16 2020 at 10:07)</a>:</h4>
<p>It would be nice if <code>show_term</code> could be used to produce <code>refine</code>  proof scripts as well as <code>exact</code> proof terms</p>



<a name="204065421"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/%60%3F%60%20exercises/near/204065421" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/.60.3F.60.20exercises.html#204065421">(Jul 16 2020 at 10:08)</a>:</h4>
<p>that way you could achieve what you want with roughly <code>show_term {repeat {split &lt;|&gt; assumption}}</code></p>



<a name="204065659"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/%60%3F%60%20exercises/near/204065659" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/.60.3F.60.20exercises.html#204065659">(Jul 16 2020 at 10:11)</a>:</h4>
<p>the <code>repeat {split &lt;|&gt; assumption}</code> part isn't quite right; there are a number of special cases that would suggest a dedicated tactic for this, perhaps called <code>splita</code></p>



<a name="204065702"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/%60%3F%60%20exercises/near/204065702" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/.60.3F.60.20exercises.html#204065702">(Jul 16 2020 at 10:11)</a>:</h4>
<p>but what you are calling <code>refine?</code> could be something that brackets a tactic invocation and returns an equivalent refine script (give or take)</p>



<a name="204065964"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/%60%3F%60%20exercises/near/204065964" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Nicolò Cavalleri <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/.60.3F.60.20exercises.html#204065964">(Jul 16 2020 at 10:15)</a>:</h4>
<p>Well as long as it automates this process I'm happy however it is implemented. Do you think it is something that could be done in the current lean or is it more like a possible future wish</p>



<a name="204066076"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/%60%3F%60%20exercises/near/204066076" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/.60.3F.60.20exercises.html#204066076">(Jul 16 2020 at 10:16)</a>:</h4>
<p>It should be a minor variation on <code>show_term</code></p>



<a name="204066124"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/%60%3F%60%20exercises/near/204066124" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/.60.3F.60.20exercises.html#204066124">(Jul 16 2020 at 10:17)</a>:</h4>
<p><code>splita</code> is also a relatively simple exercise (although it gets more complicated if you have dependent args and many assumption options and want to make maximal progress)</p>



<a name="204066368"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/%60%3F%60%20exercises/near/204066368" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/.60.3F.60.20exercises.html#204066368">(Jul 16 2020 at 10:20)</a>:</h4>
<p>(to be clear: this is all very doable in lean 3)</p>



<a name="204066622"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/%60%3F%60%20exercises/near/204066622" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Nicolò Cavalleri <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/.60.3F.60.20exercises.html#204066622">(Jul 16 2020 at 10:23)</a>:</h4>
<p>Actually you're right <code>show_term {repeat {split &lt;|&gt; assumption}}</code> is pretty much similar to what I wanted even if it writes exacts instead of refine and it doesn't really work in case of exists goals</p>



<a name="204066764"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/%60%3F%60%20exercises/near/204066764" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Nicolò Cavalleri <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/.60.3F.60.20exercises.html#204066764">(Jul 16 2020 at 10:25)</a>:</h4>
<p>I mean I am trying it right now and sometimes the goal can be closed with <code>\&lt;b, rfl\&gt;</code> but this writes <code>Exists.intro (a, b).snd (eq.refl (⇑J (a, b).snd))</code> and then it does not accept its own output</p>



<a name="204066824"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/%60%3F%60%20exercises/near/204066824" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Nicolò Cavalleri <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/.60.3F.60.20exercises.html#204066824">(Jul 16 2020 at 10:26)</a>:</h4>
<p>Probably because coercions are involved</p>



<a name="204066894"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/%60%3F%60%20exercises/near/204066894" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/.60.3F.60.20exercises.html#204066894">(Jul 16 2020 at 10:27)</a>:</h4>
<p>it's apparently not the best at pretty printing anonymous constructors (and it could also do with some proof term simplification)</p>



<a name="204073882"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/%60%3F%60%20exercises/near/204073882" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/.60.3F.60.20exercises.html#204073882">(Jul 16 2020 at 12:03)</a>:</h4>
<p>If you update mathlib, <code>show_term</code> should be printing <code>refine</code> rather than <code>exact</code>.</p>



<a name="204073942"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/%60%3F%60%20exercises/near/204073942" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/.60.3F.60.20exercises.html#204073942">(Jul 16 2020 at 12:04)</a>:</h4>
<p>you could try <code>show_term { dsimp_result { ... } }</code></p>



<a name="204073963"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/%60%3F%60%20exercises/near/204073963" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/.60.3F.60.20exercises.html#204073963">(Jul 16 2020 at 12:04)</a>:</h4>
<p>That should at least get rid of the <code>(a, b).snd</code> stuff.</p>



<a name="204073988"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/%60%3F%60%20exercises/near/204073988" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/.60.3F.60.20exercises.html#204073988">(Jul 16 2020 at 12:05)</a>:</h4>
<p>I wonder if we can drop the coercion arrows from <code>pp</code>?</p>



<a name="204142186"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/%60%3F%60%20exercises/near/204142186" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/.60.3F.60.20exercises.html#204142186">(Jul 16 2020 at 20:59)</a>:</h4>
<p>The multi-split thing came up at Xena this evening, when I had three goals, and <span class="user-mention" data-user-id="243312">@Jason KY.</span> suggested <code>refine </code>\&lt;_, _, _\&gt;` which worked for me.</p>



<a name="204147964"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/%60%3F%60%20exercises/near/204147964" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Nicolò Cavalleri <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/.60.3F.60.20exercises.html#204147964">(Jul 16 2020 at 21:51)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110038">Kevin Buzzard</span> <a href="#narrow/stream/239415-metaprogramming-.2F.20tactics/topic/.60.3F.60.20exercises/near/204142186">said</a>:</p>
<blockquote>
<p>The multi-split thing came up at Xena this evening, when I had three goals, and <span class="user-mention silent" data-user-id="243312">Jason KY.</span> suggested <code>refine </code>\&lt;_, _, _\&gt;` which worked for me.</p>
</blockquote>
<p>You mean just writing it manually? Or are you suggesting another form of automation?</p>



<a name="204151411"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/%60%3F%60%20exercises/near/204151411" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/.60.3F.60.20exercises.html#204151411">(Jul 16 2020 at 22:29)</a>:</h4>
<p>Yes in my case I just wrote it manually, I just didn't want to do two <code>splits</code> because then I'd have lots of bracket indentations but this was a good workaround</p>



<a name="204300434"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/%60%3F%60%20exercises/near/204300434" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Nicolò Cavalleri <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/.60.3F.60.20exercises.html#204300434">(Jul 18 2020 at 13:20)</a>:</h4>
<p>Would it make sense to PR this combination of tactics with a short name? Like</p>
<div class="codehilite"><pre><span></span><code><span class="n">meta</span> <span class="n">def</span> <span class="n">squeeze_splita</span> <span class="o">:</span> <span class="n">tactic</span> <span class="n">unit</span> <span class="o">:=</span>
  <span class="bp">`</span><span class="o">[</span><span class="n">show_term</span> <span class="o">{</span> <span class="n">dsimp_result</span> <span class="o">{</span> <span class="n">norm_cast</span> <span class="o">{</span><span class="n">repeat</span> <span class="o">{</span> <span class="n">split</span> <span class="bp">&lt;|&gt;</span> <span class="n">assumption</span> <span class="o">}}}}]</span>
</code></pre></div>


<p>It is very simple but very useful for 10 lines goals with a lot of ands</p>



<a name="204300508"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/%60%3F%60%20exercises/near/204300508" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Nicolò Cavalleri <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/.60.3F.60.20exercises.html#204300508">(Jul 18 2020 at 13:23)</a>:</h4>
<p>And it is probably very annoying to write <code>show_term { dsimp_result { norm_cast {repeat { split &lt;|&gt; assumption }}}}</code> each time</p>



<a name="204301135"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/%60%3F%60%20exercises/near/204301135" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/.60.3F.60.20exercises.html#204301135">(Jul 18 2020 at 13:44)</a>:</h4>
<p>It seems strange to want to include <code>norm_cast</code> in there. That could produce gross looking terms.</p>



<a name="204301190"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/%60%3F%60%20exercises/near/204301190" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/.60.3F.60.20exercises.html#204301190">(Jul 18 2020 at 13:44)</a>:</h4>
<p>Have you test this with other shaped splits? (Like <code>(nat x nat) x (nat x nat)</code>, for example.)</p>



<a name="204301843"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/%60%3F%60%20exercises/near/204301843" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Nicolò Cavalleri <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/.60.3F.60.20exercises.html#204301843">(Jul 18 2020 at 14:04)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110087">Scott Morrison</span> <a href="#narrow/stream/239415-metaprogramming-.2F.20tactics/topic/.60.3F.60.20exercises/near/204301135">said</a>:</p>
<blockquote>
<p>It seems strange to want to include <code>norm_cast</code> in there. That could produce gross looking terms.</p>
</blockquote>
<p>That was to get rid of the coercion arrows that make the result of this tactic not accepted by lean but it can be removed and then people should just need to remove manually coercion arrows.</p>



<a name="204301900"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/%60%3F%60%20exercises/near/204301900" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Nicolò Cavalleri <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/.60.3F.60.20exercises.html#204301900">(Jul 18 2020 at 14:06)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110087">Scott Morrison</span> <a href="#narrow/stream/239415-metaprogramming-.2F.20tactics/topic/.60.3F.60.20exercises/near/204301190">said</a>:</p>
<blockquote>
<p>Have you test this with other shaped splits? (Like <code>(nat x nat) x (nat x nat)</code>, for example.)</p>
</blockquote>
<p>No I did not test it on anything except for the lemmas where I needed it. If you think this tactic is a good idea then I might try some tests even if I do not even know where to start really as by now I only looked into geometry topology and algebra and I have no idea about what happens in the other sections of the library</p>



<a name="204325288"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/%60%3F%60%20exercises/near/204325288" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/.60.3F.60.20exercises.html#204325288">(Jul 19 2020 at 01:00)</a>:</h4>
<p>Yes, this tactic sounds pretty useful!</p>



<a name="204341856"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/%60%3F%60%20exercises/near/204341856" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Nicolò Cavalleri <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/.60.3F.60.20exercises.html#204341856">(Jul 19 2020 at 09:54)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110087">Scott Morrison</span> <a href="#narrow/stream/239415-metaprogramming-.2F.20tactics/topic/.60.3F.60.20exercises/near/204325288">said</a>:</p>
<blockquote>
<p>Yes, this tactic sounds pretty useful!</p>
</blockquote>
<p>Supposing we PR both a non-interactive version <code>splita</code> and an interactive one, should the interactive one be called <code>squeeze_splita</code> or <code>splita?</code>? I have no idea how the conventions work!</p>



<a name="204380027"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/%60%3F%60%20exercises/near/204380027" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/.60.3F.60.20exercises.html#204380027">(Jul 20 2020 at 01:52)</a>:</h4>
<p>I think the reporting version would be called <code>splita?</code></p>



<a name="204402700"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/%60%3F%60%20exercises/near/204402700" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Nicolò Cavalleri <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/.60.3F.60.20exercises.html#204402700">(Jul 20 2020 at 09:35)</a>:</h4>
<p>Is there no way at all to modify the tactic in such a way that it automatically gets rid of coercion arrows? I'm using it a lot and it is great but this would make it way better</p>



<a name="204405788"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/%60%3F%60%20exercises/near/204405788" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/.60.3F.60.20exercises.html#204405788">(Jul 20 2020 at 10:16)</a>:</h4>
<p>I guess the issue is that you personally might want to remove coercion arrows as well, but perhaps a more principled approach is to regard the coercion issue as a different problem to the splitting multiple ands issue. Why not have a tactic which splits all the ands, and then in your use case you can put a semicolon after it and run <code>norm_cast</code>.</p>



<a name="204411320"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/%60%3F%60%20exercises/near/204411320" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/.60.3F.60.20exercises.html#204411320">(Jul 20 2020 at 11:32)</a>:</h4>
<p>As Kevin says, they seem like quite orthogonal concerns. It's best is most tactics to a single, well-defined thing well, and then higher level tactics can combine them.</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>