---
layout: archive
title: Zulip Chat Archive
permalink: /stream/239415-metaprogramming-/-tactics/topic/.E2.9C.94.20unexpected.20(by.20me).20.60eval_expr.60.20behaviour.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/index.html">metaprogramming / tactics</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/.E2.9C.94.20unexpected.20(by.20me).20.60eval_expr.60.20behaviour.html">✔ unexpected (by me) `eval_expr` behaviour</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="290047510"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/%E2%9C%94%20unexpected%20%28by%20me%29%20%60eval_expr%60%20behaviour/near/290047510" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/.E2.9C.94.20unexpected.20(by.20me).20.60eval_expr.60.20behaviour.html#290047510">(Jul 19 2022 at 02:45)</a>:</h4>
<p>Dear All,</p>
<p>I would have expected the two commands below to evaluate to the same.  Am I doing something wrong?  Is there a substitute for <code>eval_expr</code> that would work in this situation?  I only want to get a natural number from an expression.</p>
<p>Thanks!</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">tactic.core</span>

<span class="k">#eval</span> <span class="n">tactic.trace</span> <span class="bp">$</span> <span class="n">tactic.eval_expr</span> <span class="n">ℕ</span> <span class="bp">`</span><span class="o">(</span><span class="mi">0</span><span class="o">)</span>        <span class="c1">-- works: `0`</span>
<span class="k">#eval</span> <span class="n">tactic.trace</span> <span class="bp">$</span> <span class="n">tactic.eval_expr</span> <span class="n">ℕ</span> <span class="bp">`</span><span class="o">(</span><span class="n">nat.zero</span><span class="o">)</span> <span class="c1">-- fails: VM does not have code for 'nat.zero'</span>
</code></pre></div>



<a name="290047927"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/%E2%9C%94%20unexpected%20%28by%20me%29%20%60eval_expr%60%20behaviour/near/290047927" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/.E2.9C.94.20unexpected.20(by.20me).20.60eval_expr.60.20behaviour.html#290047927">(Jul 19 2022 at 02:53)</a>:</h4>
<p>I just found <a href="https://leanprover-community.github.io/mathlib_docs/find/tactic.eval_expr'">docs#tactic.eval_expr'</a>.  The docstring says:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="sd">/-- `eval_expr' α e` attempts to evaluate the expression `e` in the type `α`.</span>
<span class="sd">This is a variant of `eval_expr` in core. Due to unexplained behavior in the VM, in rare</span>
<span class="sd">situations the latter will fail but the former will succeed. -/</span>
</code></pre></div>
<p>which provides some form of answer to my question!</p>



<a name="290047936"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming%20/%20tactics/topic/%E2%9C%94%20unexpected%20%28by%20me%29%20%60eval_expr%60%20behaviour/near/290047936" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Notification Bot <a href="https://leanprover-community.github.io/archive/stream/239415-metaprogramming-/-tactics/topic/.E2.9C.94.20unexpected.20(by.20me).20.60eval_expr.60.20behaviour.html#290047936">(Jul 19 2022 at 02:53)</a>:</h4>
<p><span class="user-mention silent" data-user-id="321459">Damiano Testa</span> has marked this topic as resolved.</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>