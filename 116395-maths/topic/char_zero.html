---
layout: archive
title: Zulip Chat Archive
permalink: /stream/116395-maths/topic/char_zero.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/116395-maths/index.html">maths</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/char_zero.html">char_zero</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="230905415"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/char_zero/near/230905415" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/char_zero.html#230905415">(Mar 18 2021 at 17:26)</a>:</h4>
<p>I have just noticed that some definitions around <code>char_zero</code> and <code>char_p</code> seem to assume that the base type is an appropriately decorated <code>ring</code>, while the definitions make sense for <code>[add_monoid R]</code> <code>[has_one R]</code>. </p>
<p>Is there a reason for assuming multiplication?  I imagine that this might be some "historical artifact", arising from the fact that there was no action of the natural numbers on an <code>add_monoid_with 1</code>.</p>
<p>If this is the case, then it might make sense to refactor and weaken the hypotheses.</p>
<p>If there is a deeper reason for assuming more than strictly needed, then I would be curious to know!</p>
<p>Thanks!</p>



<a name="230906193"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/char_zero/near/230906193" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/char_zero.html#230906193">(Mar 18 2021 at 17:31)</a>:</h4>
<p>First monoids with zero and now this! I don't see any reason why it shouldn't be generalised to add_monoids with 1, I'm pretty sure there's a map from the naturals to such a thing. However I am not so convinced that there is a mathematically sensible notion of "characteristic", e.g. we have these monoids like Z/nZ where everything bigger than n-1 stays at n-1, and just knowing the kernel of the map from nat into this ring doesn't really tell you the whole truth. On the other hand all the basic stuff will go through for add_groups with 1 where...wait...this is just the theory of the order of an element, right? We have this already. Maybe the correct thing to do is to refactor characteristic to just be the order of 1 in the add_comm_group?</p>



<a name="230906698"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/char_zero/near/230906698" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/char_zero.html#230906698">(Mar 18 2021 at 17:33)</a>:</h4>
<p>Yes, this is what I would have thought as well...  For me, the characteristic of a add_monoid with 1 is the order of 1...</p>



<a name="230908854"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/char_zero/near/230908854" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Julian Külshammer <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/char_zero.html#230908854">(Mar 18 2021 at 17:47)</a>:</h4>
<p>I agree. One problem is that there is currently no add_order_of although this is on my list of possible future PRs since by now I'm reasonably familiar with the order_of API. If I understand correctly, though, many proofs will have to be ported manually as [to_additive] doesn't translate nicely between g^n and n*g.  Is that understanding correct?</p>



<a name="230908925"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/char_zero/near/230908925" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/char_zero.html#230908925">(Mar 18 2021 at 17:47)</a>:</h4>
<p>Aargh! Yes that's right, and it's simply because of the order of the inputs.</p>



<a name="230911040"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/char_zero/near/230911040" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/char_zero.html#230911040">(Mar 18 2021 at 18:00)</a>:</h4>
<p>Maybe the order of inputs issue can be overcome by using that they are both modules for nat?  I am talking without having experience, so I may be saying something very silly!</p>



<a name="230911184"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/char_zero/near/230911184" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/char_zero.html#230911184">(Mar 18 2021 at 18:00)</a>:</h4>
<p>I don't think a non-commutative group is a nat-module because it doesn't satisffy <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>g</mi><mi>n</mi></msup><msup><mi>h</mi><mi>n</mi></msup><mo>=</mo><mo stretchy="false">(</mo><mi>g</mi><mi>h</mi><msup><mo stretchy="false">)</mo><mi>n</mi></msup></mrow><annotation encoding="application/x-tex">g^nh^n=(gh)^n</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.664392em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.664392em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord mathnormal">h</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.664392em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span></span></span></span></span></span></span>.</p>



<a name="230911833"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/char_zero/near/230911833" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/char_zero.html#230911833">(Mar 18 2021 at 18:04)</a>:</h4>
<p>Indeed, the nat-module structure is called <a href="https://leanprover-community.github.io/mathlib_docs/find/add_comm_monoid.nat_module">docs#add_comm_monoid.nat_module</a></p>



<a name="230911877"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/char_zero/near/230911877" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/char_zero.html#230911877">(Mar 18 2021 at 18:04)</a>:</h4>
<p><span class="user-mention silent" data-user-id="317890">Julian Külshammer</span> <a href="#narrow/stream/116395-maths/topic/char_zero/near/230908854">said</a>:</p>
<blockquote>
<p>I agree. One problem is that there is currently no add_order_of although this is on my list of possible future PRs since by now I'm reasonably familiar with the order_of API. If I understand correctly, though, many proofs will have to be ported manually as [to_additive] doesn't translate nicely between g^n and n*g.  Is that understanding correct?</p>
</blockquote>
<p>Maybe a meta programmer can comment on how hard it would be to hardcode special support into <code>to_additive</code> for this specific situation (i.e. <code>pow</code> vs <code>nsmul</code>).</p>



<a name="230911944"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/char_zero/near/230911944" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/char_zero.html#230911944">(Mar 18 2021 at 18:05)</a>:</h4>
<p>I was wondering if we can get by by introducing an auxiliary <code>nsmul'</code> abbreviation with its arguments swapped</p>



<a name="230920864"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/char_zero/near/230920864" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/char_zero.html#230920864">(Mar 18 2021 at 19:04)</a>:</h4>
<p>Ah, as usual, I was thinking of commutative additive/multiplicative groups, I did not think about the fact that this would have to be defined across all groups, commutative or not.   Too bad!</p>



<a name="231026865"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/char_zero/near/231026865" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Julian Külshammer <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/char_zero.html#231026865">(Mar 19 2021 at 14:01)</a>:</h4>
<p>I started <code>add_order_of</code> manually in <a href="https://github.com/leanprover-community/mathlib/issues/6770">#6770</a>. If someone wants to stop me because it can be done via automation, let me know. It feels close to automatic, but occasionally tricky because you have to switch from right to left and leave the 1s in nat  untouched.</p>



<a name="231027439"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/char_zero/near/231027439" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/char_zero.html#231027439">(Mar 19 2021 at 14:05)</a>:</h4>
<p>The automation suggestion was to beef up <code>to_additive</code> so it relates <code>monoid.pow</code> to some new function <code>add_monoid.nat_action_on_the-right</code> where the variables are in the right order (note : I wouldn't have a clue how to do this but others here will) and then define order using this right action.</p>



<a name="231444165"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/char_zero/near/231444165" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/char_zero.html#231444165">(Mar 23 2021 at 09:49)</a>:</h4>
<p>I am trying to get the definition of characteristic to assume less than it currently does in <a href="https://github.com/leanprover-community/mathlib/issues/6765">#6765</a>.  After fixing a few easy timeouts, I am now stuck.</p>
<p>The problem file is</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">ring_theory</span><span class="bp">/</span><span class="n">perfection.lean</span>
</code></pre></div>
<p>and specifically line 287, that no longer compiles. <br>
<a href="https://github.com/leanprover-community/mathlib/blob/09dbf4321bd3792bd0676c91ac81706b45d7b192/src/ring_theory/perfection.lean#L287">https://github.com/leanprover-community/mathlib/blob/09dbf4321bd3792bd0676c91ac81706b45d7b192/src/ring_theory/perfection.lean#L287</a></p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="c1">-- Why is this slow?</span>
<span class="kd">lemma</span> <span class="n">map_eq_map</span> <span class="o">(</span><span class="n">φ</span> <span class="o">:</span> <span class="n">R</span> <span class="bp">→+*</span> <span class="n">S</span><span class="o">)</span> <span class="o">:</span> <span class="n">map</span> <span class="n">p</span> <span class="o">(</span><span class="n">of</span> <span class="n">p</span> <span class="n">R</span><span class="o">)</span> <span class="o">(</span><span class="n">of</span> <span class="n">p</span> <span class="n">S</span><span class="o">)</span> <span class="n">φ</span> <span class="bp">=</span> <span class="n">perfection.map</span> <span class="n">p</span> <span class="n">φ</span> <span class="o">:=</span>
<span class="n">hom_ext</span> <span class="n">_</span> <span class="o">(</span><span class="n">of</span> <span class="n">p</span> <span class="n">S</span><span class="o">)</span> <span class="bp">$</span> <span class="bp">λ</span> <span class="n">f</span><span class="o">,</span> <span class="kd">by</span> <span class="n">rw</span> <span class="o">[</span><span class="n">map_map</span><span class="o">,</span> <span class="n">perfection.coeff_map</span><span class="o">]</span>
</code></pre></div>
<p>The "-- Why is this slow?" comment was already there.</p>
<p>Git thinks that this was added by <span class="user-mention" data-user-id="110064">@Kenny Lau</span> .  If anyone could give a suggestion of how to speed this up, I would be very happy!</p>
<p>Thanks!</p>



<a name="231444288"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/char_zero/near/231444288" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/char_zero.html#231444288">(Mar 23 2021 at 09:50)</a>:</h4>
<p><a href="https://github.com/leanprover-community/mathlib/issues/6800">#6800</a> might be related</p>



<a name="231444395"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/char_zero/near/231444395" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/char_zero.html#231444395">(Mar 23 2021 at 09:52)</a>:</h4>
<p>So, the suggestion is simply that if I wait enough time, then the timeout disappears?</p>



<a name="231444471"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/char_zero/near/231444471" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/char_zero.html#231444471">(Mar 23 2021 at 09:52)</a>:</h4>
<p>the suggestion is that after <a href="https://github.com/leanprover-community/mathlib/issues/6800">#6800</a> gets merged the timeout should disappear</p>



<a name="231444498"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/char_zero/near/231444498" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/char_zero.html#231444498">(Mar 23 2021 at 09:52)</a>:</h4>
<p>You could just merge <a href="https://github.com/leanprover-community/mathlib/issues/6800">#6800</a> to your branch to find out!</p>



<a name="231444572"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/char_zero/near/231444572" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/char_zero.html#231444572">(Mar 23 2021 at 09:53)</a>:</h4>
<p>Typing </p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">git</span> <span class="n">merge</span> <span class="n">eric</span><span class="bp">-</span><span class="n">wieser</span><span class="bp">/</span><span class="n">subalgebra</span><span class="bp">-</span><span class="n">coe</span>
</code></pre></div>
<p>is what you are suggesting?  I am not so good with git, so this is really a silly question that is not leading anywhere else!</p>



<a name="231444806"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/char_zero/near/231444806" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/char_zero.html#231444806">(Mar 23 2021 at 09:56)</a>:</h4>
<p>Literally that does not work:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code> <span class="o">(</span><span class="n">adomani_weaken_chap_p</span><span class="o">)</span><span class="bp">$</span> <span class="n">git</span> <span class="n">merge</span> <span class="n">eric</span><span class="bp">-</span><span class="n">wieser</span><span class="bp">/</span><span class="n">subalgebra</span><span class="bp">-</span><span class="n">coe</span>
<span class="n">merge</span><span class="o">:</span> <span class="n">eric</span><span class="bp">-</span><span class="n">wieser</span><span class="bp">/</span><span class="n">subalgebra</span><span class="bp">-</span><span class="n">coe</span> <span class="bp">-</span> <span class="n">not</span> <span class="n">something</span> <span class="n">we</span> <span class="n">can</span> <span class="n">merge</span>
</code></pre></div>



<a name="231444934"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/char_zero/near/231444934" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/char_zero.html#231444934">(Mar 23 2021 at 09:57)</a>:</h4>
<p>try <code>git fetch origin</code> first</p>



<a name="231445014"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/char_zero/near/231445014" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/char_zero.html#231445014">(Mar 23 2021 at 09:58)</a>:</h4>
<p>and then <code>git merge origin/eric-wieser/subalgebra-coe</code></p>



<a name="231445082"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/char_zero/near/231445082" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/char_zero.html#231445082">(Mar 23 2021 at 09:59)</a>:</h4>
<p>Kenny, thanks: The merging worked!</p>
<p>Now to see if it fixes the timeout!</p>



<a name="231445291"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/char_zero/near/231445291" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/char_zero.html#231445291">(Mar 23 2021 at 10:00)</a>:</h4>
<p><code>fetch</code> made my copy of <code>master</code> aware of another branch?  is this why this worked?</p>



<a name="231445748"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/char_zero/near/231445748" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ruben Van de Velde <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/char_zero.html#231445748">(Mar 23 2021 at 10:04)</a>:</h4>
<p>It made your local clone of the repository aware of the new branches. (I guess this is what you meant)</p>



<a name="231445994"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/char_zero/near/231445994" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/char_zero.html#231445994">(Mar 23 2021 at 10:06)</a>:</h4>
<p>Ruben, thanks!  you said more correctly what I had in a confused state in my mind!</p>



<a name="231450478"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/char_zero/near/231450478" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/char_zero.html#231450478">(Mar 23 2021 at 10:47)</a>:</h4>
<p>Note that you might be able to speed up the rebuild on your local machine by running <code>leanproject get-cache --rev origin/eric-wieser/subalgebra-coe</code></p>



<a name="231467436"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/char_zero/near/231467436" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/char_zero.html#231467436">(Mar 23 2021 at 13:14)</a>:</h4>
<p><code>leanproject</code> seems to not like <code>--rev</code>:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code> <span class="o">(</span><span class="n">adomani_weaken_chap_p</span><span class="o">)</span><span class="bp">$</span> <span class="n">leanproject</span> <span class="n">get</span><span class="bp">-</span><span class="n">cache</span> <span class="c1">--rev origin/eric-wieser/subalgebra-coe</span>
<span class="n">Usage</span><span class="o">:</span> <span class="n">leanproject</span> <span class="n">get</span><span class="bp">-</span><span class="n">cache</span> <span class="o">[</span><span class="n">OPTIONS</span><span class="o">]</span>
<span class="n">Try</span> <span class="bp">'</span><span class="n">leanproject</span> <span class="n">get</span><span class="bp">-</span><span class="n">cache</span> <span class="bp">-</span><span class="n">h'</span> <span class="n">for</span> <span class="n">help.</span>

<span class="n">Error</span><span class="o">:</span> <span class="n">no</span> <span class="n">such</span> <span class="n">option</span><span class="o">:</span> <span class="c1">--rev</span>
</code></pre></div>



<a name="231467558"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/char_zero/near/231467558" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/char_zero.html#231467558">(Mar 23 2021 at 13:14)</a>:</h4>
<p>Do you have the latest version?</p>



<a name="231467584"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/char_zero/near/231467584" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/char_zero.html#231467584">(Mar 23 2021 at 13:15)</a>:</h4>
<p>However, when I ask Lean to make the single file <code>ring_theory/perfection.lean</code>, it does it without problems.  However, when I open it with VSCode, it gives the timeout.</p>
<p>I will wait to see what happens with CI...</p>



<a name="231467591"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/char_zero/near/231467591" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/char_zero.html#231467591">(Mar 23 2021 at 13:15)</a>:</h4>
<p>which version of leanproject are you on? I've had no problems with --rev, I usually put <code>--rev HEAD~1</code> or something.</p>



<a name="231467652"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/char_zero/near/231467652" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/char_zero.html#231467652">(Mar 23 2021 at 13:15)</a>:</h4>
<p>Johan, how do I find out which version of <code>leanproject</code> do I have?</p>



<a name="231467685"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/char_zero/near/231467685" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/char_zero.html#231467685">(Mar 23 2021 at 13:15)</a>:</h4>
<p><code>leanproject --version</code></p>



<a name="231467744"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/char_zero/near/231467744" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/char_zero.html#231467744">(Mar 23 2021 at 13:16)</a>:</h4>
<p><code>leanproject --help</code> tells you all the options</p>



<a name="231467817"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/char_zero/near/231467817" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/char_zero.html#231467817">(Mar 23 2021 at 13:16)</a>:</h4>
<p>(adomani_weaken_chap_p)$ leanproject --version<br>
leanproject, version 0.0.9</p>



<a name="231467892"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/char_zero/near/231467892" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/char_zero.html#231467892">(Mar 23 2021 at 13:16)</a>:</h4>
<p>you need to get the latest version. We're on 1.0.0 now and it works great.</p>
<div class="codehilite" data-code-language="Text only"><pre><span></span><code>$ leanproject get-cache --help
Usage: leanproject get-cache [OPTIONS]

  Restore cached olean files.

Options:
  --force     Get cache even if the repository is dirty.
  --rev TEXT  A git sha.
  -h, --help  Show this message and exit.
buzzard@bob:~$
</code></pre></div>



<a name="231468000"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/char_zero/near/231468000" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/char_zero.html#231468000">(Mar 23 2021 at 13:17)</a>:</h4>
<p>ok, I will try to upgrade, then</p>



<a name="231468093"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/char_zero/near/231468093" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/char_zero.html#231468093">(Mar 23 2021 at 13:18)</a>:</h4>
<p>1.0.0 has been stable for a long time and has I think dealt with every issue which people threw at Patrick.</p>



<a name="231469034"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/char_zero/near/231469034" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/char_zero.html#231469034">(Mar 23 2021 at 13:24)</a>:</h4>
<p>Is this what I should do?</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">python3</span> <span class="bp">-</span><span class="n">m</span> <span class="n">pip</span> <span class="n">install</span> <span class="c1">--user pipx</span>
<span class="n">python3</span> <span class="bp">-</span><span class="n">m</span> <span class="n">pipx</span> <span class="n">ensurepath</span>
<span class="n">source</span> <span class="bp">~/.</span><span class="n">profile</span>
<span class="n">pipx</span> <span class="n">install</span> <span class="n">mathlibtools</span>
</code></pre></div>



<a name="231469055"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/char_zero/near/231469055" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/char_zero.html#231469055">(Mar 23 2021 at 13:24)</a>:</h4>
<p>(found here:<br>
<a href="https://leanprover-community.github.io/install/linux.html">https://leanprover-community.github.io/install/linux.html</a><br>
)</p>



<a name="231469627"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/char_zero/near/231469627" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Julian Berman <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/char_zero.html#231469627">(Mar 23 2021 at 13:28)</a>:</h4>
<p>You shouldn't need all of that. Probably <code>pipx upgrade mathlibtools</code> is all you need.</p>



<a name="231469638"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/char_zero/near/231469638" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/char_zero.html#231469638">(Mar 23 2021 at 13:28)</a>:</h4>
<p><code>pipx upgrade mathlibtools</code> works for me</p>



<a name="231469786"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/char_zero/near/231469786" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/char_zero.html#231469786">(Mar 23 2021 at 13:29)</a>:</h4>
<p>Julian and Riccardo: thank you both very much!</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code> <span class="o">(</span><span class="n">adomani_weaken_chap_p</span><span class="o">)</span><span class="bp">$</span> <span class="n">pipx</span> <span class="n">upgrade</span> <span class="n">mathlibtools</span>
<span class="n">upgraded</span> <span class="n">package</span> <span class="n">mathlibtools</span> <span class="k">from</span> <span class="mi">0</span><span class="bp">.</span><span class="mi">0</span><span class="bp">.</span><span class="mi">9</span> <span class="n">to</span> <span class="mi">1</span><span class="bp">.</span><span class="mi">0</span><span class="bp">.</span><span class="mi">0</span> <span class="o">(</span><span class="n">location</span><span class="o">:</span> <span class="bp">/</span><span class="n">home</span><span class="bp">/</span><span class="n">damiano</span><span class="bp">/.</span><span class="kn">local</span><span class="bp">/</span><span class="n">pipx</span><span class="bp">/</span><span class="n">venvs</span><span class="bp">/</span><span class="n">mathlibtools</span><span class="o">)</span>
 <span class="o">(</span><span class="n">adomani_weaken_chap_p</span><span class="o">)</span><span class="bp">$</span> <span class="n">leanproject</span> <span class="c1">--version</span>
<span class="n">leanproject</span><span class="o">,</span> <span class="n">version</span> <span class="mi">1</span><span class="bp">.</span><span class="mi">0</span><span class="bp">.</span><span class="mi">0</span>
</code></pre></div>



<a name="231469907"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/char_zero/near/231469907" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/char_zero.html#231469907">(Mar 23 2021 at 13:30)</a>:</h4>
<p>and now it learned <code>rev</code>!</p>



<a name="231473532"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/char_zero/near/231473532" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/char_zero.html#231473532">(Mar 23 2021 at 13:53)</a>:</h4>
<p>Eric's PR is getting merged, but it looks like this may not speed up the processing of the lemma in <code>ring_theory/perfection</code> enough to prevent the timeout, unfortunately.</p>
<p>I will wait until it is actually merged, but on my machine it still times out.</p>



<a name="231480288"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/char_zero/near/231480288" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/char_zero.html#231480288">(Mar 23 2021 at 14:35)</a>:</h4>
<p>Adding <code>@</code> and filling in a few underscores speeds up the processing to a place where, on my machine, it no longer times out on this lemma!</p>
<p>The result is not really pretty, especially since this happens on the <em>statement</em> of the lemma: if anyone has any alternative, I would be happy to hear about it!</p>
<p>This now elaborates in 2.33s, instead of timing out (on my machine):</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="c1">-- Why is this slow?</span>
<span class="kd">lemma</span> <span class="n">map_eq_map</span> <span class="o">(</span><span class="n">φ</span> <span class="o">:</span> <span class="n">R</span> <span class="bp">→+*</span> <span class="n">S</span><span class="o">)</span> <span class="o">:</span> <span class="bp">@</span><span class="n">map</span> <span class="n">p</span> <span class="n">_inst_1</span> <span class="n">R</span> <span class="n">_inst_2</span> <span class="n">_inst_3</span> <span class="o">(</span><span class="n">ring.perfection</span> <span class="n">R</span> <span class="n">p</span><span class="o">)</span>
    <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="n">S</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="o">(</span><span class="n">of</span> <span class="n">p</span> <span class="n">R</span><span class="o">)</span> <span class="n">_</span> <span class="o">(</span><span class="n">of</span> <span class="n">p</span> <span class="n">S</span><span class="o">)</span> <span class="n">φ</span> <span class="bp">=</span>
  <span class="bp">@</span><span class="n">perfection.map</span> <span class="n">R</span> <span class="n">_inst_2</span> <span class="n">p</span> <span class="n">_inst_1</span> <span class="n">_inst_3</span> <span class="n">S</span> <span class="n">_inst_7</span> <span class="n">_inst_8</span> <span class="n">φ</span> <span class="o">:=</span>
<span class="n">hom_ext</span> <span class="n">_</span> <span class="o">(</span><span class="n">of</span> <span class="n">p</span> <span class="n">S</span><span class="o">)</span> <span class="bp">$</span> <span class="bp">λ</span> <span class="n">f</span><span class="o">,</span> <span class="kd">by</span> <span class="n">rw</span> <span class="o">[</span><span class="n">map_map</span><span class="o">,</span> <span class="n">perfection.coeff_map</span><span class="o">]</span>
</code></pre></div>
<p>(for those who may take a look at this, the <code>S</code> lost in the sea of underscores in the lhs is what gave me the impression of the largest relative speedup.  This might have been an artifact of how I was filling in the underscores, though, not of anything actually having to do with the processing.)</p>



<a name="231480450"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/char_zero/near/231480450" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/char_zero.html#231480450">(Mar 23 2021 at 14:36)</a>:</h4>
<p>Do you need to fill in the <code>_inst_n</code>s?</p>



<a name="231480519"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/char_zero/near/231480519" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/char_zero.html#231480519">(Mar 23 2021 at 14:37)</a>:</h4>
<p>Because those are extremely brittle from a maintenance point of view. (Should we lint against them?)</p>



<a name="231480591"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/char_zero/near/231480591" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/char_zero.html#231480591">(Mar 23 2021 at 14:37)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">rg</span> <span class="s2">"_inst_"</span> <span class="bp">|</span> <span class="n">wc</span> <span class="bp">-</span><span class="n">l</span>
<span class="mi">37</span>
</code></pre></div>



<a name="231480722"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/char_zero/near/231480722" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/char_zero.html#231480722">(Mar 23 2021 at 14:38)</a>:</h4>
<p>I think that we should try to keep the number there</p>



<a name="231480731"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/char_zero/near/231480731" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/char_zero.html#231480731">(Mar 23 2021 at 14:38)</a>:</h4>
<p>I probably do not, in fact, I got it to avoid the time out without the <code>@</code> on the rhs, but it made it faster to add it there.</p>



<a name="231480789"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/char_zero/near/231480789" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/char_zero.html#231480789">(Mar 23 2021 at 14:39)</a>:</h4>
<p>I will profile it with and without the <code>inst</code> and report!</p>



<a name="231480887"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/char_zero/near/231480887" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/char_zero.html#231480887">(Mar 23 2021 at 14:39)</a>:</h4>
<p><span class="user-mention silent" data-user-id="112680">Johan Commelin</span> <a href="#narrow/stream/116395-maths/topic/char_zero/near/231480591">said</a>:</p>
<blockquote>
<p><div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">rg</span> <span class="s2">"_inst_"</span> <span class="bp">|</span> <span class="n">wc</span> <span class="bp">-</span><span class="n">l</span>
<span class="mi">37</span>
</code></pre></div><br>
</p>
</blockquote>
<p>Many of them are in meta code:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="k">let</span> <span class="n">e_inst_type</span> <span class="o">:=</span> <span class="o">(</span><span class="n">expr.const</span> <span class="n">class_nm</span> <span class="n">raw_levels</span><span class="o">)</span><span class="bp">.</span><span class="n">mk_app</span> <span class="n">args</span>
</code></pre></div>



<a name="231481025"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/char_zero/near/231481025" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/char_zero.html#231481025">(Mar 23 2021 at 14:40)</a>:</h4>
<p>I count 14 explicit references.</p>



<a name="231481146"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/char_zero/near/231481146" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/char_zero.html#231481146">(Mar 23 2021 at 14:40)</a>:</h4>
<p>without the <code>_inst_</code> it elaborates in 2.54s and, to be honest, this variation may not have anything to do with the search for instances: the profiler gives different results in different runs anyway.</p>
<p>so, I should remove the <code>inst</code>s, right?</p>



<a name="231481294"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/char_zero/near/231481294" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/char_zero.html#231481294">(Mar 23 2021 at 14:42)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">rg</span> <span class="s2">"</span><span class="err">\</span><span class="s2">b_inst_"</span> <span class="bp">|</span> <span class="n">wc</span> <span class="bp">-</span><span class="n">l</span>
<span class="mi">19</span>
</code></pre></div>
<p>is maybe a more honest count</p>



<a name="231481337"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/char_zero/near/231481337" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/char_zero.html#231481337">(Mar 23 2021 at 14:42)</a>:</h4>
<p>This is what the lemma looks like now:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="c1">-- Why is this slow?</span>
<span class="kd">lemma</span> <span class="n">map_eq_map</span> <span class="o">(</span><span class="n">φ</span> <span class="o">:</span> <span class="n">R</span> <span class="bp">→+*</span> <span class="n">S</span><span class="o">)</span> <span class="o">:</span>
  <span class="bp">@</span><span class="n">map</span> <span class="n">p</span> <span class="n">_</span> <span class="n">R</span> <span class="n">_</span> <span class="n">_</span> <span class="o">(</span><span class="n">ring.perfection</span> <span class="n">R</span> <span class="n">p</span><span class="o">)</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="n">S</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="o">(</span><span class="n">of</span> <span class="n">p</span> <span class="n">R</span><span class="o">)</span> <span class="n">_</span> <span class="o">(</span><span class="n">of</span> <span class="n">p</span> <span class="n">S</span><span class="o">)</span> <span class="n">φ</span> <span class="bp">=</span>
  <span class="bp">@</span><span class="n">perfection.map</span> <span class="n">R</span> <span class="n">_</span> <span class="n">p</span> <span class="n">_</span> <span class="n">_</span> <span class="n">S</span> <span class="n">_</span> <span class="n">_</span> <span class="n">φ</span> <span class="o">:=</span>
<span class="n">hom_ext</span> <span class="n">_</span> <span class="o">(</span><span class="n">of</span> <span class="n">p</span> <span class="n">S</span><span class="o">)</span> <span class="bp">$</span> <span class="bp">λ</span> <span class="n">f</span><span class="o">,</span> <span class="kd">by</span> <span class="n">rw</span> <span class="o">[</span><span class="n">map_map</span><span class="o">,</span> <span class="n">perfection.coeff_map</span><span class="o">]</span>
</code></pre></div>



<a name="231481429"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/char_zero/near/231481429" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/char_zero.html#231481429">(Mar 23 2021 at 14:42)</a>:</h4>
<p>yeah, if that doesn't time out, I would leave it like that</p>



<a name="231481549"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/char_zero/near/231481549" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/char_zero.html#231481549">(Mar 23 2021 at 14:43)</a>:</h4>
<p>ok, in any case, so far, timing out has been on my machine alone, but a lemma that processes in under 3s should not give CI problems... right?  <span aria-label="wink" class="emoji emoji-1f609" role="img" title="wink">:wink:</span></p>



<a name="231481618"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/char_zero/near/231481618" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/char_zero.html#231481618">(Mar 23 2021 at 14:43)</a>:</h4>
<p>and hopefully <span class="user-mention" data-user-id="110064">@Kenny Lau</span> will have another "speed up mathlib" marathon in the future, and figure out the real cause of why this is slow</p>



<a name="231482021"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/char_zero/near/231482021" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/char_zero.html#231482021">(Mar 23 2021 at 14:46)</a>:</h4>
<p>my, very limited, experience is that Lean takes a lot of time to figure out implicit domains/codomains of implicit maps.  this was at least my rationale for getting the <code>S</code> in the right place in the code above.  for some mysterious reason, this actually worked...</p>



<a name="231482255"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/char_zero/near/231482255" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/char_zero.html#231482255">(Mar 23 2021 at 14:47)</a>:</h4>
<p>and it seems that the statement that Kevin made chronologically just before mine on a different topic supports this!</p>



<a name="231486171"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/char_zero/near/231486171" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/char_zero.html#231486171">(Mar 23 2021 at 15:09)</a>:</h4>
<p>Are there any underscores you can replace with type annotations?</p>



<a name="231486803"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/char_zero/near/231486803" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/char_zero.html#231486803">(Mar 23 2021 at 15:13)</a>:</h4>
<p>I can try: is that preferred to having a simple underscore?</p>



<a name="231486874"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/char_zero/near/231486874" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/char_zero.html#231486874">(Mar 23 2021 at 15:13)</a>:</h4>
<p>I'd say it's preferred to using <code>@</code></p>



<a name="231487306"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/char_zero/near/231487306" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/char_zero.html#231487306">(Mar 23 2021 at 15:14)</a>:</h4>
<p>Ah, I think that the initial formulation had no underscores and filled in all the needed underscores.  I introduced the <code>@</code> and the underscores to be able to fill in arguments that were implicit before.</p>



<a name="231487510"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/char_zero/near/231487510" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/char_zero.html#231487510">(Mar 23 2021 at 15:15)</a>:</h4>
<p>This was the statement of the lemma before it started timing out:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">lemma</span> <span class="n">map_eq_map</span> <span class="o">(</span><span class="n">φ</span> <span class="o">:</span> <span class="n">R</span> <span class="bp">→+*</span> <span class="n">S</span><span class="o">)</span> <span class="o">:</span> <span class="n">map</span> <span class="n">p</span> <span class="o">(</span><span class="n">of</span> <span class="n">p</span> <span class="n">R</span><span class="o">)</span> <span class="o">(</span><span class="n">of</span> <span class="n">p</span> <span class="n">S</span><span class="o">)</span> <span class="n">φ</span> <span class="bp">=</span> <span class="n">perfection.map</span> <span class="n">p</span> <span class="n">φ</span> <span class="o">:=</span>
</code></pre></div>



<a name="231487674"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/char_zero/near/231487674" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/char_zero.html#231487674">(Mar 23 2021 at 15:16)</a>:</h4>
<p>Wait, so that version doesn't time out?</p>



<a name="231487803"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/char_zero/near/231487803" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/char_zero.html#231487803">(Mar 23 2021 at 15:17)</a>:</h4>
<p>Or do you mean, "which started timing out"</p>



<a name="231487810"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/char_zero/near/231487810" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/char_zero.html#231487810">(Mar 23 2021 at 15:17)</a>:</h4>
<p>The last one used to be slow, but not timing out, before I introduced the changes in a different file.  Now, to get mathlib to build, this one times out and hence I introduced the <code>@</code> and the partially filled in underscores.</p>



<a name="231487870"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/char_zero/near/231487870" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/char_zero.html#231487870">(Mar 23 2021 at 15:17)</a>:</h4>
<p>I wonder if for instance you can get away with just putting a <code>@</code> on the LHS or RHS but not both</p>



<a name="231487963"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/char_zero/near/231487963" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/char_zero.html#231487963">(Mar 23 2021 at 15:18)</a>:</h4>
<p>Yes, just one side should be possible, but it gets progressively faster if I do it on both sides.</p>



<a name="231488048"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/char_zero/near/231488048" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/char_zero.html#231488048">(Mar 23 2021 at 15:18)</a>:</h4>
<p>since I wanted to make sure that it would not time out, I went for the fastest!  an intermediate stage might also work, but right now I am trying to get CI to work at least once.</p>



<a name="231488281"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/char_zero/near/231488281" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/char_zero.html#231488281">(Mar 23 2021 at 15:20)</a>:</h4>
<p>CI seems to be making progress: it went past the stage of building mathlib and is now linting/testing!</p>



<a name="231490516"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/char_zero/near/231490516" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/char_zero.html#231490516">(Mar 23 2021 at 15:32)</a>:</h4>
<p>profiling on my machine, suggests a similar processing time for the lemma below as for the more expanded one above:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">lemma</span> <span class="n">map_eq_map</span> <span class="o">(</span><span class="n">φ</span> <span class="o">:</span> <span class="n">R</span> <span class="bp">→+*</span> <span class="n">S</span><span class="o">)</span> <span class="o">:</span>
  <span class="bp">@</span><span class="n">map</span> <span class="n">p</span> <span class="n">_</span> <span class="n">R</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="n">S</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="o">(</span><span class="n">of</span> <span class="n">p</span> <span class="n">R</span><span class="o">)</span> <span class="n">_</span> <span class="o">(</span><span class="n">of</span> <span class="n">p</span> <span class="n">S</span><span class="o">)</span> <span class="n">φ</span> <span class="bp">=</span>
  <span class="n">perfection.map</span> <span class="n">p</span> <span class="n">φ</span> <span class="o">:=</span>
<span class="n">hom_ext</span> <span class="n">_</span> <span class="o">(</span><span class="n">of</span> <span class="n">p</span> <span class="n">S</span><span class="o">)</span> <span class="bp">$</span> <span class="bp">λ</span> <span class="n">f</span><span class="o">,</span> <span class="kd">by</span> <span class="n">rw</span> <span class="o">[</span><span class="n">map_map</span><span class="o">,</span> <span class="n">perfection.coeff_map</span><span class="o">]</span>
</code></pre></div>
<p>(no <code>@</code> in the RHS, only <code>S</code> as previously implicit argument, now explicitly given.  If I replace <code>S</code> by an underscore, leaving the <code>@</code> and the other underscores, Lean still seems to make the processing work, but barely.)</p>
<p>Removing the <code>@</code> in the LHS and keeping the one on the RHS times out.  Thus, the explicit <code>S</code> seems to be helpful, but simply putting an <code>@</code> seems to be already giving a good amount of hints to Lean.</p>



<a name="231494494"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/char_zero/near/231494494" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/char_zero.html#231494494">(Mar 23 2021 at 15:55)</a>:</h4>
<p>The fully <code>@</code>-expanded version was accepted by CI, modulo the dependent <a href="https://github.com/leanprover-community/mathlib/issues/6800">#6800</a>!  I am not sure whether <a href="https://github.com/leanprover-community/mathlib/issues/6800">#6800</a> is actually needed for the speed up, but it is not so important.</p>
<p>I will now try to push the "minimally" <code>@</code>-expanded version and see if CI still manages to work with it.</p>



<a name="231505667"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/char_zero/near/231505667" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/char_zero.html#231505667">(Mar 23 2021 at 17:00)</a>:</h4>
<p>The shorter version with a single <code>@</code> works!</p>
<p>I am also trying to remove the merged PR.</p>



<a name="231520724"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/char_zero/near/231520724" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/char_zero.html#231520724">(Mar 23 2021 at 18:35)</a>:</h4>
<p>The unentangled version also builds!  So, once <a href="https://github.com/leanprover-community/mathlib/issues/6800">#6800</a> merges, I might try to see if removing the <code>@</code> still gives a time out or not, but at the moment, PR <a href="https://github.com/leanprover-community/mathlib/issues/6765">#6765</a> builds independently!</p>



<a name="238099978"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/char_zero/near/238099978" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/char_zero.html#238099978">(May 10 2021 at 07:48)</a>:</h4>
<p>I'm getting a timeout in <a href="https://leanprover-community.github.io/mathlib_docs/find/perfection_map.map_eq_map">docs#perfection_map.map_eq_map</a>` again in <a href="https://github.com/leanprover-community/mathlib/issues/6786">#6786</a>.</p>



<a name="238100844"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/char_zero/near/238100844" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/char_zero.html#238100844">(May 10 2021 at 07:57)</a>:</h4>
<p>This is in <code>ring_theory.perfection</code>? I see timeouts earlier, e.g.</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">lemma</span> <span class="n">pth_root_frobenius</span> <span class="o">:</span> <span class="o">(</span><span class="n">pth_root</span> <span class="n">R</span> <span class="n">p</span><span class="o">)</span><span class="bp">.</span><span class="n">comp</span> <span class="o">(</span><span class="n">frobenius</span> <span class="n">_</span> <span class="n">p</span><span class="o">)</span> <span class="bp">=</span> <span class="n">ring_hom.id</span> <span class="n">_</span> <span class="o">:=</span>
<span class="n">ring_hom.ext</span> <span class="bp">$</span> <span class="bp">λ</span> <span class="n">x</span><span class="o">,</span> <span class="n">ext</span> <span class="bp">$</span> <span class="bp">λ</span> <span class="n">n</span><span class="o">,</span>
<span class="kd">begin</span>
  <span class="n">rw</span> <span class="n">ring_hom.comp_apply</span><span class="o">,</span>
  <span class="n">rw</span> <span class="n">ring_hom.id_apply</span><span class="o">,</span>
  <span class="n">rw</span> <span class="n">coeff_pth_root</span><span class="o">,</span> <span class="c1">-- all fast</span>
  <span class="n">convert</span> <span class="n">coeff_frobenius</span> <span class="n">_</span> <span class="n">_</span><span class="o">,</span> <span class="c1">-- slow (several seconds), as is `rw coeff_frobenius` and `apply coeff_frobenius`</span>
<span class="kd">end</span>
</code></pre></div>



<a name="238100973"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/char_zero/near/238100973" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/char_zero.html#238100973">(May 10 2021 at 07:58)</a>:</h4>
<p>Have you configured vs-code with a different timeout to CI?</p>



<a name="238100985"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/char_zero/near/238100985" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/char_zero.html#238100985">(May 10 2021 at 07:58)</a>:</h4>
<p>(or are you on a diffferent commit / cache?)</p>



<a name="238101018"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/char_zero/near/238101018" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/char_zero.html#238101018">(May 10 2021 at 07:59)</a>:</h4>
<p>almost certainly, because I don't normally think about this sort of thing</p>



<a name="238101061"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/char_zero/near/238101061" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/char_zero.html#238101061">(May 10 2021 at 07:59)</a>:</h4>
<p>I'm just saying "stuff in this file is surprisingly slow, here's another example"</p>



<a name="238101280"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/char_zero/near/238101280" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/char_zero.html#238101280">(May 10 2021 at 08:01)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">lemma</span> <span class="n">pth_root_frobenius</span> <span class="o">:</span> <span class="o">(</span><span class="n">pth_root</span> <span class="n">R</span> <span class="n">p</span><span class="o">)</span><span class="bp">.</span><span class="n">comp</span> <span class="o">(</span><span class="n">frobenius</span> <span class="n">_</span> <span class="n">p</span><span class="o">)</span> <span class="bp">=</span> <span class="n">ring_hom.id</span> <span class="n">_</span> <span class="o">:=</span>
<span class="n">ring_hom.ext</span> <span class="bp">$</span> <span class="bp">λ</span> <span class="n">x</span><span class="o">,</span> <span class="n">ext</span> <span class="bp">$</span> <span class="bp">λ</span> <span class="n">n</span><span class="o">,</span>
<span class="kd">begin</span>
  <span class="n">rw</span> <span class="n">ring_hom.comp_apply</span><span class="o">,</span>
  <span class="n">rw</span> <span class="n">ring_hom.id_apply</span><span class="o">,</span>
  <span class="n">rw</span> <span class="n">coeff_pth_root</span><span class="o">,</span>
  <span class="n">rw</span> <span class="n">coeff_frobenius</span> <span class="n">x</span><span class="o">,</span> <span class="c1">-- quick</span>
<span class="kd">end</span>
</code></pre></div>
<p>Unification is going down a rabbit-hole maybe. If you put pp.all on you can see the terms are huge. Removing the x takes elaboration up to 5.73 seconds from 273ms</p>



<a name="238101403"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/char_zero/near/238101403" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/char_zero.html#238101403">(May 10 2021 at 08:02)</a>:</h4>
<p><del>The fix there being that you told lean what <code>x</code> was I assume</del></p>



<a name="238101717"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/char_zero/near/238101717" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/char_zero.html#238101717">(May 10 2021 at 08:05)</a>:</h4>
<p>If you look at where the orange bars get stuck you can see the slow lemmas. The next one is <code>frobenius_pth_root</code>, and then <code>of</code> and then <code>map_eq_map</code></p>



<a name="238101772"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/char_zero/near/238101772" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/char_zero.html#238101772">(May 10 2021 at 08:05)</a>:</h4>
<p>Yeah, good find</p>



<a name="238101883"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/char_zero/near/238101883" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/char_zero.html#238101883">(May 10 2021 at 08:06)</a>:</h4>
<p>Relatedly, <code>map</code> is a weird definition because it takes a <code>perfection_map X Y</code> argument which it ignores and uses only to infer X and Y</p>



<a name="238102051"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/char_zero/near/238102051" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/char_zero.html#238102051">(May 10 2021 at 08:08)</a>:</h4>
<p>I'm afraid I have to clock off now -- marking :-/</p>



<a name="238102221"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/char_zero/near/238102221" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/char_zero.html#238102221">(May 10 2021 at 08:10)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">lemma</span> <span class="n">frobenius_pth_root</span> <span class="o">:</span> <span class="o">(</span><span class="n">frobenius</span> <span class="n">_</span> <span class="n">p</span><span class="o">)</span><span class="bp">.</span><span class="n">comp</span> <span class="o">(</span><span class="n">pth_root</span> <span class="n">R</span> <span class="n">p</span><span class="o">)</span> <span class="bp">=</span> <span class="n">ring_hom.id</span> <span class="n">_</span> <span class="o">:=</span> <span class="gr">sorry</span> <span class="c1">-- slow</span>
</code></pre></div>



<a name="238102341"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/char_zero/near/238102341" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/char_zero.html#238102341">(May 10 2021 at 08:11)</a>:</h4>
<p>Even this is slow. If even this is slow then you can see something's wrong.</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">lemma</span> <span class="n">frobenius_pth_root</span> <span class="o">:</span> <span class="o">(</span><span class="n">frobenius</span> <span class="o">(</span><span class="n">ring.perfection</span> <span class="n">R</span> <span class="n">p</span><span class="o">)</span> <span class="n">p</span><span class="o">)</span><span class="bp">.</span><span class="n">comp</span> <span class="o">(</span><span class="n">pth_root</span> <span class="n">R</span> <span class="n">p</span><span class="o">)</span> <span class="bp">=</span> <span class="n">ring_hom.id</span> <span class="o">(</span><span class="n">ring.perfection</span> <span class="n">R</span> <span class="n">p</span><span class="o">)</span> <span class="o">:=</span> <span class="gr">sorry</span>
</code></pre></div>



<a name="238102393"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/char_zero/near/238102393" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/char_zero.html#238102393">(May 10 2021 at 08:12)</a>:</h4>
<p>I guess you're marking Kenny's old code then since you're still here?</p>



<a name="238102523"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/char_zero/near/238102523" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/char_zero.html#238102523">(May 10 2021 at 08:13)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">set_option</span> <span class="n">trace.class_instances</span> <span class="n">true</span>
<span class="kd">lemma</span> <span class="n">frobenius_pth_root</span> <span class="o">:</span> <span class="o">(</span><span class="n">frobenius</span> <span class="o">(</span><span class="n">ring.perfection</span> <span class="n">R</span> <span class="n">p</span><span class="o">)</span> <span class="n">p</span><span class="o">)</span><span class="bp">.</span><span class="n">comp</span> <span class="o">(</span><span class="n">pth_root</span> <span class="n">R</span> <span class="n">p</span><span class="o">)</span> <span class="bp">=</span> <span class="n">ring_hom.id</span> <span class="o">(</span><span class="n">ring.perfection</span> <span class="n">R</span> <span class="n">p</span><span class="o">)</span> <span class="o">:=</span> <span class="gr">sorry</span>
</code></pre></div>
<p>generates 2749 lines of debugging output.</p>



<a name="238102540"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/char_zero/near/238102540" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/char_zero.html#238102540">(May 10 2021 at 08:13)</a>:</h4>
<p>Also, <code>set_option profiler true</code> doesn't seem to notice that its slow</p>



<a name="238102647"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/char_zero/near/238102647" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/char_zero.html#238102647">(May 10 2021 at 08:14)</a>:</h4>
<p>It concedes that the longest step took 51ms</p>



<a name="238102688"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/char_zero/near/238102688" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/char_zero.html#238102688">(May 10 2021 at 08:15)</a>:</h4>
<p><a href="https://gist.github.com/kbuzzard/226abffabe7ee22f464977128b9157ed">https://gist.github.com/kbuzzard/226abffabe7ee22f464977128b9157ed</a></p>



<a name="238102697"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/char_zero/near/238102697" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/char_zero.html#238102697">(May 10 2021 at 08:15)</a>:</h4>
<p>OK I really am going now.</p>



<a name="238103102"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/char_zero/near/238103102" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/char_zero.html#238103102">(May 10 2021 at 08:19)</a>:</h4>
<p>The story of <code>nonempty nat</code>:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">2</span><span class="o">)</span> <span class="bp">?</span><span class="n">x_58</span> <span class="o">:</span> <span class="n">nonempty</span> <span class="n">ℕ</span> <span class="o">:=</span> <span class="n">unit_interval.nonempty</span>
<span class="n">failed</span> <span class="n">is_def_eq</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">2</span><span class="o">)</span> <span class="bp">?</span><span class="n">x_58</span> <span class="o">:</span> <span class="n">nonempty</span> <span class="n">ℕ</span> <span class="o">:=</span> <span class="bp">@</span><span class="n">affine_map.nonempty</span> <span class="bp">?</span><span class="n">x_66</span> <span class="bp">?</span><span class="n">x_67</span> <span class="bp">?</span><span class="n">x_68</span> <span class="bp">?</span><span class="n">x_69</span> <span class="bp">?</span><span class="n">x_70</span> <span class="bp">?</span><span class="n">x_71</span> <span class="bp">?</span><span class="n">x_72</span> <span class="bp">?</span><span class="n">x_73</span> <span class="bp">?</span><span class="n">x_74</span> <span class="bp">?</span><span class="n">x_75</span> <span class="bp">?</span><span class="n">x_76</span> <span class="bp">?</span><span class="n">x_77</span>
<span class="n">failed</span> <span class="n">is_def_eq</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">2</span><span class="o">)</span> <span class="bp">?</span><span class="n">x_58</span> <span class="o">:</span> <span class="n">nonempty</span> <span class="n">ℕ</span> <span class="o">:=</span> <span class="bp">@</span><span class="n">quiver.rooted_connected.nonempty_path</span> <span class="bp">?</span><span class="n">x_78</span> <span class="bp">?</span><span class="n">x_79</span> <span class="bp">?</span><span class="n">x_80</span> <span class="bp">?</span><span class="n">x_81</span> <span class="bp">?</span><span class="n">x_82</span>
<span class="n">failed</span> <span class="n">is_def_eq</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">2</span><span class="o">)</span> <span class="bp">?</span><span class="n">x_58</span> <span class="o">:</span> <span class="n">nonempty</span> <span class="n">ℕ</span> <span class="o">:=</span> <span class="bp">?</span><span class="n">x_84.nonempty_sets</span>
<span class="n">failed</span> <span class="n">is_def_eq</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">2</span><span class="o">)</span> <span class="bp">?</span><span class="n">x_58</span> <span class="o">:</span> <span class="n">nonempty</span> <span class="n">ℕ</span> <span class="o">:=</span> <span class="bp">@</span><span class="n">finset.has_insert.insert.nonempty</span> <span class="bp">?</span><span class="n">x_85</span> <span class="bp">?</span><span class="n">x_86</span> <span class="bp">?</span><span class="n">x_87</span> <span class="bp">?</span><span class="n">x_88</span>
<span class="n">failed</span> <span class="n">is_def_eq</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">2</span><span class="o">)</span> <span class="bp">?</span><span class="n">x_58</span> <span class="o">:</span> <span class="n">nonempty</span> <span class="n">ℕ</span> <span class="o">:=</span> <span class="bp">@</span><span class="n">set.nonempty_Iio_subtype</span> <span class="bp">?</span><span class="n">x_89</span> <span class="bp">?</span><span class="n">x_90</span> <span class="bp">?</span><span class="n">x_91</span> <span class="bp">?</span><span class="n">x_92</span>
<span class="n">failed</span> <span class="n">is_def_eq</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">2</span><span class="o">)</span> <span class="bp">?</span><span class="n">x_58</span> <span class="o">:</span> <span class="n">nonempty</span> <span class="n">ℕ</span> <span class="o">:=</span> <span class="bp">@</span><span class="n">set.nonempty_Ioi_subtype</span> <span class="bp">?</span><span class="n">x_93</span> <span class="bp">?</span><span class="n">x_94</span> <span class="bp">?</span><span class="n">x_95</span> <span class="bp">?</span><span class="n">x_96</span>
<span class="n">failed</span> <span class="n">is_def_eq</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">2</span><span class="o">)</span> <span class="bp">?</span><span class="n">x_58</span> <span class="o">:</span> <span class="n">nonempty</span> <span class="n">ℕ</span> <span class="o">:=</span> <span class="bp">@</span><span class="n">set.nonempty_Iic_subtype</span> <span class="bp">?</span><span class="n">x_97</span> <span class="bp">?</span><span class="n">x_98</span> <span class="bp">?</span><span class="n">x_99</span>
<span class="n">failed</span> <span class="n">is_def_eq</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">2</span><span class="o">)</span> <span class="bp">?</span><span class="n">x_58</span> <span class="o">:</span> <span class="n">nonempty</span> <span class="n">ℕ</span> <span class="o">:=</span> <span class="bp">@</span><span class="n">set.nonempty_Ici_subtype</span> <span class="bp">?</span><span class="n">x_100</span> <span class="bp">?</span><span class="n">x_101</span> <span class="bp">?</span><span class="n">x_102</span>
<span class="n">failed</span> <span class="n">is_def_eq</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">2</span><span class="o">)</span> <span class="bp">?</span><span class="n">x_58</span> <span class="o">:</span> <span class="n">nonempty</span> <span class="n">ℕ</span> <span class="o">:=</span> <span class="bp">@</span><span class="n">set.range.nonempty</span> <span class="bp">?</span><span class="n">x_103</span> <span class="bp">?</span><span class="n">x_104</span> <span class="bp">?</span><span class="n">x_105</span> <span class="bp">?</span><span class="n">x_106</span>
<span class="n">failed</span> <span class="n">is_def_eq</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">2</span><span class="o">)</span> <span class="bp">?</span><span class="n">x_58</span> <span class="o">:</span> <span class="n">nonempty</span> <span class="n">ℕ</span> <span class="o">:=</span> <span class="bp">@</span><span class="n">set.image.nonempty</span> <span class="bp">?</span><span class="n">x_107</span> <span class="bp">?</span><span class="n">x_108</span> <span class="bp">?</span><span class="n">x_109</span> <span class="bp">?</span><span class="n">x_110</span> <span class="bp">?</span><span class="n">x_111</span>
<span class="n">failed</span> <span class="n">is_def_eq</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">2</span><span class="o">)</span> <span class="bp">?</span><span class="n">x_58</span> <span class="o">:</span> <span class="n">nonempty</span> <span class="n">ℕ</span> <span class="o">:=</span> <span class="bp">@</span><span class="n">set.has_insert.insert.nonempty</span> <span class="bp">?</span><span class="n">x_112</span> <span class="bp">?</span><span class="n">x_113</span> <span class="bp">?</span><span class="n">x_114</span>
<span class="n">failed</span> <span class="n">is_def_eq</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">2</span><span class="o">)</span> <span class="bp">?</span><span class="n">x_58</span> <span class="o">:</span> <span class="n">nonempty</span> <span class="n">ℕ</span> <span class="o">:=</span> <span class="bp">@</span><span class="n">set.univ.nonempty</span> <span class="bp">?</span><span class="n">x_115</span> <span class="bp">?</span><span class="n">x_116</span>
<span class="n">failed</span> <span class="n">is_def_eq</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">2</span><span class="o">)</span> <span class="bp">?</span><span class="n">x_58</span> <span class="o">:</span> <span class="n">nonempty</span> <span class="n">ℕ</span> <span class="o">:=</span> <span class="bp">@</span><span class="n">nonempty_lt</span> <span class="bp">?</span><span class="n">x_117</span> <span class="bp">?</span><span class="n">x_118</span> <span class="bp">?</span><span class="n">x_119</span> <span class="bp">?</span><span class="n">x_120</span>
<span class="n">failed</span> <span class="n">is_def_eq</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">2</span><span class="o">)</span> <span class="bp">?</span><span class="n">x_58</span> <span class="o">:</span> <span class="n">nonempty</span> <span class="n">ℕ</span> <span class="o">:=</span> <span class="bp">@</span><span class="n">nonempty_gt</span> <span class="bp">?</span><span class="n">x_121</span> <span class="bp">?</span><span class="n">x_122</span> <span class="bp">?</span><span class="n">x_123</span> <span class="bp">?</span><span class="n">x_124</span>
<span class="n">failed</span> <span class="n">is_def_eq</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">2</span><span class="o">)</span> <span class="bp">?</span><span class="n">x_58</span> <span class="o">:</span> <span class="n">nonempty</span> <span class="n">ℕ</span> <span class="o">:=</span> <span class="bp">@</span><span class="n">order_dual.nonempty</span> <span class="bp">?</span><span class="n">x_125</span> <span class="bp">?</span><span class="n">x_126</span>
<span class="n">failed</span> <span class="n">is_def_eq</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">2</span><span class="o">)</span> <span class="bp">?</span><span class="n">x_58</span> <span class="o">:</span> <span class="n">nonempty</span> <span class="n">ℕ</span> <span class="o">:=</span> <span class="bp">@</span><span class="n">prod.nonempty</span> <span class="bp">?</span><span class="n">x_127</span> <span class="bp">?</span><span class="n">x_128</span> <span class="bp">?</span><span class="n">x_129</span> <span class="bp">?</span><span class="n">x_130</span>
<span class="n">failed</span> <span class="n">is_def_eq</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">2</span><span class="o">)</span> <span class="bp">?</span><span class="n">x_58</span> <span class="o">:</span> <span class="n">nonempty</span> <span class="n">ℕ</span> <span class="o">:=</span> <span class="bp">@</span><span class="n">add_torsor.nonempty</span> <span class="bp">?</span><span class="n">x_131</span> <span class="bp">?</span><span class="n">x_132</span> <span class="bp">?</span><span class="n">x_133</span> <span class="bp">?</span><span class="n">x_134</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">3</span><span class="o">)</span> <span class="bp">?</span><span class="n">x_134</span> <span class="o">:</span> <span class="bp">@</span><span class="n">add_torsor</span> <span class="bp">?</span><span class="n">x_131</span> <span class="n">ℕ</span> <span class="bp">?</span><span class="n">x_133</span> <span class="o">:=</span> <span class="bp">@</span><span class="n">affine_map.add_torsor</span> <span class="bp">?</span><span class="n">x_135</span> <span class="bp">?</span><span class="n">x_136</span> <span class="bp">?</span><span class="n">x_137</span> <span class="bp">?</span><span class="n">x_138</span> <span class="bp">?</span><span class="n">x_139</span> <span class="bp">?</span><span class="n">x_140</span> <span class="bp">?</span><span class="n">x_141</span> <span class="bp">?</span><span class="n">x_142</span> <span class="bp">?</span><span class="n">x_143</span> <span class="bp">?</span><span class="n">x_144</span> <span class="bp">?</span><span class="n">x_145</span> <span class="bp">?</span><span class="n">x_146</span>
<span class="n">failed</span> <span class="n">is_def_eq</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">3</span><span class="o">)</span> <span class="bp">?</span><span class="n">x_134</span> <span class="o">:</span> <span class="bp">@</span><span class="n">add_torsor</span> <span class="bp">?</span><span class="n">x_131</span> <span class="n">ℕ</span> <span class="bp">?</span><span class="n">x_133</span> <span class="o">:=</span> <span class="bp">@</span><span class="n">pi.add_torsor</span> <span class="bp">?</span><span class="n">x_147</span> <span class="bp">?</span><span class="n">x_148</span> <span class="bp">?</span><span class="n">x_149</span> <span class="bp">?</span><span class="n">x_150</span> <span class="bp">?</span><span class="n">x_151</span>
<span class="n">failed</span> <span class="n">is_def_eq</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">3</span><span class="o">)</span> <span class="bp">?</span><span class="n">x_134</span> <span class="o">:</span> <span class="bp">@</span><span class="n">add_torsor</span> <span class="bp">?</span><span class="n">x_131</span> <span class="n">ℕ</span> <span class="bp">?</span><span class="n">x_133</span> <span class="o">:=</span> <span class="bp">@</span><span class="n">prod.add_torsor</span> <span class="bp">?</span><span class="n">x_152</span> <span class="bp">?</span><span class="n">x_153</span> <span class="bp">?</span><span class="n">x_154</span> <span class="bp">?</span><span class="n">x_155</span> <span class="bp">?</span><span class="n">x_156</span> <span class="bp">?</span><span class="n">x_157</span> <span class="bp">?</span><span class="n">x_158</span> <span class="bp">?</span><span class="n">x_159</span>
<span class="n">failed</span> <span class="n">is_def_eq</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">3</span><span class="o">)</span> <span class="bp">?</span><span class="n">x_134</span> <span class="o">:</span> <span class="bp">@</span><span class="n">add_torsor</span> <span class="bp">?</span><span class="n">x_131</span> <span class="n">ℕ</span> <span class="bp">?</span><span class="n">x_133</span> <span class="o">:=</span> <span class="bp">@</span><span class="n">add_group_is_add_torsor</span> <span class="bp">?</span><span class="n">x_160</span> <span class="bp">?</span><span class="n">x_161</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">4</span><span class="o">)</span> <span class="bp">?</span><span class="n">x_161</span> <span class="o">:</span> <span class="n">add_group</span> <span class="n">ℕ</span> <span class="o">:=</span> <span class="bp">@</span><span class="n">power_series.add_group</span> <span class="bp">?</span><span class="n">x_162</span> <span class="bp">?</span><span class="n">x_163</span>
<span class="n">failed</span> <span class="n">is_def_eq</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">4</span><span class="o">)</span> <span class="bp">?</span><span class="n">x_161</span> <span class="o">:</span> <span class="n">add_group</span> <span class="n">ℕ</span> <span class="o">:=</span> <span class="bp">@</span><span class="n">mv_power_series.add_group</span> <span class="bp">?</span><span class="n">x_164</span> <span class="bp">?</span><span class="n">x_165</span> <span class="bp">?</span><span class="n">x_166</span>
<span class="n">failed</span> <span class="n">is_def_eq</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">4</span><span class="o">)</span> <span class="bp">?</span><span class="n">x_161</span> <span class="o">:</span> <span class="n">add_group</span> <span class="n">ℕ</span> <span class="o">:=</span> <span class="bp">@</span><span class="n">add_monoid_algebra.add_group</span> <span class="bp">?</span><span class="n">x_167</span> <span class="bp">?</span><span class="n">x_168</span> <span class="bp">?</span><span class="n">x_169</span>
<span class="n">failed</span> <span class="n">is_def_eq</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">4</span><span class="o">)</span> <span class="bp">?</span><span class="n">x_161</span> <span class="o">:</span> <span class="n">add_group</span> <span class="n">ℕ</span> <span class="o">:=</span> <span class="bp">@</span><span class="n">monoid_algebra.add_group</span> <span class="bp">?</span><span class="n">x_170</span> <span class="bp">?</span><span class="n">x_171</span> <span class="bp">?</span><span class="n">x_172</span>
<span class="n">failed</span> <span class="n">is_def_eq</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">4</span><span class="o">)</span> <span class="bp">?</span><span class="n">x_161</span> <span class="o">:</span> <span class="n">add_group</span> <span class="n">ℕ</span> <span class="o">:=</span> <span class="bp">@</span><span class="n">quotient_add_group.add_group</span> <span class="bp">?</span><span class="n">x_173</span> <span class="bp">?</span><span class="n">x_174</span> <span class="bp">?</span><span class="n">x_175</span> <span class="bp">?</span><span class="n">x_176</span>
<span class="n">failed</span> <span class="n">is_def_eq</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">4</span><span class="o">)</span> <span class="bp">?</span><span class="n">x_161</span> <span class="o">:</span> <span class="n">add_group</span> <span class="n">ℕ</span> <span class="o">:=</span> <span class="n">real.add_group</span>
<span class="n">failed</span> <span class="n">is_def_eq</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">4</span><span class="o">)</span> <span class="bp">?</span><span class="n">x_161</span> <span class="o">:</span> <span class="n">add_group</span> <span class="n">ℕ</span> <span class="o">:=</span> <span class="bp">@</span><span class="n">dfinsupp.add_group</span> <span class="bp">?</span><span class="n">x_177</span> <span class="bp">?</span><span class="n">x_178</span> <span class="bp">?</span><span class="n">x_179</span>
<span class="n">failed</span> <span class="n">is_def_eq</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">4</span><span class="o">)</span> <span class="bp">?</span><span class="n">x_161</span> <span class="o">:</span> <span class="n">add_group</span> <span class="n">ℕ</span> <span class="o">:=</span> <span class="bp">@</span><span class="n">finsupp.add_group</span> <span class="bp">?</span><span class="n">x_180</span> <span class="bp">?</span><span class="n">x_181</span> <span class="bp">?</span><span class="n">x_182</span>
<span class="n">failed</span> <span class="n">is_def_eq</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">4</span><span class="o">)</span> <span class="bp">?</span><span class="n">x_161</span> <span class="o">:</span> <span class="n">add_group</span> <span class="n">ℕ</span> <span class="o">:=</span> <span class="bp">?</span><span class="n">x_185.add_group</span>
<span class="n">failed</span> <span class="n">is_def_eq</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">4</span><span class="o">)</span> <span class="bp">?</span><span class="n">x_161</span> <span class="o">:</span> <span class="n">add_group</span> <span class="n">ℕ</span> <span class="o">:=</span> <span class="bp">@</span><span class="n">matrix.add_group</span> <span class="bp">?</span><span class="n">x_186</span> <span class="bp">?</span><span class="n">x_187</span> <span class="bp">?</span><span class="n">x_188</span> <span class="bp">?</span><span class="n">x_189</span> <span class="bp">?</span><span class="n">x_190</span> <span class="bp">?</span><span class="n">x_191</span>
<span class="n">failed</span> <span class="n">is_def_eq</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">4</span><span class="o">)</span> <span class="bp">?</span><span class="n">x_161</span> <span class="o">:</span> <span class="n">add_group</span> <span class="n">ℕ</span> <span class="o">:=</span> <span class="bp">@</span><span class="n">dmatrix.add_group</span> <span class="bp">?</span><span class="n">x_192</span> <span class="bp">?</span><span class="n">x_193</span> <span class="bp">?</span><span class="n">x_194</span> <span class="bp">?</span><span class="n">x_195</span> <span class="bp">?</span><span class="n">x_196</span> <span class="bp">?</span><span class="n">x_197</span>
<span class="n">failed</span> <span class="n">is_def_eq</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">4</span><span class="o">)</span> <span class="bp">?</span><span class="n">x_161</span> <span class="o">:</span> <span class="n">add_group</span> <span class="n">ℕ</span> <span class="o">:=</span> <span class="bp">?</span><span class="n">x_200.to_add_group</span>
<span class="n">failed</span> <span class="n">is_def_eq</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">4</span><span class="o">)</span> <span class="bp">?</span><span class="n">x_161</span> <span class="o">:</span> <span class="n">add_group</span> <span class="n">ℕ</span> <span class="o">:=</span> <span class="bp">@</span><span class="n">pi.add_group</span> <span class="bp">?</span><span class="n">x_201</span> <span class="bp">?</span><span class="n">x_202</span> <span class="bp">?</span><span class="n">x_203</span>
<span class="n">failed</span> <span class="n">is_def_eq</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">4</span><span class="o">)</span> <span class="bp">?</span><span class="n">x_161</span> <span class="o">:</span> <span class="n">add_group</span> <span class="n">ℕ</span> <span class="o">:=</span> <span class="n">rat.add_group</span>
<span class="n">failed</span> <span class="n">is_def_eq</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">4</span><span class="o">)</span> <span class="bp">?</span><span class="n">x_161</span> <span class="o">:</span> <span class="n">add_group</span> <span class="n">ℕ</span> <span class="o">:=</span> <span class="bp">@</span><span class="n">prod.add_group</span> <span class="bp">?</span><span class="n">x_204</span> <span class="bp">?</span><span class="n">x_205</span> <span class="bp">?</span><span class="n">x_206</span> <span class="bp">?</span><span class="n">x_207</span>
<span class="n">failed</span> <span class="n">is_def_eq</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">4</span><span class="o">)</span> <span class="bp">?</span><span class="n">x_161</span> <span class="o">:</span> <span class="n">add_group</span> <span class="n">ℕ</span> <span class="o">:=</span> <span class="bp">@</span><span class="n">opposite.add_group</span> <span class="bp">?</span><span class="n">x_208</span> <span class="bp">?</span><span class="n">x_209</span>
<span class="n">failed</span> <span class="n">is_def_eq</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">4</span><span class="o">)</span> <span class="bp">?</span><span class="n">x_161</span> <span class="o">:</span> <span class="n">add_group</span> <span class="n">ℕ</span> <span class="o">:=</span> <span class="bp">@</span><span class="n">additive.add_group</span> <span class="bp">?</span><span class="n">x_210</span> <span class="bp">?</span><span class="n">x_211</span>
<span class="n">failed</span> <span class="n">is_def_eq</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">4</span><span class="o">)</span> <span class="bp">?</span><span class="n">x_161</span> <span class="o">:</span> <span class="n">add_group</span> <span class="n">ℕ</span> <span class="o">:=</span> <span class="bp">@</span><span class="n">add_units.add_group</span> <span class="bp">?</span><span class="n">x_212</span> <span class="bp">?</span><span class="n">x_213</span>
<span class="n">failed</span> <span class="n">is_def_eq</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">4</span><span class="o">)</span> <span class="bp">?</span><span class="n">x_161</span> <span class="o">:</span> <span class="n">add_group</span> <span class="n">ℕ</span> <span class="o">:=</span> <span class="bp">@</span><span class="n">add_comm_group.to_add_group</span> <span class="bp">?</span><span class="n">x_214</span> <span class="bp">?</span><span class="n">x_215</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">5</span><span class="o">)</span> <span class="bp">?</span><span class="n">x_215</span> <span class="o">:</span> <span class="n">add_comm_group</span> <span class="n">ℕ</span> <span class="o">:=</span> <span class="n">real.angle.angle.add_comm_group</span>
<span class="n">failed</span> <span class="n">is_def_eq</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">5</span><span class="o">)</span> <span class="bp">?</span><span class="n">x_215</span> <span class="o">:</span> <span class="n">add_comm_group</span> <span class="n">ℕ</span> <span class="o">:=</span> <span class="bp">@</span><span class="n">formal_multilinear_series.add_comm_group</span> <span class="bp">?</span><span class="n">x_216</span> <span class="bp">?</span><span class="n">x_217</span> <span class="bp">?</span><span class="n">x_218</span> <span class="bp">?</span><span class="n">x_219</span> <span class="bp">?</span><span class="n">x_220</span> <span class="bp">?</span><span class="n">x_221</span> <span class="bp">?</span><span class="n">x_222</span> <span class="bp">?</span><span class="n">x_223</span>
<span class="n">failed</span> <span class="n">is_def_eq</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">5</span><span class="o">)</span> <span class="bp">?</span><span class="n">x_215</span> <span class="o">:</span> <span class="n">add_comm_group</span> <span class="n">ℕ</span> <span class="o">:=</span> <span class="bp">@</span><span class="n">power_series.add_comm_group</span> <span class="bp">?</span><span class="n">x_224</span> <span class="bp">?</span><span class="n">x_225</span>
<span class="n">failed</span> <span class="n">is_def_eq</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">5</span><span class="o">)</span> <span class="bp">?</span><span class="n">x_215</span> <span class="o">:</span> <span class="n">add_comm_group</span> <span class="n">ℕ</span> <span class="o">:=</span> <span class="bp">@</span><span class="n">mv_power_series.add_comm_group</span> <span class="bp">?</span><span class="n">x_226</span> <span class="bp">?</span><span class="n">x_227</span> <span class="bp">?</span><span class="n">x_228</span>
<span class="n">failed</span> <span class="n">is_def_eq</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">5</span><span class="o">)</span> <span class="bp">?</span><span class="n">x_215</span> <span class="o">:</span> <span class="n">add_comm_group</span> <span class="n">ℕ</span> <span class="o">:=</span> <span class="bp">@</span><span class="n">continuous_multilinear_map.add_comm_group</span> <span class="bp">?</span><span class="n">x_229</span> <span class="bp">?</span><span class="n">x_230</span> <span class="bp">?</span><span class="n">x_231</span> <span class="bp">?</span><span class="n">x_232</span> <span class="bp">?</span><span class="n">x_233</span> <span class="bp">?</span><span class="n">x_234</span> <span class="bp">?</span><span class="n">x_235</span> <span class="bp">?</span><span class="n">x_236</span> <span class="bp">?</span><span class="n">x_237</span> <span class="bp">?</span><span class="n">x_238</span> <span class="bp">?</span><span class="n">x_239</span>
  <span class="bp">?</span><span class="n">x_240</span>
  <span class="bp">?</span><span class="n">x_241</span>
<span class="n">failed</span> <span class="n">is_def_eq</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">5</span><span class="o">)</span> <span class="bp">?</span><span class="n">x_215</span> <span class="o">:</span> <span class="n">add_comm_group</span> <span class="n">ℕ</span> <span class="o">:=</span> <span class="bp">@</span><span class="n">normed_group_hom.add_comm_group</span> <span class="bp">?</span><span class="n">x_242</span> <span class="bp">?</span><span class="n">x_243</span> <span class="bp">?</span><span class="n">x_244</span> <span class="bp">?</span><span class="n">x_245</span>
<span class="n">failed</span> <span class="n">is_def_eq</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">5</span><span class="o">)</span> <span class="bp">?</span><span class="n">x_215</span> <span class="o">:</span> <span class="n">add_comm_group</span> <span class="n">ℕ</span> <span class="o">:=</span> <span class="bp">@</span><span class="n">affine_map.add_comm_group</span> <span class="bp">?</span><span class="n">x_246</span> <span class="bp">?</span><span class="n">x_247</span> <span class="bp">?</span><span class="n">x_248</span> <span class="bp">?</span><span class="n">x_249</span> <span class="bp">?</span><span class="n">x_250</span> <span class="bp">?</span><span class="n">x_251</span> <span class="bp">?</span><span class="n">x_252</span> <span class="bp">?</span><span class="n">x_253</span> <span class="bp">?</span><span class="n">x_254</span> <span class="bp">?</span><span class="n">x_255</span>
<span class="n">failed</span> <span class="n">is_def_eq</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">5</span><span class="o">)</span> <span class="bp">?</span><span class="n">x_215</span> <span class="o">:</span> <span class="n">add_comm_group</span> <span class="n">ℕ</span> <span class="o">:=</span> <span class="bp">@</span><span class="n">module.dual.add_comm_group</span> <span class="bp">?</span><span class="n">x_256</span> <span class="bp">?</span><span class="n">x_257</span> <span class="bp">?</span><span class="n">x_258</span> <span class="bp">?</span><span class="n">x_259</span> <span class="bp">?</span><span class="n">x_260</span>
<span class="n">failed</span> <span class="n">is_def_eq</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">5</span><span class="o">)</span> <span class="bp">?</span><span class="n">x_215</span> <span class="o">:</span> <span class="n">add_comm_group</span> <span class="n">ℕ</span> <span class="o">:=</span> <span class="bp">@</span><span class="n">alternating_map.add_comm_group</span> <span class="bp">?</span><span class="n">x_261</span> <span class="bp">?</span><span class="n">x_262</span> <span class="bp">?</span><span class="n">x_263</span> <span class="bp">?</span><span class="n">x_264</span> <span class="bp">?</span><span class="n">x_265</span> <span class="bp">?</span><span class="n">x_266</span> <span class="bp">?</span><span class="n">x_267</span> <span class="bp">?</span><span class="n">x_268</span> <span class="bp">?</span><span class="n">x_269</span> <span class="bp">?</span><span class="n">x_270</span>
<span class="n">failed</span> <span class="n">is_def_eq</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">5</span><span class="o">)</span> <span class="bp">?</span><span class="n">x_215</span> <span class="o">:</span> <span class="n">add_comm_group</span> <span class="n">ℕ</span> <span class="o">:=</span> <span class="bp">@</span><span class="n">multilinear_map.add_comm_group</span> <span class="bp">?</span><span class="n">x_271</span> <span class="bp">?</span><span class="n">x_272</span> <span class="bp">?</span><span class="n">x_273</span> <span class="bp">?</span><span class="n">x_274</span> <span class="bp">?</span><span class="n">x_275</span> <span class="bp">?</span><span class="n">x_276</span> <span class="bp">?</span><span class="n">x_277</span> <span class="bp">?</span><span class="n">x_278</span> <span class="bp">?</span><span class="n">x_279</span> <span class="bp">?</span><span class="n">x_280</span>
<span class="n">failed</span> <span class="n">is_def_eq</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">5</span><span class="o">)</span> <span class="bp">?</span><span class="n">x_215</span> <span class="o">:</span> <span class="n">add_comm_group</span> <span class="n">ℕ</span> <span class="o">:=</span> <span class="n">punit.add_comm_group</span>
<span class="n">failed</span> <span class="n">is_def_eq</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">5</span><span class="o">)</span> <span class="bp">?</span><span class="n">x_215</span> <span class="o">:</span> <span class="n">add_comm_group</span> <span class="n">ℕ</span> <span class="o">:=</span> <span class="bp">@</span><span class="n">continuous_linear_map.add_comm_group</span> <span class="bp">?</span><span class="n">x_281</span> <span class="bp">?</span><span class="n">x_282</span> <span class="bp">?</span><span class="n">x_283</span> <span class="bp">?</span><span class="n">x_284</span> <span class="bp">?</span><span class="n">x_285</span> <span class="bp">?</span><span class="n">x_286</span> <span class="bp">?</span><span class="n">x_287</span> <span class="bp">?</span><span class="n">x_288</span> <span class="bp">?</span><span class="n">x_289</span> <span class="bp">?</span><span class="n">x_290</span> <span class="bp">?</span><span class="n">x_291</span>
<span class="n">failed</span> <span class="n">is_def_eq</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">5</span><span class="o">)</span> <span class="bp">?</span><span class="n">x_215</span> <span class="o">:</span> <span class="n">add_comm_group</span> <span class="n">ℕ</span> <span class="o">:=</span> <span class="bp">@</span><span class="n">quotient_add_group.add_comm_group</span> <span class="bp">?</span><span class="n">x_292</span> <span class="bp">?</span><span class="n">x_293</span> <span class="bp">?</span><span class="n">x_294</span>
<span class="n">failed</span> <span class="n">is_def_eq</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">5</span><span class="o">)</span> <span class="bp">?</span><span class="n">x_215</span> <span class="o">:</span> <span class="n">add_comm_group</span> <span class="n">ℕ</span> <span class="o">:=</span> <span class="n">real.add_comm_group</span>
<span class="n">failed</span> <span class="n">is_def_eq</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">5</span><span class="o">)</span> <span class="bp">?</span><span class="n">x_215</span> <span class="o">:</span> <span class="n">add_comm_group</span> <span class="n">ℕ</span> <span class="o">:=</span> <span class="bp">@</span><span class="n">restrict_scalars.add_comm_group</span> <span class="bp">?</span><span class="n">x_295</span> <span class="bp">?</span><span class="n">x_296</span> <span class="bp">?</span><span class="n">x_297</span> <span class="bp">?</span><span class="n">x_298</span>
<span class="n">failed</span> <span class="n">is_def_eq</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">5</span><span class="o">)</span> <span class="bp">?</span><span class="n">x_215</span> <span class="o">:</span> <span class="n">add_comm_group</span> <span class="n">ℕ</span> <span class="o">:=</span> <span class="bp">@</span><span class="n">tensor_product.add_comm_group</span> <span class="bp">?</span><span class="n">x_299</span> <span class="bp">?</span><span class="n">x_300</span> <span class="bp">?</span><span class="n">x_301</span> <span class="bp">?</span><span class="n">x_302</span> <span class="bp">?</span><span class="n">x_303</span> <span class="bp">?</span><span class="n">x_304</span> <span class="bp">?</span><span class="n">x_305</span> <span class="bp">?</span><span class="n">x_306</span>
<span class="n">failed</span> <span class="n">is_def_eq</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">5</span><span class="o">)</span> <span class="bp">?</span><span class="n">x_215</span> <span class="o">:</span> <span class="n">add_comm_group</span> <span class="n">ℕ</span> <span class="o">:=</span> <span class="bp">@</span><span class="n">submodule.quotient.add_comm_group</span> <span class="bp">?</span><span class="n">x_307</span> <span class="bp">?</span><span class="n">x_308</span> <span class="bp">?</span><span class="n">x_309</span> <span class="bp">?</span><span class="n">x_310</span> <span class="bp">?</span><span class="n">x_311</span> <span class="bp">?</span><span class="n">x_312</span>
<span class="n">failed</span> <span class="n">is_def_eq</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">5</span><span class="o">)</span> <span class="bp">?</span><span class="n">x_215</span> <span class="o">:</span> <span class="n">add_comm_group</span> <span class="n">ℕ</span> <span class="o">:=</span> <span class="bp">@</span><span class="n">linear_map.add_comm_group</span> <span class="bp">?</span><span class="n">x_313</span> <span class="bp">?</span><span class="n">x_314</span> <span class="bp">?</span><span class="n">x_315</span> <span class="bp">?</span><span class="n">x_316</span> <span class="bp">?</span><span class="n">x_317</span> <span class="bp">?</span><span class="n">x_318</span> <span class="bp">?</span><span class="n">x_319</span> <span class="bp">?</span><span class="n">x_320</span>
<span class="n">failed</span> <span class="n">is_def_eq</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">5</span><span class="o">)</span> <span class="bp">?</span><span class="n">x_215</span> <span class="o">:</span> <span class="n">add_comm_group</span> <span class="n">ℕ</span> <span class="o">:=</span> <span class="bp">@</span><span class="n">dfinsupp.add_comm_group</span> <span class="bp">?</span><span class="n">x_321</span> <span class="bp">?</span><span class="n">x_322</span> <span class="bp">?</span><span class="n">x_323</span>
<span class="n">failed</span> <span class="n">is_def_eq</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">5</span><span class="o">)</span> <span class="bp">?</span><span class="n">x_215</span> <span class="o">:</span> <span class="n">add_comm_group</span> <span class="n">ℕ</span> <span class="o">:=</span> <span class="bp">@</span><span class="n">finsupp.add_comm_group</span> <span class="bp">?</span><span class="n">x_324</span> <span class="bp">?</span><span class="n">x_325</span> <span class="bp">?</span><span class="n">x_326</span>
<span class="n">failed</span> <span class="n">is_def_eq</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">5</span><span class="o">)</span> <span class="bp">?</span><span class="n">x_215</span> <span class="o">:</span> <span class="n">add_comm_group</span> <span class="n">ℕ</span> <span class="o">:=</span> <span class="bp">?</span><span class="n">x_332.add_comm_group</span>
<span class="n">failed</span> <span class="n">is_def_eq</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">5</span><span class="o">)</span> <span class="bp">?</span><span class="n">x_215</span> <span class="o">:</span> <span class="n">add_comm_group</span> <span class="n">ℕ</span> <span class="o">:=</span> <span class="bp">@</span><span class="n">matrix.add_comm_group</span> <span class="bp">?</span><span class="n">x_333</span> <span class="bp">?</span><span class="n">x_334</span> <span class="bp">?</span><span class="n">x_335</span> <span class="bp">?</span><span class="n">x_336</span> <span class="bp">?</span><span class="n">x_337</span> <span class="bp">?</span><span class="n">x_338</span>
<span class="n">failed</span> <span class="n">is_def_eq</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">5</span><span class="o">)</span> <span class="bp">?</span><span class="n">x_215</span> <span class="o">:</span> <span class="n">add_comm_group</span> <span class="n">ℕ</span> <span class="o">:=</span> <span class="bp">@</span><span class="n">dmatrix.add_comm_group</span> <span class="bp">?</span><span class="n">x_339</span> <span class="bp">?</span><span class="n">x_340</span> <span class="bp">?</span><span class="n">x_341</span> <span class="bp">?</span><span class="n">x_342</span> <span class="bp">?</span><span class="n">x_343</span> <span class="bp">?</span><span class="n">x_344</span>
<span class="n">failed</span> <span class="n">is_def_eq</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">5</span><span class="o">)</span> <span class="bp">?</span><span class="n">x_215</span> <span class="o">:</span> <span class="n">add_comm_group</span> <span class="n">ℕ</span> <span class="o">:=</span> <span class="bp">?</span><span class="n">x_347.to_add_comm_group</span>
<span class="n">failed</span> <span class="n">is_def_eq</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">5</span><span class="o">)</span> <span class="bp">?</span><span class="n">x_215</span> <span class="o">:</span> <span class="n">add_comm_group</span> <span class="n">ℕ</span> <span class="o">:=</span> <span class="bp">@</span><span class="n">pi.add_comm_group</span> <span class="bp">?</span><span class="n">x_348</span> <span class="bp">?</span><span class="n">x_349</span> <span class="bp">?</span><span class="n">x_350</span>
<span class="n">failed</span> <span class="n">is_def_eq</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">5</span><span class="o">)</span> <span class="bp">?</span><span class="n">x_215</span> <span class="o">:</span> <span class="n">add_comm_group</span> <span class="n">ℕ</span> <span class="o">:=</span> <span class="n">fin.add_comm_group</span> <span class="bp">?</span><span class="n">x_351</span>
<span class="n">failed</span> <span class="n">is_def_eq</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">5</span><span class="o">)</span> <span class="bp">?</span><span class="n">x_215</span> <span class="o">:</span> <span class="n">add_comm_group</span> <span class="n">ℕ</span> <span class="o">:=</span> <span class="n">rat.add_comm_group</span>
<span class="n">failed</span> <span class="n">is_def_eq</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">5</span><span class="o">)</span> <span class="bp">?</span><span class="n">x_215</span> <span class="o">:</span> <span class="n">add_comm_group</span> <span class="n">ℕ</span> <span class="o">:=</span> <span class="bp">@</span><span class="n">add_monoid_hom.add_comm_group</span> <span class="bp">?</span><span class="n">x_352</span> <span class="bp">?</span><span class="n">x_353</span> <span class="bp">?</span><span class="n">x_354</span> <span class="bp">?</span><span class="n">x_355</span>
<span class="n">failed</span> <span class="n">is_def_eq</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">5</span><span class="o">)</span> <span class="bp">?</span><span class="n">x_215</span> <span class="o">:</span> <span class="n">add_comm_group</span> <span class="n">ℕ</span> <span class="o">:=</span> <span class="bp">@</span><span class="n">prod.add_comm_group</span> <span class="bp">?</span><span class="n">x_356</span> <span class="bp">?</span><span class="n">x_357</span> <span class="bp">?</span><span class="n">x_358</span> <span class="bp">?</span><span class="n">x_359</span>
<span class="n">failed</span> <span class="n">is_def_eq</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">5</span><span class="o">)</span> <span class="bp">?</span><span class="n">x_215</span> <span class="o">:</span> <span class="n">add_comm_group</span> <span class="n">ℕ</span> <span class="o">:=</span> <span class="bp">@</span><span class="n">opposite.add_comm_group</span> <span class="bp">?</span><span class="n">x_360</span> <span class="bp">?</span><span class="n">x_361</span>
<span class="n">failed</span> <span class="n">is_def_eq</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">5</span><span class="o">)</span> <span class="bp">?</span><span class="n">x_215</span> <span class="o">:</span> <span class="n">add_comm_group</span> <span class="n">ℕ</span> <span class="o">:=</span> <span class="bp">@</span><span class="n">additive.add_comm_group</span> <span class="bp">?</span><span class="n">x_362</span> <span class="bp">?</span><span class="n">x_363</span>
<span class="n">failed</span> <span class="n">is_def_eq</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">5</span><span class="o">)</span> <span class="bp">?</span><span class="n">x_215</span> <span class="o">:</span> <span class="n">add_comm_group</span> <span class="n">ℕ</span> <span class="o">:=</span> <span class="bp">@</span><span class="n">add_units.add_comm_group</span> <span class="bp">?</span><span class="n">x_364</span> <span class="bp">?</span><span class="n">x_365</span>
<span class="n">failed</span> <span class="n">is_def_eq</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">5</span><span class="o">)</span> <span class="bp">?</span><span class="n">x_215</span> <span class="o">:</span> <span class="n">add_comm_group</span> <span class="n">ℕ</span> <span class="o">:=</span> <span class="bp">@</span><span class="n">normed_group.to_add_comm_group</span> <span class="bp">?</span><span class="n">x_366</span> <span class="bp">?</span><span class="n">x_367</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">6</span><span class="o">)</span> <span class="bp">?</span><span class="n">x_367</span> <span class="o">:</span> <span class="n">normed_group</span> <span class="n">ℕ</span> <span class="o">:=</span> <span class="n">complex.normed_group</span>
<span class="n">failed</span> <span class="n">is_def_eq</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">6</span><span class="o">)</span> <span class="bp">?</span><span class="n">x_367</span> <span class="o">:</span> <span class="n">normed_group</span> <span class="n">ℕ</span> <span class="o">:=</span> <span class="bp">@</span><span class="n">continuous_multilinear_map.to_normed_group</span> <span class="bp">?</span><span class="n">x_368</span> <span class="bp">?</span><span class="n">x_369</span> <span class="bp">?</span><span class="n">x_370</span> <span class="bp">?</span><span class="n">x_371</span> <span class="bp">?</span><span class="n">x_372</span> <span class="bp">?</span><span class="n">x_373</span> <span class="bp">?</span><span class="n">x_374</span> <span class="bp">?</span><span class="n">x_375</span> <span class="bp">?</span><span class="n">x_376</span> <span class="bp">?</span><span class="n">x_377</span> <span class="bp">?</span><span class="n">x_378</span>
<span class="n">failed</span> <span class="n">is_def_eq</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">6</span><span class="o">)</span> <span class="bp">?</span><span class="n">x_367</span> <span class="o">:</span> <span class="n">normed_group</span> <span class="n">ℕ</span> <span class="o">:=</span> <span class="bp">@</span><span class="n">continuous_linear_map.to_normed_group</span> <span class="bp">?</span><span class="n">x_379</span> <span class="bp">?</span><span class="n">x_380</span> <span class="bp">?</span><span class="n">x_381</span> <span class="bp">?</span><span class="n">x_382</span> <span class="bp">?</span><span class="n">x_383</span> <span class="bp">?</span><span class="n">x_384</span> <span class="bp">?</span><span class="n">x_385</span> <span class="bp">?</span><span class="n">x_386</span>
<span class="n">failed</span> <span class="n">is_def_eq</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">6</span><span class="o">)</span> <span class="bp">?</span><span class="n">x_367</span> <span class="o">:</span> <span class="n">normed_group</span> <span class="n">ℕ</span> <span class="o">:=</span> <span class="bp">@</span><span class="n">normed_group_hom.to_normed_group</span> <span class="bp">?</span><span class="n">x_387</span> <span class="bp">?</span><span class="n">x_388</span> <span class="bp">?</span><span class="n">x_389</span> <span class="bp">?</span><span class="n">x_390</span>
<span class="n">failed</span> <span class="n">is_def_eq</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">6</span><span class="o">)</span> <span class="bp">?</span><span class="n">x_367</span> <span class="o">:</span> <span class="n">normed_group</span> <span class="n">ℕ</span> <span class="o">:=</span> <span class="bp">@</span><span class="n">restrict_scalars.normed_group</span> <span class="bp">?</span><span class="n">x_391</span> <span class="bp">?</span><span class="n">x_392</span> <span class="bp">?</span><span class="n">x_393</span> <span class="bp">?</span><span class="n">x_394</span>
<span class="n">failed</span> <span class="n">is_def_eq</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">6</span><span class="o">)</span> <span class="bp">?</span><span class="n">x_367</span> <span class="o">:</span> <span class="n">normed_group</span> <span class="n">ℕ</span> <span class="o">:=</span> <span class="bp">@</span><span class="n">pi.normed_group</span> <span class="bp">?</span><span class="n">x_395</span> <span class="bp">?</span><span class="n">x_396</span> <span class="bp">?</span><span class="n">x_397</span> <span class="bp">?</span><span class="n">x_398</span>
<span class="n">failed</span> <span class="n">is_def_eq</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">6</span><span class="o">)</span> <span class="bp">?</span><span class="n">x_367</span> <span class="o">:</span> <span class="n">normed_group</span> <span class="n">ℕ</span> <span class="o">:=</span> <span class="bp">@</span><span class="n">prod.normed_group</span> <span class="bp">?</span><span class="n">x_399</span> <span class="bp">?</span><span class="n">x_400</span> <span class="bp">?</span><span class="n">x_401</span> <span class="bp">?</span><span class="n">x_402</span>
<span class="n">failed</span> <span class="n">is_def_eq</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">6</span><span class="o">)</span> <span class="bp">?</span><span class="n">x_367</span> <span class="o">:</span> <span class="n">normed_group</span> <span class="n">ℕ</span> <span class="o">:=</span> <span class="bp">?</span><span class="n">x_408.normed_group</span>
<span class="n">failed</span> <span class="n">is_def_eq</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">6</span><span class="o">)</span> <span class="bp">?</span><span class="n">x_367</span> <span class="o">:</span> <span class="n">normed_group</span> <span class="n">ℕ</span> <span class="o">:=</span> <span class="bp">?</span><span class="n">x_411.normed_group</span>
<span class="n">failed</span> <span class="n">is_def_eq</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">6</span><span class="o">)</span> <span class="bp">?</span><span class="n">x_367</span> <span class="o">:</span> <span class="n">normed_group</span> <span class="n">ℕ</span> <span class="o">:=</span> <span class="n">real.normed_group</span>
<span class="n">failed</span> <span class="n">is_def_eq</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">6</span><span class="o">)</span> <span class="bp">?</span><span class="n">x_367</span> <span class="o">:</span> <span class="n">normed_group</span> <span class="n">ℕ</span> <span class="o">:=</span> <span class="bp">@</span><span class="n">normed_linear_ordered_group.to_normed_group</span> <span class="bp">?</span><span class="n">x_412</span> <span class="bp">?</span><span class="n">x_413</span>
<span class="bp">```</span> <span class="o">(</span><span class="n">Zulip</span> <span class="n">max</span> <span class="n">lines</span> <span class="n">reached</span><span class="o">)</span>
</code></pre></div>



<a name="238103136"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/char_zero/near/238103136" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/char_zero.html#238103136">(May 10 2021 at 08:19)</a>:</h4>
<p>it's a much bigger story than that though</p>



<a name="238103289"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/char_zero/near/238103289" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/char_zero.html#238103289">(May 10 2021 at 08:20)</a>:</h4>
<p>that's not the problem, it's just funny</p>



<a name="238103777"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/char_zero/near/238103777" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/char_zero.html#238103777">(May 10 2021 at 08:22)</a>:</h4>
<p><del>docs#add_torsor.nonempty has the wrong priority</del></p>



<a name="238104013"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/char_zero/near/238104013" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/char_zero.html#238104013">(May 10 2021 at 08:24)</a>:</h4>
<p><del>Or perhaps more scarily, it seems to be being ignored?</del></p>



<a name="238105987"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/char_zero/near/238105987" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/char_zero.html#238105987">(May 10 2021 at 08:41)</a>:</h4>
<p>Let's see if <a href="https://github.com/leanprover-community/mathlib/issues/7563">#7563</a> makes things better or worse</p>



<a name="238380523"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/char_zero/near/238380523" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/char_zero.html#238380523">(May 11 2021 at 20:54)</a>:</h4>
<p><span class="user-mention" data-user-id="240862">@Oliver Nash</span> <span class="user-mention" data-user-id="310045">@Eric Wieser</span> The discussion <a href="#narrow/stream/113488-general/topic/rw.20causes.20excessive.20memory.20consumption/near/238325048">here</a> was my attempt to diagnose the timeouts, and it has led to Sebastien Gouezel's <a href="https://github.com/leanprover-community/mathlib/issues/7583">#7583</a>. If you merge that into <a href="https://github.com/leanprover-community/mathlib/issues/6786">#6786</a> does it help?</p>



<a name="238386110"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/char_zero/near/238386110" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Oliver Nash <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/char_zero.html#238386110">(May 11 2021 at 21:38)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110038">Kevin Buzzard</span> <a href="#narrow/stream/116395-maths/topic/char_zero/near/238380523">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="240862">Oliver Nash</span> <span class="user-mention silent" data-user-id="310045">Eric Wieser</span> The discussion <a href="#narrow/stream/113488-general/topic/rw.20causes.20excessive.20memory.20consumption/near/238325048">here</a> was my attempt to diagnose the timeouts, and it has led to Sebastien Gouezel's <a href="https://github.com/leanprover-community/mathlib/issues/7583">#7583</a>. If you merge that into <a href="https://github.com/leanprover-community/mathlib/issues/6786">#6786</a> does it help?</p>
</blockquote>
<p>Yes, it looks like it does. After mering <a href="https://github.com/leanprover-community/mathlib/tree/test_perfection">branch#test_perfection</a>, <code>perfection_map.map_eq_map</code> goes from a timeout in VS Code (not at command line, I guess different limit) to basically instant.</p>



<a name="238386311"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/char_zero/near/238386311" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Oliver Nash <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/char_zero.html#238386311">(May 11 2021 at 21:41)</a>:</h4>
<p>I could merge <a href="https://github.com/leanprover-community/mathlib/tree/test_perfection">branch#test_perfection</a> into <a href="https://github.com/leanprover-community/mathlib/issues/6786">#6786</a> but probably better to wait for <a href="https://github.com/leanprover-community/mathlib/issues/7583">#7583</a> to hit master and then merge from there.</p>



<a name="238386350"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/char_zero/near/238386350" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Oliver Nash <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/char_zero.html#238386350">(May 11 2021 at 21:41)</a>:</h4>
<p>Awesome work <span class="user-mention" data-user-id="110050">@Sebastien Gouezel</span></p>



<a name="238386359"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/char_zero/near/238386359" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Oliver Nash <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/char_zero.html#238386359">(May 11 2021 at 21:41)</a>:</h4>
<p>(and all concerned in fact)</p>



<a name="238642063"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/char_zero/near/238642063" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Oliver Nash <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/char_zero.html#238642063">(May 13 2021 at 16:03)</a>:</h4>
<p><a href="https://github.com/leanprover-community/mathlib/issues/7583">#7583</a> hit master yesterday, so I merged master into <a href="https://github.com/leanprover-community/mathlib/issues/6786">#6786</a> and indeed it now builds successfully.</p>



<a name="238673148"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/char_zero/near/238673148" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/char_zero.html#238673148">(May 13 2021 at 20:05)</a>:</h4>
<p>Great! I'll update my dependent branch that updates subring tomorrow and check that still works too!</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>