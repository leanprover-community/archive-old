---
layout: archive
title: Zulip Chat Archive
permalink: /stream/116395-maths/topic/A.20proof.20of.20Baire.20category.20theorem.20using.20.232850.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/116395-maths/index.html">maths</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/A.20proof.20of.20Baire.20category.20theorem.20using.20.232850.html">A proof of Baire category theorem using #2850</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="199316340"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/A%20proof%20of%20Baire%20category%20theorem%20using%20%232850/near/199316340" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> David Wärn <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/A.20proof.20of.20Baire.20category.20theorem.20using.20.232850.html#199316340">(May 31 2020 at 18:43)</a>:</h4>
<p>In an attempt to better explain the point of PR <a href="https://github.com/leanprover-community/mathlib/issues/2850">#2850</a>, here is a proof of BCT for a complete metric space <code>X</code> (of course there is already <a href="https://github.com/leanprover-community/mathlib/blob/25fc0a8/src/topology/metric_space/baire.lean#L89">a shorter proof</a> in mathlib). The idea is to consider the poset of closed subsets <code>C</code> of <code>X</code> with nonempty interior, ordered by reverse inclusion. We have two families of predicates on this poset: one saying "<code>C</code> has diameter <code>&lt;= r</code>", and one saying "<code>C</code> is a subset of <code>S</code>". We separately show that these predicates are both "cofinal", in the sense that any <code>C</code> can be shrunk so as to satisfy the predicate, assuming <code>r &gt; 0</code> and <code>S</code> open dense, respectively. <a href="https://github.com/leanprover-community/mathlib/issues/2850">#2850</a> finishes the job, more or less.</p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="n">order</span><span class="bp">.</span><span class="n">generic_cofilter</span>
<span class="kn">import</span> <span class="n">analysis</span><span class="bp">.</span><span class="n">specific_limits</span>

<span class="c">/-</span><span class="cm"> This is an attempt at illustrating the use #2850.</span>

<span class="cm">-/</span>

<span class="kn">open</span> <span class="n">metric</span> <span class="n">set</span>

<span class="kn">variables</span> <span class="o">{</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">metric_space</span> <span class="n">α</span><span class="o">]</span>

<span class="c1">-- where can I find this lemma?</span>
<span class="kn">lemma</span> <span class="n">closed_ball_subset_ball</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="n">α</span><span class="o">)</span> <span class="o">{</span><span class="n">a</span> <span class="n">b</span> <span class="o">:</span> <span class="n">ℝ</span><span class="o">}</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="n">a</span> <span class="bp">&lt;</span> <span class="n">b</span><span class="o">)</span> <span class="o">:</span>
  <span class="n">closed_ball</span> <span class="n">x</span> <span class="n">a</span> <span class="err">⊆</span> <span class="n">ball</span> <span class="n">x</span> <span class="n">b</span> <span class="o">:=</span>
<span class="bp">λ</span> <span class="n">y</span> <span class="n">hy</span><span class="o">,</span> <span class="k">calc</span> <span class="n">dist</span> <span class="n">y</span> <span class="n">x</span> <span class="bp">≤</span> <span class="n">a</span> <span class="o">:</span> <span class="n">hy</span>
                  <span class="bp">...</span> <span class="bp">&lt;</span> <span class="n">b</span> <span class="o">:</span> <span class="n">h</span>

<span class="c1">-- where can I find this lemma?</span>
<span class="kn">lemma</span> <span class="n">metric_space_is_regular</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="n">α</span><span class="o">)</span> <span class="o">(</span><span class="n">s</span> <span class="o">:</span> <span class="n">set</span> <span class="n">α</span><span class="o">)</span> <span class="o">(</span><span class="n">ho</span> <span class="o">:</span> <span class="n">is_open</span> <span class="n">s</span><span class="o">)</span> <span class="o">(</span><span class="n">xs</span> <span class="o">:</span> <span class="n">x</span> <span class="err">∈</span> <span class="n">s</span><span class="o">)</span> <span class="o">:</span>
  <span class="bp">∃</span> <span class="n">t</span> <span class="o">:</span> <span class="n">set</span> <span class="n">α</span><span class="o">,</span> <span class="n">is_open</span> <span class="n">t</span> <span class="bp">∧</span> <span class="n">x</span> <span class="err">∈</span> <span class="n">t</span> <span class="bp">∧</span> <span class="n">closure</span> <span class="n">t</span> <span class="err">⊆</span> <span class="n">s</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="n">rcases</span> <span class="n">metric</span><span class="bp">.</span><span class="n">is_open_iff</span><span class="bp">.</span><span class="n">mp</span> <span class="n">ho</span> <span class="n">x</span> <span class="n">xs</span> <span class="k">with</span> <span class="bp">⟨</span><span class="n">r</span><span class="o">,</span> <span class="n">rpos</span><span class="o">,</span> <span class="n">xrs</span><span class="bp">⟩</span><span class="o">,</span>
  <span class="n">refine</span> <span class="bp">⟨</span><span class="n">ball</span> <span class="n">x</span> <span class="o">(</span><span class="n">r</span><span class="bp">/</span><span class="mi">2</span><span class="o">),</span> <span class="n">is_open_ball</span><span class="o">,</span> <span class="n">mem_ball_self</span> <span class="o">(</span><span class="n">half_pos</span> <span class="n">rpos</span><span class="o">),</span> <span class="bp">_⟩</span><span class="o">,</span>
  <span class="k">calc</span> <span class="n">closure</span> <span class="o">(</span><span class="n">ball</span> <span class="n">x</span> <span class="o">(</span><span class="n">r</span><span class="bp">/</span><span class="mi">2</span><span class="o">))</span> <span class="err">⊆</span> <span class="n">closed_ball</span> <span class="n">x</span> <span class="o">(</span><span class="n">r</span><span class="bp">/</span><span class="mi">2</span><span class="o">)</span> <span class="o">:</span> <span class="n">closure_ball_subset_closed_ball</span>
                          <span class="bp">...</span> <span class="err">⊆</span> <span class="n">ball</span> <span class="n">x</span> <span class="n">r</span> <span class="o">:</span> <span class="n">closed_ball_subset_ball</span> <span class="n">x</span> <span class="o">(</span><span class="n">half_lt_self</span> <span class="n">rpos</span><span class="o">)</span>
                          <span class="bp">...</span> <span class="err">⊆</span> <span class="n">s</span> <span class="o">:</span> <span class="n">xrs</span>
<span class="kn">end</span>

<span class="kn">variable</span> <span class="o">(</span><span class="n">α</span><span class="o">)</span>
<span class="c">/-</span><span class="cm">- The type of closed subsets of `α` with nonempty interior. -/</span>
<span class="n">def</span> <span class="n">cniset</span> <span class="o">:</span> <span class="kt">Type</span> <span class="bp">_</span> <span class="o">:=</span>
  <span class="o">{</span> <span class="n">C</span> <span class="o">:</span> <span class="n">set</span> <span class="n">α</span> <span class="bp">//</span> <span class="n">is_closed</span> <span class="n">C</span> <span class="bp">∧</span> <span class="o">(</span><span class="n">interior</span> <span class="n">C</span><span class="o">)</span><span class="bp">.</span><span class="n">nonempty</span> <span class="o">}</span>
<span class="kn">variable</span> <span class="o">{</span><span class="n">α</span><span class="o">}</span>

<span class="c">/-</span><span class="cm">- We order cnisets by reverse inclusion. A smaller cniset is thought of as</span>
<span class="cm">    &#39;extending&#39; a larger set, because it imposes more constraints. -/</span>
<span class="kn">instance</span> <span class="o">:</span> <span class="n">preorder</span> <span class="o">(</span><span class="n">cniset</span> <span class="n">α</span><span class="o">)</span> <span class="o">:=</span>
<span class="o">{</span> <span class="n">le</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">f</span> <span class="n">g</span><span class="o">,</span> <span class="n">g</span><span class="bp">.</span><span class="n">val</span> <span class="err">⊆</span> <span class="n">f</span><span class="bp">.</span><span class="n">val</span><span class="o">,</span>
  <span class="n">le_refl</span> <span class="o">:=</span> <span class="k">by</span> <span class="n">tidy</span><span class="o">,</span> <span class="n">le_trans</span> <span class="o">:=</span> <span class="k">by</span> <span class="n">tidy</span><span class="o">,</span> <span class="o">}</span>

<span class="c">/-</span><span class="cm">- Given a dense open set `s`, any cniset can be shrunk so as to lie in `s`. -/</span>
<span class="n">def</span> <span class="n">cofinal_of_dense</span> <span class="o">(</span><span class="n">s</span> <span class="o">:</span> <span class="n">set</span> <span class="n">α</span><span class="o">)</span> <span class="o">(</span><span class="n">ho</span> <span class="o">:</span> <span class="n">is_open</span> <span class="n">s</span><span class="o">)</span> <span class="o">(</span><span class="n">hd</span> <span class="o">:</span> <span class="n">closure</span> <span class="n">s</span> <span class="bp">=</span> <span class="n">univ</span><span class="o">)</span> <span class="o">:</span>
  <span class="o">{</span> <span class="n">D</span> <span class="o">:</span> <span class="n">set</span> <span class="o">(</span><span class="n">cniset</span> <span class="n">α</span><span class="o">)</span> <span class="bp">//</span> <span class="n">cofinal</span> <span class="n">D</span> <span class="o">}</span> <span class="o">:=</span>
<span class="o">{</span> <span class="n">val</span> <span class="o">:=</span> <span class="o">{</span> <span class="n">f</span> <span class="bp">|</span> <span class="n">f</span><span class="bp">.</span><span class="n">val</span> <span class="err">⊆</span> <span class="n">s</span><span class="o">},</span>
  <span class="n">property</span> <span class="o">:=</span>
    <span class="k">begin</span>
      <span class="n">rintros</span> <span class="bp">⟨</span><span class="n">C</span><span class="o">,</span> <span class="n">hc</span><span class="o">,</span> <span class="n">hni</span><span class="bp">⟩</span><span class="o">,</span>
      <span class="n">rcases</span> <span class="n">dense_iff_inter_open</span><span class="bp">.</span><span class="n">mp</span> <span class="n">hd</span> <span class="o">(</span><span class="n">interior</span> <span class="n">C</span><span class="o">)</span> <span class="o">(</span><span class="n">is_open_interior</span><span class="o">)</span> <span class="n">hni</span>
        <span class="k">with</span> <span class="bp">⟨</span><span class="n">x</span><span class="o">,</span> <span class="n">xic</span><span class="o">,</span> <span class="n">xs</span><span class="bp">⟩</span><span class="o">,</span>
      <span class="n">rcases</span> <span class="n">metric_space_is_regular</span> <span class="n">x</span> <span class="o">(</span><span class="n">s</span> <span class="err">∩</span> <span class="n">interior</span> <span class="n">C</span><span class="o">)</span> <span class="o">(</span><span class="n">is_open_inter</span> <span class="n">ho</span> <span class="err">$</span> <span class="n">is_open_interior</span><span class="o">)</span>
        <span class="bp">⟨</span><span class="n">xs</span><span class="o">,</span> <span class="n">xic</span><span class="bp">⟩</span> <span class="k">with</span> <span class="bp">⟨</span><span class="n">t</span><span class="o">,</span> <span class="n">hto</span><span class="o">,</span> <span class="n">xt</span><span class="o">,</span> <span class="n">ht</span><span class="bp">⟩</span><span class="o">,</span>
      <span class="n">rw</span> <span class="n">subset_inter_iff</span> <span class="n">at</span> <span class="n">ht</span><span class="o">,</span>
      <span class="n">refine</span> <span class="bp">⟨⟨</span><span class="n">closure</span> <span class="n">t</span><span class="o">,</span> <span class="n">is_closed_closure</span><span class="o">,</span> <span class="bp">_⟩</span><span class="o">,</span> <span class="bp">_</span><span class="o">,</span> <span class="bp">_⟩</span><span class="o">,</span>
      <span class="o">{</span> <span class="n">use</span> <span class="n">x</span><span class="o">,</span>
        <span class="n">rw</span> <span class="n">mem_interior</span><span class="o">,</span>
        <span class="n">exact</span> <span class="bp">⟨</span><span class="n">t</span><span class="o">,</span> <span class="n">subset_closure</span><span class="o">,</span> <span class="n">hto</span><span class="o">,</span> <span class="n">xt</span><span class="bp">⟩</span><span class="o">,</span> <span class="o">},</span>
      <span class="n">exact</span> <span class="n">ht</span><span class="bp">.</span><span class="mi">1</span><span class="o">,</span>
      <span class="k">calc</span> <span class="n">closure</span> <span class="n">t</span> <span class="err">⊆</span> <span class="n">interior</span> <span class="n">C</span> <span class="o">:</span> <span class="n">ht</span><span class="bp">.</span><span class="mi">2</span>
                 <span class="bp">...</span> <span class="err">⊆</span> <span class="n">C</span> <span class="o">:</span> <span class="n">interior_subset</span>
    <span class="kn">end</span> <span class="o">}</span>

<span class="c">/-</span><span class="cm">- Given `r &gt; 0`, any cniset can be shrunk so as to have diameter `≤ r`:</span>
<span class="cm">    simply pick a point in the interior and intersect with the `r/2`-ball around it. -/</span>
<span class="n">def</span> <span class="n">cofinal_of_radius</span> <span class="o">(</span><span class="n">r</span> <span class="o">:</span> <span class="n">ℝ</span><span class="o">)</span> <span class="o">(</span><span class="n">rpos</span> <span class="o">:</span> <span class="n">r</span> <span class="bp">&gt;</span> <span class="mi">0</span><span class="o">)</span> <span class="o">:</span>
  <span class="o">{</span> <span class="n">D</span> <span class="o">:</span> <span class="n">set</span> <span class="o">(</span><span class="n">cniset</span> <span class="n">α</span><span class="o">)</span> <span class="bp">//</span> <span class="n">cofinal</span> <span class="n">D</span> <span class="o">}</span> <span class="o">:=</span>
<span class="o">{</span> <span class="n">val</span> <span class="o">:=</span> <span class="o">{</span> <span class="n">f</span> <span class="bp">|</span> <span class="bp">∀</span> <span class="o">(</span><span class="n">x</span> <span class="n">y</span> <span class="err">∈</span> <span class="n">f</span><span class="bp">.</span><span class="n">val</span><span class="o">),</span> <span class="n">dist</span> <span class="n">x</span> <span class="n">y</span> <span class="bp">≤</span> <span class="n">r</span> <span class="o">},</span>
  <span class="n">property</span> <span class="o">:=</span>
    <span class="k">begin</span>
      <span class="n">rintro</span> <span class="bp">⟨</span><span class="n">C</span><span class="o">,</span> <span class="n">hc</span><span class="o">,</span> <span class="n">nic</span><span class="bp">⟩</span><span class="o">,</span>
      <span class="n">cases</span> <span class="n">nic</span> <span class="k">with</span> <span class="n">x</span> <span class="n">hx</span><span class="o">,</span>
      <span class="n">refine</span> <span class="bp">⟨⟨</span><span class="n">C</span> <span class="err">∩</span> <span class="n">closed_ball</span> <span class="n">x</span> <span class="o">(</span><span class="n">r</span><span class="bp">/</span><span class="mi">2</span><span class="o">),</span> <span class="n">is_closed_inter</span> <span class="n">hc</span> <span class="n">is_closed_ball</span><span class="o">,</span> <span class="bp">_⟩</span><span class="o">,</span> <span class="bp">_</span><span class="o">,</span> <span class="bp">_⟩</span><span class="o">,</span>
      <span class="o">{</span> <span class="n">rw</span> <span class="n">interior_inter</span><span class="o">,</span>
        <span class="n">refine</span> <span class="bp">⟨</span><span class="n">x</span><span class="o">,</span> <span class="n">hx</span><span class="o">,</span> <span class="bp">_⟩</span><span class="o">,</span>
        <span class="n">rw</span> <span class="n">mem_interior</span><span class="o">,</span>
        <span class="n">exact</span> <span class="bp">⟨</span><span class="n">ball</span> <span class="n">x</span> <span class="o">(</span><span class="n">r</span><span class="bp">/</span><span class="mi">2</span><span class="o">),</span> <span class="n">ball_subset_closed_ball</span><span class="o">,</span> <span class="n">is_open_ball</span><span class="o">,</span>
          <span class="n">mem_ball_self</span> <span class="err">$</span> <span class="n">half_pos</span> <span class="n">rpos</span><span class="bp">⟩</span><span class="o">,</span> <span class="o">},</span>
      <span class="o">{</span> <span class="n">rintros</span> <span class="n">a</span> <span class="n">b</span> <span class="bp">⟨_</span><span class="o">,</span> <span class="n">ha</span><span class="bp">⟩</span> <span class="bp">⟨_</span><span class="o">,</span> <span class="n">hb</span><span class="bp">⟩</span><span class="o">,</span>
        <span class="k">calc</span> <span class="n">dist</span> <span class="n">a</span> <span class="n">b</span> <span class="bp">≤</span> <span class="n">dist</span> <span class="n">a</span> <span class="n">x</span> <span class="bp">+</span> <span class="n">dist</span> <span class="n">b</span> <span class="n">x</span> <span class="o">:</span> <span class="n">dist_triangle_right</span> <span class="bp">_</span> <span class="bp">_</span> <span class="bp">_</span>
                  <span class="bp">...</span> <span class="bp">≤</span> <span class="n">r</span><span class="bp">/</span><span class="mi">2</span> <span class="bp">+</span> <span class="n">r</span><span class="bp">/</span><span class="mi">2</span>           <span class="o">:</span> <span class="n">add_le_add</span> <span class="n">ha</span> <span class="n">hb</span>
                  <span class="bp">...</span> <span class="bp">=</span> <span class="n">r</span>                   <span class="o">:</span> <span class="n">add_halves</span> <span class="n">r</span> <span class="o">},</span>
      <span class="n">apply</span> <span class="n">inter_subset_left</span><span class="o">,</span>
    <span class="kn">end</span> <span class="o">}</span>

<span class="kn">variables</span> <span class="o">{</span><span class="n">ι</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">encodable</span> <span class="n">ι</span><span class="o">]</span> <span class="o">(</span><span class="n">ℱ</span> <span class="o">:</span> <span class="n">ι</span> <span class="bp">→</span> <span class="o">{</span> <span class="n">s</span> <span class="o">:</span> <span class="n">set</span> <span class="n">α</span> <span class="bp">//</span> <span class="n">is_open</span> <span class="n">s</span> <span class="bp">∧</span> <span class="n">closure</span> <span class="n">s</span> <span class="bp">=</span> <span class="n">univ</span> <span class="o">})</span>

<span class="n">noncomputable</span> <span class="n">def</span> <span class="n">cofinal_family</span> <span class="o">:</span> <span class="n">ι</span> <span class="err">⊕</span> <span class="bp">ℕ</span> <span class="bp">→</span> <span class="o">{</span> <span class="n">D</span> <span class="o">:</span> <span class="n">set</span> <span class="o">(</span><span class="n">cniset</span> <span class="n">α</span><span class="o">)</span> <span class="bp">//</span> <span class="n">cofinal</span> <span class="n">D</span> <span class="o">}</span>
<span class="bp">|</span> <span class="o">(</span><span class="n">sum</span><span class="bp">.</span><span class="n">inl</span> <span class="n">i</span><span class="o">)</span> <span class="o">:=</span> <span class="n">cofinal_of_dense</span> <span class="o">(</span><span class="n">ℱ</span> <span class="n">i</span><span class="o">)</span><span class="bp">.</span><span class="n">val</span> <span class="o">(</span><span class="n">ℱ</span> <span class="n">i</span><span class="o">)</span><span class="bp">.</span><span class="n">property</span><span class="bp">.</span><span class="mi">1</span> <span class="o">(</span><span class="n">ℱ</span> <span class="n">i</span><span class="o">)</span><span class="bp">.</span><span class="n">property</span><span class="bp">.</span><span class="mi">2</span>
<span class="bp">|</span> <span class="o">(</span><span class="n">sum</span><span class="bp">.</span><span class="n">inr</span> <span class="n">n</span><span class="o">)</span> <span class="o">:=</span> <span class="n">cofinal_of_radius</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">/</span> <span class="o">(</span><span class="n">n</span><span class="bp">+</span><span class="mi">1</span><span class="o">))</span> <span class="n">nat</span><span class="bp">.</span><span class="n">one_div_pos_of_nat</span>

<span class="kn">variable</span> <span class="o">(</span><span class="n">st</span> <span class="o">:</span> <span class="n">cniset</span> <span class="n">α</span><span class="o">)</span>

<span class="n">def</span> <span class="n">gencof</span> <span class="o">:</span> <span class="n">set</span> <span class="o">(</span><span class="n">cniset</span> <span class="n">α</span><span class="o">)</span> <span class="o">:=</span> <span class="n">generic</span><span class="bp">.</span><span class="n">cofilter</span> <span class="n">st</span> <span class="err">$</span> <span class="n">cofinal_family</span> <span class="n">ℱ</span>

<span class="n">def</span> <span class="n">filt</span> <span class="o">:</span> <span class="n">filter</span> <span class="n">α</span> <span class="o">:=</span>
<span class="o">{</span> <span class="n">sets</span> <span class="o">:=</span> <span class="o">{</span> <span class="n">x</span> <span class="bp">|</span> <span class="bp">∃</span> <span class="n">y</span> <span class="err">∈</span> <span class="n">gencof</span> <span class="n">ℱ</span> <span class="n">st</span><span class="o">,</span> <span class="n">subtype</span><span class="bp">.</span><span class="n">val</span> <span class="n">y</span> <span class="err">⊆</span> <span class="n">x</span> <span class="o">},</span>
  <span class="n">univ_sets</span> <span class="o">:=</span> <span class="bp">⟨</span><span class="n">st</span><span class="o">,</span> <span class="n">generic</span><span class="bp">.</span><span class="n">starting_point_mem</span> <span class="n">st</span> <span class="bp">_</span><span class="o">,</span> <span class="n">subset_univ</span> <span class="bp">_⟩</span><span class="o">,</span>
  <span class="n">sets_of_superset</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">x</span> <span class="n">x&#39;</span> <span class="bp">⟨</span><span class="n">y</span><span class="o">,</span> <span class="n">hy</span><span class="o">,</span> <span class="n">hyx</span><span class="bp">⟩</span> <span class="n">hs</span><span class="o">,</span> <span class="bp">⟨</span><span class="n">y</span><span class="o">,</span> <span class="n">hy</span><span class="o">,</span> <span class="n">subset</span><span class="bp">.</span><span class="n">trans</span> <span class="n">hyx</span> <span class="n">hs</span><span class="bp">⟩</span><span class="o">,</span>
  <span class="n">inter_sets</span> <span class="o">:=</span>
    <span class="k">begin</span>
      <span class="n">rintros</span> <span class="n">x</span> <span class="n">x&#39;</span> <span class="bp">⟨</span><span class="n">y</span><span class="o">,</span> <span class="n">hy</span><span class="o">,</span> <span class="n">hyx</span><span class="bp">⟩</span> <span class="bp">⟨</span><span class="n">y&#39;</span><span class="o">,</span> <span class="n">hy&#39;</span><span class="o">,</span> <span class="n">hyx&#39;</span><span class="bp">⟩</span><span class="o">,</span>
      <span class="n">rcases</span> <span class="n">generic</span><span class="bp">.</span><span class="n">directed_on</span> <span class="n">st</span> <span class="o">(</span><span class="n">cofinal_family</span> <span class="n">ℱ</span><span class="o">)</span> <span class="n">y</span> <span class="n">hy</span> <span class="n">y&#39;</span> <span class="n">hy&#39;</span> <span class="k">with</span> <span class="bp">⟨</span><span class="n">z</span><span class="o">,</span> <span class="n">hz</span><span class="o">,</span> <span class="n">hzy</span><span class="o">,</span> <span class="n">hzy&#39;</span><span class="bp">⟩</span><span class="o">,</span>
      <span class="n">refine</span> <span class="bp">⟨</span><span class="n">z</span><span class="o">,</span> <span class="n">hz</span><span class="o">,</span> <span class="bp">_⟩</span><span class="o">,</span>
      <span class="k">calc</span> <span class="n">z</span><span class="bp">.</span><span class="n">val</span> <span class="err">⊆</span> <span class="n">y</span><span class="bp">.</span><span class="n">val</span> <span class="err">∩</span> <span class="n">y&#39;</span><span class="bp">.</span><span class="n">val</span> <span class="o">:</span> <span class="n">subset_inter</span> <span class="n">hzy</span> <span class="n">hzy&#39;</span>
             <span class="bp">...</span> <span class="err">⊆</span> <span class="n">x</span>     <span class="err">∩</span> <span class="n">x&#39;</span>     <span class="o">:</span> <span class="n">inter_subset_inter</span> <span class="n">hyx</span> <span class="n">hyx&#39;</span>
    <span class="kn">end</span> <span class="o">}</span>

<span class="kn">lemma</span> <span class="n">filt</span><span class="bp">.</span><span class="n">cauchy</span> <span class="o">:</span> <span class="n">cauchy</span> <span class="o">(</span><span class="n">filt</span> <span class="n">ℱ</span> <span class="n">st</span><span class="o">)</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="n">rw</span> <span class="n">metric</span><span class="bp">.</span><span class="n">cauchy_iff</span><span class="o">,</span>
  <span class="n">split</span><span class="o">,</span>
  <span class="o">{</span> <span class="n">suffices</span> <span class="o">:</span> <span class="bp">¬</span> <span class="err">∅</span> <span class="err">∈</span> <span class="n">filt</span> <span class="n">ℱ</span> <span class="n">st</span><span class="o">,</span>
    <span class="o">{</span> <span class="n">intro</span> <span class="n">h</span><span class="o">,</span>
      <span class="n">rw</span> <span class="n">h</span> <span class="n">at</span> <span class="n">this</span><span class="o">,</span>
      <span class="n">tauto</span><span class="o">,</span> <span class="o">},</span>
    <span class="n">rintros</span> <span class="bp">⟨</span><span class="n">y</span><span class="o">,</span> <span class="n">hy</span><span class="o">,</span> <span class="n">h</span><span class="bp">⟩</span><span class="o">,</span>
    <span class="n">cases</span> <span class="n">y</span><span class="bp">.</span><span class="n">property</span><span class="bp">.</span><span class="mi">2</span> <span class="k">with</span> <span class="n">w</span> <span class="n">hw</span><span class="o">,</span>
    <span class="n">exact</span> <span class="n">h</span> <span class="o">(</span><span class="n">interior_subset</span> <span class="n">hw</span><span class="o">),</span> <span class="o">},</span>
  <span class="n">intros</span> <span class="n">ε</span> <span class="n">epos</span><span class="o">,</span>
  <span class="n">cases</span> <span class="n">exists_nat_one_div_lt</span> <span class="n">epos</span> <span class="k">with</span> <span class="n">n</span> <span class="n">nh</span><span class="o">,</span>
  <span class="n">rcases</span> <span class="n">generic</span><span class="bp">.</span><span class="n">meets</span> <span class="n">st</span> <span class="o">(</span><span class="n">cofinal_family</span> <span class="n">ℱ</span><span class="o">)</span> <span class="o">(</span><span class="n">sum</span><span class="bp">.</span><span class="n">inr</span> <span class="n">n</span><span class="o">)</span> <span class="k">with</span> <span class="bp">⟨</span><span class="n">y</span><span class="o">,</span> <span class="n">hy</span><span class="o">,</span> <span class="n">hyn</span><span class="bp">⟩</span><span class="o">,</span>
  <span class="n">refine</span> <span class="bp">⟨</span><span class="n">y</span><span class="bp">.</span><span class="n">val</span><span class="o">,</span> <span class="bp">⟨</span><span class="n">y</span><span class="o">,</span> <span class="n">hy</span><span class="o">,</span> <span class="n">subset</span><span class="bp">.</span><span class="n">refl</span> <span class="bp">_⟩</span><span class="o">,</span> <span class="bp">_⟩</span><span class="o">,</span>
  <span class="n">intros</span> <span class="n">a</span> <span class="n">b</span> <span class="n">ha</span> <span class="n">hb</span><span class="o">,</span>
  <span class="k">calc</span> <span class="n">dist</span> <span class="n">a</span> <span class="n">b</span> <span class="bp">≤</span> <span class="mi">1</span> <span class="bp">/</span> <span class="o">(</span><span class="n">n</span><span class="bp">+</span><span class="mi">1</span><span class="o">)</span> <span class="o">:</span> <span class="n">hyn</span> <span class="n">a</span> <span class="n">b</span> <span class="n">ha</span> <span class="n">hb</span>
            <span class="bp">...</span> <span class="bp">&lt;</span> <span class="n">ε</span>         <span class="o">:</span> <span class="n">nh</span>
<span class="kn">end</span>

<span class="kn">variable</span> <span class="o">[</span><span class="n">complete_space</span> <span class="n">α</span><span class="o">]</span>

<span class="kn">theorem</span> <span class="n">baire&#39;</span> <span class="o">:</span> <span class="o">(</span><span class="n">st</span><span class="bp">.</span><span class="n">val</span> <span class="err">∩</span> <span class="err">⋂</span> <span class="n">i</span><span class="o">,</span> <span class="o">(</span><span class="n">ℱ</span> <span class="n">i</span><span class="o">)</span><span class="bp">.</span><span class="n">val</span><span class="o">)</span><span class="bp">.</span><span class="n">nonempty</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="n">cases</span> <span class="n">complete_space</span><span class="bp">.</span><span class="n">complete</span> <span class="o">(</span><span class="n">filt</span><span class="bp">.</span><span class="n">cauchy</span> <span class="n">ℱ</span> <span class="n">st</span><span class="o">)</span> <span class="k">with</span> <span class="n">x</span> <span class="n">hx</span><span class="o">,</span>
  <span class="n">refine</span> <span class="bp">⟨</span><span class="n">x</span><span class="o">,</span> <span class="bp">_</span><span class="o">,</span> <span class="bp">_⟩</span><span class="o">,</span>
  <span class="o">{</span> <span class="n">apply</span> <span class="n">mem_of_closed_of_tendsto</span> <span class="o">(</span><span class="n">filt</span><span class="bp">.</span><span class="n">cauchy</span> <span class="n">ℱ</span> <span class="n">st</span><span class="o">)</span><span class="bp">.</span><span class="mi">1</span> <span class="n">hx</span> <span class="n">st</span><span class="bp">.</span><span class="n">property</span><span class="bp">.</span><span class="mi">1</span><span class="o">,</span>
    <span class="n">refine</span> <span class="bp">⟨_</span><span class="o">,</span> <span class="bp">_</span><span class="o">,</span> <span class="n">subset</span><span class="bp">.</span><span class="n">refl</span> <span class="bp">_⟩</span><span class="o">,</span>
    <span class="n">apply</span> <span class="n">generic</span><span class="bp">.</span><span class="n">starting_point_mem</span><span class="o">,</span> <span class="o">},</span>
  <span class="o">{</span> <span class="n">rw</span> <span class="n">mem_Inter</span><span class="o">,</span>
    <span class="n">intro</span> <span class="n">i</span><span class="o">,</span>
    <span class="n">rcases</span> <span class="n">generic</span><span class="bp">.</span><span class="n">meets</span> <span class="n">st</span> <span class="o">(</span><span class="n">cofinal_family</span> <span class="n">ℱ</span><span class="o">)</span> <span class="o">(</span><span class="n">sum</span><span class="bp">.</span><span class="n">inl</span> <span class="n">i</span><span class="o">)</span>
      <span class="k">with</span> <span class="bp">⟨</span><span class="n">C</span><span class="o">,</span> <span class="n">C_cf</span><span class="o">,</span> <span class="n">hc</span><span class="bp">⟩</span><span class="o">,</span>
    <span class="n">apply</span> <span class="n">hc</span><span class="o">,</span>
    <span class="n">apply</span> <span class="n">mem_of_closed_of_tendsto</span> <span class="o">(</span><span class="n">filt</span><span class="bp">.</span><span class="n">cauchy</span> <span class="n">ℱ</span> <span class="n">st</span><span class="o">)</span><span class="bp">.</span><span class="mi">1</span> <span class="n">hx</span> <span class="n">C</span><span class="bp">.</span><span class="n">property</span><span class="bp">.</span><span class="mi">1</span><span class="o">,</span>
    <span class="n">exact</span> <span class="bp">⟨_</span><span class="o">,</span> <span class="n">C_cf</span><span class="o">,</span> <span class="n">subset</span><span class="bp">.</span><span class="n">refl</span> <span class="bp">_⟩</span><span class="o">,</span> <span class="o">},</span>
<span class="kn">end</span>
</code></pre></div>


<p>I am curious about what people think of this style of proof! Do we have something like this in mathlib already?</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>