---
layout: archive
title: Zulip Chat Archive
permalink: /stream/116395-maths/topic/Using.20linarith.20with.20my.20own.20class.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/116395-maths/index.html">maths</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Using.20linarith.20with.20my.20own.20class.html">Using linarith with my own class</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="217459182"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Using%20linarith%20with%20my%20own%20class/near/217459182" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gihan Marasingha <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Using.20linarith.20with.20my.20own.20class.html#217459182">(Nov 20 2020 at 21:10)</a>:</h4>
<p>For teaching real numbers to my first-year undergraduates, I've written a class that contains the real number axioms and have used this to prove all the necessary basic results (<code>x*0 = 0</code>, no zero-divisors, uniqueness of supremum, the Archimedean property, etc.). I'd like to use this class for developing further facts (e.g. existence of square root of 2, results on convergence of sequences), but I can see this will be painful without <code>linarith</code>.</p>
<p>What do I need to do to use <code>linarith</code> with my own class?</p>



<a name="217460987"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Using%20linarith%20with%20my%20own%20class/near/217460987" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Using.20linarith.20with.20my.20own.20class.html#217460987">(Nov 20 2020 at 21:26)</a>:</h4>
<p>You probably need an instance from your class to <code>comm_ring</code>.</p>



<a name="217461008"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Using%20linarith%20with%20my%20own%20class/near/217461008" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Shing Tak Lam <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Using.20linarith.20with.20my.20own.20class.html#217461008">(Nov 20 2020 at 21:26)</a>:</h4>
<p>The <a href="https://leanprover-community.github.io/mathlib_docs/tactics.html#linarith">tactic docs</a> seem to suggest you need a <a href="https://leanprover-community.github.io/mathlib_docs/algebra/ordered_ring.html#linear_ordered_comm_ring"><code>linear_ordered_comm_ring</code></a> instance</p>



<a name="217461275"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Using%20linarith%20with%20my%20own%20class/near/217461275" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Using.20linarith.20with.20my.20own.20class.html#217461275">(Nov 20 2020 at 21:29)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">tactic</span>

<span class="kd">example</span> <span class="o">(</span><span class="n">R</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">)</span> <span class="o">[</span><span class="n">linear_ordered_comm_ring</span> <span class="n">R</span><span class="o">]</span>
  <span class="o">(</span><span class="n">x</span> <span class="n">y</span> <span class="o">:</span> <span class="n">R</span><span class="o">)</span> <span class="o">(</span><span class="n">h1</span> <span class="o">:</span> <span class="n">x</span> <span class="bp">&lt;</span> <span class="n">y</span> <span class="bp">+</span> <span class="mi">3</span><span class="o">)</span> <span class="o">:</span> <span class="n">x</span> <span class="bp">+</span> <span class="mi">3</span> <span class="bp">≤</span> <span class="n">y</span> <span class="bp">+</span> <span class="mi">7</span> <span class="o">:=</span>
<span class="kd">by</span> <span class="n">linarith</span>
</code></pre></div>
<p>works. I will grumpily comment that <code>linarith</code> doesn't work on <code>pnat</code>, as I discovered to my mild irritation at Xena yesterday :-)</p>



<a name="217461700"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Using%20linarith%20with%20my%20own%20class/near/217461700" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gihan Marasingha <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Using.20linarith.20with.20my.20own.20class.html#217461700">(Nov 20 2020 at 21:33)</a>:</h4>
<p>OK, I'll have a go at that but I'm not sure about proving the decidable instances.</p>



<a name="217461808"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Using%20linarith%20with%20my%20own%20class/near/217461808" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Using.20linarith.20with.20my.20own.20class.html#217461808">(Nov 20 2020 at 21:34)</a>:</h4>
<p>You can use <a href="https://leanprover-community.github.io/mathlib_docs/find/classical.prop_decidable">docs#classical.prop_decidable</a> for those.</p>



<a name="217462304"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Using%20linarith%20with%20my%20own%20class/near/217462304" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Using.20linarith.20with.20my.20own.20class.html#217462304">(Nov 20 2020 at 21:39)</a>:</h4>
<p>A nice way to do these things is to slowly build up from the basics.</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">class</span> <span class="n">linear_ordered_comm_ring</span> <span class="o">(</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">)</span> <span class="kd">extends</span> <span class="n">linear_ordered_ring</span> <span class="n">α</span><span class="o">,</span> <span class="n">comm_monoid</span> <span class="n">α</span>
</code></pre></div>
<p>so before you prove it's a <code>linear_ordered_comm_ring</code> you should prove it's a <code>linear_ordered_ring</code> and a <code>comm_monoid</code>, and keep working backwards like this until you find stuff which is true from the axioms you've assumed. The entire natural number game was built from me trying to find the most exotic structure which the naturals was (probably it's a linearly ordered semiring or whatever) and then just unravelling all the definitions of everything -- this approach informed which order I should be doing everything in.</p>



<a name="217470237"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Using%20linarith%20with%20my%20own%20class/near/217470237" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gihan Marasingha <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Using.20linarith.20with.20my.20own.20class.html#217470237">(Nov 20 2020 at 23:09)</a>:</h4>
<p>I have everything working except trying to get an instance of <code>mul_pos</code>. Though I've written a lemma <code>mul_pos'</code> that I think does the right thing,  when I try to use this to get the instance, I receive an error message,</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">type</span> <span class="n">mismatch</span> <span class="n">at</span> <span class="n">field</span> <span class="bp">'</span><span class="n">mul_pos'</span>
  <span class="n">mul_pos'</span>
<span class="n">has</span> <span class="n">type</span>
  <span class="bp">∀</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="o">:</span> <span class="bp">?</span><span class="n">m_1</span><span class="o">),</span> <span class="mi">0</span> <span class="bp">&lt;</span> <span class="n">a</span> <span class="bp">→</span> <span class="mi">0</span> <span class="bp">&lt;</span> <span class="n">b</span> <span class="bp">→</span> <span class="mi">0</span> <span class="bp">&lt;</span> <span class="n">a</span> <span class="bp">*</span> <span class="n">b</span>
<span class="n">but</span> <span class="n">is</span> <span class="n">expected</span> <span class="n">to</span> <span class="k">have</span> <span class="n">type</span>
  <span class="bp">∀</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="o">:</span> <span class="n">R</span><span class="o">),</span> <span class="mi">0</span> <span class="bp">&lt;</span> <span class="n">a</span> <span class="bp">→</span> <span class="mi">0</span> <span class="bp">&lt;</span> <span class="n">b</span> <span class="bp">→</span> <span class="mi">0</span> <span class="bp">&lt;</span> <span class="n">a</span> <span class="bp">*</span> <span class="n">b</span>
</code></pre></div>
<p>I could post the code but it's about 700 lines up to this point. Any suggestions or pointers are appreciated!</p>



<a name="217470597"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Using%20linarith%20with%20my%20own%20class/near/217470597" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Using.20linarith.20with.20my.20own.20class.html#217470597">(Nov 20 2020 at 23:14)</a>:</h4>
<p>My guess is <code>mul_pos'</code> has an extra type class assumption, maybe unintended? <code>#check @mul_pos'</code> and show the state where you're trying to use it?</p>



<a name="217470683"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Using%20linarith%20with%20my%20own%20class/near/217470683" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gihan Marasingha <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Using.20linarith.20with.20my.20own.20class.html#217470683">(Nov 20 2020 at 23:15)</a>:</h4>
<p>Ah yes, I have</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">mul_pos'</span> <span class="o">:</span> <span class="bp">∀</span> <span class="o">{</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u_1</span><span class="o">}</span> <span class="o">[</span><span class="n">_inst_1</span> <span class="o">:</span> <span class="n">ordered_semiring</span> <span class="n">α</span><span class="o">]</span> <span class="o">{</span><span class="n">a</span> <span class="n">b</span> <span class="o">:</span> <span class="n">α</span><span class="o">},</span> <span class="mi">0</span> <span class="bp">&lt;</span> <span class="n">a</span> <span class="bp">→</span> <span class="mi">0</span> <span class="bp">&lt;</span> <span class="n">b</span> <span class="bp">→</span> <span class="mi">0</span> <span class="bp">&lt;</span> <span class="n">a</span> <span class="bp">*</span> <span class="n">b</span>
</code></pre></div>



<a name="217470976"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Using%20linarith%20with%20my%20own%20class/near/217470976" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gihan Marasingha <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Using.20linarith.20with.20my.20own.20class.html#217470976">(Nov 20 2020 at 23:19)</a>:</h4>
<p>Oh no, that was a mathlib function. I've renamed mine to <code>bob</code> to avoid confusion. I have</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">bob</span> <span class="o">:</span> <span class="bp">∀</span> <span class="o">{</span><span class="n">R</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">}</span> <span class="o">[</span><span class="n">_inst_1</span> <span class="o">:</span> <span class="n">myordered_field</span> <span class="n">R</span><span class="o">]</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="o">:</span> <span class="n">R</span><span class="o">),</span> <span class="mi">0</span> <span class="bp">&lt;</span> <span class="n">a</span> <span class="bp">→</span> <span class="mi">0</span> <span class="bp">&lt;</span> <span class="n">b</span> <span class="bp">→</span> <span class="mi">0</span> <span class="bp">&lt;</span> <span class="n">a</span> <span class="bp">*</span> <span class="n">b</span>
</code></pre></div>



<a name="217471083"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Using%20linarith%20with%20my%20own%20class/near/217471083" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Using.20linarith.20with.20my.20own.20class.html#217471083">(Nov 20 2020 at 23:20)</a>:</h4>
<p>What's the context and goal when you try to apply <code>bob</code>?</p>



<a name="217471123"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Using%20linarith%20with%20my%20own%20class/near/217471123" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gihan Marasingha <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Using.20linarith.20with.20my.20own.20class.html#217471123">(Nov 20 2020 at 23:20)</a>:</h4>
<p>This isn't in a tactic state, it's when I'm trying to do</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">instance</span> <span class="o">:</span> <span class="n">linear_ordered_comm_ring</span> <span class="n">R</span> <span class="o">:=</span>
<span class="o">{</span> <span class="n">add</span> <span class="o">:=</span> <span class="n">comm_group'.add</span><span class="o">,</span>
  <span class="n">add_assoc</span> <span class="o">:=</span> <span class="n">comm_group'.add_assoc</span><span class="o">,</span>
  <span class="n">zero</span> <span class="o">:=</span> <span class="n">comm_group'.zero</span><span class="o">,</span>
  <span class="n">zero_add</span> <span class="o">:=</span> <span class="n">zero_add</span><span class="o">,</span>
  <span class="n">add_zero</span> <span class="o">:=</span> <span class="n">add_zero</span><span class="o">,</span>
  <span class="n">neg</span> <span class="o">:=</span> <span class="n">comm_group'.neg</span><span class="o">,</span>
  <span class="n">add_left_neg</span> <span class="o">:=</span> <span class="n">neg_add</span><span class="o">,</span>
  <span class="n">add_comm</span> <span class="o">:=</span> <span class="n">comm_group'.add_comm</span><span class="o">,</span>
  <span class="n">mul</span> <span class="o">:=</span> <span class="n">myfield.mul</span><span class="o">,</span>
  <span class="n">mul_assoc</span> <span class="o">:=</span> <span class="n">myfield.mul_assoc</span><span class="o">,</span>
  <span class="n">one</span> <span class="o">:=</span> <span class="n">myfield.one</span><span class="o">,</span>
  <span class="n">one_mul</span> <span class="o">:=</span> <span class="n">one_mul</span><span class="o">,</span>
  <span class="n">mul_one</span> <span class="o">:=</span> <span class="n">myfield.mul_one</span><span class="o">,</span>
  <span class="n">left_distrib</span> <span class="o">:=</span> <span class="n">myfield.mul_add</span><span class="o">,</span>
  <span class="n">right_distrib</span> <span class="o">:=</span> <span class="n">add_mul</span><span class="o">,</span>
  <span class="n">le</span> <span class="o">:=</span> <span class="n">le</span><span class="o">,</span>
  <span class="n">le_refl</span> <span class="o">:=</span> <span class="n">le_refl</span><span class="o">,</span>
  <span class="n">le_trans</span> <span class="o">:=</span> <span class="n">le_trans</span><span class="o">,</span>
  <span class="n">le_antisymm</span> <span class="o">:=</span> <span class="n">anti_symm</span><span class="o">,</span>
  <span class="n">add_le_add_left</span> <span class="o">:=</span> <span class="n">add_le_add_left</span><span class="o">,</span>
  <span class="n">zero_ne_one</span> <span class="o">:=</span> <span class="n">myfield.zero_ne_one</span><span class="o">,</span>
  <span class="n">mul_pos</span> <span class="o">:=</span> <span class="n">bob</span><span class="o">,</span>
  <span class="n">le_total</span> <span class="o">:=</span> <span class="n">le_total</span><span class="o">,</span>
  <span class="n">zero_lt_one</span> <span class="o">:=</span> <span class="n">zero_lt_one</span><span class="o">,</span>
  <span class="n">mul_comm</span> <span class="o">:=</span> <span class="n">myfield.mul_comm</span><span class="o">,</span>

<span class="o">}</span>
</code></pre></div>



<a name="217471154"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Using%20linarith%20with%20my%20own%20class/near/217471154" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gihan Marasingha <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Using.20linarith.20with.20my.20own.20class.html#217471154">(Nov 20 2020 at 23:21)</a>:</h4>
<p><code>bob</code> works fine by itself.</p>



<a name="217471212"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Using%20linarith%20with%20my%20own%20class/near/217471212" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Using.20linarith.20with.20my.20own.20class.html#217471212">(Nov 20 2020 at 23:22)</a>:</h4>
<p>Oh, so it's working now?</p>



<a name="217471279"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Using%20linarith%20with%20my%20own%20class/near/217471279" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gihan Marasingha <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Using.20linarith.20with.20my.20own.20class.html#217471279">(Nov 20 2020 at 23:23)</a>:</h4>
<p>Well it doesn't work the sense that when I type the above code to try to show <code>R</code> is an instance of <code>linear_ordered_comm_ring</code>, I get the error message</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">type</span> <span class="n">mismatch</span> <span class="n">at</span> <span class="n">field</span> <span class="bp">'</span><span class="n">mul_pos'</span>
  <span class="n">bob</span>
<span class="n">has</span> <span class="n">type</span>
  <span class="bp">∀</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="o">:</span> <span class="bp">?</span><span class="n">m_1</span><span class="o">),</span> <span class="mi">0</span> <span class="bp">&lt;</span> <span class="n">a</span> <span class="bp">→</span> <span class="mi">0</span> <span class="bp">&lt;</span> <span class="n">b</span> <span class="bp">→</span> <span class="mi">0</span> <span class="bp">&lt;</span> <span class="n">a</span> <span class="bp">*</span> <span class="n">b</span>
<span class="n">but</span> <span class="n">is</span> <span class="n">expected</span> <span class="n">to</span> <span class="k">have</span> <span class="n">type</span>
  <span class="bp">∀</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="o">:</span> <span class="n">R</span><span class="o">),</span> <span class="mi">0</span> <span class="bp">&lt;</span> <span class="n">a</span> <span class="bp">→</span> <span class="mi">0</span> <span class="bp">&lt;</span> <span class="n">b</span> <span class="bp">→</span> <span class="mi">0</span> <span class="bp">&lt;</span> <span class="n">a</span> <span class="bp">*</span> <span class="n">b</span>
</code></pre></div>



<a name="217471356"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Using%20linarith%20with%20my%20own%20class/near/217471356" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Using.20linarith.20with.20my.20own.20class.html#217471356">(Nov 20 2020 at 23:24)</a>:</h4>
<p>with <code>pp.all</code>?</p>



<a name="217471379"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Using%20linarith%20with%20my%20own%20class/near/217471379" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Using.20linarith.20with.20my.20own.20class.html#217471379">(Nov 20 2020 at 23:25)</a>:</h4>
<p>Okay, replace <code>mul_pos := bob,</code> with <code>mul_pos := _,</code> and show us the output. That's the context and goal at that point.</p>



<a name="217471395"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Using%20linarith%20with%20my%20own%20class/near/217471395" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Using.20linarith.20with.20my.20own.20class.html#217471395">(Nov 20 2020 at 23:25)</a>:</h4>
<p>Maybe <code>R</code> is <code>Type *</code> instead of <code>Type</code>?</p>



<a name="217471910"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Using%20linarith%20with%20my%20own%20class/near/217471910" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gihan Marasingha <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Using.20linarith.20with.20my.20own.20class.html#217471910">(Nov 20 2020 at 23:32)</a>:</h4>
<p>When I put in <code>mul_pos := _</code>, the only text in the Infoview window is:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">type</span> <span class="n">mismatch</span> <span class="n">at</span> <span class="n">field</span> <span class="bp">'</span><span class="n">mul_pos'</span>
  <span class="n">bob</span> <span class="bp">?</span><span class="n">m_3</span>
<span class="n">has</span> <span class="n">type</span>
  <span class="bp">∀</span> <span class="o">(</span><span class="n">b</span> <span class="o">:</span> <span class="bp">?</span><span class="n">m_1</span><span class="o">),</span> <span class="mi">0</span> <span class="bp">&lt;</span> <span class="bp">?</span><span class="n">m_3</span> <span class="bp">→</span> <span class="mi">0</span> <span class="bp">&lt;</span> <span class="n">b</span> <span class="bp">→</span> <span class="mi">0</span> <span class="bp">&lt;</span> <span class="bp">?</span><span class="n">m_3</span> <span class="bp">*</span> <span class="n">b</span>
<span class="n">but</span> <span class="n">is</span> <span class="n">expected</span> <span class="n">to</span> <span class="k">have</span> <span class="n">type</span>
  <span class="bp">∀</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="o">:</span> <span class="n">R</span><span class="o">),</span> <span class="mi">0</span> <span class="bp">&lt;</span> <span class="n">a</span> <span class="bp">→</span> <span class="mi">0</span> <span class="bp">&lt;</span> <span class="n">b</span> <span class="bp">→</span> <span class="mi">0</span> <span class="bp">&lt;</span> <span class="n">a</span> <span class="bp">*</span> <span class="n">b</span>
</code></pre></div>
<p>I have <code>variables {R : Type} [myordered_field R]</code>.</p>



<a name="217471991"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Using%20linarith%20with%20my%20own%20class/near/217471991" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gihan Marasingha <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Using.20linarith.20with.20my.20own.20class.html#217471991">(Nov 20 2020 at 23:33)</a>:</h4>
<p>And with <code>pp.all</code>, it's:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">type</span> <span class="n">mismatch</span> <span class="n">at</span> <span class="n">field</span> <span class="bp">'</span><span class="n">mul_pos'</span>
  <span class="bp">@</span><span class="n">mth1001.myreal.bob</span> <span class="bp">?</span><span class="n">m_1</span> <span class="bp">?</span><span class="n">m_2</span> <span class="bp">?</span><span class="n">m_3</span>
<span class="n">has</span> <span class="n">type</span>
  <span class="bp">∀</span> <span class="o">(</span><span class="n">b</span> <span class="o">:</span> <span class="bp">?</span><span class="n">m_1</span><span class="o">),</span>
    <span class="bp">@</span><span class="n">has_lt.lt.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="bp">?</span><span class="n">m_1</span> <span class="o">(</span><span class="bp">@</span><span class="n">mth1001.myreal.has_lt</span> <span class="bp">?</span><span class="n">m_1</span> <span class="bp">?</span><span class="n">m_2</span><span class="o">)</span>
      <span class="o">(</span><span class="bp">@</span><span class="n">has_zero.zero.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="bp">?</span><span class="n">m_1</span>
         <span class="o">(</span><span class="bp">@</span><span class="n">mth1001.myreal.has_zero.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="bp">?</span><span class="n">m_1</span>
            <span class="o">(</span><span class="bp">@</span><span class="n">mth1001.myreal.myfield.to_comm_group'.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="bp">?</span><span class="n">m_1</span> <span class="o">(</span><span class="bp">@</span><span class="n">mth1001.myreal.myordered_field.to_myfield</span> <span class="bp">?</span><span class="n">m_1</span> <span class="bp">?</span><span class="n">m_2</span><span class="o">))))</span>
      <span class="bp">?</span><span class="n">m_3</span> <span class="bp">→</span>
    <span class="bp">@</span><span class="n">has_lt.lt.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="bp">?</span><span class="n">m_1</span> <span class="o">(</span><span class="bp">@</span><span class="n">mth1001.myreal.has_lt</span> <span class="bp">?</span><span class="n">m_1</span> <span class="bp">?</span><span class="n">m_2</span><span class="o">)</span>
      <span class="o">(</span><span class="bp">@</span><span class="n">has_zero.zero.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="bp">?</span><span class="n">m_1</span>
         <span class="o">(</span><span class="bp">@</span><span class="n">mth1001.myreal.has_zero.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="bp">?</span><span class="n">m_1</span>
            <span class="o">(</span><span class="bp">@</span><span class="n">mth1001.myreal.myfield.to_comm_group'.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="bp">?</span><span class="n">m_1</span> <span class="o">(</span><span class="bp">@</span><span class="n">mth1001.myreal.myordered_field.to_myfield</span> <span class="bp">?</span><span class="n">m_1</span> <span class="bp">?</span><span class="n">m_2</span><span class="o">))))</span>
      <span class="n">b</span> <span class="bp">→</span>
    <span class="bp">@</span><span class="n">has_lt.lt.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="bp">?</span><span class="n">m_1</span> <span class="o">(</span><span class="bp">@</span><span class="n">mth1001.myreal.has_lt</span> <span class="bp">?</span><span class="n">m_1</span> <span class="bp">?</span><span class="n">m_2</span><span class="o">)</span>
      <span class="o">(</span><span class="bp">@</span><span class="n">has_zero.zero.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="bp">?</span><span class="n">m_1</span>
         <span class="o">(</span><span class="bp">@</span><span class="n">mth1001.myreal.has_zero.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="bp">?</span><span class="n">m_1</span>
            <span class="o">(</span><span class="bp">@</span><span class="n">mth1001.myreal.myfield.to_comm_group'.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="bp">?</span><span class="n">m_1</span> <span class="o">(</span><span class="bp">@</span><span class="n">mth1001.myreal.myordered_field.to_myfield</span> <span class="bp">?</span><span class="n">m_1</span> <span class="bp">?</span><span class="n">m_2</span><span class="o">))))</span>
      <span class="o">(</span><span class="bp">@</span><span class="n">has_mul.mul.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="bp">?</span><span class="n">m_1</span> <span class="o">(</span><span class="bp">@</span><span class="n">mth1001.myreal.has_mul</span> <span class="bp">?</span><span class="n">m_1</span> <span class="o">(</span><span class="bp">@</span><span class="n">mth1001.myreal.myordered_field.to_myfield</span> <span class="bp">?</span><span class="n">m_1</span> <span class="bp">?</span><span class="n">m_2</span><span class="o">))</span> <span class="bp">?</span><span class="n">m_3</span>
         <span class="n">b</span><span class="o">)</span>
<span class="n">but</span> <span class="n">is</span> <span class="n">expected</span> <span class="n">to</span> <span class="k">have</span> <span class="n">type</span>
  <span class="bp">∀</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="o">:</span> <span class="n">R</span><span class="o">),</span>
    <span class="bp">@</span><span class="n">has_lt.lt.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">R</span>
      <span class="o">(</span><span class="bp">@</span><span class="n">preorder.to_has_lt.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">R</span>
         <span class="o">(</span><span class="bp">@</span><span class="n">partial_order.to_preorder.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">R</span>
            <span class="o">(</span><span class="bp">@</span><span class="n">ordered_add_comm_group.to_partial_order.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">R</span>
               <span class="o">(</span><span class="bp">@</span><span class="n">ordered_add_comm_group.mk.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">R</span>
                  <span class="o">(</span><span class="bp">@</span><span class="n">mth1001.myreal.comm_group'.add.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">R</span>
                     <span class="o">(</span><span class="bp">@</span><span class="n">mth1001.myreal.myfield.to_comm_group'.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">R</span>
                        <span class="o">(</span><span class="bp">@</span><span class="n">mth1001.myreal.myordered_field.to_myfield</span> <span class="n">R</span> <span class="n">_inst_1</span><span class="o">)))</span>
                  <span class="o">(</span><span class="bp">@</span><span class="n">mth1001.myreal.comm_group'.add_assoc.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">R</span>
                     <span class="o">(</span><span class="bp">@</span><span class="n">mth1001.myreal.myfield.to_comm_group'.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">R</span>
                        <span class="o">(</span><span class="bp">@</span><span class="n">mth1001.myreal.myordered_field.to_myfield</span> <span class="n">R</span> <span class="n">_inst_1</span><span class="o">)))</span>
                  <span class="o">(</span><span class="bp">@</span><span class="n">mth1001.myreal.comm_group'.zero.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">R</span>
                     <span class="o">(</span><span class="bp">@</span><span class="n">mth1001.myreal.myfield.to_comm_group'.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">R</span>
<span class="c">/-</span><span class="cm"> Plus many more lines -/</span>
</code></pre></div>



<a name="217472106"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Using%20linarith%20with%20my%20own%20class/near/217472106" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Using.20linarith.20with.20my.20own.20class.html#217472106">(Nov 20 2020 at 23:35)</a>:</h4>
<p>That looks like you've put in <code>mul_pos := bob _</code>, not <code>mul_pos := _</code>.</p>



<a name="217472124"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Using%20linarith%20with%20my%20own%20class/near/217472124" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Using.20linarith.20with.20my.20own.20class.html#217472124">(Nov 20 2020 at 23:35)</a>:</h4>
<p>But now my guess is, you have two different <code>&lt;</code> instances.</p>



<a name="217472178"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Using%20linarith%20with%20my%20own%20class/near/217472178" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Using.20linarith.20with.20my.20own.20class.html#217472178">(Nov 20 2020 at 23:36)</a>:</h4>
<p>Maybe different <code>*</code> instances but <code>&lt;</code> seems more likely.</p>



<a name="217472320"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Using%20linarith%20with%20my%20own%20class/near/217472320" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gihan Marasingha <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Using.20linarith.20with.20my.20own.20class.html#217472320">(Nov 20 2020 at 23:38)</a>:</h4>
<p>Oh thanks! I misread what you wrote. The context and goal are:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">context</span><span class="o">:</span>
<span class="n">R</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">,</span>
<span class="n">_inst_1</span> <span class="o">:</span> <span class="n">myordered_field</span> <span class="n">R</span>
<span class="bp">⊢</span> <span class="bp">∀</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="o">:</span> <span class="n">R</span><span class="o">),</span>
    <span class="n">ordered_add_comm_group.lt</span> <span class="mi">0</span> <span class="n">a</span> <span class="bp">→</span> <span class="n">ordered_add_comm_group.lt</span> <span class="mi">0</span> <span class="n">b</span> <span class="bp">→</span> <span class="n">ordered_add_comm_group.lt</span> <span class="mi">0</span> <span class="o">(</span><span class="n">a</span> <span class="bp">*</span> <span class="n">b</span><span class="o">)</span>
</code></pre></div>



<a name="217472366"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Using%20linarith%20with%20my%20own%20class/near/217472366" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Using.20linarith.20with.20my.20own.20class.html#217472366">(Nov 20 2020 at 23:39)</a>:</h4>
<blockquote>
<p><code>_inst_1 : myordered_field R</code></p>
</blockquote>
<p>this looks suspicious</p>



<a name="217472387"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Using%20linarith%20with%20my%20own%20class/near/217472387" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Using.20linarith.20with.20my.20own.20class.html#217472387">(Nov 20 2020 at 23:39)</a>:</h4>
<p>you are constructing a ring instance, why is a field instance already in the context?</p>



<a name="217472755"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Using%20linarith%20with%20my%20own%20class/near/217472755" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gihan Marasingha <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Using.20linarith.20with.20my.20own.20class.html#217472755">(Nov 20 2020 at 23:45)</a>:</h4>
<p>Perhaps I'm going about this entirely the wrong way, but I've created a hierarchy of classes, <code>comm_group'</code>, <code>myfield, </code>myordered_field<code>, </code>myreal_field<code>. I'm trying to show, given
</code>variables {R : Type} [myordered_field R]<code> that </code>R<code> is an instance of </code>linear_ordered_comm_ring`.</p>



<a name="217472775"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Using%20linarith%20with%20my%20own%20class/near/217472775" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Using.20linarith.20with.20my.20own.20class.html#217472775">(Nov 20 2020 at 23:45)</a>:</h4>
<p>Ah, now I'm on board with Rob's idea too. I see <code>mth1001.myreal.has_lt</code> so apparently you have a <code>has_lt</code> instance, but you didn't supply it in the big structure instance (there is no <code>lt := (&lt;)</code> in the list)</p>



<a name="217473240"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Using%20linarith%20with%20my%20own%20class/near/217473240" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gihan Marasingha <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Using.20linarith.20with.20my.20own.20class.html#217473240">(Nov 20 2020 at 23:52)</a>:</h4>
<p>OK. I added <code>lt := lt'</code> to the list. This gives the error message</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">exact</span> <span class="n">tactic</span> <span class="n">failed</span><span class="o">,</span> <span class="n">type</span> <span class="n">mismatch</span><span class="o">,</span> <span class="n">given</span> <span class="n">expression</span> <span class="n">has</span> <span class="n">type</span>
  <span class="bp">?</span><span class="n">m_1</span> <span class="bp">↔</span> <span class="bp">?</span><span class="n">m_1</span>
<span class="n">but</span> <span class="n">is</span> <span class="n">expected</span> <span class="n">to</span> <span class="k">have</span> <span class="n">type</span>
  <span class="n">a</span> <span class="bp">&lt;</span> <span class="n">b</span> <span class="bp">↔</span> <span class="n">a</span> <span class="bp">≤</span> <span class="n">b</span> <span class="bp">∧</span> <span class="bp">¬</span><span class="n">b</span> <span class="bp">≤</span> <span class="n">a</span>
</code></pre></div>
<p>Is this because my definition <code>lt'</code> is actually <code>λ {R : Type} [_inst_1 : myordered_field R] (x y : R), myordered_field.pos (y - x)</code>?</p>



<a name="217474060"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Using%20linarith%20with%20my%20own%20class/near/217474060" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Using.20linarith.20with.20my.20own.20class.html#217474060">(Nov 21 2020 at 00:04)</a>:</h4>
<p>You need to provide the field <code>lt_iff_le_not_le</code> now too</p>



<a name="217475015"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Using%20linarith%20with%20my%20own%20class/near/217475015" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gihan Marasingha <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Using.20linarith.20with.20my.20own.20class.html#217475015">(Nov 21 2020 at 00:21)</a>:</h4>
<p>Thanks everyone for your help. This works now!</p>



<a name="217475256"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Using%20linarith%20with%20my%20own%20class/near/217475256" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Using.20linarith.20with.20my.20own.20class.html#217475256">(Nov 21 2020 at 00:26)</a>:</h4>
<p>Like I said, instead of trying to build it all at once, it's much easier to build all the instances from the very bottom :-)</p>



<a name="217475303"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Using%20linarith%20with%20my%20own%20class/near/217475303" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Using.20linarith.20with.20my.20own.20class.html#217475303">(Nov 21 2020 at 00:27)</a>:</h4>
<p>Then you can use the <code>..</code> trick.</p>



<a name="217475376"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Using%20linarith%20with%20my%20own%20class/near/217475376" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gihan Marasingha <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Using.20linarith.20with.20my.20own.20class.html#217475376">(Nov 21 2020 at 00:28)</a>:</h4>
<p>Oooh, what's the <code>..</code> trick?</p>



<a name="217477765"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Using%20linarith%20with%20my%20own%20class/near/217477765" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Using.20linarith.20with.20my.20own.20class.html#217477765">(Nov 21 2020 at 01:19)</a>:</h4>
<p>Basically, if you're constructing a structure of type <code>T</code> and <code>p : U</code> where <code>T extends U</code>, you can use <code>.. p</code> within the curly braces to fill in missing fields from <code>p</code>. There's a brief mention in TPiL <a href="https://leanprover.github.io/theorem_proving_in_lean/structures_and_records.html#objects">here</a>.</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>