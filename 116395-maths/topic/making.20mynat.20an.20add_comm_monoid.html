---
layout: archive
title: Zulip Chat Archive
permalink: /stream/116395-maths/topic/making.20mynat.20an.20add_comm_monoid.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/116395-maths/index.html">maths</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/making.20mynat.20an.20add_comm_monoid.html">making mynat an add_comm_monoid</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="169527348"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/making%20mynat%20an%20add_comm_monoid/near/169527348" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/making.20mynat.20an.20add_comm_monoid.html#169527348">(Jul 02 2019 at 23:21)</a>:</h4>
<p>I was trying to prove that a home-rolled <code>nat</code> was an <code>add_comm_monoid</code>  in a way which was maximally mathematician-friendly, e.g. no leakage of <code>le</code> or <code>zero</code>: <a href="https://gist.github.com/kbuzzard/bec5f90d5e0a012696420f0f2430bedb" target="_blank" title="https://gist.github.com/kbuzzard/bec5f90d5e0a012696420f0f2430bedb">see gist</a>.</p>
<p>My understanding of how Lean works is that I am supposed to come up with a canonical representative for things like mynat.zero -- I choose <code>0</code>, and similarly I choose <code>1</code> for <code>one</code>. That's right, right?</p>
<p>On line 56 I have a <code>zero</code> which is something I never really wanted to see again. Is there a more high-powered tactic which will preserve my choice for <code>0</code> as the "canonical representative" of <code>mynat.zero</code>? </p>
<p>Is there a tactic that makes that instance on line 77 by just matching on names?</p>
<p>Finally lines 142 and 146 -- what is the incantation which makes these? I am so bad at making structures. Let's say that you must make an instance of <code>add_semigroup mynat</code> before you make the instance of <code>add_comm_semigroup mynat</code>.</p>



<a name="169539180"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/making%20mynat%20an%20add_comm_monoid/near/169539180" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Keeley Hoek <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/making.20mynat.20an.20add_comm_monoid.html#169539180">(Jul 03 2019 at 04:49)</a>:</h4>
<p>Kevin I think your <code>by common_sense</code> actually is a pretty easily makable tactic</p>



<a name="169539182"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/making%20mynat%20an%20add_comm_monoid/near/169539182" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Keeley Hoek <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/making.20mynat.20an.20add_comm_monoid.html#169539182">(Jul 03 2019 at 04:49)</a>:</h4>
<p>I'll give it a go</p>



<a name="169539788"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/making%20mynat%20an%20add_comm_monoid/near/169539788" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Keeley Hoek <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/making.20mynat.20an.20add_comm_monoid.html#169539788">(Jul 03 2019 at 05:07)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="bp">...</span>

<span class="kn">end</span> <span class="n">mynat</span>

<span class="kn">namespace</span> <span class="n">tactic</span><span class="bp">.</span><span class="n">interactive</span>
<span class="kn">open</span> <span class="n">tactic</span>

<span class="n">meta</span> <span class="n">def</span> <span class="n">replace_special_names</span> <span class="o">:</span> <span class="n">name</span> <span class="bp">→</span> <span class="n">name</span>
<span class="bp">|</span> <span class="bp">`</span><span class="n">add</span> <span class="o">:=</span> <span class="bp">`</span><span class="n">has_add</span><span class="bp">.</span><span class="n">add</span>
<span class="bp">|</span> <span class="n">n</span> <span class="o">:=</span> <span class="n">n</span>

<span class="n">meta</span> <span class="n">def</span> <span class="n">common_sense</span> <span class="o">:</span> <span class="n">tactic</span> <span class="n">unit</span> <span class="o">:=</span>
<span class="n">do</span> <span class="n">t</span> <span class="err">←</span> <span class="n">target</span><span class="o">,</span>
   <span class="n">env</span> <span class="err">←</span> <span class="n">get_env</span><span class="o">,</span>
   <span class="k">match</span> <span class="n">t</span> <span class="k">with</span>
   <span class="bp">|</span> <span class="n">expr</span><span class="bp">.</span><span class="n">app</span> <span class="o">(</span><span class="n">expr</span><span class="bp">.</span><span class="n">const</span> <span class="n">sn</span> <span class="bp">_</span><span class="o">)</span> <span class="n">e</span> <span class="o">:=</span>
    <span class="k">match</span> <span class="n">env</span><span class="bp">.</span><span class="n">structure_fields</span> <span class="n">sn</span> <span class="k">with</span>
    <span class="bp">|</span> <span class="n">some</span> <span class="n">l</span> <span class="o">:=</span>
    <span class="n">do</span> <span class="n">n</span> <span class="bp">::</span> <span class="bp">_</span> <span class="err">←</span> <span class="n">tactic</span><span class="bp">.</span><span class="n">open_namespaces</span><span class="o">,</span>
       <span class="k">let</span> <span class="n">lf</span> <span class="o">:=</span> <span class="n">l</span><span class="bp">.</span><span class="n">map</span> <span class="n">replace_special_names</span><span class="o">,</span>
       <span class="n">v</span> <span class="err">←</span> <span class="n">lf</span><span class="bp">.</span><span class="n">mmap</span> <span class="n">resolve_name</span><span class="o">,</span>
       <span class="k">let</span> <span class="n">s</span> <span class="o">:</span> <span class="n">structure_instance_info</span> <span class="o">:=</span> <span class="o">{</span>
           <span class="n">struct</span> <span class="o">:=</span> <span class="n">some</span> <span class="n">sn</span><span class="o">,</span>
           <span class="n">field_names</span> <span class="o">:=</span> <span class="n">l</span><span class="o">,</span>
           <span class="n">field_values</span> <span class="o">:=</span> <span class="n">v</span><span class="o">,</span>
       <span class="o">},</span>
       <span class="n">e</span> <span class="err">←</span> <span class="n">to_expr</span> <span class="err">$</span> <span class="n">pexpr</span><span class="bp">.</span><span class="n">mk_structure_instance</span> <span class="n">s</span><span class="o">,</span>
       <span class="n">tactic</span><span class="bp">.</span><span class="n">exact</span> <span class="n">e</span>
    <span class="bp">|</span> <span class="n">none</span> <span class="o">:=</span> <span class="n">fail</span> <span class="s2">&quot;goal not a structure&quot;</span>
    <span class="kn">end</span>
   <span class="bp">|</span> <span class="bp">_</span> <span class="o">:=</span> <span class="n">fail</span> <span class="s2">&quot;unsupported goal&quot;</span>
   <span class="kn">end</span>

<span class="kn">end</span> <span class="n">tactic</span><span class="bp">.</span><span class="n">interactive</span>

<span class="kn">namespace</span> <span class="n">mynat</span>

<span class="kn">instance</span> <span class="o">:</span> <span class="n">add_monoid</span> <span class="n">mynat</span> <span class="o">:=</span> <span class="k">by</span> <span class="n">common_sense</span>

<span class="bp">...</span>
</pre></div>



<a name="169544326"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/making%20mynat%20an%20add_comm_monoid/near/169544326" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/making.20mynat.20an.20add_comm_monoid.html#169544326">(Jul 03 2019 at 07:00)</a>:</h4>
<p>It works! Thanks! I hate making structures. I will use it forever.</p>



<a name="169544666"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/making%20mynat%20an%20add_comm_monoid/near/169544666" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/making.20mynat.20an.20add_comm_monoid.html#169544666">(Jul 03 2019 at 07:08)</a>:</h4>
<p>Oh this is great. I have no clue how you're supposed to prove that <code>mynat</code> is a <code>comm_semiring</code>. You seem to have to perform the incantations all in exactly the right order in the official way to do it. This way I can just not even care. I went to the end of my multiplication file and typed <code>instance : comm_semiring mynat := by common_sense</code> and it just gave me a list of the fields for which it has failed and what the error messages were for each. I can then just make them at the end of my multiplication file as part of an api. This is <em>brilliant</em>. </p>
<p>It's sort-of an idiot-proof structure maker.</p>



<a name="169554653"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/making%20mynat%20an%20add_comm_monoid/near/169554653" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/making.20mynat.20an.20add_comm_monoid.html#169554653">(Jul 03 2019 at 10:21)</a>:</h4>
<p>Can we have this in mathlib? Maybe called <code>structure_helper</code>?</p>



<a name="169558300"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/making%20mynat%20an%20add_comm_monoid/near/169558300" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/making.20mynat.20an.20add_comm_monoid.html#169558300">(Jul 03 2019 at 11:34)</a>:</h4>
<p>Kevin, could you post an updated gist using this tactic? It would make this conversation easier to understand</p>



<a name="169565725"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/making%20mynat%20an%20add_comm_monoid/near/169565725" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/making.20mynat.20an.20add_comm_monoid.html#169565725">(Jul 03 2019 at 13:25)</a>:</h4>
<p><a href="https://gist.github.com/kbuzzard/73237dbb64e70c482404d3780a4483c1" target="_blank" title="https://gist.github.com/kbuzzard/73237dbb64e70c482404d3780a4483c1">Structure tactic</a></p>
<p><a href="https://gist.github.com/kbuzzard/bec5f90d5e0a012696420f0f2430bedb" target="_blank" title="https://gist.github.com/kbuzzard/bec5f90d5e0a012696420f0f2430bedb">add_comm_monoid nat</a></p>



<a name="169567680"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/making%20mynat%20an%20add_comm_monoid/near/169567680" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/making.20mynat.20an.20add_comm_monoid.html#169567680">(Jul 03 2019 at 13:49)</a>:</h4>
<p>Nice! I hope mathlib's naming convention won't interfere with merging this useful tactic</p>



<a name="169570909"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/making%20mynat%20an%20add_comm_monoid/near/169570909" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/making.20mynat.20an.20add_comm_monoid.html#169570909">(Jul 03 2019 at 14:26)</a>:</h4>
<p><span class="user-mention" data-user-id="110111">@Keeley Hoek</span> </p>
<p>I can't make preorders because they have this weird <code>lt_iff_not_le</code> field.</p>
<div class="codehilite"><pre><span></span><span class="kn">set_option</span> <span class="n">auto_param</span><span class="bp">.</span><span class="n">check_exists</span> <span class="n">false</span>
<span class="n">class</span> <span class="n">preorder</span> <span class="o">(</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">)</span> <span class="kn">extends</span> <span class="n">has_le</span> <span class="n">α</span><span class="o">,</span> <span class="n">has_lt</span> <span class="n">α</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">le_refl</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">a</span> <span class="o">:</span> <span class="n">α</span><span class="o">,</span> <span class="n">a</span> <span class="bp">≤</span> <span class="n">a</span><span class="o">)</span>
<span class="o">(</span><span class="n">le_trans</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="o">:</span> <span class="n">α</span><span class="o">,</span> <span class="n">a</span> <span class="bp">≤</span> <span class="n">b</span> <span class="bp">→</span> <span class="n">b</span> <span class="bp">≤</span> <span class="n">c</span> <span class="bp">→</span> <span class="n">a</span> <span class="bp">≤</span> <span class="n">c</span><span class="o">)</span>
<span class="o">(</span><span class="n">lt</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">a</span> <span class="n">b</span><span class="o">,</span> <span class="n">a</span> <span class="bp">≤</span> <span class="n">b</span> <span class="bp">∧</span> <span class="bp">¬</span> <span class="n">b</span> <span class="bp">≤</span> <span class="n">a</span><span class="o">)</span>
<span class="o">(</span><span class="n">lt_iff_le_not_le</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">a</span> <span class="n">b</span> <span class="o">:</span> <span class="n">α</span><span class="o">,</span> <span class="n">a</span> <span class="bp">&lt;</span> <span class="n">b</span> <span class="bp">↔</span> <span class="o">(</span><span class="n">a</span> <span class="bp">≤</span> <span class="n">b</span> <span class="bp">∧</span> <span class="bp">¬</span> <span class="n">b</span> <span class="bp">≤</span> <span class="n">a</span><span class="o">)</span> <span class="bp">.</span> <span class="n">order_laws_tac</span><span class="o">)</span>
</pre></div>


<p>I just want to not define <code>lt</code> or <code>lt_iff_le_not_le</code></p>
<div class="codehilite"><pre><span></span><span class="c1">-- import the tactic</span>
<span class="kn">inductive</span> <span class="n">mynat</span> <span class="o">:</span> <span class="kt">Type</span>

<span class="kn">namespace</span> <span class="n">mynat</span>

<span class="n">def</span> <span class="n">le</span> <span class="o">:</span> <span class="n">mynat</span> <span class="bp">→</span> <span class="n">mynat</span> <span class="bp">→</span> <span class="kt">Prop</span> <span class="o">:=</span> <span class="n">sorry</span>
<span class="kn">instance</span> <span class="o">:</span> <span class="n">has_le</span> <span class="n">mynat</span> <span class="o">:=</span> <span class="bp">⟨</span><span class="n">le</span><span class="bp">⟩</span>
<span class="n">def</span> <span class="n">le_refl</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">a</span> <span class="o">:</span> <span class="n">mynat</span><span class="o">,</span> <span class="n">a</span> <span class="bp">≤</span> <span class="n">a</span> <span class="o">:=</span> <span class="n">sorry</span>
<span class="c1">-- I think a,b,c should be implicit but Lean doesn&#39;t</span>
<span class="n">def</span> <span class="n">le_trans</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="o">:</span> <span class="n">mynat</span><span class="o">,</span> <span class="n">a</span> <span class="bp">≤</span> <span class="n">b</span> <span class="bp">→</span> <span class="n">b</span> <span class="bp">≤</span> <span class="n">c</span> <span class="bp">→</span> <span class="n">a</span> <span class="bp">≤</span> <span class="n">c</span> <span class="o">:=</span> <span class="n">sorry</span>

<span class="c1">--instance : preorder mynat := by i_checked_all_teh_axioms -- fails</span>
<span class="c1">-- unknown identifier &#39;lt&#39;</span>

<span class="n">def</span> <span class="n">lt</span> <span class="o">:</span> <span class="n">mynat</span> <span class="bp">→</span> <span class="n">mynat</span> <span class="bp">→</span> <span class="kt">Prop</span> <span class="o">:=</span>  <span class="bp">λ</span> <span class="n">a</span> <span class="n">b</span><span class="o">,</span> <span class="n">a</span> <span class="bp">≤</span> <span class="n">b</span> <span class="bp">∧</span> <span class="bp">¬</span> <span class="n">b</span> <span class="bp">≤</span> <span class="n">a</span>

<span class="c1">-- instance : preorder mynat := by i_checked_all_teh_axioms -- fails</span>
<span class="c">/-</span><span class="cm"></span>
<span class="cm">type mismatch at field &#39;lt_iff_le_not_le&#39;</span>
<span class="cm">  lt_iff_le_not_le</span>
<span class="cm">has type</span>
<span class="cm">  ?m_3 &lt; ?m_4 ↔ ?m_3 ≤ ?m_4 ∧ ¬?m_4 ≤ ?m_3</span>
<span class="cm">but is expected to have type</span>
<span class="cm">  auto_param (∀ (a b : mynat), a &lt; b ↔ a ≤ b ∧ ¬b ≤ a) (name.mk_string &quot;order_laws_tac&quot; name.anonymous)</span>
<span class="cm">-/</span>

<span class="kn">end</span> <span class="n">mynat</span>
<span class="c">/-</span><span class="cm"></span>
<span class="cm">class preorder (α : Type u) extends has_le α, has_lt α :=</span>
<span class="cm">(le_refl : ∀ a : α, a ≤ a)</span>
<span class="cm">(le_trans : ∀ a b c : α, a ≤ b → b ≤ c → a ≤ c)</span>
<span class="cm">(lt := λ a b, a ≤ b ∧ ¬ b ≤ a)</span>
<span class="cm">(lt_iff_le_not_le : ∀ a b : α, a &lt; b ↔ (a ≤ b ∧ ¬ b ≤ a) . order_laws_tac)</span>
<span class="cm">-/</span>
</pre></div>



<a name="169571250"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/making%20mynat%20an%20add_comm_monoid/near/169571250" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/making.20mynat.20an.20add_comm_monoid.html#169571250">(Jul 03 2019 at 14:30)</a>:</h4>
<p>Ah, we'll have to add something that checks if a field is wrapped with <code>auto_param</code>, and then tries running the embedded tactic.</p>



<a name="169571347"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/making%20mynat%20an%20add_comm_monoid/near/169571347" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/making.20mynat.20an.20add_comm_monoid.html#169571347">(Jul 03 2019 at 14:31)</a>:</h4>
<p>or <code>opt_param</code> in the case of <code>lt</code></p>



<a name="169572735"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/making%20mynat%20an%20add_comm_monoid/near/169572735" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Andrew Ashworth <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/making.20mynat.20an.20add_comm_monoid.html#169572735">(Jul 03 2019 at 14:47)</a>:</h4>
<p>hmm, wasn't there a hole tactic that did this as well that I saw posted awhile back? I may be misremembering</p>



<a name="169572917"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/making%20mynat%20an%20add_comm_monoid/near/169572917" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/making.20mynat.20an.20add_comm_monoid.html#169572917">(Jul 03 2019 at 14:48)</a>:</h4>
<p>Do you mean <a href="https://github.com/leanprover-community/mathlib/blob/d001abfd48d64ac27310590458132009f47c852d/src/tactic/core.lean#L718" target="_blank" title="https://github.com/leanprover-community/mathlib/blob/d001abfd48d64ac27310590458132009f47c852d/src/tactic/core.lean#L718">https://github.com/leanprover-community/mathlib/blob/d001abfd48d64ac27310590458132009f47c852d/src/tactic/core.lean#L718</a>? It's slightly different</p>



<a name="169573027"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/making%20mynat%20an%20add_comm_monoid/near/169573027" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Andrew Ashworth <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/making.20mynat.20an.20add_comm_monoid.html#169573027">(Jul 03 2019 at 14:50)</a>:</h4>
<p>ah, I think that is what I was thinking of</p>



<a name="169573853"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/making%20mynat%20an%20add_comm_monoid/near/169573853" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/making.20mynat.20an.20add_comm_monoid.html#169573853">(Jul 03 2019 at 14:59)</a>:</h4>
<p>I just want to not even bother defining <code>lt</code> and <code>lt_iff_le_not_le</code> here</p>



<a name="169574950"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/making%20mynat%20an%20add_comm_monoid/near/169574950" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/making.20mynat.20an.20add_comm_monoid.html#169574950">(Jul 03 2019 at 15:11)</a>:</h4>
<p>Yes, that's what we're proposing. Keeley's tactic should be able to identify <code>opt_param</code> or <code>auto_param</code> fields, and handle them automatically.</p>



<a name="169584033"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/making%20mynat%20an%20add_comm_monoid/near/169584033" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Keeley Hoek <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/making.20mynat.20an.20add_comm_monoid.html#169584033">(Jul 03 2019 at 17:05)</a>:</h4>
<p>I'm glad it helped! Yes this should be easy to fix...</p>



<a name="169584426"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/making%20mynat%20an%20add_comm_monoid/near/169584426" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Keeley Hoek <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/making.20mynat.20an.20add_comm_monoid.html#169584426">(Jul 03 2019 at 17:10)</a>:</h4>
<p>Oh hmm turns out it's a bit yuck...</p>



<a name="169584457"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/making%20mynat%20an%20add_comm_monoid/near/169584457" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/making.20mynat.20an.20add_comm_monoid.html#169584457">(Jul 03 2019 at 17:11)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="kn">instance</span> <span class="o">:</span> <span class="n">canonically_ordered_comm_semiring</span> <span class="n">mynat</span> <span class="o">:=</span>
<span class="o">{</span> <span class="n">add</span> <span class="o">:=</span> <span class="o">(</span><span class="bp">+</span><span class="o">),</span>
  <span class="n">add_assoc</span> <span class="o">:=</span> <span class="n">add_assoc</span><span class="o">,</span>
  <span class="n">zero</span> <span class="o">:=</span> <span class="mi">0</span><span class="o">,</span>
  <span class="n">zero_add</span> <span class="o">:=</span> <span class="n">zero_add</span><span class="o">,</span>
  <span class="n">add_zero</span> <span class="o">:=</span> <span class="n">add_zero</span><span class="o">,</span>
  <span class="n">add_comm</span> <span class="o">:=</span> <span class="n">add_comm</span><span class="o">,</span>
  <span class="n">le</span> <span class="o">:=</span> <span class="o">(</span><span class="bp">≤</span><span class="o">),</span>
  <span class="n">le_refl</span> <span class="o">:=</span> <span class="n">le_refl</span><span class="o">,</span>
  <span class="n">le_trans</span> <span class="o">:=</span> <span class="n">le_trans</span><span class="o">,</span>
  <span class="n">le_antisymm</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">a</span> <span class="n">b</span><span class="o">,</span> <span class="n">le_antisymm</span><span class="o">,</span>
  <span class="n">add_le_add_left</span> <span class="o">:=</span> <span class="n">add_le_add_left</span><span class="o">,</span>
  <span class="n">lt_of_add_lt_add_left</span> <span class="o">:=</span> <span class="n">lt_if_add_lt_add_left</span><span class="o">,</span>
  <span class="n">bot</span> <span class="o">:=</span> <span class="bp">_</span><span class="o">,</span>
  <span class="n">bot_le</span> <span class="o">:=</span> <span class="n">bot_le</span><span class="o">,</span>
  <span class="n">le_iff_exists_add</span> <span class="o">:=</span> <span class="n">le_iff_exists_add</span><span class="o">,</span>
  <span class="n">mul</span> <span class="o">:=</span> <span class="o">(</span><span class="bp">*</span><span class="o">),</span>
  <span class="n">mul_assoc</span> <span class="o">:=</span> <span class="n">mul_assoc</span><span class="o">,</span>
  <span class="n">one</span> <span class="o">:=</span> <span class="mi">1</span><span class="o">,</span>
  <span class="n">one_mul</span> <span class="o">:=</span> <span class="n">one_mul</span><span class="o">,</span>
  <span class="n">mul_one</span> <span class="o">:=</span> <span class="n">mul_one</span><span class="o">,</span>
  <span class="n">left_distrib</span> <span class="o">:=</span> <span class="n">left_distrib</span><span class="o">,</span>
  <span class="n">right_distrib</span> <span class="o">:=</span> <span class="n">right_distrib</span><span class="o">,</span>
  <span class="n">zero_mul</span> <span class="o">:=</span> <span class="n">zero_mul</span><span class="o">,</span>
  <span class="n">mul_zero</span> <span class="o">:=</span> <span class="bp">_</span><span class="o">,</span>
  <span class="n">mul_comm</span> <span class="o">:=</span> <span class="bp">_</span><span class="o">,</span>
  <span class="n">zero_ne_one</span> <span class="o">:=</span> <span class="bp">_</span><span class="o">,</span>
  <span class="n">mul_eq_zero_iff</span> <span class="o">:=</span> <span class="bp">_</span> <span class="o">}</span>
</pre></div>


<p>Also yuck.</p>



<a name="169586591"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/making%20mynat%20an%20add_comm_monoid/near/169586591" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Keeley Hoek <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/making.20mynat.20an.20add_comm_monoid.html#169586591">(Jul 03 2019 at 17:37)</a>:</h4>
<p>ha! its literally 3am where I am at the moment so I'm going to throw in the towel until morning---but just one last sorried function needs filling in:</p>



<a name="169586596"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/making%20mynat%20an%20add_comm_monoid/near/169586596" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Keeley Hoek <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/making.20mynat.20an.20add_comm_monoid.html#169586596">(Jul 03 2019 at 17:37)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="kn">namespace</span> <span class="n">tactic</span><span class="bp">.</span><span class="n">interactive</span>
<span class="kn">open</span> <span class="n">tactic</span>

<span class="n">meta</span> <span class="n">def</span> <span class="n">replace_special_names</span> <span class="o">:</span> <span class="n">name</span> <span class="bp">→</span> <span class="n">name</span>
<span class="bp">|</span> <span class="bp">`</span><span class="n">add</span> <span class="o">:=</span> <span class="bp">`</span><span class="n">has_add</span><span class="bp">.</span><span class="n">add</span>
<span class="bp">|</span> <span class="n">n</span> <span class="o">:=</span> <span class="n">n</span>

<span class="n">meta</span> <span class="n">def</span> <span class="n">get_type_of_nth_arg_core</span> <span class="o">:</span> <span class="bp">ℕ</span> <span class="bp">→</span> <span class="n">expr</span> <span class="bp">→</span> <span class="n">expr</span>
<span class="bp">|</span> <span class="bp">_</span> <span class="bp">_</span> <span class="o">:=</span> <span class="n">sorry</span>

<span class="n">meta</span> <span class="n">def</span> <span class="n">get_type_of_nth_arg</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="n">name</span><span class="o">)</span> <span class="o">(</span><span class="n">k</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">)</span> <span class="o">:</span> <span class="n">tactic</span> <span class="n">expr</span> <span class="o">:=</span>
<span class="n">get_type_of_nth_arg_core</span> <span class="n">k</span> <span class="bp">&lt;</span><span class="err">$</span><span class="bp">&gt;</span> <span class="o">(</span><span class="n">resolve_name</span> <span class="n">n</span> <span class="bp">&gt;&gt;=</span> <span class="n">to_expr</span> <span class="bp">&gt;&gt;=</span> <span class="n">infer_type</span><span class="o">)</span>

<span class="n">meta</span> <span class="n">def</span> <span class="n">run_tac</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="n">expr</span><span class="o">)</span> <span class="o">:</span> <span class="n">tactic</span> <span class="n">unit</span> <span class="o">:=</span>
<span class="n">do</span> <span class="n">n</span> <span class="err">←</span> <span class="n">eval_expr</span> <span class="n">name</span> <span class="n">n</span><span class="o">,</span>
   <span class="n">e</span> <span class="err">←</span> <span class="n">resolve_name</span> <span class="n">n</span> <span class="bp">&gt;&gt;=</span> <span class="n">to_expr</span><span class="o">,</span>
   <span class="n">tac</span> <span class="err">←</span> <span class="n">eval_expr</span> <span class="o">(</span><span class="n">tactic</span> <span class="n">unit</span><span class="o">)</span> <span class="n">e</span><span class="o">,</span>
   <span class="n">tac</span>

<span class="n">meta</span> <span class="n">def</span> <span class="n">resolve_name_or_use_autoparam</span> <span class="o">(</span><span class="n">sn</span> <span class="o">:</span> <span class="n">name</span><span class="o">)</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="bp">ℕ</span> <span class="bp">×</span> <span class="n">name</span><span class="o">)</span> <span class="o">:</span> <span class="n">tactic</span> <span class="o">(</span><span class="n">name</span> <span class="bp">×</span> <span class="n">pexpr</span><span class="o">)</span> <span class="o">:=</span>
<span class="n">do</span> <span class="n">pe</span> <span class="err">←</span> <span class="n">resolve_name</span> <span class="o">(</span><span class="n">replace_special_names</span> <span class="n">n</span><span class="bp">.</span><span class="mi">2</span><span class="o">)</span> <span class="bp">&lt;|&gt;</span>
        <span class="n">do</span> <span class="o">{</span> <span class="n">t</span> <span class="o">:</span> <span class="n">expr</span> <span class="err">←</span> <span class="n">get_type_of_nth_arg</span> <span class="o">(</span><span class="n">sn</span> <span class="bp">++</span> <span class="bp">`</span><span class="n">mk</span><span class="o">)</span> <span class="n">n</span><span class="bp">.</span><span class="mi">1</span><span class="o">,</span>
             <span class="k">match</span> <span class="n">t</span> <span class="k">with</span>
             <span class="bp">|</span> <span class="bp">`</span><span class="o">(</span><span class="n">auto_param</span> <span class="err">%%</span><span class="n">t</span> <span class="err">%%</span><span class="n">tac</span><span class="o">)</span> <span class="o">:=</span>
               <span class="n">lock_tactic_state</span> <span class="err">$</span> <span class="n">do</span>
                 <span class="n">m</span> <span class="err">←</span> <span class="n">mk_meta_var</span> <span class="n">t</span><span class="o">,</span>
                 <span class="n">set_goals</span> <span class="o">[</span><span class="n">m</span><span class="o">],</span>
                 <span class="n">run_tac</span> <span class="n">tac</span><span class="o">,</span>
                 <span class="n">to_pexpr</span> <span class="bp">&lt;</span><span class="err">$</span><span class="bp">&gt;</span> <span class="n">instantiate_mvars</span> <span class="n">m</span>
             <span class="bp">|</span> <span class="bp">_</span> <span class="o">:=</span> <span class="n">failed</span>
             <span class="kn">end</span>
           <span class="o">},</span>
   <span class="n">return</span> <span class="o">(</span><span class="n">n</span><span class="bp">.</span><span class="mi">2</span><span class="o">,</span> <span class="n">pe</span><span class="o">)</span>

<span class="n">meta</span> <span class="n">def</span> <span class="n">i_checked_all_teh_axioms</span> <span class="o">:</span> <span class="n">tactic</span> <span class="n">unit</span> <span class="o">:=</span>
<span class="n">do</span> <span class="n">t</span> <span class="err">←</span> <span class="n">target</span><span class="o">,</span>
   <span class="n">env</span> <span class="err">←</span> <span class="n">get_env</span><span class="o">,</span>
   <span class="k">match</span> <span class="n">t</span> <span class="k">with</span>
   <span class="bp">|</span> <span class="n">expr</span><span class="bp">.</span><span class="n">app</span> <span class="o">(</span><span class="n">expr</span><span class="bp">.</span><span class="n">const</span> <span class="n">sn</span> <span class="bp">_</span><span class="o">)</span> <span class="n">e</span> <span class="o">:=</span>
    <span class="n">tactic</span><span class="bp">.</span><span class="n">trace</span> <span class="o">(</span><span class="n">env</span><span class="bp">.</span><span class="n">structure_fields</span> <span class="n">sn</span><span class="o">)</span> <span class="bp">&gt;&gt;</span>
    <span class="k">match</span> <span class="n">env</span><span class="bp">.</span><span class="n">structure_fields</span> <span class="n">sn</span> <span class="k">with</span>
    <span class="bp">|</span> <span class="n">some</span> <span class="n">l</span> <span class="o">:=</span>
    <span class="n">do</span> <span class="n">n</span> <span class="bp">::</span> <span class="bp">_</span> <span class="err">←</span> <span class="n">tactic</span><span class="bp">.</span><span class="n">open_namespaces</span><span class="o">,</span>
       <span class="k">let</span> <span class="n">l</span> <span class="o">:=</span> <span class="o">(</span><span class="n">list</span><span class="bp">.</span><span class="n">range</span> <span class="n">l</span><span class="bp">.</span><span class="n">length</span><span class="o">)</span><span class="bp">.</span><span class="n">zip</span> <span class="n">l</span><span class="o">,</span>
       <span class="n">v</span> <span class="err">←</span> <span class="n">l</span><span class="bp">.</span><span class="n">mfilter_map</span> <span class="err">$</span> <span class="n">resolve_name_or_use_autoparam</span> <span class="n">sn</span><span class="o">,</span>
       <span class="n">tactic</span><span class="bp">.</span><span class="n">trace</span> <span class="n">v</span><span class="o">,</span>
       <span class="k">let</span> <span class="n">s</span> <span class="o">:</span> <span class="n">structure_instance_info</span> <span class="o">:=</span> <span class="o">{</span>
           <span class="n">struct</span> <span class="o">:=</span> <span class="n">some</span> <span class="n">sn</span><span class="o">,</span>
           <span class="n">field_names</span> <span class="o">:=</span> <span class="n">v</span><span class="bp">.</span><span class="n">map</span> <span class="n">prod</span><span class="bp">.</span><span class="n">fst</span><span class="o">,</span>
           <span class="n">field_values</span> <span class="o">:=</span> <span class="n">v</span><span class="bp">.</span><span class="n">map</span> <span class="n">prod</span><span class="bp">.</span><span class="n">snd</span><span class="o">,</span>
       <span class="o">},</span>
       <span class="n">tactic</span><span class="bp">.</span><span class="n">trace</span> <span class="n">v</span><span class="o">,</span>
       <span class="n">e</span> <span class="err">←</span> <span class="n">to_expr</span> <span class="err">$</span> <span class="n">pexpr</span><span class="bp">.</span><span class="n">mk_structure_instance</span> <span class="n">s</span><span class="o">,</span>
       <span class="n">tactic</span><span class="bp">.</span><span class="n">exact</span> <span class="n">e</span>
    <span class="bp">|</span> <span class="n">none</span> <span class="o">:=</span> <span class="n">fail</span> <span class="s2">&quot;goal not a structure&quot;</span>
    <span class="kn">end</span>
   <span class="bp">|</span> <span class="bp">_</span> <span class="o">:=</span> <span class="n">fail</span> <span class="s2">&quot;unsupported goal&quot;</span>
<span class="kn">end</span>

<span class="kn">end</span> <span class="n">tactic</span><span class="bp">.</span><span class="n">interactive</span>
</pre></div>



<a name="169586723"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/making%20mynat%20an%20add_comm_monoid/near/169586723" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Keeley Hoek <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/making.20mynat.20an.20add_comm_monoid.html#169586723">(Jul 03 2019 at 17:38)</a>:</h4>
<p>haha funnily enough <code>run_tac</code> is equivalent to the ridiculous composite</p>
<div class="codehilite"><pre><span></span><span class="n">meta</span> <span class="n">def</span> <span class="n">run_tac&#39;</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="n">expr</span><span class="o">)</span> <span class="o">:</span> <span class="n">tactic</span> <span class="n">unit</span> <span class="o">:=</span>
<span class="n">do</span> <span class="n">tac</span> <span class="err">←</span> <span class="n">eval_expr</span> <span class="n">name</span> <span class="n">n</span> <span class="bp">&gt;&gt;=</span> <span class="n">resolve_name</span> <span class="bp">&gt;&gt;=</span> <span class="n">to_expr</span> <span class="bp">&gt;&gt;=</span> <span class="n">eval_expr</span> <span class="o">(</span><span class="n">tactic</span> <span class="n">unit</span><span class="o">),</span>
   <span class="n">tac</span>
</pre></div>



<a name="169587709"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/making%20mynat%20an%20add_comm_monoid/near/169587709" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/making.20mynat.20an.20add_comm_monoid.html#169587709">(Jul 03 2019 at 17:50)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="kn">instance</span> <span class="o">:</span> <span class="n">canonically_ordered_comm_semiring</span> <span class="n">mynat</span> <span class="o">:=</span>
<span class="o">{</span> <span class="n">add</span> <span class="o">:=</span> <span class="o">(</span><span class="bp">+</span><span class="o">),</span>
  <span class="n">add_assoc</span> <span class="o">:=</span> <span class="n">add_assoc</span><span class="o">,</span>
  <span class="n">zero</span> <span class="o">:=</span> <span class="mi">0</span><span class="o">,</span>
  <span class="n">zero_add</span> <span class="o">:=</span> <span class="n">zero_add</span><span class="o">,</span>
  <span class="n">add_zero</span> <span class="o">:=</span> <span class="n">add_zero</span><span class="o">,</span>
  <span class="n">add_comm</span> <span class="o">:=</span> <span class="n">add_comm</span><span class="o">,</span>
  <span class="n">le</span> <span class="o">:=</span> <span class="o">(</span><span class="bp">≤</span><span class="o">),</span>
  <span class="n">le_refl</span> <span class="o">:=</span> <span class="n">le_refl</span><span class="o">,</span>
  <span class="n">le_trans</span> <span class="o">:=</span> <span class="n">le_trans</span><span class="o">,</span>
  <span class="n">le_antisymm</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">a</span> <span class="n">b</span><span class="o">,</span> <span class="n">le_antisymm</span><span class="o">,</span>
  <span class="n">add_le_add_left</span> <span class="o">:=</span> <span class="n">add_le_add_left</span><span class="o">,</span>
  <span class="n">lt_of_add_lt_add_left</span> <span class="o">:=</span> <span class="n">lt_if_add_lt_add_left</span><span class="o">,</span>
  <span class="n">bot</span> <span class="o">:=</span> <span class="err">⊥</span><span class="o">,</span>
  <span class="n">bot_le</span> <span class="o">:=</span> <span class="n">bot_le</span><span class="o">,</span>
  <span class="n">le_iff_exists_add</span> <span class="o">:=</span> <span class="n">le_iff_exists_add</span><span class="o">,</span>
  <span class="n">mul</span> <span class="o">:=</span> <span class="o">(</span><span class="bp">*</span><span class="o">),</span>
  <span class="n">mul_assoc</span> <span class="o">:=</span> <span class="n">mul_assoc</span><span class="o">,</span>
  <span class="n">one</span> <span class="o">:=</span> <span class="mi">1</span><span class="o">,</span>
  <span class="n">one_mul</span> <span class="o">:=</span> <span class="n">one_mul</span><span class="o">,</span>
  <span class="n">mul_one</span> <span class="o">:=</span> <span class="n">mul_one</span><span class="o">,</span>
  <span class="n">left_distrib</span> <span class="o">:=</span> <span class="n">left_distrib</span><span class="o">,</span>
  <span class="n">right_distrib</span> <span class="o">:=</span> <span class="n">right_distrib</span><span class="o">,</span>
  <span class="n">zero_mul</span> <span class="o">:=</span> <span class="n">zero_mul</span><span class="o">,</span>
  <span class="n">mul_zero</span> <span class="o">:=</span> <span class="n">mul_zero</span><span class="o">,</span>
  <span class="n">mul_comm</span> <span class="o">:=</span> <span class="n">mul_comm</span><span class="o">,</span>
  <span class="n">zero_ne_one</span> <span class="o">:=</span> <span class="n">zero_ne_one</span><span class="o">,</span>
  <span class="n">mul_eq_zero_iff</span> <span class="o">:=</span> <span class="n">mul_eq_zero_iff</span> <span class="o">}</span>
</pre></div>


<p>I finished my proof.</p>



<a name="169587982"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/making%20mynat%20an%20add_comm_monoid/near/169587982" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/making.20mynat.20an.20add_comm_monoid.html#169587982">(Jul 03 2019 at 17:54)</a>:</h4>
<p>how about decidable le?</p>



<a name="169588007"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/making%20mynat%20an%20add_comm_monoid/near/169588007" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/making.20mynat.20an.20add_comm_monoid.html#169588007">(Jul 03 2019 at 17:55)</a>:</h4>
<p>Oh that's not maths, that's not in this game</p>



<a name="169588028"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/making%20mynat%20an%20add_comm_monoid/near/169588028" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/making.20mynat.20an.20add_comm_monoid.html#169588028">(Jul 03 2019 at 17:55)</a>:</h4>
<p>That is generated without telling the user</p>



<a name="169627375"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/making%20mynat%20an%20add_comm_monoid/near/169627375" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/making.20mynat.20an.20add_comm_monoid.html#169627375">(Jul 04 2019 at 07:45)</a>:</h4>
<blockquote>
<p>how about decidable le?</p>
</blockquote>
<p><code>decidable le</code> uses recursion. I am trying to box off what is done by recursion, because mathematicians put it in a different box to induction.</p>
<p>Example: one could present the natural numbers <code>mynat</code> as having two constants <code>mynat.zero</code> and <code>mynat.succ</code>, two axioms <code>mynat.zero_ne_succ</code> and <code>mynat.succ_inj</code>, and one key fact: you can use the <code>induction n</code> tactic if you have <code>n : mynat</code>. The two axioms are proved by Lean using recursion via <code>nat.rec</code>;  <code>succ_inj</code> can be proved easily using the completely artificial function <code>pred</code> which no mathematician has ever seen or uses (because it allows 0 as an input and gives the wrong answer), and <code>zero_ne_succ</code> can be proved by defining a function which sends 0 to <code>tt</code> and <code>succ n</code> to <code>ff</code>, again a function which can be defined by recursion but is of no use to us in practice.</p>
<p>If you present nat this way and present addition similarly (<code>mynat.add</code> is a constant, we will always use the <code>+</code> notation, <code>add_zero</code> and <code>add_succ</code> are axioms, don't worry about how it was defined) then one can "prove" things like the "theorem" <code>add_monoid mynat</code> (because now it <em>is</em> a theorem -- all the data has been given to you and there's only a theorem left) purely within tactic mode, by supplying tactic proofs of each of the fields in whatever order you like.</p>
<p>I am looking at what happens to <code>nat</code> if you try and isolate all the computational content and "proofs and data constructed via recursion" and just give the user an inductive principle which can only be used to construct proofs. One way of looking at it is you could say that I was trying to isolate "the bit which mathematicians like best".</p>



<a name="169635851"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/making%20mynat%20an%20add_comm_monoid/near/169635851" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Keeley Hoek <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/making.20mynat.20an.20add_comm_monoid.html#169635851">(Jul 04 2019 at 10:14)</a>:</h4>
<p>Update: it almost works, but its hard to tell when a structure has optional parameters (the "auto-param" kind is fine). It turns out that the generated constructors don't have the <code>opt_param</code> part...</p>



<a name="169635969"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/making%20mynat%20an%20add_comm_monoid/near/169635969" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Keeley Hoek <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/making.20mynat.20an.20add_comm_monoid.html#169635969">(Jul 04 2019 at 10:16)</a>:</h4>
<p>But otherwise it's a lot more robust than before now</p>



<a name="169636384"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/making%20mynat%20an%20add_comm_monoid/near/169636384" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Keeley Hoek <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/making.20mynat.20an.20add_comm_monoid.html#169636384">(Jul 04 2019 at 10:23)</a>:</h4>
<p>Okay I found a tricksy way (not intended, but I don't think there is an API for this...)</p>



<a name="169637998"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/making%20mynat%20an%20add_comm_monoid/near/169637998" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Keeley Hoek <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/making.20mynat.20an.20add_comm_monoid.html#169637998">(Jul 04 2019 at 10:48)</a>:</h4>
<p>Ok its even tricker than I thought, extra idea...</p>



<a name="169639493"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/making%20mynat%20an%20add_comm_monoid/near/169639493" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Keeley Hoek <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/making.20mynat.20an.20add_comm_monoid.html#169639493">(Jul 04 2019 at 11:13)</a>:</h4>
<p>Yeah ok I'm really struggling. There is a lot of code now, and by some tricks I can find out which fields have optional/default values, but I can't find a way to determine what the values actually are. Secretly lean knows, but I think it might not be exposed. Does anyone know of a way to find the default value of a field declared <code>opt_param</code>?</p>



<a name="169639547"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/making%20mynat%20an%20add_comm_monoid/near/169639547" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Keeley Hoek <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/making.20mynat.20an.20add_comm_monoid.html#169639547">(Jul 04 2019 at 11:14)</a>:</h4>
<p>(Sounds like this might be a job for lean 3.5.0, just need to add a function)</p>



<a name="169639731"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/making%20mynat%20an%20add_comm_monoid/near/169639731" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Keeley Hoek <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/making.20mynat.20an.20add_comm_monoid.html#169639731">(Jul 04 2019 at 11:17)</a>:</h4>
<p>Here is the current state: <a href="https://gist.github.com/khoek/b820b0b242909a22bfd3b16a046eb9de" target="_blank" title="https://gist.github.com/khoek/b820b0b242909a22bfd3b16a046eb9de">https://gist.github.com/khoek/b820b0b242909a22bfd3b16a046eb9de</a><br>
It does everything you want Kevin except for the <code>lt</code> problem.</p>



<a name="169640042"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/making%20mynat%20an%20add_comm_monoid/near/169640042" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/making.20mynat.20an.20add_comm_monoid.html#169640042">(Jul 04 2019 at 11:23)</a>:</h4>
<p><code>try_apply_opt_auto_param_for_apply</code> might help as a template. It uses</p>
<div class="codehilite"><pre><span></span><span class="n">when</span> <span class="n">cfg</span><span class="bp">.</span><span class="n">opt_param</span> <span class="o">(</span><span class="n">try</span> <span class="n">apply_opt_param</span><span class="o">)</span> <span class="bp">&gt;&gt;</span>
<span class="n">when</span> <span class="n">cfg</span><span class="bp">.</span><span class="n">auto_param</span> <span class="o">(</span><span class="n">try</span> <span class="n">apply_auto_param</span><span class="o">)</span>
</pre></div>



<a name="169640112"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/making%20mynat%20an%20add_comm_monoid/near/169640112" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/making.20mynat.20an.20add_comm_monoid.html#169640112">(Jul 04 2019 at 11:24)</a>:</h4>
<p>which are themselves implemented in lean in the obvious way</p>



<a name="169640141"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/making%20mynat%20an%20add_comm_monoid/near/169640141" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/making.20mynat.20an.20add_comm_monoid.html#169640141">(Jul 04 2019 at 11:25)</a>:</h4>
<p>but they are expecting the opt/auto_param to be the main goal, not sure if that's true in your case</p>



<a name="169650217"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/making%20mynat%20an%20add_comm_monoid/near/169650217" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Keeley Hoek <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/making.20mynat.20an.20add_comm_monoid.html#169650217">(Jul 04 2019 at 13:54)</a>:</h4>
<p>I can do the handling of those cases just fine (and that code is in the gist), the problem is that there is no way at all I can find to programmically get the <code>opt_param blah</code> associated to an optional field of a structure.</p>



<a name="169650282"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/making%20mynat%20an%20add_comm_monoid/near/169650282" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Keeley Hoek <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/making.20mynat.20an.20add_comm_monoid.html#169650282">(Jul 04 2019 at 13:55)</a>:</h4>
<p>If you make an example structure which has an optional and auto param for comparison, the autogenerated <code>.mk</code> retains the autoparam but drops the optional</p>



<a name="169650291"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/making%20mynat%20an%20add_comm_monoid/near/169650291" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/making.20mynat.20an.20add_comm_monoid.html#169650291">(Jul 04 2019 at 13:55)</a>:</h4>
<p>An optional field has the type <code>opt_param type default_value</code></p>



<a name="169650317"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/making%20mynat%20an%20add_comm_monoid/near/169650317" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Keeley Hoek <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/making.20mynat.20an.20add_comm_monoid.html#169650317">(Jul 04 2019 at 13:56)</a>:</h4>
<p>Sure, but this information is not exposed by lean</p>



<a name="169650345"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/making%20mynat%20an%20add_comm_monoid/near/169650345" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/making.20mynat.20an.20add_comm_monoid.html#169650345">(Jul 04 2019 at 13:56)</a>:</h4>
<p>it's literally in the expr</p>



<a name="169650358"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/making%20mynat%20an%20add_comm_monoid/near/169650358" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Keeley Hoek <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/making.20mynat.20an.20add_comm_monoid.html#169650358">(Jul 04 2019 at 13:56)</a>:</h4>
<p>The expr for what?</p>



<a name="169650364"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/making%20mynat%20an%20add_comm_monoid/near/169650364" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/making.20mynat.20an.20add_comm_monoid.html#169650364">(Jul 04 2019 at 13:56)</a>:</h4>
<p>the type of the projection</p>



<a name="169650378"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/making%20mynat%20an%20add_comm_monoid/near/169650378" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Keeley Hoek <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/making.20mynat.20an.20add_comm_monoid.html#169650378">(Jul 04 2019 at 13:56)</a>:</h4>
<p>oooooooh!</p>



<a name="169650454"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/making%20mynat%20an%20add_comm_monoid/near/169650454" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Keeley Hoek <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/making.20mynat.20an.20add_comm_monoid.html#169650454">(Jul 04 2019 at 13:57)</a>:</h4>
<p>Hang on</p>



<a name="169650466"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/making%20mynat%20an%20add_comm_monoid/near/169650466" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Keeley Hoek <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/making.20mynat.20an.20add_comm_monoid.html#169650466">(Jul 04 2019 at 13:57)</a>:</h4>
<div class="codehilite"><pre><span></span>run_cmd (do
  tactic.mk_const `preorder.lt &gt;&gt;= tactic.infer_type &gt;&gt;= pp &gt;&gt;= tactic.trace
)
</pre></div>



<a name="169650474"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/making%20mynat%20an%20add_comm_monoid/near/169650474" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Keeley Hoek <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/making.20mynat.20an.20add_comm_monoid.html#169650474">(Jul 04 2019 at 13:58)</a>:</h4>
<p>I don't see any reference to the <code>opt_param</code></p>



<a name="169650546"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/making%20mynat%20an%20add_comm_monoid/near/169650546" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Keeley Hoek <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/making.20mynat.20an.20add_comm_monoid.html#169650546">(Jul 04 2019 at 13:58)</a>:</h4>
<p>The constructor <code>preorder.mk</code> is the same; <code>auto_param</code> fields are replicated, the optional ones are dropped</p>



<a name="169651364"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/making%20mynat%20an%20add_comm_monoid/near/169651364" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/making.20mynat.20an.20add_comm_monoid.html#169651364">(Jul 04 2019 at 14:11)</a>:</h4>
<p>Oh, that's weird... I found a strange parsing issue while investigating this too</p>
<div class="codehilite"><pre><span></span><span class="kn">structure</span> <span class="n">preorder1</span> <span class="o">(</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">)</span> <span class="o">[</span><span class="n">has_le</span> <span class="n">α</span><span class="o">]</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">le_refl</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">a</span> <span class="o">:</span> <span class="n">α</span><span class="o">,</span> <span class="n">a</span> <span class="bp">≤</span> <span class="n">a</span><span class="o">)</span>
<span class="o">(</span><span class="n">le_trans</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="o">:</span> <span class="n">α</span><span class="o">,</span> <span class="n">a</span> <span class="bp">≤</span> <span class="n">b</span> <span class="bp">→</span> <span class="n">b</span> <span class="bp">≤</span> <span class="n">c</span> <span class="bp">→</span> <span class="n">a</span> <span class="bp">≤</span> <span class="n">c</span><span class="o">)</span>
<span class="o">(</span><span class="n">lt</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">a</span> <span class="n">b</span> <span class="o">:</span> <span class="n">α</span><span class="o">,</span> <span class="n">a</span> <span class="bp">≤</span> <span class="n">b</span> <span class="bp">∧</span> <span class="bp">¬</span> <span class="n">b</span> <span class="bp">≤</span> <span class="n">a</span><span class="o">)</span>
<span class="o">(</span><span class="n">lt_iff_le_not_le</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">a</span> <span class="n">b</span> <span class="o">:</span> <span class="n">α</span><span class="o">,</span> <span class="n">lt</span> <span class="n">a</span> <span class="n">b</span> <span class="bp">↔</span> <span class="o">(</span><span class="n">a</span> <span class="bp">≤</span> <span class="n">b</span> <span class="bp">∧</span> <span class="bp">¬</span> <span class="n">b</span> <span class="bp">≤</span> <span class="n">a</span><span class="o">)</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">,</span> <span class="n">iff</span><span class="bp">.</span><span class="n">rfl</span><span class="o">)</span>

<span class="kn">structure</span> <span class="n">preorder2</span> <span class="o">(</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">)</span> <span class="o">[</span><span class="n">has_le</span> <span class="n">α</span><span class="o">]</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">le_refl</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">a</span> <span class="o">:</span> <span class="n">α</span><span class="o">,</span> <span class="n">a</span> <span class="bp">≤</span> <span class="n">a</span><span class="o">)</span>
<span class="o">(</span><span class="n">le_trans</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="o">:</span> <span class="n">α</span><span class="o">,</span> <span class="n">a</span> <span class="bp">≤</span> <span class="n">b</span> <span class="bp">→</span> <span class="n">b</span> <span class="bp">≤</span> <span class="n">c</span> <span class="bp">→</span> <span class="n">a</span> <span class="bp">≤</span> <span class="n">c</span><span class="o">)</span>
<span class="o">(</span><span class="n">lt</span> <span class="o">:</span> <span class="n">α</span> <span class="bp">→</span> <span class="n">α</span> <span class="bp">→</span> <span class="kt">Prop</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">a</span> <span class="n">b</span> <span class="o">:</span> <span class="n">α</span><span class="o">,</span> <span class="n">a</span> <span class="bp">≤</span> <span class="n">b</span> <span class="bp">∧</span> <span class="bp">¬</span> <span class="n">b</span> <span class="bp">≤</span> <span class="n">a</span><span class="o">)</span>
<span class="o">(</span><span class="n">lt_iff_le_not_le</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">a</span> <span class="n">b</span> <span class="o">:</span> <span class="n">α</span><span class="o">,</span> <span class="n">lt</span> <span class="n">a</span> <span class="n">b</span> <span class="bp">↔</span> <span class="o">(</span><span class="n">a</span> <span class="bp">≤</span> <span class="n">b</span> <span class="bp">∧</span> <span class="bp">¬</span> <span class="n">b</span> <span class="bp">≤</span> <span class="n">a</span><span class="o">)</span> <span class="bp">.</span> <span class="n">order_laws_tac</span><span class="o">)</span>
</pre></div>


<p>The type of <code>lt_iff_le_not_le</code> is different in the two cases. <code>preorder2</code> is the right one. <code>preorder1.lt_iff_le_not_le</code> is trivial as evidenced by the <code>rfl</code> proof. <span class="user-mention" data-user-id="110024">@Sebastian Ullrich</span> Are you aware of this? It looks like that thing you pointed out a while back where structures could define lets and notation and other crazy things. Somehow <code>lt</code> is treated as a notation for the purposes of <code>lt_iff_le_not_le</code>, but it is also an actual field...?</p>



<a name="169651434"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/making%20mynat%20an%20add_comm_monoid/near/169651434" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Keeley Hoek <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/making.20mynat.20an.20add_comm_monoid.html#169651434">(Jul 04 2019 at 14:12)</a>:</h4>
<p>:0</p>



<a name="169651451"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/making%20mynat%20an%20add_comm_monoid/near/169651451" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/making.20mynat.20an.20add_comm_monoid.html#169651451">(Jul 04 2019 at 14:12)</a>:</h4>
<p>The other weird thing about this is that <code>lt</code> is already defined in the case of <code>preorder</code>, in <code>has_lt</code>, and it's getting "redefined" with a new defeq type in <code>preorder</code></p>



<a name="169651495"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/making%20mynat%20an%20add_comm_monoid/near/169651495" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/making.20mynat.20an.20add_comm_monoid.html#169651495">(Jul 04 2019 at 14:13)</a>:</h4>
<p>I can already predict that the lean C++ code to make sense of all this is a rats nest</p>



<a name="169651705"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/making%20mynat%20an%20add_comm_monoid/near/169651705" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/making.20mynat.20an.20add_comm_monoid.html#169651705">(Jul 04 2019 at 14:16)</a>:</h4>
<p>Looks like a straight bug</p>



<a name="169651739"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/making%20mynat%20an%20add_comm_monoid/near/169651739" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/making.20mynat.20an.20add_comm_monoid.html#169651739">(Jul 04 2019 at 14:17)</a>:</h4>
<p>Now is the time were Sebastian will paste that url to the commit which fixed that bug in Lean 4 months ago</p>



<a name="169653555"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/making%20mynat%20an%20add_comm_monoid/near/169653555" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/making.20mynat.20an.20add_comm_monoid.html#169653555">(Jul 04 2019 at 14:43)</a>:</h4>
<p>I can make a preorder by just ignoring the <code>lt</code> and <code>lt_iff_whatever</code> fields completely. It's not possible to emulate that behaviour with a tactic?</p>



<a name="169654365"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/making%20mynat%20an%20add_comm_monoid/near/169654365" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Keeley Hoek <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/making.20mynat.20an.20add_comm_monoid.html#169654365">(Jul 04 2019 at 14:55)</a>:</h4>
<p>It appears that lean does not provide a way for lean to access the pre-set optional values of structures, eg. <code>lt</code> in this case.<br>
I think I make it work but it'll be a little bit less robust than I had hoped</p>



<a name="169658797"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/making%20mynat%20an%20add_comm_monoid/near/169658797" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Keeley Hoek <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/making.20mynat.20an.20add_comm_monoid.html#169658797">(Jul 04 2019 at 16:17)</a>:</h4>
<p><span class="user-mention" data-user-id="110038">@Kevin Buzzard</span> Here is a link to something that works, at least on the two <code>add_monoid</code> and <code>preorder</code> examples I've seen! <a href="https://gist.github.com/khoek/cfb72fe41b0725269a14bf9196bb9c73" target="_blank" title="https://gist.github.com/khoek/cfb72fe41b0725269a14bf9196bb9c73">https://gist.github.com/khoek/cfb72fe41b0725269a14bf9196bb9c73</a></p>



<a name="169659315"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/making%20mynat%20an%20add_comm_monoid/near/169659315" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Keeley Hoek <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/making.20mynat.20an.20add_comm_monoid.html#169659315">(Jul 04 2019 at 16:29)</a>:</h4>
<p>Are you able to make a <code>canonically_ordered_comm_semiring</code> using it?</p>



<a name="169659640"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/making%20mynat%20an%20add_comm_monoid/near/169659640" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/making.20mynat.20an.20add_comm_monoid.html#169659640">(Jul 04 2019 at 16:34)</a>:</h4>
<p>I'm now seeing all sorts of errors like</p>
<div class="codehilite"><pre><span></span>type mismatch at field &#39;lt_of_add_lt_add_left&#39;
  lt_of_add_lt_add_left
has type
  ?m_3 + ?m_4 &lt; ?m_3 + ?m_5 → ?m_4 &lt; ?m_5
but is expected to have type
  ∀ (a b c : mynat), a + b &lt; a + c → b &lt; c
</pre></div>


<p>but this is not your fault -- I have defined <code>lt_of_add_lt_add_left</code> with the inputs implicit but apparently Lean wants them explicit. Nearly there now, just fixing all of them.</p>



<a name="169659728"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/making%20mynat%20an%20add_comm_monoid/near/169659728" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/making.20mynat.20an.20add_comm_monoid.html#169659728">(Jul 04 2019 at 16:36)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="kn">instance</span> <span class="o">:</span> <span class="n">canonically_ordered_comm_semiring</span> <span class="n">mynat</span> <span class="o">:=</span> <span class="k">by</span> <span class="n">structure_helper</span> <span class="c1">-- works!</span>
</pre></div>



<a name="169659758"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/making%20mynat%20an%20add_comm_monoid/near/169659758" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/making.20mynat.20an.20add_comm_monoid.html#169659758">(Jul 04 2019 at 16:37)</a>:</h4>
<p>How do I get a complete list of all the typeclasses <code>X</code> such that type class inference can find a term of type <code>X nat</code> ?</p>



<a name="169659933"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/making%20mynat%20an%20add_comm_monoid/near/169659933" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/making.20mynat.20an.20add_comm_monoid.html#169659933">(Jul 04 2019 at 16:40)</a>:</h4>
<p>But it works :-) Many thanks Keeley!</p>



<a name="169660220"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/making%20mynat%20an%20add_comm_monoid/near/169660220" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/making.20mynat.20an.20add_comm_monoid.html#169660220">(Jul 04 2019 at 16:46)</a>:</h4>
<p>Ultimately I would rather <code>lt_of_add_lt_add_left : ∀ {a b c : mynat}, a + b &lt; a + c → b &lt; c := ...</code> because I believe that this is the idiomatic way to define this function, with a, b, c implicit. It stops the tactic working through. We can put that down to "further work if someone can be bothered".</p>



<a name="169660436"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/making%20mynat%20an%20add_comm_monoid/near/169660436" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/making.20mynat.20an.20add_comm_monoid.html#169660436">(Jul 04 2019 at 16:50)</a>:</h4>
<p><span class="user-mention" data-user-id="110049">@Mario Carneiro</span> you were talking about a bug in Lean. Can this  bug be easily fixed in 3.5.1? Would a consequence be that a whole bunch of <code>_</code>'s would need to be removed from mathlib? I feel like the definition of <code>canonically_ordered_comm_semiring.lt_of_add_lt_add_left</code> is "wrong".</p>
<div class="codehilite"><pre><span></span>canonically_ordered_comm_semiring.lt_of_add_lt_add_left : ∀ (a b c : ?M_1), a + b &lt; a + c → b &lt; c
</pre></div>


<p>I want to write some sort of front end for Lean where the user just has to type in simple proofs in tactic mode and that's all they can do. For this project, I don't care about mathlib and I don't care if I'm running a non-standard Lean. On the other hand if people change the behaviour of core tactics like <code>induction</code> then it will break everything I guess.</p>



<a name="169660461"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/making%20mynat%20an%20add_comm_monoid/near/169660461" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/making.20mynat.20an.20add_comm_monoid.html#169660461">(Jul 04 2019 at 16:51)</a>:</h4>
<p>You should just be using <code>lt_of_add_lt_add_left</code></p>



<a name="169660463"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/making%20mynat%20an%20add_comm_monoid/near/169660463" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/making.20mynat.20an.20add_comm_monoid.html#169660463">(Jul 04 2019 at 16:51)</a>:</h4>
<p>which has the right binders</p>



<a name="169660521"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/making%20mynat%20an%20add_comm_monoid/near/169660521" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/making.20mynat.20an.20add_comm_monoid.html#169660521">(Jul 04 2019 at 16:52)</a>:</h4>
<p>ooh. <code>ordered_cancel_comm_monoid</code></p>



<a name="169660533"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/making%20mynat%20an%20add_comm_monoid/near/169660533" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/making.20mynat.20an.20add_comm_monoid.html#169660533">(Jul 04 2019 at 16:53)</a>:</h4>
<p>I love that there are just a gazillion really stupid-in-my-eyes classes which are just out there and I don't know the names of any of them.</p>



<a name="169660548"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/making%20mynat%20an%20add_comm_monoid/near/169660548" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/making.20mynat.20an.20add_comm_monoid.html#169660548">(Jul 04 2019 at 16:53)</a>:</h4>
<p>I don't want to use it, I want the user to prove it.</p>



<a name="169660601"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/making%20mynat%20an%20add_comm_monoid/near/169660601" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/making.20mynat.20an.20add_comm_monoid.html#169660601">(Jul 04 2019 at 16:54)</a>:</h4>
<p>There is a tactic that does the restating automatically</p>



<a name="169660619"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/making%20mynat%20an%20add_comm_monoid/near/169660619" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/making.20mynat.20an.20add_comm_monoid.html#169660619">(Jul 04 2019 at 16:55)</a>:</h4>
<p>Yeah but I don't want to restate it, I want the user to prove it.</p>



<a name="169660623"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/making%20mynat%20an%20add_comm_monoid/near/169660623" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/making.20mynat.20an.20add_comm_monoid.html#169660623">(Jul 04 2019 at 16:55)</a>:</h4>
<p>We're building nat from scratch.</p>



<a name="169660632"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/making%20mynat%20an%20add_comm_monoid/near/169660632" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/making.20mynat.20an.20add_comm_monoid.html#169660632">(Jul 04 2019 at 16:55)</a>:</h4>
<p>The binders don't matter if you are proving it</p>



<a name="169660634"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/making%20mynat%20an%20add_comm_monoid/near/169660634" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/making.20mynat.20an.20add_comm_monoid.html#169660634">(Jul 04 2019 at 16:55)</a>:</h4>
<p>it's lambda regardless</p>



<a name="169660639"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/making%20mynat%20an%20add_comm_monoid/near/169660639" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/making.20mynat.20an.20add_comm_monoid.html#169660639">(Jul 04 2019 at 16:55)</a>:</h4>
<p>I know, I just feel like I'm lying to the user.</p>



<a name="169660704"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/making%20mynat%20an%20add_comm_monoid/near/169660704" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/making.20mynat.20an.20add_comm_monoid.html#169660704">(Jul 04 2019 at 16:56)</a>:</h4>
<p>In fact, it's usually better for the axiom to have all explicit or semi implicit binders when proving it</p>



<a name="169660778"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/making%20mynat%20an%20add_comm_monoid/near/169660778" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/making.20mynat.20an.20add_comm_monoid.html#169660778">(Jul 04 2019 at 16:58)</a>:</h4>
<p><span class="user-mention" data-user-id="110111">@Keeley Hoek</span> I would like an over-ride. I'd like to define <code>mynat.lt_of_add_lt_add_left</code>  with semi-implicit or implicit binders, and then define <code>mynat.lt_of_add_le_add_left'</code> to be the thing with the stupid binders and then tell your tactic to use the stupid version with the ' just for that field only.</p>



<a name="169660780"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/making%20mynat%20an%20add_comm_monoid/near/169660780" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/making.20mynat.20an.20add_comm_monoid.html#169660780">(Jul 04 2019 at 16:58)</a>:</h4>
<p>For instance, you might have an assumption that says <code>∀ (a b c : A), a + b &lt; a + c → b &lt; c</code> and you want to pass it in; if the assumption is implicit then the arguments will get auto applied and it won't fit</p>



<a name="169660796"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/making%20mynat%20an%20add_comm_monoid/near/169660796" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/making.20mynat.20an.20add_comm_monoid.html#169660796">(Jul 04 2019 at 16:58)</a>:</h4>
<p>I would assume that for Keeley's tactic you can define the binders however you like</p>



<a name="169660922"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/making%20mynat%20an%20add_comm_monoid/near/169660922" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Keeley Hoek <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/making.20mynat.20an.20add_comm_monoid.html#169660922">(Jul 04 2019 at 17:01)</a>:</h4>
<p>Unfortunately Mario it seems that the structure-builder notation refuses to accept specifying a field with different binders =/</p>



<a name="169660931"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/making%20mynat%20an%20add_comm_monoid/near/169660931" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Keeley Hoek <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/making.20mynat.20an.20add_comm_monoid.html#169660931">(Jul 04 2019 at 17:01)</a>:</h4>
<p>Perhaps another bug?</p>



<a name="169661038"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/making%20mynat%20an%20add_comm_monoid/near/169661038" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Keeley Hoek <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/making.20mynat.20an.20add_comm_monoid.html#169661038">(Jul 04 2019 at 17:02)</a>:</h4>
<p>MWE:</p>
<div class="codehilite"><pre><span></span><span class="kn">structure</span> <span class="n">thingo</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">func</span> <span class="o">:</span> <span class="bp">Π</span> <span class="o">(</span><span class="n">a</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">),</span> <span class="bp">ℕ</span><span class="o">)</span>

<span class="c1">-- works</span>
<span class="n">def</span> <span class="n">foo</span> <span class="o">:</span> <span class="n">thingo</span> <span class="o">:=</span> <span class="o">{</span><span class="n">func</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="o">{</span><span class="n">a</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">},</span> <span class="n">a</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">}</span>

<span class="n">def</span> <span class="n">concrete</span> <span class="o">{</span><span class="n">a</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">}</span> <span class="o">:</span> <span class="bp">ℕ</span> <span class="o">:=</span> <span class="n">a</span> <span class="bp">+</span> <span class="mi">1</span>
<span class="c1">-- doesn&#39;t</span>
<span class="n">def</span> <span class="n">bar</span> <span class="o">:</span> <span class="n">thingo</span> <span class="o">:=</span> <span class="o">{</span><span class="n">func</span> <span class="o">:=</span> <span class="n">concrete</span><span class="o">}</span>
</pre></div>



<a name="169661132"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/making%20mynat%20an%20add_comm_monoid/near/169661132" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/making.20mynat.20an.20add_comm_monoid.html#169661132">(Jul 04 2019 at 17:04)</a>:</h4>
<div class="codehilite"><pre><span></span>canonically_ordered_comm_semiring
  canonically_ordered_monoid,
    ordered_comm_monoid
      add_comm_monoid
      partial_order
    lattice.order_bot
      partial_order
  comm_semiring
  zero_ne_one_class
</pre></div>


<p>Generated by hand -- each thing extends the things one level of indentation below it.</p>



<a name="169661230"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/making%20mynat%20an%20add_comm_monoid/near/169661230" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/making.20mynat.20an.20add_comm_monoid.html#169661230">(Jul 04 2019 at 17:06)</a>:</h4>
<p>That's funny because you would imagine that <code>lam a, f</code> is syntactically equal to <code>lam {a}, f</code></p>



<a name="169661271"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/making%20mynat%20an%20add_comm_monoid/near/169661271" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/making.20mynat.20an.20add_comm_monoid.html#169661271">(Jul 04 2019 at 17:07)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="kn">structure</span> <span class="n">thingo</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">func</span> <span class="o">:</span> <span class="bp">Π</span> <span class="o">(</span><span class="n">a</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">),</span> <span class="bp">ℕ</span><span class="o">)</span>

<span class="c1">-- works</span>
<span class="n">def</span> <span class="n">foo</span> <span class="o">:</span> <span class="n">thingo</span> <span class="o">:=</span> <span class="o">{</span><span class="n">func</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="o">{</span><span class="n">a</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">},</span> <span class="n">a</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">}</span>

<span class="c1">-- also works!</span>
<span class="n">def</span> <span class="n">concrete</span> <span class="o">{{</span><span class="n">a</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">}}</span> <span class="o">:</span> <span class="bp">ℕ</span> <span class="o">:=</span> <span class="n">a</span> <span class="bp">+</span> <span class="mi">1</span>

<span class="n">def</span> <span class="n">bar</span> <span class="o">:</span> <span class="n">thingo</span> <span class="o">:=</span> <span class="o">{</span><span class="n">func</span> <span class="o">:=</span> <span class="n">concrete</span><span class="o">}</span>
</pre></div>



<a name="169662170"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/making%20mynat%20an%20add_comm_monoid/near/169662170" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/making.20mynat.20an.20add_comm_monoid.html#169662170">(Jul 04 2019 at 17:27)</a>:</h4>
<p>that's not a bug, that's by design</p>



<a name="169662183"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/making%20mynat%20an%20add_comm_monoid/near/169662183" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/making.20mynat.20an.20add_comm_monoid.html#169662183">(Jul 04 2019 at 17:27)</a>:</h4>
<p>and that's also why I said semi-implicit is a good choice here</p>



<a name="169662260"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/making%20mynat%20an%20add_comm_monoid/near/169662260" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/making.20mynat.20an.20add_comm_monoid.html#169662260">(Jul 04 2019 at 17:29)</a>:</h4>
<p>Is there a "correct" decision for the variables in <code>lt_of_add_le_add_left</code> ? Or do you sometimes need one thing and sometimes another?</p>



<a name="169662477"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/making%20mynat%20an%20add_comm_monoid/near/169662477" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/making.20mynat.20an.20add_comm_monoid.html#169662477">(Jul 04 2019 at 17:35)</a>:</h4>
<p>It might work to use apply to figure out the right number of arguments</p>



<a name="169714756"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/making%20mynat%20an%20add_comm_monoid/near/169714756" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Keeley Hoek <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/making.20mynat.20an.20add_comm_monoid.html#169714756">(Jul 05 2019 at 14:54)</a>:</h4>
<p>ooh, well my tactic could count the number of expected explicit arguments and then instead of <code>fn := fn</code> not compiling <code>fn := \lambda a b, @fn _ a b</code> would compile. Would that have defeq problems?</p>



<a name="169714809"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/making%20mynat%20an%20add_comm_monoid/near/169714809" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/making.20mynat.20an.20add_comm_monoid.html#169714809">(Jul 05 2019 at 14:55)</a>:</h4>
<p>no</p>



<a name="169714901"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/making%20mynat%20an%20add_comm_monoid/near/169714901" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/making.20mynat.20an.20add_comm_monoid.html#169714901">(Jul 05 2019 at 14:56)</a>:</h4>
<p>In principle this is what <code>apply</code> is supposed to do, but it may not work for you</p>



<a name="169714995"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/making%20mynat%20an%20add_comm_monoid/near/169714995" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Keeley Hoek <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/making.20mynat.20an.20add_comm_monoid.html#169714995">(Jul 05 2019 at 14:57)</a>:</h4>
<p>Yes, due to the aforementioned <code>opt_param</code> problems the only way I can get those fields filled is using a <code>structure_instance_info</code>, which needs explicit <code>pexpr</code>s to be provided.</p>



<a name="169715050"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/making%20mynat%20an%20add_comm_monoid/near/169715050" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Keeley Hoek <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/making.20mynat.20an.20add_comm_monoid.html#169715050">(Jul 05 2019 at 14:58)</a>:</h4>
<p>Also, is your "no" an answer to my question, or "no that won't work"?</p>



<a name="169715060"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/making%20mynat%20an%20add_comm_monoid/near/169715060" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/making.20mynat.20an.20add_comm_monoid.html#169715060">(Jul 05 2019 at 14:58)</a>:</h4>
<p>no defeq problems</p>



<a name="169715076"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/making%20mynat%20an%20add_comm_monoid/near/169715076" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/making.20mynat.20an.20add_comm_monoid.html#169715076">(Jul 05 2019 at 14:58)</a>:</h4>
<p>You can elaborate an expr using <code>apply</code> and then quote it to turn it into a pexpr</p>



<a name="169717116"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/making%20mynat%20an%20add_comm_monoid/near/169717116" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Keeley Hoek <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/making.20mynat.20an.20add_comm_monoid.html#169717116">(Jul 05 2019 at 15:26)</a>:</h4>
<p>Oh ok, I see what you are saying. I tried something like this for a bit but there were problems I think with the inter-dependence of the fields and things like <code>le</code> not being decided when <code>le_refl</code> was being decided using an <code>apply</code>. I guess you could build everything consistently so that all the fields of the structure had metavariables in their type in common when they correspond to the same thing? But this seems like some work</p>



<a name="169717269"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/making%20mynat%20an%20add_comm_monoid/near/169717269" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/making.20mynat.20an.20add_comm_monoid.html#169717269">(Jul 05 2019 at 15:29)</a>:</h4>
<p>I am using Mario's approach of <code>{{ }}</code> when necessary</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>