---
layout: archive
title: Zulip Chat Archive
permalink: /stream/116395-maths/topic/Defining.20n-division.20polynomials.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/116395-maths/index.html">maths</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Defining.20n-division.20polynomials.html">Defining n-division polynomials</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="231157400"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Defining%20n-division%20polynomials/near/231157400" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Marc Masdeu <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Defining.20n-division.20polynomials.html#231157400">(Mar 20 2021 at 16:55)</a>:</h4>
<p>Hi all,</p>
<p>I'm having a go at proving in Lean something that can't be found in the literature (as far as I'm aware), namely a purely algebraic proof of the validity of the formulas for the multiplication-by-n isogeny on elliptic curves. This involves the infamous n-division polynomials, which I am trying to define in Lean. The recurrence has 5 basic cases (0,1,2,3,4) and then two recurrent formulas, depending on the parity of n. I haven't been able to make it work so far, here is my try:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">tactic</span>
<span class="kn">import</span> <span class="n">data.polynomial.basic</span>
<span class="kn">open</span> <span class="n">polynomial</span>

<span class="kd">noncomputable theory</span>
<span class="c1">--variables {R : Type} [comm_ring R]</span>
<span class="kd">variables</span> <span class="o">{</span><span class="n">A</span> <span class="n">B</span> <span class="o">:</span> <span class="n">ℤ</span><span class="o">}</span>
<span class="kd">def</span> <span class="n">x</span> <span class="o">:=</span> <span class="o">(</span><span class="n">monomial</span> <span class="mi">1</span> <span class="o">(</span><span class="mi">1</span> <span class="o">:</span> <span class="n">ℤ</span><span class="o">))</span>

<span class="c1">--set_option trace.eqn_compiler.elim_match true</span>
<span class="kd">noncomputable</span> <span class="kd">def</span> <span class="n">psi</span> <span class="o">:</span> <span class="n">ℕ</span> <span class="bp">→</span> <span class="o">(</span><span class="n">polynomial</span> <span class="n">ℤ</span><span class="o">)</span>
<span class="bp">|</span> <span class="mi">0</span> <span class="o">:=</span> <span class="mi">0</span>
<span class="bp">|</span> <span class="mi">1</span> <span class="o">:=</span> <span class="mi">1</span>
<span class="bp">|</span> <span class="mi">2</span> <span class="o">:=</span> <span class="mi">1</span>
<span class="bp">|</span> <span class="mi">3</span> <span class="o">:=</span> <span class="mi">3</span><span class="bp">*</span><span class="n">x</span><span class="bp">^</span><span class="mi">4</span> <span class="bp">+</span> <span class="mi">6</span><span class="bp">*</span><span class="n">A</span><span class="bp">*</span><span class="n">x</span><span class="bp">^</span><span class="mi">2</span> <span class="bp">+</span> <span class="mi">12</span><span class="bp">*</span><span class="n">B</span><span class="bp">*</span><span class="n">x</span> <span class="bp">-</span> <span class="n">A</span><span class="bp">^</span><span class="mi">2</span><span class="bp">*</span><span class="n">x</span>
<span class="bp">|</span> <span class="mi">4</span> <span class="o">:=</span> <span class="mi">2</span><span class="bp">*</span><span class="o">(</span><span class="n">x</span><span class="bp">^</span><span class="mi">6</span> <span class="bp">+</span> <span class="mi">5</span><span class="bp">*</span><span class="n">A</span><span class="bp">*</span><span class="n">x</span><span class="bp">^</span><span class="mi">4</span><span class="bp">+</span><span class="mi">20</span><span class="bp">*</span><span class="n">B</span><span class="bp">*</span><span class="n">x</span><span class="bp">^</span><span class="mi">3</span><span class="bp">-</span><span class="mi">5</span><span class="bp">*</span><span class="n">A</span><span class="bp">^</span><span class="mi">2</span><span class="bp">*</span><span class="n">x</span><span class="bp">^</span><span class="mi">2</span><span class="bp">-</span><span class="mi">4</span><span class="bp">*</span><span class="n">A</span><span class="bp">*</span><span class="n">B</span><span class="bp">*</span><span class="n">x</span><span class="bp">-</span><span class="n">A</span><span class="bp">^</span><span class="mi">3</span><span class="bp">-</span><span class="mi">8</span><span class="bp">*</span><span class="n">B</span><span class="bp">^</span><span class="mi">2</span><span class="o">)</span>
<span class="bp">|</span> <span class="o">(</span><span class="mi">2</span><span class="bp">*</span><span class="n">n</span><span class="bp">+</span><span class="mi">5</span><span class="o">)</span> <span class="o">:=</span>
  <span class="k">have</span> <span class="n">n</span><span class="bp">+</span><span class="mi">4</span> <span class="bp">&lt;</span> <span class="mi">2</span><span class="bp">*</span><span class="n">n</span><span class="bp">+</span><span class="mi">5</span><span class="o">,</span> <span class="kd">by</span> <span class="n">linarith</span><span class="o">,</span>
  <span class="k">have</span> <span class="n">n</span><span class="bp">+</span><span class="mi">3</span> <span class="bp">&lt;</span> <span class="mi">2</span><span class="bp">*</span><span class="n">n</span><span class="bp">+</span><span class="mi">5</span><span class="o">,</span> <span class="kd">by</span> <span class="n">linarith</span><span class="o">,</span>
  <span class="k">have</span> <span class="n">n</span><span class="bp">+</span><span class="mi">2</span> <span class="bp">&lt;</span> <span class="mi">2</span><span class="bp">*</span><span class="n">n</span><span class="bp">+</span><span class="mi">5</span><span class="o">,</span> <span class="kd">by</span> <span class="n">linarith</span><span class="o">,</span>
  <span class="k">have</span> <span class="n">n</span><span class="bp">+</span><span class="mi">1</span> <span class="bp">&lt;</span> <span class="mi">2</span><span class="bp">*</span><span class="n">n</span><span class="bp">+</span><span class="mi">5</span><span class="o">,</span> <span class="kd">by</span> <span class="n">linarith</span><span class="o">,</span>
  <span class="o">(</span><span class="n">psi</span> <span class="o">(</span><span class="n">n</span><span class="bp">+</span><span class="mi">4</span><span class="o">))</span> <span class="bp">*</span> <span class="o">(</span><span class="n">psi</span> <span class="o">(</span><span class="n">n</span><span class="bp">+</span><span class="mi">2</span><span class="o">))</span><span class="bp">^</span><span class="mi">3</span> <span class="bp">-</span> <span class="o">(</span><span class="n">psi</span> <span class="o">(</span><span class="n">n</span><span class="bp">+</span><span class="mi">1</span><span class="o">)</span> <span class="bp">*</span> <span class="o">(</span><span class="n">psi</span> <span class="o">(</span><span class="n">n</span><span class="bp">+</span><span class="mi">3</span><span class="o">))</span><span class="bp">^</span><span class="mi">3</span><span class="o">)</span>
<span class="bp">|</span> <span class="o">(</span><span class="mi">2</span><span class="bp">*</span><span class="n">n</span><span class="bp">+</span><span class="mi">6</span><span class="o">)</span> <span class="o">:=</span>
  <span class="k">have</span> <span class="n">n</span><span class="bp">+</span><span class="mi">5</span> <span class="bp">&lt;</span> <span class="mi">2</span><span class="bp">*</span><span class="n">n</span><span class="bp">+</span><span class="mi">6</span><span class="o">,</span> <span class="kd">by</span> <span class="n">linarith</span><span class="o">,</span>
  <span class="k">have</span> <span class="n">n</span><span class="bp">+</span><span class="mi">4</span> <span class="bp">&lt;</span> <span class="mi">2</span><span class="bp">*</span><span class="n">n</span><span class="bp">+</span><span class="mi">6</span><span class="o">,</span> <span class="kd">by</span> <span class="n">linarith</span><span class="o">,</span>
  <span class="k">have</span> <span class="n">n</span><span class="bp">+</span><span class="mi">3</span> <span class="bp">&lt;</span> <span class="mi">2</span><span class="bp">*</span><span class="n">n</span><span class="bp">+</span><span class="mi">6</span><span class="o">,</span> <span class="kd">by</span> <span class="n">linarith</span><span class="o">,</span>
  <span class="k">have</span> <span class="n">n</span><span class="bp">+</span><span class="mi">2</span> <span class="bp">&lt;</span> <span class="mi">2</span><span class="bp">*</span><span class="n">n</span><span class="bp">+</span><span class="mi">6</span><span class="o">,</span> <span class="kd">by</span> <span class="n">linarith</span><span class="o">,</span>
  <span class="o">(</span><span class="n">psi</span> <span class="o">(</span><span class="n">n</span><span class="bp">+</span><span class="mi">3</span><span class="o">))</span> <span class="bp">*</span> <span class="o">((</span><span class="n">psi</span> <span class="o">(</span><span class="n">n</span><span class="bp">+</span><span class="mi">5</span><span class="o">))</span><span class="bp">*</span>
      <span class="o">(</span><span class="n">psi</span> <span class="o">(</span><span class="n">n</span><span class="bp">+</span><span class="mi">2</span><span class="o">))</span><span class="bp">^</span><span class="mi">2</span> <span class="bp">-</span> <span class="o">(</span><span class="n">psi</span> <span class="o">(</span><span class="n">n</span><span class="bp">+</span><span class="mi">1</span><span class="o">))</span> <span class="bp">*</span> <span class="o">(</span><span class="n">psi</span> <span class="o">(</span><span class="n">n</span><span class="bp">+</span><span class="mi">4</span><span class="o">))</span><span class="bp">^</span><span class="mi">2</span><span class="o">)</span> <span class="bp">/</span> <span class="o">(</span><span class="mi">4</span><span class="bp">*</span><span class="o">(</span><span class="n">x</span><span class="bp">^</span><span class="mi">3</span><span class="bp">+</span><span class="n">A</span><span class="bp">*</span><span class="n">x</span><span class="bp">+</span><span class="n">B</span><span class="o">)),</span>
</code></pre></div>
<p>From reading <a href="https://leanprover-community.github.io/extras/well_founded_recursion.html">https://leanprover-community.github.io/extras/well_founded_recursion.html</a> I gathered that I needed to supply the proofs of the fact that the recurrence is well-founded, but they would all be easy, I could even figure out how to produce a term proof if linarith was forbidden.</p>
<p>Also, I'd like A and B to be allowed to live in any commutative ring, but then it gives me even more errors because apparently A*x is not a polynomial in R when A is in R (but that's for a different thread I guess).</p>
<p>Any hints would be appreciated :-).</p>
<p>PS: feel free to move this to "new members", I'm not always sure of the distinction between streams.</p>



<a name="231157465"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Defining%20n-division%20polynomials/near/231157465" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Defining.20n-division.20polynomials.html#231157465">(Mar 20 2021 at 16:56)</a>:</h4>
<p>I think you're no longer new :-) Just to be clear -- this is the y^2=x^3+Ax+B model, right?</p>



<a name="231157516"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Defining%20n-division%20polynomials/near/231157516" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Defining.20n-division.20polynomials.html#231157516">(Mar 20 2021 at 16:57)</a>:</h4>
<p>The equation compiler isn't going to be able to split between even and odd cases I don't think, because even v odd is not something which comes directly from the recursive definition of the naturals. I would just be tempted to use "strong recursion" here.</p>



<a name="231157575"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Defining%20n-division%20polynomials/near/231157575" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Marc Masdeu <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Defining.20n-division.20polynomials.html#231157575">(Mar 20 2021 at 16:58)</a>:</h4>
<p>(what if not new but have  a newbie question?). This is the y^2=x^3+Ax+B model, but if that worked then it shouldn't be too hard to adapt the proof to the general Weierstrass model.</p>



<a name="231157729"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Defining%20n-division%20polynomials/near/231157729" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Marc Masdeu <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Defining.20n-division.20polynomials.html#231157729">(Mar 20 2021 at 17:00)</a>:</h4>
<p>Oh, so you say that 2<em>n vs 2</em>n+1 (or what I write) does confuse lean? Maybe there's an easier way just defining phi_odd and phi_even, then? It wouldn't be as elegant, but I just want to type a proof...</p>



<a name="231157845"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Defining%20n-division%20polynomials/near/231157845" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Defining.20n-division.20polynomials.html#231157845">(Mar 20 2021 at 17:02)</a>:</h4>
<p><span class="user-mention silent" data-user-id="254058">Marc Masdeu</span> <a href="#narrow/stream/116395-maths/topic/Defining.20n-division.20polynomials/near/231157400">said</a>:</p>
<blockquote>
<p>Also, I'd like A and B to be allowed to live in any commutative ring, but then it gives me even more errors because apparently A*x is not a polynomial in R when A is in R (but that's for a different thread I guess).</p>
</blockquote>
<p>Use <code>C A * X</code> or <code>A \bullet X</code>. Here <code>C</code> is <code>polynomial.C</code> is the ring morphism from <code>R</code> to <code>polynomial R</code>.</p>
<p>(I think this thread perfectly fits the #maths stream!)</p>



<a name="231158110"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Defining%20n-division%20polynomials/near/231158110" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Defining.20n-division.20polynomials.html#231158110">(Mar 20 2021 at 17:06)</a>:</h4>
<p><span class="user-mention" data-user-id="254058">@Marc Masdeu</span> I think would use <code>if .. then .. else</code> in the <code>n + 5</code> branch</p>



<a name="231158129"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Defining%20n-division%20polynomials/near/231158129" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Defining.20n-division.20polynomials.html#231158129">(Mar 20 2021 at 17:07)</a>:</h4>
<p>And <code>nat</code>-division, which is truncating, so <code>5/2 = 2</code>, <code>6/2 = 3</code>, and <code>7/2 = 3</code>, etc...</p>



<a name="231158149"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Defining%20n-division%20polynomials/near/231158149" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Defining.20n-division.20polynomials.html#231158149">(Mar 20 2021 at 17:07)</a>:</h4>
<p>The other option is the strong recursion that Kevin mentioned</p>



<a name="231158190"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Defining%20n-division%20polynomials/near/231158190" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Defining.20n-division.20polynomials.html#231158190">(Mar 20 2021 at 17:08)</a>:</h4>
<p>Aah very nice, so you don't have to extract the k from "exists k, n=2k or n=2k+1"</p>



<a name="231158239"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Defining%20n-division%20polynomials/near/231158239" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Defining.20n-division.20polynomials.html#231158239">(Mar 20 2021 at 17:08)</a>:</h4>
<p>I was going to suggest matching on the pos_num :-) but integer division is a much more sensible approach</p>



<a name="231158391"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Defining%20n-division%20polynomials/near/231158391" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Defining.20n-division.20polynomials.html#231158391">(Mar 20 2021 at 17:11)</a>:</h4>
<p>So in conclusion do the final match on n+5 and use if then else on <code>even (n+5)</code> (or probably even n is more sensible) and try your have technique. And for the polynomials I would be tempted to fix a ring and just use <code>polynomial.X</code> directly (open polynomial first) and then use C or bub</p>



<a name="231158476"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Defining%20n-division%20polynomials/near/231158476" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Marc Masdeu <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Defining.20n-division.20polynomials.html#231158476">(Mar 20 2021 at 17:13)</a>:</h4>
<p>Thanks for the suggestions, I'll try and see.</p>



<a name="231159058"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Defining%20n-division%20polynomials/near/231159058" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Marc Masdeu <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Defining.20n-division.20polynomials.html#231159058">(Mar 20 2021 at 17:24)</a>:</h4>
<p>Seems that I've made a bit of progress:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">tactic</span>
<span class="kn">import</span> <span class="n">data.polynomial.basic</span>
<span class="kn">open</span> <span class="n">polynomial</span>

<span class="kd">noncomputable theory</span>
<span class="kd">variables</span> <span class="o">{</span><span class="n">R</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">}</span> <span class="o">[</span><span class="n">comm_ring</span> <span class="n">R</span><span class="o">]</span>
<span class="kd">variables</span> <span class="o">{</span><span class="n">A</span> <span class="n">B</span> <span class="o">:</span> <span class="n">R</span><span class="o">}</span>
<span class="kd">def</span> <span class="n">x</span> <span class="o">:=</span> <span class="o">(</span><span class="n">monomial</span> <span class="mi">1</span> <span class="o">(</span><span class="mi">1</span> <span class="o">:</span> <span class="n">R</span><span class="o">))</span>

<span class="c1">--set_option trace.eqn_compiler.elim_match true</span>
<span class="kd">noncomputable</span> <span class="kd">def</span> <span class="n">psi</span> <span class="o">:</span> <span class="n">ℕ</span> <span class="bp">→</span> <span class="o">(</span><span class="n">polynomial</span> <span class="n">R</span><span class="o">)</span>
<span class="bp">|</span> <span class="mi">0</span> <span class="o">:=</span> <span class="mi">0</span>
<span class="bp">|</span> <span class="mi">1</span> <span class="o">:=</span> <span class="mi">1</span>
<span class="bp">|</span> <span class="mi">2</span> <span class="o">:=</span> <span class="mi">1</span>
<span class="bp">|</span> <span class="mi">3</span> <span class="o">:=</span> <span class="mi">3</span><span class="bp">*</span><span class="n">x</span><span class="bp">^</span><span class="mi">4</span> <span class="bp">+</span> <span class="mi">6</span><span class="bp">*</span><span class="n">A</span><span class="bp">•</span><span class="n">x</span><span class="bp">^</span><span class="mi">2</span> <span class="bp">+</span> <span class="mi">12</span><span class="bp">*</span><span class="n">B</span><span class="bp">•</span><span class="n">x</span> <span class="bp">-</span> <span class="n">A</span><span class="bp">^</span><span class="mi">2</span><span class="bp">•</span><span class="n">x</span>
<span class="bp">|</span> <span class="mi">4</span> <span class="o">:=</span> <span class="mi">2</span><span class="bp">*</span><span class="o">(</span><span class="n">x</span><span class="bp">^</span><span class="mi">6</span> <span class="bp">+</span> <span class="mi">5</span><span class="bp">*</span><span class="n">A</span><span class="bp">•</span><span class="n">x</span><span class="bp">^</span><span class="mi">4</span><span class="bp">+</span><span class="mi">20</span><span class="bp">*</span><span class="n">B</span><span class="bp">•</span><span class="n">x</span><span class="bp">^</span><span class="mi">3</span><span class="bp">-</span><span class="mi">5</span><span class="bp">*</span><span class="n">A</span><span class="bp">^</span><span class="mi">2</span><span class="bp">•</span><span class="n">x</span><span class="bp">^</span><span class="mi">2</span><span class="bp">-</span><span class="o">(</span><span class="mi">4</span><span class="bp">*</span><span class="n">A</span><span class="bp">*</span><span class="n">B</span><span class="o">)</span><span class="bp">•</span><span class="n">x</span><span class="bp">-</span><span class="n">A</span><span class="bp">^</span><span class="mi">3</span><span class="bp">•</span><span class="n">x</span><span class="bp">^</span><span class="mi">0</span><span class="bp">-</span><span class="mi">8</span><span class="bp">*</span><span class="n">B</span><span class="bp">^</span><span class="mi">2</span><span class="bp">•</span><span class="n">x</span><span class="bp">^</span><span class="mi">0</span><span class="o">)</span>
<span class="bp">|</span> <span class="o">(</span><span class="n">n</span><span class="bp">+</span><span class="mi">5</span><span class="o">)</span> <span class="o">:=</span>
  <span class="k">have</span> <span class="n">n</span><span class="bp">/</span><span class="mi">2</span><span class="bp">+</span><span class="mi">1</span> <span class="bp">&lt;</span> <span class="n">n</span><span class="bp">+</span><span class="mi">5</span><span class="o">,</span> <span class="kd">by</span> <span class="gr">sorry</span><span class="o">,</span>
  <span class="k">have</span> <span class="n">n</span><span class="bp">/</span><span class="mi">2</span><span class="bp">+</span><span class="mi">2</span> <span class="bp">&lt;</span> <span class="n">n</span><span class="bp">+</span><span class="mi">5</span><span class="o">,</span> <span class="kd">by</span> <span class="gr">sorry</span><span class="o">,</span>
  <span class="k">have</span> <span class="n">n</span><span class="bp">/</span><span class="mi">2</span><span class="bp">+</span><span class="mi">3</span> <span class="bp">&lt;</span> <span class="n">n</span><span class="bp">+</span><span class="mi">5</span><span class="o">,</span> <span class="kd">by</span> <span class="gr">sorry</span><span class="o">,</span>
  <span class="k">have</span> <span class="n">n</span><span class="bp">/</span><span class="mi">2</span><span class="bp">+</span><span class="mi">4</span> <span class="bp">&lt;</span> <span class="n">n</span><span class="bp">+</span><span class="mi">5</span><span class="o">,</span> <span class="kd">by</span> <span class="gr">sorry</span><span class="o">,</span>
  <span class="k">have</span> <span class="n">n</span><span class="bp">/</span><span class="mi">2</span><span class="bp">+</span><span class="mi">5</span> <span class="bp">&lt;</span> <span class="n">n</span><span class="bp">+</span><span class="mi">5</span><span class="o">,</span> <span class="kd">by</span> <span class="gr">sorry</span><span class="o">,</span>
  <span class="k">if</span> <span class="n">even</span> <span class="n">n</span> <span class="k">then</span> <span class="o">(</span><span class="n">psi</span> <span class="o">(</span><span class="n">n</span><span class="bp">/</span><span class="mi">2</span><span class="bp">+</span><span class="mi">3</span><span class="o">))</span> <span class="bp">*</span> <span class="o">((</span><span class="n">psi</span> <span class="o">(</span><span class="n">n</span><span class="bp">/</span><span class="mi">2</span><span class="bp">+</span><span class="mi">5</span><span class="o">))</span><span class="bp">*</span>
      <span class="o">(</span><span class="n">psi</span> <span class="o">(</span><span class="n">n</span><span class="bp">/</span><span class="mi">2</span><span class="bp">+</span><span class="mi">2</span><span class="o">))</span><span class="bp">^</span><span class="mi">2</span> <span class="bp">-</span> <span class="o">(</span><span class="n">psi</span> <span class="o">(</span><span class="n">n</span><span class="bp">/</span><span class="mi">2</span><span class="bp">+</span><span class="mi">1</span><span class="o">))</span> <span class="bp">*</span> <span class="o">(</span><span class="n">psi</span> <span class="o">(</span><span class="n">n</span><span class="bp">/</span><span class="mi">2</span><span class="bp">+</span><span class="mi">4</span><span class="o">))</span><span class="bp">^</span><span class="mi">2</span><span class="o">)</span> <span class="c1">--/ (4*(x^3+A•x+B•x^0))</span>
      <span class="k">else</span>
  <span class="o">(</span><span class="n">psi</span> <span class="o">(</span><span class="n">n</span><span class="bp">/</span><span class="mi">2</span><span class="bp">+</span><span class="mi">4</span><span class="o">))</span> <span class="bp">*</span> <span class="o">(</span><span class="n">psi</span> <span class="o">(</span><span class="n">n</span><span class="bp">/</span><span class="mi">2</span><span class="bp">+</span><span class="mi">2</span><span class="o">))</span><span class="bp">^</span><span class="mi">3</span> <span class="bp">-</span> <span class="o">(</span><span class="n">psi</span> <span class="o">(</span><span class="n">n</span><span class="bp">/</span><span class="mi">2</span><span class="bp">+</span><span class="mi">1</span><span class="o">)</span> <span class="bp">*</span> <span class="o">(</span><span class="n">psi</span> <span class="o">(</span><span class="n">n</span><span class="bp">/</span><span class="mi">2</span><span class="bp">+</span><span class="mi">3</span><span class="o">))</span><span class="bp">^</span><span class="mi">3</span><span class="o">)</span>
</code></pre></div>
<p>but Lean complains about <code>decidable (even n)</code>. Also I'll have trouble dividing by a polynomial, I need to familiarize myself with that part of mathlib, but I'd have assumed that there is a has_div giving out junk when the numerator is not a multiple of the denominator, as usual.</p>



<a name="231159194"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Defining%20n-division%20polynomials/near/231159194" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Defining.20n-division.20polynomials.html#231159194">(Mar 20 2021 at 17:26)</a>:</h4>
<p>I'm surprised that it complains about <code>decidable (even n)</code>. But I guess you can replace it with <code>n % 2 = 0</code> or <code>open_locale classical</code>.</p>



<a name="231159216"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Defining%20n-division%20polynomials/near/231159216" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Defining.20n-division.20polynomials.html#231159216">(Mar 20 2021 at 17:27)</a>:</h4>
<p><code>n % 2 = 0</code> might be a bit easier, because it allows you to use <code>rfl</code> in a bit more places.</p>



<a name="231159233"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Defining%20n-division%20polynomials/near/231159233" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Defining.20n-division.20polynomials.html#231159233">(Mar 20 2021 at 17:27)</a>:</h4>
<p>Of course the other option is to write an instance for <code>decidable (even n)</code>. I didn't find it in mathlib with a quick search.</p>



<a name="231159305"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Defining%20n-division%20polynomials/near/231159305" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Defining.20n-division.20polynomials.html#231159305">(Mar 20 2021 at 17:29)</a>:</h4>
<p>Anyway, the first thing after this definition is probably simp-lemmas for <code>0</code>, <code>1</code>, <code>2</code>, <code>3</code>, <code>4</code>, <code>even n</code>, and <code>odd n</code>. Maybe also for <code>2n + 5</code> and <code>2n + 6</code>.</p>



<a name="231160535"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Defining%20n-division%20polynomials/near/231160535" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Defining.20n-division.20polynomials.html#231160535">(Mar 20 2021 at 17:49)</a>:</h4>
<p>And also I would be tempted to use polynomial.X rather than your x because there will be a bunch of lemmas about how X evaluates but you'll be constantly unfolding your x in order to make progress</p>



<a name="231161826"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Defining%20n-division%20polynomials/near/231161826" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Defining.20n-division.20polynomials.html#231161826">(Mar 20 2021 at 18:10)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">tactic</span>
<span class="kn">import</span> <span class="n">data.nat.parity</span>

<span class="kd">example</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="o">:</span> <span class="n">decidable</span> <span class="o">(</span><span class="n">even</span> <span class="n">n</span><span class="o">)</span> <span class="o">:=</span> <span class="n">infer_instance</span>
</code></pre></div>
<p>It is there, you just need the right import perhaps?</p>



<a name="231762168"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Defining%20n-division%20polynomials/near/231762168" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Marc Masdeu <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Defining.20n-division.20polynomials.html#231762168">(Mar 25 2021 at 08:23)</a>:</h4>
<p>For what is worth, I post the definition I settled on.</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">tactic</span>
<span class="kn">import</span> <span class="n">data.polynomial.basic</span>
<span class="kn">import</span> <span class="n">data.polynomial.div</span>
<span class="kn">import</span> <span class="n">data.nat.parity</span>
<span class="kn">open</span> <span class="n">polynomial</span>
<span class="kn">open</span> <span class="n">nat</span>

<span class="kd">noncomputable theory</span>
<span class="n">open_locale</span> <span class="n">classical</span>

<span class="kd">lemma</span> <span class="n">nhalves</span> <span class="o">{</span><span class="n">n</span> <span class="n">m</span> <span class="n">r</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">}</span> <span class="o">:</span>  <span class="n">n</span> <span class="bp">/</span> <span class="mi">2</span> <span class="bp">+</span> <span class="n">m</span> <span class="bp">&lt;</span> <span class="n">n</span> <span class="bp">+</span> <span class="n">m</span> <span class="bp">+</span> <span class="n">r</span> <span class="bp">+</span> <span class="mi">1</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="k">have</span> <span class="n">twopos</span> <span class="o">:</span> <span class="mi">0</span> <span class="bp">&lt;</span> <span class="mi">2</span><span class="o">,</span> <span class="kd">by</span> <span class="n">linarith</span><span class="o">,</span>
  <span class="k">have</span> <span class="o">:</span> <span class="n">n</span> <span class="bp">&lt;</span> <span class="mi">2</span><span class="bp">*</span><span class="o">(</span><span class="n">n</span><span class="bp">+</span><span class="mi">1</span><span class="o">),</span> <span class="kd">by</span> <span class="n">linarith</span><span class="o">,</span>
  <span class="k">suffices</span> <span class="o">:</span> <span class="n">n</span> <span class="bp">/</span> <span class="mi">2</span>  <span class="bp">&lt;</span> <span class="n">n</span><span class="bp">+</span><span class="mi">1</span><span class="o">,</span>
  <span class="kd">by</span> <span class="n">linarith</span><span class="o">,</span>
  <span class="n">exact</span> <span class="n">nat.div_lt_of_lt_mul</span> <span class="n">this</span><span class="o">,</span>
<span class="kd">end</span>

<span class="kd">lemma</span> <span class="n">nhalves'</span> <span class="o">{</span><span class="n">n</span> <span class="n">m</span> <span class="n">r</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">}</span> <span class="o">:</span> <span class="o">(</span><span class="n">n</span><span class="bp">+</span><span class="mi">1</span><span class="o">)</span><span class="bp">/</span><span class="mi">2</span> <span class="bp">+</span> <span class="n">m</span> <span class="bp">&lt;</span> <span class="n">n</span> <span class="bp">+</span> <span class="n">m</span> <span class="bp">+</span> <span class="n">r</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">:=</span>
<span class="kd">begin</span>
  <span class="k">suffices</span> <span class="o">:</span> <span class="o">(</span><span class="n">n</span><span class="bp">+</span><span class="mi">1</span><span class="o">)</span><span class="bp">/</span><span class="mi">2</span> <span class="bp">+</span> <span class="n">m</span> <span class="bp">&lt;</span> <span class="n">n</span> <span class="bp">+</span> <span class="n">m</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">,</span> <span class="kd">by</span> <span class="n">linarith</span><span class="o">,</span>
  <span class="k">suffices</span> <span class="o">:</span> <span class="o">(</span><span class="n">n</span><span class="bp">+</span><span class="mi">1</span><span class="o">)</span><span class="bp">/</span><span class="mi">2</span> <span class="bp">&lt;</span> <span class="n">n</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">,</span> <span class="kd">by</span> <span class="n">linarith</span><span class="o">,</span>
  <span class="n">exact</span> <span class="n">nat.div_lt_self'</span> <span class="n">n</span> <span class="mi">0</span><span class="o">,</span>
<span class="kd">end</span>

<span class="sd">/--</span>
<span class="sd">Define the "depleted" psi polynomials. They are Ψ as in Wikipedia,</span>
<span class="sd">but for even n we remove a factor of 2*y, thus making them one-variable.</span>
<span class="sd">-/</span>
<span class="kd">noncomputable</span> <span class="kd">def</span> <span class="n">psi</span> <span class="o">{</span><span class="n">R</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">comm_ring</span> <span class="n">R</span><span class="o">]</span> <span class="o">(</span><span class="n">A</span> <span class="n">B</span> <span class="o">:</span> <span class="n">R</span><span class="o">)</span> <span class="o">:</span> <span class="n">ℕ</span> <span class="bp">→</span> <span class="o">(</span><span class="n">polynomial</span> <span class="n">R</span><span class="o">)</span>
<span class="bp">|</span> <span class="mi">0</span> <span class="o">:=</span> <span class="o">(</span><span class="mi">0</span> <span class="o">:</span> <span class="n">polynomial</span> <span class="n">R</span><span class="o">)</span>
<span class="bp">|</span> <span class="mi">1</span> <span class="o">:=</span> <span class="o">(</span><span class="mi">1</span> <span class="o">:</span> <span class="n">polynomial</span> <span class="n">R</span><span class="o">)</span>
<span class="bp">|</span> <span class="mi">2</span> <span class="o">:=</span> <span class="o">(</span><span class="mi">1</span> <span class="o">:</span> <span class="n">polynomial</span> <span class="n">R</span><span class="o">)</span>
<span class="bp">|</span> <span class="mi">3</span> <span class="o">:=</span> <span class="mi">3</span><span class="bp">*</span><span class="n">X</span><span class="bp">^</span><span class="mi">4</span> <span class="bp">+</span> <span class="mi">6</span><span class="bp">*</span><span class="n">A</span><span class="bp">•</span><span class="n">X</span><span class="bp">^</span><span class="mi">2</span> <span class="bp">+</span> <span class="mi">12</span><span class="bp">*</span><span class="n">B</span><span class="bp">•</span><span class="n">X</span> <span class="bp">-</span> <span class="n">A</span><span class="bp">^</span><span class="mi">2</span><span class="bp">•</span><span class="mi">1</span>
<span class="bp">|</span> <span class="mi">4</span> <span class="o">:=</span> <span class="mi">2</span><span class="bp">*</span><span class="o">(</span><span class="n">X</span><span class="bp">^</span><span class="mi">6</span> <span class="bp">+</span> <span class="mi">5</span><span class="bp">*</span><span class="n">A</span><span class="bp">•</span><span class="n">X</span><span class="bp">^</span><span class="mi">4</span><span class="bp">+</span><span class="mi">20</span><span class="bp">*</span><span class="n">B</span><span class="bp">•</span><span class="n">X</span><span class="bp">^</span><span class="mi">3</span><span class="bp">-</span><span class="mi">5</span><span class="bp">*</span><span class="n">A</span><span class="bp">^</span><span class="mi">2</span><span class="bp">•</span><span class="n">X</span><span class="bp">^</span><span class="mi">2</span><span class="bp">-</span><span class="o">(</span><span class="mi">4</span><span class="bp">*</span><span class="n">A</span><span class="bp">*</span><span class="n">B</span><span class="o">)</span><span class="bp">•</span><span class="n">X</span><span class="bp">-</span><span class="n">A</span><span class="bp">^</span><span class="mi">3</span><span class="bp">•</span><span class="mi">1</span><span class="bp">-</span><span class="mi">8</span><span class="bp">*</span><span class="n">B</span><span class="bp">^</span><span class="mi">2</span><span class="bp">•</span><span class="mi">1</span><span class="o">)</span>
<span class="bp">|</span> <span class="o">(</span><span class="n">n</span><span class="bp">+</span><span class="mi">5</span><span class="o">)</span> <span class="o">:=</span>
  <span class="k">have</span> <span class="n">n</span><span class="bp">/</span><span class="mi">2</span><span class="bp">+</span><span class="mi">4</span> <span class="bp">&lt;</span> <span class="n">n</span><span class="bp">+</span><span class="mi">4</span><span class="bp">+</span><span class="mi">0</span><span class="bp">+</span><span class="mi">1</span> <span class="o">:=</span> <span class="n">nhalves</span><span class="o">,</span>
  <span class="k">have</span> <span class="n">n</span><span class="bp">/</span><span class="mi">2</span><span class="bp">+</span><span class="mi">3</span> <span class="bp">&lt;</span> <span class="n">n</span><span class="bp">+</span><span class="mi">3</span><span class="bp">+</span><span class="mi">1</span><span class="bp">+</span><span class="mi">1</span> <span class="o">:=</span> <span class="n">nhalves</span><span class="o">,</span>
  <span class="k">have</span> <span class="n">n</span><span class="bp">/</span><span class="mi">2</span><span class="bp">+</span><span class="mi">2</span> <span class="bp">&lt;</span> <span class="n">n</span><span class="bp">+</span><span class="mi">2</span><span class="bp">+</span><span class="mi">2</span><span class="bp">+</span><span class="mi">1</span> <span class="o">:=</span> <span class="n">nhalves</span><span class="o">,</span>
  <span class="k">have</span> <span class="n">n</span><span class="bp">/</span><span class="mi">2</span><span class="bp">+</span><span class="mi">1</span> <span class="bp">&lt;</span> <span class="n">n</span><span class="bp">+</span><span class="mi">1</span><span class="bp">+</span><span class="mi">3</span><span class="bp">+</span><span class="mi">1</span> <span class="o">:=</span> <span class="n">nhalves</span><span class="o">,</span>
  <span class="k">have</span> <span class="o">(</span><span class="n">n</span><span class="bp">+</span><span class="mi">1</span><span class="o">)</span><span class="bp">/</span><span class="mi">2</span> <span class="bp">&lt;</span> <span class="n">n</span><span class="bp">+</span><span class="mi">0</span><span class="bp">+</span><span class="mi">4</span><span class="bp">+</span><span class="mi">1</span> <span class="o">:=</span> <span class="bp">@</span><span class="n">nhalves'</span> <span class="n">_</span> <span class="mi">0</span> <span class="n">_</span><span class="o">,</span>
  <span class="k">have</span> <span class="o">(</span><span class="n">n</span><span class="bp">+</span><span class="mi">1</span><span class="o">)</span><span class="bp">/</span><span class="mi">2</span><span class="bp">+</span><span class="mi">1</span> <span class="bp">&lt;</span> <span class="n">n</span><span class="bp">+</span><span class="mi">1</span><span class="bp">+</span><span class="mi">3</span><span class="bp">+</span><span class="mi">1</span> <span class="o">:=</span> <span class="n">nhalves'</span><span class="o">,</span>
  <span class="k">have</span> <span class="o">(</span><span class="n">n</span><span class="bp">+</span><span class="mi">1</span><span class="o">)</span><span class="bp">/</span><span class="mi">2</span><span class="bp">+</span><span class="mi">2</span> <span class="bp">&lt;</span> <span class="n">n</span><span class="bp">+</span><span class="mi">2</span><span class="bp">+</span><span class="mi">2</span><span class="bp">+</span><span class="mi">1</span> <span class="o">:=</span> <span class="n">nhalves'</span><span class="o">,</span>
  <span class="k">have</span> <span class="o">(</span><span class="n">n</span><span class="bp">+</span><span class="mi">1</span><span class="o">)</span><span class="bp">/</span><span class="mi">2</span><span class="bp">+</span><span class="mi">3</span> <span class="bp">&lt;</span> <span class="n">n</span><span class="bp">+</span><span class="mi">3</span><span class="bp">+</span><span class="mi">1</span><span class="bp">+</span><span class="mi">1</span> <span class="o">:=</span> <span class="n">nhalves'</span><span class="o">,</span>
  <span class="k">have</span> <span class="o">(</span><span class="n">n</span><span class="bp">+</span><span class="mi">1</span><span class="o">)</span><span class="bp">/</span><span class="mi">2</span><span class="bp">+</span><span class="mi">4</span> <span class="bp">&lt;</span> <span class="n">n</span><span class="bp">+</span><span class="mi">4</span><span class="bp">+</span><span class="mi">0</span><span class="bp">+</span><span class="mi">1</span> <span class="o">:=</span> <span class="n">nhalves'</span><span class="o">,</span>
  <span class="k">if</span> <span class="n">even</span> <span class="n">n</span> <span class="k">then</span>
    <span class="k">if</span> <span class="n">even</span> <span class="o">(</span><span class="n">n</span> <span class="bp">/</span> <span class="mi">2</span><span class="o">)</span> <span class="k">then</span>
      <span class="mi">16</span><span class="bp">*</span><span class="o">(</span><span class="n">X</span><span class="bp">^</span><span class="mi">3</span><span class="bp">+</span><span class="n">A</span><span class="bp">•</span><span class="n">X</span><span class="bp">+</span><span class="n">B</span><span class="bp">•</span><span class="mi">1</span><span class="o">)</span><span class="bp">^</span><span class="mi">2</span> <span class="bp">*</span> <span class="n">psi</span> <span class="o">(</span><span class="n">n</span><span class="bp">/</span><span class="mi">2</span><span class="bp">+</span><span class="mi">4</span><span class="o">)</span> <span class="bp">*</span> <span class="o">(</span><span class="n">psi</span> <span class="o">(</span><span class="n">n</span><span class="bp">/</span><span class="mi">2</span><span class="bp">+</span><span class="mi">2</span><span class="o">))</span><span class="bp">^</span><span class="mi">3</span> <span class="bp">-</span> <span class="n">psi</span> <span class="o">(</span><span class="n">n</span><span class="bp">/</span><span class="mi">2</span><span class="bp">+</span><span class="mi">1</span><span class="o">)</span> <span class="bp">*</span> <span class="o">(</span><span class="n">psi</span> <span class="o">(</span><span class="n">n</span><span class="bp">/</span><span class="mi">2</span><span class="bp">+</span><span class="mi">3</span><span class="o">))</span><span class="bp">^</span><span class="mi">3</span>
    <span class="k">else</span>
      <span class="n">psi</span> <span class="o">(</span><span class="n">n</span><span class="bp">/</span><span class="mi">2</span><span class="bp">+</span><span class="mi">4</span><span class="o">)</span> <span class="bp">*</span> <span class="o">(</span><span class="n">psi</span> <span class="o">(</span><span class="n">n</span><span class="bp">/</span><span class="mi">2</span><span class="bp">+</span><span class="mi">2</span><span class="o">))</span><span class="bp">^</span><span class="mi">3</span> <span class="bp">-</span> <span class="mi">16</span><span class="bp">*</span><span class="o">(</span><span class="n">X</span><span class="bp">^</span><span class="mi">3</span><span class="bp">+</span><span class="n">A</span><span class="bp">•</span><span class="n">X</span><span class="bp">+</span><span class="n">B</span><span class="bp">•</span><span class="mi">1</span><span class="o">)</span><span class="bp">^</span><span class="mi">2</span> <span class="bp">*</span> <span class="n">psi</span> <span class="o">(</span><span class="n">n</span><span class="bp">/</span><span class="mi">2</span><span class="bp">+</span><span class="mi">1</span><span class="o">)</span> <span class="bp">*</span> <span class="o">(</span><span class="n">psi</span> <span class="o">(</span><span class="n">n</span><span class="bp">/</span><span class="mi">2</span><span class="bp">+</span><span class="mi">3</span><span class="o">))</span><span class="bp">^</span><span class="mi">3</span>
  <span class="k">else</span>
      <span class="o">(</span><span class="n">psi</span> <span class="o">((</span><span class="n">n</span><span class="bp">+</span><span class="mi">1</span><span class="o">)</span><span class="bp">/</span><span class="mi">2</span><span class="bp">+</span><span class="mi">2</span><span class="o">))</span> <span class="bp">*</span> <span class="o">((</span><span class="n">psi</span> <span class="o">((</span><span class="n">n</span><span class="bp">+</span><span class="mi">1</span><span class="o">)</span><span class="bp">/</span><span class="mi">2</span><span class="bp">+</span><span class="mi">4</span><span class="o">))</span> <span class="bp">*</span> <span class="o">(</span><span class="n">psi</span> <span class="o">((</span><span class="n">n</span><span class="bp">+</span><span class="mi">1</span><span class="o">)</span><span class="bp">/</span><span class="mi">2</span><span class="bp">+</span><span class="mi">1</span><span class="o">))</span><span class="bp">^</span><span class="mi">2</span> <span class="bp">-</span>
        <span class="n">psi</span> <span class="o">((</span><span class="n">n</span><span class="bp">+</span><span class="mi">1</span><span class="o">)</span><span class="bp">/</span><span class="mi">2</span><span class="o">)</span> <span class="bp">*</span> <span class="o">(</span><span class="n">psi</span> <span class="o">((</span><span class="n">n</span><span class="bp">+</span><span class="mi">1</span><span class="o">)</span><span class="bp">/</span><span class="mi">2</span><span class="bp">+</span><span class="mi">3</span><span class="o">))</span><span class="bp">^</span><span class="mi">2</span><span class="o">)</span>
</code></pre></div>
<p>I have been able to prove the lemma, for example, with quite a bit of work. But it would be useful to avoid having to write A B so many times in such statements. For my application, I'd like to "fix" A B throughout a namespace, and define something like mypsi (or better, Ψ) like <code>Ψ : ℕ → polynomial R := λ n, psi A B n</code>, but I don't know how to do it, really.</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">lemma</span> <span class="n">psi_two_times</span> <span class="o">{</span><span class="n">A</span> <span class="n">B</span> <span class="o">:</span> <span class="n">R</span><span class="o">}</span> <span class="o">{</span><span class="n">n</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">}</span>  <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="mi">2</span> <span class="bp">≤</span> <span class="n">n</span><span class="o">)</span> <span class="o">:</span>
 <span class="n">psi</span> <span class="n">A</span> <span class="n">B</span> <span class="o">(</span><span class="mi">2</span><span class="bp">*</span><span class="n">n</span><span class="o">)</span> <span class="bp">=</span> <span class="o">(</span><span class="n">psi</span> <span class="n">A</span> <span class="n">B</span> <span class="n">n</span><span class="o">)</span> <span class="bp">*</span> <span class="o">(</span><span class="n">psi</span> <span class="n">A</span> <span class="n">B</span> <span class="o">(</span><span class="n">n</span><span class="bp">+</span><span class="mi">2</span><span class="o">)</span> <span class="bp">*</span> <span class="o">(</span><span class="n">psi</span> <span class="n">A</span> <span class="n">B</span> <span class="o">(</span><span class="n">n</span><span class="bp">-</span><span class="mi">1</span><span class="o">))</span><span class="bp">^</span><span class="mi">2</span> <span class="bp">-</span>
  <span class="n">psi</span> <span class="n">A</span> <span class="n">B</span> <span class="o">(</span><span class="n">n</span><span class="bp">-</span><span class="mi">2</span><span class="o">)</span> <span class="bp">*</span> <span class="o">(</span><span class="n">psi</span> <span class="n">A</span> <span class="n">B</span> <span class="o">(</span><span class="n">n</span><span class="bp">+</span><span class="mi">1</span><span class="o">))</span><span class="bp">^</span><span class="mi">2</span> <span class="o">)</span> <span class="o">:=</span> <span class="gr">sorry</span>
</code></pre></div>



<a name="231763121"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Defining%20n-division%20polynomials/near/231763121" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Defining.20n-division.20polynomials.html#231763121">(Mar 25 2021 at 08:32)</a>:</h4>
<p><span class="user-mention" data-user-id="254058">@Marc Masdeu</span> One possibility would be to use notation for this:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">local</span> <span class="kd">notation</span> <span class="bp">`</span><span class="n">mypsi</span><span class="bp">`</span> <span class="o">:=</span> <span class="bp">`</span><span class="n">psi</span> <span class="n">A</span> <span class="n">B</span><span class="bp">`</span>
</code></pre></div>
<p>That way you don't have to write the <code>A</code> and <code>B</code> everywhere in your code. But they will still be visible in the goal window.</p>



<a name="231764093"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Defining%20n-division%20polynomials/near/231764093" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Defining.20n-division.20polynomials.html#231764093">(Mar 25 2021 at 08:41)</a>:</h4>
<p>you mean <code>local notation `mypsi` := psi A B</code></p>



<a name="231780667"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Defining%20n-division%20polynomials/near/231780667" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Defining.20n-division.20polynomials.html#231780667">(Mar 25 2021 at 11:01)</a>:</h4>
<p>Hi Marc!</p>
<p>Not at all related to the <code>A B</code> stuff, but the initial lemmas can be proved as follows.  I was actually surprised that <code>lemma nat.half_le_self</code> is not already in mathlib (and maybe it is?):</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">lemma</span> <span class="n">nat.half_le_self</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="o">:</span> <span class="o">(</span><span class="n">n</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)</span> <span class="bp">/</span> <span class="mi">2</span> <span class="bp">≤</span> <span class="n">n</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="n">cases</span> <span class="n">n</span><span class="o">,</span>
  <span class="o">{</span> <span class="n">exact</span> <span class="n">rfl.le</span> <span class="o">},</span>
  <span class="o">{</span> <span class="n">exact</span> <span class="n">nat.div_le_of_le_mul</span> <span class="o">(((</span><span class="n">add_le_add_iff_left</span> <span class="n">_</span><span class="o">)</span><span class="bp">.</span><span class="n">mpr</span> <span class="o">((</span><span class="mi">1</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span><span class="bp">.</span><span class="n">le_add_left</span> <span class="n">n</span><span class="o">))</span><span class="bp">.</span><span class="n">trans</span>
      <span class="o">(</span><span class="n">two_mul</span> <span class="n">_</span><span class="o">)</span><span class="bp">.</span><span class="n">symm.le</span><span class="o">)</span> <span class="o">}</span>
<span class="kd">end</span>

<span class="kd">lemma</span> <span class="n">nhalves</span> <span class="o">{</span><span class="n">n</span> <span class="n">m</span> <span class="n">r</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">}</span> <span class="o">:</span>  <span class="n">n</span> <span class="bp">/</span> <span class="mi">2</span> <span class="bp">+</span> <span class="n">m</span> <span class="bp">&lt;</span> <span class="n">n</span> <span class="bp">+</span> <span class="n">m</span> <span class="bp">+</span> <span class="n">r</span> <span class="bp">+</span> <span class="mi">1</span> <span class="o">:=</span>
<span class="o">(((</span><span class="n">add_le_add_iff_right</span> <span class="n">_</span><span class="o">)</span><span class="bp">.</span><span class="n">mpr</span> <span class="o">(</span><span class="n">n.div_le_self</span> <span class="mi">2</span><span class="o">))</span><span class="bp">.</span><span class="n">trans</span> <span class="o">(</span><span class="n">le.intro</span> <span class="n">rfl</span><span class="o">))</span><span class="bp">.</span><span class="n">trans_lt</span> <span class="o">(</span><span class="n">lt_add_one</span> <span class="n">_</span><span class="o">)</span>

<span class="kd">lemma</span> <span class="n">nhalves'</span> <span class="o">{</span><span class="n">n</span> <span class="n">m</span> <span class="n">r</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">}</span> <span class="o">:</span> <span class="o">(</span><span class="n">n</span><span class="bp">+</span><span class="mi">1</span><span class="o">)</span><span class="bp">/</span><span class="mi">2</span> <span class="bp">+</span> <span class="n">m</span> <span class="bp">&lt;</span> <span class="n">n</span> <span class="bp">+</span> <span class="n">m</span> <span class="bp">+</span> <span class="n">r</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">:=</span>
<span class="o">(((</span><span class="n">add_le_add_iff_right</span> <span class="n">_</span><span class="o">)</span><span class="bp">.</span><span class="n">mpr</span> <span class="n">n.half_le_self</span><span class="o">)</span><span class="bp">.</span><span class="n">trans</span> <span class="o">(</span><span class="n">le.intro</span> <span class="n">rfl</span><span class="o">))</span><span class="bp">.</span><span class="n">trans_lt</span> <span class="o">(</span><span class="n">lt_add_one</span> <span class="n">_</span><span class="o">)</span>
</code></pre></div>



<a name="231781243"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Defining%20n-division%20polynomials/near/231781243" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yakov Pechersky <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Defining.20n-division.20polynomials.html#231781243">(Mar 25 2021 at 11:05)</a>:</h4>
<p>Check if there is such a statement about div2</p>



<a name="231781506"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Defining%20n-division%20polynomials/near/231781506" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Defining.20n-division.20polynomials.html#231781506">(Mar 25 2021 at 11:08)</a>:</h4>
<p>I thought that I checked: besides <code>library_search</code>, I also tried with the autocomplete, but all my guesses failed.  I did find the one with <code>n / 2 ≤ n</code>, though...</p>



<a name="231781670"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Defining%20n-division%20polynomials/near/231781670" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Defining.20n-division.20polynomials.html#231781670">(Mar 25 2021 at 11:09)</a>:</h4>
<p>There is a possibly promising lemma, but I am not sure what it says:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">@[simp]</span> <span class="kd">lemma</span> <span class="n">div2_succ</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="o">:</span> <span class="n">div2</span> <span class="o">(</span><span class="n">succ</span> <span class="n">n</span><span class="o">)</span> <span class="bp">=</span> <span class="n">cond</span> <span class="o">(</span><span class="n">bodd</span> <span class="n">n</span><span class="o">)</span> <span class="o">(</span><span class="n">succ</span> <span class="o">(</span><span class="n">div2</span> <span class="n">n</span><span class="o">))</span> <span class="o">(</span><span class="n">div2</span> <span class="n">n</span><span class="o">)</span> <span class="o">:=</span>
<span class="kd">by</span> <span class="n">unfold</span> <span class="n">bodd</span> <span class="n">div2</span> <span class="n">bodd_div2</span><span class="bp">;</span> <span class="n">cases</span> <span class="n">bodd_div2</span> <span class="n">n</span><span class="bp">;</span> <span class="n">cases</span> <span class="n">fst</span><span class="bp">;</span> <span class="n">refl</span>
</code></pre></div>



<a name="231782171"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Defining%20n-division%20polynomials/near/231782171" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Defining.20n-division.20polynomials.html#231782171">(Mar 25 2021 at 11:13)</a>:</h4>
<p>Also, I am at the same time proud and ashamed of having guessed that <code>(0 + 1) / 2 ≤ 0</code> was</p>
<ul>
<li>true,</li>
<li>proved by <code>exact rfl.le</code>.</li>
</ul>



<a name="231782296"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Defining%20n-division%20polynomials/near/231782296" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Defining.20n-division.20polynomials.html#231782296">(Mar 25 2021 at 11:14)</a>:</h4>
<p>Johan, I wish I could add emoji reactions to your emoji reactions!  <span aria-label="lol" class="emoji emoji-1f606" role="img" title="lol">:lol:</span></p>



<a name="231810426"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Defining%20n-division%20polynomials/near/231810426" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Defining.20n-division.20polynomials.html#231810426">(Mar 25 2021 at 14:28)</a>:</h4>
<p>In case you find this helpful, I made a PR with the lemma <code>(n+1) / 2 ≤ n</code>.<br>
<a href="https://github.com/leanprover-community/mathlib/issues/6863">#6863</a></p>



<a name="232309772"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Defining%20n-division%20polynomials/near/232309772" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Defining.20n-division.20polynomials.html#232309772">(Mar 29 2021 at 18:00)</a>:</h4>
<p>Marc, <code>lemma nat.succ_half_le_self</code> did not survive the review process.  However, with the latest version of mathlib, what's below is also a proof.</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">lemma</span> <span class="n">nat.succ_half_le_self</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="o">:</span> <span class="o">(</span><span class="n">n</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)</span> <span class="bp">/</span> <span class="mi">2</span> <span class="bp">≤</span> <span class="n">n</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">div_le_iff_le_mul_add_pred</span> <span class="n">zero_lt_two</span><span class="o">)</span><span class="bp">.</span><span class="n">mpr</span> <span class="o">((</span><span class="n">add_le_add_iff_right</span> <span class="n">_</span><span class="o">)</span><span class="bp">.</span><span class="n">mpr</span>
  <span class="o">(</span><span class="n">le_mul_of_one_le_of_le</span> <span class="n">one_le_two</span> <span class="n">rfl.le</span><span class="o">))</span>
</code></pre></div>
<p>If you do not care about lines longer than 100 chars, it even fits on a single line. <span aria-label="upside down" class="emoji emoji-1f643" role="img" title="upside down">:upside_down:</span></p>



<a name="232312529"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Defining%20n-division%20polynomials/near/232312529" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bhavik Mehta <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Defining.20n-division.20polynomials.html#232312529">(Mar 29 2021 at 18:19)</a>:</h4>
<p>Every proof is a one line proof if you start far enough to the left <span aria-label="upside down" class="emoji emoji-1f643" role="img" title="upside down">:upside_down:</span></p>



<a name="232312884"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Defining%20n-division%20polynomials/near/232312884" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Defining.20n-division.20polynomials.html#232312884">(Mar 29 2021 at 18:22)</a>:</h4>
<p>By induction every proof fits in the margin?</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>