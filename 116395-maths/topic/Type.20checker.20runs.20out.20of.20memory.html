---
layout: archive
title: Zulip Chat Archive
permalink: /stream/116395-maths/topic/Type.20checker.20runs.20out.20of.20memory.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/116395-maths/index.html">maths</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Type.20checker.20runs.20out.20of.20memory.html">Type checker runs out of memory</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="319504016"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Type%20checker%20runs%20out%20of%20memory/near/319504016" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Quarrie <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Type.20checker.20runs.20out.20of.20memory.html#319504016">(Jan 05 2023 at 01:57)</a>:</h4>
<p>For some reason, whenever I try to typecheck my project I run into a compiler error that says that Lean ran out of memory at "type checker."</p>



<a name="319504127"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Type%20checker%20runs%20out%20of%20memory/near/319504127" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Quarrie <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Type.20checker.20runs.20out.20of.20memory.html#319504127">(Jan 05 2023 at 01:59)</a>:</h4>
<p>I searched the error in the Zulip archive and could only find one other instance of it, which was apparently resolved by getting up-to-date oleans. I tried this. It did not solve anything.</p>



<a name="319529885"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Type%20checker%20runs%20out%20of%20memory/near/319529885" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Type.20checker.20runs.20out.20of.20memory.html#319529885">(Jan 05 2023 at 07:46)</a>:</h4>
<p>Is this lean 3 or lean 4? Are you using mathlib?</p>



<a name="319573709"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Type%20checker%20runs%20out%20of%20memory/near/319573709" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Quarrie <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Type.20checker.20runs.20out.20of.20memory.html#319573709">(Jan 05 2023 at 12:23)</a>:</h4>
<p>Lean 3.50.3 with what was the latest version of mathlib a few weeks ago</p>



<a name="319574360"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Type%20checker%20runs%20out%20of%20memory/near/319574360" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mauricio Collares <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Type.20checker.20runs.20out.20of.20memory.html#319574360">(Jan 05 2023 at 12:26)</a>:</h4>
<p>Mathlib was only bumped to 3.50.3 a week ago. Are you using <code>elan</code>? It is highly recommended (over installing specific lean versions using your package manager, that is).</p>



<a name="319574940"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Type%20checker%20runs%20out%20of%20memory/near/319574940" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mauricio Collares <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Type.20checker.20runs.20out.20of.20memory.html#319574940">(Jan 05 2023 at 12:29)</a>:</h4>
<p>Any given mathlib commit is associated to a specific lean version (via the <code>leanpkg.toml</code>) file, and the oleans only work for that particular version. Elan takes care of that for you by downloading and using the version declared in the <code>leanpkg.toml</code> file.</p>



<a name="319575401"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Type%20checker%20runs%20out%20of%20memory/near/319575401" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Type.20checker.20runs.20out.20of.20memory.html#319575401">(Jan 05 2023 at 12:31)</a>:</h4>
<p>Are you working in mathlib itself or in a project which depends on mathlib? Does <code>leanproject get-m</code>, run in your project, fix the problem?</p>



<a name="319603912"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Type%20checker%20runs%20out%20of%20memory/near/319603912" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Quarrie <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Type.20checker.20runs.20out.20of.20memory.html#319603912">(Jan 05 2023 at 15:02)</a>:</h4>
<p><span class="user-mention silent" data-user-id="325367">Mauricio Collares</span> <a href="#narrow/stream/116395-maths/topic/Type.20checker.20runs.20out.20of.20memory/near/319574360">said</a>:</p>
<blockquote>
<p>Mathlib was only bumped to 3.50.3 a week ago. Are you using <code>elan</code>? It is highly recommended (over installing specific lean versions using your package manager, that is).</p>
</blockquote>
<p>Yes, I am using elan/leanproject, learned that the hard way lol</p>



<a name="319603953"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Type%20checker%20runs%20out%20of%20memory/near/319603953" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Quarrie <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Type.20checker.20runs.20out.20of.20memory.html#319603953">(Jan 05 2023 at 15:02)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110038">Kevin Buzzard</span> <a href="#narrow/stream/116395-maths/topic/Type.20checker.20runs.20out.20of.20memory/near/319575401">said</a>:</p>
<blockquote>
<p>Are you working in mathlib itself or in a project which depends on mathlib? Does <code>leanproject get-m</code>, run in your project, fix the problem?</p>
</blockquote>
<p>Depends on mathlib, and I already checked</p>



<a name="319606993"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Type%20checker%20runs%20out%20of%20memory/near/319606993" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Type.20checker.20runs.20out.20of.20memory.html#319606993">(Jan 05 2023 at 15:16)</a>:</h4>
<p>After <code>leanproject get-m</code>, what happens if you try <code>leanproject build</code> on the command line?</p>



<a name="319614047"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Type%20checker%20runs%20out%20of%20memory/near/319614047" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Quarrie <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Type.20checker.20runs.20out.20of.20memory.html#319614047">(Jan 05 2023 at 15:52)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110038">Kevin Buzzard</span> <a href="#narrow/stream/116395-maths/topic/Type.20checker.20runs.20out.20of.20memory/near/319606993">said</a>:</p>
<blockquote>
<p>After <code>leanproject get-m</code>, what happens if you try <code>leanproject build</code> on the command line?</p>
</blockquote>
<p>Well, I get a bunch of compiler errors that imply that none of the import statements are being accepted, and in VSCode itself I still get this error on the imports</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">invalid</span> <span class="kn">import</span><span class="o">:</span> <span class="n">data.option.defs</span>
<span class="n">excessive</span> <span class="n">memory</span> <span class="n">consumption</span> <span class="n">detected</span> <span class="n">at</span> <span class="bp">'</span><span class="n">type</span> <span class="n">checker'</span> <span class="o">(</span><span class="n">potential</span> <span class="n">solution</span><span class="o">:</span> <span class="n">increase</span> <span class="n">memory</span> <span class="n">consumption</span> <span class="n">threshold</span><span class="o">)</span>
</code></pre></div>



<a name="319614540"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Type%20checker%20runs%20out%20of%20memory/near/319614540" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Type.20checker.20runs.20out.20of.20memory.html#319614540">(Jan 05 2023 at 15:54)</a>:</h4>
<p>Just to be clear -- are you trying <code>leanproject build</code> in the root directory of your project? What does <code>lean --make src/</code> do? If imports aren't being accepted then your project is corrupt in some way. Perhaps you want to post the <code>leanpkg.path</code> and <code>leanpkg.toml</code> from your project.</p>



<a name="319615314"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Type%20checker%20runs%20out%20of%20memory/near/319615314" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Quarrie <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Type.20checker.20runs.20out.20of.20memory.html#319615314">(Jan 05 2023 at 15:59)</a>:</h4>
<p>lean --make src/ parses the entirety of mathlib.</p>



<a name="319615356"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Type%20checker%20runs%20out%20of%20memory/near/319615356" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Quarrie <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Type.20checker.20runs.20out.20of.20memory.html#319615356">(Jan 05 2023 at 15:59)</a>:</h4>
<p>and yes, I am running build from project root</p>



<a name="319615404"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Type%20checker%20runs%20out%20of%20memory/near/319615404" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Quarrie <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Type.20checker.20runs.20out.20of.20memory.html#319615404">(Jan 05 2023 at 15:59)</a>:</h4>
<p>leanpkg.path</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">builtin_path</span>
<span class="n">path</span> <span class="n">_target</span><span class="bp">/</span><span class="n">deps</span><span class="bp">/</span><span class="n">mathlib</span><span class="bp">/</span><span class="n">src</span>
<span class="n">path</span> <span class="bp">./</span><span class="n">src</span>
</code></pre></div>
<p>leanpkg.toml</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="o">[</span><span class="n">package</span><span class="o">]</span>
<span class="n">name</span> <span class="bp">=</span> <span class="s2">"mathlib-tensor-lib"</span>
<span class="n">version</span> <span class="bp">=</span> <span class="s2">"0.1"</span>
<span class="n">lean_version</span> <span class="bp">=</span> <span class="s2">"leanprover-community/lean:3.50.3"</span>
<span class="n">path</span> <span class="bp">=</span> <span class="s2">"src"</span>

<span class="o">[</span><span class="n">dependencies</span><span class="o">]</span>
<span class="n">mathlib</span> <span class="bp">=</span> <span class="o">{</span><span class="n">git</span> <span class="bp">=</span> <span class="s2">"https://github.com/leanprover-community/mathlib"</span><span class="o">,</span> <span class="n">rev</span> <span class="bp">=</span> <span class="s2">"46a64b5b4268c594af770c44d9e502afc6a515cb"</span><span class="o">}</span>
</code></pre></div>



<a name="319615858"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Type%20checker%20runs%20out%20of%20memory/near/319615858" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Type.20checker.20runs.20out.20of.20memory.html#319615858">(Jan 05 2023 at 16:01)</a>:</h4>
<p>and what's the output of <code>leanproject get-m</code>?</p>



<a name="319616642"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Type%20checker%20runs%20out%20of%20memory/near/319616642" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Quarrie <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Type.20checker.20runs.20out.20of.20memory.html#319616642">(Jan 05 2023 at 16:04)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">Looking</span> <span class="n">for</span> <span class="n">mathlib</span> <span class="n">oleans</span> <span class="n">for</span> <span class="mi">46</span><span class="n">a64b5b42</span>
  <span class="n">locally...</span>
  <span class="n">Found</span> <span class="kn">local</span> <span class="n">mathlib</span> <span class="n">oleans</span>
<span class="n">Located</span> <span class="n">matching</span> <span class="n">cache</span>
<span class="n">Applying</span> <span class="n">cache</span>
  <span class="n">files</span> <span class="n">extracted</span><span class="o">:</span> <span class="mi">3020</span> <span class="o">[</span><span class="mi">00</span><span class="o">:</span><span class="mi">15</span><span class="o">,</span> <span class="mi">193</span><span class="bp">.</span><span class="mi">30</span><span class="bp">/</span><span class="n">s</span><span class="o">]</span>
</code></pre></div>



<a name="319616670"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Type%20checker%20runs%20out%20of%20memory/near/319616670" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Type.20checker.20runs.20out.20of.20memory.html#319616670">(Jan 05 2023 at 16:04)</a>:</h4>
<p>Assuming it just downloads oleans as normal, the most common issue which causes errors such as yours is that someone has edited your set-up of core Lean by accident (e.g. by jumping to definition and then pressing a key). You can fix this with brute force uninstalling Lean 3.50.3 with <code>rm -rf ~/.elan/toolchains/leanprover-community--lean---3.50.3 ~/.elan/update-hashes/leanprover-community--lean---3.50.3</code> and then trying <code>lean --make src</code> again; then <code>elan</code> should redownload Lean and hopefully it fixes your problem.</p>



<a name="319616999"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Type%20checker%20runs%20out%20of%20memory/near/319616999" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Quarrie <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Type.20checker.20runs.20out.20of.20memory.html#319616999">(Jan 05 2023 at 16:06)</a>:</h4>
<p>Trying that nwo</p>



<a name="320773983"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Type%20checker%20runs%20out%20of%20memory/near/320773983" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Quarrie <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Type.20checker.20runs.20out.20of.20memory.html#320773983">(Jan 11 2023 at 18:56)</a>:</h4>
<p>It did not, in fact, fix my problem.</p>



<a name="320789276"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Type%20checker%20runs%20out%20of%20memory/near/320789276" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Quarrie <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Type.20checker.20runs.20out.20of.20memory.html#320789276">(Jan 11 2023 at 20:17)</a>:</h4>
<p>Is it possible to update the leanproject utility in-place? I tested creating a new project, and it seems to think the latest Lean version is 3.33.0 even though 3.50.3 is the only one I have installed.</p>



<a name="320962862"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Type%20checker%20runs%20out%20of%20memory/near/320962862" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Type.20checker.20runs.20out.20of.20memory.html#320962862">(Jan 12 2023 at 15:15)</a>:</h4>
<p>There is some debugging output when you make a new project which at some point essentially prints out a random version of Lean. Are you sure that your new project thinks it's on 3.33.0, or was this part of random debugging output? What does the <code>leanpkg.toml</code> have to say about the matter? That is the source of truth.</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>