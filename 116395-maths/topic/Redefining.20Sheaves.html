---
layout: archive
title: Zulip Chat Archive
permalink: /stream/116395-maths/topic/Redefining.20Sheaves.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/116395-maths/index.html">maths</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Redefining.20Sheaves.html">Redefining Sheaves</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="263308542"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Redefining%20Sheaves/near/263308542" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Redefining.20Sheaves.html#263308542">(Dec 01 2021 at 15:36)</a>:</h4>
<p>I have found it fairly annoying working with <code>Sheaf J A</code> as it's currently defined <a href="https://leanprover-community.github.io/mathlib_docs/find/category_theory.Sheaf">docs#category_theory.Sheaf</a> and I'm fairly certain the source of the issues come from the fact that <code>Sheaf J A</code> is defined as the subtype <code>{P : Cᵒᵖ ⥤ A // presheaf.is_sheaf J P}</code>. Lean is happy to <code>dsimp</code>lify <code>P.val</code> to <code>↑P</code>, and that makes it difficult for automation to work. </p>
<p>So, I would like to redefine <code>Sheaf J A</code> as </p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">structure</span> <span class="n">Sheaf</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">to_presheaf</span> <span class="o">:</span> <span class="n">C</span><span class="bp">ᵒᵖ</span> <span class="bp">⥤</span> <span class="n">A</span><span class="o">)</span>
<span class="o">(</span><span class="n">condition</span> <span class="o">:</span> <span class="n">presheaf.is_sheaf</span> <span class="n">J</span> <span class="n">to_presheaf</span><span class="o">)</span>
</code></pre></div>
<p>with no additional coercions, so that we can have more precise control for when a sheaf is considered as a presheaf.</p>
<p>Another question is whether we want morphisms of sheaves to be <em>defined</em> as natural transformations or as something like this:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">structure</span> <span class="n">hom</span> <span class="o">(</span><span class="n">X</span> <span class="n">Y</span> <span class="o">:</span> <span class="n">Sheaf</span> <span class="n">J</span> <span class="n">A</span><span class="o">)</span> <span class="o">:=</span>
<span class="n">mk</span> <span class="o">::</span> <span class="o">(</span><span class="n">presheaf_hom</span> <span class="o">:</span> <span class="n">X.to_presheaf</span> <span class="bp">⟶</span> <span class="n">Y.to_presheaf</span><span class="o">)</span>
</code></pre></div>
<p>Again, I think it could be useful to have more precise control for deciding when a morphism of sheaves should be seen as "just" another natural transformation.</p>
<p>What do people think about this?</p>



<a name="263308648"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Redefining%20Sheaves/near/263308648" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Redefining.20Sheaves.html#263308648">(Dec 01 2021 at 15:37)</a>:</h4>
<p>Ping <span class="user-mention" data-user-id="112680">@Johan Commelin</span> <span class="user-mention" data-user-id="439483">@Andrew Yang</span> <span class="user-mention" data-user-id="246273">@Bhavik Mehta</span> <span class="user-mention" data-user-id="110087">@Scott Morrison</span></p>



<a name="263310483"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Redefining%20Sheaves/near/263310483" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Redefining.20Sheaves.html#263310483">(Dec 01 2021 at 15:49)</a>:</h4>
<p>I agree. The only downside is that <code>to_presheaf</code> is pretty long.</p>



<a name="263310561"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Redefining%20Sheaves/near/263310561" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Redefining.20Sheaves.html#263310561">(Dec 01 2021 at 15:50)</a>:</h4>
<p>Maybe reusing <code>val</code> as the field name isn't too evil?</p>



<a name="263311257"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Redefining%20Sheaves/near/263311257" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Redefining.20Sheaves.html#263311257">(Dec 01 2021 at 15:54)</a>:</h4>
<p>Sure, <code>val</code> is fine. What do you think about redefining the morphisms as well? I'm less convinced about that</p>



<a name="263314983"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Redefining%20Sheaves/near/263314983" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bhavik Mehta <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Redefining.20Sheaves.html#263314983">(Dec 01 2021 at 16:16)</a>:</h4>
<p>I'm not opposed to either of these changes, but I wonder if what you want can be achieved in a simpler way. For instance, we had the change of <code>fin</code> being defined as a structure to a subtype, and this is essentially the reverse direction. I'm actually slightly more convinced about the morphisms change (it might even be a good idea for subcategories in general?)</p>



<a name="263317388"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Redefining%20Sheaves/near/263317388" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Justus Springer <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Redefining.20Sheaves.html#263317388">(Dec 01 2021 at 16:32)</a>:</h4>
<p>This has been discussed shortly in my PR <a href="https://github.com/leanprover-community/mathlib/issues/9607">#9607</a>, where I changed the definition of a sheaf on a topological space into a subtype. I have also found the distinction between morphisms of presheaves vs morphisms of sheaves a bit annoying in the past. Maybe having more precise control over the coercions will make it better.</p>



<a name="263318548"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Redefining%20Sheaves/near/263318548" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Justus Springer <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Redefining.20Sheaves.html#263318548">(Dec 01 2021 at 16:38)</a>:</h4>
<p>If you redefine sheaves on sites in that way, sheaves on spaces should probably be changed as well. Better still, sheaves on spaces should finally be defined as a special case of sheaves on sites. But this might be a slightly bigger project, I'm not sure. Note that I connected the sheaf conditions on either side to each other back in <a href="https://github.com/leanprover-community/mathlib/issues/9609">#9609</a>.</p>



<a name="263321099"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Redefining%20Sheaves/near/263321099" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Redefining.20Sheaves.html#263321099">(Dec 01 2021 at 16:55)</a>:</h4>
<p>As far as I can tell, the coercion from <code>Sheaf J A</code> to <code>C\op \func A</code> in this case only causes pain with essentially no gain.  And since we have a <code>dsimp</code> lemma which will always trigger to change <code>S.val</code> to <code>↑S</code>, we would not be able to, for example, use <code>S.val</code> in statements of theorems if we then want to freely use <code>dsimp</code>in the proof. This is an issue if we want to write, e.g., <code>S.val.map f</code> or something like that. As far as I can tell, this means that we cannot use subtypes to define <code>Sheaf J A</code> if we want to avoid such problems.</p>



<a name="263324731"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Redefining%20Sheaves/near/263324731" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bhavik Mehta <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Redefining.20Sheaves.html#263324731">(Dec 01 2021 at 17:19)</a>:</h4>
<p>Isn't this the same thing which happens with any subtype? Lemmas shouldn't be written in terms of <code>S.val</code>, but instead in terms of the coercion, and then <code>dsimp</code> doing that conversion won't be an issue</p>



<a name="263325403"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Redefining%20Sheaves/near/263325403" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Redefining.20Sheaves.html#263325403">(Dec 01 2021 at 17:23)</a>:</h4>
<p>I don't think <code>↑S.map f</code> works.</p>



<a name="263325492"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Redefining%20Sheaves/near/263325492" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bhavik Mehta <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Redefining.20Sheaves.html#263325492">(Dec 01 2021 at 17:24)</a>:</h4>
<p><code>(S : C\op \func A).map f</code> does - and this is the usual pattern across mathlib for subtypes</p>



<a name="263325493"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Redefining%20Sheaves/near/263325493" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Redefining.20Sheaves.html#263325493">(Dec 01 2021 at 17:24)</a>:</h4>
<p>Yeah, that means we would have to duplicate a bunch of presheaf-API for sheaves.</p>



<a name="263325535"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Redefining%20Sheaves/near/263325535" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Redefining.20Sheaves.html#263325535">(Dec 01 2021 at 17:24)</a>:</h4>
<p>That might be the cleanest option. But it's also a lot of repetition. Pretty non-DRY</p>



<a name="263325577"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Redefining%20Sheaves/near/263325577" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bhavik Mehta <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Redefining.20Sheaves.html#263325577">(Dec 01 2021 at 17:25)</a>:</h4>
<p>It might also mean we'd duplicate a bunch of subtype-API for sheaves (again comparing to the <code>fin</code> change)</p>



<a name="263325963"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Redefining%20Sheaves/near/263325963" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Redefining.20Sheaves.html#263325963">(Dec 01 2021 at 17:27)</a>:</h4>
<p><span class="user-mention silent" data-user-id="112680">Johan Commelin</span> <a href="#narrow/stream/116395-maths/topic/Redefining.20Sheaves/near/263325493">said</a>:</p>
<blockquote>
<p>Yeah, that means we would have to duplicate a bunch of presheaf-API for sheaves.</p>
</blockquote>
<p>No it doesn't. If you want to use the presheaf API, you would write <code>F.val</code>.</p>



<a name="263326651"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Redefining%20Sheaves/near/263326651" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Redefining.20Sheaves.html#263326651">(Dec 01 2021 at 17:31)</a>:</h4>
<p>I meant that if we want to keep using subtypes, then it might make sense to do</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">def</span> <span class="n">sheaf.map</span> <span class="o">(</span><span class="n">F</span> <span class="o">:</span> <span class="n">sheaf</span> <span class="n">J</span> <span class="n">D</span><span class="o">)</span> <span class="o">:=</span> <span class="n">F.val.map</span>
</code></pre></div>
<p>etc...</p>



<a name="263326967"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Redefining%20Sheaves/near/263326967" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Redefining.20Sheaves.html#263326967">(Dec 01 2021 at 17:33)</a>:</h4>
<p>Let's take a vote...</p>



<a name="263327065"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Redefining%20Sheaves/near/263327065" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Redefining.20Sheaves.html#263327065">(Dec 01 2021 at 17:34)</a>:</h4>
<p>(how do you make polls again?)</p>



<a name="263327241"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Redefining%20Sheaves/near/263327241" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Redefining.20Sheaves.html#263327241">(Dec 01 2021 at 17:35)</a>:</h4>
<p>/poll <br>
Redefine Sheaf as a structure, leave morphisms of sheaves as is<br>
Leave Sheaf as a subtype, redefine morphisms as a structure<br>
Redefine Sheaves and morphisms of sheaves as structures<br>
Leave everything alone</p>



<a name="263327288"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Redefining%20Sheaves/near/263327288" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Redefining.20Sheaves.html#263327288">(Dec 01 2021 at 17:35)</a>:</h4>
<p>I messed up</p>



<a name="263327406"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Redefining%20Sheaves/near/263327406" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Redefining.20Sheaves.html#263327406">(Dec 01 2021 at 17:36)</a>:</h4>
<p>It definitely seems to me that making automation work better / finding workarounds is better long-term than defining bespoke subtypes every time we hit an issue with them. But as I haven't tried using sheaves I don't actually feel qualified to vote lol</p>



<a name="263327615"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Redefining%20Sheaves/near/263327615" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Redefining.20Sheaves.html#263327615">(Dec 01 2021 at 17:37)</a>:</h4>
<p>Alex I think this is a pretty special case, because we already have a lot of automation built up for functors.</p>



<a name="263327803"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Redefining%20Sheaves/near/263327803" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Redefining.20Sheaves.html#263327803">(Dec 01 2021 at 17:38)</a>:</h4>
<p>/poll Redefining Sheaves<br>
Redefine Sheaf as a structure, leave morphisms of sheaves as is<br>
Leave Sheaf as a subtype, redefine morphisms as a structure<br>
Redefine Sheaves and morphisms of sheaves as structures<br>
Leave everything alone</p>



<a name="263327943"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Redefining%20Sheaves/near/263327943" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Redefining.20Sheaves.html#263327943">(Dec 01 2021 at 17:39)</a>:</h4>
<p>I vote for "all or nothing"</p>



<a name="263329130"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Redefining%20Sheaves/near/263329130" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Redefining.20Sheaves.html#263329130">(Dec 01 2021 at 17:47)</a>:</h4>
<p>If there is only one simp lemma that is annoying does adding <code>local attribute [-simp] subtype.val_eq_coe</code> whenever the automation fails help? Or is there more to the Sheaf as subtype issue?</p>



<a name="263329440"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Redefining%20Sheaves/near/263329440" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Redefining.20Sheaves.html#263329440">(Dec 01 2021 at 17:49)</a>:</h4>
<p>So you propose to add that local attribute to every file that involves sheaves?</p>



<a name="263329901"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Redefining%20Sheaves/near/263329901" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Redefining.20Sheaves.html#263329901">(Dec 01 2021 at 17:52)</a>:</h4>
<p>Well only those where automation fails I suppose. But I don't know the explicit examples you do, so I have no idea how widespread the issue is</p>



<a name="263340000"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Redefining%20Sheaves/near/263340000" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Redefining.20Sheaves.html#263340000">(Dec 01 2021 at 19:00)</a>:</h4>
<p>(deleted)</p>



<a name="263340316"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Redefining%20Sheaves/near/263340316" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Redefining.20Sheaves.html#263340316">(Dec 01 2021 at 19:02)</a>:</h4>
<p>Sorry, that was my mistake</p>



<a name="263343514"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Redefining%20Sheaves/near/263343514" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Redefining.20Sheaves.html#263343514">(Dec 01 2021 at 19:22)</a>:</h4>
<p>Option 5:  Redefine full subcategories in general:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">category_theory.full_subcategory</span>

<span class="kn">open</span> <span class="n">category_theory</span>

<span class="kd">variables</span> <span class="o">{</span><span class="n">C</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">category</span> <span class="n">C</span><span class="o">]</span>

<span class="kd">structure</span> <span class="n">full_subcategory</span> <span class="o">(</span><span class="n">P</span> <span class="o">:</span> <span class="n">C</span> <span class="bp">→</span> <span class="kt">Prop</span><span class="o">)</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">val</span> <span class="o">:</span> <span class="n">C</span><span class="o">)</span>
<span class="o">(</span><span class="n">prop</span> <span class="o">:</span> <span class="n">P</span> <span class="n">val</span><span class="o">)</span>

<span class="kn">namespace</span> <span class="n">full_subcategory</span>

<span class="kd">@[ext]</span>
<span class="kd">structure</span> <span class="n">hom</span> <span class="o">{</span><span class="n">P</span> <span class="o">:</span> <span class="n">C</span> <span class="bp">→</span> <span class="kt">Prop</span><span class="o">}</span> <span class="o">(</span><span class="n">X</span> <span class="n">Y</span> <span class="o">:</span> <span class="n">full_subcategory</span> <span class="n">P</span><span class="o">)</span> <span class="o">:=</span>
<span class="n">mk</span> <span class="o">::</span> <span class="o">(</span><span class="n">val</span> <span class="o">:</span> <span class="n">X.val</span> <span class="bp">⟶</span> <span class="n">Y.val</span><span class="o">)</span>

<span class="kd">@[simps]</span>
<span class="kd">instance</span> <span class="n">category</span> <span class="o">{</span><span class="n">P</span> <span class="o">:</span> <span class="n">C</span> <span class="bp">→</span> <span class="kt">Prop</span><span class="o">}</span> <span class="o">:</span> <span class="n">category</span> <span class="o">(</span><span class="n">full_subcategory</span> <span class="n">P</span><span class="o">)</span> <span class="o">:=</span>
<span class="o">{</span> <span class="n">hom</span> <span class="o">:=</span> <span class="n">hom</span><span class="o">,</span>
  <span class="n">id</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">X</span><span class="o">,</span> <span class="o">⟨</span><span class="mi">𝟙</span> <span class="n">_</span><span class="o">⟩,</span>
  <span class="n">comp</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">X</span> <span class="n">Y</span> <span class="n">Z</span> <span class="n">f</span> <span class="n">g</span><span class="o">,</span> <span class="o">⟨</span><span class="n">f.val</span> <span class="bp">≫</span> <span class="n">g.val</span><span class="o">⟩</span> <span class="o">}</span>

<span class="k">#check</span> <span class="bp">@</span><span class="n">full_subcategory.category_id_val</span>
<span class="c">/-</span><span class="cm"></span>
<span class="cm">category_id_val :</span>
<span class="cm">  ∀ {C : Type u_3} [_inst_1 : category_theory.category C] {P : C → Prop} (X : full_subcategory P),</span>
<span class="cm">    (𝟙 X).val = 𝟙 X.val</span>
<span class="cm">-/</span>

<span class="k">#check</span> <span class="bp">@</span><span class="n">full_subcategory.category_comp_val</span>
<span class="c">/-</span><span class="cm"></span>
<span class="cm">category_comp_val :</span>
<span class="cm">  ∀ {C : Type u_3} [_inst_1 : category_theory.category C] {P : C → Prop} (X Y Z : full_subcategory P) (f : X ⟶ Y)</span>
<span class="cm">  (g : Y ⟶ Z), (f ≫ g).val = f.val ≫ g.val</span>
<span class="cm">-/</span>

<span class="kd">@[simps]</span>
<span class="kd">def</span> <span class="n">inclusion</span> <span class="o">{</span><span class="n">P</span> <span class="o">:</span> <span class="n">C</span> <span class="bp">→</span> <span class="kt">Prop</span><span class="o">}</span> <span class="o">:</span> <span class="n">full_subcategory</span> <span class="n">P</span> <span class="bp">⥤</span> <span class="n">C</span> <span class="o">:=</span>
<span class="o">{</span> <span class="n">obj</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">X</span><span class="o">,</span> <span class="n">X.val</span><span class="o">,</span>
  <span class="n">map</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">X</span> <span class="n">Y</span> <span class="n">f</span><span class="o">,</span> <span class="n">f.val</span> <span class="o">}</span>

<span class="k">#check</span> <span class="bp">@</span><span class="n">inclusion_obj</span>
<span class="c">/-</span><span class="cm"></span>
<span class="cm">inclusion_obj :</span>
<span class="cm">  ∀ {C : Type u_3} [_inst_1 : category_theory.category C] {P : C → Prop} (X : full_subcategory P),</span>
<span class="cm">    inclusion.obj X = X.val</span>
<span class="cm">-/</span>

<span class="k">#check</span> <span class="bp">@</span><span class="n">inclusion_map</span>
<span class="c">/-</span><span class="cm"></span>
<span class="cm">inclusion_map :</span>
<span class="cm">  ∀ {C : Type u_3} [_inst_1 : category_theory.category C] {P : C → Prop} (X Y : full_subcategory P) (f : X ⟶ Y),</span>
<span class="cm">    inclusion.map f = f.val</span>
<span class="cm">-/</span>

<span class="kd">end</span> <span class="n">full_subcategory</span>
</code></pre></div>



<a name="263428367"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Redefining%20Sheaves/near/263428367" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Redefining.20Sheaves.html#263428367">(Dec 02 2021 at 12:21)</a>:</h4>
<p>I've opened a PR that cleans up some of the <code>simp</code>s involved with sheaves here <a href="https://github.com/leanprover-community/mathlib/issues/10574">#10574</a><br>
Note that I had to add </p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">@[simp]</span> <span class="kd">lemma</span> <span class="n">id_app</span> <span class="o">(</span><span class="n">X</span> <span class="o">:</span> <span class="n">Sheaf</span> <span class="n">J</span> <span class="n">A</span><span class="o">)</span> <span class="o">(</span><span class="n">B</span> <span class="o">:</span> <span class="n">C</span><span class="bp">ᵒᵖ</span><span class="o">)</span> <span class="o">:</span> <span class="o">(</span><span class="mi">𝟙</span> <span class="n">X</span> <span class="o">:</span> <span class="n">X</span> <span class="bp">⟶</span> <span class="n">X</span><span class="o">)</span><span class="bp">.</span><span class="n">app</span> <span class="n">B</span> <span class="bp">=</span> <span class="mi">𝟙</span> <span class="n">_</span> <span class="o">:=</span> <span class="n">rfl</span>
<span class="kd">@[simp]</span> <span class="kd">lemma</span> <span class="n">comp_app</span> <span class="o">{</span><span class="n">X</span> <span class="n">Y</span> <span class="n">Z</span> <span class="o">:</span> <span class="n">Sheaf</span> <span class="n">J</span> <span class="n">A</span><span class="o">}</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">X</span> <span class="bp">⟶</span> <span class="n">Y</span><span class="o">)</span> <span class="o">(</span><span class="n">g</span> <span class="o">:</span> <span class="n">Y</span> <span class="bp">⟶</span> <span class="n">Z</span><span class="o">)</span> <span class="o">(</span><span class="n">B</span> <span class="o">:</span> <span class="n">C</span><span class="bp">ᵒᵖ</span><span class="o">)</span> <span class="o">:</span>
  <span class="o">(</span><span class="n">f</span> <span class="bp">≫</span> <span class="n">g</span><span class="o">)</span><span class="bp">.</span><span class="n">app</span> <span class="n">B</span> <span class="bp">=</span> <span class="n">f.app</span> <span class="n">B</span> <span class="bp">≫</span> <span class="n">g.app</span> <span class="n">B</span> <span class="o">:=</span> <span class="n">rfl</span>
</code></pre></div>
<p>which <code>dsimp, simp</code> was not able to close. I think this is a first example of what <span class="user-mention" data-user-id="112680">@Johan Commelin</span> was mentioning above regarding needing to copy some of the API for functors, which I don't think is very ideal.</p>



<a name="264219894"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Redefining%20Sheaves/near/264219894" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Redefining.20Sheaves.html#264219894">(Dec 08 2021 at 21:02)</a>:</h4>
<p>I ran into yet another annoying issue in LTE regarding the current deffinition of the category of sheaves. I added a comment here:<br>
<a href="https://github.com/leanprover-community/lean-liquid/blob/890de421fb657301057d418f6a19085b7e2494cb/src/condensed/adjunctions.lean#L58">https://github.com/leanprover-community/lean-liquid/blob/890de421fb657301057d418f6a19085b7e2494cb/src/condensed/adjunctions.lean#L58</a></p>
<p>And this prompted me to actually write a PR redefining sheaves per the discussion above -- <a href="https://github.com/leanprover-community/mathlib/issues/10678">#10678</a></p>
<p>I tagged this as RFC for now. Please let me know what you think!</p>



<a name="264233958"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Redefining%20Sheaves/near/264233958" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Redefining.20Sheaves.html#264233958">(Dec 08 2021 at 23:04)</a>:</h4>
<p>Just a remark: The simp_nf linter failed on this commit <br>
<a href="https://github.com/leanprover-community/mathlib/pull/10678/commits/a236c2c04eb3522f45d8265eb9b1b5308033d668">https://github.com/leanprover-community/mathlib/pull/10678/commits/a236c2c04eb3522f45d8265eb9b1b5308033d668</a><br>
I think this is a good sign, because it means that <code>simp</code> is able to now do more work with this change.</p>



<a name="264477482"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Redefining%20Sheaves/near/264477482" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Redefining.20Sheaves.html#264477482">(Dec 10 2021 at 17:11)</a>:</h4>
<p><span aria-label="ping pong" class="emoji emoji-1f3d3" role="img" title="ping pong">:ping_pong:</span> Any further thoughts about this?</p>



<a name="264486927"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Redefining%20Sheaves/near/264486927" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Redefining.20Sheaves.html#264486927">(Dec 10 2021 at 18:16)</a>:</h4>
<p>Looks fine to me. But I'll ping <span class="user-mention" data-user-id="439483">@Andrew Yang</span> <span class="user-mention" data-user-id="246273">@Bhavik Mehta</span> and <span class="user-mention" data-user-id="384542">@Justus Springer</span> for their thoughts.</p>



<a name="264487004"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Redefining%20Sheaves/near/264487004" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Redefining.20Sheaves.html#264487004">(Dec 10 2021 at 18:17)</a>:</h4>
<p>Since the linkifier is broken, here is the link to the PR:<br>
<a href="https://github.com/leanprover-community/mathlib/pull/10678">https://github.com/leanprover-community/mathlib/pull/10678</a></p>



<a name="264581962"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Redefining%20Sheaves/near/264581962" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bhavik Mehta <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Redefining.20Sheaves.html#264581962">(Dec 11 2021 at 20:11)</a>:</h4>
<p><span class="user-mention silent" data-user-id="246273">Bhavik Mehta</span> <a href="#narrow/stream/116395-maths/topic/Redefining.20Sheaves/near/263314983">said</a>:</p>
<blockquote>
<p>I'm not opposed to either of these changes, but I wonder if what you want can be achieved in a simpler way. For instance, we had the change of <code>fin</code> being defined as a structure to a subtype, and this is essentially the reverse direction. I'm actually slightly more convinced about the morphisms change (it might even be a good idea for subcategories in general?)</p>
</blockquote>
<p>I still have this concern; this PR does the exact opposite of the fin refactor. I don't see a way this new approach avoids re-duplication of subtype API and presheaf API</p>



<a name="264583324"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Redefining%20Sheaves/near/264583324" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Redefining.20Sheaves.html#264583324">(Dec 11 2021 at 20:38)</a>:</h4>
<p>But what part of the subtype API do you actually want in this case?</p>



<a name="264583341"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Redefining%20Sheaves/near/264583341" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Redefining.20Sheaves.html#264583341">(Dec 11 2021 at 20:38)</a>:</h4>
<p>Remember that you shouldnt be evil and talk about equality of sheaves</p>



<a name="264583718"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Redefining%20Sheaves/near/264583718" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Redefining.20Sheaves.html#264583718">(Dec 11 2021 at 20:47)</a>:</h4>
<p>And if you want to view a sheaf as a presheaf, just write <code>F.val</code>, just like you had to before, except now lean wouldn't get confused if you apply <code>dsimp</code> which currently applies lemmas from the subtype API that cause various annoyances in proofs.</p>



<a name="264586331"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Redefining%20Sheaves/near/264586331" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Redefining.20Sheaves.html#264586331">(Dec 11 2021 at 21:39)</a>:</h4>
<p>I guess one of the main points of this PR is that I think the subtype API only causes pain in this case. I can't think of anything that I want from the subtype API in this context.</p>



<a name="265119347"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Redefining%20Sheaves/near/265119347" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Redefining.20Sheaves.html#265119347">(Dec 16 2021 at 07:17)</a>:</h4>
<p>I think we should move forward with this PR. I agree with <span class="user-mention" data-user-id="243562">@Adam Topaz</span> that the subtype API seems less useful in this specific case (put mildly). <span class="user-mention" data-user-id="246273">@Bhavik Mehta</span> do you have further concerns? Otherwise I would like to merge the PR</p>



<a name="265154527"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Redefining%20Sheaves/near/265154527" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bhavik Mehta <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Redefining.20Sheaves.html#265154527">(Dec 16 2021 at 13:25)</a>:</h4>
<p>Let's go with it and see what happens!</p>



<a name="274296128"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Redefining%20Sheaves/near/274296128" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Markus Himmel <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Redefining.20Sheaves.html#274296128">(Mar 06 2022 at 09:39)</a>:</h4>
<p>I will need to be able to work with several subcategories of the category of functors and how they relate, and for that I think it is still useful to have a unified development of full subcategories instead of a hand-rolled structure approach like the one  introduced in <a href="https://github.com/leanprover-community/mathlib/pull/10678">#10678</a>. For this reason, I will attempt to refactor the definition of <code>full_subcategory</code> as suggested by Adam above. If you have any objections, please let me know.</p>



<a name="274359116"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Redefining%20Sheaves/near/274359116" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Antoine Chambert-Loir <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Redefining.20Sheaves.html#274359116">(Mar 07 2022 at 07:56)</a>:</h4>
<p>A remark from an outsider. Some mathematicians claim that categories/functors are all over the place and that it is the right (and only right) way to proceed, but most of them do it appropriately lazily enough (forgetting about forgetful functors all over the place, for example). For a large scale formalization process, thinking categorically has advantages since it makes a lot of the constructions systematic. I guess it would be fruitful to gather pros and cons, and regarding cons, it would probably be fruitful to think about how to circumvent them systematically. Maybe, for particular categories, one would realize that they were not properly defined (such as filters, as Johann, Kevin and Patrick did) and this would lead to a (essentially equivalent but slightly) better definition, at least to a better understanding.</p>



<a name="274384115"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Redefining%20Sheaves/near/274384115" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Redefining.20Sheaves.html#274384115">(Mar 07 2022 at 12:29)</a>:</h4>
<p>For the record: Johan, Kevin and I have nothing to do with the definition of filters in mathlib. Filters were defined in mathlib by Johannes Hölzl in the very first months, ported from Isabelle/HOL (see <a href="https://link.springer.com/chapter/10.1007/978-3-642-39634-2_21">https://link.springer.com/chapter/10.1007/978-3-642-39634-2_21</a>)</p>



<a name="286353961"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Redefining%20Sheaves/near/286353961" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Markus Himmel <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Redefining.20Sheaves.html#286353961">(Jun 16 2022 at 13:41)</a>:</h4>
<p><span class="user-mention silent" data-user-id="260921">Markus Himmel</span> <a href="#narrow/stream/116395-maths/topic/Redefining.20Sheaves/near/274296128">said</a>:</p>
<blockquote>
<p>I will need to be able to work with several subcategories of the category of functors and how they relate, and for that I think it is still useful to have a unified development of full subcategories instead of a hand-rolled structure approach like the one  introduced in <a href="https://github.com/leanprover-community/mathlib/pull/10678">#10678</a>. For this reason, I will attempt to refactor the definition of <code>full_subcategory</code> as suggested by Adam above. If you have any objections, please let me know.</p>
</blockquote>
<p>I finally got around to this and opened <a href="https://github.com/leanprover-community/mathlib/pull/14767">#14767</a>. For now, I only put the objects in a custom structure and left morphisms. I tried also putting the morphisms in a separate structure (already on the level of <code>induced_category</code>) as is currently done for sheaves, but I ran into two issues:</p>
<ol>
<li>Apparently some uses of the <code>bundled</code> framework can lead to some concrete categories being created through multiple levels of <code>induced_category</code>, which means you have to write things like <code>f.val.val</code> to get hold of the actual map.</li>
<li>If <code>x</code> is a point of a topological space <code>X</code>, then the preorder category <code>open_nhds x</code> is a full_subcategory of the preorder category <code>opens X</code>. If we create a structure for the morphisms in a full subcategory, then <code>open_nhds x</code> has two non-defeq category structures, which causes issues.</li>
</ol>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>