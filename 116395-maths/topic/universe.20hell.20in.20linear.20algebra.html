---
layout: archive
title: Zulip Chat Archive
permalink: /stream/116395-maths/topic/universe.20hell.20in.20linear.20algebra.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/116395-maths/index.html">maths</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/universe.20hell.20in.20linear.20algebra.html">universe hell in linear algebra</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="206269534"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/universe%20hell%20in%20linear%20algebra/near/206269534" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/universe.20hell.20in.20linear.20algebra.html#206269534">(Aug 07 2020 at 15:15)</a>:</h4>
<p>Is there a user guide to universe hell fighting in linear algebra? For instance:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">variables</span>  <span class="o">{</span><span class="n">K</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span>  <span class="o">[</span><span class="n">field</span> <span class="n">K</span><span class="o">]</span> <span class="o">{</span><span class="n">V</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">add_comm_group</span> <span class="n">V</span><span class="o">]</span> <span class="o">[</span><span class="n">vector_space</span> <span class="n">K</span> <span class="n">V</span><span class="o">]</span> <span class="o">[</span><span class="n">finite_dimensional</span> <span class="n">K</span> <span class="n">V</span><span class="o">]</span>
           <span class="o">{</span><span class="n">n</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">}</span> <span class="o">{</span><span class="n">v</span> <span class="o">:</span> <span class="n">fin</span> <span class="n">n</span> <span class="bp">→</span> <span class="n">V</span><span class="o">}</span>


<span class="kn">lemma</span> <span class="n">le_of_linear_independent</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="n">linear_independent</span> <span class="n">K</span> <span class="n">v</span><span class="o">)</span> <span class="o">:</span> <span class="n">n</span> <span class="bp">≤</span> <span class="n">findim</span> <span class="n">K</span> <span class="n">V</span> <span class="o">:=</span>
</code></pre></div>



<a name="206269685"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/universe%20hell%20in%20linear%20algebra/near/206269685" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/universe.20hell.20in.20linear.20algebra.html#206269685">(Aug 07 2020 at 15:16)</a>:</h4>
<p>It looks like <a href="https://leanprover-community.github.io/mathlib_docs/find/finite_dimensional.fintype_card_le_findim_of_linear_independent">docs#finite_dimensional.fintype_card_le_findim_of_linear_independent</a> would help but it assumes the indexing type is in the same universe as the vector space.</p>



<a name="206271656"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/universe%20hell%20in%20linear%20algebra/near/206271656" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/universe.20hell.20in.20linear.20algebra.html#206271656">(Aug 07 2020 at 15:33)</a>:</h4>
<p>what hell?</p>



<a name="206271683"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/universe%20hell%20in%20linear%20algebra/near/206271683" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/universe.20hell.20in.20linear.20algebra.html#206271683">(Aug 07 2020 at 15:33)</a>:</h4>
<p>I don't see anything troubling in this snippet</p>



<a name="206271697"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/universe%20hell%20in%20linear%20algebra/near/206271697" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/universe.20hell.20in.20linear.20algebra.html#206271697">(Aug 07 2020 at 15:33)</a>:</h4>
<p>The trouble is in the proof.</p>



<a name="206271770"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/universe%20hell%20in%20linear%20algebra/near/206271770" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/universe.20hell.20in.20linear.20algebra.html#206271770">(Aug 07 2020 at 15:34)</a>:</h4>
<p>Because <code>fin n</code> and <code>V</code> live in different universes, you cannot apply the lemma I linked to.</p>



<a name="206271941"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/universe%20hell%20in%20linear%20algebra/near/206271941" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Floris van Doorn <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/universe.20hell.20in.20linear.20algebra.html#206271941">(Aug 07 2020 at 15:35)</a>:</h4>
<p>The lemma has the note</p>
<div class="codehilite"><pre><span></span><code><span class="c1">-- Note here we&#39;ve restricted the universe levels of `ι` and `V` to be the same, for convenience.</span>
</code></pre></div>


<p>I think generalizing this lemma to arbitrary universe levels is a better use of time than writing a user guide to work around it.</p>



<a name="206272021"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/universe%20hell%20in%20linear%20algebra/near/206272021" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/universe.20hell.20in.20linear.20algebra.html#206272021">(Aug 07 2020 at 15:36)</a>:</h4>
<p>For whose convenience?</p>



<a name="206272037"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/universe%20hell%20in%20linear%20algebra/near/206272037" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Floris van Doorn <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/universe.20hell.20in.20linear.20algebra.html#206272037">(Aug 07 2020 at 15:36)</a>:</h4>
<p>The prover of the lemma, presumably.</p>



<a name="206272101"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/universe%20hell%20in%20linear%20algebra/near/206272101" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/universe.20hell.20in.20linear.20algebra.html#206272101">(Aug 07 2020 at 15:37)</a>:</h4>
<p>My question is: how to prove a general version of such lemmas where it's convenient to assume universe equalities?</p>



<a name="206272248"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/universe%20hell%20in%20linear%20algebra/near/206272248" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Floris van Doorn <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/universe.20hell.20in.20linear.20algebra.html#206272248">(Aug 07 2020 at 15:38)</a>:</h4>
<p>after you have proven the lemma, apply it to <code>ulift \i</code> and <code>ulift V</code>, and then massage the statement along equivalences to get it for <code>\i</code> and <code>V</code>.</p>
<p>This assumes you have proven that every component of the (statement of the) lemma is invariant under equivalences.</p>



<a name="206272358"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/universe%20hell%20in%20linear%20algebra/near/206272358" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/universe.20hell.20in.20linear.20algebra.html#206272358">(Aug 07 2020 at 15:39)</a>:</h4>
<p>Mario, what Floris wrote is what I called universe hell.</p>



<a name="206272367"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/universe%20hell%20in%20linear%20algebra/near/206272367" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/universe.20hell.20in.20linear.20algebra.html#206272367">(Aug 07 2020 at 15:39)</a>:</h4>
<p>Alternatively, just use the theorem that talks about <code>lift (mk A)</code> instead of <code>mk A</code> when using the cardinal library</p>



<a name="206272390"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/universe%20hell%20in%20linear%20algebra/near/206272390" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/universe.20hell.20in.20linear.20algebra.html#206272390">(Aug 07 2020 at 15:39)</a>:</h4>
<p>the proof is exactly as long, you just use different lemmas</p>



<a name="206272627"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/universe%20hell%20in%20linear%20algebra/near/206272627" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/universe.20hell.20in.20linear.20algebra.html#206272627">(Aug 07 2020 at 15:41)</a>:</h4>
<p>This sounds promising.</p>



<a name="206273124"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/universe%20hell%20in%20linear%20algebra/near/206273124" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/universe.20hell.20in.20linear.20algebra.html#206273124">(Aug 07 2020 at 15:44)</a>:</h4>
<p>Except I have no idea how to turn it into Lean code.</p>



<a name="206273145"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/universe%20hell%20in%20linear%20algebra/near/206273145" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/universe.20hell.20in.20linear.20algebra.html#206273145">(Aug 07 2020 at 15:45)</a>:</h4>
<p>I'm working on it</p>



<a name="206273156"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/universe%20hell%20in%20linear%20algebra/near/206273156" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/universe.20hell.20in.20linear.20algebra.html#206273156">(Aug 07 2020 at 15:45)</a>:</h4>
<p>Thanks a lot!</p>



<a name="206273206"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/universe%20hell%20in%20linear%20algebra/near/206273206" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Floris van Doorn <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/universe.20hell.20in.20linear.20algebra.html#206273206">(Aug 07 2020 at 15:45)</a>:</h4>
<p>I think the <code>fintype.card</code> library is not as consistent as the <code>cardinal</code> library, but there is <code>fintype.​card_ulift</code> which requires one more step.</p>



<a name="206274529"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/universe%20hell%20in%20linear%20algebra/near/206274529" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Floris van Doorn <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/universe.20hell.20in.20linear.20algebra.html#206274529">(Aug 07 2020 at 15:56)</a>:</h4>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="n">linear_algebra</span><span class="bp">.</span><span class="n">finite_dimensional</span>

<span class="kn">variables</span>  <span class="o">{</span><span class="n">K</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span>  <span class="o">[</span><span class="n">field</span> <span class="n">K</span><span class="o">]</span> <span class="o">{</span><span class="n">V</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">add_comm_group</span> <span class="n">V</span><span class="o">]</span> <span class="o">[</span><span class="n">vector_space</span> <span class="n">K</span> <span class="n">V</span><span class="o">]</span> <span class="o">[</span><span class="n">finite_dimensional</span> <span class="n">K</span> <span class="n">V</span><span class="o">]</span>
           <span class="o">{</span><span class="n">n</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">}</span> <span class="o">{</span><span class="n">v</span> <span class="o">:</span> <span class="n">fin</span> <span class="n">n</span> <span class="bp">→</span> <span class="n">V</span><span class="o">}</span>

<span class="kn">open</span> <span class="n">finite_dimensional</span>

<span class="kn">lemma</span> <span class="n">ulift</span><span class="bp">.</span><span class="n">down</span><span class="bp">.</span><span class="n">injective</span> <span class="o">{</span><span class="n">α</span><span class="o">}</span> <span class="o">:</span> <span class="n">function</span><span class="bp">.</span><span class="n">injective</span> <span class="o">(</span><span class="n">ulift</span><span class="bp">.</span><span class="n">down</span> <span class="o">:</span> <span class="n">ulift</span> <span class="n">α</span> <span class="bp">→</span> <span class="n">α</span><span class="o">)</span> <span class="o">:=</span>
<span class="k">by</span> <span class="o">{</span> <span class="n">rintro</span> <span class="bp">⟨</span><span class="n">x</span><span class="bp">⟩</span> <span class="bp">⟨</span><span class="n">y</span><span class="bp">⟩</span> <span class="n">h</span><span class="o">,</span> <span class="n">dsimp</span> <span class="n">at</span> <span class="n">h</span><span class="o">,</span> <span class="n">rw</span> <span class="n">h</span> <span class="o">}</span>

<span class="kn">lemma</span> <span class="n">le_of_linear_independent</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="n">linear_independent</span> <span class="n">K</span> <span class="n">v</span><span class="o">)</span> <span class="o">:</span> <span class="n">n</span> <span class="bp">≤</span> <span class="n">findim</span> <span class="n">K</span> <span class="n">V</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="k">have</span> <span class="o">:</span> <span class="n">linear_independent</span> <span class="n">K</span> <span class="o">(</span><span class="n">v</span> <span class="err">∘</span> <span class="n">ulift</span><span class="bp">.</span><span class="n">down</span><span class="o">)</span> <span class="o">:=</span>
    <span class="n">linear_independent</span><span class="bp">.</span><span class="n">comp</span> <span class="n">h</span> <span class="bp">_</span> <span class="n">ulift</span><span class="bp">.</span><span class="n">down</span><span class="bp">.</span><span class="n">injective</span><span class="o">,</span>
  <span class="n">convert</span> <span class="n">finite_dimensional</span><span class="bp">.</span><span class="n">fintype_card_le_findim_of_linear_independent</span> <span class="n">this</span><span class="o">,</span>
  <span class="n">simp</span><span class="o">,</span>
<span class="kn">end</span>
</code></pre></div>



<a name="206276520"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/universe%20hell%20in%20linear%20algebra/near/206276520" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/universe.20hell.20in.20linear.20algebra.html#206276520">(Aug 07 2020 at 16:12)</a>:</h4>
<p><a href="https://github.com/leanprover-community/mathlib/issues/3721">#3721</a></p>



<a name="206276607"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/universe%20hell%20in%20linear%20algebra/near/206276607" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/universe.20hell.20in.20linear.20algebra.html#206276607">(Aug 07 2020 at 16:13)</a>:</h4>
<p>Floris's suggestion is good for when you don't want to change the library, but it is better in this case to just already have the universe generalized versions of all the lemmas</p>



<a name="206276654"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/universe%20hell%20in%20linear%20algebra/near/206276654" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/universe.20hell.20in.20linear.20algebra.html#206276654">(Aug 07 2020 at 16:13)</a>:</h4>
<p>Sure. Thank you very much to both of you anyway.</p>



<a name="206279600"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/universe%20hell%20in%20linear%20algebra/near/206279600" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/universe.20hell.20in.20linear.20algebra.html#206279600">(Aug 07 2020 at 16:36)</a>:</h4>
<p>Patrick -- come back to <code>Type</code>! All your universe problems will melt away!</p>



<a name="206337734"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/universe%20hell%20in%20linear%20algebra/near/206337734" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Utensil Song <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/universe.20hell.20in.20linear.20algebra.html#206337734">(Aug 08 2020 at 08:06)</a>:</h4>
<p>I think in this topic I've learned something opposite to <a href="#narrow/stream/113488-general/topic/Deterministic.20timeout.20for.20class.20definition/near/205055878">the other topic</a>:</p>
<p>Even if we can put the universe issue aside at the beginning, one day we'll have to come back to give it a proper treatment.</p>
<p>This topic provides two methods to deal with the situation, both seem not costly, but both are hard to decipher, especially the changes in <a href="https://github.com/leanprover-community/mathlib/issues/3721">#3721</a> look totally random, I'm seeing the <code>'</code>s on <code>u v w</code>, <code>Type*</code>, <code>lemma {m}</code>, <code>_</code>s and <code>max</code>s, and have no idea how the universes are arranged and by any chance <code>u</code> and <code>u'</code> (for example), <code>m</code> and others, <code>*</code> and others are related in the arrangement. There's so much magic in one page...</p>



<a name="206337847"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/universe%20hell%20in%20linear%20algebra/near/206337847" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Utensil Song <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/universe.20hell.20in.20linear.20algebra.html#206337847">(Aug 08 2020 at 08:10)</a>:</h4>
<p><span class="user-mention silent" data-user-id="111080">Floris van Doorn</span> <a href="#narrow/stream/116395-maths/topic/universe.20hell.20in.20linear.20algebra/near/206272248">said</a>:</p>
<blockquote>
<p>after you have proven the lemma, apply it to <code>ulift \i</code> and <code>ulift V</code>, and then massage the statement along equivalences to get it for <code>\i</code> and <code>V</code>.</p>
<p>This assumes you have proven that every component of the (statement of the) lemma is invariant under equivalences.</p>
</blockquote>
<p>The massage seems to have a pattern, is turning this into a reusable tactic possible?</p>



<a name="206398488"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/universe%20hell%20in%20linear%20algebra/near/206398488" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/universe.20hell.20in.20linear.20algebra.html#206398488">(Aug 09 2020 at 15:00)</a>:</h4>
<p>I have a variation on universe issues in linear algebras:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">example</span> <span class="o">{</span><span class="n">ι</span> <span class="n">K</span> <span class="n">V</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">field</span> <span class="n">K</span><span class="o">]</span> <span class="o">[</span><span class="n">add_comm_group</span> <span class="n">V</span><span class="o">]</span> <span class="o">[</span><span class="n">vector_space</span> <span class="n">K</span> <span class="n">V</span><span class="o">]</span>
  <span class="o">[</span><span class="n">finite_dimensional</span> <span class="n">K</span> <span class="n">V</span><span class="o">]</span> <span class="o">{</span><span class="n">v</span> <span class="o">:</span> <span class="n">ι</span> <span class="bp">→</span> <span class="n">V</span><span class="o">}</span> <span class="o">(</span><span class="n">hv</span> <span class="o">:</span> <span class="n">is_basis</span> <span class="n">K</span> <span class="n">v</span><span class="o">)</span> <span class="o">:</span>  <span class="n">fintype</span> <span class="n">ι</span>
</code></pre></div>


<p>the universe issue is hidden a bit, but not much since there are cardinals involved.</p>



<a name="206406837"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/universe%20hell%20in%20linear%20algebra/near/206406837" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/universe.20hell.20in.20linear.20algebra.html#206406837">(Aug 09 2020 at 18:42)</a>:</h4>
<p><span class="user-mention" data-user-id="110049">@Mario Carneiro</span> do you have a magic trick here?</p>



<a name="206406859"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/universe%20hell%20in%20linear%20algebra/near/206406859" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/universe.20hell.20in.20linear.20algebra.html#206406859">(Aug 09 2020 at 18:43)</a>:</h4>
<p>what's the context?</p>



<a name="206406985"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/universe%20hell%20in%20linear%20algebra/near/206406985" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/universe.20hell.20in.20linear.20algebra.html#206406985">(Aug 09 2020 at 18:46)</a>:</h4>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="n">linear_algebra</span><span class="bp">.</span><span class="n">finite_dimensional</span>

<span class="kn">example</span> <span class="o">{</span><span class="n">ι</span> <span class="n">K</span> <span class="n">V</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">field</span> <span class="n">K</span><span class="o">]</span> <span class="o">[</span><span class="n">add_comm_group</span> <span class="n">V</span><span class="o">]</span> <span class="o">[</span><span class="n">vector_space</span> <span class="n">K</span> <span class="n">V</span><span class="o">]</span>
  <span class="o">[</span><span class="n">finite_dimensional</span> <span class="n">K</span> <span class="n">V</span><span class="o">]</span> <span class="o">{</span><span class="n">v</span> <span class="o">:</span> <span class="n">ι</span> <span class="bp">→</span> <span class="n">V</span><span class="o">}</span> <span class="o">(</span><span class="n">hv</span> <span class="o">:</span> <span class="n">is_basis</span> <span class="n">K</span> <span class="n">v</span><span class="o">)</span> <span class="o">:</span>  <span class="n">fintype</span> <span class="n">ι</span> <span class="o">:=</span>
<span class="n">sorry</span>
</code></pre></div>



<a name="206406994"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/universe%20hell%20in%20linear%20algebra/near/206406994" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/universe.20hell.20in.20linear.20algebra.html#206406994">(Aug 09 2020 at 18:47)</a>:</h4>
<p>This is a combination of handling universes in cardinals and fighting <code>fintype</code></p>



<a name="206408092"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/universe%20hell%20in%20linear%20algebra/near/206408092" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/universe.20hell.20in.20linear.20algebra.html#206408092">(Aug 09 2020 at 19:16)</a>:</h4>
<p>I didn't have any universe issues in the proof:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="n">linear_algebra</span><span class="bp">.</span><span class="n">finite_dimensional</span>

<span class="n">noncomputable</span> <span class="kn">example</span> <span class="o">{</span><span class="n">ι</span> <span class="n">K</span> <span class="n">V</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">field</span> <span class="n">K</span><span class="o">]</span> <span class="o">[</span><span class="n">add_comm_group</span> <span class="n">V</span><span class="o">]</span> <span class="o">[</span><span class="n">vector_space</span> <span class="n">K</span> <span class="n">V</span><span class="o">]</span>
  <span class="o">[</span><span class="n">finite_dimensional</span> <span class="n">K</span> <span class="n">V</span><span class="o">]</span> <span class="o">{</span><span class="n">v</span> <span class="o">:</span> <span class="n">ι</span> <span class="bp">→</span> <span class="n">V</span><span class="o">}</span> <span class="o">(</span><span class="n">hv</span> <span class="o">:</span> <span class="n">is_basis</span> <span class="n">K</span> <span class="n">v</span><span class="o">)</span> <span class="o">:</span> <span class="n">fintype</span> <span class="n">ι</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="n">apply</span> <span class="n">classical</span><span class="bp">.</span><span class="n">choice</span><span class="o">,</span>
  <span class="n">rw</span> <span class="o">[</span><span class="err">←</span> <span class="n">cardinal</span><span class="bp">.</span><span class="n">lt_omega_iff_fintype</span><span class="o">,</span> <span class="err">←</span> <span class="n">finite_dimensional</span><span class="bp">.</span><span class="n">findim_eq_card_basis&#39;</span> <span class="n">hv</span><span class="o">],</span>
  <span class="n">apply</span> <span class="n">cardinal</span><span class="bp">.</span><span class="n">nat_lt_omega</span><span class="o">,</span>
<span class="kn">end</span>
</code></pre></div>



<a name="206408099"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/universe%20hell%20in%20linear%20algebra/near/206408099" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/universe.20hell.20in.20linear.20algebra.html#206408099">(Aug 09 2020 at 19:17)</a>:</h4>
<p>I'm not sure which <code>finite_dimensional</code> theorem you were intending to use</p>



<a name="206412792"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/universe%20hell%20in%20linear%20algebra/near/206412792" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/universe.20hell.20in.20linear.20algebra.html#206412792">(Aug 09 2020 at 21:40)</a>:</h4>
<p>Thanks you very much Mario. I was stuck at:</p>
<div class="codehilite"><pre><span></span><code>  <span class="n">apply</span> <span class="n">fintype</span><span class="bp">.</span><span class="n">of_cardinal_lt</span><span class="o">,</span>
  <span class="k">have</span> <span class="n">c1</span> <span class="o">:=</span> <span class="n">finite_dimensional</span><span class="bp">.</span><span class="n">dim_lt_omega</span> <span class="n">K</span> <span class="n">V</span><span class="o">,</span>
  <span class="k">have</span> <span class="n">c2</span> <span class="o">:=</span> <span class="n">hv</span><span class="bp">.</span><span class="n">mk_eq_dim&#39;</span><span class="o">,</span>
</code></pre></div>


<p>(with or without the last prime) which left me with a context having all I needed but all in wrong universes. Was it possible to salvage things from there? Is there any easy explanation of why this was the wrong road? Also I would have never guessed the first line would be this <code>apply classical.choice</code> but I guess this comes from the weirdness of <code>fintype X</code> not being in <code>Prop</code>.</p>



<a name="206412854"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/universe%20hell%20in%20linear%20algebra/near/206412854" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/universe.20hell.20in.20linear.20algebra.html#206412854">(Aug 09 2020 at 21:43)</a>:</h4>
<p>Would you mind having</p>
<div class="codehilite"><pre><span></span><code><span class="kn">lemma</span> <span class="n">fintype</span><span class="bp">.</span><span class="n">of_cardinal_lt</span> <span class="o">{</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="n">cardinal</span><span class="bp">.</span><span class="n">mk</span> <span class="n">α</span> <span class="bp">&lt;</span> <span class="n">cardinal</span><span class="bp">.</span><span class="n">omega</span><span class="o">)</span> <span class="o">:</span> <span class="n">fintype</span> <span class="n">α</span> <span class="o">:=</span>
<span class="n">classical</span><span class="bp">.</span><span class="n">choice</span> <span class="err">$</span> <span class="n">cardinal</span><span class="bp">.</span><span class="n">lt_omega_iff_fintype</span><span class="bp">.</span><span class="n">mp</span> <span class="n">h</span>
</code></pre></div>


<p>PRed?</p>



<a name="206412904"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/universe%20hell%20in%20linear%20algebra/near/206412904" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/universe.20hell.20in.20linear.20algebra.html#206412904">(Aug 09 2020 at 21:44)</a>:</h4>
<p>I makes your proof a lot less puzzling.</p>



<a name="206415137"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/universe%20hell%20in%20linear%20algebra/near/206415137" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/universe.20hell.20in.20linear.20algebra.html#206415137">(Aug 09 2020 at 22:50)</a>:</h4>
<p>I have yet another example of  "<code>fintype</code> is data" fun:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="n">data</span><span class="bp">.</span><span class="n">fintype</span><span class="bp">.</span><span class="n">card</span>

<span class="n">open_locale</span> <span class="n">big_operators</span>

<span class="kn">example</span>  <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">)</span> <span class="o">(</span><span class="n">ι</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span>
  <span class="o">[</span><span class="n">fintype</span> <span class="n">ι</span><span class="o">]</span>
<span class="c1">--  [fintype (fin n ⊕ ι)]</span>
  <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">fin</span> <span class="n">n</span> <span class="err">⊕</span> <span class="n">ι</span> <span class="bp">→</span> <span class="bp">ℤ</span><span class="o">)</span>
  <span class="o">:</span> <span class="err">∑</span> <span class="o">(</span><span class="n">i</span> <span class="o">:</span> <span class="n">fin</span> <span class="n">n</span> <span class="err">⊕</span> <span class="n">ι</span><span class="o">),</span> <span class="n">f</span> <span class="n">i</span> <span class="bp">=</span> <span class="mi">0</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="n">rw</span> <span class="n">fintype</span><span class="bp">.</span><span class="n">sum_sum_type</span><span class="o">,</span>
  <span class="n">admit</span><span class="o">,</span>
<span class="kn">end</span>
</code></pre></div>


<p>Uncomment the commented line to see the rewrite failing. Something is really wrong in this whole <code>fintype</code> setup...</p>



<a name="206415206"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/universe%20hell%20in%20linear%20algebra/near/206415206" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/universe.20hell.20in.20linear.20algebra.html#206415206">(Aug 09 2020 at 22:52)</a>:</h4>
<p>why is that a reasonable thing to do? That's like having two <code>group</code> instances</p>



<a name="206415210"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/universe%20hell%20in%20linear%20algebra/near/206415210" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/universe.20hell.20in.20linear.20algebra.html#206415210">(Aug 09 2020 at 22:52)</a>:</h4>
<p>In this case the second fintype can clearly be inferred from the first</p>



<a name="206415220"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/universe%20hell%20in%20linear%20algebra/near/206415220" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/universe.20hell.20in.20linear.20algebra.html#206415220">(Aug 09 2020 at 22:53)</a>:</h4>
<p>The sum does not depend on the <code>fintype</code> instance.</p>



<a name="206415224"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/universe%20hell%20in%20linear%20algebra/near/206415224" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/universe.20hell.20in.20linear.20algebra.html#206415224">(Aug 09 2020 at 22:53)</a>:</h4>
<p>In my real example, the commented instance was used to build the uncommented one, not the other way around.</p>



<a name="206415271"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/universe%20hell%20in%20linear%20algebra/near/206415271" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/universe.20hell.20in.20linear.20algebra.html#206415271">(Aug 09 2020 at 22:54)</a>:</h4>
<p>I'm not saying that <code>fintype</code> is useless, I can totally believe it can be useful for programming or constructive mathematics, but it's not the right class for defining sums.</p>



<a name="206415352"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/universe%20hell%20in%20linear%20algebra/near/206415352" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/universe.20hell.20in.20linear.20algebra.html#206415352">(Aug 09 2020 at 22:56)</a>:</h4>
<p>how about a sum that takes no finiteness argument and returns 0 when the input function is not finitely supported</p>



<a name="206415358"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/universe%20hell%20in%20linear%20algebra/near/206415358" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/universe.20hell.20in.20linear.20algebra.html#206415358">(Aug 09 2020 at 22:57)</a>:</h4>
<p>I sometimes dreams about that, but I fear this will be very confusing where you think about converging series.</p>



<a name="206415363"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/universe%20hell%20in%20linear%20algebra/near/206415363" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/universe.20hell.20in.20linear.20algebra.html#206415363">(Aug 09 2020 at 22:57)</a>:</h4>
<p>We already have <code>tsum</code> for infinite series</p>



<a name="206415365"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/universe%20hell%20in%20linear%20algebra/near/206415365" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/universe.20hell.20in.20linear.20algebra.html#206415365">(Aug 09 2020 at 22:57)</a>:</h4>
<p>Because such series would have a vanishing sum.</p>



<a name="206415367"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/universe%20hell%20in%20linear%20algebra/near/206415367" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/universe.20hell.20in.20linear.20algebra.html#206415367">(Aug 09 2020 at 22:57)</a>:</h4>
<p>Whatever this new sum is it has to work without a topology</p>



<a name="206415371"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/universe%20hell%20in%20linear%20algebra/near/206415371" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/universe.20hell.20in.20linear.20algebra.html#206415371">(Aug 09 2020 at 22:57)</a>:</h4>
<p>But maybe this would still be better than the current situation.</p>



<a name="206415412"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/universe%20hell%20in%20linear%20algebra/near/206415412" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/universe.20hell.20in.20linear.20algebra.html#206415412">(Aug 09 2020 at 22:58)</a>:</h4>
<p>(or equivalently, the discrete topology, where convergence of the infinite sum means that it is finitely supported)</p>



<a name="206415507"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/universe%20hell%20in%20linear%20algebra/near/206415507" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/universe.20hell.20in.20linear.20algebra.html#206415507">(Aug 09 2020 at 23:00)</a>:</h4>
<p>we can't really get rid of the existing theory of finset sums, those are still true and applicable for their domain, but we can take the notation and apply it to a different constant</p>



<a name="206415516"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/universe%20hell%20in%20linear%20algebra/near/206415516" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/universe.20hell.20in.20linear.20algebra.html#206415516">(Aug 09 2020 at 23:01)</a>:</h4>
<p>of course, it's already a localized notation so it doesn't even have to conflict with the existing development</p>



<a name="206415746"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/universe%20hell%20in%20linear%20algebra/near/206415746" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/universe.20hell.20in.20linear.20algebra.html#206415746">(Aug 09 2020 at 23:08)</a>:</h4>
<p>Proposal:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="n">data</span><span class="bp">.</span><span class="n">finsupp</span>

<span class="n">open_locale</span> <span class="n">classical</span>

<span class="n">noncomputable</span> <span class="n">def</span> <span class="n">finsum</span> <span class="o">{</span><span class="n">ι</span> <span class="n">α</span><span class="o">}</span> <span class="o">[</span><span class="n">add_comm_group</span> <span class="n">α</span><span class="o">]</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">ι</span> <span class="bp">→</span> <span class="n">α</span><span class="o">)</span> <span class="o">:</span> <span class="n">α</span> <span class="o">:=</span>
<span class="k">if</span> <span class="n">h</span> <span class="o">:</span> <span class="bp">∃</span> <span class="n">f&#39;</span> <span class="o">:</span> <span class="n">ι</span> <span class="bp">→</span><span class="err">₀</span> <span class="n">α</span><span class="o">,</span> <span class="n">f</span> <span class="bp">=</span> <span class="n">f&#39;</span> <span class="k">then</span> <span class="o">(</span><span class="n">classical</span><span class="bp">.</span><span class="n">some</span> <span class="n">h</span><span class="o">)</span><span class="bp">.</span><span class="n">sum</span> <span class="o">(</span><span class="bp">λ</span> <span class="bp">_</span> <span class="n">a</span><span class="o">,</span> <span class="n">a</span><span class="o">)</span> <span class="k">else</span> <span class="mi">0</span>

<span class="n">noncomputable</span> <span class="n">def</span> <span class="n">finsum_in</span> <span class="o">{</span><span class="n">ι</span> <span class="n">α</span><span class="o">}</span> <span class="o">[</span><span class="n">add_comm_group</span> <span class="n">α</span><span class="o">]</span> <span class="o">(</span><span class="n">s</span> <span class="o">:</span> <span class="n">set</span> <span class="n">ι</span><span class="o">)</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">ι</span> <span class="bp">→</span> <span class="n">α</span><span class="o">)</span> <span class="o">:</span> <span class="n">α</span> <span class="o">:=</span>
<span class="n">finsum</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">i</span><span class="o">,</span> <span class="k">if</span> <span class="n">i</span> <span class="err">∈</span> <span class="n">s</span> <span class="k">then</span> <span class="n">f</span> <span class="n">i</span> <span class="k">else</span> <span class="mi">0</span><span class="o">)</span>

<span class="n">localized</span> <span class="s2">&quot;notation `∑` binders `, ` r:(scoped:67 f, finsum f) := r&quot;</span> <span class="k">in</span> <span class="n">finsum</span>
<span class="n">localized</span> <span class="s2">&quot;notation `∑` binders ` in ` s `, ` r:(scoped:67 f, finsum_in s f) := r&quot;</span> <span class="k">in</span> <span class="n">finsum</span>
</code></pre></div>



<a name="206415849"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/universe%20hell%20in%20linear%20algebra/near/206415849" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/universe.20hell.20in.20linear.20algebra.html#206415849">(Aug 09 2020 at 23:11)</a>:</h4>
<p>Yes, we should probably have something like that. But the next question is: can we avoid duplicating the whole API?</p>



<a name="206415979"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/universe%20hell%20in%20linear%20algebra/near/206415979" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/universe.20hell.20in.20linear.20algebra.html#206415979">(Aug 09 2020 at 23:15)</a>:</h4>
<p>that's sort of the cost of doing business. The theorems aren't the same, so it's mostly a question of which finset sum theorems we want to forego</p>



<a name="206416033"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/universe%20hell%20in%20linear%20algebra/near/206416033" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/universe.20hell.20in.20linear.20algebra.html#206416033">(Aug 09 2020 at 23:16)</a>:</h4>
<p>I imagine that most theorems that aren't in the <code>big_operators</code> file can just change to the new sum without being duplicated, but the old API itself still has to stay mostly intact</p>



<a name="206416041"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/universe%20hell%20in%20linear%20algebra/near/206416041" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/universe.20hell.20in.20linear.20algebra.html#206416041">(Aug 09 2020 at 23:16)</a>:</h4>
<p>one obvious reason being that the definition I just gave uses <code>finsupp</code>, which uses finset sums to define it</p>



<a name="206416056"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/universe%20hell%20in%20linear%20algebra/near/206416056" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/universe.20hell.20in.20linear.20algebra.html#206416056">(Aug 09 2020 at 23:17)</a>:</h4>
<p>so it's more like another API on top of the existing one than a replacement</p>



<a name="206416136"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/universe%20hell%20in%20linear%20algebra/near/206416136" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/universe.20hell.20in.20linear.20algebra.html#206416136">(Aug 09 2020 at 23:19)</a>:</h4>
<p>All theorem will be there, but some of them will have finiteness assumptions. But sure, this is business.</p>



<a name="206416202"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/universe%20hell%20in%20linear%20algebra/near/206416202" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/universe.20hell.20in.20linear.20algebra.html#206416202">(Aug 09 2020 at 23:20)</a>:</h4>
<p>As consolation, I think most of the proofs will be one liners</p>



<a name="206416212"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/universe%20hell%20in%20linear%20algebra/near/206416212" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/universe.20hell.20in.20linear.20algebra.html#206416212">(Aug 09 2020 at 23:20)</a>:</h4>
<p>but people generally can never have enough API theorems</p>



<a name="206454390"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/universe%20hell%20in%20linear%20algebra/near/206454390" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/universe.20hell.20in.20linear.20algebra.html#206454390">(Aug 10 2020 at 12:24)</a>:</h4>
<p><span class="user-mention" data-user-id="110031">@Patrick Massot</span> your theorem about fintype (fin n + iota) is provable with the weaker hypothesis <code>nonempty (fintype iota)</code> which I think is a more useful typeclass for people like you and me</p>



<a name="206454477"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/universe%20hell%20in%20linear%20algebra/near/206454477" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/universe.20hell.20in.20linear.20algebra.html#206454477">(Aug 10 2020 at 12:25)</a>:</h4>
<p>And nonempty (fintype (X + Y)) implies nonempty (fintype X)</p>



<a name="206454770"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/universe%20hell%20in%20linear%20algebra/near/206454770" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/universe.20hell.20in.20linear.20algebra.html#206454770">(Aug 10 2020 at 12:29)</a>:</h4>
<p><span class="user-mention" data-user-id="110049">@Mario Carneiro</span> you have done a brilliant job of making computable finiteness in Lean but we are missing API for a good noncomputable finiteness concept. I think Reid's idea of making set.finite the fundamental Prop-valued finiteness class and then bundling it with finset2 will produce a type which is easier for reasoning and which will have a noncomputable card which cant be #eval'ed but about which you can prove theorems like Sylow's theorems</p>



<a name="206454854"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/universe%20hell%20in%20linear%20algebra/near/206454854" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/universe.20hell.20in.20linear.20algebra.html#206454854">(Aug 10 2020 at 12:30)</a>:</h4>
<p>I think there should be a typeclass which is propositional and equivalent to nonempty (fintype X)</p>



<a name="206454908"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/universe%20hell%20in%20linear%20algebra/near/206454908" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/universe.20hell.20in.20linear.20algebra.html#206454908">(Aug 10 2020 at 12:31)</a>:</h4>
<p>I don't know whether this should be literally <code>nonempty (fintype X)</code> or whether its actual definition should be <code>finite univ</code></p>



<a name="206454939"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/universe%20hell%20in%20linear%20algebra/near/206454939" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/universe.20hell.20in.20linear.20algebra.html#206454939">(Aug 10 2020 at 12:31)</a>:</h4>
<p>Maybe it doesn't matter as long as it's proved equivalent to nonempty fintype X</p>



<a name="206455037"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/universe%20hell%20in%20linear%20algebra/near/206455037" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/universe.20hell.20in.20linear.20algebra.html#206455037">(Aug 10 2020 at 12:32)</a>:</h4>
<p>Because Patrick is reasoning not computing, he should be using this Prop-valued concept of finiteness. He is in trouble because he's trying to do reasoning using the wrong typeclass</p>



<a name="206495516"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/universe%20hell%20in%20linear%20algebra/near/206495516" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/universe.20hell.20in.20linear.20algebra.html#206495516">(Aug 10 2020 at 18:30)</a>:</h4>
<p>Clearly we should do something. The current setup just doesn't work for our purposes (we should probably keep it, maybe with a more specialized name since it corresponds to very specialized purposes).</p>



<a name="206497335"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/universe%20hell%20in%20linear%20algebra/near/206497335" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/universe.20hell.20in.20linear.20algebra.html#206497335">(Aug 10 2020 at 18:44)</a>:</h4>
<p>I'm making an API for a class fintype2 X := nonempty (fintype X). This will at least fix the problem where I was working with finite groups and had a complicated expression involving <code>card (bot : subgroup G)</code> but I couldn't <code>rw (card_bot : card (bot) = 1)</code> because type class inference had managed to find two non-defeq proofs of fintype bot (one coming from the fact that G was finite and one indpendent of this).</p>



<a name="206502388"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/universe%20hell%20in%20linear%20algebra/near/206502388" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/universe.20hell.20in.20linear.20algebra.html#206502388">(Aug 10 2020 at 19:25)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110038">Kevin Buzzard</span> <a href="#narrow/stream/116395-maths/topic/universe.20hell.20in.20linear.20algebra/near/206454854">said</a>:</p>
<blockquote>
<p>I think there should be a typeclass which is propositional and equivalent to nonempty (fintype X)</p>
</blockquote>
<p>Why don't we just call it <code>is_finite X</code>?</p>



<a name="206502825"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/universe%20hell%20in%20linear%20algebra/near/206502825" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/universe.20hell.20in.20linear.20algebra.html#206502825">(Aug 10 2020 at 19:29)</a>:</h4>
<p>We could even eliminate <code>set.finite</code> in favor of <code>is_finite (\u s)</code></p>



<a name="206502935"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/universe%20hell%20in%20linear%20algebra/near/206502935" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/universe.20hell.20in.20linear.20algebra.html#206502935">(Aug 10 2020 at 19:30)</a>:</h4>
<p>it's always been a bit weird that <code>set.finite</code> combines these two operations (going from type to prop and then using sets instead of types) and there is no term for the intermediate operation</p>



<a name="206503158"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/universe%20hell%20in%20linear%20algebra/near/206503158" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/universe.20hell.20in.20linear.20algebra.html#206503158">(Aug 10 2020 at 19:31)</a>:</h4>
<p>But I also think that for all these examples of noncomputable versions of functions like <code>card</code> you would be better served getting rid of the typeclass argument entirely rather than making it propositional</p>



<a name="206506174"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/universe%20hell%20in%20linear%20algebra/near/206506174" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/universe.20hell.20in.20linear.20algebra.html#206506174">(Aug 10 2020 at 19:59)</a>:</h4>
<p>So for the definition of card we should dump the typeclass, but then when we're actually proving something which does need finiteness...the idea is that we put the is_finite typeclass into the theorem statement but still use the nat-valued card?</p>



<a name="206506252"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/universe%20hell%20in%20linear%20algebra/near/206506252" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/universe.20hell.20in.20linear.20algebra.html#206506252">(Aug 10 2020 at 19:59)</a>:</h4>
<p>I wondered if <code>finprop X</code> was good name for it, but I think the type in fintype refers to X rather than the type of the output!</p>



<a name="206529556"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/universe%20hell%20in%20linear%20algebra/near/206529556" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/universe.20hell.20in.20linear.20algebra.html#206529556">(Aug 11 2020 at 00:36)</a>:</h4>
<p>We could do something like rename <code>fintype</code> to <code>finenum</code> or <code>fin_bij</code>, or something that more clearly indicates it is carrying data? Not sure.</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>