---
layout: archive
title: Zulip Chat Archive
permalink: /stream/116395-maths/topic/.60add_torsor.60.20order.20instances.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/116395-maths/index.html">maths</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/.60add_torsor.60.20order.20instances.html">`add_torsor` order instances</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="282423758"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/%60add_torsor%60%20order%20instances/near/282423758" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Hanting Zhang <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/.60add_torsor.60.20order.20instances.html#282423758">(May 15 2022 at 19:03)</a>:</h4>
<p>I'm trying to define some new order instances on <code>P</code> when we have <code>add_torsor G P</code> for some group <code>G</code>. However, the following problem occurs:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">algebra.add_torsor</span>

<span class="kd">variables</span> <span class="o">{</span><span class="n">G</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">{</span><span class="n">P</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span>

<span class="kd">variables</span> <span class="o">[</span><span class="n">ordered_add_comm_group</span> <span class="n">G</span><span class="o">]</span> <span class="o">[</span><span class="n">T</span> <span class="o">:</span> <span class="n">add_torsor</span> <span class="n">G</span> <span class="n">P</span><span class="o">]</span>
<span class="kn">include</span> <span class="n">T</span>

<span class="kd">instance</span> <span class="n">add_torsor.has_le</span> <span class="o">:</span> <span class="n">has_le</span> <span class="n">P</span> <span class="o">:=</span> <span class="o">⟨</span><span class="bp">λ</span> <span class="o">(</span><span class="n">x</span> <span class="n">y</span> <span class="o">:</span> <span class="n">P</span><span class="o">),</span> <span class="o">(</span><span class="mi">0</span><span class="o">:</span><span class="n">G</span><span class="o">)</span> <span class="bp">≤</span> <span class="n">y</span> <span class="bp">-ᵥ</span> <span class="n">x</span><span class="o">⟩</span>

<span class="kn">private</span> <span class="kd">lemma</span> <span class="n">le_def</span> <span class="o">{</span><span class="n">x</span> <span class="n">y</span> <span class="o">:</span> <span class="n">P</span><span class="o">}</span> <span class="o">:</span> <span class="n">x</span> <span class="bp">≤</span> <span class="n">y</span> <span class="bp">↔</span> <span class="o">(</span><span class="mi">0</span><span class="o">:</span><span class="n">G</span><span class="o">)</span> <span class="bp">≤</span> <span class="n">y</span> <span class="bp">-ᵥ</span> <span class="n">x</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="c1">-- the `≤` inside `0 ≤ y -ᵥ x` is generated from `add_group_is_add_torsor`</span>
  <span class="c1">-- instead of the expected `ordered_add_comm_group.has_le`</span>
<span class="kd">end</span>
</code></pre></div>
<p>and therefore, I cannot unwrap the definition of <code>≤</code> to prove anything. I can't even make progress in proving <code>le_def</code>.</p>



<a name="282423924"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/%60add_torsor%60%20order%20instances/near/282423924" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Hanting Zhang <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/.60add_torsor.60.20order.20instances.html#282423924">(May 15 2022 at 19:07)</a>:</h4>
<p>Going into where <code>add_torsor</code>is defined, we see that </p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">@[nolint instance_priority]</span>
<span class="kd">instance</span> <span class="n">add_group_is_add_torsor</span> <span class="o">(</span><span class="n">G</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">[</span><span class="n">add_group</span> <span class="n">G</span><span class="o">]</span> <span class="o">:</span>
  <span class="n">add_torsor</span> <span class="n">G</span> <span class="n">G</span> <span class="o">:=</span>
<span class="o">{</span> <span class="n">vsub</span> <span class="o">:=</span> <span class="n">has_sub.sub</span><span class="o">,</span>
  <span class="n">vsub_vadd'</span> <span class="o">:=</span> <span class="n">sub_add_cancel</span><span class="o">,</span>
  <span class="n">vadd_vsub'</span> <span class="o">:=</span> <span class="n">add_sub_cancel</span> <span class="o">}</span>
</code></pre></div>
<p>so, I suspect the way this is defined is messing with the typeclass resolution somehow. What's the real problem going on here and what's the best way to fix this? Thanks for any input.</p>



<a name="282424067"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/%60add_torsor%60%20order%20instances/near/282424067" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/.60add_torsor.60.20order.20instances.html#282424067">(May 15 2022 at 19:11)</a>:</h4>
<p>I don't see the problem here; does <code>iff.rfl</code> not work as a proof?</p>



<a name="282424130"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/%60add_torsor%60%20order%20instances/near/282424130" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Hanting Zhang <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/.60add_torsor.60.20order.20instances.html#282424130">(May 15 2022 at 19:12)</a>:</h4>
<p>No, unfortunately not. I've tried a lot of things but none of them seem to work. I'd love to be proven wrong though!</p>
<p>I believe that the RHS has the incorrect <code>has_le</code> instance because of <code>add_group_is_add_torsor</code></p>



<a name="282424209"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/%60add_torsor%60%20order%20instances/near/282424209" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/.60add_torsor.60.20order.20instances.html#282424209">(May 15 2022 at 19:14)</a>:</h4>
<p>This isn't a good instance because anything might be a torsor for some undetermined group</p>



<a name="282424370"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/%60add_torsor%60%20order%20instances/near/282424370" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Hanting Zhang <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/.60add_torsor.60.20order.20instances.html#282424370">(May 15 2022 at 19:18)</a>:</h4>
<p>What's the proper way to fix this? Make <code>add_group_is_add_torsor</code> lower priority?</p>



<a name="282424462"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/%60add_torsor%60%20order%20instances/near/282424462" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/.60add_torsor.60.20order.20instances.html#282424462">(May 15 2022 at 19:20)</a>:</h4>
<p>There's no way to fix this. That's the problem.</p>



<a name="282424464"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/%60add_torsor%60%20order%20instances/near/282424464" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/.60add_torsor.60.20order.20instances.html#282424464">(May 15 2022 at 19:20)</a>:</h4>
<p>It's just fundamentally not sensible in Lean. Instead you could make a class that asserts that a <code>has_le T</code> instance is propositionally equivalent to the one that would come from your definition.</p>



<a name="282424465"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/%60add_torsor%60%20order%20instances/near/282424465" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/.60add_torsor.60.20order.20instances.html#282424465">(May 15 2022 at 19:20)</a>:</h4>
<p>What are you trying to do? Do you have a reference?</p>



<a name="282424567"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/%60add_torsor%60%20order%20instances/near/282424567" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/.60add_torsor.60.20order.20instances.html#282424567">(May 15 2022 at 19:23)</a>:</h4>
<p>An option is to not have it an instance but instead make it a <code>def</code> and give it locally.</p>



<a name="282424583"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/%60add_torsor%60%20order%20instances/near/282424583" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Hanting Zhang <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/.60add_torsor.60.20order.20instances.html#282424583">(May 15 2022 at 19:23)</a>:</h4>
<p>I just wanted to say something like</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">instance</span> <span class="n">add_torsor.preorder</span> <span class="o">:</span> <span class="n">preorder</span> <span class="n">P</span> <span class="o">:=</span> <span class="gr">sorry</span>
<span class="kd">instance</span> <span class="n">add_torsor.linear_order</span><span class="o">:</span> <span class="n">linear_order</span> <span class="n">P</span> <span class="o">:=</span> <span class="gr">sorry</span>
</code></pre></div>



<a name="282424626"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/%60add_torsor%60%20order%20instances/near/282424626" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/.60add_torsor.60.20order.20instances.html#282424626">(May 15 2022 at 19:24)</a>:</h4>
<p>Yes, but do you <strong>need</strong> to?</p>



<a name="282424656"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/%60add_torsor%60%20order%20instances/near/282424656" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/.60add_torsor.60.20order.20instances.html#282424656">(May 15 2022 at 19:25)</a>:</h4>
<p>The goal seems pretty self-explanatory to me</p>



<a name="282424703"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/%60add_torsor%60%20order%20instances/near/282424703" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/.60add_torsor.60.20order.20instances.html#282424703">(May 15 2022 at 19:26)</a>:</h4>
<p>Another option is to define a type synonym.</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">@[nolint unused_arguments]</span>
<span class="kd">def</span> <span class="n">my_ordered_torsor</span> <span class="o">(</span><span class="n">G</span> <span class="n">P</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">:=</span> <span class="n">P</span>

<span class="kd">instance</span> <span class="n">my_ordered_torsor.has_le</span> <span class="o">{</span><span class="n">G</span> <span class="n">P</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">has_le</span> <span class="n">G</span><span class="o">]</span> <span class="o">[</span><span class="n">add_torsor</span> <span class="n">G</span> <span class="n">P</span><span class="o">]</span> <span class="o">:</span>
  <span class="n">has_le</span> <span class="o">(</span><span class="n">my_ordered_torsor</span> <span class="n">G</span> <span class="n">P</span><span class="o">)</span> <span class="o">:=</span>
<span class="o">⟨</span><span class="bp">λ</span> <span class="n">x</span> <span class="n">y</span><span class="o">,</span> <span class="mi">0</span> <span class="bp">≤</span> <span class="n">y</span> <span class="bp">-ᵥ</span> <span class="n">x</span><span class="o">⟩</span>
</code></pre></div>



<a name="282424710"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/%60add_torsor%60%20order%20instances/near/282424710" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Hanting Zhang <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/.60add_torsor.60.20order.20instances.html#282424710">(May 15 2022 at 19:26)</a>:</h4>
<p>Ah ok I see what you mean. The reason this is happening is because I'm trying to refactor the <code>convex</code> stuff to <code>affine_space</code>. There are some lemmas where we assume the space is ordered, so I need an order on the torsor now.</p>



<a name="282424712"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/%60add_torsor%60%20order%20instances/near/282424712" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/.60add_torsor.60.20order.20instances.html#282424712">(May 15 2022 at 19:26)</a>:</h4>
<p>Well, can someone self-explain it to me? <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span></p>



<a name="282424732"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/%60add_torsor%60%20order%20instances/near/282424732" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/.60add_torsor.60.20order.20instances.html#282424732">(May 15 2022 at 19:27)</a>:</h4>
<p>Oh you should have told me earlier. This is a refactor I started eight months ago.</p>



<a name="282424738"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/%60add_torsor%60%20order%20instances/near/282424738" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Hanting Zhang <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/.60add_torsor.60.20order.20instances.html#282424738">(May 15 2022 at 19:27)</a>:</h4>
<p>Aha, <span aria-label="rolling on the floor laughing" class="emoji emoji-1f923" role="img" title="rolling on the floor laughing">:rolling_on_the_floor_laughing:</span></p>



<a name="282424791"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/%60add_torsor%60%20order%20instances/near/282424791" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Hanting Zhang <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/.60add_torsor.60.20order.20instances.html#282424791">(May 15 2022 at 19:28)</a>:</h4>
<p>Did you make much progess?</p>



<a name="282424795"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/%60add_torsor%60%20order%20instances/near/282424795" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/.60add_torsor.60.20order.20instances.html#282424795">(May 15 2022 at 19:28)</a>:</h4>
<p>I don't see what ordering the torsor has to do with anything. The correct thing to do is to replace <code>affine_space</code> by <code>add_torsor</code> everywhere and define the real <code>affine_space</code>.</p>



<a name="282424803"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/%60add_torsor%60%20order%20instances/near/282424803" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/.60add_torsor.60.20order.20instances.html#282424803">(May 15 2022 at 19:28)</a>:</h4>
<p>I'm currently stuck on getting the definition of affine spaces right.</p>



<a name="282424886"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/%60add_torsor%60%20order%20instances/near/282424886" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/.60add_torsor.60.20order.20instances.html#282424886">(May 15 2022 at 19:30)</a>:</h4>
<p>Precisely, the problem is that our current definition of affine spaces require negation, but a few spaces we care about don't have one (measures are one of them, Yakov had an example coming from tropical geometry).</p>



<a name="282424905"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/%60add_torsor%60%20order%20instances/near/282424905" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Hanting Zhang <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/.60add_torsor.60.20order.20instances.html#282424905">(May 15 2022 at 19:30)</a>:</h4>
<p><del>Huh, what's wrong with the current definition of affine spaces?</del> I was just replacing all the <code>[add_comm_monoid E] [module k E]</code> with <code>[add_comm_group V] [module k P] [affine_space V P]</code></p>



<a name="282424916"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/%60add_torsor%60%20order%20instances/near/282424916" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/.60add_torsor.60.20order.20instances.html#282424916">(May 15 2022 at 19:31)</a>:</h4>
<p>Yeah well that's not a generalization.</p>



<a name="282424930"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/%60add_torsor%60%20order%20instances/near/282424930" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Hanting Zhang <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/.60add_torsor.60.20order.20instances.html#282424930">(May 15 2022 at 19:31)</a>:</h4>
<p>What is the generalization?</p>



<a name="282425000"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/%60add_torsor%60%20order%20instances/near/282425000" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Hanting Zhang <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/.60add_torsor.60.20order.20instances.html#282425000">(May 15 2022 at 19:32)</a>:</h4>
<p>Actually, the reason for refactoring convex is because I want to do some geometry</p>



<a name="282425008"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/%60add_torsor%60%20order%20instances/near/282425008" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/.60add_torsor.60.20order.20instances.html#282425008">(May 15 2022 at 19:33)</a>:</h4>
<p>The picture is</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">vector</span> <span class="n">space</span> <span class="bp">→</span> <span class="n">add</span> <span class="n">torsor</span>
   <span class="bp">↓</span>                <span class="bp">↓</span>
<span class="n">module</span>       <span class="bp">→</span> <span class="n">affine</span> <span class="n">space</span>
</code></pre></div>
<p>and you're jumping through the diagonal.</p>



<a name="282425070"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/%60add_torsor%60%20order%20instances/near/282425070" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/.60add_torsor.60.20order.20instances.html#282425070">(May 15 2022 at 19:34)</a>:</h4>
<p>Great! I had better things to do than refactoring something nobody was gonna use. Now that someone actually needs it (aka you), I can get back to it. Incidentally I decided to revive <a href="https://github.com/leanprover-community/mathlib/pull/9268">#9268</a> this morning.</p>



<a name="282425077"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/%60add_torsor%60%20order%20instances/near/282425077" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Hanting Zhang <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/.60add_torsor.60.20order.20instances.html#282425077">(May 15 2022 at 19:34)</a>:</h4>
<p>Oh I see, so <code>affine_space</code> is slightly too strong right now.</p>



<a name="282425085"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/%60add_torsor%60%20order%20instances/near/282425085" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/.60add_torsor.60.20order.20instances.html#282425085">(May 15 2022 at 19:34)</a>:</h4>
<p>Yep, exactly. Right now, we are missing the bottom right of the square.</p>



<a name="282425263"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/%60add_torsor%60%20order%20instances/near/282425263" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Hanting Zhang <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/.60add_torsor.60.20order.20instances.html#282425263">(May 15 2022 at 19:38)</a>:</h4>
<p>For the order instances, wouldn't we still want those after the refactor?</p>



<a name="282425301"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/%60add_torsor%60%20order%20instances/near/282425301" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/.60add_torsor.60.20order.20instances.html#282425301">(May 15 2022 at 19:39)</a>:</h4>
<p>Those are meaningless. The scalars don't live in your vector space so it makes no sense to use the order coming from it.</p>



<a name="282425481"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/%60add_torsor%60%20order%20instances/near/282425481" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/.60add_torsor.60.20order.20instances.html#282425481">(May 15 2022 at 19:43)</a>:</h4>
<p>Reid, the full picture is that you have <code>𝕜</code> the scalars, <code>V</code> the vectors, <code>P</code> the points. Hanting's instances turn an order on <code>V</code> into an order on <code>P</code>. But the order isn't on <code>V</code>, it's on <code>𝕜</code>.</p>



<a name="282425535"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/%60add_torsor%60%20order%20instances/near/282425535" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Hanting Zhang <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/.60add_torsor.60.20order.20instances.html#282425535">(May 15 2022 at 19:44)</a>:</h4>
<p>Ok maybe I still don't understand what you mean <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span></p>



<a name="282425577"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/%60add_torsor%60%20order%20instances/near/282425577" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/.60add_torsor.60.20order.20instances.html#282425577">(May 15 2022 at 19:45)</a>:</h4>
<p>What you multiply the vectors by in the definition of convexity are scalars, not vectors. And the scalars are the ones you want to be ordered.</p>



<a name="282425654"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/%60add_torsor%60%20order%20instances/near/282425654" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/.60add_torsor.60.20order.20instances.html#282425654">(May 15 2022 at 19:47)</a>:</h4>
<p>For example in <code>ℝ^n</code> what your definition is doing is saying that for convexity you consider the vectors in <code>[0, 1]^n</code> and... well I don't know what you do with those because a priori you can't multiply them to other vectors to give vectors.</p>



<a name="282425916"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/%60add_torsor%60%20order%20instances/near/282425916" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/.60add_torsor.60.20order.20instances.html#282425916">(May 15 2022 at 19:53)</a>:</h4>
<p>In general there are ordered abelian groups and torsors over them and it is reasonable to equip such a torsor with its induced ordering from the group.</p>



<a name="282425969"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/%60add_torsor%60%20order%20instances/near/282425969" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Hanting Zhang <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/.60add_torsor.60.20order.20instances.html#282425969">(May 15 2022 at 19:54)</a>:</h4>
<p>I don't see where <code>[0, 1]^n</code> is coming from in my definition, which looks like this right now:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">open_locale</span> <span class="n">affine</span>

<span class="kd">variables</span> <span class="o">(</span><span class="bp">𝕜</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">{</span><span class="n">V</span> <span class="n">P</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">ordered_ring</span> <span class="bp">𝕜</span><span class="o">]</span>
  <span class="o">[</span><span class="n">add_comm_group</span> <span class="n">V</span><span class="o">]</span> <span class="o">[</span><span class="n">module</span> <span class="bp">𝕜</span> <span class="n">V</span><span class="o">]</span> <span class="o">[</span><span class="n">affine_space</span> <span class="n">V</span> <span class="n">P</span><span class="o">]</span>
<span class="kn">include</span> <span class="n">V</span>

<span class="kn">namespace</span> <span class="n">convex</span>
<span class="kd">def</span> <span class="n">Ioo</span> <span class="o">(</span><span class="n">x</span> <span class="n">y</span> <span class="o">:</span> <span class="n">P</span><span class="o">)</span> <span class="o">:=</span> <span class="n">affine_map.line_map</span> <span class="n">x</span> <span class="n">y</span> <span class="bp">''</span> <span class="n">set.Ioo</span> <span class="o">(</span><span class="mi">0</span><span class="o">:</span><span class="bp">𝕜</span><span class="o">)</span> <span class="mi">1</span>
<span class="kd">def</span> <span class="n">Icc</span> <span class="o">(</span><span class="n">x</span> <span class="n">y</span> <span class="o">:</span> <span class="n">P</span><span class="o">)</span> <span class="o">:=</span> <span class="n">affine_map.line_map</span> <span class="n">x</span> <span class="n">y</span> <span class="bp">''</span> <span class="n">set.Icc</span> <span class="o">(</span><span class="mi">0</span><span class="o">:</span><span class="bp">𝕜</span><span class="o">)</span> <span class="mi">1</span>

<span class="kd">end</span> <span class="n">convex</span>

<span class="kd">def</span> <span class="n">convex</span> <span class="o">(</span><span class="n">s</span> <span class="o">:</span> <span class="n">set</span> <span class="n">P</span><span class="o">)</span> <span class="o">:</span> <span class="kt">Prop</span> <span class="o">:=</span>
<span class="bp">∀</span> <span class="o">⦃</span><span class="n">x</span> <span class="n">y</span> <span class="o">:</span> <span class="n">P</span><span class="o">⦄,</span> <span class="n">x</span> <span class="bp">∈</span> <span class="n">s</span> <span class="bp">→</span> <span class="n">y</span> <span class="bp">∈</span> <span class="n">s</span> <span class="bp">→</span> <span class="n">convex.Icc</span> <span class="bp">𝕜</span> <span class="n">x</span> <span class="n">y</span> <span class="bp">⊆</span> <span class="n">s</span>
</code></pre></div>
<p>(And if I understand correctly, <code>add_comm_group V</code> should be <code>add_comm_monoid V</code> after your refactor.)</p>



<a name="282425987"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/%60add_torsor%60%20order%20instances/near/282425987" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Hanting Zhang <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/.60add_torsor.60.20order.20instances.html#282425987">(May 15 2022 at 19:55)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110032">Reid Barton</span> <a href="#narrow/stream/116395-maths/topic/.60add_torsor.60.20order.20instances/near/282425916">said</a>:</p>
<blockquote>
<p>In general there are ordered abelian groups and torsors over them and it is reasonable to equip such a torsor with its induced ordering from the group.</p>
</blockquote>
<p>This was my thinking too</p>



<a name="282426893"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/%60add_torsor%60%20order%20instances/near/282426893" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/.60add_torsor.60.20order.20instances.html#282426893">(May 15 2022 at 20:15)</a>:</h4>
<p>Yeah well I don't see where you need an order on <code>P</code> in the above</p>



<a name="282426985"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/%60add_torsor%60%20order%20instances/near/282426985" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Hanting Zhang <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/.60add_torsor.60.20order.20instances.html#282426985">(May 15 2022 at 20:17)</a>:</h4>
<p>For a lemma like this, if we translate it to the <code>affine_space</code> version, then wouldn't we need an order on <code>P</code> to say <code>set.Iic r</code> where now <code>r : P</code>?</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">variables</span> <span class="o">[</span><span class="n">ordered_add_comm_monoid</span> <span class="n">β</span><span class="o">]</span> <span class="o">[</span><span class="n">module</span> <span class="bp">𝕜</span> <span class="n">β</span><span class="o">]</span> <span class="o">[</span><span class="n">ordered_smul</span> <span class="bp">𝕜</span> <span class="n">β</span><span class="o">]</span>

<span class="kd">lemma</span> <span class="n">convex_Iic</span> <span class="o">(</span><span class="n">r</span> <span class="o">:</span> <span class="n">β</span><span class="o">)</span> <span class="o">:</span> <span class="n">convex</span> <span class="bp">𝕜</span> <span class="o">(</span><span class="n">set.Iic</span> <span class="n">r</span><span class="o">)</span> <span class="o">:=</span> <span class="gr">sorry</span>
</code></pre></div>



<a name="282427129"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/%60add_torsor%60%20order%20instances/near/282427129" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/.60add_torsor.60.20order.20instances.html#282427129">(May 15 2022 at 20:20)</a>:</h4>
<p>Sure, but then you aren't deriving the order on <code>P</code>, you are using the one it already has.</p>



<a name="282427252"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/%60add_torsor%60%20order%20instances/near/282427252" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Hanting Zhang <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/.60add_torsor.60.20order.20instances.html#282427252">(May 15 2022 at 20:23)</a>:</h4>
<p>I don't see what you mean, afiak there is no order on <code>P</code>?</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">variables</span> <span class="o">{</span><span class="n">β</span> <span class="n">Pβ</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">ordered_add_comm_group</span> <span class="n">β</span><span class="o">]</span> <span class="o">[</span><span class="n">module</span> <span class="bp">𝕜</span> <span class="n">β</span><span class="o">]</span> <span class="o">[</span><span class="n">affine_space</span> <span class="n">β</span> <span class="n">Pβ</span><span class="o">]</span>
<span class="kn">include</span> <span class="n">β</span>

<span class="kd">lemma</span> <span class="n">convex_Iic</span> <span class="o">(</span><span class="n">r</span> <span class="o">:</span> <span class="n">Pβ</span><span class="o">)</span> <span class="o">:</span> <span class="n">convex</span> <span class="bp">𝕜</span> <span class="o">(</span><span class="n">set.Iic</span> <span class="n">r</span><span class="o">)</span> <span class="o">:=</span> <span class="gr">sorry</span>
</code></pre></div>
<p>If I write this right now, lean complains that it cannot synthesize an instance of <code>preorder Pβ</code></p>



<a name="282427313"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/%60add_torsor%60%20order%20instances/near/282427313" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/.60add_torsor.60.20order.20instances.html#282427313">(May 15 2022 at 20:25)</a>:</h4>
<p>Yeah, so you should add <code>[preorder Pβ]</code> to your hypotheses.</p>



<a name="282427320"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/%60add_torsor%60%20order%20instances/near/282427320" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Hanting Zhang <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/.60add_torsor.60.20order.20instances.html#282427320">(May 15 2022 at 20:25)</a>:</h4>
<p>Ohhhhhhhhhhhh</p>



<a name="282427386"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/%60add_torsor%60%20order%20instances/near/282427386" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Hanting Zhang <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/.60add_torsor.60.20order.20instances.html#282427386">(May 15 2022 at 20:27)</a>:</h4>
<p>But then the preorder on <code>Pβ</code> would not agree on the one with <code>β</code>? I would expect that the order is naturally derived from <code>β</code></p>



<a name="282427438"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/%60add_torsor%60%20order%20instances/near/282427438" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/.60add_torsor.60.20order.20instances.html#282427438">(May 15 2022 at 20:28)</a>:</h4>
<p>Yeah, so you should a class saying that the order on <code>Pβ</code> is compatible with the one on <code>β</code>.</p>



<a name="282427448"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/%60add_torsor%60%20order%20instances/near/282427448" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/.60add_torsor.60.20order.20instances.html#282427448">(May 15 2022 at 20:28)</a>:</h4>
<p>This is what <code>ordered_smul</code> does between <code>𝕜</code> and <code>β</code> in the current <code>convex_Iic</code>.</p>



<a name="282427480"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/%60add_torsor%60%20order%20instances/near/282427480" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Hanting Zhang <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/.60add_torsor.60.20order.20instances.html#282427480">(May 15 2022 at 20:30)</a>:</h4>
<p>Ahhhh ok, lol that took a while</p>



<a name="282427526"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/%60add_torsor%60%20order%20instances/near/282427526" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/.60add_torsor.60.20order.20instances.html#282427526">(May 15 2022 at 20:30)</a>:</h4>
<p>We could decide to always derive the order on a torsor from the order on its vectors, but this is a design decision that's orthogonal to what you're doing now.</p>



<a name="282427552"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/%60add_torsor%60%20order%20instances/near/282427552" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/.60add_torsor.60.20order.20instances.html#282427552">(May 15 2022 at 20:31)</a>:</h4>
<p>What kind of geometry problems are you thinking of doing? You surely don't already have applications which need such high generality?</p>



<a name="282427689"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/%60add_torsor%60%20order%20instances/near/282427689" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Hanting Zhang <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/.60add_torsor.60.20order.20instances.html#282427689">(May 15 2022 at 20:34)</a>:</h4>
<p>Yeah no, I don't really need all this, I was just thinking of defining things in Euclidean geometry for Olympiads, like triangle congruences and area api, along with more api for everything</p>



<a name="282427707"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/%60add_torsor%60%20order%20instances/near/282427707" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Hanting Zhang <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/.60add_torsor.60.20order.20instances.html#282427707">(May 15 2022 at 20:34)</a>:</h4>
<p>It's just the inevitable mathlib refactoring hole you go down trying to make things properly work</p>



<a name="282427722"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/%60add_torsor%60%20order%20instances/near/282427722" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/.60add_torsor.60.20order.20instances.html#282427722">(May 15 2022 at 20:35)</a>:</h4>
<p>Been there, done that <span aria-label="grinning" class="emoji emoji-1f600" role="img" title="grinning">:grinning:</span></p>



<a name="282427723"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/%60add_torsor%60%20order%20instances/near/282427723" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/.60add_torsor.60.20order.20instances.html#282427723">(May 15 2022 at 20:35)</a>:</h4>
<p>Welcome to my hole</p>



<a name="282427800"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/%60add_torsor%60%20order%20instances/near/282427800" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Hanting Zhang <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/.60add_torsor.60.20order.20instances.html#282427800">(May 15 2022 at 20:37)</a>:</h4>
<p>But this hole is quite interesting too! Maybe I will not worry about this convexity stuff so much then, but I'm might come back in the future in case you haven't already</p>



<a name="282427875"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/%60add_torsor%60%20order%20instances/near/282427875" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/.60add_torsor.60.20order.20instances.html#282427875">(May 15 2022 at 20:38)</a>:</h4>
<p>Yeah I've been thinking about this lots on and off this past half year, so I'm probably more due to the refactor suffering than you are <span aria-label="laughing" class="emoji emoji-1f606" role="img" title="laughing">:laughing:</span></p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>