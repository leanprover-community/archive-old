---
layout: archive
title: Zulip Chat Archive
permalink: /stream/116395-maths/topic/golfing.20.60Ico.60.20union.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/116395-maths/index.html">maths</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/golfing.20.60Ico.60.20union.html">golfing `Ico` union</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="204983674"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/golfing%20%60Ico%60%20union/near/204983674" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/golfing.20.60Ico.60.20union.html#204983674">(Jul 25 2020 at 02:25)</a>:</h4>
<p>I have the following goal:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">example</span> <span class="o">{</span><span class="n">α</span><span class="o">}</span> <span class="o">[</span><span class="n">linear_order</span> <span class="n">α</span><span class="o">]</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="o">:</span> <span class="n">α</span><span class="o">)</span> <span class="o">:</span> <span class="n">Ico</span> <span class="n">a</span> <span class="n">b</span> <span class="err">∪</span> <span class="n">Ico</span> <span class="n">b</span> <span class="n">c</span> <span class="err">∪</span> <span class="n">Ico</span> <span class="n">c</span> <span class="n">a</span> <span class="bp">=</span> <span class="n">Ico</span> <span class="n">b</span> <span class="n">a</span> <span class="err">∪</span> <span class="n">Ico</span> <span class="n">c</span> <span class="n">b</span> <span class="err">∪</span> <span class="n">Ico</span> <span class="n">a</span> <span class="n">c</span> <span class="o">:=</span> <span class="n">sorry</span>
</code></pre></div>


<p>I know how to prove this using lots of <code>by_cases</code> and <code>Ico_union_Ico</code>. Is there any easier way?</p>



<a name="204993163"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/golfing%20%60Ico%60%20union/near/204993163" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Floris van Doorn <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/golfing.20.60Ico.60.20union.html#204993163">(Jul 25 2020 at 07:47)</a>:</h4>
<p>Here it is for decidable linear orders. I think <code>Ico_union_Ico</code> is the most general lemma that "merges" the union of two <code>Ico</code>s (I do have some nonterminal simps in my proof).<br>
After doing all this, I'm not sure if this was actually easier than doing it directly, but <code>Ico_union_Ico</code> is probably also useful for a bunch of other things.</p>
<div class="codehilite"><pre><span></span><code><span class="kn">lemma</span> <span class="n">Ico_union_Ico&#39;</span> <span class="o">{</span><span class="n">α</span><span class="o">}</span> <span class="o">[</span><span class="n">decidable_linear_order</span> <span class="n">α</span><span class="o">]</span> <span class="o">{</span><span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="n">d</span> <span class="o">:</span> <span class="n">α</span><span class="o">}</span>
  <span class="o">(</span><span class="n">h1</span> <span class="o">:</span> <span class="n">a</span> <span class="bp">≤</span> <span class="n">b</span><span class="o">)</span> <span class="o">(</span><span class="n">h2</span> <span class="o">:</span> <span class="n">b</span> <span class="bp">≤</span> <span class="n">c</span><span class="o">)</span> <span class="o">(</span><span class="n">h3</span> <span class="o">:</span> <span class="n">c</span> <span class="bp">≤</span> <span class="n">d</span><span class="o">)</span> <span class="o">:</span>
  <span class="n">Ico</span> <span class="n">a</span> <span class="n">c</span> <span class="err">∪</span> <span class="n">Ico</span> <span class="n">b</span> <span class="n">d</span> <span class="bp">=</span> <span class="n">Ico</span> <span class="n">a</span> <span class="n">d</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="n">apply</span> <span class="n">subset</span><span class="bp">.</span><span class="n">antisymm</span><span class="o">,</span> <span class="n">apply</span> <span class="n">union_subset</span><span class="bp">;</span> <span class="n">apply</span> <span class="n">Ico_subset_Ico</span><span class="bp">;</span> <span class="o">{</span><span class="n">refl</span> <span class="bp">&lt;|&gt;</span> <span class="n">assumption</span><span class="o">},</span>
  <span class="n">rw</span> <span class="err">←</span> <span class="n">Ico_union_Ico_eq_Ico</span> <span class="n">h1</span> <span class="o">(</span><span class="n">le_trans</span> <span class="n">h2</span> <span class="n">h3</span><span class="o">),</span> <span class="n">apply</span> <span class="n">union_subset_union_left</span><span class="o">,</span>
  <span class="n">apply</span> <span class="n">Ico_subset_Ico</span><span class="o">,</span> <span class="n">refl</span><span class="o">,</span> <span class="n">assumption</span>
<span class="kn">end</span>

<span class="kn">lemma</span> <span class="n">Ico_union_Ico</span> <span class="o">{</span><span class="n">α</span><span class="o">}</span> <span class="o">[</span><span class="n">decidable_linear_order</span> <span class="n">α</span><span class="o">]</span> <span class="o">{</span><span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="n">d</span> <span class="o">:</span> <span class="n">α</span><span class="o">}</span>
  <span class="o">(</span><span class="n">h1</span> <span class="o">:</span> <span class="n">min</span> <span class="n">a</span> <span class="n">b</span> <span class="bp">≤</span> <span class="n">max</span> <span class="n">c</span> <span class="n">d</span><span class="o">)</span> <span class="o">(</span><span class="n">h2</span> <span class="o">:</span> <span class="n">min</span> <span class="n">c</span> <span class="n">d</span> <span class="bp">≤</span> <span class="n">max</span> <span class="n">a</span> <span class="n">b</span><span class="o">)</span> <span class="o">:</span>
  <span class="n">Ico</span> <span class="n">a</span> <span class="n">b</span> <span class="err">∪</span> <span class="n">Ico</span> <span class="n">c</span> <span class="n">d</span> <span class="bp">=</span> <span class="n">Ico</span> <span class="o">(</span><span class="n">min</span> <span class="n">a</span> <span class="n">c</span><span class="o">)</span> <span class="o">(</span><span class="n">max</span> <span class="n">b</span> <span class="n">d</span><span class="o">)</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="n">cases</span> <span class="n">le_total</span> <span class="n">a</span> <span class="n">b</span> <span class="k">with</span> <span class="n">h3</span> <span class="n">h3</span><span class="bp">;</span> <span class="n">cases</span> <span class="n">le_total</span> <span class="n">c</span> <span class="n">d</span> <span class="k">with</span> <span class="n">h4</span> <span class="n">h4</span><span class="bp">;</span> <span class="n">simp</span> <span class="o">[</span><span class="n">h3</span><span class="o">,</span> <span class="n">h4</span><span class="o">]</span> <span class="n">at</span> <span class="n">h1</span> <span class="n">h2</span> <span class="err">⊢</span><span class="o">,</span>
  <span class="o">{</span> <span class="n">cases</span> <span class="n">le_total</span> <span class="n">a</span> <span class="n">c</span> <span class="k">with</span> <span class="n">h5</span> <span class="n">h5</span><span class="bp">;</span> <span class="n">cases</span> <span class="n">le_total</span> <span class="n">b</span> <span class="n">d</span> <span class="k">with</span> <span class="n">h6</span> <span class="n">h6</span><span class="bp">;</span> <span class="n">simp</span> <span class="o">[</span><span class="n">h5</span><span class="o">,</span> <span class="n">h6</span><span class="o">],</span>
    <span class="o">{</span> <span class="n">apply</span> <span class="n">Ico_union_Ico&#39;</span><span class="bp">;</span> <span class="n">assumption</span> <span class="o">},</span>
    <span class="o">{</span> <span class="n">apply</span> <span class="n">union_eq_self_of_subset_right</span><span class="o">,</span> <span class="n">apply</span> <span class="n">Ico_subset_Ico</span><span class="bp">;</span> <span class="n">assumption</span> <span class="o">},</span>
    <span class="o">{</span> <span class="n">apply</span> <span class="n">union_eq_self_of_subset_left</span><span class="o">,</span> <span class="n">apply</span> <span class="n">Ico_subset_Ico</span><span class="bp">;</span> <span class="n">assumption</span> <span class="o">},</span>
    <span class="o">{</span> <span class="n">rw</span> <span class="n">union_comm</span><span class="o">,</span> <span class="n">apply</span> <span class="n">Ico_union_Ico&#39;</span><span class="bp">;</span> <span class="n">assumption</span> <span class="o">},</span>
     <span class="o">},</span>
  <span class="o">{</span> <span class="n">simp</span> <span class="o">[</span><span class="n">h1</span><span class="o">,</span> <span class="n">h2</span><span class="o">]</span> <span class="o">},</span>
  <span class="o">{</span> <span class="n">simp</span> <span class="o">[</span><span class="n">h1</span><span class="o">,</span> <span class="n">h2</span><span class="o">]</span> <span class="o">},</span>
  <span class="o">{</span> <span class="n">rw</span> <span class="n">Ico_eq_empty</span><span class="o">,</span> <span class="n">simp</span> <span class="bp">*</span> <span class="o">}</span>
<span class="kn">end</span>

<span class="kn">lemma</span> <span class="n">Ico_union_Ico_same</span> <span class="o">{</span><span class="n">α</span><span class="o">}</span> <span class="o">[</span><span class="n">decidable_linear_order</span> <span class="n">α</span><span class="o">]</span> <span class="o">{</span><span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="o">:</span> <span class="n">α</span><span class="o">}</span> <span class="o">:</span>
  <span class="n">Ico</span> <span class="n">a</span> <span class="n">b</span> <span class="err">∪</span> <span class="n">Ico</span> <span class="n">b</span> <span class="n">c</span> <span class="bp">=</span> <span class="n">Ico</span> <span class="o">(</span><span class="n">min</span> <span class="n">a</span> <span class="n">b</span><span class="o">)</span> <span class="o">(</span><span class="n">max</span> <span class="n">b</span> <span class="n">c</span><span class="o">)</span> <span class="o">:=</span>
<span class="n">Ico_union_Ico</span> <span class="o">(</span><span class="n">le_trans</span> <span class="o">(</span><span class="n">min_le_right</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">)</span> <span class="o">(</span><span class="n">le_max_left</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">))</span>
              <span class="o">(</span><span class="n">le_trans</span> <span class="o">(</span><span class="n">min_le_left</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">)</span> <span class="o">(</span><span class="n">le_max_right</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">))</span>

<span class="kn">example</span> <span class="o">{</span><span class="n">α</span><span class="o">}</span> <span class="o">[</span><span class="n">decidable_linear_order</span> <span class="n">α</span><span class="o">]</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="o">:</span> <span class="n">α</span><span class="o">)</span> <span class="o">:</span>
  <span class="n">Ico</span> <span class="n">a</span> <span class="n">b</span> <span class="err">∪</span> <span class="n">Ico</span> <span class="n">b</span> <span class="n">c</span> <span class="err">∪</span> <span class="n">Ico</span> <span class="n">c</span> <span class="n">a</span> <span class="bp">=</span> <span class="n">Ico</span> <span class="n">b</span> <span class="n">a</span> <span class="err">∪</span> <span class="n">Ico</span> <span class="n">c</span> <span class="n">b</span> <span class="err">∪</span> <span class="n">Ico</span> <span class="n">a</span> <span class="n">c</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="n">rw</span> <span class="o">[</span><span class="n">Ico_union_Ico_same</span><span class="o">,</span> <span class="n">Ico_union_Ico</span><span class="o">,</span> <span class="n">union_comm</span> <span class="o">(</span><span class="n">Ico</span> <span class="n">b</span> <span class="n">a</span><span class="o">),</span> <span class="n">Ico_union_Ico_same</span><span class="o">,</span> <span class="n">Ico_union_Ico</span><span class="o">],</span>
  <span class="o">{</span> <span class="n">simp</span> <span class="n">only</span> <span class="o">[</span><span class="n">max_left_comm</span><span class="o">,</span> <span class="n">min_left_comm</span><span class="o">,</span> <span class="n">min_comm</span><span class="o">,</span> <span class="n">max_comm</span><span class="o">]</span> <span class="o">},</span>
  <span class="n">all_goals</span> <span class="o">{</span> <span class="n">simp</span><span class="o">,</span> <span class="n">finish</span> <span class="o">},</span>
<span class="kn">end</span>
</code></pre></div>



<a name="204994189"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/golfing%20%60Ico%60%20union/near/204994189" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/golfing.20.60Ico.60.20union.html#204994189">(Jul 25 2020 at 08:15)</a>:</h4>
<p>I think the proof should be: WLOG a&lt;=b&lt;=c; linarith.</p>



<a name="204994238"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/golfing%20%60Ico%60%20union/near/204994238" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/golfing.20.60Ico.60.20union.html#204994238">(Jul 25 2020 at 08:16)</a>:</h4>
<p>The theorem statement is S3-invariant.</p>



<a name="204994772"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/golfing%20%60Ico%60%20union/near/204994772" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/golfing.20.60Ico.60.20union.html#204994772">(Jul 25 2020 at 08:35)</a>:</h4>
<p>Aah I see, you still have to do a case split on X&lt;b</p>



<a name="204996229"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/golfing%20%60Ico%60%20union/near/204996229" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/golfing.20.60Ico.60.20union.html#204996229">(Jul 25 2020 at 09:15)</a>:</h4>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="n">tactic</span>
<span class="kn">import</span> <span class="n">data</span><span class="bp">.</span><span class="n">real</span><span class="bp">.</span><span class="n">basic</span>

<span class="kn">open</span> <span class="n">set</span>

<span class="kn">lemma</span> <span class="n">Ico_union_Ico</span> <span class="o">{</span><span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="n">d</span> <span class="o">:</span> <span class="n">ℝ</span><span class="o">}</span>
  <span class="o">(</span><span class="n">h1</span> <span class="o">:</span> <span class="n">min</span> <span class="n">a</span> <span class="n">b</span> <span class="bp">≤</span> <span class="n">max</span> <span class="n">c</span> <span class="n">d</span><span class="o">)</span> <span class="o">(</span><span class="n">h2</span> <span class="o">:</span> <span class="n">min</span> <span class="n">c</span> <span class="n">d</span> <span class="bp">≤</span> <span class="n">max</span> <span class="n">a</span> <span class="n">b</span><span class="o">)</span> <span class="o">:</span>
  <span class="n">Ico</span> <span class="n">a</span> <span class="n">b</span> <span class="err">∪</span> <span class="n">Ico</span> <span class="n">c</span> <span class="n">d</span> <span class="bp">=</span> <span class="n">Ico</span> <span class="o">(</span><span class="n">min</span> <span class="n">a</span> <span class="n">c</span><span class="o">)</span> <span class="o">(</span><span class="n">max</span> <span class="n">b</span> <span class="n">d</span><span class="o">)</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="n">ext</span> <span class="n">x</span><span class="o">,</span>
  <span class="n">split</span><span class="o">,</span>
  <span class="n">all_goals</span> <span class="o">{</span><span class="n">intro</span> <span class="n">h</span><span class="o">},</span>
  <span class="n">all_goals</span> <span class="o">{</span><span class="n">try</span> <span class="o">{</span><span class="n">cases</span> <span class="n">h</span> <span class="k">with</span> <span class="n">h3</span> <span class="n">h4</span><span class="o">}},</span>
  <span class="n">all_goals</span> <span class="o">{</span><span class="n">unfold</span> <span class="n">min</span> <span class="n">max</span> <span class="n">Ico</span> <span class="n">at</span> <span class="bp">*</span><span class="o">},</span>
  <span class="c1">-- split_ifs at * leads to a weird state with multiple copies of variables :-(</span>
  <span class="n">all_goals</span> <span class="o">{</span><span class="n">try</span> <span class="o">{</span><span class="n">split_ifs</span> <span class="n">at</span> <span class="n">h1</span><span class="o">}},</span>
  <span class="n">all_goals</span> <span class="o">{</span><span class="n">try</span> <span class="o">{</span><span class="n">split_ifs</span> <span class="n">at</span> <span class="n">h2</span><span class="o">}},</span>
  <span class="n">all_goals</span> <span class="o">{</span><span class="n">try</span> <span class="o">{</span><span class="n">split_ifs</span> <span class="n">at</span> <span class="n">h3</span><span class="o">}},</span>
  <span class="n">all_goals</span> <span class="o">{</span><span class="n">try</span> <span class="o">{</span><span class="n">split_ifs</span> <span class="n">at</span> <span class="n">h4</span><span class="o">}},</span>
  <span class="n">all_goals</span> <span class="o">{</span><span class="n">try</span> <span class="o">{</span><span class="n">split_ifs</span><span class="o">}},</span>
  <span class="n">all_goals</span> <span class="o">{</span><span class="n">try</span> <span class="o">{</span><span class="n">split</span><span class="o">}},</span>
  <span class="c1">-- 144 goals at this point</span>
  <span class="n">all_goals</span> <span class="o">{</span><span class="n">try</span> <span class="o">{</span><span class="n">cases</span> <span class="n">h3</span><span class="o">}},</span>
  <span class="n">all_goals</span> <span class="o">{</span><span class="n">try</span> <span class="o">{</span><span class="n">cases</span> <span class="n">h4</span><span class="o">}},</span>
  <span class="n">all_goals</span> <span class="o">{</span><span class="n">try</span> <span class="o">{</span><span class="n">linarith</span><span class="o">}},</span>
  <span class="n">all_goals</span> <span class="o">{</span><span class="n">try</span> <span class="o">{</span><span class="n">left</span><span class="o">,</span> <span class="n">split</span><span class="bp">;</span> <span class="n">linarith</span><span class="o">}},</span>
  <span class="n">all_goals</span> <span class="o">{</span><span class="n">try</span> <span class="o">{</span><span class="n">right</span><span class="o">,</span> <span class="n">split</span><span class="bp">;</span> <span class="n">linarith</span><span class="o">}},</span>
  <span class="c1">-- two left</span>
  <span class="n">all_goals</span> <span class="o">{</span><span class="n">by_cases</span> <span class="n">h5</span> <span class="o">:</span> <span class="n">x</span> <span class="bp">&lt;</span> <span class="n">b</span><span class="o">},</span>
  <span class="n">all_goals</span> <span class="o">{</span><span class="n">try</span> <span class="o">{</span><span class="n">left</span><span class="o">,</span> <span class="n">split</span><span class="bp">;</span> <span class="n">linarith</span><span class="o">}},</span>
  <span class="n">all_goals</span> <span class="o">{</span><span class="n">try</span> <span class="o">{</span><span class="n">right</span><span class="o">,</span> <span class="n">split</span><span class="bp">;</span> <span class="n">linarith</span><span class="o">}},</span>
  <span class="c">/-</span><span class="cm"></span>
<span class="cm">  abcdx: ℝ</span>
<span class="cm">h: a ≤ b</span>
<span class="cm">h_1: c ≤ d</span>
<span class="cm">h1: a ≤ d</span>
<span class="cm">h_2: c ≤ d</span>
<span class="cm">h2: c ≤ b</span>
<span class="cm">h_3: ¬a ≤ c</span>
<span class="cm">h3: c ≤ x</span>
<span class="cm">h_4: ¬b ≤ d</span>
<span class="cm">h4: x &lt; b</span>
<span class="cm">h5: x &lt; b</span>
<span class="cm">⊢ x ∈ {x : ℝ | a ≤ x ∧ x &lt; b} ∪ {x : ℝ | c ≤ x ∧ x &lt; d}</span>
<span class="cm">-/</span>
  <span class="n">sorry</span>
<span class="kn">end</span>
</code></pre></div>


<p>If you do <code>split_ifs at *</code> you can end up with five variables called a sometimes. I was using semicolons but  all_goals is clearer. I got from 1 goal to 160 and then back down to 1 but I didn't quite finish and now I have to go :-/ Do I need one more case split? Why do I need case splits? Is there something that linarith doesn't know? Would like to diagnose but have family duties</p>



<a name="204996359"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/golfing%20%60Ico%60%20union/near/204996359" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/golfing.20.60Ico.60.20union.html#204996359">(Jul 25 2020 at 09:18)</a>:</h4>
<p><span class="user-mention" data-user-id="110038">@Kevin Buzzard</span> what's the maths proof that isn't "draw a picture"?</p>



<a name="204996459"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/golfing%20%60Ico%60%20union/near/204996459" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/golfing.20.60Ico.60.20union.html#204996459">(Jul 25 2020 at 09:21)</a>:</h4>
<p>I just posted it: get the tactics to draw the picture</p>



<a name="204997401"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/golfing%20%60Ico%60%20union/near/204997401" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/golfing.20.60Ico.60.20union.html#204997401">(Jul 25 2020 at 09:52)</a>:</h4>
<p>Why can't I close my last goal? c&lt;a&lt;=d&lt;b</p>



<a name="204999538"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/golfing%20%60Ico%60%20union/near/204999538" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jasmin Blanchette <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/golfing.20.60Ico.60.20union.html#204999538">(Jul 25 2020 at 11:02)</a>:</h4>
<p>Because no hammer?<br>
<a href="/user_uploads/3121/KTTOYzmfydAWNUIosqE79Zuj/Screen-Shot-2020-07-25-at-13.01.42.png">Screen-Shot-2020-07-25-at-13.01.42.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/3121/KTTOYzmfydAWNUIosqE79Zuj/Screen-Shot-2020-07-25-at-13.01.42.png" title="Screen-Shot-2020-07-25-at-13.01.42.png"><img src="/user_uploads/3121/KTTOYzmfydAWNUIosqE79Zuj/Screen-Shot-2020-07-25-at-13.01.42.png"></a></div>



<a name="204999547"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/golfing%20%60Ico%60%20union/near/204999547" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jasmin Blanchette <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/golfing.20.60Ico.60.20union.html#204999547">(Jul 25 2020 at 11:03)</a>:</h4>
<p>(In turn, because excruciatingly low Lean 3 metaprogramming framework.)</p>



<a name="205000097"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/golfing%20%60Ico%60%20union/near/205000097" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/golfing.20.60Ico.60.20union.html#205000097">(Jul 25 2020 at 11:22)</a>:</h4>
<p>Yeah that's the correct proof</p>



<a name="205000100"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/golfing%20%60Ico%60%20union/near/205000100" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/golfing.20.60Ico.60.20union.html#205000100">(Jul 25 2020 at 11:22)</a>:</h4>
<p>"It's obvious"</p>



<a name="205009947"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/golfing%20%60Ico%60%20union/near/205009947" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Floris van Doorn <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/golfing.20.60Ico.60.20union.html#205009947">(Jul 25 2020 at 16:09)</a>:</h4>
<p>Yes, we do miss sledgehammer in Lean.<br>
However, many of your conjunctions should be disjunctions: you only know</p>
<div class="codehilite"><pre><span></span><code><span class="n">h1</span> <span class="o">:</span> <span class="n">a</span> <span class="bp">≤</span> <span class="n">c</span> <span class="bp">∨</span> <span class="n">b</span> <span class="bp">≤</span> <span class="n">c</span> <span class="bp">∨</span> <span class="n">a</span> <span class="bp">≤</span> <span class="n">d</span> <span class="bp">∨</span> <span class="n">b</span> <span class="bp">≤</span> <span class="n">d</span><span class="o">,</span>
<span class="n">h2</span> <span class="o">:</span> <span class="n">c</span> <span class="bp">≤</span> <span class="n">a</span> <span class="bp">∨</span> <span class="n">d</span> <span class="bp">≤</span> <span class="n">a</span> <span class="bp">∨</span> <span class="n">c</span> <span class="bp">≤</span> <span class="n">b</span> <span class="bp">∨</span> <span class="n">d</span> <span class="bp">≤</span> <span class="n">b</span>
</code></pre></div>



<a name="205009949"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/golfing%20%60Ico%60%20union/near/205009949" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Floris van Doorn <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/golfing.20.60Ico.60.20union.html#205009949">(Jul 25 2020 at 16:09)</a>:</h4>
<p><span class="user-mention" data-user-id="121058">@Jasmin Blanchette</span></p>



<a name="205010010"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/golfing%20%60Ico%60%20union/near/205010010" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Floris van Doorn <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/golfing.20.60Ico.60.20union.html#205010010">(Jul 25 2020 at 16:10)</a>:</h4>
<p>Oh sorry, you responded to Kevin, you were not golfing my lemma. My bad.</p>



<a name="205010026"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/golfing%20%60Ico%60%20union/near/205010026" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Floris van Doorn <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/golfing.20.60Ico.60.20union.html#205010026">(Jul 25 2020 at 16:11)</a>:</h4>
<p>Does sledgehammer solve the complete lemma by itself?</p>



<a name="205010470"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/golfing%20%60Ico%60%20union/near/205010470" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/golfing.20.60Ico.60.20union.html#205010470">(Jul 25 2020 at 16:23)</a>:</h4>
<p>The screenshot suggests we miss <code>auto</code> or <code>force</code>, not really sledgehammer (unless you consider these to be part of sledgehammer).</p>



<a name="205012274"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/golfing%20%60Ico%60%20union/near/205012274" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/golfing.20.60Ico.60.20union.html#205012274">(Jul 25 2020 at 17:07)</a>:</h4>
<p>I came up with the following (for a <code>decidable_linear_order</code>):</p>
<div class="codehilite"><pre><span></span><code><span class="kn">lemma</span> <span class="n">Ico_union_Ico_union_Ico_cycle</span> <span class="o">:</span>
  <span class="n">Ico</span> <span class="n">a</span> <span class="n">b</span> <span class="err">∪</span> <span class="n">Ico</span> <span class="n">b</span> <span class="n">c</span> <span class="err">∪</span> <span class="n">Ico</span> <span class="n">c</span> <span class="n">a</span> <span class="bp">=</span> <span class="n">Ico</span> <span class="o">(</span><span class="n">min</span> <span class="n">a</span> <span class="o">(</span><span class="n">min</span> <span class="n">b</span> <span class="n">c</span><span class="o">))</span> <span class="o">(</span><span class="n">max</span> <span class="n">a</span> <span class="o">(</span><span class="n">max</span> <span class="n">b</span> <span class="n">c</span><span class="o">))</span> <span class="o">:=</span>
<span class="n">ext</span> <span class="err">$</span> <span class="bp">λ</span> <span class="n">x</span><span class="o">,</span> <span class="k">by</span> <span class="n">simp</span> <span class="o">[</span><span class="n">iff_def</span><span class="o">,</span> <span class="n">or_imp_distrib</span><span class="o">,</span> <span class="n">lt_or_le</span><span class="o">]</span> <span class="o">{</span> <span class="n">contextual</span> <span class="o">:=</span> <span class="n">tt</span> <span class="o">}</span><span class="bp">;</span>
  <span class="n">simp</span> <span class="o">[</span><span class="err">←</span> <span class="n">or_assoc</span><span class="o">,</span> <span class="n">or_comm</span><span class="o">,</span> <span class="n">lt_or_le</span><span class="o">]</span>
</code></pre></div>



<a name="205012498"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/golfing%20%60Ico%60%20union/near/205012498" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/golfing.20.60Ico.60.20union.html#205012498">(Jul 25 2020 at 17:12)</a>:</h4>
<p>It would be really nice to have a tactic doing this is a pretty general context.</p>



<a name="205015135"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/golfing%20%60Ico%60%20union/near/205015135" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jasmin Blanchette <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/golfing.20.60Ico.60.20union.html#205015135">(Jul 25 2020 at 18:16)</a>:</h4>
<p>@Floris: I can't test easily without knowing what <code>Ico</code> is.</p>



<a name="205015339"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/golfing%20%60Ico%60%20union/near/205015339" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/golfing.20.60Ico.60.20union.html#205015339">(Jul 25 2020 at 18:20)</a>:</h4>
<p><a href="https://leanprover-community.github.io/mathlib_docs/find/set.Ico/src">src#set.Ico</a></p>



<a name="205015598"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/golfing%20%60Ico%60%20union/near/205015598" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jasmin Blanchette <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/golfing.20.60Ico.60.20union.html#205015598">(Jul 25 2020 at 18:25)</a>:</h4>
<p><span class="user-mention" data-user-id="110031">@Patrick Massot</span> another proof is possible with Isabelle's <code>simp</code> + <code>linarith</code>.</p>



<a name="205016730"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/golfing%20%60Ico%60%20union/near/205016730" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/golfing.20.60Ico.60.20union.html#205016730">(Jul 25 2020 at 18:51)</a>:</h4>
<p>Here's a more basic proof along the lines of floris's first proof:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">lemma</span> <span class="n">Ico_union_Ico</span> <span class="o">{</span><span class="n">α</span><span class="o">}</span> <span class="o">[</span><span class="n">decidable_linear_order</span> <span class="n">α</span><span class="o">]</span> <span class="o">{</span><span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="n">d</span> <span class="o">:</span> <span class="n">α</span><span class="o">}</span>
  <span class="o">(</span><span class="n">h1</span> <span class="o">:</span> <span class="n">min</span> <span class="n">a</span> <span class="n">b</span> <span class="bp">≤</span> <span class="n">max</span> <span class="n">c</span> <span class="n">d</span><span class="o">)</span> <span class="o">(</span><span class="n">h2</span> <span class="o">:</span> <span class="n">min</span> <span class="n">c</span> <span class="n">d</span> <span class="bp">≤</span> <span class="n">max</span> <span class="n">a</span> <span class="n">b</span><span class="o">)</span> <span class="o">:</span>
  <span class="n">Ico</span> <span class="n">a</span> <span class="n">b</span> <span class="err">∪</span> <span class="n">Ico</span> <span class="n">c</span> <span class="n">d</span> <span class="bp">=</span> <span class="n">Ico</span> <span class="o">(</span><span class="n">min</span> <span class="n">a</span> <span class="n">c</span><span class="o">)</span> <span class="o">(</span><span class="n">max</span> <span class="n">b</span> <span class="n">d</span><span class="o">)</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="n">apply</span> <span class="n">subset</span><span class="bp">.</span><span class="n">antisymm</span><span class="o">,</span>
  <span class="o">{</span> <span class="n">apply</span> <span class="n">union_subset</span><span class="bp">;</span> <span class="n">apply</span> <span class="n">Ico_subset_Ico</span><span class="bp">;</span> <span class="n">simp</span> <span class="o">[</span><span class="n">le_refl</span><span class="o">]</span> <span class="o">},</span>
  <span class="n">rintro</span> <span class="n">x</span> <span class="bp">⟨</span><span class="n">h3</span><span class="o">,</span> <span class="n">h4</span><span class="bp">⟩;</span> <span class="n">simp</span> <span class="n">at</span> <span class="n">h3</span> <span class="n">h4</span> <span class="err">⊢</span><span class="o">,</span>
  <span class="n">cases</span> <span class="n">h3</span><span class="bp">;</span> <span class="n">cases</span> <span class="n">h4</span><span class="bp">;</span> <span class="n">simp</span> <span class="o">[</span><span class="n">h3</span><span class="o">,</span> <span class="n">h4</span><span class="o">]</span><span class="bp">;</span> <span class="n">by_contra</span> <span class="n">hn</span><span class="bp">;</span> <span class="n">push_neg</span> <span class="n">at</span> <span class="n">hn</span><span class="bp">;</span> <span class="n">cases</span> <span class="n">hn</span> <span class="k">with</span> <span class="n">h5</span> <span class="n">h6</span><span class="o">,</span>
  <span class="o">{</span> <span class="n">exact</span> <span class="n">not_le_of_lt</span> <span class="o">(</span><span class="n">lt_min</span> <span class="n">h6</span> <span class="n">h4</span><span class="o">)</span> <span class="o">(</span><span class="n">le_trans</span> <span class="n">h2</span> <span class="o">(</span><span class="n">max_le</span> <span class="n">h3</span> <span class="n">h5</span><span class="o">))</span> <span class="o">},</span>
  <span class="o">{</span> <span class="n">exact</span> <span class="n">not_le_of_lt</span> <span class="o">(</span><span class="n">lt_min</span> <span class="n">h5</span> <span class="n">h4</span><span class="o">)</span> <span class="o">(</span><span class="n">le_trans</span> <span class="n">h1</span> <span class="o">(</span><span class="n">max_le</span> <span class="n">h3</span> <span class="n">h6</span><span class="o">))</span> <span class="o">}</span>
<span class="kn">end</span>
</code></pre></div>


<p>I tried <code>linarith</code> on the last two goals but it didn't work, does it not do proofs in pure inequality structures?</p>



<a name="205017775"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/golfing%20%60Ico%60%20union/near/205017775" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/golfing.20.60Ico.60.20union.html#205017775">(Jul 25 2020 at 19:17)</a>:</h4>
<p>Golfed:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">lemma</span> <span class="n">Ico_Ico_Ico</span> <span class="o">{</span><span class="n">α</span><span class="o">}</span> <span class="o">[</span><span class="n">linear_order</span> <span class="n">α</span><span class="o">]</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="o">:</span> <span class="n">α</span><span class="o">)</span> <span class="o">:</span>
  <span class="n">Ico</span> <span class="n">a</span> <span class="n">b</span> <span class="err">∪</span> <span class="n">Ico</span> <span class="n">b</span> <span class="n">c</span> <span class="err">∪</span> <span class="n">Ico</span> <span class="n">c</span> <span class="n">a</span> <span class="bp">=</span> <span class="n">Ico</span> <span class="n">b</span> <span class="n">a</span> <span class="err">∪</span> <span class="n">Ico</span> <span class="n">c</span> <span class="n">b</span> <span class="err">∪</span> <span class="n">Ico</span> <span class="n">a</span> <span class="n">c</span> <span class="o">:=</span>
<span class="k">by</span> <span class="n">ext</span><span class="bp">;</span> <span class="n">split</span><span class="bp">;</span> <span class="n">finish</span> <span class="kn">using</span> <span class="o">[</span><span class="n">lt_of_le_of_lt</span><span class="o">,</span> <span class="n">lt_of_lt_of_le</span><span class="o">,</span> <span class="n">lt_irrefl</span><span class="o">]</span> <span class="o">{</span><span class="n">max_ematch_rounds</span> <span class="o">:=</span> <span class="mi">2</span><span class="o">}</span>
</code></pre></div>


<p>(Please don't run the profiler on this.)</p>



<a name="205019138"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/golfing%20%60Ico%60%20union/near/205019138" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/golfing.20.60Ico.60.20union.html#205019138">(Jul 25 2020 at 19:52)</a>:</h4>
<p>Slightly faster (five seconds):</p>
<div class="codehilite"><pre><span></span><code><span class="kn">lemma</span> <span class="n">Ico_Ico_Ico</span> <span class="o">{</span><span class="n">α</span><span class="o">}</span> <span class="o">[</span><span class="n">linear_order</span> <span class="n">α</span><span class="o">]</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="o">:</span> <span class="n">α</span><span class="o">)</span> <span class="o">:</span>
  <span class="n">Ico</span> <span class="n">a</span> <span class="n">b</span> <span class="err">∪</span> <span class="n">Ico</span> <span class="n">b</span> <span class="n">c</span> <span class="err">∪</span> <span class="n">Ico</span> <span class="n">c</span> <span class="n">a</span> <span class="bp">=</span> <span class="n">Ico</span> <span class="n">b</span> <span class="n">a</span> <span class="err">∪</span> <span class="n">Ico</span> <span class="n">c</span> <span class="n">b</span> <span class="err">∪</span> <span class="n">Ico</span> <span class="n">a</span> <span class="n">c</span> <span class="o">:=</span>
<span class="k">by</span> <span class="n">ext</span><span class="bp">;</span> <span class="n">simp</span><span class="bp">;</span> <span class="n">super</span> <span class="k">with</span> <span class="n">lt_irrefl</span> <span class="n">lt_of_lt_of_le</span> <span class="n">lt_of_le_of_lt</span> <span class="n">le_or_lt</span> <span class="o">{</span><span class="n">timeout</span> <span class="o">:=</span> <span class="mi">50000</span><span class="o">}</span>
</code></pre></div>


<p>This should be acceptably fast in <span aria-label="four leaf clover" class="emoji emoji-1f340" role="img" title="four leaf clover">:four_leaf_clover:</span>.</p>



<a name="205021344"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/golfing%20%60Ico%60%20union/near/205021344" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/golfing.20.60Ico.60.20union.html#205021344">(Jul 25 2020 at 20:56)</a>:</h4>
<p><span class="user-mention silent" data-user-id="121058">Jasmin Blanchette</span> <a href="#narrow/stream/116395-maths/topic/golfing.20.60Ico.60.20union/near/205015598">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="110031">Patrick Massot</span> another proof is possible with Isabelle's <code>simp</code> + <code>linarith</code>.</p>
</blockquote>
<p>We want all of this <span aria-label="grinning" class="emoji emoji-1f600" role="img" title="grinning">:grinning:</span></p>



<a name="205027499"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/golfing%20%60Ico%60%20union/near/205027499" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/golfing.20.60Ico.60.20union.html#205027499">(Jul 25 2020 at 23:58)</a>:</h4>
<p>Note that we can't use Lean <code>linarith</code> because we have only <code>(decidable_)linear_order</code>, no <code>ordered_field</code>.</p>



<a name="205027506"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/golfing%20%60Ico%60%20union/near/205027506" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/golfing.20.60Ico.60.20union.html#205027506">(Jul 25 2020 at 23:59)</a>:</h4>
<p>BTW, <span class="user-mention" data-user-id="121058">@Jasmin Blanchette</span> what does Isabelle say in this context (<code>linear_order</code> only)?</p>



<a name="205040715"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/golfing%20%60Ico%60%20union/near/205040715" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastien Gouezel <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/golfing.20.60Ico.60.20union.html#205040715">(Jul 26 2020 at 07:33)</a>:</h4>
<div class="codehilite"><pre><span></span><code><span class="kn">lemma</span> <span class="n">auto_is_strong</span><span class="o">:</span>
  <span class="n">fixes</span> <span class="n">a</span> <span class="n">b</span> <span class="n">c</span><span class="bp">::</span><span class="s2">&quot;&#39;a::linorder&quot;</span>
  <span class="n">shows</span> <span class="s2">&quot;{a ..&lt; b} ∪ {b ..&lt; c} ∪ {c ..&lt; a} = {b ..&lt; a} ∪ {c ..&lt; b} ∪ {a ..&lt; c}&quot;</span>
<span class="k">by</span> <span class="n">auto</span>
</code></pre></div>



<a name="205040721"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/golfing%20%60Ico%60%20union/near/205040721" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastien Gouezel <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/golfing.20.60Ico.60.20union.html#205040721">(Jul 26 2020 at 07:34)</a>:</h4>
<p>(takes less than 1/10s)</p>



<a name="205040815"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/golfing%20%60Ico%60%20union/near/205040815" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastien Gouezel <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/golfing.20.60Ico.60.20union.html#205040815">(Jul 26 2020 at 07:36)</a>:</h4>
<p>I guess <code>auto</code> will use some <code>simp</code> lemmas that will depend on the order of the points, then split automatically on case disjunction, then use some version of linarith that works in linear orders, but I don't know how to ask details about the proof.</p>



<a name="205041529"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/golfing%20%60Ico%60%20union/near/205041529" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastien Gouezel <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/golfing.20.60Ico.60.20union.html#205041529">(Jul 26 2020 at 08:00)</a>:</h4>
<p>In fact, I don't think it uses any fancy version of linarith. Probably it only applies <code>lt_of_le</code>, <code>lt_trans</code> a few times (at most 5, say), see all the consequences it gets from this, and then sees if the goal is in there (but in a more efficient way called a tableau prover). Essentially what Gabriel did with its <code>super</code> invocation, in fact. Except that it is really fast in Isabelle, and completely automatic.</p>



<a name="205042340"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/golfing%20%60Ico%60%20union/near/205042340" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jasmin Blanchette <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/golfing.20.60Ico.60.20union.html#205042340">(Jul 26 2020 at 08:26)</a>:</h4>
<p><span class="user-mention" data-user-id="256311">@Jannis Limperg</span> I hope you are paying attention. ;)</p>



<a name="205042411"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/golfing%20%60Ico%60%20union/near/205042411" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/golfing.20.60Ico.60.20union.html#205042411">(Jul 26 2020 at 08:29)</a>:</h4>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="n">data</span><span class="bp">.</span><span class="n">set</span><span class="bp">.</span><span class="n">intervals</span><span class="bp">.</span><span class="n">basic</span>

<span class="kn">open</span> <span class="n">set</span>

<span class="kn">example</span> <span class="o">{</span><span class="n">α</span><span class="o">}</span> <span class="o">[</span><span class="n">linear_order</span> <span class="n">α</span><span class="o">]</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="o">:</span> <span class="n">α</span><span class="o">)</span> <span class="o">:</span> <span class="n">Ico</span> <span class="n">a</span> <span class="n">b</span> <span class="err">∪</span> <span class="n">Ico</span> <span class="n">b</span> <span class="n">c</span> <span class="err">∪</span> <span class="n">Ico</span> <span class="n">c</span> <span class="n">a</span> <span class="bp">=</span> <span class="n">Ico</span> <span class="n">b</span> <span class="n">a</span> <span class="err">∪</span> <span class="n">Ico</span> <span class="n">c</span> <span class="n">b</span> <span class="err">∪</span> <span class="n">Ico</span> <span class="n">a</span> <span class="n">c</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="n">cases</span> <span class="n">le_total</span> <span class="n">a</span> <span class="n">b</span> <span class="k">with</span> <span class="n">hab</span> <span class="n">hba</span><span class="bp">;</span> <span class="n">cases</span> <span class="n">le_total</span> <span class="n">b</span> <span class="n">c</span> <span class="k">with</span> <span class="n">hbc</span> <span class="n">hcb</span><span class="o">,</span>
  <span class="o">{</span> <span class="n">rw</span> <span class="o">[</span><span class="n">Ico_eq_empty</span> <span class="n">hab</span><span class="o">,</span> <span class="n">Ico_eq_empty</span> <span class="n">hbc</span><span class="o">,</span> <span class="n">Ico_eq_empty</span> <span class="o">(</span><span class="n">le_trans</span> <span class="n">hab</span> <span class="n">hbc</span><span class="o">),</span>
      <span class="n">empty_union</span><span class="o">,</span> <span class="n">empty_union</span><span class="o">,</span> <span class="n">union_empty</span><span class="o">,</span> <span class="n">Ico_union_Ico_eq_Ico</span> <span class="n">hab</span> <span class="n">hbc</span><span class="o">]</span> <span class="o">},</span>
  <span class="o">{</span> <span class="n">cases</span> <span class="n">le_total</span> <span class="n">a</span> <span class="n">c</span> <span class="k">with</span> <span class="n">hac</span> <span class="n">hca</span><span class="o">,</span>
    <span class="o">{</span> <span class="n">rw</span> <span class="o">[</span><span class="n">Ico_eq_empty</span> <span class="n">hac</span><span class="o">,</span> <span class="n">Ico_eq_empty</span> <span class="n">hcb</span><span class="o">,</span> <span class="n">Ico_eq_empty</span> <span class="n">hab</span><span class="o">,</span>
        <span class="n">empty_union</span><span class="o">,</span> <span class="n">union_empty</span><span class="o">,</span> <span class="n">union_empty</span><span class="o">,</span> <span class="n">union_comm</span><span class="o">,</span> <span class="n">Ico_union_Ico_eq_Ico</span> <span class="n">hac</span> <span class="n">hcb</span><span class="o">]</span> <span class="o">},</span>
    <span class="o">{</span> <span class="n">rw</span> <span class="o">[</span><span class="n">Ico_eq_empty</span> <span class="n">hca</span><span class="o">,</span> <span class="n">Ico_eq_empty</span> <span class="n">hcb</span><span class="o">,</span> <span class="n">Ico_eq_empty</span> <span class="n">hab</span><span class="o">,</span>
        <span class="n">empty_union</span><span class="o">,</span> <span class="n">union_empty</span><span class="o">,</span> <span class="n">union_empty</span><span class="o">,</span> <span class="n">union_comm</span><span class="o">,</span> <span class="n">Ico_union_Ico_eq_Ico</span> <span class="n">hca</span> <span class="n">hab</span><span class="o">]</span> <span class="o">}</span> <span class="o">},</span>
  <span class="o">{</span> <span class="n">cases</span> <span class="n">le_total</span> <span class="n">a</span> <span class="n">c</span> <span class="k">with</span> <span class="n">hac</span> <span class="n">hca</span><span class="o">,</span>
    <span class="o">{</span> <span class="n">rw</span> <span class="o">[</span><span class="n">Ico_eq_empty</span> <span class="n">hac</span><span class="o">,</span> <span class="n">Ico_eq_empty</span> <span class="n">hbc</span><span class="o">,</span> <span class="n">Ico_eq_empty</span> <span class="n">hba</span><span class="o">,</span>
        <span class="n">empty_union</span><span class="o">,</span> <span class="n">union_empty</span><span class="o">,</span> <span class="n">union_empty</span><span class="o">,</span> <span class="n">Ico_union_Ico_eq_Ico</span> <span class="n">hba</span> <span class="n">hac</span><span class="o">]</span> <span class="o">},</span>
    <span class="o">{</span> <span class="n">rw</span> <span class="o">[</span><span class="n">Ico_eq_empty</span> <span class="n">hca</span><span class="o">,</span> <span class="n">Ico_eq_empty</span> <span class="n">hbc</span><span class="o">,</span> <span class="n">Ico_eq_empty</span> <span class="n">hba</span><span class="o">,</span>
        <span class="n">empty_union</span><span class="o">,</span> <span class="n">union_empty</span><span class="o">,</span> <span class="n">union_empty</span><span class="o">,</span> <span class="n">Ico_union_Ico_eq_Ico</span> <span class="n">hbc</span> <span class="n">hca</span><span class="o">]</span> <span class="o">}</span> <span class="o">},</span>
  <span class="o">{</span> <span class="n">rw</span> <span class="o">[</span><span class="n">Ico_eq_empty</span> <span class="n">hcb</span><span class="o">,</span> <span class="n">Ico_eq_empty</span> <span class="n">hba</span><span class="o">,</span> <span class="n">Ico_eq_empty</span> <span class="o">(</span><span class="n">le_trans</span> <span class="n">hcb</span> <span class="n">hba</span><span class="o">),</span>
      <span class="n">empty_union</span><span class="o">,</span> <span class="n">empty_union</span><span class="o">,</span> <span class="n">union_empty</span><span class="o">,</span> <span class="n">union_comm</span><span class="o">,</span> <span class="n">Ico_union_Ico_eq_Ico</span> <span class="n">hcb</span> <span class="n">hba</span><span class="o">]</span> <span class="o">}</span>
<span class="kn">end</span>
</code></pre></div>



<a name="205042419"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/golfing%20%60Ico%60%20union/near/205042419" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/golfing.20.60Ico.60.20union.html#205042419">(Jul 26 2020 at 08:29)</a>:</h4>
<p><span class="user-mention silent" data-user-id="214703">Yury G. Kudryashov</span> <a href="#narrow/stream/116395-maths/topic/golfing.20.60Ico.60.20union/near/204983674">said</a>:</p>
<blockquote>
<p>I know how to prove this using lots of <code>by_cases</code> and <code>Ico_union_Ico</code>. Is there any easier way?</p>
</blockquote>



<a name="205042463"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/golfing%20%60Ico%60%20union/near/205042463" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/golfing.20.60Ico.60.20union.html#205042463">(Jul 26 2020 at 08:30)</a>:</h4>
<p>So what is <code>auto</code>?</p>



<a name="205043409"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/golfing%20%60Ico%60%20union/near/205043409" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastien Gouezel <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/golfing.20.60Ico.60.20union.html#205043409">(Jul 26 2020 at 09:02)</a>:</h4>
<p>From <a href="https://people.mpi-inf.mpg.de/~jblanche/frocos2011-dis-proof.pdf">https://people.mpi-inf.mpg.de/~jblanche/frocos2011-dis-proof.pdf</a>:</p>
<p>On the user level, the simplifier is eclipsed by auto, a proof method that interleaves simplification with a small amount of proof search. It is impossible to describe suc-cinctly what auto does due to its heuristic, ad hoc nature. Its great strength is its ability to discharge the easy parts of a goal and leave the user with the more difficult ones. This helps the user to quickly focus on the core of a problem.Strengthened versions of auto perform more sophisticated proof search, while still interleaving it with simplification. The search is based on tableau methods [39]. These methods are often useful, but since search is involved, not only are they slower than the simplifier and auto, they are endgame provers that do not provide any hints when they fail to prove the goal</p>
<p><span class="user-mention" data-user-id="121058">@Jasmin Blanchette</span> , do you know of a reference describing a little bit more of the internals of <code>auto</code>? I think I miss it in Lean even more than sledgehammer...</p>



<a name="205043624"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/golfing%20%60Ico%60%20union/near/205043624" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/golfing.20.60Ico.60.20union.html#205043624">(Jul 26 2020 at 09:10)</a>:</h4>
<p>I've read descriptions of <code>auto</code> like that several times before and it's indistinguishable from "auto is magic"</p>



<a name="205043635"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/golfing%20%60Ico%60%20union/near/205043635" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/golfing.20.60Ico.60.20union.html#205043635">(Jul 26 2020 at 09:11)</a>:</h4>
<p>and as a user it also is difficult to demystify by watching it work</p>



<a name="205044282"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/golfing%20%60Ico%60%20union/near/205044282" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastien Gouezel <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/golfing.20.60Ico.60.20union.html#205044282">(Jul 26 2020 at 09:32)</a>:</h4>
<p>Apparently (see the code at <a href="http://isabelle.in.tum.de/repos/isabelle/file/f3e1144a1cec/src/Provers/clasimp.ML">http://isabelle.in.tum.de/repos/isabelle/file/f3e1144a1cec/src/Provers/clasimp.ML</a>), it combines blast (<a href="https://www.cl.cam.ac.uk/~lp15/papers/Isabelle/blast.pdf">https://www.cl.cam.ac.uk/~lp15/papers/Isabelle/blast.pdf</a>) with the simplifier.</p>



<a name="205044731"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/golfing%20%60Ico%60%20union/near/205044731" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/golfing.20.60Ico.60.20union.html#205044731">(Jul 26 2020 at 09:46)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110049">Mario Carneiro</span> <a href="#narrow/stream/116395-maths/topic/golfing.20.60Ico.60.20union/near/205043624">said</a>:</p>
<blockquote>
<p>I've read descriptions of <code>auto</code> like that several times before and it's indistinguishable from "auto is magic"</p>
</blockquote>
<p>This sounds like the holy grail of interactive theorem proving: a tactic that proves obvious goals without any need to understand how it works.</p>



<a name="205044791"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/golfing%20%60Ico%60%20union/near/205044791" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/golfing.20.60Ico.60.20union.html#205044791">(Jul 26 2020 at 09:48)</a>:</h4>
<p>I generally have a bad experience with "magic" tactics. If it actually solves all goals I care about, well that's great, but that's also a pipe dream. Unless I understand the failure modes, I won't be able to use it effectively</p>



<a name="205044806"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/golfing%20%60Ico%60%20union/near/205044806" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/golfing.20.60Ico.60.20union.html#205044806">(Jul 26 2020 at 09:49)</a>:</h4>
<p>I remember working in isabelle during a tutorial, this was my number one complaint - everything was "by auto" and I didn't even understand what the syntax of tactic proofs was (and of course I can't ask isabelle to show me the proof either). It was very unsatisfying</p>



<a name="205044848"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/golfing%20%60Ico%60%20union/near/205044848" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jasmin Blanchette <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/golfing.20.60Ico.60.20union.html#205044848">(Jul 26 2020 at 09:50)</a>:</h4>
<p><code>auto</code> isn't that magic. It's really simplifier + some intro and elim rules, some applied aggressively, some not (with backtracking). From its output, which is similar to the simplifier's except that you can get multiple subgols, you can usually tell "oh, I forgot to register commutativity of <code>foo</code> as a <code>simp</code> rule".</p>



<a name="205044850"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/golfing%20%60Ico%60%20union/near/205044850" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastien Gouezel <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/golfing.20.60Ico.60.20union.html#205044850">(Jul 26 2020 at 09:50)</a>:</h4>
<p><code>auto</code> is not a closing tactic: it takes care of what it can, and leaves you with the remaining goals. And you can tweak it like <code>(auto simp: foo bar intro: foo' bar')</code> telling it to add <code>foo</code> and <code>bar</code> to the simpset during this run, and to apply the lemmas <code>foo'</code> and <code>bar'</code> whenever it can. When you are used to it, it is incredibly efficient.</p>



<a name="205044858"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/golfing%20%60Ico%60%20union/near/205044858" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jasmin Blanchette <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/golfing.20.60Ico.60.20union.html#205044858">(Jul 26 2020 at 09:51)</a>:</h4>
<p>But indeed, it would be nice if <code>auto</code> had some detailed output, or at least existed in some <code>squeeze_auto</code> fashion.</p>



<a name="205044866"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/golfing%20%60Ico%60%20union/near/205044866" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jasmin Blanchette <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/golfing.20.60Ico.60.20union.html#205044866">(Jul 26 2020 at 09:51)</a>:</h4>
<p>And if <code>auto</code> were ever reproduced in Lean, it would have to have better output.</p>



<a name="205044869"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/golfing%20%60Ico%60%20union/near/205044869" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jasmin Blanchette <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/golfing.20.60Ico.60.20union.html#205044869">(Jul 26 2020 at 09:52)</a>:</h4>
<p>As for the reference: I'm not aware of any.</p>



<a name="205044932"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/golfing%20%60Ico%60%20union/near/205044932" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/golfing.20.60Ico.60.20union.html#205044932">(Jul 26 2020 at 09:53)</a>:</h4>
<p>how important is heuristic instantiation for <code>auto</code>?</p>



<a name="205044982"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/golfing%20%60Ico%60%20union/near/205044982" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/golfing.20.60Ico.60.20union.html#205044982">(Jul 26 2020 at 09:54)</a>:</h4>
<p>Does it differ in any important way from <code>tidy</code>? If it's just "case on or, split on and, simp" then <code>tidy</code> does that already</p>



<a name="205045011"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/golfing%20%60Ico%60%20union/near/205045011" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastien Gouezel <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/golfing.20.60Ico.60.20union.html#205045011">(Jul 26 2020 at 09:55)</a>:</h4>
<p><code>auto</code> does backtracking.</p>



<a name="205045063"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/golfing%20%60Ico%60%20union/near/205045063" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/golfing.20.60Ico.60.20union.html#205045063">(Jul 26 2020 at 09:57)</a>:</h4>
<p>what do you get in an <code>auto</code> failure if it backtracks?</p>



<a name="205045709"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/golfing%20%60Ico%60%20union/near/205045709" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastien Gouezel <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/golfing.20.60Ico.60.20union.html#205045709">(Jul 26 2020 at 10:15)</a>:</h4>
<p>Auto does several things:</p>
<ul>
<li>it applies the simplifier (always).</li>
<li>there are some lemmas that it will always apply if they make sense. No backtracking involved. Typically you are left with several subgoals afterwards.</li>
<li>there are somme lemmas that it will apply if after applying them it is able to prove the goal (or the part of the goal it is working on). Here backtracking happens.</li>
</ul>
<p>This means that on some subgoals it will try to find a proof and if it doesn't it will just leave you the subgoal untouched. Other subgoals will be solved thanks to backtracking and proof search. Typically, in the end you will just be left with the nontrivial remaining subgoals, a.k.a., the interesting part of the proof.</p>



<a name="205045765"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/golfing%20%60Ico%60%20union/near/205045765" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastien Gouezel <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/golfing.20.60Ico.60.20union.html#205045765">(Jul 26 2020 at 10:17)</a>:</h4>
<p>(NB: this is what I understood from playing quite some time with Isabelle, I have never looked at auto's inner workings)</p>



<a name="205045833"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/golfing%20%60Ico%60%20union/near/205045833" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/golfing.20.60Ico.60.20union.html#205045833">(Jul 26 2020 at 10:19)</a>:</h4>
<p>then how do you do all that in 1/10 s?</p>



<a name="205045884"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/golfing%20%60Ico%60%20union/near/205045884" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastien Gouezel <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/golfing.20.60Ico.60.20union.html#205045884">(Jul 26 2020 at 10:20)</a>:</h4>
<p>That's Isabelle and simple type theory (no unification, no implicit parameters, and so on).</p>



<a name="205046112"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/golfing%20%60Ico%60%20union/near/205046112" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/golfing.20.60Ico.60.20union.html#205046112">(Jul 26 2020 at 10:26)</a>:</h4>
<p>so what are intro and elim rules and how do they contribute to that overall structure?</p>



<a name="205046123"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/golfing%20%60Ico%60%20union/near/205046123" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/golfing.20.60Ico.60.20union.html#205046123">(Jul 26 2020 at 10:27)</a>:</h4>
<p>I understand that these have to be annotated in the library, yes?</p>



<a name="205046204"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/golfing%20%60Ico%60%20union/near/205046204" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastien Gouezel <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/golfing.20.60Ico.60.20union.html#205046204">(Jul 26 2020 at 10:29)</a>:</h4>
<p>Yes. You have <code>intro!</code> lemmas (i.e., lemmas tagged with this attribute in the library), which are lemmas that auto should always apply when they make sense, and <code>intro</code> (or <code>intro?</code>) lemmas that will only be applied in the middle of a proof search process with backtracking. And elim I never really understood :-)</p>



<a name="205046313"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/golfing%20%60Ico%60%20union/near/205046313" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastien Gouezel <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/golfing.20.60Ico.60.20union.html#205046313">(Jul 26 2020 at 10:32)</a>:</h4>
<p>Note that the <code>intro!</code> lemmas are not equivalences in general, so maybe a statement that was provable is not provable any more after applying <code>auto</code>. But when a lemma is the right thing to do like 95% of the time, it is a good idea to mark it at <code>intro!</code> (and of course the intro set can be tweaked in an invocation of auto).</p>



<a name="205046351"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/golfing%20%60Ico%60%20union/near/205046351" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/golfing.20.60Ico.60.20union.html#205046351">(Jul 26 2020 at 10:33)</a>:</h4>
<p>Does <code>simplify</code> have its own annotation e.g. <code>simp</code>? Or does it reuse <code>intro</code> and <code>elim</code> in some way</p>



<a name="205046421"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/golfing%20%60Ico%60%20union/near/205046421" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastien Gouezel <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/golfing.20.60Ico.60.20union.html#205046421">(Jul 26 2020 at 10:35)</a>:</h4>
<p>You also have <code>simp</code> tags, yes. You have 3 different kinds of lemmas, the simp ones, the intro ones, and the elim ones.</p>



<a name="205046461"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/golfing%20%60Ico%60%20union/near/205046461" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/golfing.20.60Ico.60.20union.html#205046461">(Jul 26 2020 at 10:36)</a>:</h4>
<p>Lean also has <code>intro</code> and <code>intro!</code> attributes, but no one knows what they do :)</p>



<a name="205046662"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/golfing%20%60Ico%60%20union/near/205046662" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastien Gouezel <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/golfing.20.60Ico.60.20union.html#205046662">(Jul 26 2020 at 10:43)</a>:</h4>
<p>Probably they don't do anything for now because we don't have auto, but they have been planned a long way ahead!</p>



<a name="205046700"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/golfing%20%60Ico%60%20union/near/205046700" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/golfing.20.60Ico.60.20union.html#205046700">(Jul 26 2020 at 10:44)</a>:</h4>
<p>That's not true.</p>



<a name="205046705"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/golfing%20%60Ico%60%20union/near/205046705" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/golfing.20.60Ico.60.20union.html#205046705">(Jul 26 2020 at 10:44)</a>:</h4>
<p>I know what they do.</p>



<a name="205046725"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/golfing%20%60Ico%60%20union/near/205046725" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/golfing.20.60Ico.60.20union.html#205046725">(Jul 26 2020 at 10:45)</a>:</h4>
<p><a href="https://github.com/leanprover-community/lean/blob/master/library/init/meta/backward.lean">https://github.com/leanprover-community/lean/blob/master/library/init/meta/backward.lean</a></p>



<a name="205046776"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/golfing%20%60Ico%60%20union/near/205046776" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/golfing.20.60Ico.60.20union.html#205046776">(Jul 26 2020 at 10:46)</a>:</h4>
<p>we should give <code>back_chaining</code> an interactive front end and try using it</p>



<a name="205046791"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/golfing%20%60Ico%60%20union/near/205046791" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastien Gouezel <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/golfing.20.60Ico.60.20union.html#205046791">(Jul 26 2020 at 10:47)</a>:</h4>
<p>Is it like <code>apply_rules</code>?</p>



<a name="205046794"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/golfing%20%60Ico%60%20union/near/205046794" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/golfing.20.60Ico.60.20union.html#205046794">(Jul 26 2020 at 10:47)</a>:</h4>
<p>pretty sure</p>



<a name="205046798"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/golfing%20%60Ico%60%20union/near/205046798" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/golfing.20.60Ico.60.20union.html#205046798">(Jul 26 2020 at 10:47)</a>:</h4>
<p>Yes, it's Leo's version of apply_rules.</p>



<a name="205046838"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/golfing%20%60Ico%60%20union/near/205046838" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/golfing.20.60Ico.60.20union.html#205046838">(Jul 26 2020 at 10:48)</a>:</h4>
<p>But it's clearly an experiment that was mostly abandonned.</p>



<a name="205046841"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/golfing%20%60Ico%60%20union/near/205046841" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/golfing.20.60Ico.60.20union.html#205046841">(Jul 26 2020 at 10:48)</a>:</h4>
<p>does it do things?</p>



<a name="205046848"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/golfing%20%60Ico%60%20union/near/205046848" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastien Gouezel <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/golfing.20.60Ico.60.20union.html#205046848">(Jul 26 2020 at 10:48)</a>:</h4>
<p>I've done <code>apply_rules</code> because I was longing for auto and I couldn't do anything smarter, but I'm pretty sure Leo's version is much better!</p>



<a name="205046859"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/golfing%20%60Ico%60%20union/near/205046859" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/golfing.20.60Ico.60.20union.html#205046859">(Jul 26 2020 at 10:49)</a>:</h4>
<p>the problem with relying on leo's tactics is that they don't get maintenance because no one knows the code</p>



<a name="205046862"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/golfing%20%60Ico%60%20union/near/205046862" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/golfing.20.60Ico.60.20union.html#205046862">(Jul 26 2020 at 10:49)</a>:</h4>
<p>the smt/eblast stuff died for basically that reason</p>



<a name="205046913"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/golfing%20%60Ico%60%20union/near/205046913" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/golfing.20.60Ico.60.20union.html#205046913">(Jul 26 2020 at 10:50)</a>:</h4>
<p>honestly <code>simp</code> has held up pretty well all things considered</p>



<a name="205046964"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/golfing%20%60Ico%60%20union/near/205046964" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/golfing.20.60Ico.60.20union.html#205046964">(Jul 26 2020 at 10:52)</a>:</h4>
<p>but if you are okay with using them as is then I don't see why we can't give a nice front end to the tactic and see if it's any good</p>



<a name="205047082"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/golfing%20%60Ico%60%20union/near/205047082" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/golfing.20.60Ico.60.20union.html#205047082">(Jul 26 2020 at 10:56)</a>:</h4>
<p>It passes the basic test:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">example</span> <span class="o">{</span><span class="n">n</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">}</span> <span class="o">:</span> <span class="n">n</span> <span class="bp">≤</span> <span class="n">n</span> <span class="err">⊔</span> <span class="n">n</span> <span class="err">⊔</span> <span class="n">n</span> <span class="o">:=</span>
<span class="k">by</span> <span class="n">apply_rules</span> <span class="o">[</span><span class="n">le_sup_left_of_le</span><span class="o">,</span> <span class="n">le_refl</span><span class="o">]</span>

<span class="kn">example</span> <span class="o">{</span><span class="n">n</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">}</span> <span class="o">:</span> <span class="n">n</span> <span class="bp">≤</span> <span class="n">n</span> <span class="err">⊔</span> <span class="n">n</span> <span class="err">⊔</span> <span class="n">n</span> <span class="o">:=</span>
<span class="k">by</span> <span class="n">do</span>
  <span class="o">[</span><span class="bp">`</span><span class="n">le_sup_left_of_le</span><span class="o">,</span> <span class="bp">`</span><span class="n">le_refl</span><span class="o">]</span><span class="bp">.</span><span class="n">mmap</span> <span class="n">tactic</span><span class="bp">.</span><span class="n">mk_const</span> <span class="bp">&gt;&gt;=</span>
  <span class="n">tactic</span><span class="bp">.</span><span class="n">back_chaining_using</span>
</code></pre></div>



<a name="205047162"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/golfing%20%60Ico%60%20union/near/205047162" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/golfing.20.60Ico.60.20union.html#205047162">(Jul 26 2020 at 10:59)</a>:</h4>
<p>we don't need more powerful tactics; we need more basic tactics and more creative proofs:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="n">data</span><span class="bp">.</span><span class="n">set</span><span class="bp">.</span><span class="n">intervals</span><span class="bp">.</span><span class="n">basic</span> <span class="n">tactic</span>

<span class="kn">open</span> <span class="n">set</span>

<span class="n">meta</span> <span class="n">def</span> <span class="n">unions&#39;</span> <span class="o">:</span> <span class="n">tactic</span> <span class="n">unit</span> <span class="o">:=</span>
<span class="bp">`</span><span class="o">[</span><span class="n">try</span> <span class="o">{</span> <span class="n">refl&#39;</span> <span class="bp">&lt;|&gt;</span> <span class="o">{</span> <span class="n">apply</span> <span class="n">subset_union_of_subset_left</span><span class="o">,</span> <span class="n">unions&#39;</span> <span class="o">}</span> <span class="bp">&lt;|&gt;</span> <span class="o">{</span> <span class="n">apply</span> <span class="n">subset_union_of_subset_right</span><span class="o">,</span> <span class="n">unions&#39;</span> <span class="o">}}]</span>

<span class="n">meta</span> <span class="n">def</span> <span class="n">unions</span> <span class="o">:</span> <span class="n">tactic</span> <span class="n">unit</span> <span class="o">:=</span>
<span class="bp">`</span><span class="o">[{</span> <span class="n">apply</span> <span class="n">union_subset</span><span class="bp">;</span> <span class="n">unions</span> <span class="o">}</span> <span class="bp">&lt;|&gt;</span> <span class="n">unions&#39;</span><span class="o">]</span>

<span class="kn">example</span> <span class="o">{</span><span class="n">α</span><span class="o">}</span> <span class="o">[</span><span class="n">linear_order</span> <span class="n">α</span><span class="o">]</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="o">:</span> <span class="n">α</span><span class="o">)</span> <span class="o">:</span> <span class="n">Ico</span> <span class="n">a</span> <span class="n">b</span> <span class="err">∪</span> <span class="n">Ico</span> <span class="n">b</span> <span class="n">c</span> <span class="err">∪</span> <span class="n">Ico</span> <span class="n">c</span> <span class="n">a</span> <span class="bp">=</span> <span class="n">Ico</span> <span class="n">b</span> <span class="n">a</span> <span class="err">∪</span> <span class="n">Ico</span> <span class="n">c</span> <span class="n">b</span> <span class="err">∪</span> <span class="n">Ico</span> <span class="n">a</span> <span class="n">c</span> <span class="o">:=</span>
<span class="n">subset</span><span class="bp">.</span><span class="n">antisymm</span> <span class="o">(</span><span class="n">subset</span><span class="bp">.</span><span class="n">trans</span> <span class="o">(</span><span class="n">union_subset_union</span> <span class="o">(</span><span class="n">union_subset_union</span>
    <span class="o">(</span><span class="bp">@</span><span class="n">Ico_subset_Ico_union_Ico</span> <span class="bp">_</span> <span class="bp">_</span> <span class="n">a</span> <span class="n">c</span> <span class="n">b</span><span class="o">)</span> <span class="o">(</span><span class="bp">@</span><span class="n">Ico_subset_Ico_union_Ico</span> <span class="bp">_</span> <span class="bp">_</span> <span class="n">b</span> <span class="n">a</span> <span class="n">c</span><span class="o">))</span> <span class="o">(</span><span class="bp">@</span><span class="n">Ico_subset_Ico_union_Ico</span> <span class="bp">_</span> <span class="bp">_</span> <span class="n">c</span> <span class="n">b</span> <span class="n">a</span><span class="o">))</span> <span class="o">(</span><span class="k">by</span> <span class="n">unions</span><span class="o">))</span>
  <span class="o">(</span><span class="n">subset</span><span class="bp">.</span><span class="n">trans</span> <span class="o">(</span><span class="n">union_subset_union</span> <span class="o">(</span><span class="n">union_subset_union</span>
    <span class="o">(</span><span class="bp">@</span><span class="n">Ico_subset_Ico_union_Ico</span> <span class="bp">_</span> <span class="bp">_</span> <span class="n">b</span> <span class="n">c</span> <span class="n">a</span><span class="o">)</span> <span class="o">(</span><span class="bp">@</span><span class="n">Ico_subset_Ico_union_Ico</span> <span class="bp">_</span> <span class="bp">_</span> <span class="n">c</span> <span class="n">a</span> <span class="n">b</span><span class="o">))</span> <span class="o">(</span><span class="bp">@</span><span class="n">Ico_subset_Ico_union_Ico</span> <span class="bp">_</span> <span class="bp">_</span> <span class="n">a</span> <span class="n">b</span> <span class="n">c</span><span class="o">))</span> <span class="o">(</span><span class="k">by</span> <span class="n">unions</span><span class="o">))</span>
</code></pre></div>



<a name="205047484"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/golfing%20%60Ico%60%20union/near/205047484" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/golfing.20.60Ico.60.20union.html#205047484">(Jul 26 2020 at 11:09)</a>:</h4>
<p>turns out Lean is pretty smart:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="n">data</span><span class="bp">.</span><span class="n">set</span><span class="bp">.</span><span class="n">intervals</span><span class="bp">.</span><span class="n">basic</span> <span class="n">tactic</span>

<span class="kn">open</span> <span class="n">set</span>

<span class="n">meta</span> <span class="n">def</span> <span class="n">unions&#39;</span> <span class="o">:</span> <span class="n">tactic</span> <span class="n">unit</span> <span class="o">:=</span>
<span class="bp">`</span><span class="o">[</span><span class="n">try</span> <span class="o">{</span> <span class="n">refl&#39;</span> <span class="bp">&lt;|&gt;</span> <span class="o">{</span> <span class="n">apply</span> <span class="n">subset_union_of_subset_left</span><span class="o">,</span> <span class="n">unions&#39;</span> <span class="o">}</span> <span class="bp">&lt;|&gt;</span> <span class="o">{</span> <span class="n">apply</span> <span class="n">subset_union_of_subset_right</span><span class="o">,</span> <span class="n">unions&#39;</span> <span class="o">}}]</span>

<span class="n">meta</span> <span class="n">def</span> <span class="n">unions</span> <span class="o">:</span> <span class="n">tactic</span> <span class="n">unit</span> <span class="o">:=</span>
<span class="bp">`</span><span class="o">[{</span> <span class="n">apply</span> <span class="n">union_subset</span><span class="bp">;</span> <span class="n">unions</span> <span class="o">}</span> <span class="bp">&lt;|&gt;</span> <span class="n">unions&#39;</span><span class="o">]</span>

<span class="kn">example</span> <span class="o">{</span><span class="n">α</span><span class="o">}</span> <span class="o">[</span><span class="n">linear_order</span> <span class="n">α</span><span class="o">]</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="o">:</span> <span class="n">α</span><span class="o">)</span> <span class="o">:</span> <span class="n">Ico</span> <span class="n">a</span> <span class="n">b</span> <span class="err">∪</span> <span class="n">Ico</span> <span class="n">b</span> <span class="n">c</span> <span class="err">∪</span> <span class="n">Ico</span> <span class="n">c</span> <span class="n">a</span> <span class="bp">=</span> <span class="n">Ico</span> <span class="n">b</span> <span class="n">a</span> <span class="err">∪</span> <span class="n">Ico</span> <span class="n">c</span> <span class="n">b</span> <span class="err">∪</span> <span class="n">Ico</span> <span class="n">a</span> <span class="n">c</span> <span class="o">:=</span>
<span class="n">subset</span><span class="bp">.</span><span class="n">antisymm</span> <span class="o">(</span><span class="n">subset</span><span class="bp">.</span><span class="n">trans</span> <span class="o">(</span><span class="n">union_subset_union</span> <span class="o">(</span><span class="n">union_subset_union</span>
    <span class="n">Ico_subset_Ico_union_Ico</span> <span class="n">Ico_subset_Ico_union_Ico</span><span class="o">)</span> <span class="n">Ico_subset_Ico_union_Ico</span><span class="o">)</span> <span class="o">(</span><span class="k">by</span> <span class="n">unions</span><span class="o">))</span>
  <span class="o">(</span><span class="n">subset</span><span class="bp">.</span><span class="n">trans</span> <span class="o">(</span><span class="n">union_subset_union</span> <span class="o">(</span><span class="n">union_subset_union</span>
    <span class="n">Ico_subset_Ico_union_Ico</span> <span class="n">Ico_subset_Ico_union_Ico</span><span class="o">)</span> <span class="n">Ico_subset_Ico_union_Ico</span><span class="o">)</span> <span class="o">(</span><span class="k">by</span> <span class="n">unions</span><span class="o">))</span>
</code></pre></div>



<a name="205048055"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/golfing%20%60Ico%60%20union/near/205048055" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastien Gouezel <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/golfing.20.60Ico.60.20union.html#205048055">(Jul 26 2020 at 11:24)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110064">Kenny Lau</span> <a href="#narrow/stream/116395-maths/topic/golfing.20.60Ico.60.20union/near/205047162">said</a>:</p>
<blockquote>
<p>we don't need more powerful tactics</p>
</blockquote>
<p>Come on Kenny! Would you complain if you had a tactic <code>auto</code> which could close this lemma with <code>by auto</code> in 1/10s?</p>



<a name="205048414"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/golfing%20%60Ico%60%20union/near/205048414" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/golfing.20.60Ico.60.20union.html#205048414">(Jul 26 2020 at 11:35)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110049">Mario Carneiro</span> <a href="#narrow/stream/116395-maths/topic/golfing.20.60Ico.60.20union/near/205046776">said</a>:</p>
<blockquote>
<p>we should give <code>back_chaining</code> an interactive front end and try using it</p>
</blockquote>
<p>I think <code>auto</code> would be great to have.  Note that <code>back_chaining</code> only does a third of auto: namely applying the "intro" rules.  My gut feeling is that most of the work of creating a Lean version of <code>auto</code> would consist of judiciously adding <code>intro</code> and <code>elim</code> attributes.  These sets require just as much care, effort, and curation as the simp set.</p>



<a name="205048519"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/golfing%20%60Ico%60%20union/near/205048519" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/golfing.20.60Ico.60.20union.html#205048519">(Jul 26 2020 at 11:38)</a>:</h4>
<p>It actually has a bit of the other parts of <code>auto</code> as well, because the core tactic also includes a <code>pre_tactic</code> and <code>leaf_tactic</code> for interoperating with the backtracking search. If you put in <code>simp</code> as the <code>pre_tactic</code> it seems like you've got 2/3 of <code>auto</code></p>



<a name="205048535"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/golfing%20%60Ico%60%20union/near/205048535" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/golfing.20.60Ico.60.20union.html#205048535">(Jul 26 2020 at 11:38)</a>:</h4>
<p>I definitely agree that it is important for us to start curating the <code>intro</code> set</p>



<a name="205048549"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/golfing%20%60Ico%60%20union/near/205048549" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/golfing.20.60Ico.60.20union.html#205048549">(Jul 26 2020 at 11:39)</a>:</h4>
<p>I suspect that there is a chicken and egg problem with getting a good <code>intro</code> set vs getting the <code>auto</code> tactic working</p>



<a name="205048594"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/golfing%20%60Ico%60%20union/near/205048594" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/golfing.20.60Ico.60.20union.html#205048594">(Jul 26 2020 at 11:40)</a>:</h4>
<p>Don't forget the <code>elim</code> set.</p>



<a name="205048599"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/golfing%20%60Ico%60%20union/near/205048599" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/golfing.20.60Ico.60.20union.html#205048599">(Jul 26 2020 at 11:40)</a>:</h4>
<p>Do you know what that is? Sebastien didn't above</p>



<a name="205048614"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/golfing%20%60Ico%60%20union/near/205048614" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/golfing.20.60Ico.60.20union.html#205048614">(Jul 26 2020 at 11:42)</a>:</h4>
<p><code>intro</code> lemmas are used with <code>apply</code>, i.e. they only apply to the target of the goal.  <code>elim</code> lemmas are similar to <code>cases</code>, they apply to the hypotheses.</p>



<a name="205048658"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/golfing%20%60Ico%60%20union/near/205048658" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/golfing.20.60Ico.60.20union.html#205048658">(Jul 26 2020 at 11:42)</a>:</h4>
<p>E.g., if you have an assumption <code>∃ x, p x</code> then you want to apply <a href="https://leanprover-community.github.io/mathlib_docs/find/exists.elim">docs#exists.elim</a></p>



<a name="205048664"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/golfing%20%60Ico%60%20union/near/205048664" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/golfing.20.60Ico.60.20union.html#205048664">(Jul 26 2020 at 11:43)</a>:</h4>
<p>do you think we should use curated lemmas for that? Unlike isabelle we get most of that for free by using <code>cases</code></p>



<a name="205048669"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/golfing%20%60Ico%60%20union/near/205048669" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/golfing.20.60Ico.60.20union.html#205048669">(Jul 26 2020 at 11:43)</a>:</h4>
<p>but maybe there are things like custom recursors we should be applying instead</p>



<a name="205048681"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/golfing%20%60Ico%60%20union/near/205048681" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/golfing.20.60Ico.60.20union.html#205048681">(Jul 26 2020 at 11:43)</a>:</h4>
<p>do you know examples of elim rules that are not just subsets of <code>cases</code> behavior?</p>



<a name="205055932"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/golfing%20%60Ico%60%20union/near/205055932" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jasmin Blanchette <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/golfing.20.60Ico.60.20union.html#205055932">(Jul 26 2020 at 15:20)</a>:</h4>
<p>I'd consider using the <code>intro!</code> attribute globally for a unidirectional rule (i.e., one that doesn't preserve provability) a bug. The whole point is that these "safe" rules should be applied exhaustively, like <code>simp</code>s, without loss of generality.</p>



<a name="205056126"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/golfing%20%60Ico%60%20union/near/205056126" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/golfing.20.60Ico.60.20union.html#205056126">(Jul 26 2020 at 15:26)</a>:</h4>
<p>An example of a unidirectional <code>intro!</code> rule would be something like closure for division like <code>x \in real /\ y \in real /\ y != 0 -&gt; x / y \in real</code> for a hypothetical typing predicate for real division (maybe these are ZFC reals or something so that typing is a theorem)</p>



<a name="205056160"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/golfing%20%60Ico%60%20union/near/205056160" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/golfing.20.60Ico.60.20union.html#205056160">(Jul 26 2020 at 15:27)</a>:</h4>
<p>in fact even setting aside partial functions, something like <code>x \in real /\ y \in real -&gt; x + y \in real</code> might very well not be bidirectional</p>



<a name="205056499"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/golfing%20%60Ico%60%20union/near/205056499" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastien Gouezel <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/golfing.20.60Ico.60.20union.html#205056499">(Jul 26 2020 at 15:36)</a>:</h4>
<p>For another example, if you want to prove <code>continuous (f + g)</code>, it seems to me completely reasonable to apply <code>continuous.add</code> and reduce it to the continuity of <code>f</code> and <code>g</code>, although of course you can have discontinuous functions whose sum is continuous, but this should never show up in real proofs.</p>



<a name="205056511"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/golfing%20%60Ico%60%20union/near/205056511" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastien Gouezel <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/golfing.20.60Ico.60.20union.html#205056511">(Jul 26 2020 at 15:37)</a>:</h4>
<p>A rule that does preserve provability could instead be written as an iff and registered as a simp lemma, so to me the whole point of <code>intro!</code> is for rules that don't preserve provability but are completely reasonable like the continuity example.</p>



<a name="205056921"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/golfing%20%60Ico%60%20union/near/205056921" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jasmin Blanchette <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/golfing.20.60Ico.60.20union.html#205056921">(Jul 26 2020 at 15:51)</a>:</h4>
<p>I'd say that's the point of <code>intro</code>.</p>



<a name="205056983"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/golfing%20%60Ico%60%20union/near/205056983" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jasmin Blanchette <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/golfing.20.60Ico.60.20union.html#205056983">(Jul 26 2020 at 15:53)</a>:</h4>
<p>See e.g. <a href="http://www21.in.tum.de/~ballarin/fomus/part1/part1.pdf">http://www21.in.tum.de/~ballarin/fomus/part1/part1.pdf</a></p>



<a name="205056986"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/golfing%20%60Ico%60%20union/near/205056986" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jasmin Blanchette <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/golfing.20.60Ico.60.20union.html#205056986">(Jul 26 2020 at 15:53)</a>:</h4>
<p>Search for "safe" and "unsafe" throughout.</p>



<a name="205745659"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/golfing%20%60Ico%60%20union/near/205745659" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jannis Limperg <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/golfing.20.60Ico.60.20union.html#205745659">(Aug 02 2020 at 21:52)</a>:</h4>
<p><span class="user-mention silent" data-user-id="121058">Jasmin Blanchette</span> <a href="#narrow/stream/116395-maths/topic/golfing.20.60Ico.60.20union/near/205042340">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="256311">Jannis Limperg</span> I hope you are paying attention. ;)</p>
</blockquote>
<p>I wasn't because I'm not subscribed to this stream, in which case I apparently don't even get notified if I'm @-mentioned. -.- Am now though.</p>



<a name="205749815"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/golfing%20%60Ico%60%20union/near/205749815" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jalex Stark <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/golfing.20.60Ico.60.20union.html#205749815">(Aug 03 2020 at 00:08)</a>:</h4>
<p>When you @ someone who is not subscribed to the stream you're posting in, there should be a prompt to invite them to the stream</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>