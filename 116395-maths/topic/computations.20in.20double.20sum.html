---
layout: archive
title: Zulip Chat Archive
permalink: /stream/116395-maths/topic/computations.20in.20double.20sum.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/116395-maths/index.html">maths</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/computations.20in.20double.20sum.html">computations in double sum</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="219807482"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/computations%20in%20double%20sum/near/219807482" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ashvni Narayanan <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/computations.20in.20double.20sum.html#219807482">(Dec 14 2020 at 07:28)</a>:</h4>
<p>I am working on defining basic properties of Bernoulli polynomials, and am currently trying to prove that  <code>  ∑ k in finset.range (n + 1), ((n + 1).choose k : ℚ) * bernoulli_poly k X = (n + 1) * X^n </code> . I am at this stage of the proof :</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">X</span><span class="o">:</span> <span class="n">ℚ</span>
<span class="n">n</span><span class="o">:</span> <span class="n">ℕ</span>
<span class="n">f</span><span class="o">:</span> <span class="bp">∑</span> <span class="o">(</span><span class="n">s</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="k">in</span> <span class="n">finset.Ico</span> <span class="mi">0</span> <span class="o">(</span><span class="n">n.succ</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">),</span> <span class="bp">↑</span><span class="o">((</span><span class="n">n.succ</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)</span><span class="bp">.</span><span class="n">choose</span> <span class="n">s</span><span class="o">)</span> <span class="bp">*</span> <span class="n">X</span> <span class="bp">^</span> <span class="n">s</span> <span class="bp">*</span> <span class="bp">∑</span> <span class="o">(</span><span class="n">y</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="k">in</span> <span class="n">finset.Ico</span> <span class="mi">0</span> <span class="o">(</span><span class="n">n.succ</span> <span class="bp">+</span> <span class="mi">1</span> <span class="bp">-</span> <span class="n">s</span><span class="o">),</span> <span class="bp">↑</span><span class="o">((</span><span class="n">n.succ</span> <span class="bp">+</span> <span class="mi">1</span> <span class="bp">-</span> <span class="n">s</span><span class="o">)</span><span class="bp">.</span><span class="n">choose</span> <span class="n">y</span><span class="o">)</span> <span class="bp">*</span> <span class="n">bernoulli_neg</span> <span class="n">y</span> <span class="bp">=</span> <span class="o">(</span><span class="bp">↑</span><span class="o">(</span><span class="n">n.succ</span><span class="o">)</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)</span> <span class="bp">*</span> <span class="n">X</span> <span class="bp">^</span> <span class="n">n.succ</span>
<span class="bp">⊢</span> <span class="bp">∑</span> <span class="o">(</span><span class="n">i</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="k">in</span> <span class="n">finset.Ico</span> <span class="mi">0</span> <span class="o">(</span><span class="n">n.succ</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">),</span> <span class="bp">∑</span> <span class="o">(</span><span class="n">j</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="k">in</span> <span class="n">finset.Ico</span> <span class="n">i</span> <span class="o">(</span><span class="n">n.succ</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">),</span> <span class="bp">↑</span><span class="o">((</span><span class="n">n.succ</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)</span><span class="bp">.</span><span class="n">choose</span> <span class="n">j</span><span class="o">)</span> <span class="bp">*</span> <span class="o">(</span><span class="n">bernoulli_neg</span> <span class="o">(</span><span class="n">j</span> <span class="bp">-</span> <span class="n">i</span><span class="o">)</span> <span class="bp">*</span> <span class="bp">↑</span><span class="o">(</span><span class="n">j.choose</span> <span class="n">i</span><span class="o">)</span> <span class="bp">*</span> <span class="n">X</span> <span class="bp">^</span> <span class="n">i</span><span class="o">)</span> <span class="bp">=</span> <span class="o">(</span><span class="bp">↑</span><span class="o">(</span><span class="n">n.succ</span><span class="o">)</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)</span> <span class="bp">*</span> <span class="n">X</span> <span class="bp">^</span> <span class="n">n.succ</span>
</code></pre></div>
<p>I want to use the lemma <code>finset.sum_Ico_add</code> in order to change the bounds of the inner sum from <code>i</code> to <code>n.succ + 1</code>,to <code>0</code> to <code>n.succ + 1 - i</code>. In general, I am having issues dealing with computations within double sums. I tried to use <code>conv_lhs</code>, however, I am losing the data that <code>i in finset.Ico 0 (n.succ + 1)</code> (This information is needed so I can use <code>nat.sub_add_cancel</code>).</p>
<p>Any help is appreciated, thank you!</p>



<a name="219807667"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/computations%20in%20double%20sum/near/219807667" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ashvni Narayanan <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/computations.20in.20double.20sum.html#219807667">(Dec 14 2020 at 07:32)</a>:</h4>
<p><a href="https://github.com/leanprover-community/mathlib/blob/d47e1b70d9e9407b1ac7f0785958ed0bbe071523/src/number_theory/bernoulli%20polynomials.lean#L135">https://github.com/leanprover-community/mathlib/blob/d47e1b70d9e9407b1ac7f0785958ed0bbe071523/src/number_theory/bernoulli%20polynomials.lean#L135</a></p>
<p>Here is my code.</p>



<a name="219807986"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/computations%20in%20double%20sum/near/219807986" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/computations.20in.20double.20sum.html#219807986">(Dec 14 2020 at 07:38)</a>:</h4>
<p>Inside conv mode you can use <code>funext</code> I think, to retain some of the data. But I agree that this is not as smooth as we would like</p>



<a name="219808009"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/computations%20in%20double%20sum/near/219808009" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/computations.20in.20double.20sum.html#219808009">(Dec 14 2020 at 07:39)</a>:</h4>
<p>Does it make sense to take smaller steps? Write a helper lemma that manipulates the inner sum for you.</p>



<a name="219808365"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/computations%20in%20double%20sum/near/219808365" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ashvni Narayanan <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/computations.20in.20double.20sum.html#219808365">(Dec 14 2020 at 07:44)</a>:</h4>
<p><span class="user-mention silent" data-user-id="112680">Johan Commelin</span> <a href="#narrow/stream/116395-maths/topic/computations.20in.20double.20sum/near/219807986">said</a>:</p>
<blockquote>
<p>Inside conv mode you can use <code>funext</code> I think, to retain some of the data. But I agree that this is not as smooth as we would like</p>
</blockquote>
<p>I tried that, but I lost the info that <code>i ≤ (n.succ + 1)</code>(which I do need). Would it be wise to use <code>convert_to</code>?</p>



<a name="219808380"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/computations%20in%20double%20sum/near/219808380" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ashvni Narayanan <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/computations.20in.20double.20sum.html#219808380">(Dec 14 2020 at 07:44)</a>:</h4>
<p><span class="user-mention silent" data-user-id="112680">Johan Commelin</span> <a href="#narrow/stream/116395-maths/topic/computations.20in.20double.20sum/near/219808009">said</a>:</p>
<blockquote>
<p>Does it make sense to take smaller steps? Write a helper lemma that manipulates the inner sum for you.</p>
</blockquote>
<p>I will try this.</p>



<a name="219810454"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/computations%20in%20double%20sum/near/219810454" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/computations.20in.20double.20sum.html#219810454">(Dec 14 2020 at 08:16)</a>:</h4>
<p><span class="user-mention" data-user-id="250372">@Ashvni Narayanan</span> What if you start your <code>conv</code> block with <code>apply_congr, skip,</code>?</p>



<a name="219810793"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/computations%20in%20double%20sum/near/219810793" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ashvni Narayanan <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/computations.20in.20double.20sum.html#219810793">(Dec 14 2020 at 08:20)</a>:</h4>
<p>Yes, that works! Thank you! </p>
<p>I also found a lemma <code>finset.sum_Ico_eq_sum_range</code> which directly gives me the required result.</p>



<a name="219810966"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/computations%20in%20double%20sum/near/219810966" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/computations.20in.20double.20sum.html#219810966">(Dec 14 2020 at 08:23)</a>:</h4>
<p>ooh, sorry, I said <code>funext</code> but I actually meant <code>apply_congr</code>.</p>



<a name="219811573"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/computations%20in%20double%20sum/near/219811573" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/computations.20in.20double.20sum.html#219811573">(Dec 14 2020 at 08:31)</a>:</h4>
<p>That <code>apply_congr</code> tactic (which is a <code>conv</code> mode tactic) was written exactly for this purpose of rewriting under big ops.</p>



<a name="219817874"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/computations%20in%20double%20sum/near/219817874" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ashvni Narayanan <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/computations.20in.20double.20sum.html#219817874">(Dec 14 2020 at 09:39)</a>:</h4>
<p>I see, thank you!</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>