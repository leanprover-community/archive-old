---
layout: archive
title: Zulip Chat Archive
permalink: /stream/116395-maths/topic/division_monoid.20and.20is_unit.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/116395-maths/index.html">maths</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/division_monoid.20and.20is_unit.html">division_monoid and is_unit</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="293917391"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/division_monoid%20and%20is_unit/near/293917391" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alexander Bentkamp <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/division_monoid.20and.20is_unit.html#293917391">(Aug 17 2022 at 15:15)</a>:</h4>
<p>There are a couple of lemmas about <code>is_unit</code> that depend on <code>division_monoid</code> such as <a href="https://leanprover-community.github.io/mathlib_docs/find/is_unit.inv_mul_eq_iff_eq_mul">docs#is_unit.inv_mul_eq_iff_eq_mul</a>. Unfortunately, I can't use these lemmas when working with square matrices because a <code>division_monoid</code> requires <code>x⁻¹⁻¹ = x</code>, even for non-invertible <code>x</code>. Would removing that requirement from <code>division_monoid</code> be an option? Or should I reprove these lemmas specifically for matrices? Or do we need two finer-grained type-classes here?</p>



<a name="293923507"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/division_monoid%20and%20is_unit/near/293923507" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jireh Loreaux <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/division_monoid.20and.20is_unit.html#293923507">(Aug 17 2022 at 15:48)</a>:</h4>
<p>(deleted)</p>



<a name="293923681"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/division_monoid%20and%20is_unit/near/293923681" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jireh Loreaux <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/division_monoid.20and.20is_unit.html#293923681">(Aug 17 2022 at 15:48)</a>:</h4>
<p>(deleted)</p>



<a name="293923798"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/division_monoid%20and%20is_unit/near/293923798" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jireh Loreaux <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/division_monoid.20and.20is_unit.html#293923798">(Aug 17 2022 at 15:49)</a>:</h4>
<p>Nevermind, I misread your question.</p>



<a name="293925842"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/division_monoid%20and%20is_unit/near/293925842" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Moritz Doll <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/division_monoid.20and.20is_unit.html#293925842">(Aug 17 2022 at 15:59)</a>:</h4>
<p>Isn't the problem that the matrix multiplication is only a <code>has_mul.mul</code> if the matrices are square? and similarly the inverse of <code>a : A</code> has to have type <code>A</code>. I have the same problem with defining the resolvent and I was about to define my own version of <code>inverse</code> and <code>unit</code>, but if that problem occurs several times, then we might want to find a better solution.</p>



<a name="293930092"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/division_monoid%20and%20is_unit/near/293930092" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Junyan Xu <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/division_monoid.20and.20is_unit.html#293930092">(Aug 17 2022 at 16:20)</a>:</h4>
<p>It seems we lack a lemma saying if <code>h : is_unit x</code> then <code>x⁻¹ = ↑(h.unit⁻¹)</code> for a matrix <code>x</code>. After rewriting by that, what you want is defeq to <a href="https://leanprover-community.github.io/mathlib_docs/find/units.inv_mul_eq_iff_eq_mul">docs#units.inv_mul_eq_iff_eq_mul</a>.</p>



<a name="293930691"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/division_monoid%20and%20is_unit/near/293930691" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alexander Bentkamp <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/division_monoid.20and.20is_unit.html#293930691">(Aug 17 2022 at 16:24)</a>:</h4>
<p><span class="user-mention" data-user-id="412682">@Moritz Doll</span> That's yet another problem, but I would already be happy with a solution that works for square matrices.</p>



<a name="293932510"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/division_monoid%20and%20is_unit/near/293932510" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Moritz Doll <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/division_monoid.20and.20is_unit.html#293932510">(Aug 17 2022 at 16:33)</a>:</h4>
<p>ah for non-invertible matrices the inverse is defined as zero and not as the matrix itself</p>



<a name="293932663"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/division_monoid%20and%20is_unit/near/293932663" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Moritz Doll <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/division_monoid.20and.20is_unit.html#293932663">(Aug 17 2022 at 16:34)</a>:</h4>
<p>and I also misread your question, I am sorry.</p>



<a name="293933531"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/division_monoid%20and%20is_unit/near/293933531" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alexander Bentkamp <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/division_monoid.20and.20is_unit.html#293933531">(Aug 17 2022 at 16:38)</a>:</h4>
<p>Yes, the inverse of a noninvertible matrix would be the matrix itself, that would also work. Then we could use <code>division_monoid</code> directly. On the other hand, the definition of the inverse as <code>ring.inverse A.det • A.adjugate</code> is currenlty quite elegant.</p>



<a name="293933792"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/division_monoid%20and%20is_unit/near/293933792" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Moritz Doll <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/division_monoid.20and.20is_unit.html#293933792">(Aug 17 2022 at 16:40)</a>:</h4>
<p>the issue goes down to <code>ring.inverse</code>, but changing it there seems like a dangerous thing</p>



<a name="293933919"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/division_monoid%20and%20is_unit/near/293933919" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Moritz Doll <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/division_monoid.20and.20is_unit.html#293933919">(Aug 17 2022 at 16:40)</a>:</h4>
<p>I would guess that there a quite a few things that rely on the inverse being zero if the element is non-invertible</p>



<a name="293934094"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/division_monoid%20and%20is_unit/near/293934094" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alexander Bentkamp <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/division_monoid.20and.20is_unit.html#293934094">(Aug 17 2022 at 16:41)</a>:</h4>
<p>Right, it would probably be easier to modify <code>division_monoid</code>, although I am not sure how much depends on it.</p>



<a name="293934258"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/division_monoid%20and%20is_unit/near/293934258" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alexander Bentkamp <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/division_monoid.20and.20is_unit.html#293934258">(Aug 17 2022 at 16:42)</a>:</h4>
<p><span class="user-mention" data-user-id="224323">@Junyan Xu</span> Yes, that would be a nice way to transfer the lemmas from <code>units</code> to <code>matrix</code>. But it would still require us to create <code>matrix</code>-specific copies of the lemmas about <code>units</code>. I was wondering if we could use type class inference instead of copies.</p>



<a name="293934913"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/division_monoid%20and%20is_unit/near/293934913" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jireh Loreaux <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/division_monoid.20and.20is_unit.html#293934913">(Aug 17 2022 at 16:46)</a>:</h4>
<p><span class="user-mention" data-user-id="387244">@Yaël Dillies</span> who put some serious thought into the creation of <code>division_monoid</code></p>



<a name="293935274"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/division_monoid%20and%20is_unit/near/293935274" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/division_monoid.20and.20is_unit.html#293935274">(Aug 17 2022 at 16:48)</a>:</h4>
<p>Currently, matrices are not a division monoid because they do not respect <a href="https://leanprover-community.github.io/mathlib_docs/find/inv_inv">docs#inv_inv</a>.</p>



<a name="293935475"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/division_monoid%20and%20is_unit/near/293935475" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/division_monoid.20and.20is_unit.html#293935475">(Aug 17 2022 at 16:49)</a>:</h4>
<p>Removing this field to <a href="https://leanprover-community.github.io/mathlib_docs/find/division_monoid">docs#division_monoid</a> would make ~50 lemmas not true for them (out of ~300 <code>division_monoid</code> lemmas) iirc.</p>



<a name="293935812"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/division_monoid%20and%20is_unit/near/293935812" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/division_monoid.20and.20is_unit.html#293935812">(Aug 17 2022 at 16:51)</a>:</h4>
<p>What I suggested back then was to redefine inversion of matrices so as to make this axiom true, but <span class="user-mention" data-user-id="308899">@Yakov Pechersky</span> says thus is too hard to ensure. I don't know whether I believe it but I also don't know much about matrices.</p>



<a name="293936391"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/division_monoid%20and%20is_unit/near/293936391" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Moritz Doll <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/division_monoid.20and.20is_unit.html#293936391">(Aug 17 2022 at 16:54)</a>:</h4>
<p>it feels a bit like the last three fields in <code>division_monoid</code> almost force the inverse to be a real inverse and I wonder whether the lemma Alexander was first mentioning is true without the <code>is_unit</code> assumption</p>



<a name="293936887"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/division_monoid%20and%20is_unit/near/293936887" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/division_monoid.20and.20is_unit.html#293936887">(Aug 17 2022 at 16:57)</a>:</h4>
<p>No, that lemma is wrong if you do not assume <code>is_unit</code>.</p>



<a name="293937035"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/division_monoid%20and%20is_unit/near/293937035" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Moritz Doll <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/division_monoid.20and.20is_unit.html#293937035">(Aug 17 2022 at 16:57)</a>:</h4>
<p>but there more serious question would be whether it is possible to prove it with something less than <code>division_monoid</code></p>



<a name="293937139"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/division_monoid%20and%20is_unit/near/293937139" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/division_monoid.20and.20is_unit.html#293937139">(Aug 17 2022 at 16:58)</a>:</h4>
<p>Yes you can</p>



<a name="293937337"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/division_monoid%20and%20is_unit/near/293937337" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/division_monoid.20and.20is_unit.html#293937337">(Aug 17 2022 at 16:59)</a>:</h4>
<p>Its proof doesn't mention <code>inv_inv</code>.</p>



<a name="293939810"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/division_monoid%20and%20is_unit/near/293939810" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/division_monoid.20and.20is_unit.html#293939810">(Aug 17 2022 at 17:13)</a>:</h4>
<p>The easy way out is to write the typeclass <code>division_monoid</code> - <code>inv_inv</code>, but I was trying not to overengineer the hierarchy. The solution I would like to see is making <code>inv_inv</code> true for <code>matrix</code>.</p>



<a name="293940182"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/division_monoid%20and%20is_unit/near/293940182" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jireh Loreaux <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/division_monoid.20and.20is_unit.html#293940182">(Aug 17 2022 at 17:15)</a>:</h4>
<p>Does this not work for <code>div_inv_monoid</code>?</p>



<a name="293941921"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/division_monoid%20and%20is_unit/near/293941921" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/division_monoid.20and.20is_unit.html#293941921">(Aug 17 2022 at 17:24)</a>:</h4>
<p>No, <code>div_inv_monoid</code> just states the definition of division in terms of inversion.</p>



<a name="293943580"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/division_monoid%20and%20is_unit/near/293943580" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Moritz Doll <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/division_monoid.20and.20is_unit.html#293943580">(Aug 17 2022 at 17:33)</a>:</h4>
<p>yeah, one would need a typeclass for having <code>a⁻¹ = ↑(ha.unit)⁻¹</code>, where <code>ha : is_unit a</code>, but I don't know whether that is worth it (probably not)</p>



<a name="293944654"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/division_monoid%20and%20is_unit/near/293944654" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jireh Loreaux <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/division_monoid.20and.20is_unit.html#293944654">(Aug 17 2022 at 17:39)</a>:</h4>
<p>If it's just matrices for now, I think adding a standalone lemma for those is okay.</p>



<a name="293944905"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/division_monoid%20and%20is_unit/near/293944905" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yakov Pechersky <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/division_monoid.20and.20is_unit.html#293944905">(Aug 17 2022 at 17:40)</a>:</h4>
<p><code>inv_inv_inv</code> is true for matrices as it right now</p>



<a name="293945440"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/division_monoid%20and%20is_unit/near/293945440" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yakov Pechersky <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/division_monoid.20and.20is_unit.html#293945440">(Aug 17 2022 at 17:44)</a>:</h4>
<p>If a matrix is not invertible, then currently <code>inv</code> sends it to <code>0</code>. so <code>A\inv\inv = 0</code> even when <code>A \ne 0</code>.</p>



<a name="293945531"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/division_monoid%20and%20is_unit/near/293945531" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yakov Pechersky <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/division_monoid.20and.20is_unit.html#293945531">(Aug 17 2022 at 17:44)</a>:</h4>
<p>Let's say <code>A\inv = A</code> when A is not invertible. Then <code>inv_inv</code> is true. But then a lot of nice lemmas about the distribution of inv over mul, or <code>zpow</code> don't work.</p>



<a name="293956543"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/division_monoid%20and%20is_unit/near/293956543" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/division_monoid.20and.20is_unit.html#293956543">(Aug 17 2022 at 18:55)</a>:</h4>
<p>I mean, I'd rather have lemmas applying sometimes under more conditions (e.g. requiring invertibility) instead of having to rewrite lemmas, but I'm not sure of the exact details of this situation. We can also prove lemmas about the adjugate+determinant combo separately, and leave the inv lemmas to another inv so that  the typeclass system functions better.</p>



<a name="293956726"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/division_monoid%20and%20is_unit/near/293956726" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yakov Pechersky <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/division_monoid.20and.20is_unit.html#293956726">(Aug 17 2022 at 18:56)</a>:</h4>
<p>There is also <a href="https://leanprover-community.github.io/mathlib_docs/find/ring.inverse">docs#ring.inverse</a></p>



<a name="293956828"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/division_monoid%20and%20is_unit/near/293956828" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yakov Pechersky <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/division_monoid.20and.20is_unit.html#293956828">(Aug 17 2022 at 18:56)</a>:</h4>
<p>That's re Moritz Doll's suggestion</p>



<a name="293957025"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/division_monoid%20and%20is_unit/near/293957025" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yakov Pechersky <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/division_monoid.20and.20is_unit.html#293957025">(Aug 17 2022 at 18:58)</a>:</h4>
<p>Sorry, I see that Alexander already mentioned it via the <code>matrix.inv</code> definition</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>