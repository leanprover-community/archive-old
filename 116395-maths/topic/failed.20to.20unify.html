---
layout: archive
title: Zulip Chat Archive
permalink: /stream/116395-maths/topic/failed.20to.20unify.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/116395-maths/index.html">maths</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/failed.20to.20unify.html">failed to unify</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="269864660"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/failed%20to%20unify/near/269864660" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joachim Breitner <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/failed.20to.20unify.html#269864660">(Jan 29 2022 at 13:36)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">invalid</span> <span class="n">apply</span> <span class="n">tactic</span><span class="o">,</span> <span class="n">failed</span> <span class="n">to</span> <span class="n">unify</span>
  <span class="n">y</span> <span class="bp">*</span> <span class="n">x</span> <span class="bp">=</span> <span class="n">x</span> <span class="bp">*</span> <span class="n">y</span>
<span class="k">with</span>
  <span class="n">y</span> <span class="bp">*</span> <span class="n">x</span> <span class="bp">=</span> <span class="n">x</span> <span class="bp">*</span> <span class="n">y</span>
<span class="n">state</span><span class="o">:</span>
<span class="n">G</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u_1</span><span class="o">,</span>
<span class="n">_inst_1</span> <span class="o">:</span> <span class="n">group</span> <span class="n">G</span><span class="o">,</span>
<span class="n">_inst_3</span> <span class="o">:</span> <span class="n">comm_group</span> <span class="n">G</span><span class="o">,</span>
<span class="n">x</span> <span class="n">y</span> <span class="o">:</span> <span class="n">G</span>
<span class="bp">⊢</span> <span class="n">y</span> <span class="bp">*</span> <span class="n">x</span> <span class="bp">=</span> <span class="n">x</span> <span class="bp">*</span> <span class="n">y</span>
</code></pre></div>
<p>irregardless of the current cause, maybe <code>lean</code> (and any other programming language around there) could be so kind and notice that when it produces a “failed to unify” error message with identical pretty-printed code, and maybe add a polite sentence like “and I’m sorry for the unhelpful error message”.</p>



<a name="269864691"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/failed%20to%20unify/near/269864691" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/failed.20to.20unify.html#269864691">(Jan 29 2022 at 13:37)</a>:</h4>
<p>usually it unfolds the definitions it if things pretty print the same, I'm not sure why it didn't here. the issue is that you have two <code>group</code> instances, btw</p>



<a name="269864891"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/failed%20to%20unify/near/269864891" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joachim Breitner <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/failed.20to.20unify.html#269864891">(Jan 29 2022 at 13:40)</a>:</h4>
<p>Hmm, maybe I am using <code>comm_group G</code> wrong then. How do I express that a group <code>G</code> for which I have <code>group G</code> is commutative? I didn't find a predicate  <code>G.abelian</code> or something like that.</p>



<a name="269864908"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/failed%20to%20unify/near/269864908" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joachim Breitner <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/failed.20to.20unify.html#269864908">(Jan 29 2022 at 13:41)</a>:</h4>
<p><code>⊤.is_commutative</code> is a bit roundabout</p>



<a name="269864991"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/failed%20to%20unify/near/269864991" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joachim Breitner <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/failed.20to.20unify.html#269864991">(Jan 29 2022 at 13:43)</a>:</h4>
<p>Ah, maybe <code>is_commutative G  (*)</code></p>



<a name="269865233"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/failed%20to%20unify/near/269865233" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/failed.20to.20unify.html#269865233">(Jan 29 2022 at 13:45)</a>:</h4>
<p><code>cyclic</code> sort of has to deal with this a little, ctrl+f "commutative" <a href="https://leanprover-community.github.io/mathlib_docs/group_theory/specific_groups/cyclic.html">here</a> to see some of what they do</p>



<a name="269865306"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/failed%20to%20unify/near/269865306" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/failed.20to.20unify.html#269865306">(Jan 29 2022 at 13:47)</a>:</h4>
<p>If you're assuming <code>[comm_group G]</code> then don't assume <code>[group G]</code></p>



<a name="269865371"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/failed%20to%20unify/near/269865371" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joachim Breitner <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/failed.20to.20unify.html#269865371">(Jan 29 2022 at 13:48)</a>:</h4>
<p>So is this reasonable?</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">def</span> <span class="n">_root_.group.comm_group_of_center_eq_top</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="n">center</span> <span class="n">G</span> <span class="bp">=</span> <span class="bp">⊤</span><span class="o">)</span> <span class="o">:</span> <span class="n">comm_group</span> <span class="n">G</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="k">have</span> <span class="n">h'</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">x</span><span class="o">,</span> <span class="n">x</span> <span class="bp">∈</span> <span class="n">center</span> <span class="n">G</span><span class="o">,</span> <span class="kd">by</span> <span class="o">{</span><span class="n">rw</span> <span class="n">h</span><span class="o">,</span> <span class="n">simp</span><span class="o">,},</span>
  <span class="n">exact</span> <span class="o">{</span> <span class="n">mul_comm</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">x</span> <span class="n">y</span><span class="o">,</span> <span class="n">h'</span> <span class="n">y</span> <span class="n">x</span><span class="o">,</span> <span class="bp">..</span> <span class="o">(</span><span class="n">_</span> <span class="o">:</span> <span class="n">group</span> <span class="n">G</span><span class="o">)</span> <span class="o">}</span>
<span class="kd">end</span>
</code></pre></div>



<a name="269865534"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/failed%20to%20unify/near/269865534" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/failed.20to.20unify.html#269865534">(Jan 29 2022 at 13:52)</a>:</h4>
<p>yeah, you can maybe golf it to this but otherwise fine:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">def</span> <span class="n">_root_.group.comm_group_of_center_eq_top</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="n">center</span> <span class="n">G</span> <span class="bp">=</span> <span class="bp">⊤</span><span class="o">)</span> <span class="o">:</span> <span class="n">comm_group</span> <span class="n">G</span> <span class="o">:=</span>
<span class="k">let</span> <span class="n">h'</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">x</span><span class="o">,</span> <span class="n">x</span> <span class="bp">∈</span> <span class="n">center</span> <span class="n">G</span> <span class="o">:=</span> <span class="kd">by</span> <span class="n">simp</span> <span class="o">[</span><span class="n">h</span><span class="o">]</span> <span class="k">in</span> <span class="o">{</span> <span class="n">mul_comm</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">x</span> <span class="n">y</span><span class="o">,</span> <span class="n">h'</span> <span class="n">y</span> <span class="n">x</span><span class="o">,</span> <span class="bp">..</span> <span class="o">(</span><span class="n">_</span> <span class="o">:</span> <span class="n">group</span> <span class="n">G</span><span class="o">)</span> <span class="o">}</span>
</code></pre></div>



<a name="269865744"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/failed%20to%20unify/near/269865744" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/failed.20to.20unify.html#269865744">(Jan 29 2022 at 13:56)</a>:</h4>
<p>You would usually put the <code>comm_group.mk</code> outermost</p>



<a name="269865854"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/failed%20to%20unify/near/269865854" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joachim Breitner <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/failed.20to.20unify.html#269865854">(Jan 29 2022 at 13:59)</a>:</h4>
<p>Further refinements welcome at <a href="https://github.com/leanprover-community/mathlib/pull/11718">https://github.com/leanprover-community/mathlib/pull/11718</a> :-)</p>



<a name="269865880"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/failed%20to%20unify/near/269865880" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joachim Breitner <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/failed.20to.20unify.html#269865880">(Jan 29 2022 at 13:59)</a>:</h4>
<p>Ah, this should probably be a <code>def</code>, not a <code>lemma</code>, if it returns <code>comm_group</code>, right?</p>



<a name="269879684"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/failed%20to%20unify/near/269879684" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Stuart Presnell <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/failed.20to.20unify.html#269879684">(Jan 29 2022 at 18:17)</a>:</h4>
<p><span class="user-mention silent" data-user-id="470149">Joachim Breitner</span> <a href="#narrow/stream/116395-maths/topic/failed.20to.20unify/near/269864660">said</a>:</p>
<blockquote>
<p>maybe add a polite sentence like “and I’m sorry for the unhelpful error message”.</p>
</blockquote>
<p>You're right that it would be good to have a more helpful error message here.  This kind of error — things that pretty-print to the same thing but aren't considered identical — often seems to be due to typeclass problems.  So maybe something could be added to the error message to direct the user to check their typeclasses?</p>



<a name="269879709"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/failed%20to%20unify/near/269879709" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Stuart Presnell <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/failed.20to.20unify.html#269879709">(Jan 29 2022 at 18:17)</a>:</h4>
<p>(I'm assuming here that it's possible to automatically detect that the pp output is identical in these cases.)</p>



<a name="270013104"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/failed%20to%20unify/near/270013104" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Anne Baanen <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/failed.20to.20unify.html#270013104">(Jan 31 2022 at 10:58)</a>:</h4>
<p><a href="https://github.com/leanprover-community/lean/blob/b99b2ec06a55fceaa396d03e1c2cc6821b5adf4e/src/library/tactic/apply_tactic.cpp#L220">The error message is generated by <code>apply_tactic.cpp:220</code></a>, and there's similar code in <a href="https://github.com/leanprover-community/lean/blob/6f1b5639005a358db19f183c2d7296cebcb12b39/src/library/tactic/tactic_state.cpp#L513"><code>tactic_state.cpp:513</code></a></p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>