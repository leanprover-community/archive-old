---
layout: archive
title: Zulip Chat Archive
permalink: /stream/116395-maths/topic/Coersion.20and.20composition.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/116395-maths/index.html">maths</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Coersion.20and.20composition.html">Coersion and composition</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="195265279"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Coersion%20and%20composition/near/195265279" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> orlando <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Coersion.20and.20composition.html#195265279">(Apr 25 2020 at 03:21)</a>:</h4>
<p>Hello,  I have problem with coersion <span aria-label="innocent" class="emoji emoji-1f607" role="img" title="innocent">:innocent:</span></p>
<div class="codehilite"><pre><span></span><span class="kn">import</span> <span class="n">algebra</span><span class="bp">.</span><span class="n">module</span>
<span class="kn">import</span> <span class="n">linear_algebra</span><span class="bp">.</span><span class="n">basic</span>
<span class="c1">--infix  ` * `     := linear_map.comp</span>
<span class="n">universes</span> <span class="n">u</span> <span class="n">v</span>
<span class="kn">variables</span> <span class="o">{</span><span class="n">R</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">}[</span><span class="n">comm_ring</span> <span class="n">R</span><span class="o">]{</span><span class="n">M</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">v</span><span class="o">}[</span><span class="n">add_comm_group</span> <span class="n">M</span><span class="o">]</span> <span class="o">[</span><span class="n">module</span> <span class="n">R</span> <span class="n">M</span> <span class="o">]</span>
<span class="kn">open</span> <span class="n">linear_map</span>
<span class="n">def</span>  <span class="n">Projector</span> <span class="o">(</span><span class="n">p</span> <span class="o">:</span> <span class="n">M</span> <span class="bp">→</span><span class="err">ₗ</span><span class="o">[</span><span class="n">R</span><span class="o">]</span> <span class="n">M</span><span class="o">)</span> <span class="o">:=</span> <span class="n">p</span> <span class="bp">*</span> <span class="n">p</span> <span class="bp">=</span> <span class="n">p</span>

<span class="c">/-</span><span class="cm">-</span>
<span class="cm">    if `p² = p` then `(1-p)² = 1 - p - p +p² = ... = 1-p`</span>
<span class="cm">-/</span>
<span class="kn">lemma</span> <span class="n">Complementary</span> <span class="o">(</span><span class="n">p</span> <span class="o">:</span> <span class="n">M</span> <span class="bp">→</span><span class="err">ₗ</span><span class="o">[</span><span class="n">R</span><span class="o">]</span><span class="n">M</span><span class="o">)</span> <span class="o">[</span><span class="n">Projector</span> <span class="n">p</span><span class="o">]</span> <span class="o">:</span> <span class="n">Projector</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">-</span> <span class="n">p</span><span class="o">)</span> <span class="o">:=</span> <span class="k">begin</span>
    <span class="n">unfold</span> <span class="n">Projector</span><span class="o">,</span>
    <span class="n">rw</span> <span class="n">mul_sub_left_distrib</span><span class="o">,</span>
    <span class="n">iterate</span> <span class="mi">2</span> <span class="o">{</span> <span class="n">rw</span> <span class="n">mul_sub_right_distrib</span><span class="o">,</span><span class="n">rw</span> <span class="n">mul_one</span><span class="o">},</span>
    <span class="n">unfold</span> <span class="n">Projector</span> <span class="n">at</span> <span class="bp">*</span><span class="o">,</span>
    <span class="n">rw</span> <span class="bp">_</span><span class="n">inst_4</span><span class="o">,</span>
    <span class="n">rw</span> <span class="n">one_mul</span><span class="o">,</span>
    <span class="n">simp</span><span class="o">,</span>
<span class="kn">end</span>
<span class="kn">variables</span> <span class="o">(</span><span class="n">p</span> <span class="o">:</span> <span class="n">M</span><span class="bp">→</span><span class="err">ₗ</span><span class="o">[</span><span class="n">R</span><span class="o">]</span><span class="n">M</span><span class="o">)</span>
<span class="kn">lemma</span> <span class="n">ker_eq_im_complementary</span> <span class="o">(</span><span class="n">hyp</span> <span class="o">:</span> <span class="n">Projector</span> <span class="n">p</span> <span class="o">)</span> <span class="o">:</span> <span class="n">range</span> <span class="n">p</span> <span class="bp">=</span> <span class="n">ker</span> <span class="o">(</span><span class="mi">1</span><span class="bp">-</span><span class="n">p</span><span class="o">)</span> <span class="o">:=</span> <span class="k">begin</span>
    <span class="n">apply</span> <span class="n">submodule</span><span class="bp">.</span><span class="n">ext</span><span class="o">,</span>
    <span class="n">intros</span> <span class="n">x</span><span class="o">,</span>
    <span class="n">split</span><span class="o">,</span>
        <span class="n">intros</span> <span class="n">x_in_range</span><span class="o">,</span>
        <span class="n">rw</span> <span class="n">mem_range</span> <span class="n">at</span> <span class="n">x_in_range</span><span class="o">,</span>
        <span class="n">rcases</span> <span class="n">x_in_range</span> <span class="k">with</span> <span class="bp">⟨</span><span class="n">y</span><span class="o">,</span><span class="n">hyp_y</span><span class="bp">⟩</span><span class="o">,</span>
        <span class="n">rw</span> <span class="n">mem_ker</span><span class="o">,</span>
        <span class="n">rw</span> <span class="err">←</span> <span class="n">hyp_y</span><span class="o">,</span>
        <span class="n">simp</span><span class="o">,</span>
        <span class="n">rw</span> <span class="err">←</span> <span class="n">function</span><span class="bp">.</span><span class="n">comp_apply</span> <span class="err">⇑</span><span class="n">p</span><span class="o">,</span>
        <span class="n">unfold</span> <span class="n">Projector</span> <span class="n">at</span> <span class="n">hyp</span><span class="o">,</span>
        <span class="n">erw</span> <span class="n">hyp</span><span class="o">,</span>       <span class="c1">--- here  do you have an idea to make the coersion of the  composition easy ?</span>
<span class="kn">end</span>
</pre></div>



<a name="195268723"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Coersion%20and%20composition/near/195268723" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Coersion.20and.20composition.html#195268723">(Apr 25 2020 at 05:10)</a>:</h4>
<p>Could you please copy+paste proof state? BTW, why do you use <code>Projector</code> as a typeclass in <code>Complementary</code> and as an explicit argument in the next lemma?</p>



<a name="195268824"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Coersion%20and%20composition/near/195268824" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> orlando <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Coersion.20and.20composition.html#195268824">(Apr 25 2020 at 05:14)</a>:</h4>
<p>Hello, it's a problem <code> ⇑p ∘ ⇑p = ⇑(p  * p) </code> coersion ! </p>
<div class="codehilite"><pre><span></span><span class="n">rewrite</span> <span class="n">tactic</span> <span class="n">failed</span><span class="o">,</span> <span class="n">did</span> <span class="n">not</span> <span class="n">find</span> <span class="kn">instance</span> <span class="n">of</span> <span class="n">the</span> <span class="n">pattern</span> <span class="k">in</span> <span class="n">the</span> <span class="n">target</span> <span class="n">expression</span>
  <span class="n">p</span> <span class="bp">*</span> <span class="n">p</span>
<span class="n">state</span><span class="o">:</span>
<span class="mi">2</span> <span class="n">goals</span>
<span class="n">R</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">,</span>
<span class="bp">_</span><span class="n">inst_1</span> <span class="o">:</span> <span class="n">comm_ring</span> <span class="n">R</span><span class="o">,</span>
<span class="n">M</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">v</span><span class="o">,</span>
<span class="bp">_</span><span class="n">inst_2</span> <span class="o">:</span> <span class="n">add_comm_group</span> <span class="n">M</span><span class="o">,</span>
<span class="bp">_</span><span class="n">inst_3</span> <span class="o">:</span> <span class="n">module</span> <span class="n">R</span> <span class="n">M</span><span class="o">,</span>
<span class="n">p</span> <span class="o">:</span> <span class="n">M</span> <span class="bp">→</span><span class="err">ₗ</span><span class="o">[</span><span class="n">R</span><span class="o">]</span> <span class="n">M</span><span class="o">,</span>
<span class="n">x</span> <span class="n">y</span> <span class="o">:</span> <span class="n">M</span><span class="o">,</span>
<span class="n">hyp_y</span> <span class="o">:</span> <span class="err">⇑</span><span class="n">p</span> <span class="n">y</span> <span class="bp">=</span> <span class="n">x</span><span class="o">,</span>
<span class="n">hyp</span> <span class="o">:</span> <span class="n">p</span> <span class="bp">*</span> <span class="n">p</span> <span class="bp">=</span> <span class="n">p</span>
<span class="err">⊢</span> <span class="err">⇑</span><span class="n">p</span> <span class="n">y</span> <span class="bp">-</span> <span class="o">(</span><span class="err">⇑</span><span class="n">p</span> <span class="err">∘</span> <span class="err">⇑</span><span class="n">p</span><span class="o">)</span> <span class="n">y</span> <span class="bp">=</span> <span class="mi">0</span>

<span class="n">R</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">,</span>
<span class="bp">_</span><span class="n">inst_1</span> <span class="o">:</span> <span class="n">comm_ring</span> <span class="n">R</span><span class="o">,</span>
<span class="n">M</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">v</span><span class="o">,</span>
<span class="bp">_</span><span class="n">inst_2</span> <span class="o">:</span> <span class="n">add_comm_group</span> <span class="n">M</span><span class="o">,</span>
<span class="bp">_</span><span class="n">inst_3</span> <span class="o">:</span> <span class="n">module</span> <span class="n">R</span> <span class="n">M</span><span class="o">,</span>
<span class="n">p</span> <span class="o">:</span> <span class="n">M</span> <span class="bp">→</span><span class="err">ₗ</span><span class="o">[</span><span class="n">R</span><span class="o">]</span> <span class="n">M</span><span class="o">,</span>
<span class="n">hyp</span> <span class="o">:</span> <span class="n">Projector</span> <span class="n">p</span><span class="o">,</span>
<span class="n">x</span> <span class="o">:</span> <span class="n">M</span>
<span class="err">⊢</span> <span class="n">x</span> <span class="err">∈</span> <span class="n">ker</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">-</span> <span class="n">p</span><span class="o">)</span> <span class="bp">→</span> <span class="n">x</span> <span class="err">∈</span> <span class="n">range</span> <span class="n">p</span>
</pre></div>



<a name="195268827"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Coersion%20and%20composition/near/195268827" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Coersion.20and.20composition.html#195268827">(Apr 25 2020 at 05:15)</a>:</h4>
<p>You can try to change your goal:</p>
<div class="codehilite"><pre><span></span><span class="n">change</span> <span class="n">p</span> <span class="n">y</span> <span class="bp">-</span> <span class="o">(</span><span class="n">p</span> <span class="bp">*</span> <span class="n">p</span><span class="o">)</span> <span class="n">y</span> <span class="bp">=</span> <span class="mi">0</span>
</pre></div>



<a name="195268830"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Coersion%20and%20composition/near/195268830" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Coersion.20and.20composition.html#195268830">(Apr 25 2020 at 05:15)</a>:</h4>
<p>There should be a <code>linear_map.mul_apply</code> lemma. Use it instead of <code>function.comp_apply</code>.</p>



<a name="195268835"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Coersion%20and%20composition/near/195268835" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Coersion.20and.20composition.html#195268835">(Apr 25 2020 at 05:15)</a>:</h4>
<p>Yury's advice is better</p>



<a name="195268901"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Coersion%20and%20composition/near/195268901" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Coersion.20and.20composition.html#195268901">(Apr 25 2020 at 05:17)</a>:</h4>
<p>If there is no such lemma, please add it right after the instance that gives you <code>*</code></p>



<a name="195268947"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Coersion%20and%20composition/near/195268947" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> orlando <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Coersion.20and.20composition.html#195268947">(Apr 25 2020 at 05:18)</a>:</h4>
<p>But it's work Johan ! </p>
<p><span class="user-mention" data-user-id="214703">@Yury G. Kudryashov</span>  the tatic state change to <code> ⊢ ⇑p y - ⇑(comp p p) y = 0 </code> lean transform <code> * </code> to composition and i can't `rw``` after <span aria-label="frown" class="emoji emoji-1f641" role="img" title="frown">:frown:</span></p>



<a name="195268948"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Coersion%20and%20composition/near/195268948" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> orlando <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Coersion.20and.20composition.html#195268948">(Apr 25 2020 at 05:18)</a>:</h4>
<p>I thinck there is a stuff with using <code> * </code> !</p>



<a name="195268956"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Coersion%20and%20composition/near/195268956" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Coersion.20and.20composition.html#195268956">(Apr 25 2020 at 05:19)</a>:</h4>
<p>It's called <code>linear_map.mul_app</code></p>



<a name="195268997"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Coersion%20and%20composition/near/195268997" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Coersion.20and.20composition.html#195268997">(Apr 25 2020 at 05:20)</a>:</h4>
<p>If you <code>rw ← p.mul_app</code> instead of <code>function.comp_apply</code>, then you should get <code>*</code></p>



<a name="195269050"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Coersion%20and%20composition/near/195269050" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> orlando <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Coersion.20and.20composition.html#195269050">(Apr 25 2020 at 05:22)</a>:</h4>
<p>oh Sorry, i read <code>linear_map.comp_apply </code>  so  ok nice !</p>



<a name="195269059"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Coersion%20and%20composition/near/195269059" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> orlando <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Coersion.20and.20composition.html#195269059">(Apr 25 2020 at 05:23)</a>:</h4>
<p>For your question : i don't understand when a have to use <code> class</code> or <code>def</code> or <code>structure</code></p>



<a name="195269159"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Coersion%20and%20composition/near/195269159" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> orlando <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Coersion.20and.20composition.html#195269159">(Apr 25 2020 at 05:26)</a>:</h4>
<p>if i understand, i have to use <code> (hyp :  Projector p) </code></p>



<a name="195269168"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Coersion%20and%20composition/near/195269168" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Coersion.20and.20composition.html#195269168">(Apr 25 2020 at 05:26)</a>:</h4>
<p>You should use <code>class</code> and <code>[Projector p]</code> if you will have quite a few <code>instance</code>s, and every time you apply your theorem Lean will find an instance automatically. It is used, e.g., for various information about <code>Type</code>s (<code>[group α]</code> etc)</p>



<a name="195269212"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Coersion%20and%20composition/near/195269212" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Coersion.20and.20composition.html#195269212">(Apr 25 2020 at 05:28)</a>:</h4>
<p>If you're not going to have many <code>instance</code>s, then you should use <code>(hyp : Projector p)</code>. BTW, if you're going to PR this to <code>mathlib</code>, then I'd recommend to call it <code>is_projector p</code>.</p>



<a name="195269289"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Coersion%20and%20composition/near/195269289" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> orlando <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Coersion.20and.20composition.html#195269289">(Apr 25 2020 at 05:30)</a>:</h4>
<p>ok, <code>is_projector</code> is  really a better name !</p>



<a name="195269566"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Coersion%20and%20composition/near/195269566" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> orlando <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Coersion.20and.20composition.html#195269566">(Apr 25 2020 at 05:41)</a>:</h4>
<p><code>change</code>  : if i have an equality to show <code> left = right </code> and  <code> left = left' </code> by <code>rfl</code> , i can change  my goal for <code> left' = right </code>  with <code>change </code> ...  waaaaahou ... my new favorite <code> tactic</code>   <span aria-label="grinning face with smiling eyes" class="emoji emoji-1f601" role="img" title="grinning face with smiling eyes">:grinning_face_with_smiling_eyes:</span></p>



<a name="195291083"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Coersion%20and%20composition/near/195291083" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> orlando <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Coersion.20and.20composition.html#195291083">(Apr 25 2020 at 16:07)</a>:</h4>
<p>Hello two questions about <code>specialize </code> and  <code> change </code></p>
<p>1/ Why <code>  let H := specialize (proj_ker (id - p)) (Complementary p hyp)  </code> doesn't work but <code>let H := proj_ker (id-p),     specialize  H  (Complementary p hyp), </code> work ? </p>
<p>2/ At the end, can i change without  <code>intro m </code> ?  </p>
<div class="codehilite"><pre><span></span><span class="kn">import</span> <span class="n">tactic</span><span class="bp">.</span><span class="n">ring</span>
<span class="kn">import</span> <span class="n">algebra</span><span class="bp">.</span><span class="n">module</span>
<span class="kn">import</span> <span class="n">linear_algebra</span><span class="bp">.</span><span class="n">basic</span>
<span class="c1">--infix  ` * `     := linear_map.comp</span>
<span class="n">universes</span> <span class="n">u</span> <span class="n">v</span>
<span class="kn">variables</span> <span class="o">{</span><span class="n">R</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">}[</span><span class="n">comm_ring</span> <span class="n">R</span><span class="o">]{</span><span class="n">M</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">v</span><span class="o">}[</span><span class="n">add_comm_group</span> <span class="n">M</span><span class="o">]</span> <span class="o">[</span><span class="n">module</span> <span class="n">R</span> <span class="n">M</span><span class="o">]</span>
<span class="kn">open</span> <span class="n">linear_map</span>

<span class="n">def</span>  <span class="n">is_projector</span> <span class="o">(</span><span class="n">p</span> <span class="o">:</span> <span class="n">M</span> <span class="bp">→</span><span class="err">ₗ</span><span class="o">[</span><span class="n">R</span><span class="o">]</span> <span class="n">M</span><span class="o">)</span> <span class="o">:=</span> <span class="n">p</span> <span class="bp">*</span> <span class="n">p</span> <span class="bp">=</span> <span class="n">p</span>

<span class="kn">lemma</span> <span class="n">is_projector_ext</span> <span class="o">{</span><span class="n">p</span> <span class="o">:</span> <span class="n">M</span> <span class="bp">→</span><span class="err">ₗ</span><span class="o">[</span><span class="n">R</span><span class="o">]</span><span class="n">M</span><span class="o">}</span> <span class="o">(</span><span class="n">hyp</span> <span class="o">:</span> <span class="n">is_projector</span> <span class="n">p</span><span class="o">)</span> <span class="o">:</span> <span class="n">p</span> <span class="bp">*</span> <span class="n">p</span> <span class="bp">=</span> <span class="n">p</span> <span class="o">:=</span>
<span class="k">begin</span> <span class="n">unfold</span> <span class="n">is_projector</span> <span class="n">at</span> <span class="n">hyp</span><span class="o">,</span><span class="n">exact</span> <span class="n">hyp</span><span class="o">,</span> <span class="kn">end</span>
<span class="c">/-</span><span class="cm">-</span>
<span class="cm">    if `p² = p` then `(1-p)² = 1 - p - p +p² = ... = 1-p`</span>
<span class="cm">-/</span>
<span class="kn">lemma</span> <span class="n">Complementary</span> <span class="o">(</span><span class="n">p</span> <span class="o">:</span> <span class="n">M</span> <span class="bp">→</span><span class="err">ₗ</span><span class="o">[</span><span class="n">R</span><span class="o">]</span><span class="n">M</span><span class="o">)</span> <span class="o">(</span><span class="n">hyp</span> <span class="o">:</span> <span class="n">is_projector</span> <span class="n">p</span><span class="o">)</span> <span class="o">:</span> <span class="n">is_projector</span> <span class="o">(</span><span class="n">id</span> <span class="bp">-</span> <span class="n">p</span><span class="o">)</span> <span class="o">:=</span> <span class="k">begin</span>
    <span class="n">change</span> <span class="n">linear_map</span><span class="bp">.</span><span class="n">id</span> <span class="bp">-</span> <span class="n">p</span> <span class="k">with</span> <span class="mi">1</span> <span class="bp">-</span><span class="n">p</span><span class="o">,</span>
    <span class="n">unfold</span> <span class="n">is_projector</span><span class="o">,</span>
    <span class="n">rw</span> <span class="n">mul_sub_left_distrib</span><span class="o">,</span>
    <span class="n">iterate</span> <span class="mi">2</span> <span class="o">{</span> <span class="n">rw</span> <span class="n">mul_sub_right_distrib</span><span class="o">,</span><span class="n">rw</span> <span class="n">mul_one</span><span class="o">},</span>
    <span class="n">unfold</span> <span class="n">is_projector</span> <span class="n">at</span> <span class="bp">*</span><span class="o">,</span>
    <span class="n">rw</span> <span class="n">hyp</span><span class="o">,</span>
    <span class="n">rw</span> <span class="n">one_mul</span><span class="o">,</span>
    <span class="n">simp</span><span class="o">,</span>
<span class="kn">end</span>
<span class="kn">variables</span> <span class="o">(</span><span class="n">p</span> <span class="o">:</span> <span class="n">M</span> <span class="bp">→</span><span class="err">ₗ</span><span class="o">[</span><span class="n">R</span><span class="o">]</span><span class="n">M</span> <span class="o">)</span>
<span class="kn">lemma</span> <span class="n">ker_eq_im_comp</span> <span class="o">(</span><span class="n">hyp</span> <span class="o">:</span> <span class="n">is_projector</span> <span class="n">p</span><span class="o">)</span> <span class="o">:</span> <span class="n">range</span> <span class="n">p</span> <span class="bp">=</span> <span class="n">ker</span> <span class="o">(</span><span class="n">id</span><span class="bp">-</span><span class="n">p</span><span class="o">)</span> <span class="o">:=</span> <span class="k">begin</span>
    <span class="n">apply</span> <span class="n">submodule</span><span class="bp">.</span><span class="n">ext</span><span class="o">,</span><span class="n">intros</span> <span class="n">x</span><span class="o">,</span><span class="n">split</span><span class="o">,</span><span class="n">rintros</span> <span class="bp">⟨</span><span class="n">y</span><span class="o">,</span><span class="n">hyp</span>  <span class="bp">⟩</span><span class="o">,</span> <span class="n">rw</span> <span class="n">mem_ker</span><span class="o">,</span> <span class="n">change</span> <span class="n">x</span><span class="bp">-</span> <span class="n">p</span> <span class="n">x</span> <span class="bp">=</span> <span class="mi">0</span><span class="o">,</span> <span class="n">rw</span> <span class="err">←</span> <span class="n">hyp</span><span class="bp">.</span><span class="mi">2</span><span class="o">,</span>
    <span class="n">change</span> <span class="o">(</span><span class="n">p</span> <span class="bp">-</span> <span class="n">p</span> <span class="bp">*</span> <span class="n">p</span><span class="o">)</span> <span class="n">y</span> <span class="bp">=</span> <span class="mi">0</span><span class="o">,</span> <span class="n">rw</span> <span class="n">is_projector_ext</span><span class="o">,</span> <span class="n">rw</span> <span class="n">sub_self</span><span class="o">,</span> <span class="n">exact</span> <span class="n">rfl</span><span class="o">,</span><span class="n">assumption</span><span class="o">,</span>
    <span class="n">intros</span> <span class="n">hyp</span><span class="o">,</span> <span class="n">rw</span> <span class="n">mem_ker</span> <span class="n">at</span> <span class="n">hyp</span><span class="o">,</span> <span class="n">change</span> <span class="n">x</span><span class="bp">-</span><span class="n">p</span> <span class="n">x</span> <span class="bp">=</span> <span class="mi">0</span> <span class="n">at</span> <span class="n">hyp</span><span class="o">,</span> <span class="n">rw</span> <span class="n">mem_range</span><span class="o">,</span> <span class="n">use</span> <span class="n">x</span><span class="o">,</span>
    <span class="n">sorry</span><span class="o">,</span>
 <span class="kn">end</span>
 <span class="kn">lemma</span> <span class="n">image_in_range</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="n">M</span><span class="o">)</span> <span class="o">:</span> <span class="n">p</span> <span class="n">x</span> <span class="err">∈</span> <span class="n">range</span> <span class="n">p</span> <span class="o">:=</span> <span class="k">begin</span>
    <span class="n">rw</span> <span class="n">mem_range</span><span class="o">,</span><span class="n">use</span> <span class="n">x</span><span class="o">,</span>
 <span class="kn">end</span>
<span class="kn">lemma</span> <span class="n">proj_ker</span> <span class="o">(</span><span class="n">p</span> <span class="o">:</span> <span class="n">M</span> <span class="bp">→</span><span class="err">ₗ</span><span class="o">[</span><span class="n">R</span><span class="o">]</span><span class="n">M</span><span class="o">)</span> <span class="o">(</span><span class="n">hyp</span> <span class="o">:</span> <span class="n">is_projector</span> <span class="n">p</span><span class="o">)</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">m</span> <span class="o">:</span> <span class="n">M</span><span class="o">,</span> <span class="n">p</span> <span class="n">m</span> <span class="err">∈</span> <span class="n">ker</span> <span class="o">(</span><span class="n">id</span> <span class="bp">-</span> <span class="n">p</span><span class="o">)</span> <span class="o">:=</span>
<span class="k">begin</span>
    <span class="n">rw</span> <span class="err">←</span> <span class="n">ker_eq_im_comp</span><span class="o">,</span> <span class="n">exact</span> <span class="n">image_in_range</span> <span class="n">p</span><span class="o">,</span><span class="n">assumption</span><span class="o">,</span>
<span class="kn">end</span>
<span class="kn">lemma</span>  <span class="n">calcul</span> <span class="o">:</span> <span class="n">linear_map</span><span class="bp">.</span><span class="n">id</span> <span class="bp">-</span> <span class="o">(</span><span class="n">id</span> <span class="bp">-</span> <span class="n">p</span><span class="o">)</span> <span class="bp">=</span> <span class="n">p</span> <span class="o">:=</span> <span class="k">begin</span> <span class="n">sorry</span><span class="o">,</span> <span class="kn">end</span>

<span class="kn">lemma</span> <span class="n">proj_im</span><span class="o">(</span><span class="n">p</span> <span class="o">:</span> <span class="n">M</span> <span class="bp">→</span><span class="err">ₗ</span><span class="o">[</span><span class="n">R</span><span class="o">]</span><span class="n">M</span><span class="o">)</span> <span class="o">(</span><span class="n">hyp</span> <span class="o">:</span> <span class="n">is_projector</span> <span class="n">p</span><span class="o">)</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">m</span> <span class="o">:</span> <span class="n">M</span><span class="o">,</span> <span class="n">m</span> <span class="bp">-</span> <span class="n">p</span> <span class="n">m</span> <span class="err">∈</span> <span class="n">ker</span> <span class="o">(</span><span class="n">p</span><span class="o">)</span> <span class="o">:=</span>
<span class="k">begin</span>
    <span class="k">let</span> <span class="n">H</span> <span class="o">:=</span> <span class="n">proj_ker</span> <span class="o">(</span><span class="n">id</span><span class="bp">-</span><span class="n">p</span><span class="o">),</span>
    <span class="c1">-- let H := specialize (proj_ker (id - p)) (Complementary p hyp)                  -- unknown identifier &#39;specialize&#39;</span>
    <span class="n">specialize</span>  <span class="n">H</span>  <span class="o">(</span><span class="n">Complementary</span> <span class="n">p</span> <span class="n">hyp</span><span class="o">),</span>
    <span class="n">rw</span> <span class="n">calcul</span> <span class="n">at</span> <span class="n">H</span><span class="o">,</span>
    <span class="n">intros</span> <span class="n">m</span><span class="o">,</span>                                                    <span class="c1">-- change without intro doesn&#39;t work ?</span>
    <span class="n">change</span> <span class="n">m</span><span class="bp">-</span> <span class="n">p</span> <span class="n">m</span> <span class="k">with</span> <span class="o">(</span><span class="n">linear_map</span><span class="bp">.</span><span class="n">id</span> <span class="bp">-</span><span class="n">p</span><span class="o">)</span> <span class="n">m</span><span class="o">,</span>
    <span class="n">exact</span> <span class="n">H</span> <span class="n">m</span><span class="o">,</span>
<span class="kn">end</span>
</pre></div>



<a name="195291128"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Coersion%20and%20composition/near/195291128" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Coersion.20and.20composition.html#195291128">(Apr 25 2020 at 16:08)</a>:</h4>
<p>1: <code>specialize</code> is a tactic, not a function</p>



<a name="195291201"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Coersion%20and%20composition/near/195291201" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Coersion.20and.20composition.html#195291201">(Apr 25 2020 at 16:10)</a>:</h4>
<p>The term mode equivalent is simply <code>let H := proj_ker (id-p) (Complementary p hyp)</code></p>



<a name="195291206"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Coersion%20and%20composition/near/195291206" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> orlando <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Coersion.20and.20composition.html#195291206">(Apr 25 2020 at 16:10)</a>:</h4>
<p>of course !!!!</p>



<a name="195291207"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Coersion%20and%20composition/near/195291207" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> orlando <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Coersion.20and.20composition.html#195291207">(Apr 25 2020 at 16:10)</a>:</h4>
<p>thx</p>



<a name="195291217"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Coersion%20and%20composition/near/195291217" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Coersion.20and.20composition.html#195291217">(Apr 25 2020 at 16:11)</a>:</h4>
<p>For 2, you can't <code>change m - p m with ...</code> when <code>m</code> is not in scope</p>



<a name="195291232"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Coersion%20and%20composition/near/195291232" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Coersion.20and.20composition.html#195291232">(Apr 25 2020 at 16:11)</a>:</h4>
<p>here, the simplest thing is to notice that you just used <code>exact</code> after <code>change</code> anyways, and almost always that means you can simply delete <code>change</code></p>



<a name="195291271"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Coersion%20and%20composition/near/195291271" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Coersion.20and.20composition.html#195291271">(Apr 25 2020 at 16:12)</a>:</h4>
<p>and then <code>intros m, exact H m</code> can (in this case at least) be simplified to <code>exact H</code></p>



<a name="195291283"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Coersion%20and%20composition/near/195291283" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> orlando <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Coersion.20and.20composition.html#195291283">(Apr 25 2020 at 16:12)</a>:</h4>
<p>I thinck i try but i mistake a <code> (  )  </code> <span aria-label="grinning face with smiling eyes" class="emoji emoji-1f601" role="img" title="grinning face with smiling eyes">:grinning_face_with_smiling_eyes:</span></p>



<a name="195291377"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Coersion%20and%20composition/near/195291377" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Coersion.20and.20composition.html#195291377">(Apr 25 2020 at 16:14)</a>:</h4>
<p>without <code>intro m</code>, you can also write for example <code>change ∀ m, (linear_map.id - p) m ∈ _,</code></p>



<a name="195291483"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Coersion%20and%20composition/near/195291483" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> orlando <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Coersion.20and.20composition.html#195291483">(Apr 25 2020 at 16:17)</a>:</h4>
<p>OK  <span class="user-mention" data-user-id="110032">@Reid Barton</span>  : i understand why <code> intros m, exact H m, </code> work !</p>



<a name="195291549"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Coersion%20and%20composition/near/195291549" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> orlando <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Coersion.20and.20composition.html#195291549">(Apr 25 2020 at 16:19)</a>:</h4>
<p><span class="user-mention" data-user-id="110032">@Reid Barton</span>  : <code> exact H </code> without <code>intro </code> is ok !</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>