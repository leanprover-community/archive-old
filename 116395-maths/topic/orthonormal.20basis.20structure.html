---
layout: archive
title: Zulip Chat Archive
permalink: /stream/116395-maths/topic/orthonormal.20basis.20structure.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/116395-maths/index.html">maths</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/orthonormal.20basis.20structure.html">orthonormal basis structure</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="271836547"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/orthonormal%20basis%20structure/near/271836547" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Daniel Packer <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/orthonormal.20basis.20structure.html#271836547">(Feb 14 2022 at 14:54)</a>:</h4>
<p>Hi all,</p>
<p>At the suggestion/guidance of <span class="user-mention" data-user-id="260507">@Heather Macbeth</span>, <span class="user-mention" data-user-id="459656">@Hans Parshall</span>, <span class="user-mention" data-user-id="450749">@Dustin Mixon</span>, and I are thinking about introducing an <code>orthonormal_basis</code> structure,</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">structure</span> <span class="n">orthonormal_basis</span> <span class="o">:=</span> <span class="n">of_repr</span> <span class="o">::</span> <span class="o">(</span><span class="n">repr</span> <span class="o">:</span> <span class="n">E</span> <span class="bp">≃ₗᵢ</span><span class="o">[</span><span class="bp">𝕜</span><span class="o">]</span> <span class="n">euclidean_space</span> <span class="bp">𝕜</span> <span class="n">ι</span><span class="o">)</span>
</code></pre></div>
<p>Which will be the finite dimensional version of <a href="https://leanprover-community.github.io/mathlib_docs/find/hilbert_basis.has_coe_to_fun">docs#hilbert_basis.has_coe_to_fun</a>. I think we have a basic sense of lemmas that we want to hit, but if you have any thoughts let us know!</p>



<a name="271847463"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/orthonormal%20basis%20structure/near/271847463" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Daniel Packer <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/orthonormal.20basis.20structure.html#271847463">(Feb 14 2022 at 16:02)</a>:</h4>
<p>So, there is already a noncomputable definition of orthonormal_basis at <a href="https://leanprover-community.github.io/mathlib_docs/find/orthonormal_basis">docs#orthonormal_basis</a>. Ultimately it seems like this should get roped into the structure definition above. I'm not quite sure what the standard rules for how to combine these sorts of definitions for compatibility are.<br>
That is, it seems to me that the new output of <a href="https://leanprover-community.github.io/mathlib_docs/find/orthonormal_basis">docs#orthonormal_basis</a> should be:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">def</span> <span class="n">orthonormal_basis</span> <span class="o">(</span><span class="bp">𝕜</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u_1</span><span class="o">)</span> <span class="o">(</span><span class="n">E</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u_2</span><span class="o">)</span> <span class="o">[</span><span class="n">is_R_or_C</span> <span class="bp">𝕜</span><span class="o">]</span> <span class="o">[</span><span class="n">inner_product_space</span> <span class="bp">𝕜</span> <span class="n">E</span><span class="o">]</span> <span class="o">[</span><span class="n">finite_dimensional</span> <span class="bp">𝕜</span> <span class="n">E</span><span class="o">]</span> <span class="o">:</span>
<span class="n">orthonormal_basis</span> <span class="bp">𝕜</span> <span class="n">E</span>
</code></pre></div>
<p>But I don't know if it's my role to refactor a thing like this (to be clear, I'm happy to, I just don't want to mess up some one else's code)</p>



<a name="271847704"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/orthonormal%20basis%20structure/near/271847704" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/orthonormal.20basis.20structure.html#271847704">(Feb 14 2022 at 16:04)</a>:</h4>
<p>That definition is the definition of a particular "standard" orthonormal basis of a given inner product space.  Your definition is more important, so it should get the name.  And we'll rename that definition.</p>



<a name="271847799"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/orthonormal%20basis%20structure/near/271847799" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Daniel Packer <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/orthonormal.20basis.20structure.html#271847799">(Feb 14 2022 at 16:04)</a>:</h4>
<p>Ah, I see. So the definition there should be like <code>std_orthonormal_basis</code>?</p>



<a name="271847836"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/orthonormal%20basis%20structure/near/271847836" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/orthonormal.20basis.20structure.html#271847836">(Feb 14 2022 at 16:05)</a>:</h4>
<p>But your formulation of the type signature for the new output is correct!</p>



<a name="271847924"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/orthonormal%20basis%20structure/near/271847924" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/orthonormal.20basis.20structure.html#271847924">(Feb 14 2022 at 16:05)</a>:</h4>
<p>More generally, I've been thinking for a while that this would be a good change, and I'm very pleased that <span class="user-mention" data-user-id="467358">@Daniel Packer</span> and co will take it on.  There are several parts of the library that could probably be rewritten more elegantly once we have this new structure.  It would supersede <a href="https://leanprover-community.github.io/mathlib_docs/find/basis.isometry_euclidean_of_orthonormal">docs#basis.isometry_euclidean_of_orthonormal</a> , we'd probably rewrite <a href="https://leanprover-community.github.io/mathlib_docs/find/maximal_orthonormal_iff_basis_of_finite_dimensional">docs#maximal_orthonormal_iff_basis_of_finite_dimensional</a> using it ...</p>



<a name="271847967"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/orthonormal%20basis%20structure/near/271847967" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/orthonormal.20basis.20structure.html#271847967">(Feb 14 2022 at 16:06)</a>:</h4>
<p>Probably <a href="https://leanprover-community.github.io/mathlib_docs/find/inner_product_space.is_self_adjoint.diagonalization_basis">docs#inner_product_space.is_self_adjoint.diagonalization_basis</a> would pass through it</p>



<a name="271848077"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/orthonormal%20basis%20structure/near/271848077" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/orthonormal.20basis.20structure.html#271848077">(Feb 14 2022 at 16:06)</a>:</h4>
<p>And maybe <span class="user-mention" data-user-id="266253">@Joseph Myers</span> will have applications for Euclidean geometry.</p>



<a name="271848376"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/orthonormal%20basis%20structure/near/271848376" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/orthonormal.20basis.20structure.html#271848376">(Feb 14 2022 at 16:08)</a>:</h4>
<p>I'd be happy to help out switching all these parts of the library to the new structure ... Maybe the strategy should be: first make the new definition and the "obvious" new lemmas, then we can slowly switch these other parts of the library over, and discover what the other standard lemmas should be in the process of developing these applications.</p>



<a name="271849957"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/orthonormal%20basis%20structure/near/271849957" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/orthonormal.20basis.20structure.html#271849957">(Feb 14 2022 at 16:19)</a>:</h4>
<p>One thought: When we have theories developed in parallel, it's good to have parallel naming.  Here, both <a href="https://leanprover-community.github.io/mathlib_docs/find/hilbert_basis">docs#hilbert_basis</a> and <a href="https://leanprover-community.github.io/mathlib_docs/find/basis">docs#basis</a> are quite parallel, so when there is a lemma that is parallel to lemmas there, the names should also be the same.</p>



<a name="271851782"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/orthonormal%20basis%20structure/near/271851782" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/orthonormal.20basis.20structure.html#271851782">(Feb 14 2022 at 16:32)</a>:</h4>
<p>By the way, if you are curious about this design choice to make the definition of "basis" the strongest possible thing one gets from a basis -- namely the identification with C^n -- you can read some of the history at the PR <a href="https://github.com/leanprover-community/mathlib/pull/7496">#7496</a> and the Zulip discussions linked there.  It was <span class="user-mention" data-user-id="238446">@Anne Baanen</span>'s idea.</p>



<a name="271918580"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/orthonormal%20basis%20structure/near/271918580" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joseph Myers <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/orthonormal.20basis.20structure.html#271918580">(Feb 15 2022 at 02:26)</a>:</h4>
<p>I'd expect the <code>orthonormal_basis</code> API to provide definitions converting to and from a <code>basis</code> that is propositionally <code>orthonormal</code> (with proofs that the basis vectors and coordinates are the same etc.) and analogues of <code>basis</code> APIs such as <code>basis.map</code>, <code>basis.reindex</code>, <code>basis.equiv</code> (<code>orthonormal_basis.map</code> and <code>orthonormal_basis.equiv</code> would of course work with <code>linear_isometry_equiv</code>), with lemmas showing those APIs are consistent with the corresponding APIs for <code>basis</code>. Some other APIs may be needed for particular purposes (e.g. <code>adjust_to_orientation</code>, in order to make <code>orientation.fin_orthonormal_basis</code> give a bundled <code>orthonormal_basis</code>; that may be a case where "convert to <code>basis</code>, apply the <code>basis</code> API and then convert back to <code>orthonormal_basis</code>" is an appropriate implementation strategy).</p>
<p>My current work on oriented angles defines things in terms of a <code>basis</code> that's propositionally <code>orthonormal</code> (and then proves that the definition depends only on the orientation associated with the basis, so that the API can then be replicated with definitions and lemmas that only take an <code>orientation</code> and not a <code>basis</code> as an argument and hopefully most users don't need to refer to bases at all). (That work is <code>sorry</code>-free, but there are still more lemmas I'd like to add before PRing it.) It should be straightforward to adapt to take an <code>orthonormal_basis</code> once such a bundled type is available, with API corresponding to that of <code>basis</code> and existing lemmas about a <code>basis</code> that is <code>orthonormal</code> updated accordingly to use the new type.</p>



<a name="271918913"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/orthonormal%20basis%20structure/near/271918913" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/orthonormal.20basis.20structure.html#271918913">(Feb 15 2022 at 02:32)</a>:</h4>
<p><span class="user-mention silent" data-user-id="266253">Joseph Myers</span> <a href="#narrow/stream/116395-maths/topic/orthonormal.20basis.20structure/near/271918580">said</a>:</p>
<blockquote>
<p>I'd expect the <code>orthonormal_basis</code> API to provide definitions converting to and from a <code>basis</code> that is propositionally <code>orthonormal</code> (with proofs that the basis vectors and coordinates are the same etc.)</p>
</blockquote>
<p>Agreed; I think this should look very similar to <a href="https://leanprover-community.github.io/mathlib_docs/find/hilbert_basis.mk">docs#hilbert_basis.mk</a> together with the associated lemma <a href="https://leanprover-community.github.io/mathlib_docs/find/hilbert_basis.coe_mk">docs#hilbert_basis.coe_mk</a> .</p>



<a name="271919025"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/orthonormal%20basis%20structure/near/271919025" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/orthonormal.20basis.20structure.html#271919025">(Feb 15 2022 at 02:34)</a>:</h4>
<p>Or, perhaps we should have both <code>orthonormal_basis.mk</code>, from</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="o">(</span><span class="n">hv</span> <span class="o">:</span> <span class="n">orthonormal</span> <span class="bp">𝕜</span> <span class="n">v</span><span class="o">)</span> <span class="o">(</span><span class="n">hsp</span> <span class="o">:</span> <span class="n">submodule.span</span> <span class="bp">𝕜</span> <span class="o">(</span><span class="n">set.range</span> <span class="n">v</span><span class="o">)</span><span class="bp">=</span> <span class="bp">⊤</span><span class="o">)</span>
</code></pre></div>
<p>and also <code>basis.to_orthonormal_basis</code> from</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="o">(</span><span class="n">b</span> <span class="o">:</span> <span class="n">basis</span> <span class="n">ι</span> <span class="bp">𝕜</span> <span class="n">E</span><span class="o">)</span> <span class="o">(</span><span class="n">hv</span> <span class="o">:</span> <span class="n">orthonormal</span> <span class="bp">𝕜</span> <span class="n">b</span><span class="o">)</span>
</code></pre></div>



<a name="271998420"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/orthonormal%20basis%20structure/near/271998420" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Daniel Packer <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/orthonormal.20basis.20structure.html#271998420">(Feb 15 2022 at 16:21)</a>:</h4>
<p>Okay, I've got a basic API set up  mirroring some of <a href="https://leanprover-community.github.io/mathlib_docs/find/hilbert_basis">docs#hilbert_basis</a>. We have both</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">protected</span> <span class="kd">def</span> <span class="n">mk</span> <span class="o">(</span><span class="n">hon</span> <span class="o">:</span> <span class="n">orthonormal</span> <span class="bp">𝕜</span> <span class="n">v</span><span class="o">)</span> <span class="o">(</span><span class="n">hsp</span><span class="o">:</span> <span class="n">submodule.span</span> <span class="bp">𝕜</span> <span class="o">(</span><span class="n">set.range</span> <span class="n">v</span><span class="o">)</span> <span class="bp">=</span> <span class="bp">⊤</span><span class="o">):</span>
<span class="n">orthonormal_basis</span> <span class="n">ι</span> <span class="bp">𝕜</span> <span class="n">E</span>
</code></pre></div>
<p>and</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">def</span> <span class="n">_root_.basis.to_orthonormal_basis</span> <span class="o">(</span><span class="n">b</span> <span class="o">:</span> <span class="n">basis</span> <span class="n">ι</span> <span class="bp">𝕜</span> <span class="n">E</span><span class="o">)</span> <span class="o">(</span><span class="n">hb</span> <span class="o">:</span> <span class="n">orthonormal</span> <span class="bp">𝕜</span> <span class="n">b</span><span class="o">)</span> <span class="o">:</span>
<span class="n">orthonormal_basis</span>  <span class="n">ι</span> <span class="bp">𝕜</span> <span class="n">E</span>
</code></pre></div>
<p>There's still more to do, but I wanted to check in that it's generally going in the right direction. Some of the proofs are much longer than they need to be, but I don't think I know the right tricks to get them shorter. I also think I might need permission to the non-master branch--my github is Daniel-Packer.<br>
Currently, the repository is at Daniel-Packer/orthonormal_basis.</p>



<a name="271999320"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/orthonormal%20basis%20structure/near/271999320" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/orthonormal.20basis.20structure.html#271999320">(Feb 15 2022 at 16:28)</a>:</h4>
<p><span class="user-mention" data-user-id="467358">@Daniel Packer</span>  I think you can use <a href="https://leanprover-community.github.io/mathlib_docs/find/set.indicator">docs#set.indicator</a> to define <code>euclidean_space.single</code>, and indeed there are probably some proofs that can be made shorter over the course of the PR process.  Also, can you make an analogue of <a href="https://leanprover-community.github.io/mathlib_docs/find/hilbert_basis.has_sum_repr_symm">docs#hilbert_basis.has_sum_repr_symm</a>, using the finite sum (<a href="https://leanprover-community.github.io/mathlib_docs/find/finset.sum">docs#finset.sum</a>)? But otherwise this looks good to me!  Please go ahead and open a PR (I think the material can be put directly in the file <code>inner_product_space.pi_Lp</code>, and we may find that some of the lemmas there will naturally be deleted.)</p>



<a name="272021447"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/orthonormal%20basis%20structure/near/272021447" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Daniel Packer <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/orthonormal.20basis.20structure.html#272021447">(Feb 15 2022 at 18:59)</a>:</h4>
<p>Okay! Both changes done! I think I might need permission for non-master branches on the mathlib repo, my user id is <code>Daniel-Packer</code></p>



<a name="272023569"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/orthonormal%20basis%20structure/near/272023569" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kyle Miller <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/orthonormal.20basis.20structure.html#272023569">(Feb 15 2022 at 19:13)</a>:</h4>
<p><span class="user-mention" data-user-id="467358">@Daniel Packer</span> Invite sent!</p>



<a name="272040154"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/orthonormal%20basis%20structure/near/272040154" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Daniel Packer <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/orthonormal.20basis.20structure.html#272040154">(Feb 15 2022 at 21:23)</a>:</h4>
<p>Okay, so we now have a branch at :<br>
<a href="https://github.com/leanprover-community/mathlib/tree/orthonormal_basis">https://github.com/leanprover-community/mathlib/tree/orthonormal_basis</a><br>
I think there are some linting issues, and when building, it introduces some error in orientation world, so I haven't opened a pull request yet.<br>
That said, I've opened up a draft pull request here:<br>
<a href="https://github.com/leanprover-community/mathlib/pull/12060">https://github.com/leanprover-community/mathlib/pull/12060</a></p>



<a name="272083553"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/orthonormal%20basis%20structure/near/272083553" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/orthonormal.20basis.20structure.html#272083553">(Feb 16 2022 at 08:00)</a>:</h4>
<p>I would love to hear more people talking about the various worlds we have in mathlib :-)</p>



<a name="272169814"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/orthonormal%20basis%20structure/near/272169814" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Daniel Packer <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/orthonormal.20basis.20structure.html#272169814">(Feb 16 2022 at 19:55)</a>:</h4>
<p>Okeedokes! I think that the <code>orthonormal_basis</code> refactor is ready for review for merging. It has passed the checks, it seems.</p>



<a name="272619675"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/orthonormal%20basis%20structure/near/272619675" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Daniel Packer <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/orthonormal.20basis.20structure.html#272619675">(Feb 20 2022 at 22:02)</a>:</h4>
<p>Okay! Now that we have the updated <code>orthonormal_basis</code> structure, I'm going to go through <code>projection.lean</code> and <code>spectrum.lean</code> to refactor appropriately. I'm going to be starting with the section <code>orthonormal_basis</code> in <code>projection.lean</code> (which we might incidentally want to rename?). Let me know if you have strong opinions on how it refactors.<br>
My main goal is get <code>std_orthonormal_basis</code> to be of type <code>orthonormal_basis</code>, and to have <code>self_adjoint.eigenvector_basis</code> to be of type <code>orthonormal_basis</code> as well.</p>



<a name="272620024"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/orthonormal%20basis%20structure/near/272620024" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/orthonormal.20basis.20structure.html#272620024">(Feb 20 2022 at 22:08)</a>:</h4>
<p><span class="user-mention" data-user-id="467358">@Daniel Packer</span>  Oh, snap!  I was doing this too.  I haven't made too much progress but I'll push what I have.</p>



<a name="272620060"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/orthonormal%20basis%20structure/near/272620060" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/orthonormal.20basis.20structure.html#272620060">(Feb 20 2022 at 22:09)</a>:</h4>
<p><span class="user-mention silent" data-user-id="467358">Daniel Packer</span> <a href="#narrow/stream/116395-maths/topic/orthonormal.20basis.20structure/near/272619675">said</a>:</p>
<blockquote>
<p>I'm going to be starting with the section <code>orthonormal_basis</code> in <code>projection.lean</code> (which we might incidentally want to rename?). <br>
My main goal is get <code>std_orthonormal_basis</code> to be of type <code>orthonormal_basis</code>, and to have <code>self_adjoint.eigenvector_basis</code> to be of type <code>orthonormal_basis</code> as well.</p>
</blockquote>
<p>Yes, I had the same idea.  And that stuff should, therefore, move from <code>projection</code> to <code>pi_L2</code>.</p>



<a name="272620265"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/orthonormal%20basis%20structure/near/272620265" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/orthonormal.20basis.20structure.html#272620265">(Feb 20 2022 at 22:13)</a>:</h4>
<p><a href="https://github.com/leanprover-community/mathlib/tree/std_orthonormal_basis">branch#std_orthonormal_basis</a> (about half-debugged)</p>



<a name="272620368"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/orthonormal%20basis%20structure/near/272620368" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Daniel Packer <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/orthonormal.20basis.20structure.html#272620368">(Feb 20 2022 at 22:15)</a>:</h4>
<p><span class="user-mention" data-user-id="260507">@Heather Macbeth</span>  No worries! Do you plan on working on it today? Because I'm happy to stay away from it for now if so--long term I just want <code>self_adjoint.eigenvector_basis</code> to be an <code>orthonormal_basis</code> for my own selfish purposes.<br>
If you aren't planning on working on it today, I can try to make some progress and you can take over from wherever I leave off.</p>



<a name="272620429"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/orthonormal%20basis%20structure/near/272620429" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/orthonormal.20basis.20structure.html#272620429">(Feb 20 2022 at 22:16)</a>:</h4>
<p>Sounds great, I should really do some other things :). I'll leave the branch for you now, keep me posted!</p>



<a name="272620440"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/orthonormal%20basis%20structure/near/272620440" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Daniel Packer <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/orthonormal.20basis.20structure.html#272620440">(Feb 20 2022 at 22:16)</a>:</h4>
<p>Will do!</p>



<a name="272621521"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/orthonormal%20basis%20structure/near/272621521" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Daniel Packer <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/orthonormal.20basis.20structure.html#272621521">(Feb 20 2022 at 22:38)</a>:</h4>
<p>The first thing I've been trying to do is build a version of dos#basis.reindex for <code>orthonormal_basis</code>. It seems like the way to do that is to make a version of <a href="https://leanprover-community.github.io/mathlib_docs/find/finsupp.dom_lcongr">docs#finsupp.dom_lcongr</a> with <code>linear_isometry_equiv</code> instead. Where should such a definition go?</p>



<a name="272621633"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/orthonormal%20basis%20structure/near/272621633" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/orthonormal.20basis.20structure.html#272621633">(Feb 20 2022 at 22:41)</a>:</h4>
<p>I think in <code>pi_L2</code>, too.</p>



<a name="272621706"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/orthonormal%20basis%20structure/near/272621706" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/orthonormal.20basis.20structure.html#272621706">(Feb 20 2022 at 22:42)</a>:</h4>
<p>Or, no, sorry, in <code>normed_space.pi_Lp</code>.</p>



<a name="272621781"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/orthonormal%20basis%20structure/near/272621781" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Daniel Packer <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/orthonormal.20basis.20structure.html#272621781">(Feb 20 2022 at 22:44)</a>:</h4>
<p>Ah, you're totally right! Thanks!</p>



<a name="272711524"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/orthonormal%20basis%20structure/near/272711524" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Daniel Packer <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/orthonormal.20basis.20structure.html#272711524">(Feb 21 2022 at 16:43)</a>:</h4>
<p>I think I might be misunderstanding things, but if I want to put <code>finsupp.dom_licongr</code> in <code>normed_space.pi_Lp</code>, then I think I will have to add an import in that file for <code>euclidean_space</code> to work (which feels wrong to me). Should <code>euclidean_space</code> be living in <code>normed_space.pi_Lp</code>?</p>



<a name="272711651"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/orthonormal%20basis%20structure/near/272711651" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Daniel Packer <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/orthonormal.20basis.20structure.html#272711651">(Feb 21 2022 at 16:44)</a>:</h4>
<p>Currently, I'm working with:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">variables</span> <span class="o">[</span><span class="n">fintype</span> <span class="n">ι'</span><span class="o">]</span>
<span class="kd">def</span> <span class="n">_root_.finsupp.dom_licongr</span> <span class="o">(</span><span class="n">e</span> <span class="o">:</span> <span class="n">ι</span> <span class="bp">≃</span> <span class="n">ι'</span><span class="o">)</span> <span class="o">:</span> <span class="n">euclidean_space</span> <span class="bp">𝕜</span> <span class="n">ι</span> <span class="bp">≃ₗᵢ</span><span class="o">[</span><span class="bp">𝕜</span><span class="o">]</span> <span class="n">euclidean_space</span> <span class="bp">𝕜</span> <span class="n">ι'</span> <span class="o">:=</span>
</code></pre></div>



<a name="272712223"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/orthonormal%20basis%20structure/near/272712223" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Daniel Packer <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/orthonormal.20basis.20structure.html#272712223">(Feb 21 2022 at 16:49)</a>:</h4>
<p>Separately, this definition seems silly to have around now that we have the <code>orthonormal_basis</code> structure:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">def</span> <span class="n">linear_isometry_equiv.of_inner_product_space</span>
  <span class="o">[</span><span class="n">finite_dimensional</span> <span class="bp">𝕜</span> <span class="n">E</span><span class="o">]</span> <span class="o">{</span><span class="n">n</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">}</span> <span class="o">(</span><span class="n">hn</span> <span class="o">:</span> <span class="n">finrank</span> <span class="bp">𝕜</span> <span class="n">E</span> <span class="bp">=</span> <span class="n">n</span><span class="o">)</span> <span class="o">:</span>
  <span class="n">E</span> <span class="bp">≃ₗᵢ</span><span class="o">[</span><span class="bp">𝕜</span><span class="o">]</span> <span class="o">(</span><span class="n">euclidean_space</span> <span class="bp">𝕜</span> <span class="o">(</span><span class="n">fin</span> <span class="n">n</span><span class="o">))</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">fin_std_orthonormal_basis</span> <span class="n">hn</span><span class="o">)</span><span class="bp">.</span><span class="n">repr</span>
</code></pre></div>



<a name="272714778"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/orthonormal%20basis%20structure/near/272714778" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/orthonormal.20basis.20structure.html#272714778">(Feb 21 2022 at 17:12)</a>:</h4>
<p><span class="user-mention" data-user-id="467358">@Daniel Packer</span> I was thinking more like</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">variables</span> <span class="o">[</span><span class="n">fintype</span> <span class="n">ι'</span><span class="o">]</span> <span class="o">{</span><span class="n">E</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">normed_group</span> <span class="n">E</span><span class="o">]</span> <span class="o">[</span><span class="n">normed_space</span> <span class="bp">𝕜</span> <span class="n">E</span><span class="o">]</span>
<span class="kd">def</span> <span class="n">pi_Lp.dom_licongr</span> <span class="o">(</span><span class="n">e</span> <span class="o">:</span> <span class="n">ι</span> <span class="bp">≃</span> <span class="n">ι'</span><span class="o">)</span> <span class="o">:</span> <span class="n">pi_Lp</span> <span class="bp">𝕜</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">i</span> <span class="o">:</span> <span class="n">ι</span><span class="o">,</span> <span class="n">E</span><span class="o">)</span> <span class="n">p</span> <span class="bp">≃ₗᵢ</span><span class="o">[</span><span class="bp">𝕜</span><span class="o">]</span> <span class="n">pi_Lp</span> <span class="bp">𝕜</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">i</span> <span class="o">:</span> <span class="n">ι</span><span class="o">,</span> <span class="n">E</span><span class="o">)</span> <span class="n">p</span> <span class="o">:=</span>
</code></pre></div>



<a name="272715329"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/orthonormal%20basis%20structure/near/272715329" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/orthonormal.20basis.20structure.html#272715329">(Feb 21 2022 at 17:17)</a>:</h4>
<p><span class="user-mention silent" data-user-id="467358">Daniel Packer</span> <a href="#narrow/stream/116395-maths/topic/orthonormal.20basis.20structure/near/272712223">said</a>:</p>
<blockquote>
<p>Separately, this definition seems silly to have around now that we have the <code>orthonormal_basis</code> structure:</p>
<p><div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">def</span> <span class="n">linear_isometry_equiv.of_inner_product_space</span>
  <span class="o">[</span><span class="n">finite_dimensional</span> <span class="bp">𝕜</span> <span class="n">E</span><span class="o">]</span> <span class="o">{</span><span class="n">n</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">}</span> <span class="o">(</span><span class="n">hn</span> <span class="o">:</span> <span class="n">finrank</span> <span class="bp">𝕜</span> <span class="n">E</span> <span class="bp">=</span> <span class="n">n</span><span class="o">)</span> <span class="o">:</span>
  <span class="n">E</span> <span class="bp">≃ₗᵢ</span><span class="o">[</span><span class="bp">𝕜</span><span class="o">]</span> <span class="o">(</span><span class="n">euclidean_space</span> <span class="bp">𝕜</span> <span class="o">(</span><span class="n">fin</span> <span class="n">n</span><span class="o">))</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">fin_std_orthonormal_basis</span> <span class="n">hn</span><span class="o">)</span><span class="bp">.</span><span class="n">repr</span>
</code></pre></div><br>
</p>
</blockquote>
<p>Agreed!  Let's delete it.</p>



<a name="272741340"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/orthonormal%20basis%20structure/near/272741340" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Daniel Packer <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/orthonormal.20basis.20structure.html#272741340">(Feb 21 2022 at 22:37)</a>:</h4>
<p><span class="user-mention" data-user-id="260507">@Heather Macbeth</span> I've pushed where I'm at rn. I think my proof of <code>finsupp.dom_licongr</code> is far too long. <br>
I'm also unsure how to mess  with</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">lemma</span> <span class="n">maximal_orthonormal_iff_basis_of_finite_dimensional</span>
<span class="o">(</span><span class="n">hv</span> <span class="o">:</span> <span class="n">orthonormal</span> <span class="bp">𝕜</span> <span class="o">(</span><span class="n">coe</span> <span class="o">:</span> <span class="n">v</span> <span class="bp">→</span> <span class="n">E</span><span class="o">))</span> <span class="o">:</span>
</code></pre></div>
<p>which you had commented out, as well as how the following discussion ought to go.</p>



<a name="272741409"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/orthonormal%20basis%20structure/near/272741409" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Daniel Packer <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/orthonormal.20basis.20structure.html#272741409">(Feb 21 2022 at 22:38)</a>:</h4>
<p>For instance, I had:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">@[irreducible]</span> <span class="kd">def</span> <span class="n">direct_sum.submodule_is_internal.subordinate_orthonormal_basis</span> <span class="o">:</span>
  <span class="n">orthonormal_basis</span> <span class="o">(</span><span class="n">fin</span> <span class="n">n</span><span class="o">)</span> <span class="bp">𝕜</span> <span class="n">E</span> <span class="o">:=</span>
</code></pre></div>



<a name="272741453"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/orthonormal%20basis%20structure/near/272741453" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Daniel Packer <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/orthonormal.20basis.20structure.html#272741453">(Feb 21 2022 at 22:39)</a>:</h4>
<p>Which I tried to combine with the later <code>subordinate_orthonormal_basis_orthonormal</code>, which added this hypothesis:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">@[irreducible]</span> <span class="kd">def</span> <span class="n">direct_sum.submodule_is_internal.subordinate_orthonormal_basis</span>
  <span class="o">(</span><span class="n">hV'</span> <span class="o">:</span> <span class="bp">@</span><span class="n">orthogonal_family</span> <span class="bp">𝕜</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">i</span><span class="o">,</span> <span class="n">V</span> <span class="n">i</span><span class="o">)</span> <span class="n">_</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">i</span><span class="o">,</span> <span class="o">(</span><span class="n">V</span> <span class="n">i</span><span class="o">)</span><span class="bp">.</span><span class="n">subtypeₗ</span><span class="bp">ᵢ</span><span class="o">))</span> <span class="o">:</span>
  <span class="n">orthonormal_basis</span> <span class="o">(</span><span class="n">fin</span> <span class="n">n</span><span class="o">)</span> <span class="bp">𝕜</span> <span class="n">E</span> <span class="o">:=</span>
</code></pre></div>



<a name="272741620"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/orthonormal%20basis%20structure/near/272741620" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Daniel Packer <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/orthonormal.20basis.20structure.html#272741620">(Feb 21 2022 at 22:41)</a>:</h4>
<p>But this created errors later on, and I suspect it will mess up stuff in other parts of mathlib, so I think I would like to get others' (i.e. your) opinions before I push any changes to this.</p>



<a name="272741872"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/orthonormal%20basis%20structure/near/272741872" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/orthonormal.20basis.20structure.html#272741872">(Feb 21 2022 at 22:45)</a>:</h4>
<p><span class="user-mention" data-user-id="467358">@Daniel Packer</span> Quick comment -- I think it would be faster to prove <code>finsupp.dom_licongr</code> without passing through finitely-supported functions -- that's a complication you don't need when the index set itself is finite.  I think <a href="https://leanprover-community.github.io/mathlib_docs/find/linear_equiv.Pi_congr_right">docs#linear_equiv.Pi_congr_right</a>  will be a better "basic model" for a linear-equiv-to-upgrade-to-linear-isometry-equiv than <a href="https://leanprover-community.github.io/mathlib_docs/find/finsupp.dom_lcongr">docs#finsupp.dom_lcongr</a></p>



<a name="272742037"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/orthonormal%20basis%20structure/near/272742037" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/orthonormal.20basis.20structure.html#272742037">(Feb 21 2022 at 22:48)</a>:</h4>
<p><code>maximal_orthonormal_iff_basis_of_finite_dimensional</code> can hopefully be deleted, I just commented it out in case we needed to raid its proof for some argument.</p>



<a name="272742338"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/orthonormal%20basis%20structure/near/272742338" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/orthonormal.20basis.20structure.html#272742338">(Feb 21 2022 at 22:52)</a>:</h4>
<p>And to deal with the awkwardness about <code>subordinate_orthonormal_basis</code>, I think you should define an analogue of the construction <a href="https://leanprover-community.github.io/mathlib_docs/find/direct_sum.submodule_is_internal.collected_basis">docs#direct_sum.submodule_is_internal.collected_basis</a> called something like</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">direct_sum.submodule_is_internal.collected_orthonormal_basis</span>
</code></pre></div>



<a name="272742426"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/orthonormal%20basis%20structure/near/272742426" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/orthonormal.20basis.20structure.html#272742426">(Feb 21 2022 at 22:54)</a>:</h4>
<p>(refer to <a href="https://leanprover-community.github.io/mathlib_docs/find/direct_sum.submodule_is_internal.collected_basis_orthonormal">docs#direct_sum.submodule_is_internal.collected_basis_orthonormal</a> for some of the work involved in that construction)</p>



<a name="272808724"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/orthonormal%20basis%20structure/near/272808724" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Daniel Packer <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/orthonormal.20basis.20structure.html#272808724">(Feb 22 2022 at 14:20)</a>:</h4>
<p><span class="user-mention" data-user-id="260507">@Heather Macbeth</span> For the <code>finsupp.dom_licongr</code> did you mean <a href="https://leanprover-community.github.io/mathlib_docs/find/linear_equiv.Pi_congr_left">docs#linear_equiv.Pi_congr_left</a> ? I'm not sure I understand how <a href="https://leanprover-community.github.io/mathlib_docs/find/linear_equiv.Pi_congr_right">docs#linear_equiv.Pi_congr_right</a> will help. (Separately, what does the naming convention refer to?)</p>



<a name="272808875"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/orthonormal%20basis%20structure/near/272808875" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/orthonormal.20basis.20structure.html#272808875">(Feb 22 2022 at 14:21)</a>:</h4>
<p>Yes, sorry!  I have no idea what the names refer to :)</p>



<a name="272809027"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/orthonormal%20basis%20structure/near/272809027" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/orthonormal.20basis.20structure.html#272809027">(Feb 22 2022 at 14:22)</a>:</h4>
<p>Git blame says <span class="user-mention" data-user-id="310045">@Eric Wieser</span> baptised them.</p>



<a name="272809495"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/orthonormal%20basis%20structure/near/272809495" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/orthonormal.20basis.20structure.html#272809495">(Feb 22 2022 at 14:26)</a>:</h4>
<p>I think I just copied <a href="https://leanprover-community.github.io/mathlib_docs/find/equiv.Pi_congr_left">docs#equiv.Pi_congr_left</a></p>



<a name="272809559"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/orthonormal%20basis%20structure/near/272809559" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/orthonormal.20basis.20structure.html#272809559">(Feb 22 2022 at 14:26)</a>:</h4>
<p>The left vs right naming corresponds to the domain vs codomain of the pi type</p>



<a name="272809628"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/orthonormal%20basis%20structure/near/272809628" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/orthonormal.20basis.20structure.html#272809628">(Feb 22 2022 at 14:27)</a>:</h4>
<p><code>dom</code> and <code>cod</code> would probably be more sensible names</p>



<a name="272812842"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/orthonormal%20basis%20structure/near/272812842" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Daniel Packer <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/orthonormal.20basis.20structure.html#272812842">(Feb 22 2022 at 14:50)</a>:</h4>
<p>So should I be calling the lemma <code>linear_isometry_equiv.Pi_congr_dom</code> instead?</p>



<a name="272815337"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/orthonormal%20basis%20structure/near/272815337" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/orthonormal.20basis.20structure.html#272815337">(Feb 22 2022 at 15:07)</a>:</h4>
<p>No, you should stick to <code>Pi_congr_left</code> and <code>Pi_congr_right</code>, unless you first want to make a PR to rename all the existing <code>_left</code> / <code>_right</code>s to <code>_dom</code> / <code>_cod</code>.</p>



<a name="272877716"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/orthonormal%20basis%20structure/near/272877716" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Daniel Packer <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/orthonormal.20basis.20structure.html#272877716">(Feb 22 2022 at 22:48)</a>:</h4>
<p>I'm going to put this question here, but feel free to move it if it deserves its own thread.<br>
I've been trying to port the lemmas about <a href="https://leanprover-community.github.io/mathlib_docs/find/basis.reindex">docs#basis.reindex</a> to <a href="https://leanprover-community.github.io/mathlib_docs/find/orthonormal_basis">docs#orthonormal_basis</a>, and one of these is <a href="https://leanprover-community.github.io/mathlib_docs/find/basis.coe_reindex_repr">docs#basis.coe_reindex_repr</a>, which looks like: <code>((b.reindex e).repr x : ι' → R) = b.repr x ∘ e.symm</code>.<br>
I've tried to port this over as:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">protected</span> <span class="kd">lemma</span> <span class="n">coe_reindex_repr</span>
  <span class="o">(</span><span class="n">b</span> <span class="o">:</span> <span class="n">orthonormal_basis</span> <span class="n">ι</span> <span class="bp">𝕜</span> <span class="n">E</span><span class="o">)</span> <span class="o">(</span><span class="n">e</span> <span class="o">:</span> <span class="n">ι</span> <span class="bp">≃</span> <span class="n">ι'</span><span class="o">)</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="n">E</span><span class="o">)</span> <span class="o">(</span><span class="n">i'</span> <span class="o">:</span> <span class="n">ι'</span><span class="o">)</span> <span class="o">:</span>
  <span class="o">((</span><span class="n">b.reindex</span> <span class="n">e</span><span class="o">)</span><span class="bp">.</span><span class="n">repr</span> <span class="n">x</span><span class="o">)</span> <span class="bp">=</span> <span class="o">(</span><span class="n">id</span><span class="o">(</span><span class="n">b.repr</span> <span class="n">x</span><span class="o">)</span> <span class="o">:</span> <span class="n">ι</span> <span class="bp">→</span> <span class="bp">𝕜</span><span class="o">)</span> <span class="bp">∘</span> <span class="o">(</span><span class="n">e.symm</span><span class="o">)</span> <span class="o">:=</span>
</code></pre></div>
<p>but this requires an <code>id</code> (or perhaps something else) to make it run through, which tells Lean that this can't be a simplification lemma.<br>
I have a few associated questions:</p>
<ul>
<li>Should I even be bothering to formalize this lemma?</li>
<li>Why does this <code>id</code> prevent this from being a simplification lemma?</li>
<li>Why doesn't <code>euclidean_space ι 𝕜</code> have an instance of <code>has_coe_to_fun : ι → 𝕜</code>?</li>
</ul>



<a name="272879617"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/orthonormal%20basis%20structure/near/272879617" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/orthonormal.20basis.20structure.html#272879617">(Feb 22 2022 at 23:06)</a>:</h4>
<p>All very interesting questions!  I'd go for avoiding the issue by temporarily answering no to</p>
<p><span class="user-mention silent" data-user-id="467358">Daniel Packer</span> <a href="#narrow/stream/116395-maths/topic/orthonormal.20basis.20structure/near/272877716">said</a>:</p>
<blockquote>
<ul>
<li>Should I even be bothering to formalize this lemma?</li>
</ul>
</blockquote>
<p>but maybe someone will come along with a more principled answer :)</p>



<a name="272879694"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/orthonormal%20basis%20structure/near/272879694" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/orthonormal.20basis.20structure.html#272879694">(Feb 22 2022 at 23:07)</a>:</h4>
<p>If you gave us a <a href="https://leanprover-community.github.io/mwe.html">#mwe</a> I could investigate further but I don't see why</p>
<ul>
<li>you need the <code>id</code> (maybe you just need a coercion arrow <code>↑</code>?)</li>
<li>the <code>id</code> would matter for simp normal form as it's on the RHS</li>
</ul>



<a name="272879716"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/orthonormal%20basis%20structure/near/272879716" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/orthonormal.20basis.20structure.html#272879716">(Feb 22 2022 at 23:07)</a>:</h4>
<p><span class="user-mention" data-user-id="387244">@Yaël Dillies</span> the <code>id</code> is because <code>euclidean_space</code> is a type synonym.</p>



<a name="272879830"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/orthonormal%20basis%20structure/near/272879830" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/orthonormal.20basis.20structure.html#272879830">(Feb 22 2022 at 23:09)</a>:</h4>
<p>Ahah, so you're saying you're missing the "identity" equivalence between <code>euclidean_space</code> and <code>ι → 𝕜</code>? Definitely add that, in the spirit of <a href="https://leanprover-community.github.io/mathlib_docs/find/order_dual.to_dual">docs#order_dual.to_dual</a> and <a href="https://leanprover-community.github.io/mathlib_docs/find/of_lex">docs#of_lex</a>.</p>



<a name="272879874"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/orthonormal%20basis%20structure/near/272879874" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/orthonormal.20basis.20structure.html#272879874">(Feb 22 2022 at 23:09)</a>:</h4>
<p>Well, I think that's somewhat of an orthogonal (ha!) project to Daniel's.</p>



<a name="272879941"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/orthonormal%20basis%20structure/near/272879941" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/orthonormal.20basis.20structure.html#272879941">(Feb 22 2022 at 23:10)</a>:</h4>
<p>And also might not be necessarily once we find the Platonic ideal of how to represent Euclidean space ... therefore fine to punt on.</p>



<a name="272879972"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/orthonormal%20basis%20structure/near/272879972" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/orthonormal.20basis.20structure.html#272879972">(Feb 22 2022 at 23:10)</a>:</h4>
<p>Sure, but it seems related to Daniel's current problem and is also very cheap to have.</p>



<a name="272880245"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/orthonormal%20basis%20structure/near/272880245" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/orthonormal.20basis.20structure.html#272880245">(Feb 22 2022 at 23:14)</a>:</h4>
<p>I <a href="#narrow/stream/116395-maths/topic/SVD">still advocate</a> for trying other approaches to the issue, so I'd rather not (yet) add a lot of boilerplate to double down on the type synonym method.</p>



<a name="272880302"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/orthonormal%20basis%20structure/near/272880302" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/orthonormal.20basis.20structure.html#272880302">(Feb 22 2022 at 23:15)</a>:</h4>
<p><span class="user-mention" data-user-id="467358">@Daniel Packer</span> Do you need this lemma?</p>



<a name="272880312"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/orthonormal%20basis%20structure/near/272880312" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/orthonormal.20basis.20structure.html#272880312">(Feb 22 2022 at 23:15)</a>:</h4>
<p>Heather, two definitions is not a lot of boilerplate <span aria-label="stuck out tongue wink" class="emoji emoji-1f61c" role="img" title="stuck out tongue wink">:stuck_out_tongue_wink:</span></p>



<a name="272880349"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/orthonormal%20basis%20structure/near/272880349" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/orthonormal.20basis.20structure.html#272880349">(Feb 22 2022 at 23:16)</a>:</h4>
<p>That's all you need to make your translations from and to <code>euclidean_space</code> type-correct.</p>



<a name="272880891"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/orthonormal%20basis%20structure/near/272880891" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/orthonormal.20basis.20structure.html#272880891">(Feb 22 2022 at 23:22)</a>:</h4>
<p>One thing I didn't add in the thread you just linked to is that you don't need to insert those identity equivalences when writing non public-facing API. See for example <a href="https://leanprover-community.github.io/mathlib_docs/find/order_iso.dual_dual">docs#order_iso.dual_dual</a>, which I literally just defined as <a href="https://leanprover-community.github.io/mathlib_docs/find/order_iso.refl">docs#order_iso.refl</a> but without the <code>@[simps]</code> so that I get to write <a href="https://leanprover-community.github.io/mathlib_docs/find/order_iso.coe_dual_dual">docs#order_iso.coe_dual_dual</a> and friends myself in the correct form.</p>



<a name="272880941"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/orthonormal%20basis%20structure/near/272880941" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Daniel Packer <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/orthonormal.20basis.20structure.html#272880941">(Feb 22 2022 at 23:22)</a>:</h4>
<p><span class="user-mention silent" data-user-id="260507">Heather Macbeth</span> <a href="#narrow/stream/116395-maths/topic/orthonormal.20basis.20structure/near/272880302">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="467358">Daniel Packer</span> Do you need this lemma?</p>
</blockquote>
<p>I don't need this lemma at all. I just didn't want to build half of an API. I'm also happy to add this change in, but I'm not quite sure what it looks like. Specifically, what sort of equivalence do we think it should be?</p>



<a name="272881184"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/orthonormal%20basis%20structure/near/272881184" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/orthonormal.20basis.20structure.html#272881184">(Feb 22 2022 at 23:26)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">def</span> <span class="n">to_euclidean_space</span> <span class="o">:</span> <span class="o">(</span><span class="n">ι</span> <span class="bp">→</span> <span class="bp">𝕜</span><span class="o">)</span> <span class="bp">≃</span> <span class="n">euclidean_space</span> <span class="bp">𝕜</span> <span class="n">ι</span> <span class="o">:=</span> <span class="n">equiv.refl</span> <span class="n">_</span>
<span class="kd">def</span> <span class="n">of_euclidean_space</span> <span class="o">:</span> <span class="n">euclidean_space</span> <span class="bp">𝕜</span> <span class="n">ι</span> <span class="bp">≃</span> <span class="o">(</span><span class="n">ι</span> <span class="bp">→</span> <span class="bp">𝕜</span><span class="o">)</span> <span class="o">:=</span> <span class="n">equiv.refl</span> <span class="n">_</span>
</code></pre></div>
<p>Note the absence of the <code>simps</code> attribute.</p>



<a name="272881405"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/orthonormal%20basis%20structure/near/272881405" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/orthonormal.20basis.20structure.html#272881405">(Feb 22 2022 at 23:28)</a>:</h4>
<p><span class="user-mention silent" data-user-id="467358">Daniel Packer</span> <a href="#narrow/stream/116395-maths/topic/orthonormal.20basis.20structure/near/272880941">said</a>:</p>
<blockquote>
<p>I don't need this lemma at all. I just didn't want to build half of an API. </p>
</blockquote>
<p>I'd suggest adding the following equivalent lemma, which feels more "native" to Euclidean space.</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">protected</span> <span class="kd">lemma</span> <span class="n">reindex_repr_apply</span>
  <span class="o">(</span><span class="n">b</span> <span class="o">:</span> <span class="n">orthonormal_basis</span> <span class="n">ι</span> <span class="bp">𝕜</span> <span class="n">E</span><span class="o">)</span> <span class="o">(</span><span class="n">e</span> <span class="o">:</span> <span class="n">ι</span> <span class="bp">≃</span> <span class="n">ι'</span><span class="o">)</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="n">E</span><span class="o">)</span> <span class="o">(</span><span class="n">i'</span> <span class="o">:</span> <span class="n">ι'</span><span class="o">)</span> <span class="o">:</span>
  <span class="o">(</span><span class="n">b.reindex</span> <span class="n">e</span><span class="o">)</span><span class="bp">.</span><span class="n">repr</span> <span class="n">x</span> <span class="n">i'</span> <span class="bp">=</span> <span class="n">b.repr</span> <span class="n">x</span> <span class="o">(</span><span class="n">e.symm</span> <span class="n">i'</span><span class="o">)</span> <span class="o">:=</span>
</code></pre></div>



<a name="272881681"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/orthonormal%20basis%20structure/near/272881681" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Daniel Packer <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/orthonormal.20basis.20structure.html#272881681">(Feb 22 2022 at 23:31)</a>:</h4>
<p><span class="user-mention silent" data-user-id="260507">Heather Macbeth</span> <a href="#narrow/stream/116395-maths/topic/orthonormal.20basis.20structure/near/272881405">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="467358">Daniel Packer</span> <a href="#narrow/stream/116395-maths/topic/orthonormal.20basis.20structure/near/272880941">said</a>:</p>
<blockquote>
<p>I don't need this lemma at all. I just didn't want to build half of an API. </p>
</blockquote>
<p>I'd suggest adding the following equivalent lemma, which feels more "native" to Euclidean space.</p>
<p><div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">protected</span> <span class="kd">lemma</span> <span class="n">reindex_repr_apply</span>
  <span class="o">(</span><span class="n">b</span> <span class="o">:</span> <span class="n">orthonormal_basis</span> <span class="n">ι</span> <span class="bp">𝕜</span> <span class="n">E</span><span class="o">)</span> <span class="o">(</span><span class="n">e</span> <span class="o">:</span> <span class="n">ι</span> <span class="bp">≃</span> <span class="n">ι'</span><span class="o">)</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="n">E</span><span class="o">)</span> <span class="o">(</span><span class="n">i'</span> <span class="o">:</span> <span class="n">ι'</span><span class="o">)</span> <span class="o">:</span>
  <span class="o">(</span><span class="n">b.reindex</span> <span class="n">e</span><span class="o">)</span><span class="bp">.</span><span class="n">repr</span> <span class="n">x</span> <span class="n">i'</span> <span class="bp">=</span> <span class="n">b.repr</span> <span class="n">x</span> <span class="o">(</span><span class="n">e.symm</span> <span class="n">i'</span><span class="o">)</span> <span class="o">:=</span>
</code></pre></div><br>
</p>
</blockquote>
<p>Ah nice! In fact, that is the lemma that I did add after coming across the struggles with the other form. (Although I titled it <code>reindex_repr</code> to follow the convention of <a href="https://leanprover-community.github.io/mathlib_docs/find/basis.reindex_repr">docs#basis.reindex_repr</a>).</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>