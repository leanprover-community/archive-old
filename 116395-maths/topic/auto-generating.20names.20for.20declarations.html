---
layout: archive
title: Zulip Chat Archive
permalink: /stream/116395-maths/topic/auto-generating.20names.20for.20declarations.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/116395-maths/index.html">maths</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/auto-generating.20names.20for.20declarations.html">auto-generating names for declarations</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="202185225"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/auto-generating%20names%20for%20declarations/near/202185225" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/auto-generating.20names.20for.20declarations.html#202185225">(Jun 27 2020 at 13:05)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110596">Rob Lewis</span> <a href="#narrow/stream/116395-maths/topic/Cayley-Hamilton/near/202184921">said</a>:</p>
<blockquote>
<blockquote>
<p>What we really need is a linter that automatically flags if a name is wrong, and suggests to replace it with a proper one...</p>
</blockquote>
<p><a href="https://arxiv.org/abs/2004.07761">https://arxiv.org/abs/2004.07761</a></p>
</blockquote>
<p>Interesting!</p>



<a name="202185309"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/auto-generating%20names%20for%20declarations/near/202185309" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/auto-generating.20names.20for.20declarations.html#202185309">(Jun 27 2020 at 13:07)</a>:</h4>
<p>It would be really nice if we had this for Lean.</p>



<a name="202185312"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/auto-generating%20names%20for%20declarations/near/202185312" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/auto-generating.20names.20for.20declarations.html#202185312">(Jun 27 2020 at 13:07)</a>:</h4>
<p>We could maybe even run it on Azure...</p>



<a name="202185316"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/auto-generating%20names%20for%20declarations/near/202185316" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/auto-generating.20names.20for.20declarations.html#202185316">(Jun 27 2020 at 13:07)</a>:</h4>
<p>And have it auto-fix our library for us</p>



<a name="202185322"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/auto-generating%20names%20for%20declarations/near/202185322" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/auto-generating.20names.20for.20declarations.html#202185322">(Jun 27 2020 at 13:07)</a>:</h4>
<p>But I have no idea about whether this stuff lives up to its promise.</p>



<a name="202185694"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/auto-generating%20names%20for%20declarations/near/202185694" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/auto-generating.20names.20for.20declarations.html#202185694">(Jun 27 2020 at 13:16)</a>:</h4>
<p><span class="user-mention silent" data-user-id="112680">Johan Commelin</span> <a href="#narrow/stream/116395-maths/topic/auto-generating.20names.20for.20declarations/near/202185322">said</a>:</p>
<blockquote>
<p>But I have no idea about whether this stuff lives up to its promise.</p>
</blockquote>
<p>I can only speculate. The challenge adapting this to Lean 3 would be accessing what they call "syntax trees," the input-level pre-expressions. Otherwise I think it's just a matter of hooking things together. Maybe a version would work without the syntax trees. They write</p>
<blockquote>
<p>The best overall performance (BLEU = 47.2) is obtained using the multi-input model with lemma statement and chopped kernel tree as inputs</p>
</blockquote>
<p>I'm not sure if that's intended to exclude the syntax tree in some way.</p>



<a name="202186047"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/auto-generating%20names%20for%20declarations/near/202186047" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/auto-generating.20names.20for.20declarations.html#202186047">(Jun 27 2020 at 13:25)</a>:</h4>
<p>This is clearly above what I could work on. But I would very much cheer you on.</p>



<a name="202186113"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/auto-generating%20names%20for%20declarations/near/202186113" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/auto-generating.20names.20for.20declarations.html#202186113">(Jun 27 2020 at 13:26)</a>:</h4>
<p>Not me! Look somewhere else...</p>



<a name="202186142"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/auto-generating%20names%20for%20declarations/near/202186142" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/auto-generating.20names.20for.20declarations.html#202186142">(Jun 27 2020 at 13:27)</a>:</h4>
<p>I agree with Rob, it should be easy to adapt to mathlib.  But I really can't tell how bad the results are.  It guesses the "right" name 10% of the time.  I believe it's enough to feed it only the elaborated expressions, the <code>ChopKnlTree+attn+copy</code> input is the second best perfoming in their paper.</p>



<a name="202186216"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/auto-generating%20names%20for%20declarations/near/202186216" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/auto-generating.20names.20for.20declarations.html#202186216">(Jun 27 2020 at 13:29)</a>:</h4>
<p>10% is a bit sad ... I guess we wouldn't get much out of it in practice.</p>



<a name="202186289"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/auto-generating%20names%20for%20declarations/near/202186289" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/auto-generating.20names.20for.20declarations.html#202186289">(Jun 27 2020 at 13:30)</a>:</h4>
<p><span class="user-mention" data-user-id="198375">@Karl Palmskog</span> may want to comment here.</p>



<a name="202186419"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/auto-generating%20names%20for%20declarations/near/202186419" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/auto-generating.20names.20for.20declarations.html#202186419">(Jun 27 2020 at 13:33)</a>:</h4>
<p>Maybe a more useful application would be as a name accuracy estimator. Don't ask it to name lemmas for you, but try to identify lemmas whose names are obviously wrong. This would fit the linting framework better.</p>



<a name="202186491"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/auto-generating%20names%20for%20declarations/near/202186491" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/auto-generating.20names.20for.20declarations.html#202186491">(Jun 27 2020 at 13:34)</a>:</h4>
<p>Thing like <code>mul_lt_mul''''</code></p>



<a name="202186515"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/auto-generating%20names%20for%20declarations/near/202186515" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/auto-generating.20names.20for.20declarations.html#202186515">(Jun 27 2020 at 13:35)</a>:</h4>
<div class="codehilite"><pre><span></span><code>git grep &quot;&#39;&#39;&#39;&#39;&quot;
src/algebra/linear_ordered_comm_group_with_zero.lean:lemma mul_lt_mul&#39;&#39;&#39;&#39; (hab : a &lt; b) (hcd : c &lt; d) : a * c &lt; b * d :=
</code></pre></div>



<a name="202191967"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/auto-generating%20names%20for%20declarations/near/202191967" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Karl Palmskog <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/auto-generating.20names.20for.20declarations.html#202191967">(Jun 27 2020 at 15:40)</a>:</h4>
<p>hi everyone.</p>
<blockquote>
<p>I'm not sure if that's intended to exclude the syntax tree in some way.</p>
</blockquote>
<p>Our best model for name suggestion did indeed not use the Gallina syntax trees (ASTs, "ChopSynTree") as input. Likely, there was a lot of overlap between the raw tokens ("Stmt") from Coq's lexer and the syntax trees from Coq's parser ("ChopSynTree") in terms of information used for naming</p>



<a name="202192133"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/auto-generating%20names%20for%20declarations/near/202192133" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Karl Palmskog <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/auto-generating.20names.20for.20declarations.html#202192133">(Jun 27 2020 at 15:45)</a>:</h4>
<blockquote>
<p>It guesses the "right" name 10% of the time. </p>
</blockquote>
<p>I'm guessing this is referring to the top-1 score. For perspective, MathComp lemma names are not your average lemma names to get exactly right, they can have 8-9 components and mix underscore and camelcase. To be "top-1-correct" every character must be present in exactly the right order.</p>
<p>A better question to ask may be: how many of the top-1 suggested names are "good" or "reasonable"? In our manual evaluation on a project outside of our corpus, we found that around 24% of top-1 names were rated as good/useful. We believe this is good enough for top-5 suggestions from our tool to be used in pull requests, editors, and the like.</p>



<a name="202192714"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/auto-generating%20names%20for%20declarations/near/202192714" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Karl Palmskog <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/auto-generating.20names.20for.20declarations.html#202192714">(Jun 27 2020 at 16:00)</a>:</h4>
<p><span class="user-mention silent" data-user-id="112680">Johan Commelin</span> <a href="#narrow/stream/116395-maths/topic/auto-generating.20names.20for.20declarations/near/202185316">said</a>:</p>
<blockquote>
<p>And have it auto-fix our library for us</p>
</blockquote>
<p>The output of our tool can only be as good as the training/validation data. If you want to apply this, you will have to select data with desirable naming conventions for the training, validation and test sets. We chose to train/validate/test on very specific MathComp projects in the paper since they were widely regarded as having high-quality names. If there are no agreed-on conventions for certain training/validation data, having a high top-1 percentage on a certain test set might not have any implications for when the tool is applied in practice.</p>



<a name="202192758"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/auto-generating%20names%20for%20declarations/near/202192758" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/auto-generating.20names.20for.20declarations.html#202192758">(Jun 27 2020 at 16:01)</a>:</h4>
<p>This question are half-hypothetical, I won't have time in the near future to try to adapt this myself. But for someone who wanted to, how much work would it take beyond data preparation to adapt this to Lean? It would be very very easy to produce a list of mathlib lemma names with their types and bodies as trees, in whatever format is convenient. From section 5 of your paper, it looks like you're working directly on Coq datatypes for a while, right? So it's fairly far from plug-and-play?</p>



<a name="202192827"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/auto-generating%20names%20for%20declarations/near/202192827" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Karl Palmskog <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/auto-generating.20names.20for.20declarations.html#202192827">(Jun 27 2020 at 16:02)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110596">Rob Lewis</span> <a href="#narrow/stream/116395-maths/topic/auto-generating.20names.20for.20declarations/near/202186419">said</a>:</p>
<blockquote>
<p>Maybe a more useful application would be as a name accuracy estimator. Don't ask it to name lemmas for you, but try to identify lemmas whose names are obviously wrong. This would fit the linting framework better.</p>
</blockquote>
<p>This is indeed one possible application of this kind of tool. You can basically get a number on how well certain lemma names conform to the lemma names in the training/validation set.</p>



<a name="202193102"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/auto-generating%20names%20for%20declarations/near/202193102" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Karl Palmskog <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/auto-generating.20names.20for.20declarations.html#202193102">(Jun 27 2020 at 16:08)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110596">Rob Lewis</span> <a href="#narrow/stream/116395-maths/topic/auto-generating.20names.20for.20declarations/near/202192758">said</a>:</p>
<blockquote>
<p>But for someone who wanted to, how much work would it take beyond data preparation? It would be very very easy to produce a list of mathlib lemma names with their types and bodies as trees, in whatever format is convenient. From section 5 of your paper, it looks like you're working directly on Coq datatypes for a while, right? So it's fairly far from plug-and-play?</p>
</blockquote>
<p>Our toolchain currently assumes input data in the form of S-expressions (since this is what we currently get from Coq). So there will be perhaps a workday or two to make our frontend work with Lean data. We also need a Lean-specific so called "subtokenizer" that knows how to break apart a Lean names into their components (e.g., based on underscores). It's likely you want to perform similar chopping we did on Lean kernel terms to make them into a manageable size. This might be 1-2 workdays more. Then training/validation takes a day of machine time or so. So I would pessimistically estimate a workweek or so (assuming data selection and tokens can be straightforwardly obtained)</p>



<a name="202193320"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/auto-generating%20names%20for%20declarations/near/202193320" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Karl Palmskog <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/auto-generating.20names.20for.20declarations.html#202193320">(Jun 27 2020 at 16:13)</a>:</h4>
<p>I guess this is a bit off-topic, but since we used the same data and similar techniques: we are also presenting some preliminary work soon in the Coq Workshop July 5 on learning/predicting spacing: <a href="https://cozy.ece.utexas.edu/~palmskog/coqws20draft.pdf">https://cozy.ece.utexas.edu/~palmskog/coqws20draft.pdf</a> <a href="https://coq-workshop.gitlab.io/2020/#talk-1-2-3">https://coq-workshop.gitlab.io/2020/#talk-1-2-3</a></p>



<a name="202193322"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/auto-generating%20names%20for%20declarations/near/202193322" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/auto-generating.20names.20for.20declarations.html#202193322">(Jun 27 2020 at 16:13)</a>:</h4>
<p>Thanks for the analysis, that's very helpful! The subtokenizing should be very easy. The rest sounds like a nice project for someone looking to do Lean+ML.</p>



<a name="202193391"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/auto-generating%20names%20for%20declarations/near/202193391" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Karl Palmskog <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/auto-generating.20names.20for.20declarations.html#202193391">(Jun 27 2020 at 16:14)</a>:</h4>
<p>finally, the name generation tool is publicly available now <a href="https://github.com/EngineeringSoftware/roosterize">https://github.com/EngineeringSoftware/roosterize</a> and so is the dataset: <a href="https://github.com/EngineeringSoftware/math-comp-corpus">https://github.com/EngineeringSoftware/math-comp-corpus</a> and the paper will be presented at IJCAR July 3 in a session chaired by Leo: <a href="https://easychair.org/smart-program/IJCAR2020/2020-07-03.html#talk:147084">https://easychair.org/smart-program/IJCAR2020/2020-07-03.html#talk:147084</a> --- my machine learning focused co-author, Pengyu, will likely be able to better answer ML-related questions there than I can here</p>



<a name="202195162"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/auto-generating%20names%20for%20declarations/near/202195162" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/auto-generating.20names.20for.20declarations.html#202195162">(Jun 27 2020 at 16:57)</a>:</h4>
<p><span class="user-mention" data-user-id="198375">@Karl Palmskog</span> Thanks a lot for chiming in!</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>