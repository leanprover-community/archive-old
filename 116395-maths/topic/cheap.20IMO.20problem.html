---
layout: archive
title: Zulip Chat Archive
permalink: /stream/116395-maths/topic/cheap.20IMO.20problem.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/116395-maths/index.html">maths</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/cheap.20IMO.20problem.html">cheap IMO problem</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="211279527"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/cheap%20IMO%20problem/near/211279527" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/cheap.20IMO.20problem.html#211279527">(Sep 25 2020 at 16:16)</a>:</h4>
<p>IMO 1979 Q1:</p>
<div class="codehilite" data-code-language="Text only"><pre><span></span><code> Let m and n be positive integers such that:

      m/n = 1 - 1/2 + 1/3 - 1/4 + ... - 1/1318 + 1/1319.

Prove that m is divisible by 1979.
</code></pre></div>

<p>SPOILER ALERT LINK <a href="https://prase.cz/kalva/imo/isoln/isoln791.html">IMO 1979 Q1 solution</a> should be easy to formalise now we have p-adic valuation, right?</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">tactic</span>

<span class="kn">import</span> <span class="n">algebra.big_operators.basic</span>

<span class="n">open_locale</span> <span class="n">big_operators</span>

<span class="kd">def</span> <span class="n">h</span> <span class="o">:</span> <span class="n">fin</span> <span class="mi">1320</span> <span class="bp">→</span> <span class="n">ℚ</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">n</span><span class="o">,</span> <span class="o">(</span><span class="bp">-</span><span class="mi">1</span><span class="o">)</span><span class="bp">^</span><span class="o">((</span><span class="n">n</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span><span class="bp">+</span> <span class="mi">1</span><span class="o">)</span><span class="bp">/</span><span class="n">n</span>

<span class="kn">open</span> <span class="n">nat</span>

<span class="kd">instance</span> <span class="n">foo</span> <span class="o">:</span> <span class="n">fact</span> <span class="o">(</span><span class="n">prime</span> <span class="mi">1979</span><span class="o">)</span> <span class="o">:=</span> <span class="kd">by</span> <span class="n">norm_num</span>

<span class="kd">theorem</span> <span class="n">imo</span> <span class="o">(</span><span class="n">p</span> <span class="n">q</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="o">:</span> <span class="o">(</span><span class="n">p</span> <span class="o">:</span> <span class="n">ℚ</span><span class="o">)</span> <span class="bp">/</span> <span class="n">q</span> <span class="bp">=</span>
<span class="c1">-- 1 - (1/2) + (1/3) - (1/4) + ... + (1/1319),</span>
<span class="bp">∑</span> <span class="n">x</span><span class="o">,</span> <span class="n">h</span> <span class="n">x</span>
<span class="bp">→</span> <span class="mi">1979</span> <span class="bp">∣</span> <span class="n">p</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="n">sorry</span>
<span class="kd">end</span>
</code></pre></div>

<p>They were chatting about it on the IMO stream.</p>



<a name="211279716"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/cheap%20IMO%20problem/near/211279716" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/cheap.20IMO.20problem.html#211279716">(Sep 25 2020 at 16:18)</a>:</h4>
<p>There's probably a better way to state it.</p>



<a name="211280955"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/cheap%20IMO%20problem/near/211280955" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/cheap.20IMO.20problem.html#211280955">(Sep 25 2020 at 16:28)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">tactic</span>

<span class="kn">import</span> <span class="n">algebra.big_operators.basic</span>

<span class="n">open_locale</span> <span class="n">big_operators</span>

<span class="kn">open</span> <span class="n">nat</span>

<span class="kd">instance</span> <span class="n">foo</span> <span class="o">:</span> <span class="n">fact</span> <span class="o">(</span><span class="n">prime</span> <span class="mi">1979</span><span class="o">)</span> <span class="o">:=</span> <span class="kd">by</span> <span class="n">norm_num</span>

<span class="kd">theorem</span> <span class="n">imo</span> <span class="o">(</span><span class="n">p</span> <span class="n">q</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="o">:</span> <span class="o">(</span><span class="n">p</span> <span class="o">:</span> <span class="n">ℚ</span><span class="o">)</span> <span class="bp">/</span> <span class="n">q</span> <span class="bp">=</span>
<span class="c1">-- 1 - (1/2) + (1/3) - (1/4) + ... + (1/1319),</span>
<span class="bp">∑</span> <span class="n">n</span> <span class="k">in</span> <span class="n">finset.range</span> <span class="mi">1320</span><span class="o">,</span> <span class="o">(</span><span class="bp">-</span><span class="mi">1</span><span class="o">)</span><span class="bp">^</span><span class="o">(</span><span class="n">n</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)</span> <span class="bp">/</span> <span class="n">n</span>
<span class="bp">→</span> <span class="mi">1979</span> <span class="bp">∣</span> <span class="n">p</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="n">sorry</span>
<span class="kd">end</span>
</code></pre></div>

<p>is nicer.</p>



<a name="211310516"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/cheap%20IMO%20problem/near/211310516" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/cheap.20IMO.20problem.html#211310516">(Sep 25 2020 at 20:01)</a>:</h4>
<p>I made a start but now I have to eat:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">tactic</span>

<span class="kn">import</span> <span class="n">algebra.big_operators.ring</span>

<span class="kn">import</span> <span class="n">data.nat.parity</span>

<span class="n">open_locale</span> <span class="n">big_operators</span>

<span class="kn">open</span> <span class="n">finset</span>

<span class="kn">open</span> <span class="n">nat</span>

<span class="kd">instance</span> <span class="n">foo</span> <span class="o">:</span> <span class="n">fact</span> <span class="o">(</span><span class="n">prime</span> <span class="mi">1979</span><span class="o">)</span> <span class="o">:=</span> <span class="kd">by</span> <span class="n">norm_num</span>

<span class="kn">open</span> <span class="n">finset</span>

<span class="kd">theorem</span> <span class="n">imo</span> <span class="o">(</span><span class="n">p</span> <span class="n">q</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="o">:</span> <span class="o">(</span><span class="n">p</span> <span class="o">:</span> <span class="n">ℚ</span><span class="o">)</span> <span class="bp">/</span> <span class="n">q</span> <span class="bp">=</span>
<span class="c1">-- 1 - (1/2) + (1/3) - (1/4) + ... + (1/1319),</span>
<span class="bp">∑</span> <span class="n">n</span> <span class="k">in</span> <span class="n">finset.range</span> <span class="mi">1320</span><span class="o">,</span> <span class="o">(</span><span class="bp">-</span><span class="mi">1</span><span class="o">)</span><span class="bp">^</span><span class="o">(</span><span class="n">n</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)</span> <span class="bp">/</span> <span class="n">n</span>
<span class="bp">→</span> <span class="mi">1979</span> <span class="bp">∣</span> <span class="n">p</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="k">let</span> <span class="n">a</span> <span class="o">:</span> <span class="n">ℚ</span> <span class="o">:=</span> <span class="bp">∑</span> <span class="n">n</span> <span class="k">in</span> <span class="n">range</span> <span class="mi">1320</span><span class="o">,</span> <span class="o">(</span><span class="bp">-</span><span class="mi">1</span><span class="o">)</span><span class="bp">^</span><span class="o">(</span><span class="n">n</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)</span> <span class="bp">/</span> <span class="n">n</span><span class="o">,</span>
  <span class="k">let</span> <span class="n">b</span> <span class="o">:</span> <span class="n">ℚ</span> <span class="o">:=</span> <span class="bp">∑</span> <span class="n">n</span> <span class="k">in</span> <span class="n">range</span> <span class="mi">1320</span><span class="o">,</span> <span class="mi">1</span> <span class="bp">/</span> <span class="n">n</span><span class="o">,</span>
  <span class="c1">-- b - a = 2(1/2+1/4+...+1318)</span>
  <span class="c1">-- = 1+1/2+1/3+...+1/659</span>
  <span class="k">let</span> <span class="n">c</span> <span class="o">:</span> <span class="n">ℚ</span> <span class="o">:=</span> <span class="bp">∑</span> <span class="n">n</span> <span class="k">in</span> <span class="n">range</span> <span class="mi">660</span><span class="o">,</span> <span class="mi">1</span> <span class="bp">/</span> <span class="n">n</span><span class="o">,</span>
  <span class="c1">-- want b - a = c i.e. to formalise lines above</span>
  <span class="k">let</span> <span class="n">e</span> <span class="o">:</span> <span class="n">ℕ</span> <span class="bp">↪</span> <span class="n">ℕ</span> <span class="o">:=</span> <span class="o">⟨</span><span class="bp">λ</span> <span class="n">n</span><span class="o">,</span> <span class="mi">2</span> <span class="bp">*</span> <span class="n">n</span><span class="o">,</span> <span class="bp">λ</span> <span class="n">a</span> <span class="n">b</span><span class="o">,</span> <span class="n">mul_left_cancel'</span> <span class="o">(</span><span class="kd">by</span> <span class="n">norm_num</span><span class="o">)⟩,</span>
  <span class="k">have</span> <span class="n">h1</span> <span class="o">:=</span> <span class="n">sum_map</span> <span class="o">(</span><span class="n">range</span> <span class="mi">660</span><span class="o">)</span> <span class="n">e</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">n</span><span class="o">,</span> <span class="o">(</span><span class="mi">1</span> <span class="o">:</span> <span class="n">ℚ</span><span class="o">)</span> <span class="bp">/</span> <span class="n">n</span><span class="o">),</span>
  <span class="c1">-- first goal b - a = c,</span>
  <span class="c1">-- hence a = sum from 660 to 1319</span>
  <span class="c1">-- then they cancel</span>
  <span class="k">have</span> <span class="n">h0</span> <span class="o">:</span> <span class="n">b</span> <span class="bp">-</span> <span class="n">a</span> <span class="bp">=</span> <span class="n">c</span><span class="o">,</span>
  <span class="k">calc</span> <span class="n">b</span> <span class="bp">-</span> <span class="n">a</span> <span class="bp">=</span> <span class="bp">∑</span> <span class="n">n</span> <span class="k">in</span> <span class="n">range</span> <span class="mi">1320</span><span class="o">,</span> <span class="o">(</span><span class="mi">1</span><span class="bp">/</span><span class="n">n</span> <span class="bp">-</span> <span class="o">(</span><span class="bp">-</span><span class="mi">1</span><span class="o">)</span><span class="bp">^</span><span class="o">(</span><span class="n">n</span><span class="bp">+</span><span class="mi">1</span><span class="o">)</span><span class="bp">/</span><span class="n">n</span><span class="o">)</span> <span class="o">:</span> <span class="kd">by</span> <span class="n">rw</span> <span class="n">sum_sub_distrib</span>
    <span class="bp">...</span> <span class="bp">=</span> <span class="bp">∑</span> <span class="n">n</span> <span class="k">in</span> <span class="n">range</span> <span class="mi">1320</span><span class="o">,</span> <span class="n">ite</span> <span class="o">(</span><span class="n">even</span> <span class="n">n</span><span class="o">)</span> <span class="o">(</span><span class="mi">2</span><span class="bp">/</span><span class="n">n</span><span class="o">)</span> <span class="mi">0</span> <span class="o">:</span> <span class="kd">by</span> <span class="o">{</span>
      <span class="n">apply</span> <span class="n">sum_congr</span> <span class="n">rfl</span><span class="o">,</span>
      <span class="n">rintros</span> <span class="n">x</span> <span class="n">hx</span><span class="o">,</span>
      <span class="n">rw</span> <span class="o">[</span><span class="n">pow_add</span><span class="o">,</span> <span class="n">pow_one</span><span class="o">,</span> <span class="n">mul_neg_one</span><span class="o">,</span> <span class="n">neg_div</span><span class="o">,</span> <span class="n">sub_neg_eq_add</span><span class="o">,</span> <span class="bp">←</span> <span class="n">_root_.add_div</span><span class="o">],</span>
      <span class="n">split_ifs</span><span class="o">,</span>
      <span class="o">{</span> <span class="n">rcases</span> <span class="n">h</span> <span class="k">with</span> <span class="o">⟨</span><span class="n">n</span><span class="o">,</span> <span class="n">rfl</span><span class="o">⟩,</span>
        <span class="n">rw</span> <span class="o">[</span><span class="n">pow_mul</span><span class="o">,</span> <span class="n">pow_two</span><span class="o">],</span>
        <span class="n">simp</span><span class="o">,</span> <span class="n">norm_num</span> <span class="o">},</span>
      <span class="o">{</span> <span class="n">rw</span> <span class="n">not_even_iff</span> <span class="n">at</span> <span class="n">h</span><span class="o">,</span>
        <span class="k">have</span> <span class="n">h8</span> <span class="o">:=</span> <span class="n">nat.mod_add_div</span> <span class="n">x</span> <span class="mi">2</span><span class="o">,</span>
        <span class="n">rw</span> <span class="n">h</span> <span class="n">at</span> <span class="n">h8</span><span class="o">,</span>
        <span class="k">suffices</span> <span class="o">:</span> <span class="o">(</span><span class="mi">1</span> <span class="o">:</span> <span class="n">ℚ</span><span class="o">)</span> <span class="bp">+</span> <span class="o">(</span><span class="bp">-</span><span class="mi">1</span><span class="o">)</span><span class="bp">^</span><span class="n">x</span> <span class="bp">=</span> <span class="mi">0</span><span class="o">,</span>
          <span class="n">rw</span> <span class="n">this</span><span class="o">,</span> <span class="n">simp</span><span class="o">,</span>
        <span class="n">rw</span> <span class="bp">←</span> <span class="n">h8</span><span class="o">,</span>
        <span class="n">simp</span> <span class="o">[</span><span class="n">pow_add</span><span class="o">,</span> <span class="n">pow_mul</span><span class="o">],</span>
      <span class="o">}</span>
    <span class="o">}</span>
    <span class="bp">...</span> <span class="bp">=</span> <span class="bp">∑</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="k">in</span> <span class="n">filter</span> <span class="n">even</span> <span class="o">(</span><span class="n">range</span> <span class="mi">1320</span><span class="o">),</span> <span class="mi">2</span> <span class="bp">/</span> <span class="n">x</span> <span class="o">:</span> <span class="kd">by</span> <span class="n">rw</span> <span class="n">sum_filter</span>
    <span class="bp">...</span> <span class="bp">=</span> <span class="bp">∑</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="k">in</span> <span class="n">map</span> <span class="n">e</span> <span class="o">(</span><span class="n">range</span> <span class="mi">660</span><span class="o">),</span> <span class="o">(</span><span class="mi">2</span> <span class="o">:</span> <span class="n">ℚ</span><span class="o">)</span> <span class="bp">/</span> <span class="n">x</span> <span class="o">:</span> <span class="kd">by</span> <span class="o">{</span>
      <span class="n">apply</span> <span class="n">sum_congr</span><span class="o">,</span> <span class="n">swap</span><span class="o">,</span> <span class="n">simp</span><span class="o">,</span>
      <span class="n">apply</span> <span class="n">finset.subset.antisymm</span><span class="o">,</span>
        <span class="n">sorry</span><span class="o">,</span>
      <span class="n">sorry</span>
    <span class="o">}</span>
    <span class="bp">...</span> <span class="bp">=</span> <span class="n">c</span> <span class="o">:</span> <span class="n">sorry</span><span class="o">,</span>
  <span class="n">sorry</span>
<span class="kd">end</span>
</code></pre></div>



<a name="211403761"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/cheap%20IMO%20problem/near/211403761" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yakov Pechersky <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/cheap.20IMO.20problem.html#211403761">(Sep 27 2020 at 07:43)</a>:</h4>
<p>Here's my <code>fin</code> powered attempt, I'm now struggling with collapsing the "telescoping" sum.</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">tactic.ring_exp</span>
<span class="kn">import</span> <span class="n">data.matrix.notation</span>
<span class="kn">import</span> <span class="n">data.rat.cast</span>

<span class="n">open_locale</span> <span class="n">big_operators</span>

<span class="kd">def</span> <span class="n">h</span> <span class="o">{</span><span class="n">n</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">}</span> <span class="o">:</span> <span class="n">fin</span> <span class="n">n</span> <span class="bp">→</span> <span class="n">ℚ</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">k</span><span class="o">,</span> <span class="o">(</span><span class="bp">-</span><span class="mi">1</span><span class="o">)</span><span class="bp">^</span><span class="o">((</span><span class="n">k</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span><span class="bp">+</span> <span class="mi">1</span><span class="o">)</span><span class="bp">/</span><span class="n">k</span>

<span class="kd">instance</span> <span class="n">foo</span> <span class="o">:</span> <span class="n">fact</span> <span class="o">(</span><span class="n">nat.prime</span> <span class="mi">1979</span><span class="o">)</span> <span class="o">:=</span> <span class="kd">by</span> <span class="n">norm_num</span>

<span class="kd">@[simp]</span> <span class="kd">lemma</span> <span class="n">fin.coe_sub</span> <span class="o">{</span><span class="n">n</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">}</span> <span class="o">(</span><span class="n">x</span> <span class="n">y</span> <span class="o">:</span> <span class="n">fin</span> <span class="n">n</span><span class="o">)</span> <span class="o">:</span> <span class="o">(((</span><span class="n">x</span> <span class="bp">-</span> <span class="n">y</span><span class="o">)</span> <span class="o">:</span> <span class="n">fin</span> <span class="n">n</span><span class="o">)</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="bp">=</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="bp">-</span> <span class="n">y</span> <span class="o">:=</span>
<span class="kd">by</span> <span class="o">{</span> <span class="n">cases</span> <span class="n">x</span><span class="o">,</span> <span class="n">cases</span> <span class="n">y</span><span class="o">,</span> <span class="n">refl</span> <span class="o">}</span>

<span class="kd">lemma</span> <span class="n">fin.coe_bit0</span> <span class="o">{</span><span class="n">n</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">}</span> <span class="o">{</span><span class="n">x</span> <span class="o">:</span> <span class="n">fin</span> <span class="n">n</span><span class="o">}</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="o">(</span><span class="n">bit0</span> <span class="n">x</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="bp">&lt;</span> <span class="n">n</span><span class="o">)</span> <span class="o">:</span> <span class="o">((</span><span class="n">bit0</span> <span class="n">x</span> <span class="o">:</span> <span class="n">fin</span> <span class="n">n</span><span class="o">)</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="bp">=</span> <span class="n">bit0</span> <span class="n">x</span> <span class="o">:=</span>
<span class="kd">by</span> <span class="o">{</span> <span class="n">cases</span> <span class="n">x</span><span class="o">,</span> <span class="n">exact</span> <span class="n">nat.mod_eq_of_lt</span> <span class="n">h</span> <span class="o">}</span>

<span class="kd">lemma</span> <span class="n">fin.coe_bit1</span> <span class="o">{</span><span class="n">n</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">}</span> <span class="o">{</span><span class="n">x</span> <span class="o">:</span> <span class="n">fin</span> <span class="o">(</span><span class="n">n</span> <span class="bp">+</span> <span class="mi">2</span><span class="o">)}</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="o">(</span><span class="n">bit1</span> <span class="n">x</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="bp">&lt;</span> <span class="n">n</span> <span class="bp">+</span> <span class="mi">2</span><span class="o">)</span> <span class="o">:</span>
  <span class="o">((</span><span class="n">bit1</span> <span class="n">x</span> <span class="o">:</span> <span class="n">fin</span> <span class="o">(</span><span class="n">n</span> <span class="bp">+</span> <span class="mi">2</span><span class="o">))</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="bp">=</span> <span class="n">bit1</span> <span class="n">x</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="n">rw</span> <span class="n">bit1</span> <span class="n">at</span> <span class="n">h</span><span class="o">,</span>
  <span class="n">simpa</span> <span class="n">only</span> <span class="o">[</span><span class="n">bit1</span><span class="o">,</span> <span class="n">fin.coe_add</span><span class="o">,</span>
              <span class="n">fin.coe_bit0</span> <span class="o">(</span><span class="n">lt_of_le_of_lt</span> <span class="o">(</span><span class="n">nat.le_add_right</span> <span class="n">_</span> <span class="n">_</span><span class="o">)</span> <span class="n">h</span><span class="o">)]</span> <span class="n">using</span> <span class="n">nat.mod_eq_of_lt</span> <span class="n">h</span><span class="o">,</span>
<span class="kd">end</span>

<span class="kn">section</span> <span class="n">hF</span>

<span class="kd">variables</span> <span class="o">{</span><span class="n">n</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">}</span> <span class="o">(</span><span class="n">N</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="n">fin</span> <span class="n">n</span><span class="o">)</span>

<span class="kd">def</span> <span class="n">hF</span> <span class="o">:</span> <span class="n">ℚ</span> <span class="o">:=</span> <span class="mi">1</span> <span class="bp">/</span> <span class="o">((</span><span class="n">N</span> <span class="bp">+</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">))</span> <span class="o">:</span> <span class="n">ℚ</span><span class="o">)</span>

<span class="kd">lemma</span> <span class="n">shift</span> <span class="o">:</span> <span class="n">hF</span> <span class="n">N.succ</span> <span class="n">x.cast_succ</span> <span class="bp">=</span> <span class="n">hF</span> <span class="n">N</span> <span class="n">x.succ</span> <span class="o">:=</span>
<span class="kd">by</span> <span class="o">{</span> <span class="n">simp</span> <span class="o">[</span><span class="n">hF</span><span class="o">],</span> <span class="n">ring_exp</span> <span class="o">}</span>

<span class="kd">lemma</span> <span class="n">reduce</span> <span class="o">:</span> <span class="bp">@</span><span class="n">hF</span> <span class="n">n.succ</span> <span class="n">N</span> <span class="n">x.cast_succ</span> <span class="bp">=</span> <span class="bp">@</span><span class="n">hF</span> <span class="n">n</span> <span class="n">N</span> <span class="n">x</span> <span class="o">:=</span>
<span class="kd">by</span> <span class="n">simp</span> <span class="o">[</span><span class="n">hF</span><span class="o">]</span>

<span class="kd">lemma</span> <span class="n">hreduce</span> <span class="o">:</span> <span class="n">h</span> <span class="n">x.cast_succ.cast_succ</span> <span class="bp">=</span> <span class="n">h</span> <span class="n">x</span> <span class="o">:=</span>
<span class="kd">by</span> <span class="n">simp</span> <span class="o">[</span><span class="n">h</span><span class="o">]</span>

<span class="kd">lemma</span> <span class="n">h_to_hF</span> <span class="o">:</span> <span class="o">(</span><span class="bp">∑</span> <span class="n">x</span> <span class="o">:</span> <span class="n">fin</span> <span class="o">(</span><span class="n">N</span> <span class="bp">*</span> <span class="mi">2</span><span class="o">),</span> <span class="n">h</span> <span class="n">x</span><span class="o">)</span> <span class="bp">=</span> <span class="bp">∑</span> <span class="n">x</span> <span class="o">:</span> <span class="n">fin</span> <span class="n">N</span><span class="o">,</span> <span class="n">hF</span> <span class="n">N</span> <span class="n">x</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="n">induction</span> <span class="n">N</span> <span class="k">with</span> <span class="n">N</span> <span class="n">hN</span><span class="o">,</span>
  <span class="o">{</span> <span class="n">refl</span> <span class="o">},</span>
  <span class="n">symmetry</span><span class="o">,</span>
  <span class="n">rw</span> <span class="n">fin.sum_univ_cast_succ</span><span class="o">,</span>
  <span class="n">simp_rw</span> <span class="n">shift</span> <span class="n">N</span><span class="o">,</span>
  <span class="n">rw</span> <span class="o">[</span><span class="bp">←</span><span class="n">add_right_inj</span> <span class="o">(</span><span class="n">hF</span> <span class="n">N</span> <span class="mi">0</span><span class="o">),</span> <span class="bp">←</span><span class="n">add_assoc</span><span class="o">,</span> <span class="bp">←</span><span class="n">fin.sum_univ_succ</span><span class="o">,</span> <span class="n">fin.sum_univ_cast_succ</span><span class="o">],</span>
  <span class="n">simp_rw</span> <span class="n">reduce</span><span class="o">,</span>
  <span class="n">symmetry</span><span class="o">,</span>
  <span class="n">rw</span> <span class="o">[</span><span class="n">nat.succ_mul</span><span class="o">,</span> <span class="n">fin.sum_univ_cast_succ</span><span class="o">,</span> <span class="n">fin.sum_univ_cast_succ</span><span class="o">],</span>
  <span class="n">simp_rw</span> <span class="n">hreduce</span><span class="o">,</span>
  <span class="n">rw</span> <span class="o">[</span><span class="n">hN</span><span class="o">,</span> <span class="bp">←</span><span class="n">add_assoc</span><span class="o">,</span> <span class="bp">←</span><span class="n">add_assoc</span><span class="o">,</span> <span class="n">add_comm</span> <span class="o">(</span><span class="n">hF</span> <span class="n">_</span> <span class="n">_</span><span class="o">),</span> <span class="n">add_assoc</span><span class="o">,</span> <span class="n">add_assoc</span><span class="o">,</span> <span class="n">add_assoc</span><span class="o">],</span>
  <span class="n">congr'</span> <span class="mi">1</span><span class="o">,</span>
  <span class="n">rw</span> <span class="bp">←</span><span class="n">add_assoc</span><span class="o">,</span>
  <span class="n">congr</span><span class="o">,</span>
  <span class="o">{</span> <span class="k">have</span> <span class="n">nh</span> <span class="o">:</span> <span class="o">(</span><span class="bp">-</span><span class="mi">1</span> <span class="o">:</span> <span class="n">ℚ</span><span class="o">)</span> <span class="bp">^</span> <span class="o">(</span><span class="n">N</span> <span class="bp">*</span> <span class="mi">2</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)</span> <span class="bp">=</span> <span class="bp">-</span><span class="mi">1</span><span class="o">,</span>
    <span class="o">{</span> <span class="n">rw</span> <span class="o">[</span><span class="n">mul_comm</span><span class="o">],</span>
      <span class="n">simp</span> <span class="o">[</span><span class="n">pow_add</span><span class="o">,</span> <span class="n">pow_mul</span><span class="o">]</span> <span class="o">},</span>
    <span class="k">have</span> <span class="o">:</span> <span class="o">(</span><span class="n">N</span> <span class="o">:</span> <span class="n">ℚ</span><span class="o">)</span><span class="bp">⁻¹</span> <span class="bp">=</span> <span class="mi">2</span> <span class="bp">/</span> <span class="o">(</span><span class="n">N</span> <span class="bp">*</span> <span class="mi">2</span><span class="o">),</span>
      <span class="o">{</span> <span class="n">norm_num</span> <span class="o">[</span><span class="bp">←</span><span class="n">one_div</span><span class="o">,</span> <span class="n">mul_comm</span><span class="o">,</span> <span class="n">div_mul_eq_div_mul_one_div</span><span class="o">]</span> <span class="o">},</span>
    <span class="n">norm_num</span> <span class="o">[</span><span class="n">h</span><span class="o">,</span> <span class="n">hF</span><span class="o">,</span> <span class="n">nh</span><span class="o">,</span> <span class="n">this</span><span class="o">],</span>
    <span class="n">ring_exp</span> <span class="o">},</span>
  <span class="o">{</span> <span class="k">have</span> <span class="n">nh</span> <span class="o">:</span> <span class="o">(</span><span class="bp">-</span><span class="mi">1</span> <span class="o">:</span> <span class="n">ℚ</span><span class="o">)</span> <span class="bp">^</span> <span class="o">(</span><span class="n">N</span> <span class="bp">*</span> <span class="mi">2</span> <span class="bp">+</span> <span class="mi">1</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)</span> <span class="bp">=</span> <span class="mi">1</span><span class="o">,</span>
    <span class="o">{</span> <span class="n">rw</span> <span class="o">[</span><span class="n">mul_comm</span><span class="o">],</span>
      <span class="n">simp</span> <span class="o">[</span><span class="n">pow_add</span><span class="o">,</span> <span class="n">pow_mul</span><span class="o">]</span> <span class="o">},</span>
    <span class="n">norm_num</span> <span class="o">[</span><span class="n">h</span><span class="o">,</span> <span class="n">hF</span><span class="o">,</span> <span class="n">nh</span><span class="o">],</span>
    <span class="n">ring_exp</span> <span class="o">}</span>
<span class="kd">end</span>

<span class="kd">end</span> <span class="n">hF</span>

<span class="kn">section</span> <span class="n">nums</span>

<span class="kd">lemma</span> <span class="n">coe_659</span> <span class="o">:</span> <span class="o">((</span><span class="mi">659</span> <span class="o">:</span> <span class="n">fin</span> <span class="mi">660</span><span class="o">)</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="bp">=</span> <span class="mi">659</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="n">rw</span> <span class="o">[</span><span class="n">fin.coe_bit1</span><span class="o">,</span> <span class="n">fin.coe_bit1</span><span class="o">,</span> <span class="n">fin.coe_bit0</span><span class="o">,</span> <span class="n">fin.coe_bit0</span><span class="o">,</span> <span class="n">fin.coe_bit1</span><span class="o">,</span>
      <span class="n">fin.coe_bit0</span><span class="o">,</span> <span class="n">fin.coe_bit0</span><span class="o">,</span> <span class="n">fin.coe_bit1</span><span class="o">,</span> <span class="n">fin.coe_bit0</span><span class="o">],</span>
  <span class="n">simp</span> <span class="n">only</span> <span class="o">[</span><span class="n">fin.coe_one</span><span class="o">],</span>
  <span class="n">all_goals</span> <span class="o">{</span> <span class="n">dec_trivial</span> <span class="o">}</span>
<span class="kd">end</span>

<span class="kd">lemma</span> <span class="n">pos_660</span> <span class="o">:</span> <span class="o">(</span><span class="mi">0</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="bp">&lt;</span> <span class="mi">660</span> <span class="o">:=</span> <span class="n">dec_trivial</span>

<span class="kd">lemma</span> <span class="n">posQ_660</span> <span class="o">:</span> <span class="o">(</span><span class="mi">0</span> <span class="o">:</span> <span class="n">ℚ</span><span class="o">)</span> <span class="bp">&lt;</span> <span class="mi">660</span> <span class="o">:=</span> <span class="n">nat.cast_lt.mpr</span> <span class="n">pos_660</span>

<span class="kd">lemma</span> <span class="n">expand</span> <span class="o">(</span><span class="n">d</span> <span class="o">:</span> <span class="n">fin</span> <span class="mi">660</span><span class="o">)</span> <span class="o">:</span> <span class="n">hF</span> <span class="mi">660</span> <span class="n">d</span> <span class="bp">+</span> <span class="n">hF</span> <span class="mi">660</span> <span class="o">(</span><span class="mi">659</span> <span class="bp">-</span> <span class="n">d</span><span class="o">)</span> <span class="bp">=</span> <span class="mi">1979</span> <span class="bp">/</span> <span class="o">((</span><span class="mi">660</span> <span class="bp">+</span> <span class="n">d</span><span class="o">)</span> <span class="bp">*</span> <span class="o">(</span><span class="mi">1319</span> <span class="bp">-</span> <span class="n">d</span><span class="o">))</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="n">obtain</span> <span class="o">⟨</span><span class="n">d</span><span class="o">,</span> <span class="n">dlim</span><span class="o">⟩</span> <span class="o">:=</span> <span class="n">d</span><span class="o">,</span>
  <span class="n">simp</span> <span class="n">only</span> <span class="o">[</span><span class="n">hF</span><span class="o">,</span> <span class="n">one_div</span><span class="o">],</span>
  <span class="n">rw</span> <span class="n">inv_add_inv</span><span class="o">,</span>
  <span class="n">simp</span> <span class="n">only</span> <span class="o">[</span><span class="n">nat.cast_bit0</span><span class="o">,</span> <span class="n">nat.cast_bit1</span><span class="o">,</span> <span class="n">nat.cast_one</span><span class="o">,</span> <span class="n">fin.coe_mk</span><span class="o">,</span> <span class="n">fin.coe_sub</span><span class="o">,</span> <span class="n">coe_659</span><span class="o">,</span>
              <span class="n">nat.cast_sub</span> <span class="o">(</span><span class="n">nat.le_of_succ_le_succ</span> <span class="n">dlim</span><span class="o">),</span> <span class="n">coe_coe</span><span class="o">],</span>
  <span class="n">refine</span> <span class="n">congr_arg2</span> <span class="n">has_div.div</span> <span class="n">_</span> <span class="n">_</span><span class="o">,</span>
  <span class="o">{</span> <span class="n">rw</span> <span class="n">add_assoc</span><span class="o">,</span>
    <span class="n">rw</span> <span class="n">add_comm</span><span class="o">,</span>
    <span class="n">rw</span> <span class="bp">←</span><span class="n">eq_sub_iff_add_eq</span><span class="o">,</span>
    <span class="n">rw</span> <span class="n">add_comm</span><span class="o">,</span>
    <span class="n">rw</span> <span class="n">add_assoc</span><span class="o">,</span>
    <span class="n">norm_num</span> <span class="o">},</span>
  <span class="o">{</span> <span class="n">rw</span> <span class="n">add_sub</span><span class="o">,</span>
    <span class="n">norm_num</span> <span class="o">},</span>
  <span class="o">{</span> <span class="n">simp</span> <span class="n">only</span> <span class="o">[</span><span class="n">nat.cast_bit0</span><span class="o">,</span> <span class="n">nat.cast_bit1</span><span class="o">,</span> <span class="n">nat.cast_one</span><span class="o">,</span> <span class="n">fin.coe_mk</span><span class="o">],</span>
    <span class="n">refine</span> <span class="n">ne_of_gt</span> <span class="o">(</span><span class="n">lt_of_lt_of_le</span> <span class="n">posQ_660</span> <span class="n">_</span><span class="o">),</span>
    <span class="n">exact</span> <span class="n">le_add_of_nonneg_right</span> <span class="o">(</span><span class="n">nat.cast_nonneg</span> <span class="n">d</span><span class="o">)</span> <span class="o">},</span>
  <span class="o">{</span> <span class="n">simp</span> <span class="n">only</span> <span class="o">[</span><span class="n">nat.cast_bit0</span><span class="o">,</span> <span class="n">nat.cast_bit1</span><span class="o">,</span> <span class="n">nat.cast_one</span><span class="o">,</span> <span class="n">fin.coe_mk</span><span class="o">],</span>
    <span class="n">refine</span> <span class="n">ne_of_gt</span> <span class="o">(</span><span class="n">lt_of_lt_of_le</span> <span class="n">posQ_660</span> <span class="n">_</span><span class="o">),</span>
    <span class="n">exact</span> <span class="n">le_add_of_nonneg_right</span> <span class="o">(</span><span class="n">nat.cast_nonneg</span> <span class="n">_</span><span class="o">)</span> <span class="o">}</span>
<span class="kd">end</span>

<span class="kd">lemma</span> <span class="n">sub_659</span> <span class="o">:</span> <span class="n">fin.last</span> <span class="mi">659</span> <span class="bp">=</span> <span class="o">(</span><span class="mi">659</span> <span class="o">:</span> <span class="n">fin</span> <span class="mi">660</span><span class="o">)</span> <span class="bp">-</span> <span class="o">(</span><span class="mi">0</span> <span class="o">:</span> <span class="n">fin</span> <span class="mi">660</span><span class="o">)</span> <span class="o">:=</span> <span class="n">rfl</span>

<span class="kd">end</span> <span class="n">nums</span>

<span class="kd">theorem</span> <span class="n">imo</span> <span class="o">(</span><span class="n">p</span> <span class="n">q</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="o">:</span> <span class="o">(</span><span class="n">p</span> <span class="o">:</span> <span class="n">ℚ</span><span class="o">)</span> <span class="bp">/</span> <span class="n">q</span> <span class="bp">=</span>
<span class="c1">-- 1 - (1/2) + (1/3) - (1/4) + ... + (1/1319),</span>
<span class="bp">∑</span> <span class="n">x</span> <span class="o">:</span> <span class="n">fin</span> <span class="mi">1320</span><span class="o">,</span> <span class="n">h</span> <span class="n">x</span>
<span class="bp">→</span> <span class="mi">1979</span> <span class="bp">∣</span> <span class="n">p</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="n">intro</span> <span class="n">F</span><span class="o">,</span>
  <span class="n">rw</span> <span class="o">(</span><span class="k">show</span> <span class="mi">1320</span> <span class="bp">=</span> <span class="mi">660</span> <span class="bp">*</span> <span class="mi">2</span><span class="o">,</span> <span class="kd">by</span> <span class="n">norm_num</span><span class="o">)</span> <span class="n">at</span> <span class="n">F</span><span class="o">,</span>
  <span class="n">rw</span> <span class="n">h_to_hF</span> <span class="n">at</span> <span class="n">F</span><span class="o">,</span>
  <span class="n">rw</span> <span class="n">fin.sum_univ_cast_succ</span> <span class="n">at</span> <span class="n">F</span><span class="o">,</span>
  <span class="n">rw</span> <span class="n">fin.sum_univ_succ</span> <span class="n">at</span> <span class="n">F</span><span class="o">,</span>
  <span class="n">rw</span> <span class="n">add_assoc</span> <span class="n">at</span> <span class="n">F</span><span class="o">,</span>
  <span class="n">rw</span> <span class="n">add_comm</span> <span class="o">(</span><span class="bp">∑</span> <span class="n">_</span><span class="o">,</span> <span class="n">_</span><span class="o">)</span> <span class="n">at</span> <span class="n">F</span><span class="o">,</span>
  <span class="n">rw</span> <span class="bp">←</span><span class="n">add_assoc</span> <span class="n">at</span> <span class="n">F</span><span class="o">,</span>
  <span class="n">rw</span> <span class="n">sub_659</span> <span class="n">at</span> <span class="n">F</span><span class="o">,</span>
  <span class="n">rw</span> <span class="n">fin.cast_succ_zero</span> <span class="n">at</span> <span class="n">F</span><span class="o">,</span>
  <span class="n">rw</span> <span class="n">expand</span> <span class="mi">0</span> <span class="n">at</span> <span class="n">F</span><span class="o">,</span>
  <span class="n">sorry</span><span class="o">,</span>
<span class="kd">end</span>
</code></pre></div>



<a name="211408135"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/cheap%20IMO%20problem/near/211408135" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Miroslav Olšák <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/cheap.20IMO.20problem.html#211408135">(Sep 27 2020 at 09:48)</a>:</h4>
<p>As we were discussing that it could be just easily canlculated, how could one prove that?:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">example</span> <span class="o">:</span> <span class="o">(</span><span class="bp">∑</span> <span class="n">n</span> <span class="k">in</span> <span class="n">finset.range</span> <span class="mi">1320</span><span class="o">,</span> <span class="o">((</span><span class="bp">-</span><span class="mi">1</span><span class="o">)</span><span class="bp">^</span><span class="o">(</span><span class="n">n</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)</span> <span class="bp">/</span> <span class="n">n</span> <span class="o">:</span> <span class="n">ℚ</span><span class="o">))</span>
<span class="bp">=</span>
<span class="o">(</span><span class="mi">9712435370176457211789032112275705035436058023056668172162691122769643536134963388887418503518212227707181887399284421324209991580261372180881066042267340013822543021630993790301871917306672479003742347731906894502206611684973377349822140727866748793472314555146081954133359219693224842345716201562838113110488664229990443258508595332395129617286143580898566908128232436187466371871641095608257859832669859587159077972843255741143946005144546720084104126426401254209483858435525146637078869452056788708944608960016712180409515668301909686056363654039823351264466923197720153813</span>
<span class="bp">/</span>
<span class="mi">14004426370194880461934343682044774391282833031127910746297786781959105584828861694180270900155320736866485178357969757814225700469374818454186270560156419686116542029027696742870488277713573014598870206397512488706141517193426122086231634178080237723065448682598131182597623527313179068878231298472650458406330723014358986732179004322578669107971003162372262774921109835980551500767898797452304799628071849186633284721093163439037683000781898695594646092124867941059532453140720984993275703737648888419223774236963722967299484493466538792766661068428697404447683623975519360000</span> <span class="o">:</span> <span class="n">ℚ</span><span class="o">)</span>
<span class="o">:=</span>
</code></pre></div>



<a name="211408479"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/cheap%20IMO%20problem/near/211408479" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/cheap.20IMO.20problem.html#211408479">(Sep 27 2020 at 09:58)</a>:</h4>
<p>does <code>by norm_num</code> work?</p>



<a name="211409111"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/cheap%20IMO%20problem/near/211409111" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/cheap.20IMO.20problem.html#211409111">(Sep 27 2020 at 10:14)</a>:</h4>
<p>I'm guessing no</p>



<a name="211409115"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/cheap%20IMO%20problem/near/211409115" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/cheap.20IMO.20problem.html#211409115">(Sep 27 2020 at 10:14)</a>:</h4>
<p>But pari does it in a split second</p>



<a name="211409347"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/cheap%20IMO%20problem/near/211409347" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/cheap.20IMO.20problem.html#211409347">(Sep 27 2020 at 10:20)</a>:</h4>
<p>In principle this works -- it reduces things to the scope of <code>norm_num</code>. But <code>norm_num</code> uses too much memory for VSCode. Maybe if you run it with a higher memory limit, or do something clever to simplify intermediate steps, you could make it work. (Not in a split second.)</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">algebra.big_operators.finsupp</span> <span class="n">data.rat</span>

<span class="n">open_locale</span> <span class="n">big_operators</span>

<span class="kd">example</span> <span class="o">:</span> <span class="o">(</span><span class="bp">∑</span> <span class="n">n</span> <span class="k">in</span> <span class="n">finset.range</span> <span class="mi">1320</span><span class="o">,</span> <span class="o">((</span><span class="bp">-</span><span class="mi">1</span><span class="o">)</span><span class="bp">^</span><span class="o">(</span><span class="n">n</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)</span> <span class="bp">/</span> <span class="n">n</span> <span class="o">:</span> <span class="n">ℚ</span><span class="o">))</span>
<span class="bp">=</span>
<span class="o">(</span><span class="mi">9712435370176457211789032112275705035436058023056668172162691122769643536134963388887418503518212227707181887399284421324209991580261372180881066042267340013822543021630993790301871917306672479003742347731906894502206611684973377349822140727866748793472314555146081954133359219693224842345716201562838113110488664229990443258508595332395129617286143580898566908128232436187466371871641095608257859832669859587159077972843255741143946005144546720084104126426401254209483858435525146637078869452056788708944608960016712180409515668301909686056363654039823351264466923197720153813</span>
<span class="bp">/</span>
<span class="mi">14004426370194880461934343682044774391282833031127910746297786781959105584828861694180270900155320736866485178357969757814225700469374818454186270560156419686116542029027696742870488277713573014598870206397512488706141517193426122086231634178080237723065448682598131182597623527313179068878231298472650458406330723014358986732179004322578669107971003162372262774921109835980551500767898797452304799628071849186633284721093163439037683000781898695594646092124867941059532453140720984993275703737648888419223774236963722967299484493466538792766661068428697404447683623975519360000</span> <span class="o">:</span> <span class="n">ℚ</span><span class="o">)</span>
<span class="o">:=</span>
<span class="kd">begin</span>
  <span class="n">iterate</span> <span class="mi">1320</span>
  <span class="o">{</span> <span class="n">transitivity</span><span class="o">,</span>
    <span class="n">apply</span> <span class="n">finset.sum_range_succ</span><span class="o">,</span>
    <span class="n">rw</span> <span class="bp">←</span> <span class="n">eq_sub_iff_add_eq'</span> <span class="o">},</span>
  <span class="n">rw</span> <span class="n">finset.sum_range_zero</span><span class="o">,</span>
  <span class="n">simp</span> <span class="n">only</span> <span class="o">[</span><span class="n">nat.cast_bit0</span><span class="o">,</span> <span class="n">nat.cast_bit1</span><span class="o">,</span> <span class="n">nat.cast_add</span><span class="o">,</span> <span class="n">nat.cast_zero</span><span class="o">,</span> <span class="n">nat.cast_one</span><span class="o">],</span>
  <span class="c1">-- norm_num1,</span>
<span class="kd">end</span>
</code></pre></div>



<a name="211415956"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/cheap%20IMO%20problem/near/211415956" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Miroslav Olšák <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/cheap.20IMO.20problem.html#211415956">(Sep 27 2020 at 13:09)</a>:</h4>
<p>Would it be possible to tell lean to just call <code>#eval</code> to the first expression?</p>



<a name="211416237"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/cheap%20IMO%20problem/near/211416237" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/cheap.20IMO.20problem.html#211416237">(Sep 27 2020 at 13:17)</a>:</h4>
<p>Sure. But #eval is just a calculator; no proofs attached.</p>



<a name="211421110"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/cheap%20IMO%20problem/near/211421110" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yakov Pechersky <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/cheap.20IMO.20problem.html#211421110">(Sep 27 2020 at 15:27)</a>:</h4>
<p>All that's left to do is change the divisibility goal to be on <code>Q</code> instead of <code>N</code>:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">tactic.ring_exp</span>
<span class="kn">import</span> <span class="n">data.matrix.notation</span>
<span class="kn">import</span> <span class="n">data.rat.cast</span>

<span class="n">open_locale</span> <span class="n">big_operators</span>

<span class="kd">def</span> <span class="n">h</span> <span class="o">{</span><span class="n">n</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">}</span> <span class="o">:</span> <span class="n">fin</span> <span class="n">n</span> <span class="bp">→</span> <span class="n">ℚ</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">k</span><span class="o">,</span> <span class="o">(</span><span class="bp">-</span><span class="mi">1</span><span class="o">)</span><span class="bp">^</span><span class="o">((</span><span class="n">k</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span><span class="bp">+</span> <span class="mi">1</span><span class="o">)</span><span class="bp">/</span><span class="n">k</span>

<span class="kd">instance</span> <span class="n">foo</span> <span class="o">:</span> <span class="n">fact</span> <span class="o">(</span><span class="n">nat.prime</span> <span class="mi">1979</span><span class="o">)</span> <span class="o">:=</span> <span class="kd">by</span> <span class="n">norm_num</span>

<span class="kd">@[simp]</span> <span class="kd">lemma</span> <span class="n">fin.coe_sub</span> <span class="o">{</span><span class="n">n</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">}</span> <span class="o">(</span><span class="n">x</span> <span class="n">y</span> <span class="o">:</span> <span class="n">fin</span> <span class="n">n</span><span class="o">)</span> <span class="o">:</span> <span class="o">(((</span><span class="n">x</span> <span class="bp">-</span> <span class="n">y</span><span class="o">)</span> <span class="o">:</span> <span class="n">fin</span> <span class="n">n</span><span class="o">)</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="bp">=</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="bp">-</span> <span class="n">y</span> <span class="o">:=</span>
<span class="kd">by</span> <span class="o">{</span> <span class="n">cases</span> <span class="n">x</span><span class="o">,</span> <span class="n">cases</span> <span class="n">y</span><span class="o">,</span> <span class="n">refl</span> <span class="o">}</span>

<span class="kd">lemma</span> <span class="n">fin.coe_bit0</span> <span class="o">{</span><span class="n">n</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">}</span> <span class="o">{</span><span class="n">x</span> <span class="o">:</span> <span class="n">fin</span> <span class="n">n</span><span class="o">}</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="o">(</span><span class="n">bit0</span> <span class="n">x</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="bp">&lt;</span> <span class="n">n</span><span class="o">)</span> <span class="o">:</span> <span class="o">((</span><span class="n">bit0</span> <span class="n">x</span> <span class="o">:</span> <span class="n">fin</span> <span class="n">n</span><span class="o">)</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="bp">=</span> <span class="n">bit0</span> <span class="n">x</span> <span class="o">:=</span>
<span class="kd">by</span> <span class="o">{</span> <span class="n">cases</span> <span class="n">x</span><span class="o">,</span> <span class="n">exact</span> <span class="n">nat.mod_eq_of_lt</span> <span class="n">h</span> <span class="o">}</span>

<span class="kd">lemma</span> <span class="n">fin.coe_bit1</span> <span class="o">{</span><span class="n">n</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">}</span> <span class="o">{</span><span class="n">x</span> <span class="o">:</span> <span class="n">fin</span> <span class="o">(</span><span class="n">n</span> <span class="bp">+</span> <span class="mi">2</span><span class="o">)}</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="o">(</span><span class="n">bit1</span> <span class="n">x</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="bp">&lt;</span> <span class="n">n</span> <span class="bp">+</span> <span class="mi">2</span><span class="o">)</span> <span class="o">:</span>
  <span class="o">((</span><span class="n">bit1</span> <span class="n">x</span> <span class="o">:</span> <span class="n">fin</span> <span class="o">(</span><span class="n">n</span> <span class="bp">+</span> <span class="mi">2</span><span class="o">))</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="bp">=</span> <span class="n">bit1</span> <span class="n">x</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="n">rw</span> <span class="n">bit1</span> <span class="n">at</span> <span class="n">h</span><span class="o">,</span>
  <span class="n">simpa</span> <span class="n">only</span> <span class="o">[</span><span class="n">bit1</span><span class="o">,</span> <span class="n">fin.coe_add</span><span class="o">,</span>
              <span class="n">fin.coe_bit0</span> <span class="o">(</span><span class="n">lt_of_le_of_lt</span> <span class="o">(</span><span class="n">nat.le_add_right</span> <span class="n">_</span> <span class="n">_</span><span class="o">)</span> <span class="n">h</span><span class="o">)]</span> <span class="n">using</span> <span class="n">nat.mod_eq_of_lt</span> <span class="n">h</span><span class="o">,</span>
<span class="kd">end</span>

<span class="kd">lemma</span> <span class="n">nat.le_add</span> <span class="o">(</span><span class="n">n</span> <span class="n">m</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="o">:</span> <span class="n">n</span> <span class="bp">≤</span> <span class="n">n</span> <span class="bp">+</span> <span class="n">m</span> <span class="o">:=</span>
<span class="n">nat.le.intro</span> <span class="n">rfl</span>

<span class="kn">section</span> <span class="n">hF</span>

<span class="kd">variables</span> <span class="o">{</span><span class="n">n</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">}</span> <span class="o">(</span><span class="n">N</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="n">fin</span> <span class="n">n</span><span class="o">)</span>

<span class="kd">def</span> <span class="n">hF</span> <span class="o">:</span> <span class="n">ℚ</span> <span class="o">:=</span> <span class="mi">1</span> <span class="bp">/</span> <span class="o">((</span><span class="n">N</span> <span class="bp">+</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">))</span> <span class="o">:</span> <span class="n">ℚ</span><span class="o">)</span>

<span class="kd">lemma</span> <span class="n">shift</span> <span class="o">:</span> <span class="n">hF</span> <span class="n">N.succ</span> <span class="n">x.cast_succ</span> <span class="bp">=</span> <span class="n">hF</span> <span class="n">N</span> <span class="n">x.succ</span> <span class="o">:=</span>
<span class="kd">by</span> <span class="o">{</span> <span class="n">simp</span> <span class="o">[</span><span class="n">hF</span><span class="o">],</span> <span class="n">ring_exp</span> <span class="o">}</span>

<span class="kd">lemma</span> <span class="n">shift'</span> <span class="o">:</span> <span class="n">hF</span> <span class="o">(</span><span class="n">N</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)</span> <span class="n">x.cast_succ</span> <span class="bp">=</span> <span class="n">hF</span> <span class="n">N</span> <span class="n">x.succ</span> <span class="o">:=</span>
<span class="kd">by</span> <span class="o">{</span> <span class="n">simp</span> <span class="o">[</span><span class="n">hF</span><span class="o">],</span> <span class="n">ring_exp</span> <span class="o">}</span>

<span class="kd">lemma</span> <span class="n">reduce</span> <span class="o">:</span> <span class="bp">@</span><span class="n">hF</span> <span class="n">n.succ</span> <span class="n">N</span> <span class="n">x.cast_succ</span> <span class="bp">=</span> <span class="bp">@</span><span class="n">hF</span> <span class="n">n</span> <span class="n">N</span> <span class="n">x</span> <span class="o">:=</span>
<span class="kd">by</span> <span class="n">simp</span> <span class="o">[</span><span class="n">hF</span><span class="o">]</span>

<span class="kd">lemma</span> <span class="n">hreduce</span> <span class="o">:</span> <span class="n">h</span> <span class="n">x.cast_succ.cast_succ</span> <span class="bp">=</span> <span class="n">h</span> <span class="n">x</span> <span class="o">:=</span>
<span class="kd">by</span> <span class="n">simp</span> <span class="o">[</span><span class="n">h</span><span class="o">]</span>

<span class="kd">lemma</span> <span class="n">h_to_hF</span> <span class="o">:</span> <span class="o">(</span><span class="bp">∑</span> <span class="n">x</span> <span class="o">:</span> <span class="n">fin</span> <span class="o">(</span><span class="n">N</span> <span class="bp">*</span> <span class="mi">2</span><span class="o">),</span> <span class="n">h</span> <span class="n">x</span><span class="o">)</span> <span class="bp">=</span> <span class="bp">∑</span> <span class="n">x</span> <span class="o">:</span> <span class="n">fin</span> <span class="n">N</span><span class="o">,</span> <span class="n">hF</span> <span class="n">N</span> <span class="n">x</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="n">induction</span> <span class="n">N</span> <span class="k">with</span> <span class="n">N</span> <span class="n">hN</span><span class="o">,</span>
  <span class="o">{</span> <span class="n">refl</span> <span class="o">},</span>
  <span class="n">symmetry</span><span class="o">,</span>
  <span class="n">rw</span> <span class="n">fin.sum_univ_cast_succ</span><span class="o">,</span>
  <span class="n">simp_rw</span> <span class="n">shift</span> <span class="n">N</span><span class="o">,</span>
  <span class="n">rw</span> <span class="o">[</span><span class="bp">←</span><span class="n">add_right_inj</span> <span class="o">(</span><span class="n">hF</span> <span class="n">N</span> <span class="mi">0</span><span class="o">),</span> <span class="bp">←</span><span class="n">add_assoc</span><span class="o">,</span> <span class="bp">←</span><span class="n">fin.sum_univ_succ</span><span class="o">,</span> <span class="n">fin.sum_univ_cast_succ</span><span class="o">],</span>
  <span class="n">simp_rw</span> <span class="n">reduce</span><span class="o">,</span>
  <span class="n">symmetry</span><span class="o">,</span>
  <span class="n">rw</span> <span class="o">[</span><span class="n">nat.succ_mul</span><span class="o">,</span> <span class="n">fin.sum_univ_cast_succ</span><span class="o">,</span> <span class="n">fin.sum_univ_cast_succ</span><span class="o">],</span>
  <span class="n">simp_rw</span> <span class="n">hreduce</span><span class="o">,</span>
  <span class="n">rw</span> <span class="o">[</span><span class="n">hN</span><span class="o">,</span> <span class="bp">←</span><span class="n">add_assoc</span><span class="o">,</span> <span class="bp">←</span><span class="n">add_assoc</span><span class="o">,</span> <span class="n">add_comm</span> <span class="o">(</span><span class="n">hF</span> <span class="n">_</span> <span class="n">_</span><span class="o">),</span> <span class="n">add_assoc</span><span class="o">,</span> <span class="n">add_assoc</span><span class="o">,</span> <span class="n">add_assoc</span><span class="o">],</span>
  <span class="n">congr'</span> <span class="mi">1</span><span class="o">,</span>
  <span class="n">rw</span> <span class="bp">←</span><span class="n">add_assoc</span><span class="o">,</span>
  <span class="n">congr</span><span class="o">,</span>
  <span class="o">{</span> <span class="k">have</span> <span class="n">nh</span> <span class="o">:</span> <span class="o">(</span><span class="bp">-</span><span class="mi">1</span> <span class="o">:</span> <span class="n">ℚ</span><span class="o">)</span> <span class="bp">^</span> <span class="o">(</span><span class="n">N</span> <span class="bp">*</span> <span class="mi">2</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)</span> <span class="bp">=</span> <span class="bp">-</span><span class="mi">1</span><span class="o">,</span>
    <span class="o">{</span> <span class="n">rw</span> <span class="o">[</span><span class="n">mul_comm</span><span class="o">],</span>
      <span class="n">simp</span> <span class="o">[</span><span class="n">pow_add</span><span class="o">,</span> <span class="n">pow_mul</span><span class="o">]</span> <span class="o">},</span>
    <span class="k">have</span> <span class="o">:</span> <span class="o">(</span><span class="n">N</span> <span class="o">:</span> <span class="n">ℚ</span><span class="o">)</span><span class="bp">⁻¹</span> <span class="bp">=</span> <span class="mi">2</span> <span class="bp">/</span> <span class="o">(</span><span class="n">N</span> <span class="bp">*</span> <span class="mi">2</span><span class="o">),</span>
      <span class="o">{</span> <span class="n">norm_num</span> <span class="o">[</span><span class="bp">←</span><span class="n">one_div</span><span class="o">,</span> <span class="n">mul_comm</span><span class="o">,</span> <span class="n">div_mul_eq_div_mul_one_div</span><span class="o">]</span> <span class="o">},</span>
    <span class="n">norm_num</span> <span class="o">[</span><span class="n">h</span><span class="o">,</span> <span class="n">hF</span><span class="o">,</span> <span class="n">nh</span><span class="o">,</span> <span class="n">this</span><span class="o">],</span>
    <span class="n">ring_exp</span> <span class="o">},</span>
  <span class="o">{</span> <span class="k">have</span> <span class="n">nh</span> <span class="o">:</span> <span class="o">(</span><span class="bp">-</span><span class="mi">1</span> <span class="o">:</span> <span class="n">ℚ</span><span class="o">)</span> <span class="bp">^</span> <span class="o">(</span><span class="n">N</span> <span class="bp">*</span> <span class="mi">2</span> <span class="bp">+</span> <span class="mi">1</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)</span> <span class="bp">=</span> <span class="mi">1</span><span class="o">,</span>
    <span class="o">{</span> <span class="n">rw</span> <span class="o">[</span><span class="n">mul_comm</span><span class="o">],</span>
      <span class="n">simp</span> <span class="o">[</span><span class="n">pow_add</span><span class="o">,</span> <span class="n">pow_mul</span><span class="o">]</span> <span class="o">},</span>
    <span class="n">norm_num</span> <span class="o">[</span><span class="n">h</span><span class="o">,</span> <span class="n">hF</span><span class="o">,</span> <span class="n">nh</span><span class="o">],</span>
    <span class="n">ring_exp</span> <span class="o">}</span>
<span class="kd">end</span>

<span class="kd">end</span> <span class="n">hF</span>

<span class="kn">section</span> <span class="n">nums</span>

<span class="kd">lemma</span> <span class="n">coe_659</span> <span class="o">:</span> <span class="o">((</span><span class="mi">659</span> <span class="o">:</span> <span class="n">fin</span> <span class="mi">660</span><span class="o">)</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="bp">=</span> <span class="mi">659</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="n">rw</span> <span class="o">[</span><span class="n">fin.coe_bit1</span><span class="o">,</span> <span class="n">fin.coe_bit1</span><span class="o">,</span> <span class="n">fin.coe_bit0</span><span class="o">,</span> <span class="n">fin.coe_bit0</span><span class="o">,</span> <span class="n">fin.coe_bit1</span><span class="o">,</span>
      <span class="n">fin.coe_bit0</span><span class="o">,</span> <span class="n">fin.coe_bit0</span><span class="o">,</span> <span class="n">fin.coe_bit1</span><span class="o">,</span> <span class="n">fin.coe_bit0</span><span class="o">],</span>
  <span class="n">simp</span> <span class="n">only</span> <span class="o">[</span><span class="n">fin.coe_one</span><span class="o">],</span>
  <span class="n">all_goals</span> <span class="o">{</span> <span class="n">dec_trivial</span> <span class="o">}</span>
<span class="kd">end</span>

<span class="kd">lemma</span> <span class="n">pos_660</span> <span class="o">:</span> <span class="o">(</span><span class="mi">0</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="bp">&lt;</span> <span class="mi">660</span> <span class="o">:=</span> <span class="n">dec_trivial</span>

<span class="kd">lemma</span> <span class="n">posQ_660</span> <span class="o">:</span> <span class="o">(</span><span class="mi">0</span> <span class="o">:</span> <span class="n">ℚ</span><span class="o">)</span> <span class="bp">&lt;</span> <span class="mi">660</span> <span class="o">:=</span> <span class="n">nat.cast_lt.mpr</span> <span class="n">pos_660</span>

<span class="kd">lemma</span> <span class="n">expand</span> <span class="o">(</span><span class="n">d</span> <span class="o">:</span> <span class="n">fin</span> <span class="mi">660</span><span class="o">)</span> <span class="o">:</span> <span class="n">hF</span> <span class="mi">660</span> <span class="n">d</span> <span class="bp">+</span> <span class="n">hF</span> <span class="mi">660</span> <span class="o">(</span><span class="mi">659</span> <span class="bp">-</span> <span class="n">d</span><span class="o">)</span> <span class="bp">=</span> <span class="mi">1979</span> <span class="bp">/</span> <span class="o">((</span><span class="mi">660</span> <span class="bp">+</span> <span class="n">d</span><span class="o">)</span> <span class="bp">*</span> <span class="o">(</span><span class="mi">1319</span> <span class="bp">-</span> <span class="n">d</span><span class="o">))</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="n">obtain</span> <span class="o">⟨</span><span class="n">d</span><span class="o">,</span> <span class="n">dlim</span><span class="o">⟩</span> <span class="o">:=</span> <span class="n">d</span><span class="o">,</span>
  <span class="n">simp</span> <span class="n">only</span> <span class="o">[</span><span class="n">hF</span><span class="o">,</span> <span class="n">one_div</span><span class="o">],</span>
  <span class="n">rw</span> <span class="n">inv_add_inv</span><span class="o">,</span>
  <span class="n">simp</span> <span class="n">only</span> <span class="o">[</span><span class="n">nat.cast_bit0</span><span class="o">,</span> <span class="n">nat.cast_bit1</span><span class="o">,</span> <span class="n">nat.cast_one</span><span class="o">,</span> <span class="n">fin.coe_mk</span><span class="o">,</span> <span class="n">fin.coe_sub</span><span class="o">,</span> <span class="n">coe_659</span><span class="o">,</span>
              <span class="n">nat.cast_sub</span> <span class="o">(</span><span class="n">nat.le_of_succ_le_succ</span> <span class="n">dlim</span><span class="o">),</span> <span class="n">coe_coe</span><span class="o">],</span>
  <span class="n">refine</span> <span class="n">congr_arg2</span> <span class="n">has_div.div</span> <span class="n">_</span> <span class="n">_</span><span class="o">,</span>
  <span class="o">{</span> <span class="n">rw</span> <span class="n">add_assoc</span><span class="o">,</span>
    <span class="n">rw</span> <span class="n">add_comm</span><span class="o">,</span>
    <span class="n">rw</span> <span class="bp">←</span><span class="n">eq_sub_iff_add_eq</span><span class="o">,</span>
    <span class="n">rw</span> <span class="n">add_comm</span><span class="o">,</span>
    <span class="n">rw</span> <span class="n">add_assoc</span><span class="o">,</span>
    <span class="n">norm_num</span> <span class="o">},</span>
  <span class="o">{</span> <span class="n">rw</span> <span class="n">add_sub</span><span class="o">,</span>
    <span class="n">norm_num</span> <span class="o">},</span>
  <span class="o">{</span> <span class="n">simp</span> <span class="n">only</span> <span class="o">[</span><span class="n">nat.cast_bit0</span><span class="o">,</span> <span class="n">nat.cast_bit1</span><span class="o">,</span> <span class="n">nat.cast_one</span><span class="o">,</span> <span class="n">fin.coe_mk</span><span class="o">],</span>
    <span class="n">norm_cast</span><span class="o">,</span>
    <span class="n">exact</span> <span class="n">ne_of_gt</span> <span class="o">(</span><span class="n">lt_of_lt_of_le</span> <span class="n">pos_660</span> <span class="o">(</span><span class="n">nat.le_add</span> <span class="mi">660</span> <span class="n">d</span><span class="o">))</span> <span class="o">},</span>
  <span class="o">{</span> <span class="n">simp</span> <span class="n">only</span> <span class="o">[</span><span class="n">nat.cast_bit0</span><span class="o">,</span> <span class="n">nat.cast_bit1</span><span class="o">,</span> <span class="n">nat.cast_one</span><span class="o">,</span> <span class="n">fin.coe_mk</span><span class="o">],</span>
    <span class="n">refine</span> <span class="n">ne_of_gt</span> <span class="o">(</span><span class="n">lt_of_lt_of_le</span> <span class="n">posQ_660</span> <span class="n">_</span><span class="o">),</span>
    <span class="n">exact</span> <span class="n">le_add_of_nonneg_right</span> <span class="o">(</span><span class="n">nat.cast_nonneg</span> <span class="n">_</span><span class="o">)</span> <span class="o">}</span>
<span class="kd">end</span>

<span class="kd">lemma</span> <span class="n">expand'</span> <span class="o">(</span><span class="n">d</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="n">d</span> <span class="bp">&lt;</span> <span class="mi">331</span><span class="o">)</span> <span class="o">:</span>
<span class="o">(</span><span class="bp">∑</span> <span class="n">x</span> <span class="o">:</span> <span class="n">fin</span> <span class="o">(</span><span class="n">d</span> <span class="bp">*</span> <span class="mi">2</span><span class="o">),</span> <span class="n">hF</span> <span class="o">(</span><span class="mi">990</span> <span class="bp">-</span> <span class="n">d</span><span class="o">)</span> <span class="n">x</span><span class="o">)</span> <span class="bp">=</span> <span class="bp">∑</span> <span class="n">x</span> <span class="o">:</span> <span class="n">fin</span> <span class="n">d</span><span class="o">,</span> <span class="o">((</span><span class="mi">1979</span> <span class="o">:</span> <span class="n">ℚ</span><span class="o">)</span> <span class="bp">/</span> <span class="o">((</span><span class="mi">990</span> <span class="bp">+</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">))</span> <span class="bp">*</span> <span class="o">(</span><span class="mi">989</span> <span class="bp">-</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">))))</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="n">induction</span> <span class="n">d</span> <span class="k">with</span> <span class="n">d</span> <span class="n">hd</span><span class="o">,</span>
  <span class="o">{</span> <span class="n">rw</span> <span class="n">zero_mul</span><span class="o">,</span>
    <span class="n">simp</span> <span class="n">only</span> <span class="o">[</span><span class="n">fin.sum_univ_zero</span><span class="o">]</span> <span class="o">},</span>
  <span class="o">{</span> <span class="k">have</span> <span class="n">h'</span> <span class="o">:=</span> <span class="n">nat.lt_of_succ_lt</span> <span class="n">h</span><span class="o">,</span>
    <span class="k">have</span> <span class="n">h''</span> <span class="o">:=</span> <span class="n">nat.mul_lt_mul</span> <span class="n">h'</span> <span class="o">(</span><span class="n">le_refl</span> <span class="mi">2</span><span class="o">)</span> <span class="o">(</span><span class="kd">by</span> <span class="n">dec_trivial</span><span class="o">),</span>
    <span class="k">have</span> <span class="n">h'''</span> <span class="o">:=</span> <span class="n">nat.mul_lt_mul</span> <span class="n">h</span> <span class="o">(</span><span class="n">le_refl</span> <span class="mi">2</span><span class="o">)</span> <span class="o">(</span><span class="kd">by</span> <span class="n">dec_trivial</span><span class="o">),</span>
    <span class="n">rw</span> <span class="n">nat.succ_mul</span> <span class="n">at</span> <span class="n">h'''</span><span class="o">,</span>
    <span class="n">rw</span> <span class="n">nat.succ_mul</span><span class="o">,</span>
    <span class="n">rw</span> <span class="n">fin.sum_univ_succ</span><span class="o">,</span>
    <span class="n">rw</span> <span class="n">fin.sum_univ_cast_succ</span><span class="o">,</span>
    <span class="n">rw</span> <span class="n">add_comm</span><span class="o">,</span>
    <span class="n">rw</span> <span class="n">add_assoc</span><span class="o">,</span>
    <span class="n">simp_rw</span> <span class="bp">←</span><span class="n">shift'</span><span class="o">,</span>
    <span class="n">simp_rw</span> <span class="n">reduce</span><span class="o">,</span>
    <span class="k">have</span> <span class="o">:</span> <span class="mi">990</span> <span class="bp">-</span> <span class="n">d.succ</span> <span class="bp">+</span> <span class="mi">1</span> <span class="bp">=</span> <span class="mi">990</span> <span class="bp">-</span> <span class="n">d</span><span class="o">,</span>
      <span class="o">{</span> <span class="n">rw</span> <span class="bp">←</span><span class="n">nat.sub_sub_assoc</span><span class="o">,</span>
        <span class="n">refl</span><span class="o">,</span>
        <span class="n">refine</span> <span class="n">le_of_lt</span> <span class="o">(</span><span class="n">lt_trans</span> <span class="n">h</span> <span class="n">_</span><span class="o">),</span>
        <span class="n">norm_num</span><span class="o">,</span>
        <span class="n">exact</span> <span class="n">nat.succ_pos'</span> <span class="o">},</span>
    <span class="n">rw</span> <span class="n">this</span><span class="o">,</span>
    <span class="n">clear</span> <span class="n">this</span><span class="o">,</span>
    <span class="n">rw</span> <span class="n">hd</span> <span class="n">h'</span><span class="o">,</span>
    <span class="n">rw</span> <span class="n">fin.sum_univ_cast_succ</span><span class="o">,</span>
    <span class="n">congr'</span> <span class="mi">1</span><span class="o">,</span>
    <span class="n">simp</span> <span class="n">only</span> <span class="o">[</span><span class="n">hF</span><span class="o">,</span> <span class="n">one_div</span><span class="o">,</span> <span class="n">add_zero</span><span class="o">,</span> <span class="n">fin.coe_zero</span><span class="o">,</span> <span class="n">nat.succ_sub_succ_eq_sub</span><span class="o">,</span> <span class="n">fin.coe_last</span><span class="o">,</span> <span class="n">nat.cast_bit0</span><span class="o">,</span> <span class="n">nat.cast_zero</span><span class="o">,</span>
 <span class="n">nat.cast_one</span><span class="o">,</span> <span class="n">nat.cast_mul</span><span class="o">],</span>
    <span class="n">rw</span> <span class="n">mul_two</span><span class="o">,</span>
    <span class="n">rw</span> <span class="bp">←</span><span class="n">add_assoc</span><span class="o">,</span>
    <span class="n">norm_cast</span><span class="o">,</span>
    <span class="k">have</span> <span class="n">le990</span> <span class="o">:</span> <span class="n">d</span> <span class="bp">≤</span> <span class="mi">990</span><span class="o">,</span>
      <span class="o">{</span> <span class="n">refine</span> <span class="n">le_of_lt</span> <span class="o">(</span><span class="n">lt_trans</span> <span class="n">h'</span> <span class="n">_</span><span class="o">),</span>
        <span class="n">norm_num</span> <span class="o">},</span>
    <span class="k">have</span> <span class="n">le989</span> <span class="o">:</span> <span class="n">d</span> <span class="bp">≤</span> <span class="mi">989</span><span class="o">,</span>
      <span class="o">{</span> <span class="n">refine</span> <span class="n">le_of_lt</span> <span class="o">(</span><span class="n">lt_trans</span> <span class="n">h'</span> <span class="n">_</span><span class="o">),</span>
        <span class="n">norm_num</span> <span class="o">},</span>
    <span class="n">rw</span> <span class="n">nat.sub_add_cancel</span> <span class="n">le990</span><span class="o">,</span>
    <span class="n">rw</span> <span class="n">inv_add_inv</span><span class="o">,</span>
    <span class="n">refine</span> <span class="n">congr_arg2</span> <span class="n">has_div.div</span> <span class="n">_</span> <span class="n">_</span><span class="o">,</span>
    <span class="o">{</span> <span class="n">norm_cast</span><span class="o">,</span>
      <span class="n">rw</span> <span class="n">add_assoc</span><span class="o">,</span>
      <span class="n">rw</span> <span class="n">nat.add_sub_cancel'</span> <span class="n">le989</span><span class="o">,</span>
      <span class="n">norm_num</span> <span class="o">},</span>
    <span class="o">{</span> <span class="n">norm_cast</span> <span class="o">},</span>
    <span class="o">{</span> <span class="n">rw</span> <span class="n">nat.cast_ne_zero</span><span class="o">,</span>
      <span class="n">refine</span> <span class="n">ne_of_gt</span> <span class="o">(</span><span class="n">lt_of_lt_of_le</span> <span class="n">_</span> <span class="o">(</span><span class="n">nat.le_add</span> <span class="mi">990</span> <span class="n">d</span><span class="o">)),</span>
      <span class="n">norm_num</span> <span class="o">},</span>
    <span class="o">{</span> <span class="n">rw</span> <span class="n">nat.cast_ne_zero</span><span class="o">,</span>
      <span class="n">refine</span> <span class="n">ne_of_gt</span> <span class="n">_</span><span class="o">,</span>
      <span class="n">refine</span> <span class="n">nat.sub_pos_of_lt</span> <span class="n">_</span><span class="o">,</span>
      <span class="n">refine</span> <span class="n">lt_trans</span> <span class="n">h'</span> <span class="n">_</span><span class="o">,</span>
      <span class="n">norm_num</span> <span class="o">}</span> <span class="o">}</span>
<span class="kd">end</span>

<span class="kd">lemma</span> <span class="n">sub_659</span> <span class="o">:</span> <span class="n">fin.last</span> <span class="mi">659</span> <span class="bp">=</span> <span class="o">(</span><span class="mi">659</span> <span class="o">:</span> <span class="n">fin</span> <span class="mi">660</span><span class="o">)</span> <span class="bp">-</span> <span class="o">(</span><span class="mi">0</span> <span class="o">:</span> <span class="n">fin</span> <span class="mi">660</span><span class="o">)</span> <span class="o">:=</span> <span class="n">rfl</span>

<span class="kd">end</span> <span class="n">nums</span>

<span class="kd">theorem</span> <span class="n">imo</span> <span class="o">(</span><span class="n">p</span> <span class="n">q</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="o">:</span> <span class="o">(</span><span class="n">p</span> <span class="o">:</span> <span class="n">ℚ</span><span class="o">)</span> <span class="bp">/</span> <span class="n">q</span> <span class="bp">=</span>
<span class="c1">-- 1 - (1/2) + (1/3) - (1/4) + ... + (1/1319),</span>
<span class="bp">∑</span> <span class="n">x</span> <span class="o">:</span> <span class="n">fin</span> <span class="mi">1320</span><span class="o">,</span> <span class="n">h</span> <span class="n">x</span>
<span class="bp">→</span> <span class="mi">1979</span> <span class="bp">∣</span> <span class="n">p</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="n">intro</span> <span class="n">F</span><span class="o">,</span>
  <span class="n">rw</span> <span class="o">(</span><span class="k">show</span> <span class="mi">1320</span> <span class="bp">=</span> <span class="mi">660</span> <span class="bp">*</span> <span class="mi">2</span><span class="o">,</span> <span class="kd">by</span> <span class="n">norm_num</span><span class="o">)</span> <span class="n">at</span> <span class="n">F</span><span class="o">,</span>
  <span class="n">rw</span> <span class="n">h_to_hF</span> <span class="n">at</span> <span class="n">F</span><span class="o">,</span>
  <span class="n">rw</span> <span class="o">(</span><span class="k">show</span> <span class="mi">660</span> <span class="bp">=</span> <span class="mi">330</span> <span class="bp">*</span> <span class="mi">2</span><span class="o">,</span> <span class="kd">by</span> <span class="n">norm_num</span><span class="o">)</span> <span class="n">at</span> <span class="n">F</span><span class="o">,</span>
  <span class="k">have</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">x</span> <span class="o">:</span> <span class="n">fin</span> <span class="o">(</span><span class="mi">330</span> <span class="bp">*</span> <span class="mi">2</span><span class="o">),</span> <span class="n">hF</span> <span class="o">(</span><span class="mi">330</span> <span class="bp">*</span> <span class="mi">2</span><span class="o">)</span> <span class="n">x</span> <span class="bp">=</span> <span class="n">hF</span> <span class="o">(</span><span class="mi">990</span> <span class="bp">-</span> <span class="mi">330</span><span class="o">)</span> <span class="n">x</span><span class="o">,</span>
    <span class="o">{</span> <span class="n">intro</span> <span class="n">x</span><span class="o">,</span>
      <span class="n">simp_rw</span> <span class="o">(</span><span class="k">show</span> <span class="mi">330</span> <span class="bp">*</span> <span class="mi">2</span> <span class="bp">=</span> <span class="mi">990</span> <span class="bp">-</span> <span class="mi">330</span><span class="o">,</span> <span class="kd">by</span> <span class="n">norm_num</span><span class="o">)</span> <span class="o">},</span>
  <span class="n">simp_rw</span> <span class="n">this</span> <span class="n">at</span> <span class="n">F</span><span class="o">,</span>
  <span class="n">rw</span> <span class="n">expand'</span> <span class="mi">330</span> <span class="o">(</span><span class="kd">by</span> <span class="n">norm_num</span><span class="o">)</span> <span class="n">at</span> <span class="n">F</span><span class="o">,</span>
  <span class="n">simp_rw</span> <span class="n">division_def</span> <span class="n">at</span> <span class="n">F</span><span class="o">,</span>
  <span class="n">rw</span> <span class="bp">←</span><span class="n">finset.mul_sum</span> <span class="n">at</span> <span class="n">F</span><span class="o">,</span>
  <span class="n">set</span> <span class="n">S</span> <span class="o">:=</span> <span class="o">(</span><span class="bp">∑</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="n">fin</span> <span class="mi">330</span><span class="o">),</span> <span class="o">(((</span><span class="mi">990</span> <span class="o">:</span> <span class="n">ℚ</span><span class="o">)</span> <span class="bp">+</span> <span class="n">x</span><span class="o">)</span> <span class="bp">*</span> <span class="o">(</span><span class="mi">989</span> <span class="bp">-</span> <span class="n">x</span><span class="o">))</span><span class="bp">⁻¹</span><span class="o">)</span> <span class="k">with</span> <span class="n">hS</span><span class="o">,</span>
  <span class="n">simp_rw</span> <span class="o">[</span><span class="n">coe_coe</span><span class="o">]</span> <span class="n">at</span> <span class="n">hS</span><span class="o">,</span>
  <span class="n">rw</span> <span class="bp">←</span><span class="n">hS</span> <span class="n">at</span> <span class="n">F</span><span class="o">,</span>
  <span class="n">sorry</span>
  <span class="c">/-</span><span class="cm"></span>
<span class="cm">p q : ℕ,</span>
<span class="cm">this : ∀ (x : fin (330 * 2)), hF (330 * 2) x = hF (990 - 330) x,</span>
<span class="cm">S : ℚ := ∑ (x : fin 330), ((990 + ↑x) * (989 - ↑x))⁻¹,</span>
<span class="cm">hS : S = ∑ (x : fin 330), ((990 + ↑↑x) * (989 - ↑↑x))⁻¹,</span>
<span class="cm">F : ↑p * (↑q)⁻¹ = 1979 * S</span>
<span class="cm">⊢ 1979 ∣ p</span>
<span class="cm">-/</span>

<span class="kd">end</span>
</code></pre></div>



<a name="211421123"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/cheap%20IMO%20problem/near/211421123" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yakov Pechersky <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/cheap.20IMO.20problem.html#211421123">(Sep 27 2020 at 15:27)</a>:</h4>
<p>Can definitely be cleaned up.</p>



<a name="211421843"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/cheap%20IMO%20problem/near/211421843" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/cheap.20IMO.20problem.html#211421843">(Sep 27 2020 at 15:44)</a>:</h4>
<p>I tried with the finset approach (no fin) and it ended up looking like this:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">tactic</span>
<span class="kn">import</span> <span class="n">algebra.big_operators.ring</span>
<span class="kn">import</span> <span class="n">data.nat.parity</span>
<span class="kn">import</span> <span class="n">data.finset.intervals</span>
<span class="kn">import</span> <span class="n">data.padics.hensel</span>

<span class="n">open_locale</span> <span class="n">big_operators</span>

<span class="kn">open</span> <span class="n">finset</span>

<span class="kn">open</span> <span class="n">nat</span>

<span class="kd">instance</span> <span class="n">foo</span> <span class="o">:</span> <span class="n">fact</span> <span class="o">(</span><span class="n">nat.prime</span> <span class="mi">1979</span><span class="o">)</span> <span class="o">:=</span> <span class="kd">by</span> <span class="n">norm_num</span>

<span class="kn">open</span> <span class="n">finset</span>

<span class="c1">--example (k : Type) [comm_ring k] (a b : k) : k := a - b</span>

<span class="kn">namespace</span> <span class="n">imo1979q1</span>

<span class="c1">-- some constants</span>
<span class="kd">@[reducible]</span> <span class="kd">def</span> <span class="n">a</span> <span class="o">:</span> <span class="n">ℚ</span> <span class="o">:=</span> <span class="bp">∑</span> <span class="n">n</span> <span class="k">in</span> <span class="n">range</span> <span class="mi">1320</span><span class="o">,</span> <span class="o">(</span><span class="bp">-</span><span class="mi">1</span><span class="o">)</span><span class="bp">^</span><span class="o">(</span><span class="n">n</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)</span> <span class="bp">/</span> <span class="n">n</span>
<span class="kd">@[reducible]</span> <span class="kd">def</span> <span class="n">b</span> <span class="o">:</span> <span class="n">ℚ</span> <span class="o">:=</span> <span class="bp">∑</span> <span class="n">n</span> <span class="k">in</span> <span class="n">range</span> <span class="mi">1320</span><span class="o">,</span> <span class="mi">1</span> <span class="bp">/</span> <span class="n">n</span>
<span class="kd">@[reducible]</span> <span class="kd">def</span> <span class="n">c</span> <span class="o">:</span> <span class="n">ℚ</span> <span class="o">:=</span> <span class="bp">∑</span> <span class="n">n</span> <span class="k">in</span> <span class="n">range</span> <span class="mi">660</span><span class="o">,</span> <span class="mi">1</span> <span class="bp">/</span> <span class="n">n</span>
<span class="kd">@[reducible]</span> <span class="kd">def</span> <span class="n">d</span> <span class="o">:</span> <span class="n">ℚ</span> <span class="o">:=</span> <span class="bp">∑</span> <span class="n">n</span> <span class="k">in</span> <span class="n">Ico</span> <span class="mi">660</span> <span class="mi">1320</span><span class="o">,</span> <span class="mi">1</span> <span class="bp">/</span> <span class="n">n</span>
<span class="kd">@[reducible]</span> <span class="kd">def</span> <span class="n">e</span> <span class="o">:</span> <span class="n">ℚ</span> <span class="o">:=</span> <span class="bp">∑</span> <span class="n">n</span> <span class="k">in</span> <span class="n">range</span> <span class="mi">330</span><span class="o">,</span> <span class="mi">1</span> <span class="bp">/</span> <span class="o">(</span><span class="n">n</span> <span class="bp">+</span> <span class="mi">660</span><span class="o">)</span>
<span class="kd">@[reducible]</span> <span class="kd">def</span> <span class="n">f</span> <span class="o">:</span> <span class="n">ℚ</span> <span class="o">:=</span> <span class="bp">∑</span> <span class="n">n</span> <span class="k">in</span> <span class="n">range</span> <span class="mi">330</span><span class="o">,</span> <span class="mi">1</span> <span class="bp">/</span> <span class="o">(</span><span class="mi">1319</span> <span class="bp">-</span> <span class="n">n</span><span class="o">)</span>

<span class="c">/-</span><span class="cm"></span>
<span class="cm">  We start with some lemmas:</span>

<span class="cm">  Lemma 1 : b - a = c</span>
<span class="cm">  Lemma 2 : c + d = b (and hence a = d)</span>
<span class="cm">  Lemma 3 : d = e + f</span>

<span class="cm">  Then we prove the theorem, by showing the 1979-adic</span>
<span class="cm">  valuation of e + f is positive.</span>
<span class="cm">-/</span>

<span class="kd">@[reducible]</span> <span class="kd">def</span> <span class="n">double</span> <span class="o">:</span> <span class="n">ℕ</span> <span class="bp">↪</span> <span class="n">ℕ</span> <span class="o">:=</span> <span class="o">⟨</span><span class="bp">λ</span> <span class="n">n</span><span class="o">,</span> <span class="mi">2</span> <span class="bp">*</span> <span class="n">n</span><span class="o">,</span> <span class="bp">λ</span> <span class="n">a</span> <span class="n">b</span><span class="o">,</span> <span class="n">mul_left_cancel'</span> <span class="o">(</span><span class="kd">by</span> <span class="n">norm_num</span><span class="o">)⟩</span>
<span class="c1">--@[reducible] def</span>
<span class="kd">lemma</span> <span class="n">lemma1</span> <span class="o">:</span> <span class="n">b</span> <span class="bp">-</span> <span class="n">a</span> <span class="bp">=</span> <span class="n">c</span> <span class="o">:=</span>
  <span class="k">calc</span> <span class="n">b</span> <span class="bp">-</span> <span class="n">a</span> <span class="bp">=</span> <span class="bp">∑</span> <span class="n">n</span> <span class="k">in</span> <span class="n">range</span> <span class="mi">1320</span><span class="o">,</span> <span class="o">(</span><span class="mi">1</span><span class="bp">/</span><span class="n">n</span> <span class="bp">-</span> <span class="o">(</span><span class="bp">-</span><span class="mi">1</span><span class="o">)</span><span class="bp">^</span><span class="o">(</span><span class="n">n</span><span class="bp">+</span><span class="mi">1</span><span class="o">)</span><span class="bp">/</span><span class="n">n</span><span class="o">)</span> <span class="o">:</span> <span class="kd">by</span> <span class="n">rw</span> <span class="n">sum_sub_distrib</span>
    <span class="bp">...</span> <span class="bp">=</span> <span class="bp">∑</span> <span class="n">n</span> <span class="k">in</span> <span class="n">range</span> <span class="mi">1320</span><span class="o">,</span> <span class="n">ite</span> <span class="o">(</span><span class="n">even</span> <span class="n">n</span><span class="o">)</span> <span class="o">(</span><span class="mi">2</span><span class="bp">/</span><span class="n">n</span><span class="o">)</span> <span class="mi">0</span> <span class="o">:</span> <span class="kd">by</span> <span class="o">{</span>
      <span class="n">apply</span> <span class="n">sum_congr</span> <span class="n">rfl</span><span class="o">,</span>
      <span class="n">rintros</span> <span class="n">x</span> <span class="n">hx</span><span class="o">,</span>
      <span class="n">rw</span> <span class="o">[</span><span class="n">pow_add</span><span class="o">,</span> <span class="n">pow_one</span><span class="o">,</span> <span class="n">mul_neg_one</span><span class="o">,</span> <span class="n">neg_div</span><span class="o">,</span> <span class="n">sub_neg_eq_add</span><span class="o">,</span> <span class="bp">←</span> <span class="n">_root_.add_div</span><span class="o">],</span>
      <span class="n">split_ifs</span><span class="o">,</span>
      <span class="o">{</span> <span class="n">rcases</span> <span class="n">h</span> <span class="k">with</span> <span class="o">⟨</span><span class="n">n</span><span class="o">,</span> <span class="n">rfl</span><span class="o">⟩,</span>
        <span class="n">rw</span> <span class="o">[</span><span class="n">pow_mul</span><span class="o">,</span> <span class="n">pow_two</span><span class="o">],</span>
        <span class="n">simp</span><span class="o">,</span> <span class="n">norm_num</span> <span class="o">},</span>
      <span class="o">{</span> <span class="n">rw</span> <span class="n">not_even_iff</span> <span class="n">at</span> <span class="n">h</span><span class="o">,</span>
        <span class="k">have</span> <span class="n">h8</span> <span class="o">:=</span> <span class="n">nat.mod_add_div</span> <span class="n">x</span> <span class="mi">2</span><span class="o">,</span>
        <span class="n">rw</span> <span class="n">h</span> <span class="n">at</span> <span class="n">h8</span><span class="o">,</span>
        <span class="k">suffices</span> <span class="o">:</span> <span class="o">(</span><span class="mi">1</span> <span class="o">:</span> <span class="n">ℚ</span><span class="o">)</span> <span class="bp">+</span> <span class="o">(</span><span class="bp">-</span><span class="mi">1</span><span class="o">)</span><span class="bp">^</span><span class="n">x</span> <span class="bp">=</span> <span class="mi">0</span><span class="o">,</span>
          <span class="n">rw</span> <span class="n">this</span><span class="o">,</span> <span class="n">simp</span><span class="o">,</span>
        <span class="n">rw</span> <span class="bp">←</span> <span class="n">h8</span><span class="o">,</span>
        <span class="n">simp</span> <span class="o">[</span><span class="n">pow_add</span><span class="o">,</span> <span class="n">pow_mul</span><span class="o">],</span>
      <span class="o">}</span>
    <span class="o">}</span>
    <span class="bp">...</span> <span class="bp">=</span> <span class="bp">∑</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="k">in</span> <span class="n">filter</span> <span class="n">even</span> <span class="o">(</span><span class="n">range</span> <span class="mi">1320</span><span class="o">),</span> <span class="mi">2</span> <span class="bp">/</span> <span class="n">x</span> <span class="o">:</span> <span class="kd">by</span> <span class="n">rw</span> <span class="n">sum_filter</span>
    <span class="bp">...</span> <span class="bp">=</span> <span class="bp">∑</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="k">in</span> <span class="n">map</span> <span class="n">double</span> <span class="o">(</span><span class="n">range</span> <span class="mi">660</span><span class="o">),</span> <span class="o">(</span><span class="mi">2</span> <span class="o">:</span> <span class="n">ℚ</span><span class="o">)</span> <span class="bp">/</span> <span class="n">x</span> <span class="o">:</span> <span class="kd">by</span> <span class="o">{</span>
      <span class="c1">-- extract_goal, -- problem not observed</span>
      <span class="n">apply</span> <span class="n">sum_congr</span><span class="o">,</span> <span class="n">swap</span><span class="o">,</span> <span class="n">simp</span><span class="o">,</span>
      <span class="n">apply</span> <span class="n">finset.subset.antisymm</span><span class="o">,</span>
      <span class="o">{</span> <span class="c1">--extract_goal, -- problem not observed</span>
        <span class="n">intros</span> <span class="n">x</span> <span class="n">hx</span><span class="o">,</span>
        <span class="n">rw</span> <span class="n">mem_filter</span> <span class="n">at</span> <span class="n">hx</span><span class="o">,</span>
        <span class="n">rcases</span> <span class="n">hx</span> <span class="k">with</span> <span class="o">⟨</span><span class="n">hx1</span><span class="o">,</span> <span class="n">m</span><span class="o">,</span> <span class="n">rfl</span><span class="o">⟩,</span>
        <span class="n">rw</span> <span class="n">mem_map</span><span class="o">,</span>
        <span class="c1">--extract_goal, -- problem not observed</span>
        <span class="c1">-- uncommenting this times out</span>
        <span class="c1">-- use m,                          -- &lt;&lt; timeout</span>
         <span class="n">existsi</span> <span class="n">m</span><span class="o">,</span> <span class="c1">-- works fine</span>
         <span class="n">existsi</span> <span class="n">_</span><span class="o">,</span> <span class="n">refl</span><span class="o">,</span>
         <span class="n">rw</span> <span class="n">mem_range</span> <span class="n">at</span> <span class="n">hx1</span> <span class="bp">⊢</span><span class="o">,</span>
         <span class="n">linarith</span> <span class="o">},</span>
      <span class="o">{</span> <span class="n">intros</span> <span class="n">x</span> <span class="n">hx</span><span class="o">,</span>
        <span class="n">rw</span> <span class="n">mem_filter</span><span class="o">,</span>
        <span class="n">rw</span> <span class="n">mem_map</span> <span class="n">at</span> <span class="n">hx</span><span class="o">,</span>
        <span class="n">rcases</span> <span class="n">hx</span> <span class="k">with</span> <span class="o">⟨</span><span class="n">a</span><span class="o">,</span> <span class="n">ha</span><span class="o">,</span> <span class="n">rfl</span><span class="o">⟩,</span>
        <span class="n">split</span><span class="o">,</span>
        <span class="o">{</span> <span class="n">rw</span> <span class="n">mem_range</span> <span class="n">at</span> <span class="n">ha</span> <span class="bp">⊢</span><span class="o">,</span>
          <span class="n">change</span> <span class="mi">2</span> <span class="bp">*</span> <span class="n">a</span> <span class="bp">&lt;</span> <span class="mi">1320</span><span class="o">,</span>
          <span class="n">linarith</span> <span class="o">},</span>
        <span class="o">{</span> <span class="n">existsi</span> <span class="n">a</span><span class="o">,</span>
          <span class="n">refl</span>
        <span class="o">}</span>
      <span class="o">}</span>
    <span class="o">}</span>
    <span class="bp">...</span> <span class="bp">=</span> <span class="n">c</span> <span class="o">:</span> <span class="kd">by</span> <span class="o">{</span>
      <span class="n">rw</span> <span class="n">sum_map</span> <span class="o">(</span><span class="n">range</span> <span class="mi">660</span><span class="o">)</span> <span class="n">double</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">n</span><span class="o">,</span> <span class="o">(</span><span class="mi">2</span> <span class="o">:</span> <span class="n">ℚ</span><span class="o">)</span> <span class="bp">/</span> <span class="n">n</span><span class="o">),</span>
      <span class="n">apply</span> <span class="n">sum_congr</span><span class="o">,</span> <span class="n">refl</span><span class="o">,</span> <span class="c1">-- is there a better way?</span>
      <span class="n">intros</span> <span class="n">x</span> <span class="n">hx</span><span class="o">,</span>
      <span class="k">show</span> <span class="o">(</span><span class="mi">2</span> <span class="o">:</span> <span class="n">ℚ</span><span class="o">)</span> <span class="bp">/</span> <span class="o">(</span><span class="mi">2</span> <span class="bp">*</span> <span class="n">x</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="bp">=</span> <span class="n">_</span><span class="o">,</span>
      <span class="n">push_cast</span><span class="o">,</span>
      <span class="n">change</span> <span class="o">(</span><span class="mi">2</span> <span class="o">:</span> <span class="n">ℚ</span><span class="o">)</span> <span class="bp">/</span> <span class="o">(</span><span class="mi">2</span> <span class="bp">*</span> <span class="n">x</span><span class="o">)</span> <span class="bp">=</span> <span class="mi">1</span> <span class="bp">/</span> <span class="n">x</span><span class="o">,</span>
      <span class="n">generalize</span> <span class="n">h</span> <span class="o">:</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="n">ℚ</span><span class="o">)</span> <span class="bp">=</span> <span class="n">q</span><span class="o">,</span>
      <span class="n">by_cases</span> <span class="n">hq</span> <span class="o">:</span> <span class="n">q</span> <span class="bp">=</span> <span class="mi">0</span><span class="o">,</span>
        <span class="n">rw</span> <span class="n">hq</span><span class="o">,</span> <span class="n">ring</span><span class="o">,</span>
      <span class="n">field_simp</span> <span class="o">[</span><span class="n">hq</span><span class="o">]</span> <span class="o">}</span>

<span class="kd">lemma</span> <span class="n">lemma2</span> <span class="o">:</span> <span class="n">c</span> <span class="bp">+</span> <span class="n">d</span> <span class="bp">=</span> <span class="n">b</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="n">unfold</span> <span class="n">c</span> <span class="n">d</span> <span class="n">b</span><span class="o">,</span>
  <span class="n">simp</span> <span class="n">only</span> <span class="o">[</span><span class="bp">←</span> <span class="n">Ico.zero_bot</span><span class="o">],</span>
  <span class="n">rw</span> <span class="bp">←</span> <span class="n">sum_union</span><span class="o">,</span>
  <span class="o">{</span> <span class="n">apply</span> <span class="n">sum_congr</span><span class="o">,</span>
    <span class="o">{</span> <span class="n">ext</span> <span class="n">x</span><span class="o">,</span>
      <span class="k">suffices</span> <span class="o">:</span> <span class="n">x</span> <span class="bp">&lt;</span> <span class="mi">660</span> <span class="bp">∨</span> <span class="mi">660</span> <span class="bp">≤</span> <span class="n">x</span> <span class="bp">∧</span> <span class="n">x</span> <span class="bp">&lt;</span> <span class="mi">1320</span> <span class="bp">↔</span> <span class="n">x</span> <span class="bp">&lt;</span> <span class="mi">1320</span><span class="o">,</span>
        <span class="n">simpa</span><span class="o">,</span>
      <span class="n">split</span><span class="o">,</span>
      <span class="o">{</span> <span class="n">rintro</span> <span class="o">(</span><span class="n">a</span> <span class="bp">|</span> <span class="o">⟨</span><span class="n">b</span><span class="o">,</span> <span class="n">c</span><span class="o">⟩)</span><span class="bp">;</span> <span class="n">linarith</span> <span class="o">},</span>
      <span class="o">{</span> <span class="n">intro</span> <span class="n">hx</span><span class="o">,</span>
        <span class="n">cases</span> <span class="n">lt_or_le</span> <span class="n">x</span> <span class="mi">660</span><span class="o">,</span>
        <span class="o">{</span> <span class="n">left</span><span class="o">,</span> <span class="n">assumption</span> <span class="o">},</span>
        <span class="o">{</span> <span class="n">right</span><span class="o">,</span> <span class="n">cc</span> <span class="o">}</span> <span class="o">}</span> <span class="o">},</span>
    <span class="o">{</span> <span class="n">intros</span><span class="o">,</span> <span class="n">refl</span> <span class="o">}</span> <span class="o">},</span>
  <span class="n">apply</span> <span class="n">Ico.disjoint_consecutive</span>
<span class="kd">end</span>

<span class="kd">lemma</span> <span class="n">corollary3</span> <span class="o">:</span> <span class="n">a</span> <span class="bp">=</span> <span class="n">d</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="n">apply</span> <span class="n">add_left_cancel</span><span class="o">,</span> <span class="n">swap</span><span class="o">,</span> <span class="n">exact</span> <span class="n">c</span><span class="o">,</span>
  <span class="n">rw</span> <span class="n">lemma2</span><span class="o">,</span>
  <span class="n">rw</span> <span class="bp">←</span> <span class="n">lemma1</span><span class="o">,</span>
  <span class="n">apply</span> <span class="n">sub_add_cancel</span><span class="o">,</span>
<span class="kd">end</span>

<span class="kd">lemma</span> <span class="n">lemma4</span> <span class="o">:</span> <span class="n">e</span> <span class="bp">+</span> <span class="n">f</span> <span class="bp">=</span> <span class="n">d</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="n">unfold</span> <span class="n">d</span> <span class="n">e</span> <span class="n">f</span><span class="o">,</span>
  <span class="n">rw</span> <span class="o">(</span><span class="n">Ico.zero_bot</span> <span class="mi">330</span><span class="o">)</span><span class="bp">.</span><span class="n">symm</span><span class="o">,</span>
  <span class="k">have</span> <span class="n">h</span> <span class="o">:</span> <span class="bp">∑</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="k">in</span> <span class="n">Ico</span> <span class="mi">0</span> <span class="mi">330</span><span class="o">,</span> <span class="o">(</span><span class="mi">1</span> <span class="o">:</span> <span class="n">ℚ</span><span class="o">)</span> <span class="bp">/</span> <span class="o">(</span><span class="n">n</span> <span class="bp">+</span> <span class="mi">660</span><span class="o">)</span> <span class="bp">=</span>
    <span class="bp">∑</span> <span class="o">(</span><span class="n">m</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="k">in</span> <span class="n">Ico</span> <span class="mi">660</span> <span class="mi">990</span><span class="o">,</span> <span class="o">(</span><span class="mi">1</span> <span class="o">:</span> <span class="n">ℚ</span><span class="o">)</span> <span class="bp">/</span> <span class="n">m</span><span class="o">,</span>
  <span class="o">{</span>
    <span class="n">rw</span> <span class="bp">←</span><span class="n">Ico.image_add</span> <span class="mi">0</span> <span class="mi">330</span> <span class="mi">660</span><span class="o">,</span>
    <span class="n">rw</span> <span class="n">sum_image</span><span class="o">,</span>
    <span class="o">{</span> <span class="n">apply</span> <span class="n">sum_congr</span><span class="o">,</span> <span class="n">refl</span><span class="o">,</span>
      <span class="n">intros</span><span class="o">,</span> <span class="n">simp</span> <span class="o">[</span><span class="n">add_comm</span><span class="o">]</span> <span class="o">},</span>
    <span class="o">{</span> <span class="n">intros</span> <span class="n">x</span> <span class="n">hx</span> <span class="n">y</span> <span class="n">hy</span><span class="o">,</span>
      <span class="n">exact</span> <span class="o">(</span><span class="n">add_right_inj</span> <span class="mi">660</span><span class="o">)</span><span class="bp">.</span><span class="n">mp</span> <span class="o">}</span>
  <span class="o">},</span>
  <span class="n">rw</span> <span class="n">h</span><span class="o">,</span> <span class="n">clear</span> <span class="n">h</span><span class="o">,</span>
  <span class="k">have</span> <span class="n">h</span> <span class="o">:</span> <span class="bp">∑</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="k">in</span> <span class="n">Ico</span> <span class="mi">0</span> <span class="mi">330</span><span class="o">,</span> <span class="o">(</span><span class="mi">1</span> <span class="o">:</span> <span class="n">ℚ</span><span class="o">)</span> <span class="bp">/</span> <span class="o">(</span><span class="mi">1319</span> <span class="bp">-</span> <span class="n">n</span><span class="o">)</span> <span class="bp">=</span>
    <span class="bp">∑</span> <span class="o">(</span><span class="n">m</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="k">in</span> <span class="n">Ico</span> <span class="mi">990</span> <span class="mi">1320</span><span class="o">,</span> <span class="o">(</span><span class="mi">1</span> <span class="o">:</span> <span class="n">ℚ</span><span class="o">)</span> <span class="bp">/</span> <span class="n">m</span><span class="o">,</span>
  <span class="o">{</span> <span class="k">have</span> <span class="n">h2</span> <span class="o">:</span> <span class="n">image</span> <span class="o">(</span><span class="bp">λ</span> <span class="o">(</span><span class="n">j</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">),</span> <span class="mi">1319</span> <span class="bp">-</span> <span class="n">j</span><span class="o">)</span> <span class="o">(</span><span class="n">Ico</span> <span class="mi">0</span> <span class="mi">330</span><span class="o">)</span> <span class="bp">=</span>
      <span class="n">Ico</span> <span class="o">(</span><span class="mi">990</span><span class="o">)</span> <span class="o">(</span><span class="mi">1320</span><span class="o">),</span>
    <span class="o">{</span> <span class="n">rw</span> <span class="n">Ico.image_const_sub</span><span class="o">,</span> <span class="n">refl</span><span class="o">,</span> <span class="n">linarith</span> <span class="o">},</span>
    <span class="n">rw</span> <span class="bp">←</span> <span class="n">h2</span><span class="o">,</span>
    <span class="n">rw</span> <span class="n">sum_image</span><span class="o">,</span>
    <span class="o">{</span> <span class="n">apply</span> <span class="n">sum_congr</span><span class="o">,</span> <span class="n">refl</span><span class="o">,</span>
      <span class="n">intros</span><span class="o">,</span>
      <span class="n">apply</span> <span class="n">congr_arg</span><span class="o">,</span>
      <span class="n">rw</span> <span class="n">nat.cast_sub</span><span class="o">,</span> <span class="n">norm_cast</span><span class="o">,</span>
      <span class="n">rw</span> <span class="n">Ico.mem</span> <span class="n">at</span> <span class="n">H</span><span class="o">,</span>
      <span class="n">cases</span> <span class="n">H</span><span class="o">,</span> <span class="n">linarith</span> <span class="o">},</span>
    <span class="o">{</span> <span class="n">intros</span> <span class="n">x</span> <span class="n">hx</span> <span class="n">y</span> <span class="n">hy</span><span class="o">,</span>
      <span class="n">intro</span> <span class="n">h</span><span class="o">,</span>
      <span class="n">rw</span> <span class="o">[</span><span class="n">Ico.zero_bot</span><span class="o">,</span> <span class="n">mem_range</span><span class="o">]</span> <span class="n">at</span> <span class="n">hx</span> <span class="n">hy</span><span class="o">,</span>
      <span class="n">rw</span> <span class="n">nat.sub_eq_iff_eq_add</span> <span class="o">(</span><span class="k">show</span> <span class="n">x</span> <span class="bp">≤</span> <span class="mi">1319</span><span class="o">,</span> <span class="kd">by</span> <span class="n">linarith</span><span class="o">)</span> <span class="n">at</span> <span class="n">h</span><span class="o">,</span>
      <span class="n">rw</span> <span class="n">nat.sub_add_eq_add_sub</span> <span class="o">(</span><span class="k">show</span> <span class="n">y</span> <span class="bp">≤</span> <span class="mi">1319</span><span class="o">,</span> <span class="kd">by</span> <span class="n">linarith</span><span class="o">)</span> <span class="n">at</span> <span class="n">h</span><span class="o">,</span>
      <span class="n">symmetry'</span> <span class="n">at</span> <span class="n">h</span><span class="o">,</span>
      <span class="n">rw</span> <span class="n">nat.sub_eq_iff_eq_add</span> <span class="n">at</span> <span class="n">h</span><span class="o">,</span> <span class="n">swap</span><span class="o">,</span> <span class="n">linarith</span><span class="o">,</span>
      <span class="n">exact</span> <span class="o">(</span><span class="n">add_right_inj</span> <span class="mi">1319</span><span class="o">)</span><span class="bp">.</span><span class="n">mp</span> <span class="n">h</span> <span class="o">}</span>
  <span class="o">},</span>
  <span class="n">rw</span> <span class="n">h</span><span class="o">,</span> <span class="n">clear</span> <span class="n">h</span><span class="o">,</span>
  <span class="n">rw</span> <span class="bp">←</span><span class="n">sum_union</span><span class="o">,</span>
  <span class="o">{</span> <span class="n">apply</span> <span class="n">sum_congr</span><span class="o">,</span>
    <span class="o">{</span> <span class="n">apply</span> <span class="n">Ico.union_consecutive</span><span class="bp">;</span> <span class="n">linarith</span> <span class="o">},</span>
    <span class="o">{</span> <span class="n">intros</span><span class="o">,</span> <span class="n">refl</span> <span class="o">}</span> <span class="o">},</span>
  <span class="o">{</span> <span class="n">apply</span> <span class="n">Ico.disjoint_consecutive</span> <span class="o">}</span>
<span class="kd">end</span>

<span class="kd">lemma</span> <span class="n">lemma5</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">n</span> <span class="bp">∈</span> <span class="n">range</span> <span class="mi">330</span><span class="o">,</span> <span class="bp">∥</span> <span class="o">(((</span><span class="mi">1</span> <span class="bp">/</span> <span class="o">(</span><span class="n">n</span> <span class="bp">+</span> <span class="mi">660</span><span class="o">)</span> <span class="bp">+</span> <span class="mi">1</span> <span class="bp">/</span> <span class="o">(</span><span class="mi">1319</span> <span class="bp">-</span> <span class="n">n</span><span class="o">))</span> <span class="o">:</span> <span class="n">ℚ</span><span class="o">)</span> <span class="o">:</span> <span class="n">ℚ_</span><span class="o">[</span><span class="mi">1979</span><span class="o">])</span> <span class="bp">∥</span> <span class="bp">&lt;</span> <span class="mi">1</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="n">intros</span> <span class="n">n</span> <span class="n">hn</span><span class="o">,</span>
  <span class="n">rw</span> <span class="n">mem_range</span> <span class="n">at</span> <span class="n">hn</span><span class="o">,</span>
  <span class="k">have</span> <span class="n">h1</span> <span class="o">:</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="n">ℚ</span><span class="o">)</span> <span class="bp">+</span> <span class="mi">660</span> <span class="bp">≠</span> <span class="mi">0</span><span class="o">,</span>
    <span class="n">apply</span> <span class="n">ne_of_gt</span><span class="o">,</span>
    <span class="n">norm_cast</span><span class="o">,</span> <span class="n">simp</span><span class="o">,</span>
  <span class="k">have</span> <span class="n">h2</span> <span class="o">:</span> <span class="o">(</span><span class="mi">1319</span> <span class="o">:</span> <span class="n">ℚ</span><span class="o">)</span> <span class="bp">-</span> <span class="n">n</span> <span class="bp">≠</span> <span class="mi">0</span><span class="o">,</span>
    <span class="k">have</span> <span class="n">h3</span> <span class="o">:</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="n">ℚ</span><span class="o">)</span> <span class="bp">&lt;</span> <span class="mi">330</span><span class="o">,</span> <span class="n">norm_cast</span><span class="o">,</span> <span class="n">exact</span> <span class="n">hn</span><span class="o">,</span>
    <span class="n">linarith</span><span class="o">,</span>
  <span class="k">let</span> <span class="n">p</span> <span class="o">:</span> <span class="n">ℕ</span> <span class="o">:=</span> <span class="mi">1979</span><span class="o">,</span>
  <span class="k">have</span> <span class="n">h3</span> <span class="o">:</span> <span class="o">(</span><span class="mi">1</span> <span class="o">:</span> <span class="n">ℚ</span><span class="o">)</span> <span class="bp">/</span> <span class="o">(</span><span class="n">n</span> <span class="bp">+</span> <span class="mi">660</span><span class="o">)</span> <span class="bp">+</span> <span class="mi">1</span> <span class="bp">/</span> <span class="o">(</span><span class="mi">1319</span> <span class="bp">-</span> <span class="n">n</span><span class="o">)</span> <span class="bp">=</span> <span class="mi">1979</span> <span class="bp">/</span> <span class="o">((</span><span class="n">n</span> <span class="bp">+</span> <span class="mi">660</span><span class="o">)</span> <span class="bp">*</span> <span class="o">(</span><span class="mi">1319</span> <span class="bp">-</span> <span class="n">n</span><span class="o">)),</span>
    <span class="n">field_simp</span> <span class="o">[</span><span class="n">h1</span><span class="o">,</span> <span class="n">h2</span><span class="o">],</span>
    <span class="n">generalize</span> <span class="o">:</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="n">ℚ</span><span class="o">)</span> <span class="bp">=</span> <span class="n">q</span><span class="o">,</span>
    <span class="n">ring</span><span class="o">,</span>
  <span class="n">rw</span> <span class="n">h3</span><span class="o">,</span> <span class="n">clear</span> <span class="n">h3</span><span class="o">,</span>
  <span class="n">push_cast</span><span class="o">,</span>
  <span class="n">rw</span> <span class="n">normed_field.norm_div</span><span class="o">,</span>
  <span class="n">rw</span> <span class="n">normed_field.norm_mul</span><span class="o">,</span>
  <span class="n">rw</span> <span class="n">div_lt_one</span><span class="o">,</span>
    <span class="n">sorry</span><span class="o">,</span>
  <span class="n">sorry</span><span class="o">,</span>
<span class="kd">end</span>



<span class="kd">theorem</span> <span class="n">imo</span> <span class="o">(</span><span class="n">p</span> <span class="n">q</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="o">:</span> <span class="o">(</span><span class="n">p</span> <span class="o">:</span> <span class="n">ℚ</span><span class="o">)</span> <span class="bp">/</span> <span class="n">q</span> <span class="bp">=</span>
<span class="c1">-- 1 - (1/2) + (1/3) - (1/4) + ... + (1/1319),</span>
<span class="bp">∑</span> <span class="n">n</span> <span class="k">in</span> <span class="n">finset.range</span> <span class="mi">1320</span><span class="o">,</span> <span class="o">(</span><span class="bp">-</span><span class="mi">1</span><span class="o">)</span><span class="bp">^</span><span class="o">(</span><span class="n">n</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)</span> <span class="bp">/</span> <span class="n">n</span>
<span class="bp">→</span> <span class="mi">1979</span> <span class="bp">∣</span> <span class="n">p</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="n">change</span> <span class="n">_</span> <span class="bp">=</span> <span class="n">a</span> <span class="bp">→</span> <span class="n">_</span><span class="o">,</span>
  <span class="n">rw</span> <span class="n">corollary3</span><span class="o">,</span>
  <span class="n">rw</span> <span class="bp">←</span> <span class="n">lemma4</span><span class="o">,</span>
  <span class="n">intro</span> <span class="n">h</span><span class="o">,</span>
  <span class="n">unfold</span> <span class="n">e</span> <span class="n">f</span> <span class="n">at</span> <span class="n">h</span><span class="o">,</span>
  <span class="n">rw</span> <span class="bp">←</span> <span class="n">sum_add_distrib</span> <span class="n">at</span> <span class="n">h</span><span class="o">,</span>

  <span class="n">sorry</span>
<span class="kd">end</span>

<span class="kd">end</span> <span class="n">imo1979q1</span>
</code></pre></div>

<p>I'm not finished either -- I'm at the same place as you in fact.</p>



<a name="211421851"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/cheap%20IMO%20problem/near/211421851" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/cheap.20IMO.20problem.html#211421851">(Sep 27 2020 at 15:44)</a>:</h4>
<p>I just decided it was time I learnt about how sums work in Lean nowadays :-)</p>



<a name="211422081"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/cheap%20IMO%20problem/near/211422081" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yakov Pechersky <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/cheap.20IMO.20problem.html#211422081">(Sep 27 2020 at 15:50)</a>:</h4>
<p>I think the solution for my approach is to somehow identify q with the product of 660 to 1320. And then push the casts to remove the casts to Q and make everything statements about N.</p>



<a name="211422105"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/cheap%20IMO%20problem/near/211422105" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/cheap.20IMO.20problem.html#211422105">(Sep 27 2020 at 15:51)</a>:</h4>
<p>My gut feeling is that using p-adic norm should make life easier; you don't have to deal with the denominator that way.</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>