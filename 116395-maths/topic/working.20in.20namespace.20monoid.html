---
layout: archive
title: Zulip Chat Archive
permalink: /stream/116395-maths/topic/working.20in.20namespace.20monoid.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/116395-maths/index.html">maths</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/working.20in.20namespace.20monoid.html">working in namespace monoid</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="278293492"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/working%20in%20namespace%20monoid/near/278293492" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jakob von Raumer <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/working.20in.20namespace.20monoid.html#278293492">(Apr 08 2022 at 11:59)</a>:</h4>
<p>What can I do about <code>simp</code> not doing the right thing here?</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">algebra.group.defs</span>

<span class="kn">namespace</span> <span class="n">monoid</span>

<span class="kd">example</span> <span class="o">{</span><span class="n">R</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">monoid</span> <span class="n">R</span><span class="o">]</span> <span class="o">(</span><span class="n">r</span> <span class="o">:</span> <span class="n">R</span><span class="o">)</span> <span class="o">:</span> <span class="n">r</span> <span class="bp">*</span> <span class="o">(</span><span class="n">r</span> <span class="bp">*</span> <span class="n">r</span><span class="o">)</span> <span class="bp">*</span> <span class="n">r</span> <span class="bp">=</span> <span class="o">(</span><span class="n">r</span> <span class="bp">*</span> <span class="n">r</span><span class="o">)</span> <span class="bp">*</span> <span class="o">(</span><span class="n">r</span> <span class="bp">*</span> <span class="n">r</span><span class="o">)</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="n">simp</span> <span class="o">[</span><span class="bp">←</span><span class="n">mul_assoc</span><span class="o">],</span>
<span class="kd">end</span>

<span class="kd">end</span> <span class="n">monoid</span>
</code></pre></div>
<p>Or should I just not be working inside <code>monoid</code>?</p>



<a name="278293782"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/working%20in%20namespace%20monoid/near/278293782" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/working.20in.20namespace.20monoid.html#278293782">(Apr 08 2022 at 12:01)</a>:</h4>
<p>It works for me. What version of mathlib are you on?</p>



<a name="278293897"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/working%20in%20namespace%20monoid/near/278293897" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Floris van Doorn <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/working.20in.20namespace.20monoid.html#278293897">(Apr 08 2022 at 12:02)</a>:</h4>
<p>You want to use <code>_root_.mul_assoc</code>:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">algebra.group.defs</span>

<span class="kn">namespace</span> <span class="n">monoid</span>

<span class="kd">example</span> <span class="o">{</span><span class="n">R</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">monoid</span> <span class="n">R</span><span class="o">]</span> <span class="o">(</span><span class="n">r</span> <span class="o">:</span> <span class="n">R</span><span class="o">)</span> <span class="o">:</span> <span class="n">r</span> <span class="bp">*</span> <span class="o">(</span><span class="n">r</span> <span class="bp">*</span> <span class="n">r</span><span class="o">)</span> <span class="bp">*</span> <span class="n">r</span> <span class="bp">=</span> <span class="o">(</span><span class="n">r</span> <span class="bp">*</span> <span class="n">r</span><span class="o">)</span> <span class="bp">*</span> <span class="o">(</span><span class="n">r</span> <span class="bp">*</span> <span class="n">r</span><span class="o">)</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="n">simp</span> <span class="n">only</span> <span class="o">[</span><span class="bp">←</span><span class="n">_root_.mul_assoc</span><span class="o">],</span>
<span class="kd">end</span>

<span class="kd">end</span> <span class="n">monoid</span>
</code></pre></div>



<a name="278293904"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/working%20in%20namespace%20monoid/near/278293904" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/working.20in.20namespace.20monoid.html#278293904">(Apr 08 2022 at 12:02)</a>:</h4>
<p>Ah wait, I get it now.</p>



<a name="278293923"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/working%20in%20namespace%20monoid/near/278293923" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/working.20in.20namespace.20monoid.html#278293923">(Apr 08 2022 at 12:02)</a>:</h4>
<p><code>monoid.mul_assoc</code> should be protected.</p>



<a name="278293943"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/working%20in%20namespace%20monoid/near/278293943" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Floris van Doorn <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/working.20in.20namespace.20monoid.html#278293943">(Apr 08 2022 at 12:03)</a>:</h4>
<p><a href="https://leanprover-community.github.io/mathlib_docs/find/monoid.mul_assoc">docs#monoid.mul_assoc</a> is a field of the structure that should not be used.</p>



<a name="278294397"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/working%20in%20namespace%20monoid/near/278294397" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jakob von Raumer <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/working.20in.20namespace.20monoid.html#278294397">(Apr 08 2022 at 12:07)</a>:</h4>
<p>Thanks for the explanation, yea it should be protected then, I guess. Should things about monoids which are a bit "out there" go into <code>monoid</code> or into its own namespace?</p>



<a name="278294612"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/working%20in%20namespace%20monoid/near/278294612" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/working.20in.20namespace.20monoid.html#278294612">(Apr 08 2022 at 12:09)</a>:</h4>
<p>What are you thinking of?</p>



<a name="278297305"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/working%20in%20namespace%20monoid/near/278297305" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jakob von Raumer <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/working.20in.20namespace.20monoid.html#278297305">(Apr 08 2022 at 12:36)</a>:</h4>
<p>We formalised the ore localisation of monoids</p>



<a name="278305011"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/working%20in%20namespace%20monoid/near/278305011" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/working.20in.20namespace.20monoid.html#278305011">(Apr 08 2022 at 13:39)</a>:</h4>
<p>If <code>namespace monoid</code> is making name resolution annoying, you can just use <code>lemma monoid.foo</code> instead in the root namespace</p>



<a name="278305143"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/working%20in%20namespace%20monoid/near/278305143" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Anne Baanen <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/working.20in.20namespace.20monoid.html#278305143">(Apr 08 2022 at 13:40)</a>:</h4>
<p>Semi-serious suggestion: should there be a <code>close monoid</code> command that undoes the (implicit) <code>open monoid</code> in <code>namespace monoid</code>?</p>



<a name="278306374"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/working%20in%20namespace%20monoid/near/278306374" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jakob von Raumer <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/working.20in.20namespace.20monoid.html#278306374">(Apr 08 2022 at 13:48)</a>:</h4>
<p><span class="user-mention silent" data-user-id="310045">Eric Wieser</span> <a href="#narrow/stream/116395-maths/topic/working.20in.20namespace.20monoid/near/278305011">said</a>:</p>
<blockquote>
<p>If <code>namespace monoid</code> is making name resolution annoying, you can just use <code>lemma monoid.foo</code> instead in the root namespace</p>
</blockquote>
<p>After looking at another few examples from mathlib, I now think that <code>namespace ore_localization</code> is actually the better choice anyway :)</p>



<a name="278307313"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/working%20in%20namespace%20monoid/near/278307313" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/working.20in.20namespace.20monoid.html#278307313">(Apr 08 2022 at 13:54)</a>:</h4>
<p><span class="user-mention silent" data-user-id="238446">Anne Baanen</span> <a href="#narrow/stream/116395-maths/topic/working.20in.20namespace.20monoid/near/278305143">said</a>:</p>
<blockquote>
<p>Semi-serious suggestion: should there be a <code>close monoid</code> command that undoes the (implicit) <code>open monoid</code> in <code>namespace monoid</code>?</p>
</blockquote>
<p>this is hard, right? because afair Lean implements <code>open</code> by removing all the <code>monoid.</code> from names in the local context, so it'd have to "remember" which ones it removed</p>



<a name="278307758"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/working%20in%20namespace%20monoid/near/278307758" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Julian Berman <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/working.20in.20namespace.20monoid.html#278307758">(Apr 08 2022 at 13:58)</a>:</h4>
<p>Not sure if it's any easier or saner but presuming declarations know their own names could also have an <code>unshadow foo</code> command which loops over declarations with conflicting names and removes the one that isn't from <code>foo</code> (and default <code>foo</code> to  <code>_root_</code>)</p>



<a name="278310692"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/working%20in%20namespace%20monoid/near/278310692" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/working.20in.20namespace.20monoid.html#278310692">(Apr 08 2022 at 14:18)</a>:</h4>
<p><code>semigroup</code> has <code>protect_proj</code>, probably it should just be added to <code>monoid</code> too, with an explicit list if there are names we want to not protect</p>



<a name="278317499"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/working%20in%20namespace%20monoid/near/278317499" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kyle Miller <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/working.20in.20namespace.20monoid.html#278317499">(Apr 08 2022 at 15:05)</a>:</h4>
<p><span class="user-mention" data-user-id="284160">@Eric Rodriguez</span> It looks like <code>open</code> operates by adding aliases -- it doesn't remove anything.</p>
<p>I learned that <code>open</code> isn't fully documented in the Lean reference manual. Here's the BNF for the command:</p>
<p><code>open</code> <em>ident</em> [<code>as</code> <em>ident</em>] ( <code>(renaming</code> (<em>ident</em> <code>-&gt;</code> <em>ident</em>)* <code>)</code> | <code>(hiding</code> <em>ident</em> * <code>)</code> | <code>(</code> <em>ident</em> * <code>)</code> )*</p>
<p>(Square brackets mean it's optional, non-monospace parentheses are for grouping, postfix * means zero-or-more, and | indicates alternatives.)</p>
<ul>
<li>example: <code>open foo as bar</code> takes every name in the <code>foo</code> namespace and gives an alias in the <code>bar</code> namespace</li>
<li>The three types of extra rules are called renames, exceptions, and explicits. There cannot simultaneously be renames/exceptions and explicits (the Lean error is about "mixing explicit and implicit open/export options"; not sure why they're called "implicit" in the error.)<ul>
<li>If there are explicits: only the listed identifiers are given aliases</li>
<li>If there are renames/exceptions: everything but the exceptions are given aliases and the renames are processed (note: renames override exceptions; might be a bug)</li>
</ul>
</li>
</ul>



<a name="278317794"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/working%20in%20namespace%20monoid/near/278317794" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kyle Miller <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/working.20in.20namespace.20monoid.html#278317794">(Apr 08 2022 at 15:07)</a>:</h4>
<p>It seems like in principle there could be a <code>close</code> command with the same syntax that erases aliases instead of adding them. (Aliases are special data attached to the current environment.)</p>



<a name="278318483"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/working%20in%20namespace%20monoid/near/278318483" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kyle Miller <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/working.20in.20namespace.20monoid.html#278318483">(Apr 08 2022 at 15:12)</a>:</h4>
<p>The way <code>export</code> works is it's <code>open</code> but it also adds an "export declaration" to a particular namespace, and then the <code>namespace foo</code> command will look for all the export declarations and "replay" them by simulating the <code>open</code> command.</p>



<a name="278319992"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/working%20in%20namespace%20monoid/near/278319992" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kyle Miller <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/working.20in.20namespace.20monoid.html#278319992">(Apr 08 2022 at 15:24)</a>:</h4>
<p><span class="user-mention silent" data-user-id="238446">Anne Baanen</span> <a href="#narrow/stream/116395-maths/topic/working.20in.20namespace.20monoid/near/278305143">said</a>:</p>
<blockquote>
<p>Semi-serious suggestion: should there be a <code>close monoid</code> command that undoes the (implicit) <code>open monoid</code> in <code>namespace monoid</code>?</p>
</blockquote>
<p>I'm not sure this could work as an inverse to <code>open</code> -- as far as I understand, there's not an implicit <code>open monoid</code> in the <code>namespace monoid</code> command. Rather, when resolving a name the elaborator goes through the following steps:</p>
<ol>
<li>look through the current stack of namespaces to find the declaration (so, if you're in <code>foo.bar</code>, look in <code>foo.bar</code> then <code>foo</code>)</li>
<li>check if it's an exact name (after removing <code>_root_</code> from the front if present)</li>
<li>look for an alias with that name</li>
<li>try turning the name into field notation (example: if it's <code>a.b</code>, try resolving <code>a</code> and then get the <code>b</code> field).</li>
</ol>
<p>There could be a <code>close</code> command to inhibit step 1, I suppose. It seems like a specialized feature though ("all declarations go into this namespace, but do not use it for name resolution").</p>



<a name="278321054"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/working%20in%20namespace%20monoid/near/278321054" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kyle Miller <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/working.20in.20namespace.20monoid.html#278321054">(Apr 08 2022 at 15:32)</a>:</h4>
<p>I haven't looked at how it'd be implemented, but potentially <code>protected namespace foo</code> could permanently mark a namespace to not be used for name resolution by the elaborator (here's place it happens: <a href="https://github.com/leanprover-community/lean/blob/master/src/frontends/lean/elaborator.cpp#L4092">https://github.com/leanprover-community/lean/blob/master/src/frontends/lean/elaborator.cpp#L4092</a>). I'm assuming mathport would rather this not be implemented however...</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>