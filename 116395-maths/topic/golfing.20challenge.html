---
layout: archive
title: Zulip Chat Archive
permalink: /stream/116395-maths/topic/golfing.20challenge.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/116395-maths/index.html">maths</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/golfing.20challenge.html">golfing challenge</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="196060730"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/golfing%20challenge/near/196060730" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/golfing.20challenge.html#196060730">(May 02 2020 at 17:03)</a>:</h4>
<p>This shouldn't be so hard/long/slow...</p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="n">ring_theory</span><span class="bp">.</span><span class="n">polynomial</span>

<span class="kn">namespace</span> <span class="n">polynomial</span>

<span class="c">/-</span><span class="cm">- The formal derivative of polynomials, as additive homomorphism. -/</span>
<span class="n">noncomputable</span> <span class="n">def</span> <span class="n">derivative_hom</span> <span class="o">(</span><span class="n">R</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">[</span><span class="n">comm_semiring</span> <span class="n">R</span><span class="o">]</span> <span class="o">:</span> <span class="n">polynomial</span> <span class="n">R</span> <span class="bp">→+</span> <span class="n">polynomial</span> <span class="n">R</span> <span class="o">:=</span>
<span class="o">{</span> <span class="n">to_fun</span> <span class="o">:=</span> <span class="n">derivative</span><span class="o">,</span>
  <span class="n">map_zero&#39;</span> <span class="o">:=</span> <span class="n">derivative_zero</span><span class="o">,</span>
  <span class="n">map_add&#39;</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">p</span> <span class="n">q</span><span class="o">,</span> <span class="n">derivative_add</span> <span class="o">}</span>

<span class="bp">@</span><span class="o">[</span><span class="n">simp</span><span class="o">]</span> <span class="kn">lemma</span> <span class="n">derivative_neg</span> <span class="o">{</span><span class="n">R</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">comm_ring</span> <span class="n">R</span><span class="o">]</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">polynomial</span> <span class="n">R</span><span class="o">)</span> <span class="o">:</span>
  <span class="n">derivative</span> <span class="o">(</span><span class="bp">-</span><span class="n">f</span><span class="o">)</span> <span class="bp">=</span> <span class="bp">-</span><span class="n">derivative</span> <span class="n">f</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">derivative_hom</span> <span class="n">R</span><span class="o">)</span><span class="bp">.</span><span class="n">map_neg</span> <span class="n">f</span>

<span class="bp">@</span><span class="o">[</span><span class="n">simp</span><span class="o">]</span> <span class="kn">lemma</span> <span class="n">derivative_sub</span> <span class="o">{</span><span class="n">R</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">comm_ring</span> <span class="n">R</span><span class="o">]</span> <span class="o">(</span><span class="n">f</span> <span class="n">g</span> <span class="o">:</span> <span class="n">polynomial</span> <span class="n">R</span><span class="o">)</span> <span class="o">:</span>
  <span class="n">derivative</span> <span class="o">(</span><span class="n">f</span> <span class="bp">-</span> <span class="n">g</span><span class="o">)</span> <span class="bp">=</span> <span class="n">derivative</span> <span class="n">f</span> <span class="bp">-</span> <span class="n">derivative</span> <span class="n">g</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">derivative_hom</span> <span class="n">R</span><span class="o">)</span><span class="bp">.</span><span class="n">map_sub</span> <span class="n">f</span> <span class="n">g</span>

<span class="kn">lemma</span> <span class="n">is_coprime_of_is_root_of_eval_derivative_ne_zero</span> <span class="o">{</span><span class="n">R</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">field</span> <span class="n">R</span><span class="o">]</span>
  <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">polynomial</span> <span class="n">R</span><span class="o">)</span> <span class="o">(</span><span class="n">r</span> <span class="o">:</span> <span class="n">R</span><span class="o">)</span> <span class="o">(</span><span class="n">hf</span> <span class="o">:</span> <span class="n">f</span><span class="bp">.</span><span class="n">is_root</span> <span class="n">r</span><span class="o">)</span> <span class="o">(</span><span class="n">hf&#39;</span> <span class="o">:</span> <span class="n">f</span><span class="bp">.</span><span class="n">derivative</span><span class="bp">.</span><span class="kn">eval</span> <span class="n">r</span> <span class="bp">≠</span> <span class="mi">0</span><span class="o">)</span> <span class="o">:</span>
  <span class="n">ideal</span><span class="bp">.</span><span class="n">is_coprime</span> <span class="o">(</span><span class="n">X</span> <span class="bp">-</span> <span class="n">C</span> <span class="n">r</span> <span class="o">:</span> <span class="n">polynomial</span> <span class="n">R</span><span class="o">)</span> <span class="o">(</span><span class="n">f</span> <span class="bp">/</span><span class="err">ₘ</span> <span class="o">(</span><span class="n">X</span> <span class="bp">-</span> <span class="n">C</span> <span class="n">r</span><span class="o">))</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="n">rw</span> <span class="err">←</span> <span class="n">mul_div_by_monic_eq_iff_is_root</span> <span class="n">at</span> <span class="n">hf</span><span class="o">,</span>
  <span class="n">rw</span> <span class="err">←</span> <span class="n">hf</span> <span class="n">at</span> <span class="n">hf&#39;</span><span class="o">,</span>
  <span class="n">simp</span> <span class="n">only</span> <span class="o">[</span><span class="n">eval_C</span><span class="o">,</span> <span class="n">eval_X</span><span class="o">,</span> <span class="n">add_zero</span><span class="o">,</span> <span class="n">derivative_X</span><span class="o">,</span> <span class="n">derivative_mul</span><span class="o">,</span> <span class="n">one_mul</span><span class="o">,</span> <span class="n">zero_mul</span><span class="o">,</span>
    <span class="n">eval_sub</span><span class="o">,</span> <span class="n">sub_zero</span><span class="o">,</span> <span class="n">ne</span><span class="bp">.</span><span class="n">def</span><span class="o">,</span> <span class="n">derivative_sub</span><span class="o">,</span> <span class="n">eval_add</span><span class="o">,</span> <span class="n">eval_mul</span><span class="o">,</span> <span class="n">derivative_C</span><span class="o">,</span> <span class="n">sub_self</span><span class="o">]</span> <span class="n">at</span> <span class="n">hf&#39;</span><span class="o">,</span>
  <span class="n">apply</span> <span class="n">is_coprime_of_dvd</span><span class="o">,</span>
  <span class="o">{</span> <span class="n">push_neg</span><span class="o">,</span> <span class="n">left</span><span class="o">,</span> <span class="k">assume</span> <span class="n">eqz</span><span class="o">,</span>
    <span class="n">apply_fun</span> <span class="n">polynomial</span><span class="bp">.</span><span class="n">degree</span> <span class="n">at</span> <span class="n">eqz</span><span class="o">,</span>
    <span class="n">rw</span> <span class="n">polynomial</span><span class="bp">.</span><span class="n">degree_X_sub_C</span> <span class="n">at</span> <span class="n">eqz</span><span class="o">,</span>
    <span class="n">exact</span> <span class="n">option</span><span class="bp">.</span><span class="n">no_confusion</span> <span class="n">eqz</span> <span class="o">},</span>
  <span class="o">{</span> <span class="n">rintros</span> <span class="n">a</span> <span class="n">h1</span> <span class="n">h2</span> <span class="bp">⟨</span><span class="n">b</span><span class="o">,</span> <span class="n">hab</span><span class="bp">⟩</span> <span class="n">H</span><span class="o">,</span>
    <span class="k">have</span> <span class="o">:</span> <span class="kn">irreducible</span> <span class="o">(</span><span class="n">X</span> <span class="bp">-</span> <span class="n">C</span> <span class="n">r</span><span class="o">),</span>
    <span class="o">{</span> <span class="n">apply</span> <span class="n">polynomial</span><span class="bp">.</span><span class="n">irreducible_of_degree_eq_one</span><span class="o">,</span> <span class="n">exact</span> <span class="n">polynomial</span><span class="bp">.</span><span class="n">degree_X_sub_C</span> <span class="bp">_</span> <span class="o">},</span>
    <span class="n">rcases</span> <span class="o">(</span><span class="n">this</span><span class="bp">.</span><span class="n">is_unit_or_is_unit</span> <span class="n">hab</span><span class="o">)</span> <span class="k">with</span> <span class="n">ha</span><span class="bp">|⟨</span><span class="n">b</span><span class="o">,</span><span class="n">rfl</span><span class="bp">⟩</span><span class="o">,</span>
    <span class="o">{</span> <span class="n">exact</span> <span class="n">h1</span> <span class="n">ha</span> <span class="o">},</span>
    <span class="n">apply</span> <span class="n">hf&#39;</span><span class="o">,</span>
    <span class="k">show</span> <span class="n">is_root</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">,</span>
    <span class="n">rw</span> <span class="err">←</span> <span class="n">dvd_iff_is_root</span><span class="o">,</span>
    <span class="n">refine</span> <span class="n">dvd_trans</span> <span class="bp">⟨</span><span class="err">↑</span><span class="n">b</span><span class="bp">⁻¹</span><span class="o">,</span> <span class="bp">_⟩</span> <span class="n">H</span><span class="o">,</span>
    <span class="n">rw</span> <span class="o">[</span><span class="n">hab</span><span class="o">,</span> <span class="n">units</span><span class="bp">.</span><span class="n">mul_inv_cancel_right</span><span class="o">]</span> <span class="o">}</span>
<span class="kn">end</span>

<span class="kn">end</span> <span class="n">polynomial</span>
</code></pre></div>



<a name="196063662"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/golfing%20challenge/near/196063662" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/golfing.20challenge.html#196063662">(May 02 2020 at 18:15)</a>:</h4>
<p>Probably this can be golfed more, but heres a slightly different proof (I think?) </p>
<div class="codehilite"><pre><span></span><code><span class="kn">lemma</span> <span class="n">is_coprime_of_is_root_of_eval_derivative_ne_zero</span> <span class="o">{</span><span class="n">R</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">field</span> <span class="n">R</span><span class="o">]</span>
  <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">polynomial</span> <span class="n">R</span><span class="o">)</span> <span class="o">(</span><span class="n">r</span> <span class="o">:</span> <span class="n">R</span><span class="o">)</span> <span class="o">(</span><span class="n">hf</span> <span class="o">:</span> <span class="n">f</span><span class="bp">.</span><span class="n">is_root</span> <span class="n">r</span><span class="o">)</span> <span class="o">(</span><span class="n">hf&#39;</span> <span class="o">:</span> <span class="n">f</span><span class="bp">.</span><span class="n">derivative</span><span class="bp">.</span><span class="kn">eval</span> <span class="n">r</span> <span class="bp">≠</span> <span class="mi">0</span><span class="o">)</span> <span class="o">:</span>
  <span class="n">ideal</span><span class="bp">.</span><span class="n">is_coprime</span> <span class="o">(</span><span class="n">X</span> <span class="bp">-</span> <span class="n">C</span> <span class="n">r</span> <span class="o">:</span> <span class="n">polynomial</span> <span class="n">R</span><span class="o">)</span> <span class="o">(</span><span class="n">f</span> <span class="bp">/</span><span class="err">ₘ</span> <span class="o">(</span><span class="n">X</span> <span class="bp">-</span> <span class="n">C</span> <span class="n">r</span><span class="o">))</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="k">have</span> <span class="n">aa</span> <span class="o">:</span> <span class="o">(</span><span class="n">X</span> <span class="bp">-</span> <span class="n">C</span> <span class="n">r</span><span class="o">)</span> <span class="bp">*</span> <span class="o">(</span><span class="n">f</span> <span class="bp">/</span><span class="err">ₘ</span> <span class="o">(</span><span class="n">X</span> <span class="bp">-</span> <span class="n">C</span> <span class="n">r</span><span class="o">))</span> <span class="bp">=</span> <span class="n">f</span> <span class="bp">-</span> <span class="o">(</span><span class="n">f</span> <span class="err">%ₘ</span> <span class="o">(</span><span class="n">X</span> <span class="bp">-</span> <span class="n">C</span> <span class="n">r</span><span class="o">))</span>  <span class="o">:=</span> <span class="k">begin</span>
    <span class="n">rw</span> <span class="o">[</span><span class="n">eq_sub_iff_add_eq</span><span class="o">,</span> <span class="err">←</span> <span class="n">eq_sub_iff_add_eq&#39;</span><span class="o">,</span> <span class="n">mod_by_monic_eq_sub_mul_div</span><span class="o">],</span>
    <span class="n">exact</span> <span class="n">monic_X_sub_C</span> <span class="n">r</span><span class="o">,</span>
  <span class="kn">end</span><span class="o">,</span>
  <span class="n">apply_fun</span> <span class="n">derivative</span> <span class="n">at</span> <span class="n">aa</span><span class="o">,</span>
  <span class="n">simp</span> <span class="n">only</span> <span class="o">[</span><span class="n">derivative_X</span><span class="o">,</span> <span class="n">derivative_mul</span><span class="o">,</span> <span class="n">one_mul</span><span class="o">,</span> <span class="n">sub_zero</span><span class="o">,</span> <span class="n">derivative_sub</span><span class="o">,</span> <span class="n">mod_by_monic_X_sub_C_eq_C_eval</span><span class="o">,</span> <span class="n">derivative_C</span><span class="o">]</span> <span class="n">at</span> <span class="n">aa</span><span class="o">,</span>
  <span class="n">refine</span> <span class="n">or</span><span class="bp">.</span><span class="n">resolve_left</span> <span class="o">(</span><span class="n">dvd_or_coprime</span> <span class="o">(</span><span class="n">X</span> <span class="bp">-</span> <span class="n">C</span> <span class="n">r</span><span class="o">)</span> <span class="o">(</span><span class="n">f</span> <span class="bp">/</span><span class="err">ₘ</span> <span class="o">(</span><span class="n">X</span> <span class="bp">-</span> <span class="n">C</span> <span class="n">r</span><span class="o">))</span> <span class="o">(</span><span class="n">irreducible_of_degree_eq_one</span> <span class="o">(</span><span class="n">polynomial</span><span class="bp">.</span><span class="n">degree_X_sub_C</span> <span class="n">r</span><span class="o">)))</span> <span class="bp">_</span><span class="o">,</span>
  <span class="n">intro</span><span class="o">,</span>
  <span class="n">apply</span> <span class="n">hf&#39;</span><span class="o">,</span>
  <span class="k">have</span> <span class="o">:</span> <span class="o">(</span><span class="n">X</span> <span class="bp">-</span> <span class="n">C</span> <span class="n">r</span><span class="o">)</span> <span class="err">∣</span> <span class="n">derivative</span> <span class="n">f</span> <span class="o">:=</span> <span class="n">aa</span> <span class="bp">▸</span> <span class="o">(</span><span class="n">dvd_add</span> <span class="n">a</span> <span class="o">(</span><span class="n">dvd</span><span class="bp">.</span><span class="n">intro</span> <span class="o">(</span><span class="n">derivative</span> <span class="o">(</span><span class="n">f</span> <span class="bp">/</span><span class="err">ₘ</span> <span class="o">(</span><span class="n">X</span> <span class="bp">-</span> <span class="n">C</span> <span class="n">r</span><span class="o">)))</span> <span class="n">rfl</span><span class="o">)),</span>
  <span class="n">rw</span> <span class="o">[</span><span class="err">←</span> <span class="n">dvd_iff_mod_by_monic_eq_zero</span> <span class="o">(</span><span class="n">monic_X_sub_C</span> <span class="bp">_</span><span class="o">),</span> <span class="n">mod_by_monic_X_sub_C_eq_C_eval</span><span class="o">]</span> <span class="n">at</span> <span class="n">this</span><span class="o">,</span>
  <span class="n">apply_fun</span> <span class="n">coeff</span> <span class="n">at</span> <span class="n">this</span><span class="o">,</span>
  <span class="n">convert</span> <span class="n">congr_fun</span> <span class="n">this</span> <span class="mi">0</span><span class="o">,</span>
  <span class="n">rw</span> <span class="o">[</span><span class="n">coeff_C_zero</span><span class="o">],</span>
<span class="kn">end</span>
</code></pre></div>



<a name="196069265"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/golfing%20challenge/near/196069265" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/golfing.20challenge.html#196069265">(May 02 2020 at 20:42)</a>:</h4>
<p>Thanks... it's certainly shorter than what I had.</p>



<a name="196989334"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/golfing%20challenge/near/196989334" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/golfing.20challenge.html#196989334">(May 09 2020 at 12:25)</a>:</h4>
<p>Feel free to turn this into a kata.</p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="n">data</span><span class="bp">.</span><span class="n">nat</span><span class="bp">.</span><span class="n">choose</span>

<span class="c1">-- Generalise this to arbitrary property that is respected by addition/multiplication:</span>
<span class="c1">-- example applications: sum_pos, sum_neg, ... others?</span>
<span class="kn">lemma</span> <span class="n">dvd_sum</span> <span class="o">{</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">{</span><span class="n">R</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">comm_ring</span> <span class="n">R</span><span class="o">]</span>
  <span class="o">(</span><span class="n">s</span> <span class="o">:</span> <span class="n">finset</span> <span class="n">α</span><span class="o">)</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">α</span> <span class="bp">→</span> <span class="n">R</span><span class="o">)</span> <span class="o">(</span><span class="n">b</span> <span class="o">:</span> <span class="n">R</span><span class="o">)</span> <span class="o">(</span><span class="n">H</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">a</span> <span class="err">∈</span> <span class="n">s</span><span class="o">,</span> <span class="n">b</span> <span class="err">∣</span> <span class="n">f</span> <span class="n">a</span><span class="o">)</span> <span class="o">:</span>
  <span class="n">b</span> <span class="err">∣</span> <span class="n">s</span><span class="bp">.</span><span class="n">sum</span> <span class="n">f</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="k">let</span> <span class="n">t</span> <span class="o">:=</span> <span class="n">s</span><span class="o">,</span>
  <span class="n">replace</span> <span class="n">H</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">a</span> <span class="err">∈</span> <span class="n">t</span><span class="o">,</span> <span class="n">b</span> <span class="err">∣</span> <span class="n">f</span> <span class="n">a</span> <span class="o">:=</span> <span class="n">H</span><span class="o">,</span>
  <span class="k">have</span> <span class="n">hs</span> <span class="o">:</span> <span class="n">s</span> <span class="err">⊆</span> <span class="n">t</span> <span class="o">:=</span> <span class="n">finset</span><span class="bp">.</span><span class="n">subset</span><span class="bp">.</span><span class="n">refl</span> <span class="n">s</span><span class="o">,</span>
  <span class="n">revert</span> <span class="n">hs</span><span class="o">,</span>
  <span class="n">classical</span><span class="o">,</span>
  <span class="n">apply</span> <span class="n">finset</span><span class="bp">.</span><span class="n">induction_on</span> <span class="n">s</span><span class="o">,</span> <span class="o">{</span><span class="n">simp</span><span class="o">},</span>
  <span class="n">intros</span> <span class="n">a</span> <span class="n">s&#39;</span> <span class="n">ha</span> <span class="n">IH</span> <span class="n">hs&#39;</span><span class="o">,</span>
  <span class="n">rw</span> <span class="n">finset</span><span class="bp">.</span><span class="n">insert_subset</span> <span class="n">at</span> <span class="n">hs&#39;</span><span class="o">,</span>
  <span class="n">cases</span> <span class="n">hs&#39;</span> <span class="k">with</span> <span class="n">has</span> <span class="n">hs&#39;</span><span class="o">,</span>
  <span class="n">simp</span> <span class="o">[</span><span class="bp">*</span><span class="o">,</span> <span class="n">dvd_add</span><span class="o">]</span>
<span class="kn">end</span>

<span class="kn">lemma</span> <span class="n">coe_nat_dvd</span> <span class="o">{</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">comm_ring</span> <span class="n">α</span><span class="o">]</span> <span class="o">(</span><span class="n">m</span> <span class="n">n</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">)</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="n">m</span> <span class="err">∣</span> <span class="n">n</span><span class="o">)</span> <span class="o">:</span>
  <span class="o">(</span><span class="n">m</span> <span class="o">:</span> <span class="n">α</span><span class="o">)</span> <span class="err">∣</span> <span class="n">n</span> <span class="o">:=</span>
<span class="k">by</span> <span class="o">{</span> <span class="n">rcases</span> <span class="n">h</span> <span class="k">with</span> <span class="bp">⟨</span><span class="n">k</span><span class="o">,</span> <span class="n">rfl</span><span class="bp">⟩</span><span class="o">,</span> <span class="n">refine</span> <span class="bp">⟨</span><span class="n">k</span><span class="o">,</span> <span class="k">by</span> <span class="n">norm_cast</span><span class="bp">⟩</span> <span class="o">}</span>

<span class="kn">lemma</span> <span class="n">dvd_sub_pow_of_dvd_sub</span> <span class="o">(</span><span class="n">R</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">[</span><span class="n">comm_ring</span> <span class="n">R</span><span class="o">]</span> <span class="o">(</span><span class="n">p</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">)</span> <span class="o">[</span><span class="n">hp</span> <span class="o">:</span> <span class="n">fact</span> <span class="n">p</span><span class="bp">.</span><span class="n">prime</span><span class="o">]</span>
  <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="o">:</span> <span class="n">R</span><span class="o">)</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="o">(</span><span class="n">p</span> <span class="o">:</span> <span class="n">R</span><span class="o">)</span> <span class="err">∣</span> <span class="n">a</span> <span class="bp">-</span> <span class="n">b</span><span class="o">)</span> <span class="o">(</span><span class="n">k</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">)</span> <span class="o">:</span>
  <span class="o">(</span><span class="n">p</span><span class="bp">^</span><span class="o">(</span><span class="n">k</span><span class="bp">+</span><span class="mi">1</span><span class="o">)</span> <span class="o">:</span> <span class="n">R</span><span class="o">)</span> <span class="err">∣</span> <span class="n">a</span><span class="bp">^</span><span class="o">(</span><span class="n">p</span><span class="bp">^</span><span class="n">k</span><span class="o">)</span> <span class="bp">-</span> <span class="n">b</span><span class="bp">^</span><span class="o">(</span><span class="n">p</span><span class="bp">^</span><span class="n">k</span><span class="o">)</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="n">induction</span> <span class="n">k</span> <span class="k">with</span> <span class="n">k</span> <span class="n">ih</span><span class="o">,</span> <span class="o">{</span> <span class="n">simpa</span> <span class="kn">using</span> <span class="n">h</span> <span class="o">},</span> <span class="n">clear</span> <span class="n">h</span><span class="o">,</span>
  <span class="n">simp</span> <span class="n">only</span> <span class="o">[</span><span class="n">nat</span><span class="bp">.</span><span class="n">succ_eq_add_one</span><span class="o">],</span>
  <span class="n">rcases</span> <span class="n">ih</span> <span class="k">with</span> <span class="bp">⟨</span><span class="n">c</span><span class="o">,</span> <span class="n">hc</span><span class="bp">⟩</span><span class="o">,</span>
  <span class="n">rw</span> <span class="n">sub_eq_iff_eq_add&#39;</span> <span class="n">at</span> <span class="n">hc</span><span class="o">,</span>
  <span class="n">replace</span> <span class="n">hc</span> <span class="o">:=</span> <span class="n">congr_arg</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">x</span><span class="o">,</span> <span class="n">x</span><span class="bp">^</span><span class="n">p</span><span class="o">)</span> <span class="n">hc</span><span class="o">,</span>
  <span class="n">dsimp</span> <span class="n">only</span> <span class="n">at</span> <span class="n">hc</span><span class="o">,</span>
  <span class="n">rw</span> <span class="o">[</span><span class="err">←</span> <span class="n">pow_mul</span><span class="o">,</span> <span class="n">add_pow</span><span class="o">,</span> <span class="n">finset</span><span class="bp">.</span><span class="n">sum_range_succ</span><span class="o">,</span> <span class="n">nat</span><span class="bp">.</span><span class="n">choose_self</span><span class="o">,</span> <span class="n">nat</span><span class="bp">.</span><span class="n">cast_one</span><span class="o">,</span> <span class="n">mul_one</span><span class="o">,</span>
    <span class="n">nat</span><span class="bp">.</span><span class="n">sub_self</span><span class="o">,</span> <span class="n">pow_zero</span><span class="o">,</span> <span class="n">mul_one</span><span class="o">]</span> <span class="n">at</span> <span class="n">hc</span><span class="o">,</span>
  <span class="n">conv</span> <span class="o">{</span> <span class="n">congr</span><span class="o">,</span> <span class="n">skip</span><span class="o">,</span> <span class="n">rw</span> <span class="o">[</span><span class="n">nat</span><span class="bp">.</span><span class="n">pow_succ</span><span class="o">]</span> <span class="o">},</span>
  <span class="n">simp</span> <span class="n">only</span> <span class="o">[</span><span class="n">nat</span><span class="bp">.</span><span class="n">pow_eq_pow</span><span class="o">]</span> <span class="n">at</span> <span class="n">hc</span><span class="o">,</span>
  <span class="n">rw</span> <span class="o">[</span><span class="n">hc</span><span class="o">,</span> <span class="n">pow_mul</span><span class="o">,</span> <span class="n">add_sub_cancel&#39;</span><span class="o">],</span> <span class="n">clear</span> <span class="n">hc</span> <span class="n">a</span><span class="o">,</span>
  <span class="n">apply</span> <span class="n">dvd_sum</span><span class="o">,</span>
  <span class="n">intros</span> <span class="n">i</span> <span class="n">hi</span><span class="o">,</span>
  <span class="n">rw</span> <span class="n">finset</span><span class="bp">.</span><span class="n">mem_range</span> <span class="n">at</span> <span class="n">hi</span><span class="o">,</span>
  <span class="n">rw</span> <span class="n">mul_pow</span><span class="o">,</span>
  <span class="n">conv</span> <span class="o">{</span> <span class="n">congr</span><span class="o">,</span> <span class="n">skip</span><span class="o">,</span> <span class="n">congr</span><span class="o">,</span> <span class="n">congr</span><span class="o">,</span> <span class="n">skip</span><span class="o">,</span> <span class="n">rw</span> <span class="n">mul_comm</span> <span class="o">},</span>
  <span class="n">repeat</span> <span class="o">{</span> <span class="n">rw</span> <span class="n">mul_assoc</span><span class="o">,</span> <span class="n">apply</span> <span class="n">dvd_mul_of_dvd_right</span> <span class="o">},</span> <span class="n">clear</span> <span class="n">c</span> <span class="n">b</span><span class="o">,</span>
  <span class="n">norm_cast</span><span class="o">,</span>
  <span class="n">apply</span> <span class="n">coe_nat_dvd</span><span class="o">,</span>
  <span class="n">by_cases</span> <span class="n">H</span> <span class="o">:</span> <span class="n">i</span> <span class="bp">=</span> <span class="mi">0</span><span class="o">,</span>
  <span class="o">{</span> <span class="n">subst</span> <span class="n">H</span><span class="o">,</span>
    <span class="n">suffices</span> <span class="o">:</span> <span class="n">p</span> <span class="bp">^</span> <span class="o">(</span><span class="n">k</span> <span class="bp">+</span> <span class="mi">1</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)</span> <span class="err">∣</span> <span class="o">(</span><span class="n">p</span> <span class="bp">^</span> <span class="o">(</span><span class="n">k</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">))</span> <span class="bp">^</span> <span class="n">p</span><span class="o">,</span> <span class="k">by</span> <span class="n">simpa</span><span class="o">,</span>
    <span class="n">rw</span> <span class="err">←</span> <span class="n">nat</span><span class="bp">.</span><span class="n">pow_mul</span><span class="o">,</span>
    <span class="n">apply</span> <span class="n">nat</span><span class="bp">.</span><span class="n">pow_dvd_pow</span><span class="o">,</span>
    <span class="n">refine</span> <span class="n">le_trans</span> <span class="o">(</span><span class="n">add_le_add_left&#39;</span> <span class="err">$</span> <span class="n">le_add_left</span> <span class="err">$</span> <span class="n">le_refl</span> <span class="bp">_</span> <span class="o">:</span> <span class="n">k</span> <span class="bp">+</span> <span class="mi">1</span> <span class="bp">+</span> <span class="mi">1</span> <span class="bp">≤</span> <span class="n">k</span> <span class="bp">+</span> <span class="mi">1</span> <span class="bp">+</span> <span class="o">(</span><span class="n">k</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">))</span> <span class="bp">_</span><span class="o">,</span>
    <span class="n">refine</span> <span class="n">le_trans</span> <span class="o">(</span><span class="n">le_of_eq</span> <span class="bp">_</span><span class="o">)</span> <span class="o">(</span><span class="n">nat</span><span class="bp">.</span><span class="n">mul_le_mul_left</span> <span class="o">(</span><span class="n">k</span><span class="bp">+</span><span class="mi">1</span><span class="o">)</span> <span class="err">$</span> <span class="o">(</span><span class="n">hp</span><span class="bp">.</span><span class="n">two_le</span> <span class="o">:</span> <span class="mi">2</span> <span class="bp">≤</span> <span class="n">p</span><span class="o">)),</span>
    <span class="n">rw</span> <span class="n">mul_two</span> <span class="o">},</span>
  <span class="k">have</span> <span class="n">i_pos</span> <span class="o">:=</span> <span class="n">nat</span><span class="bp">.</span><span class="n">pos_of_ne_zero</span> <span class="n">H</span><span class="o">,</span> <span class="n">clear</span> <span class="n">H</span><span class="o">,</span>
  <span class="n">rw</span> <span class="n">nat</span><span class="bp">.</span><span class="n">pow_succ</span><span class="o">,</span>
  <span class="n">apply</span> <span class="n">mul_dvd_mul</span><span class="o">,</span>
  <span class="o">{</span> <span class="n">generalize</span> <span class="n">H</span> <span class="o">:</span> <span class="o">(</span><span class="n">p</span><span class="bp">^</span><span class="o">(</span><span class="n">k</span><span class="bp">+</span><span class="mi">1</span><span class="o">))</span> <span class="bp">=</span> <span class="n">b</span><span class="o">,</span>
    <span class="k">have</span> <span class="o">:=</span> <span class="n">nat</span><span class="bp">.</span><span class="n">sub_pos_of_lt</span> <span class="n">hi</span><span class="o">,</span>
    <span class="n">conv</span> <span class="o">{</span><span class="n">congr</span><span class="o">,</span> <span class="n">rw</span> <span class="err">←</span> <span class="n">nat</span><span class="bp">.</span><span class="n">pow_one</span> <span class="n">b</span><span class="o">},</span>
    <span class="n">apply</span> <span class="n">nat</span><span class="bp">.</span><span class="n">pow_dvd_pow</span><span class="o">,</span>
    <span class="n">exact</span> <span class="n">this</span> <span class="o">},</span>
  <span class="n">exact</span> <span class="n">nat</span><span class="bp">.</span><span class="n">prime</span><span class="bp">.</span><span class="n">dvd_choose</span> <span class="n">i_pos</span> <span class="n">hi</span> <span class="err">‹</span><span class="bp">_</span><span class="err">›</span>
<span class="kn">end</span>
</code></pre></div>



<a name="196989346"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/golfing%20challenge/near/196989346" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/golfing.20challenge.html#196989346">(May 09 2020 at 12:25)</a>:</h4>
<p>Currently it takes so long on my machine that I'm worried codewars wouldn't accept it.</p>



<a name="196989400"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/golfing%20challenge/near/196989400" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/golfing.20challenge.html#196989400">(May 09 2020 at 12:26)</a>:</h4>
<p><span class="user-mention silent" data-user-id="112680">Johan Commelin</span> <a href="#narrow/stream/116395-maths/topic/golfing.20challenge/near/196989334" title="#narrow/stream/116395-maths/topic/golfing.20challenge/near/196989334">said</a>:</p>
<blockquote>
<p>Feel free to turn this into a <del>kata</del> mathlib PR.</p>
</blockquote>



<a name="196989418"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/golfing%20challenge/near/196989418" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/golfing.20challenge.html#196989418">(May 09 2020 at 12:26)</a>:</h4>
<p>Only after it's fast enough to be a kata</p>



<a name="196990008"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/golfing%20challenge/near/196990008" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Chris Hughes <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/golfing.20challenge.html#196990008">(May 09 2020 at 12:43)</a>:</h4>
<p>The generalization of the first theorem is <code>is_add_submonoid.sum_mem</code>. Whether that's a good way to state it I don't know.</p>



<a name="196990061"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/golfing%20challenge/near/196990061" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/golfing.20challenge.html#196990061">(May 09 2020 at 12:44)</a>:</h4>
<p>But it might be a good way to prove it.</p>



<a name="196990080"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/golfing%20challenge/near/196990080" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/golfing.20challenge.html#196990080">(May 09 2020 at 12:45)</a>:</h4>
<p>On the other hand, the other suggestions don't really follow from <code>sum_mem</code>, I guess. Things like <code>sum_pos</code> and <code>sum_neg</code></p>



<a name="196990127"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/golfing%20challenge/near/196990127" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/golfing.20challenge.html#196990127">(May 09 2020 at 12:46)</a>:</h4>
<p>Well, they do, but I don't think the relevant submonoids have been set up.</p>



<a name="196991420"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/golfing%20challenge/near/196991420" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Chris Hughes <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/golfing.20challenge.html#196991420">(May 09 2020 at 13:19)</a>:</h4>
<p><code>sum_pos</code> and <code>sum_neg</code> actually need <code>is_add_subsemigroup.sum_mem_of_ne_empty</code> which doesn't exist.</p>



<a name="196991463"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/golfing%20challenge/near/196991463" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/golfing.20challenge.html#196991463">(May 09 2020 at 13:20)</a>:</h4>
<p><code>sum_nonpos</code> and <code>sum_nonneg</code>...</p>



<a name="196993221"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/golfing%20challenge/near/196993221" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/golfing.20challenge.html#196993221">(May 09 2020 at 14:07)</a>:</h4>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="n">data</span><span class="bp">.</span><span class="n">nat</span><span class="bp">.</span><span class="n">choose</span> <span class="n">algebra</span><span class="bp">.</span><span class="n">geom_sum</span> <span class="n">ring_theory</span><span class="bp">.</span><span class="n">ideals</span>

<span class="c1">-- Generalise this to arbitrary property that is respected by addition/multiplication:</span>
<span class="c1">-- example applications: sum_pos, sum_neg, ... others?</span>
<span class="kn">lemma</span> <span class="n">dvd_sum</span> <span class="o">{</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">{</span><span class="n">R</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">comm_ring</span> <span class="n">R</span><span class="o">]</span>
  <span class="o">(</span><span class="n">s</span> <span class="o">:</span> <span class="n">finset</span> <span class="n">α</span><span class="o">)</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">α</span> <span class="bp">→</span> <span class="n">R</span><span class="o">)</span> <span class="o">(</span><span class="n">b</span> <span class="o">:</span> <span class="n">R</span><span class="o">)</span> <span class="o">(</span><span class="n">H</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">a</span> <span class="err">∈</span> <span class="n">s</span><span class="o">,</span> <span class="n">b</span> <span class="err">∣</span> <span class="n">f</span> <span class="n">a</span><span class="o">)</span> <span class="o">:</span>
  <span class="n">b</span> <span class="err">∣</span> <span class="n">s</span><span class="bp">.</span><span class="n">sum</span> <span class="n">f</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="n">classical</span><span class="o">,</span> <span class="n">revert</span> <span class="n">H</span><span class="o">,</span>
  <span class="n">apply</span> <span class="n">finset</span><span class="bp">.</span><span class="n">induction_on</span> <span class="n">s</span><span class="o">,</span>
  <span class="o">{</span> <span class="n">intros</span><span class="o">,</span> <span class="n">exact</span> <span class="n">dvd_zero</span> <span class="n">b</span><span class="o">,</span> <span class="o">},</span>
  <span class="n">intros</span> <span class="n">a</span> <span class="n">s</span> <span class="n">has</span> <span class="n">ih</span> <span class="n">H</span><span class="o">,</span>
  <span class="n">rw</span> <span class="n">finset</span><span class="bp">.</span><span class="n">forall_mem_insert</span> <span class="n">at</span> <span class="n">H</span><span class="o">,</span>
  <span class="n">rw</span> <span class="n">finset</span><span class="bp">.</span><span class="n">sum_insert</span> <span class="n">has</span><span class="o">,</span>
  <span class="n">exact</span> <span class="n">dvd_add</span> <span class="n">H</span><span class="bp">.</span><span class="mi">1</span> <span class="o">(</span><span class="n">ih</span> <span class="n">H</span><span class="bp">.</span><span class="mi">2</span><span class="o">)</span>
<span class="kn">end</span>

<span class="kn">lemma</span> <span class="n">coe_nat_dvd</span> <span class="o">{</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">comm_ring</span> <span class="n">α</span><span class="o">]</span> <span class="o">(</span><span class="n">m</span> <span class="n">n</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">)</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="n">m</span> <span class="err">∣</span> <span class="n">n</span><span class="o">)</span> <span class="o">:</span>
  <span class="o">(</span><span class="n">m</span> <span class="o">:</span> <span class="n">α</span><span class="o">)</span> <span class="err">∣</span> <span class="n">n</span> <span class="o">:=</span>
<span class="k">by</span> <span class="o">{</span> <span class="n">rcases</span> <span class="n">h</span> <span class="k">with</span> <span class="bp">⟨</span><span class="n">k</span><span class="o">,</span> <span class="n">rfl</span><span class="bp">⟩</span><span class="o">,</span> <span class="n">refine</span> <span class="bp">⟨</span><span class="n">k</span><span class="o">,</span> <span class="k">by</span> <span class="n">norm_cast</span><span class="bp">⟩</span> <span class="o">}</span>

<span class="kn">instance</span> <span class="o">{</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">comm_ring</span> <span class="n">α</span><span class="o">]</span> <span class="o">(</span><span class="n">I</span> <span class="o">:</span> <span class="n">ideal</span> <span class="n">α</span><span class="o">)</span> <span class="o">:</span> <span class="n">is_ring_hom</span> <span class="o">(</span><span class="n">ideal</span><span class="bp">.</span><span class="n">quotient</span><span class="bp">.</span><span class="n">mk</span> <span class="n">I</span><span class="o">)</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">ideal</span><span class="bp">.</span><span class="n">quotient</span><span class="bp">.</span><span class="n">mk_hom</span> <span class="n">I</span><span class="o">)</span><span class="bp">.</span><span class="n">is_ring_hom</span>

<span class="kn">lemma</span> <span class="n">mk_eq_mk_hom</span> <span class="o">{</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">comm_ring</span> <span class="n">α</span><span class="o">]</span> <span class="o">(</span><span class="n">I</span> <span class="o">:</span> <span class="n">ideal</span> <span class="n">α</span><span class="o">)</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="n">α</span><span class="o">)</span> <span class="o">:</span>
  <span class="n">ideal</span><span class="bp">.</span><span class="n">quotient</span><span class="bp">.</span><span class="n">mk</span> <span class="n">I</span> <span class="n">x</span> <span class="bp">=</span> <span class="n">ideal</span><span class="bp">.</span><span class="n">quotient</span><span class="bp">.</span><span class="n">mk_hom</span> <span class="n">I</span> <span class="n">x</span> <span class="o">:=</span>
<span class="n">rfl</span>

<span class="kn">theorem</span> <span class="n">ring_hom</span><span class="bp">.</span><span class="n">map_geom_series₂</span> <span class="o">{</span><span class="n">α</span> <span class="n">β</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">comm_ring</span> <span class="n">α</span><span class="o">]</span> <span class="o">[</span><span class="n">comm_ring</span> <span class="n">β</span><span class="o">]</span> <span class="o">(</span><span class="n">x</span> <span class="n">y</span> <span class="o">:</span> <span class="n">α</span><span class="o">)</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">)</span>
  <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">α</span> <span class="bp">→+*</span> <span class="n">β</span><span class="o">)</span> <span class="o">:</span> <span class="n">f</span> <span class="o">(</span><span class="n">geom_series₂</span> <span class="n">x</span> <span class="n">y</span> <span class="n">n</span><span class="o">)</span> <span class="bp">=</span> <span class="n">geom_series₂</span> <span class="o">(</span><span class="n">f</span> <span class="n">x</span><span class="o">)</span> <span class="o">(</span><span class="n">f</span> <span class="n">y</span><span class="o">)</span> <span class="n">n</span> <span class="o">:=</span>
<span class="k">by</span> <span class="o">{</span> <span class="n">rw</span> <span class="o">[</span><span class="n">geom_series₂_def</span><span class="o">,</span> <span class="n">geom_series₂_def</span><span class="o">,</span> <span class="err">←</span> <span class="n">finset</span><span class="bp">.</span><span class="n">sum_hom</span> <span class="bp">_</span> <span class="n">f</span><span class="o">],</span>
    <span class="n">simp_rw</span> <span class="o">[</span><span class="n">f</span><span class="bp">.</span><span class="n">map_mul</span><span class="o">,</span> <span class="n">f</span><span class="bp">.</span><span class="n">map_pow</span><span class="o">]</span> <span class="o">}</span>

<span class="kn">theorem</span> <span class="n">geom_series₂_self</span> <span class="o">{</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">comm_ring</span> <span class="n">α</span><span class="o">]</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="n">α</span><span class="o">)</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">)</span> <span class="o">:</span>
  <span class="n">geom_series₂</span> <span class="n">x</span> <span class="n">x</span> <span class="n">n</span> <span class="bp">=</span> <span class="n">n</span> <span class="bp">*</span> <span class="n">x</span> <span class="bp">^</span> <span class="o">(</span><span class="n">n</span><span class="bp">-</span><span class="mi">1</span><span class="o">)</span> <span class="o">:=</span>
<span class="k">calc</span>  <span class="o">(</span><span class="n">finset</span><span class="bp">.</span><span class="n">range</span> <span class="n">n</span><span class="o">)</span><span class="bp">.</span><span class="n">sum</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">i</span><span class="o">,</span> <span class="n">x</span> <span class="bp">^</span> <span class="n">i</span> <span class="bp">*</span> <span class="n">x</span> <span class="bp">^</span> <span class="o">(</span><span class="n">n</span> <span class="bp">-</span> <span class="mi">1</span> <span class="bp">-</span> <span class="n">i</span><span class="o">))</span>
    <span class="bp">=</span> <span class="o">(</span><span class="n">finset</span><span class="bp">.</span><span class="n">range</span> <span class="n">n</span><span class="o">)</span><span class="bp">.</span><span class="n">sum</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">i</span><span class="o">,</span> <span class="n">x</span> <span class="bp">^</span> <span class="o">(</span><span class="n">i</span> <span class="bp">+</span> <span class="o">(</span><span class="n">n</span> <span class="bp">-</span> <span class="mi">1</span> <span class="bp">-</span> <span class="n">i</span><span class="o">)))</span> <span class="o">:</span> <span class="k">by</span> <span class="n">simp_rw</span> <span class="o">[</span><span class="err">←</span> <span class="n">pow_add</span><span class="o">]</span>
<span class="bp">...</span> <span class="bp">=</span> <span class="o">(</span><span class="n">finset</span><span class="bp">.</span><span class="n">range</span> <span class="n">n</span><span class="o">)</span><span class="bp">.</span><span class="n">sum</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">i</span><span class="o">,</span> <span class="n">x</span> <span class="bp">^</span> <span class="o">(</span><span class="n">n</span> <span class="bp">-</span> <span class="mi">1</span><span class="o">))</span> <span class="o">:</span> <span class="n">finset</span><span class="bp">.</span><span class="n">sum_congr</span> <span class="n">rfl</span>
  <span class="o">(</span><span class="bp">λ</span> <span class="n">i</span> <span class="n">hi</span><span class="o">,</span> <span class="n">congr_arg</span> <span class="bp">_</span> <span class="err">$</span> <span class="n">nat</span><span class="bp">.</span><span class="n">add_sub_cancel&#39;</span> <span class="err">$</span> <span class="n">nat</span><span class="bp">.</span><span class="n">le_pred_of_lt</span> <span class="err">$</span> <span class="n">finset</span><span class="bp">.</span><span class="n">mem_range</span><span class="bp">.</span><span class="mi">1</span> <span class="n">hi</span><span class="o">)</span>
<span class="bp">...</span> <span class="bp">=</span> <span class="n">add_monoid</span><span class="bp">.</span><span class="n">smul</span> <span class="o">(</span><span class="n">finset</span><span class="bp">.</span><span class="n">range</span> <span class="n">n</span><span class="o">)</span><span class="bp">.</span><span class="n">card</span> <span class="o">(</span><span class="n">x</span> <span class="bp">^</span> <span class="o">(</span><span class="n">n</span> <span class="bp">-</span> <span class="mi">1</span><span class="o">))</span> <span class="o">:</span> <span class="n">finset</span><span class="bp">.</span><span class="n">sum_const</span> <span class="bp">_</span>
<span class="bp">...</span> <span class="bp">=</span> <span class="n">n</span> <span class="bp">*</span> <span class="n">x</span> <span class="bp">^</span> <span class="o">(</span><span class="n">n</span> <span class="bp">-</span> <span class="mi">1</span><span class="o">)</span> <span class="o">:</span> <span class="k">by</span> <span class="n">rw</span> <span class="o">[</span><span class="n">finset</span><span class="bp">.</span><span class="n">card_range</span><span class="o">,</span> <span class="n">add_monoid</span><span class="bp">.</span><span class="n">smul_eq_mul</span><span class="o">]</span>


<span class="kn">lemma</span> <span class="n">dvd_sub_pow_of_dvd_sub</span> <span class="o">(</span><span class="n">R</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">[</span><span class="n">comm_ring</span> <span class="n">R</span><span class="o">]</span> <span class="o">(</span><span class="n">p</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">)</span> <span class="o">[</span><span class="n">hp</span> <span class="o">:</span> <span class="n">fact</span> <span class="n">p</span><span class="bp">.</span><span class="n">prime</span><span class="o">]</span>
  <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="o">:</span> <span class="n">R</span><span class="o">)</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="o">(</span><span class="n">p</span> <span class="o">:</span> <span class="n">R</span><span class="o">)</span> <span class="err">∣</span> <span class="n">a</span> <span class="bp">-</span> <span class="n">b</span><span class="o">)</span> <span class="o">(</span><span class="n">k</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">)</span> <span class="o">:</span>
  <span class="o">(</span><span class="n">p</span><span class="bp">^</span><span class="o">(</span><span class="n">k</span><span class="bp">+</span><span class="mi">1</span><span class="o">)</span> <span class="o">:</span> <span class="n">R</span><span class="o">)</span> <span class="err">∣</span> <span class="n">a</span><span class="bp">^</span><span class="o">(</span><span class="n">p</span><span class="bp">^</span><span class="n">k</span><span class="o">)</span> <span class="bp">-</span> <span class="n">b</span><span class="bp">^</span><span class="o">(</span><span class="n">p</span><span class="bp">^</span><span class="n">k</span><span class="o">)</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="n">induction</span> <span class="n">k</span> <span class="k">with</span> <span class="n">k</span> <span class="n">ih</span><span class="o">,</span>
  <span class="o">{</span> <span class="n">rwa</span> <span class="o">[</span><span class="n">pow_one</span><span class="o">,</span> <span class="n">nat</span><span class="bp">.</span><span class="n">pow_zero</span><span class="o">,</span> <span class="n">pow_one</span><span class="o">,</span> <span class="n">pow_one</span><span class="o">]</span> <span class="o">},</span>
  <span class="n">rw</span> <span class="o">[</span><span class="n">nat</span><span class="bp">.</span><span class="n">pow_succ</span><span class="o">,</span> <span class="n">pow_mul</span><span class="o">,</span> <span class="n">pow_mul</span><span class="o">,</span> <span class="err">←</span> <span class="n">geom_sum₂_mul</span><span class="o">,</span> <span class="n">pow_succ</span><span class="o">],</span>
  <span class="n">refine</span> <span class="n">mul_dvd_mul</span> <span class="bp">_</span> <span class="n">ih</span><span class="o">,</span>
  <span class="n">rw</span> <span class="o">[</span><span class="err">←</span> <span class="n">ideal</span><span class="bp">.</span><span class="n">mem_span_singleton</span><span class="o">,</span> <span class="err">←</span> <span class="n">ideal</span><span class="bp">.</span><span class="n">quotient</span><span class="bp">.</span><span class="n">eq</span><span class="o">,</span> <span class="n">mk_eq_mk_hom</span><span class="o">,</span> <span class="n">mk_eq_mk_hom</span><span class="o">]</span> <span class="n">at</span> <span class="n">h</span><span class="o">,</span>
  <span class="n">rw</span> <span class="o">[</span><span class="err">←</span> <span class="n">ideal</span><span class="bp">.</span><span class="n">mem_span_singleton</span><span class="o">,</span> <span class="err">←</span> <span class="n">ideal</span><span class="bp">.</span><span class="n">quotient</span><span class="bp">.</span><span class="n">eq_zero_iff_mem</span><span class="o">,</span> <span class="n">mk_eq_mk_hom</span><span class="o">,</span>
      <span class="n">ring_hom</span><span class="bp">.</span><span class="n">map_geom_series₂</span><span class="o">,</span> <span class="n">ring_hom</span><span class="bp">.</span><span class="n">map_pow</span><span class="o">,</span> <span class="n">ring_hom</span><span class="bp">.</span><span class="n">map_pow</span><span class="o">,</span> <span class="n">h</span><span class="o">,</span> <span class="n">geom_series₂_self</span><span class="o">,</span>
      <span class="err">←</span> <span class="n">ring_hom</span><span class="bp">.</span><span class="n">map_pow</span><span class="o">,</span> <span class="err">←</span> <span class="n">ring_hom</span><span class="bp">.</span><span class="n">map_pow</span><span class="o">,</span> <span class="err">←</span> <span class="n">add_monoid</span><span class="bp">.</span><span class="n">smul_eq_mul</span><span class="o">],</span>
  <span class="n">erw</span> <span class="o">[</span><span class="err">←</span> <span class="o">(</span><span class="n">ideal</span><span class="bp">.</span><span class="n">quotient</span><span class="bp">.</span><span class="n">mk_hom</span> <span class="o">(</span><span class="n">ideal</span><span class="bp">.</span><span class="n">span</span> <span class="o">({</span><span class="n">p</span><span class="o">}</span> <span class="o">:</span> <span class="n">set</span> <span class="n">R</span><span class="o">)))</span><span class="bp">.</span><span class="n">to_add_monoid_hom</span><span class="bp">.</span><span class="n">map_smul</span><span class="o">,</span>
      <span class="n">ideal</span><span class="bp">.</span><span class="n">quotient</span><span class="bp">.</span><span class="n">eq_zero_iff_mem</span><span class="o">],</span>
  <span class="n">rw</span> <span class="n">add_monoid</span><span class="bp">.</span><span class="n">smul_eq_mul</span><span class="o">,</span>
  <span class="n">exact</span> <span class="n">ideal</span><span class="bp">.</span><span class="n">mul_mem_right</span> <span class="bp">_</span> <span class="o">(</span><span class="n">ideal</span><span class="bp">.</span><span class="n">mem_span_singleton</span><span class="bp">.</span><span class="mi">2</span> <span class="err">$</span> <span class="n">dvd_refl</span> <span class="o">(</span><span class="n">p</span> <span class="o">:</span> <span class="n">R</span><span class="o">))</span>
<span class="kn">end</span>
</code></pre></div>



<a name="196993237"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/golfing%20challenge/near/196993237" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/golfing.20challenge.html#196993237">(May 09 2020 at 14:08)</a>:</h4>
<p><span class="user-mention" data-user-id="112680">@Johan Commelin</span> the trick is to use <code>geom_series\2</code> and quotient ring</p>



<a name="196993454"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/golfing%20challenge/near/196993454" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/golfing.20challenge.html#196993454">(May 09 2020 at 14:12)</a>:</h4>
<p><span class="user-mention" data-user-id="110064">@Kenny Lau</span>  Sounds good. Thanks! Wanna make a PR?</p>



<a name="196993461"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/golfing%20challenge/near/196993461" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/golfing.20challenge.html#196993461">(May 09 2020 at 14:12)</a>:</h4>
<p>go ahead</p>



<a name="196994350"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/golfing%20challenge/near/196994350" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/golfing.20challenge.html#196994350">(May 09 2020 at 14:32)</a>:</h4>
<p><span class="user-mention" data-user-id="110064">@Kenny Lau</span> Golfed further:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">lemma</span> <span class="n">dvd_sub_pow_of_dvd_sub</span> <span class="o">(</span><span class="n">R</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">[</span><span class="n">comm_ring</span> <span class="n">R</span><span class="o">]</span> <span class="o">(</span><span class="n">p</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">)</span> <span class="o">[</span><span class="n">hp</span> <span class="o">:</span> <span class="n">fact</span> <span class="n">p</span><span class="bp">.</span><span class="n">prime</span><span class="o">]</span>
  <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="o">:</span> <span class="n">R</span><span class="o">)</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="o">(</span><span class="n">p</span> <span class="o">:</span> <span class="n">R</span><span class="o">)</span> <span class="err">∣</span> <span class="n">a</span> <span class="bp">-</span> <span class="n">b</span><span class="o">)</span> <span class="o">(</span><span class="n">k</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">)</span> <span class="o">:</span>
  <span class="o">(</span><span class="n">p</span><span class="bp">^</span><span class="o">(</span><span class="n">k</span><span class="bp">+</span><span class="mi">1</span><span class="o">)</span> <span class="o">:</span> <span class="n">R</span><span class="o">)</span> <span class="err">∣</span> <span class="n">a</span><span class="bp">^</span><span class="o">(</span><span class="n">p</span><span class="bp">^</span><span class="n">k</span><span class="o">)</span> <span class="bp">-</span> <span class="n">b</span><span class="bp">^</span><span class="o">(</span><span class="n">p</span><span class="bp">^</span><span class="n">k</span><span class="o">)</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="n">induction</span> <span class="n">k</span> <span class="k">with</span> <span class="n">k</span> <span class="n">ih</span><span class="o">,</span>
  <span class="o">{</span> <span class="n">rwa</span> <span class="o">[</span><span class="n">pow_one</span><span class="o">,</span> <span class="n">nat</span><span class="bp">.</span><span class="n">pow_zero</span><span class="o">,</span> <span class="n">pow_one</span><span class="o">,</span> <span class="n">pow_one</span><span class="o">]</span> <span class="o">},</span>
  <span class="n">rw</span> <span class="o">[</span><span class="n">nat</span><span class="bp">.</span><span class="n">pow_succ</span><span class="o">,</span> <span class="n">pow_mul</span><span class="o">,</span> <span class="n">pow_mul</span><span class="o">,</span> <span class="err">←</span> <span class="n">geom_sum₂_mul</span><span class="o">,</span> <span class="n">pow_succ</span><span class="o">],</span>
  <span class="n">refine</span> <span class="n">mul_dvd_mul</span> <span class="bp">_</span> <span class="n">ih</span><span class="o">,</span>
  <span class="k">have</span> <span class="o">:</span> <span class="o">(</span><span class="n">p</span> <span class="o">:</span> <span class="n">R</span><span class="o">)</span> <span class="err">∈</span> <span class="n">ideal</span><span class="bp">.</span><span class="n">span</span> <span class="o">({</span><span class="n">p</span><span class="o">}</span> <span class="o">:</span> <span class="n">set</span> <span class="n">R</span><span class="o">),</span> <span class="o">{</span> <span class="n">rw</span> <span class="n">ideal</span><span class="bp">.</span><span class="n">mem_span_singleton</span> <span class="o">},</span>
  <span class="n">rw</span> <span class="o">[</span><span class="err">←</span> <span class="n">ideal</span><span class="bp">.</span><span class="n">quotient</span><span class="bp">.</span><span class="n">eq_zero_iff_mem</span><span class="o">,</span> <span class="n">mk_eq_mk_hom</span><span class="o">,</span> <span class="n">ring_hom</span><span class="bp">.</span><span class="n">map_nat_cast</span><span class="o">]</span> <span class="n">at</span> <span class="n">this</span><span class="o">,</span>
  <span class="n">rw</span> <span class="o">[</span><span class="err">←</span> <span class="n">ideal</span><span class="bp">.</span><span class="n">mem_span_singleton</span><span class="o">,</span> <span class="err">←</span> <span class="n">ideal</span><span class="bp">.</span><span class="n">quotient</span><span class="bp">.</span><span class="n">eq</span><span class="o">,</span> <span class="n">mk_eq_mk_hom</span><span class="o">,</span> <span class="n">mk_eq_mk_hom</span><span class="o">]</span> <span class="n">at</span> <span class="n">h</span><span class="o">,</span>
  <span class="n">rw</span> <span class="o">[</span><span class="err">←</span> <span class="n">ideal</span><span class="bp">.</span><span class="n">mem_span_singleton</span><span class="o">,</span> <span class="err">←</span> <span class="n">ideal</span><span class="bp">.</span><span class="n">quotient</span><span class="bp">.</span><span class="n">eq_zero_iff_mem</span><span class="o">,</span> <span class="n">mk_eq_mk_hom</span><span class="o">,</span>
      <span class="n">ring_hom</span><span class="bp">.</span><span class="n">map_geom_series₂</span><span class="o">,</span> <span class="n">ring_hom</span><span class="bp">.</span><span class="n">map_pow</span><span class="o">,</span> <span class="n">ring_hom</span><span class="bp">.</span><span class="n">map_pow</span><span class="o">,</span> <span class="n">h</span><span class="o">,</span> <span class="n">geom_series₂_self</span><span class="o">,</span>
      <span class="n">this</span><span class="o">,</span> <span class="n">zero_mul</span><span class="o">],</span>
<span class="kn">end</span>
</code></pre></div>



<a name="196994371"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/golfing%20challenge/near/196994371" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/golfing.20challenge.html#196994371">(May 09 2020 at 14:33)</a>:</h4>
<p><span class="user-mention" data-user-id="112680">@Johan Commelin</span> aha, you applied the quotient philosophy even more</p>



<a name="196995771"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/golfing%20challenge/near/196995771" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/golfing.20challenge.html#196995771">(May 09 2020 at 15:03)</a>:</h4>
<p>Wow, from a monster it's now at de Bruijn index 1!</p>



<a name="196996126"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/golfing%20challenge/near/196996126" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/golfing.20challenge.html#196996126">(May 09 2020 at 15:11)</a>:</h4>
<p><a href="https://github.com/leanprover-community/mathlib/issues/2640" title="https://github.com/leanprover-community/mathlib/issues/2640">#2640</a></p>



<a name="197000897"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/golfing%20challenge/near/197000897" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/golfing.20challenge.html#197000897">(May 09 2020 at 16:57)</a>:</h4>
<p>Unexpected side effect: the proof doesn't use that <code>p</code> is prime (-;</p>



<a name="197000940"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/golfing%20challenge/near/197000940" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/golfing.20challenge.html#197000940">(May 09 2020 at 16:58)</a>:</h4>
<p>Maybe not so unexpected after all. But that hypothesis certainly existed in my mental copy of this lemma (-;</p>



<a name="197000943"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/golfing%20challenge/near/197000943" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/golfing.20challenge.html#197000943">(May 09 2020 at 16:58)</a>:</h4>
<p>Linters are good.</p>



<a name="197001109"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/golfing%20challenge/near/197001109" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/golfing.20challenge.html#197001109">(May 09 2020 at 17:03)</a>:</h4>
<p>wow that's unexpected</p>



<a name="197001123"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/golfing%20challenge/near/197001123" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/golfing.20challenge.html#197001123">(May 09 2020 at 17:03)</a>:</h4>
<p>it's probably because you called the variable <code>p</code></p>



<a name="197001162"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/golfing%20challenge/near/197001162" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/golfing.20challenge.html#197001162">(May 09 2020 at 17:04)</a>:</h4>
<p>It's called <code>n</code> now (-;</p>



<a name="197001263"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/golfing%20challenge/near/197001263" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/golfing.20challenge.html#197001263">(May 09 2020 at 17:07)</a>:</h4>
<p>I sort of think it should still be called <code>p</code></p>



<a name="197001266"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/golfing%20challenge/near/197001266" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/golfing.20challenge.html#197001266">(May 09 2020 at 17:07)</a>:</h4>
<p>I had no idea this was true for <code>p</code> not prime and I would certainly expect to see <code>p</code> in the theorem statement</p>



<a name="197001270"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/golfing%20challenge/near/197001270" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/golfing.20challenge.html#197001270">(May 09 2020 at 17:07)</a>:</h4>
<p>Oops... I didn't update the theorem name...</p>



<a name="197001416"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/golfing%20challenge/near/197001416" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/golfing.20challenge.html#197001416">(May 09 2020 at 17:09)</a>:</h4>
<p><span class="user-mention" data-user-id="110032">@Reid Barton</span> You can prove the special case, if you want <span aria-label="grinning face with smiling eyes" class="emoji emoji-1f601" role="img" title="grinning face with smiling eyes">:grinning_face_with_smiling_eyes:</span></p>



<a name="197001512"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/golfing%20challenge/near/197001512" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/golfing.20challenge.html#197001512">(May 09 2020 at 17:10)</a>:</h4>
<p>I don't need the special case, I just want the theorem statement to read as expected, with the <code>prime p</code> hypothesis mysteriously absent.</p>



<a name="197001798"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/golfing%20challenge/near/197001798" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/golfing.20challenge.html#197001798">(May 09 2020 at 17:15)</a>:</h4>
<p>Sure, was only joking</p>



<a name="197002305"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/golfing%20challenge/near/197002305" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/golfing.20challenge.html#197002305">(May 09 2020 at 17:24)</a>:</h4>
<p>Yeah I like that style, it's kind of an in joke</p>



<a name="197002359"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/golfing%20challenge/near/197002359" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/golfing.20challenge.html#197002359">(May 09 2020 at 17:25)</a>:</h4>
<p>For 2 you can beat this result, 2^(k+2) divides the 2^kth power if k&gt;=1.</p>



<a name="197002438"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/golfing%20challenge/near/197002438" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/golfing.20challenge.html#197002438">(May 09 2020 at 17:26)</a>:</h4>
<p>And does this get used somewhere?</p>



<a name="197002454"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/golfing%20challenge/near/197002454" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/golfing.20challenge.html#197002454">(May 09 2020 at 17:26)</a>:</h4>
<p>And the pair (1,5) show that this is tight for all k&gt;=1</p>



<a name="197002480"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/golfing%20challenge/near/197002480" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/golfing.20challenge.html#197002480">(May 09 2020 at 17:26)</a>:</h4>
<p>Analogous to the pair (1,p+1) showing its tight for odd primes</p>



<a name="197002506"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/golfing%20challenge/near/197002506" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/golfing.20challenge.html#197002506">(May 09 2020 at 17:27)</a>:</h4>
<p>You mean for arbitrary <code>p ≥ 3</code>?</p>



<a name="197002515"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/golfing%20challenge/near/197002515" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/golfing.20challenge.html#197002515">(May 09 2020 at 17:27)</a>:</h4>
<p>For <code>p = 1</code> you can do even better than for <code>p = 2</code>!!!</p>



<a name="197002518"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/golfing%20challenge/near/197002518" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/golfing.20challenge.html#197002518">(May 09 2020 at 17:27)</a>:</h4>
<p>Yes you can use it to demonstrate that 1+p resp 5 have large multiplicative orders mod p^n, and determine their order precisely</p>



<a name="197002561"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/golfing%20challenge/near/197002561" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/golfing.20challenge.html#197002561">(May 09 2020 at 17:28)</a>:</h4>
<p>And is this fact about <code>5</code> used somewhere?</p>



<a name="197002563"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/golfing%20challenge/near/197002563" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/golfing.20challenge.html#197002563">(May 09 2020 at 17:28)</a>:</h4>
<p>This gives you the structure theorem for the units of Z/p^nZ and then by CRT the structure of the units in Z/NZ</p>



<a name="197002567"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/golfing%20challenge/near/197002567" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/golfing.20challenge.html#197002567">(May 09 2020 at 17:28)</a>:</h4>
<p>Aah, I see</p>



<a name="197002606"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/golfing%20challenge/near/197002606" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/golfing.20challenge.html#197002606">(May 09 2020 at 17:29)</a>:</h4>
<p>Yes it tells you that the units in Z/32 have an element of order 8 and with that and the elements +-17 you know the structure of the group modulo the structure theorem</p>



<a name="197002616"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/golfing%20challenge/near/197002616" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/golfing.20challenge.html#197002616">(May 09 2020 at 17:29)</a>:</h4>
<p>Which you can probably prove by hand here</p>



<a name="197002633"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/golfing%20challenge/near/197002633" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/golfing.20challenge.html#197002633">(May 09 2020 at 17:29)</a>:</h4>
<p><code>dec_trivial</code>?</p>



<a name="197002673"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/golfing%20challenge/near/197002673" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/golfing.20challenge.html#197002673">(May 09 2020 at 17:30)</a>:</h4>
<p>Lol, just kidding</p>



<a name="197002689"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/golfing%20challenge/near/197002689" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/golfing.20challenge.html#197002689">(May 09 2020 at 17:30)</a>:</h4>
<p>If only</p>



<a name="197002700"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/golfing%20challenge/near/197002700" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/golfing.20challenge.html#197002700">(May 09 2020 at 17:30)</a>:</h4>
<p>But were you aware that this lemma doesn't need the primality assumption?</p>



<a name="197002704"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/golfing%20challenge/near/197002704" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/golfing.20challenge.html#197002704">(May 09 2020 at 17:30)</a>:</h4>
<p>It's <code>come_on_lean</code> you need</p>



<a name="197002713"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/golfing%20challenge/near/197002713" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/golfing.20challenge.html#197002713">(May 09 2020 at 17:30)</a>:</h4>
<p>No I didn't know</p>



<a name="197002724"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/golfing%20challenge/near/197002724" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/golfing.20challenge.html#197002724">(May 09 2020 at 17:30)</a>:</h4>
<p>Would that give you a speed up for the structure theorem?</p>



<a name="197002728"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/golfing%20challenge/near/197002728" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/golfing.20challenge.html#197002728">(May 09 2020 at 17:30)</a>:</h4>
<p>But everything I said needed it</p>



<a name="197002739"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/golfing%20challenge/near/197002739" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/golfing.20challenge.html#197002739">(May 09 2020 at 17:30)</a>:</h4>
<p>Ok, I see</p>



<a name="197002791"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/golfing%20challenge/near/197002791" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/golfing.20challenge.html#197002791">(May 09 2020 at 17:31)</a>:</h4>
<p>Well, we can make those tightness bounds into an issue for later</p>



<a name="197003189"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/golfing%20challenge/near/197003189" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> David Wärn <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/golfing.20challenge.html#197003189">(May 09 2020 at 17:42)</a>:</h4>
<p>I think this is made more precise by the "Lifting the Exponent lemma", i.e. "<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>v</mi><mi>p</mi></msub><mo stretchy="false">(</mo><msup><mi>a</mi><mi>n</mi></msup><mo>−</mo><msup><mi>b</mi><mi>n</mi></msup><mo stretchy="false">)</mo><mo>=</mo><msub><mi>v</mi><mi>p</mi></msub><mo stretchy="false">(</mo><mi>a</mi><mo>−</mo><mi>b</mi><mo stretchy="false">)</mo><mo>+</mo><msub><mi>v</mi><mi>p</mi></msub><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">v_p(a^n - b^n) = v_p(a-b)  + v_p(n)</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:1.036108em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">p</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">a</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.664392em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">n</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathdefault">b</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.664392em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">n</span></span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.036108em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">p</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathdefault">a</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault">b</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.036108em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">p</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathdefault">n</span><span class="mclose">)</span></span></span></span> for p odd prime with p dividing <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mo>−</mo><mi>b</mi></mrow><annotation encoding="application/x-tex">a-b</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.66666em;vertical-align:-0.08333em;"></span><span class="mord mathdefault">a</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault">b</span></span></span></span> but not a or b"</p>



<a name="197003254"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/golfing%20challenge/near/197003254" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/golfing.20challenge.html#197003254">(May 09 2020 at 17:44)</a>:</h4>
<p>But that needs the primality assumption...</p>



<a name="197003355"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/golfing%20challenge/near/197003355" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> David Wärn <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/golfing.20challenge.html#197003355">(May 09 2020 at 17:47)</a>:</h4>
<p>Probably one direction does, yes</p>



<a name="197003414"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/golfing%20challenge/near/197003414" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> David Wärn <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/golfing.20challenge.html#197003414">(May 09 2020 at 17:48)</a>:</h4>
<p>Or maybe both... Not sure</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>