---
layout: archive
title: Zulip Chat Archive
permalink: /stream/116395-maths/topic/dfinsupp.20of.20product.20is.20dfinsupp.20of.20dfinsupp.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/116395-maths/index.html">maths</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/dfinsupp.20of.20product.20is.20dfinsupp.20of.20dfinsupp.html">dfinsupp of product is dfinsupp of dfinsupp</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="204655886"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/dfinsupp%20of%20product%20is%20dfinsupp%20of%20dfinsupp/near/204655886" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/dfinsupp.20of.20product.20is.20dfinsupp.20of.20dfinsupp.html#204655886">(Jul 22 2020 at 11:57)</a>:</h4>
<p>I'm trying to obtain the equivalence in the following, <code>(Π₀ (ij : ii × jj), β ij.1 ij.2) ≃ (Π₀ i j, β i j)</code></p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="n">data</span><span class="bp">.</span><span class="n">dfinsupp</span>
<span class="n">universes</span> <span class="n">u</span> <span class="n">v</span> <span class="n">w</span>

<span class="c1">-- requirements of Π₀</span>
<span class="kn">variables</span> <span class="o">{</span><span class="n">ii</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">}</span> <span class="o">{</span><span class="n">jj</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">v</span><span class="o">}</span> <span class="o">[</span><span class="n">decidable_eq</span> <span class="n">ii</span><span class="o">]</span> <span class="o">[</span><span class="n">decidable_eq</span> <span class="n">jj</span><span class="o">]</span>
<span class="kn">variables</span> <span class="o">(</span><span class="n">β</span> <span class="o">:</span> <span class="n">ii</span> <span class="bp">→</span> <span class="n">jj</span> <span class="bp">→</span> <span class="kt">Type</span> <span class="n">w</span><span class="o">)</span> <span class="o">[</span><span class="bp">Π</span> <span class="n">i</span> <span class="n">j</span><span class="o">,</span> <span class="n">has_zero</span> <span class="o">(</span><span class="n">β</span> <span class="n">i</span> <span class="n">j</span><span class="o">)]</span>

<span class="kn">example</span> <span class="o">:</span> <span class="o">(</span><span class="bp">Π</span><span class="err">₀</span> <span class="o">(</span><span class="n">ij</span> <span class="o">:</span> <span class="n">ii</span> <span class="bp">×</span> <span class="n">jj</span><span class="o">),</span> <span class="n">β</span> <span class="n">ij</span><span class="bp">.</span><span class="mi">1</span> <span class="n">ij</span><span class="bp">.</span><span class="mi">2</span><span class="o">)</span> <span class="err">≃</span> <span class="o">(</span><span class="bp">Π</span><span class="err">₀</span> <span class="n">i</span> <span class="n">j</span><span class="o">,</span> <span class="n">β</span> <span class="n">i</span> <span class="n">j</span><span class="o">)</span> <span class="o">:=</span> <span class="n">sorry</span>
</code></pre></div>


<p>I initially posted this over at <a href="#narrow/stream/217875-Is-there.20code.20for.20X.3F/topic/dfinsupp.20of.20product.20is.20dfinsupp.20of.20dfinsupp/near/204537032">https://leanprover.zulipchat.com/#narrow/stream/217875-Is-there.20code.20for.20X.3F/topic/dfinsupp.20of.20product.20is.20dfinsupp.20of.20dfinsupp/near/204537032</a>.</p>
<p>Over there, you can see a definition of the forward transformation, <code>(Π₀ (ij : ii × jj), β ij.1 ij.2)) → (Π₀ i, Π₀ j, β i j)</code>, but I'm struggling to de-sorry the reverse transformation.</p>
<p>I suspect my issue here is a lack of familiarity with quotient types in lean.</p>
<p>Help finishing those definitions would be greatly appreciated!</p>



<a name="204656025"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/dfinsupp%20of%20product%20is%20dfinsupp%20of%20dfinsupp/near/204656025" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/dfinsupp.20of.20product.20is.20dfinsupp.20of.20dfinsupp.html#204656025">(Jul 22 2020 at 11:58)</a>:</h4>
<p>do you need this for a random <code>β</code>, or are they actually at least <code>add_comm_monoid</code>?</p>



<a name="204656089"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/dfinsupp%20of%20product%20is%20dfinsupp%20of%20dfinsupp/near/204656089" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/dfinsupp.20of.20product.20is.20dfinsupp.20of.20dfinsupp.html#204656089">(Jul 22 2020 at 11:59)</a>:</h4>
<p>Ideally a random <code>β</code></p>



<a name="204656141"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/dfinsupp%20of%20product%20is%20dfinsupp%20of%20dfinsupp/near/204656141" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/dfinsupp.20of.20product.20is.20dfinsupp.20of.20dfinsupp.html#204656141">(Jul 22 2020 at 11:59)</a>:</h4>
<p>I think the add_comm_monoid version probably applies better to <code>direct_sum</code> than to <code>dfinsupp</code></p>



<a name="204656304"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/dfinsupp%20of%20product%20is%20dfinsupp%20of%20dfinsupp/near/204656304" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/dfinsupp.20of.20product.20is.20dfinsupp.20of.20dfinsupp.html#204656304">(Jul 22 2020 at 12:01)</a>:</h4>
<p>I was also trying to avoid needing the decidability of <code>{f : β i j}, f = 0</code>, which is required if I try to use <code>.support</code></p>



<a name="204656387"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/dfinsupp%20of%20product%20is%20dfinsupp%20of%20dfinsupp/near/204656387" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/dfinsupp.20of.20product.20is.20dfinsupp.20of.20dfinsupp.html#204656387">(Jul 22 2020 at 12:02)</a>:</h4>
<p>(hence my attempts to go through <code>pre_support</code> instead.)</p>



<a name="204675296"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/dfinsupp%20of%20product%20is%20dfinsupp%20of%20dfinsupp/near/204675296" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/dfinsupp.20of.20product.20is.20dfinsupp.20of.20dfinsupp.html#204675296">(Jul 22 2020 at 14:45)</a>:</h4>
<p>I've made a PR at <a href="https://github.com/leanprover-community/mathlib/pull/3515">https://github.com/leanprover-community/mathlib/pull/3515</a> which contains the bits of the proof I was able to put together, so that it's not completely lost to zulip streams.</p>



<a name="204787141"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/dfinsupp%20of%20product%20is%20dfinsupp%20of%20dfinsupp/near/204787141" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Utensil Song <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/dfinsupp.20of.20product.20is.20dfinsupp.20of.20dfinsupp.html#204787141">(Jul 23 2020 at 12:01)</a>:</h4>
<p>I don't understand why there would be "goals accomplished" and </p>
<div class="codehilite"><pre><span></span><code><span class="n">tactic</span> <span class="n">failed</span><span class="o">,</span> <span class="n">result</span> <span class="n">contains</span> <span class="n">meta</span><span class="bp">-</span><span class="kn">variables</span>
<span class="n">state</span><span class="o">:</span>
<span class="n">no</span> <span class="n">goals</span>
</code></pre></div>


<p>at the same time for the following <a href="https://leanprover-community.github.io/mwe.html">#mwe</a> related to this PR:</p>



<a name="204787279"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/dfinsupp%20of%20product%20is%20dfinsupp%20of%20dfinsupp/near/204787279" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Utensil Song <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/dfinsupp.20of.20product.20is.20dfinsupp.20of.20dfinsupp.html#204787279">(Jul 23 2020 at 12:02)</a>:</h4>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="n">data</span><span class="bp">.</span><span class="n">dfinsupp</span>
<span class="kn">import</span> <span class="n">tactic</span>

<span class="n">universes</span> <span class="n">u</span> <span class="n">v</span> <span class="n">w</span>

<span class="kn">namespace</span> <span class="n">dfinsupp</span><span class="bp">.</span><span class="n">prod</span>

<span class="kn">variables</span> <span class="o">{</span><span class="n">ii</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">}</span> <span class="o">{</span><span class="n">jj</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">v</span><span class="o">}</span> <span class="o">[</span><span class="n">decidable_eq</span> <span class="n">ii</span><span class="o">]</span> <span class="o">[</span><span class="n">decidable_eq</span> <span class="n">jj</span><span class="o">]</span>
<span class="kn">variables</span> <span class="o">{</span><span class="n">β</span> <span class="o">:</span> <span class="n">ii</span> <span class="bp">→</span> <span class="n">jj</span> <span class="bp">→</span> <span class="kt">Type</span> <span class="n">w</span><span class="o">}</span> <span class="o">[</span><span class="bp">Π</span> <span class="n">i</span> <span class="n">j</span><span class="o">,</span> <span class="n">has_zero</span> <span class="o">(</span><span class="n">β</span> <span class="n">i</span> <span class="n">j</span><span class="o">)]</span>

<span class="n">def</span> <span class="n">prod_to_nested</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="bp">Π</span><span class="err">₀</span> <span class="o">(</span><span class="n">ij</span> <span class="o">:</span> <span class="n">ii</span> <span class="bp">×</span> <span class="n">jj</span><span class="o">),</span> <span class="n">β</span> <span class="n">ij</span><span class="bp">.</span><span class="mi">1</span> <span class="n">ij</span><span class="bp">.</span><span class="mi">2</span><span class="o">)</span> <span class="o">:</span> <span class="bp">Π</span><span class="err">₀</span> <span class="n">i</span><span class="o">,</span> <span class="bp">Π</span><span class="err">₀</span> <span class="n">j</span><span class="o">,</span> <span class="n">β</span> <span class="n">i</span> <span class="n">j</span> <span class="o">:=</span> <span class="k">begin</span>
  <span class="n">apply</span> <span class="n">quotient</span><span class="bp">.</span><span class="n">lift_on</span> <span class="n">f</span><span class="o">,</span>
  <span class="n">intros</span> <span class="n">a</span> <span class="n">b</span> <span class="n">h</span><span class="o">,</span>
  <span class="n">unfold</span> <span class="n">has_equiv</span><span class="bp">.</span><span class="n">equiv</span> <span class="n">at</span> <span class="n">h</span><span class="o">,</span>
  <span class="n">unfold</span> <span class="n">setoid</span><span class="bp">.</span><span class="n">r</span> <span class="n">at</span> <span class="n">h</span><span class="o">,</span>
  <span class="n">apply</span> <span class="n">quotient</span><span class="bp">.</span><span class="n">sound</span><span class="o">,</span>
  <span class="n">intro</span> <span class="n">i</span><span class="o">,</span>
  <span class="n">simp</span> <span class="o">[</span><span class="n">h</span><span class="o">],</span>  <span class="c1">-- goals accomplished</span>
<span class="kn">end</span> <span class="c1">-- result contains meta-variables</span>
</code></pre></div>



<a name="204787473"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/dfinsupp%20of%20product%20is%20dfinsupp%20of%20dfinsupp/near/204787473" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Anne Baanen <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/dfinsupp.20of.20product.20is.20dfinsupp.20of.20dfinsupp.html#204787473">(Jul 23 2020 at 12:04)</a>:</h4>
<p>This happens when tactics claim to have solved all the metavariables (i.e. there are no more goals), but there are still metavariables that need to be filled out. You can use the <code>recover</code> tactic to get the missing goal.</p>



<a name="204787811"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/dfinsupp%20of%20product%20is%20dfinsupp%20of%20dfinsupp/near/204787811" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Anne Baanen <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/dfinsupp.20of.20product.20is.20dfinsupp.20of.20dfinsupp.html#204787811">(Jul 23 2020 at 12:08)</a>:</h4>
<p>More specifically, the line <code>apply quotient.sound,</code> causes a goal to be hidden, I guess because the tactic expects that it will be filled by unification. If you write <code>refine quotient.sound _,</code> instead, the goal will still be around.</p>



<a name="204815530"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/dfinsupp%20of%20product%20is%20dfinsupp%20of%20dfinsupp/near/204815530" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Chris Hughes <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/dfinsupp.20of.20product.20is.20dfinsupp.20of.20dfinsupp.html#204815530">(Jul 23 2020 at 15:52)</a>:</h4>
<p>I did manage to prove this, but it's not pretty (<a href="https://gist.github.com/ChrisHughes24/73d40b1b31f07b81cbec47ef88700a7c">link</a>). I think this might be a case of the <a href="https://en.wikipedia.org/wiki/XY_problem">#xy</a> problem. <code>dfinsupp</code> is not really intended to be used unless the <code>β i</code> are <code>add_comm_monoid</code>s, in fact it shouldn't really be used directly as <code>dfinsupp</code>, but you should use <code>direct_sum</code> instead most of the time for the interface. It is strange to want to use it with just <code>has_zero</code>, and the library really isn't set up for that usage.</p>



<a name="204858379"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/dfinsupp%20of%20product%20is%20dfinsupp%20of%20dfinsupp/near/204858379" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/dfinsupp.20of.20product.20is.20dfinsupp.20of.20dfinsupp.html#204858379">(Jul 23 2020 at 21:59)</a>:</h4>
<p>This is just an x problem, I decided it was more challenging than my original y problem</p>



<a name="204887291"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/dfinsupp%20of%20product%20is%20dfinsupp%20of%20dfinsupp/near/204887291" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/dfinsupp.20of.20product.20is.20dfinsupp.20of.20dfinsupp.html#204887291">(Jul 24 2020 at 07:42)</a>:</h4>
<p>Although I think if you're willing to assume<code>[Π i j, decidable_eq (β i j)]</code>, there are some shorter solutions - my difficulty was trying to avoid that assumption</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>