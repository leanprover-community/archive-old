---
layout: archive
title: Zulip Chat Archive
permalink: /stream/116395-maths/topic/Quotients.20.26.20synthesizing.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/116395-maths/index.html">maths</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Quotients.20.26.20synthesizing.html">Quotients & synthesizing</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="197057758"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Quotients%20%26%20synthesizing/near/197057758" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ryan Lahfa <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Quotients.20.26.20synthesizing.html#197057758">(May 10 2020 at 14:18)</a>:</h4>
<p>Hello, I'm trying to do some quotients stuff, namely to build the completion of a metric space.<br>
So here's a minimal example:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="n">data</span><span class="bp">.</span><span class="n">real</span><span class="bp">.</span><span class="n">basic</span>
<span class="n">class</span> <span class="n">metric_space</span> <span class="o">(</span><span class="n">X</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">d</span> <span class="o">:</span> <span class="n">X</span> <span class="bp">→</span> <span class="n">X</span> <span class="bp">→</span> <span class="n">ℝ</span><span class="o">)</span>
<span class="o">(</span><span class="n">d_pos</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">x</span> <span class="n">y</span><span class="o">,</span> <span class="n">d</span> <span class="n">x</span> <span class="n">y</span> <span class="bp">≥</span> <span class="mi">0</span><span class="o">)</span>
<span class="o">(</span><span class="n">presep</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">x</span> <span class="n">y</span><span class="o">,</span> <span class="n">x</span><span class="bp">=</span><span class="n">y</span> <span class="bp">→</span> <span class="n">d</span> <span class="n">x</span> <span class="n">y</span> <span class="bp">=</span> <span class="mi">0</span><span class="o">)</span>
<span class="o">(</span><span class="n">sep</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">x</span> <span class="n">y</span><span class="o">,</span> <span class="n">d</span> <span class="n">x</span> <span class="n">y</span> <span class="bp">=</span> <span class="mi">0</span> <span class="bp">→</span>  <span class="n">x</span> <span class="bp">=</span> <span class="n">y</span><span class="o">)</span>
<span class="o">(</span><span class="n">sym</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">x</span> <span class="n">y</span><span class="o">,</span> <span class="n">d</span> <span class="n">x</span> <span class="n">y</span> <span class="bp">=</span> <span class="n">d</span> <span class="n">y</span> <span class="n">x</span><span class="o">)</span>
<span class="o">(</span><span class="n">triangle</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">x</span> <span class="n">y</span> <span class="n">z</span><span class="o">,</span> <span class="n">d</span> <span class="n">x</span> <span class="n">z</span> <span class="bp">≤</span> <span class="n">d</span> <span class="n">x</span> <span class="n">y</span> <span class="bp">+</span> <span class="n">d</span> <span class="n">y</span> <span class="n">z</span><span class="o">)</span>

<span class="kn">section</span> <span class="n">test</span>
<span class="kn">open</span> <span class="n">metric_space</span>
<span class="kn">variables</span> <span class="o">{</span><span class="n">X</span><span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">metric_space</span> <span class="n">X</span><span class="o">]</span>

<span class="n">def</span> <span class="n">cauchy</span> <span class="o">(</span><span class="n">x</span><span class="o">:</span> <span class="bp">ℕ</span> <span class="bp">→</span> <span class="n">X</span><span class="o">)</span> <span class="o">:=</span>
  <span class="bp">∀</span> <span class="n">ε</span> <span class="bp">&gt;</span> <span class="mi">0</span><span class="o">,</span> <span class="bp">∃</span> <span class="n">N</span><span class="o">,</span> <span class="bp">∀</span> <span class="n">p</span> <span class="bp">≥</span> <span class="n">N</span><span class="o">,</span> <span class="bp">∀</span> <span class="n">q</span> <span class="bp">≥</span> <span class="n">N</span><span class="o">,</span> <span class="o">((</span><span class="n">d</span> <span class="o">(</span><span class="n">x</span> <span class="n">p</span><span class="o">)</span> <span class="o">(</span><span class="n">x</span> <span class="n">q</span><span class="o">))</span> <span class="bp">&lt;</span> <span class="n">ε</span><span class="o">)</span>
<span class="n">def</span> <span class="n">cauchy_seqs</span> <span class="o">:=</span> <span class="o">{</span> <span class="n">f</span> <span class="o">:</span> <span class="bp">ℕ</span> <span class="bp">→</span> <span class="n">X</span> <span class="bp">//</span> <span class="n">cauchy</span> <span class="n">f</span> <span class="o">}</span>


<span class="n">def</span> <span class="n">cauchy</span><span class="bp">.</span><span class="n">setoid</span> <span class="o">:</span> <span class="n">setoid</span> <span class="n">cauchy_seqs</span> <span class="o">:=</span>
<span class="o">{</span>
  <span class="n">r</span> <span class="o">:=</span> <span class="n">sorry</span><span class="o">,</span>
  <span class="n">iseqv</span> <span class="o">:=</span> <span class="n">sorry</span>
<span class="o">}</span>

<span class="n">def</span> <span class="n">completion_of_metric_space</span><span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span> <span class="o">:=</span> <span class="n">quotient</span> <span class="n">cauchy</span><span class="bp">.</span><span class="n">setoid</span>
<span class="c1">-- instance completion.metric_space: espace_metrique cauchy.setoid</span>
<span class="kn">end</span> <span class="n">test</span>
</code></pre></div>


<p>So here's my first attempt, <code>cauchy.setoid</code> fails with:</p>
<div class="codehilite"><pre><span></span><code><span class="n">don&#39;t</span> <span class="n">know</span> <span class="n">how</span> <span class="n">to</span> <span class="n">synthesize</span> <span class="n">placeholder</span>
<span class="kn">context</span><span class="o">:</span>
<span class="err">⊢</span> <span class="kt">Type</span> <span class="err">?</span>
</code></pre></div>


<p>So what I have done is to add types everywhere and had this new minimal example, but now I have this "too many arguments" issues:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="n">data</span><span class="bp">.</span><span class="n">set</span>
<span class="kn">import</span> <span class="n">data</span><span class="bp">.</span><span class="n">real</span><span class="bp">.</span><span class="n">basic</span>


<span class="c1">-- Une structure d&#39;espace métrique sur un type X --</span>
<span class="n">class</span> <span class="n">metric_space</span> <span class="o">(</span><span class="n">X</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">d</span> <span class="o">:</span> <span class="n">X</span> <span class="bp">→</span> <span class="n">X</span> <span class="bp">→</span> <span class="n">ℝ</span><span class="o">)</span>
<span class="o">(</span><span class="n">d_pos</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">x</span> <span class="n">y</span><span class="o">,</span> <span class="n">d</span> <span class="n">x</span> <span class="n">y</span> <span class="bp">≥</span> <span class="mi">0</span><span class="o">)</span>
<span class="o">(</span><span class="n">presep</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">x</span> <span class="n">y</span><span class="o">,</span> <span class="n">x</span><span class="bp">=</span><span class="n">y</span> <span class="bp">→</span> <span class="n">d</span> <span class="n">x</span> <span class="n">y</span> <span class="bp">=</span> <span class="mi">0</span><span class="o">)</span>
<span class="o">(</span><span class="n">sep</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">x</span> <span class="n">y</span><span class="o">,</span> <span class="n">d</span> <span class="n">x</span> <span class="n">y</span> <span class="bp">=</span> <span class="mi">0</span> <span class="bp">→</span>  <span class="n">x</span> <span class="bp">=</span> <span class="n">y</span><span class="o">)</span>
<span class="o">(</span><span class="n">sym</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">x</span> <span class="n">y</span><span class="o">,</span> <span class="n">d</span> <span class="n">x</span> <span class="n">y</span> <span class="bp">=</span> <span class="n">d</span> <span class="n">y</span> <span class="n">x</span><span class="o">)</span>
<span class="o">(</span><span class="n">triangle</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">x</span> <span class="n">y</span> <span class="n">z</span><span class="o">,</span> <span class="n">d</span> <span class="n">x</span> <span class="n">z</span> <span class="bp">≤</span> <span class="n">d</span> <span class="n">x</span> <span class="n">y</span> <span class="bp">+</span> <span class="n">d</span> <span class="n">y</span> <span class="n">z</span><span class="o">)</span>

<span class="kn">namespace</span> <span class="n">test</span>
<span class="kn">open</span> <span class="n">metric_space</span>
<span class="kn">variables</span> <span class="o">{</span><span class="n">X</span><span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">metric_space</span> <span class="n">X</span><span class="o">]</span>

<span class="n">def</span> <span class="n">cauchy</span> <span class="o">(</span><span class="n">x</span><span class="o">:</span> <span class="bp">ℕ</span> <span class="bp">→</span> <span class="n">X</span><span class="o">)</span> <span class="o">:=</span>
  <span class="bp">∀</span> <span class="n">ε</span> <span class="bp">&gt;</span> <span class="mi">0</span><span class="o">,</span> <span class="bp">∃</span> <span class="n">N</span><span class="o">,</span> <span class="bp">∀</span> <span class="n">p</span> <span class="bp">≥</span> <span class="n">N</span><span class="o">,</span> <span class="bp">∀</span> <span class="n">q</span> <span class="bp">≥</span> <span class="n">N</span><span class="o">,</span> <span class="o">((</span><span class="n">d</span> <span class="o">(</span><span class="n">x</span> <span class="n">p</span><span class="o">)</span> <span class="o">(</span><span class="n">x</span> <span class="n">q</span><span class="o">))</span> <span class="bp">&lt;</span> <span class="n">ε</span><span class="o">)</span>

<span class="kn">end</span> <span class="n">test</span>

<span class="kn">section</span> <span class="n">test2</span>
<span class="n">def</span> <span class="n">cauchy_seqs</span> <span class="o">(</span><span class="n">X</span><span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">[</span><span class="n">metric_space</span> <span class="n">X</span><span class="o">]</span> <span class="o">:=</span> <span class="o">{</span> <span class="n">f</span> <span class="o">:</span> <span class="bp">ℕ</span> <span class="bp">→</span> <span class="n">X</span> <span class="bp">//</span> <span class="n">test</span><span class="bp">.</span><span class="n">cauchy</span> <span class="n">f</span> <span class="o">}</span>
<span class="n">def</span> <span class="n">cauchy</span><span class="bp">.</span><span class="n">setoid</span> <span class="o">(</span><span class="n">X</span><span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">[</span><span class="n">metric_space</span> <span class="n">X</span><span class="o">]</span> <span class="o">:</span> <span class="n">setoid</span> <span class="o">(</span><span class="n">cauchy_seqs</span> <span class="n">X</span><span class="o">)</span> <span class="o">:=</span>
<span class="o">{</span>
  <span class="n">r</span> <span class="o">:=</span> <span class="n">sorry</span><span class="o">,</span>
  <span class="n">iseqv</span> <span class="o">:=</span> <span class="n">sorry</span>
<span class="o">}</span>

<span class="c1">-- en termes d&#39;univers, quotient retourne un type d&#39;univers u + 1 en partant de T : Type u.</span>
<span class="n">def</span> <span class="n">completion_of_metric_space</span> <span class="o">(</span><span class="n">X</span><span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">[</span><span class="n">metric_space</span> <span class="n">X</span><span class="o">]:</span> <span class="kt">Type</span><span class="bp">*</span> <span class="o">:=</span> <span class="n">quotient</span> <span class="o">(</span><span class="n">cauchy</span><span class="bp">.</span><span class="n">setoid</span> <span class="n">X</span><span class="o">)</span>

<span class="kn">instance</span> <span class="n">completion</span><span class="bp">.</span><span class="n">metric_space</span> <span class="o">(</span><span class="n">X</span><span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">[</span><span class="n">metric_space</span> <span class="n">X</span><span class="o">]:</span> <span class="n">metric_space</span> <span class="o">(</span><span class="n">completion_of_metric_space</span> <span class="n">X</span><span class="o">)</span>
<span class="o">{</span>
  <span class="n">d</span> <span class="o">:=</span> <span class="n">sorry</span><span class="o">,</span>
<span class="o">}</span>
<span class="kn">end</span> <span class="n">test2</span>
</code></pre></div>


<p>Precisely:</p>
<div class="codehilite"><pre><span></span><code><span class="n">function</span> <span class="n">expected</span> <span class="n">at</span>
  <span class="n">metric_space</span> <span class="o">(</span><span class="n">completion_of_metric_space</span> <span class="n">X</span><span class="o">)</span>
<span class="n">term</span> <span class="n">has</span> <span class="n">type</span>
  <span class="kt">Type</span> <span class="err">?</span>
<span class="n">Additional</span> <span class="n">information</span><span class="o">:</span>
<span class="bp">/</span><span class="n">home</span><span class="bp">/</span><span class="n">raito</span><span class="bp">/</span><span class="n">dev</span><span class="bp">/</span><span class="n">projects</span><span class="bp">/</span><span class="n">projet</span><span class="bp">-</span><span class="n">maths</span><span class="bp">-</span><span class="n">lean</span><span class="bp">/</span><span class="n">src</span><span class="bp">/</span><span class="n">espaces</span><span class="bp">-</span><span class="n">metriques</span><span class="bp">/</span><span class="n">test</span><span class="bp">.</span><span class="n">lean</span><span class="o">:</span><span class="mi">34</span><span class="o">:</span><span class="mi">62</span><span class="o">:</span> <span class="kn">context</span><span class="o">:</span> <span class="n">switched</span> <span class="n">to</span> <span class="n">simple</span> <span class="n">application</span> <span class="n">elaboration</span> <span class="n">procedure</span> <span class="n">because</span> <span class="n">failed</span> <span class="n">to</span> <span class="n">use</span> <span class="n">expected</span> <span class="n">type</span> <span class="n">to</span> <span class="n">elaborate</span> <span class="n">it</span><span class="o">,</span> <span class="n">error</span> <span class="n">message</span>
  <span class="n">too</span> <span class="n">many</span> <span class="n">arguments</span>
</code></pre></div>


<p>I have found this topic: <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/has_coe_to_fun.20with.20implicit.20arguments.html" title="https://leanprover-community.github.io/archive/stream/113488-general/topic/has_coe_to_fun.20with.20implicit.20arguments.html">https://leanprover-community.github.io/archive/stream/113488-general/topic/has_coe_to_fun.20with.20implicit.20arguments.html</a> which seems to have this error, but I don't understand how to port the idea to my problem.</p>
<p>Also, I guess it might have to do with some universes stuff as I'm trying to cheat and let Lean compute the correct universes, but it might be possible that I need to be explicit and specify that a completion lives in Type (u + 1) ?</p>



<a name="197058198"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Quotients%20%26%20synthesizing/near/197058198" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Quotients.20.26.20synthesizing.html#197058198">(May 10 2020 at 14:24)</a>:</h4>
<p>Not at lean right now so treat with a pinch of salt. Lean can't figure out X in the first example. Make it explicit and call it <code>cauchy_seqs X</code></p>



<a name="197058271"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Quotients%20%26%20synthesizing/near/197058271" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Quotients.20.26.20synthesizing.html#197058271">(May 10 2020 at 14:26)</a>:</h4>
<p>Oh you got that far</p>



<a name="197058280"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Quotients%20%26%20synthesizing/near/197058280" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ryan Lahfa <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Quotients.20.26.20synthesizing.html#197058280">(May 10 2020 at 14:27)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110038">Kevin Buzzard</span> <a href="#narrow/stream/116395-maths/topic/Quotients.20.26.20synthesizing/near/197058271" title="#narrow/stream/116395-maths/topic/Quotients.20.26.20synthesizing/near/197058271">said</a>:</p>
<blockquote>
<p>Oh you got that far</p>
</blockquote>
<p>Indeed, but that means that I have to do it the 2nd way at least :)</p>



<a name="197058716"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Quotients%20%26%20synthesizing/near/197058716" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Quotients.20.26.20synthesizing.html#197058716">(May 10 2020 at 14:33)</a>:</h4>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="n">data</span><span class="bp">.</span><span class="n">real</span><span class="bp">.</span><span class="n">basic</span>
<span class="n">class</span> <span class="n">metric_space</span> <span class="o">(</span><span class="n">X</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">d</span> <span class="o">:</span> <span class="n">X</span> <span class="bp">→</span> <span class="n">X</span> <span class="bp">→</span> <span class="n">ℝ</span><span class="o">)</span>
<span class="o">(</span><span class="n">d_pos</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">x</span> <span class="n">y</span><span class="o">,</span> <span class="n">d</span> <span class="n">x</span> <span class="n">y</span> <span class="bp">≥</span> <span class="mi">0</span><span class="o">)</span>
<span class="o">(</span><span class="n">presep</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">x</span> <span class="n">y</span><span class="o">,</span> <span class="n">x</span><span class="bp">=</span><span class="n">y</span> <span class="bp">→</span> <span class="n">d</span> <span class="n">x</span> <span class="n">y</span> <span class="bp">=</span> <span class="mi">0</span><span class="o">)</span>
<span class="o">(</span><span class="n">sep</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">x</span> <span class="n">y</span><span class="o">,</span> <span class="n">d</span> <span class="n">x</span> <span class="n">y</span> <span class="bp">=</span> <span class="mi">0</span> <span class="bp">→</span>  <span class="n">x</span> <span class="bp">=</span> <span class="n">y</span><span class="o">)</span>
<span class="o">(</span><span class="n">sym</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">x</span> <span class="n">y</span><span class="o">,</span> <span class="n">d</span> <span class="n">x</span> <span class="n">y</span> <span class="bp">=</span> <span class="n">d</span> <span class="n">y</span> <span class="n">x</span><span class="o">)</span>
<span class="o">(</span><span class="n">triangle</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">x</span> <span class="n">y</span> <span class="n">z</span><span class="o">,</span> <span class="n">d</span> <span class="n">x</span> <span class="n">z</span> <span class="bp">≤</span> <span class="n">d</span> <span class="n">x</span> <span class="n">y</span> <span class="bp">+</span> <span class="n">d</span> <span class="n">y</span> <span class="n">z</span><span class="o">)</span>

<span class="kn">section</span> <span class="n">test</span>
<span class="kn">open</span> <span class="n">metric_space</span>
<span class="kn">variables</span> <span class="o">{</span><span class="n">X</span><span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">metric_space</span> <span class="n">X</span><span class="o">]</span>

<span class="n">def</span> <span class="n">is_cauchy</span> <span class="o">(</span><span class="n">x</span><span class="o">:</span> <span class="bp">ℕ</span> <span class="bp">→</span> <span class="n">X</span><span class="o">)</span> <span class="o">:=</span>
  <span class="bp">∀</span> <span class="n">ε</span> <span class="bp">&gt;</span> <span class="mi">0</span><span class="o">,</span> <span class="bp">∃</span> <span class="n">N</span><span class="o">,</span> <span class="bp">∀</span> <span class="n">p</span> <span class="bp">≥</span> <span class="n">N</span><span class="o">,</span> <span class="bp">∀</span> <span class="n">q</span> <span class="bp">≥</span> <span class="n">N</span><span class="o">,</span> <span class="o">((</span><span class="n">d</span> <span class="o">(</span><span class="n">x</span> <span class="n">p</span><span class="o">)</span> <span class="o">(</span><span class="n">x</span> <span class="n">q</span><span class="o">))</span> <span class="bp">&lt;</span> <span class="n">ε</span><span class="o">)</span>

<span class="n">def</span> <span class="n">cauchy_seqs</span> <span class="o">(</span><span class="n">X</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">[</span><span class="n">metric_space</span> <span class="n">X</span><span class="o">]</span> <span class="o">:=</span> <span class="o">{</span> <span class="n">f</span> <span class="o">:</span> <span class="bp">ℕ</span> <span class="bp">→</span> <span class="n">X</span> <span class="bp">//</span> <span class="n">is_cauchy</span> <span class="n">f</span> <span class="o">}</span>


<span class="n">def</span> <span class="n">cauchy</span><span class="bp">.</span><span class="n">setoid</span> <span class="o">(</span><span class="n">X</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">[</span><span class="n">metric_space</span> <span class="n">X</span><span class="o">]</span> <span class="o">:</span> <span class="n">setoid</span> <span class="o">(</span><span class="n">cauchy_seqs</span> <span class="n">X</span><span class="o">)</span> <span class="o">:=</span>
<span class="o">{</span>
  <span class="n">r</span> <span class="o">:=</span> <span class="n">sorry</span><span class="o">,</span>
  <span class="n">iseqv</span> <span class="o">:=</span> <span class="n">sorry</span>
<span class="o">}</span>

<span class="n">def</span> <span class="n">completion</span> <span class="o">(</span><span class="n">X</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">[</span><span class="n">metric_space</span> <span class="n">X</span><span class="o">]</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span> <span class="o">:=</span> <span class="n">quotient</span> <span class="o">(</span><span class="n">cauchy</span><span class="bp">.</span><span class="n">setoid</span> <span class="n">X</span><span class="o">)</span>

<span class="kn">instance</span> <span class="n">completion</span><span class="bp">.</span><span class="n">metric_space</span> <span class="o">(</span><span class="n">X</span><span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">[</span><span class="n">metric_space</span> <span class="n">X</span><span class="o">]:</span> <span class="n">metric_space</span> <span class="o">(</span><span class="n">completion</span> <span class="n">X</span><span class="o">)</span> <span class="o">:=</span>
<span class="o">{</span>
  <span class="n">d</span> <span class="o">:=</span> <span class="n">sorry</span><span class="o">,</span>
  <span class="n">d_pos</span> <span class="o">:=</span> <span class="n">sorry</span><span class="o">,</span>
  <span class="c1">-- etc</span>
<span class="o">}</span>

<span class="kn">end</span> <span class="n">test</span>
</code></pre></div>



<a name="197059056"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Quotients%20%26%20synthesizing/near/197059056" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Quotients.20.26.20synthesizing.html#197059056">(May 10 2020 at 14:38)</a>:</h4>
<p>PS <code>d_pos</code> follows from the other axioms :P (use the triangle equality) and <code>presep</code> should just be <code>forall x, d x x = 0</code></p>



<a name="197059061"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Quotients%20%26%20synthesizing/near/197059061" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ryan Lahfa <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Quotients.20.26.20synthesizing.html#197059061">(May 10 2020 at 14:38)</a>:</h4>
<p>Wow, I don't see very well what's the difference, <span class="user-mention" data-user-id="110038">@Kevin Buzzard</span></p>



<a name="197059100"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Quotients%20%26%20synthesizing/near/197059100" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ryan Lahfa <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Quotients.20.26.20synthesizing.html#197059100">(May 10 2020 at 14:38)</a>:</h4>
<p>(<span class="user-mention" data-user-id="110038">@Kevin Buzzard</span> I agree, you've already told me this :D! But I'm not allowed to change those :D)</p>



<a name="197059171"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Quotients%20%26%20synthesizing/near/197059171" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Quotients.20.26.20synthesizing.html#197059171">(May 10 2020 at 14:39)</a>:</h4>
<p>I guess you just made some syntax error in the second example -- no <code>:=</code>?</p>



<a name="197059243"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Quotients%20%26%20synthesizing/near/197059243" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ryan Lahfa <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Quotients.20.26.20synthesizing.html#197059243">(May 10 2020 at 14:40)</a>:</h4>
<p>… indeed.</p>



<a name="197059261"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Quotients%20%26%20synthesizing/near/197059261" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ryan Lahfa <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Quotients.20.26.20synthesizing.html#197059261">(May 10 2020 at 14:41)</a>:</h4>
<p>The error is a bit cryptic though</p>



<a name="197059402"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Quotients%20%26%20synthesizing/near/197059402" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Quotients.20.26.20synthesizing.html#197059402">(May 10 2020 at 14:44)</a>:</h4>
<p>There used to be a comment on the official Lean github repo saying something like "we will close issues complaining that error messages are confusing"</p>



<a name="197060170"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Quotients%20%26%20synthesizing/near/197060170" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ryan Lahfa <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Quotients.20.26.20synthesizing.html#197060170">(May 10 2020 at 15:04)</a>:</h4>
<p>While I'm on the subject of quotients, is there a way to transfer a map <code>f : (a_1 a_2 … a_n: cauchy_seqs X) → Y</code> into a <code>f' : (a_1 … a_n: completion X) → Y</code>?</p>



<a name="197060275"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Quotients%20%26%20synthesizing/near/197060275" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Quotients.20.26.20synthesizing.html#197060275">(May 10 2020 at 15:07)</a>:</h4>
<p><code>quotient.lift</code>?</p>



<a name="197060356"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Quotients%20%26%20synthesizing/near/197060356" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ryan Lahfa <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Quotients.20.26.20synthesizing.html#197060356">(May 10 2020 at 15:10)</a>:</h4>
<p>it sounded like <code>quotient.lift</code> takes a <code>f : α → β</code>,</p>



<a name="197060423"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Quotients%20%26%20synthesizing/near/197060423" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Quotients.20.26.20synthesizing.html#197060423">(May 10 2020 at 15:11)</a>:</h4>
<p>Oh I see.</p>



<a name="197060432"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Quotients%20%26%20synthesizing/near/197060432" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Quotients.20.26.20synthesizing.html#197060432">(May 10 2020 at 15:11)</a>:</h4>
<p>Well you can't have <code>…</code>, but I think there is a version for 2 arguments at least and you can look at how that works.</p>



<a name="197060562"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Quotients%20%26%20synthesizing/near/197060562" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ryan Lahfa <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Quotients.20.26.20synthesizing.html#197060562">(May 10 2020 at 15:14)</a>:</h4>
<p>I tried lift_2, and it's complaining about synthesizing:</p>
<div class="codehilite"><pre><span></span><code><span class="n">failed</span> <span class="n">to</span> <span class="n">synthesize</span> <span class="n">type</span> <span class="n">class</span> <span class="kn">instance</span> <span class="n">for</span>
<span class="n">T</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">,</span>
<span class="bp">_</span><span class="n">inst_1</span> <span class="o">:</span> <span class="n">metric_space</span> <span class="n">T</span><span class="o">,</span>
<span class="n">x</span> <span class="n">y</span> <span class="o">:</span> <span class="n">completion</span> <span class="n">T</span>
<span class="err">⊢</span> <span class="n">setoid</span> <span class="o">(</span><span class="n">cauchy_seqs</span> <span class="n">T</span><span class="o">)</span>
</code></pre></div>


<p>For full example:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="n">data</span><span class="bp">.</span><span class="n">real</span><span class="bp">.</span><span class="n">basic</span>
<span class="n">class</span> <span class="n">metric_space</span> <span class="o">(</span><span class="n">X</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">d</span> <span class="o">:</span> <span class="n">X</span> <span class="bp">→</span> <span class="n">X</span> <span class="bp">→</span> <span class="n">ℝ</span><span class="o">)</span>
<span class="o">(</span><span class="n">d_pos</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">x</span> <span class="n">y</span><span class="o">,</span> <span class="n">d</span> <span class="n">x</span> <span class="n">y</span> <span class="bp">≥</span> <span class="mi">0</span><span class="o">)</span>
<span class="o">(</span><span class="n">presep</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">x</span> <span class="n">y</span><span class="o">,</span> <span class="n">x</span><span class="bp">=</span><span class="n">y</span> <span class="bp">→</span> <span class="n">d</span> <span class="n">x</span> <span class="n">y</span> <span class="bp">=</span> <span class="mi">0</span><span class="o">)</span>
<span class="o">(</span><span class="n">sep</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">x</span> <span class="n">y</span><span class="o">,</span> <span class="n">d</span> <span class="n">x</span> <span class="n">y</span> <span class="bp">=</span> <span class="mi">0</span> <span class="bp">→</span>  <span class="n">x</span> <span class="bp">=</span> <span class="n">y</span><span class="o">)</span>
<span class="o">(</span><span class="n">sym</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">x</span> <span class="n">y</span><span class="o">,</span> <span class="n">d</span> <span class="n">x</span> <span class="n">y</span> <span class="bp">=</span> <span class="n">d</span> <span class="n">y</span> <span class="n">x</span><span class="o">)</span>
<span class="o">(</span><span class="n">triangle</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">x</span> <span class="n">y</span> <span class="n">z</span><span class="o">,</span> <span class="n">d</span> <span class="n">x</span> <span class="n">z</span> <span class="bp">≤</span> <span class="n">d</span> <span class="n">x</span> <span class="n">y</span> <span class="bp">+</span> <span class="n">d</span> <span class="n">y</span> <span class="n">z</span><span class="o">)</span>

<span class="kn">section</span> <span class="n">test</span>
<span class="kn">open</span> <span class="n">metric_space</span>
<span class="kn">variables</span> <span class="o">{</span><span class="n">X</span><span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">metric_space</span> <span class="n">X</span><span class="o">]</span>

<span class="n">def</span> <span class="n">is_cauchy</span> <span class="o">(</span><span class="n">x</span><span class="o">:</span> <span class="bp">ℕ</span> <span class="bp">→</span> <span class="n">X</span><span class="o">)</span> <span class="o">:=</span>
  <span class="bp">∀</span> <span class="n">ε</span> <span class="bp">&gt;</span> <span class="mi">0</span><span class="o">,</span> <span class="bp">∃</span> <span class="n">N</span><span class="o">,</span> <span class="bp">∀</span> <span class="n">p</span> <span class="bp">≥</span> <span class="n">N</span><span class="o">,</span> <span class="bp">∀</span> <span class="n">q</span> <span class="bp">≥</span> <span class="n">N</span><span class="o">,</span> <span class="o">((</span><span class="n">d</span> <span class="o">(</span><span class="n">x</span> <span class="n">p</span><span class="o">)</span> <span class="o">(</span><span class="n">x</span> <span class="n">q</span><span class="o">))</span> <span class="bp">&lt;</span> <span class="n">ε</span><span class="o">)</span>

<span class="n">def</span> <span class="n">cauchy_seqs</span> <span class="o">(</span><span class="n">X</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">[</span><span class="n">metric_space</span> <span class="n">X</span><span class="o">]</span> <span class="o">:=</span> <span class="o">{</span> <span class="n">f</span> <span class="o">:</span> <span class="bp">ℕ</span> <span class="bp">→</span> <span class="n">X</span> <span class="bp">//</span> <span class="n">is_cauchy</span> <span class="n">f</span> <span class="o">}</span>


<span class="n">def</span> <span class="n">cauchy</span><span class="bp">.</span><span class="n">setoid</span> <span class="o">(</span><span class="n">X</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">[</span><span class="n">metric_space</span> <span class="n">X</span><span class="o">]</span> <span class="o">:</span> <span class="n">setoid</span> <span class="o">(</span><span class="n">cauchy_seqs</span> <span class="n">X</span><span class="o">)</span> <span class="o">:=</span>
<span class="o">{</span>
  <span class="n">r</span> <span class="o">:=</span> <span class="n">sorry</span><span class="o">,</span>
  <span class="n">iseqv</span> <span class="o">:=</span> <span class="n">sorry</span>
<span class="o">}</span>
<span class="c1">-- Définit la distance entre 2 suites de Cauchy par lim d(x_n, y_n).</span>
<span class="n">def</span> <span class="n">cauchy</span><span class="bp">.</span><span class="n">dist</span> <span class="o">(</span><span class="n">T</span><span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">[</span><span class="n">metric_space</span> <span class="n">T</span><span class="o">]</span> <span class="o">(</span><span class="n">x</span> <span class="n">y</span><span class="o">:</span> <span class="n">cauchy_seqs</span> <span class="n">T</span><span class="o">):</span> <span class="n">ℝ</span>
  <span class="o">:=</span> <span class="n">sorry</span> <span class="c1">-- some cauchy limit stuff.</span>

<span class="n">def</span> <span class="n">completion</span> <span class="o">(</span><span class="n">X</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">[</span><span class="n">metric_space</span> <span class="n">X</span><span class="o">]</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span> <span class="o">:=</span> <span class="n">quotient</span> <span class="o">(</span><span class="n">cauchy</span><span class="bp">.</span><span class="n">setoid</span> <span class="n">X</span><span class="o">)</span>
<span class="n">def</span> <span class="n">completion</span><span class="bp">.</span><span class="n">dist</span> <span class="o">(</span><span class="n">T</span><span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">[</span><span class="n">metric_space</span> <span class="n">T</span><span class="o">]</span> <span class="o">(</span><span class="n">x</span> <span class="n">y</span><span class="o">:</span> <span class="n">completion</span> <span class="n">T</span><span class="o">):</span> <span class="n">ℝ</span> <span class="o">:=</span>
  <span class="n">quotient</span><span class="bp">.</span><span class="n">lift₂</span> <span class="o">(</span><span class="n">cauchy</span><span class="bp">.</span><span class="n">dist</span> <span class="n">T</span><span class="o">)</span> <span class="n">x</span> <span class="n">y</span>

<span class="kn">instance</span> <span class="n">completion</span><span class="bp">.</span><span class="n">metric_space</span> <span class="o">(</span><span class="n">X</span><span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">[</span><span class="n">metric_space</span> <span class="n">X</span><span class="o">]:</span> <span class="n">metric_space</span> <span class="o">(</span><span class="n">completion</span> <span class="n">X</span><span class="o">)</span> <span class="o">:=</span>
<span class="o">{</span>
  <span class="n">d</span> <span class="o">:=</span> <span class="n">sorry</span><span class="o">,</span>
  <span class="n">d_pos</span> <span class="o">:=</span> <span class="n">sorry</span><span class="o">,</span>
  <span class="c1">-- etc</span>
<span class="o">}</span>

<span class="kn">end</span> <span class="n">test</span>
</code></pre></div>


<p><code>completion.dist</code> has errors</p>



<a name="197060653"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Quotients%20%26%20synthesizing/near/197060653" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Quotients.20.26.20synthesizing.html#197060653">(May 10 2020 at 15:16)</a>:</h4>
<p>Okay, because your <code>completion</code> is not an instance. To be honest, this whole type class design with quotient is pretty dubious.<br>
Is there a <code>lift\2'</code> that uses a <code>{}</code> argument for the <code>setoid</code>?</p>



<a name="197060698"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Quotients%20%26%20synthesizing/near/197060698" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ryan Lahfa <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Quotients.20.26.20synthesizing.html#197060698">(May 10 2020 at 15:17)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110032">Reid Barton</span> <a href="#narrow/stream/116395-maths/topic/Quotients.20.26.20synthesizing/near/197060653" title="#narrow/stream/116395-maths/topic/Quotients.20.26.20synthesizing/near/197060653">said</a>:</p>
<blockquote>
<p>Okay, because your <code>completion</code> is not an instance. To be honest, this whole type class design with quotient is pretty dubious.<br>
Is there a <code>lift\2'</code> that uses a <code>{}</code> argument for the <code>setoid</code>?</p>
</blockquote>
<p>I can turn it into an instance, but I heard/read here that most of the time quotients need not to be instances, I don't really understand why (but I guess there must be a good reason)</p>



<a name="197060794"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Quotients%20%26%20synthesizing/near/197060794" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ryan Lahfa <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Quotients.20.26.20synthesizing.html#197060794">(May 10 2020 at 15:18)</a>:</h4>
<p>As far as I see it, in <code>quot.lean</code>, there's no <code>{…}</code></p>



<a name="197060799"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Quotients%20%26%20synthesizing/near/197060799" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ryan Lahfa <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Quotients.20.26.20synthesizing.html#197060799">(May 10 2020 at 15:18)</a>:</h4>
<p>for setoids.</p>



<a name="197060805"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Quotients%20%26%20synthesizing/near/197060805" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Quotients.20.26.20synthesizing.html#197060805">(May 10 2020 at 15:18)</a>:</h4>
<p>There is nothing specific about quotient, the question is: do you want multiple instances on the same type?</p>



<a name="197060823"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Quotients%20%26%20synthesizing/near/197060823" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Quotients.20.26.20synthesizing.html#197060823">(May 10 2020 at 15:18)</a>:</h4>
<p>If yes then there will be trouble.</p>



<a name="197060862"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Quotients%20%26%20synthesizing/near/197060862" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Quotients.20.26.20synthesizing.html#197060862">(May 10 2020 at 15:19)</a>:</h4>
<p>The link with quotients is that this issue comes up for instance with setoid on Z (you want several quotients of Z)</p>



<a name="197060948"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Quotients%20%26%20synthesizing/near/197060948" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Quotients.20.26.20synthesizing.html#197060948">(May 10 2020 at 15:20)</a>:</h4>
<p>Since you defined your own <code>cauchy_seqs</code> type and the <code>setoid</code> only depends on other stuff available through instances, it would be fine (and easiest) to make it an instance in this case.</p>



<a name="197060952"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Quotients%20%26%20synthesizing/near/197060952" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ryan Lahfa <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Quotients.20.26.20synthesizing.html#197060952">(May 10 2020 at 15:20)</a>:</h4>
<p>I don't think I'm going to have an instance of something else than a metric space for the Cauchy sequences quotient by <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mo><mi>lim</mi><mo>⁡</mo></mo><mi>n</mi></msub><mi>d</mi><mo stretchy="false">(</mo><msub><mi>x</mi><mi>n</mi></msub><mo separator="true">,</mo><msub><mi>y</mi><mi>n</mi></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\lim_n d(x_n, y_n)</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mop"><span class="mop">lim</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">d</span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span> AFAIK.</p>



<a name="197060956"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Quotients%20%26%20synthesizing/near/197060956" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ryan Lahfa <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Quotients.20.26.20synthesizing.html#197060956">(May 10 2020 at 15:20)</a>:</h4>
<p>Alright, will do :)</p>



<a name="197060977"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Quotients%20%26%20synthesizing/near/197060977" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Quotients.20.26.20synthesizing.html#197060977">(May 10 2020 at 15:21)</a>:</h4>
<p>I think the last time I asked, Mario told me that arbitrary lifting is independent of Lean</p>



<a name="197060981"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Quotients%20%26%20synthesizing/near/197060981" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Quotients.20.26.20synthesizing.html#197060981">(May 10 2020 at 15:21)</a>:</h4>
<p>at least the computable one</p>



<a name="197060986"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Quotients%20%26%20synthesizing/near/197060986" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Quotients.20.26.20synthesizing.html#197060986">(May 10 2020 at 15:21)</a>:</h4>
<p>but finite lifting should be doable by induction</p>



<a name="197065102"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Quotients%20%26%20synthesizing/near/197065102" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ryan Lahfa <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Quotients.20.26.20synthesizing.html#197065102">(May 10 2020 at 16:38)</a>:</h4>
<p>Also, when I have <code>x ~ y</code>, how can I get the underlying property?<br>
Like I have <code>x ~ y &lt;=&gt; dist x y = 0</code>, how can I derive <code>dist x y = 0</code> in this situation?</p>



<a name="197065169"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Quotients%20%26%20synthesizing/near/197065169" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Quotients.20.26.20synthesizing.html#197065169">(May 10 2020 at 16:38)</a>:</h4>
<p>Is it <code>rfl</code>?</p>



<a name="197065444"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Quotients%20%26%20synthesizing/near/197065444" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Quotients.20.26.20synthesizing.html#197065444">(May 10 2020 at 16:45)</a>:</h4>
<p><a href="https://github.com/leanprover-community/mathlib/wiki/Minimum-Working-Example-&#40;MWE&#41;" title="https://github.com/leanprover-community/mathlib/wiki/Minimum-Working-Example-&#40;MWE&#41;">#mwe</a></p>



<a name="197065541"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Quotients%20%26%20synthesizing/near/197065541" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ryan Lahfa <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Quotients.20.26.20synthesizing.html#197065541">(May 10 2020 at 16:47)</a>:</h4>
<p><span class="user-mention" data-user-id="110064">@Kenny Lau</span> :P<br>
I'll provide a MWE</p>



<a name="197065896"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Quotients%20%26%20synthesizing/near/197065896" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ryan Lahfa <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Quotients.20.26.20synthesizing.html#197065896">(May 10 2020 at 16:57)</a>:</h4>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="n">data</span><span class="bp">.</span><span class="n">real</span><span class="bp">.</span><span class="n">basic</span>
<span class="n">class</span> <span class="n">metric_space</span> <span class="o">(</span><span class="n">X</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">d</span> <span class="o">:</span> <span class="n">X</span> <span class="bp">→</span> <span class="n">X</span> <span class="bp">→</span> <span class="n">ℝ</span><span class="o">)</span>
<span class="o">(</span><span class="n">d_pos</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">x</span> <span class="n">y</span><span class="o">,</span> <span class="n">d</span> <span class="n">x</span> <span class="n">y</span> <span class="bp">≥</span> <span class="mi">0</span><span class="o">)</span>
<span class="o">(</span><span class="n">presep</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">x</span> <span class="n">y</span><span class="o">,</span> <span class="n">x</span><span class="bp">=</span><span class="n">y</span> <span class="bp">→</span> <span class="n">d</span> <span class="n">x</span> <span class="n">y</span> <span class="bp">=</span> <span class="mi">0</span><span class="o">)</span>
<span class="o">(</span><span class="n">sep</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">x</span> <span class="n">y</span><span class="o">,</span> <span class="n">d</span> <span class="n">x</span> <span class="n">y</span> <span class="bp">=</span> <span class="mi">0</span> <span class="bp">→</span>  <span class="n">x</span> <span class="bp">=</span> <span class="n">y</span><span class="o">)</span>
<span class="o">(</span><span class="n">sym</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">x</span> <span class="n">y</span><span class="o">,</span> <span class="n">d</span> <span class="n">x</span> <span class="n">y</span> <span class="bp">=</span> <span class="n">d</span> <span class="n">y</span> <span class="n">x</span><span class="o">)</span>
<span class="o">(</span><span class="n">triangle</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">x</span> <span class="n">y</span> <span class="n">z</span><span class="o">,</span> <span class="n">d</span> <span class="n">x</span> <span class="n">z</span> <span class="bp">≤</span> <span class="n">d</span> <span class="n">x</span> <span class="n">y</span> <span class="bp">+</span> <span class="n">d</span> <span class="n">y</span> <span class="n">z</span><span class="o">)</span>

<span class="kn">section</span> <span class="n">test</span>
<span class="kn">open</span> <span class="n">metric_space</span>
<span class="kn">variables</span> <span class="o">{</span><span class="n">X</span><span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">metric_space</span> <span class="n">X</span><span class="o">]</span>

<span class="n">def</span> <span class="n">is_cauchy</span> <span class="o">(</span><span class="n">x</span><span class="o">:</span> <span class="bp">ℕ</span> <span class="bp">→</span> <span class="n">X</span><span class="o">)</span> <span class="o">:=</span>
  <span class="bp">∀</span> <span class="n">ε</span> <span class="bp">&gt;</span> <span class="mi">0</span><span class="o">,</span> <span class="bp">∃</span> <span class="n">N</span><span class="o">,</span> <span class="bp">∀</span> <span class="n">p</span> <span class="bp">≥</span> <span class="n">N</span><span class="o">,</span> <span class="bp">∀</span> <span class="n">q</span> <span class="bp">≥</span> <span class="n">N</span><span class="o">,</span> <span class="o">((</span><span class="n">d</span> <span class="o">(</span><span class="n">x</span> <span class="n">p</span><span class="o">)</span> <span class="o">(</span><span class="n">x</span> <span class="n">q</span><span class="o">))</span> <span class="bp">&lt;</span> <span class="n">ε</span><span class="o">)</span>

<span class="n">def</span> <span class="n">cauchy_seqs</span> <span class="o">(</span><span class="n">X</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">[</span><span class="n">metric_space</span> <span class="n">X</span><span class="o">]</span> <span class="o">:=</span> <span class="o">{</span> <span class="n">f</span> <span class="o">:</span> <span class="bp">ℕ</span> <span class="bp">→</span> <span class="n">X</span> <span class="bp">//</span> <span class="n">is_cauchy</span> <span class="n">f</span> <span class="o">}</span>


<span class="kn">instance</span> <span class="n">cauchy</span><span class="bp">.</span><span class="n">setoid</span> <span class="o">(</span><span class="n">X</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">[</span><span class="n">metric_space</span> <span class="n">X</span><span class="o">]</span> <span class="o">:</span> <span class="n">setoid</span> <span class="o">(</span><span class="n">cauchy_seqs</span> <span class="n">X</span><span class="o">)</span> <span class="o">:=</span>
<span class="o">{</span>
  <span class="n">r</span> <span class="o">:=</span> <span class="n">sorry</span><span class="o">,</span>
  <span class="n">iseqv</span> <span class="o">:=</span> <span class="n">sorry</span>
<span class="o">}</span>
<span class="n">local</span> <span class="n">attribute</span> <span class="o">[</span><span class="kn">instance</span><span class="o">]</span> <span class="n">cauchy</span><span class="bp">.</span><span class="n">setoid</span>
<span class="n">def</span> <span class="n">cauchy</span><span class="bp">.</span><span class="n">dist</span> <span class="o">(</span><span class="n">T</span><span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">[</span><span class="n">metric_space</span> <span class="n">T</span><span class="o">]</span> <span class="o">(</span><span class="n">x</span> <span class="n">y</span><span class="o">:</span> <span class="n">cauchy_seqs</span> <span class="n">T</span><span class="o">):</span> <span class="n">ℝ</span>
  <span class="o">:=</span> <span class="n">sorry</span> <span class="c1">-- some cauchy limit stuff.</span>

<span class="n">def</span> <span class="n">completion</span> <span class="o">(</span><span class="n">X</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">[</span><span class="n">metric_space</span> <span class="n">X</span><span class="o">]</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span> <span class="o">:=</span> <span class="n">quotient</span> <span class="o">(</span><span class="n">cauchy</span><span class="bp">.</span><span class="n">setoid</span> <span class="n">X</span><span class="o">)</span>

<span class="n">def</span> <span class="n">completion</span><span class="bp">.</span><span class="n">dist_soundness</span> <span class="o">(</span><span class="n">T</span><span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">[</span><span class="n">metric_space</span> <span class="n">T</span><span class="o">]:</span>
  <span class="bp">∀</span> <span class="n">x₁</span> <span class="n">x₂</span><span class="o">:</span> <span class="n">cauchy_seqs</span> <span class="n">T</span><span class="o">,</span> <span class="bp">∀</span> <span class="n">y₁</span> <span class="n">y₂</span><span class="o">:</span> <span class="n">cauchy_seqs</span> <span class="n">T</span><span class="o">,</span> <span class="o">(</span><span class="n">x₁</span> <span class="bp">≈</span> <span class="n">y₁</span><span class="o">)</span> <span class="bp">→</span> <span class="o">(</span><span class="n">x₂</span> <span class="bp">≈</span> <span class="n">y₂</span><span class="o">)</span> <span class="bp">→</span> <span class="o">(</span><span class="n">cauchy</span><span class="bp">.</span><span class="n">dist</span> <span class="n">T</span> <span class="n">x₁</span> <span class="n">x₂</span> <span class="bp">=</span> <span class="n">cauchy</span><span class="bp">.</span><span class="n">dist</span> <span class="n">T</span> <span class="n">y₁</span> <span class="n">y₂</span><span class="o">)</span> <span class="o">:=</span> <span class="k">begin</span>
  <span class="n">intros</span> <span class="n">x</span> <span class="n">y</span> <span class="n">z</span> <span class="n">t</span> <span class="n">Hxz</span> <span class="n">Hyt</span><span class="o">,</span>
  <span class="c1">-- what to do with Hxz, Hyt? I want cauchy.dist x z = 0 to rewrite them and conclude by refl.</span>
<span class="kn">end</span>
<span class="n">def</span> <span class="n">completion</span><span class="bp">.</span><span class="n">dist</span> <span class="o">(</span><span class="n">T</span><span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">[</span><span class="n">metric_space</span> <span class="n">T</span><span class="o">]</span> <span class="o">(</span><span class="n">x</span> <span class="n">y</span><span class="o">:</span> <span class="n">completion</span> <span class="n">T</span><span class="o">):</span> <span class="n">ℝ</span> <span class="o">:=</span>
  <span class="n">quotient</span><span class="bp">.</span><span class="n">lift₂</span> <span class="o">(</span><span class="n">cauchy</span><span class="bp">.</span><span class="n">dist</span> <span class="n">T</span><span class="o">)</span> <span class="o">(</span><span class="n">completion</span><span class="bp">.</span><span class="n">dist_soundness</span> <span class="n">T</span><span class="o">)</span> <span class="n">x</span> <span class="n">y</span>

<span class="kn">instance</span> <span class="n">completion</span><span class="bp">.</span><span class="n">metric_space</span> <span class="o">(</span><span class="n">X</span><span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">[</span><span class="n">metric_space</span> <span class="n">X</span><span class="o">]:</span> <span class="n">metric_space</span> <span class="o">(</span><span class="n">completion</span> <span class="n">X</span><span class="o">)</span> <span class="o">:=</span>
<span class="o">{</span>
  <span class="n">d</span> <span class="o">:=</span> <span class="n">completion</span><span class="bp">.</span><span class="n">dist</span> <span class="n">X</span><span class="o">,</span>
  <span class="n">d_pos</span> <span class="o">:=</span> <span class="n">sorry</span><span class="o">,</span>
  <span class="c1">-- etc</span>
<span class="o">}</span>

<span class="kn">end</span> <span class="n">test</span>
</code></pre></div>



<a name="197065906"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Quotients%20%26%20synthesizing/near/197065906" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ryan Lahfa <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Quotients.20.26.20synthesizing.html#197065906">(May 10 2020 at 16:57)</a>:</h4>
<p><span class="user-mention" data-user-id="110064">@Kenny Lau</span> <span class="user-mention" data-user-id="110038">@Kevin Buzzard</span> Here's a MWE, I'm not sure how to use <code>rfl</code> to be able to rewrite the goal using Hxz, Hyz?</p>



<a name="197066584"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Quotients%20%26%20synthesizing/near/197066584" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Quotients.20.26.20synthesizing.html#197066584">(May 10 2020 at 17:15)</a>:</h4>
<p>Wait -- you cannot do anything at all with <code>x₁ ≈ y₁</code> because this means <code>r x₁ y₁</code> and your definition of <code>r</code> is <code>sorry</code>.</p>



<a name="197066588"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Quotients%20%26%20synthesizing/near/197066588" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ryan Lahfa <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Quotients.20.26.20synthesizing.html#197066588">(May 10 2020 at 17:15)</a>:</h4>
<p>ah, let me edit it</p>



<a name="197066640"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Quotients%20%26%20synthesizing/near/197066640" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Quotients.20.26.20synthesizing.html#197066640">(May 10 2020 at 17:16)</a>:</h4>
<p>I think that <code>x₁ ≈ y₁</code> is definitionally equal to <code>r x₁ y₁</code> and hence to whatever you define it to be.</p>



<a name="197066692"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Quotients%20%26%20synthesizing/near/197066692" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Quotients.20.26.20synthesizing.html#197066692">(May 10 2020 at 17:17)</a>:</h4>
<p>You should just be able to use the <code>change</code> tactic to change something to anything definitionally equivalent to it.</p>



<a name="197067005"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Quotients%20%26%20synthesizing/near/197067005" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ryan Lahfa <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Quotients.20.26.20synthesizing.html#197067005">(May 10 2020 at 17:22)</a>:</h4>
<p>Alright, will give it a try</p>



<a name="197067394"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Quotients%20%26%20synthesizing/near/197067394" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ryan Lahfa <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Quotients.20.26.20synthesizing.html#197067394">(May 10 2020 at 17:28)</a>:</h4>
<p>Hmm, not sure how to use it here:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="n">data</span><span class="bp">.</span><span class="n">real</span><span class="bp">.</span><span class="n">basic</span>
<span class="n">class</span> <span class="n">metric_space</span> <span class="o">(</span><span class="n">X</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">d</span> <span class="o">:</span> <span class="n">X</span> <span class="bp">→</span> <span class="n">X</span> <span class="bp">→</span> <span class="n">ℝ</span><span class="o">)</span>
<span class="o">(</span><span class="n">d_pos</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">x</span> <span class="n">y</span><span class="o">,</span> <span class="n">d</span> <span class="n">x</span> <span class="n">y</span> <span class="bp">≥</span> <span class="mi">0</span><span class="o">)</span>
<span class="o">(</span><span class="n">presep</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">x</span> <span class="n">y</span><span class="o">,</span> <span class="n">x</span><span class="bp">=</span><span class="n">y</span> <span class="bp">→</span> <span class="n">d</span> <span class="n">x</span> <span class="n">y</span> <span class="bp">=</span> <span class="mi">0</span><span class="o">)</span>
<span class="o">(</span><span class="n">sep</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">x</span> <span class="n">y</span><span class="o">,</span> <span class="n">d</span> <span class="n">x</span> <span class="n">y</span> <span class="bp">=</span> <span class="mi">0</span> <span class="bp">→</span>  <span class="n">x</span> <span class="bp">=</span> <span class="n">y</span><span class="o">)</span>
<span class="o">(</span><span class="n">sym</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">x</span> <span class="n">y</span><span class="o">,</span> <span class="n">d</span> <span class="n">x</span> <span class="n">y</span> <span class="bp">=</span> <span class="n">d</span> <span class="n">y</span> <span class="n">x</span><span class="o">)</span>
<span class="o">(</span><span class="n">triangle</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">x</span> <span class="n">y</span> <span class="n">z</span><span class="o">,</span> <span class="n">d</span> <span class="n">x</span> <span class="n">z</span> <span class="bp">≤</span> <span class="n">d</span> <span class="n">x</span> <span class="n">y</span> <span class="bp">+</span> <span class="n">d</span> <span class="n">y</span> <span class="n">z</span><span class="o">)</span>

<span class="kn">instance</span> <span class="n">real</span><span class="bp">.</span><span class="n">metric_space</span><span class="o">:</span> <span class="n">metric_space</span> <span class="n">ℝ</span> <span class="o">:=</span>
 <span class="o">{</span> <span class="n">d</span> <span class="o">:=</span> <span class="n">sorry</span><span class="o">,</span> <span class="n">d_pos</span> <span class="o">:=</span> <span class="n">sorry</span><span class="o">,</span> <span class="n">presep</span> <span class="o">:=</span> <span class="n">sorry</span><span class="o">,</span> <span class="n">sep</span> <span class="o">:=</span> <span class="n">sorry</span><span class="o">,</span>
<span class="n">sym</span> <span class="o">:=</span> <span class="n">sorry</span><span class="o">,</span> <span class="n">triangle</span> <span class="o">:=</span> <span class="n">sorry</span> <span class="o">}</span>
<span class="n">open_locale</span> <span class="n">classical</span>
<span class="n">noncomputable</span> <span class="n">theory</span>
<span class="kn">section</span> <span class="n">test</span>
<span class="kn">open</span> <span class="n">metric_space</span>
<span class="kn">variables</span> <span class="o">{</span><span class="n">X</span><span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">metric_space</span> <span class="n">X</span><span class="o">]</span>

<span class="n">def</span> <span class="n">is_cauchy</span> <span class="o">(</span><span class="n">x</span><span class="o">:</span> <span class="bp">ℕ</span> <span class="bp">→</span> <span class="n">X</span><span class="o">)</span> <span class="o">:=</span>
  <span class="bp">∀</span> <span class="n">ε</span> <span class="bp">&gt;</span> <span class="mi">0</span><span class="o">,</span> <span class="bp">∃</span> <span class="n">N</span><span class="o">,</span> <span class="bp">∀</span> <span class="n">p</span> <span class="bp">≥</span> <span class="n">N</span><span class="o">,</span> <span class="bp">∀</span> <span class="n">q</span> <span class="bp">≥</span> <span class="n">N</span><span class="o">,</span> <span class="o">((</span><span class="n">d</span> <span class="o">(</span><span class="n">x</span> <span class="n">p</span><span class="o">)</span> <span class="o">(</span><span class="n">x</span> <span class="n">q</span><span class="o">))</span> <span class="bp">&lt;</span> <span class="n">ε</span><span class="o">)</span>
<span class="n">def</span> <span class="n">converge</span> <span class="o">(</span><span class="n">x</span><span class="o">:</span> <span class="bp">ℕ</span> <span class="bp">→</span> <span class="n">X</span><span class="o">)</span> <span class="o">(</span><span class="n">l</span> <span class="o">:</span> <span class="n">X</span><span class="o">)</span> <span class="o">:=</span>
  <span class="bp">∀</span> <span class="n">ε</span> <span class="bp">&gt;</span> <span class="mi">0</span><span class="o">,</span> <span class="bp">∃</span> <span class="n">N</span><span class="o">,</span> <span class="bp">∀</span> <span class="n">n</span> <span class="bp">≥</span> <span class="n">N</span><span class="o">,</span> <span class="o">((</span><span class="n">d</span> <span class="n">l</span> <span class="o">(</span><span class="n">x</span> <span class="n">n</span><span class="o">))</span>  <span class="bp">&lt;</span> <span class="n">ε</span><span class="o">)</span>
<span class="n">def</span> <span class="n">complete</span> <span class="o">(</span><span class="n">T</span><span class="o">:</span> <span class="kt">Type</span><span class="o">)</span> <span class="o">[</span><span class="n">metric_space</span> <span class="n">T</span><span class="o">]</span> <span class="o">:=</span> <span class="bp">∀</span> <span class="n">x</span> <span class="o">:</span> <span class="bp">ℕ</span> <span class="bp">→</span> <span class="n">T</span><span class="o">,</span> <span class="n">is_cauchy</span> <span class="n">x</span> <span class="bp">→</span> <span class="bp">∃</span> <span class="n">l</span> <span class="o">:</span> <span class="n">T</span><span class="o">,</span> <span class="n">converge</span> <span class="n">x</span> <span class="n">l</span>

<span class="kn">lemma</span> <span class="n">R_is_complete</span><span class="o">:</span> <span class="n">complete</span> <span class="n">ℝ</span> <span class="o">:=</span> <span class="n">sorry</span>

<span class="n">def</span> <span class="n">cauchy_seqs</span> <span class="o">(</span><span class="n">X</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">[</span><span class="n">metric_space</span> <span class="n">X</span><span class="o">]</span> <span class="o">:=</span> <span class="o">{</span> <span class="n">f</span> <span class="o">:</span> <span class="bp">ℕ</span> <span class="bp">→</span> <span class="n">X</span> <span class="bp">//</span> <span class="n">is_cauchy</span> <span class="n">f</span> <span class="o">}</span>
<span class="n">def</span> <span class="n">cauchy</span><span class="bp">.</span><span class="n">diff</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="bp">ℕ</span> <span class="bp">→</span> <span class="n">X</span><span class="o">)</span> <span class="o">(</span><span class="n">y</span> <span class="o">:</span> <span class="bp">ℕ</span> <span class="bp">→</span> <span class="n">X</span><span class="o">)</span> <span class="o">:</span> <span class="bp">ℕ</span> <span class="bp">→</span> <span class="n">ℝ</span>  <span class="o">:=</span>
 <span class="bp">λ</span> <span class="n">n</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">,</span> <span class="n">d</span> <span class="o">(</span><span class="n">x</span> <span class="n">n</span><span class="o">)</span> <span class="o">(</span><span class="n">y</span> <span class="n">n</span><span class="o">)</span>
<span class="n">def</span> <span class="n">cauchy</span><span class="bp">.</span><span class="n">cauchy_of_diff</span> <span class="o">(</span><span class="n">x</span> <span class="n">y</span> <span class="o">:</span> <span class="bp">ℕ</span> <span class="bp">→</span>  <span class="n">X</span><span class="o">)</span> <span class="o">(</span><span class="n">h1</span> <span class="o">:</span> <span class="n">is_cauchy</span> <span class="n">x</span><span class="o">)</span> <span class="o">(</span><span class="n">h2</span> <span class="o">:</span> <span class="n">is_cauchy</span> <span class="n">y</span><span class="o">):</span>
  <span class="n">is_cauchy</span> <span class="o">(</span><span class="n">cauchy</span><span class="bp">.</span><span class="n">diff</span> <span class="n">x</span> <span class="n">y</span><span class="o">)</span> <span class="o">:=</span> <span class="n">sorry</span>

<span class="n">def</span> <span class="n">cauchy</span><span class="bp">.</span><span class="n">limit</span> <span class="o">(</span><span class="n">x</span><span class="o">:</span> <span class="bp">ℕ</span> <span class="bp">→</span> <span class="n">ℝ</span><span class="o">)</span> <span class="o">(</span><span class="n">H</span><span class="o">:</span> <span class="n">is_cauchy</span> <span class="n">x</span><span class="o">):</span> <span class="n">ℝ</span> <span class="o">:=</span> <span class="n">classical</span><span class="bp">.</span><span class="n">some</span> <span class="o">(</span><span class="n">R_is_complete</span> <span class="n">x</span> <span class="n">H</span><span class="o">)</span>
<span class="n">def</span> <span class="n">cauchy</span><span class="bp">.</span><span class="n">dist</span> <span class="o">(</span><span class="n">T</span><span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">[</span><span class="n">metric_space</span> <span class="n">T</span><span class="o">]</span> <span class="o">(</span><span class="n">x</span> <span class="n">y</span><span class="o">:</span> <span class="n">cauchy_seqs</span> <span class="n">T</span><span class="o">):</span> <span class="n">ℝ</span>
  <span class="o">:=</span> <span class="n">cauchy</span><span class="bp">.</span><span class="n">limit</span> <span class="o">(</span><span class="n">cauchy</span><span class="bp">.</span><span class="n">diff</span> <span class="n">x</span><span class="bp">.</span><span class="n">val</span> <span class="n">y</span><span class="bp">.</span><span class="n">val</span><span class="o">)</span> <span class="o">(</span><span class="n">cauchy</span><span class="bp">.</span><span class="n">cauchy_of_diff</span> <span class="n">x</span><span class="bp">.</span><span class="n">val</span> <span class="n">y</span><span class="bp">.</span><span class="n">val</span> <span class="n">x</span><span class="bp">.</span><span class="n">property</span> <span class="n">y</span><span class="bp">.</span><span class="n">property</span><span class="o">)</span>

<span class="kn">instance</span> <span class="n">cauchy</span><span class="bp">.</span><span class="n">setoid</span> <span class="o">(</span><span class="n">X</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">[</span><span class="n">metric_space</span> <span class="n">X</span><span class="o">]</span> <span class="o">:</span> <span class="n">setoid</span> <span class="o">(</span><span class="n">cauchy_seqs</span> <span class="n">X</span><span class="o">)</span> <span class="o">:=</span>
<span class="o">{</span>
  <span class="n">r</span> <span class="o">:=</span> <span class="n">sorry</span><span class="o">,</span>
  <span class="n">iseqv</span> <span class="o">:=</span> <span class="n">sorry</span>
<span class="o">}</span>
<span class="n">local</span> <span class="n">attribute</span> <span class="o">[</span><span class="kn">instance</span><span class="o">]</span> <span class="n">cauchy</span><span class="bp">.</span><span class="n">setoid</span>

<span class="n">def</span> <span class="n">completion</span> <span class="o">(</span><span class="n">X</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">[</span><span class="n">metric_space</span> <span class="n">X</span><span class="o">]</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span> <span class="o">:=</span> <span class="n">quotient</span> <span class="o">(</span><span class="n">cauchy</span><span class="bp">.</span><span class="n">setoid</span> <span class="n">X</span><span class="o">)</span>

<span class="n">def</span> <span class="n">completion</span><span class="bp">.</span><span class="n">dist_soundness</span> <span class="o">(</span><span class="n">T</span><span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">[</span><span class="n">metric_space</span> <span class="n">T</span><span class="o">]:</span>
  <span class="bp">∀</span> <span class="n">x₁</span> <span class="n">x₂</span><span class="o">:</span> <span class="n">cauchy_seqs</span> <span class="n">T</span><span class="o">,</span> <span class="bp">∀</span> <span class="n">y₁</span> <span class="n">y₂</span><span class="o">:</span> <span class="n">cauchy_seqs</span> <span class="n">T</span><span class="o">,</span> <span class="o">(</span><span class="n">x₁</span> <span class="bp">≈</span> <span class="n">y₁</span><span class="o">)</span> <span class="bp">→</span> <span class="o">(</span><span class="n">x₂</span> <span class="bp">≈</span> <span class="n">y₂</span><span class="o">)</span> <span class="bp">→</span> <span class="o">(</span><span class="n">cauchy</span><span class="bp">.</span><span class="n">dist</span> <span class="n">T</span> <span class="n">x₁</span> <span class="n">x₂</span> <span class="bp">=</span> <span class="n">cauchy</span><span class="bp">.</span><span class="n">dist</span> <span class="n">T</span> <span class="n">y₁</span> <span class="n">y₂</span><span class="o">)</span> <span class="o">:=</span> <span class="k">begin</span>
  <span class="n">intros</span> <span class="n">x</span> <span class="n">y</span> <span class="n">z</span> <span class="n">t</span> <span class="n">Hxz</span> <span class="n">Hyt</span><span class="o">,</span>
  <span class="n">change</span> <span class="o">(</span><span class="n">x</span> <span class="bp">≈</span> <span class="n">z</span><span class="o">)</span> <span class="k">with</span> <span class="o">(</span><span class="n">cauchy</span><span class="bp">.</span><span class="n">dist</span> <span class="n">T</span> <span class="n">x</span> <span class="n">z</span> <span class="bp">=</span> <span class="mi">0</span><span class="o">)</span> <span class="n">at</span> <span class="n">Hxz</span><span class="o">,</span>
  <span class="c1">-- what to do with Hxz, Hyt?</span>
<span class="kn">end</span>
<span class="n">def</span> <span class="n">completion</span><span class="bp">.</span><span class="n">dist</span> <span class="o">(</span><span class="n">T</span><span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">[</span><span class="n">metric_space</span> <span class="n">T</span><span class="o">]</span> <span class="o">(</span><span class="n">x</span> <span class="n">y</span><span class="o">:</span> <span class="n">completion</span> <span class="n">T</span><span class="o">):</span> <span class="n">ℝ</span> <span class="o">:=</span>
  <span class="n">quotient</span><span class="bp">.</span><span class="n">lift₂</span> <span class="o">(</span><span class="n">cauchy</span><span class="bp">.</span><span class="n">dist</span> <span class="n">T</span><span class="o">)</span> <span class="o">(</span><span class="n">completion</span><span class="bp">.</span><span class="n">dist_soundness</span> <span class="n">T</span><span class="o">)</span> <span class="n">x</span> <span class="n">y</span>

<span class="kn">instance</span> <span class="n">completion</span><span class="bp">.</span><span class="n">metric_space</span> <span class="o">(</span><span class="n">X</span><span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">[</span><span class="n">metric_space</span> <span class="n">X</span><span class="o">]:</span> <span class="n">metric_space</span> <span class="o">(</span><span class="n">completion</span> <span class="n">X</span><span class="o">)</span> <span class="o">:=</span>
<span class="o">{</span>
  <span class="n">d</span> <span class="o">:=</span> <span class="n">completion</span><span class="bp">.</span><span class="n">dist</span> <span class="n">X</span><span class="o">,</span>
  <span class="n">d_pos</span> <span class="o">:=</span> <span class="n">sorry</span><span class="o">,</span>
  <span class="c1">-- etc</span>
<span class="o">}</span>

<span class="kn">end</span> <span class="n">test</span>
</code></pre></div>



<a name="197068038"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Quotients%20%26%20synthesizing/near/197068038" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Quotients.20.26.20synthesizing.html#197068038">(May 10 2020 at 17:38)</a>:</h4>
<p><span class="user-mention" data-user-id="262143">@Ryan Lahfa</span> nothing can help you if you keep sorried data and hope Lean will see it's defeq to what you wish</p>



<a name="197068077"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Quotients%20%26%20synthesizing/near/197068077" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ryan Lahfa <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Quotients.20.26.20synthesizing.html#197068077">(May 10 2020 at 17:39)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110031">Patrick Massot</span> <a href="#narrow/stream/116395-maths/topic/Quotients.20.26.20synthesizing/near/197068038" title="#narrow/stream/116395-maths/topic/Quotients.20.26.20synthesizing/near/197068038">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="262143">Ryan Lahfa</span> nothing can help you if you keep sorried data and hope Lean will see it's defeq to what you wish</p>
</blockquote>
<p>I have it fully, but it's quite long :/</p>



<a name="197068078"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Quotients%20%26%20synthesizing/near/197068078" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Quotients.20.26.20synthesizing.html#197068078">(May 10 2020 at 17:39)</a>:</h4>
<p>here the relation in <code>cauchy.setoid</code> is sorried</p>



<a name="197068089"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Quotients%20%26%20synthesizing/near/197068089" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ryan Lahfa <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Quotients.20.26.20synthesizing.html#197068089">(May 10 2020 at 17:39)</a>:</h4>
<p>Oops, you're right</p>



<a name="197068184"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Quotients%20%26%20synthesizing/near/197068184" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ryan Lahfa <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Quotients.20.26.20synthesizing.html#197068184">(May 10 2020 at 17:40)</a>:</h4>
<p>It works \o/ thanks a lot <span class="user-mention" data-user-id="110031">@Patrick Massot</span> <span class="user-mention" data-user-id="110038">@Kevin Buzzard</span> !</p>



<a name="197068595"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Quotients%20%26%20synthesizing/near/197068595" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ryan Lahfa <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Quotients.20.26.20synthesizing.html#197068595">(May 10 2020 at 17:50)</a>:</h4>
<p>But… I have still a little issue with <code>change</code>, it appears like my second change has no effect and no errors:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="n">data</span><span class="bp">.</span><span class="n">real</span><span class="bp">.</span><span class="n">basic</span>
<span class="n">class</span> <span class="n">metric_space</span> <span class="o">(</span><span class="n">X</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">d</span> <span class="o">:</span> <span class="n">X</span> <span class="bp">→</span> <span class="n">X</span> <span class="bp">→</span> <span class="n">ℝ</span><span class="o">)</span>
<span class="o">(</span><span class="n">d_pos</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">x</span> <span class="n">y</span><span class="o">,</span> <span class="n">d</span> <span class="n">x</span> <span class="n">y</span> <span class="bp">≥</span> <span class="mi">0</span><span class="o">)</span>
<span class="o">(</span><span class="n">presep</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">x</span> <span class="n">y</span><span class="o">,</span> <span class="n">x</span><span class="bp">=</span><span class="n">y</span> <span class="bp">→</span> <span class="n">d</span> <span class="n">x</span> <span class="n">y</span> <span class="bp">=</span> <span class="mi">0</span><span class="o">)</span>
<span class="o">(</span><span class="n">sep</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">x</span> <span class="n">y</span><span class="o">,</span> <span class="n">d</span> <span class="n">x</span> <span class="n">y</span> <span class="bp">=</span> <span class="mi">0</span> <span class="bp">→</span>  <span class="n">x</span> <span class="bp">=</span> <span class="n">y</span><span class="o">)</span>
<span class="o">(</span><span class="n">sym</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">x</span> <span class="n">y</span><span class="o">,</span> <span class="n">d</span> <span class="n">x</span> <span class="n">y</span> <span class="bp">=</span> <span class="n">d</span> <span class="n">y</span> <span class="n">x</span><span class="o">)</span>
<span class="o">(</span><span class="n">triangle</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">x</span> <span class="n">y</span> <span class="n">z</span><span class="o">,</span> <span class="n">d</span> <span class="n">x</span> <span class="n">z</span> <span class="bp">≤</span> <span class="n">d</span> <span class="n">x</span> <span class="n">y</span> <span class="bp">+</span> <span class="n">d</span> <span class="n">y</span> <span class="n">z</span><span class="o">)</span>

<span class="kn">instance</span> <span class="n">real</span><span class="bp">.</span><span class="n">metric_space</span><span class="o">:</span> <span class="n">metric_space</span> <span class="n">ℝ</span> <span class="o">:=</span>
 <span class="o">{</span> <span class="n">d</span> <span class="o">:=</span> <span class="n">sorry</span><span class="o">,</span> <span class="n">d_pos</span> <span class="o">:=</span> <span class="n">sorry</span><span class="o">,</span> <span class="n">presep</span> <span class="o">:=</span> <span class="n">sorry</span><span class="o">,</span> <span class="n">sep</span> <span class="o">:=</span> <span class="n">sorry</span><span class="o">,</span>
<span class="n">sym</span> <span class="o">:=</span> <span class="n">sorry</span><span class="o">,</span> <span class="n">triangle</span> <span class="o">:=</span> <span class="n">sorry</span> <span class="o">}</span>
<span class="n">open_locale</span> <span class="n">classical</span>
<span class="n">noncomputable</span> <span class="n">theory</span>
<span class="kn">section</span> <span class="n">test</span>
<span class="kn">open</span> <span class="n">metric_space</span>
<span class="kn">variables</span> <span class="o">{</span><span class="n">X</span><span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">metric_space</span> <span class="n">X</span><span class="o">]</span>

<span class="n">def</span> <span class="n">is_cauchy</span> <span class="o">(</span><span class="n">x</span><span class="o">:</span> <span class="bp">ℕ</span> <span class="bp">→</span> <span class="n">X</span><span class="o">)</span> <span class="o">:=</span>
  <span class="bp">∀</span> <span class="n">ε</span> <span class="bp">&gt;</span> <span class="mi">0</span><span class="o">,</span> <span class="bp">∃</span> <span class="n">N</span><span class="o">,</span> <span class="bp">∀</span> <span class="n">p</span> <span class="bp">≥</span> <span class="n">N</span><span class="o">,</span> <span class="bp">∀</span> <span class="n">q</span> <span class="bp">≥</span> <span class="n">N</span><span class="o">,</span> <span class="o">((</span><span class="n">d</span> <span class="o">(</span><span class="n">x</span> <span class="n">p</span><span class="o">)</span> <span class="o">(</span><span class="n">x</span> <span class="n">q</span><span class="o">))</span> <span class="bp">&lt;</span> <span class="n">ε</span><span class="o">)</span>
<span class="n">def</span> <span class="n">converge</span> <span class="o">(</span><span class="n">x</span><span class="o">:</span> <span class="bp">ℕ</span> <span class="bp">→</span> <span class="n">X</span><span class="o">)</span> <span class="o">(</span><span class="n">l</span> <span class="o">:</span> <span class="n">X</span><span class="o">)</span> <span class="o">:=</span>
  <span class="bp">∀</span> <span class="n">ε</span> <span class="bp">&gt;</span> <span class="mi">0</span><span class="o">,</span> <span class="bp">∃</span> <span class="n">N</span><span class="o">,</span> <span class="bp">∀</span> <span class="n">n</span> <span class="bp">≥</span> <span class="n">N</span><span class="o">,</span> <span class="o">((</span><span class="n">d</span> <span class="n">l</span> <span class="o">(</span><span class="n">x</span> <span class="n">n</span><span class="o">))</span>  <span class="bp">&lt;</span> <span class="n">ε</span><span class="o">)</span>
<span class="n">def</span> <span class="n">complete</span> <span class="o">(</span><span class="n">T</span><span class="o">:</span> <span class="kt">Type</span><span class="o">)</span> <span class="o">[</span><span class="n">metric_space</span> <span class="n">T</span><span class="o">]</span> <span class="o">:=</span> <span class="bp">∀</span> <span class="n">x</span> <span class="o">:</span> <span class="bp">ℕ</span> <span class="bp">→</span> <span class="n">T</span><span class="o">,</span> <span class="n">is_cauchy</span> <span class="n">x</span> <span class="bp">→</span> <span class="bp">∃</span> <span class="n">l</span> <span class="o">:</span> <span class="n">T</span><span class="o">,</span> <span class="n">converge</span> <span class="n">x</span> <span class="n">l</span>

<span class="kn">lemma</span> <span class="n">R_is_complete</span><span class="o">:</span> <span class="n">complete</span> <span class="n">ℝ</span> <span class="o">:=</span> <span class="n">sorry</span>

<span class="n">def</span> <span class="n">cauchy_seqs</span> <span class="o">(</span><span class="n">X</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">[</span><span class="n">metric_space</span> <span class="n">X</span><span class="o">]</span> <span class="o">:=</span> <span class="o">{</span> <span class="n">f</span> <span class="o">:</span> <span class="bp">ℕ</span> <span class="bp">→</span> <span class="n">X</span> <span class="bp">//</span> <span class="n">is_cauchy</span> <span class="n">f</span> <span class="o">}</span>
<span class="n">def</span> <span class="n">cauchy</span><span class="bp">.</span><span class="n">diff</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="bp">ℕ</span> <span class="bp">→</span> <span class="n">X</span><span class="o">)</span> <span class="o">(</span><span class="n">y</span> <span class="o">:</span> <span class="bp">ℕ</span> <span class="bp">→</span> <span class="n">X</span><span class="o">)</span> <span class="o">:</span> <span class="bp">ℕ</span> <span class="bp">→</span> <span class="n">ℝ</span>  <span class="o">:=</span>
 <span class="bp">λ</span> <span class="n">n</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">,</span> <span class="n">d</span> <span class="o">(</span><span class="n">x</span> <span class="n">n</span><span class="o">)</span> <span class="o">(</span><span class="n">y</span> <span class="n">n</span><span class="o">)</span>
<span class="n">def</span> <span class="n">cauchy</span><span class="bp">.</span><span class="n">cauchy_of_diff</span> <span class="o">(</span><span class="n">x</span> <span class="n">y</span> <span class="o">:</span> <span class="bp">ℕ</span> <span class="bp">→</span>  <span class="n">X</span><span class="o">)</span> <span class="o">(</span><span class="n">h1</span> <span class="o">:</span> <span class="n">is_cauchy</span> <span class="n">x</span><span class="o">)</span> <span class="o">(</span><span class="n">h2</span> <span class="o">:</span> <span class="n">is_cauchy</span> <span class="n">y</span><span class="o">):</span>
  <span class="n">is_cauchy</span> <span class="o">(</span><span class="n">cauchy</span><span class="bp">.</span><span class="n">diff</span> <span class="n">x</span> <span class="n">y</span><span class="o">)</span> <span class="o">:=</span> <span class="n">sorry</span>

<span class="n">def</span> <span class="n">cauchy</span><span class="bp">.</span><span class="n">limit</span> <span class="o">(</span><span class="n">x</span><span class="o">:</span> <span class="bp">ℕ</span> <span class="bp">→</span> <span class="n">ℝ</span><span class="o">)</span> <span class="o">(</span><span class="n">H</span><span class="o">:</span> <span class="n">is_cauchy</span> <span class="n">x</span><span class="o">):</span> <span class="n">ℝ</span> <span class="o">:=</span> <span class="n">classical</span><span class="bp">.</span><span class="n">some</span> <span class="o">(</span><span class="n">R_is_complete</span> <span class="n">x</span> <span class="n">H</span><span class="o">)</span>
<span class="n">def</span> <span class="n">cauchy</span><span class="bp">.</span><span class="n">dist</span> <span class="o">(</span><span class="n">T</span><span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">[</span><span class="n">metric_space</span> <span class="n">T</span><span class="o">]</span> <span class="o">(</span><span class="n">x</span> <span class="n">y</span><span class="o">:</span> <span class="n">cauchy_seqs</span> <span class="n">T</span><span class="o">):</span> <span class="n">ℝ</span>
  <span class="o">:=</span> <span class="n">cauchy</span><span class="bp">.</span><span class="n">limit</span> <span class="o">(</span><span class="n">cauchy</span><span class="bp">.</span><span class="n">diff</span> <span class="n">x</span><span class="bp">.</span><span class="n">val</span> <span class="n">y</span><span class="bp">.</span><span class="n">val</span><span class="o">)</span> <span class="o">(</span><span class="n">cauchy</span><span class="bp">.</span><span class="n">cauchy_of_diff</span> <span class="n">x</span><span class="bp">.</span><span class="n">val</span> <span class="n">y</span><span class="bp">.</span><span class="n">val</span> <span class="n">x</span><span class="bp">.</span><span class="n">property</span> <span class="n">y</span><span class="bp">.</span><span class="n">property</span><span class="o">)</span>

<span class="n">def</span> <span class="n">cauchy</span><span class="bp">.</span><span class="n">cong</span> <span class="o">(</span><span class="n">T</span><span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">[</span><span class="n">metric_space</span> <span class="n">T</span><span class="o">]</span> <span class="o">(</span><span class="n">x</span> <span class="n">y</span><span class="o">:</span> <span class="n">cauchy_seqs</span> <span class="n">T</span><span class="o">):</span> <span class="kt">Prop</span> <span class="o">:=</span> <span class="n">cauchy</span><span class="bp">.</span><span class="n">dist</span> <span class="n">T</span> <span class="n">x</span> <span class="n">y</span> <span class="bp">=</span> <span class="mi">0</span>
<span class="kn">instance</span> <span class="n">cauchy</span><span class="bp">.</span><span class="n">setoid</span> <span class="o">(</span><span class="n">X</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">[</span><span class="n">metric_space</span> <span class="n">X</span><span class="o">]</span> <span class="o">:</span> <span class="n">setoid</span> <span class="o">(</span><span class="n">cauchy_seqs</span> <span class="n">X</span><span class="o">)</span> <span class="o">:=</span>
<span class="o">{</span>
  <span class="n">r</span> <span class="o">:=</span> <span class="n">cauchy</span><span class="bp">.</span><span class="n">cong</span> <span class="n">X</span><span class="o">,</span>
  <span class="n">iseqv</span> <span class="o">:=</span> <span class="n">sorry</span>
<span class="o">}</span>
<span class="n">local</span> <span class="n">attribute</span> <span class="o">[</span><span class="kn">instance</span><span class="o">]</span> <span class="n">cauchy</span><span class="bp">.</span><span class="n">setoid</span>

<span class="n">def</span> <span class="n">completion</span> <span class="o">(</span><span class="n">X</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">[</span><span class="n">metric_space</span> <span class="n">X</span><span class="o">]</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span> <span class="o">:=</span> <span class="n">quotient</span> <span class="o">(</span><span class="n">cauchy</span><span class="bp">.</span><span class="n">setoid</span> <span class="n">X</span><span class="o">)</span>

<span class="n">def</span> <span class="n">completion</span><span class="bp">.</span><span class="n">dist_soundness</span> <span class="o">(</span><span class="n">T</span><span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">[</span><span class="n">metric_space</span> <span class="n">T</span><span class="o">]:</span>
  <span class="bp">∀</span> <span class="n">x₁</span> <span class="n">x₂</span><span class="o">:</span> <span class="n">cauchy_seqs</span> <span class="n">T</span><span class="o">,</span> <span class="bp">∀</span> <span class="n">y₁</span> <span class="n">y₂</span><span class="o">:</span> <span class="n">cauchy_seqs</span> <span class="n">T</span><span class="o">,</span> <span class="o">(</span><span class="n">x₁</span> <span class="bp">≈</span> <span class="n">y₁</span><span class="o">)</span> <span class="bp">→</span> <span class="o">(</span><span class="n">x₂</span> <span class="bp">≈</span> <span class="n">y₂</span><span class="o">)</span> <span class="bp">→</span> <span class="o">(</span><span class="n">cauchy</span><span class="bp">.</span><span class="n">dist</span> <span class="n">T</span> <span class="n">x₁</span> <span class="n">x₂</span> <span class="bp">=</span> <span class="n">cauchy</span><span class="bp">.</span><span class="n">dist</span> <span class="n">T</span> <span class="n">y₁</span> <span class="n">y₂</span><span class="o">)</span> <span class="o">:=</span> <span class="k">begin</span>
  <span class="n">intros</span> <span class="n">x</span> <span class="n">y</span> <span class="n">z</span> <span class="n">t</span> <span class="n">Hxz</span> <span class="n">Hyt</span><span class="o">,</span>
  <span class="n">change</span> <span class="o">(</span><span class="n">x</span> <span class="bp">≈</span> <span class="n">z</span><span class="o">)</span> <span class="k">with</span> <span class="o">(</span><span class="n">cauchy</span><span class="bp">.</span><span class="n">dist</span> <span class="n">T</span> <span class="n">x</span> <span class="n">z</span> <span class="bp">=</span> <span class="mi">0</span><span class="o">)</span> <span class="n">at</span> <span class="n">Hxz</span><span class="o">,</span>
  <span class="n">change</span> <span class="o">(</span><span class="n">y</span> <span class="bp">≈</span> <span class="n">t</span><span class="o">)</span> <span class="k">with</span> <span class="o">(</span><span class="n">cauchy</span><span class="bp">.</span><span class="n">dist</span> <span class="n">T</span> <span class="n">y</span> <span class="n">t</span> <span class="bp">=</span> <span class="mi">0</span><span class="o">)</span> <span class="n">at</span> <span class="n">Hyt</span><span class="o">,</span>
  <span class="n">apply</span> <span class="n">le_antisymm</span><span class="o">,</span>
  <span class="k">calc</span>
    <span class="n">cauchy</span><span class="bp">.</span><span class="n">dist</span> <span class="n">T</span> <span class="n">x</span> <span class="n">y</span> <span class="bp">≤</span> <span class="n">cauchy</span><span class="bp">.</span><span class="n">dist</span> <span class="n">T</span> <span class="n">x</span> <span class="n">z</span> <span class="bp">+</span> <span class="n">cauchy</span><span class="bp">.</span><span class="n">dist</span> <span class="n">T</span> <span class="n">z</span> <span class="n">t</span> <span class="bp">+</span> <span class="n">cauchy</span><span class="bp">.</span><span class="n">dist</span> <span class="n">T</span> <span class="n">t</span> <span class="n">y</span> <span class="o">:</span> <span class="n">sorry</span>
    <span class="bp">...</span> <span class="bp">=</span> <span class="n">cauchy</span><span class="bp">.</span><span class="n">dist</span> <span class="n">T</span> <span class="n">z</span> <span class="n">t</span> <span class="bp">+</span> <span class="n">cauchy</span><span class="bp">.</span><span class="n">dist</span> <span class="n">T</span> <span class="n">t</span> <span class="n">y</span> <span class="o">:</span> <span class="k">by</span> <span class="n">rw</span> <span class="n">Hxz</span>
    <span class="bp">...</span> <span class="bp">=</span> <span class="n">cauchy</span><span class="bp">.</span><span class="n">dist</span> <span class="n">T</span> <span class="n">z</span> <span class="n">t</span> <span class="bp">+</span> <span class="n">cauchy</span><span class="bp">.</span><span class="n">dist</span> <span class="n">T</span> <span class="n">y</span> <span class="n">t</span> <span class="o">:</span> <span class="n">sorry</span> <span class="c1">-- symmetry</span>
    <span class="bp">...</span> <span class="bp">=</span> <span class="n">cauchy</span><span class="bp">.</span><span class="n">dist</span> <span class="n">T</span> <span class="n">z</span> <span class="n">t</span> <span class="o">:</span> <span class="n">sorry</span><span class="o">,</span>
  <span class="k">calc</span>
    <span class="n">cauchy</span><span class="bp">.</span><span class="n">dist</span> <span class="n">T</span> <span class="n">z</span> <span class="n">t</span> <span class="bp">≤</span> <span class="n">cauchy</span><span class="bp">.</span><span class="n">dist</span> <span class="n">T</span> <span class="n">z</span> <span class="n">x</span> <span class="bp">+</span> <span class="n">cauchy</span><span class="bp">.</span><span class="n">dist</span> <span class="n">T</span> <span class="n">x</span> <span class="n">y</span> <span class="bp">+</span> <span class="n">cauchy</span><span class="bp">.</span><span class="n">dist</span> <span class="n">T</span> <span class="n">y</span> <span class="n">t</span> <span class="o">:</span> <span class="n">sorry</span>
    <span class="bp">...</span> <span class="bp">=</span> <span class="n">cauchy</span><span class="bp">.</span><span class="n">dist</span> <span class="n">T</span> <span class="n">x</span> <span class="n">z</span> <span class="bp">+</span> <span class="n">cauchy</span><span class="bp">.</span><span class="n">dist</span> <span class="n">T</span> <span class="n">x</span> <span class="n">y</span> <span class="o">:</span> <span class="n">sorry</span>
    <span class="bp">...</span> <span class="bp">=</span> <span class="n">cauchy</span><span class="bp">.</span><span class="n">dist</span> <span class="n">T</span> <span class="n">x</span> <span class="n">y</span> <span class="o">:</span> <span class="n">sorry</span><span class="o">,</span>
<span class="kn">end</span>
<span class="n">def</span> <span class="n">completion</span><span class="bp">.</span><span class="n">dist</span> <span class="o">(</span><span class="n">T</span><span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">[</span><span class="n">metric_space</span> <span class="n">T</span><span class="o">]</span> <span class="o">(</span><span class="n">x</span> <span class="n">y</span><span class="o">:</span> <span class="n">completion</span> <span class="n">T</span><span class="o">):</span> <span class="n">ℝ</span> <span class="o">:=</span>
  <span class="n">quotient</span><span class="bp">.</span><span class="n">lift₂</span> <span class="o">(</span><span class="n">cauchy</span><span class="bp">.</span><span class="n">dist</span> <span class="n">T</span><span class="o">)</span> <span class="o">(</span><span class="n">completion</span><span class="bp">.</span><span class="n">dist_soundness</span> <span class="n">T</span><span class="o">)</span> <span class="n">x</span> <span class="n">y</span>

<span class="kn">instance</span> <span class="n">completion</span><span class="bp">.</span><span class="n">metric_space</span> <span class="o">(</span><span class="n">X</span><span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">[</span><span class="n">metric_space</span> <span class="n">X</span><span class="o">]:</span> <span class="n">metric_space</span> <span class="o">(</span><span class="n">completion</span> <span class="n">X</span><span class="o">)</span> <span class="o">:=</span>
<span class="o">{</span>
  <span class="n">d</span> <span class="o">:=</span> <span class="n">completion</span><span class="bp">.</span><span class="n">dist</span> <span class="n">X</span><span class="o">,</span>
  <span class="n">d_pos</span> <span class="o">:=</span> <span class="n">sorry</span><span class="o">,</span>
  <span class="c1">-- etc</span>
<span class="o">}</span>

<span class="kn">end</span> <span class="n">test</span>
</code></pre></div>



<a name="197068600"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Quotients%20%26%20synthesizing/near/197068600" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ryan Lahfa <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Quotients.20.26.20synthesizing.html#197068600">(May 10 2020 at 17:50)</a>:</h4>
<p><code>Hyt</code> stays the same</p>



<a name="197068605"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Quotients%20%26%20synthesizing/near/197068605" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ryan Lahfa <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Quotients.20.26.20synthesizing.html#197068605">(May 10 2020 at 17:51)</a>:</h4>
<p>I triple-checked and I don't think I'm doing something stupid</p>



<a name="197069639"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Quotients%20%26%20synthesizing/near/197069639" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Quotients.20.26.20synthesizing.html#197069639">(May 10 2020 at 18:16)</a>:</h4>
<p>I don't know specifically why it doesn't work, but just use <code>change cauchy.dist T y t = 0 at Hyt</code> since you are <code>change</code>ing the whole type.</p>



<a name="197069823"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Quotients%20%26%20synthesizing/near/197069823" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ryan Lahfa <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Quotients.20.26.20synthesizing.html#197069823">(May 10 2020 at 18:18)</a>:</h4>
<p>Alright!</p>



<a name="197069851"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Quotients%20%26%20synthesizing/near/197069851" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ryan Lahfa <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Quotients.20.26.20synthesizing.html#197069851">(May 10 2020 at 18:19)</a>:</h4>
<p>It works fine, this way <span class="user-mention" data-user-id="110032">@Reid Barton</span> thanks!</p>



<a name="197069958"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Quotients%20%26%20synthesizing/near/197069958" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Quotients.20.26.20synthesizing.html#197069958">(May 10 2020 at 18:20)</a>:</h4>
<p>I actually only learned about <code>change ... with</code> a couple weeks ago, I think.</p>



<a name="197070363"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Quotients%20%26%20synthesizing/near/197070363" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Quotients.20.26.20synthesizing.html#197070363">(May 10 2020 at 18:26)</a>:</h4>
<p>related: <code>change' ... with</code></p>



<a name="197081205"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Quotients%20%26%20synthesizing/near/197081205" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ryan Lahfa <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Quotients.20.26.20synthesizing.html#197081205">(May 10 2020 at 21:58)</a>:</h4>
<p>And here I come back with a complex issue because I cannot reproduce it as a MWE:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="n">data</span><span class="bp">.</span><span class="n">real</span><span class="bp">.</span><span class="n">basic</span>
<span class="n">class</span> <span class="n">metric_space</span> <span class="o">(</span><span class="n">X</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">d</span> <span class="o">:</span> <span class="n">X</span> <span class="bp">→</span> <span class="n">X</span> <span class="bp">→</span> <span class="n">ℝ</span><span class="o">)</span>
<span class="o">(</span><span class="n">d_pos</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">x</span> <span class="n">y</span><span class="o">,</span> <span class="n">d</span> <span class="n">x</span> <span class="n">y</span> <span class="bp">≥</span> <span class="mi">0</span><span class="o">)</span>
<span class="o">(</span><span class="n">presep</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">x</span> <span class="n">y</span><span class="o">,</span> <span class="n">x</span><span class="bp">=</span><span class="n">y</span> <span class="bp">→</span> <span class="n">d</span> <span class="n">x</span> <span class="n">y</span> <span class="bp">=</span> <span class="mi">0</span><span class="o">)</span>
<span class="o">(</span><span class="n">sep</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">x</span> <span class="n">y</span><span class="o">,</span> <span class="n">d</span> <span class="n">x</span> <span class="n">y</span> <span class="bp">=</span> <span class="mi">0</span> <span class="bp">→</span>  <span class="n">x</span> <span class="bp">=</span> <span class="n">y</span><span class="o">)</span>
<span class="o">(</span><span class="n">sym</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">x</span> <span class="n">y</span><span class="o">,</span> <span class="n">d</span> <span class="n">x</span> <span class="n">y</span> <span class="bp">=</span> <span class="n">d</span> <span class="n">y</span> <span class="n">x</span><span class="o">)</span>
<span class="o">(</span><span class="n">triangle</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">x</span> <span class="n">y</span> <span class="n">z</span><span class="o">,</span> <span class="n">d</span> <span class="n">x</span> <span class="n">z</span> <span class="bp">≤</span> <span class="n">d</span> <span class="n">x</span> <span class="n">y</span> <span class="bp">+</span> <span class="n">d</span> <span class="n">y</span> <span class="n">z</span><span class="o">)</span>
<span class="n">class</span> <span class="n">premetric_space</span> <span class="o">(</span><span class="n">X</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">d</span> <span class="o">:</span> <span class="n">X</span> <span class="bp">→</span> <span class="n">X</span> <span class="bp">→</span> <span class="n">ℝ</span><span class="o">)</span>
<span class="o">(</span><span class="n">d_pos</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">x</span> <span class="n">y</span><span class="o">,</span> <span class="n">d</span> <span class="n">x</span> <span class="n">y</span> <span class="bp">≥</span> <span class="mi">0</span><span class="o">)</span>
<span class="o">(</span><span class="n">presep</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">x</span> <span class="n">y</span><span class="o">,</span> <span class="n">x</span><span class="bp">=</span><span class="n">y</span> <span class="bp">→</span> <span class="n">d</span> <span class="n">x</span> <span class="n">y</span> <span class="bp">=</span> <span class="mi">0</span><span class="o">)</span>
<span class="o">(</span><span class="n">sym</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">x</span> <span class="n">y</span><span class="o">,</span> <span class="n">d</span> <span class="n">x</span> <span class="n">y</span> <span class="bp">=</span> <span class="n">d</span> <span class="n">y</span> <span class="n">x</span><span class="o">)</span>
<span class="o">(</span><span class="n">triangle</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">x</span> <span class="n">y</span> <span class="n">z</span><span class="o">,</span> <span class="n">d</span> <span class="n">x</span> <span class="n">z</span> <span class="bp">≤</span> <span class="n">d</span> <span class="n">x</span> <span class="n">y</span> <span class="bp">+</span> <span class="n">d</span> <span class="n">y</span> <span class="n">z</span><span class="o">)</span>

<span class="kn">instance</span> <span class="n">real</span><span class="bp">.</span><span class="n">metric_space</span><span class="o">:</span> <span class="n">metric_space</span> <span class="n">ℝ</span> <span class="o">:=</span>
 <span class="o">{</span> <span class="n">d</span> <span class="o">:=</span> <span class="n">sorry</span><span class="o">,</span> <span class="n">d_pos</span> <span class="o">:=</span> <span class="n">sorry</span><span class="o">,</span> <span class="n">presep</span> <span class="o">:=</span> <span class="n">sorry</span><span class="o">,</span> <span class="n">sep</span> <span class="o">:=</span> <span class="n">sorry</span><span class="o">,</span>
<span class="n">sym</span> <span class="o">:=</span> <span class="n">sorry</span><span class="o">,</span> <span class="n">triangle</span> <span class="o">:=</span> <span class="n">sorry</span> <span class="o">}</span>
<span class="n">open_locale</span> <span class="n">classical</span>
<span class="n">noncomputable</span> <span class="n">theory</span>
<span class="kn">section</span> <span class="n">test</span>
<span class="kn">open</span> <span class="n">metric_space</span>
<span class="kn">variables</span> <span class="o">{</span><span class="n">X</span><span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">metric_space</span> <span class="n">X</span><span class="o">]</span>

<span class="n">def</span> <span class="n">is_cauchy</span> <span class="o">(</span><span class="n">x</span><span class="o">:</span> <span class="bp">ℕ</span> <span class="bp">→</span> <span class="n">X</span><span class="o">)</span> <span class="o">:=</span>
  <span class="bp">∀</span> <span class="n">ε</span> <span class="bp">&gt;</span> <span class="mi">0</span><span class="o">,</span> <span class="bp">∃</span> <span class="n">N</span><span class="o">,</span> <span class="bp">∀</span> <span class="n">p</span> <span class="bp">≥</span> <span class="n">N</span><span class="o">,</span> <span class="bp">∀</span> <span class="n">q</span> <span class="bp">≥</span> <span class="n">N</span><span class="o">,</span> <span class="o">((</span><span class="n">d</span> <span class="o">(</span><span class="n">x</span> <span class="n">p</span><span class="o">)</span> <span class="o">(</span><span class="n">x</span> <span class="n">q</span><span class="o">))</span> <span class="bp">&lt;</span> <span class="n">ε</span><span class="o">)</span>
<span class="n">def</span> <span class="n">converge</span> <span class="o">(</span><span class="n">x</span><span class="o">:</span> <span class="bp">ℕ</span> <span class="bp">→</span> <span class="n">X</span><span class="o">)</span> <span class="o">(</span><span class="n">l</span> <span class="o">:</span> <span class="n">X</span><span class="o">)</span> <span class="o">:=</span>
  <span class="bp">∀</span> <span class="n">ε</span> <span class="bp">&gt;</span> <span class="mi">0</span><span class="o">,</span> <span class="bp">∃</span> <span class="n">N</span><span class="o">,</span> <span class="bp">∀</span> <span class="n">n</span> <span class="bp">≥</span> <span class="n">N</span><span class="o">,</span> <span class="o">((</span><span class="n">d</span> <span class="n">l</span> <span class="o">(</span><span class="n">x</span> <span class="n">n</span><span class="o">))</span>  <span class="bp">&lt;</span> <span class="n">ε</span><span class="o">)</span>
<span class="n">def</span> <span class="n">complete</span> <span class="o">(</span><span class="n">T</span><span class="o">:</span> <span class="kt">Type</span><span class="o">)</span> <span class="o">[</span><span class="n">metric_space</span> <span class="n">T</span><span class="o">]</span> <span class="o">:=</span> <span class="bp">∀</span> <span class="n">x</span> <span class="o">:</span> <span class="bp">ℕ</span> <span class="bp">→</span> <span class="n">T</span><span class="o">,</span> <span class="n">is_cauchy</span> <span class="n">x</span> <span class="bp">→</span> <span class="bp">∃</span> <span class="n">l</span> <span class="o">:</span> <span class="n">T</span><span class="o">,</span> <span class="n">converge</span> <span class="n">x</span> <span class="n">l</span>

<span class="kn">lemma</span> <span class="n">R_is_complete</span><span class="o">:</span> <span class="n">complete</span> <span class="n">ℝ</span> <span class="o">:=</span> <span class="n">sorry</span>

<span class="n">def</span> <span class="n">cauchy_seqs</span> <span class="o">(</span><span class="n">X</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">[</span><span class="n">metric_space</span> <span class="n">X</span><span class="o">]</span> <span class="o">:=</span> <span class="o">{</span> <span class="n">f</span> <span class="o">:</span> <span class="bp">ℕ</span> <span class="bp">→</span> <span class="n">X</span> <span class="bp">//</span> <span class="n">is_cauchy</span> <span class="n">f</span> <span class="o">}</span>
<span class="n">def</span> <span class="n">cauchy</span><span class="bp">.</span><span class="n">diff</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="bp">ℕ</span> <span class="bp">→</span> <span class="n">X</span><span class="o">)</span> <span class="o">(</span><span class="n">y</span> <span class="o">:</span> <span class="bp">ℕ</span> <span class="bp">→</span> <span class="n">X</span><span class="o">)</span> <span class="o">:</span> <span class="bp">ℕ</span> <span class="bp">→</span> <span class="n">ℝ</span>  <span class="o">:=</span>
 <span class="bp">λ</span> <span class="n">n</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">,</span> <span class="n">d</span> <span class="o">(</span><span class="n">x</span> <span class="n">n</span><span class="o">)</span> <span class="o">(</span><span class="n">y</span> <span class="n">n</span><span class="o">)</span>
<span class="n">def</span> <span class="n">cauchy</span><span class="bp">.</span><span class="n">cauchy_of_diff</span> <span class="o">(</span><span class="n">x</span> <span class="n">y</span> <span class="o">:</span> <span class="bp">ℕ</span> <span class="bp">→</span>  <span class="n">X</span><span class="o">)</span> <span class="o">(</span><span class="n">h1</span> <span class="o">:</span> <span class="n">is_cauchy</span> <span class="n">x</span><span class="o">)</span> <span class="o">(</span><span class="n">h2</span> <span class="o">:</span> <span class="n">is_cauchy</span> <span class="n">y</span><span class="o">):</span>
  <span class="n">is_cauchy</span> <span class="o">(</span><span class="n">cauchy</span><span class="bp">.</span><span class="n">diff</span> <span class="n">x</span> <span class="n">y</span><span class="o">)</span> <span class="o">:=</span> <span class="n">sorry</span>

<span class="n">def</span> <span class="n">cauchy</span><span class="bp">.</span><span class="n">limit</span> <span class="o">(</span><span class="n">x</span><span class="o">:</span> <span class="bp">ℕ</span> <span class="bp">→</span> <span class="n">ℝ</span><span class="o">)</span> <span class="o">(</span><span class="n">H</span><span class="o">:</span> <span class="n">is_cauchy</span> <span class="n">x</span><span class="o">):</span> <span class="n">ℝ</span> <span class="o">:=</span> <span class="n">classical</span><span class="bp">.</span><span class="n">some</span> <span class="o">(</span><span class="n">R_is_complete</span> <span class="n">x</span> <span class="n">H</span><span class="o">)</span>
<span class="n">def</span> <span class="n">cauchy</span><span class="bp">.</span><span class="n">dist</span> <span class="o">(</span><span class="n">T</span><span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">[</span><span class="n">metric_space</span> <span class="n">T</span><span class="o">]</span> <span class="o">(</span><span class="n">x</span> <span class="n">y</span><span class="o">:</span> <span class="n">cauchy_seqs</span> <span class="n">T</span><span class="o">):</span> <span class="n">ℝ</span>
  <span class="o">:=</span> <span class="n">cauchy</span><span class="bp">.</span><span class="n">limit</span> <span class="o">(</span><span class="n">cauchy</span><span class="bp">.</span><span class="n">diff</span> <span class="n">x</span><span class="bp">.</span><span class="n">val</span> <span class="n">y</span><span class="bp">.</span><span class="n">val</span><span class="o">)</span> <span class="o">(</span><span class="n">cauchy</span><span class="bp">.</span><span class="n">cauchy_of_diff</span> <span class="n">x</span><span class="bp">.</span><span class="n">val</span> <span class="n">y</span><span class="bp">.</span><span class="n">val</span> <span class="n">x</span><span class="bp">.</span><span class="n">property</span> <span class="n">y</span><span class="bp">.</span><span class="n">property</span><span class="o">)</span>


<span class="kn">instance</span> <span class="n">pre_ecart</span><span class="bp">.</span><span class="n">premetrique</span> <span class="o">(</span><span class="n">X</span><span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">[</span><span class="n">metric_space</span> <span class="n">X</span><span class="o">]:</span> <span class="n">premetric_space</span> <span class="o">(</span><span class="n">cauchy_seqs</span> <span class="n">X</span><span class="o">)</span> <span class="o">:=</span>
<span class="o">{</span> <span class="n">d</span> <span class="o">:=</span> <span class="n">cauchy</span><span class="bp">.</span><span class="n">dist</span> <span class="n">X</span><span class="o">,</span>
  <span class="n">d_pos</span> <span class="o">:=</span> <span class="n">sorry</span><span class="o">,</span>
  <span class="n">presep</span> <span class="o">:=</span> <span class="n">sorry</span><span class="o">,</span>
  <span class="n">sym</span> <span class="o">:=</span> <span class="n">sorry</span><span class="o">,</span>
  <span class="n">triangle</span> <span class="o">:=</span> <span class="n">sorry</span> <span class="o">}</span>

<span class="n">def</span> <span class="n">cauchy</span><span class="bp">.</span><span class="n">cong</span> <span class="o">(</span><span class="n">T</span><span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">[</span><span class="n">metric_space</span> <span class="n">T</span><span class="o">]</span> <span class="o">(</span><span class="n">x</span> <span class="n">y</span><span class="o">:</span> <span class="n">cauchy_seqs</span> <span class="n">T</span><span class="o">):</span> <span class="kt">Prop</span> <span class="o">:=</span> <span class="n">cauchy</span><span class="bp">.</span><span class="n">dist</span> <span class="n">T</span> <span class="n">x</span> <span class="n">y</span> <span class="bp">=</span> <span class="mi">0</span>
<span class="kn">instance</span> <span class="n">cauchy</span><span class="bp">.</span><span class="n">setoid</span> <span class="o">(</span><span class="n">X</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">[</span><span class="n">metric_space</span> <span class="n">X</span><span class="o">]</span> <span class="o">:</span> <span class="n">setoid</span> <span class="o">(</span><span class="n">cauchy_seqs</span> <span class="n">X</span><span class="o">)</span> <span class="o">:=</span>
<span class="o">{</span>
  <span class="n">r</span> <span class="o">:=</span> <span class="n">cauchy</span><span class="bp">.</span><span class="n">cong</span> <span class="n">X</span><span class="o">,</span>
  <span class="n">iseqv</span> <span class="o">:=</span> <span class="n">sorry</span>
<span class="o">}</span>
<span class="n">local</span> <span class="n">attribute</span> <span class="o">[</span><span class="kn">instance</span><span class="o">]</span> <span class="n">cauchy</span><span class="bp">.</span><span class="n">setoid</span>

<span class="n">def</span> <span class="n">completion</span> <span class="o">(</span><span class="n">X</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">[</span><span class="n">metric_space</span> <span class="n">X</span><span class="o">]</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span> <span class="o">:=</span> <span class="n">quotient</span> <span class="o">(</span><span class="n">cauchy</span><span class="bp">.</span><span class="n">setoid</span> <span class="n">X</span><span class="o">)</span>

<span class="n">def</span> <span class="n">completion</span><span class="bp">.</span><span class="n">dist_soundness</span> <span class="o">(</span><span class="n">T</span><span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">[</span><span class="n">metric_space</span> <span class="n">T</span><span class="o">]:</span>
  <span class="bp">∀</span> <span class="n">x₁</span> <span class="n">x₂</span><span class="o">:</span> <span class="n">cauchy_seqs</span> <span class="n">T</span><span class="o">,</span> <span class="bp">∀</span> <span class="n">y₁</span> <span class="n">y₂</span><span class="o">:</span> <span class="n">cauchy_seqs</span> <span class="n">T</span><span class="o">,</span> <span class="o">(</span><span class="n">x₁</span> <span class="bp">≈</span> <span class="n">y₁</span><span class="o">)</span> <span class="bp">→</span> <span class="o">(</span><span class="n">x₂</span> <span class="bp">≈</span> <span class="n">y₂</span><span class="o">)</span> <span class="bp">→</span> <span class="o">(</span><span class="n">cauchy</span><span class="bp">.</span><span class="n">dist</span> <span class="n">T</span> <span class="n">x₁</span> <span class="n">x₂</span> <span class="bp">=</span> <span class="n">cauchy</span><span class="bp">.</span><span class="n">dist</span> <span class="n">T</span> <span class="n">y₁</span> <span class="n">y₂</span><span class="o">)</span> <span class="o">:=</span> <span class="k">begin</span>
  <span class="n">intros</span> <span class="n">x</span> <span class="n">y</span> <span class="n">z</span> <span class="n">t</span> <span class="n">Hxz</span> <span class="n">Hyt</span><span class="o">,</span>
  <span class="n">change</span> <span class="o">(</span><span class="n">cauchy</span><span class="bp">.</span><span class="n">dist</span> <span class="n">T</span> <span class="n">x</span> <span class="n">z</span> <span class="bp">=</span> <span class="mi">0</span><span class="o">)</span> <span class="n">at</span> <span class="n">Hxz</span><span class="o">,</span>
  <span class="n">change</span> <span class="o">(</span><span class="n">cauchy</span><span class="bp">.</span><span class="n">dist</span> <span class="n">T</span> <span class="n">y</span> <span class="n">t</span> <span class="bp">=</span> <span class="mi">0</span><span class="o">)</span> <span class="n">at</span> <span class="n">Hyt</span><span class="o">,</span>
  <span class="n">apply</span> <span class="n">le_antisymm</span><span class="o">,</span>
  <span class="k">calc</span>
    <span class="n">cauchy</span><span class="bp">.</span><span class="n">dist</span> <span class="n">T</span> <span class="n">x</span> <span class="n">y</span> <span class="bp">≤</span> <span class="n">cauchy</span><span class="bp">.</span><span class="n">dist</span> <span class="n">T</span> <span class="n">x</span> <span class="n">z</span> <span class="bp">+</span> <span class="n">cauchy</span><span class="bp">.</span><span class="n">dist</span> <span class="n">T</span> <span class="n">z</span> <span class="n">y</span> <span class="o">:</span> <span class="n">premetric_space</span><span class="bp">.</span><span class="n">triangle</span> <span class="n">x</span> <span class="n">z</span> <span class="n">y</span>
    <span class="bp">...</span> <span class="bp">≤</span> <span class="n">cauchy</span><span class="bp">.</span><span class="n">dist</span> <span class="n">T</span> <span class="n">x</span> <span class="n">z</span> <span class="bp">+</span> <span class="o">(</span><span class="n">cauchy</span><span class="bp">.</span><span class="n">dist</span> <span class="n">T</span> <span class="n">z</span> <span class="n">t</span> <span class="bp">+</span> <span class="n">cauchy</span><span class="bp">.</span><span class="n">dist</span> <span class="n">T</span> <span class="n">t</span> <span class="n">y</span><span class="o">)</span> <span class="o">:</span> <span class="n">add_le_add_left</span> <span class="o">(</span><span class="n">premetric_space</span><span class="bp">.</span><span class="n">triangle</span> <span class="n">z</span> <span class="n">t</span> <span class="n">y</span><span class="o">)</span> <span class="bp">_</span> <span class="c1">--</span>
    <span class="bp">...</span> <span class="bp">=</span> <span class="n">cauchy</span><span class="bp">.</span><span class="n">dist</span> <span class="n">T</span> <span class="n">z</span> <span class="n">t</span> <span class="bp">+</span> <span class="n">cauchy</span><span class="bp">.</span><span class="n">dist</span> <span class="n">T</span> <span class="n">y</span> <span class="n">t</span> <span class="o">:</span> <span class="k">by</span> <span class="n">rw</span> <span class="o">[</span><span class="n">Hxz</span><span class="o">,</span> <span class="n">zero_add</span><span class="o">,</span> <span class="n">premetric_space</span><span class="bp">.</span><span class="n">sym</span> <span class="n">t</span> <span class="n">y</span><span class="o">]</span> <span class="c1">-- the last rewrite don&#39;t work</span>
    <span class="bp">...</span> <span class="bp">=</span> <span class="n">cauchy</span><span class="bp">.</span><span class="n">dist</span> <span class="n">T</span> <span class="n">z</span> <span class="n">t</span> <span class="o">:</span> <span class="k">by</span> <span class="n">rw</span> <span class="n">Hyt</span><span class="o">,</span>
  <span class="k">calc</span>
    <span class="n">cauchy</span><span class="bp">.</span><span class="n">dist</span> <span class="n">T</span> <span class="n">z</span> <span class="n">t</span> <span class="bp">≤</span> <span class="n">cauchy</span><span class="bp">.</span><span class="n">dist</span> <span class="n">T</span> <span class="n">z</span> <span class="n">x</span> <span class="bp">+</span> <span class="n">cauchy</span><span class="bp">.</span><span class="n">dist</span> <span class="n">T</span> <span class="n">x</span> <span class="n">t</span> <span class="o">:</span> <span class="n">premetric_space</span><span class="bp">.</span><span class="n">triangle</span> <span class="n">z</span> <span class="n">x</span> <span class="n">t</span>
    <span class="bp">...</span> <span class="bp">≤</span> <span class="n">cauchy</span><span class="bp">.</span><span class="n">dist</span> <span class="n">T</span> <span class="n">z</span> <span class="n">x</span> <span class="bp">+</span> <span class="o">(</span><span class="n">cauchy</span><span class="bp">.</span><span class="n">dist</span> <span class="n">T</span> <span class="n">x</span> <span class="n">y</span> <span class="bp">+</span> <span class="n">cauchy</span><span class="bp">.</span><span class="n">dist</span> <span class="n">T</span> <span class="n">y</span> <span class="n">t</span><span class="o">)</span> <span class="o">:</span> <span class="n">add_le_add_left</span> <span class="o">(</span><span class="n">premetric_space</span><span class="bp">.</span><span class="n">triangle</span> <span class="n">x</span> <span class="n">y</span> <span class="n">t</span><span class="o">)</span> <span class="bp">_</span>
    <span class="bp">...</span> <span class="bp">=</span> <span class="n">cauchy</span><span class="bp">.</span><span class="n">dist</span> <span class="n">T</span> <span class="n">x</span> <span class="n">z</span> <span class="bp">+</span> <span class="n">cauchy</span><span class="bp">.</span><span class="n">dist</span> <span class="n">T</span> <span class="n">x</span> <span class="n">y</span> <span class="o">:</span> <span class="k">by</span> <span class="n">rw</span> <span class="o">[</span><span class="n">Hyt</span><span class="o">,</span> <span class="n">add_zero</span><span class="o">,</span> <span class="n">premetric_space</span><span class="bp">.</span><span class="n">sym</span> <span class="n">z</span> <span class="n">x</span><span class="o">]</span> <span class="c1">-- the last rewrite don&#39;t work</span>
    <span class="bp">...</span> <span class="bp">=</span> <span class="n">cauchy</span><span class="bp">.</span><span class="n">dist</span> <span class="n">T</span> <span class="n">x</span> <span class="n">y</span> <span class="o">:</span> <span class="k">by</span> <span class="n">rw</span> <span class="n">Hxz</span><span class="o">,</span>
<span class="kn">end</span>

<span class="n">def</span> <span class="n">completion</span><span class="bp">.</span><span class="n">dist</span> <span class="o">(</span><span class="n">T</span><span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">[</span><span class="n">metric_space</span> <span class="n">T</span><span class="o">]</span> <span class="o">(</span><span class="n">x</span> <span class="n">y</span><span class="o">:</span> <span class="n">completion</span> <span class="n">T</span><span class="o">):</span> <span class="n">ℝ</span> <span class="o">:=</span>
  <span class="n">quotient</span><span class="bp">.</span><span class="n">lift₂</span> <span class="o">(</span><span class="n">cauchy</span><span class="bp">.</span><span class="n">dist</span> <span class="n">T</span><span class="o">)</span> <span class="o">(</span><span class="n">completion</span><span class="bp">.</span><span class="n">dist_soundness</span> <span class="n">T</span><span class="o">)</span> <span class="n">x</span> <span class="n">y</span>

<span class="kn">instance</span> <span class="n">completion</span><span class="bp">.</span><span class="n">metric_space</span> <span class="o">(</span><span class="n">X</span><span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">[</span><span class="n">metric_space</span> <span class="n">X</span><span class="o">]:</span> <span class="n">metric_space</span> <span class="o">(</span><span class="n">completion</span> <span class="n">X</span><span class="o">)</span> <span class="o">:=</span>
<span class="o">{</span>
  <span class="n">d</span> <span class="o">:=</span> <span class="n">completion</span><span class="bp">.</span><span class="n">dist</span> <span class="n">X</span><span class="o">,</span>
  <span class="n">d_pos</span> <span class="o">:=</span> <span class="n">sorry</span><span class="o">,</span>
  <span class="c1">-- etc</span>
<span class="o">}</span>

<span class="kn">end</span> <span class="n">test</span>
</code></pre></div>


<p>Here's the expected MWE, it type check and work, but at the place where I've put comments, in my big code, it does not work, it complains about:</p>
<div class="codehilite"><pre><span></span><code><span class="n">rewrite</span> <span class="n">tactic</span> <span class="n">failed</span><span class="o">,</span> <span class="n">did</span> <span class="n">not</span> <span class="n">find</span> <span class="kn">instance</span> <span class="n">of</span> <span class="n">the</span> <span class="n">pattern</span> <span class="k">in</span> <span class="n">the</span> <span class="n">target</span> <span class="n">expression</span>
  <span class="n">premetric_space</span><span class="bp">.</span><span class="n">d</span> <span class="n">t</span> <span class="n">y</span>
<span class="n">state</span><span class="o">:</span>
<span class="n">T</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">,</span>
<span class="bp">_</span><span class="n">inst_4</span> <span class="o">:</span> <span class="n">metric_space</span> <span class="n">T</span><span class="o">,</span>
<span class="n">x</span> <span class="n">y</span> <span class="n">z</span> <span class="n">t</span> <span class="o">:</span> <span class="n">cauchy_seqs</span> <span class="n">T</span><span class="o">,</span>
<span class="n">Hxz</span> <span class="o">:</span> <span class="n">cauchy</span><span class="bp">.</span><span class="n">dist</span> <span class="n">T</span> <span class="n">x</span> <span class="n">z</span> <span class="bp">=</span> <span class="mi">0</span><span class="o">,</span>
<span class="n">Hyt</span> <span class="o">:</span> <span class="n">cauchy</span><span class="bp">.</span><span class="n">dist</span> <span class="n">T</span> <span class="n">y</span> <span class="n">t</span> <span class="bp">=</span> <span class="mi">0</span>
<span class="err">⊢</span> <span class="n">cauchy</span><span class="bp">.</span><span class="n">dist</span> <span class="n">T</span> <span class="n">z</span> <span class="n">t</span> <span class="bp">+</span> <span class="n">cauchy</span><span class="bp">.</span><span class="n">dist</span> <span class="n">T</span> <span class="n">t</span> <span class="n">y</span> <span class="bp">=</span> <span class="n">cauchy</span><span class="bp">.</span><span class="n">dist</span> <span class="n">T</span> <span class="n">z</span> <span class="n">t</span> <span class="bp">+</span> <span class="n">cauchy</span><span class="bp">.</span><span class="n">dist</span> <span class="n">T</span> <span class="n">y</span> <span class="n">t</span>
<span class="n">state</span><span class="o">:</span>
<span class="mi">2</span> <span class="n">goals</span>
<span class="n">T</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">,</span>
<span class="bp">_</span><span class="n">inst_4</span> <span class="o">:</span> <span class="n">metric_space</span> <span class="n">T</span><span class="o">,</span>
<span class="n">x</span> <span class="n">y</span> <span class="n">z</span> <span class="n">t</span> <span class="o">:</span> <span class="n">cauchy_seqs</span> <span class="n">T</span><span class="o">,</span>
<span class="n">Hxz</span> <span class="o">:</span> <span class="n">cauchy</span><span class="bp">.</span><span class="n">dist</span> <span class="n">T</span> <span class="n">x</span> <span class="n">z</span> <span class="bp">=</span> <span class="mi">0</span><span class="o">,</span>
<span class="n">Hyt</span> <span class="o">:</span> <span class="n">cauchy</span><span class="bp">.</span><span class="n">dist</span> <span class="n">T</span> <span class="n">y</span> <span class="n">t</span> <span class="bp">=</span> <span class="mi">0</span>
<span class="err">⊢</span> <span class="n">cauchy</span><span class="bp">.</span><span class="n">dist</span> <span class="n">T</span> <span class="n">x</span> <span class="n">y</span> <span class="bp">≤</span> <span class="n">cauchy</span><span class="bp">.</span><span class="n">dist</span> <span class="n">T</span> <span class="n">z</span> <span class="n">t</span>

<span class="n">T</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">,</span>
<span class="bp">_</span><span class="n">inst_4</span> <span class="o">:</span> <span class="n">metric_space</span> <span class="n">T</span><span class="o">,</span>
<span class="n">x</span> <span class="n">y</span> <span class="n">z</span> <span class="n">t</span> <span class="o">:</span> <span class="n">cauchy_seqs</span> <span class="n">T</span><span class="o">,</span>
<span class="n">Hxz</span> <span class="o">:</span> <span class="n">cauchy</span><span class="bp">.</span><span class="n">dist</span> <span class="n">T</span> <span class="n">x</span> <span class="n">z</span> <span class="bp">=</span> <span class="mi">0</span><span class="o">,</span>
<span class="n">Hyt</span> <span class="o">:</span> <span class="n">cauchy</span><span class="bp">.</span><span class="n">dist</span> <span class="n">T</span> <span class="n">y</span> <span class="n">t</span> <span class="bp">=</span> <span class="mi">0</span>
<span class="err">⊢</span> <span class="n">cauchy</span><span class="bp">.</span><span class="n">dist</span> <span class="n">T</span> <span class="n">z</span> <span class="n">t</span> <span class="bp">≤</span> <span class="n">cauchy</span><span class="bp">.</span><span class="n">dist</span> <span class="n">T</span> <span class="n">x</span> <span class="n">y</span>
</code></pre></div>


<p>I don't know if there's way to tell him: please use my instance on premetric spaces, which has the good definition of <code>d</code> (?)</p>



<a name="197081236"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Quotients%20%26%20synthesizing/near/197081236" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Quotients.20.26.20synthesizing.html#197081236">(May 10 2020 at 21:59)</a>:</h4>
<p>0/10 this is real not complex</p>



<a name="197081431"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Quotients%20%26%20synthesizing/near/197081431" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Quotients.20.26.20synthesizing.html#197081431">(May 10 2020 at 22:04)</a>:</h4>
<p>aha, this is an API issue</p>



<a name="197081508"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Quotients%20%26%20synthesizing/near/197081508" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ryan Lahfa <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Quotients.20.26.20synthesizing.html#197081508">(May 10 2020 at 22:06)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110064">Kenny Lau</span> <a href="#narrow/stream/116395-maths/topic/Quotients.20.26.20synthesizing/near/197081431" title="#narrow/stream/116395-maths/topic/Quotients.20.26.20synthesizing/near/197081431">said</a>:</p>
<blockquote>
<p>aha, this is an API issue</p>
</blockquote>
<p>What do you mean?</p>



<a name="197081509"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Quotients%20%26%20synthesizing/near/197081509" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ryan Lahfa <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Quotients.20.26.20synthesizing.html#197081509">(May 10 2020 at 22:06)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110064">Kenny Lau</span> <a href="#narrow/stream/116395-maths/topic/Quotients.20.26.20synthesizing/near/197081236" title="#narrow/stream/116395-maths/topic/Quotients.20.26.20synthesizing/near/197081236">said</a>:</p>
<blockquote>
<p>0/10 this is real not complex</p>
</blockquote>
<p>:-D</p>



<a name="197081561"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Quotients%20%26%20synthesizing/near/197081561" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Quotients.20.26.20synthesizing.html#197081561">(May 10 2020 at 22:08)</a>:</h4>
<p>MWE:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="n">data</span><span class="bp">.</span><span class="n">real</span><span class="bp">.</span><span class="n">basic</span>
<span class="n">class</span> <span class="n">metric_space</span> <span class="o">(</span><span class="n">X</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">d</span> <span class="o">:</span> <span class="n">X</span> <span class="bp">→</span> <span class="n">X</span> <span class="bp">→</span> <span class="n">ℝ</span><span class="o">)</span>
<span class="n">class</span> <span class="n">premetric_space</span> <span class="o">(</span><span class="n">X</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">d</span> <span class="o">:</span> <span class="n">X</span> <span class="bp">→</span> <span class="n">X</span> <span class="bp">→</span> <span class="n">ℝ</span><span class="o">)</span>
<span class="o">(</span><span class="n">sym</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">x</span> <span class="n">y</span><span class="o">,</span> <span class="n">d</span> <span class="n">x</span> <span class="n">y</span> <span class="bp">=</span> <span class="n">d</span> <span class="n">y</span> <span class="n">x</span><span class="o">)</span>

<span class="n">open_locale</span> <span class="n">classical</span>
<span class="n">noncomputable</span> <span class="n">theory</span>

<span class="kn">section</span> <span class="n">test</span>
<span class="kn">open</span> <span class="n">metric_space</span>
<span class="kn">variables</span> <span class="o">{</span><span class="n">X</span><span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">metric_space</span> <span class="n">X</span><span class="o">]</span>

<span class="n">def</span> <span class="n">is_cauchy</span> <span class="o">(</span><span class="n">x</span><span class="o">:</span> <span class="bp">ℕ</span> <span class="bp">→</span> <span class="n">X</span><span class="o">)</span> <span class="o">:=</span>
  <span class="bp">∀</span> <span class="n">ε</span> <span class="bp">&gt;</span> <span class="mi">0</span><span class="o">,</span> <span class="bp">∃</span> <span class="n">N</span><span class="o">,</span> <span class="bp">∀</span> <span class="n">p</span> <span class="bp">≥</span> <span class="n">N</span><span class="o">,</span> <span class="bp">∀</span> <span class="n">q</span> <span class="bp">≥</span> <span class="n">N</span><span class="o">,</span> <span class="o">((</span><span class="n">d</span> <span class="o">(</span><span class="n">x</span> <span class="n">p</span><span class="o">)</span> <span class="o">(</span><span class="n">x</span> <span class="n">q</span><span class="o">))</span> <span class="bp">&lt;</span> <span class="n">ε</span><span class="o">)</span>

<span class="n">def</span> <span class="n">cauchy_seqs</span> <span class="o">(</span><span class="n">X</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">[</span><span class="n">metric_space</span> <span class="n">X</span><span class="o">]</span> <span class="o">:=</span> <span class="o">{</span> <span class="n">f</span> <span class="o">:</span> <span class="bp">ℕ</span> <span class="bp">→</span> <span class="n">X</span> <span class="bp">//</span> <span class="n">is_cauchy</span> <span class="n">f</span> <span class="o">}</span>

<span class="n">def</span> <span class="n">cauchy</span><span class="bp">.</span><span class="n">dist</span> <span class="o">(</span><span class="n">T</span><span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">[</span><span class="n">metric_space</span> <span class="n">T</span><span class="o">]</span> <span class="o">(</span><span class="n">x</span> <span class="n">y</span><span class="o">:</span> <span class="n">cauchy_seqs</span> <span class="n">T</span><span class="o">)</span> <span class="o">:</span> <span class="n">ℝ</span> <span class="o">:=</span> <span class="n">sorry</span>

<span class="kn">instance</span> <span class="n">pre_ecart</span><span class="bp">.</span><span class="n">premetrique</span> <span class="o">(</span><span class="n">X</span><span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">[</span><span class="n">metric_space</span> <span class="n">X</span><span class="o">]:</span> <span class="n">premetric_space</span> <span class="o">(</span><span class="n">cauchy_seqs</span> <span class="n">X</span><span class="o">)</span> <span class="o">:=</span>
<span class="o">{</span> <span class="n">d</span> <span class="o">:=</span> <span class="n">cauchy</span><span class="bp">.</span><span class="n">dist</span> <span class="n">X</span><span class="o">,</span>
  <span class="n">sym</span> <span class="o">:=</span> <span class="n">sorry</span> <span class="o">}</span>

<span class="kn">example</span> <span class="o">(</span><span class="n">T</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">[</span><span class="n">metric_space</span> <span class="n">T</span><span class="o">]</span> <span class="o">(</span><span class="n">x</span> <span class="n">y</span> <span class="o">:</span> <span class="n">cauchy_seqs</span> <span class="n">T</span><span class="o">)</span> <span class="o">:</span>
  <span class="n">cauchy</span><span class="bp">.</span><span class="n">dist</span> <span class="n">T</span> <span class="n">x</span> <span class="n">y</span> <span class="bp">=</span> <span class="n">cauchy</span><span class="bp">.</span><span class="n">dist</span> <span class="n">T</span> <span class="n">y</span> <span class="n">x</span> <span class="o">:=</span>
<span class="k">by</span> <span class="n">rw</span> <span class="n">premetric_space</span><span class="bp">.</span><span class="n">sym</span> <span class="n">x</span> <span class="n">y</span> <span class="c1">-- fails</span>

<span class="kn">end</span> <span class="n">test</span>
</code></pre></div>



<a name="197081567"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Quotients%20%26%20synthesizing/near/197081567" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Quotients.20.26.20synthesizing.html#197081567">(May 10 2020 at 22:08)</a>:</h4>
<p>so there are two solutions</p>



<a name="197081578"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Quotients%20%26%20synthesizing/near/197081578" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ryan Lahfa <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Quotients.20.26.20synthesizing.html#197081578">(May 10 2020 at 22:09)</a>:</h4>
<p>I listen carefully</p>



<a name="197081582"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Quotients%20%26%20synthesizing/near/197081582" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Quotients.20.26.20synthesizing.html#197081582">(May 10 2020 at 22:09)</a>:</h4>
<ol>
<li>use <code>premetric_space.d x y</code> instead of <code>cauchy.dist T x y</code></li>
</ol>



<a name="197081631"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Quotients%20%26%20synthesizing/near/197081631" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Quotients.20.26.20synthesizing.html#197081631">(May 10 2020 at 22:10)</a>:</h4>
<ol start="2">
<li>prove <code>cauchy.dist T x y = cauchy.dist T y x</code> immediately after declaring the instance</li>
</ol>



<a name="197081634"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Quotients%20%26%20synthesizing/near/197081634" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Quotients.20.26.20synthesizing.html#197081634">(May 10 2020 at 22:10)</a>:</h4>
<p>(the proof is just <code>premetric_space.sym</code> this time)</p>



<a name="197081637"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Quotients%20%26%20synthesizing/near/197081637" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ryan Lahfa <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Quotients.20.26.20synthesizing.html#197081637">(May 10 2020 at 22:10)</a>:</h4>
<p>can I even do that because premetric_space depends on some  metricspace?</p>



<a name="197081642"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Quotients%20%26%20synthesizing/near/197081642" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Quotients.20.26.20synthesizing.html#197081642">(May 10 2020 at 22:10)</a>:</h4>
<p>Lean will infer it</p>



<a name="197081726"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Quotients%20%26%20synthesizing/near/197081726" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ryan Lahfa <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Quotients.20.26.20synthesizing.html#197081726">(May 10 2020 at 22:12)</a>:</h4>
<p>Okay, will try 1, then will fallback to 2, <span class="user-mention" data-user-id="110064">@Kenny Lau</span> thanks a lot.<br>
A more abstract question, if we take back my MWE:</p>
<div class="codehilite"><pre><span></span><code><span class="n">def</span> <span class="n">completion</span><span class="bp">.</span><span class="n">dist</span> <span class="o">(</span><span class="n">T</span><span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">[</span><span class="n">metric_space</span> <span class="n">T</span><span class="o">]</span> <span class="o">(</span><span class="n">x</span> <span class="n">y</span><span class="o">:</span> <span class="n">completion</span> <span class="n">T</span><span class="o">):</span> <span class="n">ℝ</span> <span class="o">:=</span>
  <span class="n">quotient</span><span class="bp">.</span><span class="n">lift₂</span> <span class="o">(</span><span class="n">cauchy</span><span class="bp">.</span><span class="n">dist</span> <span class="n">T</span><span class="o">)</span> <span class="o">(</span><span class="n">completion</span><span class="bp">.</span><span class="n">dist_soundness</span> <span class="n">T</span><span class="o">)</span> <span class="n">x</span> <span class="n">y</span>
</code></pre></div>


<p>Precisely this, when I have some assumption: <code>completion.dist T x y = 0</code>, how can I turn it into something more usable?<br>
What I've done is turn back x y into <code>[[X], [[Y]]</code> (using exists_rep, sound) and then, can I somehow say that I have <code>cauchy.dist T X Y = 0</code> ?</p>



<a name="197081728"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Quotients%20%26%20synthesizing/near/197081728" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Quotients.20.26.20synthesizing.html#197081728">(May 10 2020 at 22:12)</a>:</h4>
<p><span class="user-mention" data-user-id="110049">@Mario Carneiro</span> is 1 or 2 better?</p>



<a name="197081807"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Quotients%20%26%20synthesizing/near/197081807" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ryan Lahfa <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Quotients.20.26.20synthesizing.html#197081807">(May 10 2020 at 22:14)</a>:</h4>
<p>1 worked fine</p>



<a name="197081820"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Quotients%20%26%20synthesizing/near/197081820" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Quotients.20.26.20synthesizing.html#197081820">(May 10 2020 at 22:15)</a>:</h4>
<p>doesn't mean it's better</p>



<a name="197081821"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Quotients%20%26%20synthesizing/near/197081821" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Quotients.20.26.20synthesizing.html#197081821">(May 10 2020 at 22:15)</a>:</h4>
<div class="codehilite"><pre><span></span><code><span class="kn">instance</span> <span class="n">completion</span><span class="bp">.</span><span class="n">metric_space</span> <span class="o">(</span><span class="n">X</span><span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">[</span><span class="n">metric_space</span> <span class="n">X</span><span class="o">]:</span> <span class="n">metric_space</span> <span class="o">(</span><span class="n">completion</span> <span class="n">X</span><span class="o">)</span> <span class="o">:=</span>
<span class="o">{</span>
  <span class="n">d</span> <span class="o">:=</span> <span class="n">completion</span><span class="bp">.</span><span class="n">dist</span> <span class="n">X</span><span class="o">,</span>
  <span class="n">d_pos</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">x</span> <span class="n">y</span><span class="o">,</span> <span class="n">quotient</span><span class="bp">.</span><span class="n">induction_on₂</span> <span class="n">x</span> <span class="n">y</span> <span class="err">$</span> <span class="bp">λ</span> <span class="n">Y</span> <span class="n">Z</span><span class="o">,</span> <span class="k">show</span> <span class="n">cauchy</span><span class="bp">.</span><span class="n">dist</span> <span class="n">X</span> <span class="n">Y</span> <span class="n">Z</span> <span class="bp">≥</span> <span class="mi">0</span><span class="o">,</span> <span class="k">from</span> <span class="n">sorry</span><span class="o">,</span>
  <span class="c1">-- etc</span>
<span class="o">}</span>
</code></pre></div>



<a name="197081824"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Quotients%20%26%20synthesizing/near/197081824" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Quotients.20.26.20synthesizing.html#197081824">(May 10 2020 at 22:15)</a>:</h4>
<p>use <code>induction_on</code> instead of <code>exists_rep</code></p>



<a name="197081828"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Quotients%20%26%20synthesizing/near/197081828" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ryan Lahfa <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Quotients.20.26.20synthesizing.html#197081828">(May 10 2020 at 22:15)</a>:</h4>
<p>Thanks a lot</p>



<a name="197081897"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Quotients%20%26%20synthesizing/near/197081897" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Quotients.20.26.20synthesizing.html#197081897">(May 10 2020 at 22:16)</a>:</h4>
<p>Doesn't mathlib use <code>dist</code> for this?</p>



<a name="197081910"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Quotients%20%26%20synthesizing/near/197081910" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Quotients.20.26.20synthesizing.html#197081910">(May 10 2020 at 22:17)</a>:</h4>
<p>There is a definition <code>dist</code> which just unwraps <code>metric_space.dist</code>, and rather than <code>cauchy.dist</code> or <code>premetric_space.d</code> you should be using <code>dist</code></p>



<a name="197081927"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Quotients%20%26%20synthesizing/near/197081927" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Quotients.20.26.20synthesizing.html#197081927">(May 10 2020 at 22:17)</a>:</h4>
<p>aha, the third solution</p>



<a name="197081929"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Quotients%20%26%20synthesizing/near/197081929" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ryan Lahfa <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Quotients.20.26.20synthesizing.html#197081929">(May 10 2020 at 22:17)</a>:</h4>
<p><span class="user-mention" data-user-id="110049">@Mario Carneiro</span> I'm rebuilding this as an exercise, so I'm not sure what you're suggesting is not just reusing mathlib, which I cannot</p>



<a name="197081985"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Quotients%20%26%20synthesizing/near/197081985" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Quotients.20.26.20synthesizing.html#197081985">(May 10 2020 at 22:18)</a>:</h4>
<p>That's fine, then just rebuild <code>dist</code> too</p>



<a name="197081994"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Quotients%20%26%20synthesizing/near/197081994" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ryan Lahfa <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Quotients.20.26.20synthesizing.html#197081994">(May 10 2020 at 22:18)</a>:</h4>
<p>Is there some file or pointer where to look?</p>



<a name="197082082"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Quotients%20%26%20synthesizing/near/197082082" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Quotients.20.26.20synthesizing.html#197082082">(May 10 2020 at 22:19)</a>:</h4>
<p><a href="https://github.com/leanprover-community/mathlib/blob/master/src/topology/metric_space/premetric_space.lean" title="https://github.com/leanprover-community/mathlib/blob/master/src/topology/metric_space/premetric_space.lean">https://github.com/leanprover-community/mathlib/blob/master/src/topology/metric_space/premetric_space.lean</a></p>



<a name="197082148"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Quotients%20%26%20synthesizing/near/197082148" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Quotients.20.26.20synthesizing.html#197082148">(May 10 2020 at 22:20)</a>:</h4>
<p>It looks like <code>has_dist</code> has been broken off as its own typeclass</p>



<a name="197082157"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Quotients%20%26%20synthesizing/near/197082157" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Quotients.20.26.20synthesizing.html#197082157">(May 10 2020 at 22:20)</a>:</h4>
<p><a href="https://github.com/leanprover-community/mathlib/blob/master/src/topology/metric_space/basic.lean#L46" title="https://github.com/leanprover-community/mathlib/blob/master/src/topology/metric_space/basic.lean#L46">https://github.com/leanprover-community/mathlib/blob/master/src/topology/metric_space/basic.lean#L46</a></p>



<a name="197082163"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Quotients%20%26%20synthesizing/near/197082163" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ryan Lahfa <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Quotients.20.26.20synthesizing.html#197082163">(May 10 2020 at 22:21)</a>:</h4>
<p>Okay, so  <code>has_XXX</code> technique, thanks</p>



<a name="197082243"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Quotients%20%26%20synthesizing/near/197082243" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ryan Lahfa <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Quotients.20.26.20synthesizing.html#197082243">(May 10 2020 at 22:22)</a>:</h4>
<p><span class="user-mention" data-user-id="110064">@Kenny Lau</span> I just didn't understand something on induction_on2</p>



<a name="197082271"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Quotients%20%26%20synthesizing/near/197082271" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ryan Lahfa <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Quotients.20.26.20synthesizing.html#197082271">(May 10 2020 at 22:23)</a>:</h4>
<p>When you pass the hypothesis: for all x, y: cauchy_seqs, I can prove cauchy.dist X Y Z ≥ 0, why does it "coerce" to completion.dist ?</p>



<a name="197082289"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Quotients%20%26%20synthesizing/near/197082289" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ryan Lahfa <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Quotients.20.26.20synthesizing.html#197082289">(May 10 2020 at 22:23)</a>:</h4>
<p>i mean like, does cauchy.dist X Y Z ≥ 0 → completion.dist X [Y] [Z] ≥ 0 automatically?</p>



<a name="197082489"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Quotients%20%26%20synthesizing/near/197082489" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Quotients.20.26.20synthesizing.html#197082489">(May 10 2020 at 22:26)</a>:</h4>
<p><code>completion.dist X [Y] [Z]</code> is defeq to <code>cauchy.dist X Y Z</code></p>



<a name="197082493"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Quotients%20%26%20synthesizing/near/197082493" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Quotients.20.26.20synthesizing.html#197082493">(May 10 2020 at 22:26)</a>:</h4>
<p>because of definitional equalities involving <code>quotient.lift</code></p>



<a name="197082505"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Quotients%20%26%20synthesizing/near/197082505" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ryan Lahfa <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Quotients.20.26.20synthesizing.html#197082505">(May 10 2020 at 22:27)</a>:</h4>
<p>okay, nice it makes it super clear, last question, <span class="user-mention" data-user-id="110064">@Kenny Lau</span> how can I prove <code>X \~~  Y</code> or <code>[X] = [Y]</code> knowing that I can prove that <code>cauchy.dist X Y = 0</code> (which is exactly the def of the relation)?</p>



<a name="197082533"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Quotients%20%26%20synthesizing/near/197082533" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Quotients.20.26.20synthesizing.html#197082533">(May 10 2020 at 22:27)</a>:</h4>
<p><code>quotient.sound</code></p>



<a name="197082534"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Quotients%20%26%20synthesizing/near/197082534" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ryan Lahfa <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Quotients.20.26.20synthesizing.html#197082534">(May 10 2020 at 22:27)</a>:</h4>
<p>well<br>
cauchy.dist X Y = 0 is defeq X ~~Y I guess</p>



<a name="197082585"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Quotients%20%26%20synthesizing/near/197082585" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ryan Lahfa <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Quotients.20.26.20synthesizing.html#197082585">(May 10 2020 at 22:28)</a>:</h4>
<p>yes, I used quot.sound and some hypothesis and it just worked ™, thx a lot</p>



<a name="197082823"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Quotients%20%26%20synthesizing/near/197082823" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ryan Lahfa <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Quotients.20.26.20synthesizing.html#197082823">(May 10 2020 at 22:32)</a>:</h4>
<p><span class="user-mention" data-user-id="110064">@Kenny Lau</span> is there a induction_on3 ? :D</p>



<a name="197082826"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Quotients%20%26%20synthesizing/near/197082826" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ryan Lahfa <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Quotients.20.26.20synthesizing.html#197082826">(May 10 2020 at 22:32)</a>:</h4>
<p>Oh there is !</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>