---
layout: archive
title: Zulip Chat Archive
permalink: /stream/116395-maths/topic/has_sum_nat_add_iff.20for.20add_monoid.3F.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/116395-maths/index.html">maths</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/has_sum_nat_add_iff.20for.20add_monoid.3F.html">has_sum_nat_add_iff for add_monoid?</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="222447272"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/has_sum_nat_add_iff%20for%20add_monoid%3F/near/222447272" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/has_sum_nat_add_iff.20for.20add_monoid.3F.html#222447272">(Jan 12 2021 at 15:32)</a>:</h4>
<p>If would like to apply the following lemma to <code>nnreal</code>, but it's proven only for topological additive groups.</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">lemma</span> <span class="n">has_sum_nat_add_iff</span> <span class="o">{</span><span class="n">f</span> <span class="o">:</span> <span class="n">ℕ</span> <span class="bp">→</span> <span class="n">α</span><span class="o">}</span> <span class="o">(</span><span class="n">k</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="o">{</span><span class="n">a</span> <span class="o">:</span> <span class="n">α</span><span class="o">}</span> <span class="o">:</span>
  <span class="n">has_sum</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">n</span><span class="o">,</span> <span class="n">f</span> <span class="o">(</span><span class="n">n</span> <span class="bp">+</span> <span class="n">k</span><span class="o">))</span> <span class="n">a</span> <span class="bp">↔</span> <span class="n">has_sum</span> <span class="n">f</span> <span class="o">(</span><span class="n">a</span> <span class="bp">+</span> <span class="bp">∑</span> <span class="n">i</span> <span class="k">in</span> <span class="n">range</span> <span class="n">k</span><span class="o">,</span> <span class="n">f</span> <span class="n">i</span><span class="o">)</span> <span class="o">:=</span>
</code></pre></div>
<p>I'm not really good at manipulating <code>has_sum</code>. Can someone tell me how to prove this for add_monoids?</p>



<a name="222452384"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/has_sum_nat_add_iff%20for%20add_monoid%3F/near/222452384" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/has_sum_nat_add_iff.20for.20add_monoid.3F.html#222452384">(Jan 12 2021 at 16:04)</a>:</h4>
<p>MWE?</p>



<a name="222453622"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/has_sum_nat_add_iff%20for%20add_monoid%3F/near/222453622" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/has_sum_nat_add_iff.20for.20add_monoid.3F.html#222453622">(Jan 12 2021 at 16:12)</a>:</h4>
<p>I haven't done it but here's the MWE. The proof in mathlib does only work for groups :-/</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">tactic</span>
<span class="kn">import</span> <span class="n">topology.algebra.infinite_sum</span>

<span class="n">open_locale</span> <span class="n">big_operators</span>

<span class="kd">variables</span> <span class="o">(</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">[</span><span class="n">topological_space</span> <span class="n">α</span><span class="o">]</span> <span class="o">[</span><span class="n">add_comm_monoid</span> <span class="n">α</span><span class="o">]</span>

<span class="kn">open</span> <span class="n">finset</span>

<span class="kd">lemma</span> <span class="n">has_sum_nat_add_iff''</span> <span class="o">{</span><span class="n">f</span> <span class="o">:</span> <span class="n">ℕ</span> <span class="bp">→</span> <span class="n">α</span><span class="o">}</span> <span class="o">(</span><span class="n">k</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="o">{</span><span class="n">a</span> <span class="o">:</span> <span class="n">α</span><span class="o">}</span> <span class="o">:</span>
  <span class="n">has_sum</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">n</span><span class="o">,</span> <span class="n">f</span> <span class="o">(</span><span class="n">n</span> <span class="bp">+</span> <span class="n">k</span><span class="o">))</span> <span class="n">a</span> <span class="bp">↔</span> <span class="n">has_sum</span> <span class="n">f</span> <span class="o">(</span><span class="n">a</span> <span class="bp">+</span> <span class="bp">∑</span> <span class="n">i</span> <span class="k">in</span> <span class="n">range</span> <span class="n">k</span><span class="o">,</span> <span class="n">f</span> <span class="n">i</span><span class="o">)</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="gr">sorry</span>
<span class="kd">end</span>
</code></pre></div>



<a name="222455640"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/has_sum_nat_add_iff%20for%20add_monoid%3F/near/222455640" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/has_sum_nat_add_iff.20for.20add_monoid.3F.html#222455640">(Jan 12 2021 at 16:24)</a>:</h4>
<p>Oh! <span class="user-mention" data-user-id="260507">@Heather Macbeth</span> this was the example I mentioned to you the other day! The extraordinary file <code>topology.algebra.infinite_sum</code> assumes that alpha is an add_comm_monoid and a topological_space, and for the first 214 lines it does not assume that there is any relation between these two structures. Continuity of addition appears on line 214. It's quite surprising what they prove without this assumption!</p>



<a name="222455957"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/has_sum_nat_add_iff%20for%20add_monoid%3F/near/222455957" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/has_sum_nat_add_iff.20for.20add_monoid.3F.html#222455957">(Jan 12 2021 at 16:26)</a>:</h4>
<p>There will be more -- <span class="user-mention" data-user-id="127136">@Alex J. Best</span> gave me a preview of his linter's effect on <code>topology.algebra.ordered</code>, and it was quite drastic :)</p>



<a name="222456512"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/has_sum_nat_add_iff%20for%20add_monoid%3F/near/222456512" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/has_sum_nat_add_iff.20for.20add_monoid.3F.html#222456512">(Jan 12 2021 at 16:29)</a>:</h4>
<p>Johan, I suspect the lemma is not true for general add_comm_monoids. If a monoid has some saturating element then a + sum can lose information.</p>



<a name="222456849"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/has_sum_nat_add_iff%20for%20add_monoid%3F/near/222456849" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastien Gouezel <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/has_sum_nat_add_iff.20for.20add_monoid.3F.html#222456849">(Jan 12 2021 at 16:31)</a>:</h4>
<p>But it will definitely be true for <code>nnreal</code>.</p>



<a name="222456920"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/has_sum_nat_add_iff%20for%20add_monoid%3F/near/222456920" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/has_sum_nat_add_iff.20for.20add_monoid.3F.html#222456920">(Jan 12 2021 at 16:32)</a>:</h4>
<p>It's easier to think of in terms of products, with the target a monoid with zero. If we have an infinite set S and a finite set F, then the product over S union F is the product of the product over S and the product over F, but if you know that the product over S union F is zero then you don't know which one caused it.</p>



<a name="222457083"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/has_sum_nat_add_iff%20for%20add_monoid%3F/near/222457083" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/has_sum_nat_add_iff.20for.20add_monoid.3F.html#222457083">(Jan 12 2021 at 16:33)</a>:</h4>
<p>I think it's true in general</p>



<a name="222457146"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/has_sum_nat_add_iff%20for%20add_monoid%3F/near/222457146" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/has_sum_nat_add_iff.20for.20add_monoid.3F.html#222457146">(Jan 12 2021 at 16:34)</a>:</h4>
<p>If you really need both directions then you'll need some extra assumption saying things cancel (which as Sebastien says is fine for nnreal); or do you only need the true way?</p>



<a name="222457244"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/has_sum_nat_add_iff%20for%20add_monoid%3F/near/222457244" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/has_sum_nat_add_iff.20for.20add_monoid.3F.html#222457244">(Jan 12 2021 at 16:34)</a>:</h4>
<p>You can always assume WLOG that the sum contains any chosen finite set of summands because that's how the filter works, so you can assume in this case that you are only dealing with partial sums that contain <code>range k</code></p>



<a name="222457490"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/has_sum_nat_add_iff%20for%20add_monoid%3F/near/222457490" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/has_sum_nat_add_iff.20for.20add_monoid.3F.html#222457490">(Jan 12 2021 at 16:36)</a>:</h4>
<p>Mario, a counterexample for <code>&lt;-</code> in the product version with target the reals (a topological monoid under multiplication) would be if f(0)=0 and k=1. Then RHS is true for any a because <code>0*a1*a2*a3*...</code> is always 0 whatever the product of the a_i converges to.</p>



<a name="222457650"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/has_sum_nat_add_iff%20for%20add_monoid%3F/near/222457650" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/has_sum_nat_add_iff.20for.20add_monoid.3F.html#222457650">(Jan 12 2021 at 16:37)</a>:</h4>
<p>Ah, I see, we're cancelling in the <code>&lt;-</code> direction</p>



<a name="222457929"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/has_sum_nat_add_iff%20for%20add_monoid%3F/near/222457929" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/has_sum_nat_add_iff.20for.20add_monoid.3F.html#222457929">(Jan 12 2021 at 16:39)</a>:</h4>
<p>But if the goal is just <code>nnreal</code> we can just add <code>add_right_cancel</code> as a hypothesis</p>



<a name="222458048"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/has_sum_nat_add_iff%20for%20add_monoid%3F/near/222458048" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/has_sum_nat_add_iff.20for.20add_monoid.3F.html#222458048">(Jan 12 2021 at 16:40)</a>:</h4>
<p>or use <code>add_left_cancel_monoid</code> or whatever it is called if it is a mixin</p>



<a name="222458158"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/has_sum_nat_add_iff%20for%20add_monoid%3F/near/222458158" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/has_sum_nat_add_iff.20for.20add_monoid.3F.html#222458158">(Jan 12 2021 at 16:41)</a>:</h4>
<p>Looks like <code>add_cancel_comm_monoid</code> is a thing (I think everything has to be commutative)</p>



<a name="222458311"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/has_sum_nat_add_iff%20for%20add_monoid%3F/near/222458311" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/has_sum_nat_add_iff.20for.20add_monoid.3F.html#222458311">(Jan 12 2021 at 16:42)</a>:</h4>
<p>We probably assume it but it's not strictly necessary for <code>tsum</code> stuff</p>



<a name="222458339"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/has_sum_nat_add_iff%20for%20add_monoid%3F/near/222458339" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/has_sum_nat_add_iff.20for.20add_monoid.3F.html#222458339">(Jan 12 2021 at 16:42)</a>:</h4>
<p>you only need things to be "eventually commutative"</p>



<a name="222458356"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/has_sum_nat_add_iff%20for%20add_monoid%3F/near/222458356" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/has_sum_nat_add_iff.20for.20add_monoid.3F.html#222458356">(Jan 12 2021 at 16:42)</a>:</h4>
<p><del>My guess is that this is provable</del>:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">tactic</span>
<span class="kn">import</span> <span class="n">topology.algebra.infinite_sum</span>

<span class="n">open_locale</span> <span class="n">big_operators</span>

<span class="kd">variables</span> <span class="o">(</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">[</span><span class="n">topological_space</span> <span class="n">α</span><span class="o">]</span> <span class="o">[</span><span class="n">add_cancel_comm_monoid</span> <span class="n">α</span><span class="o">]</span> <span class="o">[</span><span class="n">has_continuous_add</span> <span class="n">α</span><span class="o">]</span>

<span class="kn">open</span> <span class="n">finset</span>

<span class="kd">lemma</span> <span class="n">has_sum_nat_add_iff''</span> <span class="o">{</span><span class="n">f</span> <span class="o">:</span> <span class="n">ℕ</span> <span class="bp">→</span> <span class="n">α</span><span class="o">}</span> <span class="o">(</span><span class="n">k</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="o">{</span><span class="n">a</span> <span class="o">:</span> <span class="n">α</span><span class="o">}</span> <span class="o">:</span>
  <span class="n">has_sum</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">n</span><span class="o">,</span> <span class="n">f</span> <span class="o">(</span><span class="n">n</span> <span class="bp">+</span> <span class="n">k</span><span class="o">))</span> <span class="n">a</span> <span class="bp">↔</span> <span class="n">has_sum</span> <span class="n">f</span> <span class="o">(</span><span class="n">a</span> <span class="bp">+</span> <span class="bp">∑</span> <span class="n">i</span> <span class="k">in</span> <span class="n">range</span> <span class="n">k</span><span class="o">,</span> <span class="n">f</span> <span class="n">i</span><span class="o">)</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="gr">sorry</span>
<span class="kd">end</span>
</code></pre></div>
<p>Edit: it is not!</p>



<a name="222458476"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/has_sum_nat_add_iff%20for%20add_monoid%3F/near/222458476" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/has_sum_nat_add_iff.20for.20add_monoid.3F.html#222458476">(Jan 12 2021 at 16:43)</a>:</h4>
<p>If I were doing this in class I would just say "because alpha is cancellative we can just work in its group of fractions and now we're obviously done"</p>



<a name="222459159"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/has_sum_nat_add_iff%20for%20add_monoid%3F/near/222459159" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/has_sum_nat_add_iff.20for.20add_monoid.3F.html#222459159">(Jan 12 2021 at 16:47)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">example</span> <span class="o">:</span> <span class="n">add_cancel_comm_monoid</span> <span class="n">nnreal</span> <span class="o">:=</span> <span class="kd">by</span> <span class="n">apply_instance</span> <span class="c1">-- fails :-(</span>
</code></pre></div>



<a name="222459911"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/has_sum_nat_add_iff%20for%20add_monoid%3F/near/222459911" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/has_sum_nat_add_iff.20for.20add_monoid.3F.html#222459911">(Jan 12 2021 at 16:51)</a>:</h4>
<p>got it:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">noncomputable</span> <span class="kd">example</span> <span class="o">:</span> <span class="n">add_left_cancel_monoid</span> <span class="n">nnreal</span> <span class="o">:=</span> <span class="kd">by</span> <span class="n">apply_instance</span> <span class="c1">-- works :-)</span>
<span class="kd">noncomputable</span> <span class="kd">example</span> <span class="o">:</span> <span class="n">add_right_cancel_monoid</span> <span class="n">nnreal</span> <span class="o">:=</span> <span class="kd">by</span> <span class="n">apply_instance</span> <span class="c1">-- fails :-)</span>
</code></pre></div>



<a name="222461012"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/has_sum_nat_add_iff%20for%20add_monoid%3F/near/222461012" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/has_sum_nat_add_iff.20for.20add_monoid.3F.html#222461012">(Jan 12 2021 at 16:57)</a>:</h4>
<p>Oh, some new theorems pop up when you try the obvious thing. Is it true that if <code>f + g ~&gt; a + b</code> and <code>f ~&gt; a</code> then <code>g ~&gt; b</code> (in a cancellative topological monoid)?</p>



<a name="222461035"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/has_sum_nat_add_iff%20for%20add_monoid%3F/near/222461035" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/has_sum_nat_add_iff.20for.20add_monoid.3F.html#222461035">(Jan 12 2021 at 16:57)</a>:</h4>
<p>Oh surely.</p>



<a name="222461058"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/has_sum_nat_add_iff%20for%20add_monoid%3F/near/222461058" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/has_sum_nat_add_iff.20for.20add_monoid.3F.html#222461058">(Jan 12 2021 at 16:57)</a>:</h4>
<p>wait stop</p>



<a name="222461075"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/has_sum_nat_add_iff%20for%20add_monoid%3F/near/222461075" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/has_sum_nat_add_iff.20for.20add_monoid.3F.html#222461075">(Jan 12 2021 at 16:57)</a>:</h4>
<p>I suspect you need some condition that plays a role analogous to "negation is continuous" in a group</p>



<a name="222461094"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/has_sum_nat_add_iff%20for%20add_monoid%3F/near/222461094" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/has_sum_nat_add_iff.20for.20add_monoid.3F.html#222461094">(Jan 12 2021 at 16:57)</a>:</h4>
<p>Yeah!</p>



<a name="222461103"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/has_sum_nat_add_iff%20for%20add_monoid%3F/near/222461103" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/has_sum_nat_add_iff.20for.20add_monoid.3F.html#222461103">(Jan 12 2021 at 16:57)</a>:</h4>
<p>like addition is an open map or something</p>



<a name="222461177"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/has_sum_nat_add_iff%20for%20add_monoid%3F/near/222461177" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/has_sum_nat_add_iff.20for.20add_monoid.3F.html#222461177">(Jan 12 2021 at 16:58)</a>:</h4>
<p>Yeah I am now less sure that my example is provable!</p>



<a name="222461227"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/has_sum_nat_add_iff%20for%20add_monoid%3F/near/222461227" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/has_sum_nat_add_iff.20for.20add_monoid.3F.html#222461227">(Jan 12 2021 at 16:58)</a>:</h4>
<p>For nnreal it's fine, but could one imagine a cancellative additive monoid where inverse is not continuous?</p>



<a name="222461346"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/has_sum_nat_add_iff%20for%20add_monoid%3F/near/222461346" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/has_sum_nat_add_iff.20for.20add_monoid.3F.html#222461346">(Jan 12 2021 at 16:59)</a>:</h4>
<p>Just to prove I'm not shirking, here's the fun I'm having:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">data.real.nnreal</span>

<span class="c">/-</span><span class="cm"></span>
<span class="cm">@[protect_proj, ancestor add_right_cancel_semigroup add_monoid]</span>
<span class="cm">class add_right_cancel_monoid (M : Type u) extends add_right_cancel_semigroup M, add_monoid M</span>
<span class="cm">-/</span>

<span class="kd">noncomputable</span> <span class="kd">example</span> <span class="o">:</span> <span class="n">add_right_cancel_semigroup</span> <span class="n">nnreal</span> <span class="o">:=</span> <span class="kd">by</span> <span class="n">apply_instance</span>
<span class="kd">noncomputable</span> <span class="kd">example</span> <span class="o">:</span> <span class="n">add_monoid</span> <span class="n">nnreal</span> <span class="o">:=</span> <span class="kd">by</span> <span class="n">apply_instance</span>
<span class="kd">noncomputable</span> <span class="kd">example</span> <span class="o">:</span> <span class="n">add_right_cancel_monoid</span> <span class="n">nnreal</span> <span class="o">:=</span> <span class="kd">by</span> <span class="n">apply_instance</span> <span class="c1">-- fails</span>
</code></pre></div>



<a name="222461355"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/has_sum_nat_add_iff%20for%20add_monoid%3F/near/222461355" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/has_sum_nat_add_iff.20for.20add_monoid.3F.html#222461355">(Jan 12 2021 at 16:59)</a>:</h4>
<p>Seems like the same kind of thing as noncomputable inverses</p>



<a name="222461627"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/has_sum_nat_add_iff%20for%20add_monoid%3F/near/222461627" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/has_sum_nat_add_iff.20for.20add_monoid.3F.html#222461627">(Jan 12 2021 at 17:00)</a>:</h4>
<p>BTW re: your example, you don't get a class just because you have all the superclasses</p>



<a name="222461640"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/has_sum_nat_add_iff%20for%20add_monoid%3F/near/222461640" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/has_sum_nat_add_iff.20for.20add_monoid.3F.html#222461640">(Jan 12 2021 at 17:01)</a>:</h4>
<p>All we need is a topological space with a group structure such that multiplication is continuous and inverse isn't, and I know examples of these but they're quite pathological.</p>



<a name="222461674"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/has_sum_nat_add_iff%20for%20add_monoid%3F/near/222461674" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/has_sum_nat_add_iff.20for.20add_monoid.3F.html#222461674">(Jan 12 2021 at 17:01)</a>:</h4>
<p>you have to explicitly implement it, even if there are no fields</p>



<a name="222462053"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/has_sum_nat_add_iff%20for%20add_monoid%3F/near/222462053" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/has_sum_nat_add_iff.20for.20add_monoid.3F.html#222462053">(Jan 12 2021 at 17:03)</a>:</h4>
<p>OK I'll handle that. I suspect this example isn't going to help you but the adeles are the following topological subring of the product of the real numbers and the product over all p of the p-adic numbers: at all but finitely many of the p-adic places, the element must be an integer. This is a topological ring, and its units with the (bad) subspace topology are a topological monoid which is not a topological group because inverse is not continuous with the subspace topology.</p>



<a name="222462119"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/has_sum_nat_add_iff%20for%20add_monoid%3F/near/222462119" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/has_sum_nat_add_iff.20for.20add_monoid.3F.html#222462119">(Jan 12 2021 at 17:03)</a>:</h4>
<p>I like that my maths proof had this bug in :D</p>



<a name="222462210"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/has_sum_nat_add_iff%20for%20add_monoid%3F/near/222462210" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/has_sum_nat_add_iff.20for.20add_monoid.3F.html#222462210">(Jan 12 2021 at 17:04)</a>:</h4>
<p>I swear I could have delivered that line well enough to get it past anyone.</p>



<a name="222462427"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/has_sum_nat_add_iff%20for%20add_monoid%3F/near/222462427" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/has_sum_nat_add_iff.20for.20add_monoid.3F.html#222462427">(Jan 12 2021 at 17:05)</a>:</h4>
<p>I will stop worrying about instances and try to find a counterexample.</p>



<a name="222463450"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/has_sum_nat_add_iff%20for%20add_monoid%3F/near/222463450" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/has_sum_nat_add_iff.20for.20add_monoid.3F.html#222463450">(Jan 12 2021 at 17:11)</a>:</h4>
<p>OK so here's a pretty concrete example of negation not being continuous (translated down from my adelic example): if you give the integers the topology with basis <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">[</mo><mi>n</mi><mo separator="true">,</mo><mi mathvariant="normal">∞</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">[n,\infty)</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord mathnormal">n</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">∞</span><span class="mclose">)</span></span></span></span> for <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mo>∈</mo><mi mathvariant="double-struck">Z</mi></mrow><annotation encoding="application/x-tex">n\in\mathbb{Z}</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.68889em;vertical-align:0em;"></span><span class="mord"><span class="mord mathbb">Z</span></span></span></span></span> then it seems to me that addition is continuous, because the pre-image of <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">[</mo><mi>n</mi><mo separator="true">,</mo><mi mathvariant="normal">∞</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">[n,\infty)</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord mathnormal">n</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">∞</span><span class="mclose">)</span></span></span></span> is the union over <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi><mo>+</mo><mi>y</mi><mo>=</mo><mi>n</mi></mrow><annotation encoding="application/x-tex">x+y=n</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.66666em;vertical-align:-0.08333em;"></span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">n</span></span></span></span> of <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">[</mo><mi>x</mi><mo separator="true">,</mo><mi mathvariant="normal">∞</mi><mo stretchy="false">)</mo><mo>×</mo><mo stretchy="false">[</mo><mi>y</mi><mo separator="true">,</mo><mi mathvariant="normal">∞</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">[x,\infty)\times[y,\infty)</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord mathnormal">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">∞</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">∞</span><span class="mclose">)</span></span></span></span>. But inverse is not continuous. I think.</p>



<a name="222463675"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/has_sum_nat_add_iff%20for%20add_monoid%3F/near/222463675" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/has_sum_nat_add_iff.20for.20add_monoid.3F.html#222463675">(Jan 12 2021 at 17:12)</a>:</h4>
<p>ah, you just beat me to it. I was going to suggest the basis <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">{</mo><mn>0</mn><mo stretchy="false">}</mo></mrow><annotation encoding="application/x-tex">\{0\}</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">{</span><span class="mord">0</span><span class="mclose">}</span></span></span></span> for natural numbers under addition</p>



<a name="222463783"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/has_sum_nat_add_iff%20for%20add_monoid%3F/near/222463783" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/has_sum_nat_add_iff.20for.20add_monoid.3F.html#222463783">(Jan 12 2021 at 17:13)</a>:</h4>
<p>So now what do we want? We're still asking questions about infinite sums, or were you asking about sequences?</p>



<a name="222463878"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/has_sum_nat_add_iff%20for%20add_monoid%3F/near/222463878" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/has_sum_nat_add_iff.20for.20add_monoid.3F.html#222463878">(Jan 12 2021 at 17:14)</a>:</h4>
<p>I could imagine that an infinite sum converging upwards might have different behaviour to an infinite sum converging downwards with this topology</p>



<a name="222463928"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/has_sum_nat_add_iff%20for%20add_monoid%3F/near/222463928" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/has_sum_nat_add_iff.20for.20add_monoid.3F.html#222463928">(Jan 12 2021 at 17:14)</a>:</h4>
<p>Use the reals rather than the integers or naturals</p>



<a name="222463971"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/has_sum_nat_add_iff%20for%20add_monoid%3F/near/222463971" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/has_sum_nat_add_iff.20for.20add_monoid.3F.html#222463971">(Jan 12 2021 at 17:14)</a>:</h4>
<p>I'm confused by the question</p>



<a name="222463976"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/has_sum_nat_add_iff%20for%20add_monoid%3F/near/222463976" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/has_sum_nat_add_iff.20for.20add_monoid.3F.html#222463976">(Jan 12 2021 at 17:14)</a>:</h4>
<p>all this just to satisfy Alex's linter! ;-)</p>



<a name="222464049"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/has_sum_nat_add_iff%20for%20add_monoid%3F/near/222464049" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/has_sum_nat_add_iff.20for.20add_monoid.3F.html#222464049">(Jan 12 2021 at 17:15)</a>:</h4>
<p>infinite sums don't converge in any particular direction here</p>



<a name="222464061"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/has_sum_nat_add_iff%20for%20add_monoid%3F/near/222464061" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/has_sum_nat_add_iff.20for.20add_monoid.3F.html#222464061">(Jan 12 2021 at 17:15)</a>:</h4>
<p>I'm just checking I understand the question. Originally we were talking about <code>has_sum</code>. I'm just checking that we still are.</p>



<a name="222464113"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/has_sum_nat_add_iff%20for%20add_monoid%3F/near/222464113" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/has_sum_nat_add_iff.20for.20add_monoid.3F.html#222464113">(Jan 12 2021 at 17:15)</a>:</h4>
<p>i.e. that your comment about <code>f + g ~&gt; a + b</code> was still a question about sums</p>



<a name="222464137"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/has_sum_nat_add_iff%20for%20add_monoid%3F/near/222464137" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/has_sum_nat_add_iff.20for.20add_monoid.3F.html#222464137">(Jan 12 2021 at 17:15)</a>:</h4>
<p>I think the has_sum question reduces to the question I posed about filter limits, which boils down to some continuity property</p>



<a name="222464253"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/has_sum_nat_add_iff%20for%20add_monoid%3F/near/222464253" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/has_sum_nat_add_iff.20for.20add_monoid.3F.html#222464253">(Jan 12 2021 at 17:16)</a>:</h4>
<p>It's not about sequences, because <code>has_sum</code> can handle more general convergent nets of partial sums</p>



<a name="222464292"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/has_sum_nat_add_iff%20for%20add_monoid%3F/near/222464292" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/has_sum_nat_add_iff.20for.20add_monoid.3F.html#222464292">(Jan 12 2021 at 17:16)</a>:</h4>
<p>Oh this topology isn't even Hausdorff! So probably 1+1+1+1+... tends to 37</p>



<a name="222464329"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/has_sum_nat_add_iff%20for%20add_monoid%3F/near/222464329" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/has_sum_nat_add_iff.20for.20add_monoid.3F.html#222464329">(Jan 12 2021 at 17:17)</a>:</h4>
<p>this is looking good</p>



<a name="222464413"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/has_sum_nat_add_iff%20for%20add_monoid%3F/near/222464413" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/has_sum_nat_add_iff.20for.20add_monoid.3F.html#222464413">(Jan 12 2021 at 17:17)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110038">Kevin Buzzard</span> <a href="#narrow/stream/116395-maths/topic/has_sum_nat_add_iff.20for.20add_monoid.3F/near/222461346">said</a>:</p>
<blockquote>
<p>Just to prove I'm not shirking, here's the fun I'm having:<br>
...</p>
</blockquote>
<p>For some reason <a href="https://leanprover-community.github.io/mathlib_docs/find/ordered_cancel_comm_monoid.to_left_cancel_monoid">docs#ordered_cancel_comm_monoid.to_left_cancel_monoid</a> exists but <a href="https://leanprover-community.github.io/mathlib_docs/find/ordered_cancel_comm_monoid.to_right_cancel_monoid">docs#ordered_cancel_comm_monoid.to_right_cancel_monoid</a> doesn't!</p>



<a name="222464524"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/has_sum_nat_add_iff%20for%20add_monoid%3F/near/222464524" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/has_sum_nat_add_iff.20for.20add_monoid.3F.html#222464524">(Jan 12 2021 at 17:18)</a>:</h4>
<p>Yes I'd got this far :-) But now I've been distracted by pathological topological monoids</p>



<a name="222464610"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/has_sum_nat_add_iff%20for%20add_monoid%3F/near/222464610" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/has_sum_nat_add_iff.20for.20add_monoid.3F.html#222464610">(Jan 12 2021 at 17:18)</a>:</h4>
<p>how about an example like: take the nonnegative reals but make the topology discrete on [0, 1]</p>



<a name="222464615"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/has_sum_nat_add_iff%20for%20add_monoid%3F/near/222464615" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/has_sum_nat_add_iff.20for.20add_monoid.3F.html#222464615">(Jan 12 2021 at 17:18)</a>:</h4>
<p>But actually that property spells doom as a counterexample, because everything converges to everything</p>



<a name="222464714"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/has_sum_nat_add_iff%20for%20add_monoid%3F/near/222464714" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/has_sum_nat_add_iff.20for.20add_monoid.3F.html#222464714">(Jan 12 2021 at 17:19)</a>:</h4>
<p>No, because if you don't get far enough then you don't converge.</p>



<a name="222464814"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/has_sum_nat_add_iff%20for%20add_monoid%3F/near/222464814" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/has_sum_nat_add_iff.20for.20add_monoid.3F.html#222464814">(Jan 12 2021 at 17:20)</a>:</h4>
<p>0+0+0+0+... doesn't tend to 2 because it never makes it to [1,infty)</p>



<a name="222464836"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/has_sum_nat_add_iff%20for%20add_monoid%3F/near/222464836" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/has_sum_nat_add_iff.20for.20add_monoid.3F.html#222464836">(Jan 12 2021 at 17:20)</a>:</h4>
<p>true, but that happens iff the sequence converges in the usual sense to infinity, and taking a few elements off won't change that</p>



<a name="222464853"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/has_sum_nat_add_iff%20for%20add_monoid%3F/near/222464853" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/has_sum_nat_add_iff.20for.20add_monoid.3F.html#222464853">(Jan 12 2021 at 17:20)</a>:</h4>
<p>so I think that's it, right? 0+0+0+... doesn't tend to 2, but 1+1+1+... tends to 37 and the sum tends to 39.</p>



<a name="222464942"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/has_sum_nat_add_iff%20for%20add_monoid%3F/near/222464942" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/has_sum_nat_add_iff.20for.20add_monoid.3F.html#222464942">(Jan 12 2021 at 17:21)</a>:</h4>
<p>but that's not a counterexample</p>



<a name="222464995"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/has_sum_nat_add_iff%20for%20add_monoid%3F/near/222464995" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/has_sum_nat_add_iff.20for.20add_monoid.3F.html#222464995">(Jan 12 2021 at 17:21)</a>:</h4>
<p>you can only remove finitely many elements from the sequence</p>



<a name="222465254"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/has_sum_nat_add_iff%20for%20add_monoid%3F/near/222465254" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/has_sum_nat_add_iff.20for.20add_monoid.3F.html#222465254">(Jan 12 2021 at 17:23)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110049">Mario Carneiro</span> <a href="#narrow/stream/116395-maths/topic/has_sum_nat_add_iff.20for.20add_monoid.3F/near/222461012">said</a>:</p>
<blockquote>
<p>Oh, some new theorems pop up when you try the obvious thing. Is it true that if <code>f + g ~&gt; a + b</code> and <code>f ~&gt; a</code> then <code>g ~&gt; b</code> (in a cancellative topological monoid)?</p>
</blockquote>
<p>I don't know what this means, but I thought that I had given a counterexample to it.</p>



<a name="222465390"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/has_sum_nat_add_iff%20for%20add_monoid%3F/near/222465390" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/has_sum_nat_add_iff.20for.20add_monoid.3F.html#222465390">(Jan 12 2021 at 17:24)</a>:</h4>
<p>Ah, you were giving a counterexample to that</p>



<a name="222465402"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/has_sum_nat_add_iff%20for%20add_monoid%3F/near/222465402" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/has_sum_nat_add_iff.20for.20add_monoid.3F.html#222465402">(Jan 12 2021 at 17:24)</a>:</h4>
<p>I agree we don't have a counterexample to Johan's original question yet.</p>



<a name="222465463"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/has_sum_nat_add_iff%20for%20add_monoid%3F/near/222465463" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/has_sum_nat_add_iff.20for.20add_monoid.3F.html#222465463">(Jan 12 2021 at 17:25)</a>:</h4>
<p>But we have Reid's comment to fall back on if this one doesn't give us something.</p>



<a name="222465662"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/has_sum_nat_add_iff%20for%20add_monoid%3F/near/222465662" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/has_sum_nat_add_iff.20for.20add_monoid.3F.html#222465662">(Jan 12 2021 at 17:26)</a>:</h4>
<p>Actually a more accurate version of what you get by reducing Johan's question is if <code>f + b ~&gt; a + b</code> then <code>f ~&gt; a</code></p>



<a name="222465766"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/has_sum_nat_add_iff%20for%20add_monoid%3F/near/222465766" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/has_sum_nat_add_iff.20for.20add_monoid.3F.html#222465766">(Jan 12 2021 at 17:27)</a>:</h4>
<p>Where the + b is acting on the convergents (partial sums), not the elements of the sum</p>



<a name="222465883"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/has_sum_nat_add_iff%20for%20add_monoid%3F/near/222465883" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/has_sum_nat_add_iff.20for.20add_monoid.3F.html#222465883">(Jan 12 2021 at 17:28)</a>:</h4>
<p>I think that's equivalent to saying that <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">_</mi><mo>+</mo><mi>b</mi></mrow><annotation encoding="application/x-tex">\_  + b</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.89333em;vertical-align:-0.31em;"></span><span class="mord" style="margin-right:0.02778em;">_</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathnormal">b</span></span></span></span> is an open map</p>



<a name="222466249"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/has_sum_nat_add_iff%20for%20add_monoid%3F/near/222466249" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/has_sum_nat_add_iff.20for.20add_monoid.3F.html#222466249">(Jan 12 2021 at 17:30)</a>:</h4>
<p>and in this example we're working with, right addition probably is an open map. So let's fall back on Reid's example because there it looks to me like it isn't.</p>



<a name="222466341"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/has_sum_nat_add_iff%20for%20add_monoid%3F/near/222466341" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/has_sum_nat_add_iff.20for.20add_monoid.3F.html#222466341">(Jan 12 2021 at 17:31)</a>:</h4>
<p>So put the usual topology on <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="double-struck">R</mi></mrow><annotation encoding="application/x-tex">\mathbb{R}</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.68889em;vertical-align:0em;"></span><span class="mord"><span class="mord mathbb">R</span></span></span></span></span>, and then add a bunch more open sets -- any subset of <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">[</mo><mn>0</mn><mo separator="true">,</mo><mn>1</mn><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">[0,1]</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">1</span><span class="mclose">]</span></span></span></span> is open -- and there's a topology.</p>



<a name="222466435"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/has_sum_nat_add_iff%20for%20add_monoid%3F/near/222466435" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/has_sum_nat_add_iff.20for.20add_monoid.3F.html#222466435">(Jan 12 2021 at 17:32)</a>:</h4>
<p>But now addition is not continuous :-(</p>



<a name="222466449"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/has_sum_nat_add_iff%20for%20add_monoid%3F/near/222466449" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/has_sum_nat_add_iff.20for.20add_monoid.3F.html#222466449">(Jan 12 2021 at 17:32)</a>:</h4>
<p>Needs to be the nonnegative reals for that reason</p>



<a name="222466486"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/has_sum_nat_add_iff%20for%20add_monoid%3F/near/222466486" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/has_sum_nat_add_iff.20for.20add_monoid.3F.html#222466486">(Jan 12 2021 at 17:32)</a>:</h4>
<p>yeah I just went to re-check your comment :-)</p>



<a name="222466727"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/has_sum_nat_add_iff%20for%20add_monoid%3F/near/222466727" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/has_sum_nat_add_iff.20for.20add_monoid.3F.html#222466727">(Jan 12 2021 at 17:34)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110038">Kevin Buzzard</span> <a href="#narrow/stream/116395-maths/topic/has_sum_nat_add_iff.20for.20add_monoid.3F/near/222464524">said</a>:</p>
<blockquote>
<p>Yes I'd got this far :-) But now I've been distracted by pathological topological monoids</p>
</blockquote>
<p>Fixed in <a href="https://github.com/leanprover-community/mathlib/issues/5713">#5713</a>, hopefully</p>



<a name="222466779"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/has_sum_nat_add_iff%20for%20add_monoid%3F/near/222466779" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/has_sum_nat_add_iff.20for.20add_monoid.3F.html#222466779">(Jan 12 2021 at 17:34)</a>:</h4>
<p>I see. So the pre-image of a usual open set is certainly open because usual addition is continuous for the usual topology, and the preimage of a weird open set is open because it's in this [0,1] chaos.</p>



<a name="222466873"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/has_sum_nat_add_iff%20for%20add_monoid%3F/near/222466873" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/has_sum_nat_add_iff.20for.20add_monoid.3F.html#222466873">(Jan 12 2021 at 17:35)</a>:</h4>
<p>Here's a formal rendering of the statement I gave above (with <code>f</code> in place of <code>+ b</code>)</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">def</span> <span class="n">property</span> <span class="o">{</span><span class="n">α</span> <span class="n">β</span><span class="o">}</span> <span class="o">[</span><span class="n">topological_space</span> <span class="n">α</span><span class="o">]</span> <span class="o">[</span><span class="n">topological_space</span> <span class="n">β</span><span class="o">]</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">α</span> <span class="bp">→</span> <span class="n">β</span><span class="o">)</span> <span class="o">:=</span>
<span class="bp">∀</span> <span class="o">(</span><span class="n">F</span> <span class="o">:</span> <span class="n">filter</span> <span class="n">α</span><span class="o">)</span> <span class="o">(</span><span class="n">a</span> <span class="o">:</span> <span class="n">α</span><span class="o">),</span> <span class="n">F.map</span> <span class="n">f</span> <span class="bp">≤</span> <span class="n">nhds</span> <span class="o">(</span><span class="n">f</span> <span class="n">a</span><span class="o">)</span> <span class="bp">→</span> <span class="n">F</span> <span class="bp">≤</span> <span class="n">nhds</span> <span class="n">a</span>
</code></pre></div>



<a name="222466892"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/has_sum_nat_add_iff%20for%20add_monoid%3F/near/222466892" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/has_sum_nat_add_iff.20for.20add_monoid.3F.html#222466892">(Jan 12 2021 at 17:35)</a>:</h4>
<p>Thanks Eric! Does <code>nnreal</code> become an <code>add_cancel_comm_monoid</code> now?</p>



<a name="222466922"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/has_sum_nat_add_iff%20for%20add_monoid%3F/near/222466922" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/has_sum_nat_add_iff.20for.20add_monoid.3F.html#222466922">(Jan 12 2021 at 17:35)</a>:</h4>
<p>Who knows, the universe has to rebuild first</p>



<a name="222466991"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/has_sum_nat_add_iff%20for%20add_monoid%3F/near/222466991" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/has_sum_nat_add_iff.20for.20add_monoid.3F.html#222466991">(Jan 12 2021 at 17:36)</a>:</h4>
<p>this looks like something that should have a straightforward topological rendering, but I'm not sure what</p>



<a name="222467212"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/has_sum_nat_add_iff%20for%20add_monoid%3F/near/222467212" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/has_sum_nat_add_iff.20for.20add_monoid.3F.html#222467212">(Jan 12 2021 at 17:38)</a>:</h4>
<p>I would guess it's "f is open"</p>



<a name="222469069"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/has_sum_nat_add_iff%20for%20add_monoid%3F/near/222469069" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/has_sum_nat_add_iff.20for.20add_monoid.3F.html#222469069">(Jan 12 2021 at 17:51)</a>:</h4>
<p>OK I think I've got everything straight.</p>
<p>So Reid's example gives us a cancellative add comm monoid with a topology for which addition is continuous but for which Johan's lemma fails, because 1/10+1/100+1/1000+... does _not_ tend to 0.11111111111...=1/9 because it never reaches the open set {1/9}. However 37+1/10+1/100+1/1000.. does tend to 37.1111... because over there the topology is sensible. Adding 37 isn't open. So this proves that my second attempt at a MWE is also not provable. </p>
<p>The idea of adding a cancellative assumption was that we seemed to be cancelling, but we need to cancel continuously. So there is some predicate on topological add monoids which is strictly stronger than algebraic cancellation, it says that not only is adding x injective (from cancellative) and continuous (from the top add monoid assumption), it is also open. Presumably this is precisely the condition which one needs in order to make the top add monoid a submonoid of a top add group (certainly for submonoids, with the subspace topology, of top add groups, addition will be continuous). So this would be the natural assumption to put on alpha to make Johan's lemma true.</p>
<p>My guess is that more generally if <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>M</mi></mrow><annotation encoding="application/x-tex">M</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">M</span></span></span></span> is a topological commutative monoid and <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi></mrow><annotation encoding="application/x-tex">S</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span></span></span></span> is a subset then there might be random ways to put a topology on <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>M</mi><mo stretchy="false">[</mo><mn>1</mn><mi mathvariant="normal">/</mi><mi>S</mi><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">M[1/S]</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="mopen">[</span><span class="mord">1</span><span class="mord">/</span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mclose">]</span></span></span></span> but the nicest theorems will only hold under the assumption that multiplication by <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mo>∈</mo><mi>S</mi></mrow><annotation encoding="application/x-tex">s\in S</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mord mathnormal">s</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span></span></span></span> is an open map (because then division by <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi></mrow><annotation encoding="application/x-tex">s</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">s</span></span></span></span> will be continuous). This seems like quite a neat project. In fact maybe <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>M</mi><mo stretchy="false">[</mo><mn>1</mn><mi mathvariant="normal">/</mi><mi>S</mi><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">M[1/S]</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="mopen">[</span><span class="mord">1</span><span class="mord">/</span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mclose">]</span></span></span></span> won't be a topological monoid if you just put a random topology on it somehow coming from <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>M</mi></mrow><annotation encoding="application/x-tex">M</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">M</span></span></span></span>, without this extra hypothesis.</p>
<p>If Johan only needs the result for nnreal then I guess the most painless thing to do is to prove that adding a constant is an open map on nnreal, or alternatively trying to deduce the result on nnreal from the corresponding result for reals.</p>
<p><span class="user-mention" data-user-id="112680">@Johan Commelin</span> thanks for the interesting question!</p>



<a name="222469074"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/has_sum_nat_add_iff%20for%20add_monoid%3F/near/222469074" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/has_sum_nat_add_iff.20for.20add_monoid.3F.html#222469074">(Jan 12 2021 at 17:51)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110038">Kevin Buzzard</span> <a href="#narrow/stream/116395-maths/topic/has_sum_nat_add_iff.20for.20add_monoid.3F/near/222467212">said</a>:</p>
<blockquote>
<p>I would guess it's "f is open"</p>
</blockquote>
<p>Confirmed, under the assumption that <code>f</code> is injective (which it is in our examples)</p>



<a name="222469351"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/has_sum_nat_add_iff%20for%20add_monoid%3F/near/222469351" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/has_sum_nat_add_iff.20for.20add_monoid.3F.html#222469351">(Jan 12 2021 at 17:53)</a>:</h4>
<p>Nice! So there is an argument for a "topologically cancellative" top monoid class.</p>



<a name="222469597"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/has_sum_nat_add_iff%20for%20add_monoid%3F/near/222469597" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/has_sum_nat_add_iff.20for.20add_monoid.3F.html#222469597">(Jan 12 2021 at 17:55)</a>:</h4>
<p>If you drop injectivity of <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi></mrow><annotation encoding="application/x-tex">f</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span></span></span></span> then the lemma is probably false for other reasons (a1 + b = a2 + b and the infinite sum won't tend to both a1 and a2)</p>



<a name="222475907"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/has_sum_nat_add_iff%20for%20add_monoid%3F/near/222475907" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/has_sum_nat_add_iff.20for.20add_monoid.3F.html#222475907">(Jan 12 2021 at 18:41)</a>:</h4>
<p><span class="user-mention" data-user-id="110049">@Mario Carneiro</span> are these missing? Are you working on them?</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">tactic</span>
<span class="kn">import</span> <span class="n">topology.algebra.infinite_sum</span>

<span class="n">open_locale</span> <span class="n">big_operators</span>

<span class="kn">open</span> <span class="n">finset</span>

<span class="kd">variables</span> <span class="o">(</span><span class="n">M</span> <span class="n">N</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">[</span><span class="n">topological_space</span> <span class="n">M</span><span class="o">]</span> <span class="o">[</span><span class="n">topological_space</span> <span class="n">N</span><span class="o">]</span>
  <span class="o">[</span><span class="n">add_comm_monoid</span> <span class="n">M</span><span class="o">]</span> <span class="o">[</span><span class="n">add_comm_monoid</span> <span class="n">N</span><span class="o">]</span>
  <span class="o">[</span><span class="n">has_continuous_add</span> <span class="n">M</span><span class="o">]</span> <span class="o">[</span><span class="n">has_continuous_add</span> <span class="n">N</span><span class="o">]</span> <span class="c1">-- I have no idea whether we need these!</span>

<span class="kd">variable</span> <span class="o">(</span><span class="n">ι</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span>

<span class="kd">lemma</span> <span class="n">lemma1</span> <span class="o">(</span><span class="n">φ</span> <span class="o">:</span> <span class="n">M</span> <span class="bp">→+</span> <span class="n">N</span><span class="o">)</span> <span class="o">(</span><span class="n">hφ</span> <span class="o">:</span> <span class="n">continuous</span> <span class="n">φ</span><span class="o">)</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">ι</span> <span class="bp">→</span> <span class="n">M</span><span class="o">)</span> <span class="o">(</span><span class="n">m</span> <span class="o">:</span> <span class="n">M</span><span class="o">)</span> <span class="o">(</span><span class="n">hm</span> <span class="o">:</span> <span class="n">has_sum</span> <span class="n">f</span> <span class="n">m</span><span class="o">)</span> <span class="o">:</span>
  <span class="n">has_sum</span> <span class="o">(</span><span class="n">φ</span> <span class="bp">∘</span> <span class="n">f</span><span class="o">)</span> <span class="o">(</span><span class="n">φ</span> <span class="n">m</span><span class="o">)</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="gr">sorry</span>
<span class="kd">end</span>

<span class="kn">open</span> <span class="n">function</span>

<span class="kd">lemma</span> <span class="n">lemma2</span> <span class="o">(</span><span class="n">φ</span> <span class="o">:</span> <span class="n">M</span> <span class="bp">→+</span> <span class="n">N</span><span class="o">)</span> <span class="o">(</span><span class="n">hφ</span> <span class="o">:</span> <span class="n">continuous</span> <span class="n">φ</span><span class="o">)</span> <span class="o">(</span><span class="n">hφ2</span> <span class="o">:</span> <span class="n">injective</span> <span class="n">φ</span><span class="o">)</span> <span class="o">(</span><span class="n">hφ3</span> <span class="o">:</span> <span class="n">is_open_map</span> <span class="n">φ</span><span class="o">)</span>
  <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">ι</span> <span class="bp">→</span> <span class="n">M</span><span class="o">)</span> <span class="o">(</span><span class="n">m</span> <span class="o">:</span> <span class="n">M</span><span class="o">)</span> <span class="o">(</span><span class="n">hm</span> <span class="o">:</span> <span class="n">has_sum</span> <span class="o">(</span><span class="n">φ</span> <span class="bp">∘</span> <span class="n">f</span><span class="o">)</span> <span class="o">(</span><span class="n">φ</span> <span class="n">m</span><span class="o">))</span> <span class="o">:</span> <span class="n">has_sum</span> <span class="n">f</span> <span class="n">m</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="gr">sorry</span>
<span class="kd">end</span>
</code></pre></div>



<a name="222475972"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/has_sum_nat_add_iff%20for%20add_monoid%3F/near/222475972" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/has_sum_nat_add_iff.20for.20add_monoid.3F.html#222475972">(Jan 12 2021 at 18:41)</a>:</h4>
<p>we should have the first one already, but I doubt we have the second</p>



<a name="222476190"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/has_sum_nat_add_iff%20for%20add_monoid%3F/near/222476190" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/has_sum_nat_add_iff.20for.20add_monoid.3F.html#222476190">(Jan 12 2021 at 18:43)</a>:</h4>
<p>In <code>topology.algebra.infinite_sum</code> I couldn't find a single lemma about changing the target monoid. Should I be looking somewhere else? I'll remark in passing that if we used math notation (M, N for the monoids, alpha, beta for the index types) it would be easier to look!</p>



<a name="222479119"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/has_sum_nat_add_iff%20for%20add_monoid%3F/near/222479119" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/has_sum_nat_add_iff.20for.20add_monoid.3F.html#222479119">(Jan 12 2021 at 19:06)</a>:</h4>
<p>Hah, I see that you opened and closed some cans of worms while I put my kids in bed (-;</p>



<a name="222479150"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/has_sum_nat_add_iff%20for%20add_monoid%3F/near/222479150" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/has_sum_nat_add_iff.20for.20add_monoid.3F.html#222479150">(Jan 12 2021 at 19:06)</a>:</h4>
<p>I've nearly proved your lemma!</p>



<a name="222479175"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/has_sum_nat_add_iff%20for%20add_monoid%3F/near/222479175" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/has_sum_nat_add_iff.20for.20add_monoid.3F.html#222479175">(Jan 12 2021 at 19:06)</a>:</h4>
<p>Is this for the liquid stuff?</p>



<a name="222480364"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/has_sum_nat_add_iff%20for%20add_monoid%3F/near/222480364" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/has_sum_nat_add_iff.20for.20add_monoid.3F.html#222480364">(Jan 12 2021 at 19:14)</a>:</h4>
<p>yup</p>



<a name="222480693"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/has_sum_nat_add_iff%20for%20add_monoid%3F/near/222480693" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/has_sum_nat_add_iff.20for.20add_monoid.3F.html#222480693">(Jan 12 2021 at 19:17)</a>:</h4>
<p>You led us up quite the garden path!</p>



<a name="222480707"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/has_sum_nat_add_iff%20for%20add_monoid%3F/near/222480707" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/has_sum_nat_add_iff.20for.20add_monoid.3F.html#222480707">(Jan 12 2021 at 19:17)</a>:</h4>
<p>mi sori</p>



<a name="222480790"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/has_sum_nat_add_iff%20for%20add_monoid%3F/near/222480790" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/has_sum_nat_add_iff.20for.20add_monoid.3F.html#222480790">(Jan 12 2021 at 19:18)</a>:</h4>
<p>But it should be possible to get a statement that works for both <code>nnreal</code> and <code>nnrat</code> (when we ever get around to defining that one).</p>



<a name="222480791"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/has_sum_nat_add_iff%20for%20add_monoid%3F/near/222480791" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/has_sum_nat_add_iff.20for.20add_monoid.3F.html#222480791">(Jan 12 2021 at 19:18)</a>:</h4>
<p>Oh it was great fun, I have loads of things to do today and it was a wonderful excuse not to do any of them. I've just got it compiling.</p>



<a name="222480904"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/has_sum_nat_add_iff%20for%20add_monoid%3F/near/222480904" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/has_sum_nat_add_iff.20for.20add_monoid.3F.html#222480904">(Jan 12 2021 at 19:18)</a>:</h4>
<p>so what is the solution in the end? you're assuming that addition is open? I guess this should be a new typeclass... or did you already make it that?</p>



<a name="222481132"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/has_sum_nat_add_iff%20for%20add_monoid%3F/near/222481132" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/has_sum_nat_add_iff.20for.20add_monoid.3F.html#222481132">(Jan 12 2021 at 19:20)</a>:</h4>
<p>No, the new typeclass is a proper little project. I figured that you just wanted it for <code>nnreal</code>. </p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">topology.algebra.infinite_sum</span>
<span class="kn">import</span> <span class="n">topology.instances.nnreal</span>

<span class="n">open_locale</span> <span class="n">big_operators</span>

<span class="kn">open</span> <span class="n">nnreal</span>

<span class="kn">open</span> <span class="n">finset</span>

<span class="kd">lemma</span> <span class="n">has_sum_nat_add_iff''</span> <span class="o">{</span><span class="n">f</span> <span class="o">:</span> <span class="n">ℕ</span> <span class="bp">→</span> <span class="n">nnreal</span><span class="o">}</span> <span class="o">(</span><span class="n">k</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="o">{</span><span class="n">a</span> <span class="o">:</span> <span class="n">nnreal</span><span class="o">}</span> <span class="o">:</span>
  <span class="n">has_sum</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">n</span><span class="o">,</span> <span class="n">f</span> <span class="o">(</span><span class="n">n</span> <span class="bp">+</span> <span class="n">k</span><span class="o">))</span> <span class="n">a</span> <span class="bp">↔</span> <span class="n">has_sum</span> <span class="n">f</span> <span class="o">(</span><span class="n">a</span> <span class="bp">+</span> <span class="bp">∑</span> <span class="n">i</span> <span class="k">in</span> <span class="n">range</span> <span class="n">k</span><span class="o">,</span> <span class="n">f</span> <span class="n">i</span><span class="o">)</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="n">unfold</span> <span class="n">has_sum</span><span class="o">,</span>
  <span class="n">rw</span> <span class="bp">←</span> <span class="n">tendsto_coe</span><span class="o">,</span>
  <span class="n">rw</span> <span class="bp">←</span> <span class="n">tendsto_coe</span><span class="o">,</span>
  <span class="n">simp</span> <span class="n">only</span> <span class="o">[</span><span class="n">coe_sum</span><span class="o">],</span>
  <span class="n">convert</span> <span class="n">has_sum_nat_add_iff</span> <span class="n">k</span><span class="o">,</span>
  <span class="n">refl</span><span class="o">,</span>
  <span class="n">classical</span><span class="o">,</span>
  <span class="n">rw</span> <span class="n">nnreal.coe_add</span><span class="o">,</span>
  <span class="n">simp</span> <span class="n">only</span> <span class="o">[</span><span class="n">coe_sum</span><span class="o">],</span>
  <span class="n">apply_instance</span><span class="o">,</span>
<span class="kd">end</span>
</code></pre></div>
<p>I've not tidied it up yet.</p>



<a name="222481440"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/has_sum_nat_add_iff%20for%20add_monoid%3F/near/222481440" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/has_sum_nat_add_iff.20for.20add_monoid.3F.html#222481440">(Jan 12 2021 at 19:23)</a>:</h4>
<p>ok, so this is the "cheaty" version that falls back to <code>real</code> (-;</p>



<a name="222482244"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/has_sum_nat_add_iff%20for%20add_monoid%3F/near/222482244" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/has_sum_nat_add_iff.20for.20add_monoid.3F.html#222482244">(Jan 12 2021 at 19:29)</a>:</h4>
<p>Here's what's going on. It's absolutely crucial that addition is an open map (otherwise the lemma is false). It's also crucial that the monoid is cancellative (otherwise the lemma is false). This should really be a new typeclass ("topologically cancellative monoids -- the top monoids which are submonoids of top groups). The correct localisation theory for topological add_monoids (you want a topology on the localisation too) is, I suspect, when the things you're inverting have the property that adding them is an open map (Patrick will probably tell us that all of this is in Bourbaki). If you do it this way then basically you're reducing the question from top monoids to top groups. But to actually do the reduction you need lemma1 and lemma2 above, to move between the monoid and the group (and the corollary that for a continuous injective open map, like nnreal -&gt; real, sum = a iff coerced sum = a). This is the key thing:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">lemma</span> <span class="n">lemma1</span> <span class="o">(</span><span class="n">φ</span> <span class="o">:</span> <span class="n">M</span> <span class="bp">→+</span> <span class="n">N</span><span class="o">)</span> <span class="o">(</span><span class="n">hφ</span> <span class="o">:</span> <span class="n">continuous</span> <span class="n">φ</span><span class="o">)</span> <span class="o">{</span><span class="n">f</span> <span class="o">:</span> <span class="n">ι</span> <span class="bp">→</span> <span class="n">M</span><span class="o">}</span> <span class="o">{</span><span class="n">m</span> <span class="o">:</span> <span class="n">M</span><span class="o">}</span> <span class="o">(</span><span class="n">hm</span> <span class="o">:</span> <span class="n">has_sum</span> <span class="n">f</span> <span class="n">m</span><span class="o">)</span> <span class="o">:</span>
  <span class="n">has_sum</span> <span class="o">(</span><span class="n">φ</span> <span class="bp">∘</span> <span class="n">f</span><span class="o">)</span> <span class="o">(</span><span class="n">φ</span> <span class="n">m</span><span class="o">)</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="gr">sorry</span>
<span class="kd">end</span>

<span class="kn">open</span> <span class="n">function</span>

<span class="kd">lemma</span> <span class="n">lemma2</span> <span class="o">(</span><span class="n">φ</span> <span class="o">:</span> <span class="n">M</span> <span class="bp">→+</span> <span class="n">N</span><span class="o">)</span> <span class="o">(</span><span class="n">hφ1</span> <span class="o">:</span> <span class="n">injective</span> <span class="n">φ</span><span class="o">)</span> <span class="o">(</span><span class="n">hφ2</span> <span class="o">:</span> <span class="n">is_open_map</span> <span class="n">φ</span><span class="o">)</span>
  <span class="o">{</span><span class="n">f</span> <span class="o">:</span> <span class="n">ι</span> <span class="bp">→</span> <span class="n">M</span><span class="o">}</span> <span class="o">{</span><span class="n">m</span> <span class="o">:</span> <span class="n">M</span><span class="o">}</span> <span class="o">(</span><span class="n">hm</span> <span class="o">:</span> <span class="n">has_sum</span> <span class="o">(</span><span class="n">φ</span> <span class="bp">∘</span> <span class="n">f</span><span class="o">)</span> <span class="o">(</span><span class="n">φ</span> <span class="n">m</span><span class="o">))</span> <span class="o">:</span> <span class="n">has_sum</span> <span class="n">f</span> <span class="n">m</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="gr">sorry</span>
<span class="kd">end</span>

<span class="kd">lemma</span> <span class="n">corollary3</span> <span class="o">(</span><span class="n">φ</span> <span class="o">:</span> <span class="n">M</span> <span class="bp">→+</span> <span class="n">N</span><span class="o">)</span> <span class="o">(</span><span class="n">hφ</span> <span class="o">:</span> <span class="n">continuous</span> <span class="n">φ</span><span class="o">)</span> <span class="o">(</span><span class="n">hφ2</span> <span class="o">:</span> <span class="n">injective</span> <span class="n">φ</span><span class="o">)</span> <span class="o">(</span><span class="n">hφ3</span> <span class="o">:</span> <span class="n">is_open_map</span> <span class="n">φ</span><span class="o">)</span>
  <span class="o">{</span><span class="n">f</span> <span class="o">:</span> <span class="n">ι</span> <span class="bp">→</span> <span class="n">M</span><span class="o">}</span> <span class="o">{</span><span class="n">m</span> <span class="o">:</span> <span class="n">M</span><span class="o">}</span> <span class="o">:</span> <span class="n">has_sum</span> <span class="n">f</span> <span class="n">m</span> <span class="bp">↔</span> <span class="n">has_sum</span> <span class="o">(</span><span class="n">φ</span> <span class="bp">∘</span> <span class="n">f</span><span class="o">)</span> <span class="o">(</span><span class="n">φ</span> <span class="n">m</span><span class="o">)</span> <span class="o">:=</span>
<span class="o">⟨</span><span class="n">lemma1</span> <span class="n">φ</span> <span class="n">hφ</span><span class="o">,</span> <span class="n">lemma2</span> <span class="n">φ</span> <span class="n">hφ2</span> <span class="n">hφ3</span><span class="o">⟩</span>
</code></pre></div>
<p>I'm not sure we have those lemmas either! Mario was optimistic about lemma 1 but I couldn't find it. So on the face of it, your lemma looks like a lot of work!</p>
<p>However Yury has already proved corollary 3 in the special case where the map is nnreal -&gt; real, so if you just need it in the nnreal case you may as well use Yury's result, which is what I used (<code>nnreal.tendsto_coe</code>). I was rather hoping it would be a really slick one-liner, but unfortunately you have to commute the coercions with everything. Also, for some reason the first <code>simp only</code> (which is a rewrite under a binder) takes forever right now. I'll try to tidy.</p>



<a name="222483061"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/has_sum_nat_add_iff%20for%20add_monoid%3F/near/222483061" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/has_sum_nat_add_iff.20for.20add_monoid.3F.html#222483061">(Jan 12 2021 at 19:35)</a>:</h4>
<p><span class="user-mention" data-user-id="110038">@Kevin Buzzard</span> I'm looking at <a href="https://leanprover-community.github.io/mathlib_docs/find/has_sum.map">docs#has_sum.map</a> for <code>lemma1</code></p>



<a name="222483502"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/has_sum_nat_add_iff%20for%20add_monoid%3F/near/222483502" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/has_sum_nat_add_iff.20for.20add_monoid.3F.html#222483502">(Jan 12 2021 at 19:38)</a>:</h4>
<p>Nice! I missed it because the add_comm_monoid instance was put on the random type gamma. If it had been an <code>N</code> I would have been more likely to spot it! The lemma is before line 214 so indeed it does not assume that things are topological monoids! In particular my earlier comment <code>  [has_continuous_add M] [has_continuous_add N] -- I have no idea whether we need these!</code> -- indeed we don't seem to!</p>



<a name="222491266"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/has_sum_nat_add_iff%20for%20add_monoid%3F/near/222491266" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/has_sum_nat_add_iff.20for.20add_monoid.3F.html#222491266">(Jan 12 2021 at 20:41)</a>:</h4>
<p>I got it down to one line in the end! <a href="https://github.com/leanprover-community/mathlib/issues/5716">#5716</a></p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>