---
layout: archive
title: Zulip Chat Archive
permalink: /stream/116395-maths/topic/how.20to.20avoid.20.60int_algebra.60.20diamond.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/116395-maths/index.html">maths</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/how.20to.20avoid.20.60int_algebra.60.20diamond.html">how to avoid `int_algebra` diamond</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="259272573"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/how%20to%20avoid%20%60int_algebra%60%20diamond/near/259272573" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/how.20to.20avoid.20.60int_algebra.60.20diamond.html#259272573">(Oct 27 2021 at 17:08)</a>:</h4>
<p>The following instance</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">algebra.algebra.basic</span>

<span class="kd">instance</span> <span class="n">foo</span> <span class="o">(</span><span class="n">A</span> <span class="n">B</span> <span class="n">C</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">[</span><span class="n">comm_ring</span> <span class="n">A</span><span class="o">]</span> <span class="o">[</span><span class="n">comm_ring</span> <span class="n">B</span><span class="o">]</span> <span class="o">[</span><span class="n">comm_ring</span> <span class="n">C</span><span class="o">]</span>
  <span class="o">[</span><span class="n">algebra</span> <span class="n">A</span> <span class="n">B</span><span class="o">]</span> <span class="o">[</span><span class="n">algebra</span> <span class="n">B</span> <span class="n">C</span><span class="o">]</span> <span class="o">:</span> <span class="n">algebra</span> <span class="n">A</span> <span class="n">C</span> <span class="o">:=</span>
<span class="o">((</span><span class="n">algebra_map</span> <span class="n">B</span> <span class="n">C</span><span class="o">)</span><span class="bp">.</span><span class="n">comp</span> <span class="o">(</span><span class="n">algebra_map</span> <span class="n">A</span> <span class="n">B</span><span class="o">))</span><span class="bp">.</span><span class="n">to_algebra</span>
</code></pre></div>
<p>causes problems, because <code>algebra_int R : algebra ℤ R</code> is an instance, so if <code>R</code> and <code>S</code> are <code>comm_ring</code>s and <code>[algebra R S]</code> then <code>foo</code> and <code>algebra_int</code> give two non-defeq instances of <code>algebra ℤ S</code>. I don't see a way around this right now. This came up in <a class="stream" data-stream-id="304774" href="/#narrow/stream/304774-FLT-regular">#FLT regular</a> .</p>



<a name="259277229"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/how%20to%20avoid%20%60int_algebra%60%20diamond/near/259277229" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/how.20to.20avoid.20.60int_algebra.60.20diamond.html#259277229">(Oct 27 2021 at 17:40)</a>:</h4>
<p>It's probably an insane amount of work, but maybe the long term solution is to make the N action part of the definition of a semiring, and similarly for rings.</p>



<a name="259277350"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/how%20to%20avoid%20%60int_algebra%60%20diamond/near/259277350" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/how.20to.20avoid.20.60int_algebra.60.20diamond.html#259277350">(Oct 27 2021 at 17:41)</a>:</h4>
<p>This still might not solve the problem though, because you can't have <code>foo</code> saying "if A is the integers then do it this way, else do it the obvious way".</p>



<a name="259277555"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/how%20to%20avoid%20%60int_algebra%60%20diamond/near/259277555" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/how.20to.20avoid.20.60int_algebra.60.20diamond.html#259277555">(Oct 27 2021 at 17:42)</a>:</h4>
<p>As subscribers to <a class="stream" data-stream-id="304774" href="/#narrow/stream/304774-FLT-regular">#FLT regular</a> will know, we're probably going to switch to a weaker version of <code>foo</code> which will suffice for the cases we're interested in. Johan suggested that there might already be a diamond in mathlib with <code>rat.algebra_rat</code> because there's some variant of <code>foo</code> which does exist for intermediate fields.</p>



<a name="259277583"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/how%20to%20avoid%20%60int_algebra%60%20diamond/near/259277583" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/how.20to.20avoid.20.60int_algebra.60.20diamond.html#259277583">(Oct 27 2021 at 17:43)</a>:</h4>
<p>This what happened to monoids and groups, right? Now it's literally impossible to have two non defeq Z actions on a group if I understand what has been done</p>



<a name="259277739"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/how%20to%20avoid%20%60int_algebra%60%20diamond/near/259277739" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/how.20to.20avoid.20.60int_algebra.60.20diamond.html#259277739">(Oct 27 2021 at 17:44)</a>:</h4>
<p>No, I don't think it's impossible. It got a bit harder to do it wrong though.</p>



<a name="259277811"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/how%20to%20avoid%20%60int_algebra%60%20diamond/near/259277811" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/how.20to.20avoid.20.60int_algebra.60.20diamond.html#259277811">(Oct 27 2021 at 17:44)</a>:</h4>
<p>More importantly, it became possible to do it right.</p>



<a name="259277860"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/how%20to%20avoid%20%60int_algebra%60%20diamond/near/259277860" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/how.20to.20avoid.20.60int_algebra.60.20diamond.html#259277860">(Oct 27 2021 at 17:45)</a>:</h4>
<p>Somehow it's not quite the same. We put an action of the integers on every group, but given a group homomorphism G -&gt; H and an action of X on G you don't get an induced action of X on H.</p>



<a name="259277869"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/how%20to%20avoid%20%60int_algebra%60%20diamond/near/259277869" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/how.20to.20avoid.20.60int_algebra.60.20diamond.html#259277869">(Oct 27 2021 at 17:45)</a>:</h4>
<p>Better than nothing <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span></p>



<a name="259278065"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/how%20to%20avoid%20%60int_algebra%60%20diamond/near/259278065" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/how.20to.20avoid.20.60int_algebra.60.20diamond.html#259278065">(Oct 27 2021 at 17:46)</a>:</h4>
<p>Here even if we make every ring a Z-algebra as part of the definition, we still can't have <code>foo</code> because it says precisely that A-algebra structures can be pushed along homomorphisms, and we don't want to push it in this one specific case when A=Z</p>



<a name="259288416"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/how%20to%20avoid%20%60int_algebra%60%20diamond/near/259288416" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/how.20to.20avoid.20.60int_algebra.60.20diamond.html#259288416">(Oct 27 2021 at 18:52)</a>:</h4>
<p>I'm trying to redefine <code>algebra</code> in <a href="https://github.com/leanprover-community/mathlib/tree/redefine-algebra">branch#redefine-algebra</a> so that <code>algebra_map</code> is no longer part of the typeclass.</p>



<a name="259288573"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/how%20to%20avoid%20%60int_algebra%60%20diamond/near/259288573" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/how.20to.20avoid.20.60int_algebra.60.20diamond.html#259288573">(Oct 27 2021 at 18:53)</a>:</h4>
<p>The only downside is that we loose nice definitional equalities for <code>algebra_map</code> but I think that we can live without them.</p>



<a name="259306831"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/how%20to%20avoid%20%60int_algebra%60%20diamond/near/259306831" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/how.20to.20avoid.20.60int_algebra.60.20diamond.html#259306831">(Oct 27 2021 at 21:09)</a>:</h4>
<p><code>foo</code> should never be an instance in the first place</p>



<a name="259306916"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/how%20to%20avoid%20%60int_algebra%60%20diamond/near/259306916" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/how.20to.20avoid.20.60int_algebra.60.20diamond.html#259306916">(Oct 27 2021 at 21:10)</a>:</h4>
<p>Even if you remove <code>algebra_map</code> it creates diamonds in <code>smul</code></p>



<a name="259318197"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/how%20to%20avoid%20%60int_algebra%60%20diamond/near/259318197" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/how.20to.20avoid.20.60int_algebra.60.20diamond.html#259318197">(Oct 27 2021 at 22:54)</a>:</h4>
<p><span class="user-mention silent" data-user-id="214703">Yury G. Kudryashov</span> <a href="#narrow/stream/116395-maths/topic/how.20to.20avoid.20.60int_algebra.60.20diamond/near/259288416">said</a>:</p>
<blockquote>
<p>I'm trying to redefine <code>algebra</code> in <a href="https://github.com/leanprover-community/mathlib/tree/redefine-algebra">branch#redefine-algebra</a> so that <code>algebra_map</code> is no longer part of the typeclass.</p>
</blockquote>
<p>Oh wow, this seems to delete a bunch of code, which is a good sign. Do you think this solves the problem?</p>



<a name="259321063"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/how%20to%20avoid%20%60int_algebra%60%20diamond/near/259321063" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/how.20to.20avoid.20.60int_algebra.60.20diamond.html#259321063">(Oct 27 2021 at 23:29)</a>:</h4>
<p>To be clear, "the problem" is not really anything to do with the thing at the top of this thread, but is instead:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">algebra.algebra.basic</span>

<span class="kd">example</span> <span class="o">:</span> <span class="n">algebra.id</span> <span class="n">ℕ</span> <span class="bp">=</span> <span class="n">algebra_nat</span> <span class="o">:=</span> <span class="n">rfl</span> <span class="c1">-- fails, because...</span>

<span class="kd">example</span> <span class="o">:</span> <span class="bp">@</span><span class="n">algebra.to_has_scalar</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="o">(</span><span class="n">algebra.id</span> <span class="n">ℕ</span><span class="o">)</span> <span class="bp">=</span> <span class="bp">@</span><span class="n">algebra.to_has_scalar</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="n">algebra_nat</span> <span class="o">:=</span>
<span class="n">rfl</span> <span class="c1">-- while this works thanks to the nat-module refactor</span>

<span class="kd">example</span> <span class="o">:</span> <span class="bp">@</span><span class="n">algebra.to_ring_hom</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="o">(</span><span class="n">algebra.id</span> <span class="n">ℕ</span><span class="o">)</span> <span class="bp">=</span> <span class="bp">@</span><span class="n">algebra.to_ring_hom</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="n">algebra_nat</span> <span class="o">:=</span>
<span class="n">rfl</span> <span class="c1">-- this does not</span>
</code></pre></div>
<p>Our choice are either:</p>
<ul>
<li>Declare we don't care about <code>algebra_map</code> having a convenient definition, and replace it with <code>1 •</code> as Yury does in their branch.</li>
<li>Decide we still do care about <code>algebra_map</code> having a convenient definition, and add <code>semiring.of_nat</code> / <code>ring.of_int</code> etc, as suggested in my scalar actions talk, which I made a feeble attempt to start in <a href="https://github.com/leanprover-community/mathlib/issues/9525">#9525</a>.</li>
</ul>



<a name="259332705"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/how%20to%20avoid%20%60int_algebra%60%20diamond/near/259332705" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/how.20to.20avoid.20.60int_algebra.60.20diamond.html#259332705">(Oct 28 2021 at 02:30)</a>:</h4>
<p>With my approach we get a definition of <code>algebra</code> that works for non-associative algebras.</p>



<a name="259349155"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/how%20to%20avoid%20%60int_algebra%60%20diamond/near/259349155" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/how.20to.20avoid.20.60int_algebra.60.20diamond.html#259349155">(Oct 28 2021 at 07:22)</a>:</h4>
<p>We already can express non-associative algebras as <code>[module R A] [smul_comm_class R A A] [is_scalar_tower R A A]</code>, and indeed many of the instances for that already exist</p>



<a name="259349233"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/how%20to%20avoid%20%60int_algebra%60%20diamond/near/259349233" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/how.20to.20avoid.20.60int_algebra.60.20diamond.html#259349233">(Oct 28 2021 at 07:23)</a>:</h4>
<p>(I'm sure you knew that, but maybe not every reader of your message did)</p>



<a name="259349395"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/how%20to%20avoid%20%60int_algebra%60%20diamond/near/259349395" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/how.20to.20avoid.20.60int_algebra.60.20diamond.html#259349395">(Oct 28 2021 at 07:25)</a>:</h4>
<p><code>extends ...</code> is exactly the definition in <a href="https://github.com/leanprover-community/mathlib/tree/redefine-algebra">branch#redefine-algebra</a>. I think that we should try to minimize the amount of data in typeclasses (unless we really have to introduce it to avoid diamonds).</p>



<a name="259349550"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/how%20to%20avoid%20%60int_algebra%60%20diamond/near/259349550" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/how.20to.20avoid.20.60int_algebra.60.20diamond.html#259349550">(Oct 28 2021 at 07:27)</a>:</h4>
<p>I think I'm willing to give up defeq properties of <code>algebra_map</code>.</p>



<a name="259350352"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/how%20to%20avoid%20%60int_algebra%60%20diamond/near/259350352" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastien Gouezel <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/how.20to.20avoid.20.60int_algebra.60.20diamond.html#259350352">(Oct 28 2021 at 07:36)</a>:</h4>
<p>The less data there is, the less risk of diamonds, so I'd also go for the dataless definition. Defeqness properties are just an implementation detail that we shouldn't rely on too much in any case.</p>



<a name="259350508"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/how%20to%20avoid%20%60int_algebra%60%20diamond/near/259350508" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/how.20to.20avoid.20.60int_algebra.60.20diamond.html#259350508">(Oct 28 2021 at 07:38)</a>:</h4>
<p>I'll try to fix compilation of <a href="https://github.com/leanprover-community/mathlib/tree/redefine-algebra">branch#redefine-algebra</a> next week.</p>



<a name="259350627"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/how%20to%20avoid%20%60int_algebra%60%20diamond/near/259350627" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/how.20to.20avoid.20.60int_algebra.60.20diamond.html#259350627">(Oct 28 2021 at 07:40)</a>:</h4>
<p>BTW, is <a href="https://leanprover-community.github.io/mathlib_docs/find/subalgebra.under">docs#subalgebra.under</a> a particular case of <a href="https://leanprover-community.github.io/mathlib_docs/find/subalgebra.restrict_scalars">docs#subalgebra.restrict_scalars</a>?</p>



<a name="259350823"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/how%20to%20avoid%20%60int_algebra%60%20diamond/near/259350823" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/how.20to.20avoid.20.60int_algebra.60.20diamond.html#259350823">(Oct 28 2021 at 07:42)</a>:</h4>
<p>I only learnt about the "extend <code>smul_comm_class</code> and <code>is_scalar_tower</code>" approach from looking at Yury's branch. Wow! Is this the way forward? It removes data from the typeclass system so that's surely a good thing</p>



<a name="259351569"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/how%20to%20avoid%20%60int_algebra%60%20diamond/near/259351569" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/how.20to.20avoid.20.60int_algebra.60.20diamond.html#259351569">(Oct 28 2021 at 07:51)</a>:</h4>
<p>It was in my FMM2021 presentation too ;), months ago</p>



<a name="259351724"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/how%20to%20avoid%20%60int_algebra%60%20diamond/near/259351724" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/how.20to.20avoid.20.60int_algebra.60.20diamond.html#259351724">(Oct 28 2021 at 07:53)</a>:</h4>
<p>If we do go in Yury's direction, do we want to copy the recent change from <code>[integral_domain X]</code> to <code>[comm_ring X] [is_domain X]</code> by replacing <code>[algebra R A]</code> with <code>[module R A] [is_algebra R A]</code>?</p>



<a name="259352048"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/how%20to%20avoid%20%60int_algebra%60%20diamond/near/259352048" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/how.20to.20avoid.20.60int_algebra.60.20diamond.html#259352048">(Oct 28 2021 at 07:56)</a>:</h4>
<p>What I like about this is that it shows that an R-algebra A is just a non-homogeneous multiplication R x A -&gt; A satisfying some axioms</p>



<a name="259352075"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/how%20to%20avoid%20%60int_algebra%60%20diamond/near/259352075" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/how.20to.20avoid.20.60int_algebra.60.20diamond.html#259352075">(Oct 28 2021 at 07:56)</a>:</h4>
<p>I had never really internalised this</p>



<a name="259352084"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/how%20to%20avoid%20%60int_algebra%60%20diamond/near/259352084" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/how.20to.20avoid.20.60int_algebra.60.20diamond.html#259352084">(Oct 28 2021 at 07:56)</a>:</h4>
<p>Either way, the reality is that we end up with instances that almost ubiquitously look like</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">instance</span> <span class="o">:</span> <span class="n">algebra</span> <span class="n">R</span> <span class="n">my_type</span> <span class="o">:=</span>
<span class="o">{</span> <span class="bp">..</span><span class="n">my_type.smul_comm_class</span><span class="o">,</span>
  <span class="bp">..</span><span class="n">my_type.is_scalar_tower</span><span class="o">,</span>
  <span class="bp">..</span><span class="n">my_type.module</span> <span class="o">}</span>
</code></pre></div>
<p>like they already do for <a href="https://leanprover-community.github.io/mathlib_docs/find/is_domain">docs#is_domain</a>.</p>



<a name="259352224"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/how%20to%20avoid%20%60int_algebra%60%20diamond/near/259352224" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/how.20to.20avoid.20.60int_algebra.60.20diamond.html#259352224">(Oct 28 2021 at 07:58)</a>:</h4>
<p>Wait though, my current model is that it's just a map R -&gt; A satisfying some axioms</p>



<a name="259352261"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/how%20to%20avoid%20%60int_algebra%60%20diamond/near/259352261" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/how.20to.20avoid.20.60int_algebra.60.20diamond.html#259352261">(Oct 28 2021 at 07:58)</a>:</h4>
<p>How come the new model is better?</p>



<a name="259352346"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/how%20to%20avoid%20%60int_algebra%60%20diamond/near/259352346" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/how.20to.20avoid.20.60int_algebra.60.20diamond.html#259352346">(Oct 28 2021 at 07:59)</a>:</h4>
<p>The old model is properties of <code>(• 1) = algebra_map</code>, the new one is properties of <code>(•)</code>. You need 1 : A to talk about the first one</p>



<a name="259352537"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/how%20to%20avoid%20%60int_algebra%60%20diamond/near/259352537" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/how.20to.20avoid.20.60int_algebra.60.20diamond.html#259352537">(Oct 28 2021 at 08:01)</a>:</h4>
<p>But I emphasize again that we already have the tools to talk about the situation without 1 : A, so really this is an argument about how we want to spell things and if anyone cares about algebra_map</p>



<a name="259353340"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/how%20to%20avoid%20%60int_algebra%60%20diamond/near/259353340" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/how.20to.20avoid.20.60int_algebra.60.20diamond.html#259353340">(Oct 28 2021 at 08:08)</a>:</h4>
<p>In particular I suspect the key benefit to <code>algebra_map</code> is that <code>algebra_map R R = id</code> is (intended to be, and in most cases other than the one titling this thread already is) true definitionally. As another example, <code>algebra_map ℝ ℂ r = ⟨r, 0⟩</code>  is true definitionally right now. In Yury's branch, it becomes <code>algebra_map ℝ ℂ r = ⟨r*1 - 0*0, r*0 + 0*1⟩</code> (see <a href="https://leanprover-community.github.io/mathlib_docs/find/complex.has_scalar/src">src#complex.has_scalar</a> to see why).</p>



<a name="259358451"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/how%20to%20avoid%20%60int_algebra%60%20diamond/near/259358451" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/how.20to.20avoid.20.60int_algebra.60.20diamond.html#259358451">(Oct 28 2021 at 08:57)</a>:</h4>
<p><span class="user-mention" data-user-id="310045">@Eric Wieser</span> Do you think it makes sense to remove <code>algebra</code> completely?</p>



<a name="259359209"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/how%20to%20avoid%20%60int_algebra%60%20diamond/near/259359209" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/how.20to.20avoid.20.60int_algebra.60.20diamond.html#259359209">(Oct 28 2021 at 09:03)</a>:</h4>
<p>Only if we decide we no longer want to control <code>algebra_map</code> definitionally, as Yury has already done on their branch</p>



<a name="259359668"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/how%20to%20avoid%20%60int_algebra%60%20diamond/near/259359668" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/how.20to.20avoid.20.60int_algebra.60.20diamond.html#259359668">(Oct 28 2021 at 09:07)</a>:</h4>
<p>My rough order of preference (ignoring the "what mathetaticians want to read" aspect) is:</p>
<ol>
<li>Leave typeclasses as they are, add <code>ring.of_int</code> etc to fix the diamonds</li>
<li>Remove <code>algebra</code> with no replacement, use <code>[smul_comm_class R A A] [is_scalar_tower R A A]</code> as we already can today</li>
<li>Remove <code>algebra</code>, introduce <code>class is_algebra R A extends smul_comm_class R A A, is_scalar_tower R A A</code> for convenience</li>
<li>Remove <code>algebra.to_ring_hom</code> from the definition of <code>algebra</code> as Yury does in the branch above.</li>
</ol>
<p>Note that in Lean 4, we can (probably) have <code>instance [smul_comm_class R A A] [is_scalar_tower R A A] : is_algebra R A</code> without forming a loop, which removes all the downsides of option 3 over option 2.</p>



<a name="259359824"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/how%20to%20avoid%20%60int_algebra%60%20diamond/near/259359824" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/how.20to.20avoid.20.60int_algebra.60.20diamond.html#259359824">(Oct 28 2021 at 09:08)</a>:</h4>
<p>I really want Lean 4. Those loops will be so extremely useful!</p>



<a name="259360009"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/how%20to%20avoid%20%60int_algebra%60%20diamond/near/259360009" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/how.20to.20avoid.20.60int_algebra.60.20diamond.html#259360009">(Oct 28 2021 at 09:10)</a>:</h4>
<p>I'm a little scared they might not work quite as well as described in the case of dependent typeclasses like <code>module</code>, but I guess we'll find out eventually and this isn't the thread to speculate about that.</p>



<a name="259364731"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/how%20to%20avoid%20%60int_algebra%60%20diamond/near/259364731" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/how.20to.20avoid.20.60int_algebra.60.20diamond.html#259364731">(Oct 28 2021 at 09:58)</a>:</h4>
<p>I don't understand how <code>ring.of_int</code> would solve the problem of being able to construct the <code>algebra A C</code> instance from <code>algebra A B</code> and <code>algebra B C</code> in a safe way</p>



<a name="259365212"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/how%20to%20avoid%20%60int_algebra%60%20diamond/near/259365212" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/how.20to.20avoid.20.60int_algebra.60.20diamond.html#259365212">(Oct 28 2021 at 10:03)</a>:</h4>
<p><span class="user-mention" data-user-id="110038">@Kevin Buzzard</span> But that can't be an instance anyway, because how can Lean find <code>B</code> if it only knows <code>algebra A C</code>. It won't know where to look (at least with the current algorithm).</p>



<a name="259368371"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/how%20to%20avoid%20%60int_algebra%60%20diamond/near/259368371" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/how.20to.20avoid.20.60int_algebra.60.20diamond.html#259368371">(Oct 28 2021 at 10:34)</a>:</h4>
<p>I'm pretty sure requiring that to not form a diamond is the same as requiring <code>a • (1 : B) • c = a • c</code> definitionally for all choices of <code>B</code></p>



<a name="259368390"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/how%20to%20avoid%20%60int_algebra%60%20diamond/near/259368390" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/how.20to.20avoid.20.60int_algebra.60.20diamond.html#259368390">(Oct 28 2021 at 10:34)</a>:</h4>
<p>Which seems like a pretty outrageous requirement</p>



<a name="259374233"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/how%20to%20avoid%20%60int_algebra%60%20diamond/near/259374233" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/how.20to.20avoid.20.60int_algebra.60.20diamond.html#259374233">(Oct 28 2021 at 11:32)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110038">Kevin Buzzard</span> <a href="#narrow/stream/116395-maths/topic/how.20to.20avoid.20.60int_algebra.60.20diamond/near/259352048">said</a>:</p>
<blockquote>
<p>What I like about this is that it shows that an R-algebra A is just a non-homogeneous multiplication R x A -&gt; A satisfying some axioms<br>
I had never really internalised this</p>
</blockquote>
<p>This is really funny. I never heard of algebras seen as maps from R to A before mathlib. I was taught about the non-homogeneous multiplication version.</p>



<a name="259389442"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/how%20to%20avoid%20%60int_algebra%60%20diamond/near/259389442" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastien Gouezel <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/how.20to.20avoid.20.60int_algebra.60.20diamond.html#259389442">(Oct 28 2021 at 13:40)</a>:</h4>
<p><span class="user-mention silent" data-user-id="310045">Eric Wieser</span> <a href="#narrow/stream/116395-maths/topic/how.20to.20avoid.20.60int_algebra.60.20diamond/near/259359668">said</a>:</p>
<blockquote>
<p>My rough order of preference (ignoring the "what mathetaticians want to read" aspect) is:</p>
<ol>
<li>Leave typeclasses as they are, add <code>ring.of_int</code> etc to fix the diamonds</li>
<li>Remove <code>algebra</code> with no replacement, use <code>[smul_comm_class R A A] [is_scalar_tower R A A]</code> as we already can today</li>
<li>Remove <code>algebra</code>, introduce <code>class is_algebra R A extends smul_comm_class R A A, is_scalar_tower R A A</code> for convenience</li>
<li>Remove <code>algebra.to_ring_hom</code> from the definition of <code>algebra</code> as Yury does in the branch above.</li>
</ol>
<p>Note that in Lean 4, we can (probably) have <code>instance [smul_comm_class R A A] [is_scalar_tower R A A] : is_algebra R A</code> without forming a loop, which removes all the downsides of option 3 over option 2.</p>
</blockquote>
<p>I'd vote for 3, and then 4. I don't really like 2 because of the "what mathematicians want to read" aspect, and I don't like 1 because it feels like opening the possibility to shoot oneself in the knee when there is no need for it.</p>



<a name="259394720"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/how%20to%20avoid%20%60int_algebra%60%20diamond/near/259394720" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/how.20to.20avoid.20.60int_algebra.60.20diamond.html#259394720">(Oct 28 2021 at 14:17)</a>:</h4>
<p>What does <code>1</code> mean? You mean change the definition of <code>ring</code> to give it a canonical map from the integers? I don't understand how this fixes things. I like the look of 3 as well.</p>



<a name="259399282"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/how%20to%20avoid%20%60int_algebra%60%20diamond/near/259399282" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/how.20to.20avoid.20.60int_algebra.60.20diamond.html#259399282">(Oct 28 2021 at 14:45)</a>:</h4>
<p>I suspect you don't understand how it fixes things because "things" to you is <a href="#narrow/stream/116395-maths/topic/how.20to.20avoid.20.60int_algebra.60.20diamond/near/259272573">the example at the top of this thread</a> that is not really possible at all. It fixes the <code>example</code>s <a href="#narrow/stream/116395-maths/topic/how.20to.20avoid.20.60int_algebra.60.20diamond/near/259321063">I post above</a> for the same reason that the <code>smul</code> ones are already fixed.</p>



<a name="259399834"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/how%20to%20avoid%20%60int_algebra%60%20diamond/near/259399834" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/how.20to.20avoid.20.60int_algebra.60.20diamond.html#259399834">(Oct 28 2021 at 14:48)</a>:</h4>
<p>I guess the fix for my original issue is to make <code>algebra_int</code> not an instance</p>



<a name="259399941"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/how%20to%20avoid%20%60int_algebra%60%20diamond/near/259399941" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/how.20to.20avoid.20.60int_algebra.60.20diamond.html#259399941">(Oct 28 2021 at 14:49)</a>:</h4>
<p>Your original issue will almost always make diamonds if <code>algebra A C</code> already exists, and it usually does. And the instance is illegal anyway as B can't be inferred</p>



<a name="259400012"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/how%20to%20avoid%20%60int_algebra%60%20diamond/near/259400012" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastien Gouezel <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/how.20to.20avoid.20.60int_algebra.60.20diamond.html#259400012">(Oct 28 2021 at 14:49)</a>:</h4>
<p>Just to be clear: the instance in the first message of this thread is:</p>
<p><span class="user-mention silent" data-user-id="110038">Kevin Buzzard</span> <a href="#narrow/stream/116395-maths/topic/how.20to.20avoid.20.60int_algebra.60.20diamond/near/259272573">said</a>:</p>
<blockquote>
<p>The following instance</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">algebra.algebra.basic</span>

<span class="kd">instance</span> <span class="n">foo</span> <span class="o">(</span><span class="n">A</span> <span class="n">B</span> <span class="n">C</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">[</span><span class="n">comm_ring</span> <span class="n">A</span><span class="o">]</span> <span class="o">[</span><span class="n">comm_ring</span> <span class="n">B</span><span class="o">]</span> <span class="o">[</span><span class="n">comm_ring</span> <span class="n">C</span><span class="o">]</span>
  <span class="o">[</span><span class="n">algebra</span> <span class="n">A</span> <span class="n">B</span><span class="o">]</span> <span class="o">[</span><span class="n">algebra</span> <span class="n">B</span> <span class="n">C</span><span class="o">]</span> <span class="o">:</span> <span class="n">algebra</span> <span class="n">A</span> <span class="n">C</span> <span class="o">:=</span>
<span class="o">((</span><span class="n">algebra_map</span> <span class="n">B</span> <span class="n">C</span><span class="o">)</span><span class="bp">.</span><span class="n">comp</span> <span class="o">(</span><span class="n">algebra_map</span> <span class="n">A</span> <span class="n">B</span><span class="o">))</span><span class="bp">.</span><span class="n">to_algebra</span>
</code></pre></div>
<p>causes problems, because <code>algebra_int R : algebra ℤ R</code> is an instance, so if <code>R</code> and <code>S</code> are <code>comm_ring</code>s and <code>[algebra R S]</code> then <code>foo</code> and <code>algebra_int</code> give two non-defeq instances of <code>algebra ℤ S</code>. I don't see a way around this right now. This came up in <a class="stream" data-stream-id="304774" href="/#narrow/stream/304774-FLT-regular">#FLT regular</a> .</p>
</blockquote>
<p>This can not be an instance, because there is no way to guess <code>B</code> from the goal <code>algebra A C</code>.</p>



<a name="259400227"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/how%20to%20avoid%20%60int_algebra%60%20diamond/near/259400227" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/how.20to.20avoid.20.60int_algebra.60.20diamond.html#259400227">(Oct 28 2021 at 14:50)</a>:</h4>
<p>I see, so one just has to make the instance manually in the original setting where we know B</p>



<a name="259400317"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/how%20to%20avoid%20%60int_algebra%60%20diamond/near/259400317" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/how.20to.20avoid.20.60int_algebra.60.20diamond.html#259400317">(Oct 28 2021 at 14:51)</a>:</h4>
<p>Exactly, and in most places we do just that (eg, see <a href="https://leanprover-community.github.io/mathlib_docs/find/algebra.prod.algebra">docs#algebra.prod.algebra</a>, which provides all algebra structures not just the <code>A (prod A A)</code> one). The instance is missing for <code>spitting_field</code> which is what started this problem, but I have a local branch that starts fixing it.</p>



<a name="259400790"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/how%20to%20avoid%20%60int_algebra%60%20diamond/near/259400790" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/how.20to.20avoid.20.60int_algebra.60.20diamond.html#259400790">(Oct 28 2021 at 14:54)</a>:</h4>
<p>Regarding <span class="user-mention" data-user-id="110050">@Sebastien Gouezel</span>'s objection to 1, I'd argue since <code>ring</code> already has three foot-guns (nsmul, zsmul, npow), adding two more (<code>of_nat</code> and <code>of_int</code>) is not all that much worse. I guess the counterargument is we had no other choice but to add the existing 3, but we do have a choice here.</p>



<a name="259400910"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/how%20to%20avoid%20%60int_algebra%60%20diamond/near/259400910" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/how.20to.20avoid.20.60int_algebra.60.20diamond.html#259400910">(Oct 28 2021 at 14:54)</a>:</h4>
<p><span aria-label="+1" class="emoji emoji-1f44d" role="img" title="+1">:+1:</span> for the counterargument.</p>



<a name="259401167"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/how%20to%20avoid%20%60int_algebra%60%20diamond/near/259401167" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/how.20to.20avoid.20.60int_algebra.60.20diamond.html#259401167">(Oct 28 2021 at 14:56)</a>:</h4>
<p>Losing <code>rfl : algebra_map ℝ ℂ r = ⟨r, 0⟩</code> and <code>rfl : algebra_map α (α × α) a = (a, a)</code> seems like the most visible annoyance with options 2, 3, and 4</p>



<a name="259401377"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/how%20to%20avoid%20%60int_algebra%60%20diamond/near/259401377" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/how.20to.20avoid.20.60int_algebra.60.20diamond.html#259401377">(Oct 28 2021 at 14:57)</a>:</h4>
<p>We don't have <code>rfl : a / b = a * b⁻¹</code>!</p>



<a name="259401551"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/how%20to%20avoid%20%60int_algebra%60%20diamond/near/259401551" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/how.20to.20avoid.20.60int_algebra.60.20diamond.html#259401551">(Oct 28 2021 at 14:58)</a>:</h4>
<p>How is that related?</p>



<a name="259401681"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/how%20to%20avoid%20%60int_algebra%60%20diamond/near/259401681" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/how.20to.20avoid.20.60int_algebra.60.20diamond.html#259401681">(Oct 28 2021 at 14:59)</a>:</h4>
<p><span class="user-mention silent" data-user-id="214703">Yury G. Kudryashov</span>, That almost makes the opposite argument; <code>div</code>,<code>inv</code>, and <code>div_eq_mul_inv</code> are analogous to <code>algebra_map</code>, <code>smul</code>, and <code>algebra.smul_def</code></p>



<a name="259401709"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/how%20to%20avoid%20%60int_algebra%60%20diamond/near/259401709" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/how.20to.20avoid.20.60int_algebra.60.20diamond.html#259401709">(Oct 28 2021 at 14:59)</a>:</h4>
<p>I am coming to terms with (a) losing readability of internal definitions of things like groups and (b) losing rfl. I wouldn't like to claim that lists in [insert your favourite language here] are implemented as [insert your naive idea about how to implement lists in this langauge], so maybe other people shouldn't assume that groups are implemented in the obvious way. And rfl is overrated.</p>



<a name="259402271"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/how%20to%20avoid%20%60int_algebra%60%20diamond/near/259402271" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/how.20to.20avoid.20.60int_algebra.60.20diamond.html#259402271">(Oct 28 2021 at 15:02)</a>:</h4>
<p><span class="user-mention silent" data-user-id="214703">Yury G. Kudryashov</span> <a href="#narrow/stream/116395-maths/topic/how.20to.20avoid.20.60int_algebra.60.20diamond/near/259401377">said</a>:</p>
<blockquote>
<p>We don't have <code>rfl : a / b = a * b⁻¹</code>!</p>
</blockquote>
<p>It's funny. Here we added extra data to tear the rfl apart. But with algebra_map we are removing data.</p>



<a name="259402371"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/how%20to%20avoid%20%60int_algebra%60%20diamond/near/259402371" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/how.20to.20avoid.20.60int_algebra.60.20diamond.html#259402371">(Oct 28 2021 at 15:03)</a>:</h4>
<p>I meant that we can live without some very natural <code>rfl</code>s.</p>



<a name="259402377"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/how%20to%20avoid%20%60int_algebra%60%20diamond/near/259402377" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/how.20to.20avoid.20.60int_algebra.60.20diamond.html#259402377">(Oct 28 2021 at 15:03)</a>:</h4>
<blockquote>
<p>Here we added extra data to tear the rfl apart.</p>
</blockquote>
<p>More accurately, we added extra data in order to allow us to choose which things were rfl in concrete cases, and remove things that were rfl from abstract cases</p>



<a name="259402456"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/how%20to%20avoid%20%60int_algebra%60%20diamond/near/259402456" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/how.20to.20avoid.20.60int_algebra.60.20diamond.html#259402456">(Oct 28 2021 at 15:04)</a>:</h4>
<p>(I'll be away for the next 2 hours)</p>



<a name="259402542"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/how%20to%20avoid%20%60int_algebra%60%20diamond/near/259402542" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/how.20to.20avoid.20.60int_algebra.60.20diamond.html#259402542">(Oct 28 2021 at 15:04)</a>:</h4>
<p>So adding <code>div_eq_mul_inv</code> did not quite remove "very natural <code>rfl</code>s", but it said "the choice of what is natural might depend on the type", and indeed was motivated by "very natural <code>rfl</code>s" on ideals that didn't match the generic "very natural <code>rfl</code>".</p>



<a name="259402736"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/how%20to%20avoid%20%60int_algebra%60%20diamond/near/259402736" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/how.20to.20avoid.20.60int_algebra.60.20diamond.html#259402736">(Oct 28 2021 at 15:06)</a>:</h4>
<p>In the same way, the natural <code>rfl</code> on a general (unitary) algebra is <code>algebra_map R A r = r • (1 : A)</code>, but in a specific one there are almost always more natural choices</p>



<a name="259402801"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/how%20to%20avoid%20%60int_algebra%60%20diamond/near/259402801" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/how.20to.20avoid.20.60int_algebra.60.20diamond.html#259402801">(Oct 28 2021 at 15:06)</a>:</h4>
<p>That's true.</p>



<a name="259402923"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/how%20to%20avoid%20%60int_algebra%60%20diamond/near/259402923" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/how.20to.20avoid.20.60int_algebra.60.20diamond.html#259402923">(Oct 28 2021 at 15:07)</a>:</h4>
<p>But of course, the difference is that the cost of mistakenly keeping the default <code>div</code> is usually just some annoying non-rfl lemmas (usually things like <code>coe_div</code> not being <code>rfl</code>), whereas the cost of mistakenly keeping the default <code>of_nat</code> would be diamonds, just like it is for <code>nsmul</code>.</p>



<a name="259405367"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/how%20to%20avoid%20%60int_algebra%60%20diamond/near/259405367" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/how.20to.20avoid.20.60int_algebra.60.20diamond.html#259405367">(Oct 28 2021 at 15:24)</a>:</h4>
<p>Someone has surely already said this, but at some point we will want that sequences converging to zero form a real algebra. And in this case <code>algebra_map</code> really does not exist.</p>



<a name="259407534"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/how%20to%20avoid%20%60int_algebra%60%20diamond/near/259407534" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastien Gouezel <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/how.20to.20avoid.20.60int_algebra.60.20diamond.html#259407534">(Oct 28 2021 at 15:39)</a>:</h4>
<p><span class="user-mention silent" data-user-id="310045">Eric Wieser</span> <a href="#narrow/stream/116395-maths/topic/how.20to.20avoid.20.60int_algebra.60.20diamond/near/259402377">said</a>:</p>
<blockquote>
<blockquote>
<p>Here we added extra data to tear the rfl apart.</p>
</blockquote>
<p>More accurately, we added extra data in order to allow us to choose which things were rfl in concrete cases, and remove things that were rfl from abstract cases</p>
</blockquote>
<p>Even more accurately, we added extra data here to kill a non-defeq diamond in typeclass inference. Which, to me, is the only situation where we should fight for defeqness. In the algebra situation, I agree that adding fields for nat and int embedding would solve the nat and int algebra diamond, but I fear there may be other algebra-related diamonds elsewhere (yet to be seen). Just removing the data from the definition is a nice way to kill all of them, once and for all.</p>



<a name="259407770"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/how%20to%20avoid%20%60int_algebra%60%20diamond/near/259407770" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/how.20to.20avoid.20.60int_algebra.60.20diamond.html#259407770">(Oct 28 2021 at 15:40)</a>:</h4>
<p>But we are not removing the data, right? Instead of giving <code>R -&gt; A</code> we're giving <code>R -&gt; A -&gt; A</code></p>



<a name="259407999"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/how%20to%20avoid%20%60int_algebra%60%20diamond/near/259407999" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/how.20to.20avoid.20.60int_algebra.60.20diamond.html#259407999">(Oct 28 2021 at 15:42)</a>:</h4>
<p>Currently we are giving both</p>



<a name="259408011"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/how%20to%20avoid%20%60int_algebra%60%20diamond/near/259408011" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastien Gouezel <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/how.20to.20avoid.20.60int_algebra.60.20diamond.html#259408011">(Oct 28 2021 at 15:42)</a>:</h4>
<p>We're using a module structure which, supposedly, is already there. So, we avoid adding more data on top of a module structure.</p>



<a name="259408180"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/how%20to%20avoid%20%60int_algebra%60%20diamond/near/259408180" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/how.20to.20avoid.20.60int_algebra.60.20diamond.html#259408180">(Oct 28 2021 at 15:43)</a>:</h4>
<p>Oh so we are!</p>



<a name="259409097"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/how%20to%20avoid%20%60int_algebra%60%20diamond/near/259409097" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/how.20to.20avoid.20.60int_algebra.60.20diamond.html#259409097">(Oct 28 2021 at 15:50)</a>:</h4>
<p>Regarding whether the definition of an A-algebra is a ring hom or a module with a multiplication, I think Atiyah--Macdonald say it all:</p>
<blockquote>
<p>Let f:A-&gt;B be a ring homomorphism. If a in A and b in B, define a product ab:=f(a)b. This definition makes the ring B into an A-module...Thus B has an A-module structure as well as a ring structure, and these two structures are compatible in a sense which the reader will be able to formulate for himself. The ring B equipped with this A-module structure is said to be an <em>A-algebra</em> [in italics, so this is the definition]. Thus  an A-algebra is, by definition, a ring B together with a ring homomorphism f : A -&gt; B</p>
</blockquote>
<p>In other words, both definitions are "the definition", by definition.</p>



<a name="259420969"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/how%20to%20avoid%20%60int_algebra%60%20diamond/near/259420969" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Julian Külshammer <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/how.20to.20avoid.20.60int_algebra.60.20diamond.html#259420969">(Oct 28 2021 at 17:07)</a>:</h4>
<p>They don't quite "say it all" as they have this strange standing assumption that B is commutative, so they are missing the condition that the image of the ring homomorphism is in the centre of B. :-)</p>



<a name="259422970"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/how%20to%20avoid%20%60int_algebra%60%20diamond/near/259422970" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/how.20to.20avoid.20.60int_algebra.60.20diamond.html#259422970">(Oct 28 2021 at 17:20)</a>:</h4>
<p>All noncommutative rings are central simple algebras, right?</p>



<a name="259423064"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/how%20to%20avoid%20%60int_algebra%60%20diamond/near/259423064" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/how.20to.20avoid.20.60int_algebra.60.20diamond.html#259423064">(Oct 28 2021 at 17:21)</a>:</h4>
<p>Anyway, I'm more and more starting to like (3). Should we have a vote?</p>



<a name="259434227"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/how%20to%20avoid%20%60int_algebra%60%20diamond/near/259434227" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/how.20to.20avoid.20.60int_algebra.60.20diamond.html#259434227">(Oct 28 2021 at 18:46)</a>:</h4>
<p><span class="user-mention" data-user-id="110050">@Sebastien Gouezel</span>, my message you quote was about div_inv_monoid where AFAIR there was no diamond</p>



<a name="259436119"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/how%20to%20avoid%20%60int_algebra%60%20diamond/near/259436119" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/how.20to.20avoid.20.60int_algebra.60.20diamond.html#259436119">(Oct 28 2021 at 18:59)</a>:</h4>
<p>Perhaps <span class="user-mention" data-user-id="238446">@Anne Baanen</span> can recall the motivation there</p>



<a name="259436150"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/how%20to%20avoid%20%60int_algebra%60%20diamond/near/259436150" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/how.20to.20avoid.20.60int_algebra.60.20diamond.html#259436150">(Oct 28 2021 at 18:59)</a>:</h4>
<p>(I think they're on vacation right now?)</p>



<a name="259439487"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/how%20to%20avoid%20%60int_algebra%60%20diamond/near/259439487" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/how.20to.20avoid.20.60int_algebra.60.20diamond.html#259439487">(Oct 28 2021 at 19:25)</a>:</h4>
<p>I think the issue was that you can always define <code>I * J</code> for ideals. And then, for suitable rings, you can define <code>I⁻¹</code> and <code>I / J</code>. These definitions are only compatible for Dedekind rings, or so. But they are useful in a more general setting.</p>



<a name="259439879"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/how%20to%20avoid%20%60int_algebra%60%20diamond/near/259439879" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Anne Baanen <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/how.20to.20avoid.20.60int_algebra.60.20diamond.html#259439879">(Oct 28 2021 at 19:28)</a>:</h4>
<p>I am indeed on vacation, but it's raining so I decided to check my notifications, apparently exactly at the right moment :)</p>
<p>The motivation behind <code>div_inv_monoid</code> was types like <a href="https://leanprover-community.github.io/mathlib_docs/find/fractional_ideal">docs#fractional_ideal</a> that have a well-defined (/) operator in general, and form a group (with 0) in some special cases. So you would get a non-defeq group -&gt; has_div instance.</p>



<a name="259439976"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/how%20to%20avoid%20%60int_algebra%60%20diamond/near/259439976" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/how.20to.20avoid.20.60int_algebra.60.20diamond.html#259439976">(Oct 28 2021 at 19:29)</a>:</h4>
<p>Right, I should have mentioned <em>fractional</em> ideals.</p>



<a name="259449313"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/how%20to%20avoid%20%60int_algebra%60%20diamond/near/259449313" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/how.20to.20avoid.20.60int_algebra.60.20diamond.html#259449313">(Oct 28 2021 at 20:43)</a>:</h4>
<p>Ok, so the original <code>div_inv_monoid</code> motivation doesn't quite apply here as there is no separate <code>has_algebra_map</code> instance that exists independently of  <code>has_scalar</code> - thanks for the explanation.</p>



<a name="259449743"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/how%20to%20avoid%20%60int_algebra%60%20diamond/near/259449743" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/how.20to.20avoid.20.60int_algebra.60.20diamond.html#259449743">(Oct 28 2021 at 20:47)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110050">Sebastien Gouezel</span> <a href="#narrow/stream/116395-maths/topic/how.20to.20avoid.20.60int_algebra.60.20diamond/near/259407534">said</a>:</p>
<blockquote>
<p>but I fear there may be other algebra-related diamonds elsewhere (yet to be seen)</p>
</blockquote>
<p>My hunch is that in the likely event these do exist, they will have corresponding scalar diamond problems anyway; by the time we've fixed those (assuming they're even fixable), it's probably not too much harder to fix the algebra_map problems at the same time. Of course it does still create more work, so I'm sympathetic to the avoid-the-risk viewpoint.</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>