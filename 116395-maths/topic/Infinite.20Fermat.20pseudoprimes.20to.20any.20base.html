---
layout: archive
title: Zulip Chat Archive
permalink: /stream/116395-maths/topic/Infinite.20Fermat.20pseudoprimes.20to.20any.20base.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/116395-maths/index.html">maths</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Infinite.20Fermat.20pseudoprimes.20to.20any.20base.html">Infinite Fermat pseudoprimes to any base</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="304250807"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Infinite%20Fermat%20pseudoprimes%20to%20any%20base/near/304250807" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Niels Voss <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Infinite.20Fermat.20pseudoprimes.20to.20any.20base.html#304250807">(Oct 15 2022 at 22:57)</a>:</h4>
<p>I proved that there are an infinite number of Fermat pseudoprimes to any base starting at 1.<br>
Here are the definitions and type signature of my proof:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">def</span> <span class="n">probable_prime</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="o">(</span><span class="n">b</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="o">:</span> <span class="kt">Prop</span> <span class="o">:=</span> <span class="n">n</span> <span class="bp">∣</span> <span class="n">b</span><span class="bp">^</span><span class="o">(</span><span class="n">n</span> <span class="bp">-</span> <span class="mi">1</span><span class="o">)</span> <span class="bp">-</span> <span class="mi">1</span>
<span class="kd">def</span> <span class="n">fermat_psp</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="o">(</span><span class="n">b</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="o">:</span> <span class="kt">Prop</span> <span class="o">:=</span> <span class="n">nat.coprime</span> <span class="n">n</span> <span class="n">b</span> <span class="bp">∧</span> <span class="n">probable_prime</span> <span class="n">n</span> <span class="n">b</span> <span class="bp">∧</span> <span class="bp">¬</span><span class="n">nat.prime</span> <span class="n">n</span> <span class="bp">∧</span> <span class="n">n</span> <span class="bp">&gt;</span> <span class="mi">1</span>
<span class="kd">theorem</span> <span class="n">exists_infinite_pseudoprimes</span> <span class="o">(</span><span class="n">b</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="n">b</span> <span class="bp">≥</span> <span class="mi">1</span><span class="o">)</span> <span class="o">(</span><span class="n">m</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="o">:</span> <span class="bp">∃</span> <span class="n">n</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">,</span> <span class="n">fermat_psp</span> <span class="n">n</span> <span class="n">b</span> <span class="bp">∧</span> <span class="n">n</span> <span class="bp">≥</span> <span class="n">m</span>
</code></pre></div>
<p>The full proof (including some documentation) can be found here: <a href="https://github.com/osbourn/fermat-pseudoprimes/blob/master/src/fermat_psp.lean">https://github.com/osbourn/fermat-pseudoprimes/blob/master/src/fermat_psp.lean</a></p>
<p>I had a few questions about the proof. I was wondering if the definition for pseudoprime was set up correctly. A textbook I have states that n being coprime with b is a requirement for n to be pseudoprime, but other sources don't seem to include this requirement.<br>
Additionally, because <code>probable_prime</code> was defined using divisibility instead of congruences, all numbers are probable primes to base 0 and 1, and 0 and 1 are probable primes to any base.<br>
This definition for pseudoprime also permits a few pseudoprimes that might be considered trivial. For example, all composite numbers are pseudoprimes to base 1, and 4 is pseudoprime to base 5.</p>
<p>A few other questions I had were:</p>
<ul>
<li>Should the order of the parameters n and b be swapped? Currently <code>fermat_psp 341 2</code> means 341 is a pseudoprime to base 2 but I can see the advantages of swapping them.</li>
<li>Would it have been better to have used modular arithmetic instead of divisibility in the definition?</li>
<li>My proof contains a variety of lemmas which are unrelated to pseudoprimes. Where should I place them?</li>
<li><code>psp_from_prime</code>, <code>psp_from_prime_psp</code>, and <code>psp_from_prime_gt_p</code> are all marked private because I didn't think they had much use outside of proving <code>exists_infinite_pseudoprimes</code>. Should they be marked private?</li>
</ul>



<a name="304284976"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Infinite%20Fermat%20pseudoprimes%20to%20any%20base/near/304284976" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Infinite.20Fermat.20pseudoprimes.20to.20any.20base.html#304284976">(Oct 16 2022 at 09:21)</a>:</h4>
<p>Whether you want n to be coprime with b might depend on whether you're using b^(n-1)-1 or b^n-b. I can believe that there is inconsistency, you might just want to go with whatever it says on Wikipedia. The definition wasn't really designed for edge cases, I wouldn't worry too much about what happens when b is small. People are going to complain if 341 isn't a pseudoprime base 2 but nobody is going to complain if your edge cases are a bit different to their edge cases because it's not the point of the definition. I think the order is fine, it's the order that they are in when we say the phrase in English. For definitions, you reap what you sew. If you've got your definition working then I wouldn't worry. If you want the definition to be equivalent to a statement using modular arithmetic then just prove that statement and give a docstring explaining why it's there.</p>



<a name="304285670"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Infinite%20Fermat%20pseudoprimes%20to%20any%20base/near/304285670" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Infinite.20Fermat.20pseudoprimes.20to.20any.20base.html#304285670">(Oct 16 2022 at 09:28)</a>:</h4>
<p>Lemmas going elsewhere -- which lemmas in particular are you talking about? Link to the permalinks or paste the statements to stop people having to second guess you. Lemmas involving nat subtraction or division always give me pause because they all seem to me to be mathematically unnatural -- if I want to mathematically subtract naturals I would switch to integers. It's your project, you can mark whatever you like as private.</p>



<a name="304355514"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Infinite%20Fermat%20pseudoprimes%20to%20any%20base/near/304355514" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Niels Voss <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Infinite.20Fermat.20pseudoprimes.20to.20any.20base.html#304355514">(Oct 16 2022 at 22:09)</a>:</h4>
<p>One thing I didn't realize when I posted yesterday was that the condition <code>n ∣ b^(n - 1) - 1</code> actually implies that n and b are coprime. I removed the requirement that n and b are coprime from the definition of <code>fermat_psp</code> and added the following two lemmas:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">lemma</span> <span class="n">coprime_of_probable_prime</span> <span class="o">(</span><span class="n">n</span> <span class="n">b</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="n">probable_prime</span> <span class="n">n</span> <span class="n">b</span><span class="o">)</span> <span class="o">(</span><span class="n">h₁</span> <span class="o">:</span> <span class="n">n</span> <span class="bp">≥</span> <span class="mi">1</span><span class="o">)</span> <span class="o">(</span><span class="n">h₂</span> <span class="o">:</span> <span class="n">b</span> <span class="bp">≥</span> <span class="mi">1</span><span class="o">)</span> <span class="o">:</span> <span class="n">nat.coprime</span> <span class="n">n</span> <span class="n">b</span>
<span class="kd">lemma</span> <span class="n">coprime_of_fermat_psp</span> <span class="o">(</span><span class="n">n</span> <span class="n">b</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="n">fermat_psp</span> <span class="n">n</span> <span class="n">b</span><span class="o">)</span> <span class="o">(</span><span class="n">h₁</span> <span class="o">:</span> <span class="n">b</span> <span class="bp">≥</span> <span class="mi">1</span><span class="o">)</span> <span class="o">:</span> <span class="n">nat.coprime</span> <span class="n">n</span> <span class="n">b</span>
</code></pre></div>
<p>I apologize for not being clear when I talked about the extra lemmas. I had to prove the following statements that were unrelated to pseudoprimes for use in my proof:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">lemma</span> <span class="n">diff_squares</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="n">a</span> <span class="bp">≥</span> <span class="n">b</span><span class="o">)</span> <span class="o">:</span> <span class="o">(</span><span class="n">a</span> <span class="bp">+</span> <span class="n">b</span><span class="o">)</span> <span class="bp">*</span> <span class="o">(</span><span class="n">a</span> <span class="bp">-</span> <span class="n">b</span><span class="o">)</span> <span class="bp">=</span> <span class="n">a</span><span class="bp">*</span><span class="n">a</span> <span class="bp">-</span> <span class="n">b</span><span class="bp">*</span><span class="n">b</span>
<span class="kd">lemma</span> <span class="n">not_dvd_of_not_dvd_mul</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="bp">¬</span><span class="n">a</span> <span class="bp">∣</span> <span class="n">b</span> <span class="bp">*</span> <span class="n">c</span><span class="o">)</span> <span class="o">:</span> <span class="bp">¬</span><span class="n">a</span> <span class="bp">∣</span> <span class="n">b</span>
<span class="kd">lemma</span> <span class="n">mul_self</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="o">:</span> <span class="n">n</span> <span class="bp">*</span> <span class="n">n</span> <span class="bp">=</span> <span class="n">n</span> <span class="bp">^</span> <span class="mi">2</span>
<span class="kd">lemma</span> <span class="n">pow_factor</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="n">b</span> <span class="bp">≥</span> <span class="mi">1</span><span class="o">)</span> <span class="o">:</span> <span class="n">a</span><span class="bp">^</span><span class="n">b</span> <span class="bp">=</span> <span class="n">a</span> <span class="bp">*</span> <span class="n">a</span><span class="bp">^</span><span class="o">(</span><span class="n">b</span> <span class="bp">-</span> <span class="mi">1</span><span class="o">)</span>
<span class="kd">lemma</span> <span class="n">odd_of_prime_gt_two</span> <span class="o">(</span><span class="n">p</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="n">nat.prime</span> <span class="n">p</span><span class="o">)</span> <span class="o">(</span><span class="n">hp</span> <span class="o">:</span> <span class="n">p</span> <span class="bp">&gt;</span> <span class="mi">2</span><span class="o">)</span> <span class="o">:</span> <span class="bp">¬</span><span class="mi">2</span> <span class="bp">∣</span> <span class="n">p</span>
<span class="kd">lemma</span> <span class="n">odd_pow_lem</span> <span class="o">(</span><span class="n">a</span> <span class="o">:</span> <span class="n">ℤ</span><span class="o">)</span> <span class="o">(</span><span class="n">n</span> <span class="n">k</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="o">(</span><span class="n">h₁</span> <span class="o">:</span> <span class="n">k</span> <span class="bp">∣</span> <span class="n">n</span><span class="o">)</span> <span class="o">(</span><span class="n">h₂</span> <span class="o">:</span> <span class="n">odd</span> <span class="o">(</span><span class="n">n</span> <span class="bp">/</span> <span class="n">k</span><span class="o">))</span> <span class="o">:</span> <span class="n">a</span><span class="bp">^</span><span class="n">k</span> <span class="bp">+</span> <span class="mi">1</span> <span class="bp">∣</span> <span class="n">a</span><span class="bp">^</span><span class="n">n</span> <span class="bp">+</span> <span class="mi">1</span>
<span class="kd">lemma</span> <span class="n">ab_lem</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="n">n</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="o">:</span> <span class="o">(</span><span class="n">a</span> <span class="bp">-</span> <span class="n">b</span><span class="o">)</span> <span class="bp">∣</span> <span class="o">(</span><span class="n">a</span><span class="bp">^</span><span class="n">n</span> <span class="bp">-</span> <span class="n">b</span><span class="bp">^</span><span class="n">n</span><span class="o">)</span>
<span class="kd">lemma</span> <span class="n">coprime_dvd_succ</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="n">a</span> <span class="bp">∣</span> <span class="n">b</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)</span> <span class="o">:</span> <span class="n">nat.coprime</span> <span class="n">a</span> <span class="n">b</span>
<span class="kd">lemma</span> <span class="n">pow_gt_base</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="o">(</span><span class="n">ha</span> <span class="o">:</span> <span class="n">a</span> <span class="bp">&gt;</span> <span class="mi">1</span><span class="o">)</span> <span class="o">(</span><span class="n">hb</span> <span class="o">:</span> <span class="n">b</span> <span class="bp">&gt;</span> <span class="mi">1</span><span class="o">)</span> <span class="o">:</span> <span class="n">a</span><span class="bp">^</span><span class="n">b</span> <span class="bp">&gt;</span> <span class="n">a</span>
<span class="kd">lemma</span> <span class="n">pow_gt_exponent</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="n">a</span> <span class="bp">≥</span> <span class="mi">2</span><span class="o">)</span> <span class="o">:</span> <span class="n">a</span><span class="bp">^</span><span class="n">b</span> <span class="bp">&gt;</span> <span class="n">b</span>
<span class="kd">lemma</span> <span class="n">gt_of_sub_le</span> <span class="o">(</span><span class="n">n</span> <span class="n">m</span> <span class="n">k</span> <span class="n">l</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="n">n</span> <span class="bp">&gt;</span> <span class="n">m</span><span class="o">)</span> <span class="o">(</span><span class="n">h₁</span> <span class="o">:</span> <span class="n">k</span> <span class="bp">≤</span> <span class="n">l</span><span class="o">)</span> <span class="o">(</span><span class="n">h₂</span> <span class="o">:</span> <span class="n">m</span> <span class="bp">≥</span> <span class="n">l</span><span class="o">)</span> <span class="o">:</span> <span class="o">(</span><span class="n">n</span> <span class="bp">-</span> <span class="n">k</span> <span class="bp">&gt;</span> <span class="n">m</span> <span class="bp">-</span> <span class="n">l</span><span class="o">)</span>
</code></pre></div>
<p>These statements have proofs of various length, available here:<br>
<a href="https://github.com/osbourn/fermat-pseudoprimes/blob/53f3f7e5c54a42a63895909c7f4b22871671eb1b/src/fermat_psp.lean#L135">https://github.com/osbourn/fermat-pseudoprimes/blob/53f3f7e5c54a42a63895909c7f4b22871671eb1b/src/fermat_psp.lean#L135</a><br>
For the most part the names are temporary and need to be changed to become more descriptive. Some of the lemmas (like <code>mul_self</code> and <code>pow_factor</code>) I probably could have found in mathlib if I looked hard enough, but <code>library_search</code> didn't return anything. Yesterday I was primarily asking that if I decide to PR this to mathlib, should these lemmas should go in the same file as the rest of the proofs and definitions or some other file?</p>
<p>Using natural numbers instead of integers may or may not have been a mistake, since it made some of the proofs harder and it took much longer to prove inequalities involving subtraction (considering my proofs are probably already long since I am relatively new to lean). Natural numbers were also what caused the "all composite numbers are pseudoprime to base 0" edge case. If I decide to PR this to mathlib, would trying to switch to ints be better?</p>



<a name="304355928"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Infinite%20Fermat%20pseudoprimes%20to%20any%20base/near/304355928" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Infinite.20Fermat.20pseudoprimes.20to.20any.20base.html#304355928">(Oct 16 2022 at 22:15)</a>:</h4>
<p><span class="user-mention" data-user-id="398581">@Mantas Baksys</span> can tell you where <code>odd_pow_lem</code> and <code>ab_lem</code> are. For the other ones, there's <a href="https://leanprover-community.github.io/mathlib_docs/find/sq_sub_sq">docs#sq_sub_sq</a>, <a href="https://leanprover-community.github.io/mathlib_docs/find/dvd_mul_of_dvd_left">docs#dvd_mul_of_dvd_left</a> (+ <a href="https://leanprover-community.github.io/mathlib_docs/find/mt">docs#mt</a>), <a href="https://leanprover-community.github.io/mathlib_docs/find/sq">docs#sq</a>, <a href="https://leanprover-community.github.io/mathlib_docs/find/pow_succ">docs#pow_succ</a></p>



<a name="304356656"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Infinite%20Fermat%20pseudoprimes%20to%20any%20base/near/304356656" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Niels Voss <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Infinite.20Fermat.20pseudoprimes.20to.20any.20base.html#304356656">(Oct 16 2022 at 22:27)</a>:</h4>
<p>sq_sub_sq seems to work for integers, but not for natural numbers. Is this because nat isn't a comm_ring?</p>



<a name="304356793"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Infinite%20Fermat%20pseudoprimes%20to%20any%20base/near/304356793" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Infinite.20Fermat.20pseudoprimes.20to.20any.20base.html#304356793">(Oct 16 2022 at 22:29)</a>:</h4>
<p>Yes exactly! So instead you have <a href="https://leanprover-community.github.io/mathlib_docs/find/nat.sq_sub_sq">docs#nat.sq_sub_sq</a></p>



<a name="305576800"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Infinite%20Fermat%20pseudoprimes%20to%20any%20base/near/305576800" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Niels Voss <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Infinite.20Fermat.20pseudoprimes.20to.20any.20base.html#305576800">(Oct 22 2022 at 19:34)</a>:</h4>
<p>Using the lemmas Yaël Dillies suggested, I was able to get rid of most of the lemmas, with a few left over:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">lemma</span> <span class="n">odd_of_prime_gt_two</span> <span class="o">(</span><span class="n">p</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="n">nat.prime</span> <span class="n">p</span><span class="o">)</span> <span class="o">(</span><span class="n">hp</span> <span class="o">:</span> <span class="n">p</span> <span class="bp">&gt;</span> <span class="mi">2</span><span class="o">)</span> <span class="o">:</span> <span class="n">odd</span> <span class="n">p</span>
<span class="kd">lemma</span> <span class="n">odd_pow_lem</span> <span class="o">(</span><span class="n">a</span> <span class="o">:</span> <span class="n">ℤ</span><span class="o">)</span> <span class="o">(</span><span class="n">n</span> <span class="n">k</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="o">(</span><span class="n">h₁</span> <span class="o">:</span> <span class="n">k</span> <span class="bp">∣</span> <span class="n">n</span><span class="o">)</span> <span class="o">(</span><span class="n">h₂</span> <span class="o">:</span> <span class="n">odd</span> <span class="o">(</span><span class="n">n</span> <span class="bp">/</span> <span class="n">k</span><span class="o">))</span> <span class="o">:</span> <span class="n">a</span><span class="bp">^</span><span class="n">k</span> <span class="bp">+</span> <span class="mi">1</span> <span class="bp">∣</span> <span class="n">a</span><span class="bp">^</span><span class="n">n</span> <span class="bp">+</span> <span class="mi">1</span>
<span class="kd">lemma</span> <span class="n">ab_lem</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="n">n</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="o">:</span> <span class="o">(</span><span class="n">a</span> <span class="bp">-</span> <span class="n">b</span><span class="o">)</span> <span class="bp">∣</span> <span class="o">(</span><span class="n">a</span><span class="bp">^</span><span class="n">n</span> <span class="bp">-</span> <span class="n">b</span><span class="bp">^</span><span class="n">n</span><span class="o">)</span>
<span class="kd">lemma</span> <span class="n">pow_gt_base</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="o">(</span><span class="n">ha</span> <span class="o">:</span> <span class="n">a</span> <span class="bp">&gt;</span> <span class="mi">1</span><span class="o">)</span> <span class="o">(</span><span class="n">hb</span> <span class="o">:</span> <span class="n">b</span> <span class="bp">&gt;</span> <span class="mi">1</span><span class="o">)</span> <span class="o">:</span> <span class="n">a</span><span class="bp">^</span><span class="n">b</span> <span class="bp">&gt;</span> <span class="n">a</span>
<span class="kd">lemma</span> <span class="n">pow_gt_exponent</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="n">a</span> <span class="bp">≥</span> <span class="mi">2</span><span class="o">)</span> <span class="o">:</span> <span class="n">a</span><span class="bp">^</span><span class="n">b</span> <span class="bp">&gt;</span> <span class="n">b</span>
</code></pre></div>
<p>I think I might be able to eliminate <code>odd_of_prime_gt_two</code> and <code>pow_gt_base</code> soon, since those are less complicated than the others.<br>
I also added an extra lemma to help convert between the divisibility definition of probable prime and the modeq definition. The hypothesis <code>h</code> is needed to deal with edge cases in the original definition</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">lemma</span> <span class="n">probable_prime_iff_modeq</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="o">{</span><span class="n">b</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">}</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="n">b</span> <span class="bp">≥</span> <span class="mi">1</span><span class="o">)</span> <span class="o">:</span> <span class="n">probable_prime</span> <span class="n">n</span> <span class="n">b</span> <span class="bp">↔</span> <span class="n">b</span><span class="bp">^</span><span class="o">(</span><span class="n">n</span> <span class="bp">-</span> <span class="mi">1</span><span class="o">)</span> <span class="bp">≡</span> <span class="mi">1</span> <span class="o">[</span><span class="n">MOD</span> <span class="n">n</span><span class="o">]</span>
</code></pre></div>



<a name="305580708"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Infinite%20Fermat%20pseudoprimes%20to%20any%20base/near/305580708" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Infinite.20Fermat.20pseudoprimes.20to.20any.20base.html#305580708">(Oct 22 2022 at 20:02)</a>:</h4>
<p><code>ab_lem</code> is horrible because it's using natural subtraction. Do you really need that non-mathematical statement? It would be more natural to have a and b integers there.</p>



<a name="305580843"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Infinite%20Fermat%20pseudoprimes%20to%20any%20base/near/305580843" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Infinite.20Fermat.20pseudoprimes.20to.20any.20base.html#305580843">(Oct 22 2022 at 20:03)</a>:</h4>
<p>You shouldn't have any lemmas with <code>&gt;</code> in. You should change all <code>a &gt; b</code> to <code>b &lt; a</code> because that's the shape of all the hypotheses, conclusions, simp lemmas etc in all the lemmas in Lean's library</p>



<a name="305631644"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Infinite%20Fermat%20pseudoprimes%20to%20any%20base/near/305631644" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Niels Voss <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Infinite.20Fermat.20pseudoprimes.20to.20any.20base.html#305631644">(Oct 23 2022 at 07:37)</a>:</h4>
<p>I replaced all instances of <code>&gt;</code> and <code>≥</code> with <code>&lt;</code> and <code>≤</code> (with the exception of a few <code>calc</code> proofs where changing the symbol would have required changing the direction of proof).</p>
<p>I agree that <code>ab_lem</code>, in its current state, is a bit questionable because it relies on the fact that <code>a - b = 0</code> when <code>b &gt; a</code>. Is natural number subtraction bad in general, or just in cases where it leads to problematic results? I could add <code>a ≥ b</code> as a hypothesis. I could also make <code>ab_lem</code> use integers, and then use <code>exact_mod_cast</code> and similar tactics to use it to prove properties of natural numbers.</p>
<p>I think the problem is a bit deeper, though. The main reason why <code>ab_lem</code> needs to operate on natural numbers rather than integers is because my original definition used natural numbers instead of integers. I could change this (which would probably remove quite a few sore spots where <code>linarith</code> didn't solve inequalities as well as I would have hoped). However, I'm not quite sure how I would do this, since <code>a^b</code> is not defined when <code>a</code> and <code>b</code> are both <code>int</code>s. In the main definition</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">def</span> <span class="n">fermat_psp.probable_prime</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="o">(</span><span class="n">b</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="o">:</span> <span class="kt">Prop</span> <span class="o">:=</span> <span class="n">n</span> <span class="bp">∣</span> <span class="n">b</span><span class="bp">^</span><span class="o">(</span><span class="n">n</span> <span class="bp">-</span> <span class="mi">1</span><span class="o">)</span> <span class="bp">-</span> <span class="mi">1</span>
</code></pre></div>
<p><code>n - 1</code> needs to be a <code>nat</code> because it is the exponent. I could maybe try one of these:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">def</span> <span class="n">probable_prime</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="o">(</span><span class="n">b</span> <span class="o">:</span> <span class="n">ℤ</span><span class="o">)</span> <span class="o">:</span> <span class="kt">Prop</span> <span class="o">:=</span> <span class="bp">↑</span><span class="n">n</span> <span class="bp">∣</span> <span class="n">b</span><span class="bp">^</span><span class="o">(</span><span class="n">n</span> <span class="bp">-</span> <span class="mi">1</span><span class="o">)</span> <span class="bp">-</span> <span class="mi">1</span>
<span class="kd">def</span> <span class="n">probable_prime</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="o">(</span><span class="n">b</span> <span class="o">:</span> <span class="n">ℤ</span><span class="o">)</span> <span class="o">:</span> <span class="kt">Prop</span> <span class="o">:=</span> <span class="mi">1</span> <span class="bp">≤</span> <span class="n">n</span> <span class="bp">∧</span> <span class="bp">↑</span><span class="n">n</span> <span class="bp">∣</span> <span class="n">b</span><span class="bp">^</span><span class="o">(</span><span class="n">n</span> <span class="bp">-</span> <span class="mi">1</span><span class="o">)</span> <span class="bp">-</span> <span class="mi">1</span>
<span class="kd">def</span> <span class="n">probable_prime</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="o">(</span><span class="n">b</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="o">:</span> <span class="kt">Prop</span> <span class="o">:=</span> <span class="mi">1</span> <span class="bp">≤</span> <span class="n">n</span> <span class="bp">∧</span> <span class="bp">↑</span><span class="n">n</span> <span class="bp">∣</span> <span class="o">(</span><span class="n">b</span> <span class="o">:</span> <span class="n">ℤ</span><span class="o">)</span><span class="bp">^</span><span class="o">(</span><span class="n">n</span> <span class="bp">-</span> <span class="mi">1</span><span class="o">)</span> <span class="bp">-</span> <span class="mi">1</span>
</code></pre></div>
<p>and see how far I get.</p>



<a name="305633054"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Infinite%20Fermat%20pseudoprimes%20to%20any%20base/near/305633054" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Infinite.20Fermat.20pseudoprimes.20to.20any.20base.html#305633054">(Oct 23 2022 at 07:57)</a>:</h4>
<p>Natural number subtraction is a pathological function so it's harder to work with. The books you were taking the proofs from didn't use it, right? Mathematicians don't use it, right? So why use it here?</p>



<a name="305633255"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Infinite%20Fermat%20pseudoprimes%20to%20any%20base/near/305633255" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Infinite.20Fermat.20pseudoprimes.20to.20any.20base.html#305633255">(Oct 23 2022 at 08:00)</a>:</h4>
<p>I'm not suggesting you change the <em>power</em> to an integer though! That would also be pathological because what would the integer 2^-1 be? All I'm saying is that rather than fight natural subtraction like the computer scientists do, avoid it like the mathematicians do.</p>



<a name="305635223"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Infinite%20Fermat%20pseudoprimes%20to%20any%20base/near/305635223" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Niels Voss <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Infinite.20Fermat.20pseudoprimes.20to.20any.20base.html#305635223">(Oct 23 2022 at 08:29)</a>:</h4>
<p>Yes, I think you're right. Upon looking over my proof again, the only natural number subtraction that I ended up performing was something minus one. My proof is based roughly on this one: <a href="https://primes.utm.edu/notes/proofs/a_pseudoprimes.html">https://primes.utm.edu/notes/proofs/a_pseudoprimes.html</a></p>
<p>The only natural number subtraction in this proof I used often was subtracting 1 from various numbers, the idea being that none of the numbers that 1 was subtracted from are ever going to be 0. I just realized in my proof that whenever I use ab_lem, I set b to be 1 as well, so I could probably do with a more restricted form of ab_lem:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">lemma</span> <span class="n">ab_lem'</span> <span class="o">(</span><span class="n">a</span> <span class="n">n</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="o">:</span> <span class="o">(</span><span class="n">a</span> <span class="bp">-</span> <span class="mi">1</span><span class="o">)</span> <span class="bp">∣</span> <span class="o">(</span><span class="n">a</span><span class="bp">^</span><span class="n">n</span> <span class="bp">-</span> <span class="mi">1</span><span class="o">)</span>
</code></pre></div>
<p>I'm not really sure why I decided to generalize it to all b, I just assumed that I might need it at one point. Is natural number subtraction with 1 still a problem if the only times it would be irregular is during edge cases?</p>
<p>I used natural number subtraction with numbers other than 1 twice, but only to prove a very specific subgoal and not in a definition or theorem statement so it probably isn't worth considering.</p>



<a name="305658365"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Infinite%20Fermat%20pseudoprimes%20to%20any%20base/near/305658365" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Infinite.20Fermat.20pseudoprimes.20to.20any.20base.html#305658365">(Oct 23 2022 at 12:35)</a>:</h4>
<p>I'm just saying that in my experience, avoiding natural subtraction completely makes proofs easier. If you've already done what you need to do using it, that's fine -- it's more advice than anything else, and there are more CS-aligned people around here who would probably disagree with it.</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>