---
layout: archive
title: Zulip Chat Archive
permalink: /stream/116395-maths/topic/universe.20levels.20in.20preserves.20statements.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/116395-maths/index.html">maths</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/universe.20levels.20in.20preserves.20statements.html">universe levels in preserves statements</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="285026265"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/universe%20levels%20in%20preserves%20statements/near/285026265" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jakob von Raumer <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/universe.20levels.20in.20preserves.20statements.html#285026265">(Jun 05 2022 at 09:01)</a>:</h4>
<p><span class="user-mention" data-user-id="260921">@Markus Himmel</span>  and me have found many ove the universe level restrictions in <code>category_theory.limits.preserves</code> to be too strong in that they require both categories to live in the same universe. I started to work on a generalization at <a href="https://github.com/leanprover-community/mathlib/tree/preserves-universes">preserves-universes</a> but for many of the more specific type classes, e.g. <code>preserves_binary_products</code>, the fix needs to pin the universe level of the diagram category. In general it seems more consistent with other parts of mathlib to have things like the <code>walking_pair</code>in <code>Type</code> instead of being universe polymorphic. Edge cases like <code>preserves_finite_limits</code> are harder to decide on. Any comments on these changes, esp <span class="user-mention" data-user-id="110087">@Scott Morrison</span> ? I seem to have fixed most files, but there's still some work to do...</p>



<a name="285074083"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/universe%20levels%20in%20preserves%20statements/near/285074083" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/universe.20levels.20in.20preserves.20statements.html#285074083">(Jun 06 2022 at 04:13)</a>:</h4>
<p><span class="user-mention" data-user-id="110789">@Jakob von Raumer</span> I guess you know the back story, that the indexing diagram used to be a small category at the same universe level as that of the morphisms of category in which you take limits. This was decoupled a while ago. So I agree that it's now a good idea for <code>walking_pair</code> and friends to simply live in <code>Type</code>.<br>
For things like <code>preserves_finite_limits</code>, I think we should at least support a universe polymorphic version. It could be called <code>preserves_finite_limits_of_size</code> for example.</p>



<a name="285075948"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/universe%20levels%20in%20preserves%20statements/near/285075948" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/universe.20levels.20in.20preserves.20statements.html#285075948">(Jun 06 2022 at 04:54)</a>:</h4>
<p>I'm concerned that these more relaxed universe parameters will mean the<br>
<code>preserves</code> instances will almost never fire automatically. We are already running into some issues in LTE where we have to provide universes explicitly to <code>has_limit</code> (or similar) instances. Is that better than dealing with <code>ulift</code> once in a while? I don't know...</p>



<a name="285077901"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/universe%20levels%20in%20preserves%20statements/near/285077901" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jakob von Raumer <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/universe.20levels.20in.20preserves.20statements.html#285077901">(Jun 06 2022 at 05:42)</a>:</h4>
<p><span class="user-mention silent" data-user-id="112680">Johan Commelin</span> <a href="#narrow/stream/116395-maths/topic/universe.20levels.20in.20preserves.20statements/near/285074083">said</a>:</p>
<blockquote>
<p>For things like <code>preserves_finite_limits</code>, I think we should at least support a universe polymorphic version. It could be called <code>preserves_finite_limits_of_size</code> for example.</p>
</blockquote>
<p>Yes, that's what it's like on the branch now. There's a sparate lemma  <code>preserves_smallest_finite_limits_of_preserves_limits</code>reflecting it down to <code>Type</code> which we can locally make an instance.</p>



<a name="285077954"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/universe%20levels%20in%20preserves%20statements/near/285077954" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jakob von Raumer <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/universe.20levels.20in.20preserves.20statements.html#285077954">(Jun 06 2022 at 05:44)</a>:</h4>
<p><span class="user-mention silent" data-user-id="243562">Adam Topaz</span> <a href="#narrow/stream/116395-maths/topic/universe.20levels.20in.20preserves.20statements/near/285075948">said</a>:</p>
<blockquote>
<p>I'm concerned that these more relaxed universe parameters will mean the<br>
<code>preserves</code> instances will almost never fire automatically. We are already running into some issues in LTE where we have to provide universes explicitly to <code>has_limit</code> (or similar) instances. Is that better than dealing with <code>ulift</code> once in a while? I don't know...</p>
</blockquote>
<p>Since I'm almost through refactoring mathlib, I can say that it does require a few explicit universes but then it removes some others (partially because now the index categories have fixed universes).</p>



<a name="285078070"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/universe%20levels%20in%20preserves%20statements/near/285078070" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jakob von Raumer <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/universe.20levels.20in.20preserves.20statements.html#285078070">(Jun 06 2022 at 05:47)</a>:</h4>
<p>Going from an index level &gt; 0 to 0 in order to have e.g. binary products is not completely painless, but in most places we will have <code>has_finite_limits</code> which maybe should default to 0 (as opposed to a <code>has_finite_limits_of_size</code>)</p>



<a name="285947751"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/universe%20levels%20in%20preserves%20statements/near/285947751" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jakob von Raumer <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/universe.20levels.20in.20preserves.20statements.html#285947751">(Jun 13 2022 at 15:42)</a>:</h4>
<p><span class="user-mention" data-user-id="439483">@Andrew Yang</span> One point I'm stuck at is <code>Lan_preserves_finite_limits_of_flat</code> in <code>category_theory.functor.flat</code>, can you help me? I'm on branch <code>preserves-universes</code></p>



<a name="285956119"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/universe%20levels%20in%20preserves%20statements/near/285956119" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Andrew Yang <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/universe.20levels.20in.20preserves.20statements.html#285956119">(Jun 13 2022 at 16:38)</a>:</h4>
<p>I think there should not be a need for <code>has_finite_limits_of_size</code>. Since we have <code>fin_category.equiv_as_type</code> and <code>has_limits_of_shape_of_equivalence</code>, <code>has_finite_limits</code> should suffice.</p>
<p>I believe <code>Lan_preserves_finite_limits_of_flat</code> should work if the two are merged and we have the instances</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">instance</span> <span class="n">has_limits_of_shape_of_has_finite_limits</span> <span class="o">[</span><span class="n">has_finite_limits</span> <span class="n">C</span><span class="o">]</span> <span class="o">{</span><span class="n">J</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span>
  <span class="o">[</span><span class="n">small_category</span> <span class="n">J</span><span class="o">]</span> <span class="o">[</span><span class="n">fin_category</span> <span class="n">J</span><span class="o">]</span> <span class="o">:</span>
  <span class="n">has_limits_of_shape</span> <span class="n">J</span> <span class="n">C</span> <span class="o">:=</span> <span class="gr">sorry</span>

<span class="kd">instance</span> <span class="n">preserves_limits_of_shape_of_preserves_finite_limits</span> <span class="o">(</span><span class="n">F</span> <span class="o">:</span> <span class="n">C</span> <span class="bp">⥤</span> <span class="n">D</span><span class="o">)</span>
  <span class="o">[</span><span class="n">preserves_finite_limits</span> <span class="n">F</span><span class="o">]</span> <span class="o">{</span><span class="n">J</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span>
  <span class="o">[</span><span class="n">small_category</span> <span class="n">J</span><span class="o">]</span> <span class="o">[</span><span class="n">fin_category</span> <span class="n">J</span><span class="o">]</span> <span class="o">:</span>
  <span class="n">preserves_limits_of_shape</span> <span class="n">J</span> <span class="n">F</span> <span class="o">:=</span> <span class="gr">sorry</span>
</code></pre></div>



<a name="285976484"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/universe%20levels%20in%20preserves%20statements/near/285976484" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jakob von Raumer <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/universe.20levels.20in.20preserves.20statements.html#285976484">(Jun 13 2022 at 19:18)</a>:</h4>
<p>Thanks! I'll have a look at it tomorrow :)</p>



<a name="286030818"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/universe%20levels%20in%20preserves%20statements/near/286030818" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jakob von Raumer <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/universe.20levels.20in.20preserves.20statements.html#286030818">(Jun 14 2022 at 07:19)</a>:</h4>
<p><span class="user-mention silent" data-user-id="439483">Andrew Yang</span> <a href="#narrow/stream/116395-maths/topic/universe.20levels.20in.20preserves.20statements/near/285956119">said</a>:</p>
<blockquote>
<p>I think there should not be a need for <code>has_finite_limits_of_size</code>. Since we have <code>fin_category.equiv_as_type</code> and <code>has_limits_of_shape_of_equivalence</code>, <code>has_finite_limits</code> should suffice.</p>
</blockquote>
<p>It's a tough decision. I think I'll keep it for now, and we can consider removing it in a second refactor step.</p>



<a name="287180652"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/universe%20levels%20in%20preserves%20statements/near/287180652" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jakob von Raumer <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/universe.20levels.20in.20preserves.20statements.html#287180652">(Jun 23 2022 at 12:15)</a>:</h4>
<p>Maybe I can get some help from the community with this: On the <code>preserves-universes</code> I'm currently trying to relax all sorts of universe constraints, which in turn suggests changing constant index categories like <code>walking_parallel_pair</code> and the like to not be universe polymorphic but instead live in <code>Type</code>. This causes a problem with <code>over B</code> categories, though: In those we only derive connected limits in the universe <code>v</code> of the morphisms instead of in universe <code>0</code>. One should think that this is not a problem, but the issue is that connectedness is not preserved by <code>ulift</code> (since the space of discrete categories we use to test the functor's being constant grows), so we can't derive that <code>over B</code> has e.g. pullbacks because we miss the instance <code>is_connected (ulift_hom (ulift walking_cospan))</code>, and it's not really easy to derive this instance in a general way. Any ideas on how to solve this? <span class="user-mention" data-user-id="110087">@Scott Morrison</span> ?</p>



<a name="287180820"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/universe%20levels%20in%20preserves%20statements/near/287180820" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jakob von Raumer <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/universe.20levels.20in.20preserves.20statements.html#287180820">(Jun 23 2022 at 12:17)</a>:</h4>
<p>(<a href="https://github.com/leanprover-community/mathlib/blob/c479d3736b98fbe1dfd580d19c7fd484b990ac4a/src/category_theory/limits/constructions/over/default.lean">this</a> is the file)</p>



<a name="287183999"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/universe%20levels%20in%20preserves%20statements/near/287183999" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/universe.20levels.20in.20preserves.20statements.html#287183999">(Jun 23 2022 at 12:47)</a>:</h4>
<p>The definition of <code>is_connected</code> should really just be that if you quotient the objects by <code>nonempty (A --&gt; B)</code>, you get a singleton. I'm not sure why we have this complicated definition instead.</p>



<a name="287184055"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/universe%20levels%20in%20preserves%20statements/near/287184055" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/universe.20levels.20in.20preserves.20statements.html#287184055">(Jun 23 2022 at 12:48)</a>:</h4>
<p>Certainly connectedness really is preserved by any kind of universe lifting.</p>



<a name="287185090"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/universe%20levels%20in%20preserves%20statements/near/287185090" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jakob von Raumer <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/universe.20levels.20in.20preserves.20statements.html#287185090">(Jun 23 2022 at 12:56)</a>:</h4>
<p>With the current complicated definition, is it really?</p>



<a name="287185978"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/universe%20levels%20in%20preserves%20statements/near/287185978" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/universe.20levels.20in.20preserves.20statements.html#287185978">(Jun 23 2022 at 13:03)</a>:</h4>
<p>Yes, because it is equivalent to the simple definition</p>



<a name="287185990"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/universe%20levels%20in%20preserves%20statements/near/287185990" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/universe.20levels.20in.20preserves.20statements.html#287185990">(Jun 23 2022 at 13:03)</a>:</h4>
<p>If it isn't, then it's wrong!</p>



<a name="287186499"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/universe%20levels%20in%20preserves%20statements/near/287186499" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/universe.20levels.20in.20preserves.20statements.html#287186499">(Jun 23 2022 at 13:06)</a>:</h4>
<p>All these ulift constructiions should provide some equivalence of caategories, and connectedness is preserves under equivalences (the complicateed definition makes it not so bad to prove that!)</p>



<a name="287186543"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/universe%20levels%20in%20preserves%20statements/near/287186543" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/universe.20levels.20in.20preserves.20statements.html#287186543">(Jun 23 2022 at 13:07)</a>:</h4>
<p>see <a href="https://leanprover-community.github.io/mathlib_docs/find/category_theory.is_connected_of_equivalent">docs#category_theory.is_connected_of_equivalent</a></p>



<a name="287186624"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/universe%20levels%20in%20preserves%20statements/near/287186624" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/universe.20levels.20in.20preserves.20statements.html#287186624">(Jun 23 2022 at 13:07)</a>:</h4>
<p>And I think we have <a href="https://leanprover-community.github.io/mathlib_docs/find/category_theory.is_connected_of_zigzag">docs#category_theory.is_connected_of_zigzag</a></p>



<a name="287186798"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/universe%20levels%20in%20preserves%20statements/near/287186798" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/universe.20levels.20in.20preserves.20statements.html#287186798">(Jun 23 2022 at 13:09)</a>:</h4>
<p><span class="user-mention silent" data-user-id="243562">Adam Topaz</span> <a href="#narrow/stream/116395-maths/topic/universe.20levels.20in.20preserves.20statements/near/287186543">said</a>:</p>
<blockquote>
<p>see <a href="https://leanprover-community.github.io/mathlib_docs/find/category_theory.is_connected_of_equivalent">docs#category_theory.is_connected_of_equivalent</a></p>
</blockquote>
<p>This one only covers categories with objects in the same universe</p>



<a name="287186972"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/universe%20levels%20in%20preserves%20statements/near/287186972" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/universe.20levels.20in.20preserves.20statements.html#287186972">(Jun 23 2022 at 13:10)</a>:</h4>
<p>That seems wrong...</p>



<a name="287188538"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/universe%20levels%20in%20preserves%20statements/near/287188538" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/universe.20levels.20in.20preserves.20statements.html#287188538">(Jun 23 2022 at 13:22)</a>:</h4>
<p>It's the easy case for this definition because you are eliminating into the same discrete categories</p>



<a name="287188584"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/universe%20levels%20in%20preserves%20statements/near/287188584" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/universe.20levels.20in.20preserves.20statements.html#287188584">(Jun 23 2022 at 13:22)</a>:</h4>
<p>If you have different object universes then you run into what Jakob mentioned, and usually the easiest way to prove something like this is to prove equivalence to the "predicative" definition</p>



<a name="287190141"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/universe%20levels%20in%20preserves%20statements/near/287190141" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jakob von Raumer <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/universe.20levels.20in.20preserves.20statements.html#287190141">(Jun 23 2022 at 13:33)</a>:</h4>
<p>Seems about right. I think the equivalence to the existence of zigzags is such a predicative definition which could be used. I'll try to go that route and see how much hassle it is to deal with lifts of zigzags <span aria-label="grimacing" class="emoji emoji-1f62c" role="img" title="grimacing">:grimacing:</span></p>



<a name="287190379"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/universe%20levels%20in%20preserves%20statements/near/287190379" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/universe.20levels.20in.20preserves.20statements.html#287190379">(Jun 23 2022 at 13:34)</a>:</h4>
<p>You don't necessarily even need to deal with zigzags, you can just take a <code>quot</code></p>



<a name="287190597"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/universe%20levels%20in%20preserves%20statements/near/287190597" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jakob von Raumer <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/universe.20levels.20in.20preserves.20statements.html#287190597">(Jun 23 2022 at 13:35)</a>:</h4>
<p>With zigzags the advantage would be that the equivalence to the currrent <code>is_connected</code> is already there</p>



<a name="287203494"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/universe%20levels%20in%20preserves%20statements/near/287203494" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jakob von Raumer <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/universe.20levels.20in.20preserves.20statements.html#287203494">(Jun 23 2022 at 15:03)</a>:</h4>
<p>Ah, I think <code>induct_on_objects</code> might be enough to prove it, still a bit messy though</p>



<a name="287204607"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/universe%20levels%20in%20preserves%20statements/near/287204607" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jakob von Raumer <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/universe.20levels.20in.20preserves.20statements.html#287204607">(Jun 23 2022 at 15:12)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">example</span> <span class="o">[</span><span class="n">is_connected</span> <span class="n">J</span><span class="o">]</span> <span class="o">[</span><span class="n">hn</span> <span class="o">:</span> <span class="n">nonempty</span> <span class="n">J</span><span class="o">]</span> <span class="o">:</span> <span class="n">is_connected</span> <span class="o">(</span><span class="n">ulift_hom.</span><span class="o">{</span><span class="n">v₂</span><span class="o">}</span> <span class="o">(</span><span class="n">ulift.</span><span class="o">{</span><span class="n">u₂</span><span class="o">}</span> <span class="n">J</span><span class="o">))</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="n">haveI</span> <span class="o">:</span> <span class="n">nonempty</span> <span class="o">(</span><span class="n">ulift_hom.</span><span class="o">{</span><span class="n">v₂</span><span class="o">}</span> <span class="o">(</span><span class="n">ulift.</span><span class="o">{</span><span class="n">u₂</span><span class="o">}</span> <span class="n">J</span><span class="o">)),</span> <span class="o">{</span> <span class="n">simpa</span> <span class="o">[</span><span class="n">ulift_hom</span><span class="o">]</span> <span class="o">},</span>
  <span class="k">let</span> <span class="n">j₀</span> <span class="o">:</span> <span class="n">J</span> <span class="o">:=</span> <span class="n">classical.choice</span> <span class="n">hn</span><span class="o">,</span>
  <span class="n">fapply</span> <span class="n">is_connected.of_induct</span><span class="o">,</span>
  <span class="o">{</span> <span class="n">exact</span> <span class="o">⟨</span><span class="n">j₀</span><span class="o">⟩</span> <span class="o">},</span>
  <span class="o">{</span> <span class="n">intros</span> <span class="n">p</span> <span class="n">hj₀</span> <span class="n">h</span> <span class="n">j</span><span class="o">,</span> <span class="n">cases</span> <span class="n">j</span> <span class="k">with</span> <span class="n">j</span><span class="o">,</span>
    <span class="k">let</span> <span class="n">p'</span> <span class="o">:</span> <span class="n">set</span> <span class="n">J</span> <span class="o">:=</span> <span class="o">((</span><span class="bp">λ</span> <span class="o">(</span><span class="n">j</span> <span class="o">:</span> <span class="n">J</span><span class="o">),</span> <span class="n">p</span> <span class="o">{</span><span class="n">down</span> <span class="o">:=</span> <span class="n">j</span><span class="o">})</span> <span class="o">:</span> <span class="n">set</span> <span class="n">J</span><span class="o">),</span>
    <span class="k">have</span> <span class="n">hj₀'</span> <span class="o">:</span> <span class="n">j₀</span> <span class="bp">∈</span> <span class="n">p'</span><span class="o">,</span> <span class="o">{</span> <span class="n">simp</span> <span class="n">only</span> <span class="o">[</span><span class="n">p'</span><span class="o">],</span> <span class="n">exact</span> <span class="n">hj₀</span> <span class="o">},</span>
    <span class="n">apply</span> <span class="n">induct_on_objects</span> <span class="o">(</span><span class="bp">λ</span> <span class="o">(</span><span class="n">j</span> <span class="o">:</span> <span class="n">J</span><span class="o">),</span> <span class="n">p</span> <span class="o">{</span><span class="n">down</span> <span class="o">:=</span> <span class="n">j</span><span class="o">})</span> <span class="n">hj₀'</span><span class="o">,</span>
    <span class="n">intros</span> <span class="n">j₁</span> <span class="n">j₂</span> <span class="n">f</span><span class="o">,</span> <span class="n">apply</span> <span class="n">h</span><span class="o">,</span>
    <span class="n">exact</span> <span class="o">(</span><span class="n">ulift_hom_ulift_category.equiv</span> <span class="n">J</span><span class="o">)</span><span class="bp">.</span><span class="n">functor.map</span> <span class="n">f</span> <span class="o">}</span>
<span class="kd">end</span>
</code></pre></div>



<a name="287238844"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/universe%20levels%20in%20preserves%20statements/near/287238844" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/universe.20levels.20in.20preserves.20statements.html#287238844">(Jun 23 2022 at 19:42)</a>:</h4>
<p>Nice!</p>



<a name="287263313"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/universe%20levels%20in%20preserves%20statements/near/287263313" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bhavik Mehta <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/universe.20levels.20in.20preserves.20statements.html#287263313">(Jun 23 2022 at 21:53)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110032">Reid Barton</span> <a href="#narrow/stream/116395-maths/topic/universe.20levels.20in.20preserves.20statements/near/287183999">said</a>:</p>
<blockquote>
<p>The definition of <code>is_connected</code> should really just be that if you quotient the objects by <code>nonempty (A --&gt; B)</code>, you get a singleton. I'm not sure why we have this complicated definition instead.</p>
</blockquote>
<p>My hope was that I could pick any one definition in which the universe choices were obvious then show that the others are equivalent, it would be good enough (which is eg why I didn't pick <code>of_constant_of_preserves_morphisms</code> as the definition), and then the quotient definition vs the functor definition differ only in whether you care more about a slightly more complex definition, or more things needed to define before the main definition, and I picked arbitrarily. I have no objection to switching the definition!</p>



<a name="287297937"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/universe%20levels%20in%20preserves%20statements/near/287297937" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jakob von Raumer <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/universe.20levels.20in.20preserves.20statements.html#287297937">(Jun 24 2022 at 07:21)</a>:</h4>
<p>In the end it doesn't matter that much, if we have all the right equivalences...</p>



<a name="287332908"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/universe%20levels%20in%20preserves%20statements/near/287332908" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jakob von Raumer <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/universe.20levels.20in.20preserves.20statements.html#287332908">(Jun 24 2022 at 13:50)</a>:</h4>
<p>Status report (to help myself remember, too <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span> ): Made some progress, now <code>category_theory.graded_object.lean</code> cannot derive an instance <code>mono (colimit.ι (discrete.functor (λ (i : β), Y i)) {as := i})</code> where before it had</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="n">caching</span> <span class="kd">instance</span> <span class="n">for</span> <span class="bp">@</span><span class="n">mono</span> <span class="o">((</span><span class="bp">λ</span> <span class="o">(</span><span class="n">_x</span> <span class="o">:</span> <span class="n">β</span><span class="o">),</span> <span class="n">C</span><span class="o">)</span> <span class="n">i</span><span class="o">)</span> <span class="n">_inst_1</span> <span class="o">(</span><span class="n">Y</span> <span class="n">i</span><span class="o">)</span>
  <span class="o">((</span><span class="bp">@</span><span class="n">colim</span> <span class="o">(</span><span class="n">discrete</span> <span class="o">(</span><span class="n">ulift</span> <span class="n">β</span><span class="o">))</span> <span class="o">(</span><span class="n">category_theory.discrete_category</span> <span class="o">(</span><span class="n">ulift</span> <span class="n">β</span><span class="o">))</span> <span class="n">C</span> <span class="n">_inst_1</span> <span class="n">_</span><span class="o">)</span><span class="bp">.</span><span class="n">obj</span>
     <span class="o">(</span><span class="bp">@</span><span class="n">discrete.functor</span> <span class="n">C</span> <span class="n">_inst_1</span> <span class="o">(</span><span class="n">ulift</span> <span class="n">β</span><span class="o">)</span> <span class="o">(</span><span class="bp">λ</span> <span class="o">(</span><span class="n">i</span> <span class="o">:</span> <span class="n">ulift</span> <span class="n">β</span><span class="o">),</span> <span class="n">Y</span> <span class="n">i.down</span><span class="o">)))</span>
  <span class="o">(</span><span class="bp">@</span><span class="n">colimit.ι</span> <span class="o">(</span><span class="n">discrete</span> <span class="o">(</span><span class="n">ulift</span> <span class="n">β</span><span class="o">))</span> <span class="o">(</span><span class="n">category_theory.discrete_category</span> <span class="o">(</span><span class="n">ulift</span> <span class="n">β</span><span class="o">))</span> <span class="n">C</span> <span class="n">_inst_1</span>
     <span class="o">(</span><span class="bp">@</span><span class="n">discrete.functor</span> <span class="n">C</span> <span class="n">_inst_1</span> <span class="o">(</span><span class="n">ulift</span> <span class="n">β</span><span class="o">)</span> <span class="o">(</span><span class="bp">λ</span> <span class="o">(</span><span class="n">i</span> <span class="o">:</span> <span class="n">ulift</span> <span class="n">β</span><span class="o">),</span> <span class="n">Y</span> <span class="n">i.down</span><span class="o">))</span>
     <span class="n">_</span>
     <span class="o">(</span><span class="bp">@</span><span class="n">discrete.mk</span> <span class="o">(</span><span class="n">ulift</span> <span class="n">β</span><span class="o">)</span> <span class="o">(</span><span class="bp">@</span><span class="n">ulift.up</span> <span class="n">β</span> <span class="n">i</span><span class="o">)))</span>
<span class="bp">@</span><span class="n">split_mono.mono</span> <span class="o">((</span><span class="bp">λ</span> <span class="o">(</span><span class="n">_x</span> <span class="o">:</span> <span class="n">β</span><span class="o">),</span> <span class="n">C</span><span class="o">)</span> <span class="n">i</span><span class="o">)</span> <span class="n">_inst_1</span> <span class="o">(</span><span class="n">Y</span> <span class="n">i</span><span class="o">)</span>
  <span class="o">((</span><span class="bp">@</span><span class="n">colim</span> <span class="o">(</span><span class="n">discrete</span> <span class="o">(</span><span class="n">ulift</span> <span class="n">β</span><span class="o">))</span> <span class="o">(</span><span class="n">category_theory.discrete_category</span> <span class="o">(</span><span class="n">ulift</span> <span class="n">β</span><span class="o">))</span> <span class="n">C</span> <span class="n">_inst_1</span> <span class="o">(</span><span class="n">_inst_2</span> <span class="o">(</span><span class="n">ulift</span> <span class="n">β</span><span class="o">)))</span><span class="bp">.</span><span class="n">obj</span>
     <span class="o">(</span><span class="bp">@</span><span class="n">discrete.functor</span> <span class="n">C</span> <span class="n">_inst_1</span> <span class="o">(</span><span class="n">ulift</span> <span class="n">β</span><span class="o">)</span> <span class="o">(</span><span class="bp">λ</span> <span class="o">(</span><span class="n">i</span> <span class="o">:</span> <span class="n">ulift</span> <span class="n">β</span><span class="o">),</span> <span class="n">Y</span> <span class="n">i.down</span><span class="o">)))</span>
  <span class="o">(</span><span class="bp">@</span><span class="n">colimit.ι</span> <span class="o">(</span><span class="n">discrete</span> <span class="o">(</span><span class="n">ulift</span> <span class="n">β</span><span class="o">))</span> <span class="o">(</span><span class="n">category_theory.discrete_category</span> <span class="o">(</span><span class="n">ulift</span> <span class="n">β</span><span class="o">))</span> <span class="n">C</span> <span class="n">_inst_1</span>
     <span class="o">(</span><span class="bp">@</span><span class="n">discrete.functor</span> <span class="n">C</span> <span class="n">_inst_1</span> <span class="o">(</span><span class="n">ulift</span> <span class="n">β</span><span class="o">)</span> <span class="o">(</span><span class="bp">λ</span> <span class="o">(</span><span class="n">i</span> <span class="o">:</span> <span class="n">ulift</span> <span class="n">β</span><span class="o">),</span> <span class="n">Y</span> <span class="n">i.down</span><span class="o">))</span>
     <span class="o">(</span><span class="bp">@</span><span class="n">limits.has_colimit_of_has_colimits_of_shape</span> <span class="n">C</span> <span class="n">_inst_1</span> <span class="o">(</span><span class="n">discrete</span> <span class="o">(</span><span class="n">ulift</span> <span class="n">β</span><span class="o">))</span>
        <span class="o">(</span><span class="n">category_theory.discrete_category</span> <span class="o">(</span><span class="n">ulift</span> <span class="n">β</span><span class="o">))</span>
        <span class="o">(</span><span class="n">_inst_2</span> <span class="o">(</span><span class="n">ulift</span> <span class="n">β</span><span class="o">))</span>
        <span class="o">(</span><span class="bp">@</span><span class="n">discrete.functor</span> <span class="n">C</span> <span class="n">_inst_1</span> <span class="o">(</span><span class="n">ulift</span> <span class="n">β</span><span class="o">)</span> <span class="o">(</span><span class="bp">λ</span> <span class="o">(</span><span class="n">i</span> <span class="o">:</span> <span class="n">ulift</span> <span class="n">β</span><span class="o">),</span> <span class="n">Y</span> <span class="n">i.down</span><span class="o">)))</span>
     <span class="o">(</span><span class="bp">@</span><span class="n">discrete.mk</span> <span class="o">(</span><span class="n">ulift</span> <span class="n">β</span><span class="o">)</span> <span class="o">(</span><span class="bp">@</span><span class="n">ulift.up</span> <span class="n">β</span> <span class="n">i</span><span class="o">)))</span>
  <span class="o">(</span><span class="bp">@</span><span class="n">limits.split_mono_sigma_ι</span> <span class="o">((</span><span class="bp">λ</span> <span class="o">(</span><span class="n">_x</span> <span class="o">:</span> <span class="n">β</span><span class="o">),</span> <span class="n">C</span><span class="o">)</span> <span class="n">i</span><span class="o">)</span> <span class="n">_inst_1</span> <span class="o">(</span><span class="n">ulift</span> <span class="n">β</span><span class="o">)</span> <span class="n">_inst_3</span> <span class="o">(</span><span class="bp">λ</span> <span class="o">(</span><span class="n">i</span> <span class="o">:</span> <span class="n">ulift</span> <span class="n">β</span><span class="o">),</span> <span class="n">Y</span> <span class="n">i.down</span><span class="o">)</span>
     <span class="o">(</span><span class="bp">@</span><span class="n">limits.has_colimit_of_has_colimits_of_shape</span> <span class="n">C</span> <span class="n">_inst_1</span> <span class="o">(</span><span class="n">discrete</span> <span class="o">(</span><span class="n">ulift</span> <span class="n">β</span><span class="o">))</span>
        <span class="o">(</span><span class="n">category_theory.discrete_category</span> <span class="o">(</span><span class="n">ulift</span> <span class="n">β</span><span class="o">))</span>
        <span class="o">(</span><span class="n">_inst_2</span> <span class="o">(</span><span class="n">ulift</span> <span class="n">β</span><span class="o">))</span>
        <span class="o">(</span><span class="bp">@</span><span class="n">discrete.functor</span> <span class="n">C</span> <span class="n">_inst_1</span> <span class="o">(</span><span class="n">ulift</span> <span class="n">β</span><span class="o">)</span> <span class="o">(</span><span class="bp">λ</span> <span class="o">(</span><span class="n">i</span> <span class="o">:</span> <span class="n">ulift</span> <span class="n">β</span><span class="o">),</span> <span class="n">Y</span> <span class="n">i.down</span><span class="o">)))</span>
     <span class="o">(</span><span class="bp">@</span><span class="n">ulift.up</span> <span class="n">β</span> <span class="n">i</span><span class="o">))</span>
</code></pre></div>
<p>and I'm still stuck at one universe conflict at <code>category_theory.sites.sheaf.lean</code>.</p>



<a name="287869042"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/universe%20levels%20in%20preserves%20statements/near/287869042" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jakob von Raumer <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/universe.20levels.20in.20preserves.20statements.html#287869042">(Jun 29 2022 at 15:09)</a>:</h4>
<p><span class="user-mention" data-user-id="439483">@Andrew Yang</span> Can you have a look at <code>locally_ringed_space/has_colimits.lean</code> on the branch? Without a universe polymorphic <code>walking_parallel_pair</code>, the argument about the locally ringed space having colimits doesn't really work the same any more, because we cannot seem to generalise <code>presheafed_space/has_colimits.lean</code> to support index categories on any other universe level than the one of the morphisms of <code>C</code>...</p>



<a name="287869735"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/universe%20levels%20in%20preserves%20statements/near/287869735" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jakob von Raumer <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/universe.20levels.20in.20preserves.20statements.html#287869735">(Jun 29 2022 at 15:13)</a>:</h4>
<p>With the PR being at 1,080 additions and 758 deletions, there's still any help welcome! <span class="user-mention" data-user-id="110087">@Scott Morrison</span> <span class="user-mention" data-user-id="112680">@Johan Commelin</span></p>



<a name="287869999"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/universe%20levels%20in%20preserves%20statements/near/287869999" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Andrew Yang <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/universe.20levels.20in.20preserves.20statements.html#287869999">(Jun 29 2022 at 15:14)</a>:</h4>
<p>I have not yet looked into the problem, but doesn't <code>has_finite_limits_of_has_limits_of_size</code> (or some more universe-general version of it) solve the problem?</p>



<a name="287870278"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/universe%20levels%20in%20preserves%20statements/near/287870278" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Andrew Yang <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/universe.20levels.20in.20preserves.20statements.html#287870278">(Jun 29 2022 at 15:16)</a>:</h4>
<p>Also I would strongly suggest you to do the refactor a small portion at a time. That seems like a large diff to keep up with. Maybe one shape at a time if it is possible.</p>



<a name="287870818"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/universe%20levels%20in%20preserves%20statements/near/287870818" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jakob von Raumer <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/universe.20levels.20in.20preserves.20statements.html#287870818">(Jun 29 2022 at 15:20)</a>:</h4>
<p>Not really possible, because the generalisation of <code>preserves_limits</code> is the big chunk that breaks everything.</p>



<a name="287871310"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/universe%20levels%20in%20preserves%20statements/near/287871310" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jakob von Raumer <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/universe.20levels.20in.20preserves.20statements.html#287871310">(Jun 29 2022 at 15:23)</a>:</h4>
<p><span class="user-mention silent" data-user-id="439483">Andrew Yang</span> <a href="#narrow/stream/116395-maths/topic/universe.20levels.20in.20preserves.20statements/near/287869999">said</a>:</p>
<blockquote>
<p>I have not yet looked into the problem, but doesn't <code>has_finite_limits_of_has_limits_of_size</code> (or some more universe-general version of it) solve the problem?</p>
</blockquote>
<p>No, the lies more in some auxiliary constructions from which <code>has_coequalizers</code> is derived. Since we don't want <code>walking_parallel_pair</code> to be universe polymorphic anymore, it seems this is one of the places where we <em>do</em> have to insert ulifts</p>



<a name="287871538"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/universe%20levels%20in%20preserves%20statements/near/287871538" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Andrew Yang <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/universe.20levels.20in.20preserves.20statements.html#287871538">(Jun 29 2022 at 15:24)</a>:</h4>
<p>Is there a core statement that you want to generalize, and all the other changes are just to prevent it from breaking?</p>



<a name="287872140"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/universe%20levels%20in%20preserves%20statements/near/287872140" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jakob von Raumer <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/universe.20levels.20in.20preserves.20statements.html#287872140">(Jun 29 2022 at 15:28)</a>:</h4>
<p>I want <code>preserves_limits</code>, <code>preserves_products</code>, etc, and co to be compatible with functors between categories of different universe levels.</p>



<a name="287872295"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/universe%20levels%20in%20preserves%20statements/near/287872295" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jakob von Raumer <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/universe.20levels.20in.20preserves.20statements.html#287872295">(Jun 29 2022 at 15:29)</a>:</h4>
<p>I do feel like I'm at least 80% to 90% through the critical files, it's mostly been straightforward fixes. The only critcal areas were sheaves and biproducts</p>



<a name="287872471"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/universe%20levels%20in%20preserves%20statements/near/287872471" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Andrew Yang <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/universe.20levels.20in.20preserves.20statements.html#287872471">(Jun 29 2022 at 15:30)</a>:</h4>
<p>Could you not generalize the universe for each of the definitions one at a time?<br>
Note that the original PR <a href="https://github.com/leanprover-community/mathlib/pull/10736">#10736</a> that changed <code>preserves_limits</code> to <code>preserves_limits_of_shape</code> only has a diff of +208, -157.</p>



<a name="287872773"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/universe%20levels%20in%20preserves%20statements/near/287872773" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jakob von Raumer <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/universe.20levels.20in.20preserves.20statements.html#287872773">(Jun 29 2022 at 15:32)</a>:</h4>
<p>I never fixed anything I didn't need to. The issue is that once one changes one limit over a fixed, finite index category like coequalizers, all of the others need to be changed, too.</p>



<a name="287873231"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/universe%20levels%20in%20preserves%20statements/near/287873231" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jakob von Raumer <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/universe.20levels.20in.20preserves.20statements.html#287873231">(Jun 29 2022 at 15:35)</a>:</h4>
<p>Fixing the universe level for, say, <code>walking_pair</code> would be one first PR, but it does require all the fixes that make it so tedious right now.</p>



<a name="287873591"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/universe%20levels%20in%20preserves%20statements/near/287873591" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Andrew Yang <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/universe.20levels.20in.20preserves.20statements.html#287873591">(Jun 29 2022 at 15:37)</a>:</h4>
<p>Is there a reason that you couldn't leave <code>presheafed_space.lean</code> alone?<br>
Since the file should not depend on any particular shapes, it shouldn't break when the other files upstream provides strictly stronger statements?</p>



<a name="287875721"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/universe%20levels%20in%20preserves%20statements/near/287875721" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jakob von Raumer <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/universe.20levels.20in.20preserves.20statements.html#287875721">(Jun 29 2022 at 15:50)</a>:</h4>
<p><code>presheafed_space.lean</code> itself is fine. it's <code>presheafed_space/has_colimits.lean</code> which <em>does</em> depend on a particular shape in that references coequalizers.</p>



<a name="287876375"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/universe%20levels%20in%20preserves%20statements/near/287876375" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jakob von Raumer <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/universe.20levels.20in.20preserves.20statements.html#287876375">(Jun 29 2022 at 15:54)</a>:</h4>
<p>The file upstream is not strictly stronger because to have a maximally universe polymorphic <code>preserves_coequalizers</code> statement, we need to fix <code>walking_parallel_pair</code>s universe level and not pin it on the one of the category it's used for. This in turn causes (mostly trivial) need for fixes down the tree.</p>



<a name="287905874"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/universe%20levels%20in%20preserves%20statements/near/287905874" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Andrew Yang <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/universe.20levels.20in.20preserves.20statements.html#287905874">(Jun 29 2022 at 19:27)</a>:</h4>
<p>I pushed a attempt that seems to make both <code>presheafed_space/has_colimits.lean</code> and <code>locally_ringed_space/has_colimits.lean</code> both compile.</p>



<a name="287910577"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/universe%20levels%20in%20preserves%20statements/near/287910577" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jakob von Raumer <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/universe.20levels.20in.20preserves.20statements.html#287910577">(Jun 29 2022 at 20:04)</a>:</h4>
<p>Cool, thanks a lot!!!</p>



<a name="287924589"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/universe%20levels%20in%20preserves%20statements/near/287924589" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jakob von Raumer <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/universe.20levels.20in.20preserves.20statements.html#287924589">(Jun 29 2022 at 21:00)</a>:</h4>
<p>I think that's it, only lint errors remaining! :)</p>



<a name="287995256"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/universe%20levels%20in%20preserves%20statements/near/287995256" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jakob von Raumer <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/universe.20levels.20in.20preserves.20statements.html#287995256">(Jun 30 2022 at 08:56)</a>:</h4>
<p>PR'ed: <a href="https://github.com/leanprover-community/mathlib/pull/15067">#15067</a></p>



<a name="287995725"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/universe%20levels%20in%20preserves%20statements/near/287995725" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jakob von Raumer <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/universe.20levels.20in.20preserves.20statements.html#287995725">(Jun 30 2022 at 09:01)</a>:</h4>
<p>So if anyone volunteers to review this, I'm happy to make it a proper interactive video call review <span aria-label="grinning face with smiling eyes" class="emoji emoji-1f601" role="img" title="grinning face with smiling eyes">:grinning_face_with_smiling_eyes:</span></p>



<a name="287996988"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/universe%20levels%20in%20preserves%20statements/near/287996988" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/universe.20levels.20in.20preserves.20statements.html#287996988">(Jun 30 2022 at 09:11)</a>:</h4>
<p>So everything about finite (co)limits now happens with index categories in <code>Type</code>, right?</p>



<a name="287997055"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/universe%20levels%20in%20preserves%20statements/near/287997055" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/universe.20levels.20in.20preserves.20statements.html#287997055">(Jun 30 2022 at 09:11)</a>:</h4>
<p>And in the occasional moment where we have a finite type in a higher universe, we just have to forcefully bump it down.</p>



<a name="287997262"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/universe%20levels%20in%20preserves%20statements/near/287997262" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jakob von Raumer <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/universe.20levels.20in.20preserves.20statements.html#287997262">(Jun 30 2022 at 09:13)</a>:</h4>
<p>Exactly. This can always be done with the equivalence to <code>finset</code>.</p>



<a name="288166720"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/universe%20levels%20in%20preserves%20statements/near/288166720" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Andrew Yang <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/universe.20levels.20in.20preserves.20statements.html#288166720">(Jul 01 2022 at 13:09)</a>:</h4>
<p>Will we ever need a <code>PresheafedSpace</code> valued in <code>C : Type u</code> with <code>[category.{v} C]</code> where the topological space is not in <code>Top.{v}</code>? The downside of this that we would always need to write <code>PresheafedSpace.{v}</code>.</p>



<a name="288225859"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/universe%20levels%20in%20preserves%20statements/near/288225859" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jakob von Raumer <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/universe.20levels.20in.20preserves.20statements.html#288225859">(Jul 01 2022 at 21:27)</a>:</h4>
<p>/cc <span class="user-mention" data-user-id="110087">@Scott Morrison</span></p>



<a name="288226048"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/universe%20levels%20in%20preserves%20statements/near/288226048" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jakob von Raumer <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/universe.20levels.20in.20preserves.20statements.html#288226048">(Jul 01 2022 at 21:29)</a>:</h4>
<p>I mean it does look like a place where in the light of topos theory etc the size matters and the universes diverges...</p>



<a name="288251012"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/universe%20levels%20in%20preserves%20statements/near/288251012" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/universe.20levels.20in.20preserves.20statements.html#288251012">(Jul 02 2022 at 05:44)</a>:</h4>
<p><span class="user-mention silent" data-user-id="439483">Andrew Yang</span> <a href="#narrow/stream/116395-maths/topic/universe.20levels.20in.20preserves.20statements/near/288166720">said</a>:</p>
<blockquote>
<p>Will we ever need a <code>PresheafedSpace</code> valued in <code>C : Type u</code> with <code>[category.{v} C]</code> where the topological space is not in <code>Top.{v}</code>? The downside of this that we would always need to write <code>PresheafedSpace.{v}</code>.</p>
</blockquote>
<p>In mathematical practice: most likely not. But sometimes Lean forces a situation on you where it might be natural to have differing universes.</p>



<a name="288251020"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/universe%20levels%20in%20preserves%20statements/near/288251020" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/universe.20levels.20in.20preserves.20statements.html#288251020">(Jul 02 2022 at 05:45)</a>:</h4>
<p>I wouldn't bother generalizing it atm.</p>



<a name="288252592"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/universe%20levels%20in%20preserves%20statements/near/288252592" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Markus Himmel <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/universe.20levels.20in.20preserves.20statements.html#288252592">(Jul 02 2022 at 06:25)</a>:</h4>
<p>Jakob already generalized it, so the question is whether to un-generalize it</p>



<a name="288253646"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/universe%20levels%20in%20preserves%20statements/near/288253646" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/universe.20levels.20in.20preserves.20statements.html#288253646">(Jul 02 2022 at 06:55)</a>:</h4>
<p>I think I wouldn't bother with that either <span aria-label="lol" class="emoji emoji-1f606" role="img" title="lol">:lol:</span></p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>