---
layout: archive
title: Zulip Chat Archive
permalink: /stream/116395-maths/topic/Dimensional.20Analysis.20Community.20Input.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/116395-maths/index.html">maths</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Dimensional.20Analysis.20Community.20Input.html">Dimensional Analysis Community Input</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="297626339"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Dimensional%20Analysis%20Community%20Input/near/297626339" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Max Bobbin <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Dimensional.20Analysis.20Community.20Input.html#297626339">(Sep 07 2022 at 16:32)</a>:</h4>
<p>A recent project of mine has been formalizing <a href="https://en.wikipedia.org/wiki/Dimensional_analysis#Properties">dimensional analysis</a> in Lean. So far, I am at a point where the code is better than Sympy and nearing on par or surpassing wolfram. However, I'm at a point where I'm stuck with defining addition.  To give background, I defined a new inductive type, called dimension, which has one constructor, a function.</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">inductive</span> <span class="n">dimension</span>
<span class="bp">|</span> <span class="n">Q</span> <span class="o">:</span> <span class="n">rat</span> <span class="bp">→</span> <span class="n">rat</span> <span class="bp">→</span> <span class="n">rat</span> <span class="bp">→</span> <span class="n">rat</span> <span class="bp">→</span> <span class="n">rat</span> <span class="bp">→</span> <span class="n">rat</span> <span class="bp">→</span> <span class="n">rat</span> <span class="bp">→</span> <span class="n">dimension</span>
<span class="c1">-- L → M → N → I → θ → T → J → dimension</span>
</code></pre></div>
<p>This corresponds to the function Q = L^a*M^b*N^c*I^d*O^e*T^f*J^g, which allows any dimension to be constructed (assuming the seven common base dimensions )<br>
Thus, length is defined as:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">def</span> <span class="n">length</span>               <span class="o">:</span> <span class="n">dimension</span> <span class="o">:=</span> <span class="n">Q</span> <span class="mi">1</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span>
</code></pre></div>
<p>Defining multiplication looks like:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">protected</span> <span class="kd">def</span> <span class="n">mul</span> <span class="o">:</span> <span class="n">dimension</span> <span class="bp">→</span> <span class="n">dimension</span> <span class="bp">→</span> <span class="n">dimension</span>
<span class="bp">|</span><span class="o">(</span><span class="n">Q</span> <span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="n">d</span> <span class="n">e</span> <span class="n">f</span> <span class="n">g</span><span class="o">)</span> <span class="o">(</span><span class="n">Q</span> <span class="n">h</span> <span class="n">i</span> <span class="n">j</span> <span class="n">k</span> <span class="n">l</span> <span class="n">m</span> <span class="n">n</span><span class="o">)</span> <span class="o">:=</span> <span class="o">(</span><span class="n">Q</span> <span class="o">(</span><span class="n">a</span><span class="bp">+</span><span class="n">h</span><span class="o">)</span> <span class="o">(</span><span class="n">b</span><span class="bp">+</span><span class="n">i</span><span class="o">)</span> <span class="o">(</span><span class="n">c</span><span class="bp">+</span><span class="n">j</span><span class="o">)</span> <span class="o">(</span><span class="n">d</span><span class="bp">+</span><span class="n">k</span><span class="o">)</span> <span class="o">(</span><span class="n">e</span><span class="bp">+</span><span class="n">l</span><span class="o">)</span> <span class="o">(</span><span class="n">f</span><span class="bp">+</span><span class="n">m</span><span class="o">)</span> <span class="o">(</span><span class="n">g</span><span class="bp">+</span><span class="n">n</span><span class="o">))</span>
</code></pre></div>
<p>since the exponents just get added. The difficult part is addition. Two dimensions can be added together if they are the same, so we can add length, and get length + length = length. The other thing is we want addition to combine two of the same elements into one element, rather then multiply that element by two. This was done by</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">protected</span> <span class="kd">def</span> <span class="n">add</span> <span class="o">:</span> <span class="n">dimension</span> <span class="bp">→</span> <span class="n">dimension</span> <span class="bp">→</span> <span class="n">dimension</span>
<span class="bp">|</span><span class="o">(</span><span class="n">Q</span> <span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="n">d</span> <span class="n">e</span> <span class="n">f</span> <span class="n">g</span><span class="o">)</span> <span class="o">(</span><span class="n">Q</span> <span class="n">h</span> <span class="n">i</span> <span class="n">j</span> <span class="n">k</span> <span class="n">l</span> <span class="n">m</span> <span class="n">n</span><span class="o">)</span> <span class="o">:=</span> <span class="n">ite</span> <span class="o">(</span><span class="n">a</span><span class="bp">=</span><span class="n">h</span><span class="bp">∧</span><span class="n">b</span><span class="bp">=</span><span class="n">i</span><span class="bp">∧</span><span class="n">c</span><span class="bp">=</span><span class="n">j</span><span class="bp">∧</span><span class="n">d</span><span class="bp">=</span><span class="n">k</span><span class="bp">∧</span><span class="n">e</span><span class="bp">=</span><span class="n">l</span><span class="bp">∧</span><span class="n">f</span><span class="bp">=</span><span class="n">m</span><span class="bp">∧</span><span class="n">g</span><span class="bp">=</span><span class="n">n</span><span class="o">)</span> <span class="o">(</span><span class="n">Q</span> <span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="n">d</span> <span class="n">e</span> <span class="n">f</span> <span class="n">g</span><span class="o">)</span> <span class="n">dimensionless</span>
</code></pre></div>
<p>where dimensionless is defined as </p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">def</span> <span class="n">dimensionless</span>        <span class="o">:</span> <span class="n">dimension</span> <span class="o">:=</span> <span class="n">Q</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span>
</code></pre></div>
<p>In this case, dimensionless is used as a junk value that is thrown for improper addition. This definition encompasses most of the addition, but there is one more case. Adding a dimensionless number with a dimension simplifies to that dimension. So, dimensionless_number + length = length. The dimensionless number takes on the role of the identity element. For multiplication, it acts like 1 and for addition, it acts like zero. <br>
I wanted to get feedback from the community and suggestions on how to implement this functionality. Specifically, defining addition so that the only acceptable cases are either addition of two of the same elements or an element with a dimensionless number.</p>



<a name="297627680"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Dimensional%20Analysis%20Community%20Input/near/297627680" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Dimensional.20Analysis.20Community.20Input.html#297627680">(Sep 07 2022 at 16:39)</a>:</h4>
<p>Can't you just do</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">protected</span> <span class="kd">def</span> <span class="n">add</span> <span class="o">:</span> <span class="n">dimension</span> <span class="bp">→</span> <span class="n">dimension</span> <span class="bp">→</span> <span class="n">dimension</span> <span class="o">:=</span>
<span class="bp">λ</span> <span class="n">Q₁</span> <span class="n">Q₂</span><span class="o">,</span>
     <span class="k">if</span> <span class="n">Q₁</span> <span class="bp">=</span> <span class="n">Q₂</span> <span class="k">then</span> <span class="n">Q₁</span>
<span class="k">else</span> <span class="k">if</span> <span class="n">Q₁</span> <span class="bp">=</span> <span class="n">dimensionless</span> <span class="k">then</span> <span class="n">Q₂</span>
<span class="k">else</span> <span class="k">if</span> <span class="n">Q₂</span> <span class="bp">=</span> <span class="n">dimensionless</span> <span class="k">then</span> <span class="n">Q₁</span>
<span class="k">else</span> <span class="n">dimensionless</span>
</code></pre></div>



<a name="297628694"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Dimensional%20Analysis%20Community%20Input/near/297628694" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Andrew Yang <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Dimensional.20Analysis.20Community.20Input.html#297628694">(Sep 07 2022 at 16:44)</a>:</h4>
<p>I don't think adding a dimensionless number with one with a dimension makes sense though?<br>
What is <code>2 seconds + π</code> ? Is <code>(2 seconds + π) * 1 second</code> equal to <code>6 seconds ^ 2 + π seconds</code>?</p>



<a name="297629376"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Dimensional%20Analysis%20Community%20Input/near/297629376" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Dimensional.20Analysis.20Community.20Input.html#297629376">(Sep 07 2022 at 16:48)</a>:</h4>
<p>Maybe you want to talk about <code>\Q[length, time, ...]</code>?</p>



<a name="297629457"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Dimensional%20Analysis%20Community%20Input/near/297629457" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Dimensional.20Analysis.20Community.20Input.html#297629457">(Sep 07 2022 at 16:49)</a>:</h4>
<p>Or rather the corresponding <code>add_monoid_algebra</code></p>



<a name="297630658"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Dimensional%20Analysis%20Community%20Input/near/297630658" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Andrew Yang <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Dimensional.20Analysis.20Community.20Input.html#297630658">(Sep 07 2022 at 16:55)</a>:</h4>
<p>I think <code>fin n -&gt; rat</code> might be a better approach than what you have now. Also I wouldn't restrain to the case <code>n = 7</code> since there are cases where introducing additional base units are useful.</p>



<a name="297632247"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Dimensional%20Analysis%20Community%20Input/near/297632247" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kyle Miller <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Dimensional.20Analysis.20Community.20Input.html#297632247">(Sep 07 2022 at 17:04)</a>:</h4>
<p>Another option is to effectively use <code>option dimension</code>, with <code>none</code> signalling that there is an error in the dimensional analysis.<br>
If you want, you can encode that as</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">inductive</span> <span class="n">dimension</span>
<span class="bp">|</span> <span class="n">Q</span> <span class="o">:</span> <span class="n">rat</span> <span class="bp">→</span> <span class="n">rat</span> <span class="bp">→</span> <span class="n">rat</span> <span class="bp">→</span> <span class="n">rat</span> <span class="bp">→</span> <span class="n">rat</span> <span class="bp">→</span> <span class="n">rat</span> <span class="bp">→</span> <span class="n">rat</span> <span class="bp">→</span> <span class="n">dimension</span>
<span class="bp">|</span> <span class="n">error</span> <span class="o">:</span> <span class="n">dimension</span>
</code></pre></div>
<p>and then you have that any operation that involves a dimension error yields a dimension error. It's like a NaN for dimensions.</p>
<p>If you make errors yield <code>dimensionless</code>, then you can get weird situations like <code>(1 second + 1 ft) * 3 kg = 6 kg</code></p>



<a name="297633789"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Dimensional%20Analysis%20Community%20Input/near/297633789" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Max Bobbin <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Dimensional.20Analysis.20Community.20Input.html#297633789">(Sep 07 2022 at 17:14)</a>:</h4>
<p><span class="user-mention silent" data-user-id="439483">Andrew Yang</span> <a href="#narrow/stream/116395-maths/topic/Dimensional.20Analysis.20Community.20Input/near/297628694">said</a>:</p>
<blockquote>
<p>I don't think adding a dimensionless number with one with a dimension makes sense though?<br>
What is <code>2 seconds + π</code> ? Is <code>(2 seconds + π) * 1 second</code> equal to <code>6 seconds ^ 2 + π seconds</code>?</p>
</blockquote>
<p>I see the contradiction you are trying to show, but I don't think there ends up being a problem. If you had seconds*(seoncds+dimensionless) = seconds^2+seconds. If we used the addition rule, we would get seconds = seconds^2+seconds, and we could factor the right side to get seconds = seconds. We are looking at dimensional congruity. The reason I think we have to have this rule is Buckingham Pi Theorem stipulates that the dimensions form a vector field over the rational numbers. In Lean, the module definition requires the module part to be an add_comm_monoid, which requires this idea of adding an identity element.</p>



<a name="297634121"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Dimensional%20Analysis%20Community%20Input/near/297634121" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Max Bobbin <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Dimensional.20Analysis.20Community.20Input.html#297634121">(Sep 07 2022 at 17:16)</a>:</h4>
<p><span class="user-mention silent" data-user-id="387244">Yaël Dillies</span> <a href="#narrow/stream/116395-maths/topic/Dimensional.20Analysis.20Community.20Input/near/297629376">said</a>:</p>
<blockquote>
<p>Maybe you want to talk about <code>\Q[length, time, ...]</code>?</p>
</blockquote>
<p>Could you elaborate on what the <code> \Q[length, time, ...]</code> means? I've never used something like that in Lean before</p>



<a name="297634370"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Dimensional%20Analysis%20Community%20Input/near/297634370" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Max Bobbin <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Dimensional.20Analysis.20Community.20Input.html#297634370">(Sep 07 2022 at 17:17)</a>:</h4>
<p><span class="user-mention silent" data-user-id="439483">Andrew Yang</span> <a href="#narrow/stream/116395-maths/topic/Dimensional.20Analysis.20Community.20Input/near/297630658">said</a>:</p>
<blockquote>
<p>I think <code>fin n -&gt; rat</code> might be a better approach than what you have now. Also I wouldn't restrain to the case <code>n = 7</code> since there are cases where introducing additional base units are useful.</p>
</blockquote>
<p>I can try out this, I see what you that its much more manageable then seven rat and arrows, but I would need to learn how to properly use <code> fin n</code> so it translate to what I've been doing so far.</p>



<a name="297635763"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Dimensional%20Analysis%20Community%20Input/near/297635763" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Andrew Yang <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Dimensional.20Analysis.20Community.20Input.html#297635763">(Sep 07 2022 at 17:25)</a>:</h4>
<p>I don't really get what you mean by factor out <code>seconds^2+seconds</code>. I think we both agree that adding two different dimensions (as in this expression) is meaningless?<br>
The dimension forms a <code>Q</code>-vector field because multiplying two dimensions corresponds to adding the exponents of each base units. The <code>Q</code>-action refers to taking powers. There is no "addition of dimensions" involved, and there should be no need to adjoin an identity: the <code>dimensionless</code> is already a multiplicative identity.</p>



<a name="297638185"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Dimensional%20Analysis%20Community%20Input/near/297638185" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Max Bobbin <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Dimensional.20Analysis.20Community.20Input.html#297638185">(Sep 07 2022 at 17:37)</a>:</h4>
<p>Yes, I see the contradictions that could form. I'm not trying to advocate for adding two different dimensions. The problem I'm having is showing that this <code>Q</code>-vector field exists. Using the module class that Lean already defines requires that dimension be an <code>add_comm_monoid</code>, which requires the idea of a zero element and adding the identity element. Plus, to use the definitions of the basis vectors requires this same property as well as being a <code>module</code>. I could just define a vector space and basis vectors and such without these requirements, but I didn't think this would be necessary and I could just use the <code>module</code> class already definined</p>



<a name="297639117"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Dimensional%20Analysis%20Community%20Input/near/297639117" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Max Bobbin <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Dimensional.20Analysis.20Community.20Input.html#297639117">(Sep 07 2022 at 17:43)</a>:</h4>
<p><span class="user-mention silent" data-user-id="439483">Andrew Yang</span> <a href="#narrow/stream/116395-maths/topic/Dimensional.20Analysis.20Community.20Input/near/297635763">said</a>:</p>
<blockquote>
<p>I don't really get what you mean by factor out <code>seconds^2+seconds</code>. I think we both agree that adding two different dimensions (as in this expression) is meaningless?<br>
The dimension forms a <code>Q</code>-vector space because multiplying two dimensions corresponds to adding the exponents of each base units. The <code>Q</code>-action refers to taking powers. There is no "addition of dimensions" involved, and there should be no need to adjoin an identity: the <code>dimensionless</code> is already a multiplicative identity.</p>
</blockquote>
<p>However, doesn't it mean that if dimension forms a <code>Q</code> - vector space, then dimension must be an additive abelian group?</p>



<a name="297639281"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Dimensional%20Analysis%20Community%20Input/near/297639281" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Andrew Yang <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Dimensional.20Analysis.20Community.20Input.html#297639281">(Sep 07 2022 at 17:44)</a>:</h4>
<p>The <code>add_comm_monoid</code> is given by realizing each dimension as a <code>n</code>-tuple of exponents, and adding each exponent correspondingly. This in turn corresponds to <strong>multiplication</strong> of the dimensions and not the <strong>addition</strong> of the dimension.</p>



<a name="297639685"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Dimensional%20Analysis%20Community%20Input/near/297639685" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Andrew Yang <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Dimensional.20Analysis.20Community.20Input.html#297639685">(Sep 07 2022 at 17:46)</a>:</h4>
<p>By modeling dimensions as <code>fin n -&gt; rat</code>, this vector space structure will come for free.</p>



<a name="297639707"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Dimensional%20Analysis%20Community%20Input/near/297639707" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Max Bobbin <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Dimensional.20Analysis.20Community.20Input.html#297639707">(Sep 07 2022 at 17:46)</a>:</h4>
<p>Ok, just had the break thought I needed. Thank you so much, that clears things up. I think that was the blockade that was confusing me, but I'm now on the same page. Thank you for your time and help! After I finish class, I'm going to try this out</p>



<a name="297639744"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Dimensional%20Analysis%20Community%20Input/near/297639744" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Max Bobbin <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Dimensional.20Analysis.20Community.20Input.html#297639744">(Sep 07 2022 at 17:46)</a>:</h4>
<p>Ok, that's perfect. I'll try that out tonight</p>



<a name="297643270"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Dimensional%20Analysis%20Community%20Input/near/297643270" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Anand Rao <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Dimensional.20Analysis.20Community.20Input.html#297643270">(Sep 07 2022 at 17:52)</a>:</h4>
<p>Since dimension is more the analog of a "type" of a physical quantity, would including the dimension information at the type level help here?</p>
<p>What I had in mind is something like this:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">inductive</span> <span class="n">physical_quantity</span> <span class="o">{</span><span class="n">R</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">comm_ring</span> <span class="n">R</span><span class="o">]</span> <span class="o">:</span> <span class="n">R</span> <span class="bp">→</span> <span class="n">R</span> <span class="bp">→</span> <span class="n">R</span> <span class="bp">→</span> <span class="n">R</span> <span class="bp">→</span> <span class="n">R</span> <span class="bp">→</span> <span class="n">R</span> <span class="bp">→</span> <span class="n">R</span> <span class="bp">→</span> <span class="kt">Type</span><span class="bp">*</span>
</code></pre></div>
<p>where this inductive type either has no constructors, or has a single constructor for introducing a "value".</p>
<p>This way the problem of type-safe addition of physical quantities can be delegated to Lean.</p>



<a name="297651049"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Dimensional%20Analysis%20Community%20Input/near/297651049" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yakov Pechersky <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Dimensional.20Analysis.20Community.20Input.html#297651049">(Sep 07 2022 at 18:38)</a>:</h4>
<p>I would suggest using a <code>structure</code> instead of a plain <code>inductive</code> to be able to index into each base through keywords</p>



<a name="297656708"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Dimensional%20Analysis%20Community%20Input/near/297656708" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Max Bobbin <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Dimensional.20Analysis.20Community.20Input.html#297656708">(Sep 07 2022 at 19:12)</a>:</h4>
<p>I think I can already do that with <code>inductive</code> though. Since, I can use <code>def</code> to define the seven base dimensions</p>



<a name="297948629"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Dimensional%20Analysis%20Community%20Input/near/297948629" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Tomas Skrivan <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Dimensional.20Analysis.20Community.20Input.html#297948629">(Sep 09 2022 at 11:04)</a>:</h4>
<p>This got me interested how to do dimensional analysis in Lean 4, I also got into a <a href="#narrow/stream/270676-lean4/topic/dimensional.20analysis.20and.20arithmetic.20in.20type">problem with addition</a></p>
<p>To me it seems you are not making the distinction between the unit itself and a value that has a unit. I would say you can't add units but you can add values with the same units. </p>
<p>Also I would argue that the unit checking should be done on the type checking level i.e. I do not like that adding two different units produce a junk value. I think such addition should be disallowed by the type system.</p>



<a name="297949065"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Dimensional%20Analysis%20Community%20Input/near/297949065" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Dimensional.20Analysis.20Community.20Input.html#297949065">(Sep 09 2022 at 11:07)</a>:</h4>
<p>what if two units are propeq but not defeq? would seem like a pain</p>



<a name="297949248"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Dimensional%20Analysis%20Community%20Input/near/297949248" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Dimensional.20Analysis.20Community.20Input.html#297949248">(Sep 09 2022 at 11:08)</a>:</h4>
<p>What about just using formal series? Then you can add two values with different units without junk values.</p>



<a name="297949251"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Dimensional%20Analysis%20Community%20Input/near/297949251" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Tomas Skrivan <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Dimensional.20Analysis.20Community.20Input.html#297949251">(Sep 09 2022 at 11:08)</a>:</h4>
<p>Yes that is exactly the problem I got into :/</p>



<a name="297949282"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Dimensional%20Analysis%20Community%20Input/near/297949282" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Dimensional.20Analysis.20Community.20Input.html#297949282">(Sep 09 2022 at 11:08)</a>:</h4>
<p>also maybe it's worth to have physical quantity just be <code>fin n -&gt; rat</code> or something, because that way a) you can reuse API b) you can add random units that maybe don't exist but are useful theoretically or exclude units you don't care about at the time</p>



<a name="297949299"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Dimensional%20Analysis%20Community%20Input/near/297949299" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Dimensional.20Analysis.20Community.20Input.html#297949299">(Sep 09 2022 at 11:08)</a>:</h4>
<p><code>fin 7 -&gt; rat</code> also makes sense</p>



<a name="297949386"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Dimensional%20Analysis%20Community%20Input/near/297949386" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Dimensional.20Analysis.20Community.20Input.html#297949386">(Sep 09 2022 at 11:09)</a>:</h4>
<p>multiplication should then come automatically from <code>pi.has_mul</code>, addition would need a specific definition but</p>



<a name="297950475"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Dimensional%20Analysis%20Community%20Input/near/297950475" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Tomas Skrivan <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Dimensional.20Analysis.20Community.20Input.html#297950475">(Sep 09 2022 at 11:17)</a>:</h4>
<p>The <code>fin n -&gt; rat</code> would be used for the unit not a quantity(value + unit), right?</p>



<a name="297957369"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Dimensional%20Analysis%20Community%20Input/near/297957369" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Dimensional.20Analysis.20Community.20Input.html#297957369">(Sep 09 2022 at 12:04)</a>:</h4>
<p>yea</p>



<a name="297958897"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Dimensional%20Analysis%20Community%20Input/near/297958897" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Tomas Skrivan <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Dimensional.20Analysis.20Community.20Input.html#297958897">(Sep 09 2022 at 12:14)</a>:</h4>
<p>Why would you need multiplication on that type then?</p>



<a name="297959646"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Dimensional%20Analysis%20Community%20Input/near/297959646" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Dimensional.20Analysis.20Community.20Input.html#297959646">(Sep 09 2022 at 12:18)</a>:</h4>
<p>meters squared * per seconds for example</p>



<a name="297960112"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Dimensional%20Analysis%20Community%20Input/near/297960112" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Dimensional.20Analysis.20Community.20Input.html#297960112">(Sep 09 2022 at 12:21)</a>:</h4>
<p>When do <code>rat</code>-valued powers of units show up? (I only ever studied physics in high school...)</p>



<a name="297963958"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Dimensional%20Analysis%20Community%20Input/near/297963958" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Tomas Skrivan <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Dimensional.20Analysis.20Community.20Input.html#297963958">(Sep 09 2022 at 12:42)</a>:</h4>
<p><span class="user-mention silent" data-user-id="284160">Eric Rodriguez</span> <a href="#narrow/stream/116395-maths/topic/Dimensional.20Analysis.20Community.20Input/near/297959646">said</a>:</p>
<blockquote>
<p>meters squared * per seconds for example</p>
</blockquote>
<p>Maybe I'm misunderstanding something , but then you are adding or subtracting the powers: <code>m^1 * m^1 * s^(-1) = m^(1+1) * s^(-1)</code>, no?</p>



<a name="297963989"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Dimensional%20Analysis%20Community%20Input/near/297963989" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Shing Tak Lam <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Dimensional.20Analysis.20Community.20Input.html#297963989">(Sep 09 2022 at 12:42)</a>:</h4>
<p><span class="user-mention silent" data-user-id="112680">Johan Commelin</span> <a href="#narrow/stream/116395-maths/topic/Dimensional.20Analysis.20Community.20Input/near/297960112">said</a>:</p>
<blockquote>
<p>When do <code>rat</code>-valued powers of units show up? (I only ever studied physics in high school...)</p>
</blockquote>
<p><a href="https://physics.stackexchange.com/questions/350121/what-is-the-unit-dimension-of-the-3-dimensional-position-space-wavefunction">Wave functions in quantum mechanics</a></p>



<a name="297965810"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Dimensional%20Analysis%20Community%20Input/near/297965810" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Dimensional.20Analysis.20Community.20Input.html#297965810">(Sep 09 2022 at 12:53)</a>:</h4>
<p><span class="user-mention silent" data-user-id="346070">Tomas Skrivan</span> <a href="#narrow/stream/116395-maths/topic/Dimensional.20Analysis.20Community.20Input/near/297963958">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="284160">Eric Rodriguez</span> <a href="#narrow/stream/116395-maths/topic/Dimensional.20Analysis.20Community.20Input/near/297959646">said</a>:</p>
<blockquote>
<p>meters squared * per seconds for example</p>
</blockquote>
<p>Maybe I'm misunderstanding something , but then you are adding or subtracting the powers: <code>m^1 * m^1 * s^(-1) = m^(1+1) * s^(-1)</code>, no?</p>
</blockquote>
<p>ahh, sure, you definitely have to take care with the multiplication. sorry!</p>



<a name="297976432"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Dimensional%20Analysis%20Community%20Input/near/297976432" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Tomas Skrivan <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Dimensional.20Analysis.20Community.20Input.html#297976432">(Sep 09 2022 at 13:46)</a>:</h4>
<p>Now I'm thinking about it. A unit should be <code>fin n -&gt; rat × rat</code>, it needs scaling and power.</p>
<p>For example this should be expressible: <code>feet * km = 0,3048 m * 1000 m = 306,8 m^2</code>. So we need multiplication in the first(scale) component and addition in the second(power).</p>



<a name="297982156"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Dimensional%20Analysis%20Community%20Input/near/297982156" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Andrew Yang <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Dimensional.20Analysis.20Community.20Input.html#297982156">(Sep 09 2022 at 14:09)</a>:</h4>
<p>I don't think we should focus on units rather than dimensions. And I don't think we should care about adding or multiplying concrete physical quantities since we would like the results to cover arbitrary transcendental functions. In particular, If a function <code>f : (fin n -&gt; real) -&gt; real</code> whose arguments have dimensions <code>d : fin n -&gt; dimension</code> scales like some <code>d' : dimension</code> under the scalings induced by <code>d</code> on <code>fin n -&gt; real</code>, it should be considered "physically meaningful" with dimension <code>d'</code> and our result should apply on it.</p>



<a name="297984836"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Dimensional%20Analysis%20Community%20Input/near/297984836" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Tomas Skrivan <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Dimensional.20Analysis.20Community.20Input.html#297984836">(Sep 09 2022 at 14:23)</a>:</h4>
<p>Makes sense, I guess it depends what is the application. My interest in this is to write code that prevents another Mars Climate Orbiter crash :)</p>



<a name="298139564"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Dimensional%20Analysis%20Community%20Input/near/298139564" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Dimensional.20Analysis.20Community.20Input.html#298139564">(Sep 10 2022 at 13:53)</a>:</h4>
<p>Does the defeq problem actually come up? It seems quite unusual for your dimensions not to be known constants rather than free variables</p>



<a name="298147247"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Dimensional%20Analysis%20Community%20Input/near/298147247" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Tomas Skrivan <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Dimensional.20Analysis.20Community.20Input.html#298147247">(Sep 10 2022 at 14:59)</a>:</h4>
<p>In my Lean 4 <a href="#narrow/stream/270676-lean4/topic/dimensional.20analysis.20and.20arithmetic.20in.20type">attempt</a> the defeq problem definitely comes up. For example 'meter per second' times 'second' is not defeq to meter, or at least I don't know how to make it so.</p>



<a name="298180717"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Dimensional%20Analysis%20Community%20Input/near/298180717" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Dimensional.20Analysis.20Community.20Input.html#298180717">(Sep 10 2022 at 21:40)</a>:</h4>
<p>I don't see how that could be the case, that sounds like claiming that <code>{s := -1 + 1, m := 1}</code> is not defeq to <code>{s := 0, m := 1}</code></p>



<a name="298180742"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Dimensional%20Analysis%20Community%20Input/near/298180742" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Dimensional.20Analysis.20Community.20Input.html#298180742">(Sep 10 2022 at 21:41)</a>:</h4>
<p>It looks like your problem in that thread is that lean is not attempting to unify the types and check if they're defeq</p>



<a name="298180752"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Dimensional%20Analysis%20Community%20Input/near/298180752" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Dimensional.20Analysis.20Community.20Input.html#298180752">(Sep 10 2022 at 21:41)</a>:</h4>
<p>And instead is using typeclass inference to match syntactically</p>



<a name="298186876"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Dimensional%20Analysis%20Community%20Input/near/298186876" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Tomas Skrivan <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Dimensional.20Analysis.20Community.20Input.html#298186876">(Sep 10 2022 at 23:28)</a>:</h4>
<p>Ohh I see, that makes sense. Well, it looks like that I do not understand defeq properly.</p>



<a name="298187973"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Dimensional%20Analysis%20Community%20Input/near/298187973" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Dimensional.20Analysis.20Community.20Input.html#298187973">(Sep 10 2022 at 23:49)</a>:</h4>
<p>I don't know what the solution to your issue is though; I think this is a problem that Lean 3 solves by only having homogenous multiplication, which forces lean to unify the two types into a single defeq type</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>