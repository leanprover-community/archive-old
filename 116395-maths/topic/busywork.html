---
layout: archive
title: Zulip Chat Archive
permalink: /stream/116395-maths/topic/busywork.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/116395-maths/index.html">maths</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/busywork.html">busywork</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="244406974"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/busywork/near/244406974" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/busywork.html#244406974">(Jun 30 2021 at 11:08)</a>:</h4>
<p>I am not 100% sure I know what this word means, but I think it's interesting that three Imperial mathematician <span class="user-mention" data-user-id="250372">@Ashvni Narayanan</span> <span class="user-mention" data-user-id="118107">@Amelia Livingston</span> and <span class="user-mention" data-user-id="243312">@Jason KY.</span> all cut their teeth in the PR process with work doing stuff like bundling subobjects or morphisms ("we've done subrings but now we want subsemirings" or whatever). Why do we have a folder called <code>deprecated</code> in mathlib? Might removing this folder become quite a good summer project for mathematicians beginners? The mathematical material there is all very familiar to them. What needs to be done? I know I've asked this before, but I have a bunch of people looking for summer projects right now and need training material.</p>



<a name="244407155"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/busywork/near/244407155" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/busywork.html#244407155">(Jun 30 2021 at 11:10)</a>:</h4>
<p><code>deprecated/</code> shouldn't be removed. Instead, we need <code>is_group_hom</code> (and friends) to move from <code>class</code> to <code>structure</code>, and all the instances should become lemmas, etc...</p>



<a name="244407183"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/busywork/near/244407183" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/busywork.html#244407183">(Jun 30 2021 at 11:11)</a>:</h4>
<p>After that, they should just become part of regular mathlib, instead of living a poor and uncomfy life in <code>deprecated/</code></p>



<a name="244407417"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/busywork/near/244407417" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/busywork.html#244407417">(Jun 30 2021 at 11:13)</a>:</h4>
<p>In <code>subring.lean</code> (non-deprecated) it says</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">Let</span> <span class="bp">`</span><span class="n">R</span><span class="bp">`</span> <span class="n">be</span> <span class="n">a</span> <span class="n">ring.</span> <span class="n">This</span> <span class="n">file</span> <span class="n">defines</span> <span class="n">the</span> <span class="s2">"bundled"</span> <span class="n">subring</span> <span class="n">type</span> <span class="bp">`</span><span class="n">subring</span> <span class="n">R</span><span class="bp">`</span><span class="o">,</span> <span class="n">a</span> <span class="n">type</span>
<span class="n">whose</span> <span class="n">terms</span> <span class="n">correspond</span> <span class="n">to</span> <span class="n">subrings</span> <span class="n">of</span> <span class="bp">`</span><span class="n">R</span><span class="bp">`.</span> <span class="n">This</span> <span class="n">is</span> <span class="n">the</span> <span class="n">preferred</span> <span class="n">way</span> <span class="n">to</span> <span class="n">talk</span>
<span class="n">about</span> <span class="n">subrings</span> <span class="k">in</span> <span class="n">mathlib.</span> <span class="n">Unbundled</span> <span class="n">subrings</span> <span class="o">(</span><span class="bp">`</span><span class="n">s</span> <span class="o">:</span> <span class="n">set</span> <span class="n">R</span><span class="bp">`</span> <span class="n">and</span> <span class="bp">`</span><span class="n">is_subring</span> <span class="n">s</span><span class="bp">`</span><span class="o">)</span>
<span class="n">are</span> <span class="n">not</span> <span class="k">in</span> <span class="n">this</span> <span class="n">file</span><span class="o">,</span> <span class="n">and</span> <span class="n">they</span> <span class="n">will</span> <span class="n">ultimately</span> <span class="n">be</span> <span class="n">deprecated.</span>
</code></pre></div>
<p>So This means "unbundled subrings will still exist, they're just not in <code>simp</code> normal form"?</p>



<a name="244408841"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/busywork/near/244408841" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/busywork.html#244408841">(Jun 30 2021 at 11:28)</a>:</h4>
<p>Yep, that's my understanding of what is the best design (as far as we can see now)</p>



<a name="244409897"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/busywork/near/244409897" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/busywork.html#244409897">(Jun 30 2021 at 11:41)</a>:</h4>
<p>My impression is that after doing what Johan describes, there may be benefits to redefining <code>abbreviation subring:= subtype is_subring</code>, since that gives us the ability to generalize statements like <a href="https://leanprover-community.github.io/mathlib_docs/find/subring.coe_add">docs#subring.coe_add</a>.</p>



<a name="244410226"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/busywork/near/244410226" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/busywork.html#244410226">(Jun 30 2021 at 11:45)</a>:</h4>
<p>So that would be a massive <code>subring</code> refactor?</p>



<a name="244410295"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/busywork/near/244410295" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/busywork.html#244410295">(Jun 30 2021 at 11:46)</a>:</h4>
<p>I had not internalised this before</p>



<a name="244410350"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/busywork/near/244410350" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/busywork.html#244410350">(Jun 30 2021 at 11:47)</a>:</h4>
<p>You think the fundamental object from the point of view of CS is <code>is_subring</code>, and <code>subring</code> should be built on top?</p>



<a name="244410375"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/busywork/near/244410375" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/busywork.html#244410375">(Jun 30 2021 at 11:47)</a>:</h4>
<p>I think <code>subtype</code> gives us much more generalization power than building a new structure each time</p>



<a name="244410537"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/busywork/near/244410537" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/busywork.html#244410537">(Jun 30 2021 at 11:49)</a>:</h4>
<p>The idea behind <a href="https://leanprover-community.github.io/mathlib_docs/find/set_like">docs#set_like</a> is to say "look, this is basically just a subtype of a set". The alternative would be to make our subobjects defeq to subtypes of sets.</p>



<a name="244410561"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/busywork/near/244410561" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/busywork.html#244410561">(Jun 30 2021 at 11:49)</a>:</h4>
<p>I don't know to what extent that would pay off yet</p>



<a name="244410669"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/busywork/near/244410669" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/busywork.html#244410669">(Jun 30 2021 at 11:50)</a>:</h4>
<p>Does dot notation work with <code>abbreviation</code>s? <code>S.to_add_subgroup_mono</code> for <code>S : subring R</code>?</p>



<a name="244417430"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/busywork/near/244417430" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Anne Baanen <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/busywork.html#244417430">(Jun 30 2021 at 12:48)</a>:</h4>
<p>It does, <code>abbreviation</code> is basically the same as <code>@[reducible] def</code> so it sticks around in expressions:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">abbreviation</span> <span class="n">nat_abbr</span> <span class="o">:=</span> <span class="n">nat</span>

<span class="kd">def</span> <span class="n">nat_abbr.zero</span> <span class="o">:</span> <span class="n">nat_abbr</span> <span class="o">:=</span> <span class="mi">0</span>
<span class="kd">def</span> <span class="n">nat_abbr.foo</span> <span class="o">:</span> <span class="n">nat_abbr</span> <span class="bp">→</span> <span class="n">nat_abbr</span> <span class="bp">→</span> <span class="n">nat_abbr</span> <span class="o">:=</span> <span class="o">(</span><span class="n">has_add.add</span> <span class="o">:</span> <span class="n">ℕ</span> <span class="bp">→</span> <span class="n">ℕ</span> <span class="bp">→</span> <span class="n">ℕ</span><span class="o">)</span>

<span class="kd">example</span> <span class="o">:</span> <span class="n">nat_abbr.zero.foo</span> <span class="n">nat_abbr.zero</span> <span class="bp">=</span> <span class="n">nat_abbr.zero</span> <span class="o">:=</span> <span class="n">rfl</span>
</code></pre></div>



<a name="244417693"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/busywork/near/244417693" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Anne Baanen <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/busywork.html#244417693">(Jun 30 2021 at 12:50)</a>:</h4>
<p>This is different from <code>notation</code>, which is only a parsing thing and doesn't appear in expressions:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">notation</span> <span class="bp">`</span><span class="n">nat_notation</span><span class="bp">`</span> <span class="o">:=</span> <span class="n">nat</span>

<span class="kd">def</span> <span class="n">nat_notation.zero</span> <span class="o">:</span> <span class="n">nat_notation</span> <span class="o">:=</span> <span class="mi">0</span>
<span class="kd">def</span> <span class="n">nat_notation.foo</span> <span class="o">:=</span> <span class="o">(</span><span class="n">has_add.add</span> <span class="o">:</span> <span class="n">ℕ</span> <span class="bp">→</span> <span class="n">ℕ</span> <span class="bp">→</span> <span class="n">ℕ</span><span class="o">)</span>

<span class="kd">example</span> <span class="o">:</span> <span class="n">nat_notation.zero.foo</span> <span class="n">nat_notation.zero</span> <span class="bp">=</span> <span class="n">nat_abbr.zero</span> <span class="o">:=</span> <span class="n">rfl</span> <span class="c1">-- error, `nat.foo` undefined</span>
</code></pre></div>



<a name="244418311"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/busywork/near/244418311" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/busywork.html#244418311">(Jun 30 2021 at 12:54)</a>:</h4>
<p>Do abbreviations also mean that you're now stuck with _every_ <code>nat</code> appearing as <code>nat_abbr</code> in the prettyprinter until you've finished with the abbreviation?</p>



<a name="244418886"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/busywork/near/244418886" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Anne Baanen <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/busywork.html#244418886">(Jun 30 2021 at 12:59)</a>:</h4>
<p>No, it really creates something new. So <code>ideal R</code> could have been defined as an <code>abbreviation</code> for <code>submodule R R</code> instead of <code>@[reducible] def</code> as it is now. There is still the distinction between <code>ideal R</code> and <code>submodule R R</code>.</p>



<a name="244422344"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/busywork/near/244422344" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/busywork.html#244422344">(Jun 30 2021 at 13:22)</a>:</h4>
<p>So why aren't we using <code>vector_space</code> as an abbreviation for <code>module</code>? Then I could still use vector space in teaching materials and...oh, I then have to move over all of <code>module.foo</code> into <code>vector_space.foo</code> :-/</p>



<a name="244423092"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/busywork/near/244423092" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/busywork.html#244423092">(Jun 30 2021 at 13:27)</a>:</h4>
<p>Damn, I'm always half confused when I need to talk about the difference between abbreviation and notation. That's why I hesitated to write anything at all in this discussion.</p>



<a name="244423861"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/busywork/near/244423861" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Anne Baanen <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/busywork.html#244423861">(Jun 30 2021 at 13:33)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110038">Kevin Buzzard</span> <a href="#narrow/stream/116395-maths/topic/busywork/near/244422344">said</a>:</p>
<blockquote>
<p>So why aren't we using <code>vector_space</code> as an abbreviation for <code>module</code>? Then I could still use vector space in teaching materials and...oh, I then have to move over all of <code>module.foo</code> into <code>vector_space.foo</code> :-/</p>
</blockquote>
<p>That was exactly the old situation before <a href="https://github.com/leanprover-community/mathlib/issues/7322">#7322</a>: <code>vector_space K V</code> is an <code>abbreviation</code> for <code>semimodule K V</code> with extra assumptions <code>[field K] [add_comm_group V]</code>.</p>



<a name="244424576"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/busywork/near/244424576" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Anne Baanen <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/busywork.html#244424576">(Jun 30 2021 at 13:38)</a>:</h4>
<p>I can't find where it was discussed, but there was also the possibility of defining</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">abbreviation</span> <span class="n">vector_space</span> <span class="o">(</span><span class="n">K</span> <span class="n">V</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">[</span><span class="n">semiring</span> <span class="n">K</span><span class="o">]</span> <span class="o">[</span><span class="n">add_comm_monoid</span> <span class="n">V</span><span class="o">]</span> <span class="o">:=</span> <span class="n">module</span> <span class="n">K</span> <span class="n">V</span>
</code></pre></div>
<p>which should have a lot less drawbacks, although it's mathematically slightly lying.</p>



<a name="244424674"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/busywork/near/244424674" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/busywork.html#244424674">(Jun 30 2021 at 13:39)</a>:</h4>
<p>So maybe <code>notation</code> would be perfect for <code>vector_space</code>, let it apply in all situations, the point being that what we are trying to do with <code>vector_space</code> is <em>shield</em> a beginner UG from the word <code>module</code> completely because it sounds intimidating.</p>



<a name="244424855"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/busywork/near/244424855" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/busywork.html#244424855">(Jun 30 2021 at 13:40)</a>:</h4>
<p>The moment they start using modules and vector spaces you just disable the notation because they're not scared of modules any more. Isn't this a perfect thing to do in localised notation? It seems to me that it might solve all the issues I had with the disappearance of <code>vector_space</code>.</p>



<a name="244425068"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/busywork/near/244425068" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Anne Baanen <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/busywork.html#244425068">(Jun 30 2021 at 13:42)</a>:</h4>
<p>I think that would be perfect, i.e. <code>localized "notation `vector_space` := module" in vector_space</code></p>



<a name="244425450"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/busywork/near/244425450" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/busywork.html#244425450">(Jun 30 2021 at 13:45)</a>:</h4>
<p>I try and explain all my code, but perhaps heuristically, when I'm teaching. I tend to minimise imports and say "we need this one for subgroups" or whatever. But when it comes to <code>open X</code> I just say "we'll be using results about Xs" and I can dismiss <code>open_locale X</code> in just the same way.</p>



<a name="244432777"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/busywork/near/244432777" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Filippo A. E. Nuccio <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/busywork.html#244432777">(Jun 30 2021 at 14:35)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110031">Patrick Massot</span> <a href="#narrow/stream/116395-maths/topic/busywork/near/244423092">said</a>:</p>
<blockquote>
<p>Damn, I'm always half confused when I need to talk about the difference between abbreviation and notation. That's why I hesitated to write anything at all in this discussion.</p>
</blockquote>
<p><span class="user-mention" data-user-id="110031">@Patrick Massot</span> But is all this somewhere documented?</p>



<a name="244609086"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/busywork/near/244609086" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Anatole Dedecker <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/busywork.html#244609086">(Jul 01 2021 at 18:37)</a>:</h4>
<p>Just wondering, what were the original motivations for switching to bundled subgroups/subrings/... ?</p>



<a name="244611136"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/busywork/near/244611136" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/busywork.html#244611136">(Jul 01 2021 at 18:53)</a>:</h4>
<p>I'm not sure either - perhaps it was to make <code>map</code> and <code>comap</code> easier in some way?</p>



<a name="244611226"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/busywork/near/244611226" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/busywork.html#244611226">(Jul 01 2021 at 18:54)</a>:</h4>
<p>That is, maybe <code>is_subring (f '' s)</code> couldn't be found by typeclass search</p>



<a name="244666496"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/busywork/near/244666496" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/busywork.html#244666496">(Jul 02 2021 at 07:09)</a>:</h4>
<p>My memory was that people were complaining that type class inference was not doing all the things which people wanted it to do, and the problem was diagnosed and my understanding was that the conclusion was that it was hard to fix in Lean 3, so we switched to a bundled approach which seems to have worked fine.</p>



<a name="244677015"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/busywork/near/244677015" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Anne Baanen <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/busywork.html#244677015">(Jul 02 2021 at 09:10)</a>:</h4>
<p>From the mathlib paper:</p>
<blockquote>
<ul>
<li>It is important for compositions of homs to be a hom, but problems of the form is_hom (f ◦ g) can be difficult for type class inference. With bundled homs, one instead defines a custom composition operator Hom(A, B) × Hom(B, C) → Hom(A, C) that is used explicitly, obviating the need to search for is_hom (f ◦ g).</li>
<li>The type Hom(A, B) itself often has interesting structure. For example, the type M →l [R] N of R-linear maps from M to N is an R-module where the zero element is the constant zero map, and addition and scalar multiplication work pointwise (Section 5.1). Bundling the type makes it easier to reason about this structure.</li>
</ul>
</blockquote>



<a name="244677157"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/busywork/near/244677157" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Anne Baanen <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/busywork.html#244677157">(Jul 02 2021 at 09:12)</a>:</h4>
<p>(In particular, if we have an instance <code>is_hom (f ◦ g)</code> and <code>is_hom id</code>, you have to be very careful with reducibility etc that searching for <code>is_hom f</code> doesn't go through <code>is_hom (id ◦ f), is_hom (id ◦ id ◦ f), is_hom (id ◦ id ◦ id ◦ f), ...</code>)</p>



<a name="244677198"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/busywork/near/244677198" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/busywork.html#244677198">(Jul 02 2021 at 09:12)</a>:</h4>
<p>That's the one I had internalized too - but was there a similar argument for not using <code>is_submonoid</code> as a typeclass?</p>



<a name="244677234"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/busywork/near/244677234" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Anne Baanen <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/busywork.html#244677234">(Jul 02 2021 at 09:13)</a>:</h4>
<p>Presumably the same for <code>is_submonoid s, is_submonoid (id '' s), is_submonoid (id '' id '' s), ...</code>?</p>



<a name="244677269"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/busywork/near/244677269" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/busywork.html#244677269">(Jul 02 2021 at 09:13)</a>:</h4>
<p>We also have a bunch of results about the lattice structure on <code>is_sub_X</code></p>



<a name="244677283"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/busywork/near/244677283" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/busywork.html#244677283">(Jul 02 2021 at 09:13)</a>:</h4>
<p>And <code>X.quotient</code> for <code>X = ideal/subgroup/submodule</code> etc...</p>



<a name="244677349"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/busywork/near/244677349" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/busywork.html#244677349">(Jul 02 2021 at 09:14)</a>:</h4>
<p>I don't think dot notation working is a particularly convincing argument</p>



<a name="244677357"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/busywork/near/244677357" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/busywork.html#244677357">(Jul 02 2021 at 09:14)</a>:</h4>
<p>Of course the latter is just a convenience, but not a crucial feature.</p>



<a name="244677382"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/busywork/near/244677382" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/busywork.html#244677382">(Jul 02 2021 at 09:14)</a>:</h4>
<p>Since if we found a new design, we would probably be motivated to adjust lean core to make notation nice like last time when we expanded dot notation</p>



<a name="244678052"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/busywork/near/244678052" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Anne Baanen <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/busywork.html#244678052">(Jul 02 2021 at 09:22)</a>:</h4>
<p>My informal/unscientific intuition is that typeclasses are much easier to work with when there is a "trivial theory of equalities" on the arguments. Basically, you never have to use the fact that <code>zmod 0 = ℤ</code> in the way you would use the fact that <code>smul_alg_hom 1 = id</code>. As soon as you need a nontrivial equality, you need to make things reducible to infer well, and then you have a global condition on "everything that reduces in typeclass search" + "every instance declared" for termination of typeclass search.</p>



<a name="244688733"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/busywork/near/244688733" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/busywork.html#244688733">(Jul 02 2021 at 11:21)</a>:</h4>
<p>I agree. Type classes work well when the proof of <code>P x</code> is usually/always determined by a kind of structural recursion on the syntactic form of <code>x</code>. But if <code>x</code> is a something like a real number or a <code>set int</code> or a function then a very common way to prove <code>P x</code> is to prove that <code>x = y</code> and <code>P y</code>, and if <code>P</code> is a type class then this becomes much more awkward.<br>
This doesn't arise for types because we don't have any general way to reason about isomorphism-invariance (such as univalence)--so the strategy "<code>x</code> is isomorphic to <code>y</code> and <code>P y</code>" isn't very convenient, and most proofs end up being of the structural form.</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>