---
layout: archive
title: Zulip Chat Archive
permalink: /stream/116395-maths/topic/Valuation.20rings.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/116395-maths/index.html">maths</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Valuation.20rings.html">Valuation rings</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="275429093"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Valuation%20rings/near/275429093" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Valuation.20rings.html#275429093">(Mar 15 2022 at 20:12)</a>:</h4>
<p>Hi all,</p>
<p>I just opened a WIP/RFC PR with the definition of a valuation ring and the construction of the associated valuation. <br>
Comments are very welcome! There is much more to add, but this PR is already a little long...<br>
I'm sure there is overlap with the perfectoid project, so let me ping <span class="user-mention" data-user-id="112680">@Johan Commelin</span> <span class="user-mention" data-user-id="110038">@Kevin Buzzard</span>  and <span class="user-mention" data-user-id="110031">@Patrick Massot</span></p>



<a name="275429108"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Valuation%20rings/near/275429108" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Valuation.20rings.html#275429108">(Mar 15 2022 at 20:12)</a>:</h4>
<p><a href="https://github.com/leanprover-community/mathlib/pull/12719">#12719</a></p>



<a name="275431458"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Valuation%20rings/near/275431458" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Valuation.20rings.html#275431458">(Mar 15 2022 at 20:33)</a>:</h4>
<p>Maria and I seem to want rank 1 valuations. Do you have an opinion about how they should fit into things?</p>



<a name="275431602"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Valuation%20rings/near/275431602" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Valuation.20rings.html#275431602">(Mar 15 2022 at 20:34)</a>:</h4>
<p>Perhaps via Krull dimension?</p>



<a name="275431666"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Valuation%20rings/near/275431666" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Valuation.20rings.html#275431666">(Mar 15 2022 at 20:35)</a>:</h4>
<p>the rank of a valuation ring (in the sense of the rank of the value group) is the Krull dimension -- I should prove that at some point...</p>



<a name="275431946"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Valuation%20rings/near/275431946" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Valuation.20rings.html#275431946">(Mar 15 2022 at 20:37)</a>:</h4>
<p>I don't think we have Krull dimension yet</p>



<a name="275431979"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Valuation%20rings/near/275431979" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Valuation.20rings.html#275431979">(Mar 15 2022 at 20:37)</a>:</h4>
<p>Oh my.... we have so much to do!</p>



<a name="275432137"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Valuation%20rings/near/275432137" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ruben Van de Velde <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Valuation.20rings.html#275432137">(Mar 15 2022 at 20:38)</a>:</h4>
<p>So much fun still to be had!</p>



<a name="275432144"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Valuation%20rings/near/275432144" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Valuation.20rings.html#275432144">(Mar 15 2022 at 20:39)</a>:</h4>
<p>How does this fit into my idea of formalizing (part of) <a href="https://www.cambridge.org/core/books/spectral-spaces/9ACC409F3885FA808C8AF53B0381C9C7">this book about spectrai spaces</a>?</p>



<a name="275432552"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Valuation%20rings/near/275432552" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Valuation.20rings.html#275432552">(Mar 15 2022 at 20:42)</a>:</h4>
<p>I don't know, <span class="user-mention" data-user-id="387244">@Yaël Dillies</span> .... what do you have in mind?</p>



<a name="275432578"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Valuation%20rings/near/275432578" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Valuation.20rings.html#275432578">(Mar 15 2022 at 20:43)</a>:</h4>
<p>Hochster's result, chapter 12</p>



<a name="275432747"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Valuation%20rings/near/275432747" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Valuation.20rings.html#275432747">(Mar 15 2022 at 20:44)</a>:</h4>
<p>Yeah, but what do you have in mind in connection with valuation rings?</p>



<a name="275432852"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Valuation%20rings/near/275432852" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Valuation.20rings.html#275432852">(Mar 15 2022 at 20:45)</a>:</h4>
<p>No idea! Probably my question was misguided.</p>



<a name="275433213"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Valuation%20rings/near/275433213" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Valuation.20rings.html#275433213">(Mar 15 2022 at 20:48)</a>:</h4>
<p>I mean... valuation rings play an important role in algebraic geometry in various ways and the topological properties is one of them (for example by mapping spectra of valuation rings to a scheme it is possible to reconstruct the underlying topology of a scheme, see e.g. section 3 of <a href="https://arxiv.org/pdf/1906.00921.pdf">https://arxiv.org/pdf/1906.00921.pdf</a> ), but I don't have a clear enough picture of what you're planning to do <span class="user-mention" data-user-id="387244">@Yaël Dillies</span> to say whether anything about valuation rings will be useful...</p>



<a name="275437210"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Valuation%20rings/near/275437210" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Valuation.20rings.html#275437210">(Mar 15 2022 at 21:22)</a>:</h4>
<p><span class="user-mention" data-user-id="110038">@Kevin Buzzard</span> for now I added:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">variables</span> <span class="o">(</span><span class="n">A</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">[</span><span class="n">comm_ring</span> <span class="n">A</span><span class="o">]</span> <span class="o">[</span><span class="n">is_domain</span> <span class="n">A</span><span class="o">]</span> <span class="o">[</span><span class="n">discrete_valuation_ring</span> <span class="n">A</span><span class="o">]</span>

<span class="kd">instance</span> <span class="n">of_discrete_valuation_ring</span> <span class="o">:</span> <span class="n">valuation_ring</span> <span class="n">A</span> <span class="o">:=</span> <span class="bp">...</span>
</code></pre></div>



<a name="275441071"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Valuation%20rings/near/275441071" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Valuation.20rings.html#275441071">(Mar 15 2022 at 21:54)</a>:</h4>
<p>Is it me, or is your <code>value_group</code> almost identical to <a href="https://leanprover-community.github.io/mathlib_docs/find/projectivization">docs#projectivization</a>?</p>



<a name="275441105"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Valuation%20rings/near/275441105" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Valuation.20rings.html#275441105">(Mar 15 2022 at 21:55)</a>:</h4>
<p>It shouldn't be</p>



<a name="275441168"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Valuation%20rings/near/275441168" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Valuation.20rings.html#275441168">(Mar 15 2022 at 21:55)</a>:</h4>
<p>At a glance both are just the quotient by <code>(mul_action.orbit_rel Kˣ V)</code> with various extra typeclass assumptions on K and V</p>



<a name="275441235"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Valuation%20rings/near/275441235" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Valuation.20rings.html#275441235">(Mar 15 2022 at 21:56)</a>:</h4>
<p>Maybe the nonzero requirement is worth more than I'm giving it</p>



<a name="275441397"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Valuation%20rings/near/275441397" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Valuation.20rings.html#275441397">(Mar 15 2022 at 21:57)</a>:</h4>
<p>No, you do make a fair point</p>



<a name="275441615"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Valuation%20rings/near/275441615" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Valuation.20rings.html#275441615">(Mar 15 2022 at 21:59)</a>:</h4>
<p>I'm quite surprised Adam left the zero in the value group. I think in adic space valuation theory it's usually not there (and this is what I was thinking about; I hadn't looked at the PR), and in the adic space theory the quotient is more complex than the things of valuation 1, and it's only a monoid so you have to take the associated group.</p>



<a name="275442673"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Valuation%20rings/near/275442673" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Valuation.20rings.html#275442673">(Mar 15 2022 at 22:10)</a>:</h4>
<p>Note that a valuation in the sense of mathlib takes values in a <code>linearly_ordered_comm_monoid_with_zero</code>.</p>



<a name="275442700"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Valuation%20rings/near/275442700" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Valuation.20rings.html#275442700">(Mar 15 2022 at 22:10)</a>:</h4>
<p>So not removing the zero is necessary!</p>



<a name="275442803"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Valuation%20rings/near/275442803" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Valuation.20rings.html#275442803">(Mar 15 2022 at 22:11)</a>:</h4>
<p>Right. But Wedhorn uses the word "value group" of v : R -&gt; {0} union G to be the smallest subgroup H of G such that v takes values in {0} union H. It seems you're using the phrase differently (which was why I was so quick to tell Eric that they weren't the same before I looked at your code, and so quick to back down once I did )</p>



<a name="275442910"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Valuation%20rings/near/275442910" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Valuation.20rings.html#275442910">(Mar 15 2022 at 22:13)</a>:</h4>
<p>I could rename the thing in my PR to <code>value_group_with_zero</code> if folks prefer that.</p>



<a name="275442925"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Valuation%20rings/near/275442925" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Valuation.20rings.html#275442925">(Mar 15 2022 at 22:13)</a>:</h4>
<p>I don't know the standard language for valuation rings</p>



<a name="275442993"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Valuation%20rings/near/275442993" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Valuation.20rings.html#275442993">(Mar 15 2022 at 22:14)</a>:</h4>
<p>I only ask because I wonder if this is one of these "group rings and magma algebras are the same thing"- or "semimodules and vectors spaces are the same thing"- type cases, where the construction is the same, and we're just using different words to refer to them when extra ambient typeclasses are available.</p>



<a name="275443354"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Valuation%20rings/near/275443354" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Valuation.20rings.html#275443354">(Mar 15 2022 at 22:20)</a>:</h4>
<p>The terminology is all off anyway... Usually (as far as I know) a valuation on a field is a map from the units of the field to some totally ordered abelian group, and the and the ultrametric condition  is <code>v (x+y) \geq min ...</code>. We flip things around and include the zero in mathlib. I think having a zero in the value group is not the end of the world.</p>



<a name="275443792"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Valuation%20rings/near/275443792" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Valuation.20rings.html#275443792">(Mar 15 2022 at 22:25)</a>:</h4>
<p>Oh golly, a valuation on a field isn't defined at 0?? And a valuation on a ring is :-) Eric's going to like that :-)</p>



<a name="275472921"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Valuation%20rings/near/275472921" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Valuation.20rings.html#275472921">(Mar 16 2022 at 06:56)</a>:</h4>
<p>I think we did something similar in the perfectoid project: <a href="https://github.com/leanprover-community/lean-perfectoid-spaces/blob/master/src/valuation/canonical.lean#L85L111">https://github.com/leanprover-community/lean-perfectoid-spaces/blob/master/src/valuation/canonical.lean#L85L111</a><br>
I'm glad to see that all this can now be golfed into 1 line with current mathlib.</p>



<a name="275477263"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Valuation%20rings/near/275477263" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Antoine Chambert-Loir <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Valuation.20rings.html#275477263">(Mar 16 2022 at 08:04)</a>:</h4>
<p>It's a good thing to authorize 0 in the “value group”, it simplifies the definition, — and, while you're here, you could define “semivaluations on a ring” which may take 0  on something else than 0. Berkovich spaces are defined by spaces of seminorms and semivaluations are more flexible, a semivaluation passes to the quotient by the prime ideal on which it vanishes, etc.</p>



<a name="275477302"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Valuation%20rings/near/275477302" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Antoine Chambert-Loir <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Valuation.20rings.html#275477302">(Mar 16 2022 at 08:05)</a>:</h4>
<p>In fact, “general” valuations could take their value in any “ordered monoid with bot“.</p>



<a name="275477458"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Valuation%20rings/near/275477458" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Antoine Chambert-Loir <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Valuation.20rings.html#275477458">(Mar 16 2022 at 08:07)</a>:</h4>
<p>There is also the (convention) issue of the ordering: if <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mi mathvariant="normal">∣</mi><mi>b</mi></mrow><annotation encoding="application/x-tex">a | b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">a</span><span class="mord">∣</span><span class="mord mathnormal">b</span></span></span></span>, is <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>v</mi><mo stretchy="false">(</mo><mi>a</mi><mo stretchy="false">)</mo><mo>≤</mo><mi>v</mi><mo stretchy="false">(</mo><mi>b</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">v(a) \leq v(b)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mopen">(</span><span class="mord mathnormal">a</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mopen">(</span><span class="mord mathnormal">b</span><span class="mclose">)</span></span></span></span> or $v(b)\leq v(a)$$.<br>
The traditional convention is the former, but people (like Huber) use the first one, which makes a valuation more like the <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi></mrow><annotation encoding="application/x-tex">p</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">p</span></span></span></span>-adic norm.</p>



<a name="275485877"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Valuation%20rings/near/275485877" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Valuation.20rings.html#275485877">(Mar 16 2022 at 09:35)</a>:</h4>
<p><a href="https://leanprover-community.github.io/mathlib_docs/find/valuation">docs#valuation</a></p>



<a name="275485998"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Valuation%20rings/near/275485998" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Valuation.20rings.html#275485998">(Mar 16 2022 at 09:36)</a>:</h4>
<p>Antoine we have the multiplicative version, taking values in an ordered commutative monoid with 0 (and which may take 0 on inputs other than 0) (and we use Huber's convention)</p>



<a name="275500066"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Valuation%20rings/near/275500066" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Valuation.20rings.html#275500066">(Mar 16 2022 at 11:59)</a>:</h4>
<p><span class="user-mention silent" data-user-id="112680">Johan Commelin</span> <a href="#narrow/stream/116395-maths/topic/Valuation.20rings/near/275472921">said</a>:</p>
<blockquote>
<p>I think we did something similar in the perfectoid project: <a href="https://github.com/leanprover-community/lean-perfectoid-spaces/blob/master/src/valuation/canonical.lean#L85L111">https://github.com/leanprover-community/lean-perfectoid-spaces/blob/master/src/valuation/canonical.lean#L85L111</a><br>
I'm glad to see that all this can now be golfed into 1 line with current mathlib.</p>
</blockquote>
<p>Yes, this setoid is essentially the same. </p>
<p>Maybe I should explain what's happening in my PR a little better:</p>
<p>First, suppose that <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi></mrow><annotation encoding="application/x-tex">A</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">A</span></span></span></span> is an integral domain.<br>
We say that <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi></mrow><annotation encoding="application/x-tex">A</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">A</span></span></span></span> is a <em>valuation ring</em> provided that for all <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mo separator="true">,</mo><mi>b</mi><mo>∈</mo><mi>A</mi></mrow><annotation encoding="application/x-tex">a,b \in A</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">a</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">b</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">A</span></span></span></span>, there exists some <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi><mo>∈</mo><mi>A</mi></mrow><annotation encoding="application/x-tex">c \in A</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mord mathnormal">c</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">A</span></span></span></span> such that <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi><mo>⋅</mo><mi>a</mi><mo>=</mo><mi>b</mi></mrow><annotation encoding="application/x-tex">c \cdot a = b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4445em;"></span><span class="mord mathnormal">c</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">a</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">b</span></span></span></span> or <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi><mo>⋅</mo><mi>b</mi><mo>=</mo><mi>a</mi></mrow><annotation encoding="application/x-tex">c \cdot b = a</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4445em;"></span><span class="mord mathnormal">c</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">b</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">a</span></span></span></span>. This is equivalent to saying that when we consider <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi></mrow><annotation encoding="application/x-tex">A</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">A</span></span></span></span> as a subring of its fraction field, say <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>K</mi></mrow><annotation encoding="application/x-tex">K</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">K</span></span></span></span>, that for every element <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi><mo>∈</mo><mi>K</mi></mrow><annotation encoding="application/x-tex">x \in K</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">K</span></span></span></span>, either <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi><mo>∈</mo><mi>A</mi></mrow><annotation encoding="application/x-tex">x \in A</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">A</span></span></span></span> or <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>x</mi><mrow><mo>−</mo><mn>1</mn></mrow></msup><mo>∈</mo><mi>A</mi></mrow><annotation encoding="application/x-tex">x^{-1} \in A</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8532em;vertical-align:-0.0391em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">A</span></span></span></span>. In other words, this agrees with the usual notion of a valuation ring, except there is no need to refer to "the" fraction field.</p>
<p>Now comes some lean/mathlib technicalities. Given a valuation ring <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi></mrow><annotation encoding="application/x-tex">A</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">A</span></span></span></span>, an <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi></mrow><annotation encoding="application/x-tex">A</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">A</span></span></span></span>-algebra <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>K</mi></mrow><annotation encoding="application/x-tex">K</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">K</span></span></span></span> which happens to be a field, and an instance of <code>is_fraction_ring A K</code> (so <code>K</code> is <em>a</em> fraction field of <code>A</code>), this PR constructs <code>value_group A K</code> as the quotient of <code>K</code> by the multiplicative action of the units of <code>A</code> (this is essentially the same setoid from the perfectoid project that Johan linked above). In this PR, I do not assume that there is some valuation given ahead of time (unlike what's done in the perfectoid project), so we need to define a <code>linear_ordered_comm_group_with_zero</code> structure on <code>value_group A K</code> using only the axioms of <code>A</code> and <code>K</code>. This takes up the most work in the PR. The quotient map from <code>K</code> to <code>value_group A K</code> then becomes a valuation in the sense of <a href="https://leanprover-community.github.io/mathlib_docs/find/valuation">docs#valuation</a> whose ring of integers ( <a href="https://leanprover-community.github.io/mathlib_docs/find/valuation.integer">docs#valuation.integer</a> ) agrees with the original <code>A</code>.</p>



<a name="275500829"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Valuation%20rings/near/275500829" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Valuation.20rings.html#275500829">(Mar 16 2022 at 12:05)</a>:</h4>
<p>In a followup PR, I will define <code>valuation_subring K</code>, the type of valuation subrings of a field <code>K</code>. These are subrings <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="script">O</mi></mrow><annotation encoding="application/x-tex">\mathcal{O}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathcal" style="margin-right:0.02778em;">O</span></span></span></span> satisfying the condition that for all <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi><mo>∈</mo><mi>K</mi></mrow><annotation encoding="application/x-tex">x \in K</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">K</span></span></span></span>, either <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi><mo>∈</mo><mi mathvariant="script">O</mi></mrow><annotation encoding="application/x-tex">x \in \mathcal{O}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathcal" style="margin-right:0.02778em;">O</span></span></span></span> or <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>x</mi><mrow><mo>−</mo><mn>1</mn></mrow></msup><mo>∈</mo><mi mathvariant="script">O</mi></mrow><annotation encoding="application/x-tex">x^{-1} \in \mathcal{O}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8532em;vertical-align:-0.0391em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathcal" style="margin-right:0.02778em;">O</span></span></span></span>. Of course, these are all valuation rings in the above sense, and the argument above shows that any valuation ring comes from a valuation on the field <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>K</mi></mrow><annotation encoding="application/x-tex">K</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">K</span></span></span></span>. Even better, two valuations on a field <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>K</mi></mrow><annotation encoding="application/x-tex">K</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">K</span></span></span></span> are equivalent if and only if their associated valuation rings are <em>equal</em> in <code>valuation_subring K</code>. For a general ring <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi></mrow><annotation encoding="application/x-tex">A</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">A</span></span></span></span>, two valuations are equivalent if their support (a prime ideal) is the same, and the induced valuation subring of the residue field of the prime is the same.</p>



<a name="275527578"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Valuation%20rings/near/275527578" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Valuation.20rings.html#275527578">(Mar 16 2022 at 15:27)</a>:</h4>
<p>Here is a start to that followup PR: <a href="https://github.com/leanprover-community/mathlib/pull/12741">#12741</a></p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>