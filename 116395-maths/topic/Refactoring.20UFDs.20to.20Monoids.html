---
layout: archive
title: Zulip Chat Archive
permalink: /stream/116395-maths/topic/Refactoring.20UFDs.20to.20Monoids.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/116395-maths/index.html">maths</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Refactoring.20UFDs.20to.20Monoids.html">Refactoring UFDs to Monoids</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="205977613"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Refactoring%20UFDs%20to%20Monoids/near/205977613" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Aaron Anderson <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Refactoring.20UFDs.20to.20Monoids.html#205977613">(Aug 05 2020 at 00:40)</a>:</h4>
<p><span class="user-mention" data-user-id="238446">@Anne Baanen</span> has reviewed my PR on factorization of pnats with finsupps (<a href="https://github.com/leanprover-community/mathlib/issues/3291">#3291</a>), and suggested that the finsupp generalization should be made more broadly. I think this means it's time to try <span class="user-mention" data-user-id="110038">@Kevin Buzzard</span>'s suggestion that UFDs be refactored to revolve around a predicate on monoids, rather than rings.</p>



<a name="205978050"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Refactoring%20UFDs%20to%20Monoids/near/205978050" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Aaron Anderson <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Refactoring.20UFDs.20to.20Monoids.html#205978050">(Aug 05 2020 at 00:50)</a>:</h4>
<p>One decision that'll have to be made is how to deal with the fact that a monoid may or may not have a 0 element. I'm in favor either of this kind of definition: <span class="user-mention silent" data-user-id="110049">Mario Carneiro</span> <a href="#narrow/stream/113488-general/topic/types.20with.200.20.3D.20bot/near/202658502">said</a>:</p>
<blockquote>
<p>"all elements that are not zero-like have a unique factorization"</p>
</blockquote>



<a name="205978451"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Refactoring%20UFDs%20to%20Monoids/near/205978451" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Aaron Anderson <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Refactoring.20UFDs.20to.20Monoids.html#205978451">(Aug 05 2020 at 00:58)</a>:</h4>
<p>or something involving enats</p>



<a name="205987982"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Refactoring%20UFDs%20to%20Monoids/near/205987982" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Aaron Anderson <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Refactoring.20UFDs.20to.20Monoids.html#205987982">(Aug 05 2020 at 04:42)</a>:</h4>
<p>I've started tinkering with casework based on <code>def zerolike (x : α) : Prop := ∀ y, x * y = x</code>, starting with normalization monoids. It works, but it's a bit of a hassle.</p>



<a name="205987997"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Refactoring%20UFDs%20to%20Monoids/near/205987997" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Aaron Anderson <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Refactoring.20UFDs.20to.20Monoids.html#205987997">(Aug 05 2020 at 04:43)</a>:</h4>
<p>Does anybody have any ideas as to what classes and instances would make casework on whether we're dealing with a monoid-with-zero tractable?</p>



<a name="205990491"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Refactoring%20UFDs%20to%20Monoids/near/205990491" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Aaron Anderson <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Refactoring.20UFDs.20to.20Monoids.html#205990491">(Aug 05 2020 at 05:51)</a>:</h4>
<p>Perhaps a better first step is changing the divisibility relation to work for all <code>comm_monoid</code>s instead of just <code>comm_semiring</code>s. I've started working on that at <code>mathlib:divisibility_monoid</code>. Does anybody have any objection to this?</p>



<a name="205995425"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Refactoring%20UFDs%20to%20Monoids/near/205995425" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Refactoring.20UFDs.20to.20Monoids.html#205995425">(Aug 05 2020 at 07:31)</a>:</h4>
<p>The reason i think this is the way to go is that the nonzero ideals of a Dedekind domain have unique factorisation</p>



<a name="205995497"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Refactoring%20UFDs%20to%20Monoids/near/205995497" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Refactoring.20UFDs.20to.20Monoids.html#205995497">(Aug 05 2020 at 07:32)</a>:</h4>
<p>Given a monoid with zero and a 1, and a proof that 0 isn't 1, is there a way to extract the nonzero elements as a monoid?</p>



<a name="205995866"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Refactoring%20UFDs%20to%20Monoids/near/205995866" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Refactoring.20UFDs.20to.20Monoids.html#205995866">(Aug 05 2020 at 07:39)</a>:</h4>
<p>just make a subtype</p>



<a name="205995917"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Refactoring%20UFDs%20to%20Monoids/near/205995917" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Refactoring.20UFDs.20to.20Monoids.html#205995917">(Aug 05 2020 at 07:40)</a>:</h4>
<p><code>{x // x \ne 0}</code> or something like that</p>



<a name="206040403"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Refactoring%20UFDs%20to%20Monoids/near/206040403" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Aaron Anderson <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Refactoring.20UFDs.20to.20Monoids.html#206040403">(Aug 05 2020 at 15:57)</a>:</h4>
<p>I could definitely put a <code>monoid</code> instance on that subtype of a <code>monoid_with_zero</code>, but I should check first to see whether it's natural to use the submonoid API</p>



<a name="206043609"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Refactoring%20UFDs%20to%20Monoids/near/206043609" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Aaron Anderson <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Refactoring.20UFDs.20to.20Monoids.html#206043609">(Aug 05 2020 at 16:20)</a>:</h4>
<p>Hmm, using subtypes could again run into problems. If I just define, say, gcd on monoids without zero, and then define gcd on monoids with zero by using my definition of gcd on the subtype, then gcd's got the wrong type, and really the gcd function should be able to work with 0 just fine</p>



<a name="206044651"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Refactoring%20UFDs%20to%20Monoids/near/206044651" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Refactoring.20UFDs.20to.20Monoids.html#206044651">(Aug 05 2020 at 16:29)</a>:</h4>
<p>I think the correct thing to do is to define the left adjoint of the forgetful functor from monoids with zero to monoids (formally adjoin a zero). Do all the constructions for monoid_with_zero, and then it will apply to a monoid by first applying this left adjoint.</p>



<a name="206045020"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Refactoring%20UFDs%20to%20Monoids/near/206045020" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Refactoring.20UFDs.20to.20Monoids.html#206045020">(Aug 05 2020 at 16:32)</a>:</h4>
<p>(I think the construction of adjoining a zero to a monoid already exists.)</p>



<a name="206048158"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Refactoring%20UFDs%20to%20Monoids/near/206048158" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Refactoring.20UFDs.20to.20Monoids.html#206048158">(Aug 05 2020 at 16:56)</a>:</h4>
<p>Also, in general you cannot put a monoid structure on <code>{x // x \ne 0}</code> because the original monoid might have zero divisors.</p>



<a name="206048212"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Refactoring%20UFDs%20to%20Monoids/near/206048212" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Refactoring.20UFDs.20to.20Monoids.html#206048212">(Aug 05 2020 at 16:56)</a>:</h4>
<p>what about the set of all non-zero-divisors?</p>



<a name="206048460"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Refactoring%20UFDs%20to%20Monoids/near/206048460" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Refactoring.20UFDs.20to.20Monoids.html#206048460">(Aug 05 2020 at 16:58)</a>:</h4>
<p>That should be ok.</p>



<a name="206049097"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Refactoring%20UFDs%20to%20Monoids/near/206049097" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Refactoring.20UFDs.20to.20Monoids.html#206049097">(Aug 05 2020 at 17:03)</a>:</h4>
<p>All divisibility theory stuff should perhaps be done under the running assumption that there are no zero divisors. All of this ED, PID, UFD stuff assumes integral domain, and the ideals in a Dedekind domain have no zero divisors (but have a zero). The slick definition of UFD is a monoid M0 with zero, with no zero-divisors, such that the monoid M you get by removing the zero, when quotiented out by the units, is a free monoid.</p>



<a name="206049533"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Refactoring%20UFDs%20to%20Monoids/near/206049533" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Aaron Anderson <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Refactoring.20UFDs.20to.20Monoids.html#206049533">(Aug 05 2020 at 17:06)</a>:</h4>
<p>Perhaps the thing to do is to create two definitions of everything, and then prove that the with-zero versions are equivalent to the zeroless versions as applied to the submonoid obtained by deleting 0 (or all 0-divisors, depending on assumptions) and transporting lemmas that way?</p>



<a name="206050788"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Refactoring%20UFDs%20to%20Monoids/near/206050788" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Refactoring.20UFDs.20to.20Monoids.html#206050788">(Aug 05 2020 at 17:17)</a>:</h4>
<p>I don't know of any situation where mathematicians talk about unique factorisation but don't have a zero</p>



<a name="206050810"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Refactoring%20UFDs%20to%20Monoids/near/206050810" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Refactoring.20UFDs.20to.20Monoids.html#206050810">(Aug 05 2020 at 17:17)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110038">Kevin Buzzard</span> <a href="#narrow/stream/116395-maths/topic/Refactoring.20UFDs.20to.20Monoids/near/206049097">said</a>:</p>
<blockquote>
<p>All divisibility theory stuff should perhaps be done under the running assumption that there are no zero divisors. All of this ED, PID, UFD stuff assumes integral domain, and the ideals in a Dedekind domain have no zero divisors (but have a zero). The slick definition of UFD is a monoid M0 with zero, with no zero-divisors, such that the monoid M you get by removing the zero, when quotiented out by the units, is a free monoid.</p>
</blockquote>
<p>Dont remove the zero, and it's even more slick -- it's a free commutative monoid_with_zero :) (after multiplicatively modding out by units)</p>



<a name="206050832"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Refactoring%20UFDs%20to%20Monoids/near/206050832" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Refactoring.20UFDs.20to.20Monoids.html#206050832">(Aug 05 2020 at 17:17)</a>:</h4>
<p>One could argue that pnat was one, but pnat is rarely used</p>



<a name="206051101"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Refactoring%20UFDs%20to%20Monoids/near/206051101" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Refactoring.20UFDs.20to.20Monoids.html#206051101">(Aug 05 2020 at 17:19)</a>:</h4>
<p>It has bugged me for literally decades that one of the definitions of a Dedekind domain is that it's an ID where each nonzero ideal factors uniquely into prime ideals. Often people forget to say nonzero</p>



<a name="206051220"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Refactoring%20UFDs%20to%20Monoids/near/206051220" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Aaron Anderson <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Refactoring.20UFDs.20to.20Monoids.html#206051220">(Aug 05 2020 at 17:20)</a>:</h4>
<p>I suspect that at least <code>gcd_domain</code> should be at least partially property of general monoids</p>



<a name="206051323"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Refactoring%20UFDs%20to%20Monoids/near/206051323" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Refactoring.20UFDs.20to.20Monoids.html#206051323">(Aug 05 2020 at 17:21)</a>:</h4>
<p>This is something about things ordered by divisibility.</p>



<a name="206051379"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Refactoring%20UFDs%20to%20Monoids/near/206051379" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Refactoring.20UFDs.20to.20Monoids.html#206051379">(Aug 05 2020 at 17:21)</a>:</h4>
<p>So yeah, something should be doable with monoids / monoids_with_zeros</p>



<a name="206051436"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Refactoring%20UFDs%20to%20Monoids/near/206051436" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Aaron Anderson <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Refactoring.20UFDs.20to.20Monoids.html#206051436">(Aug 05 2020 at 17:22)</a>:</h4>
<p>And a factorization is, at least partially, a function from a monoid to an add_monoid which is a homomorphism except at 0 if it exists</p>



<a name="206051475"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Refactoring%20UFDs%20to%20Monoids/near/206051475" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Aaron Anderson <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Refactoring.20UFDs.20to.20Monoids.html#206051475">(Aug 05 2020 at 17:22)</a>:</h4>
<p>And this particular 0 casework pops up other places, like logarithms</p>



<a name="206051530"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Refactoring%20UFDs%20to%20Monoids/near/206051530" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Refactoring.20UFDs.20to.20Monoids.html#206051530">(Aug 05 2020 at 17:22)</a>:</h4>
<p>everything divides zero -- it's \top in some sense.</p>



<a name="206051538"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Refactoring%20UFDs%20to%20Monoids/near/206051538" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Refactoring.20UFDs.20to.20Monoids.html#206051538">(Aug 05 2020 at 17:22)</a>:</h4>
<p>Adam's observation also works for Dedekind domains too then, right? It's a ring whose prime ideals (pointed by 0 = the zero ideal, hence in particular must be an integral domain) generate the ideals freely as a monoid with zero</p>



<a name="206051591"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Refactoring%20UFDs%20to%20Monoids/near/206051591" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Aaron Anderson <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Refactoring.20UFDs.20to.20Monoids.html#206051591">(Aug 05 2020 at 17:23)</a>:</h4>
<p>So I don’t want to hang up the refactorization of these concepts to monoids on zero, but I think it’s still worth thinking of a good solution to that casework</p>



<a name="206051718"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Refactoring%20UFDs%20to%20Monoids/near/206051718" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Aaron Anderson <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Refactoring.20UFDs.20to.20Monoids.html#206051718">(Aug 05 2020 at 17:24)</a>:</h4>
<p>(And also I would rather be able to still use the stuff I wrote with pnats, but I don’t want to make everything else an awful mess in the process)</p>



<a name="206052074"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Refactoring%20UFDs%20to%20Monoids/near/206052074" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Refactoring.20UFDs.20to.20Monoids.html#206052074">(Aug 05 2020 at 17:26)</a>:</h4>
<p><span class="user-mention" data-user-id="110032">@Reid Barton</span> I guess in this case it's the free comm_monoid_with_zero on a pointed set (where the point becomes 0).</p>



<a name="206059434"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Refactoring%20UFDs%20to%20Monoids/near/206059434" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Refactoring.20UFDs.20to.20Monoids.html#206059434">(Aug 05 2020 at 18:20)</a>:</h4>
<p>Yes, in the Dedekind domain example, and also in nat, there are no units other than 1.</p>



<a name="206059481"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Refactoring%20UFDs%20to%20Monoids/near/206059481" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Aaron Anderson <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Refactoring.20UFDs.20to.20Monoids.html#206059481">(Aug 05 2020 at 18:21)</a>:</h4>
<p>I've found some trouble on <code>mathlib:divisibility_monoid</code>...</p>



<a name="206059787"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Refactoring%20UFDs%20to%20Monoids/near/206059787" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Aaron Anderson <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Refactoring.20UFDs.20to.20Monoids.html#206059787">(Aug 05 2020 at 18:23)</a>:</h4>
<p>I didn't think I changed anything other than what instance is required for <code>comm_semiring_has_dvd</code>, but now some places in the library, when we refer to <code>a | b</code> where <code>a b : nat</code>,  it thinks we want to be checking divisibility of <code>comm_monoid nat</code> instances instead of nats</p>



<a name="206060055"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Refactoring%20UFDs%20to%20Monoids/near/206060055" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Aaron Anderson <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Refactoring.20UFDs.20to.20Monoids.html#206060055">(Aug 05 2020 at 18:25)</a>:</h4>
<p>I don't know why it'd do that if it wasn't already assuming that we were trying ask if one <code>comm_semiring nat</code> divides another...</p>



<a name="206060659"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Refactoring%20UFDs%20to%20Monoids/near/206060659" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Aaron Anderson <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Refactoring.20UFDs.20to.20Monoids.html#206060659">(Aug 05 2020 at 18:30)</a>:</h4>
<p>And it's only a problem with calc-mode proofs involving pnats.</p>



<a name="206060876"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Refactoring%20UFDs%20to%20Monoids/near/206060876" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Aaron Anderson <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Refactoring.20UFDs.20to.20Monoids.html#206060876">(Aug 05 2020 at 18:32)</a>:</h4>
<p>How do I see exactly what lemmas calc is using? It's definitely using some form of transitivity, etc. without explicitly mentioning them</p>



<a name="206063731"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Refactoring%20UFDs%20to%20Monoids/near/206063731" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Refactoring.20UFDs.20to.20Monoids.html#206063731">(Aug 05 2020 at 18:55)</a>:</h4>
<p>This reminds me of the nat.pow v monoid.pow issue</p>



<a name="206063926"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Refactoring%20UFDs%20to%20Monoids/near/206063926" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Refactoring.20UFDs.20to.20Monoids.html#206063926">(Aug 05 2020 at 18:57)</a>:</h4>
<p>calc uses lemmas tagged <code>[trans]</code></p>



<a name="206064496"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Refactoring%20UFDs%20to%20Monoids/near/206064496" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Aaron Anderson <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Refactoring.20UFDs.20to.20Monoids.html#206064496">(Aug 05 2020 at 19:02)</a>:</h4>
<p>Hmm, the only lemma tagged <code>[trans]</code> that I would think it would use, <code>dvd_trans</code>, is just copy-pasted</p>



<a name="206064538"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Refactoring%20UFDs%20to%20Monoids/near/206064538" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Aaron Anderson <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Refactoring.20UFDs.20to.20Monoids.html#206064538">(Aug 05 2020 at 19:02)</a>:</h4>
<p>and works fine when I explicitly use <code>apply</code> instead of tactics</p>



<a name="206064614"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Refactoring%20UFDs%20to%20Monoids/near/206064614" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Refactoring.20UFDs.20to.20Monoids.html#206064614">(Aug 05 2020 at 19:03)</a>:</h4>
<p>There will be some nat.dvd_trans and monoid.dvd_trans maybe?</p>



<a name="206065007"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Refactoring%20UFDs%20to%20Monoids/near/206065007" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Aaron Anderson <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Refactoring.20UFDs.20to.20Monoids.html#206065007">(Aug 05 2020 at 19:06)</a>:</h4>
<p>It appears that <code>nat.dvd_trans</code> is not tagged with <code>[trans]</code>, but <code>dvd_trans</code> (the <code>comm_semiring</code> one that I switched to work with <code>comm_monoid</code>) is</p>



<a name="206065466"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Refactoring%20UFDs%20to%20Monoids/near/206065466" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Refactoring.20UFDs.20to.20Monoids.html#206065466">(Aug 05 2020 at 19:11)</a>:</h4>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="n">data</span><span class="bp">.</span><span class="n">nat</span><span class="bp">.</span><span class="n">basic</span>

<span class="n">def</span> <span class="n">ZZZ</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">)</span> <span class="o">(</span><span class="n">hab</span> <span class="o">:</span> <span class="n">a</span> <span class="err">∣</span> <span class="n">b</span><span class="o">)</span> <span class="o">(</span><span class="n">hbc</span> <span class="o">:</span> <span class="n">b</span> <span class="err">∣</span> <span class="n">c</span><span class="o">)</span> <span class="o">:</span>
  <span class="n">a</span> <span class="err">∣</span> <span class="n">c</span> <span class="o">:=</span>
<span class="k">calc</span> <span class="n">a</span> <span class="err">∣</span> <span class="n">b</span> <span class="o">:</span> <span class="n">hab</span>
<span class="bp">...</span>    <span class="err">∣</span> <span class="n">c</span> <span class="o">:</span> <span class="n">hbc</span>

<span class="bp">#</span><span class="kn">print</span> <span class="n">ZZZ</span> <span class="c1">-- dvd_trans</span>
</code></pre></div>


<p>Yes, it's picking up the semiring one.</p>



<a name="206066802"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Refactoring%20UFDs%20to%20Monoids/near/206066802" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Aaron Anderson <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Refactoring.20UFDs.20to.20Monoids.html#206066802">(Aug 05 2020 at 19:24)</a>:</h4>
<p>Yeah, and when I copy-paste that, I get a red squiggle under the ..., with</p>
<div class="codehilite"><pre><span></span><code><span class="n">type</span> <span class="n">mismatch</span> <span class="n">at</span> <span class="n">application</span>
  <span class="n">dvd_trans</span>
<span class="n">term</span>
  <span class="n">c</span>
<span class="n">has</span> <span class="n">type</span>
  <span class="bp">ℕ</span>
<span class="n">but</span> <span class="n">is</span> <span class="n">expected</span> <span class="n">to</span> <span class="k">have</span> <span class="n">type</span>
  <span class="n">comm_monoid</span> <span class="bp">ℕ</span>
</code></pre></div>



<a name="206066907"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Refactoring%20UFDs%20to%20Monoids/near/206066907" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Aaron Anderson <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Refactoring.20UFDs.20to.20Monoids.html#206066907">(Aug 05 2020 at 19:25)</a>:</h4>
<p>which is weird, because <code>dvd_trans</code> seems to still work outside of <code>calc</code></p>



<a name="206067042"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Refactoring%20UFDs%20to%20Monoids/near/206067042" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Refactoring.20UFDs.20to.20Monoids.html#206067042">(Aug 05 2020 at 19:26)</a>:</h4>
<p>oh yeah, I can reproduce</p>



<a name="206067073"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Refactoring%20UFDs%20to%20Monoids/near/206067073" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Aaron Anderson <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Refactoring.20UFDs.20to.20Monoids.html#206067073">(Aug 05 2020 at 19:26)</a>:</h4>
<div class="codehilite"><pre><span></span><code><span class="n">def</span> <span class="n">YYZ</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">)</span> <span class="o">(</span><span class="n">hab</span> <span class="o">:</span> <span class="n">a</span> <span class="err">∣</span> <span class="n">b</span><span class="o">)</span> <span class="o">(</span><span class="n">hbc</span> <span class="o">:</span> <span class="n">b</span> <span class="err">∣</span> <span class="n">c</span><span class="o">)</span> <span class="o">:</span>
  <span class="n">a</span> <span class="err">∣</span> <span class="n">c</span> <span class="o">:=</span>
<span class="n">dvd_trans</span> <span class="n">hab</span> <span class="n">hbc</span>
</code></pre></div>


<p>works just fine</p>



<a name="206068592"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Refactoring%20UFDs%20to%20Monoids/near/206068592" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Aaron Anderson <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Refactoring.20UFDs.20to.20Monoids.html#206068592">(Aug 05 2020 at 19:40)</a>:</h4>
<p>oh wow, it was the order of the implied variables in <code>divisibility.lean</code></p>



<a name="206068659"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Refactoring%20UFDs%20to%20Monoids/near/206068659" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Aaron Anderson <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Refactoring.20UFDs.20to.20Monoids.html#206068659">(Aug 05 2020 at 19:41)</a>:</h4>
<p>the <code>[comm_monoid]</code> instance has to come before <code>{a b c}</code></p>



<a name="206078726"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Refactoring%20UFDs%20to%20Monoids/near/206078726" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Aaron Anderson <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Refactoring.20UFDs.20to.20Monoids.html#206078726">(Aug 05 2020 at 21:10)</a>:</h4>
<p><a href="https://github.com/leanprover-community/mathlib/issues/3702">#3702</a></p>



<a name="206281162"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Refactoring%20UFDs%20to%20Monoids/near/206281162" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Aaron Anderson <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Refactoring.20UFDs.20to.20Monoids.html#206281162">(Aug 07 2020 at 16:50)</a>:</h4>
<p><a href="https://github.com/leanprover-community/mathlib/issues/3714">#3714</a></p>



<a name="206285218"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Refactoring%20UFDs%20to%20Monoids/near/206285218" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Aaron Anderson <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Refactoring.20UFDs.20to.20Monoids.html#206285218">(Aug 07 2020 at 17:26)</a>:</h4>
<p>In that PR, I try to make the divisibility relation work for any (noncommutative) monoid, as I realized that every instance of divisibility in <code>mathlib</code> boils down to <code>exists c, a * c = b</code>, which we might properly call right-divisibility, and <code>associated</code> already makes the choice to use right-associated as the definition in the noncommutative case.</p>



<a name="206285589"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Refactoring%20UFDs%20to%20Monoids/near/206285589" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Aaron Anderson <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Refactoring.20UFDs.20to.20Monoids.html#206285589">(Aug 07 2020 at 17:29)</a>:</h4>
<p><span class="user-mention" data-user-id="238446">@Anne Baanen</span> pointed out that that could be controversial, instead of defining left- and right-divisibility separately. Does anyone object to using right-divisibility?</p>



<a name="206286185"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Refactoring%20UFDs%20to%20Monoids/near/206286185" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Refactoring.20UFDs.20to.20Monoids.html#206286185">(Aug 07 2020 at 17:33)</a>:</h4>
<p>I think making right divisibility the default is compatible with the fact that the default multiplicative action is an action on the left. It's saying that b is in the image of the (left) multiplicative action of a.</p>



<a name="206286617"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Refactoring%20UFDs%20to%20Monoids/near/206286617" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Refactoring.20UFDs.20to.20Monoids.html#206286617">(Aug 07 2020 at 17:36)</a>:</h4>
<p>In fact, one could define divisibility in any situation where there is a <code>mul_action</code>.</p>



<a name="206286902"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Refactoring%20UFDs%20to%20Monoids/near/206286902" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Anne Baanen <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Refactoring.20UFDs.20to.20Monoids.html#206286902">(Aug 07 2020 at 17:39)</a>:</h4>
<p>Moreover, I would like to point out: even if we later want to introduce <code>has_left_dvd</code>, this PR would be helpful in the preparations because it identifies the parts that we would need to change.</p>



<a name="206287078"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Refactoring%20UFDs%20to%20Monoids/near/206287078" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Anne Baanen <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Refactoring.20UFDs.20to.20Monoids.html#206287078">(Aug 07 2020 at 17:40)</a>:</h4>
<p>So I'm pretty much in favour of the PR, but I would like to make sure we don't make non-canonical choices lightly.</p>



<a name="206288597"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Refactoring%20UFDs%20to%20Monoids/near/206288597" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Refactoring.20UFDs.20to.20Monoids.html#206288597">(Aug 07 2020 at 17:50)</a>:</h4>
<p>I'm not suggesting this should be changed right now, but what are your thoughts about doing something like this at some point in the future?</p>
<div class="codehilite"><pre><span></span><code><span class="n">class</span> <span class="n">has_dvd</span> <span class="o">(</span><span class="n">α</span> <span class="n">β</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">dvd</span> <span class="o">:</span> <span class="n">α</span> <span class="bp">→</span> <span class="n">β</span> <span class="bp">→</span> <span class="kt">Prop</span><span class="o">)</span>

<span class="kn">instance</span> <span class="o">(</span><span class="n">M</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">)</span> <span class="o">[</span><span class="n">monoid</span> <span class="n">M</span><span class="o">]</span> <span class="o">(</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">[</span><span class="n">mul_action</span> <span class="n">M</span> <span class="n">α</span><span class="o">]</span> <span class="o">:</span> <span class="n">has_dvd</span> <span class="n">M</span> <span class="n">α</span> <span class="o">:=</span>
<span class="bp">⟨</span> <span class="bp">λ</span> <span class="n">m</span> <span class="n">a</span><span class="o">,</span> <span class="bp">∃</span> <span class="n">b</span><span class="o">,</span> <span class="n">m</span> <span class="err">•</span> <span class="n">b</span> <span class="bp">=</span> <span class="n">a</span> <span class="bp">⟩</span>
</code></pre></div>



<a name="206288660"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Refactoring%20UFDs%20to%20Monoids/near/206288660" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Refactoring.20UFDs.20to.20Monoids.html#206288660">(Aug 07 2020 at 17:51)</a>:</h4>
<p>This would let you speak about divisible modules, and things like this.</p>



<a name="206288952"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Refactoring%20UFDs%20to%20Monoids/near/206288952" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Aaron Anderson <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Refactoring.20UFDs.20to.20Monoids.html#206288952">(Aug 07 2020 at 17:53)</a>:</h4>
<p>I would appreciate the smooth syntax for divisible groups, but I’m not sure the definitional equalities between the two instances would be easy to pull off.</p>



<a name="206289100"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Refactoring%20UFDs%20to%20Monoids/near/206289100" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Refactoring.20UFDs.20to.20Monoids.html#206289100">(Aug 07 2020 at 17:54)</a>:</h4>
<p>This works:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="n">algebra</span>

<span class="n">class</span> <span class="n">has_dvd&#39;</span> <span class="o">(</span><span class="n">α</span> <span class="n">β</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">dvd</span> <span class="o">:</span> <span class="n">α</span> <span class="bp">→</span> <span class="n">β</span> <span class="bp">→</span> <span class="kt">Prop</span><span class="o">)</span>

<span class="kn">instance</span> <span class="n">foo</span> <span class="o">(</span><span class="n">M</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">[</span><span class="n">monoid</span> <span class="n">M</span><span class="o">]</span> <span class="o">(</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">[</span><span class="n">mul_action</span> <span class="n">M</span> <span class="n">α</span><span class="o">]</span> <span class="o">:</span> <span class="n">has_dvd&#39;</span> <span class="n">M</span> <span class="n">α</span> <span class="o">:=</span>
<span class="bp">⟨</span> <span class="bp">λ</span> <span class="n">m</span> <span class="n">a</span><span class="o">,</span> <span class="bp">∃</span> <span class="n">b</span><span class="o">,</span> <span class="n">m</span> <span class="err">•</span> <span class="n">b</span> <span class="bp">=</span> <span class="n">a</span> <span class="bp">⟩</span>

<span class="kn">example</span> <span class="o">(</span><span class="n">M</span><span class="o">)</span> <span class="o">[</span><span class="n">comm_ring</span> <span class="n">M</span><span class="o">]</span> <span class="o">:</span> <span class="n">has_dvd&#39;</span> <span class="n">M</span> <span class="n">M</span> <span class="o">:=</span> <span class="k">by</span> <span class="n">apply_instance</span>
</code></pre></div>



<a name="206289454"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Refactoring%20UFDs%20to%20Monoids/near/206289454" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Refactoring.20UFDs.20to.20Monoids.html#206289454">(Aug 07 2020 at 17:57)</a>:</h4>
<p>Oh, it looks like this is missing from mathlib:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">instance</span> <span class="o">(</span><span class="n">M</span><span class="o">)</span> <span class="o">[</span><span class="n">monoid</span> <span class="n">M</span><span class="o">]</span> <span class="o">:</span> <span class="n">mul_action</span> <span class="n">M</span> <span class="n">M</span> <span class="o">:=</span> <span class="n">sorry</span>
</code></pre></div>



<a name="206289546"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Refactoring%20UFDs%20to%20Monoids/near/206289546" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Refactoring.20UFDs.20to.20Monoids.html#206289546">(Aug 07 2020 at 17:58)</a>:</h4>
<p>scratch that, it's <code>mul_action.regular M</code>.</p>



<a name="206289863"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Refactoring%20UFDs%20to%20Monoids/near/206289863" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Aaron Anderson <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Refactoring.20UFDs.20to.20Monoids.html#206289863">(Aug 07 2020 at 18:00)</a>:</h4>
<p>I guess it would have to be a different typeclass to accomodate distinct types, so there’s no danger of overriding the existing instances</p>



<a name="206289931"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Refactoring%20UFDs%20to%20Monoids/near/206289931" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Aaron Anderson <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Refactoring.20UFDs.20to.20Monoids.html#206289931">(Aug 07 2020 at 18:00)</a>:</h4>
<p>The other thing you’d have to decide is if you want the <code>mul_action</code> to be inferred or explicit</p>



<a name="206290001"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Refactoring%20UFDs%20to%20Monoids/near/206290001" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Aaron Anderson <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Refactoring.20UFDs.20to.20Monoids.html#206290001">(Aug 07 2020 at 18:01)</a>:</h4>
<p>And whether if it’s inferred, you make a shortcut for the same | notation</p>



<a name="206290295"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Refactoring%20UFDs%20to%20Monoids/near/206290295" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Aaron Anderson <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Refactoring.20UFDs.20to.20Monoids.html#206290295">(Aug 07 2020 at 18:03)</a>:</h4>
<p>I guess you could even edit <code>has_dvd</code> in core, but that’s so vastly above my level</p>



<a name="206290377"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Refactoring%20UFDs%20to%20Monoids/near/206290377" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Refactoring.20UFDs.20to.20Monoids.html#206290377">(Aug 07 2020 at 18:03)</a>:</h4>
<p>this sounds like it will make the typeclass problem for divisibilty a lot more complicated</p>



<a name="206290737"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Refactoring%20UFDs%20to%20Monoids/near/206290737" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Refactoring.20UFDs.20to.20Monoids.html#206290737">(Aug 07 2020 at 18:06)</a>:</h4>
<p>Can this be solved with notation only? </p>
<div class="codehilite"><pre><span></span><code><span class="kn">notation</span> <span class="n">a</span> <span class="bp">`</span><span class="err">∣</span><span class="bp">`</span> <span class="n">b</span> <span class="o">:=</span> <span class="bp">∃</span> <span class="n">c</span><span class="o">,</span> <span class="n">a</span> <span class="err">•</span> <span class="n">c</span> <span class="bp">=</span> <span class="n">b</span>
<span class="kn">notation</span> <span class="n">a</span> <span class="bp">`</span><span class="err">∣</span><span class="bp">`</span> <span class="n">b</span> <span class="o">:=</span> <span class="bp">∃</span> <span class="n">c</span><span class="o">,</span> <span class="n">a</span> <span class="bp">*</span> <span class="n">c</span> <span class="bp">=</span> <span class="n">b</span>
</code></pre></div>



<a name="206290775"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Refactoring%20UFDs%20to%20Monoids/near/206290775" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Refactoring.20UFDs.20to.20Monoids.html#206290775">(Aug 07 2020 at 18:07)</a>:</h4>
<p>no, overloaded notation is not very good in lean 3</p>



<a name="206290777"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Refactoring%20UFDs%20to%20Monoids/near/206290777" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Refactoring.20UFDs.20to.20Monoids.html#206290777">(Aug 07 2020 at 18:07)</a>:</h4>
<p>I guess that's a terrible idea.</p>



<a name="206290824"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Refactoring%20UFDs%20to%20Monoids/near/206290824" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Refactoring.20UFDs.20to.20Monoids.html#206290824">(Aug 07 2020 at 18:07)</a>:</h4>
<p>unless it can be distinguished by type (and these never will be) it always just flags an ambiguity error</p>



<a name="206290852"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Refactoring%20UFDs%20to%20Monoids/near/206290852" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Refactoring.20UFDs.20to.20Monoids.html#206290852">(Aug 07 2020 at 18:08)</a>:</h4>
<p>I see.</p>



<a name="206290918"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Refactoring%20UFDs%20to%20Monoids/near/206290918" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Refactoring.20UFDs.20to.20Monoids.html#206290918">(Aug 07 2020 at 18:08)</a>:</h4>
<p>I would just suggest using a sigil of some kind on the symbol</p>



<a name="206290942"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Refactoring%20UFDs%20to%20Monoids/near/206290942" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Refactoring.20UFDs.20to.20Monoids.html#206290942">(Aug 07 2020 at 18:08)</a>:</h4>
<p><code>\|\_m</code> or something</p>



<a name="206291004"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Refactoring%20UFDs%20to%20Monoids/near/206291004" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Refactoring.20UFDs.20to.20Monoids.html#206291004">(Aug 07 2020 at 18:09)</a>:</h4>
<div class="codehilite"><pre><span></span><code><span class="kn">notation</span> <span class="n">a</span> <span class="bp">`</span><span class="err">∣ₘ</span><span class="bp">`</span> <span class="n">b</span> <span class="o">:=</span> <span class="bp">∃</span> <span class="n">c</span><span class="o">,</span> <span class="n">a</span> <span class="err">•</span> <span class="n">c</span> <span class="bp">=</span> <span class="n">b</span>
</code></pre></div>



<a name="206291009"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Refactoring%20UFDs%20to%20Monoids/near/206291009" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Refactoring.20UFDs.20to.20Monoids.html#206291009">(Aug 07 2020 at 18:09)</a>:</h4>
<p>That's not too awful.</p>



<a name="206601115"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Refactoring%20UFDs%20to%20Monoids/near/206601115" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Aaron Anderson <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Refactoring.20UFDs.20to.20Monoids.html#206601115">(Aug 11 2020 at 17:03)</a>:</h4>
<p>What strong opinions do people have about normalization and gcd domains?</p>



<a name="206601626"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Refactoring%20UFDs%20to%20Monoids/near/206601626" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Aaron Anderson <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Refactoring.20UFDs.20to.20Monoids.html#206601626">(Aug 11 2020 at 17:06)</a>:</h4>
<p>I'd like to have one structure called gcd monoid that applies to all monoids (with adequate cancellation at least), which is sort of a lattice structure with different names for the operations. However, normalization monoids have a definition which depends on 0 in the ways discussed earlier.</p>



<a name="206601987"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Refactoring%20UFDs%20to%20Monoids/near/206601987" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Refactoring.20UFDs.20to.20Monoids.html#206601987">(Aug 11 2020 at 17:09)</a>:</h4>
<p>These were things which the computable people liked and I could never see the point of. Our definition of UFD is not a Prop, which isn't the mathematical definition. Do mathematicians really any of this stuff? Why can't you just work in the quotient of the nonzero elements by the units?</p>



<a name="206635830"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Refactoring%20UFDs%20to%20Monoids/near/206635830" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Aaron Anderson <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Refactoring.20UFDs.20to.20Monoids.html#206635830">(Aug 11 2020 at 21:54)</a>:</h4>
<p>Ok, we should definitely have a notion of gcd monoid/domain at least general enough to apply to euclidean domains...</p>



<a name="206646417"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Refactoring%20UFDs%20to%20Monoids/near/206646417" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Aaron Anderson <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Refactoring.20UFDs.20to.20Monoids.html#206646417">(Aug 12 2020 at 00:06)</a>:</h4>
<p>I have a tentative definition of <code>gcd_monoid</code> at <code>mathlib:gcd_monoid</code></p>



<a name="206845093"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Refactoring%20UFDs%20to%20Monoids/near/206845093" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Aaron Anderson <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Refactoring.20UFDs.20to.20Monoids.html#206845093">(Aug 13 2020 at 17:33)</a>:</h4>
<p>Perhaps I'm overcomplicating things, but I think this is the best way to provide a common interface for all instances of gcd:</p>



<a name="206845309"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Refactoring%20UFDs%20to%20Monoids/near/206845309" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Aaron Anderson <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Refactoring.20UFDs.20to.20Monoids.html#206845309">(Aug 13 2020 at 17:34)</a>:</h4>
<p><code>gcd_monoid</code> : a mixin on <code>comm_monoid</code> that provides <code>gcd</code> and <code>lcm</code>, only guaranteed to be unique up to associated, or maybe even mutual divisibility (whatever you can guarantee for Euclidean domains)</p>



<a name="206845329"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Refactoring%20UFDs%20to%20Monoids/near/206845329" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Aaron Anderson <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Refactoring.20UFDs.20to.20Monoids.html#206845329">(Aug 13 2020 at 17:34)</a>:</h4>
<p>several normalization classes:</p>



<a name="206845621"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Refactoring%20UFDs%20to%20Monoids/near/206845621" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Aaron Anderson <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Refactoring.20UFDs.20to.20Monoids.html#206845621">(Aug 13 2020 at 17:36)</a>:</h4>
<ul>
<li><code>normalization_monoid</code> : a mixin on <code>comm_monoid</code> that provides <code>normalize</code> as a <code>monoid_hom</code></li>
<li><code>norm_unit_monoid_with_zero</code> : basically the current definition of <code>normalization_domain</code>, implies an instance of <code>normalization_monoid</code></li>
<li><code>normalized_monoid</code> or <code>unique_unit_monoid</code> : applies to nats and pnats, implies an instance of <code>normalization_monoid</code></li>
</ul>



<a name="206845908"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Refactoring%20UFDs%20to%20Monoids/near/206845908" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Aaron Anderson <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Refactoring.20UFDs.20to.20Monoids.html#206845908">(Aug 13 2020 at 17:39)</a>:</h4>
<p>and then<br>
<code>normalization_gcd_monoid</code> : extends <code>gcd_monoid</code> and <code>normalization_monoid</code>, is basically equivalent to <code>gcd_domain</code> right now, except it can apply to nats, pnats, and <code>associates</code>, this is where <code>coprime</code> is defined to match <code>nat.coprime</code> from core</p>



<a name="206847393"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Refactoring%20UFDs%20to%20Monoids/near/206847393" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Aaron Anderson <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Refactoring.20UFDs.20to.20Monoids.html#206847393">(Aug 13 2020 at 17:51)</a>:</h4>
<p>One obnoxious thing is that for all of these, a useful monoid-theoretic property to assume is that associated is the same thing as mutual divisibility, but the proof of that is slightly different depending on whether you have a <code>comm_cancel_monoid</code> (not yet defined) or a <code>comm_cancel_monoid_with_zero</code></p>



<a name="206882262"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Refactoring%20UFDs%20to%20Monoids/near/206882262" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Refactoring.20UFDs.20to.20Monoids.html#206882262">(Aug 13 2020 at 23:07)</a>:</h4>
<p>Mutual divisibility is the same as associated for an integral domain and anyone trying to do any kind of factoring in a non integral domain is in for a tough time</p>



<a name="206882367"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Refactoring%20UFDs%20to%20Monoids/near/206882367" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Refactoring.20UFDs.20to.20Monoids.html#206882367">(Aug 13 2020 at 23:08)</a>:</h4>
<p>I think we should have a mathematician's UFD which is a predicate on IDs rather than one which chooses representatives for factors. This is what comes up in commutative algebra</p>



<a name="206882999"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Refactoring%20UFDs%20to%20Monoids/near/206882999" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Aaron Anderson <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Refactoring.20UFDs.20to.20Monoids.html#206882999">(Aug 13 2020 at 23:18)</a>:</h4>
<p>So, there's no problem with doing it in a <code>comm_cancel_monoid_with_zero</code>, and that should let us do factorization of <code>associates</code> or ideals of a Dedekind Domain, etc.</p>



<a name="206883055"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Refactoring%20UFDs%20to%20Monoids/near/206883055" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Aaron Anderson <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Refactoring.20UFDs.20to.20Monoids.html#206883055">(Aug 13 2020 at 23:19)</a>:</h4>
<p>I'm just still here months later trying to find a way to not have to duplicate the gcd API between nats and pnats</p>



<a name="206883094"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Refactoring%20UFDs%20to%20Monoids/near/206883094" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Aaron Anderson <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Refactoring.20UFDs.20to.20Monoids.html#206883094">(Aug 13 2020 at 23:19)</a>:</h4>
<p>and it seems like the only solution is to have a class of commutative monoids where all elements can either be cancelled or are self-absorbing on both sides...</p>



<a name="206885890"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Refactoring%20UFDs%20to%20Monoids/near/206885890" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Aaron Anderson <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Refactoring.20UFDs.20to.20Monoids.html#206885890">(Aug 14 2020 at 00:02)</a>:</h4>
<p>I've spewed out some work on <code>mathlib:gcd_monoid</code> at <code>src/algebra/gcd_monoid</code></p>



<a name="206885903"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Refactoring%20UFDs%20to%20Monoids/near/206885903" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Aaron Anderson <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Refactoring.20UFDs.20to.20Monoids.html#206885903">(Aug 14 2020 at 00:02)</a>:</h4>
<p>I'm pretty sure it contains both good and bad ideas...</p>



<a name="206886026"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Refactoring%20UFDs%20to%20Monoids/near/206886026" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Aaron Anderson <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Refactoring.20UFDs.20to.20Monoids.html#206886026">(Aug 14 2020 at 00:04)</a>:</h4>
<p>I have also, however, exceeded instance depth, which means I should probably get help from somebody who knows more than me...</p>



<a name="206955000"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Refactoring%20UFDs%20to%20Monoids/near/206955000" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Aaron Anderson <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Refactoring.20UFDs.20to.20Monoids.html#206955000">(Aug 14 2020 at 17:27)</a>:</h4>
<p>Ok, I think I know how to reorder my priorities on this.</p>
<ul>
<li>Refactor normalization and gcd to be mixins on <code>comm_cancel_monoid_with_zero</code>, which is basically an Integral Domain which has forgotten addition and subtraction. This neglects Euclidean domains and pnats for now.</li>
<li>Turn to UFD. Find non-constructive, purely multiplicative criterion for defining <code>is_UFD</code>. Currently thinking <code>atomic :=</code> every non-zero element can be written as a product of irreducibles and units, but not necessarily in some global or constructive way, together with (irreducible iff prime).</li>
<li>Combine that definition with a <code>normalization_monoid</code> instance to get a constructive unique factorization, where all the irreducibles in the product are normalized (e.g. positive, e.g. monic)</li>
</ul>



<a name="206959972"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Refactoring%20UFDs%20to%20Monoids/near/206959972" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Aaron Anderson <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Refactoring.20UFDs.20to.20Monoids.html#206959972">(Aug 14 2020 at 18:14)</a>:</h4>
<p>Another step in there might be monoidifying <code>multiplicity</code>, as once you have a set/type of representatives of associate classes, multiplicity should give you the factorization, for the low price of proving multiplicity is finite</p>



<a name="206983320"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Refactoring%20UFDs%20to%20Monoids/near/206983320" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Aaron Anderson <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Refactoring.20UFDs.20to.20Monoids.html#206983320">(Aug 14 2020 at 21:19)</a>:</h4>
<p><a href="https://github.com/leanprover-community/mathlib/issues/3779">#3779</a> monoidifies some stuff</p>



<a name="206983377"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Refactoring%20UFDs%20to%20Monoids/near/206983377" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Aaron Anderson <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Refactoring.20UFDs.20to.20Monoids.html#206983377">(Aug 14 2020 at 21:20)</a>:</h4>
<p>It makes it possible to define a <code>gcd_monoid</code> instance on nats, and start merging the nat gcd API, but I don't start doing that in that PR</p>



<a name="206984600"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Refactoring%20UFDs%20to%20Monoids/near/206984600" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Aaron Anderson <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Refactoring.20UFDs.20to.20Monoids.html#206984600">(Aug 14 2020 at 21:32)</a>:</h4>
<p><span class="user-mention" data-user-id="110038">@Kevin Buzzard</span>, do you have opinions on the <code>Prop</code> definition of <code>is_UFD</code>? Another potential idea is irreducible iff prime and descending chain condition for divisibility</p>



<a name="207753504"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Refactoring%20UFDs%20to%20Monoids/near/207753504" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Aaron Anderson <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Refactoring.20UFDs.20to.20Monoids.html#207753504">(Aug 23 2020 at 03:18)</a>:</h4>
<p>I'm making some progress at <code>mathlib:ufm</code>.</p>



<a name="207753651"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Refactoring%20UFDs%20to%20Monoids/near/207753651" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Aaron Anderson <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Refactoring.20UFDs.20to.20Monoids.html#207753651">(Aug 23 2020 at 03:22)</a>:</h4>
<p>I've defined a class called <code>DCC_dvd</code> for monoids in which the relation <code>(λ a b : α, a ≠ 0 ∧ ∃ x, ¬is_unit x ∧ b = a * x)</code> is well-founded. I chose that definition because we've already proven that Noetherian rings satisfy that condition, but it's equivalent to <code>&lt;</code> on associates being well-founded, and it's usually called ACCP in the literature because it's equivalent to the ACC for principal ideals. All of these equivalences are trivial on paper, and seem not too bad in Lean, but aren't yet all trivial. (Would just need one lemma about relation-preserving surjections).</p>



<a name="207753734"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Refactoring%20UFDs%20to%20Monoids/near/207753734" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Aaron Anderson <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Refactoring.20UFDs.20to.20Monoids.html#207753734">(Aug 23 2020 at 03:25)</a>:</h4>
<p>I've defined <code>unique_factorization_monoid</code> to be that together with <code>irreducible_iff_prime</code>, and have renamed <code>unique_factorization_domain</code> to <code>prime_factorization</code>, because that's really the data of that definition. We also have an analogous structure already called <code>unique_irreducible_factorization</code>, that contains that data, and all of these are equivalent as properties of the ring, although not definitionally.</p>



<a name="207754345"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Refactoring%20UFDs%20to%20Monoids/near/207754345" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Aaron Anderson <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Refactoring.20UFDs.20to.20Monoids.html#207754345">(Aug 23 2020 at 03:44)</a>:</h4>
<p>I am going to prove that <code>unique_factorization_monoid</code> is equivalent to "every nonzero element is a product of primes" is equivalent to "every nonzero element is a product of irreducibles uniquely up to units", but should I keep the structures of <code>prime_factorization</code> and <code>unique_irreducible_factorization</code> if those proofs work without them?</p>



<a name="207754481"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Refactoring%20UFDs%20to%20Monoids/near/207754481" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Aaron Anderson <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Refactoring.20UFDs.20to.20Monoids.html#207754481">(Aug 23 2020 at 03:49)</a>:</h4>
<p>Of course, I'll still provide a canonical prime/irreducible factorization for a <code>normalization_monoid</code>, but that seems like about the only condition on which a canonical one actually exists, and works for all of our important examples.</p>



<a name="207755224"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Refactoring%20UFDs%20to%20Monoids/near/207755224" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Aaron Anderson <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Refactoring.20UFDs.20to.20Monoids.html#207755224">(Aug 23 2020 at 04:13)</a>:</h4>
<p>I'm certainly skeptical that we need both <code>prime_factorization</code> and <code>unique_irreducible_factorization</code>, because any time they both exist, they're provably equivalent</p>



<a name="207759644"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Refactoring%20UFDs%20to%20Monoids/near/207759644" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Refactoring.20UFDs.20to.20Monoids.html#207759644">(Aug 23 2020 at 06:50)</a>:</h4>
<p>They might not be constructively the same, or something?</p>



<a name="207779173"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Refactoring%20UFDs%20to%20Monoids/near/207779173" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Aaron Anderson <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Refactoring.20UFDs.20to.20Monoids.html#207779173">(Aug 23 2020 at 15:55)</a>:</h4>
<p>Well, any time either kind of factorization exists, you can prove both that such factorizations are unique up to units, and that irreducible is equivalent to prime</p>



<a name="207784114"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Refactoring%20UFDs%20to%20Monoids/near/207784114" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Refactoring.20UFDs.20to.20Monoids.html#207784114">(Aug 23 2020 at 17:56)</a>:</h4>
<p>Can you give a definition of a Dedekind domain as an integral domain whose nonzero ideals satisfy unique factorisation?</p>



<a name="207784125"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Refactoring%20UFDs%20to%20Monoids/near/207784125" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Refactoring.20UFDs.20to.20Monoids.html#207784125">(Aug 23 2020 at 17:57)</a>:</h4>
<p>The definition goes via the commutative semiring of ideals</p>



<a name="207788981"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Refactoring%20UFDs%20to%20Monoids/near/207788981" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Aaron Anderson <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Refactoring.20UFDs.20to.20Monoids.html#207788981">(Aug 23 2020 at 20:04)</a>:</h4>
<p>Do we actually have that commutative semiring instance on the type of ideals?</p>



<a name="207789007"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Refactoring%20UFDs%20to%20Monoids/near/207789007" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Aaron Anderson <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Refactoring.20UFDs.20to.20Monoids.html#207789007">(Aug 23 2020 at 20:05)</a>:</h4>
<p>I think we'd need a <code>comm_cancel_monoid_with_zero</code> instance on the type of ideals. I'm not sure if the cancel part is true for all <code>comm_ring</code>s, but should be true for every <code>integral_domain</code>, I guess, and at least it's definitely true for ideals of a Dedekind domain</p>



<a name="207789066"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Refactoring%20UFDs%20to%20Monoids/near/207789066" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Aaron Anderson <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Refactoring.20UFDs.20to.20Monoids.html#207789066">(Aug 23 2020 at 20:07)</a>:</h4>
<p>Then you need to show what "prime" and possibly "irreducible" mean in that monoid, but "prime" just means prime ideal, at least for enough rings</p>



<a name="207789076"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Refactoring%20UFDs%20to%20Monoids/near/207789076" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Aaron Anderson <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Refactoring.20UFDs.20to.20Monoids.html#207789076">(Aug 23 2020 at 20:07)</a>:</h4>
<p>and then you need to show either that <code>irreducible_iff_prime</code>, in the monoid of ideals, or that each nonzero ideal is a product, in some way, of primes</p>



<a name="207789078"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Refactoring%20UFDs%20to%20Monoids/near/207789078" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Aaron Anderson <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Refactoring.20UFDs.20to.20Monoids.html#207789078">(Aug 23 2020 at 20:07)</a>:</h4>
<p>and then you should be good</p>



<a name="207789122"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Refactoring%20UFDs%20to%20Monoids/near/207789122" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Aaron Anderson <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Refactoring.20UFDs.20to.20Monoids.html#207789122">(Aug 23 2020 at 20:08)</a>:</h4>
<p>once I work everything out here</p>



<a name="207792555"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Refactoring%20UFDs%20to%20Monoids/near/207792555" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Refactoring.20UFDs.20to.20Monoids.html#207792555">(Aug 23 2020 at 21:37)</a>:</h4>
<p>That's great. A lot has already been proven about the semring of ideals I believe.</p>



<a name="207792615"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Refactoring%20UFDs%20to%20Monoids/near/207792615" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Refactoring.20UFDs.20to.20Monoids.html#207792615">(Aug 23 2020 at 21:39)</a>:</h4>
<p><span class="user-mention silent" data-user-id="302826">Aaron Anderson</span> <a href="#narrow/stream/116395-maths/topic/Refactoring.20UFDs.20to.20Monoids/near/206984600">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="110038">Kevin Buzzard</span>, do you have opinions on the <code>Prop</code> definition of <code>is_UFD</code>? Another potential idea is irreducible iff prime and descending chain condition for divisibility</p>
</blockquote>
<p>Just to reply to this (very late I'm sorry, we've been seeing relatives) -- I don't have a clue about this sort of question. I don't believe that definitional equality is so important at this level -- either that or I don't understand its importance. Any Prop which is classically equivalent to being a UFD for rings and which applies to the ideals of a Dedekind domain will be fine.</p>



<a name="207793126"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Refactoring%20UFDs%20to%20Monoids/near/207793126" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Aaron Anderson <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Refactoring.20UFDs.20to.20Monoids.html#207793126">(Aug 23 2020 at 21:55)</a>:</h4>
<p>Ok, I'm proving 3 props are equivalent definitions, and then all data will come after that. If someone has a different preference as to which prop should be the original definition, it shouldn't be so hard to juggle everything around.</p>



<a name="207907799"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Refactoring%20UFDs%20to%20Monoids/near/207907799" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Aaron Anderson <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Refactoring.20UFDs.20to.20Monoids.html#207907799">(Aug 24 2020 at 23:07)</a>:</h4>
<p>Pushed more work. I should be done with showing the equivalence of the different prop definitions, and now I'm going to start constructing an actual prime factorization under the assumption of <code>normalization_monoid</code></p>



<a name="207907905"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Refactoring%20UFDs%20to%20Monoids/near/207907905" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Aaron Anderson <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Refactoring.20UFDs.20to.20Monoids.html#207907905">(Aug 24 2020 at 23:09)</a>:</h4>
<p>Unfortunately my definition will not be computable because I'm using choice, but it should be possible to refactor it to be defined in terms of <code>multiplicity</code>, which I believe is computable.</p>



<a name="207929644"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Refactoring%20UFDs%20to%20Monoids/near/207929644" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Refactoring.20UFDs.20to.20Monoids.html#207929644">(Aug 25 2020 at 06:53)</a>:</h4>
<p>We don't need computability for this stuff</p>



<a name="207929768"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Refactoring%20UFDs%20to%20Monoids/near/207929768" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Aaron Anderson <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Refactoring.20UFDs.20to.20Monoids.html#207929768">(Aug 25 2020 at 06:55)</a>:</h4>
<p>I just pushed a bunch more stuff connecting my work to the rest of the library</p>



<a name="207929845"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Refactoring%20UFDs%20to%20Monoids/near/207929845" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Aaron Anderson <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Refactoring.20UFDs.20to.20Monoids.html#207929845">(Aug 25 2020 at 06:56)</a>:</h4>
<p>for now I’ve deleted the old associates.factor_set business, some of which I want to reimplement, but it seems we can now do pretty much everything we wanted to do before I started, but with more generality, and it’s a predicate</p>



<a name="210083288"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Refactoring%20UFDs%20to%20Monoids/near/210083288" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Aaron Anderson <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Refactoring.20UFDs.20to.20Monoids.html#210083288">(Sep 15 2020 at 01:51)</a>:</h4>
<p><a href="https://github.com/leanprover-community/mathlib/issues/4156">#4156</a></p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>