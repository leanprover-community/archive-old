---
layout: archive
title: Zulip Chat Archive
permalink: /stream/116395-maths/topic/.60linear_combination.60.20for.20.20.E2.89.A0.20goals.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/116395-maths/index.html">maths</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/.60linear_combination.60.20for.20.20.E2.89.A0.20goals.html">`linear_combination` for  ≠ goals</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="275277616"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/%60linear_combination%60%20for%20%20%E2%89%A0%20goals/near/275277616" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/.60linear_combination.60.20for.20.20.E2.89.A0.20goals.html#275277616">(Mar 14 2022 at 18:20)</a>:</h4>
<p>By the way, <span class="user-mention" data-user-id="110596">@Rob Lewis</span>, I was noticing that for the <a href="#narrow/stream/116395-maths/topic/thoughts.20on.20elliptic.20curves/near/275271497">side goal produced</a> by Marc's code, it would be nice to have a <code>linear_combination</code> variant which solved inequality goals given one inequality hypothesis.</p>
<p>(Delibarately) slightly more complicated example than Marc's:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">example</span> <span class="o">{</span><span class="n">x</span> <span class="n">y</span> <span class="n">z</span> <span class="o">:</span> <span class="n">K</span><span class="o">}</span> <span class="o">(</span><span class="n">h₁</span> <span class="o">:</span> <span class="o">(</span><span class="n">x</span> <span class="bp">-</span> <span class="n">y</span><span class="o">)</span> <span class="bp">^</span> <span class="mi">2</span> <span class="bp">≠</span> <span class="mi">0</span><span class="o">)</span> <span class="o">(</span><span class="n">h₂</span> <span class="o">:</span> <span class="n">y</span> <span class="bp">=</span> <span class="n">z</span><span class="o">)</span> <span class="o">:</span> <span class="bp">-</span><span class="n">x</span> <span class="bp">^</span> <span class="mi">2</span> <span class="bp">+</span> <span class="mi">2</span> <span class="bp">*</span> <span class="n">x</span> <span class="bp">*</span> <span class="n">z</span> <span class="bp">≠</span> <span class="n">y</span> <span class="bp">^</span> <span class="mi">2</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="n">contrapose</span><span class="bp">!</span> <span class="n">h₁</span><span class="o">,</span>
  <span class="n">linear_combination</span> <span class="o">(</span><span class="n">h₁</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">)</span> <span class="o">(</span><span class="n">h₂</span><span class="o">,</span> <span class="bp">-</span> <span class="mi">2</span> <span class="bp">*</span> <span class="n">x</span><span class="o">),</span>
<span class="kd">end</span>
</code></pre></div>



<a name="275277715"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/%60linear_combination%60%20for%20%20%E2%89%A0%20goals/near/275277715" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/.60linear_combination.60.20for.20.20.E2.89.A0.20goals.html#275277715">(Mar 14 2022 at 18:21)</a>:</h4>
<p>Can't you just do <code>refine λ h, h₁ _, linear_combination ...</code>?</p>



<a name="275277763"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/%60linear_combination%60%20for%20%20%E2%89%A0%20goals/near/275277763" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/.60linear_combination.60.20for.20.20.E2.89.A0.20goals.html#275277763">(Mar 14 2022 at 18:21)</a>:</h4>
<p>Of course, but I'm asking for it to be built into <code>linear_combination</code> itself!</p>



<a name="275277822"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/%60linear_combination%60%20for%20%20%E2%89%A0%20goals/near/275277822" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/.60linear_combination.60.20for.20.20.E2.89.A0.20goals.html#275277822">(Mar 14 2022 at 18:21)</a>:</h4>
<p>(Actually I think I'm also using the <code>not_not</code> simplification hidden in <code>contrapose!</code>)</p>



<a name="275277909"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/%60linear_combination%60%20for%20%20%E2%89%A0%20goals/near/275277909" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/.60linear_combination.60.20for.20.20.E2.89.A0.20goals.html#275277909">(Mar 14 2022 at 18:22)</a>:</h4>
<p>You're not, no.</p>



<a name="275277947"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/%60linear_combination%60%20for%20%20%E2%89%A0%20goals/near/275277947" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/.60linear_combination.60.20for.20.20.E2.89.A0.20goals.html#275277947">(Mar 14 2022 at 18:22)</a>:</h4>
<p>Oh yes, you are</p>



<a name="275277963"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/%60linear_combination%60%20for%20%20%E2%89%A0%20goals/near/275277963" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/.60linear_combination.60.20for.20.20.E2.89.A0.20goals.html#275277963">(Mar 14 2022 at 18:22)</a>:</h4>
<p>No, you're not</p>



<a name="275278031"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/%60linear_combination%60%20for%20%20%E2%89%A0%20goals/near/275278031" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/.60linear_combination.60.20for.20.20.E2.89.A0.20goals.html#275278031">(Mar 14 2022 at 18:23)</a>:</h4>
<p>Been a long day here <span aria-label="rofl" class="emoji emoji-1f923" role="img" title="rofl">:rofl:</span></p>



<a name="275278221"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/%60linear_combination%60%20for%20%20%E2%89%A0%20goals/near/275278221" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/.60linear_combination.60.20for.20.20.E2.89.A0.20goals.html#275278221">(Mar 14 2022 at 18:24)</a>:</h4>
<p>It would be easy enough to add this as a preprocessing step, yes!</p>



<a name="275279357"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/%60linear_combination%60%20for%20%20%E2%89%A0%20goals/near/275279357" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/.60linear_combination.60.20for.20.20.E2.89.A0.20goals.html#275279357">(Mar 14 2022 at 18:32)</a>:</h4>
<p><a href="https://github.com/leanprover-community/mathlib/pull/12685">#12685</a></p>



<a name="275280464"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/%60linear_combination%60%20for%20%20%E2%89%A0%20goals/near/275280464" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/.60linear_combination.60.20for.20.20.E2.89.A0.20goals.html#275280464">(Mar 14 2022 at 18:41)</a>:</h4>
<p>I've made the patch locally already, will PR when I have a reliable internet connection to push it!</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">example</span> <span class="o">{</span><span class="n">x</span> <span class="n">y</span> <span class="n">z</span> <span class="o">:</span> <span class="n">ℝ</span><span class="o">}</span> <span class="o">(</span><span class="n">h₁</span> <span class="o">:</span> <span class="o">(</span><span class="n">x</span> <span class="bp">-</span> <span class="n">y</span><span class="o">)</span> <span class="bp">^</span> <span class="mi">2</span> <span class="bp">≠</span> <span class="mi">0</span><span class="o">)</span> <span class="o">(</span><span class="n">h₂</span> <span class="o">:</span> <span class="n">y</span> <span class="bp">=</span> <span class="n">z</span><span class="o">)</span> <span class="o">:</span> <span class="bp">-</span><span class="n">x</span> <span class="bp">^</span> <span class="mi">2</span> <span class="bp">+</span> <span class="mi">2</span> <span class="bp">*</span> <span class="n">x</span> <span class="bp">*</span> <span class="n">z</span> <span class="bp">≠</span> <span class="n">y</span> <span class="bp">^</span> <span class="mi">2</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="n">linear_combination</span> <span class="o">(</span><span class="n">h₁</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">)</span> <span class="o">(</span><span class="n">h₂</span><span class="o">,</span> <span class="bp">-</span> <span class="mi">2</span> <span class="bp">*</span> <span class="n">x</span><span class="o">),</span>
<span class="kd">end</span>
</code></pre></div>



<a name="275280620"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/%60linear_combination%60%20for%20%20%E2%89%A0%20goals/near/275280620" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/.60linear_combination.60.20for.20.20.E2.89.A0.20goals.html#275280620">(Mar 14 2022 at 18:43)</a>:</h4>
<p>Rob Lewis, customer service employee of the month, March 2022!  (and every month!)</p>



<a name="275280860"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/%60linear_combination%60%20for%20%20%E2%89%A0%20goals/near/275280860" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/.60linear_combination.60.20for.20.20.E2.89.A0.20goals.html#275280860">(Mar 14 2022 at 18:45)</a>:</h4>
<p>Just don't ask for it to start handling inequalities too <span aria-label="wink" class="emoji emoji-1f609" role="img" title="wink">:wink:</span></p>



<a name="275291921"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/%60linear_combination%60%20for%20%20%E2%89%A0%20goals/near/275291921" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/.60linear_combination.60.20for.20.20.E2.89.A0.20goals.html#275291921">(Mar 14 2022 at 20:12)</a>:</h4>
<p>In fact, this is somewhat more involved than what I hacked together on the spot. When you contrapose the goal and a hypothesis, some coefficients may change. It would be natural to write </p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">example</span> <span class="o">{</span><span class="n">x</span> <span class="n">y</span> <span class="n">a</span> <span class="n">b</span> <span class="n">c</span><span class="o">:</span> <span class="n">ℝ</span><span class="o">}</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="n">x</span> <span class="bp">≠</span> <span class="n">y</span><span class="o">)</span> <span class="o">(</span><span class="n">h2</span> <span class="o">:</span> <span class="n">a</span> <span class="bp">=</span> <span class="n">b</span><span class="o">)</span> <span class="o">:</span> <span class="mi">5</span><span class="bp">*</span><span class="n">x</span> <span class="bp">+</span> <span class="mi">2</span><span class="bp">*</span><span class="n">a</span> <span class="bp">≠</span> <span class="mi">5</span><span class="bp">*</span><span class="n">y</span> <span class="bp">+</span> <span class="mi">2</span><span class="bp">*</span><span class="n">b</span> <span class="o">:=</span>
<span class="kd">by</span> <span class="n">linear_combination</span> <span class="o">(</span><span class="n">h</span><span class="o">,</span> <span class="mi">5</span><span class="o">)</span> <span class="o">(</span><span class="n">h2</span><span class="o">,</span> <span class="mi">2</span><span class="o">)</span>
</code></pre></div>
<p>but this doesn't work. So consider this WIP still</p>



<a name="275298775"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/%60linear_combination%60%20for%20%20%E2%89%A0%20goals/near/275298775" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/.60linear_combination.60.20for.20.20.E2.89.A0.20goals.html#275298775">(Mar 14 2022 at 21:11)</a>:</h4>
<p>I see -- so the coefficient changes by a sign on all but the special hypothesis, and moreover by the inverse of the coefficient of the special hypothesis on every hypothesis:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">tactic.linear_combination</span>

<span class="c1">-- desired_syntax: `linear_combination h₁ (h₂, 2 * x)`</span>
<span class="kd">example</span> <span class="o">{</span><span class="n">R</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">comm_ring</span> <span class="n">R</span><span class="o">]</span> <span class="o">{</span><span class="n">x</span> <span class="n">y</span> <span class="n">z</span> <span class="o">:</span> <span class="n">R</span><span class="o">}</span> <span class="o">(</span><span class="n">h₁</span> <span class="o">:</span> <span class="o">(</span><span class="n">x</span> <span class="bp">-</span> <span class="n">y</span><span class="o">)</span> <span class="bp">^</span> <span class="mi">2</span> <span class="bp">≠</span> <span class="mi">0</span><span class="o">)</span> <span class="o">(</span><span class="n">h₂</span> <span class="o">:</span> <span class="n">y</span> <span class="bp">=</span> <span class="n">z</span><span class="o">)</span> <span class="o">:</span>
  <span class="bp">-</span><span class="n">x</span> <span class="bp">^</span> <span class="mi">2</span> <span class="bp">+</span> <span class="mi">2</span> <span class="bp">*</span> <span class="n">x</span> <span class="bp">*</span> <span class="n">z</span> <span class="bp">≠</span> <span class="n">y</span> <span class="bp">^</span> <span class="mi">2</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="n">contrapose</span><span class="bp">!</span> <span class="n">h₁</span> <span class="k">with</span> <span class="n">h_goal</span><span class="o">,</span>
  <span class="n">linear_combination</span> <span class="o">(</span><span class="n">h_goal</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">)</span> <span class="o">(</span><span class="n">h₂</span><span class="o">,</span> <span class="bp">-</span> <span class="mi">2</span> <span class="bp">*</span> <span class="n">x</span><span class="o">),</span>
<span class="kd">end</span>

<span class="c1">-- desired_syntax: `linear_combination h (h2, 2)`</span>
<span class="kd">example</span> <span class="o">{</span><span class="n">R</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">comm_ring</span> <span class="n">R</span><span class="o">]</span> <span class="o">{</span><span class="n">x</span> <span class="n">y</span> <span class="n">a</span> <span class="n">b</span> <span class="n">c</span><span class="o">:</span> <span class="n">R</span><span class="o">}</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="n">x</span> <span class="bp">≠</span> <span class="n">y</span><span class="o">)</span> <span class="o">(</span><span class="n">h2</span> <span class="o">:</span> <span class="n">a</span> <span class="bp">=</span> <span class="n">b</span><span class="o">)</span> <span class="o">:</span>
  <span class="n">x</span> <span class="bp">+</span> <span class="mi">2</span> <span class="bp">*</span> <span class="n">a</span> <span class="bp">≠</span> <span class="n">y</span> <span class="bp">+</span> <span class="mi">2</span> <span class="bp">*</span> <span class="n">b</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="n">contrapose</span><span class="bp">!</span> <span class="n">h</span> <span class="k">with</span> <span class="n">h_goal</span><span class="o">,</span>
  <span class="n">linear_combination</span> <span class="n">h_goal</span> <span class="o">(</span><span class="n">h2</span><span class="o">,</span> <span class="bp">-</span><span class="mi">2</span><span class="o">)</span>
<span class="kd">end</span>

<span class="c1">-- desired syntax: `linear_combination (h, 5) (h2, 2)`</span>
<span class="kd">example</span> <span class="o">{</span><span class="n">K</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">field</span> <span class="n">K</span><span class="o">]</span> <span class="o">[</span><span class="n">char_zero</span> <span class="n">K</span><span class="o">]</span> <span class="o">{</span><span class="n">x</span> <span class="n">y</span> <span class="n">a</span> <span class="n">b</span> <span class="n">c</span><span class="o">:</span> <span class="n">K</span><span class="o">}</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="n">x</span> <span class="bp">≠</span> <span class="n">y</span><span class="o">)</span> <span class="o">(</span><span class="n">h2</span> <span class="o">:</span> <span class="n">a</span> <span class="bp">=</span> <span class="n">b</span><span class="o">)</span> <span class="o">:</span>
  <span class="mi">5</span> <span class="bp">*</span> <span class="n">x</span> <span class="bp">+</span> <span class="mi">2</span> <span class="bp">*</span> <span class="n">a</span> <span class="bp">≠</span> <span class="mi">5</span> <span class="bp">*</span> <span class="n">y</span> <span class="bp">+</span> <span class="mi">2</span> <span class="bp">*</span> <span class="n">b</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="n">contrapose</span><span class="bp">!</span> <span class="n">h</span> <span class="k">with</span> <span class="n">h_goal</span><span class="o">,</span>
  <span class="n">linear_combination</span> <span class="o">(</span><span class="n">h_goal</span><span class="o">,</span> <span class="mi">1</span><span class="bp">/</span><span class="mi">5</span><span class="o">)</span> <span class="o">(</span><span class="n">h2</span><span class="o">,</span> <span class="bp">-</span><span class="mi">2</span><span class="bp">/</span><span class="mi">5</span><span class="o">),</span>
<span class="kd">end</span>
</code></pre></div>



<a name="275299297"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/%60linear_combination%60%20for%20%20%E2%89%A0%20goals/near/275299297" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/.60linear_combination.60.20for.20.20.E2.89.A0.20goals.html#275299297">(Mar 14 2022 at 21:16)</a>:</h4>
<p>In particular this means that you need invertibility of the coefficient of the special hypothesis -- perhaps build in special handling when this coefficient is 1 or -1, and otherwise require that one be working over a characteristic-zero field and that the coefficient is a numeral.</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>