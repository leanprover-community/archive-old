---
layout: archive
title: Zulip Chat Archive
permalink: /stream/116395-maths/topic/Multiplication.20on.20int.20is.20well-defined.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/116395-maths/index.html">maths</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Multiplication.20on.20int.20is.20well-defined.html">Multiplication on int is well-defined</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="202240104"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Multiplication%20on%20int%20is%20well-defined/near/202240104" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Multiplication.20on.20int.20is.20well-defined.html#202240104">(Jun 28 2020 at 14:57)</a>:</h4>
<p>In other words,</p>
<div class="codehilite"><pre><span></span><code><span class="kn">example</span> <span class="o">(</span><span class="n">p</span> <span class="n">q</span> <span class="n">r</span> <span class="n">s</span> <span class="n">t</span> <span class="n">u</span> <span class="n">v</span> <span class="n">w</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">)</span> <span class="o">(</span><span class="n">h1</span> <span class="o">:</span> <span class="n">p</span> <span class="bp">+</span> <span class="n">u</span> <span class="bp">=</span> <span class="n">q</span> <span class="bp">+</span> <span class="n">t</span><span class="o">)</span> <span class="o">(</span><span class="n">h2</span> <span class="o">:</span> <span class="n">r</span> <span class="bp">+</span> <span class="n">w</span> <span class="bp">=</span> <span class="n">s</span> <span class="bp">+</span> <span class="n">v</span><span class="o">)</span> <span class="o">:</span>
  <span class="n">p</span> <span class="bp">*</span> <span class="n">r</span> <span class="bp">+</span> <span class="n">q</span> <span class="bp">*</span> <span class="n">s</span> <span class="bp">+</span> <span class="o">(</span><span class="n">t</span> <span class="bp">*</span> <span class="n">w</span> <span class="bp">+</span> <span class="n">u</span> <span class="bp">*</span> <span class="n">v</span><span class="o">)</span> <span class="bp">=</span> <span class="n">p</span> <span class="bp">*</span> <span class="n">s</span> <span class="bp">+</span> <span class="n">q</span> <span class="bp">*</span> <span class="n">r</span> <span class="bp">+</span> <span class="o">(</span><span class="n">t</span> <span class="bp">*</span> <span class="n">v</span> <span class="bp">+</span> <span class="n">u</span> <span class="bp">*</span> <span class="n">w</span><span class="o">)</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="k">have</span> <span class="n">h3</span> <span class="o">:</span> <span class="o">(</span><span class="n">p</span> <span class="bp">+</span> <span class="n">u</span><span class="o">)</span> <span class="bp">*</span> <span class="n">r</span> <span class="bp">=</span> <span class="o">(</span><span class="n">q</span> <span class="bp">+</span> <span class="n">t</span><span class="o">)</span> <span class="bp">*</span> <span class="n">r</span><span class="o">,</span>
    <span class="n">rw</span> <span class="n">h1</span><span class="o">,</span>
  <span class="n">rw</span> <span class="o">[</span><span class="n">add_mul</span><span class="o">,</span> <span class="n">add_mul</span><span class="o">]</span> <span class="n">at</span> <span class="n">h3</span><span class="o">,</span>
  <span class="n">apply</span> <span class="bp">@</span><span class="n">nat</span><span class="bp">.</span><span class="n">add_left_cancel</span> <span class="o">(</span><span class="n">u</span> <span class="bp">*</span> <span class="n">r</span><span class="o">),</span>
  <span class="n">rw</span> <span class="o">[</span><span class="k">show</span> <span class="n">u</span> <span class="bp">*</span> <span class="n">r</span> <span class="bp">+</span> <span class="o">(</span><span class="n">p</span> <span class="bp">*</span> <span class="n">r</span> <span class="bp">+</span> <span class="n">q</span> <span class="bp">*</span> <span class="n">s</span> <span class="bp">+</span> <span class="o">(</span><span class="n">t</span> <span class="bp">*</span> <span class="n">w</span> <span class="bp">+</span> <span class="n">u</span> <span class="bp">*</span> <span class="n">v</span><span class="o">))</span> <span class="bp">=</span> <span class="n">p</span> <span class="bp">*</span> <span class="n">r</span> <span class="bp">+</span> <span class="n">u</span> <span class="bp">*</span> <span class="n">r</span> <span class="bp">+</span> <span class="n">q</span> <span class="bp">*</span> <span class="n">s</span> <span class="bp">+</span> <span class="n">t</span> <span class="bp">*</span> <span class="n">w</span> <span class="bp">+</span> <span class="n">u</span> <span class="bp">*</span> <span class="n">v</span><span class="o">,</span> <span class="k">by</span> <span class="n">ring</span><span class="o">],</span>
  <span class="n">rw</span> <span class="n">h3</span><span class="o">,</span>
  <span class="n">rw</span> <span class="o">[</span><span class="k">show</span> <span class="n">q</span> <span class="bp">*</span> <span class="n">r</span> <span class="bp">+</span> <span class="n">t</span> <span class="bp">*</span> <span class="n">r</span> <span class="bp">+</span> <span class="n">q</span> <span class="bp">*</span> <span class="n">s</span> <span class="bp">+</span> <span class="n">t</span> <span class="bp">*</span> <span class="n">w</span> <span class="bp">+</span> <span class="n">u</span> <span class="bp">*</span> <span class="n">v</span> <span class="bp">=</span> <span class="n">t</span> <span class="bp">*</span> <span class="o">(</span><span class="n">r</span> <span class="bp">+</span> <span class="n">w</span><span class="o">)</span> <span class="bp">+</span> <span class="n">q</span> <span class="bp">*</span> <span class="n">s</span> <span class="bp">+</span> <span class="n">u</span> <span class="bp">*</span> <span class="n">v</span> <span class="bp">+</span> <span class="n">q</span> <span class="bp">*</span> <span class="n">r</span><span class="o">,</span> <span class="k">by</span> <span class="n">ring</span><span class="o">],</span>
  <span class="n">rw</span> <span class="o">[</span><span class="k">show</span> <span class="n">u</span> <span class="bp">*</span> <span class="n">r</span> <span class="bp">+</span> <span class="o">(</span><span class="n">p</span> <span class="bp">*</span> <span class="n">s</span> <span class="bp">+</span> <span class="n">q</span> <span class="bp">*</span> <span class="n">r</span> <span class="bp">+</span> <span class="o">(</span><span class="n">t</span> <span class="bp">*</span> <span class="n">v</span> <span class="bp">+</span> <span class="n">u</span> <span class="bp">*</span> <span class="n">w</span><span class="o">))</span> <span class="bp">=</span> <span class="n">u</span> <span class="bp">*</span> <span class="o">(</span><span class="n">r</span> <span class="bp">+</span> <span class="n">w</span><span class="o">)</span> <span class="bp">+</span> <span class="n">p</span> <span class="bp">*</span> <span class="n">s</span> <span class="bp">+</span> <span class="n">t</span> <span class="bp">*</span> <span class="n">v</span> <span class="bp">+</span> <span class="n">q</span> <span class="bp">*</span> <span class="n">r</span><span class="o">,</span> <span class="k">by</span> <span class="n">ring</span><span class="o">],</span>
  <span class="n">rw</span> <span class="o">[</span><span class="n">h2</span><span class="o">,</span> <span class="n">mul_add</span><span class="o">,</span> <span class="n">mul_add</span><span class="o">],</span>
  <span class="n">rw</span> <span class="o">[</span><span class="k">show</span> <span class="n">t</span> <span class="bp">*</span> <span class="n">s</span> <span class="bp">+</span> <span class="n">t</span> <span class="bp">*</span> <span class="n">v</span> <span class="bp">+</span> <span class="n">q</span> <span class="bp">*</span> <span class="n">s</span> <span class="bp">+</span> <span class="n">u</span> <span class="bp">*</span> <span class="n">v</span> <span class="bp">+</span> <span class="n">q</span> <span class="bp">*</span> <span class="n">r</span> <span class="bp">=</span> <span class="n">t</span> <span class="bp">*</span> <span class="n">s</span> <span class="bp">+</span> <span class="n">q</span> <span class="bp">*</span> <span class="n">s</span> <span class="bp">+</span> <span class="n">t</span> <span class="bp">*</span> <span class="n">v</span> <span class="bp">+</span> <span class="n">u</span> <span class="bp">*</span> <span class="n">v</span> <span class="bp">+</span> <span class="n">q</span> <span class="bp">*</span> <span class="n">r</span><span class="o">,</span> <span class="k">by</span> <span class="n">ring</span><span class="o">],</span>
  <span class="c1">--uv cancels tv cancels qr cancels</span>
  <span class="n">suffices</span> <span class="o">:</span> <span class="n">t</span> <span class="bp">*</span> <span class="n">s</span> <span class="bp">+</span> <span class="n">q</span> <span class="bp">*</span> <span class="n">s</span> <span class="bp">=</span> <span class="o">(</span><span class="n">p</span> <span class="bp">+</span> <span class="n">u</span><span class="o">)</span> <span class="bp">*</span> <span class="n">s</span><span class="o">,</span>
    <span class="n">rw</span> <span class="n">this</span><span class="o">,</span> <span class="n">ring</span><span class="o">,</span>
  <span class="n">rw</span> <span class="n">h1</span><span class="o">,</span>
  <span class="n">ring</span><span class="o">,</span>
<span class="kn">end</span>
</code></pre></div>


<p>Are there better techniques for this? Note that this is all nat hell.</p>



<a name="202240116"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Multiplication%20on%20int%20is%20well-defined/near/202240116" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Multiplication.20on.20int.20is.20well-defined.html#202240116">(Jun 28 2020 at 14:57)</a>:</h4>
<p>This is what you get when you try to define multiplication on the quotient.</p>



<a name="202241110"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Multiplication%20on%20int%20is%20well-defined/near/202241110" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Multiplication.20on.20int.20is.20well-defined.html#202241110">(Jun 28 2020 at 15:24)</a>:</h4>
<p>Here's the most organized proof I can make based on your script:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">example</span> <span class="o">(</span><span class="n">p</span> <span class="n">q</span> <span class="n">r</span> <span class="n">s</span> <span class="n">t</span> <span class="n">u</span> <span class="n">v</span> <span class="n">w</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">)</span> <span class="o">(</span><span class="n">h1</span> <span class="o">:</span> <span class="n">p</span> <span class="bp">+</span> <span class="n">u</span> <span class="bp">=</span> <span class="n">q</span> <span class="bp">+</span> <span class="n">t</span><span class="o">)</span> <span class="o">(</span><span class="n">h2</span> <span class="o">:</span> <span class="n">r</span> <span class="bp">+</span> <span class="n">w</span> <span class="bp">=</span> <span class="n">s</span> <span class="bp">+</span> <span class="n">v</span><span class="o">)</span> <span class="o">:</span>
  <span class="n">p</span> <span class="bp">*</span> <span class="n">r</span> <span class="bp">+</span> <span class="n">q</span> <span class="bp">*</span> <span class="n">s</span> <span class="bp">+</span> <span class="o">(</span><span class="n">t</span> <span class="bp">*</span> <span class="n">w</span> <span class="bp">+</span> <span class="n">u</span> <span class="bp">*</span> <span class="n">v</span><span class="o">)</span> <span class="bp">=</span> <span class="n">p</span> <span class="bp">*</span> <span class="n">s</span> <span class="bp">+</span> <span class="n">q</span> <span class="bp">*</span> <span class="n">r</span> <span class="bp">+</span> <span class="o">(</span><span class="n">t</span> <span class="bp">*</span> <span class="n">v</span> <span class="bp">+</span> <span class="n">u</span> <span class="bp">*</span> <span class="n">w</span><span class="o">)</span> <span class="o">:=</span>
<span class="n">nat</span><span class="bp">.</span><span class="n">add_left_cancel</span> <span class="err">$</span> <span class="k">calc</span>
      <span class="n">u</span> <span class="bp">*</span> <span class="n">r</span> <span class="bp">+</span> <span class="o">(</span><span class="n">p</span> <span class="bp">*</span> <span class="n">r</span> <span class="bp">+</span> <span class="n">q</span> <span class="bp">*</span> <span class="n">s</span> <span class="bp">+</span> <span class="o">(</span><span class="n">t</span> <span class="bp">*</span> <span class="n">w</span> <span class="bp">+</span> <span class="n">u</span> <span class="bp">*</span> <span class="n">v</span><span class="o">))</span>
    <span class="bp">=</span> <span class="n">t</span> <span class="bp">*</span> <span class="n">w</span> <span class="bp">+</span> <span class="o">(</span><span class="n">p</span> <span class="bp">+</span> <span class="n">u</span><span class="o">)</span> <span class="bp">*</span> <span class="n">r</span> <span class="bp">+</span> <span class="n">q</span> <span class="bp">*</span> <span class="n">s</span> <span class="bp">+</span> <span class="n">u</span> <span class="bp">*</span> <span class="n">v</span> <span class="o">:</span> <span class="k">by</span> <span class="n">ring</span>
<span class="bp">...</span> <span class="bp">=</span> <span class="n">t</span> <span class="bp">*</span> <span class="o">(</span><span class="n">s</span> <span class="bp">+</span> <span class="n">v</span><span class="o">)</span> <span class="bp">+</span> <span class="n">q</span> <span class="bp">*</span> <span class="n">r</span> <span class="bp">+</span> <span class="n">q</span> <span class="bp">*</span> <span class="n">s</span> <span class="bp">+</span> <span class="n">u</span> <span class="bp">*</span> <span class="n">v</span> <span class="o">:</span> <span class="k">by</span> <span class="n">rw</span> <span class="o">[</span><span class="n">h1</span><span class="o">,</span> <span class="err">←</span> <span class="n">h2</span><span class="o">]</span><span class="bp">;</span> <span class="n">ring</span>
<span class="bp">...</span> <span class="bp">=</span> <span class="n">u</span> <span class="bp">*</span> <span class="n">v</span> <span class="bp">+</span> <span class="o">(</span><span class="n">q</span> <span class="bp">+</span> <span class="n">t</span><span class="o">)</span> <span class="bp">*</span> <span class="n">s</span> <span class="bp">+</span> <span class="n">q</span> <span class="bp">*</span> <span class="n">r</span> <span class="bp">+</span> <span class="n">t</span> <span class="bp">*</span> <span class="n">v</span> <span class="o">:</span> <span class="k">by</span> <span class="n">ring</span>
<span class="bp">...</span> <span class="bp">=</span> <span class="n">u</span> <span class="bp">*</span> <span class="o">(</span><span class="n">r</span> <span class="bp">+</span> <span class="n">w</span><span class="o">)</span> <span class="bp">+</span> <span class="n">p</span> <span class="bp">*</span> <span class="n">s</span> <span class="bp">+</span> <span class="n">q</span> <span class="bp">*</span> <span class="n">r</span> <span class="bp">+</span> <span class="n">t</span> <span class="bp">*</span> <span class="n">v</span> <span class="o">:</span> <span class="k">by</span> <span class="n">rw</span> <span class="o">[</span><span class="err">←</span> <span class="n">h1</span><span class="o">,</span> <span class="n">h2</span><span class="o">]</span><span class="bp">;</span> <span class="n">ring</span>
<span class="bp">...</span> <span class="bp">=</span> <span class="n">u</span> <span class="bp">*</span> <span class="n">r</span> <span class="bp">+</span> <span class="o">(</span><span class="n">p</span> <span class="bp">*</span> <span class="n">s</span> <span class="bp">+</span> <span class="n">q</span> <span class="bp">*</span> <span class="n">r</span> <span class="bp">+</span> <span class="o">(</span><span class="n">t</span> <span class="bp">*</span> <span class="n">v</span> <span class="bp">+</span> <span class="n">u</span> <span class="bp">*</span> <span class="n">w</span><span class="o">))</span> <span class="o">:</span> <span class="k">by</span> <span class="n">ring</span>
</code></pre></div>



<a name="202243810"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Multiplication%20on%20int%20is%20well-defined/near/202243810" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Multiplication.20on.20int.20is.20well-defined.html#202243810">(Jun 28 2020 at 16:30)</a>:</h4>
<p>Where is my automation? Is this hard?</p>



<a name="202243817"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Multiplication%20on%20int%20is%20well-defined/near/202243817" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Multiplication.20on.20int.20is.20well-defined.html#202243817">(Jun 28 2020 at 16:30)</a>:</h4>
<p>Aah -- it suffices to prove it for all the variables in<code>int</code>, and <code>ring</code> can do that</p>



<a name="202244609"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Multiplication%20on%20int%20is%20well-defined/near/202244609" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Multiplication.20on.20int.20is.20well-defined.html#202244609">(Jun 28 2020 at 16:52)</a>:</h4>
<p>Of course you can also coerce everything to <code>int</code> and then this is easy by <code>ring</code> but I'm assuming you don't have that</p>



<a name="202244637"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Multiplication%20on%20int%20is%20well-defined/near/202244637" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Multiplication.20on.20int.20is.20well-defined.html#202244637">(Jun 28 2020 at 16:53)</a>:</h4>
<p>The general automation for things like this is the <code>ring_rw</code> / <code>groebner</code> tactics we've been talking about</p>



<a name="202244862"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Multiplication%20on%20int%20is%20well-defined/near/202244862" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Multiplication.20on.20int.20is.20well-defined.html#202244862">(Jun 28 2020 at 16:58)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110049">Mario Carneiro</span> <a href="#narrow/stream/116395-maths/topic/Multiplication.20on.20int.20is.20well-defined/near/202244609">said</a>:</p>
<blockquote>
<p>Of course you can also coerce everything to <code>int</code> and then this is easy by <code>ring</code> but I'm assuming you don't have that</p>
</blockquote>
<p><code>zify at *</code> coerces everything to <code>int</code>s, but it doesn't seem to help much in this case.</p>



<a name="202244952"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Multiplication%20on%20int%20is%20well-defined/near/202244952" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Karl Palmskog <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Multiplication.20on.20int.20is.20well-defined.html#202244952">(Jun 28 2020 at 17:00)</a>:</h4>
<p>just wanted to check if the Lean community is aware of Coq's ongoing modernization of <a href="https://coq.inria.fr/refman/addendum/micromega.html">Micromega</a> (<code>lia</code>, <code>nia</code>, etc., tactics)? For example, <code>lia</code> in Coq 8.11 directly solves the above goal. (<code>Finished transaction in 0.042 secs (0.034u,0.s) (successful)</code>)</p>



<a name="202245031"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Multiplication%20on%20int%20is%20well-defined/near/202245031" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Multiplication.20on.20int.20is.20well-defined.html#202245031">(Jun 28 2020 at 17:03)</a>:</h4>
<p>Oh, <code>nlinarith</code> solves it too! (but it's kind of slow: <code>elaboration: tactic execution took 1.78s</code>.)</p>



<a name="202248581"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Multiplication%20on%20int%20is%20well-defined/near/202248581" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Multiplication.20on.20int.20is.20well-defined.html#202248581">(Jun 28 2020 at 18:33)</a>:</h4>
<p>What sorcery is this?</p>



<a name="202248655"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Multiplication%20on%20int%20is%20well-defined/near/202248655" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Multiplication.20on.20int.20is.20well-defined.html#202248655">(Jun 28 2020 at 18:35)</a>:</h4>
<p>so why is Coq so much faster?</p>



<a name="202248740"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Multiplication%20on%20int%20is%20well-defined/near/202248740" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bhavik Mehta <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Multiplication.20on.20int.20is.20well-defined.html#202248740">(Jun 28 2020 at 18:36)</a>:</h4>
<p>Does the <code>lia</code> proof in Coq solve it over <code>int</code> or <code>nat</code>? Looking at that link, it seems that <code>lia</code> uses arithmetic over <code>int</code>, so it's not exactly the same problem as this one</p>



<a name="202248742"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Multiplication%20on%20int%20is%20well-defined/near/202248742" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Multiplication.20on.20int.20is.20well-defined.html#202248742">(Jun 28 2020 at 18:36)</a>:</h4>
<p><span class="user-mention" data-user-id="110064">@Kenny Lau</span> , <span class="user-mention" data-user-id="110596">@Rob Lewis</span> has been working on this for weeks.</p>



<a name="202248972"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Multiplication%20on%20int%20is%20well-defined/near/202248972" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Karl Palmskog <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Multiplication.20on.20int.20is.20well-defined.html#202248972">(Jun 28 2020 at 18:43)</a>:</h4>
<p><code>lia</code> transforms goals with <code>nat</code>, <code>Z</code>, etc., to an abstract internal representation. The Coq <code>zify</code> tactic is modular and allows one to inject types that map into <code>Z</code>/<code>nat</code> using type classes, which allows <code>lia</code> to solve goals on them. For example, this has been done for MathComp's <code>nat</code>/<code>int</code>, which are subtly different from those in the Coq stdlib: <a href="https://github.com/pi8027/mczify">https://github.com/pi8027/mczify</a></p>



<a name="202249069"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Multiplication%20on%20int%20is%20well-defined/near/202249069" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Karl Palmskog <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Multiplication.20on.20int.20is.20well-defined.html#202249069">(Jun 28 2020 at 18:45)</a>:</h4>
<p>for completeness, there is also some other more general automation in Coq for similar more abstract problems: <a href="https://github.com/coq-community/aac-tactics">https://github.com/coq-community/aac-tactics</a> <a href="https://github.com/math-comp/math-comp/blob/master/mathcomp/ssreflect/ssrAC.v">https://github.com/math-comp/math-comp/blob/master/mathcomp/ssreflect/ssrAC.v</a> <a href="https://github.com/coq-community/atbr">https://github.com/coq-community/atbr</a> (we also have two flavors of Gröbner bases <a href="https://github.com/coq-community/buchberger">https://github.com/coq-community/buchberger</a> <a href="https://github.com/thery/grobner">https://github.com/thery/grobner</a>)</p>



<a name="202296671"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Multiplication%20on%20int%20is%20well-defined/near/202296671" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Multiplication.20on.20int.20is.20well-defined.html#202296671">(Jun 29 2020 at 11:21)</a>:</h4>
<p>I'm surprised that <code>lia</code> solves this, since it doesn't look linear! <code>omega</code> is the closest Lean equivalent to <code>lia</code>, but it has a bunch of bugs and its implementer doesn't seem interested in fixing them. One of the bugs is relevant here, it doesn't atomize multiplication of variables properly. I don't know if this is in scope for <code>omega</code> even if this bug were fixed, since I don't immediately see the linear problem it should pick up.</p>



<a name="202296776"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Multiplication%20on%20int%20is%20well-defined/near/202296776" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Multiplication.20on.20int.20is.20well-defined.html#202296776">(Jun 29 2020 at 11:22)</a>:</h4>
<p>I'm also surprised by why <code>nlinarith</code> is so slow on this. It's spending over half its time... checking whether variables are defeq, even though it's only unfolding <code>reducible</code> definitions.</p>



<a name="202302824"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Multiplication%20on%20int%20is%20well-defined/near/202302824" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Karl Palmskog <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Multiplication.20on.20int.20is.20well-defined.html#202302824">(Jun 29 2020 at 12:35)</a>:</h4>
<p>for completeness, this was on Coq 8.11.2:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">Require</span> <span class="kn">Import</span> <span class="n">Lia</span><span class="o">.</span>
<span class="kn">Lemma</span> <span class="n">example</span> <span class="o">(</span><span class="n">p</span> <span class="n">q</span> <span class="n">r</span> <span class="n">s</span> <span class="n">t</span> <span class="n">u</span> <span class="n">v</span> <span class="n">w</span> <span class="o">:</span> <span class="n">nat</span><span class="o">)</span> <span class="o">(</span><span class="n">h1</span> <span class="o">:</span> <span class="n">p</span> <span class="o">+</span> <span class="n">u</span> <span class="o">=</span> <span class="n">q</span> <span class="o">+</span> <span class="n">t</span><span class="o">)</span> <span class="o">(</span><span class="n">h2</span> <span class="o">:</span> <span class="n">r</span> <span class="o">+</span> <span class="n">w</span> <span class="o">=</span> <span class="n">s</span> <span class="o">+</span> <span class="n">v</span><span class="o">)</span> <span class="o">:</span>
  <span class="n">p</span> <span class="o">*</span> <span class="n">r</span> <span class="o">+</span> <span class="n">q</span> <span class="o">*</span> <span class="n">s</span> <span class="o">+</span> <span class="o">(</span><span class="n">t</span> <span class="o">*</span> <span class="n">w</span> <span class="o">+</span> <span class="n">u</span> <span class="o">*</span> <span class="n">v</span><span class="o">)</span> <span class="o">=</span> <span class="n">p</span> <span class="o">*</span> <span class="n">s</span> <span class="o">+</span> <span class="n">q</span> <span class="o">*</span> <span class="n">r</span> <span class="o">+</span> <span class="o">(</span><span class="n">t</span> <span class="o">*</span> <span class="n">v</span> <span class="o">+</span> <span class="n">u</span> <span class="o">*</span> <span class="n">w</span><span class="o">).</span>
<span class="kn">Proof</span><span class="o">.</span>
 <span class="n">Time</span> <span class="n">lia</span><span class="o">.</span>
<span class="kn">Qed</span><span class="o">.</span>
</code></pre></div>


<p>Also perhaps of interest that Coq's <code>omega</code> is going to be deprecated in 8.12.0 in favor of <code>lia</code>.</p>



<a name="202303331"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Multiplication%20on%20int%20is%20well-defined/near/202303331" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Multiplication.20on.20int.20is.20well-defined.html#202303331">(Jun 29 2020 at 12:40)</a>:</h4>
<p>Oh, yeah, I'm not saying I don't believe that <code>lia</code> solved it :) I tried it myself. But it means my idea of what <code>lia</code> does must be wrong.</p>



<a name="202311135"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Multiplication%20on%20int%20is%20well-defined/near/202311135" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Karl Palmskog <a href="https://leanprover-community.github.io/archive/stream/116395-maths/topic/Multiplication.20on.20int.20is.20well-defined.html#202311135">(Jun 29 2020 at 13:50)</a>:</h4>
<p><span class="user-mention" data-user-id="110596">@Rob Lewis</span> if you have any questions about the functionality/limitations of <code>lia</code>, you should reach out to <a href="http://people.rennes.inria.fr/Frederic.Besson/">Frédéric Besson</a> via email (his preferred contact method from when I asked). He is the main implementer and from what I can tell drives the effort of improving <code>lia</code>/<code>zify</code>/etc.</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>