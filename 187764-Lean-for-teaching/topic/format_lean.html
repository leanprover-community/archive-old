---
layout: archive
title: Zulip Chat Archive
permalink: /stream/187764-Lean-for-teaching/topic/format_lean.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/187764-Lean-for-teaching/index.html">Lean for teaching</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/187764-Lean-for-teaching/topic/format_lean.html">format_lean</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="163509006"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/187764-Lean%20for%20teaching/topic/format_lean/near/163509006" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/187764-Lean-for-teaching/topic/format_lean.html#163509006">(Apr 16 2019 at 21:31)</a>:</h4>
<p>In <a href="https://github.com/leanprover-community/format_lean" target="_blank" title="https://github.com/leanprover-community/format_lean">format_lean</a> I added the possibility to use tikzcd diagrams, and also include theorems without a Lean counterpart. This is used in <a href="https://www.math.u-psud.fr/~pmassot/enseignement/math114/cours5.html" target="_blank" title="https://www.math.u-psud.fr/~pmassot/enseignement/math114/cours5.html">https://www.math.u-psud.fr/~pmassot/enseignement/math114/cours5.html</a> There is a diagram at the very bottom of the page for instance. Note that this page also feature a proof of existence of <code>quotient.lift</code> by hand for discussion purpose (this is actually the only Lean proof of that page).</p>



<a name="163509112"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/187764-Lean%20for%20teaching/topic/format_lean/near/163509112" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/187764-Lean-for-teaching/topic/format_lean.html#163509112">(Apr 16 2019 at 21:32)</a>:</h4>
<p><span class="user-mention" data-user-id="132175">@Mohammad Pedramfar</span> I had no time to look at your interactive version yet, because I have too much teaching, administration, referee reports, perfectoid spaces etc. But you can PR it in order to avoid drifting too far away from my version.</p>



<a name="264426310"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/187764-Lean%20for%20teaching/topic/format_lean/near/264426310" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kalle Kytölä <a href="https://leanprover-community.github.io/archive/stream/187764-Lean-for-teaching/topic/format_lean.html#264426310">(Dec 10 2021 at 10:15)</a>:</h4>
<p>Hello! I would love to try <a href="https://github.com/leanprover-community/format_lean">format_lean</a>, but I did not get it to cooperate with my Lean. I think I installed as in the instructions, but when running, it is not clear to me what I should set as the parameter <code>--lib-path</code>. If I set it to the directory of my mathlib source by</p>
<div class="codehilite" data-code-language="code"><pre><span></span><code>format_lean --inpath test_001.lean --outdir build --lib-path ~/Lean/msc1541_2021/src
</code></pre></div>
<p>then I get </p>
<div class="codehilite" data-code-language="code"><pre><span></span><code>error: couldn't find value of ELAN_HOME
</code></pre></div>
<p>plus some errors about <code>BrokenPipeError: [Errno 32] Broken pipe</code> (presumably consequences of the original elan problem).</p>
<p>Could <span class="user-mention" data-user-id="110031">@Patrick Massot</span> or someone else with computer skills and/or experience with <code>format_lean</code> help me with how to configure this? Thanks in advance!</p>



<a name="264426362"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/187764-Lean%20for%20teaching/topic/format_lean/near/264426362" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kalle Kytölä <a href="https://leanprover-community.github.io/archive/stream/187764-Lean-for-teaching/topic/format_lean.html#264426362">(Dec 10 2021 at 10:16)</a>:</h4>
<p>To clarify, I believe I have elan somewhere. If I run <code>elan show</code>, it reports </p>
<div class="codehilite" data-code-language="code"><pre><span></span><code>installed toolchains
--------------------

stable (default)
leanprover-community-lean-3.20.0
leanprover-community-lean-3.23.0
leanprover-community-lean-3.24.0
leanprover-community-lean-3.26.0
leanprover-community-lean-3.28.0
leanprover-community-lean-3.30.0
leanprover-community-lean-3.31.0
leanprover-community-lean-3.32.1
leanprover-community-lean-3.33.0
leanprover-community-lean-3.34.0
leanprover-community-lean-3.35.0
leanprover-community-lean-3.35.1

active toolchain
----------------

leanprover-community-lean-3.35.1 (overridden by '/u/01/kytolak1/unix/Lean/msc1541_2021/leanpkg.toml')
Lean (version 3.35.1, commit 4887d8a30621, Release)
</code></pre></div>



<a name="264426423"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/187764-Lean%20for%20teaching/topic/format_lean/near/264426423" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kalle Kytölä <a href="https://leanprover-community.github.io/archive/stream/187764-Lean-for-teaching/topic/format_lean.html#264426423">(Dec 10 2021 at 10:16)</a>:</h4>
<p>And still for the teaching context (or <a href="https://en.wikipedia.org/wiki/XY_problem">#xy</a>): I would like to use Lean in my upcoming 2nd year metric spaces course to help students understand proofs better. Mainly I would like to concretely convey the idea that each step of a proof changes what is considered established and/or what still remains to be proven. For this I think it would be great to be able to "explore" proofs with Lean tactic state shown after each step. I believe this is exactly what Patrick's <code>format_lean</code> would achieve (if I got it to work).</p>
<p>(Of course I dream of using Lean for teaching proofs in more ways than just that. Such hopes were in fact how I got into formalization in the first place. But I have noted warnings about difficulties of doing so from Kevin and Patrick and others, so in the next course I am teaching I would only try "exploration" and possibly a few optional exercises.)</p>



<a name="267752315"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/187764-Lean%20for%20teaching/topic/format_lean/near/267752315" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jireh Loreaux <a href="https://leanprover-community.github.io/archive/stream/187764-Lean-for-teaching/topic/format_lean.html#267752315">(Jan 12 2022 at 16:53)</a>:</h4>
<p><span class="user-mention" data-user-id="110031">@Patrick Massot</span> I had played with <code>format_lean</code> briefly a while ago and thought I had it working, but I have since encountered a problem. Whenever I try to add a comment line in a tactic proof I get an error without a build. Moreover, even without comments, the proofs don't display any lines between "Proof" and "QED". I'm running Arch (hence Python 3.12), so I tried setting up the virtual environment with Python 3.7.2 but still had the same symptoms.</p>



<a name="267752492"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/187764-Lean%20for%20teaching/topic/format_lean/near/267752492" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/187764-Lean-for-teaching/topic/format_lean.html#267752492">(Jan 12 2022 at 16:54)</a>:</h4>
<p>I would need to see a minimal project with this issue</p>



<a name="267752561"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/187764-Lean%20for%20teaching/topic/format_lean/near/267752561" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jireh Loreaux <a href="https://leanprover-community.github.io/archive/stream/187764-Lean-for-teaching/topic/format_lean.html#267752561">(Jan 12 2022 at 16:55)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="c1">-- MWE</span>
<span class="kn">namespace</span> <span class="n">hidden</span>

<span class="kd">inductive</span> <span class="n">nat</span> <span class="o">:</span> <span class="kt">Type</span>
<span class="bp">|</span> <span class="n">zero</span> <span class="o">:</span> <span class="n">nat</span>
<span class="bp">|</span> <span class="n">succ</span> <span class="o">:</span> <span class="n">nat</span> <span class="bp">→</span> <span class="n">nat</span>

<span class="kn">local</span> <span class="kd">notation</span> <span class="bp">`</span><span class="n">ℕ</span><span class="bp">`</span> <span class="o">:=</span> <span class="n">nat</span>

<span class="kd">instance</span> <span class="o">:</span> <span class="n">has_zero</span> <span class="n">ℕ</span> <span class="o">:=</span> <span class="o">⟨</span><span class="n">nat.zero</span><span class="o">⟩</span>

<span class="c">/-</span><span class="cm"> Lemma</span>
<span class="cm">This works, but of course it's a term mode proof, so there is no tactic state.</span>
<span class="cm">-/</span>
<span class="kd">@[simp]</span> <span class="kd">lemma</span> <span class="n">nat_zero_eq_zero</span> <span class="o">:</span> <span class="n">nat.zero</span> <span class="bp">=</span> <span class="mi">0</span> <span class="o">:=</span> <span class="n">rfl</span>

<span class="c">/-</span><span class="cm"> Definition</span>
<span class="cm">Addition of natural numbers, defined recursively, this also works</span>
<span class="cm">-/</span>
<span class="kd">def</span> <span class="n">add</span> <span class="o">:</span> <span class="n">ℕ</span> <span class="bp">→</span> <span class="n">ℕ</span> <span class="bp">→</span> <span class="n">ℕ</span>
<span class="bp">|</span> <span class="n">m</span> <span class="mi">0</span> <span class="o">:=</span> <span class="n">m</span>
<span class="bp">|</span> <span class="n">m</span> <span class="o">(</span><span class="n">nat.succ</span> <span class="n">n</span><span class="o">)</span> <span class="o">:=</span> <span class="n">nat.succ</span> <span class="o">(</span><span class="n">add</span> <span class="n">m</span> <span class="n">n</span><span class="o">)</span>

<span class="kd">instance</span> <span class="o">:</span> <span class="n">has_add</span> <span class="n">ℕ</span> <span class="o">:=</span> <span class="o">⟨</span><span class="n">add</span><span class="o">⟩</span>
<span class="c">/-</span><span class="cm"> Lemma</span>
<span class="cm">A lemma which is true by definition, in tactic mode (no lines or tactic state displayed).</span>
<span class="cm">-/</span>
<span class="kd">@[simp]</span> <span class="kd">lemma</span> <span class="n">add_zero</span> <span class="o">(</span><span class="n">m</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="o">:</span> <span class="n">m</span> <span class="bp">+</span> <span class="mi">0</span> <span class="bp">=</span> <span class="n">m</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="c1">-- comment breaks compilation</span>
  <span class="n">refl</span><span class="o">,</span>
<span class="kd">end</span>

<span class="kd">end</span> <span class="n">hidden</span>
</code></pre></div>



<a name="267752653"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/187764-Lean%20for%20teaching/topic/format_lean/near/267752653" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jireh Loreaux <a href="https://leanprover-community.github.io/archive/stream/187764-Lean-for-teaching/topic/format_lean.html#267752653">(Jan 12 2022 at 16:55)</a>:</h4>
<p>sorry, I can probably make it smaller, let me try and check</p>



<a name="267752983"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/187764-Lean%20for%20teaching/topic/format_lean/near/267752983" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jireh Loreaux <a href="https://leanprover-community.github.io/archive/stream/187764-Lean-for-teaching/topic/format_lean.html#267752983">(Jan 12 2022 at 16:58)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="c">/-</span><span class="cm"> Lemma</span>
<span class="cm">this should not break</span>
<span class="cm">-/</span>
<span class="kd">lemma</span> <span class="n">add_zero</span> <span class="o">(</span><span class="n">m</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="o">:</span> <span class="n">m</span> <span class="bp">+</span> <span class="mi">0</span> <span class="bp">=</span> <span class="n">m</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="c1">-- comment breaks compilation, removing it allows compilation to succeed.</span>
  <span class="n">refl</span><span class="o">,</span>
<span class="kd">end</span>
</code></pre></div>



<a name="267753274"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/187764-Lean%20for%20teaching/topic/format_lean/near/267753274" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jireh Loreaux <a href="https://leanprover-community.github.io/archive/stream/187764-Lean-for-teaching/topic/format_lean.html#267753274">(Jan 12 2022 at 16:59)</a>:</h4>
<p>This is the output to <code>stderr</code> inside the python venv with version 3.7.2</p>
<div class="codehilite" data-code-language="Bash"><pre><span></span><code>$ format_lean --inpath mwe.lean --outdir build2
Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
  File <span class="s2">"/home/jireh/.virtualenvs/format_lean/bin/format_lean"</span>, line <span class="m">77</span>, <span class="k">in</span> &lt;module&gt;
    Fire<span class="o">(</span>render_lean_file<span class="o">)</span>
  File <span class="s2">"/home/jireh/.virtualenvs/format_lean/lib/python3.7/site-packages/fire/core.py"</span>, line <span class="m">141</span>, <span class="k">in</span> Fire
    <span class="nv">component_trace</span> <span class="o">=</span> _Fire<span class="o">(</span>component, args, parsed_flag_args, context, name<span class="o">)</span>
  File <span class="s2">"/home/jireh/.virtualenvs/format_lean/lib/python3.7/site-packages/fire/core.py"</span>, line <span class="m">471</span>, <span class="k">in</span> _Fire
    <span class="nv">target</span><span class="o">=</span>component.__name__<span class="o">)</span>
  File <span class="s2">"/home/jireh/.virtualenvs/format_lean/lib/python3.7/site-packages/fire/core.py"</span>, line <span class="m">681</span>, <span class="k">in</span> _CallAndUpdateTrace
    <span class="nv">component</span> <span class="o">=</span> fn<span class="o">(</span>*varargs, **kwargs<span class="o">)</span>
  File <span class="s2">"/home/jireh/.virtualenvs/format_lean/bin/format_lean"</span>, line <span class="m">68</span>, <span class="k">in</span> render_lean_file
    lecture_reader.read_file<span class="o">(</span>inpath<span class="o">)</span>
  File <span class="s2">"/home/jireh/.virtualenvs/format_lean/lib/python3.7/site-packages/format_lean/line_reader.py"</span>, line <span class="m">49</span>, <span class="k">in</span> read_file
    self.normal_line_handler<span class="o">(</span>self, line<span class="o">)</span>
  File <span class="s2">"/home/jireh/.virtualenvs/format_lean/lib/python3.7/site-packages/format_lean/objects.py"</span>, line <span class="m">377</span>, <span class="k">in</span> normal_line
    file_reader.cur_line_nb, <span class="m">1</span><span class="o">)</span>
  File <span class="s2">"/home/jireh/.virtualenvs/format_lean/lib/python3.7/site-packages/format_lean/server.py"</span>, line <span class="m">34</span>, <span class="k">in</span> info
    raise LeanError<span class="o">(</span>ret<span class="o">)</span>
format_lean.server.LeanError: <span class="o">{</span><span class="s1">'msgs'</span>: <span class="o">[{</span><span class="s1">'caption'</span>: <span class="s1">''</span>, <span class="s1">'file_name'</span>: <span class="s1">'/home/jireh/.elan/toolchains/leanprover-community-lean-3.16.5/lib/lean/library/init/data/option/basic.lean'</span>, <span class="s1">'pos_col'</span>: <span class="m">41</span>, <span class="s1">'pos_line'</span>: <span class="m">30</span>, <span class="s1">'severity'</span>: <span class="s1">'error'</span>, <span class="s1">'text'</span>: <span class="s1">'type expected at\n  o.is_some\nterm has type\n  bool'</span><span class="o">}</span>, <span class="o">{</span><span class="s1">'caption'</span>: <span class="s1">''</span>, <span class="s1">'file_name'</span>: <span class="s1">'/home/jireh/.elan/toolchains/leanprover-community-lean-3.16.5/lib/lean/library/init/data/option/basic.lean'</span>, <span class="s1">'pos_col'</span>: <span class="m">41</span>, <span class="s1">'pos_line'</span>: <span class="m">30</span>, <span class="s1">'severity'</span>: <span class="s1">'error'</span>, <span class="s1">'text'</span>: <span class="s1">'type expected at\n  o.is_some\nterm has type\n  bool'</span><span class="o">}]</span>, <span class="s1">'response'</span>: <span class="s1">'all_messages'</span><span class="o">}</span>
</code></pre></div>



<a name="267753761"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/187764-Lean%20for%20teaching/topic/format_lean/near/267753761" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jireh Loreaux <a href="https://leanprover-community.github.io/archive/stream/187764-Lean-for-teaching/topic/format_lean.html#267753761">(Jan 12 2022 at 17:02)</a>:</h4>
<p>ooh, sorry, I think I may have figured out the problem. I had switched to an old version of Lean (3.16.5) trying to solve this problem outside my venv (I think Python 3.12 may be incompatible with <code>format_lean</code>, but I'm not sure). After switching back to 3.35.1 it seems to work. Sorry for the inconvenience.</p>



<a name="267760848"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/187764-Lean%20for%20teaching/topic/format_lean/near/267760848" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jireh Loreaux <a href="https://leanprover-community.github.io/archive/stream/187764-Lean-for-teaching/topic/format_lean.html#267760848">(Jan 12 2022 at 17:51)</a>:</h4>
<p><span class="user-mention" data-user-id="110031">@Patrick Massot</span> Just to follow up: I figured out all my problems. I had a <code>sorry</code> in my original file and I didn't realize <code>format_lean</code> would balk at that (it's fine, I just didn't know). In my troubleshooting I (stupidly) didn't try to create an MWE first, and then I went down a rabbit hole, changed my Lean version, and then I had <em>two</em> problems  <span aria-label="face palm" class="emoji emoji-1f926" role="img" title="face palm">:face_palm:</span>. But it's all fixed now, and there are no issues with the current version of Python (3.10.1, I misspoke above), except for a deprecation warning about <code>distutils</code> slated for removal in Python 3.12.</p>



<a name="267761079"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/187764-Lean%20for%20teaching/topic/format_lean/near/267761079" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/187764-Lean-for-teaching/topic/format_lean.html#267761079">(Jan 12 2022 at 17:52)</a>:</h4>
<p>Feel free to open a PR about this sorry issue if you want it and have time.</p>



<a name="267761288"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/187764-Lean%20for%20teaching/topic/format_lean/near/267761288" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/187764-Lean-for-teaching/topic/format_lean.html#267761288">(Jan 12 2022 at 17:54)</a>:</h4>
<p>I can't   spend any time to add features to this tool. I have too much to do and this tool will be completely obsolete with Lean4</p>



<a name="267761584"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/187764-Lean%20for%20teaching/topic/format_lean/near/267761584" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jireh Loreaux <a href="https://leanprover-community.github.io/archive/stream/187764-Lean-for-teaching/topic/format_lean.html#267761584">(Jan 12 2022 at 17:56)</a>:</h4>
<p>No I completely understand, it's not important to me. Thanks though.</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>