---
layout: archive
title: Zulip Chat Archive
permalink: /stream/187764-Lean-for-teaching/topic/Literate.20Lean.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/187764-Lean-for-teaching/index.html">Lean for teaching</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/187764-Lean-for-teaching/topic/Literate.20Lean.html">Literate Lean</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="287503162"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/187764-Lean%20for%20teaching/topic/Literate%20Lean/near/287503162" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Philip Wadler <a href="https://leanprover-community.github.io/archive/stream/187764-Lean-for-teaching/topic/Literate.20Lean.html#287503162">(Jun 26 2022 at 17:07)</a>:</h4>
<p>Apologies if this is a newbie question, but I am a Lean newbie.</p>
<p>I've written an online textbook, Programming Language Foundation in Agda (<a href="http://plfa.inf.ed.ac.uk">plfa.inf.ed.ac.uk</a>), and am considering adapting it to Lean. In the textbook, each chapter is a separate markdown file containing literate Agda. The beginning of the chapter needs to import relevant bits of the standard library, but then everything subsequent in the chapter can make use of any definitions, lemmas, and so on from earlier in the chapter. Let's call this "literate" style. (It descends from Donald Knuth's Literate Programming, via the literate style for Haskell introduced by Richard Bird.)</p>
<p>In contrast, in Theorem Proving in Lean (<a href="https://leanprover.github.io/theorem_proving_in_lean/">https://leanprover.github.io/theorem_proving_in_lean/</a>), each code snippet is independent. Every example needs to import anything relevant from mathlib or from earlier in the chapter. There is support for hiding lines that import from mathlib or copy earlier developments in order to make the text more readable. Let's call this "snippet" style.</p>
<p>My question is, do there exist tools for Lean that support the "literate" style as opposed to the "snippet" style? I couldn't find any with an hour or so of search. Thank you for your help!</p>



<a name="287503666"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/187764-Lean%20for%20teaching/topic/Literate%20Lean/near/287503666" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Henrik Böving <a href="https://leanprover-community.github.io/archive/stream/187764-Lean-for-teaching/topic/Literate.20Lean.html#287503666">(Jun 26 2022 at 17:16)</a>:</h4>
<p>This is not available in Lean 3 right now but in Lean 4 we have LeanInk (<a href="https://github.com/leanprover/LeanInk/">https://github.com/leanprover/LeanInk/</a>) which is a lean frontend to the well known coq alectryon (<a href="https://github.com/cpitclaudel/alectryon">https://github.com/cpitclaudel/alectryon</a>) and is as of this week integrate into the lean 4 docuemtnation tool doc-gen4 (<a href="https://leanprover-community.github.io/mathlib4_docs/Mathlib/Algebra/Group/Defs.html">https://leanprover-community.github.io/mathlib4_docs/Mathlib/Algebra/Group/Defs.html</a>, you can click on the <code>ink</code> button in any <code>Mathlib</code> submodule to see the doc-gen rendered version of the LeanInk output). This isn't nearly as advanced as the alectryon renderer right now but I do plan to push it to the point where we can basically write our books/tutorials whatever with it in this interactive style you are searching for, though this will definitely take some time.</p>



<a name="287503805"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/187764-Lean%20for%20teaching/topic/Literate%20Lean/near/287503805" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/187764-Lean-for-teaching/topic/Literate.20Lean.html#287503805">(Jun 26 2022 at 17:19)</a>:</h4>
<p>This should be compatible with Lean 3:<br>
<a href="https://github.com/arthurpaulino/lean2md">https://github.com/arthurpaulino/lean2md</a><br>
Edit: nvm, you need to go the other way around (md to lean, not lean to md)</p>



<a name="287512511"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/187764-Lean%20for%20teaching/topic/Literate%20Lean/near/287512511" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/187764-Lean-for-teaching/topic/Literate.20Lean.html#287512511">(Jun 26 2022 at 20:30)</a>:</h4>
<p>The setup in <a href="https://leanprover-community.github.io/mathematics_in_lean/">Mathematics in Lean</a> is closer to what you want. See <a href="https://github.com/avigad/mathematics_in_lean_source">https://github.com/avigad/mathematics_in_lean_source</a>. The actual source is a bunch of Lean files containing restructured text markup, for instance <a href="https://github.com/avigad/mathematics_in_lean_source/blob/master/lean_source/07_Topology/source_01_Filters.lean">https://github.com/avigad/mathematics_in_lean_source/blob/master/lean_source/07_Topology/source_01_Filters.lean</a>. The point of using a Lean file is that you can get feedback from Lean while writing. It could be adapted easily to use md instead of rst (Jeremy was used to restructured text instead of markdown).</p>



<a name="287512531"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/187764-Lean%20for%20teaching/topic/Literate%20Lean/near/287512531" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/187764-Lean-for-teaching/topic/Literate.20Lean.html#287512531">(Jun 26 2022 at 20:31)</a>:</h4>
<p>However this is still a hack. We are refraining to seriously work on such tools until we really switch to Lean 4.</p>



<a name="287723721"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/187764-Lean%20for%20teaching/topic/Literate%20Lean/near/287723721" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jeremy Avigad <a href="https://leanprover-community.github.io/archive/stream/187764-Lean-for-teaching/topic/Literate.20Lean.html#287723721">(Jun 28 2022 at 14:28)</a>:</h4>
<blockquote>
<p>Jeremy was used to restructured text instead of markdown</p>
</blockquote>
<p>I am actually o.k. with both. Restructured text has some advantages over markdown, like better mechanisms for including links, references, figures, and math formulas. (Google will provide various comparisons.)</p>
<p>The Python scripts used to generated the files for MIL are pretty rudimentary. I wrote them in a rush, so there is definitely room for improvement. But they work really well, and it is extremely helpful to write the text and the Lean in the same file. For years I would write the text in one file and the Lean examples in another and then cut and paste. This is much better. It also made it easier to generate files containing solutions to the exercises -- i.e. you write the exercise and the solutions in the same Lean file, and some simple markup indicates which is which.</p>
<p>We have also talked about connecting this with Alectryon / Lean Ink so that readers can step through proofs by hovering over the text in the browser.</p>



<a name="287729318"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/187764-Lean%20for%20teaching/topic/Literate%20Lean/near/287729318" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/187764-Lean-for-teaching/topic/Literate.20Lean.html#287729318">(Jun 28 2022 at 15:07)</a>:</h4>
<p>Another advantage of restructured text is that it has extensibility built in in a standardized way (custom <code>:role:</code>s and <code>.. admonition::</code>s). As far as I can tell, the main downside is that in practice it's more of a standard implementation than a specification, which means we have to have python in the system somewhere and can't really put the whole thing in lean itself.</p>



<a name="287732013"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/187764-Lean%20for%20teaching/topic/Literate%20Lean/near/287732013" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Henrik Böving <a href="https://leanprover-community.github.io/archive/stream/187764-Lean-for-teaching/topic/Literate.20Lean.html#287732013">(Jun 28 2022 at 15:25)</a>:</h4>
<p>After my exams in july i was planning on porting the CMark renderer we use for markdown in doc-gen right now to pure Lean so we can also reuse it nicely in the LeanInk rendering. Is there a clear preference here? I'll be happy to implement either of them but not both at the same time, at least not while the rest isn't fleshed out.</p>



<a name="287744462"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/187764-Lean%20for%20teaching/topic/Literate%20Lean/near/287744462" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/187764-Lean-for-teaching/topic/Literate.20Lean.html#287744462">(Jun 28 2022 at 16:49)</a>:</h4>
<p>CMark is what doc-gen4 uses? doc-gen3 uses mistletoe, but I was planning to port it to markdown-it once an upstream math-formatting patch is merged</p>



<a name="287744516"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/187764-Lean%20for%20teaching/topic/Literate%20Lean/near/287744516" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/187764-Lean-for-teaching/topic/Literate.20Lean.html#287744516">(Jun 28 2022 at 16:49)</a>:</h4>
<p>(I think markdown-it is what vscode uses internally)</p>



<a name="287744633"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/187764-Lean%20for%20teaching/topic/Literate%20Lean/near/287744633" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Henrik Böving <a href="https://leanprover-community.github.io/archive/stream/187764-Lean-for-teaching/topic/Literate.20Lean.html#287744633">(Jun 28 2022 at 16:50)</a>:</h4>
<p>Yeah we use cmark to avoid any other language dependencies, CMark is a C lib and since you already necessarily have a c compiler when you compile Lean 4 that's just natural, the move away from mistletoe was intentional.</p>



<a name="287744730"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/187764-Lean%20for%20teaching/topic/Literate%20Lean/near/287744730" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/187764-Lean-for-teaching/topic/Literate.20Lean.html#287744730">(Jun 28 2022 at 16:51)</a>:</h4>
<p>CMark doesn't support math, right? (edit: <a href="https://github.com/commonmark/cmark/issues/439">https://github.com/commonmark/cmark/issues/439</a>)</p>



<a name="287745093"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/187764-Lean%20for%20teaching/topic/Literate%20Lean/near/287745093" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Henrik Böving <a href="https://leanprover-community.github.io/archive/stream/187764-Lean-for-teaching/topic/Literate.20Lean.html#287745093">(Jun 28 2022 at 16:54)</a>:</h4>
<p>Not to my knowledge no, but that (among getting rid of the dpendency on pure C as well :D) is one of the reasons I want to look into writing a renderer in pure Lean 4. So naturally the question comes up whether it should be a markdown or RST one. But given that we probably want to render math it looks like RST is going to win huh?</p>



<a name="287745316"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/187764-Lean%20for%20teaching/topic/Literate%20Lean/near/287745316" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/187764-Lean-for-teaching/topic/Literate.20Lean.html#287745316">(Jun 28 2022 at 16:56)</a>:</h4>
<p>In principle you could probably compile markdown-it (javascript) to a C interface via Emscripten, then call that from Lean?</p>



<a name="287745589"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/187764-Lean%20for%20teaching/topic/Literate%20Lean/near/287745589" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Henrik Böving <a href="https://leanprover-community.github.io/archive/stream/187764-Lean-for-teaching/topic/Literate.20Lean.html#287745589">(Jun 28 2022 at 16:58)</a>:</h4>
<p>I guess that might be possible yeah, though I dont really see the advantage over CMark at that point?</p>



<a name="287745711"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/187764-Lean%20for%20teaching/topic/Literate%20Lean/near/287745711" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/187764-Lean-for-teaching/topic/Literate.20Lean.html#287745711">(Jun 28 2022 at 16:59)</a>:</h4>
<p>The fact that you get math support (via an extension), without having to write everything from scratch</p>



<a name="304092139"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/187764-Lean%20for%20teaching/topic/Literate%20Lean/near/304092139" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Chris Lovett <a href="https://leanprover-community.github.io/archive/stream/187764-Lean-for-teaching/topic/Literate.20Lean.html#304092139">(Oct 14 2022 at 18:23)</a>:</h4>
<p>Getting back to Phillips original question, yes it is possible now that we have LeanInk and alectryon and mdbook working together :-) I believe the following example is following the <code>Literate Style</code> of writing a book.  This <a href="https://github.com/leanprover/lean4-samples/tree/main/NaturalNumbers">Natural Numbers Tutorial</a> (derived from the famous Natural Number Game) is written in Lean then uses LeanInk to create markdown then it uses <code>mdbook</code> to generate nice HTML with a TOC on the left, the TOC comes from SUMMARY.md.  The result looks like this <a href="https://lovettsoftware.com/NaturalNumbers/">https://lovettsoftware.com/NaturalNumbers/</a>.  Each code block in each .lean file can build on previous code blocks and each file can also import previous sections to build on those and so on.  Notice the mdbook is enabling mathjax so you can even do inline latex formulas if you want like you see in <a href="https://lovettsoftware.com/NaturalNumbers/FunctionWorld/Level5.lean.html">Function World Level5</a> with the expressions <code>\\(10^{10^{10}}\\)</code> which is rendered like this:<br>
<a href="/user_uploads/3121/7-PMCuzbkFYOMhBpaAF6ZQpJ/image.png">image.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/3121/7-PMCuzbkFYOMhBpaAF6ZQpJ/image.png" title="image.png"><img src="/user_uploads/3121/7-PMCuzbkFYOMhBpaAF6ZQpJ/image.png"></a></div>



<a name="304094924"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/187764-Lean%20for%20teaching/topic/Literate%20Lean/near/304094924" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/187764-Lean-for-teaching/topic/Literate.20Lean.html#304094924">(Oct 14 2022 at 18:40)</a>:</h4>
<p>Really nice!<br>
I noticed the github links in the top right go to the wrong url though: <a href="https://github.com/leanprover/lean4-samples/NaturalNumbers">https://github.com/leanprover/lean4-samples/NaturalNumbers</a> rather than <a href="https://github.com/leanprover/lean4-samples/tree/main/NaturalNumbers">https://github.com/leanprover/lean4-samples/tree/main/NaturalNumbers</a></p>



<a name="304096645"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/187764-Lean%20for%20teaching/topic/Literate%20Lean/near/304096645" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/187764-Lean-for-teaching/topic/Literate.20Lean.html#304096645">(Oct 14 2022 at 18:52)</a>:</h4>
<p><span class="user-mention" data-user-id="434989">@Chris Lovett</span> Nice work!  For my own applications (typical example: <a href="https://hrmacbeth.github.io/computations_in_lean/03_Nonsingularity_of_Curves.html">html</a> and the code it's built on <a href="https://github.com/hrmacbeth/computations_in_lean/blob/main/src/03_Nonsingularity_of_Curves/01_powers_case_splits.lean">1</a> <a href="https://github.com/hrmacbeth/computations_in_lean/blob/main/src/03_Nonsingularity_of_Curves/02_projective_curves.lean">2</a>) I would like to show only snippets of the full source code, with other parts hidden.  For example, no need to show the reader this:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="c">/-</span><span class="cm"></span>
<span class="cm">Copyright (c) 2022 Heather Macbeth. All rights reserved.</span>
<span class="cm">Authors: Heather Macbeth</span>
<span class="cm">-/</span>
<span class="kn">import</span> <span class="n">data.mv_polynomial.pderiv</span>
<span class="kn">import</span> <span class="n">data.mv_polynomial.comm_ring</span>
<span class="kn">import</span> <span class="n">tactic.polyrith</span>
<span class="kn">import</span> <span class="n">tactic.norm_fin</span>

<span class="kd">noncomputable theory</span>

<span class="kn">open</span> <span class="n">mv_polynomial</span>

<span class="kd">variables</span> <span class="o">(</span><span class="n">K</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">[</span><span class="n">field</span> <span class="n">K</span><span class="o">]</span> <span class="o">[</span><span class="n">char_zero</span> <span class="n">K</span><span class="o">]</span>

<span class="c">/-</span><span class="cm">! This file contains a lot of computationally-intensive evaluation of polynomials and their</span>
<span class="cm">derivatives. We speed it up slightly by specifiying in advance the path the simplifier should take.</span>
<span class="cm">-/</span>

<span class="n">mk_simp_attribute</span> <span class="n">poly_simps</span> <span class="s2">"simp-lemmas for polynomials"</span>

<span class="kn">attribute</span> <span class="o">[</span><span class="n">poly_simps</span><span class="o">]</span> <span class="n">mv_polynomial.eval_X</span> <span class="n">mv_polynomial.eval_C</span>
  <span class="n">map_add</span> <span class="n">map_sub</span> <span class="n">map_mul</span> <span class="n">map_neg</span> <span class="n">map_bit0</span> <span class="n">map_bit1</span> <span class="n">map_one</span> <span class="n">map_pow</span> <span class="n">map_zero</span>
  <span class="n">matrix.cons_val_zero</span> <span class="n">matrix.cons_val_one</span> <span class="n">matrix.head_cons</span>
  <span class="n">matrix.cons_vec_bit0_eq_alt0</span> <span class="n">matrix.cons_vec_bit1_eq_alt1</span>
  <span class="n">matrix.cons_vec_alt0</span> <span class="n">matrix.cons_vec_alt1</span>
  <span class="n">matrix.cons_append</span> <span class="n">matrix.empty_append</span>
  <span class="n">derivation.leibniz</span> <span class="n">derivation.leibniz_pow</span> <span class="n">pderiv_C</span> <span class="n">pderiv_X_of_ne</span> <span class="n">pderiv_X_self</span> <span class="n">pi.single_eq_of_ne</span>
  <span class="n">algebra.id.smul_eq_mul</span> <span class="n">nsmul_eq_mul</span>
  <span class="n">nat.cast_bit1</span> <span class="n">nat.cast_bit0</span> <span class="n">nat.cast_one</span>
  <span class="c1">-- `ring`/`linear_combination` would take care of the next ones, but we add them to aid human</span>
  <span class="c1">-- inspection</span>
  <span class="n">mul_zero</span> <span class="n">zero_mul</span> <span class="n">mul_one</span> <span class="n">one_mul</span> <span class="n">add_zero</span> <span class="n">zero_add</span> <span class="n">pow_one</span> <span class="n">mul_neg</span> <span class="n">neg_zero</span>
</code></pre></div>



<a name="304096666"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/187764-Lean%20for%20teaching/topic/Literate%20Lean/near/304096666" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/187764-Lean-for-teaching/topic/Literate.20Lean.html#304096666">(Oct 14 2022 at 18:52)</a>:</h4>
<p>Is this possible?</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>