---
layout: archive
title: Zulip Chat Archive
permalink: /stream/217875-Is-there-code-for-X%3F/topic/List.20lemmas.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/index.html">Is there code for X?</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/List.20lemmas.html">List lemmas</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="197045919"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/List%20lemmas/near/197045919" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Chris Wong <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/List.20lemmas.html#197045919">(May 10 2020 at 10:05)</a>:</h4>
<p>Do we have either of these in mathlib?</p>
<div class="codehilite"><pre><span></span><code><span class="kn">lemma</span> <span class="n">singleton_append</span> <span class="o">{</span><span class="n">α</span><span class="o">}</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="n">α</span><span class="o">)</span> <span class="o">(</span><span class="n">l</span> <span class="o">:</span> <span class="n">list</span> <span class="n">α</span><span class="o">)</span> <span class="o">:</span> <span class="o">[</span><span class="n">x</span><span class="o">]</span> <span class="bp">++</span> <span class="n">l</span> <span class="bp">=</span> <span class="n">x</span> <span class="bp">::</span> <span class="n">l</span> <span class="o">:=</span>
<span class="k">by</span> <span class="n">rw</span> <span class="o">[</span><span class="n">list</span><span class="bp">.</span><span class="n">cons_append</span><span class="o">,</span> <span class="n">list</span><span class="bp">.</span><span class="n">nil_append</span><span class="o">]</span>

<span class="kn">lemma</span> <span class="n">bind_singleton</span> <span class="o">{</span><span class="n">α</span> <span class="n">β</span><span class="o">}</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="n">α</span><span class="o">)</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">α</span> <span class="bp">→</span> <span class="n">list</span> <span class="n">β</span><span class="o">)</span> <span class="o">:</span> <span class="n">list</span><span class="bp">.</span><span class="n">bind</span> <span class="o">[</span><span class="n">x</span><span class="o">]</span> <span class="n">f</span> <span class="bp">=</span> <span class="n">f</span> <span class="n">x</span> <span class="o">:=</span>
<span class="k">by</span> <span class="n">rw</span> <span class="o">[</span><span class="n">list</span><span class="bp">.</span><span class="n">cons_bind</span><span class="o">,</span> <span class="n">list</span><span class="bp">.</span><span class="n">nil_bind</span><span class="o">,</span> <span class="n">list</span><span class="bp">.</span><span class="n">append_nil</span><span class="o">]</span>
</code></pre></div>


<p>I did find the latter in terms of monads, but it would still be nice to have a version specialized to lists.</p>



<a name="197048927"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/List%20lemmas/near/197048927" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Shing Tak Lam <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/List.20lemmas.html#197048927">(May 10 2020 at 11:13)</a>:</h4>
<p><code>library_search</code> is helpful here and finds solution to both.</p>
<div class="codehilite"><pre><span></span><code><span class="kn">lemma</span> <span class="n">singleton_append</span> <span class="o">{</span><span class="n">α</span><span class="o">}</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="n">α</span><span class="o">)</span> <span class="o">(</span><span class="n">l</span> <span class="o">:</span> <span class="n">list</span> <span class="n">α</span><span class="o">)</span> <span class="o">:</span> <span class="o">[</span><span class="n">x</span><span class="o">]</span> <span class="bp">++</span> <span class="n">l</span> <span class="bp">=</span> <span class="n">x</span> <span class="bp">::</span> <span class="n">l</span> <span class="o">:=</span>
<span class="n">rfl</span>

<span class="kn">lemma</span> <span class="n">bind_singleton</span> <span class="o">{</span><span class="n">α</span> <span class="n">β</span><span class="o">}</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="n">α</span><span class="o">)</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">α</span> <span class="bp">→</span> <span class="n">list</span> <span class="n">β</span><span class="o">)</span> <span class="o">:</span> <span class="n">list</span><span class="bp">.</span><span class="n">bind</span> <span class="o">[</span><span class="n">x</span><span class="o">]</span> <span class="n">f</span> <span class="bp">=</span> <span class="n">f</span> <span class="n">x</span> <span class="o">:=</span>
<span class="n">list</span><span class="bp">.</span><span class="n">append_nil</span> <span class="o">(</span><span class="n">f</span> <span class="n">x</span><span class="o">)</span>
</code></pre></div>



<a name="197053020"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/List%20lemmas/near/197053020" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/List.20lemmas.html#197053020">(May 10 2020 at 12:34)</a>:</h4>
<p>Even if the first is true by <code>rfl</code>, it might not hurt to have the lemma, so that one can rewrite using it.</p>



<a name="197053059"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/List%20lemmas/near/197053059" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/List.20lemmas.html#197053059">(May 10 2020 at 12:35)</a>:</h4>
<p>Similarly the second can still be useful, as the solution found by <code>library_search</code> is unfolding some definitions, and it might be helpful to have the syntactical statement too.</p>



<a name="197053060"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/List%20lemmas/near/197053060" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/List.20lemmas.html#197053060">(May 10 2020 at 12:35)</a>:</h4>
<p>Maybe a <code>reducible</code> setting for <code>library_search</code> would be useful?</p>



<a name="197053106"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/List%20lemmas/near/197053106" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/List.20lemmas.html#197053106">(May 10 2020 at 12:36)</a>:</h4>
<p>Moreover, potentially both of these lemmas could be <code>@[simp]</code> lemmas?</p>



<a name="197053453"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/List%20lemmas/near/197053453" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/List.20lemmas.html#197053453">(May 10 2020 at 12:42)</a>:</h4>
<div class="codehilite"><pre><span></span><code> <span class="n">library_search</span> <span class="o">{</span> <span class="n">apply</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">e</span><span class="o">,</span> <span class="n">tactic</span><span class="bp">.</span><span class="n">apply</span> <span class="n">e</span> <span class="o">{</span> <span class="n">md</span> <span class="o">:=</span> <span class="n">tactic</span><span class="bp">.</span><span class="n">transparency</span><span class="bp">.</span><span class="kn">reducible</span> <span class="o">}</span> <span class="o">}</span>
</code></pre></div>


<p>should do this (i.e. only unfold <code>reducible</code> things), but there is a small bug preventing it from working.</p>



<a name="197053457"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/List%20lemmas/near/197053457" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/List.20lemmas.html#197053457">(May 10 2020 at 12:42)</a>:</h4>
<p>(the custom <code>apply</code> tactic is only used by <code>solve_by_elim</code> discharging subgoals, not for actually applying library lemmas)</p>



<a name="197053534"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/List%20lemmas/near/197053534" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/List.20lemmas.html#197053534">(May 10 2020 at 12:44)</a>:</h4>
<p>I'll fix that bug.</p>



<a name="197053543"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/List%20lemmas/near/197053543" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/List.20lemmas.html#197053543">(May 10 2020 at 12:45)</a>:</h4>
<p><span class="user-mention" data-user-id="110032">@Reid Barton</span>, if you have an idea for a shortcut syntax for the reducibility setting, I can do that.</p>



<a name="197053728"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/List%20lemmas/near/197053728" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/List.20lemmas.html#197053728">(May 10 2020 at 12:50)</a>:</h4>
<p><a href="https://github.com/leanprover-community/mathlib/issues/2648" title="https://github.com/leanprover-community/mathlib/issues/2648">#2648</a></p>



<a name="197053904"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/List%20lemmas/near/197053904" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/List.20lemmas.html#197053904">(May 10 2020 at 12:54)</a>:</h4>
<p>Well, hmm... the best option would be not to have an option, and have library_search try with the <code>reducible</code> setting first. Would this be too slow?</p>



<a name="197092931"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/List%20lemmas/near/197092931" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/List.20lemmas.html#197092931">(May 11 2020 at 02:23)</a>:</h4>
<p>I'll try to do some experiments. I don't know what to expect: pessimistically, it will take twice as long, optimistically, running with <code>md := reducible</code> could be be much faster (and so potentially even faster overall in cases where it finds something in the first pass).</p>



<a name="197257783"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/List%20lemmas/near/197257783" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Chris Wong <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/List.20lemmas.html#197257783">(May 12 2020 at 10:40)</a>:</h4>
<p>What an interesting discussion!</p>
<p>Indeed I was using these for <code>rw</code>. With palindromes, there's a lot of <code>x :: (l ++ [x])</code> constructions that take some effort to manipulate.</p>
<p>I think I'll send a PR then, if at least so they're there next time I reach for them.</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>