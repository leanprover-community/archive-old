---
layout: archive
title: Zulip Chat Archive
permalink: /stream/217875-Is-there-code-for-X%3F/topic/explicit.20sums.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/index.html">Is there code for X?</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/explicit.20sums.html">explicit sums</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="284181801"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/explicit%20sums/near/284181801" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Michael Stoll <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/explicit.20sums.html#284181801">(May 27 2022 at 20:33)</a>:</h4>
<p>Is there a better way of proving the following?</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">tactic</span>
<span class="kn">import</span> <span class="n">data.zmod.basic</span>

<span class="n">open_locale</span> <span class="n">big_operators</span>
<span class="kn">open</span> <span class="n">finset</span>

<span class="kd">example</span> <span class="o">{</span><span class="n">R</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">add_comm_monoid</span> <span class="n">R</span><span class="o">]</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="o">(</span><span class="n">zmod</span> <span class="mi">3</span><span class="o">)</span> <span class="bp">→</span> <span class="n">R</span><span class="o">)</span> <span class="o">:</span> <span class="bp">∑</span> <span class="n">a</span><span class="o">,</span> <span class="n">f</span> <span class="n">a</span> <span class="bp">=</span> <span class="n">f</span> <span class="mi">0</span> <span class="bp">+</span> <span class="n">f</span> <span class="mi">1</span> <span class="bp">+</span> <span class="n">f</span> <span class="mi">2</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="k">have</span> <span class="n">hs</span> <span class="o">:</span> <span class="n">cons</span> <span class="mi">0</span> <span class="o">({</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">}</span> <span class="o">:</span> <span class="n">finset</span> <span class="o">(</span><span class="n">zmod</span> <span class="mi">3</span><span class="o">))</span> <span class="n">dec_trivial</span> <span class="bp">=</span> <span class="n">univ</span> <span class="o">:=</span> <span class="n">dec_trivial</span><span class="o">,</span>
  <span class="k">have</span> <span class="n">hs'</span> <span class="o">:</span> <span class="n">cons</span> <span class="mi">1</span> <span class="o">({</span><span class="mi">2</span><span class="o">}</span> <span class="o">:</span> <span class="n">finset</span> <span class="o">(</span><span class="n">zmod</span> <span class="mi">3</span><span class="o">))</span> <span class="n">dec_trivial</span> <span class="bp">=</span> <span class="o">({</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">}</span> <span class="o">:</span> <span class="n">finset</span> <span class="o">(</span><span class="n">zmod</span> <span class="mi">3</span><span class="o">))</span> <span class="o">:=</span> <span class="n">dec_trivial</span><span class="o">,</span>
  <span class="n">rw</span> <span class="o">[</span><span class="bp">←</span> <span class="n">hs</span><span class="o">,</span> <span class="n">sum_cons</span><span class="o">,</span> <span class="bp">←</span> <span class="n">hs'</span><span class="o">,</span> <span class="n">sum_cons</span><span class="o">,</span> <span class="bp">←</span> <span class="n">add_assoc</span><span class="o">,</span> <span class="n">sum_singleton</span><span class="o">],</span>
<span class="kd">end</span>
</code></pre></div>
<p>(bearing in mind that what I really want is the analogous statement for <code>zmod 8</code>...)</p>



<a name="284181921"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/explicit%20sums/near/284181921" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/explicit.20sums.html#284181921">(May 27 2022 at 20:34)</a>:</h4>
<p><code>norm_num</code> should do this, I think</p>



<a name="284182021"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/explicit%20sums/near/284182021" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/explicit.20sums.html#284182021">(May 27 2022 at 20:35)</a>:</h4>
<p>hmm... seems not. I thought <span class="user-mention" data-user-id="238446">@Anne Baanen</span>  had made a tactic for this recently.</p>



<a name="284182024"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/explicit%20sums/near/284182024" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Michael Stoll <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/explicit.20sums.html#284182024">(May 27 2022 at 20:35)</a>:</h4>
<p><code>norm_num</code> does basically nothing here. Perhaps because <code>norm_num</code> does not work well with <code>zmod</code>?</p>



<a name="284182323"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/explicit%20sums/near/284182323" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/explicit.20sums.html#284182323">(May 27 2022 at 20:39)</a>:</h4>
<p>For <code>fin</code> rather than <code>zmod</code>, you can do</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">example</span> <span class="o">{</span><span class="n">R</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">add_comm_monoid</span> <span class="n">R</span><span class="o">]</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">fin</span> <span class="mi">3</span> <span class="bp">→</span> <span class="n">R</span><span class="o">)</span> <span class="o">:</span> <span class="bp">∑</span> <span class="n">a</span><span class="o">,</span> <span class="n">f</span> <span class="n">a</span> <span class="bp">=</span> <span class="n">f</span> <span class="mi">0</span> <span class="bp">+</span> <span class="o">(</span><span class="n">f</span> <span class="mi">1</span> <span class="bp">+</span> <span class="n">f</span> <span class="mi">2</span><span class="o">)</span> <span class="o">:=</span>
<span class="kd">by</span> <span class="n">simp</span> <span class="o">[</span><span class="n">fin.sum_univ_succ</span><span class="o">]</span>
</code></pre></div>



<a name="284182343"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/explicit%20sums/near/284182343" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/explicit.20sums.html#284182343">(May 27 2022 at 20:39)</a>:</h4>
<p>I figured it out: you need the import <code>import algebra.big_operators.norm_num</code></p>



<a name="284182371"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/explicit%20sums/near/284182371" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/explicit.20sums.html#284182371">(May 27 2022 at 20:39)</a>:</h4>
<p>but this still doesn't work for zmod, you need to <code>change</code> some stuff:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">tactic</span>
<span class="kn">import</span> <span class="n">data.zmod.basic</span>
<span class="kn">import</span> <span class="n">algebra.big_operators.norm_num</span>

<span class="n">open_locale</span> <span class="n">big_operators</span>
<span class="kn">open</span> <span class="n">finset</span>

<span class="kd">example</span> <span class="o">{</span><span class="n">R</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">add_comm_monoid</span> <span class="n">R</span><span class="o">]</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="o">(</span><span class="n">zmod</span> <span class="mi">3</span><span class="o">)</span> <span class="bp">→</span> <span class="n">R</span><span class="o">)</span> <span class="o">:</span> <span class="bp">∑</span> <span class="n">a</span><span class="o">,</span> <span class="n">f</span> <span class="n">a</span> <span class="bp">=</span> <span class="n">f</span> <span class="mi">0</span> <span class="bp">+</span> <span class="n">f</span> <span class="mi">1</span> <span class="bp">+</span> <span class="n">f</span> <span class="mi">2</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="n">rw</span> <span class="n">zmod</span> <span class="n">at</span> <span class="n">f</span><span class="o">,</span>
  <span class="n">change</span> <span class="bp">∑</span> <span class="o">(</span><span class="n">a</span> <span class="o">:</span> <span class="n">fin</span> <span class="mi">3</span><span class="o">),</span> <span class="n">_</span> <span class="bp">=</span> <span class="n">_</span><span class="o">,</span>
  <span class="n">norm_num</span><span class="o">,</span>
<span class="kd">end</span>
</code></pre></div>
<p>I guess this is fixable</p>



<a name="284182428"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/explicit%20sums/near/284182428" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/explicit.20sums.html#284182428">(May 27 2022 at 20:40)</a>:</h4>
<p>(also for some reason <code>norm_num</code> doesn't fix the <code>+ 0</code> here)</p>



<a name="284182503"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/explicit%20sums/near/284182503" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/explicit.20sums.html#284182503">(May 27 2022 at 20:41)</a>:</h4>
<p>(and if you don't try <code>change</code>, <code>norm_num</code> errors hard)</p>



<a name="284182644"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/explicit%20sums/near/284182644" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Michael Stoll <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/explicit.20sums.html#284182644">(May 27 2022 at 20:42)</a>:</h4>
<p>Hmm. After <code>rw zmod at f</code>, the tactic state has two <code>f</code>s:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">f</span><span class="o">:</span> <span class="n">zmod</span> <span class="mi">3</span> <span class="bp">→</span> <span class="n">R</span>
<span class="n">f</span><span class="o">:</span> <span class="n">fin</span> <span class="o">(</span><span class="mi">2</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)</span> <span class="bp">→</span> <span class="n">R</span>
</code></pre></div>
<p>What to make of that?</p>



<a name="284182664"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/explicit%20sums/near/284182664" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/explicit.20sums.html#284182664">(May 27 2022 at 20:43)</a>:</h4>
<p>it's what should be expected, but just don't do this it's a bad idea</p>



<a name="284182672"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/explicit%20sums/near/284182672" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/explicit.20sums.html#284182672">(May 27 2022 at 20:43)</a>:</h4>
<p>like very bad idea</p>



<a name="284182834"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/explicit%20sums/near/284182834" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Michael Stoll <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/explicit.20sums.html#284182834">(May 27 2022 at 20:45)</a>:</h4>
<p>Why do you do it then in your code above?</p>



<a name="284182837"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/explicit%20sums/near/284182837" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/explicit.20sums.html#284182837">(May 27 2022 at 20:45)</a>:</h4>
<p>the issue is that <code>f</code> is already in the expression so it can't just get rid of the <code>f</code>, so  it has to make a copy</p>



<a name="284182842"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/explicit%20sums/near/284182842" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/explicit.20sums.html#284182842">(May 27 2022 at 20:45)</a>:</h4>
<p>just to debug pretty much</p>



<a name="284182989"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/explicit%20sums/near/284182989" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Michael Stoll <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/explicit.20sums.html#284182989">(May 27 2022 at 20:47)</a>:</h4>
<p>Also, with</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">tactic</span>
<span class="kn">import</span> <span class="n">data.zmod.basic</span>
<span class="kn">import</span> <span class="n">algebra.big_operators.norm_num</span>

<span class="n">open_locale</span> <span class="n">big_operators</span>
<span class="kn">open</span> <span class="n">finset</span>

<span class="kd">example</span> <span class="o">{</span><span class="n">R</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">add_comm_monoid</span> <span class="n">R</span><span class="o">]</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="o">(</span><span class="n">zmod</span> <span class="mi">3</span><span class="o">)</span> <span class="bp">→</span> <span class="n">R</span><span class="o">)</span> <span class="o">:</span> <span class="bp">∑</span> <span class="n">a</span><span class="o">,</span> <span class="n">f</span> <span class="n">a</span> <span class="bp">=</span> <span class="n">f</span> <span class="mi">0</span> <span class="bp">+</span> <span class="n">f</span> <span class="mi">1</span> <span class="bp">+</span> <span class="n">f</span> <span class="mi">2</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="n">rw</span> <span class="n">zmod</span> <span class="n">at</span> <span class="n">f</span><span class="o">,</span>
  <span class="n">change</span> <span class="bp">∑</span> <span class="o">(</span><span class="n">a</span> <span class="o">:</span> <span class="n">fin</span> <span class="mi">3</span><span class="o">),</span> <span class="n">_</span> <span class="bp">=</span> <span class="n">_</span><span class="o">,</span>
  <span class="n">norm_num</span><span class="o">,</span>
  <span class="n">rw</span> <span class="o">[</span><span class="n">add_zero</span><span class="o">,</span> <span class="bp">←</span> <span class="n">add_assoc</span><span class="o">],</span>
<span class="kd">end</span>
</code></pre></div>
<p>I get the "Goals accomplished" message, but also an error</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">type</span> <span class="n">mismatch</span> <span class="n">at</span> <span class="n">application</span>
  <span class="bp">@</span><span class="n">tactic.norm_num.finset.eval_sum_of_list</span> <span class="n">R</span>
<span class="n">term</span>
  <span class="n">R</span>
<span class="n">has</span> <span class="n">type</span>
  <span class="kt">Type</span> <span class="n">u_1</span>
<span class="n">but</span> <span class="n">is</span> <span class="n">expected</span> <span class="n">to</span> <span class="k">have</span> <span class="n">type</span>
  <span class="kt">Type</span> <span class="n">u_2</span>
</code></pre></div>
<p>which I find rather confusing.</p>



<a name="284182995"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/explicit%20sums/near/284182995" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/explicit.20sums.html#284182995">(May 27 2022 at 20:47)</a>:</h4>
<p>bug in the <code>norm_num</code> impl below:</p>
<div class="spoiler-block"><div class="spoiler-header">
</div><div class="spoiler-content" aria-hidden="true">
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">tactic</span>
<span class="kn">import</span> <span class="n">data.zmod.basic</span>
<span class="kn">import</span> <span class="n">algebra.big_operators.norm_num</span>

<span class="n">open_locale</span> <span class="n">big_operators</span>
<span class="kn">open</span> <span class="n">finset</span>

<span class="kd">example</span> <span class="o">{</span><span class="n">R</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">}</span> <span class="o">[</span><span class="n">add_comm_monoid</span> <span class="n">R</span><span class="o">]</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="o">(</span><span class="n">zmod</span> <span class="mi">3</span><span class="o">)</span> <span class="bp">→</span> <span class="n">R</span><span class="o">)</span> <span class="o">:</span> <span class="bp">∑</span> <span class="n">a</span><span class="o">,</span> <span class="n">f</span> <span class="n">a</span> <span class="bp">=</span> <span class="n">f</span> <span class="mi">0</span> <span class="bp">+</span> <span class="n">f</span> <span class="mi">1</span> <span class="bp">+</span> <span class="n">f</span> <span class="mi">2</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="n">change</span> <span class="bp">∑</span> <span class="o">(</span><span class="n">a</span> <span class="o">:</span> <span class="n">fin</span> <span class="mi">3</span><span class="o">),</span> <span class="n">_</span> <span class="bp">=</span> <span class="n">_</span><span class="o">,</span>
  <span class="n">norm_num</span><span class="o">,</span>
  <span class="n">rw</span> <span class="o">[</span><span class="n">add_zero</span><span class="o">,</span> <span class="n">add_assoc</span><span class="o">],</span>
<span class="kd">end</span>
</code></pre></div>
</div></div>



<a name="284183025"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/explicit%20sums/near/284183025" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/explicit.20sums.html#284183025">(May 27 2022 at 20:47)</a>:</h4>
<p>yeah, that's a sign of a buggy tactic. i'm not really sure what's up nor how to debug things</p>



<a name="284183322"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/explicit%20sums/near/284183322" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Michael Stoll <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/explicit.20sums.html#284183322">(May 27 2022 at 20:51)</a>:</h4>
<p><span class="user-mention silent" data-user-id="260507">Heather Macbeth</span> <a href="#narrow/stream/217875-Is-there-code-for-X.3F/topic/explicit.20sums/near/284182323">said</a>:</p>
<blockquote>
<p>For <code>fin</code> rather than <code>zmod</code>, you can do</p>
<p><div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">example</span> <span class="o">{</span><span class="n">R</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">add_comm_monoid</span> <span class="n">R</span><span class="o">]</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">fin</span> <span class="mi">3</span> <span class="bp">→</span> <span class="n">R</span><span class="o">)</span> <span class="o">:</span> <span class="bp">∑</span> <span class="n">a</span><span class="o">,</span> <span class="n">f</span> <span class="n">a</span> <span class="bp">=</span> <span class="n">f</span> <span class="mi">0</span> <span class="bp">+</span> <span class="o">(</span><span class="n">f</span> <span class="mi">1</span> <span class="bp">+</span> <span class="n">f</span> <span class="mi">2</span><span class="o">)</span> <span class="o">:=</span>
<span class="kd">by</span> <span class="n">simp</span> <span class="o">[</span><span class="n">fin.sum_univ_succ</span><span class="o">]</span>
</code></pre></div><br>
</p>
</blockquote>
<p>This doesn't seem to work when I replace <code>3</code> by <code>4</code>:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">example</span> <span class="o">{</span><span class="n">R</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">add_comm_monoid</span> <span class="n">R</span><span class="o">]</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="o">(</span><span class="n">fin</span> <span class="mi">4</span><span class="o">)</span> <span class="bp">→</span> <span class="n">R</span><span class="o">)</span> <span class="o">:</span> <span class="bp">∑</span> <span class="n">a</span><span class="o">,</span> <span class="n">f</span> <span class="n">a</span> <span class="bp">=</span> <span class="n">f</span> <span class="mi">0</span> <span class="bp">+</span> <span class="n">f</span> <span class="mi">1</span> <span class="bp">+</span> <span class="n">f</span> <span class="mi">2</span> <span class="bp">+</span> <span class="n">f</span> <span class="mi">3</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="n">rw</span> <span class="o">[</span><span class="n">add_assoc</span><span class="o">,</span> <span class="n">add_assoc</span><span class="o">],</span>
  <span class="n">simp</span> <span class="o">[</span><span class="n">fin.sum_univ_succ</span><span class="o">],</span>
<span class="kd">end</span>
</code></pre></div>
<p>leaves the goal at <code>f 0 + (f 1 + (f 2 + f 2.succ)) = f 0 + (f 1 + (f 2 + f 3))</code>. Adding a <code>congr</code> at the end finishes it, though.</p>



<a name="284183625"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/explicit%20sums/near/284183625" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Michael Stoll <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/explicit.20sums.html#284183625">(May 27 2022 at 20:54)</a>:</h4>
<p>Confusingly,</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">example</span> <span class="o">{</span><span class="n">R</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">add_comm_monoid</span> <span class="n">R</span><span class="o">]</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="o">(</span><span class="n">zmod</span> <span class="mi">8</span><span class="o">)</span> <span class="bp">→</span> <span class="n">R</span><span class="o">)</span> <span class="o">:</span>
 <span class="bp">∑</span> <span class="n">a</span><span class="o">,</span> <span class="n">f</span> <span class="n">a</span> <span class="bp">=</span> <span class="n">f</span> <span class="mi">0</span> <span class="bp">+</span> <span class="n">f</span> <span class="mi">1</span> <span class="bp">+</span> <span class="n">f</span> <span class="mi">2</span> <span class="bp">+</span> <span class="n">f</span> <span class="mi">3</span> <span class="bp">+</span> <span class="n">f</span> <span class="mi">4</span> <span class="bp">+</span> <span class="n">f</span> <span class="mi">5</span> <span class="bp">+</span> <span class="n">f</span> <span class="mi">6</span> <span class="bp">+</span> <span class="n">f</span> <span class="mi">7</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="n">change</span> <span class="bp">∑</span> <span class="o">(</span><span class="n">a</span> <span class="o">:</span> <span class="n">fin</span> <span class="mi">8</span><span class="o">),</span> <span class="n">_</span> <span class="bp">=</span> <span class="n">_</span><span class="o">,</span>
  <span class="n">repeat</span> <span class="o">{</span><span class="n">rw</span> <span class="n">add_assoc</span><span class="o">},</span>
  <span class="n">simp</span> <span class="o">[</span><span class="n">fin.sum_univ_succ</span><span class="o">],</span> <span class="c1">-- does not replace the sum</span>
  <span class="gr">sorry</span>
<span class="kd">end</span>
</code></pre></div>
<p>does not work, but using <code>fin 8</code> in the statement instead of <code>zmod 8</code> does.</p>



<a name="284183984"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/explicit%20sums/near/284183984" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Michael Stoll <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/explicit.20sums.html#284183984">(May 27 2022 at 20:58)</a>:</h4>
<p>The following works.</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">example</span> <span class="o">{</span><span class="n">R</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">add_comm_monoid</span> <span class="n">R</span><span class="o">]</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="o">(</span><span class="n">zmod</span> <span class="mi">8</span><span class="o">)</span> <span class="bp">→</span> <span class="n">R</span><span class="o">)</span> <span class="o">:</span>
 <span class="bp">∑</span> <span class="n">a</span><span class="o">,</span> <span class="n">f</span> <span class="n">a</span> <span class="bp">=</span> <span class="n">f</span> <span class="mi">0</span> <span class="bp">+</span> <span class="n">f</span> <span class="mi">1</span> <span class="bp">+</span> <span class="n">f</span> <span class="mi">2</span> <span class="bp">+</span> <span class="n">f</span> <span class="mi">3</span> <span class="bp">+</span> <span class="n">f</span> <span class="mi">4</span> <span class="bp">+</span> <span class="n">f</span> <span class="mi">5</span> <span class="bp">+</span> <span class="n">f</span> <span class="mi">6</span> <span class="bp">+</span> <span class="n">f</span> <span class="mi">7</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="k">have</span> <span class="n">sum8</span> <span class="o">:</span> <span class="bp">∀</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="o">(</span><span class="n">fin</span> <span class="mi">8</span><span class="o">)</span> <span class="bp">→</span> <span class="n">R</span><span class="o">),</span> <span class="bp">∑</span> <span class="n">a</span><span class="o">,</span> <span class="n">f</span> <span class="n">a</span> <span class="bp">=</span> <span class="n">f</span> <span class="mi">0</span> <span class="bp">+</span> <span class="n">f</span> <span class="mi">1</span> <span class="bp">+</span> <span class="n">f</span> <span class="mi">2</span> <span class="bp">+</span> <span class="n">f</span> <span class="mi">3</span> <span class="bp">+</span> <span class="n">f</span> <span class="mi">4</span> <span class="bp">+</span> <span class="n">f</span> <span class="mi">5</span> <span class="bp">+</span> <span class="n">f</span> <span class="mi">6</span> <span class="bp">+</span> <span class="n">f</span> <span class="mi">7</span> <span class="o">:=</span>
  <span class="kd">begin</span>
    <span class="n">intro</span> <span class="n">f'</span><span class="o">,</span>
    <span class="n">repeat</span> <span class="o">{</span><span class="n">rw</span> <span class="n">add_assoc</span><span class="o">},</span>
    <span class="n">simp</span> <span class="o">[</span><span class="n">fin.sum_univ_succ</span><span class="o">],</span>
    <span class="n">congr</span><span class="o">,</span>
  <span class="kd">end</span><span class="o">,</span>
  <span class="n">exact</span> <span class="n">sum8</span> <span class="n">f</span><span class="o">,</span>
<span class="kd">end</span>
</code></pre></div>



<a name="284184077"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/explicit%20sums/near/284184077" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Michael Stoll <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/explicit.20sums.html#284184077">(May 27 2022 at 20:59)</a>:</h4>
<p>But why it works in this form and not in the previous one, I do not understand.</p>



<a name="284185101"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/explicit%20sums/near/284185101" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/explicit.20sums.html#284185101">(May 27 2022 at 21:10)</a>:</h4>
<p>cc <span class="user-mention" data-user-id="238446">@Anne Baanen</span> re: norm_num extension bug</p>



<a name="284185147"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/explicit%20sums/near/284185147" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Michael Stoll <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/explicit.20sums.html#284185147">(May 27 2022 at 21:10)</a>:</h4>
<p>But my proof (derived from <span class="user-mention" data-user-id="260507">@Heather Macbeth</span> 's one) does not use <code>norm_num</code>.</p>



<a name="284185315"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/explicit%20sums/near/284185315" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/explicit.20sums.html#284185315">(May 27 2022 at 21:13)</a>:</h4>
<p>the norm_num bug may or may not be related to your issue, but it's a bug in any case</p>



<a name="284206686"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/explicit%20sums/near/284206686" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/explicit.20sums.html#284206686">(May 28 2022 at 03:25)</a>:</h4>
<p>Why are you using <code>zmod 3</code> and not <code>fin 3</code>, the "official" type with 3 elements?</p>



<a name="284221152"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/explicit%20sums/near/284221152" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/explicit.20sums.html#284221152">(May 28 2022 at 09:48)</a>:</h4>
<p>I'm guessing f is some sort of character, so zmod makes more sense for those</p>



<a name="284240179"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/explicit%20sums/near/284240179" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Michael Stoll <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/explicit.20sums.html#284240179">(May 28 2022 at 17:45)</a>:</h4>
<p>Yes; in my use case, I want to expand a Gauss sum on Z/8Z into an explicit sum, so <code>zmod n</code> is the natural type.</p>



<a name="284303058"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/explicit%20sums/near/284303058" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Anne Baanen <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/explicit.20sums.html#284303058">(May 29 2022 at 20:09)</a>:</h4>
<p>Thanks for being guinea pigs for the tactic! :)</p>



<a name="284303122"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/explicit%20sums/near/284303122" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Anne Baanen <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/explicit.20sums.html#284303122">(May 29 2022 at 20:10)</a>:</h4>
<p><span class="user-mention silent" data-user-id="479359">Michael Stoll</span> <a href="#narrow/stream/217875-Is-there-code-for-X.3F/topic/explicit.20sums/near/284182644">said</a>:</p>
<blockquote>
<p>Hmm. After <code>rw zmod at f</code>, the tactic state has two <code>f</code>s:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">f</span><span class="o">:</span> <span class="n">zmod</span> <span class="mi">3</span> <span class="bp">→</span> <span class="n">R</span>
<span class="n">f</span><span class="o">:</span> <span class="n">fin</span> <span class="o">(</span><span class="mi">2</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)</span> <span class="bp">→</span> <span class="n">R</span>
</code></pre></div>
<p>What to make of that?</p>
</blockquote>
<p>I recall something ending up with <code>fin (2+1)</code> before, not entirely sure where, and it confused <code>norm_num</code>, but I fixed it by making sure the tactics I called would always give <code>fin 3</code>. The other solution would be to replace some usages of <a href="https://leanprover-community.github.io/mathlib_docs/find/expr.to_nat">docs#expr.to_nat</a> with something slightly smarter that understands <code>+1</code>.</p>



<a name="284303140"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/explicit%20sums/near/284303140" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Anne Baanen <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/explicit.20sums.html#284303140">(May 29 2022 at 20:11)</a>:</h4>
<p><span class="user-mention silent" data-user-id="479359">Michael Stoll</span> <a href="#narrow/stream/217875-Is-there-code-for-X.3F/topic/explicit.20sums/near/284182989">said</a>:</p>
<blockquote>
<p>Also, with</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">tactic</span>
<span class="kn">import</span> <span class="n">data.zmod.basic</span>
<span class="kn">import</span> <span class="n">algebra.big_operators.norm_num</span>

<span class="n">open_locale</span> <span class="n">big_operators</span>
<span class="kn">open</span> <span class="n">finset</span>

<span class="kd">example</span> <span class="o">{</span><span class="n">R</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">add_comm_monoid</span> <span class="n">R</span><span class="o">]</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="o">(</span><span class="n">zmod</span> <span class="mi">3</span><span class="o">)</span> <span class="bp">→</span> <span class="n">R</span><span class="o">)</span> <span class="o">:</span> <span class="bp">∑</span> <span class="n">a</span><span class="o">,</span> <span class="n">f</span> <span class="n">a</span> <span class="bp">=</span> <span class="n">f</span> <span class="mi">0</span> <span class="bp">+</span> <span class="n">f</span> <span class="mi">1</span> <span class="bp">+</span> <span class="n">f</span> <span class="mi">2</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="n">rw</span> <span class="n">zmod</span> <span class="n">at</span> <span class="n">f</span><span class="o">,</span>
  <span class="n">change</span> <span class="bp">∑</span> <span class="o">(</span><span class="n">a</span> <span class="o">:</span> <span class="n">fin</span> <span class="mi">3</span><span class="o">),</span> <span class="n">_</span> <span class="bp">=</span> <span class="n">_</span><span class="o">,</span>
  <span class="n">norm_num</span><span class="o">,</span>
  <span class="n">rw</span> <span class="o">[</span><span class="n">add_zero</span><span class="o">,</span> <span class="bp">←</span> <span class="n">add_assoc</span><span class="o">],</span>
<span class="kd">end</span>
</code></pre></div>
<p>I get the "Goals accomplished" message, but also an error</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">type</span> <span class="n">mismatch</span> <span class="n">at</span> <span class="n">application</span>
  <span class="bp">@</span><span class="n">tactic.norm_num.finset.eval_sum_of_list</span> <span class="n">R</span>
<span class="n">term</span>
  <span class="n">R</span>
<span class="n">has</span> <span class="n">type</span>
  <span class="kt">Type</span> <span class="n">u_1</span>
<span class="n">but</span> <span class="n">is</span> <span class="n">expected</span> <span class="n">to</span> <span class="k">have</span> <span class="n">type</span>
  <span class="kt">Type</span> <span class="n">u_2</span>
</code></pre></div>
<p>which I find rather confusing.</p>
</blockquote>
<p>Oof, that's an embarassing kind of bug :P</p>



<a name="284303184"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/explicit%20sums/near/284303184" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Anne Baanen <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/explicit.20sums.html#284303184">(May 29 2022 at 20:12)</a>:</h4>
<p>I should have some time within the next days to fix both these issues.</p>



<a name="290707431"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/explicit%20sums/near/290707431" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/explicit.20sums.html#290707431">(Jul 25 2022 at 00:18)</a>:</h4>
<p>was this ever fixed, btw?</p>



<a name="290782356"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/explicit%20sums/near/290782356" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Anne Baanen <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/explicit.20sums.html#290782356">(Jul 25 2022 at 16:14)</a>:</h4>
<p>I don't think so, at leat I never got around to it</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>