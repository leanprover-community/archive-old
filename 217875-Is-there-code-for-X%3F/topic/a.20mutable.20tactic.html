---
layout: archive
title: Zulip Chat Archive
permalink: /stream/217875-Is-there-code-for-X%3F/topic/a.20mutable.20tactic.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/index.html">Is there code for X?</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/a.20mutable.20tactic.html">a mutable tactic</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="197782498"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/a%20mutable%20tactic/near/197782498" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/a.20mutable.20tactic.html#197782498">(May 16 2020 at 07:42)</a>:</h4>
<p>is it possible to write a tactic:</p>
<div class="codehilite"><pre><span></span><code><span class="n">meta</span> <span class="n">def</span> <span class="n">increment</span> <span class="o">:</span> <span class="n">tactic</span> <span class="n">unit</span> <span class="o">:=</span>
</code></pre></div>


<p>such that every time I do <code>#eval by increment</code> it prints <code>0</code> and then <code>1</code> and then <code>2</code> etc?</p>



<a name="197782501"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/a%20mutable%20tactic/near/197782501" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/a.20mutable.20tactic.html#197782501">(May 16 2020 at 07:42)</a>:</h4>
<div class="codehilite"><pre><span></span><code><span class="bp">#</span><span class="kn">eval</span> <span class="k">by</span> <span class="n">increment</span> <span class="c1">-- 0</span>
<span class="bp">#</span><span class="kn">eval</span> <span class="k">by</span> <span class="n">increment</span> <span class="c1">-- 1</span>
<span class="bp">#</span><span class="kn">eval</span> <span class="k">by</span> <span class="n">increment</span> <span class="c1">-- 2</span>
</code></pre></div>



<a name="197782511"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/a%20mutable%20tactic/near/197782511" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/a.20mutable.20tactic.html#197782511">(May 16 2020 at 07:43)</a>:</h4>
<p>I imagine I could start by inspect how <code>random</code> works</p>



<a name="197782572"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/a%20mutable%20tactic/near/197782572" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/a.20mutable.20tactic.html#197782572">(May 16 2020 at 07:44)</a>:</h4>
<p>this behaviour is also acceptable:</p>
<div class="codehilite"><pre><span></span><code><span class="bp">#</span><span class="kn">eval</span> <span class="k">by</span> <span class="o">{</span><span class="n">increment</span><span class="o">,</span> <span class="n">increment</span><span class="o">,</span> <span class="n">increment</span><span class="o">}</span> <span class="c1">-- 0 \n 1 \n 2</span>
</code></pre></div>



<a name="197782644"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/a%20mutable%20tactic/near/197782644" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/a.20mutable.20tactic.html#197782644">(May 16 2020 at 07:47)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110064">Kenny Lau</span> <a href="#narrow/stream/217875-Is-there.20code.20for.20X.3F/topic/a.20mutable.20tactic/near/197782511">said</a>:</p>
<blockquote>
<p>I imagine I could start by inspect how <code>random</code> works</p>
</blockquote>
<p>welp I'm out of luck as I've hit the <code>constant</code> wall</p>



<a name="197782687"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/a%20mutable%20tactic/near/197782687" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/a.20mutable.20tactic.html#197782687">(May 16 2020 at 07:48)</a>:</h4>
<p>I imagine I could also use the help of an outside file, if I've resolved the <a href="#narrow/stream/113489-new-members/topic/failed.20to.20open.20file">issue of not being able to open files</a></p>



<a name="197782961"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/a%20mutable%20tactic/near/197782961" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/a.20mutable.20tactic.html#197782961">(May 16 2020 at 07:56)</a>:</h4>
<p>it doesn't have to go on forever, e.g. by reading a file that basically contains <code>0\n1\n2\n3\n4</code></p>



<a name="197782969"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/a%20mutable%20tactic/near/197782969" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/a.20mutable.20tactic.html#197782969">(May 16 2020 at 07:56)</a>:</h4>
<p>then it's basically "read the next line" tactic</p>



<a name="197784624"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/a%20mutable%20tactic/near/197784624" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/a.20mutable.20tactic.html#197784624">(May 16 2020 at 08:40)</a>:</h4>
<p>You could use <code>user_attribute</code> to set (and modify) an attribute on the <code>increment</code> declaration.</p>



<a name="197784884"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/a%20mutable%20tactic/near/197784884" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/a.20mutable.20tactic.html#197784884">(May 16 2020 at 08:47)</a>:</h4>
<p>is there an approach with less performance cost than this? Particularly when the object being stored is large</p>



<a name="197787801"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/a%20mutable%20tactic/near/197787801" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/a.20mutable.20tactic.html#197787801">(May 16 2020 at 09:58)</a>:</h4>
<div class="codehilite"><pre><span></span><code><span class="n">meta</span> <span class="n">def</span> <span class="n">hack</span> <span class="o">:</span> <span class="n">list</span> <span class="n">expr</span> <span class="o">:=</span>
<span class="o">[</span><span class="bp">`</span><span class="o">(</span><span class="mi">42</span><span class="o">),</span> <span class="bp">`</span><span class="o">(</span><span class="mi">57</span><span class="o">)]</span>

<span class="bp">@</span><span class="o">[</span><span class="n">user_attribute</span><span class="o">]</span>
<span class="n">meta</span> <span class="n">def</span> <span class="n">incr_attr</span> <span class="o">:</span> <span class="n">user_attribute</span> <span class="n">unit</span> <span class="bp">ℕ</span> <span class="o">:=</span>
<span class="o">{</span> <span class="n">name</span>   <span class="o">:=</span> <span class="bp">`</span><span class="n">incrementer</span><span class="o">,</span>
  <span class="n">descr</span>  <span class="o">:=</span> <span class="s2">&quot;incrementer&quot;</span><span class="o">,</span>
  <span class="n">parser</span> <span class="o">:=</span> <span class="n">pure</span> <span class="mi">0</span> <span class="o">}</span>

<span class="kn">open</span> <span class="n">tactic</span>
<span class="n">meta</span> <span class="n">def</span> <span class="n">increment</span> <span class="o">:</span> <span class="n">tactic</span> <span class="n">unit</span> <span class="o">:=</span>
<span class="n">do</span> <span class="n">n</span> <span class="err">←</span> <span class="n">incr_attr</span><span class="bp">.</span><span class="n">get_param</span> <span class="bp">`</span><span class="n">increment</span> <span class="bp">&lt;|&gt;</span> <span class="n">pure</span> <span class="mi">0</span><span class="o">,</span>
  <span class="n">e</span> <span class="err">←</span> <span class="n">hack</span><span class="bp">.</span><span class="n">nth</span> <span class="o">(</span><span class="n">n</span> <span class="err">%</span> <span class="mi">2</span><span class="o">),</span>
  <span class="n">tactic</span><span class="bp">.</span><span class="n">exact</span> <span class="n">e</span><span class="o">,</span>
  <span class="n">incr_attr</span><span class="bp">.</span><span class="n">set</span> <span class="bp">`</span><span class="n">increment</span> <span class="o">(</span><span class="n">n</span><span class="bp">+</span><span class="mi">1</span><span class="o">)</span> <span class="n">tt</span>

<span class="n">def</span> <span class="n">test0</span> <span class="o">:</span> <span class="bp">ℕ</span> <span class="o">:=</span> <span class="k">by</span> <span class="n">increment</span>
<span class="n">def</span> <span class="n">test1</span> <span class="o">:</span> <span class="bp">ℕ</span> <span class="o">:=</span> <span class="k">by</span> <span class="n">increment</span>
<span class="n">def</span> <span class="n">test2</span> <span class="o">:</span> <span class="bp">ℕ</span> <span class="o">:=</span> <span class="k">by</span> <span class="n">increment</span>
<span class="n">def</span> <span class="n">test3</span> <span class="o">:</span> <span class="bp">ℕ</span> <span class="o">:=</span> <span class="k">by</span> <span class="n">increment</span>
<span class="bp">#</span><span class="kn">print</span> <span class="n">test0</span> <span class="c1">-- 42</span>
<span class="bp">#</span><span class="kn">print</span> <span class="n">test1</span> <span class="c1">-- 57</span>
<span class="bp">#</span><span class="kn">print</span> <span class="n">test2</span> <span class="c1">-- 42</span>
<span class="bp">#</span><span class="kn">print</span> <span class="n">test3</span> <span class="c1">-- 57</span>
</code></pre></div>



<a name="197787803"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/a%20mutable%20tactic/near/197787803" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/a.20mutable.20tactic.html#197787803">(May 16 2020 at 09:58)</a>:</h4>
<p>this works perfectly</p>



<a name="197787804"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/a%20mutable%20tactic/near/197787804" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/a.20mutable.20tactic.html#197787804">(May 16 2020 at 09:58)</a>:</h4>
<p>thanks to Mario</p>



<a name="197788137"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/a%20mutable%20tactic/near/197788137" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/a.20mutable.20tactic.html#197788137">(May 16 2020 at 10:07)</a>:</h4>
<p><span class="user-mention" data-user-id="110049">@Mario Carneiro</span> is there a way to change the environment permanently?</p>



<a name="197788139"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/a%20mutable%20tactic/near/197788139" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/a.20mutable.20tactic.html#197788139">(May 16 2020 at 10:07)</a>:</h4>
<p>this doesn't survive <code>&lt;|&gt;</code></p>



<a name="197788206"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/a%20mutable%20tactic/near/197788206" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/a.20mutable.20tactic.html#197788206">(May 16 2020 at 10:09)</a>:</h4>
<div class="codehilite"><pre><span></span><code><span class="kn">lemma</span> <span class="n">test</span> <span class="o">:</span> <span class="n">true</span> <span class="o">:=</span>
<span class="k">by</span> <span class="n">rw</span> <span class="o">[</span><span class="k">by</span> <span class="n">increment</span><span class="o">]</span> <span class="bp">&lt;|&gt;</span> <span class="n">rw</span> <span class="o">[</span><span class="k">by</span> <span class="n">increment</span><span class="o">]</span> <span class="bp">&lt;|&gt;</span> <span class="n">rw</span> <span class="o">[</span><span class="k">by</span> <span class="n">increment</span><span class="o">]</span>
</code></pre></div>



<a name="197788207"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/a%20mutable%20tactic/near/197788207" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/a.20mutable.20tactic.html#197788207">(May 16 2020 at 10:09)</a>:</h4>
<p>this just gives 3 zeroes</p>



<a name="197788269"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/a%20mutable%20tactic/near/197788269" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/a.20mutable.20tactic.html#197788269">(May 16 2020 at 10:10)</a>:</h4>
<p>maybe we really need to do some read/write?</p>



<a name="197788307"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/a%20mutable%20tactic/near/197788307" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/a.20mutable.20tactic.html#197788307">(May 16 2020 at 10:11)</a>:</h4>
<p>but then we would need some way to pass from <code>io</code> to <code>tactic</code></p>



<a name="197790989"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/a%20mutable%20tactic/near/197790989" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Markus Himmel <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/a.20mutable.20tactic.html#197790989">(May 16 2020 at 11:21)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110064">Kenny Lau</span> <a href="#narrow/stream/217875-Is-there.20code.20for.20X.3F/topic/a.20mutable.20tactic/near/197788307">said</a>:</p>
<blockquote>
<p>but then we would need some way to pass from <code>io</code> to <code>tactic</code></p>
</blockquote>
<p>Like <code>tactic.unsafe_run_io</code>?</p>



<a name="197792695"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/a%20mutable%20tactic/near/197792695" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/a.20mutable.20tactic.html#197792695">(May 16 2020 at 12:09)</a>:</h4>
<p>seriously it takes more time to hack your kata</p>



<a name="197792697"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/a%20mutable%20tactic/near/197792697" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/a.20mutable.20tactic.html#197792697">(May 16 2020 at 12:09)</a>:</h4>
<p>then is it still a hack?</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>