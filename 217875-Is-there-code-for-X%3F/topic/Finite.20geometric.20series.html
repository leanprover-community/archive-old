---
layout: archive
title: Zulip Chat Archive
permalink: /stream/217875-Is-there-code-for-X%3F/topic/Finite.20geometric.20series.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/index.html">Is there code for X?</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Finite.20geometric.20series.html">Finite geometric series</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="202191581"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Finite%20geometric%20series/near/202191581" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Finite.20geometric.20series.html#202191581">(Jun 27 2020 at 15:30)</a>:</h4>
<p>I would like to use the lemma </p>
<div class="codehilite"><pre><span></span><code><span class="kn">theorem</span> <span class="n">geom_sum_mul_neg</span> <span class="o">[</span><span class="n">ring</span> <span class="n">α</span><span class="o">]</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="n">α</span><span class="o">)</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">)</span> <span class="o">:</span> <span class="o">(</span><span class="n">geom_series</span> <span class="n">x</span> <span class="n">n</span><span class="o">)</span> <span class="bp">*</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">-</span> <span class="n">x</span><span class="o">)</span> <span class="bp">=</span> <span class="mi">1</span> <span class="bp">-</span> <span class="n">x</span> <span class="bp">^</span> <span class="n">n</span>
</code></pre></div>


<p>from <a href="https://leanprover-community.github.io/mathlib_docs/algebra/geom_sum.html#top">algebra.geom_sum</a>, but in the "reflected" form</p>
<div class="codehilite"><pre><span></span><code>  <span class="o">(</span><span class="mi">1</span> <span class="bp">-</span><span class="n">x</span><span class="o">)</span> <span class="bp">*</span> <span class="o">(</span><span class="n">geom_series</span> <span class="n">x</span> <span class="n">n</span><span class="o">)</span> <span class="bp">=</span> <span class="mi">1</span> <span class="bp">-</span> <span class="n">x</span> <span class="bp">^</span> <span class="n">n</span>
</code></pre></div>


<p>Is there a slick way to get this, maybe using that <code>1</code> and <code>x</code> commute?  Or do I truly need to re-prove this lemma and all the lemmas it depends on (<code>geom_sum_mul</code>, <code>geom_sum₂_mul_comm</code>, <code>geom_sum₂_mul_add</code>, ...) in reflected form?</p>



<a name="202191733"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Finite%20geometric%20series/near/202191733" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jalex Stark <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Finite.20geometric.20series.html#202191733">(Jun 27 2020 at 15:34)</a>:</h4>
<p>if you're writing a tactic mode proof, you can <code>have</code> it and then <code>rw mul_comm at</code> it</p>



<a name="202191746"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Finite%20geometric%20series/near/202191746" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Finite.20geometric.20series.html#202191746">(Jun 27 2020 at 15:35)</a>:</h4>
<p>This is a possibly non-commutative ring</p>



<a name="202191753"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Finite%20geometric%20series/near/202191753" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jalex Stark <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Finite.20geometric.20series.html#202191753">(Jun 27 2020 at 15:35)</a>:</h4>
<p>thanks, maybe I forgot which stream I was in :)</p>



<a name="202191825"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Finite%20geometric%20series/near/202191825" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jalex Stark <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Finite.20geometric.20series.html#202191825">(Jun 27 2020 at 15:37)</a>:</h4>
<p>hmm you could have this as a theorem about the polynomial ring <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="double-struck">Z</mi><mo stretchy="false">[</mo><mi>x</mi><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex"> \Z[x] </annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathbb">Z</span></span><span class="mopen">[</span><span class="mord mathdefault">x</span><span class="mclose">]</span></span></span></span></p>



<a name="202191832"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Finite%20geometric%20series/near/202191832" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bhavik Mehta <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Finite.20geometric.20series.html#202191832">(Jun 27 2020 at 15:37)</a>:</h4>
<p>Could you show <code>x * geom_series x n = geom_series x n * x</code> (using <code>x^n * x = x * x^n</code>) and then use distributivity perhaps?</p>



<a name="202191839"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Finite%20geometric%20series/near/202191839" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Finite.20geometric.20series.html#202191839">(Jun 27 2020 at 15:37)</a>:</h4>
<p>Maybe we need some <code>big_operators</code> lemmas about <code>commute</code></p>



<a name="202192039"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Finite%20geometric%20series/near/202192039" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Finite.20geometric.20series.html#202192039">(Jun 27 2020 at 15:42)</a>:</h4>
<p>OK, for now I will just add reflected versions of a bunch of lemmas to <code>algebra.geom_sum</code>; hopefully Bhavik's idea will reduce my pain.</p>



<a name="202192045"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Finite%20geometric%20series/near/202192045" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Finite.20geometric.20series.html#202192045">(Jun 27 2020 at 15:42)</a>:</h4>
<p>Looks like the elegant ways also require a lot of work .. so someone else can do it later.</p>



<a name="202192337"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Finite%20geometric%20series/near/202192337" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jalex Stark <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Finite.20geometric.20series.html#202192337">(Jun 27 2020 at 15:51)</a>:</h4>
<p>This depends on <a href="https://github.com/leanprover-community/mathlib/issues/3197">#3197</a>, which should be merged soon. </p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="n">tactic</span>

<span class="kn">variables</span> <span class="o">(</span><span class="n">α</span> <span class="n">R</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">[</span><span class="n">ring</span> <span class="n">R</span><span class="o">]</span> <span class="o">(</span><span class="n">s</span> <span class="o">:</span> <span class="n">finset</span> <span class="n">α</span><span class="o">)</span>

<span class="n">open_locale</span> <span class="n">big_operators</span>
<span class="kn">open</span> <span class="n">finset</span>

<span class="kn">lemma</span> <span class="n">mul_sum_comm</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">α</span> <span class="bp">→</span> <span class="n">R</span><span class="o">)</span> <span class="o">(</span><span class="n">a</span> <span class="o">:</span> <span class="n">R</span><span class="o">)</span> <span class="o">(</span><span class="n">ha</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">x</span> <span class="err">∈</span> <span class="n">s</span><span class="o">,</span> <span class="n">a</span> <span class="bp">*</span> <span class="n">f</span> <span class="n">x</span> <span class="bp">=</span> <span class="n">f</span> <span class="n">x</span> <span class="bp">*</span> <span class="n">a</span><span class="o">)</span> <span class="o">:</span>
<span class="n">a</span> <span class="bp">*</span> <span class="err">∑</span> <span class="n">x</span> <span class="k">in</span> <span class="n">s</span><span class="o">,</span> <span class="n">f</span> <span class="n">x</span> <span class="bp">=</span> <span class="o">(</span><span class="err">∑</span> <span class="n">x</span> <span class="k">in</span> <span class="n">s</span><span class="o">,</span> <span class="n">f</span> <span class="n">x</span><span class="o">)</span> <span class="bp">*</span> <span class="n">a</span> <span class="o">:=</span>
<span class="n">sum_induction</span> <span class="n">f</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">r</span><span class="o">,</span> <span class="n">a</span> <span class="bp">*</span> <span class="n">r</span> <span class="bp">=</span> <span class="n">r</span> <span class="bp">*</span> <span class="n">a</span><span class="o">)</span>
  <span class="o">(</span><span class="bp">λ</span> <span class="bp">_</span> <span class="bp">_</span> <span class="n">hb</span> <span class="n">hc</span><span class="o">,</span> <span class="k">by</span> <span class="n">rw</span> <span class="o">[</span><span class="n">mul_add</span><span class="o">,</span> <span class="n">add_mul</span><span class="o">,</span> <span class="n">hb</span><span class="o">,</span> <span class="n">hc</span><span class="o">])</span> <span class="o">(</span><span class="k">by</span> <span class="n">simp</span><span class="o">)</span> <span class="n">ha</span>
</code></pre></div>



<a name="202192384"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Finite%20geometric%20series/near/202192384" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Finite.20geometric.20series.html#202192384">(Jun 27 2020 at 15:52)</a>:</h4>
<p>There is already <code>commute</code> which handles the parts of this other than the induction on the sum</p>



<a name="202192403"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Finite%20geometric%20series/near/202192403" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Finite.20geometric.20series.html#202192403">(Jun 27 2020 at 15:53)</a>:</h4>
<p><span class="user-mention silent" data-user-id="260507">Heather Macbeth</span> <a href="#narrow/stream/217875-Is-there.20code.20for.20X.3F/topic/Finite.20geometric.20series/near/202192045">said</a>:</p>
<blockquote>
<p>Looks like the elegant ways also require a lot of work .. so someone else can do it later.</p>
</blockquote>
<p>Wait, is this becoming "someone else can do it right now"? :)</p>



<a name="202192481"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Finite%20geometric%20series/near/202192481" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jalex Stark <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Finite.20geometric.20series.html#202192481">(Jun 27 2020 at 15:55)</a>:</h4>
<p>mm how much more are you asking to be done? this was just meant to help prove that <code>x</code> commutes with <code>geom_series x n</code></p>



<a name="202192574"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Finite%20geometric%20series/near/202192574" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Finite.20geometric.20series.html#202192574">(Jun 27 2020 at 15:57)</a>:</h4>
<p>This counts as an elegant way, as far as I am concerned.</p>



<a name="202192632"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Finite%20geometric%20series/near/202192632" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Finite.20geometric.20series.html#202192632">(Jun 27 2020 at 15:58)</a>:</h4>
<p>By the way, is it too late to add that lemma to <a href="https://github.com/leanprover-community/mathlib/issues/3197">#3197</a>?</p>



<a name="202192639"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Finite%20geometric%20series/near/202192639" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jalex Stark <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Finite.20geometric.20series.html#202192639">(Jun 27 2020 at 15:59)</a>:</h4>
<p>I guess not, I'm working to make it depend on <code>commute</code> as Reid suggested</p>



<a name="202192670"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Finite%20geometric%20series/near/202192670" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jalex Stark <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Finite.20geometric.20series.html#202192670">(Jun 27 2020 at 15:59)</a>:</h4>
<p>(I think <a href="https://github.com/leanprover-community/mathlib/issues/3197">#3197</a> is in a state where it will be accepted next time a reviewer notices that it has passed the linter)</p>



<a name="202193372"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Finite%20geometric%20series/near/202193372" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jalex Stark <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Finite.20geometric.20series.html#202193372">(Jun 27 2020 at 16:14)</a>:</h4>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="n">tactic</span>


<span class="kn">variables</span> <span class="o">{</span><span class="n">α</span> <span class="n">R</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">ring</span> <span class="n">R</span><span class="o">]</span> <span class="o">{</span><span class="n">s</span> <span class="o">:</span> <span class="n">finset</span> <span class="n">α</span><span class="o">}</span>

<span class="n">open_locale</span> <span class="n">big_operators</span>
<span class="kn">open</span> <span class="n">finset</span>

<span class="kn">lemma</span> <span class="n">commute_add</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="o">:</span> <span class="n">R</span><span class="o">)</span> <span class="o">(</span><span class="n">hb</span> <span class="o">:</span> <span class="n">commute</span> <span class="n">a</span> <span class="n">b</span><span class="o">)</span> <span class="o">(</span><span class="n">hc</span> <span class="o">:</span> <span class="n">commute</span> <span class="n">a</span> <span class="n">c</span><span class="o">)</span> <span class="o">:</span>
<span class="n">commute</span> <span class="n">a</span> <span class="o">(</span><span class="n">b</span> <span class="bp">+</span> <span class="n">c</span><span class="o">)</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="n">unfold</span> <span class="n">commute</span><span class="o">,</span> <span class="n">unfold</span> <span class="n">semiconj_by</span><span class="o">,</span>
  <span class="n">rw</span> <span class="o">[</span><span class="n">mul_add</span><span class="o">,</span> <span class="n">add_mul</span><span class="o">,</span> <span class="n">hb</span><span class="bp">.</span><span class="n">eq</span><span class="o">,</span> <span class="n">hc</span><span class="bp">.</span><span class="n">eq</span><span class="o">],</span>
<span class="kn">end</span>

<span class="kn">lemma</span> <span class="n">commute_zero</span> <span class="o">(</span><span class="n">a</span> <span class="o">:</span> <span class="n">R</span><span class="o">)</span> <span class="o">:</span> <span class="n">commute</span> <span class="n">a</span> <span class="mi">0</span> <span class="o">:=</span> <span class="k">by</span> <span class="n">simp</span>

<span class="kn">lemma</span> <span class="n">commute_sum</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">α</span> <span class="bp">→</span> <span class="n">R</span><span class="o">)</span> <span class="o">(</span><span class="n">a</span> <span class="o">:</span> <span class="n">R</span><span class="o">)</span> <span class="o">(</span><span class="n">ha</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">x</span> <span class="err">∈</span> <span class="n">s</span><span class="o">,</span> <span class="n">commute</span> <span class="n">a</span> <span class="o">(</span><span class="n">f</span> <span class="n">x</span><span class="o">))</span> <span class="o">:</span>
<span class="n">commute</span> <span class="n">a</span> <span class="o">(</span><span class="err">∑</span> <span class="n">x</span> <span class="k">in</span> <span class="n">s</span><span class="o">,</span> <span class="n">f</span> <span class="n">x</span><span class="o">)</span> <span class="o">:=</span>
<span class="n">sum_induction</span> <span class="bp">_</span> <span class="bp">_</span> <span class="o">(</span><span class="n">commute_add</span> <span class="n">a</span><span class="o">)</span> <span class="o">(</span><span class="n">commute_zero</span> <span class="n">a</span><span class="o">)</span> <span class="n">ha</span>
</code></pre></div>



<a name="202193497"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Finite%20geometric%20series/near/202193497" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jalex Stark <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Finite.20geometric.20series.html#202193497">(Jun 27 2020 at 16:17)</a>:</h4>
<p>do you have any need for </p>
<div class="codehilite"><pre><span></span><code><span class="n">def</span> <span class="n">commutator</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="o">:</span> <span class="n">R</span><span class="o">)</span> <span class="o">:</span> <span class="kt">Prop</span> <span class="o">:=</span> <span class="n">a</span> <span class="bp">*</span> <span class="n">b</span> <span class="bp">-</span> <span class="n">b</span> <span class="bp">*</span> <span class="n">a</span>
</code></pre></div>



<a name="202193498"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Finite%20geometric%20series/near/202193498" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Finite.20geometric.20series.html#202193498">(Jun 27 2020 at 16:17)</a>:</h4>
<p>First two are <code>commute.add_right</code> and <code>commute.zero_right</code>.</p>



<a name="202193509"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Finite%20geometric%20series/near/202193509" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jalex Stark <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Finite.20geometric.20series.html#202193509">(Jun 27 2020 at 16:17)</a>:</h4>
<p>mm maybe I should have tried <code>library_search</code> after my eyeball-search failed</p>



<a name="202193561"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Finite%20geometric%20series/near/202193561" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jalex Stark <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Finite.20geometric.20series.html#202193561">(Jun 27 2020 at 16:18)</a>:</h4>
<p>should commute_sum go in <code>algebra.big_operators</code>? <code>commute</code>? somewhere else?</p>



<a name="202193574"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Finite%20geometric%20series/near/202193574" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Finite.20geometric.20series.html#202193574">(Jun 27 2020 at 16:18)</a>:</h4>
<p><span class="user-mention" data-user-id="214703">@Yury G. Kudryashov</span> <span class="user-mention" data-user-id="110044">@Chris Hughes</span> ?</p>



<a name="202194842"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Finite%20geometric%20series/near/202194842" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Chris Hughes <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Finite.20geometric.20series.html#202194842">(Jun 27 2020 at 16:48)</a>:</h4>
<p>I would put it in <code>commute</code>. Probably worth proving that the set of elements that commute with <code>a</code> form a subring, and perhaps that the ring generated by a set of elements that commute is commutative.</p>



<a name="202197812"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Finite%20geometric%20series/near/202197812" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Finite.20geometric.20series.html#202197812">(Jun 27 2020 at 18:04)</a>:</h4>
<p><code>commute</code> does not depend on <code>finset</code> anymore.</p>



<a name="202197875"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Finite%20geometric%20series/near/202197875" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Finite.20geometric.20series.html#202197875">(Jun 27 2020 at 18:05)</a>:</h4>
<p>We can define <code>subsemiring.centralizer</code>, then say something about <code>sum_mem</code>.</p>



<a name="202197899"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Finite%20geometric%20series/near/202197899" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Finite.20geometric.20series.html#202197899">(Jun 27 2020 at 18:05)</a>:</h4>
<p>Or just put <code>commute.sum_right</code>, <code>commute.sum_left</code>, and <code>commute.sum_sum</code> into <code>algebra.big_operators</code>.</p>



<a name="202199573"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Finite%20geometric%20series/near/202199573" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> David Wärn <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Finite.20geometric.20series.html#202199573">(Jun 27 2020 at 18:46)</a>:</h4>
<p>Another way of thinking about this: the desired result is <code>algebra.geom_sum</code> in the opposite ring <a href="https://leanprover-community.github.io/mathlib_docs/find/opposite.ring">docs#opposite.ring</a></p>



<a name="202199849"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Finite%20geometric%20series/near/202199849" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Finite.20geometric.20series.html#202199849">(Jun 27 2020 at 18:53)</a>:</h4>
<p>Nice! (-;</p>



<a name="202202130"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Finite%20geometric%20series/near/202202130" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Finite.20geometric.20series.html#202202130">(Jun 27 2020 at 19:47)</a>:</h4>
<p>Do we have a lemma that says that powers in the opposite ring are the same as powers in the original ring though?</p>



<a name="202205163"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Finite%20geometric%20series/near/202205163" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> David Wärn <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Finite.20geometric.20series.html#202205163">(Jun 27 2020 at 21:10)</a>:</h4>
<p>I don't think so. Should we? Note that this is really a result about powers in the opposite monoid</p>



<a name="202207191"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Finite%20geometric%20series/near/202207191" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bhavik Mehta <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Finite.20geometric.20series.html#202207191">(Jun 27 2020 at 22:08)</a>:</h4>
<p>I think that lemma should exist, since there's lemmas for <code>mul</code> and <code>add</code> so it seems odd to make users of the API implement the <code>pow</code> version themselves</p>



<a name="202227402"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Finite%20geometric%20series/near/202227402" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> David Wärn <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Finite.20geometric.20series.html#202227402">(Jun 28 2020 at 08:58)</a>:</h4>
<p><a href="https://github.com/leanprover-community/mathlib/issues/3211">#3211</a></p>



<a name="202234275"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Finite%20geometric%20series/near/202234275" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Finite.20geometric.20series.html#202234275">(Jun 28 2020 at 12:16)</a>:</h4>
<p>Oh, sorry, it's also in <a href="https://github.com/leanprover-community/mathlib/issues/3210">#3210</a> !</p>



<a name="202253554"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Finite%20geometric%20series/near/202253554" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Finite.20geometric.20series.html#202253554">(Jun 28 2020 at 20:29)</a>:</h4>
<p>By the way, here is my proof (from <a href="https://github.com/leanprover-community/mathlib/issues/3210">#3210</a>) of the <a href="#narrow/stream/217875-Is-there.20code.20for.20X.3F/topic/Finite.20geometric.20series/near/202191581">original fact</a>.</p>
<div class="codehilite"><pre><span></span><code><span class="kn">lemma</span> <span class="n">mul_geom_sum</span> <span class="o">[</span><span class="n">ring</span> <span class="n">α</span><span class="o">]</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="n">α</span><span class="o">)</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">)</span> <span class="o">:</span>
  <span class="o">(</span><span class="n">x</span> <span class="bp">-</span> <span class="mi">1</span><span class="o">)</span> <span class="bp">*</span> <span class="o">(</span><span class="n">geom_series</span> <span class="n">x</span> <span class="n">n</span><span class="o">)</span><span class="bp">=</span> <span class="n">x</span> <span class="bp">^</span> <span class="n">n</span> <span class="bp">-</span> <span class="mi">1</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="n">refine</span> <span class="o">(</span><span class="n">op_inj_iff</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">)</span><span class="bp">.</span><span class="n">mp</span> <span class="bp">_</span><span class="o">,</span>
  <span class="n">rw</span> <span class="o">[</span><span class="n">op_mul</span><span class="o">,</span> <span class="n">op_geom_series</span><span class="o">],</span>
  <span class="k">have</span> <span class="n">h1</span> <span class="o">:</span> <span class="n">op</span> <span class="n">x</span> <span class="bp">-</span> <span class="mi">1</span> <span class="bp">=</span> <span class="n">op</span> <span class="o">(</span><span class="n">x</span> <span class="bp">-</span> <span class="mi">1</span><span class="o">)</span> <span class="o">:=</span>
    <span class="k">by</span> <span class="n">rw</span> <span class="o">[</span><span class="err">←</span> <span class="n">op_one</span><span class="o">,</span> <span class="n">sub_eq_add_neg</span><span class="o">,</span> <span class="err">←</span> <span class="n">op_neg</span><span class="o">,</span> <span class="err">←</span> <span class="n">op_add</span><span class="o">,</span> <span class="n">sub_eq_add_neg</span><span class="o">],</span>
  <span class="n">rw</span> <span class="err">←</span> <span class="n">h1</span><span class="o">,</span>
  <span class="k">have</span> <span class="n">h2</span> <span class="o">:</span> <span class="n">op</span> <span class="n">x</span> <span class="bp">^</span> <span class="n">n</span> <span class="bp">-</span> <span class="n">op</span> <span class="mi">1</span> <span class="bp">=</span> <span class="n">op</span> <span class="o">(</span><span class="n">x</span> <span class="bp">^</span> <span class="n">n</span> <span class="bp">-</span> <span class="mi">1</span><span class="o">)</span> <span class="o">:=</span>
    <span class="k">by</span> <span class="o">{</span> <span class="n">rw</span> <span class="o">[</span><span class="n">sub_eq_add_neg</span><span class="o">,</span> <span class="err">←</span> <span class="n">op_neg</span><span class="o">,</span> <span class="err">←</span> <span class="n">op_pow</span><span class="o">,</span> <span class="err">←</span> <span class="n">op_add</span><span class="o">],</span> <span class="n">refl</span> <span class="o">},</span>
  <span class="n">rw</span> <span class="err">←</span> <span class="n">h2</span><span class="o">,</span>
  <span class="n">exact</span> <span class="n">geom_sum_mul</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">,</span>
<span class="kn">end</span>
</code></pre></div>


<p>Could this be automated?  I request a tactic <code>oppify</code>!</p>



<a name="202254527"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Finite%20geometric%20series/near/202254527" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Finite.20geometric.20series.html#202254527">(Jun 28 2020 at 20:50)</a>:</h4>
<p>Is this a job for <code>norm_cast</code>?</p>



<a name="202254616"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Finite%20geometric%20series/near/202254616" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Finite.20geometric.20series.html#202254616">(Jun 28 2020 at 20:52)</a>:</h4>
<p>I have not used <code>norm_cast</code>, but the principle looks very similar.  Would it work right now, or does someone need to rewrite the <code>norm_cast</code> tactic to include this as a suitable cast?</p>



<a name="202254744"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Finite%20geometric%20series/near/202254744" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Finite.20geometric.20series.html#202254744">(Jun 28 2020 at 20:55)</a>:</h4>
<p>You have to tag all the lemmas like <code>op_add</code> and <code>op_one</code> with @[norm_cast] and then you apply it and hope.</p>



<a name="202254842"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Finite%20geometric%20series/near/202254842" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Finite.20geometric.20series.html#202254842">(Jun 28 2020 at 20:57)</a>:</h4>
<p>I don't know what <code>op</code> is so I'm not 100% sure what I'm talking about, but here's an example of it all working with the coercion from the reals to the complexes. I tag a bunch of things <code>norm_cast</code> and then the tactic can prove "obvious" stuff. <a href="https://github.com/ImperialCollegeLondon/complex-number-game/blob/master/src/complex/Level_01_of_real.lean#L161">https://github.com/ImperialCollegeLondon/complex-number-game/blob/master/src/complex/Level_01_of_real.lean#L161</a></p>



<a name="202254847"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Finite%20geometric%20series/near/202254847" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> David Wärn <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Finite.20geometric.20series.html#202254847">(Jun 28 2020 at 20:57)</a>:</h4>
<p>I think this is a job for <code>simp</code>. There's a missing lemma for subtraction </p>
<div class="codehilite"><pre><span></span><code><span class="bp">@</span><span class="o">[</span><span class="n">simp</span><span class="o">]</span> <span class="kn">lemma</span> <span class="n">op_sub</span> <span class="o">[</span><span class="n">ring</span> <span class="n">α</span><span class="o">]</span> <span class="o">(</span><span class="n">x</span> <span class="n">y</span> <span class="o">:</span> <span class="n">α</span><span class="o">)</span> <span class="o">:</span> <span class="n">op</span> <span class="o">(</span><span class="n">x</span> <span class="bp">-</span> <span class="n">y</span><span class="o">)</span> <span class="bp">=</span> <span class="n">op</span> <span class="n">x</span> <span class="bp">-</span> <span class="n">op</span> <span class="n">y</span> <span class="o">:=</span> <span class="n">rfl</span>

<span class="kn">lemma</span> <span class="n">mul_geom_sum</span> <span class="o">[</span><span class="n">ring</span> <span class="n">α</span><span class="o">]</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="n">α</span><span class="o">)</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">)</span> <span class="o">:</span>
  <span class="o">(</span><span class="n">x</span> <span class="bp">-</span> <span class="mi">1</span><span class="o">)</span> <span class="bp">*</span> <span class="o">(</span><span class="n">geom_series</span> <span class="n">x</span> <span class="n">n</span><span class="o">)</span><span class="bp">=</span> <span class="n">x</span> <span class="bp">^</span> <span class="n">n</span> <span class="bp">-</span> <span class="mi">1</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="n">rw</span> <span class="err">←</span><span class="n">op_inj_iff</span><span class="o">,</span>
  <span class="n">simpa</span> <span class="o">[</span><span class="n">op_geom_series</span><span class="o">]</span> <span class="kn">using</span> <span class="n">geom_sum_mul</span> <span class="o">(</span><span class="n">op</span> <span class="n">x</span><span class="o">)</span> <span class="n">n</span><span class="o">,</span>
<span class="kn">end</span>
</code></pre></div>



<a name="202254947"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Finite%20geometric%20series/near/202254947" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Finite.20geometric.20series.html#202254947">(Jun 28 2020 at 20:59)</a>:</h4>
<p>If <code>simp</code> can manage it, then great! <code>norm_cast</code> was developed because of Mario's insistence that <code>simp</code> was not a great tool for this kind of problem in general.</p>



<a name="202259607"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Finite%20geometric%20series/near/202259607" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Finite.20geometric.20series.html#202259607">(Jun 28 2020 at 23:03)</a>:</h4>
<p>Works beautifully, thank you <span class="user-mention" data-user-id="130377">@David Wärn</span> !</p>



<a name="202267890"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Finite%20geometric%20series/near/202267890" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Finite.20geometric.20series.html#202267890">(Jun 29 2020 at 03:01)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110038">Kevin Buzzard</span> <a href="#narrow/stream/217875-Is-there.20code.20for.20X.3F/topic/Finite.20geometric.20series/near/202254947">said</a>:</p>
<blockquote>
<p>If <code>simp</code> can manage it, then great! <code>norm_cast</code> was developed because of Mario's insistence that <code>simp</code> was not a great tool for this kind of problem in general.</p>
</blockquote>
<p>To clarify, <code>simp</code>is good if what you want to do is push all the coercions to the leaves, for example if you want to prove a theorem about <code>nat</code> by applying <code>int.coe_nat_inj</code> and then use <code>simp</code> to put an up arrow on every variable. If you want to do the opposite, pulling all the up arrows to the top level so they can be eliminated (like if we wanted to do the reverse of the nat -&gt; int process just described), then <code>simp</code> will fight you because you are going uphill relative to simp normal form</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>