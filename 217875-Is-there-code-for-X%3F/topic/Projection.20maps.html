---
layout: archive
title: Zulip Chat Archive
permalink: /stream/217875-Is-there-code-for-X%3F/topic/Projection.20maps.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/index.html">Is there code for X?</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Projection.20maps.html">Projection maps</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="261442346"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Projection%20maps/near/261442346" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Antoine Labelle <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Projection.20maps.html#261442346">(Nov 14 2021 at 22:46)</a>:</h4>
<p>Hi,<br>
Do we have basic results about projection maps in linear algebra (i.e. linear maps T such that T^2 = T), such as equivalences between different definitions (every element in the range being fixed, being diagonalisable with 0-1 eigenvalues)?<br>
Specifically I need the result that the trace of a projection is the dimension of the range, which I couldn't find but would follow easily from these equivalences.</p>



<a name="261449848"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Projection%20maps/near/261449848" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Projection.20maps.html#261449848">(Nov 15 2021 at 01:49)</a>:</h4>
<p><span class="user-mention" data-user-id="329754">@Antoine Labelle</span> I think this mostly doesn't exist yet (but would be good to have!). The closest I can find is <a href="https://leanprover-community.github.io/mathlib_docs/find/submodule.is_compl_equiv_proj">docs#submodule.is_compl_equiv_proj</a>, proving that projection maps are in natural correspondence with internal direct sum decompositions of a vector space.  If you can't be bothered building up a full theory, you could probably get the fact you need from this directly :)</p>



<a name="261566895"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Projection%20maps/near/261566895" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Antoine Labelle <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Projection.20maps.html#261566895">(Nov 15 2021 at 22:08)</a>:</h4>
<p>How much do we have about direct sums of linear maps? In particular do we have that the matrix corresponding to a direct sum of linear maps is block-diagonal, and do we have a good dictionnary between internal and external direct sums?</p>



<a name="261567113"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Projection%20maps/near/261567113" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Projection.20maps.html#261567113">(Nov 15 2021 at 22:10)</a>:</h4>
<p>Are you talking about a linear map of direct sums formed by a separate linear map for each piece?</p>



<a name="261567196"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Projection%20maps/near/261567196" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Projection.20maps.html#261567196">(Nov 15 2021 at 22:11)</a>:</h4>
<p>(If so, that's sort of <a href="https://leanprover-community.github.io/mathlib_docs/find/direct_sum.to_module">docs#direct_sum.to_module</a>, but you have to post-compose with <a href="https://leanprover-community.github.io/mathlib_docs/find/direct_sum.lof">docs#direct_sum.lof</a> yourself)</p>



<a name="261567262"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Projection%20maps/near/261567262" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Projection.20maps.html#261567262">(Nov 15 2021 at 22:11)</a>:</h4>
<blockquote>
<p>and do we have a good dictionnary between internal and external direct sums?</p>
</blockquote>
<p>Currently the approach we've been taking is "an internal direct sum is just an external direct sum of submodules"</p>



<a name="261567356"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Projection%20maps/near/261567356" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Projection.20maps.html#261567356">(Nov 15 2021 at 22:12)</a>:</h4>
<p>We have almost no API for internal direct sums of modules beyond <a href="https://leanprover-community.github.io/mathlib_docs/find/direct_sum.submodule_is_internal">docs#direct_sum.submodule_is_internal</a> and the things near it</p>



<a name="261567500"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Projection%20maps/near/261567500" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Projection.20maps.html#261567500">(Nov 15 2021 at 22:13)</a>:</h4>
<p>Nevermind, it seems <span class="user-mention" data-user-id="260507">@Heather Macbeth</span> added a bunch of useful API <span aria-label="tada" class="emoji emoji-1f389" role="img" title="tada">:tada:</span></p>



<a name="261568099"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Projection%20maps/near/261568099" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Antoine Labelle <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Projection.20maps.html#261568099">(Nov 15 2021 at 22:18)</a>:</h4>
<p>Thanks, I'll look that up. And do you know if we have translations with block-diagonal matrices, which I think would be needed to show that the trace is additive under direct sum.</p>



<a name="261568362"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Projection%20maps/near/261568362" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Projection.20maps.html#261568362">(Nov 15 2021 at 22:20)</a>:</h4>
<p>Not sure what you mean by translation, but you probably want <a href="https://leanprover-community.github.io/mathlib_docs/find/matrix.block_diagonal'">docs#matrix.block_diagonal'</a> since the unprimed version will only work with a direct sum of copies of the same module</p>



<a name="261568403"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Projection%20maps/near/261568403" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Projection.20maps.html#261568403">(Nov 15 2021 at 22:21)</a>:</h4>
<p><span class="user-mention" data-user-id="329754">@Antoine Labelle</span> Are you sure you want to work with matrices?  Linear algebra is often easier if you don't :)</p>



<a name="261568553"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Projection%20maps/near/261568553" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Antoine Labelle <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Projection.20maps.html#261568553">(Nov 15 2021 at 22:22)</a>:</h4>
<p>I'd prefer not to but trace is currently defined in terms of matrices, so I guess I don't really have the choice</p>



<a name="261568603"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Projection%20maps/near/261568603" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Antoine Labelle <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Projection.20maps.html#261568603">(Nov 15 2021 at 22:23)</a>:</h4>
<p>Unless we have a basis-free definition of trace that I'm not aware of?</p>



<a name="261568902"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Projection%20maps/near/261568902" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Projection.20maps.html#261568902">(Nov 15 2021 at 22:25)</a>:</h4>
<p>We have <a href="https://leanprover-community.github.io/mathlib_docs/find/linear_map.trace">docs#linear_map.trace</a>, but is what you're saying that the only way to prove something about the trace is to go to a basis?</p>



<a name="261569072"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Projection%20maps/near/261569072" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Projection.20maps.html#261569072">(Nov 15 2021 at 22:27)</a>:</h4>
<p>Working back from your question yesterday about projection maps, I think perhaps what you need here is that trace of <a href="https://leanprover-community.github.io/mathlib_docs/find/linear_map.prod_map">docs#linear_map.prod_map</a> of two endomorphisms is the sum of their traces?</p>



<a name="261569216"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Projection%20maps/near/261569216" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Projection.20maps.html#261569216">(Nov 15 2021 at 22:28)</a>:</h4>
<p>And while you're at it, the same result for <a href="https://leanprover-community.github.io/mathlib_docs/find/dfinsupp.map_range.linear_map">docs#dfinsupp.map_range.linear_map</a></p>



<a name="261569932"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Projection%20maps/near/261569932" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Antoine Labelle <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Projection.20maps.html#261569932">(Nov 15 2021 at 22:34)</a>:</h4>
<p><span class="user-mention silent" data-user-id="260507">Heather Macbeth</span> <a href="#narrow/stream/217875-Is-there.20code.20for.20X.3F/topic/Projection.20maps/near/261568902">said</a>:</p>
<blockquote>
<p>We have <a href="https://leanprover-community.github.io/mathlib_docs/find/linear_map.trace">docs#linear_map.trace</a>, but is what you're saying that the only way to prove something about the trace is to go to a basis?</p>
</blockquote>
<p>It looks to me like we don't really have the choice, since the definition of <a href="https://leanprover-community.github.io/mathlib_docs/find/linear_map.trace">docs#linear_map.trace</a> is by picking a basis and taking the trace of the corresponding matrix. And we seem to have very few lemmas about the trace of a linear map, so I feel like the matrix definition is pretty much unavoidable. That being said it would be very cool to have a true basis-free definition of trace using the isomorphism <code>Hom(V,W)=V*⊗ W</code> and evaluation map.</p>



<a name="261570163"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Projection%20maps/near/261570163" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Antoine Labelle <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Projection.20maps.html#261570163">(Nov 15 2021 at 22:37)</a>:</h4>
<p><span class="user-mention silent" data-user-id="260507">Heather Macbeth</span> <a href="#narrow/stream/217875-Is-there.20code.20for.20X.3F/topic/Projection.20maps/near/261569072">said</a>:</p>
<blockquote>
<p>Working back from your question yesterday about projection maps, I think perhaps what you need here is that trace of <a href="https://leanprover-community.github.io/mathlib_docs/find/linear_map.prod_map">docs#linear_map.prod_map</a> of two endomorphisms is the sum of their traces?</p>
</blockquote>
<p>Right, that's exactly what I'd need for the trace of projection maps (or actually I guess an internal version of that)</p>



<a name="261618434"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Projection%20maps/near/261618434" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Oliver Nash <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Projection.20maps.html#261618434">(Nov 16 2021 at 09:59)</a>:</h4>
<p>I think the thing to do here is to fill this <code>sorry</code> so that nobody else has to drop down to matrices again unless they want to:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">linear_algebra.contraction</span>
<span class="kn">import</span> <span class="n">linear_algebra.trace</span>

<span class="n">open_locale</span> <span class="n">tensor_product</span>

<span class="kd">variables</span> <span class="o">(</span><span class="n">R</span> <span class="n">M</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">[</span><span class="n">field</span> <span class="n">R</span><span class="o">]</span> <span class="o">[</span><span class="n">add_comm_group</span> <span class="n">M</span><span class="o">]</span> <span class="o">[</span><span class="n">module</span> <span class="n">R</span> <span class="n">M</span><span class="o">]</span>

<span class="kd">lemma</span> <span class="n">trace_eq_contract</span> <span class="o">[</span><span class="n">finite_dimensional</span> <span class="n">R</span> <span class="n">M</span><span class="o">]</span> <span class="o">:</span>
  <span class="o">(</span><span class="n">linear_map.trace</span> <span class="n">R</span> <span class="n">M</span><span class="o">)</span> <span class="bp">∘ₗ</span> <span class="o">(</span><span class="n">dual_tensor_hom</span> <span class="n">R</span> <span class="n">M</span> <span class="n">M</span><span class="o">)</span> <span class="bp">=</span> <span class="n">contract_left</span> <span class="n">R</span> <span class="n">M</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="gr">sorry</span><span class="o">,</span>
<span class="kd">end</span>
</code></pre></div>



<a name="261618927"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Projection%20maps/near/261618927" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Oliver Nash <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Projection.20maps.html#261618927">(Nov 16 2021 at 10:03)</a>:</h4>
<p>(And also prove that <code>dual_tensor_hom R M M</code> is an equiv subject to the relevant hypothesis and thus get a formula for trace in terms of its inverse and contraction.)</p>



<a name="261692577"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Projection%20maps/near/261692577" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Antoine Labelle <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Projection.20maps.html#261692577">(Nov 16 2021 at 19:19)</a>:</h4>
<p>I'll try to tackle that!</p>



<a name="261692645"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Projection%20maps/near/261692645" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Antoine Labelle <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Projection.20maps.html#261692645">(Nov 16 2021 at 19:19)</a>:</h4>
<p>Is there a lemma for linear maps agreeing iff they agree on a basis?</p>



<a name="261692837"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Projection%20maps/near/261692837" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Projection.20maps.html#261692837">(Nov 16 2021 at 19:21)</a>:</h4>
<p>Yup, <a href="https://leanprover-community.github.io/mathlib_docs/find/basis.ext">docs#basis.ext</a></p>



<a name="261832167"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Projection%20maps/near/261832167" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Antoine Labelle <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Projection.20maps.html#261832167">(Nov 17 2021 at 19:02)</a>:</h4>
<p><span class="user-mention silent" data-user-id="240862">Oliver Nash</span> <a href="#narrow/stream/217875-Is-there.20code.20for.20X.3F/topic/Projection.20maps/near/261618434">said</a>:</p>
<blockquote>
<p>I think the thing to do here is to fill this <code>sorry</code> so that nobody else has to drop down to matrices again unless they want to:</p>
<p><div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">linear_algebra.contraction</span>
<span class="kn">import</span> <span class="n">linear_algebra.trace</span>

<span class="n">open_locale</span> <span class="n">tensor_product</span>

<span class="kd">variables</span> <span class="o">(</span><span class="n">R</span> <span class="n">M</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">[</span><span class="n">field</span> <span class="n">R</span><span class="o">]</span> <span class="o">[</span><span class="n">add_comm_group</span> <span class="n">M</span><span class="o">]</span> <span class="o">[</span><span class="n">module</span> <span class="n">R</span> <span class="n">M</span><span class="o">]</span>

<span class="kd">lemma</span> <span class="n">trace_eq_contract</span> <span class="o">[</span><span class="n">finite_dimensional</span> <span class="n">R</span> <span class="n">M</span><span class="o">]</span> <span class="o">:</span>
  <span class="o">(</span><span class="n">linear_map.trace</span> <span class="n">R</span> <span class="n">M</span><span class="o">)</span> <span class="bp">∘ₗ</span> <span class="o">(</span><span class="n">dual_tensor_hom</span> <span class="n">R</span> <span class="n">M</span> <span class="n">M</span><span class="o">)</span> <span class="bp">=</span> <span class="n">contract_left</span> <span class="n">R</span> <span class="n">M</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="gr">sorry</span><span class="o">,</span>
<span class="kd">end</span>
</code></pre></div><br>
</p>
</blockquote>
<p>PR'd! <a href="https://github.com/leanprover-community/mathlib/issues/10372">#10372</a></p>



<a name="261848731"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Projection%20maps/near/261848731" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Oliver Nash <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Projection.20maps.html#261848731">(Nov 17 2021 at 21:02)</a>:</h4>
<p><span class="user-mention silent" data-user-id="329754">Antoine Labelle</span> <a href="#narrow/stream/217875-Is-there.20code.20for.20X.3F/topic/Projection.20maps/near/261832167">said</a>:</p>
<blockquote>
<p>PR'd! <a href="https://github.com/leanprover-community/mathlib/issues/10372">#10372</a></p>
</blockquote>
<p>This looks great. I just left some review remarks but overall this is really great.</p>



<a name="261849634"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Projection%20maps/near/261849634" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Projection.20maps.html#261849634">(Nov 17 2021 at 21:09)</a>:</h4>
<p>Seems to fill a nice number of lemma holes elsewhere too</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>