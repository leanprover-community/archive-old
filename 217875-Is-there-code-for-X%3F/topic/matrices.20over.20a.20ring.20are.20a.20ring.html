---
layout: archive
title: Zulip Chat Archive
permalink: /stream/217875-Is-there-code-for-X%3F/topic/matrices.20over.20a.20ring.20are.20a.20ring.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/index.html">Is there code for X?</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/matrices.20over.20a.20ring.20are.20a.20ring.html">matrices over a ring are a ring</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="198706507"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/matrices%20over%20a%20ring%20are%20a%20ring/near/198706507" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Aniruddh Agarwal <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/matrices.20over.20a.20ring.20are.20a.20ring.html#198706507">(May 25 2020 at 22:38)</a>:</h4>
<p>I can't find the statement that matrices over a ring form a ring in mathlib</p>



<a name="198706524"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/matrices%20over%20a%20ring%20are%20a%20ring/near/198706524" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/matrices.20over.20a.20ring.20are.20a.20ring.html#198706524">(May 25 2020 at 22:39)</a>:</h4>
<p>does <code>apply_instance</code> find it?</p>



<a name="198706587"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/matrices%20over%20a%20ring%20are%20a%20ring/near/198706587" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Aniruddh Agarwal <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/matrices.20over.20a.20ring.20are.20a.20ring.html#198706587">(May 25 2020 at 22:40)</a>:</h4>
<p>I don't know what <code>apply_instance</code> is, but I'm looking it up now</p>



<a name="198706597"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/matrices%20over%20a%20ring%20are%20a%20ring/near/198706597" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/matrices.20over.20a.20ring.20are.20a.20ring.html#198706597">(May 25 2020 at 22:40)</a>:</h4>
<p><a href="https://leanprover-community.github.io/mathlib_docs/data/matrix/basic.html#matrix.ring">https://leanprover-community.github.io/mathlib_docs/data/matrix/basic.html#matrix.ring</a></p>



<a name="198706611"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/matrices%20over%20a%20ring%20are%20a%20ring/near/198706611" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/matrices.20over.20a.20ring.20are.20a.20ring.html#198706611">(May 25 2020 at 22:41)</a>:</h4>
<p>ah, you are probably missing the <code>decidable_eq</code> assumption</p>



<a name="198706676"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/matrices%20over%20a%20ring%20are%20a%20ring/near/198706676" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/matrices.20over.20a.20ring.20are.20a.20ring.html#198706676">(May 25 2020 at 22:42)</a>:</h4>
<p>In mathlib you don't usually explicitly reference a proof that says that some type is a ring, you let typeclass inference find it for you and just use <code>*</code> and <code>mul_add</code> and so on without reference to this instance</p>



<a name="198717137"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/matrices%20over%20a%20ring%20are%20a%20ring/near/198717137" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/matrices.20over.20a.20ring.20are.20a.20ring.html#198717137">(May 26 2020 at 03:17)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110049">Mario Carneiro</span> <a href="#narrow/stream/217875-Is-there.20code.20for.20X.3F/topic/matrices.20over.20a.20ring.20are.20a.20ring/near/198706611">said</a>:</p>
<blockquote>
<p>ah, you are probably missing the <code>decidable_eq</code> assumption</p>
</blockquote>
<p>Do we want to keep that assumption?</p>



<a name="198717178"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/matrices%20over%20a%20ring%20are%20a%20ring/near/198717178" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/matrices.20over.20a.20ring.20are.20a.20ring.html#198717178">(May 26 2020 at 03:18)</a>:</h4>
<p>yes, I think</p>



<a name="198717182"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/matrices%20over%20a%20ring%20are%20a%20ring/near/198717182" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/matrices.20over.20a.20ring.20are.20a.20ring.html#198717182">(May 26 2020 at 03:18)</a>:</h4>
<p>to a mathematician it's only ever instantiated at <code>fin n</code> so the decidable assumption is no problem</p>



<a name="198717198"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/matrices%20over%20a%20ring%20are%20a%20ring/near/198717198" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/matrices.20over.20a.20ring.20are.20a.20ring.html#198717198">(May 26 2020 at 03:19)</a>:</h4>
<p>also I imagine people might want to actually compute with the matrix type</p>



<a name="198717202"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/matrices%20over%20a%20ring%20are%20a%20ring/near/198717202" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/matrices.20over.20a.20ring.20are.20a.20ring.html#198717202">(May 26 2020 at 03:19)</a>:</h4>
<p>Hmm... the reason we generalized to arbitrary fintypes is exactly because we could have random fintypes showing up as index type for a basis.</p>



<a name="198717209"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/matrices%20over%20a%20ring%20are%20a%20ring/near/198717209" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/matrices.20over.20a.20ring.20are.20a.20ring.html#198717209">(May 26 2020 at 03:19)</a>:</h4>
<p>oh, the mathematician is wrong of course</p>



<a name="198717252"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/matrices%20over%20a%20ring%20are%20a%20ring/near/198717252" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/matrices.20over.20a.20ring.20are.20a.20ring.html#198717252">(May 26 2020 at 03:20)</a>:</h4>
<p>But is this implementation efficient for computations? I guess we'll want <code>sparse_matrix</code> and <code>fast_matrix</code> and whatever, once we start computing</p>



<a name="198717254"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/matrices%20over%20a%20ring%20are%20a%20ring/near/198717254" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/matrices.20over.20a.20ring.20are.20a.20ring.html#198717254">(May 26 2020 at 03:20)</a>:</h4>
<p>It's not, really</p>



<a name="198717256"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/matrices%20over%20a%20ring%20are%20a%20ring/near/198717256" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/matrices.20over.20a.20ring.20are.20a.20ring.html#198717256">(May 26 2020 at 03:20)</a>:</h4>
<p>I think this is a function on fin n? That's got pretty poor access overhead</p>



<a name="198717258"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/matrices%20over%20a%20ring%20are%20a%20ring/near/198717258" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/matrices.20over.20a.20ring.20are.20a.20ring.html#198717258">(May 26 2020 at 03:20)</a>:</h4>
<p>If you just want to compute a simple expression with <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>2</mn><mo>×</mo><mn>2</mn></mrow><annotation encoding="application/x-tex">2\times 2</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">2</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">2</span></span></span></span> matrices then any implementation is efficient.</p>



<a name="198717268"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/matrices%20over%20a%20ring%20are%20a%20ring/near/198717268" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/matrices.20over.20a.20ring.20are.20a.20ring.html#198717268">(May 26 2020 at 03:21)</a>:</h4>
<p>If you want to compute on <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>2</mn><mo>×</mo><mn>2</mn></mrow><annotation encoding="application/x-tex">2\times 2</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">2</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">2</span></span></span></span> matrices a it is better to have a good defeq and "force" the results using <code>rfl</code></p>



<a name="198717273"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/matrices%20over%20a%20ring%20are%20a%20ring/near/198717273" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/matrices.20over.20a.20ring.20are.20a.20ring.html#198717273">(May 26 2020 at 03:21)</a>:</h4>
<p>that is, if you want to compute in a proof</p>



<a name="198717317"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/matrices%20over%20a%20ring%20are%20a%20ring/near/198717317" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/matrices.20over.20a.20ring.20are.20a.20ring.html#198717317">(May 26 2020 at 03:22)</a>:</h4>
<p>if you want to compute in <code>#eval</code> then anything is efficient but you will probably be looking at bigger matrices</p>



<a name="198717480"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/matrices%20over%20a%20ring%20are%20a%20ring/near/198717480" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/matrices.20over.20a.20ring.20are.20a.20ring.html#198717480">(May 26 2020 at 03:27)</a>:</h4>
<p>This seems to work fairly well:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="n">data</span><span class="bp">.</span><span class="n">matrix</span><span class="bp">.</span><span class="kn">notation</span>

<span class="n">def</span> <span class="n">foo</span> <span class="o">:</span> <span class="n">matrix</span> <span class="o">(</span><span class="n">fin</span> <span class="mi">3</span><span class="o">)</span> <span class="o">(</span><span class="n">fin</span> <span class="mi">3</span><span class="o">)</span> <span class="bp">ℤ</span> <span class="o">:=</span> <span class="bp">!</span><span class="o">[</span><span class="bp">!</span><span class="o">[</span><span class="mi">1</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span><span class="mi">1</span><span class="o">],</span><span class="bp">!</span><span class="o">[</span><span class="mi">1</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="mi">1</span><span class="o">],</span><span class="bp">!</span><span class="o">[</span><span class="mi">1</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span><span class="mi">1</span><span class="o">]]</span>

<span class="n">def</span> <span class="n">to_list</span> <span class="o">{</span><span class="n">α</span> <span class="n">m</span> <span class="n">n</span><span class="o">}</span> <span class="o">(</span><span class="n">M</span> <span class="o">:</span> <span class="n">matrix</span> <span class="o">(</span><span class="n">fin</span> <span class="n">m</span><span class="o">)</span> <span class="o">(</span><span class="n">fin</span> <span class="n">n</span><span class="o">)</span> <span class="n">α</span><span class="o">)</span> <span class="o">:</span> <span class="n">list</span> <span class="o">(</span><span class="n">list</span> <span class="n">α</span><span class="o">)</span> <span class="o">:=</span>
<span class="n">list</span><span class="bp">.</span><span class="n">of_fn</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">i</span><span class="o">,</span> <span class="n">list</span><span class="bp">.</span><span class="n">of_fn</span> <span class="o">(</span><span class="n">M</span> <span class="n">i</span><span class="o">))</span>

<span class="bp">#</span><span class="kn">eval</span> <span class="n">to_list</span> <span class="o">(</span><span class="n">foo</span> <span class="bp">^</span> <span class="mi">10</span><span class="o">)</span>
</code></pre></div>



<a name="198717546"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/matrices%20over%20a%20ring%20are%20a%20ring/near/198717546" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/matrices.20over.20a.20ring.20are.20a.20ring.html#198717546">(May 26 2020 at 03:28)</a>:</h4>
<p>I suspect it doesn't scale the way it should though because it doesn't cache intermediate values</p>



<a name="198717764"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/matrices%20over%20a%20ring%20are%20a%20ring/near/198717764" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/matrices.20over.20a.20ring.20are.20a.20ring.html#198717764">(May 26 2020 at 03:35)</a>:</h4>
<p>maybe we need to modify norm_num again</p>



<a name="198717975"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/matrices%20over%20a%20ring%20are%20a%20ring/near/198717975" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/matrices.20over.20a.20ring.20are.20a.20ring.html#198717975">(May 26 2020 at 03:41)</a>:</h4>
<p>Looking at the contents of <code>data.matrix.notation</code>, it seems like there are enough simp lemmas that <code>norm_num</code> should Just Work</p>



<a name="198718116"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/matrices%20over%20a%20ring%20are%20a%20ring/near/198718116" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/matrices.20over.20a.20ring.20are.20a.20ring.html#198718116">(May 26 2020 at 03:45)</a>:</h4>
<p>Ah, <code>simp</code> gets stuck on the power operation. But still it gets pretty close:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="n">data</span><span class="bp">.</span><span class="n">matrix</span><span class="bp">.</span><span class="kn">notation</span>

<span class="n">def</span> <span class="n">foo</span> <span class="o">:</span> <span class="n">matrix</span> <span class="o">(</span><span class="n">fin</span> <span class="mi">3</span><span class="o">)</span> <span class="o">(</span><span class="n">fin</span> <span class="mi">3</span><span class="o">)</span> <span class="bp">ℤ</span> <span class="o">:=</span> <span class="bp">!</span><span class="o">[</span><span class="bp">!</span><span class="o">[</span><span class="mi">1</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span><span class="mi">1</span><span class="o">],</span><span class="bp">!</span><span class="o">[</span><span class="mi">1</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="mi">1</span><span class="o">],</span><span class="bp">!</span><span class="o">[</span><span class="mi">1</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span><span class="mi">1</span><span class="o">]]</span>

<span class="kn">example</span> <span class="o">:</span> <span class="n">foo</span> <span class="bp">^</span> <span class="mi">10</span> <span class="bp">=</span> <span class="bp">!</span><span class="o">[</span><span class="bp">!</span><span class="o">[</span><span class="mi">9136</span><span class="o">,</span> <span class="mi">6688</span><span class="o">,</span> <span class="mi">9136</span><span class="o">],</span> <span class="bp">!</span><span class="o">[</span><span class="mi">6688</span><span class="o">,</span> <span class="mi">4896</span><span class="o">,</span> <span class="mi">6688</span><span class="o">],</span> <span class="bp">!</span><span class="o">[</span><span class="mi">9136</span><span class="o">,</span> <span class="mi">6688</span><span class="o">,</span> <span class="mi">9136</span><span class="o">]]</span> <span class="o">:=</span>
<span class="k">by</span> <span class="n">simp</span> <span class="o">[</span><span class="n">pow_succ</span><span class="o">]</span><span class="bp">;</span> <span class="n">norm_num</span> <span class="o">[</span><span class="n">foo</span><span class="o">]</span>
</code></pre></div>



<a name="198718463"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/matrices%20over%20a%20ring%20are%20a%20ring/near/198718463" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/matrices.20over.20a.20ring.20are.20a.20ring.html#198718463">(May 26 2020 at 03:57)</a>:</h4>
<p><span class="user-mention" data-user-id="110049">@Mario Carneiro</span> <code>norm_num</code> does cache intermediate results, does it?</p>



<a name="198718465"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/matrices%20over%20a%20ring%20are%20a%20ring/near/198718465" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/matrices.20over.20a.20ring.20are.20a.20ring.html#198718465">(May 26 2020 at 03:57)</a>:</h4>
<p>Can we teach <code>norm_num</code> about repeated squaring?</p>



<a name="198718466"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/matrices%20over%20a%20ring%20are%20a%20ring/near/198718466" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/matrices.20over.20a.20ring.20are.20a.20ring.html#198718466">(May 26 2020 at 03:57)</a>:</h4>
<p>It already knows</p>



<a name="198718507"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/matrices%20over%20a%20ring%20are%20a%20ring/near/198718507" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/matrices.20over.20a.20ring.20are.20a.20ring.html#198718507">(May 26 2020 at 03:58)</a>:</h4>
<p>Hmm, but why the <code>pow_succ</code>, in that case?</p>



<a name="198718512"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/matrices%20over%20a%20ring%20are%20a%20ring/near/198718512" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/matrices.20over.20a.20ring.20are.20a.20ring.html#198718512">(May 26 2020 at 03:58)</a>:</h4>
<p><code>norm_num</code> only knows how to multiply numbers</p>



<a name="198718515"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/matrices%20over%20a%20ring%20are%20a%20ring/near/198718515" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/matrices.20over.20a.20ring.20are.20a.20ring.html#198718515">(May 26 2020 at 03:58)</a>:</h4>
<p>It should compute <code>foo ^ 2</code>, <code>foo ^ 4</code>, <code>foo ^ 8</code> and then <code>foo ^ 8 * foo ^ 2</code>.</p>



<a name="198718518"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/matrices%20over%20a%20ring%20are%20a%20ring/near/198718518" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/matrices.20over.20a.20ring.20are.20a.20ring.html#198718518">(May 26 2020 at 03:58)</a>:</h4>
<p><code>simp</code> knows how to multply other things but it doesn't know repeated squaring</p>



<a name="198718524"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/matrices%20over%20a%20ring%20are%20a%20ring/near/198718524" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/matrices.20over.20a.20ring.20are.20a.20ring.html#198718524">(May 26 2020 at 03:59)</a>:</h4>
<p>So we need a simp-lemma <code>pow_bit0</code>?</p>



<a name="198718534"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/matrices%20over%20a%20ring%20are%20a%20ring/near/198718534" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/matrices.20over.20a.20ring.20are.20a.20ring.html#198718534">(May 26 2020 at 03:59)</a>:</h4>
<p>Which is a first approximation to repeated squaring</p>



<a name="198718536"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/matrices%20over%20a%20ring%20are%20a%20ring/near/198718536" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/matrices.20over.20a.20ring.20are.20a.20ring.html#198718536">(May 26 2020 at 03:59)</a>:</h4>
<p><code>norm_num</code> also doesn't do common subexpression elimination before trying to evaluate</p>



<a name="198718546"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/matrices%20over%20a%20ring%20are%20a%20ring/near/198718546" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/matrices.20over.20a.20ring.20are.20a.20ring.html#198718546">(May 26 2020 at 04:00)</a>:</h4>
<p><code>simp</code> can only set up the goal here as <code>foo * foo * ... * foo</code> in some associativity</p>



<a name="198718598"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/matrices%20over%20a%20ring%20are%20a%20ring/near/198718598" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/matrices.20over.20a.20ring.20are.20a.20ring.html#198718598">(May 26 2020 at 04:00)</a>:</h4>
<p>But it should be able to set it up as something smarter</p>



<a name="198718605"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/matrices%20over%20a%20ring%20are%20a%20ring/near/198718605" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/matrices.20over.20a.20ring.20are.20a.20ring.html#198718605">(May 26 2020 at 04:00)</a>:</h4>
<p>not really, what expression should it produce that is better?</p>



<a name="198718617"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/matrices%20over%20a%20ring%20are%20a%20ring/near/198718617" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/matrices.20over.20a.20ring.20are.20a.20ring.html#198718617">(May 26 2020 at 04:01)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110049">Mario Carneiro</span> <a href="#narrow/stream/217875-Is-there.20code.20for.20X.3F/topic/matrices.20over.20a.20ring.20are.20a.20ring/near/198718536">said</a>:</p>
<blockquote>
<p><code>norm_num</code> also doesn't do common subexpression elimination before trying to evaluate</p>
</blockquote>
<p>Would it help to teach <code>norm_num</code> about this?</p>



<a name="198718620"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/matrices%20over%20a%20ring%20are%20a%20ring/near/198718620" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/matrices.20over.20a.20ring.20are.20a.20ring.html#198718620">(May 26 2020 at 04:01)</a>:</h4>
<p>maybe, but it might also make general use slower</p>



<a name="198718624"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/matrices%20over%20a%20ring%20are%20a%20ring/near/198718624" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/matrices.20over.20a.20ring.20are.20a.20ring.html#198718624">(May 26 2020 at 04:01)</a>:</h4>
<p>Right now <code>norm_num</code> is mostly relying on <code>simp</code> to give it a clean input</p>



<a name="198718662"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/matrices%20over%20a%20ring%20are%20a%20ring/near/198718662" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/matrices.20over.20a.20ring.20are.20a.20ring.html#198718662">(May 26 2020 at 04:02)</a>:</h4>
<p>it would have to orchestrate more of the process in order to do these things</p>



<a name="198718680"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/matrices%20over%20a%20ring%20are%20a%20ring/near/198718680" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/matrices.20over.20a.20ring.20are.20a.20ring.html#198718680">(May 26 2020 at 04:03)</a>:</h4>
<p>Plus, with the code above <code>simp</code> will hand a term like <code>foo * (foo * (foo * ...))</code> anyway so there is no CSE to be had</p>



<a name="198718684"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/matrices%20over%20a%20ring%20are%20a%20ring/near/198718684" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/matrices.20over.20a.20ring.20are.20a.20ring.html#198718684">(May 26 2020 at 04:03)</a>:</h4>
<p>Is there a simp-set that's specifically for <code>norm_num</code>?</p>



<a name="198718686"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/matrices%20over%20a%20ring%20are%20a%20ring/near/198718686" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/matrices.20over.20a.20ring.20are.20a.20ring.html#198718686">(May 26 2020 at 04:03)</a>:</h4>
<p>no</p>



<a name="198718687"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/matrices%20over%20a%20ring%20are%20a%20ring/near/198718687" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/matrices.20over.20a.20ring.20are.20a.20ring.html#198718687">(May 26 2020 at 04:03)</a>:</h4>
<p>Should there be?</p>



<a name="198718727"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/matrices%20over%20a%20ring%20are%20a%20ring/near/198718727" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/matrices.20over.20a.20ring.20are.20a.20ring.html#198718727">(May 26 2020 at 04:04)</a>:</h4>
<p>hard to say</p>



<a name="198718729"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/matrices%20over%20a%20ring%20are%20a%20ring/near/198718729" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/matrices.20over.20a.20ring.20are.20a.20ring.html#198718729">(May 26 2020 at 04:04)</a>:</h4>
<p>most simp lemmas seem to be useful in norm_num</p>



<a name="198718734"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/matrices%20over%20a%20ring%20are%20a%20ring/near/198718734" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/matrices.20over.20a.20ring.20are.20a.20ring.html#198718734">(May 26 2020 at 04:04)</a>:</h4>
<p>except possibly the ones about numbers</p>



<a name="198718741"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/matrices%20over%20a%20ring%20are%20a%20ring/near/198718741" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/matrices.20over.20a.20ring.20are.20a.20ring.html#198718741">(May 26 2020 at 04:05)</a>:</h4>
<p>I mean the other way round</p>



<a name="198718760"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/matrices%20over%20a%20ring%20are%20a%20ring/near/198718760" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/matrices.20over.20a.20ring.20are.20a.20ring.html#198718760">(May 26 2020 at 04:05)</a>:</h4>
<p>Some simp lemmas are maybe only useful for norm num</p>



<a name="198718763"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/matrices%20over%20a%20ring%20are%20a%20ring/near/198718763" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/matrices.20over.20a.20ring.20are.20a.20ring.html#198718763">(May 26 2020 at 04:05)</a>:</h4>
<p>But you don't want them in a random simp call</p>



<a name="198718764"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/matrices%20over%20a%20ring%20are%20a%20ring/near/198718764" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/matrices.20over.20a.20ring.20are.20a.20ring.html#198718764">(May 26 2020 at 04:05)</a>:</h4>
<p>I suppose there are some lemmas that you probably don't want to use unless you are trying to normalize</p>



<a name="198718822"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/matrices%20over%20a%20ring%20are%20a%20ring/near/198718822" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/matrices.20over.20a.20ring.20are.20a.20ring.html#198718822">(May 26 2020 at 04:07)</a>:</h4>
<p>But if <code>simp only [pow_bit0]</code> turns this into <code>foo ^ 5 * foo ^ 5</code>, then <code>norm_num</code> could apply CSE, right?</p>



<a name="198718865"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/matrices%20over%20a%20ring%20are%20a%20ring/near/198718865" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/matrices.20over.20a.20ring.20are.20a.20ring.html#198718865">(May 26 2020 at 04:08)</a>:</h4>
<p>If <code>mul_assoc</code> is not in the list, yes</p>



<a name="198718933"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/matrices%20over%20a%20ring%20are%20a%20ring/near/198718933" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/matrices.20over.20a.20ring.20are.20a.20ring.html#198718933">(May 26 2020 at 04:10)</a>:</h4>
<p>Also, maybe the CSE should be on the simp side; the internal function here is <code>simplify.bottom_up</code> or something like that, which calls a tactic on every subterm. It knows enough at that stage to potentially apply CSE, which is especially important if the term is dag-like and highly duplicated</p>



<a name="198718941"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/matrices%20over%20a%20ring%20are%20a%20ring/near/198718941" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/matrices.20over.20a.20ring.20are.20a.20ring.html#198718941">(May 26 2020 at 04:10)</a>:</h4>
<p>The lean side can't do much about dag-like terms</p>



<a name="198718950"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/matrices%20over%20a%20ring%20are%20a%20ring/near/198718950" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/matrices.20over.20a.20ring.20are.20a.20ring.html#198718950">(May 26 2020 at 04:11)</a>:</h4>
<p>I imagine simp-lemmas that turn <code>foo ^ 10</code> into</p>
<div class="codehilite"><pre><span></span><code><span class="n">cache</span> <span class="o">(</span><span class="n">foo</span> <span class="bp">*</span> <span class="n">foo</span><span class="o">)</span> <span class="bp">*</span>
<span class="o">(</span> <span class="n">cache</span> <span class="o">(</span> <span class="o">(</span><span class="n">foo</span> <span class="bp">*</span> <span class="n">foo</span><span class="o">)</span> <span class="bp">*</span> <span class="o">(</span><span class="n">foo</span> <span class="bp">*</span> <span class="n">foo</span><span class="o">)</span> <span class="o">)</span> <span class="bp">*</span>
<span class="o">(</span><span class="n">foo</span> <span class="bp">*</span> <span class="n">foo</span><span class="o">)</span> <span class="bp">*</span> <span class="o">(</span><span class="n">foo</span> <span class="bp">*</span> <span class="n">foo</span><span class="o">)</span> <span class="o">)</span>
</code></pre></div>


<p>where <code>cache := id</code> is a wrapper that tells <code>norm_num</code> to store a result for later.</p>



<a name="198719000"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/matrices%20over%20a%20ring%20are%20a%20ring/near/198719000" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/matrices.20over.20a.20ring.20are.20a.20ring.html#198719000">(May 26 2020 at 04:12)</a>:</h4>
<p>maybe better to put the <code>cache</code> on both sides, indicating both which to cache and which to look in the cache for</p>



<a name="198719065"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/matrices%20over%20a%20ring%20are%20a%20ring/near/198719065" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/matrices.20over.20a.20ring.20are.20a.20ring.html#198719065">(May 26 2020 at 04:14)</a>:</h4>
<p>But keep in mind that norm_num still hasn't triggered at this point. Once it is reduced to a bunch of multiplies, <code>simp[foo]</code> unfolds it to literals, and then all the matrix simp lemmas trigger until it is a bunch of cells like</p>
<div class="codehilite"><pre><span></span><code><span class="o">(</span><span class="err">…</span> <span class="bp">+</span>
                 <span class="o">(</span><span class="err">…</span> <span class="bp">+</span>
                    <span class="o">(</span><span class="err">…</span> <span class="bp">+</span>
                           <span class="o">(</span><span class="err">…</span> <span class="bp">+</span> <span class="o">(</span><span class="err">…</span> <span class="bp">+</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">+</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)))</span> <span class="bp">+</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">+</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)</span> <span class="bp">+</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">+</span> <span class="mi">1</span> <span class="bp">+</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">+</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">))))</span> <span class="bp">+</span>
                              <span class="o">(</span><span class="mi">1</span> <span class="bp">+</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)</span> <span class="bp">+</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">+</span> <span class="mi">1</span> <span class="bp">+</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">+</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)))</span> <span class="bp">+</span>
                                 <span class="o">(</span><span class="mi">1</span> <span class="bp">+</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)</span> <span class="bp">+</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">+</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">))</span> <span class="bp">+</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">+</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)</span> <span class="bp">+</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">+</span> <span class="mi">1</span> <span class="bp">+</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">+</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)))))))</span> <span class="bp">+</span>
                         <span class="o">(</span><span class="mi">1</span> <span class="bp">+</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)</span> <span class="bp">+</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">+</span> <span class="mi">1</span> <span class="bp">+</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">+</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)))</span> <span class="bp">+</span>
                                <span class="o">(</span><span class="mi">1</span> <span class="bp">+</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)</span> <span class="bp">+</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">+</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">))</span> <span class="bp">+</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">+</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)</span> <span class="bp">+</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">+</span> <span class="mi">1</span> <span class="bp">+</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">+</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)))))</span> <span class="bp">+</span>
                              <span class="o">(</span><span class="mi">1</span> <span class="bp">+</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)</span> <span class="bp">+</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">+</span> <span class="mi">1</span> <span class="bp">+</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">+</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)))</span> <span class="bp">+</span>
                                 <span class="o">(</span><span class="mi">1</span> <span class="bp">+</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)</span> <span class="bp">+</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">+</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">))</span> <span class="bp">+</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">+</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)</span> <span class="bp">+</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">+</span> <span class="mi">1</span> <span class="bp">+</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">+</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">))))))</span> <span class="bp">+</span>
                            <span class="o">(</span><span class="mi">1</span> <span class="bp">+</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)</span> <span class="bp">+</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">+</span> <span class="mi">1</span> <span class="bp">+</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">+</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)))</span> <span class="bp">+</span>
                                 <span class="o">(</span><span class="mi">1</span> <span class="bp">+</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)</span> <span class="bp">+</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">+</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">))</span> <span class="bp">+</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">+</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)</span> <span class="bp">+</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">+</span> <span class="mi">1</span> <span class="bp">+</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">+</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)))))</span> <span class="bp">+</span>
                               <span class="o">(</span><span class="mi">1</span> <span class="bp">+</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)</span> <span class="bp">+</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">+</span> <span class="mi">1</span> <span class="bp">+</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">+</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)))</span> <span class="bp">+</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">+</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)</span> <span class="bp">+</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">+</span> <span class="mi">1</span> <span class="bp">+</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">+</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">))))</span> <span class="bp">+</span>
                                  <span class="o">(</span><span class="mi">1</span> <span class="bp">+</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)</span> <span class="bp">+</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">+</span> <span class="mi">1</span> <span class="bp">+</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">+</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)))</span> <span class="bp">+</span>
                                     <span class="o">(</span><span class="mi">1</span> <span class="bp">+</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)</span> <span class="bp">+</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">+</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">))</span> <span class="bp">+</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">+</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)</span> <span class="bp">+</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">+</span> <span class="mi">1</span> <span class="bp">+</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">+</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)))))))))</span> <span class="bp">+</span>
                       <span class="o">(</span><span class="mi">1</span> <span class="bp">+</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)</span> <span class="bp">+</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">+</span> <span class="mi">1</span> <span class="bp">+</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">+</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)))</span> <span class="bp">+</span>
                                <span class="o">(</span><span class="mi">1</span> <span class="bp">+</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)</span> <span class="bp">+</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">+</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">))</span> <span class="bp">+</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">+</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)</span> <span class="bp">+</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">+</span> <span class="mi">1</span> <span class="bp">+</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">+</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)))))</span> <span class="bp">+</span>
                              <span class="o">(</span><span class="mi">1</span> <span class="bp">+</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)</span> <span class="bp">+</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">+</span> <span class="mi">1</span> <span class="bp">+</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">+</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)))</span> <span class="bp">+</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">+</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)</span> <span class="bp">+</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">+</span> <span class="mi">1</span> <span class="bp">+</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">+</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">))))</span> <span class="bp">+</span>
                                 <span class="o">(</span><span class="mi">1</span> <span class="bp">+</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)</span> <span class="bp">+</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">+</span> <span class="mi">1</span> <span class="bp">+</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">+</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)))</span> <span class="bp">+</span>
                                    <span class="o">(</span><span class="mi">1</span> <span class="bp">+</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)</span> <span class="bp">+</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">+</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">))</span> <span class="bp">+</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">+</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)</span> <span class="bp">+</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">+</span> <span class="mi">1</span> <span class="bp">+</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">+</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)))))))</span> <span class="bp">+</span>
                            <span class="o">(</span><span class="mi">1</span> <span class="bp">+</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)</span> <span class="bp">+</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">+</span> <span class="mi">1</span> <span class="bp">+</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">+</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)))</span> <span class="bp">+</span>
                                 <span class="o">(</span><span class="mi">1</span> <span class="bp">+</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)</span> <span class="bp">+</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">+</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">))</span> <span class="bp">+</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">+</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)</span> <span class="bp">+</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">+</span> <span class="mi">1</span> <span class="bp">+</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">+</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)))))</span> <span class="bp">+</span>
                               <span class="o">(</span><span class="mi">1</span> <span class="bp">+</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)</span> <span class="bp">+</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">+</span> <span class="mi">1</span> <span class="bp">+</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">+</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)))</span> <span class="bp">+</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">+</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)</span> <span class="bp">+</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">+</span> <span class="mi">1</span> <span class="bp">+</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">+</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">))))</span> <span class="bp">+</span>
 <span class="bp">...</span>
</code></pre></div>



<a name="198719075"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/matrices%20over%20a%20ring%20are%20a%20ring/near/198719075" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/matrices.20over.20a.20ring.20are.20a.20ring.html#198719075">(May 26 2020 at 04:15)</a>:</h4>
<p>It is only at this point that <code>norm_num</code> sees something with numerals that it can evaluate</p>



<a name="198719144"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/matrices%20over%20a%20ring%20are%20a%20ring/near/198719144" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/matrices.20over.20a.20ring.20are.20a.20ring.html#198719144">(May 26 2020 at 04:16)</a>:</h4>
<p>It's still faster than <code>rfl</code> though</p>



<a name="198719165"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/matrices%20over%20a%20ring%20are%20a%20ring/near/198719165" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/matrices.20over.20a.20ring.20are.20a.20ring.html#198719165">(May 26 2020 at 04:17)</a>:</h4>
<p>I see, but still the <code>cache</code> thing might help, maybe? (And your suggestion of reusing <code>cache</code> to flag a look-up seems good.)</p>



<a name="198719215"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/matrices%20over%20a%20ring%20are%20a%20ring/near/198719215" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/matrices.20over.20a.20ring.20are.20a.20ring.html#198719215">(May 26 2020 at 04:18)</a>:</h4>
<p>I mean the optimal solution is just to do like Kenny says and bake matrix operations into norm_num</p>



<a name="198719246"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/matrices%20over%20a%20ring%20are%20a%20ring/near/198719246" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/matrices.20over.20a.20ring.20are.20a.20ring.html#198719246">(May 26 2020 at 04:19)</a>:</h4>
<p>which might not even be so bad if norm_num grows some extensibility</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>