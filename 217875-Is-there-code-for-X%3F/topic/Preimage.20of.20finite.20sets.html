---
layout: archive
title: Zulip Chat Archive
permalink: /stream/217875-Is-there-code-for-X%3F/topic/Preimage.20of.20finite.20sets.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/index.html">Is there code for X?</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Preimage.20of.20finite.20sets.html">Preimage of finite sets</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="199987783"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Preimage%20of%20finite%20sets/near/199987783" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Preimage.20of.20finite.20sets.html#199987783">(Jun 06 2020 at 18:40)</a>:</h4>
<p>Hi everyone. I'm looking for the statement that the preimage under an <em>injective map</em> of a finite subset is finite, using <code>finset</code>. So, approximately something like this:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="n">data</span><span class="bp">.</span><span class="n">finset</span>
<span class="kn">open</span> <span class="n">function</span>

<span class="kn">example</span> <span class="o">{</span><span class="n">S</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">{</span><span class="n">T</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">{</span><span class="n">f</span> <span class="o">:</span> <span class="n">S</span> <span class="bp">→</span> <span class="n">T</span><span class="o">}</span> <span class="o">{</span><span class="n">h</span> <span class="o">:</span> <span class="n">injective</span> <span class="n">f</span><span class="o">}</span> <span class="o">{</span><span class="n">F</span> <span class="o">:</span> <span class="n">finset</span> <span class="n">T</span><span class="o">}</span> <span class="o">:</span>
  <span class="bp">∃</span> <span class="n">G</span> <span class="o">:</span> <span class="n">finset</span> <span class="n">S</span><span class="o">,</span> <span class="n">f</span> <span class="bp">⁻¹</span><span class="err">&#39;</span> <span class="err">↑</span><span class="n">F</span> <span class="bp">=</span> <span class="err">↑</span><span class="n">G</span> <span class="o">:=</span> <span class="n">sorry</span>
</code></pre></div>


<p>Does mathlib have anything close to this?</p>



<a name="199989322"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Preimage%20of%20finite%20sets/near/199989322" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Preimage.20of.20finite.20sets.html#199989322">(Jun 06 2020 at 19:21)</a>:</h4>
<p>There is indeed no mention of <code>comap</code> in <code>finset.lean</code>.</p>



<a name="199989434"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Preimage%20of%20finite%20sets/near/199989434" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Preimage.20of.20finite.20sets.html#199989434">(Jun 06 2020 at 19:24)</a>:</h4>
<p><code>finset.lean</code> has <code>map</code> and <code>image</code> but no <code>comap</code>. This would be a neat little PR unless I have completely missed something.</p>



<a name="199989464"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Preimage%20of%20finite%20sets/near/199989464" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Preimage.20of.20finite.20sets.html#199989464">(Jun 06 2020 at 19:25)</a>:</h4>
<p><code>finset.lean</code> must have been written by a <a href="https://github.com/leanprover-community/mathlib/blob/e48c2af4f2f92c2331a912c588610db73085939d/src/data/finset.lean#L4">bunch of amateurs</a></p>



<a name="199989601"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Preimage%20of%20finite%20sets/near/199989601" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Preimage.20of.20finite.20sets.html#199989601">(Jun 06 2020 at 19:29)</a>:</h4>
<p>Oh golly there is not even <code>multiset.comap</code></p>



<a name="199989750"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Preimage%20of%20finite%20sets/near/199989750" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Preimage.20of.20finite.20sets.html#199989750">(Jun 06 2020 at 19:33)</a>:</h4>
<p>Yeah this is all a bit crazy. <code>finset.map</code> is defined only for embeddings, when it could be defined in general; <code>finset.comap</code>, which does need embeddings, is missing. <code>multiset.map</code> is correctly defined for all maps. <span class="user-mention" data-user-id="110049">@Mario Carneiro</span>  if it was decided that <code>finset.map</code> was worth writing over 20 lemmas for in the special case where the map was an embedding, would the same apply for <code>multiset.comap</code> and <code>finset.comap</code>?</p>



<a name="199989757"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Preimage%20of%20finite%20sets/near/199989757" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Preimage.20of.20finite.20sets.html#199989757">(Jun 06 2020 at 19:33)</a>:</h4>
<p>Does something like this exist?</p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="n">data</span><span class="bp">.</span><span class="n">finset</span>
<span class="kn">open</span> <span class="n">function</span>

<span class="n">open_locale</span> <span class="n">classical</span>

<span class="kn">example</span> <span class="o">{</span><span class="n">S</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">{</span><span class="n">T</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">{</span><span class="n">f</span> <span class="o">:</span> <span class="n">S</span> <span class="bp">→</span> <span class="n">T</span><span class="o">}</span> <span class="o">{</span><span class="n">F</span> <span class="o">:</span> <span class="n">finset</span> <span class="n">T</span><span class="o">}</span> <span class="o">:</span>
  <span class="bp">∃</span> <span class="n">G</span> <span class="o">:</span> <span class="n">finset</span> <span class="n">S</span><span class="o">,</span> <span class="n">finset</span><span class="bp">.</span><span class="n">image</span> <span class="n">f</span> <span class="n">G</span> <span class="bp">=</span> <span class="n">F</span> <span class="o">:=</span> <span class="n">sorry</span> <span class="c1">-- WRONG</span>
</code></pre></div>


<p>Presumably this would be enough...</p>



<a name="199989800"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Preimage%20of%20finite%20sets/near/199989800" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Preimage.20of.20finite.20sets.html#199989800">(Jun 06 2020 at 19:34)</a>:</h4>
<p>That's not true unless f is surjective</p>



<a name="199989803"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Preimage%20of%20finite%20sets/near/199989803" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Preimage.20of.20finite.20sets.html#199989803">(Jun 06 2020 at 19:34)</a>:</h4>
<p>Kevin, are you missing <a href="https://github.com/leanprover-community/mathlib/blob/e48c2af4f2f92c2331a912c588610db73085939d/src/data/finset.lean#L1225">https://github.com/leanprover-community/mathlib/blob/e48c2af4f2f92c2331a912c588610db73085939d/src/data/finset.lean#L1225</a>?</p>



<a name="199989808"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Preimage%20of%20finite%20sets/near/199989808" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Preimage.20of.20finite.20sets.html#199989808">(Jun 06 2020 at 19:34)</a>:</h4>
<p>Oh ovbiously... I should take an intersection with the image (and I don't know how to do that...)</p>



<a name="199989809"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Preimage%20of%20finite%20sets/near/199989809" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Preimage.20of.20finite.20sets.html#199989809">(Jun 06 2020 at 19:34)</a>:</h4>
<p>We're going the other way Patrick (I think)</p>



<a name="199989830"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Preimage%20of%20finite%20sets/near/199989830" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Preimage.20of.20finite.20sets.html#199989830">(Jun 06 2020 at 19:35)</a>:</h4>
<p>Aah but I see what you're saying. That's a <code>map</code> with no injectivity assumption</p>



<a name="199989875"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Preimage%20of%20finite%20sets/near/199989875" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Preimage.20of.20finite.20sets.html#199989875">(Jun 06 2020 at 19:36)</a>:</h4>
<p>Just to be clear Adam, the issue is not how to define the function, the issue is whether it is already in mathlib</p>



<a name="199989887"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Preimage%20of%20finite%20sets/near/199989887" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Preimage.20of.20finite.20sets.html#199989887">(Jun 06 2020 at 19:37)</a>:</h4>
<p>Yeah I know... I've just haven't used finsets before so it is an issue for me :)</p>



<a name="199989892"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Preimage%20of%20finite%20sets/near/199989892" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Preimage.20of.20finite.20sets.html#199989892">(Jun 06 2020 at 19:37)</a>:</h4>
<p><a href="https://leanprover-community.github.io/mathlib_docs/find/finset.preimage">docs#finset.preimage</a></p>



<a name="199989954"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Preimage%20of%20finite%20sets/near/199989954" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Preimage.20of.20finite.20sets.html#199989954">(Jun 06 2020 at 19:39)</a>:</h4>
<p>So it is there, but in <code>set.finite</code>, and it's called <code>preimage</code> not <code>comap</code>.</p>



<a name="199990225"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Preimage%20of%20finite%20sets/near/199990225" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Preimage.20of.20finite.20sets.html#199990225">(Jun 06 2020 at 19:46)</a>:</h4>
<p>While we're here, is there something like this? (which should have been what I wrote above):</p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="n">data</span><span class="bp">.</span><span class="n">finset</span>
<span class="kn">open</span> <span class="n">function</span>

<span class="n">open_locale</span> <span class="n">classical</span>

<span class="kn">example</span> <span class="o">{</span><span class="n">S</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">{</span><span class="n">T</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">{</span><span class="n">f</span> <span class="o">:</span> <span class="n">S</span> <span class="bp">→</span> <span class="n">T</span><span class="o">}</span> <span class="o">{</span><span class="n">F</span> <span class="o">:</span> <span class="n">finset</span> <span class="n">T</span><span class="o">}</span> <span class="o">:</span>
  <span class="err">↑</span><span class="n">F</span> <span class="err">⊆</span> <span class="n">set</span><span class="bp">.</span><span class="n">range</span> <span class="n">f</span> <span class="bp">→</span> <span class="bp">∃</span> <span class="n">G</span> <span class="o">:</span> <span class="n">finset</span> <span class="n">S</span><span class="o">,</span> <span class="n">finset</span><span class="bp">.</span><span class="n">image</span> <span class="n">f</span> <span class="n">G</span> <span class="bp">=</span> <span class="n">F</span> <span class="o">:=</span> <span class="n">sorry</span>
</code></pre></div>



<a name="199990350"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Preimage%20of%20finite%20sets/near/199990350" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Preimage.20of.20finite.20sets.html#199990350">(Jun 06 2020 at 19:50)</a>:</h4>
<p>This you'll need the axiom of choice for.</p>



<a name="199990356"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Preimage%20of%20finite%20sets/near/199990356" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Preimage.20of.20finite.20sets.html#199990356">(Jun 06 2020 at 19:50)</a>:</h4>
<p>I'm happy with that...</p>



<a name="199990369"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Preimage%20of%20finite%20sets/near/199990369" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Preimage.20of.20finite.20sets.html#199990369">(Jun 06 2020 at 19:51)</a>:</h4>
<p>Oh -- you can do better than <code>f '' set.univ</code> -- we have <code>image f</code>.</p>



<a name="199990418"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Preimage%20of%20finite%20sets/near/199990418" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Preimage.20of.20finite.20sets.html#199990418">(Jun 06 2020 at 19:52)</a>:</h4>
<p>Which namespace is that in?</p>



<a name="199990424"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Preimage%20of%20finite%20sets/near/199990424" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Preimage.20of.20finite.20sets.html#199990424">(Jun 06 2020 at 19:52)</a>:</h4>
<p>Or am I missing some import?</p>



<a name="199990482"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Preimage%20of%20finite%20sets/near/199990482" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Preimage.20of.20finite.20sets.html#199990482">(Jun 06 2020 at 19:54)</a>:</h4>
<p>oh sorry! It's called <code>range f</code></p>



<a name="199990495"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Preimage%20of%20finite%20sets/near/199990495" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Preimage.20of.20finite.20sets.html#199990495">(Jun 06 2020 at 19:54)</a>:</h4>
<p><a href="https://leanprover-community.github.io/mathlib_docs/find/set.range">docs#set.range</a></p>



<a name="199990506"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Preimage%20of%20finite%20sets/near/199990506" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Preimage.20of.20finite.20sets.html#199990506">(Jun 06 2020 at 19:55)</a>:</h4>
<p>Thanks! I updated the code.</p>



<a name="199990511"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Preimage%20of%20finite%20sets/near/199990511" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Preimage.20of.20finite.20sets.html#199990511">(Jun 06 2020 at 19:55)</a>:</h4>
<p>It's easier to use because you don't have to prove that <code>x \in univ</code>.</p>



<a name="199990570"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Preimage%20of%20finite%20sets/near/199990570" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Preimage.20of.20finite.20sets.html#199990570">(Jun 06 2020 at 19:56)</a>:</h4>
<p>It wouldn't surprise me if this is not in the library, and my idea for how to do it is kind of a horrible mess.</p>



<a name="199991091"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Preimage%20of%20finite%20sets/near/199991091" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Preimage.20of.20finite.20sets.html#199991091">(Jun 06 2020 at 20:08)</a>:</h4>
<p>It's not slick, and I don't know enough of the library to quickly fill in the sorry's, but here is a sketch -- is this what you had in mind?</p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="n">data</span><span class="bp">.</span><span class="n">finset</span>
<span class="kn">open</span> <span class="n">function</span>

<span class="n">open_locale</span> <span class="n">classical</span>

<span class="kn">example</span> <span class="o">{</span><span class="n">S</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">{</span><span class="n">T</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">{</span><span class="n">f</span> <span class="o">:</span> <span class="n">S</span> <span class="bp">→</span> <span class="n">T</span><span class="o">}</span> <span class="o">{</span><span class="n">F</span> <span class="o">:</span> <span class="n">finset</span> <span class="n">T</span><span class="o">}</span> <span class="o">:</span>
  <span class="err">↑</span><span class="n">F</span> <span class="err">⊆</span> <span class="n">set</span><span class="bp">.</span><span class="n">range</span> <span class="n">f</span><span class="bp">→</span> <span class="bp">∃</span> <span class="n">G</span> <span class="o">:</span> <span class="n">finset</span> <span class="n">S</span><span class="o">,</span> <span class="n">finset</span><span class="bp">.</span><span class="n">image</span> <span class="n">f</span> <span class="n">G</span> <span class="bp">=</span> <span class="n">F</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="n">refine</span> <span class="n">finset</span><span class="bp">.</span><span class="n">induction_on</span> <span class="n">F</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">,</span>
  <span class="o">{</span>
    <span class="n">intro</span> <span class="n">h</span><span class="o">,</span>
    <span class="n">use</span> <span class="err">∅</span><span class="o">,</span>
    <span class="n">trivial</span><span class="o">,</span>
  <span class="o">},</span>
  <span class="o">{</span>
    <span class="n">intros</span> <span class="n">a</span> <span class="n">U</span> <span class="n">ha</span> <span class="n">ind</span> <span class="n">sur</span><span class="o">,</span>
    <span class="k">have</span> <span class="n">h1</span> <span class="o">:</span> <span class="err">↑</span><span class="n">U</span> <span class="err">⊆</span> <span class="n">set</span><span class="bp">.</span><span class="n">range</span> <span class="n">f</span><span class="o">,</span> <span class="k">by</span> <span class="n">sorry</span><span class="o">,</span> <span class="c1">-- from sur</span>
    <span class="k">have</span> <span class="n">h2</span> <span class="o">:</span> <span class="bp">∃</span> <span class="n">s</span> <span class="o">:</span> <span class="n">S</span><span class="o">,</span> <span class="n">f</span> <span class="n">s</span> <span class="bp">=</span> <span class="n">a</span><span class="o">,</span> <span class="k">by</span> <span class="n">sorry</span><span class="o">,</span> <span class="c1">-- from sur</span>
    <span class="n">cases</span> <span class="n">ind</span> <span class="n">h1</span> <span class="k">with</span> <span class="n">G</span> <span class="n">hG</span><span class="o">,</span>
    <span class="n">cases</span> <span class="n">h2</span> <span class="k">with</span> <span class="n">s</span> <span class="n">hs</span><span class="o">,</span>
    <span class="n">use</span> <span class="n">insert</span> <span class="n">s</span> <span class="n">G</span><span class="o">,</span>
    <span class="n">rw</span> <span class="o">[</span><span class="n">finset</span><span class="bp">.</span><span class="n">image_insert</span><span class="o">,</span> <span class="n">hs</span><span class="o">],</span>
    <span class="n">refine</span> <span class="n">congr_arg</span> <span class="o">(</span><span class="n">insert</span> <span class="n">a</span><span class="o">)</span> <span class="n">hG</span><span class="o">,</span>
  <span class="o">}</span>
<span class="kn">end</span>
</code></pre></div>



<a name="199991359"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Preimage%20of%20finite%20sets/near/199991359" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Preimage.20of.20finite.20sets.html#199991359">(Jun 06 2020 at 20:16)</a>:</h4>
<div class="codehilite"><pre><span></span><code>    <span class="k">have</span> <span class="n">h1</span> <span class="o">:</span> <span class="err">↑</span><span class="n">U</span> <span class="err">⊆</span> <span class="n">set</span><span class="bp">.</span><span class="n">range</span> <span class="n">f</span><span class="o">,</span>
    <span class="o">{</span> <span class="n">intros</span> <span class="n">x</span> <span class="n">hx</span><span class="o">,</span> <span class="n">apply</span> <span class="n">sur</span><span class="o">,</span> <span class="n">simp</span> <span class="o">[</span><span class="n">hx</span><span class="o">]},</span>
</code></pre></div>



<a name="199991428"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Preimage%20of%20finite%20sets/near/199991428" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Preimage.20of.20finite.20sets.html#199991428">(Jun 06 2020 at 20:18)</a>:</h4>
<div class="codehilite"><pre><span></span><code>    <span class="k">have</span> <span class="n">h2</span> <span class="o">:</span> <span class="bp">∃</span> <span class="n">s</span> <span class="o">:</span> <span class="n">S</span><span class="o">,</span> <span class="n">f</span> <span class="n">s</span> <span class="bp">=</span> <span class="n">a</span><span class="o">,</span>
    <span class="o">{</span> <span class="k">show</span> <span class="n">a</span> <span class="err">∈</span> <span class="n">set</span><span class="bp">.</span><span class="n">range</span> <span class="n">f</span><span class="o">,</span>
      <span class="n">apply</span> <span class="n">sur</span><span class="o">,</span>
      <span class="n">simp</span><span class="o">},</span>
</code></pre></div>



<a name="199991439"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Preimage%20of%20finite%20sets/near/199991439" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Preimage.20of.20finite.20sets.html#199991439">(Jun 06 2020 at 20:19)</a>:</h4>
<p>I don't know whether this <code>apply sur</code> is mathlib-approved, but <code>X \sub Y</code> is sugar for <code>forall a, a \in X -&gt; a \in Y</code> so you can just <code>apply sur</code>  like a function</p>



<a name="199991443"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Preimage%20of%20finite%20sets/near/199991443" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Preimage.20of.20finite.20sets.html#199991443">(Jun 06 2020 at 20:19)</a>:</h4>
<p>You beat me to it :)<br>
I got this:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="n">data</span><span class="bp">.</span><span class="n">finset</span>
<span class="kn">open</span> <span class="n">function</span>

<span class="n">open_locale</span> <span class="n">classical</span>

<span class="kn">example</span> <span class="o">{</span><span class="n">S</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">{</span><span class="n">T</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">{</span><span class="n">f</span> <span class="o">:</span> <span class="n">S</span> <span class="bp">→</span> <span class="n">T</span><span class="o">}</span> <span class="o">{</span><span class="n">F</span> <span class="o">:</span> <span class="n">finset</span> <span class="n">T</span><span class="o">}</span> <span class="o">:</span>
  <span class="err">↑</span><span class="n">F</span> <span class="err">⊆</span> <span class="n">set</span><span class="bp">.</span><span class="n">range</span> <span class="n">f</span><span class="bp">→</span> <span class="bp">∃</span> <span class="n">G</span> <span class="o">:</span> <span class="n">finset</span> <span class="n">S</span><span class="o">,</span> <span class="n">finset</span><span class="bp">.</span><span class="n">image</span> <span class="n">f</span> <span class="n">G</span> <span class="bp">=</span> <span class="n">F</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="n">refine</span> <span class="n">finset</span><span class="bp">.</span><span class="n">induction_on</span> <span class="n">F</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">,</span>
  <span class="o">{</span>
    <span class="n">intro</span> <span class="n">h</span><span class="o">,</span>
    <span class="n">use</span> <span class="err">∅</span><span class="o">,</span>
    <span class="n">trivial</span><span class="o">,</span>
  <span class="o">},</span>
  <span class="o">{</span>
    <span class="n">intros</span> <span class="n">a</span> <span class="n">U</span> <span class="n">ha</span> <span class="n">ind</span> <span class="n">sur</span><span class="o">,</span>
    <span class="k">have</span> <span class="n">h1</span> <span class="o">:</span> <span class="err">↑</span><span class="n">U</span> <span class="err">⊆</span> <span class="n">set</span><span class="bp">.</span><span class="n">range</span> <span class="n">f</span><span class="o">,</span>
    <span class="o">{</span> <span class="n">intros</span> <span class="n">x</span> <span class="n">hx</span><span class="o">,</span> <span class="n">apply</span> <span class="n">sur</span><span class="o">,</span> <span class="n">simp</span> <span class="o">[</span><span class="n">hx</span><span class="o">]},</span>
    <span class="k">have</span> <span class="n">h2</span> <span class="o">:</span> <span class="bp">∃</span> <span class="n">s</span> <span class="o">:</span> <span class="n">S</span><span class="o">,</span> <span class="n">f</span> <span class="n">s</span> <span class="bp">=</span> <span class="n">a</span><span class="o">,</span>
    <span class="o">{</span>
      <span class="n">suffices</span> <span class="o">:</span> <span class="n">a</span> <span class="err">∈</span>  <span class="err">↑</span><span class="o">(</span><span class="n">insert</span> <span class="n">a</span> <span class="n">U</span><span class="o">),</span> <span class="k">by</span> <span class="n">exact</span> <span class="bp">@</span><span class="n">sur</span> <span class="n">a</span> <span class="n">this</span><span class="o">,</span>
      <span class="n">simp</span><span class="o">,</span>
    <span class="o">},</span>
    <span class="n">cases</span> <span class="n">ind</span> <span class="n">h1</span> <span class="k">with</span> <span class="n">G</span> <span class="n">hG</span><span class="o">,</span>
    <span class="n">cases</span> <span class="n">h2</span> <span class="k">with</span> <span class="n">s</span> <span class="n">hs</span><span class="o">,</span>
    <span class="n">use</span> <span class="n">insert</span> <span class="n">s</span> <span class="n">G</span><span class="o">,</span>
    <span class="n">rw</span> <span class="o">[</span><span class="n">finset</span><span class="bp">.</span><span class="n">image_insert</span><span class="o">,</span> <span class="n">hs</span><span class="o">],</span>
    <span class="n">refine</span> <span class="n">congr_arg</span> <span class="o">(</span><span class="n">insert</span> <span class="n">a</span><span class="o">)</span> <span class="n">hG</span><span class="o">,</span>
  <span class="o">}</span>
<span class="kn">end</span>
</code></pre></div>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>