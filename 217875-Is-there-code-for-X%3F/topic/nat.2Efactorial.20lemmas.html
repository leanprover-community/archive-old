---
layout: archive
title: Zulip Chat Archive
permalink: /stream/217875-Is-there-code-for-X%3F/topic/nat.2Efactorial.20lemmas.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/index.html">Is there code for X?</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/nat.2Efactorial.20lemmas.html">nat.factorial lemmas</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="240592034"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/nat.factorial%20lemmas/near/240592034" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/nat.2Efactorial.20lemmas.html#240592034">(May 28 2021 at 11:37)</a>:</h4>
<p>I have a goal of the form</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">data.real.basic</span>
<span class="kn">import</span> <span class="n">nat.choose.basic</span>

<span class="kd">example</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="o">:</span> <span class="o">(</span><span class="n">n.choose</span> <span class="mi">2</span> <span class="o">:</span> <span class="n">ℝ</span><span class="o">)</span> <span class="bp">≤</span> <span class="n">n</span> <span class="bp">^</span> <span class="mi">2</span> <span class="bp">/</span> <span class="mi">2</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="gr">sorry</span>
<span class="kd">end</span>
</code></pre></div>
<p>Is there anything close to what I want, and if not what's the biggest generality I can prove stuff in? I can probably prove</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">lemma</span> <span class="n">nat.choose_le_pow</span><span class="o">(</span><span class="n">n</span> <span class="n">k</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="o">:</span> <span class="o">(</span><span class="n">n.choose</span> <span class="n">k</span> <span class="o">:</span> <span class="n">ℝ</span><span class="o">)</span> <span class="bp">≤</span> <span class="n">n</span><span class="bp">^</span><span class="n">k</span> <span class="bp">/</span> <span class="n">k.factorial</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="gr">sorry</span>
<span class="kd">end</span>
</code></pre></div>
<p>but I assume <code>ℝ</code> is not general enough?</p>



<a name="240592544"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/nat.factorial%20lemmas/near/240592544" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/nat.2Efactorial.20lemmas.html#240592544">(May 28 2021 at 11:43)</a>:</h4>
<p>I already know this by the way: <a href="https://leanprover-community.github.io/mathlib_docs/data/nat/choose/dvd.html#nat.choose_eq_factorial_div_factorial">https://leanprover-community.github.io/mathlib_docs/data/nat/choose/dvd.html#nat.choose_eq_factorial_div_factorial</a></p>



<a name="240592742"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/nat.factorial%20lemmas/near/240592742" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/nat.2Efactorial.20lemmas.html#240592742">(May 28 2021 at 11:45)</a>:</h4>
<p>I'd probably prove it for <a href="https://leanprover-community.github.io/mathlib_docs/find/nat.desc_fac">docs#nat.desc_fac</a>? With something like <a href="https://leanprover-community.github.io/mathlib_docs/find/nat.desc_fac_eq_factorial_mul_choose">docs#nat.desc_fac_eq_factorial_mul_choose</a>, I think that's essentially what you're doing, and then you can use a couple of the lemmas below there to transfer it to <code>nCk</code>. Also, <code>desc_fac</code> is well-linked to <a href="https://leanprover-community.github.io/mathlib_docs/find/pochhammer">docs#pochhammer</a>, which is a sweeping generalization, and all results transfer almost automatically</p>



<a name="240599897"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/nat.factorial%20lemmas/near/240599897" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/nat.2Efactorial.20lemmas.html#240599897">(May 28 2021 at 12:57)</a>:</h4>
<p>You asked a slightly different question on the Discord and here's my answer to that one:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">data.real.basic</span>
<span class="kn">import</span> <span class="n">tactic</span>

<span class="c1">-- should be in mathlib?</span>
<span class="kd">theorem</span> <span class="n">nat.cast_div</span> <span class="o">{</span><span class="n">D</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">division_ring</span> <span class="n">D</span><span class="o">]</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="o">(</span><span class="n">hba</span> <span class="o">:</span> <span class="n">b</span> <span class="bp">∣</span> <span class="n">a</span><span class="o">)</span> <span class="o">(</span><span class="n">hb</span> <span class="o">:</span> <span class="o">(</span><span class="n">b</span> <span class="o">:</span> <span class="n">D</span><span class="o">)</span> <span class="bp">≠</span> <span class="mi">0</span><span class="o">)</span> <span class="o">:</span>
  <span class="o">((</span><span class="n">a</span> <span class="bp">/</span> <span class="n">b</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="o">:</span> <span class="n">D</span><span class="o">)</span> <span class="bp">=</span> <span class="n">a</span> <span class="bp">/</span> <span class="n">b</span> <span class="o">:=</span>
<span class="kd">by</span> <span class="n">rw</span> <span class="o">[</span><span class="bp">←</span> <span class="o">(</span><span class="n">mul_left_inj'</span> <span class="n">hb</span><span class="o">),</span> <span class="n">div_mul_cancel</span> <span class="n">_</span> <span class="n">hb</span><span class="o">,</span> <span class="bp">←</span> <span class="n">nat.cast_mul</span><span class="o">,</span> <span class="n">nat.div_mul_cancel</span> <span class="n">hba</span><span class="o">]</span>

<span class="c1">-- might already be in mathlib?</span>
<span class="kd">@[elab_as_eliminator]</span>
<span class="kd">def</span> <span class="n">nat.parity.cases_on</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="o">{</span><span class="n">P</span> <span class="o">:</span> <span class="n">ℕ</span> <span class="bp">→</span> <span class="kt">Prop</span><span class="o">}</span>
  <span class="o">(</span><span class="n">h_even</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">k</span><span class="o">,</span> <span class="n">P</span> <span class="o">(</span><span class="mi">2</span> <span class="bp">*</span> <span class="n">k</span><span class="o">))</span> <span class="o">(</span><span class="n">h_odd</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">k</span><span class="o">,</span> <span class="n">P</span> <span class="o">(</span><span class="mi">2</span> <span class="bp">*</span> <span class="n">k</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">))</span> <span class="o">:</span>
  <span class="n">P</span> <span class="n">n</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="n">rw</span> <span class="bp">←</span> <span class="n">nat.div_add_mod</span> <span class="n">n</span> <span class="mi">2</span><span class="o">,</span>
  <span class="k">have</span> <span class="n">hn</span> <span class="o">:</span> <span class="n">n</span> <span class="bp">%</span> <span class="mi">2</span> <span class="bp">&lt;</span> <span class="mi">2</span> <span class="o">:=</span> <span class="n">nat.mod_lt</span> <span class="n">_</span> <span class="n">zero_lt_two</span><span class="o">,</span>
  <span class="n">interval_cases</span> <span class="o">(</span><span class="n">n</span><span class="bp">%</span><span class="mi">2</span><span class="o">)</span><span class="bp">;</span> <span class="n">rw</span> <span class="n">h</span><span class="o">,</span>
  <span class="o">{</span> <span class="n">exact</span> <span class="n">h_even</span> <span class="o">(</span><span class="n">n</span><span class="bp">/</span><span class="mi">2</span><span class="o">)</span> <span class="o">},</span>
  <span class="o">{</span> <span class="n">exact</span> <span class="n">h_odd</span> <span class="o">(</span><span class="n">n</span><span class="bp">/</span><span class="mi">2</span><span class="o">)</span> <span class="o">}</span>
<span class="kd">end</span>

<span class="kd">example</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="o">:</span> <span class="o">((</span><span class="n">n</span> <span class="bp">*</span> <span class="o">(</span><span class="n">n</span> <span class="bp">-</span> <span class="mi">1</span><span class="o">)</span><span class="bp">/</span><span class="mi">2</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="o">:</span> <span class="n">ℝ</span><span class="o">)</span> <span class="bp">=</span> <span class="o">(</span><span class="n">n</span> <span class="bp">*</span> <span class="o">(</span><span class="n">n</span> <span class="bp">-</span> <span class="mi">1</span><span class="o">)</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span><span class="bp">/</span><span class="mi">2</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="n">rw</span> <span class="n">nat.cast_div</span><span class="o">,</span>
  <span class="o">{</span> <span class="n">norm_cast</span> <span class="o">},</span>
  <span class="o">{</span> <span class="n">apply</span> <span class="n">nat.parity.cases_on</span> <span class="n">n</span><span class="o">,</span>
    <span class="o">{</span> <span class="n">intro</span> <span class="n">k</span><span class="o">,</span> <span class="n">use</span> <span class="n">k</span> <span class="bp">*</span> <span class="o">(</span><span class="mi">2</span> <span class="bp">*</span> <span class="n">k</span> <span class="bp">-</span> <span class="mi">1</span><span class="o">),</span> <span class="n">ring</span> <span class="o">},</span>
    <span class="o">{</span> <span class="n">intro</span> <span class="n">k</span><span class="o">,</span> <span class="n">use</span> <span class="n">k</span> <span class="bp">*</span> <span class="o">(</span><span class="mi">2</span> <span class="bp">*</span> <span class="n">k</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">),</span> <span class="n">rw</span> <span class="n">nat.add_sub_cancel</span><span class="o">,</span> <span class="n">ring</span> <span class="o">}</span> <span class="o">},</span>
  <span class="o">{</span> <span class="n">norm_num</span> <span class="o">}</span>
<span class="kd">end</span>
</code></pre></div>
<p>Probably people can build on this.</p>



<a name="240601089"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/nat.factorial%20lemmas/near/240601089" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ruben Van de Velde <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/nat.2Efactorial.20lemmas.html#240601089">(May 28 2021 at 13:07)</a>:</h4>
<p>Simpler proofs (though why use nat subtraction?):</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">@[elab_as_eliminator]</span>
<span class="kd">def</span> <span class="n">nat.parity.cases_on</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="o">{</span><span class="n">P</span> <span class="o">:</span> <span class="n">ℕ</span> <span class="bp">→</span> <span class="kt">Prop</span><span class="o">}</span>
  <span class="o">(</span><span class="n">h_even</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">k</span><span class="o">,</span> <span class="n">P</span> <span class="o">(</span><span class="mi">2</span> <span class="bp">*</span> <span class="n">k</span><span class="o">))</span> <span class="o">(</span><span class="n">h_odd</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">k</span><span class="o">,</span> <span class="n">P</span> <span class="o">(</span><span class="mi">2</span> <span class="bp">*</span> <span class="n">k</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">))</span> <span class="o">:</span>
  <span class="n">P</span> <span class="n">n</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="n">obtain</span> <span class="o">⟨</span><span class="n">k</span><span class="o">,</span> <span class="o">(</span><span class="n">rfl</span><span class="bp">|</span><span class="n">rfl</span><span class="o">)⟩</span> <span class="o">:=</span> <span class="n">nat.even_or_odd'</span> <span class="n">n</span><span class="o">,</span>
  <span class="n">exacts</span> <span class="o">[</span><span class="n">h_even</span> <span class="n">k</span><span class="o">,</span> <span class="n">h_odd</span> <span class="n">k</span><span class="o">],</span>
<span class="kd">end</span>

<span class="kd">example</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="o">:</span> <span class="o">((</span><span class="n">n</span> <span class="bp">*</span> <span class="o">(</span><span class="n">n</span> <span class="bp">-</span> <span class="mi">1</span><span class="o">)</span><span class="bp">/</span><span class="mi">2</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="o">:</span> <span class="n">ℝ</span><span class="o">)</span> <span class="bp">=</span> <span class="o">(</span><span class="n">n</span> <span class="bp">*</span> <span class="o">(</span><span class="n">n</span> <span class="bp">-</span> <span class="mi">1</span><span class="o">)</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span><span class="bp">/</span><span class="mi">2</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="n">rw</span> <span class="n">nat.cast_div</span><span class="o">,</span>
  <span class="o">{</span> <span class="n">norm_cast</span> <span class="o">},</span>
  <span class="o">{</span> <span class="n">cases</span> <span class="n">n</span><span class="o">,</span>
    <span class="o">{</span> <span class="n">simp</span> <span class="o">},</span>
    <span class="n">simp</span> <span class="n">only</span> <span class="o">[</span><span class="n">nat.succ_sub_succ_eq_sub</span><span class="o">,</span> <span class="n">nat.sub_zero</span><span class="o">,</span> <span class="n">mul_comm</span><span class="o">],</span>
    <span class="n">exact</span> <span class="n">nat.even_mul_succ_self</span> <span class="n">n</span> <span class="o">},</span>
  <span class="o">{</span> <span class="n">norm_num</span> <span class="o">}</span>
<span class="kd">end</span>
</code></pre></div>



<a name="240618901"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/nat.factorial%20lemmas/near/240618901" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bhavik Mehta <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/nat.2Efactorial.20lemmas.html#240618901">(May 28 2021 at 15:18)</a>:</h4>
<p>Ultimately the original question doesn't use nat subtraction anyway, so it would be nice to get solutions which don't introduce nat subtraction - Eric's approach seems promising</p>



<a name="240623798"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/nat.factorial%20lemmas/near/240623798" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/nat.2Efactorial.20lemmas.html#240623798">(May 28 2021 at 15:52)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">data.nat.factorial</span>

<span class="kn">open</span> <span class="n">nat</span>

<span class="kd">lemma</span> <span class="n">asda</span> <span class="o">{</span><span class="n">n</span><span class="o">}</span> <span class="o">:</span> <span class="bp">∀</span> <span class="o">{</span><span class="n">k</span><span class="o">},</span> <span class="n">desc_fac</span> <span class="n">n</span> <span class="n">k</span> <span class="bp">≤</span> <span class="o">(</span><span class="n">n</span> <span class="bp">+</span> <span class="n">k</span><span class="o">)</span><span class="bp">^</span><span class="n">k</span>
<span class="bp">|</span> <span class="mi">0</span> <span class="o">:=</span> <span class="kd">by</span> <span class="n">simp</span>
<span class="bp">|</span> <span class="o">(</span><span class="n">k</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)</span> <span class="o">:=</span> <span class="kd">by</span> <span class="o">{</span> <span class="n">rw</span> <span class="o">[</span><span class="n">desc_fac_succ</span><span class="o">,</span> <span class="n">pow_succ</span><span class="o">],</span>
  <span class="n">exact</span> <span class="n">nat.mul_le_mul</span> <span class="o">(</span><span class="n">le_refl</span> <span class="n">_</span><span class="o">)</span> <span class="o">(</span><span class="kd">by</span> <span class="n">simp</span> <span class="o">[</span><span class="n">asda.trans</span><span class="o">,</span> <span class="n">pow_le_pow_of_le_left</span><span class="o">])</span> <span class="o">}</span>
</code></pre></div>
<p>this will get you very close to the original lemma, and the <code>desc_fac</code> api will extend that to <code>pochhammer</code>, <code>choose</code> very easily</p>



<a name="240628203"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/nat.factorial%20lemmas/near/240628203" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/nat.2Efactorial.20lemmas.html#240628203">(May 28 2021 at 16:27)</a>:</h4>
<p>Great! Thanks!</p>



<a name="240633033"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/nat.factorial%20lemmas/near/240633033" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/nat.2Efactorial.20lemmas.html#240633033">(May 28 2021 at 17:06)</a>:</h4>
<p>Sorry, but why is <code>desc_fac</code> the <strong>ascending</strong> factorial?</p>



<a name="240633903"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/nat.factorial%20lemmas/near/240633903" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/nat.2Efactorial.20lemmas.html#240633903">(May 28 2021 at 17:13)</a>:</h4>
<p>yikes, I just googled and found out there's actually a convention</p>



<a name="240633924"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/nat.factorial%20lemmas/near/240633924" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/nat.2Efactorial.20lemmas.html#240633924">(May 28 2021 at 17:13)</a>:</h4>
<p>that's just how I named it at the time, that's pretty bad and probably deserves a rename</p>



<a name="240636574"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/nat.factorial%20lemmas/near/240636574" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/nat.2Efactorial.20lemmas.html#240636574">(May 28 2021 at 17:33)</a>:</h4>
<p>I'm making a PR now :)</p>



<a name="240636709"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/nat.factorial%20lemmas/near/240636709" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/nat.2Efactorial.20lemmas.html#240636709">(May 28 2021 at 17:34)</a>:</h4>
<p>I'm also taking the opportunity to define the actual descending factorial, as it seems more relevant in my use case.Real mathmos do not deal with nat substraction!</p>



<a name="240636971"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/nat.factorial%20lemmas/near/240636971" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/nat.2Efactorial.20lemmas.html#240636971">(May 28 2021 at 17:36)</a>:</h4>
<p>is this why I'm in Durham instead of Oxford/Cam? ;b</p>



<a name="240640404"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/nat.factorial%20lemmas/near/240640404" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/nat.2Efactorial.20lemmas.html#240640404">(May 28 2021 at 18:04)</a>:</h4>
<p>If I remember correctly, the point of defining <code>desc_fac</code> (soon-to-be-called <code>asc_fac</code>!) was to allow for quick computation using <code>norm_num</code> for the birthday problem. Did you investigate whether it was preferable to multiply from the left vs from the right time-wise?</p>



<a name="240641531"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/nat.factorial%20lemmas/near/240641531" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/nat.2Efactorial.20lemmas.html#240641531">(May 28 2021 at 18:14)</a>:</h4>
<p>I didn't, I'm afraid - sorry! left mul made a lot more sense to me while writing lemmata, though</p>



<a name="240662216"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/nat.factorial%20lemmas/near/240662216" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/nat.2Efactorial.20lemmas.html#240662216">(May 28 2021 at 21:24)</a>:</h4>
<p>Actually, neither order is optimal. Factorials can be calculated in O(n log n)</p>



<a name="240663727"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/nat.factorial%20lemmas/near/240663727" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/nat.2Efactorial.20lemmas.html#240663727">(May 28 2021 at 21:41)</a>:</h4>
<p>What algorithm calculates factorials that fast?</p>



<a name="240664950"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/nat.factorial%20lemmas/near/240664950" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/nat.2Efactorial.20lemmas.html#240664950">(May 28 2021 at 21:54)</a>:</h4>
<p>Here's a simple recursive algorithm, called "Product Recursive" from <a href="http://www.luschny.de/math/factorial/index.html">http://www.luschny.de/math/factorial/index.html</a>:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">data.nat.factorial</span>

<span class="kd">def</span> <span class="n">factorial'_aux</span> <span class="o">:</span> <span class="n">ℕ</span> <span class="bp">→</span> <span class="n">ℕ</span> <span class="bp">→</span> <span class="n">ℕ</span>
<span class="bp">|</span> <span class="n">n</span> <span class="n">k</span> <span class="o">:=</span> <span class="k">if</span> <span class="n">k</span> <span class="bp">≤</span> <span class="mi">1</span> <span class="k">then</span> <span class="n">n</span> <span class="k">else</span> <span class="k">let</span> <span class="n">l</span> <span class="o">:=</span> <span class="n">k</span> <span class="bp">/</span> <span class="mi">2</span> <span class="k">in</span>
  <span class="n">factorial'_aux</span> <span class="n">n</span> <span class="n">l</span> <span class="bp">*</span> <span class="n">factorial'_aux</span> <span class="o">(</span><span class="n">n</span> <span class="bp">+</span> <span class="n">l</span><span class="o">)</span> <span class="o">(</span><span class="n">k</span> <span class="bp">-</span> <span class="n">l</span><span class="o">)</span>
<span class="n">using_well_founded</span> <span class="o">{</span><span class="n">dec_tac</span> <span class="o">:=</span> <span class="bp">`</span><span class="o">[</span><span class="gr">sorry</span><span class="o">]}</span>

<span class="kd">def</span> <span class="n">factorial'</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="o">:=</span> <span class="n">factorial'_aux</span> <span class="mi">1</span> <span class="n">n</span>

<span class="kd">theorem</span> <span class="n">factorial'_aux_eq</span> <span class="o">(</span><span class="n">n</span> <span class="n">k</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="o">:</span> <span class="n">factorial'_aux</span> <span class="o">(</span><span class="n">n</span><span class="bp">+</span><span class="mi">1</span><span class="o">)</span> <span class="n">k</span> <span class="bp">=</span> <span class="n">nat.desc_fac</span> <span class="n">n</span> <span class="n">k</span> <span class="o">:=</span> <span class="gr">sorry</span>

<span class="kd">theorem</span> <span class="n">factorial'_eq</span> <span class="o">(</span><span class="n">n</span> <span class="n">k</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="o">:</span> <span class="n">factorial'</span> <span class="n">n</span> <span class="bp">=</span> <span class="n">nat.factorial</span> <span class="n">n</span> <span class="o">:=</span> <span class="gr">sorry</span>
</code></pre></div>



<a name="240665208"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/nat.factorial%20lemmas/near/240665208" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/nat.2Efactorial.20lemmas.html#240665208">(May 28 2021 at 21:57)</a>:</h4>
<p>The reason this is faster is that by binary splitting the factors we ensure that all multiplications are well balanced. The cost of a (naive) multiplication is the product of the number of digits of the factors, so it is a good idea to minimize the number of multiplications with a size close to the actual target value</p>



<a name="240665348"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/nat.factorial%20lemmas/near/240665348" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/nat.2Efactorial.20lemmas.html#240665348">(May 28 2021 at 21:59)</a>:</h4>
<p>This is not the fastest algorithm (that luschny page describes 21(!) algorithms for calculating factorials); the fastest ones do some kind of prime factorization</p>



<a name="240719867"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/nat.factorial%20lemmas/near/240719867" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/nat.2Efactorial.20lemmas.html#240719867">(May 29 2021 at 20:36)</a>:</h4>
<p>Nice! Will look that up.</p>



<a name="240719893"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/nat.factorial%20lemmas/near/240719893" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/nat.2Efactorial.20lemmas.html#240719893">(May 29 2021 at 20:37)</a>:</h4>
<p>Where should I put lemmas about inequalities <em>not</em> using natural division? And how should I state them? Should I coerce to <code>ℝ</code>? to <code>ℚ</code>? to something more general?</p>



<a name="240722477"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/nat.factorial%20lemmas/near/240722477" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/nat.2Efactorial.20lemmas.html#240722477">(May 29 2021 at 21:31)</a>:</h4>
<p>a division ring if you don't need commutativity of multiplcation, and a field if you do, or maybe a semifield if such a thing exists (maybe the nonnegative reals are one??)</p>



<a name="240722545"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/nat.factorial%20lemmas/near/240722545" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/nat.2Efactorial.20lemmas.html#240722545">(May 29 2021 at 21:32)</a>:</h4>
<p>oh you need an order too -- <span class="user-mention" data-user-id="321459">@Damiano Testa</span> what should Yael do here? What axioms do you use in your proofs Yael?</p>



<a name="240736818"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/nat.factorial%20lemmas/near/240736818" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/nat.2Efactorial.20lemmas.html#240736818">(May 30 2021 at 04:06)</a>:</h4>
<p>I would have to take a look, but if the proof mixes add and mul, then the <code>ordered</code> refactor has not reached it yet!  I do not have time to look at this now, though.  Also, since the lemmas that use the new typeclasses are still in PR, there is not much for you to try either...</p>



<a name="240737034"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/nat.factorial%20lemmas/near/240737034" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/nat.2Efactorial.20lemmas.html#240737034">(May 30 2021 at 04:12)</a>:</h4>
<p>There are files <code>ordered_group</code>, <code>ordered_ring</code>, <code>ordered_field</code> in algebra roughly corresponding to whether you need addition, multiplication, or division</p>



<a name="240737040"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/nat.factorial%20lemmas/near/240737040" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/nat.2Efactorial.20lemmas.html#240737040">(May 30 2021 at 04:12)</a>:</h4>
<p>so if you have a general theorem about le and div it would go in <code>ordered_field</code></p>



<a name="240737044"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/nat.factorial%20lemmas/near/240737044" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/nat.2Efactorial.20lemmas.html#240737044">(May 30 2021 at 04:13)</a>:</h4>
<p>like <a href="https://leanprover-community.github.io/mathlib_docs/find/le_div_iff">docs#le_div_iff</a></p>



<a name="240747465"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/nat.factorial%20lemmas/near/240747465" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/nat.2Efactorial.20lemmas.html#240747465">(May 30 2021 at 09:32)</a>:</h4>
<p>My proof uses the def of nat.choose and monotonicity of division by a natural. That's it I think.</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">lemma</span> <span class="n">choose_le_pow</span> <span class="o">(</span><span class="n">r</span> <span class="n">n</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="o">:</span> <span class="o">(</span><span class="n">n.choose</span> <span class="n">r</span> <span class="o">:</span> <span class="n">ℚ</span><span class="o">)</span> <span class="bp">≤</span> <span class="n">n</span><span class="bp">^</span><span class="n">r</span> <span class="bp">/</span> <span class="n">r.factorial</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="n">rw</span> <span class="n">le_div_iff'</span><span class="o">,</span>
  <span class="o">{</span> <span class="n">norm_cast</span><span class="o">,</span>
    <span class="n">rw</span> <span class="o">[</span><span class="bp">←</span><span class="n">desc_fact_eq_factorial_mul_choose</span><span class="o">],</span>
    <span class="n">exact</span> <span class="n">desc_fact_le_pow</span> <span class="n">n</span> <span class="n">r</span> <span class="o">},</span>
  <span class="n">exact_mod_cast</span> <span class="n">r.factorial_pos</span><span class="o">,</span>
<span class="kd">end</span>
</code></pre></div>
<p>So I think <code>ordered_field</code> sounds right.</p>



<a name="240753310"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/nat.factorial%20lemmas/near/240753310" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/nat.2Efactorial.20lemmas.html#240753310">(May 30 2021 at 12:22)</a>:</h4>
<p>Actually I'm probably missing something. How should I coerce naturals to <code>α</code> where <code>[linear_ordered_field α]</code>? Surely there's a "canonical" way to do that, given that we have a 1 and addition.</p>



<a name="240753539"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/nat.factorial%20lemmas/near/240753539" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/nat.2Efactorial.20lemmas.html#240753539">(May 30 2021 at 12:29)</a>:</h4>
<p>Can't you just write <code>(n : α)</code>? Or just pass the natural number where Lean is expecting an <code>α</code>?</p>



<a name="240753674"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/nat.factorial%20lemmas/near/240753674" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/nat.2Efactorial.20lemmas.html#240753674">(May 30 2021 at 12:32)</a>:</h4>
<p>Not in the file <code>algebra/ordered_field</code>. Maybe the coercion is set up in a later file?</p>



<a name="240753745"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/nat.factorial%20lemmas/near/240753745" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/nat.2Efactorial.20lemmas.html#240753745">(May 30 2021 at 12:34)</a>:</h4>
<p>In that case the lemma you are proving probably belongs in a later file.</p>



<a name="240753757"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/nat.factorial%20lemmas/near/240753757" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/nat.2Efactorial.20lemmas.html#240753757">(May 30 2021 at 12:35)</a>:</h4>
<p>But I guess the coercion is set up in <code>algebra/group.*</code> which is probably imported by <code>algebra/ordered_field</code></p>



<a name="240753761"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/nat.factorial%20lemmas/near/240753761" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/nat.2Efactorial.20lemmas.html#240753761">(May 30 2021 at 12:35)</a>:</h4>
<p>Ahah! I think the cast is in <code>data.nat.cast</code>.</p>



<a name="240753830"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/nat.factorial%20lemmas/near/240753830" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/nat.2Efactorial.20lemmas.html#240753830">(May 30 2021 at 12:37)</a>:</h4>
<p>But that doesn't sound like a great place to put my inequality. What do you think of me creating a new file for those two lemmas?</p>



<a name="240754566"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/nat.factorial%20lemmas/near/240754566" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/nat.2Efactorial.20lemmas.html#240754566">(May 30 2021 at 12:55)</a>:</h4>
<p>It looks like there's an instance <code>linear_ordered_field α</code> to <code>ordered_semiring α</code> missing.</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">data.nat.choose.basic</span>
<span class="kn">import</span> <span class="n">data.nat.cast</span>

<span class="kd">variables</span> <span class="o">{</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">linear_ordered_field</span> <span class="n">α</span><span class="o">]</span> <span class="o">[</span><span class="n">nontrivial</span> <span class="n">α</span><span class="o">]</span>

<span class="kd">lemma</span> <span class="n">choose_le_pow</span> <span class="o">(</span><span class="n">r</span> <span class="n">n</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="o">:</span> <span class="o">(</span><span class="n">n.choose</span> <span class="n">r</span> <span class="o">:</span> <span class="n">α</span><span class="o">)</span> <span class="bp">≤</span> <span class="n">n</span><span class="bp">^</span><span class="n">r</span> <span class="bp">/</span> <span class="n">r.factorial</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="n">rw</span> <span class="n">le_div_iff'</span><span class="o">,</span>
  <span class="o">{</span> <span class="n">norm_cast</span><span class="o">,</span>
    <span class="n">rw</span> <span class="bp">←</span><span class="n">nat.desc_fact_eq_factorial_mul_choose</span><span class="o">,</span>
    <span class="n">rw</span> <span class="n">nat.cast_le</span><span class="o">,</span> <span class="c1">--fails</span>
    <span class="n">exact</span> <span class="n">n.desc_fact_le_pow</span> <span class="n">r</span> <span class="o">},</span>
  <span class="n">exact_mod_cast</span> <span class="n">r.factorial_pos</span><span class="o">,</span>
<span class="kd">end</span>
</code></pre></div>



<a name="240756691"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/nat.factorial%20lemmas/near/240756691" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/nat.2Efactorial.20lemmas.html#240756691">(May 30 2021 at 13:49)</a>:</h4>
<p><a href="https://github.com/leanprover-community/mathlib/issues/7759">#7759</a></p>



<a name="243484460"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/nat.factorial%20lemmas/near/243484460" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/nat.2Efactorial.20lemmas.html#243484460">(Jun 22 2021 at 08:15)</a>:</h4>
<p>Could anyone review the PR one last time? <span aria-label="grinning face with smiling eyes" class="emoji emoji-1f601" role="img" title="grinning face with smiling eyes">:grinning_face_with_smiling_eyes:</span></p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>