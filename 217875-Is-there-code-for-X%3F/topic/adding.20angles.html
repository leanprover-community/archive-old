---
layout: archive
title: Zulip Chat Archive
permalink: /stream/217875-Is-there-code-for-X%3F/topic/adding.20angles.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/index.html">Is there code for X?</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/adding.20angles.html">adding angles</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="243832374"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/adding%20angles/near/243832374" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/adding.20angles.html#243832374">(Jun 24 2021 at 19:08)</a>:</h4>
<p>I'm idly trying to prove angle at centre is twice angle at circumference and I realise that I can't prove angle AOB plus angle BOC = angle AOC with undirected angles, indeed I am having real trouble adding hypotheses which make this statement true. Do I have to make a new definition before I can correctly state this theorem? I want to say something like "any line though O which has A and B on the same side of it, also has C on that same side".</p>



<a name="243832840"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/adding%20angles/near/243832840" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/adding.20angles.html#243832840">(Jun 24 2021 at 19:12)</a>:</h4>
<p>what's the theorem statement?</p>



<a name="243834254"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/adding%20angles/near/243834254" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/adding.20angles.html#243834254">(Jun 24 2021 at 19:24)</a>:</h4>
<p>An example of an informal statement is that B is in triangle OAC then AOB+BOC=AOC, which we could probably say right now. But more generally B could be in the "infinite triangle" with vertex O and sides extending OA and OC and I don't know how to say this in lean right now -- the question is if we have this definition</p>



<a name="243835667"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/adding%20angles/near/243835667" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/adding.20angles.html#243835667">(Jun 24 2021 at 19:35)</a>:</h4>
<p>I'm asking mostly what actual imports are you working with. Is this a theorem about R^2? Inner product spaces? Hilbert axioms for geometry?</p>



<a name="243836104"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/adding%20angles/near/243836104" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/adding.20angles.html#243836104">(Jun 24 2021 at 19:38)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">geometry.euclidean.triangle</span>

<span class="kd">universes</span> <span class="n">u</span> <span class="n">v</span>

<span class="kd">variables</span> <span class="o">{</span><span class="n">V</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">}</span> <span class="o">{</span><span class="bp">ùîº</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">v</span><span class="o">}</span> <span class="o">[</span><span class="n">inner_product_space</span> <span class="n">‚Ñù</span> <span class="n">V</span><span class="o">]</span> <span class="o">[</span><span class="n">metric_space</span> <span class="bp">ùîº</span><span class="o">]</span>
  <span class="o">[</span><span class="n">normed_add_torsor</span> <span class="n">V</span> <span class="bp">ùîº</span><span class="o">]</span> <span class="o">{</span><span class="n">n</span> <span class="o">:</span> <span class="n">‚Ñï</span><span class="o">}</span>

<span class="kn">include</span> <span class="n">V</span>

<span class="n">open_locale</span> <span class="n">euclidean_geometry</span>
<span class="n">open_locale</span> <span class="n">real</span>
<span class="kn">open</span> <span class="n">finite_dimensional</span>

<span class="kd">theorem</span> <span class="n">angles_add</span> <span class="o">(</span><span class="n">O</span> <span class="o">:</span> <span class="bp">ùîº</span><span class="o">)</span> <span class="o">(</span><span class="n">A</span> <span class="n">B</span> <span class="n">C</span> <span class="o">:</span> <span class="bp">ùîº</span><span class="o">)</span> <span class="o">(</span><span class="n">h2</span> <span class="o">:</span> <span class="n">finrank</span> <span class="n">‚Ñù</span> <span class="n">V</span> <span class="bp">=</span> <span class="mi">2</span><span class="o">)</span> <span class="o">:</span>
  <span class="bp">‚à†</span> <span class="n">A</span> <span class="n">O</span> <span class="n">B</span> <span class="bp">+</span> <span class="bp">‚à†</span> <span class="n">B</span> <span class="n">O</span> <span class="n">C</span> <span class="bp">=</span> <span class="bp">‚à†</span> <span class="n">A</span> <span class="n">O</span> <span class="n">C</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="gr">sorry</span>
<span class="kd">end</span>
</code></pre></div>
<p>Can't be proved but under some hypotheses which I can't yet express in Lean without making new definitions, it's true</p>



<a name="243836138"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/adding%20angles/near/243836138" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/adding.20angles.html#243836138">(Jun 24 2021 at 19:38)</a>:</h4>
<p>We don't have convex hull for affine spaces :-(</p>



<a name="243836150"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/adding%20angles/near/243836150" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/adding.20angles.html#243836150">(Jun 24 2021 at 19:38)</a>:</h4>
<p>One way to describe that infinite triangle is as the sum of the rays OA and OC</p>



<a name="243836228"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/adding%20angles/near/243836228" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/adding.20angles.html#243836228">(Jun 24 2021 at 19:39)</a>:</h4>
<p>there's no sum in an affine space</p>



<a name="243836271"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/adding%20angles/near/243836271" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/adding.20angles.html#243836271">(Jun 24 2021 at 19:39)</a>:</h4>
<p>well, sum of the relative vectors with O as base point</p>



<a name="243836457"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/adding%20angles/near/243836457" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/adding.20angles.html#243836457">(Jun 24 2021 at 19:41)</a>:</h4>
<p>oh my goodness, <a href="https://leanprover-community.github.io/mathlib_docs/find/norm_sub_sq_eq_norm_sq_add_norm_sq_sub_two_mul_norm_mul_norm_mul_cos_angle">docs#norm_sub_sq_eq_norm_sq_add_norm_sq_sub_two_mul_norm_mul_norm_mul_cos_angle</a></p>



<a name="243836496"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/adding%20angles/near/243836496" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/adding.20angles.html#243836496">(Jun 24 2021 at 19:41)</a>:</h4>
<p>which is clearly the law of cosines</p>



<a name="243836518"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/adding%20angles/near/243836518" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/adding.20angles.html#243836518">(Jun 24 2021 at 19:42)</a>:</h4>
<p>you mean <a href="https://leanprover-community.github.io/mathlib_docs/find/inner_product_geometry.norm_sub_sq_eq_norm_sq_add_norm_sq_sub_two_mul_norm_mul_norm_mul_cos_angle">docs#inner_product_geometry.norm_sub_sq_eq_norm_sq_add_norm_sq_sub_two_mul_norm_mul_norm_mul_cos_angle</a></p>



<a name="243836604"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/adding%20angles/near/243836604" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/adding.20angles.html#243836604">(Jun 24 2021 at 19:42)</a>:</h4>
<p>Not as long as <a href="https://leanprover-community.github.io/mathlib_docs/find/eventually_closure_subset_of_is_compact_absorbing_of_is_open_of_omega_limit_subset'">docs#eventually_closure_subset_of_is_compact_absorbing_of_is_open_of_omega_limit_subset'</a> according to someone on the discord</p>



<a name="243836605"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/adding%20angles/near/243836605" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/adding.20angles.html#243836605">(Jun 24 2021 at 19:42)</a>:</h4>
<p>it's not even possible to <code>#print</code> that without going over the line length limit</p>



<a name="243836659"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/adding%20angles/near/243836659" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bhavik Mehta <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/adding.20angles.html#243836659">(Jun 24 2021 at 19:43)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110038">Kevin Buzzard</span> <a href="#narrow/stream/217875-Is-there.20code.20for.20X.3F/topic/adding.20angles/near/243836604">said</a>:</p>
<blockquote>
<p>Not as long as <a href="https://leanprover-community.github.io/mathlib_docs/find/eventually_closure_subset_of_is_compact_absorbing_of_is_open_of_omega_limit_subset'">docs#eventually_closure_subset_of_is_compact_absorbing_of_is_open_of_omega_limit_subset'</a> according to someone on the discord</p>
</blockquote>
<p><span class="user-mention" data-user-id="364484">@Deniz Aydin</span> for the sake of credit!</p>



<a name="243836839"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/adding%20angles/near/243836839" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/adding.20angles.html#243836839">(Jun 24 2021 at 19:44)</a>:</h4>
<p>I think this is true</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">theorem</span> <span class="n">angle_at_center_equals_twice_angle_at_circumference</span> <span class="o">(</span><span class="n">O</span> <span class="o">:</span> <span class="bp">ùîº</span><span class="o">)</span> <span class="o">(</span><span class="n">A</span> <span class="n">B</span> <span class="n">C</span> <span class="o">:</span> <span class="bp">ùîº</span><span class="o">)</span>
  <span class="o">(</span><span class="n">r</span> <span class="o">:</span> <span class="n">‚Ñù</span><span class="o">)</span> <span class="o">(</span><span class="n">hOA</span> <span class="o">:</span> <span class="n">dist</span> <span class="n">O</span> <span class="n">A</span> <span class="bp">=</span> <span class="n">r</span><span class="o">)</span> <span class="o">(</span><span class="n">hOB</span> <span class="o">:</span> <span class="n">dist</span> <span class="n">O</span> <span class="n">B</span> <span class="bp">=</span> <span class="n">r</span><span class="o">)</span> <span class="o">(</span><span class="n">hOC</span> <span class="o">:</span> <span class="n">dist</span> <span class="n">O</span> <span class="n">C</span> <span class="bp">=</span> <span class="n">r</span><span class="o">)</span>
  <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="bp">‚à†</span> <span class="n">A</span> <span class="n">B</span> <span class="n">C</span> <span class="bp">&lt;</span> <span class="n">œÄ</span> <span class="bp">/</span> <span class="mi">2</span><span class="o">)</span> <span class="o">:</span>
  <span class="bp">‚à†</span> <span class="n">A</span> <span class="n">O</span> <span class="n">C</span> <span class="bp">=</span> <span class="mi">2</span> <span class="bp">*</span> <span class="bp">‚à†</span> <span class="n">A</span> <span class="n">B</span> <span class="n">C</span> <span class="o">:=</span>
</code></pre></div>
<p>but I can't write down the proof because there are two cases depending on whether BAC is &lt; 90 or &gt; 90.</p>



<a name="243836870"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/adding%20angles/near/243836870" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/adding.20angles.html#243836870">(Jun 24 2021 at 19:45)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">begin</span>
  <span class="k">have</span> <span class="n">hAB</span> <span class="o">:</span> <span class="n">A</span> <span class="bp">‚â†</span> <span class="n">B</span><span class="o">,</span>
    <span class="n">rintro</span> <span class="n">rfl</span><span class="o">,</span>
    <span class="k">have</span> <span class="n">h</span> <span class="o">:=</span> <span class="n">angle_eq_left</span> <span class="n">A</span> <span class="n">C</span><span class="o">,</span>
    <span class="n">linarith</span><span class="o">,</span>
  <span class="k">have</span> <span class="n">hAO</span> <span class="o">:</span> <span class="n">A</span> <span class="bp">‚â†</span> <span class="n">O</span><span class="o">,</span>
    <span class="n">rintro</span> <span class="n">rfl</span><span class="o">,</span>
    <span class="n">rw</span> <span class="n">dist_self</span> <span class="n">at</span> <span class="n">hOA</span><span class="o">,</span>
    <span class="n">subst</span> <span class="n">hOA</span><span class="o">,</span>
    <span class="n">apply</span> <span class="n">hAB</span><span class="o">,</span>
    <span class="n">exact</span> <span class="n">zero_eq_dist.mp</span> <span class="o">(</span><span class="n">eq.symm</span> <span class="n">hOB</span><span class="o">),</span>
  <span class="k">have</span> <span class="n">h1</span> <span class="o">:</span> <span class="mi">0</span> <span class="bp">&lt;</span> <span class="n">r</span><span class="o">,</span>
  <span class="o">{</span> <span class="n">rw</span> <span class="bp">‚Üê</span> <span class="n">hOA</span><span class="o">,</span>
    <span class="n">exact</span> <span class="n">dist_pos.2</span> <span class="n">hAO.symm</span> <span class="o">},</span>
  <span class="k">have</span> <span class="n">h2</span> <span class="o">:</span> <span class="bp">‚à†</span> <span class="n">O</span> <span class="n">A</span> <span class="n">B</span> <span class="bp">=</span> <span class="bp">‚à†</span> <span class="n">O</span> <span class="n">B</span> <span class="n">A</span><span class="o">,</span>
    <span class="n">apply</span> <span class="n">angle_eq_angle_of_dist_eq</span><span class="o">,</span>
    <span class="n">rw</span> <span class="o">[</span><span class="n">hOA</span><span class="o">,</span> <span class="n">hOB</span><span class="o">],</span>
  <span class="k">have</span> <span class="n">h3</span> <span class="o">:</span> <span class="bp">‚à†</span> <span class="n">O</span> <span class="n">B</span> <span class="n">C</span> <span class="bp">=</span> <span class="bp">‚à†</span> <span class="n">O</span> <span class="n">C</span> <span class="n">B</span><span class="o">,</span>
    <span class="n">apply</span> <span class="n">angle_eq_angle_of_dist_eq</span><span class="o">,</span>
  <span class="n">rw</span> <span class="o">[</span><span class="n">hOB</span><span class="o">,</span> <span class="n">hOC</span><span class="o">],</span>
  <span class="k">have</span> <span class="n">h4</span> <span class="o">:</span> <span class="bp">‚à†</span> <span class="n">A</span> <span class="n">B</span> <span class="n">C</span> <span class="bp">=</span> <span class="bp">‚à†</span> <span class="n">A</span> <span class="n">O</span> <span class="n">B</span> <span class="bp">+</span> <span class="bp">‚à†</span> <span class="n">B</span> <span class="n">O</span> <span class="n">C</span><span class="o">,</span>
    <span class="c1">-- this is not in general true</span>
    <span class="gr">sorry</span><span class="o">,</span>
  <span class="gr">sorry</span>
<span class="kd">end</span>
</code></pre></div>



<a name="243837119"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/adding%20angles/near/243837119" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/adding.20angles.html#243837119">(Jun 24 2021 at 19:47)</a>:</h4>
<p>(That needs <code>open euclidean_geometry</code>)</p>



<a name="243837257"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/adding%20angles/near/243837257" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/adding.20angles.html#243837257">(Jun 24 2021 at 19:48)</a>:</h4>
<p>I think the theorem is false, you haven't said that O,A,B,C are coplanar</p>



<a name="243837345"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/adding%20angles/near/243837345" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/adding.20angles.html#243837345">(Jun 24 2021 at 19:49)</a>:</h4>
<p>and in particular reasoning about that comes up when you want to add angles</p>



<a name="243837751"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/adding%20angles/near/243837751" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/adding.20angles.html#243837751">(Jun 24 2021 at 19:52)</a>:</h4>
<p>also do you want <code>h4</code> to say <code>have h4 : ‚à† A O C = ‚à† A O B + ‚à† B O C,</code>?</p>



<a name="243838043"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/adding%20angles/near/243838043" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/adding.20angles.html#243838043">(Jun 24 2021 at 19:55)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">geometry.euclidean.triangle</span>

<span class="kd">universes</span> <span class="n">u</span> <span class="n">v</span>

<span class="kd">variables</span> <span class="o">{</span><span class="n">V</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">}</span> <span class="o">{</span><span class="bp">ùîº</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">v</span><span class="o">}</span> <span class="o">[</span><span class="n">inner_product_space</span> <span class="n">‚Ñù</span> <span class="n">V</span><span class="o">]</span> <span class="o">[</span><span class="n">metric_space</span> <span class="bp">ùîº</span><span class="o">]</span>
  <span class="o">[</span><span class="n">normed_add_torsor</span> <span class="n">V</span> <span class="bp">ùîº</span><span class="o">]</span> <span class="o">{</span><span class="n">n</span> <span class="o">:</span> <span class="n">‚Ñï</span><span class="o">}</span>

<span class="kn">include</span> <span class="n">V</span>

<span class="n">open_locale</span> <span class="n">euclidean_geometry</span>
<span class="n">open_locale</span> <span class="n">real</span>
<span class="kn">open</span> <span class="n">finite_dimensional</span>
<span class="kn">open</span> <span class="n">euclidean_geometry</span>

<span class="c">/-</span><span class="cm"></span>
<span class="cm">              B</span>
<span class="cm">                  A'</span>
<span class="cm">              O</span>
<span class="cm">          A</span>
<span class="cm">                  C</span>

<span class="cm">hypothesis `h : ABC&lt;pi/2` means `AOC&lt;pi`.</span>
<span class="cm">-/</span>
<span class="kd">theorem</span> <span class="n">angle_at_center_equals_twice_angle_at_circumference</span> <span class="o">(</span><span class="n">h2</span> <span class="o">:</span> <span class="n">finrank</span> <span class="n">‚Ñù</span> <span class="n">V</span> <span class="bp">=</span> <span class="mi">2</span><span class="o">)</span>
  <span class="o">(</span><span class="n">O</span> <span class="n">A</span> <span class="n">B</span> <span class="n">C</span> <span class="o">:</span> <span class="bp">ùîº</span><span class="o">)</span> <span class="o">(</span><span class="n">r</span> <span class="o">:</span> <span class="n">‚Ñù</span><span class="o">)</span> <span class="o">(</span><span class="n">hOA</span> <span class="o">:</span> <span class="n">dist</span> <span class="n">O</span> <span class="n">A</span> <span class="bp">=</span> <span class="n">r</span><span class="o">)</span> <span class="o">(</span><span class="n">hOB</span> <span class="o">:</span> <span class="n">dist</span> <span class="n">O</span> <span class="n">B</span> <span class="bp">=</span> <span class="n">r</span><span class="o">)</span> <span class="o">(</span><span class="n">hOC</span> <span class="o">:</span> <span class="n">dist</span> <span class="n">O</span> <span class="n">C</span> <span class="bp">=</span> <span class="n">r</span><span class="o">)</span>
  <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="bp">‚à†</span> <span class="n">A</span> <span class="n">B</span> <span class="n">C</span> <span class="bp">&lt;</span> <span class="n">œÄ</span> <span class="bp">/</span> <span class="mi">2</span><span class="o">)</span> <span class="o">:</span>
  <span class="bp">‚à†</span> <span class="n">A</span> <span class="n">O</span> <span class="n">C</span> <span class="bp">=</span> <span class="mi">2</span> <span class="bp">*</span> <span class="bp">‚à†</span> <span class="n">A</span> <span class="n">B</span> <span class="n">C</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="k">have</span> <span class="n">hAB</span> <span class="o">:</span> <span class="n">A</span> <span class="bp">‚â†</span> <span class="n">B</span><span class="o">,</span>
    <span class="n">rintro</span> <span class="n">rfl</span><span class="o">,</span>
    <span class="k">have</span> <span class="n">h</span> <span class="o">:=</span> <span class="n">angle_eq_left</span> <span class="n">A</span> <span class="n">C</span><span class="o">,</span>
    <span class="n">linarith</span><span class="o">,</span>
  <span class="k">have</span> <span class="n">hAO</span> <span class="o">:</span> <span class="n">A</span> <span class="bp">‚â†</span> <span class="n">O</span><span class="o">,</span>
    <span class="n">rintro</span> <span class="n">rfl</span><span class="o">,</span>
    <span class="n">rw</span> <span class="n">dist_self</span> <span class="n">at</span> <span class="n">hOA</span><span class="o">,</span>
    <span class="n">subst</span> <span class="n">hOA</span><span class="o">,</span>
    <span class="n">apply</span> <span class="n">hAB</span><span class="o">,</span>
    <span class="n">exact</span> <span class="n">zero_eq_dist.mp</span> <span class="o">(</span><span class="n">eq.symm</span> <span class="n">hOB</span><span class="o">),</span>
  <span class="k">have</span> <span class="n">h1</span> <span class="o">:</span> <span class="mi">0</span> <span class="bp">&lt;</span> <span class="n">r</span><span class="o">,</span>
  <span class="o">{</span> <span class="n">rw</span> <span class="bp">‚Üê</span> <span class="n">hOA</span><span class="o">,</span>
    <span class="n">exact</span> <span class="n">dist_pos.2</span> <span class="n">hAO.symm</span> <span class="o">},</span>
  <span class="k">have</span> <span class="n">h2</span> <span class="o">:</span> <span class="bp">‚à†</span> <span class="n">O</span> <span class="n">A</span> <span class="n">B</span> <span class="bp">=</span> <span class="bp">‚à†</span> <span class="n">O</span> <span class="n">B</span> <span class="n">A</span><span class="o">,</span>
    <span class="n">apply</span> <span class="n">angle_eq_angle_of_dist_eq</span><span class="o">,</span>
    <span class="n">rw</span> <span class="o">[</span><span class="n">hOA</span><span class="o">,</span> <span class="n">hOB</span><span class="o">],</span>
  <span class="k">have</span> <span class="n">h3</span> <span class="o">:</span> <span class="bp">‚à†</span> <span class="n">O</span> <span class="n">B</span> <span class="n">C</span> <span class="bp">=</span> <span class="bp">‚à†</span> <span class="n">O</span> <span class="n">C</span> <span class="n">B</span><span class="o">,</span>
    <span class="n">apply</span> <span class="n">angle_eq_angle_of_dist_eq</span><span class="o">,</span>
  <span class="n">rw</span> <span class="o">[</span><span class="n">hOB</span><span class="o">,</span> <span class="n">hOC</span><span class="o">],</span>
  <span class="k">have</span> <span class="n">h4</span> <span class="o">:</span> <span class="bp">‚à†</span> <span class="n">A</span> <span class="n">B</span> <span class="n">C</span> <span class="bp">=</span> <span class="bp">‚à†</span> <span class="n">A</span> <span class="n">O</span> <span class="n">B</span> <span class="bp">+</span> <span class="bp">‚à†</span> <span class="n">B</span> <span class="n">O</span> <span class="n">C</span><span class="o">,</span>
    <span class="c1">-- this is not in general true</span>
    <span class="gr">sorry</span><span class="o">,</span>
  <span class="gr">sorry</span>
<span class="kd">end</span>
</code></pre></div>



<a name="243838169"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/adding%20angles/near/243838169" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/adding.20angles.html#243838169">(Jun 24 2021 at 19:56)</a>:</h4>
<p>In the case when it's true, this is part of the proof. The other possibility is that it's the difference of these two angles.</p>



<a name="243838377"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/adding%20angles/near/243838377" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/adding.20angles.html#243838377">(Jun 24 2021 at 19:58)</a>:</h4>
<p>Is the finrank assumption used elsewhere as a way to say that V is 2 dimensional?</p>



<a name="243838387"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/adding%20angles/near/243838387" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/adding.20angles.html#243838387">(Jun 24 2021 at 19:58)</a>:</h4>
<p>I'm interested in theorems you can't prove without making more definitions. You can state FLT in NNG but you have to define modular forms to prove it. After defining nat, succ_inj and zero_ne_succ are theorems which seem to be only provable after making more definitions (i.e. using the recursor and eliminating into type, rather than induction). Here also I can't write down my proof without making some more definitions.</p>



<a name="243838456"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/adding%20angles/near/243838456" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/adding.20angles.html#243838456">(Jun 24 2021 at 19:58)</a>:</h4>
<p>I have no idea whether the finrank hypothesis is the way to go. It makes the theorem true but there might be other ways to do it (e.g. you can demand that there exist three affine independent points but not four).</p>



<a name="243838549"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/adding%20angles/near/243838549" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/adding.20angles.html#243838549">(Jun 24 2021 at 19:59)</a>:</h4>
<p>either way, there needs to be some set of theorems that follow from the dimensionality assumption, which are likely to be crucial in the proof</p>



<a name="243838601"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/adding%20angles/near/243838601" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/adding.20angles.html#243838601">(Jun 24 2021 at 20:00)</a>:</h4>
<p>The <code>finrank</code> hypothesis doesn't look ideal to me, as it would make it awkward to talk about angles within a plane in 3D space</p>



<a name="243838648"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/adding%20angles/near/243838648" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/adding.20angles.html#243838648">(Jun 24 2021 at 20:00)</a>:</h4>
<p>the only thing that I found which looks helpful is <a href="https://leanprover-community.github.io/mathlib_docs/find/euclidean_geometry.eq_of_dist_eq_of_dist_eq_of_finrank_eq_two">docs#euclidean_geometry.eq_of_dist_eq_of_dist_eq_of_finrank_eq_two</a></p>



<a name="243838701"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/adding%20angles/near/243838701" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/adding.20angles.html#243838701">(Jun 24 2021 at 20:01)</a>:</h4>
<p>but I think you want a theorem more along the lines of your adding angles lemma</p>



<a name="243838798"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/adding%20angles/near/243838798" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/adding.20angles.html#243838798">(Jun 24 2021 at 20:02)</a>:</h4>
<p><a href="https://leanprover-community.github.io/mathlib_docs/find/euclidean_geometry.eq_of_dist_eq_of_dist_eq_of_mem_of_finrank_eq_two">docs#euclidean_geometry.eq_of_dist_eq_of_dist_eq_of_mem_of_finrank_eq_two</a>  is the subspace lemma</p>



<a name="243838857"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/adding%20angles/near/243838857" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/adding.20angles.html#243838857">(Jun 24 2021 at 20:02)</a>:</h4>
<p>Which uses <code>finrank ‚Ñù s.direction = 2</code> instead of <code>finrank ‚Ñù V = 2</code></p>



<a name="243838911"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/adding%20angles/near/243838911" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/adding.20angles.html#243838911">(Jun 24 2021 at 20:02)</a>:</h4>
<p>A simpler version of <code>angles_add</code> which doesn't need new definitions is</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">theorem</span> <span class="n">angles_add</span> <span class="o">(</span><span class="n">O</span> <span class="o">:</span> <span class="bp">ùîº</span><span class="o">)</span> <span class="o">(</span><span class="n">A</span> <span class="n">B</span> <span class="n">C</span> <span class="o">:</span> <span class="bp">ùîº</span><span class="o">)</span> <span class="o">(</span><span class="n">h2</span> <span class="o">:</span> <span class="n">finrank</span> <span class="n">‚Ñù</span> <span class="n">V</span> <span class="bp">=</span> <span class="mi">2</span><span class="o">)</span> <span class="o">:</span>
  <span class="bp">‚à†</span> <span class="n">A</span> <span class="n">O</span> <span class="n">B</span> <span class="bp">+</span> <span class="bp">‚à†</span> <span class="n">B</span> <span class="n">O</span> <span class="n">C</span> <span class="bp">=</span> <span class="bp">‚à†</span> <span class="n">A</span> <span class="n">O</span> <span class="n">C</span> <span class="bp">‚à®</span> <span class="bp">‚à†</span> <span class="n">A</span> <span class="n">O</span> <span class="n">B</span> <span class="bp">+</span> <span class="bp">‚à†</span> <span class="n">B</span> <span class="n">O</span> <span class="n">C</span> <span class="bp">=</span> <span class="bp">‚à†</span> <span class="n">A</span> <span class="n">O</span> <span class="n">C</span> <span class="bp">+</span> <span class="n">œÄ</span>
</code></pre></div>



<a name="243838922"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/adding%20angles/near/243838922" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/adding.20angles.html#243838922">(Jun 24 2021 at 20:02)</a>:</h4>
<p>Maybe the fact that the lemma Mario links to is proved via that one suggests that working in a 2D subspace is easier than working in an ambient 2D space?</p>



<a name="243839019"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/adding%20angles/near/243839019" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/adding.20angles.html#243839019">(Jun 24 2021 at 20:04)</a>:</h4>
<p>I agree that asking for the whole space to be 2d is a bit overspecific. It might be possible to lift theorems about 2d space to 2d subspaces though using metric embedding</p>



<a name="243854070"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/adding%20angles/near/243854070" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/adding.20angles.html#243854070">(Jun 24 2021 at 22:23)</a>:</h4>
<p>That version of <code>angles_add</code> isn't true because they might subtract</p>



<a name="243855395"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/adding%20angles/near/243855395" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Anatole Dedecker <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/adding.20angles.html#243855395">(Jun 24 2021 at 22:40)</a>:</h4>
<p>I have a feeling that the right way to prove that is to go through oriented angles, but I think we don't have these</p>



<a name="243855812"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/adding%20angles/near/243855812" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/adding.20angles.html#243855812">(Jun 24 2021 at 22:46)</a>:</h4>
<p>Indeed, we don't have oriented <em>anything</em>.  But now that we have determinants of endomorphisms (thanks <span class="user-mention" data-user-id="238446">@Anne Baanen</span>!), it might be time to start building it.</p>



<a name="243856236"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/adding%20angles/near/243856236" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/adding.20angles.html#243856236">(Jun 24 2021 at 22:52)</a>:</h4>
<p>Am I right in thinking for that we need oriented 2d affine spaces which generalizes to needing oriented submodules to put in <code>affine_subspace.direction</code> (aka the exterior powers)? Or are there better representations?</p>



<a name="243856414"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/adding%20angles/near/243856414" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/adding.20angles.html#243856414">(Jun 24 2021 at 22:55)</a>:</h4>
<p><span class="user-mention" data-user-id="310045">@Eric Wieser</span> The path you describe is the ideal one, but I think that in the short term, you can use <del>docs#multilinear_map</del> <a href="https://leanprover-community.github.io/mathlib_docs/find/alternating_map">docs#alternating_map</a> for a definition of orientation.</p>



<a name="243856511"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/adding%20angles/near/243856511" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/adding.20angles.html#243856511">(Jun 24 2021 at 22:56)</a>:</h4>
<p>The space of topdimensional alternating maps from a real vector space is 1-dimensional, and under the natural <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi mathvariant="double-struck">R</mi><mo>+</mo></msup></mrow><annotation encoding="application/x-tex">\mathbb{R}^+</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.771331em;vertical-align:0em;"></span><span class="mord"><span class="mord mathbb">R</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.771331em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mbin mtight">+</span></span></span></span></span></span></span></span></span></span></span> action it has two equivalence classes.</p>



<a name="243856522"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/adding%20angles/near/243856522" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/adding.20angles.html#243856522">(Jun 24 2021 at 22:56)</a>:</h4>
<p>Define an orientation to be a choice of equivalence class.</p>



<a name="243856574"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/adding%20angles/near/243856574" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/adding.20angles.html#243856574">(Jun 24 2021 at 22:57)</a>:</h4>
<p>Is <a href="https://leanprover-community.github.io/mathlib_docs/find/alternating_map">docs#alternating_map</a> a closer approximation, since that's equivalent to linear maps from the exterior powers?</p>



<a name="243856607"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/adding%20angles/near/243856607" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/adding.20angles.html#243856607">(Jun 24 2021 at 22:57)</a>:</h4>
<p>Yes thanks, fixed!  (that's what I meant to say)</p>



<a name="243856942"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/adding%20angles/near/243856942" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/adding.20angles.html#243856942">(Jun 24 2021 at 23:01)</a>:</h4>
<p>Also, it would be nice to define a density on a real vector space as an orbit of the natural <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="double-struck">Z</mi><mi mathvariant="normal">/</mi><mn>2</mn></mrow><annotation encoding="application/x-tex">\mathbb{Z}/2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathbb">Z</span><span class="mord">/2</span></span></span></span>-action (by <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>¬±</mo></mrow><annotation encoding="application/x-tex">\pm</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.66666em;vertical-align:-0.08333em;"></span><span class="mord">¬±</span></span></span></span>) on this 1-dimensional space of topdimensional alternating maps, and then prove that a density determines a measure.</p>



<a name="243857148"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/adding%20angles/near/243857148" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/adding.20angles.html#243857148">(Jun 24 2021 at 23:03)</a>:</h4>
<p>Finally (perhaps useful for <span class="user-mention" data-user-id="110038">@Kevin Buzzard</span>) there is a hack for defining oriented angles in dimension 2:  work with a real affine space modelled on <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="double-struck">C</mi></mrow><annotation encoding="application/x-tex">\mathbb{C}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68889em;vertical-align:0em;"></span><span class="mord mathbb">C</span></span></span></span> considered as a real vector space!</p>



<a name="243857420"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/adding%20angles/near/243857420" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/adding.20angles.html#243857420">(Jun 24 2021 at 23:06)</a>:</h4>
<p>I think working in <code>(exterior_algebra.Œπ R V).range ^ 2</code> gives you a poor mans exterior power?</p>



<a name="243857606"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/adding%20angles/near/243857606" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/adding.20angles.html#243857606">(Jun 24 2021 at 23:09)</a>:</h4>
<p>I don't know that syntax.</p>



<a name="243860387"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/adding%20angles/near/243860387" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joseph Myers <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/adding.20angles.html#243860387">(Jun 24 2021 at 23:43)</a>:</h4>
<p>I think working in a two-dimensional subspace is appropriate for two-dimensional geometry results going in mathlib, with the special case where the whole space is two-dimensional then being deduced from the subspace version. If you're doing some random olympiad geometry problem rather than proving a result that might be used in other proofs, then making the whole space two-dimensional seems appropriate.</p>



<a name="243860844"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/adding%20angles/near/243860844" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joseph Myers <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/adding.20angles.html#243860844">(Jun 24 2021 at 23:49)</a>:</h4>
<p>Yes, we need orientations of finite-dimensional real vector spaces (or whatever wider class of modules orientations make sense for) before defining oriented angles. I'm not sure offhand if orientations should be defined for submodules, or only for modules with the coercion from submodule to subtype and the module instance on that subtype then being used to get orientations for submodules. Also, I don't know if we have all the instances needed to get a Euclidean affine space structure on an affine subspace of a Euclidean affine space (which we'd need if only modules get orientations), but if we're missing any, they should be easy to add.</p>



<a name="243861279"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/adding%20angles/near/243861279" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joseph Myers <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/adding.20angles.html#243861279">(Jun 24 2021 at 23:53)</a>:</h4>
<p>Then you need to decide if oriented angles are real numbers, or use the <code>angle</code> type from <code>analysis.special_functions.trigonometric</code> (real numbers mod 2œÄ). And while oriented angles mod 2œÄ are certainly useful and meaningful, for many geometrical purposes you actually want oriented angles mod <code>œÄ</code> (the angle of a rotation from one undirected line to another) instead.</p>



<a name="243861793"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/adding%20angles/near/243861793" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joseph Myers <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/adding.20angles.html#243861793">(Jun 25 2021 at 00:00)</a>:</h4>
<p>As noted above, until we have convexity for affine spaces, it's hard to talk about points being between other points, or on the same / different sides of a line (which is a major reason for not being able to state most olympiad geometry problems yet, as they tend to include such conditions to reduce configuration-dependence). Once we do have convexity for affine spaces (<a href="https://github.com/leanprover-community/mathlib/issues/2910">#2910</a>), then I think we should define strict and weak versions of "between" in terms of it - both for a point being strictly or weakly between two points, and for an affine subspace being strictly or weakly between two points.</p>



<a name="243862196"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/adding%20angles/near/243862196" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/adding.20angles.html#243862196">(Jun 25 2021 at 00:06)</a>:</h4>
<p>I think one could get quite far with the complex-geometry hack:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">geometry.euclidean.basic</span>

<span class="kd">variables</span> <span class="o">{</span><span class="n">P</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">metric_space</span> <span class="n">P</span><span class="o">]</span> <span class="o">[</span><span class="n">normed_add_torsor</span> <span class="n">‚ÑÇ</span> <span class="n">P</span><span class="o">]</span>

<span class="kd">noncomputable theory</span>

<span class="kd">def</span> <span class="n">oriented_angle</span> <span class="o">(</span><span class="n">p1</span> <span class="n">p2</span> <span class="n">p3</span> <span class="o">:</span> <span class="n">P</span><span class="o">)</span> <span class="o">:</span> <span class="n">real.angle</span> <span class="o">:=</span>
<span class="n">complex.arg</span> <span class="o">((</span><span class="n">p1</span> <span class="bp">-·µ•</span> <span class="n">p2</span><span class="o">)</span> <span class="bp">/</span> <span class="o">(</span><span class="n">p3</span> <span class="bp">-·µ•</span> <span class="n">p2</span><span class="o">))</span>
</code></pre></div>



<a name="243862289"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/adding%20angles/near/243862289" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/adding.20angles.html#243862289">(Jun 25 2021 at 00:08)</a>:</h4>
<p><span class="user-mention silent" data-user-id="266253">Joseph Myers</span> <a href="#narrow/stream/217875-Is-there.20code.20for.20X.3F/topic/adding.20angles/near/243861279">said</a>:</p>
<blockquote>
<p>Then you need to decide if oriented angles are real numbers, or use the <code>angle</code> type from <code>analysis.special_functions.trigonometric</code> (real numbers mod 2œÄ). And while oriented angles mod 2œÄ are certainly useful and meaningful, for many geometrical purposes you actually want oriented angles mod <code>œÄ</code> (the angle of a rotation from one undirected line to another) instead.</p>
</blockquote>
<p>Although it brings all these problems.</p>



<a name="243862649"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/adding%20angles/near/243862649" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joseph Myers <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/adding.20angles.html#243862649">(Jun 25 2021 at 00:12)</a>:</h4>
<p>We should already have all the main pieces needed to construct an isometry between the complex plane and an arbitrary two-dimensional Euclidean affine (sub)space. But to actually use complex numbers to prove geometrical results stated in a more general context, we need a load of lemmas transporting all the geometrical definitions we have across isometries (and maybe an associated tactic to use those lemmas to reduce a general result to be proved to one for the complex plane). We don't have those lemmas at present, though I think they should be straightforward to add.</p>



<a name="243862775"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/adding%20angles/near/243862775" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/adding.20angles.html#243862775">(Jun 25 2021 at 00:14)</a>:</h4>
<p><span class="user-mention silent" data-user-id="266253">Joseph Myers</span> <a href="#narrow/stream/217875-Is-there.20code.20for.20X.3F/topic/adding.20angles/near/243862649">said</a>:</p>
<blockquote>
<p>We should already have all the main pieces needed to construct an isometry between the complex plane and an arbitrary two-dimensional Euclidean affine (sub)space.</p>
</blockquote>
<p>Indeed: <a href="https://leanprover-community.github.io/mathlib_docs/find/complex.isometry_euclidean">docs#complex.isometry_euclidean</a> plus <a href="https://leanprover-community.github.io/mathlib_docs/find/linear_isometry_equiv.of_inner_product_space">docs#linear_isometry_equiv.of_inner_product_space</a> for the linear version, so what's missing is just the linear-to-affine glue.</p>



<a name="243862791"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/adding%20angles/near/243862791" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/adding.20angles.html#243862791">(Jun 25 2021 at 00:14)</a>:</h4>
<p>(and in particular, the definition of an affine isometry, as we were discussing the other day)</p>



<a name="243862878"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/adding%20angles/near/243862878" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/adding.20angles.html#243862878">(Jun 25 2021 at 00:16)</a>:</h4>
<p><span class="user-mention silent" data-user-id="266253">Joseph Myers</span> <a href="#narrow/stream/217875-Is-there.20code.20for.20X.3F/topic/adding.20angles/near/243862649">said</a>:</p>
<blockquote>
<p>But to actually use complex numbers to prove geometrical results stated in a more general context, we need a load of lemmas transporting all the geometrical definitions we have across isometries (and maybe an associated tactic to use those lemmas to reduce a general result to be proved to one for the complex plane). We don't have those lemmas at present, though I think they should be straightforward to add.</p>
</blockquote>
<p>But all this is certainly missing, and moreover, it seems like an ugly way to prove things!  I hope that in the "ideal" state of the library nothing is done this way :)</p>



<a name="243862903"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/adding%20angles/near/243862903" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joseph Myers <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/adding.20angles.html#243862903">(Jun 25 2021 at 00:17)</a>:</h4>
<p>It's probably more for when someone wants to formalize a complex-bash solution to an olympiad problem.</p>



<a name="243863229"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/adding%20angles/near/243863229" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/adding.20angles.html#243863229">(Jun 25 2021 at 00:20)</a>:</h4>
<p>I see ... I wonder if that will ever be necessary?  I think of complex numbers as being a way of doing geometry problems by brute force, in what is sometimes a slightly more human-comprehensible form than in real co-ordinates.  But in Lean, I would think you can jump straight to the brute-force non-human-comprehensible version.</p>



<a name="243863240"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/adding%20angles/near/243863240" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joseph Myers <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/adding.20angles.html#243863240">(Jun 25 2021 at 00:21)</a>:</h4>
<p>(Transporting across isometries can be useful in non-bash cases - anything where the proof involves reflecting the diagram and looking at the reflected points, for example. Likewise, transporting across similarities.)</p>



<a name="243863250"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/adding%20angles/near/243863250" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/adding.20angles.html#243863250">(Jun 25 2021 at 00:21)</a>:</h4>
<p>Yup, no objection to that!</p>



<a name="243916536"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/adding%20angles/near/243916536" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/adding.20angles.html#243916536">(Jun 25 2021 at 13:39)</a>:</h4>
<p>This oriented angle definition is wonderful. I felt very uncomfortable with this random <code>finrank V = 2</code> assumption, and didn't have a clue how to use it. I played (on paper) with Joseph's idea of <em>defining</em> an ordered angle to be what he called "direct isometries" modulo translations (assuming "direct isometry" means "orientation-preserving" -- we're not choosing an orientation here, we're preserving all of them :-) ) but for dim(V)=n+1 these "ordered angles" now seemed to be rotations of the n-sphere, and I wasn't sure if that was what we wanted them to be in general (angle A + angle B != angle B + angle A in general!).</p>



<a name="259820540"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/adding%20angles/near/259820540" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joseph Myers <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/adding.20angles.html#259820540">(Nov 01 2021 at 02:10)</a>:</h4>
<p><span class="user-mention silent" data-user-id="260507">Heather Macbeth</span> <a href="#narrow/stream/217875-Is-there.20code.20for.20X.3F/topic/adding.20angles/near/243856511">said</a>:</p>
<blockquote>
<p>The space of topdimensional alternating maps from a real vector space is 1-dimensional, and under the natural <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi mathvariant="double-struck">R</mi><mo>+</mo></msup></mrow><annotation encoding="application/x-tex">\mathbb{R}^+</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.771331em;vertical-align:0em;"></span><span class="mord"><span class="mord mathbb">R</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.771331em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mbin mtight">+</span></span></span></span></span></span></span></span></span></span></span> action it has two equivalence classes.</p>
</blockquote>
<p>I've now implemented this definition of orientations (up to showing that these alternating maps are all multiples of the determinant and thus there are exactly two orientations). I'll do a series of PRs and then attempt to build oriented angles on top of orientations.</p>



<a name="259863159"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/adding%20angles/near/259863159" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/adding.20angles.html#259863159">(Nov 01 2021 at 13:28)</a>:</h4>
<p><span class="user-mention" data-user-id="266253">@Joseph Myers</span>  That's great!  By the way, <span class="user-mention" data-user-id="240862">@Oliver Nash</span> was asking about the status of related things just the other day:<br>
<a href="#narrow/stream/217875-Is-there.20code.20for.20X.3F/topic/determinant.20via.20exterior.20algebra">https://leanprover.zulipchat.com/#narrow/stream/217875-Is-there.20code.20for.20X.3F/topic/determinant.20via.20exterior.20algebra</a></p>



<a name="259865594"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/adding%20angles/near/259865594" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Oliver Nash <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/adding.20angles.html#259865594">(Nov 01 2021 at 13:50)</a>:</h4>
<p>Incidentally, as Kevin pointed out to me, we can express the fact that <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mo>‚àß</mo><mi>n</mi></msup><mi>V</mi></mrow><annotation encoding="application/x-tex">\wedge^n V</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord"><span class="mbin">‚àß</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.664392em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span></span></span></span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span></span></span></span> is one-dimensional neatly by saying that <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mo>‚àß</mo><mi>n</mi></msup><mi>V</mi></mrow><annotation encoding="application/x-tex">\wedge^n V</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord"><span class="mbin">‚àß</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.664392em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span></span></span></span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span></span></span></span> is a multiplicative torsor for the non-zero scalars.</p>



<a name="272321584"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/adding%20angles/near/272321584" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joseph Myers <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/adding.20angles.html#272321584">(Feb 17 2022 at 20:59)</a>:</h4>
<p>See <a href="https://github.com/leanprover-community/mathlib/pull/12106">#12106</a> for my work so far on oriented angles. As well as lots of lemmas just to set up the API, this includes a few more substantive geometrical results, e.g.</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="sd">/-- Angle at center of a circle equals twice angle at circumference, oriented vector angle</span>
<span class="sd">form. -/</span>
<span class="kd">lemma</span> <span class="n">oangle_eq_two_zsmul_oangle_sub_of_norm_eq</span> <span class="o">{</span><span class="n">x</span> <span class="n">y</span> <span class="n">z</span> <span class="o">:</span> <span class="n">V</span><span class="o">}</span> <span class="o">(</span><span class="n">hxyne</span> <span class="o">:</span> <span class="n">x</span> <span class="bp">‚â†</span> <span class="n">y</span><span class="o">)</span> <span class="o">(</span><span class="n">hxzne</span> <span class="o">:</span> <span class="n">x</span> <span class="bp">‚â†</span> <span class="n">z</span><span class="o">)</span>
  <span class="o">(</span><span class="n">hxy</span> <span class="o">:</span> <span class="bp">‚à•</span><span class="n">x</span><span class="bp">‚à•</span> <span class="bp">=</span> <span class="bp">‚à•</span><span class="n">y</span><span class="bp">‚à•</span><span class="o">)</span> <span class="o">(</span><span class="n">hxz</span> <span class="o">:</span> <span class="bp">‚à•</span><span class="n">x</span><span class="bp">‚à•</span> <span class="bp">=</span> <span class="bp">‚à•</span><span class="n">z</span><span class="bp">‚à•</span><span class="o">)</span> <span class="o">:</span> <span class="n">hb.oangle</span> <span class="n">y</span> <span class="n">z</span> <span class="bp">=</span> <span class="o">(</span><span class="mi">2</span> <span class="o">:</span> <span class="n">‚Ñ§</span><span class="o">)</span> <span class="bp">‚Ä¢</span> <span class="n">hb.oangle</span> <span class="o">(</span><span class="n">y</span> <span class="bp">-</span> <span class="n">x</span><span class="o">)</span> <span class="o">(</span><span class="n">z</span> <span class="bp">-</span> <span class="n">x</span><span class="o">)</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="k">have</span> <span class="n">hy</span> <span class="o">:</span> <span class="n">y</span> <span class="bp">‚â†</span> <span class="mi">0</span><span class="o">,</span>
  <span class="o">{</span> <span class="n">rintro</span> <span class="n">rfl</span><span class="o">,</span>
    <span class="n">rw</span> <span class="o">[</span><span class="n">norm_zero</span><span class="o">,</span> <span class="n">norm_eq_zero</span><span class="o">]</span> <span class="n">at</span> <span class="n">hxy</span><span class="o">,</span>
    <span class="n">exact</span> <span class="n">hxyne</span> <span class="n">hxy</span> <span class="o">},</span>
  <span class="k">have</span> <span class="n">hx</span> <span class="o">:</span> <span class="n">x</span> <span class="bp">‚â†</span> <span class="mi">0</span> <span class="o">:=</span> <span class="n">norm_ne_zero_iff.1</span> <span class="o">(</span><span class="n">hxy.symm</span> <span class="bp">‚ñ∏</span> <span class="n">norm_ne_zero_iff.2</span> <span class="n">hy</span><span class="o">),</span>
  <span class="k">have</span> <span class="n">hz</span> <span class="o">:</span> <span class="n">z</span> <span class="bp">‚â†</span> <span class="mi">0</span> <span class="o">:=</span> <span class="n">norm_ne_zero_iff.1</span> <span class="o">(</span><span class="n">hxz</span> <span class="bp">‚ñ∏</span> <span class="n">norm_ne_zero_iff.2</span> <span class="n">hx</span><span class="o">),</span>
  <span class="k">calc</span> <span class="n">hb.oangle</span> <span class="n">y</span> <span class="n">z</span> <span class="bp">=</span> <span class="n">hb.oangle</span> <span class="n">x</span> <span class="n">z</span> <span class="bp">-</span> <span class="n">hb.oangle</span> <span class="n">x</span> <span class="n">y</span> <span class="o">:</span> <span class="o">(</span><span class="n">hb.oangle_sub_left</span> <span class="n">hx</span> <span class="n">hy</span> <span class="n">hz</span><span class="o">)</span><span class="bp">.</span><span class="n">symm</span>
       <span class="bp">...</span>           <span class="bp">=</span> <span class="o">(</span><span class="n">œÄ</span> <span class="bp">-</span> <span class="o">(</span><span class="mi">2</span> <span class="o">:</span> <span class="n">‚Ñ§</span><span class="o">)</span> <span class="bp">‚Ä¢</span> <span class="n">hb.oangle</span> <span class="o">(</span><span class="n">x</span> <span class="bp">-</span> <span class="n">z</span><span class="o">)</span> <span class="n">x</span><span class="o">)</span> <span class="bp">-</span>
                       <span class="o">(</span><span class="n">œÄ</span> <span class="bp">-</span> <span class="o">(</span><span class="mi">2</span> <span class="o">:</span> <span class="n">‚Ñ§</span><span class="o">)</span> <span class="bp">‚Ä¢</span> <span class="n">hb.oangle</span> <span class="o">(</span><span class="n">x</span> <span class="bp">-</span> <span class="n">y</span><span class="o">)</span> <span class="n">x</span><span class="o">)</span> <span class="o">:</span>
         <span class="kd">by</span> <span class="n">rw</span> <span class="o">[</span><span class="n">hb.oangle_eq_pi_sub_two_zsmul_oangle_sub_of_norm_eq</span> <span class="n">hxzne.symm</span> <span class="n">hxz.symm</span><span class="o">,</span>
                <span class="n">hb.oangle_eq_pi_sub_two_zsmul_oangle_sub_of_norm_eq</span> <span class="n">hxyne.symm</span> <span class="n">hxy.symm</span><span class="o">]</span>
       <span class="bp">...</span>           <span class="bp">=</span> <span class="o">(</span><span class="mi">2</span> <span class="o">:</span> <span class="n">‚Ñ§</span><span class="o">)</span> <span class="bp">‚Ä¢</span> <span class="o">(</span><span class="n">hb.oangle</span> <span class="o">(</span><span class="n">x</span> <span class="bp">-</span> <span class="n">y</span><span class="o">)</span> <span class="n">x</span> <span class="bp">-</span> <span class="n">hb.oangle</span> <span class="o">(</span><span class="n">x</span> <span class="bp">-</span> <span class="n">z</span><span class="o">)</span> <span class="n">x</span><span class="o">)</span> <span class="o">:</span> <span class="kd">by</span> <span class="n">abel</span>
       <span class="bp">...</span>           <span class="bp">=</span> <span class="o">(</span><span class="mi">2</span> <span class="o">:</span> <span class="n">‚Ñ§</span><span class="o">)</span> <span class="bp">‚Ä¢</span> <span class="n">hb.oangle</span> <span class="o">(</span><span class="n">x</span> <span class="bp">-</span> <span class="n">y</span><span class="o">)</span> <span class="o">(</span><span class="n">x</span> <span class="bp">-</span> <span class="n">z</span><span class="o">)</span> <span class="o">:</span>
         <span class="kd">by</span> <span class="n">rw</span> <span class="n">hb.oangle_sub_right</span> <span class="o">(</span><span class="n">sub_ne_zero_of_ne</span> <span class="n">hxyne</span><span class="o">)</span> <span class="o">(</span><span class="n">sub_ne_zero_of_ne</span> <span class="n">hxzne</span><span class="o">)</span> <span class="n">hx</span>
       <span class="bp">...</span>           <span class="bp">=</span> <span class="o">(</span><span class="mi">2</span> <span class="o">:</span> <span class="n">‚Ñ§</span><span class="o">)</span> <span class="bp">‚Ä¢</span> <span class="n">hb.oangle</span> <span class="o">(</span><span class="n">y</span> <span class="bp">-</span> <span class="n">x</span><span class="o">)</span> <span class="o">(</span><span class="n">z</span> <span class="bp">-</span> <span class="n">x</span><span class="o">)</span> <span class="o">:</span>
         <span class="kd">by</span> <span class="n">rw</span> <span class="o">[</span><span class="bp">‚Üê</span><span class="n">oangle_neg_neg</span><span class="o">,</span> <span class="n">neg_sub</span><span class="o">,</span> <span class="n">neg_sub</span><span class="o">]</span>
<span class="kd">end</span>
</code></pre></div>



<a name="272322848"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/adding%20angles/near/272322848" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/adding.20angles.html#272322848">(Feb 17 2022 at 21:09)</a>:</h4>
<p>We finally have a theorem which my kids learnt at the age of 15 :-)</p>



<a name="272324984"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/adding%20angles/near/272324984" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joseph Myers <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/adding.20angles.html#272324984">(Feb 17 2022 at 21:28)</a>:</h4>
<p>Note that it took 50 preparatory PRs elsewhere in mathlib to get this far (though some of that is because I prefer to PR dependencies as I go along rather than mixing changes to lots of different bits of mathlib in the main PR).</p>



<a name="272364128"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/adding%20angles/near/272364128" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/adding.20angles.html#272364128">(Feb 18 2022 at 06:15)</a>:</h4>
<p><span class="user-mention" data-user-id="266253">@Joseph Myers</span> Which is greatly appreciated! Your PRs are showcases of atomic PRs that do one thing and do it right!</p>



<a name="299839950"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/adding%20angles/near/299839950" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/adding.20angles.html#299839950">(Sep 20 2022 at 20:08)</a>:</h4>
<p>I've done a big refactor of oriented angles and 2d rotations which I am now tidying up for PR, and wanted to post about it to check that everyone is ok with the change.</p>
<p>The setting is an oriented real inner product space <code>E</code> of dimension 2.  The existing constructions, by <span class="user-mention" data-user-id="266253">@Joseph Myers</span>, first define oriented angles and 2d rotations with respect to an orthonormal basis, <a href="https://leanprover-community.github.io/mathlib_docs/find/orthonormal.oangle">docs#orthonormal.oangle</a> and <a href="https://leanprover-community.github.io/mathlib_docs/find/orthonormal.rotation">docs#orthonormal.rotation</a>. Then these constructions are proved to be the same for any two orthonormal bases of the same orientation, giving <a href="https://leanprover-community.github.io/mathlib_docs/find/orientation.oangle">docs#orientation.oangle</a>, <a href="https://leanprover-community.github.io/mathlib_docs/find/orientation.rotation">docs#orientation.rotation</a>.</p>
<p>Here is my branch for the new construction: <a href="https://github.com/leanprover-community/mathlib/compare/volume-form..almost-complex-2d">https://github.com/leanprover-community/mathlib/compare/volume-form..almost-complex-2d</a><br>
(I am giving the diff relative to <a href="https://github.com/leanprover-community/mathlib/pull/16487">#16487</a> since that PR itself has a +869 ‚àí352 diff.)</p>
<p>My proposed new construction gives a basis-free construction of <code>oangle</code> and <code>rotation</code>, which cuts 600 lines from the file.  These lines are mostly made up again by a body of new theory, a new file <a href="https://github.com/leanprover-community/mathlib/blob/284747e2b754fd52fde59f6f909af85a5ea1b80c/src/analysis/inner_product_space/area_form.lean"><code>inner_product_space/area_form</code></a>.  You can read the module docstring of that file for more about the approach. Suffice it to say that one develops the theory of a "rotation-by-90-degrees map" <code>J</code> and an "oriented-area-of-a-parallelogram" map <code>œâ</code> -- we don't have oriented area yet but this map <code>œâ</code> will also be helpful when it comes to constructing that.</p>
<p>Professional geometers (<span class="user-mention" data-user-id="412682">@Moritz Doll</span> <span class="user-mention" data-user-id="110031">@Patrick Massot</span> <span class="user-mention" data-user-id="240862">@Oliver Nash</span> <span class="user-mention" data-user-id="455674">@Matej Penciak</span> ...) will notice that this is all basically a version of the inner-product/symplectic/almost-complex/Kahler triangle, although for simplicity I have done everything in two dimensions.  (I'd be glad of a naming idea for my construction <a href="https://github.com/leanprover-community/mathlib/blob/284747e2b754fd52fde59f6f909af85a5ea1b80c/src/analysis/inner_product_space/area_form.lean#L422"><code>kahler</code></a>, which betrays its origin in a way which might be confusing for people expecting the more general version.)</p>
<p>This came out of sphere eversion, in some sense.  I defined the three-dimensional analogue of all this (cross product, rotation by an angle about an axis) there, and then found the energy to redo the two-dimensional version on the same foundation (<a href="https://github.com/leanprover-community/mathlib/pull/16487">#16487</a>).</p>



<a name="299844440"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/adding%20angles/near/299844440" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joseph Myers <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/adding.20angles.html#299844440">(Sep 20 2022 at 20:37)</a>:</h4>
<p>Avoiding needing to develop the API for oriented angles twice, with respect to a basis and then a copy of that API with respect to an orientation (and <a href="https://github.com/leanprover-community/mathlib/pull/16279">#16279</a> adds the corresponding affine development for angles between points), is certainly attractive. But I think lemmas should be provided that the two definitions are equivalent, both on general principles of proving that different definitions are equivalent and for use in cases where calculations are more convenient with expressions involving separate complex numbers corresponding to the two vectors. That means four such lemmas (for each of <code>oangle</code> and <code>rotation</code>, providing a general lemma for any orthonormal basis with the right orientation, and a special-case one using <code>fin_orthonormal_basis</code> as the basis). I'd also expect a lemma proving that <code>right_angle_rotation</code> is equal to <code>rotation</code> by <code>œÄ / 2</code>.</p>



<a name="299844535"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/adding%20angles/near/299844535" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/adding.20angles.html#299844535">(Sep 20 2022 at 20:37)</a>:</h4>
<p>(I just looked at <a href="https://github.com/leanprover-community/mathlib/pull/16487">#16487</a> but couldn't see the titular feature for the trees of reasonable refactors / API lemmas)</p>



<a name="299845116"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/adding%20angles/near/299845116" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/adding.20angles.html#299845116">(Sep 20 2022 at 20:41)</a>:</h4>
<p><span class="user-mention" data-user-id="266253">@Joseph Myers</span>, what would you think of providing a single lemma for each of <code>oangle</code> and <code>rotation</code>, explaining how they can be calculated in a particular oriented orthonormal basis?  It's not clear to me that we need to duplicate all the lemmas (but I am open to hearing a different point of view).</p>



<a name="299845256"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/adding%20angles/near/299845256" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/adding.20angles.html#299845256">(Sep 20 2022 at 20:42)</a>:</h4>
<p><span class="user-mention" data-user-id="310045">@Eric Wieser</span> I don't understand your comment (is it a question?)</p>



<a name="299845381"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/adding%20angles/near/299845381" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/adding.20angles.html#299845381">(Sep 20 2022 at 20:43)</a>:</h4>
<p><span class="user-mention silent" data-user-id="260507">Heather Macbeth</span> <a href="#narrow/stream/217875-Is-there-code-for-X.3F/topic/adding.20angles/near/299845116">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="266253">Joseph Myers</span>, what would you think of providing a single lemma for each of <code>oangle</code> and <code>rotation</code>, explaining how they can be calculated in a particular oriented orthonormal basis?</p>
</blockquote>
<p>Oh, sorry, maybe I misread -- this is what you were proposing.</p>



<a name="299845434"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/adding%20angles/near/299845434" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joseph Myers <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/adding.20angles.html#299845434">(Sep 20 2022 at 20:43)</a>:</h4>
<p>I suppose a single lemma for each would work; it would simply need to be used together with the lemma stating the orientation of <code>fin_orthonormal_basis</code> whenever a proof starts by rewriting into the complex number form but doesn't care more specifically about the choice of basis.</p>



<a name="299845513"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/adding%20angles/near/299845513" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/adding.20angles.html#299845513">(Sep 20 2022 at 20:44)</a>:</h4>
<p>Apologies, I missed that it had a large tree of dependencies due to being on mobile, you can ignore my comment!</p>



<a name="299845600"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/adding%20angles/near/299845600" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/adding.20angles.html#299845600">(Sep 20 2022 at 20:44)</a>:</h4>
<p><span class="user-mention" data-user-id="266253">@Joseph Myers</span> Sorry, of course I don't mind adding 4 lemmas rather than 2; I had misread and thought you wanted to keep duplicate versions of <em>all</em> the dozens of lemmas.</p>



<a name="300091576"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/adding%20angles/near/300091576" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/adding.20angles.html#300091576">(Sep 22 2022 at 07:26)</a>:</h4>
<p>Now PR'd as <a href="https://github.com/leanprover-community/mathlib/pull/16596">#16596</a>.</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>