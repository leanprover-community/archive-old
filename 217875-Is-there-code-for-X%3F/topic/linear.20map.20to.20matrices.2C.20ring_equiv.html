---
layout: archive
title: Zulip Chat Archive
permalink: /stream/217875-Is-there-code-for-X%3F/topic/linear.20map.20to.20matrices.2C.20ring_equiv.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/index.html">Is there code for X?</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/linear.20map.20to.20matrices.2C.20ring_equiv.html">linear map to matrices, ring_equiv</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="228249649"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/linear%20map%20to%20matrices%2C%20ring_equiv/near/228249649" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yakov Pechersky <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/linear.20map.20to.20matrices.2C.20ring_equiv.html#228249649">(Mar 01 2021 at 15:28)</a>:</h4>
<p>Do we have this? Should we?</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">linear_algebra.matrix</span>
<span class="kn">open</span> <span class="n">matrix</span> <span class="n">set</span> <span class="n">linear_map</span>
<span class="kd">variables</span> <span class="o">{</span><span class="n">R</span> <span class="n">n</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">comm_ring</span> <span class="n">R</span><span class="o">]</span> <span class="o">[</span><span class="n">fintype</span> <span class="n">n</span><span class="o">]</span> <span class="o">[</span><span class="n">decidable_eq</span> <span class="n">n</span><span class="o">]</span>

<span class="sd">/-- Linear maps `(n → R) →ₗ[R] (n → R)` are ring-equivalent to `matrix n n R`. -/</span>
<span class="kd">def</span> <span class="n">linear_map.to_matrix''</span> <span class="o">:</span> <span class="o">((</span><span class="n">n</span> <span class="bp">→</span> <span class="n">R</span><span class="o">)</span> <span class="bp">→ₗ</span><span class="o">[</span><span class="n">R</span><span class="o">]</span> <span class="o">(</span><span class="n">n</span> <span class="bp">→</span> <span class="n">R</span><span class="o">))</span> <span class="bp">≃+*</span> <span class="n">matrix</span> <span class="n">n</span> <span class="n">n</span> <span class="n">R</span> <span class="o">:=</span>
<span class="o">{</span> <span class="n">to_fun</span> <span class="o">:=</span> <span class="n">to_matrix'</span><span class="o">,</span>
  <span class="n">inv_fun</span> <span class="o">:=</span> <span class="n">to_lin'</span><span class="o">,</span>
  <span class="n">left_inv</span> <span class="o">:=</span> <span class="n">to_lin'_to_matrix'</span><span class="o">,</span>
  <span class="n">right_inv</span> <span class="o">:=</span> <span class="n">to_matrix'_to_lin'</span><span class="o">,</span>
  <span class="n">map_mul'</span> <span class="o">:=</span> <span class="n">to_matrix'_mul</span><span class="o">,</span>
  <span class="n">map_add'</span> <span class="o">:=</span> <span class="n">linear_equiv.map_add'</span> <span class="n">_</span><span class="o">}</span>
</code></pre></div>



<a name="228250123"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/linear%20map%20to%20matrices%2C%20ring_equiv/near/228250123" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/linear.20map.20to.20matrices.2C.20ring_equiv.html#228250123">(Mar 01 2021 at 15:31)</a>:</h4>
<p>Do we have the R-algebra structure on square matrices sending <code>r</code> to <code>r \smul I</code>? (which would make that an alg_equiv)</p>



<a name="228251330"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/linear%20map%20to%20matrices%2C%20ring_equiv/near/228251330" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yakov Pechersky <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/linear.20map.20to.20matrices.2C.20ring_equiv.html#228251330">(Mar 01 2021 at 15:38)</a>:</h4>
<p>We do have</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">instance</span> <span class="n">matrix_algebra</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">)</span> <span class="o">(</span><span class="n">R</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">v</span><span class="o">)</span>
  <span class="o">[</span><span class="n">decidable_eq</span> <span class="n">n</span><span class="o">]</span> <span class="o">[</span><span class="n">fintype</span> <span class="n">n</span><span class="o">]</span> <span class="o">[</span><span class="n">comm_semiring</span> <span class="n">R</span><span class="o">]</span> <span class="o">:</span> <span class="n">algebra</span> <span class="n">R</span> <span class="o">(</span><span class="n">matrix</span> <span class="n">n</span> <span class="n">n</span> <span class="n">R</span><span class="o">)</span> <span class="o">:=</span>
<span class="o">{</span> <span class="n">commutes'</span> <span class="o">:=</span> <span class="kd">by</span> <span class="o">{</span> <span class="n">intros</span><span class="o">,</span> <span class="n">simp</span> <span class="o">[</span><span class="n">matrix.scalar</span><span class="o">],</span> <span class="o">},</span>
  <span class="n">smul_def'</span> <span class="o">:=</span> <span class="kd">by</span> <span class="o">{</span> <span class="n">intros</span><span class="o">,</span> <span class="n">simp</span> <span class="o">[</span><span class="n">matrix.scalar</span><span class="o">],</span> <span class="o">},</span>
  <span class="bp">..</span><span class="o">(</span><span class="n">matrix.scalar</span> <span class="n">n</span><span class="o">)</span> <span class="o">}</span>
</code></pre></div>



<a name="228252292"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/linear%20map%20to%20matrices%2C%20ring_equiv/near/228252292" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/linear.20map.20to.20matrices.2C.20ring_equiv.html#228252292">(Mar 01 2021 at 15:44)</a>:</h4>
<p><a href="https://leanprover-community.github.io/mathlib_docs/find/matrix_algebra">docs#matrix_algebra</a></p>



<a name="228252367"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/linear%20map%20to%20matrices%2C%20ring_equiv/near/228252367" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/linear.20map.20to.20matrices.2C.20ring_equiv.html#228252367">(Mar 01 2021 at 15:45)</a>:</h4>
<p>Do we also have <a href="https://leanprover-community.github.io/mathlib_docs/find/linear_map.algebra">docs#linear_map.algebra</a>?</p>



<a name="228252586"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/linear%20map%20to%20matrices%2C%20ring_equiv/near/228252586" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/linear.20map.20to.20matrices.2C.20ring_equiv.html#228252586">(Mar 01 2021 at 15:46)</a>:</h4>
<p>What do you want <code>linear_map.algebra</code> to do?</p>



<a name="228252760"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/linear%20map%20to%20matrices%2C%20ring_equiv/near/228252760" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yakov Pechersky <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/linear.20map.20to.20matrices.2C.20ring_equiv.html#228252760">(Mar 01 2021 at 15:47)</a>:</h4>
<p>So this works:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">@[simp]</span> <span class="kd">lemma</span> <span class="n">matrix.algebra_map_eq_smul</span> <span class="o">(</span><span class="n">r</span> <span class="o">:</span> <span class="n">R</span><span class="o">)</span> <span class="o">:</span> <span class="o">(</span><span class="n">algebra_map</span> <span class="n">R</span> <span class="o">(</span><span class="n">matrix</span> <span class="n">n</span> <span class="n">n</span> <span class="n">R</span><span class="o">))</span> <span class="n">r</span> <span class="bp">=</span> <span class="n">r</span> <span class="bp">•</span> <span class="mi">1</span> <span class="o">:=</span> <span class="n">rfl</span>

<span class="sd">/-- Linear maps `(n → R) →ₗ[R] (n → R)` are ring-equivalent to `matrix n n R`. -/</span>
<span class="kd">def</span> <span class="n">linear_map.to_matrix''a</span> <span class="o">:</span> <span class="o">((</span><span class="n">n</span> <span class="bp">→</span> <span class="n">R</span><span class="o">)</span> <span class="bp">→ₗ</span><span class="o">[</span><span class="n">R</span><span class="o">]</span> <span class="o">(</span><span class="n">n</span> <span class="bp">→</span> <span class="n">R</span><span class="o">))</span> <span class="bp">≃ₐ</span><span class="o">[</span><span class="n">R</span><span class="o">]</span> <span class="n">matrix</span> <span class="n">n</span> <span class="n">n</span> <span class="n">R</span> <span class="o">:=</span>
<span class="o">{</span> <span class="n">to_fun</span> <span class="o">:=</span> <span class="n">to_matrix'</span><span class="o">,</span>
  <span class="n">inv_fun</span> <span class="o">:=</span> <span class="n">to_lin'</span><span class="o">,</span>
  <span class="n">left_inv</span> <span class="o">:=</span> <span class="n">to_lin'_to_matrix'</span><span class="o">,</span>
  <span class="n">right_inv</span> <span class="o">:=</span> <span class="n">to_matrix'_to_lin'</span><span class="o">,</span>
  <span class="n">map_mul'</span> <span class="o">:=</span> <span class="n">to_matrix'_mul</span><span class="o">,</span>
  <span class="n">map_add'</span> <span class="o">:=</span> <span class="n">linear_equiv.map_add'</span> <span class="n">_</span><span class="o">,</span>
  <span class="n">commutes'</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">_</span><span class="o">,</span> <span class="kd">by</span> <span class="o">{</span>
    <span class="n">ext</span><span class="o">,</span>
    <span class="n">simp</span> <span class="n">only</span> <span class="o">[</span><span class="n">matrix.algebra_map_eq_smul</span><span class="o">,</span> <span class="n">module.algebra_map_End_apply</span><span class="o">,</span>
               <span class="n">to_matrix'_apply</span><span class="o">,</span> <span class="n">pi.smul_apply</span><span class="o">],</span>
    <span class="n">congr</span> <span class="o">}</span> <span class="o">}</span>
</code></pre></div>



<a name="228252830"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/linear%20map%20to%20matrices%2C%20ring_equiv/near/228252830" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yakov Pechersky <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/linear.20map.20to.20matrices.2C.20ring_equiv.html#228252830">(Mar 01 2021 at 15:48)</a>:</h4>
<p>Not sure how these should all be named.</p>



<a name="228253960"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/linear%20map%20to%20matrices%2C%20ring_equiv/near/228253960" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/linear.20map.20to.20matrices.2C.20ring_equiv.html#228253960">(Mar 01 2021 at 15:54)</a>:</h4>
<p>Ah, it's <del>probably</del> <a href="https://leanprover-community.github.io/mathlib_docs/find/module.endomorphism_algebra">docs#module.endomorphism_algebra</a> <del>or something</del></p>



<a name="228254145"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/linear%20map%20to%20matrices%2C%20ring_equiv/near/228254145" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yakov Pechersky <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/linear.20map.20to.20matrices.2C.20ring_equiv.html#228254145">(Mar 01 2021 at 15:55)</a>:</h4>
<p>Relatedly, do we have the <code>to_monoid_hom</code> versions of this?</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">@[simp]</span>
<span class="kd">lemma</span> <span class="n">to_ring_hom_comp_symm_to_ring_hom</span> <span class="o">(</span><span class="n">e</span> <span class="o">:</span> <span class="n">R</span> <span class="bp">≃+*</span> <span class="n">S</span><span class="o">)</span> <span class="o">:</span>
  <span class="n">e.to_ring_hom.comp</span> <span class="n">e.symm.to_ring_hom</span> <span class="bp">=</span> <span class="n">ring_hom.id</span> <span class="n">_</span> <span class="o">:=</span>
<span class="kd">by</span> <span class="o">{</span> <span class="n">ext</span><span class="o">,</span> <span class="n">simp</span> <span class="o">}</span>
</code></pre></div>



<a name="228254332"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/linear%20map%20to%20matrices%2C%20ring_equiv/near/228254332" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/linear.20map.20to.20matrices.2C.20ring_equiv.html#228254332">(Mar 01 2021 at 15:56)</a>:</h4>
<p>Probably not</p>



<a name="228254425"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/linear%20map%20to%20matrices%2C%20ring_equiv/near/228254425" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/linear.20map.20to.20matrices.2C.20ring_equiv.html#228254425">(Mar 01 2021 at 15:57)</a>:</h4>
<p>But it might be written in terms of coercions instead of an explicit <code>.to_...</code></p>



<a name="228255848"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/linear%20map%20to%20matrices%2C%20ring_equiv/near/228255848" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/linear.20map.20to.20matrices.2C.20ring_equiv.html#228255848">(Mar 01 2021 at 16:04)</a>:</h4>
<p>If you're going to add that definition, it would be good to have an un-primed version that works for a more general <code>M →ₗ[R] M</code> given a basis</p>



<a name="228256798"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/linear%20map%20to%20matrices%2C%20ring_equiv/near/228256798" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/linear.20map.20to.20matrices.2C.20ring_equiv.html#228256798">(Mar 01 2021 at 16:09)</a>:</h4>
<p>As for naming, the unprimed version could I guess be:</p>
<ul>
<li><code>linear_map.to_matrixₐ</code>, <code>matrix.to_linₐ</code></li>
<li><code>linear_map.to_matrix_alg_equiv</code>, <code>matrix.to_lin_alg_equiv</code></li>
<li><code>linear_map.to_square_matrix</code>, <code>matrix.square_to_lin</code></li>
</ul>
<p>I think I prefer the long <code>alg_equiv</code> spelling over <code>ₐ</code>, as I don't know what if any precedent there is for the latter.</p>



<a name="228285583"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/linear%20map%20to%20matrices%2C%20ring_equiv/near/228285583" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yakov Pechersky <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/linear.20map.20to.20matrices.2C.20ring_equiv.html#228285583">(Mar 01 2021 at 18:52)</a>:</h4>
<p>How would you do this for the <code>is_basis</code> version, given that there is no <code>semiring (ι →₀ R)</code>?</p>



<a name="228285716"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/linear%20map%20to%20matrices%2C%20ring_equiv/near/228285716" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/linear.20map.20to.20matrices.2C.20ring_equiv.html#228285716">(Mar 01 2021 at 18:53)</a>:</h4>
<p>I don't follow, why do you need that semiring?</p>



<a name="228286306"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/linear%20map%20to%20matrices%2C%20ring_equiv/near/228286306" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/linear.20map.20to.20matrices.2C.20ring_equiv.html#228286306">(Mar 01 2021 at 18:56)</a>:</h4>
<p>(deleted)</p>



<a name="228286411"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/linear%20map%20to%20matrices%2C%20ring_equiv/near/228286411" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/linear.20map.20to.20matrices.2C.20ring_equiv.html#228286411">(Mar 01 2021 at 18:57)</a>:</h4>
<p>nevermind... forgot to assume <code>comm_semiring</code>.</p>



<a name="228286699"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/linear%20map%20to%20matrices%2C%20ring_equiv/near/228286699" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/linear.20map.20to.20matrices.2C.20ring_equiv.html#228286699">(Mar 01 2021 at 18:59)</a>:</h4>
<p>Oh, and it looks like <a href="https://leanprover-community.github.io/mathlib_docs/find/is_basis">docs#is_basis</a> requires a <code>ring</code></p>



<a name="228286716"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/linear%20map%20to%20matrices%2C%20ring_equiv/near/228286716" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yakov Pechersky <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/linear.20map.20to.20matrices.2C.20ring_equiv.html#228286716">(Mar 01 2021 at 18:59)</a>:</h4>
<p>I might be not understanding something about the right typeclass setup here, but:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">variables</span> <span class="o">[</span><span class="n">comm_ring</span> <span class="n">R</span><span class="o">]</span> <span class="o">[</span><span class="n">add_comm_group</span> <span class="n">M</span><span class="o">]</span> <span class="o">[</span><span class="n">semiring</span> <span class="n">M</span><span class="o">]</span> <span class="o">[</span><span class="n">algebra</span> <span class="n">R</span> <span class="n">M</span><span class="o">]</span> <span class="o">[</span><span class="n">module</span> <span class="n">R</span> <span class="n">M</span><span class="o">]</span> <span class="o">[</span><span class="n">fintype</span> <span class="n">ι</span><span class="o">]</span>
  <span class="o">{</span><span class="n">v</span> <span class="o">:</span> <span class="n">ι</span> <span class="bp">→</span> <span class="n">M</span><span class="o">}</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="n">is_basis</span> <span class="n">R</span> <span class="n">v</span><span class="o">)</span>

<span class="sd">/-- Canonical algebra equivalence between a module and the linear combinations of basis vectors. -/</span>
<span class="kd">def</span> <span class="n">module_alg_equiv_finsupp</span> <span class="o">:</span> <span class="n">M</span> <span class="bp">≃ₐ</span><span class="o">[</span><span class="n">R</span><span class="o">]</span> <span class="n">ι</span> <span class="bp">→₀</span> <span class="n">R</span> <span class="o">:=</span> <span class="gr">sorry</span>
</code></pre></div>
<p>gives that <code>semiring (ι →₀ R)</code> complaint</p>



<a name="228286935"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/linear%20map%20to%20matrices%2C%20ring_equiv/near/228286935" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/linear.20map.20to.20matrices.2C.20ring_equiv.html#228286935">(Mar 01 2021 at 19:00)</a>:</h4>
<p>Oh you don't want <code>M</code>, but rather the endomorphism <del>ring</del> semiring of <code>M</code>.</p>



<a name="228287061"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/linear%20map%20to%20matrices%2C%20ring_equiv/near/228287061" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yakov Pechersky <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/linear.20map.20to.20matrices.2C.20ring_equiv.html#228287061">(Mar 01 2021 at 19:01)</a>:</h4>
<p>I was trying to copy the definition for <code>is_basis.equiv_fun</code>:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="sd">/-- A module over `R` with a finite basis is linearly equivalent to functions from its basis to `R`.</span>
<span class="sd">-/</span>
<span class="kd">def</span> <span class="n">is_basis.equiv_fun</span> <span class="o">:</span> <span class="n">M</span> <span class="bp">≃ₗ</span><span class="o">[</span><span class="n">R</span><span class="o">]</span> <span class="o">(</span><span class="n">ι</span> <span class="bp">→</span> <span class="n">R</span><span class="o">)</span> <span class="o">:=</span>
<span class="n">linear_equiv.trans</span> <span class="o">(</span><span class="n">module_equiv_finsupp</span> <span class="n">h</span><span class="o">)</span>
  <span class="o">{</span> <span class="n">to_fun</span> <span class="o">:=</span> <span class="n">coe_fn</span><span class="o">,</span>
    <span class="n">map_add'</span> <span class="o">:=</span> <span class="n">finsupp.coe_add</span><span class="o">,</span>
    <span class="n">map_smul'</span> <span class="o">:=</span> <span class="n">finsupp.coe_smul</span><span class="o">,</span>
    <span class="bp">..</span><span class="n">finsupp.equiv_fun_on_fintype</span> <span class="o">}</span>
</code></pre></div>



<a name="228287083"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/linear%20map%20to%20matrices%2C%20ring_equiv/near/228287083" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/linear.20map.20to.20matrices.2C.20ring_equiv.html#228287083">(Mar 01 2021 at 19:01)</a>:</h4>
<p>That's a linear equiv, not an algebra equiv</p>



<a name="228287232"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/linear%20map%20to%20matrices%2C%20ring_equiv/near/228287232" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/linear.20map.20to.20matrices.2C.20ring_equiv.html#228287232">(Mar 01 2021 at 19:02)</a>:</h4>
<p>The issue is that <code>is_basis</code> needs to be generalized to semirings.</p>



<a name="228287233"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/linear%20map%20to%20matrices%2C%20ring_equiv/near/228287233" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yakov Pechersky <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/linear.20map.20to.20matrices.2C.20ring_equiv.html#228287233">(Mar 01 2021 at 19:02)</a>:</h4>
<p>Yes, so to make it an alg equiv, I was going the lazy route of just substituting <code>alg_equiv</code> for <code>linear_equiv</code> where possible</p>



<a name="228287317"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/linear%20map%20to%20matrices%2C%20ring_equiv/near/228287317" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yakov Pechersky <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/linear.20map.20to.20matrices.2C.20ring_equiv.html#228287317">(Mar 01 2021 at 19:02)</a>:</h4>
<p>Because that's what worked for the <code>linear_map \to matrix</code> <code>alg_equiv</code>s</p>



<a name="228287320"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/linear%20map%20to%20matrices%2C%20ring_equiv/near/228287320" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/linear.20map.20to.20matrices.2C.20ring_equiv.html#228287320">(Mar 01 2021 at 19:02)</a>:</h4>
<p>But in your code above,, over rings, this is not what you do:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">def</span> <span class="n">linear_map.to_matrix''a</span> <span class="o">:</span> <span class="o">((</span><span class="n">n</span> <span class="bp">→</span> <span class="n">R</span><span class="o">)</span> <span class="bp">→ₗ</span><span class="o">[</span><span class="n">R</span><span class="o">]</span> <span class="o">(</span><span class="n">n</span> <span class="bp">→</span> <span class="n">R</span><span class="o">))</span> <span class="bp">≃ₐ</span><span class="o">[</span><span class="n">R</span><span class="o">]</span> <span class="n">matrix</span> <span class="n">n</span> <span class="n">n</span> <span class="n">R</span> <span class="o">:=</span>
</code></pre></div>



<a name="228287443"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/linear%20map%20to%20matrices%2C%20ring_equiv/near/228287443" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/linear.20map.20to.20matrices.2C.20ring_equiv.html#228287443">(Mar 01 2021 at 19:03)</a>:</h4>
<p>You're trying to construct this, right?</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">def</span> <span class="n">linear_map.to_matrixa</span> <span class="o">:</span> <span class="o">(</span><span class="n">M</span> <span class="bp">→ₗ</span><span class="o">[</span><span class="n">R</span><span class="o">]</span> <span class="n">M</span><span class="o">)</span> <span class="bp">≃ₐ</span><span class="o">[</span><span class="n">R</span><span class="o">]</span> <span class="n">matrix</span> <span class="n">n</span> <span class="n">n</span> <span class="n">R</span> <span class="o">:=</span>
</code></pre></div>



<a name="228287446"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/linear%20map%20to%20matrices%2C%20ring_equiv/near/228287446" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/linear.20map.20to.20matrices.2C.20ring_equiv.html#228287446">(Mar 01 2021 at 19:03)</a>:</h4>
<p>Mayube this will clarify things:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">linear_algebra.basis</span>

<span class="kd">variables</span> <span class="o">{</span><span class="n">R</span> <span class="n">M</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">comm_semiring</span> <span class="n">R</span><span class="o">]</span> <span class="o">[</span><span class="n">add_comm_monoid</span> <span class="n">M</span><span class="o">]</span> <span class="o">[</span><span class="n">semimodule</span> <span class="n">R</span> <span class="n">M</span><span class="o">]</span>

<span class="kd">example</span> <span class="o">:</span> <span class="n">semiring</span> <span class="o">(</span><span class="n">M</span> <span class="bp">→ₗ</span><span class="o">[</span><span class="n">R</span><span class="o">]</span> <span class="n">M</span><span class="o">)</span> <span class="o">:=</span> <span class="kd">by</span> <span class="n">apply_instance</span>
</code></pre></div>



<a name="228287511"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/linear%20map%20to%20matrices%2C%20ring_equiv/near/228287511" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/linear.20map.20to.20matrices.2C.20ring_equiv.html#228287511">(Mar 01 2021 at 19:03)</a>:</h4>
<p>And you already have <a href="https://leanprover-community.github.io/mathlib_docs/find/linear_map.to_matrix">docs#linear_map.to_matrix</a></p>



<a name="228287580"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/linear%20map%20to%20matrices%2C%20ring_equiv/near/228287580" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yakov Pechersky <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/linear.20map.20to.20matrices.2C.20ring_equiv.html#228287580">(Mar 01 2021 at 19:04)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="sd">/-- Linear maps `(n → R) →ₗ[R] (n → R)` are algebra equivalent to `matrix n n R`. -/</span>
<span class="kd">def</span> <span class="n">linear_map.to_matrix_alg_equiv'</span> <span class="o">:</span> <span class="o">((</span><span class="n">n</span> <span class="bp">→</span> <span class="n">R</span><span class="o">)</span> <span class="bp">→ₗ</span><span class="o">[</span><span class="n">R</span><span class="o">]</span> <span class="o">(</span><span class="n">n</span> <span class="bp">→</span> <span class="n">R</span><span class="o">))</span> <span class="bp">≃ₐ</span><span class="o">[</span><span class="n">R</span><span class="o">]</span> <span class="n">matrix</span> <span class="n">n</span> <span class="n">n</span> <span class="n">R</span> <span class="o">:=</span>
<span class="o">{</span> <span class="n">to_fun</span> <span class="o">:=</span> <span class="n">linear_map.to_matrix'</span><span class="o">,</span>
  <span class="n">inv_fun</span> <span class="o">:=</span> <span class="n">matrix.to_lin'</span><span class="o">,</span>
  <span class="n">left_inv</span> <span class="o">:=</span> <span class="n">matrix.to_lin'_to_matrix'</span><span class="o">,</span>
  <span class="n">right_inv</span> <span class="o">:=</span> <span class="n">linear_map.to_matrix'_to_lin'</span><span class="o">,</span>
  <span class="n">map_mul'</span> <span class="o">:=</span> <span class="n">linear_map.to_matrix'_mul</span><span class="o">,</span>
  <span class="n">map_add'</span> <span class="o">:=</span> <span class="n">linear_map.to_matrix'.map_add</span><span class="o">,</span>
  <span class="n">commutes'</span> <span class="o">:=</span> <span class="kd">by</span> <span class="n">simp</span> <span class="o">[</span><span class="n">module.algebra_map_End_eq_smul_id</span><span class="o">]</span> <span class="o">}</span>
</code></pre></div>
<p>And you asked for the unprimed versions</p>



<a name="228287626"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/linear%20map%20to%20matrices%2C%20ring_equiv/near/228287626" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/linear.20map.20to.20matrices.2C.20ring_equiv.html#228287626">(Mar 01 2021 at 19:04)</a>:</h4>
<p>Yes, I think you can just remove the <code>'</code> from most of the lemmas you use</p>



<a name="228287645"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/linear%20map%20to%20matrices%2C%20ring_equiv/near/228287645" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/linear.20map.20to.20matrices.2C.20ring_equiv.html#228287645">(Mar 01 2021 at 19:04)</a>:</h4>
<p>And possibly have to think about <code>commutes'</code> slightly</p>



<a name="228287758"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/linear%20map%20to%20matrices%2C%20ring_equiv/near/228287758" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yakov Pechersky <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/linear.20map.20to.20matrices.2C.20ring_equiv.html#228287758">(Mar 01 2021 at 19:05)</a>:</h4>
<p>We have that</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="sd">/-- Given bases of two modules `M₁` and `M₂` over a commutative ring `R`, we get a linear</span>
<span class="sd">equivalence between linear maps `M₁ →ₗ M₂` and matrices over `R` indexed by the bases. -/</span>
<span class="kd">def</span> <span class="n">linear_map.to_matrix</span> <span class="o">:</span> <span class="o">(</span><span class="n">M₁</span> <span class="bp">→ₗ</span><span class="o">[</span><span class="n">R</span><span class="o">]</span> <span class="n">M₂</span><span class="o">)</span> <span class="bp">≃ₗ</span><span class="o">[</span><span class="n">R</span><span class="o">]</span> <span class="n">matrix</span> <span class="n">m</span> <span class="n">n</span> <span class="n">R</span> <span class="o">:=</span>
<span class="n">linear_equiv.trans</span> <span class="o">(</span><span class="n">linear_equiv.arrow_congr</span> <span class="n">hv₁.equiv_fun</span> <span class="n">hv₂.equiv_fun</span><span class="o">)</span> <span class="n">linear_map.to_matrix'</span>
</code></pre></div>
<p>but what fills in the underscore here?</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="sd">/-- Given a basis of a module `M₁` over a commutative ring `R`, we get an algebra</span>
<span class="sd">equivalence between linear maps `M₁ →ₗ M₁` and square matrices over `R` indexed by the basis. -/</span>
<span class="kd">def</span> <span class="n">linear_map.to_matrix_alg_equiv</span> <span class="o">:</span> <span class="o">(</span><span class="n">M₁</span> <span class="bp">→ₗ</span><span class="o">[</span><span class="n">R</span><span class="o">]</span> <span class="n">M₁</span><span class="o">)</span> <span class="bp">≃ₐ</span><span class="o">[</span><span class="n">R</span><span class="o">]</span> <span class="n">matrix</span> <span class="n">n</span> <span class="n">n</span> <span class="n">R</span> <span class="o">:=</span>
<span class="n">alg_equiv.trans</span> <span class="n">_</span> <span class="n">linear_map.to_matrix_alg_equiv'</span>
</code></pre></div>



<a name="228287853"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/linear%20map%20to%20matrices%2C%20ring_equiv/near/228287853" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yakov Pechersky <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/linear.20map.20to.20matrices.2C.20ring_equiv.html#228287853">(Mar 01 2021 at 19:06)</a>:</h4>
<p>So going down this route, I wanted to write <code>is_basis.alg_equiv_fun</code></p>



<a name="228288650"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/linear%20map%20to%20matrices%2C%20ring_equiv/near/228288650" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/linear.20map.20to.20matrices.2C.20ring_equiv.html#228288650">(Mar 01 2021 at 19:10)</a>:</h4>
<p>I don't think you want to get there from here</p>



<a name="228290758"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/linear%20map%20to%20matrices%2C%20ring_equiv/near/228290758" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/linear.20map.20to.20matrices.2C.20ring_equiv.html#228290758">(Mar 01 2021 at 19:24)</a>:</h4>
<p>The "just remove the primes" approach</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">def</span> <span class="n">linear_map.to_matrix_alg_equiv</span> <span class="o">{</span><span class="n">v₁</span> <span class="o">:</span> <span class="n">n</span> <span class="bp">→</span> <span class="n">M₁</span><span class="o">}</span> <span class="o">(</span><span class="n">hv</span> <span class="o">:</span> <span class="n">is_basis</span> <span class="n">R</span> <span class="n">v₁</span><span class="o">)</span> <span class="o">:</span>
  <span class="o">(</span><span class="n">M₁</span> <span class="bp">→ₗ</span><span class="o">[</span><span class="n">R</span><span class="o">]</span> <span class="n">M₁</span><span class="o">)</span> <span class="bp">≃ₐ</span><span class="o">[</span><span class="n">R</span><span class="o">]</span> <span class="n">matrix</span> <span class="n">n</span> <span class="n">n</span> <span class="n">R</span> <span class="o">:=</span>
<span class="o">{</span> <span class="n">to_fun</span> <span class="o">:=</span> <span class="n">linear_map.to_matrix</span> <span class="n">hv</span> <span class="n">hv</span><span class="o">,</span>
  <span class="n">inv_fun</span> <span class="o">:=</span> <span class="n">matrix.to_lin</span> <span class="n">hv</span> <span class="n">hv</span><span class="o">,</span>
  <span class="n">left_inv</span> <span class="o">:=</span> <span class="n">matrix.to_lin_to_matrix</span> <span class="n">hv</span> <span class="n">hv</span><span class="o">,</span>
  <span class="n">right_inv</span> <span class="o">:=</span> <span class="n">linear_map.to_matrix_to_lin</span> <span class="n">hv</span> <span class="n">hv</span><span class="o">,</span>
  <span class="n">map_mul'</span> <span class="o">:=</span> <span class="n">linear_map.to_matrix_mul</span> <span class="n">hv</span><span class="o">,</span>
  <span class="n">map_add'</span> <span class="o">:=</span> <span class="o">(</span><span class="n">linear_map.to_matrix</span> <span class="n">hv</span> <span class="n">hv</span><span class="o">)</span><span class="bp">.</span><span class="n">map_add</span><span class="o">,</span>
  <span class="n">commutes'</span> <span class="o">:=</span> <span class="gr">sorry</span><span class="o">}</span>
</code></pre></div>



<a name="228291948"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/linear%20map%20to%20matrices%2C%20ring_equiv/near/228291948" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yakov Pechersky <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/linear.20map.20to.20matrices.2C.20ring_equiv.html#228291948">(Mar 01 2021 at 19:32)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="sd">/-- Given a basis of a module `M₁` over a commutative ring `R`, we get an algebra</span>
<span class="sd">equivalence between linear maps `M₁ →ₗ M₁` and square matrices over `R` indexed by the basis. -/</span>
<span class="kd">def</span> <span class="n">linear_map.to_matrix_alg_equiv</span> <span class="o">{</span><span class="n">v₁</span> <span class="o">:</span> <span class="n">n</span> <span class="bp">→</span> <span class="n">M₁</span><span class="o">}</span> <span class="o">(</span><span class="n">hv</span> <span class="o">:</span> <span class="n">is_basis</span> <span class="n">R</span> <span class="n">v₁</span><span class="o">)</span> <span class="o">:</span>
  <span class="o">(</span><span class="n">M₁</span> <span class="bp">→ₗ</span><span class="o">[</span><span class="n">R</span><span class="o">]</span> <span class="n">M₁</span><span class="o">)</span> <span class="bp">≃ₐ</span><span class="o">[</span><span class="n">R</span><span class="o">]</span> <span class="n">matrix</span> <span class="n">n</span> <span class="n">n</span> <span class="n">R</span> <span class="o">:=</span>
<span class="o">{</span> <span class="n">to_fun</span> <span class="o">:=</span> <span class="n">linear_map.to_matrix</span> <span class="n">hv</span> <span class="n">hv</span><span class="o">,</span>
  <span class="n">inv_fun</span> <span class="o">:=</span> <span class="n">matrix.to_lin</span> <span class="n">hv</span> <span class="n">hv</span><span class="o">,</span>
  <span class="n">left_inv</span> <span class="o">:=</span> <span class="n">matrix.to_lin_to_matrix</span> <span class="n">hv</span> <span class="n">hv</span><span class="o">,</span>
  <span class="n">right_inv</span> <span class="o">:=</span> <span class="n">linear_map.to_matrix_to_lin</span> <span class="n">hv</span> <span class="n">hv</span><span class="o">,</span>
  <span class="n">map_mul'</span> <span class="o">:=</span> <span class="n">linear_map.to_matrix_mul</span> <span class="n">hv</span><span class="o">,</span>
  <span class="n">map_add'</span> <span class="o">:=</span> <span class="o">(</span><span class="n">linear_map.to_matrix</span> <span class="n">hv</span> <span class="n">hv</span><span class="o">)</span><span class="bp">.</span><span class="n">map_add</span><span class="o">,</span>
  <span class="n">commutes'</span> <span class="o">:=</span> <span class="kd">by</span> <span class="n">simp</span> <span class="o">[</span><span class="n">module.algebra_map_End_eq_smul_id</span><span class="o">,</span> <span class="n">linear_map.to_matrix_id</span><span class="o">]</span> <span class="o">}</span>
</code></pre></div>



<a name="228291995"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/linear%20map%20to%20matrices%2C%20ring_equiv/near/228291995" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yakov Pechersky <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/linear.20map.20to.20matrices.2C.20ring_equiv.html#228291995">(Mar 01 2021 at 19:32)</a>:</h4>
<p>Thanks!</p>



<a name="228292219"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/linear%20map%20to%20matrices%2C%20ring_equiv/near/228292219" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/linear.20map.20to.20matrices.2C.20ring_equiv.html#228292219">(Mar 01 2021 at 19:33)</a>:</h4>
<p>But to answer your question, the thing that's missing is:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">variables</span> <span class="o">{</span> <span class="n">R</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">comm_ring</span> <span class="n">R</span><span class="o">]</span>

<span class="kd">variables</span> <span class="o">{</span><span class="n">M₁</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">add_comm_group</span> <span class="n">M₁</span><span class="o">]</span> <span class="o">[</span><span class="n">semimodule</span> <span class="n">R</span> <span class="n">M₁</span><span class="o">]</span>
<span class="kd">variables</span> <span class="o">{</span><span class="n">M₂</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">add_comm_group</span> <span class="n">M₂</span><span class="o">]</span> <span class="o">[</span><span class="n">semimodule</span> <span class="n">R</span> <span class="n">M₂</span><span class="o">]</span>

<span class="kd">def</span> <span class="n">linear_equiv.arrow_congr₂</span> <span class="o">(</span><span class="n">e</span> <span class="o">:</span> <span class="n">M₁</span> <span class="bp">≃ₗ</span><span class="o">[</span><span class="n">R</span><span class="o">]</span> <span class="n">M₂</span><span class="o">)</span> <span class="o">:</span> <span class="o">(</span><span class="n">M₁</span> <span class="bp">→ₗ</span><span class="o">[</span><span class="n">R</span><span class="o">]</span> <span class="n">M₁</span><span class="o">)</span> <span class="bp">≃ₐ</span><span class="o">[</span><span class="n">R</span><span class="o">]</span> <span class="o">(</span><span class="n">M₂</span> <span class="bp">→ₗ</span><span class="o">[</span><span class="n">R</span><span class="o">]</span> <span class="n">M₂</span><span class="o">)</span> <span class="o">:=</span>
<span class="o">{</span> <span class="n">map_mul'</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">x</span> <span class="n">y</span><span class="o">,</span> <span class="kd">begin</span>
    <span class="n">ext</span><span class="o">,</span>
    <span class="n">simp</span><span class="o">,</span>
  <span class="kd">end</span><span class="o">,</span>
  <span class="n">commutes'</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">r</span><span class="o">,</span> <span class="kd">begin</span>
    <span class="n">ext</span><span class="o">,</span> <span class="n">simp</span>
  <span class="kd">end</span><span class="o">,</span>
  <span class="bp">..</span><span class="o">(</span><span class="n">linear_equiv.arrow_congr</span> <span class="n">e</span> <span class="n">e</span><span class="o">)</span> <span class="o">}</span>
</code></pre></div>



<a name="228292576"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/linear%20map%20to%20matrices%2C%20ring_equiv/near/228292576" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/linear.20map.20to.20matrices.2C.20ring_equiv.html#228292576">(Mar 01 2021 at 19:35)</a>:</h4>
<p>Which probably belongs right after <a href="https://leanprover-community.github.io/mathlib_docs/find/module.endomorphism_algebra">docs#module.endomorphism_algebra</a></p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>