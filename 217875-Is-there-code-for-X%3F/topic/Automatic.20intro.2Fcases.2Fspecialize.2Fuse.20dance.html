---
layout: archive
title: Zulip Chat Archive
permalink: /stream/217875-Is-there-code-for-X%3F/topic/Automatic.20intro.2Fcases.2Fspecialize.2Fuse.20dance.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/index.html">Is there code for X?</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Automatic.20intro.2Fcases.2Fspecialize.2Fuse.20dance.html">Automatic intro/cases/specialize/use dance</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="203767478"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Automatic%20intro/cases/specialize/use%20dance/near/203767478" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kyle Miller <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Automatic.20intro.2Fcases.2Fspecialize.2Fuse.20dance.html#203767478">(Jul 13 2020 at 20:35)</a>:</h4>
<p>Sometimes you have a goal and a hypothesis that share a prefix of quantifiers.  As a contrived illustration,</p>
<div class="codehilite"><pre><span></span><code><span class="kn">example</span> <span class="o">{</span><span class="n">α</span> <span class="n">β</span><span class="o">}</span> <span class="o">(</span><span class="n">p</span> <span class="o">:</span> <span class="n">β</span> <span class="bp">→</span> <span class="kt">Prop</span><span class="o">)</span> <span class="o">(</span><span class="n">q</span> <span class="o">:</span> <span class="n">α</span> <span class="bp">→</span> <span class="n">β</span> <span class="bp">→</span> <span class="kt">Prop</span><span class="o">)</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">x</span><span class="o">,</span> <span class="bp">∃</span> <span class="n">y</span><span class="o">,</span> <span class="n">p</span> <span class="n">y</span> <span class="bp">∧</span> <span class="n">q</span> <span class="n">x</span> <span class="n">y</span><span class="o">)</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">x</span><span class="o">,</span> <span class="bp">∃</span> <span class="n">y</span><span class="o">,</span> <span class="n">q</span> <span class="n">x</span> <span class="n">y</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="n">sorry</span>
<span class="kn">end</span>
</code></pre></div>


<p>I was wondering if there was a tactic, invoked like <code>auto_use h</code>, that would automatically produce this sequence of tactics:</p>
<div class="codehilite"><pre><span></span><code>  <span class="n">intro</span> <span class="n">x</span><span class="o">,</span>
  <span class="n">specialize</span> <span class="n">h</span> <span class="n">x</span><span class="o">,</span>
  <span class="n">cases</span> <span class="n">h</span> <span class="k">with</span> <span class="n">y</span> <span class="n">h</span><span class="o">,</span>
  <span class="n">use</span> <span class="n">y</span><span class="o">,</span>
</code></pre></div>


<p>Perhaps it might even be able to apply cases on other inductive types when one of the cases can be <code>use</code>d.  For example, with a slight alteration to the above example (applying commutativity to the conjunction), it might produce the following proof:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">example</span> <span class="o">{</span><span class="n">α</span> <span class="n">β</span><span class="o">}</span> <span class="o">(</span><span class="n">p</span> <span class="o">:</span> <span class="n">β</span> <span class="bp">→</span> <span class="kt">Prop</span><span class="o">)</span> <span class="o">(</span><span class="n">q</span> <span class="o">:</span> <span class="n">α</span> <span class="bp">→</span> <span class="n">β</span> <span class="bp">→</span> <span class="kt">Prop</span><span class="o">)</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">x</span><span class="o">,</span> <span class="bp">∃</span> <span class="n">y</span><span class="o">,</span> <span class="n">q</span> <span class="n">x</span> <span class="n">y</span> <span class="bp">∧</span> <span class="n">p</span> <span class="n">y</span><span class="o">)</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">x</span><span class="o">,</span> <span class="bp">∃</span> <span class="n">y</span><span class="o">,</span> <span class="n">q</span> <span class="n">x</span> <span class="n">y</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="n">intro</span> <span class="n">x</span><span class="o">,</span>
  <span class="n">specialize</span> <span class="n">h</span> <span class="n">x</span><span class="o">,</span>
  <span class="n">cases</span> <span class="n">h</span> <span class="k">with</span> <span class="n">y</span> <span class="n">h</span><span class="o">,</span>
  <span class="n">use</span> <span class="n">y</span><span class="o">,</span>
  <span class="n">cases</span> <span class="n">h</span> <span class="k">with</span> <span class="n">h&#39;</span> <span class="n">h</span><span class="o">,</span>
  <span class="n">use</span> <span class="n">h&#39;</span><span class="o">,</span>
<span class="kn">end</span>
</code></pre></div>


<p>While it's true you can compress this proof, the point is to show the intended effect of the tactic.</p>
<p>That's a sort of imperative description of the wanted tactic, but put another way the idea would be to enter the "shared context" implied by a goal and a hypothesis.</p>
<p>(Tagging <span class="user-mention" data-user-id="304588">@Rahul Dalal</span> because we discussed this at the Berkeley Lean Seminar.)</p>



<a name="203767683"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Automatic%20intro/cases/specialize/use%20dance/near/203767683" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Automatic.20intro.2Fcases.2Fspecialize.2Fuse.20dance.html#203767683">(Jul 13 2020 at 20:36)</a>:</h4>
<p><code>tidy</code> is probably the closest to what you want...</p>



<a name="203767705"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Automatic%20intro/cases/specialize/use%20dance/near/203767705" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Automatic.20intro.2Fcases.2Fspecialize.2Fuse.20dance.html#203767705">(Jul 13 2020 at 20:36)</a>:</h4>
<p>But it's more general, and hence also more conservative.</p>



<a name="203768054"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Automatic%20intro/cases/specialize/use%20dance/near/203768054" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kyle Miller <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Automatic.20intro.2Fcases.2Fspecialize.2Fuse.20dance.html#203768054">(Jul 13 2020 at 20:39)</a>:</h4>
<p>I guess this question comes a place of wanting a tactic where you know what it will do and it's safe to use in the middle of a proof.</p>
<p>I was going to say that <code>tidy</code> certainly would deal with the second example, but I decided to check, and it actually makes a bit of a mess of the context.  Maybe this is a bug in <code>tidy</code>?</p>
<div class="codehilite"><pre><span></span><code><span class="mi">2</span> <span class="n">goals</span>
<span class="n">α</span> <span class="o">:</span> <span class="n">Sort</span> <span class="err">?</span><span class="o">,</span>
<span class="n">β</span> <span class="o">:</span> <span class="n">Sort</span> <span class="err">?</span><span class="o">,</span>
<span class="n">p</span> <span class="o">:</span> <span class="n">β</span> <span class="bp">→</span> <span class="kt">Prop</span><span class="o">,</span>
<span class="n">q</span> <span class="o">:</span> <span class="n">α</span> <span class="bp">→</span> <span class="n">β</span> <span class="bp">→</span> <span class="kt">Prop</span><span class="o">,</span>
<span class="n">h</span> <span class="o">:</span> <span class="bp">∀</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="n">α</span><span class="o">),</span> <span class="bp">∃</span> <span class="o">(</span><span class="n">y</span> <span class="o">:</span> <span class="n">β</span><span class="o">),</span> <span class="n">q</span> <span class="n">x</span> <span class="n">y</span> <span class="bp">∧</span> <span class="n">p</span> <span class="n">y</span><span class="o">,</span>
<span class="n">x</span> <span class="o">:</span> <span class="n">α</span>
<span class="err">⊢</span> <span class="n">β</span>

<span class="n">α</span> <span class="o">:</span> <span class="n">Sort</span> <span class="err">?</span><span class="o">,</span>
<span class="n">β</span> <span class="o">:</span> <span class="n">Sort</span> <span class="err">?</span><span class="o">,</span>
<span class="n">p</span> <span class="o">:</span> <span class="n">β</span> <span class="bp">→</span> <span class="kt">Prop</span><span class="o">,</span>
<span class="n">q</span> <span class="o">:</span> <span class="n">α</span> <span class="bp">→</span> <span class="n">β</span> <span class="bp">→</span> <span class="kt">Prop</span><span class="o">,</span>
<span class="n">h</span> <span class="o">:</span> <span class="bp">∀</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="n">α</span><span class="o">),</span> <span class="bp">∃</span> <span class="o">(</span><span class="n">y</span> <span class="o">:</span> <span class="n">β</span><span class="o">),</span> <span class="n">q</span> <span class="n">x</span> <span class="n">y</span> <span class="bp">∧</span> <span class="n">p</span> <span class="n">y</span><span class="o">,</span>
<span class="n">x</span> <span class="o">:</span> <span class="n">α</span>
<span class="err">⊢</span> <span class="n">q</span> <span class="n">x</span> <span class="err">?</span><span class="n">m_1</span>
</code></pre></div>



<a name="203768277"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Automatic%20intro/cases/specialize/use%20dance/near/203768277" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Automatic.20intro.2Fcases.2Fspecialize.2Fuse.20dance.html#203768277">(Jul 13 2020 at 20:41)</a>:</h4>
<p>What does <code>tidy?</code> say?</p>



<a name="203768358"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Automatic%20intro/cases/specialize/use%20dance/near/203768358" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Automatic.20intro.2Fcases.2Fspecialize.2Fuse.20dance.html#203768358">(Jul 13 2020 at 20:42)</a>:</h4>
<p>I think <code>tidy</code> isn't really good at apply <code>cases</code> apart from some very specialised examples.</p>



<a name="203768589"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Automatic%20intro/cases/specialize/use%20dance/near/203768589" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Automatic.20intro.2Fcases.2Fspecialize.2Fuse.20dance.html#203768589">(Jul 13 2020 at 20:43)</a>:</h4>
<p>At least with the examples you gave, it will make a nice tactic writing exercise.</p>



<a name="203769122"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Automatic%20intro/cases/specialize/use%20dance/near/203769122" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Automatic.20intro.2Fcases.2Fspecialize.2Fuse.20dance.html#203769122">(Jul 13 2020 at 20:48)</a>:</h4>
<p>I'm surprised we don't already have a lemma like</p>
<div class="codehilite"><pre><span></span><code><span class="kn">lemma</span> <span class="n">forall_imp</span> <span class="o">{</span><span class="n">α</span><span class="o">}</span> <span class="o">(</span><span class="n">p</span> <span class="n">q</span> <span class="o">:</span> <span class="n">α</span> <span class="bp">→</span> <span class="kt">Prop</span><span class="o">)</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">a</span><span class="o">,</span> <span class="n">p</span> <span class="n">a</span> <span class="bp">→</span> <span class="n">q</span> <span class="n">a</span><span class="o">)</span> <span class="o">:</span> <span class="o">(</span><span class="bp">∀</span> <span class="n">a</span><span class="o">,</span> <span class="n">p</span> <span class="n">a</span><span class="o">)</span> <span class="bp">→</span> <span class="o">(</span><span class="bp">∀</span> <span class="n">a</span><span class="o">,</span> <span class="n">q</span> <span class="n">a</span><span class="o">)</span> <span class="o">:=</span>
<span class="k">by</span> <span class="n">tidy</span>
</code></pre></div>


<p>Then you can use this strategy:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">example</span> <span class="o">{</span><span class="n">α</span> <span class="n">β</span><span class="o">}</span> <span class="o">(</span><span class="n">p</span> <span class="o">:</span> <span class="n">β</span> <span class="bp">→</span> <span class="kt">Prop</span><span class="o">)</span> <span class="o">(</span><span class="n">q</span> <span class="o">:</span> <span class="n">α</span> <span class="bp">→</span> <span class="n">β</span> <span class="bp">→</span> <span class="kt">Prop</span><span class="o">)</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">x</span><span class="o">,</span> <span class="bp">∃</span> <span class="n">y</span><span class="o">,</span> <span class="n">p</span> <span class="n">y</span> <span class="bp">∧</span> <span class="n">q</span> <span class="n">x</span> <span class="n">y</span><span class="o">)</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">x</span><span class="o">,</span> <span class="bp">∃</span> <span class="n">y</span><span class="o">,</span> <span class="n">q</span> <span class="n">x</span> <span class="n">y</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="n">revert</span> <span class="n">h</span><span class="o">,</span>
  <span class="n">apply</span> <span class="n">forall_imp</span><span class="o">,</span> <span class="n">intro</span><span class="o">,</span>
  <span class="n">apply</span> <span class="n">exists_imp_exists</span><span class="o">,</span> <span class="n">intro</span><span class="o">,</span>
  <span class="c1">-- ⊢ p a_1 ∧ q a a_1 → q a a_1</span>
  <span class="n">tauto</span>
<span class="kn">end</span>
</code></pre></div>



<a name="203769171"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Automatic%20intro/cases/specialize/use%20dance/near/203769171" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kyle Miller <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Automatic.20intro.2Fcases.2Fspecialize.2Fuse.20dance.html#203769171">(Jul 13 2020 at 20:48)</a>:</h4>
<p><span class="user-mention" data-user-id="110031">@Patrick Massot</span> Sounds good. I'll give it a try.</p>



<a name="203769196"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Automatic%20intro/cases/specialize/use%20dance/near/203769196" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Automatic.20intro.2Fcases.2Fspecialize.2Fuse.20dance.html#203769196">(Jul 13 2020 at 20:48)</a>:</h4>
<p>Also I wonder whether it could be in scope for <code>mono</code>.</p>



<a name="203769244"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Automatic%20intro/cases/specialize/use%20dance/near/203769244" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kyle Miller <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Automatic.20intro.2Fcases.2Fspecialize.2Fuse.20dance.html#203769244">(Jul 13 2020 at 20:49)</a>:</h4>
<p><span class="user-mention silent" data-user-id="112680">Johan Commelin</span> <a href="#narrow/stream/217875-Is-there.20code.20for.20X.3F/topic/Automatic.20intro.2Fcases.2Fspecialize.2Fuse.20dance/near/203768277">said</a>:</p>
<blockquote>
<p>What does <code>tidy?</code> say?</p>
</blockquote>
<p>It gives <code>intros x, dsimp at *, fsplit</code></p>



<a name="203769630"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Automatic%20intro/cases/specialize/use%20dance/near/203769630" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> David Wärn <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Automatic.20intro.2Fcases.2Fspecialize.2Fuse.20dance.html#203769630">(Jul 13 2020 at 20:52)</a>:</h4>
<p>I was about to suggest <code>forall_imp</code>. Shocking that it does not exist...</p>



<a name="203770011"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Automatic%20intro/cases/specialize/use%20dance/near/203770011" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kyle Miller <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Automatic.20intro.2Fcases.2Fspecialize.2Fuse.20dance.html#203770011">(Jul 13 2020 at 20:55)</a>:</h4>
<p><span class="user-mention" data-user-id="110032">@Reid Barton</span> That's fair, but it was just a contrived example.  I don't have any real examples on hand, but I've found myself doing this sort of dance in various contexts, and Rahul was saying he was doing it with even more deeply nested quantifiers. (However, in his case, it turned out to be something like <code>simp_rw [forall_and_distrib]</code>, if I remember correctly.)</p>



<a name="203770120"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Automatic%20intro/cases/specialize/use%20dance/near/203770120" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kyle Miller <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Automatic.20intro.2Fcases.2Fspecialize.2Fuse.20dance.html#203770120">(Jul 13 2020 at 20:56)</a>:</h4>
<p>Should I add <code>forall_imp</code> to mathlib?</p>



<a name="203770133"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Automatic%20intro/cases/specialize/use%20dance/near/203770133" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Automatic.20intro.2Fcases.2Fspecialize.2Fuse.20dance.html#203770133">(Jul 13 2020 at 20:56)</a>:</h4>
<p>If you want to prove <code>iff</code> rather than an implication the support is slightly better, but still not so great</p>



<a name="203770985"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Automatic%20intro/cases/specialize/use%20dance/near/203770985" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Automatic.20intro.2Fcases.2Fspecialize.2Fuse.20dance.html#203770985">(Jul 13 2020 at 21:03)</a>:</h4>
<p>(for example, <code>forall_congr</code> actually exists!)</p>



<a name="203772784"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Automatic%20intro/cases/specialize/use%20dance/near/203772784" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kyle Miller <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Automatic.20intro.2Fcases.2Fspecialize.2Fuse.20dance.html#203772784">(Jul 13 2020 at 21:18)</a>:</h4>
<p><span class="user-mention" data-user-id="110032">@Reid Barton</span> Lean has the non-dependent version of <code>forall_imp</code> already: <code>combinator.S</code>. <span aria-label="grinning" class="emoji emoji-1f600" role="img" title="grinning">:grinning:</span></p>



<a name="203773357"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Automatic%20intro/cases/specialize/use%20dance/near/203773357" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kyle Miller <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Automatic.20intro.2Fcases.2Fspecialize.2Fuse.20dance.html#203773357">(Jul 13 2020 at 21:23)</a>:</h4>
<p><span class="user-mention" data-user-id="110032">@Reid Barton</span> Ok, created a pull request <a href="https://github.com/leanprover-community/mathlib/issues/3391">#3391</a></p>



<a name="203773575"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Automatic%20intro/cases/specialize/use%20dance/near/203773575" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kyle Miller <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Automatic.20intro.2Fcases.2Fspecialize.2Fuse.20dance.html#203773575">(Jul 13 2020 at 21:24)</a>:</h4>
<p>I didn't notice that the proof is laughing at the situation: <code>λ h' a, h a (h' a)</code>.</p>



<a name="203997071"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Automatic%20intro/cases/specialize/use%20dance/near/203997071" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kyle Miller <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Automatic.20intro.2Fcases.2Fspecialize.2Fuse.20dance.html#203997071">(Jul 15 2020 at 18:52)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110031">Patrick Massot</span> <a href="#narrow/stream/217875-Is-there.20code.20for.20X.3F/topic/Automatic.20intro.2Fcases.2Fspecialize.2Fuse.20dance/near/203768589">said</a>:</p>
<blockquote>
<p>At least with the examples you gave, it will make a nice tactic writing exercise.</p>
</blockquote>
<p>That was kind of fun figuring out how to get this to work.  I mostly looked carefully at the code for <code>use</code>, <code>specialize</code>, <code>intro</code>, and <code>cases</code> and combined them into a single <code>enter</code> tactic.  An example application of the tactic is this tutorial exercise:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">-- 0073</span>
<span class="kn">lemma</span> <span class="n">seq_continuous_of_continuous</span> <span class="o">(</span><span class="n">hf</span> <span class="o">:</span> <span class="n">continuous_at_pt</span> <span class="n">f</span> <span class="n">x₀</span><span class="o">)</span>
  <span class="o">(</span><span class="n">hu</span> <span class="o">:</span> <span class="n">seq_limit</span> <span class="n">u</span> <span class="n">x₀</span><span class="o">)</span> <span class="o">:</span> <span class="n">seq_limit</span> <span class="o">(</span><span class="n">f</span> <span class="err">∘</span> <span class="n">u</span><span class="o">)</span> <span class="o">(</span><span class="n">f</span> <span class="n">x₀</span><span class="o">)</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="n">enter</span> <span class="n">hf</span> <span class="k">with</span> <span class="n">ε</span> <span class="n">εpos</span><span class="o">,</span>
  <span class="n">enter</span> <span class="n">hf</span> <span class="k">with</span> <span class="n">δ</span> <span class="n">δpos</span> <span class="n">at</span> <span class="n">hu</span><span class="o">,</span>
  <span class="n">enter</span> <span class="n">hu</span> <span class="k">with</span> <span class="n">N</span> <span class="n">n</span> <span class="n">nbig</span><span class="o">,</span>
  <span class="n">specialize</span> <span class="n">hf</span> <span class="o">(</span><span class="n">u</span> <span class="n">n</span><span class="o">)</span> <span class="n">hu</span><span class="o">,</span>
  <span class="n">exact</span> <span class="n">hf</span><span class="o">,</span>
<span class="kn">end</span>
</code></pre></div>


<p>What <code>enter hf with ε εpos</code> does is look at the quantifiers in <code>hf</code> and the goal and give them the names <code>ε</code> and <code>εpos</code> while doing the appropriate actions to eliminate the quantifiers.  The <code>enter hf with δ δpos at hu</code> does something similar, but for two hypotheses <code>hf</code> and <code>hu</code> (this is a non-standard <code>at</code> where only a single hypothesis may be mentioned).  The number of identifiers mentioned in the <code>with</code> clause determines how many quantifiers to eliminate.</p>
<p>The code follows:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="n">analysis</span><span class="bp">.</span><span class="n">specific_limits</span>

<span class="kn">import</span> <span class="n">tactic</span>

<span class="kn">namespace</span> <span class="n">tactic</span>

<span class="kn">open</span> <span class="n">tactic</span>
<span class="kn">open</span> <span class="n">interactive</span>
<span class="kn">open</span> <span class="n">interactive</span><span class="bp">.</span><span class="n">types</span>
<span class="kn">open</span> <span class="n">lean</span><span class="bp">.</span><span class="n">parser</span>

<span class="kn">namespace</span> <span class="n">interactive</span>

<span class="n">meta</span> <span class="n">def</span> <span class="n">enter_aux_use</span> <span class="o">(</span><span class="n">e</span> <span class="o">:</span> <span class="n">expr</span><span class="o">)</span> <span class="o">:</span> <span class="n">tactic</span> <span class="n">unit</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">focus1</span> <span class="err">$</span> <span class="n">tactic</span><span class="bp">.</span><span class="n">exact</span> <span class="n">e</span> <span class="bp">&gt;&gt;</span> <span class="n">done</span><span class="o">)</span> <span class="bp">&lt;|&gt;</span> <span class="o">(</span><span class="n">fconstructor</span> <span class="bp">&gt;&gt;</span> <span class="n">enter_aux_use</span><span class="o">)</span>

<span class="n">meta</span> <span class="n">def</span> <span class="n">enter_get_local</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="n">name</span><span class="o">)</span> <span class="o">:</span> <span class="n">tactic</span> <span class="n">expr</span> <span class="o">:=</span>
<span class="n">get_local</span> <span class="n">n</span> <span class="bp">&lt;|&gt;</span> <span class="n">tactic</span><span class="bp">.</span><span class="n">fail</span> <span class="o">(</span><span class="n">format</span><span class="bp">.</span><span class="n">join</span> <span class="o">[</span><span class="s2">&quot;enter failed: no such local &#39;&quot;</span><span class="o">,</span> <span class="n">to_fmt</span> <span class="n">n</span><span class="o">,</span> <span class="s2">&quot;&#39;&quot;</span><span class="o">])</span>

<span class="c">/-</span><span class="cm"></span>
<span class="cm">The implementation of `enter` for a hypothesis and the goal.</span>
<span class="cm">-/</span>
<span class="n">meta</span> <span class="n">def</span> <span class="n">enter_aux</span> <span class="o">:</span> <span class="n">name</span> <span class="bp">→</span> <span class="n">parse</span> <span class="n">with_ident_list</span> <span class="bp">→</span> <span class="n">tactic</span> <span class="n">unit</span>
<span class="bp">|</span> <span class="n">nh</span> <span class="o">[]</span> <span class="o">:=</span> <span class="n">skip</span>
<span class="bp">|</span> <span class="n">nh</span> <span class="o">(</span><span class="n">i</span> <span class="bp">::</span> <span class="n">ids</span><span class="o">)</span> <span class="o">:=</span> <span class="n">do</span>
  <span class="n">h</span> <span class="err">←</span> <span class="n">enter_get_local</span> <span class="n">nh</span><span class="o">,</span>
  <span class="k">let</span> <span class="n">e_intro</span> <span class="o">:=</span> <span class="o">(</span><span class="n">do</span>
    <span class="n">v</span> <span class="err">←</span> <span class="n">tactic</span><span class="bp">.</span><span class="n">intro</span> <span class="n">i</span><span class="o">,</span>
    <span class="n">tactic</span><span class="bp">.</span><span class="n">note</span> <span class="n">nh</span> <span class="n">none</span> <span class="o">(</span><span class="n">h</span> <span class="n">v</span><span class="o">),</span>
    <span class="n">try</span> <span class="err">$</span> <span class="n">tactic</span><span class="bp">.</span><span class="n">clear</span> <span class="n">h</span><span class="o">,</span>
    <span class="n">return</span> <span class="n">nh</span><span class="o">),</span>
  <span class="k">let</span> <span class="n">e_cases</span> <span class="o">:=</span> <span class="o">(</span><span class="n">do</span>
    <span class="o">[(</span><span class="n">name</span><span class="o">,</span> <span class="o">[</span><span class="n">v</span><span class="o">,</span> <span class="n">h&#39;&#39;</span><span class="o">])]</span> <span class="err">←</span> <span class="n">tactic</span><span class="bp">.</span><span class="n">cases</span> <span class="n">h</span> <span class="o">[</span><span class="n">i</span><span class="o">,</span> <span class="n">nh</span><span class="o">],</span>
    <span class="n">enter_aux_use</span> <span class="n">v</span><span class="o">,</span>
    <span class="n">return</span> <span class="n">h&#39;&#39;</span><span class="bp">.</span><span class="n">local_pp_name</span><span class="o">),</span>
  <span class="n">h&#39;&#39;</span> <span class="err">←</span> <span class="n">e_intro</span> <span class="bp">&lt;|&gt;</span> <span class="n">e_cases</span> <span class="bp">&lt;|&gt;</span> <span class="n">fail</span> <span class="o">(</span><span class="n">format</span><span class="bp">.</span><span class="n">join</span> <span class="o">[</span><span class="s2">&quot;enter failed: could not use identifier &#39;&quot;</span><span class="o">,</span> <span class="n">to_fmt</span> <span class="n">i</span><span class="o">,</span> <span class="s2">&quot;&#39;&quot;</span><span class="o">]),</span>
  <span class="n">enter_aux</span> <span class="n">h&#39;&#39;</span> <span class="n">ids</span>

<span class="c">/-</span><span class="cm"></span>
<span class="cm">The implementation of `enter` for two hypotheses.</span>
<span class="cm">-/</span>
<span class="n">meta</span> <span class="n">def</span> <span class="n">enter_at_aux</span> <span class="o">:</span> <span class="n">name</span> <span class="bp">→</span> <span class="n">name</span> <span class="bp">→</span> <span class="n">parse</span> <span class="n">with_ident_list</span> <span class="bp">→</span> <span class="n">tactic</span> <span class="n">unit</span>
<span class="bp">|</span> <span class="n">nh</span> <span class="n">nh&#39;</span> <span class="o">[]</span> <span class="o">:=</span> <span class="n">skip</span>
<span class="bp">|</span> <span class="n">nh</span> <span class="n">nh&#39;</span> <span class="o">(</span><span class="n">i</span> <span class="bp">::</span> <span class="n">ids</span><span class="o">)</span> <span class="o">:=</span> <span class="n">do</span>
  <span class="k">let</span> <span class="n">e_cases</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">nh</span> <span class="n">nh&#39;</span><span class="o">,</span> <span class="o">(</span><span class="n">do</span>
    <span class="n">h</span> <span class="err">←</span> <span class="n">enter_get_local</span> <span class="n">nh</span><span class="o">,</span>
    <span class="n">h&#39;</span> <span class="err">←</span> <span class="n">enter_get_local</span> <span class="n">nh&#39;</span><span class="o">,</span>
    <span class="o">[(</span><span class="n">name</span><span class="o">,</span> <span class="o">[</span><span class="n">v</span><span class="o">,</span> <span class="n">h&#39;&#39;</span><span class="o">])]</span> <span class="err">←</span> <span class="n">tactic</span><span class="bp">.</span><span class="n">cases</span> <span class="n">h</span> <span class="o">[</span><span class="n">i</span><span class="o">,</span> <span class="n">nh</span><span class="o">],</span>
    <span class="n">tactic</span><span class="bp">.</span><span class="n">note</span> <span class="n">nh&#39;</span> <span class="n">none</span> <span class="o">(</span><span class="n">h&#39;</span> <span class="n">v</span><span class="o">),</span>
    <span class="n">try</span> <span class="err">$</span> <span class="n">tactic</span><span class="bp">.</span><span class="n">clear</span> <span class="n">h&#39;</span><span class="o">,</span>
    <span class="n">return</span> <span class="o">(</span><span class="n">h&#39;&#39;</span><span class="bp">.</span><span class="n">local_pp_name</span><span class="o">,</span> <span class="n">nh&#39;</span><span class="o">)),</span>
  <span class="o">(</span><span class="n">nh</span><span class="o">,</span> <span class="n">nh&#39;</span><span class="o">)</span> <span class="err">←</span> <span class="n">e_cases</span> <span class="n">nh</span> <span class="n">nh&#39;</span> <span class="bp">&lt;|&gt;</span> <span class="n">e_cases</span> <span class="n">nh&#39;</span> <span class="n">nh</span> <span class="bp">&lt;|&gt;</span> <span class="n">fail</span> <span class="o">(</span><span class="n">format</span><span class="bp">.</span><span class="n">join</span> <span class="o">[</span><span class="s2">&quot;enter failed: could not use identifier &#39;&quot;</span><span class="o">,</span> <span class="n">to_fmt</span> <span class="n">i</span><span class="o">,</span> <span class="s2">&quot;&#39;&quot;</span><span class="o">]),</span>
  <span class="n">enter_at_aux</span> <span class="n">nh</span> <span class="n">nh&#39;</span> <span class="n">ids</span>

<span class="c">/-</span><span class="cm"></span>
<span class="cm">`enter h with a₁ a₂ .. aₙ` takes a prefix of n quantifiers shared</span>
<span class="cm">by `h` and the goal and, effectively, uses `intro`, `specialize`,</span>
<span class="cm">`cases`, and `use` to enter the shared context.  The supplied</span>
<span class="cm">identifiers determine how many quantifiers to enter.</span>

<span class="cm">`enter h` does `enter h with a`, choosing a fresh identifier `a` for</span>
<span class="cm">you.</span>

<span class="cm">`enter h (with a₁ a₂ .. aₙ)? at h&#39;` performs a similar effect between</span>
<span class="cm">hypotheses `h` and `h&#39;`, where h&#39; is as if it is the `push_neg` of a</span>
<span class="cm">goal.  That is to say existential quantifiers of `h` or `h&#39;` are used</span>
<span class="cm">to specialize a universal quantifier of the other.</span>

<span class="cm">A &quot;quantifier&quot; is any pi (Π, ∀, or →) or any single-constructor</span>
<span class="cm">inductive type with two arguments (∃, sigma, ∧, etc.).</span>
<span class="cm">-/</span>
<span class="n">meta</span> <span class="n">def</span> <span class="n">enter</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="n">parse</span> <span class="n">ident_</span><span class="o">)</span> <span class="o">:</span> <span class="n">parse</span> <span class="n">with_ident_list</span> <span class="bp">→</span> <span class="n">parse</span> <span class="o">(</span><span class="n">optional</span> <span class="err">$</span> <span class="n">tk</span> <span class="s2">&quot;at&quot;</span> <span class="bp">*&gt;</span> <span class="n">ident_</span><span class="o">)</span> <span class="bp">→</span> <span class="n">tactic</span> <span class="n">unit</span>
<span class="bp">|</span> <span class="o">[]</span> <span class="n">o</span> <span class="o">:=</span> <span class="n">do</span> <span class="n">x</span> <span class="err">←</span> <span class="n">get_unused_name</span> <span class="s2">&quot;a&quot;</span><span class="o">,</span>
             <span class="n">enter</span> <span class="o">[</span><span class="n">x</span><span class="o">]</span> <span class="n">o</span>
<span class="bp">|</span> <span class="n">ids</span> <span class="n">none</span> <span class="o">:=</span> <span class="n">propagate_tags</span> <span class="err">$</span> <span class="n">enter_aux</span> <span class="n">h</span> <span class="n">ids</span>
<span class="bp">|</span> <span class="n">ids</span> <span class="o">(</span><span class="n">some</span> <span class="n">h&#39;</span><span class="o">)</span> <span class="o">:=</span> <span class="n">propagate_tags</span> <span class="err">$</span> <span class="n">enter_at_aux</span> <span class="n">h</span> <span class="n">h&#39;</span> <span class="n">ids</span>

<span class="kn">end</span> <span class="n">interactive</span>

<span class="kn">end</span> <span class="n">tactic</span>

<span class="kn">example</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="bp">∃</span> <span class="n">y</span><span class="o">,</span> <span class="n">y</span> <span class="bp">&gt;</span> <span class="mi">2</span><span class="o">)</span> <span class="o">:</span> <span class="bp">∃</span> <span class="n">y</span><span class="o">,</span> <span class="n">y</span> <span class="bp">&gt;</span> <span class="mi">2</span> <span class="bp">∧</span> <span class="n">y</span> <span class="bp">&gt;</span> <span class="mi">1</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="n">enter</span> <span class="n">h</span> <span class="k">with</span> <span class="n">y</span><span class="o">,</span>
  <span class="n">use</span> <span class="n">h</span><span class="o">,</span> <span class="n">linarith</span> <span class="o">[</span><span class="n">h</span><span class="o">],</span>
<span class="kn">end</span>

<span class="n">def</span> <span class="n">lim_infinity</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="bp">ℕ</span> <span class="bp">→</span> <span class="bp">ℕ</span><span class="o">)</span> <span class="o">:=</span> <span class="bp">∀</span> <span class="n">m</span><span class="o">,</span> <span class="bp">∃</span> <span class="n">N</span><span class="o">,</span> <span class="bp">∀</span> <span class="n">n</span> <span class="bp">≥</span> <span class="n">N</span><span class="o">,</span> <span class="n">f</span> <span class="n">n</span> <span class="bp">≥</span> <span class="n">m</span>

<span class="kn">example</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="bp">ℕ</span> <span class="bp">→</span> <span class="bp">ℕ</span><span class="o">)</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="n">lim_infinity</span> <span class="n">f</span><span class="o">)</span> <span class="o">:</span> <span class="n">lim_infinity</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">n</span><span class="o">,</span> <span class="n">f</span> <span class="n">n</span> <span class="bp">*</span> <span class="n">f</span> <span class="n">n</span><span class="o">)</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="n">enter</span> <span class="n">h</span> <span class="k">with</span> <span class="n">m</span> <span class="n">N</span> <span class="n">n</span> <span class="n">h&#39;</span><span class="o">,</span>
  <span class="n">dsimp</span> <span class="n">only</span><span class="o">,</span>
  <span class="k">have</span> <span class="n">h&#39;</span> <span class="o">:</span> <span class="n">m</span> <span class="bp">*</span> <span class="n">m</span> <span class="bp">≥</span> <span class="n">m</span> <span class="o">:=</span> <span class="n">nat</span><span class="bp">.</span><span class="n">le_mul_self</span> <span class="bp">_</span><span class="o">,</span>
  <span class="k">calc</span> <span class="n">f</span> <span class="n">n</span> <span class="bp">*</span> <span class="n">f</span> <span class="n">n</span> <span class="bp">≥</span> <span class="n">m</span> <span class="bp">*</span> <span class="n">m</span> <span class="o">:</span> <span class="n">nat</span><span class="bp">.</span><span class="n">mul_le_mul</span> <span class="n">h</span> <span class="n">h</span>
       <span class="bp">...</span> <span class="bp">≥</span> <span class="n">m</span> <span class="o">:</span> <span class="n">h&#39;</span><span class="o">,</span>
<span class="kn">end</span>

<span class="kn">section</span>

<span class="n">local</span> <span class="kn">notation</span> <span class="bp">`|`</span><span class="n">x</span><span class="bp">`|`</span> <span class="o">:=</span> <span class="n">abs</span> <span class="n">x</span>

<span class="c">/-</span><span class="cm">- Continuity of a function at a point  -/</span>
<span class="n">def</span> <span class="n">continuous_at_pt</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">ℝ</span> <span class="bp">→</span> <span class="n">ℝ</span><span class="o">)</span> <span class="o">(</span><span class="n">x₀</span> <span class="o">:</span> <span class="n">ℝ</span><span class="o">)</span> <span class="o">:</span> <span class="kt">Prop</span> <span class="o">:=</span>
<span class="bp">∀</span> <span class="n">ε</span> <span class="bp">&gt;</span> <span class="mi">0</span><span class="o">,</span> <span class="bp">∃</span> <span class="n">δ</span> <span class="bp">&gt;</span> <span class="mi">0</span><span class="o">,</span> <span class="bp">∀</span> <span class="n">x</span><span class="o">,</span> <span class="bp">|</span><span class="n">x</span> <span class="bp">-</span> <span class="n">x₀</span><span class="bp">|</span> <span class="bp">≤</span> <span class="n">δ</span> <span class="bp">→</span> <span class="bp">|</span><span class="n">f</span> <span class="n">x</span> <span class="bp">-</span> <span class="n">f</span> <span class="n">x₀</span><span class="bp">|</span> <span class="bp">≤</span> <span class="n">ε</span>

<span class="n">def</span> <span class="n">seq_limit</span> <span class="o">(</span><span class="n">u</span> <span class="o">:</span> <span class="bp">ℕ</span> <span class="bp">→</span> <span class="n">ℝ</span><span class="o">)</span> <span class="o">(</span><span class="n">l</span> <span class="o">:</span> <span class="n">ℝ</span><span class="o">)</span> <span class="o">:</span> <span class="kt">Prop</span> <span class="o">:=</span>
<span class="bp">∀</span> <span class="n">ε</span> <span class="bp">&gt;</span> <span class="mi">0</span><span class="o">,</span> <span class="bp">∃</span> <span class="n">N</span><span class="o">,</span> <span class="bp">∀</span> <span class="n">n</span> <span class="bp">≥</span> <span class="n">N</span><span class="o">,</span> <span class="bp">|</span><span class="n">u</span> <span class="n">n</span> <span class="bp">-</span> <span class="n">l</span><span class="bp">|</span> <span class="bp">≤</span> <span class="n">ε</span>

<span class="kn">variables</span> <span class="o">{</span><span class="n">f</span> <span class="o">:</span> <span class="n">ℝ</span> <span class="bp">→</span> <span class="n">ℝ</span><span class="o">}</span> <span class="o">{</span><span class="n">x₀</span> <span class="o">:</span> <span class="n">ℝ</span><span class="o">}</span> <span class="o">{</span><span class="n">u</span> <span class="o">:</span> <span class="bp">ℕ</span> <span class="bp">→</span> <span class="n">ℝ</span><span class="o">}</span>

<span class="c1">-- 0073</span>
<span class="kn">lemma</span> <span class="n">seq_continuous_of_continuous</span> <span class="o">(</span><span class="n">hf</span> <span class="o">:</span> <span class="n">continuous_at_pt</span> <span class="n">f</span> <span class="n">x₀</span><span class="o">)</span>
  <span class="o">(</span><span class="n">hu</span> <span class="o">:</span> <span class="n">seq_limit</span> <span class="n">u</span> <span class="n">x₀</span><span class="o">)</span> <span class="o">:</span> <span class="n">seq_limit</span> <span class="o">(</span><span class="n">f</span> <span class="err">∘</span> <span class="n">u</span><span class="o">)</span> <span class="o">(</span><span class="n">f</span> <span class="n">x₀</span><span class="o">)</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="n">enter</span> <span class="n">hf</span> <span class="k">with</span> <span class="n">ε</span> <span class="n">εpos</span><span class="o">,</span>
  <span class="n">enter</span> <span class="n">hf</span> <span class="k">with</span> <span class="n">δ</span> <span class="n">δpos</span> <span class="n">at</span> <span class="n">hu</span><span class="o">,</span>
  <span class="n">enter</span> <span class="n">hu</span> <span class="k">with</span> <span class="n">N</span> <span class="n">n</span> <span class="n">nbig</span><span class="o">,</span>
  <span class="n">specialize</span> <span class="n">hf</span> <span class="o">(</span><span class="n">u</span> <span class="n">n</span><span class="o">)</span> <span class="n">hu</span><span class="o">,</span>
  <span class="n">exact</span> <span class="n">hf</span><span class="o">,</span>
<span class="kn">end</span>

<span class="kn">end</span>
</code></pre></div>



<a name="203999207"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Automatic%20intro/cases/specialize/use%20dance/near/203999207" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yakov Pechersky <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Automatic.20intro.2Fcases.2Fspecialize.2Fuse.20dance.html#203999207">(Jul 15 2020 at 19:09)</a>:</h4>
<p><del>How about syntax like <code>enter hf with δ δpos using hu</code>?</del><br>
Never mind, I see how <code>hf</code> is partially <code>enter</code>ed.<br>
Then what about <code>enter hf ... using hu</code>?</p>



<a name="203999563"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Automatic%20intro/cases/specialize/use%20dance/near/203999563" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kyle Miller <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Automatic.20intro.2Fcases.2Fspecialize.2Fuse.20dance.html#203999563">(Jul 15 2020 at 19:12)</a>:</h4>
<p>Oh, so <code>enter ID ID_LIST (using ID)?</code>? That seems better.</p>



<a name="203999725"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Automatic%20intro/cases/specialize/use%20dance/near/203999725" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yakov Pechersky <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Automatic.20intro.2Fcases.2Fspecialize.2Fuse.20dance.html#203999725">(Jul 15 2020 at 19:13)</a>:</h4>
<p><code>enter hf with x y {with,using} hu</code> assigns <code>x, y</code> gets quantifiers from <code>hf</code> and specializes at <code>hu</code>. Or you can phrase it like "using hf, specialize hu".</p>



<a name="203999817"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Automatic%20intro/cases/specialize/use%20dance/near/203999817" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yakov Pechersky <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Automatic.20intro.2Fcases.2Fspecialize.2Fuse.20dance.html#203999817">(Jul 15 2020 at 19:14)</a>:</h4>
<p>so either <code>... at ...</code> or <code>... using ...</code> could work, one would just have to be cognizant of what's used for what.</p>



<a name="204000056"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Automatic%20intro/cases/specialize/use%20dance/near/204000056" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kyle Miller <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Automatic.20intro.2Fcases.2Fspecialize.2Fuse.20dance.html#204000056">(Jul 15 2020 at 19:16)</a>:</h4>
<p>The way it's implemented is that it's symmetric in <code>hf</code> and <code>hu</code>, so it's a bit unfortunate that's not reflected in the tactic syntax.</p>



<a name="204000059"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Automatic%20intro/cases/specialize/use%20dance/near/204000059" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yakov Pechersky <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Automatic.20intro.2Fcases.2Fspecialize.2Fuse.20dance.html#204000059">(Jul 15 2020 at 19:16)</a>:</h4>
<p>Maybe that would allow for </p>
<div class="codehilite"><pre><span></span><code><span class="n">enter</span> <span class="n">hu</span> <span class="k">with</span> <span class="n">δ</span> <span class="n">δpos</span> <span class="n">N</span> <span class="n">n</span> <span class="n">nbig</span> <span class="kn">using</span> <span class="o">[</span><span class="n">hf</span><span class="o">]</span>
</code></pre></div>


<p>where it will enter as far as possible on existential, then use the available <code>using</code> hypotheses for the quantified, etc.</p>



<a name="204000650"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Automatic%20intro/cases/specialize/use%20dance/near/204000650" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kyle Miller <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Automatic.20intro.2Fcases.2Fspecialize.2Fuse.20dance.html#204000650">(Jul 15 2020 at 19:21)</a>:</h4>
<p>That's an interesting generalization.  The only objection I'd have is that you might sometimes want to <em>not</em> consider the goal at all, but then for that you might use</p>
<div class="codehilite"><pre><span></span><code><span class="n">enter</span> <span class="n">hu</span> <span class="k">with</span> <span class="n">δ</span> <span class="n">δpos</span> <span class="n">N</span> <span class="n">n</span> <span class="n">nbig</span> <span class="kn">using</span> <span class="n">only</span> <span class="o">[</span><span class="n">hf</span><span class="o">]</span>
</code></pre></div>



<a name="204000734"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Automatic%20intro/cases/specialize/use%20dance/near/204000734" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yakov Pechersky <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Automatic.20intro.2Fcases.2Fspecialize.2Fuse.20dance.html#204000734">(Jul 15 2020 at 19:22)</a>:</h4>
<p>Right, I was ignoring the goal entirely.</p>



<a name="204000827"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Automatic%20intro/cases/specialize/use%20dance/near/204000827" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kyle Miller <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Automatic.20intro.2Fcases.2Fspecialize.2Fuse.20dance.html#204000827">(Jul 15 2020 at 19:23)</a>:</h4>
<p>Oh, I thought you were saying "try entering the shared context with the goal, and whenever that fails try doing it with the first in the <code>using</code> list that would succeed"</p>



<a name="204001064"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Automatic%20intro/cases/specialize/use%20dance/near/204001064" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yakov Pechersky <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Automatic.20intro.2Fcases.2Fspecialize.2Fuse.20dance.html#204001064">(Jul 15 2020 at 19:25)</a>:</h4>
<p>I guess my assumption was <code> ... using </code> would ignore the goal by default, and goal could be included with notation for the goal</p>



<a name="204001106"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Automatic%20intro/cases/specialize/use%20dance/near/204001106" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yakov Pechersky <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Automatic.20intro.2Fcases.2Fspecialize.2Fuse.20dance.html#204001106">(Jul 15 2020 at 19:25)</a>:</h4>
<p>So either your option with <code>only</code> or explicit goal inclusion when the syntax is <code>using [...]</code></p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>