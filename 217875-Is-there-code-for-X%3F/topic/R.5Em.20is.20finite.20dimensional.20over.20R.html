---
layout: archive
title: Zulip Chat Archive
permalink: /stream/217875-Is-there-code-for-X%3F/topic/R.5Em.20is.20finite.20dimensional.20over.20R.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/index.html">Is there code for X?</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/R.5Em.20is.20finite.20dimensional.20over.20R.html">R^m is finite dimensional over R</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="231571374"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/R%5Em%20is%20finite%20dimensional%20over%20R/near/231571374" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bhavik Mehta <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/R.5Em.20is.20finite.20dimensional.20over.20R.html#231571374">(Mar 24 2021 at 01:59)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">data.real.basic</span>
<span class="kn">import</span> <span class="n">linear_algebra.finite_dimensional</span>

<span class="kd">example</span> <span class="o">{</span><span class="n">m</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">}</span> <span class="o">:</span> <span class="n">finite_dimensional</span> <span class="n">ℝ</span> <span class="o">(</span><span class="n">fin</span> <span class="n">m</span> <span class="bp">→</span> <span class="n">ℝ</span><span class="o">)</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="n">apply_instance</span>
<span class="kd">end</span>
</code></pre></div>
<p>I presume I'm just missing imports, but which ones?</p>



<a name="231571940"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/R%5Em%20is%20finite%20dimensional%20over%20R/near/231571940" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yakov Pechersky <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/R.5Em.20is.20finite.20dimensional.20over.20R.html#231571940">(Mar 24 2021 at 02:06)</a>:</h4>
<p><a href="https://leanprover-community.github.io/mathlib_docs/find/is_noetherian_pi">docs#is_noetherian_pi</a> ?</p>



<a name="231571987"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/R%5Em%20is%20finite%20dimensional%20over%20R/near/231571987" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bhavik Mehta <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/R.5Em.20is.20finite.20dimensional.20over.20R.html#231571987">(Mar 24 2021 at 02:06)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">data.real.basic</span>
<span class="kn">import</span> <span class="n">linear_algebra.finite_dimensional</span>
<span class="kn">import</span> <span class="n">ring_theory.noetherian</span>

<span class="kd">example</span> <span class="o">{</span><span class="n">m</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">}</span> <span class="o">:</span> <span class="n">finite_dimensional</span> <span class="n">ℝ</span> <span class="o">(</span><span class="n">fin</span> <span class="n">m</span> <span class="bp">→</span> <span class="n">ℝ</span><span class="o">)</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="n">apply_instance</span>
<span class="kd">end</span>
</code></pre></div>
<p>Doesn't work</p>



<a name="231572659"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/R%5Em%20is%20finite%20dimensional%20over%20R/near/231572659" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/R.5Em.20is.20finite.20dimensional.20over.20R.html#231572659">(Mar 24 2021 at 02:16)</a>:</h4>
<p>Is finite dimensional map even a class?</p>



<a name="231572712"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/R%5Em%20is%20finite%20dimensional%20over%20R/near/231572712" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bhavik Mehta <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/R.5Em.20is.20finite.20dimensional.20over.20R.html#231572712">(Mar 24 2021 at 02:18)</a>:</h4>
<p>Most of the lemmas about it in linear_algebra.finite_dimensional take <code>finite_dimensional K V</code> as a typeclass argument, so I assume that's how it's meant to be used</p>



<a name="231572835"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/R%5Em%20is%20finite%20dimensional%20over%20R/near/231572835" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/R.5Em.20is.20finite.20dimensional.20over.20R.html#231572835">(Mar 24 2021 at 02:19)</a>:</h4>
<p>Right. I got confused because the API docs just lists it as a def</p>



<a name="231572923"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/R%5Em%20is%20finite%20dimensional%20over%20R/near/231572923" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bhavik Mehta <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/R.5Em.20is.20finite.20dimensional.20over.20R.html#231572923">(Mar 24 2021 at 02:20)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">data.real.basic</span>
<span class="kn">import</span> <span class="n">linear_algebra.finite_dimensional</span>

<span class="kd">example</span> <span class="o">{</span><span class="n">m</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">}</span> <span class="o">:</span> <span class="n">finite_dimensional</span> <span class="n">ℝ</span> <span class="o">(</span><span class="n">fin</span> <span class="n">m</span> <span class="bp">→</span> <span class="n">ℝ</span><span class="o">)</span> <span class="o">:=</span>
<span class="bp">@</span><span class="n">is_noetherian_pi</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">i</span><span class="o">,</span> <span class="n">infer_instance</span><span class="o">)</span>
</code></pre></div>
<p>This works but it's weird that there's no nicer way - why is it that I need to look at the implemention of finite_dimensional and look through noetherian lemmas to get a linear algebra result</p>



<a name="231573052"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/R%5Em%20is%20finite%20dimensional%20over%20R/near/231573052" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/R.5Em.20is.20finite.20dimensional.20over.20R.html#231573052">(Mar 24 2021 at 02:22)</a>:</h4>
<p>Does it work if you replace fin n with a type with a Fintype instance?</p>



<a name="231573105"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/R%5Em%20is%20finite%20dimensional%20over%20R/near/231573105" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/R.5Em.20is.20finite.20dimensional.20over.20R.html#231573105">(Mar 24 2021 at 02:23)</a>:</h4>
<p>I mean, it shouldn't. But might be worth checking anyway</p>



<a name="231573200"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/R%5Em%20is%20finite%20dimensional%20over%20R/near/231573200" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bhavik Mehta <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/R.5Em.20is.20finite.20dimensional.20over.20R.html#231573200">(Mar 24 2021 at 02:24)</a>:</h4>
<p>Yup it doesn't work</p>



<a name="231573521"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/R%5Em%20is%20finite%20dimensional%20over%20R/near/231573521" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/R.5Em.20is.20finite.20dimensional.20over.20R.html#231573521">(Mar 24 2021 at 02:28)</a>:</h4>
<p>Sounds like a missing instance <span aria-label="expressionless" class="emoji emoji-1f611" role="img" title="expressionless">:expressionless:</span></p>



<a name="231574042"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/R%5Em%20is%20finite%20dimensional%20over%20R/near/231574042" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bhavik Mehta <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/R.5Em.20is.20finite.20dimensional.20over.20R.html#231574042">(Mar 24 2021 at 02:35)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">data.real.basic</span>
<span class="kn">import</span> <span class="n">linear_algebra.finite_dimensional</span>

<span class="kd">example</span> <span class="o">{</span><span class="n">K</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">field</span> <span class="n">K</span><span class="o">]</span> <span class="o">{</span><span class="n">i</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">}</span> <span class="o">:</span> <span class="n">finite_dimensional</span> <span class="n">K</span> <span class="o">(</span><span class="n">fin</span> <span class="n">i</span> <span class="bp">→</span> <span class="n">K</span><span class="o">)</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="n">apply_instance</span>
<span class="kd">end</span>
</code></pre></div>
<p>But this works...</p>



<a name="231574126"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/R%5Em%20is%20finite%20dimensional%20over%20R/near/231574126" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/R.5Em.20is.20finite.20dimensional.20over.20R.html#231574126">(Mar 24 2021 at 02:36)</a>:</h4>
<p>Oooh... The mystery deepens</p>



<a name="231585521"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/R%5Em%20is%20finite%20dimensional%20over%20R/near/231585521" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Shing Tak Lam <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/R.5Em.20is.20finite.20dimensional.20over.20R.html#231585521">(Mar 24 2021 at 05:22)</a>:</h4>
<p>Seems like <code>local attribute [-instance] real.semiring real.ring</code> "fixes" it and <code>apply_instance</code> works</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">data.real.basic</span>
<span class="kn">import</span> <span class="n">linear_algebra.finite_dimensional</span>

<span class="kn">local</span> <span class="kn">attribute</span> <span class="o">[</span><span class="bp">-</span><span class="kd">instance</span><span class="o">]</span> <span class="n">real.semiring</span> <span class="n">real.ring</span>

<span class="kd">example</span> <span class="o">{</span><span class="n">m</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">}</span> <span class="o">:</span> <span class="n">finite_dimensional</span> <span class="n">ℝ</span> <span class="o">(</span><span class="n">fin</span> <span class="n">m</span> <span class="bp">→</span> <span class="n">ℝ</span><span class="o">)</span> <span class="o">:=</span> <span class="kd">by</span> <span class="n">apply_instance</span>
</code></pre></div>



<a name="231585878"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/R%5Em%20is%20finite%20dimensional%20over%20R/near/231585878" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Shing Tak Lam <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/R.5Em.20is.20finite.20dimensional.20over.20R.html#231585878">(Mar 24 2021 at 05:30)</a>:</h4>
<p>Here's the original failure and the case for <code>field K</code> minimised</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">data.real.basic</span>
<span class="kn">import</span> <span class="n">linear_algebra.finite_dimensional</span>

<span class="c1">-- These both find `finite_dimensional.finite_dimensional_self`</span>
<span class="kd">example</span> <span class="o">{</span><span class="n">K</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">field</span> <span class="n">K</span><span class="o">]</span> <span class="o">(</span><span class="n">m</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="o">:</span> <span class="bp">∀</span> <span class="o">(</span><span class="n">i</span> <span class="o">:</span> <span class="n">fin</span> <span class="n">m</span><span class="o">),</span> <span class="n">is_noetherian</span> <span class="n">K</span> <span class="n">K</span> <span class="o">:=</span>
  <span class="kd">by</span> <span class="n">show_term</span> <span class="o">{</span><span class="n">apply_instance</span><span class="o">}</span>
<span class="kd">example</span> <span class="o">(</span><span class="n">m</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="o">:</span> <span class="bp">∀</span> <span class="o">(</span><span class="n">i</span> <span class="o">:</span> <span class="n">fin</span> <span class="n">m</span><span class="o">),</span> <span class="n">finite_dimensional</span> <span class="n">ℝ</span> <span class="n">ℝ</span> <span class="o">:=</span>
  <span class="kd">by</span> <span class="n">show_term</span> <span class="o">{</span><span class="n">apply_instance</span><span class="o">}</span>

<span class="c1">-- But this fails</span>
<span class="kd">example</span> <span class="o">(</span><span class="n">m</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="o">:</span> <span class="bp">∀</span> <span class="o">(</span><span class="n">i</span> <span class="o">:</span> <span class="n">fin</span> <span class="n">m</span><span class="o">),</span> <span class="n">is_noetherian</span> <span class="n">ℝ</span> <span class="n">ℝ</span> <span class="o">:=</span> <span class="kd">by</span> <span class="n">apply_instance</span>
</code></pre></div>
<p>If I turn on <code>set_option pp.all</code>, the goal for <code>finite_dimensional ℝ ℝ</code> is like so</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="bp">@</span><span class="n">finite_dimensional.</span><span class="o">{</span><span class="mi">0</span> <span class="mi">0</span><span class="o">}</span> <span class="n">real</span> <span class="n">real</span> <span class="n">real.field</span> <span class="n">real.add_comm_group</span>
    <span class="o">(</span><span class="bp">@</span><span class="n">semiring.to_semimodule.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">real</span>
       <span class="o">(</span><span class="bp">@</span><span class="n">ring.to_semiring.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">real</span> <span class="o">(</span><span class="bp">@</span><span class="n">division_ring.to_ring.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">real</span> <span class="o">(</span><span class="bp">@</span><span class="n">field.to_division_ring.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">real</span> <span class="n">real.field</span><span class="o">))))</span>
</code></pre></div>
<p>and for <code>is_noetherian ℝ ℝ</code> it's </p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="bp">@</span><span class="n">is_noetherian.</span><span class="o">{</span><span class="mi">0</span> <span class="mi">0</span><span class="o">}</span> <span class="n">real</span> <span class="n">real</span> <span class="n">real.semiring</span> <span class="n">real.add_comm_monoid</span> <span class="o">(</span><span class="bp">@</span><span class="n">semiring.to_semimodule.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">real</span> <span class="n">real.semiring</span><span class="o">)</span>
</code></pre></div>
<p>and as the instance it found for <code>finite_dimensional ℝ ℝ</code> uses a <code>finite_dimensional</code> lemma, and not a <code>is_noetherian</code> lemma, I guessed that  maybe the short circuit instances are causing issues, so I added <code>local attribute [-instance] real.semiring real.ring</code> and then the instance search worked.</p>



<a name="231586228"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/R%5Em%20is%20finite%20dimensional%20over%20R/near/231586228" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/R.5Em.20is.20finite.20dimensional.20over.20R.html#231586228">(Mar 24 2021 at 05:34)</a>:</h4>
<p>Just getting rid of <code>real.ring</code> is enough even</p>



<a name="231586268"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/R%5Em%20is%20finite%20dimensional%20over%20R/near/231586268" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/R.5Em.20is.20finite.20dimensional.20over.20R.html#231586268">(Mar 24 2021 at 05:35)</a>:</h4>
<p>hm, this works:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">example</span> <span class="o">(</span><span class="n">m</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="o">(</span><span class="n">i</span> <span class="o">:</span> <span class="n">fin</span> <span class="n">m</span><span class="o">)</span> <span class="o">:</span> <span class="n">is_noetherian</span> <span class="n">ℝ</span> <span class="n">ℝ</span> <span class="o">:=</span> <span class="kd">by</span> <span class="n">apply_instance</span>
</code></pre></div>



<a name="231586461"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/R%5Em%20is%20finite%20dimensional%20over%20R/near/231586461" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/R.5Em.20is.20finite.20dimensional.20over.20R.html#231586461">(Mar 24 2021 at 05:38)</a>:</h4>
<p>The only difference:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">0</span><span class="o">)</span> <span class="bp">?</span><span class="n">x_0</span> <span class="n">i</span> <span class="o">:</span>
  <span class="bp">@</span><span class="n">is_noetherian</span> <span class="n">ℝ</span> <span class="n">ℝ</span> <span class="n">real.semiring</span> <span class="n">real.add_comm_monoid</span> <span class="o">(</span><span class="bp">@</span><span class="n">semiring.to_semimodule</span> <span class="n">ℝ</span> <span class="n">real.semiring</span><span class="o">)</span> <span class="o">:=</span>
  <span class="bp">@</span><span class="n">finite_dimensional.finite_dimensional_self</span> <span class="o">(</span><span class="bp">?</span><span class="n">x_42</span> <span class="n">i</span><span class="o">)</span> <span class="o">(</span><span class="bp">?</span><span class="n">x_43</span> <span class="n">i</span><span class="o">)</span>
<span class="n">failed</span> <span class="n">is_def_eq</span>
</code></pre></div>
<p>vs</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">0</span><span class="o">)</span> <span class="bp">?</span><span class="n">x_0</span> <span class="o">:</span>
  <span class="bp">@</span><span class="n">is_noetherian</span> <span class="n">ℝ</span> <span class="n">ℝ</span> <span class="n">real.semiring</span> <span class="n">real.add_comm_monoid</span> <span class="o">(</span><span class="bp">@</span><span class="n">semiring.to_semimodule</span> <span class="n">ℝ</span> <span class="n">real.semiring</span><span class="o">)</span> <span class="o">:=</span>
  <span class="bp">@</span><span class="n">finite_dimensional.finite_dimensional_self</span> <span class="bp">?</span><span class="n">x_42</span> <span class="bp">?</span><span class="n">x_43</span>
<span class="o">(</span><span class="n">works</span><span class="o">)</span>
</code></pre></div>



<a name="231728852"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/R%5Em%20is%20finite%20dimensional%20over%20R/near/231728852" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bhavik Mehta <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/R.5Em.20is.20finite.20dimensional.20over.20R.html#231728852">(Mar 25 2021 at 00:03)</a>:</h4>
<p>So what's the fix in mathlib? Or should I be saying  <code>local attribute [-instance] real.ring</code></p>



<a name="231746204"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/R%5Em%20is%20finite%20dimensional%20over%20R/near/231746204" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bhavik Mehta <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/R.5Em.20is.20finite.20dimensional.20over.20R.html#231746204">(Mar 25 2021 at 04:25)</a>:</h4>
<p>Alright, now I've additionally used the import analysis.convex.topology and the local attribute fixes no longer work:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">data.real.basic</span>
<span class="kn">import</span> <span class="n">linear_algebra.finite_dimensional</span>
<span class="kn">import</span> <span class="n">analysis.convex.topology</span>

<span class="kn">local</span> <span class="kn">attribute</span> <span class="o">[</span><span class="bp">-</span><span class="kd">instance</span><span class="o">]</span> <span class="n">real.semiring</span> <span class="n">real.ring</span>

<span class="kd">example</span> <span class="o">{</span><span class="n">m</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">}</span> <span class="o">:</span> <span class="n">finite_dimensional</span> <span class="n">ℝ</span> <span class="o">(</span><span class="n">fin</span> <span class="n">m</span> <span class="bp">→</span> <span class="n">ℝ</span><span class="o">)</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="n">apply_instance</span>
<span class="kd">end</span>
</code></pre></div>
<p>What am I meant to do with this now?</p>



<a name="231746345"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/R%5Em%20is%20finite%20dimensional%20over%20R/near/231746345" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yakov Pechersky <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/R.5Em.20is.20finite.20dimensional.20over.20R.html#231746345">(Mar 25 2021 at 04:27)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">local</span> <span class="kn">attribute</span> <span class="o">[</span><span class="bp">-</span><span class="kd">instance</span><span class="o">]</span> <span class="n">real.nondiscrete_normed_field</span> <span class="n">real.normed_field</span> <span class="n">real.semiring</span> <span class="n">real.ring</span>
</code></pre></div>



<a name="231746389"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/R%5Em%20is%20finite%20dimensional%20over%20R/near/231746389" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yakov Pechersky <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/R.5Em.20is.20finite.20dimensional.20over.20R.html#231746389">(Mar 25 2021 at 04:28)</a>:</h4>
<p>I think there's probably an issue somewhere with <code>is_R_or_C</code></p>



<a name="231746513"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/R%5Em%20is%20finite%20dimensional%20over%20R/near/231746513" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yakov Pechersky <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/R.5Em.20is.20finite.20dimensional.20over.20R.html#231746513">(Mar 25 2021 at 04:30)</a>:</h4>
<p>Ah. It might have to do with <code>real.linear_ordered_field</code></p>



<a name="231746682"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/R%5Em%20is%20finite%20dimensional%20over%20R/near/231746682" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bhavik Mehta <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/R.5Em.20is.20finite.20dimensional.20over.20R.html#231746682">(Mar 25 2021 at 04:33)</a>:</h4>
<p>It's so bizarre to me that mathlib is set up so that I can't show R^m is finite dimensional out of the box!</p>



<a name="231746801"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/R%5Em%20is%20finite%20dimensional%20over%20R/near/231746801" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yakov Pechersky <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/R.5Em.20is.20finite.20dimensional.20over.20R.html#231746801">(Mar 25 2021 at 04:35)</a>:</h4>
<p>I don't know enough about diamond discovery to figure out what's wrong here, will have to wait for the real sleuths</p>



<a name="231747705"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/R%5Em%20is%20finite%20dimensional%20over%20R/near/231747705" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/R.5Em.20is.20finite.20dimensional.20over.20R.html#231747705">(Mar 25 2021 at 04:51)</a>:</h4>
<p>Whatever is going on, I doubt the troubles you're having here are intentional. Something needs to be fixed; maybe some instances need to be put in locales?</p>



<a name="231747862"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/R%5Em%20is%20finite%20dimensional%20over%20R/near/231747862" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/R.5Em.20is.20finite.20dimensional.20over.20R.html#231747862">(Mar 25 2021 at 04:54)</a>:</h4>
<p>yeah, those <code>local attribute [-instance]</code> lines are definitely not a proper solution. It looks like a lean bug</p>



<a name="231748016"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/R%5Em%20is%20finite%20dimensional%20over%20R/near/231748016" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/R.5Em.20is.20finite.20dimensional.20over.20R.html#231748016">(Mar 25 2021 at 04:57)</a>:</h4>
<p>For a mathlib workaround, you can just declare <code>instance {m : ℕ} : finite_dimensional ℝ (fin m → ℝ)</code></p>



<a name="235844934"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/R%5Em%20is%20finite%20dimensional%20over%20R/near/235844934" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/R.5Em.20is.20finite.20dimensional.20over.20R.html#235844934">(Apr 23 2021 at 14:00)</a>:</h4>
<p>It seems this issue is still not solved in mathlib master. I think this is a very serious issue. <span class="user-mention" data-user-id="110049">@Mario Carneiro</span> are you suggesting we put</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">data.real.basic</span>
<span class="kn">import</span> <span class="n">linear_algebra.finite_dimensional</span>

<span class="kd">instance</span> <span class="o">{</span><span class="n">m</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">}</span> <span class="o">:</span> <span class="n">finite_dimensional</span> <span class="n">ℝ</span> <span class="o">(</span><span class="n">fin</span> <span class="n">m</span> <span class="bp">→</span> <span class="n">ℝ</span><span class="o">)</span> <span class="o">:=</span>
<span class="bp">@</span><span class="n">is_noetherian_pi</span> <span class="n">ℝ</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">i</span><span class="o">,</span> <span class="n">finite_dimensional.finite_dimensional_self</span> <span class="n">_</span><span class="o">)</span>
</code></pre></div>
<p>somewhere? It feels like the underlying issue will get more opportunities to strike elsewhere if we ignore it.</p>



<a name="235845402"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/R%5Em%20is%20finite%20dimensional%20over%20R/near/235845402" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/R.5Em.20is.20finite.20dimensional.20over.20R.html#235845402">(Apr 23 2021 at 14:03)</a>:</h4>
<p>I don't think it's a great solution but it should help for the time being</p>



<a name="235845598"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/R%5Em%20is%20finite%20dimensional%20over%20R/near/235845598" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/R.5Em.20is.20finite.20dimensional.20over.20R.html#235845598">(Apr 23 2021 at 14:04)</a>:</h4>
<p>I don't know what's wrong in lean and I'm not especially motivated to try to patch typeclass inference</p>



<a name="235845778"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/R%5Em%20is%20finite%20dimensional%20over%20R/near/235845778" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/R.5Em.20is.20finite.20dimensional.20over.20R.html#235845778">(Apr 23 2021 at 14:05)</a>:</h4>
<p>If we add the instance, we should probably replace <code>fin m</code> by an arbitrary fintype.</p>



<a name="235846971"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/R%5Em%20is%20finite%20dimensional%20over%20R/near/235846971" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/R.5Em.20is.20finite.20dimensional.20over.20R.html#235846971">(Apr 23 2021 at 14:13)</a>:</h4>
<p>This works:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="sd">/-- non-dependent version of `is_noetherian_pi` -/</span>
<span class="kd">instance</span> <span class="n">is_noetherian_pi'</span> <span class="o">{</span><span class="n">R</span> <span class="n">ι</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">{</span><span class="n">M</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">ring</span> <span class="n">R</span><span class="o">]</span>
  <span class="o">[</span><span class="n">add_comm_group</span> <span class="n">M</span><span class="o">]</span> <span class="o">[</span><span class="n">semimodule</span> <span class="n">R</span> <span class="n">M</span><span class="o">]</span> <span class="o">[</span><span class="n">fintype</span> <span class="n">ι</span><span class="o">]</span>
  <span class="o">[</span><span class="n">is_noetherian</span> <span class="n">R</span> <span class="n">M</span><span class="o">]</span> <span class="o">:</span> <span class="n">is_noetherian</span> <span class="n">R</span> <span class="o">(</span><span class="n">ι</span> <span class="bp">→</span> <span class="n">M</span><span class="o">)</span> <span class="o">:=</span>
<span class="n">is_noetherian_pi</span>
</code></pre></div>



<a name="235847004"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/R%5Em%20is%20finite%20dimensional%20over%20R/near/235847004" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/R.5Em.20is.20finite.20dimensional.20over.20R.html#235847004">(Apr 23 2021 at 14:13)</a>:</h4>
<p>Then <code>apply_instance</code> can close the original goal</p>



<a name="235847150"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/R%5Em%20is%20finite%20dimensional%20over%20R/near/235847150" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/R.5Em.20is.20finite.20dimensional.20over.20R.html#235847150">(Apr 23 2021 at 14:14)</a>:</h4>
<p>Did you check that it closes the original goal?</p>



<a name="235847202"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/R%5Em%20is%20finite%20dimensional%20over%20R/near/235847202" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/R.5Em.20is.20finite.20dimensional.20over.20R.html#235847202">(Apr 23 2021 at 14:14)</a>:</h4>
<p>Because this thread seems to show that it doesn't always work as expected...</p>



<a name="235847215"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/R%5Em%20is%20finite%20dimensional%20over%20R/near/235847215" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/R.5Em.20is.20finite.20dimensional.20over.20R.html#235847215">(Apr 23 2021 at 14:14)</a>:</h4>
<p><del>Huh, I guess I screwed up</del></p>



<a name="235847321"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/R%5Em%20is%20finite%20dimensional%20over%20R/near/235847321" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/R.5Em.20is.20finite.20dimensional.20over.20R.html#235847321">(Apr 23 2021 at 14:15)</a>:</h4>
<p>Yes, it does:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">data.real.basic</span>
<span class="kn">import</span> <span class="n">linear_algebra.finite_dimensional</span>

<span class="sd">/-- non-dependent version of `is_noetherian_pi` -/</span>
<span class="kd">instance</span> <span class="n">is_noetherian_pi'</span> <span class="o">{</span><span class="n">R</span> <span class="n">ι</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">{</span><span class="n">M</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">ring</span> <span class="n">R</span><span class="o">]</span>
  <span class="o">[</span><span class="n">add_comm_group</span> <span class="n">M</span><span class="o">]</span> <span class="o">[</span><span class="n">semimodule</span> <span class="n">R</span> <span class="n">M</span><span class="o">]</span> <span class="o">[</span><span class="n">fintype</span> <span class="n">ι</span><span class="o">]</span>
  <span class="o">[</span><span class="n">is_noetherian</span> <span class="n">R</span> <span class="n">M</span><span class="o">]</span> <span class="o">:</span> <span class="n">is_noetherian</span> <span class="n">R</span> <span class="o">(</span><span class="n">ι</span> <span class="bp">→</span> <span class="n">M</span><span class="o">)</span> <span class="o">:=</span>
<span class="n">is_noetherian_pi</span>

<span class="kd">instance</span> <span class="o">{</span><span class="n">m</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">}</span> <span class="o">:</span> <span class="n">finite_dimensional</span> <span class="n">ℝ</span> <span class="o">(</span><span class="n">fin</span> <span class="n">m</span> <span class="bp">→</span> <span class="n">ℝ</span><span class="o">)</span> <span class="o">:=</span>
<span class="kd">by</span> <span class="n">apply_instance</span>  <span class="c1">-- works fine</span>
</code></pre></div>



<a name="235847497"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/R%5Em%20is%20finite%20dimensional%20over%20R/near/235847497" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/R.5Em.20is.20finite.20dimensional.20over.20R.html#235847497">(Apr 23 2021 at 14:16)</a>:</h4>
<p>I've seen something very similar for all the <code>dfinsupp</code> instances, where it can't seem to work out how to provide <code>M : ι → Type*</code> when it's a constant function</p>



<a name="235847877"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/R%5Em%20is%20finite%20dimensional%20over%20R/near/235847877" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/R.5Em.20is.20finite.20dimensional.20over.20R.html#235847877">(Apr 23 2021 at 14:19)</a>:</h4>
<p>This doesn't seem to be enough</p>



<a name="235847958"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/R%5Em%20is%20finite%20dimensional%20over%20R/near/235847958" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/R.5Em.20is.20finite.20dimensional.20over.20R.html#235847958">(Apr 23 2021 at 14:19)</a>:</h4>
<p>As in, that example fails for you, or there's a wider use case that still fails?</p>



<a name="235848550"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/R%5Em%20is%20finite%20dimensional%20over%20R/near/235848550" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/R.5Em.20is.20finite.20dimensional.20over.20R.html#235848550">(Apr 23 2021 at 14:23)</a>:</h4>
<p>I have a hard time minimizing...</p>



<a name="235875147"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/R%5Em%20is%20finite%20dimensional%20over%20R/near/235875147" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/R.5Em.20is.20finite.20dimensional.20over.20R.html#235875147">(Apr 23 2021 at 17:05)</a>:</h4>
<p>I returned to this but gave up on true minimization. It seems to be a really subtle elaboration order issue. The next piece of code works only if you uncomment the specialized instance:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">analysis.calculus.times_cont_diff</span>

<span class="sd">/-- non-dependent version of `is_noetherian_pi`, because typeclass inference struggles to infer `M` in the non-dependent case. -/</span>
<span class="kd">instance</span> <span class="n">is_noetherian_pi'</span> <span class="o">{</span><span class="n">R</span> <span class="n">ι</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">{</span><span class="n">M</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">ring</span> <span class="n">R</span><span class="o">]</span>
  <span class="o">[</span><span class="n">add_comm_group</span> <span class="n">M</span><span class="o">]</span> <span class="o">[</span><span class="n">semimodule</span> <span class="n">R</span> <span class="n">M</span><span class="o">]</span> <span class="o">[</span><span class="n">fintype</span> <span class="n">ι</span><span class="o">]</span>
  <span class="o">[</span><span class="n">is_noetherian</span> <span class="n">R</span> <span class="n">M</span><span class="o">]</span> <span class="o">:</span> <span class="n">is_noetherian</span> <span class="n">R</span> <span class="o">(</span><span class="n">ι</span> <span class="bp">→</span> <span class="n">M</span><span class="o">)</span> <span class="o">:=</span>
<span class="n">is_noetherian_pi</span>

<span class="c1">--instance {m : ℕ} : finite_dimensional ℝ (fin m → ℝ) :=</span>
<span class="c1">--by apply_instance  -- works fine</span>

<span class="n">open_locale</span> <span class="n">topological_space</span>

<span class="kd">variables</span> <span class="o">{</span><span class="n">E</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">normed_group</span> <span class="n">E</span><span class="o">]</span> <span class="o">[</span><span class="n">normed_space</span> <span class="n">ℝ</span> <span class="n">E</span><span class="o">]</span>
          <span class="o">{</span><span class="n">F</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">normed_group</span> <span class="n">F</span><span class="o">]</span> <span class="o">[</span><span class="n">normed_space</span> <span class="n">ℝ</span> <span class="n">F</span><span class="o">]</span> <span class="o">[</span><span class="n">finite_dimensional</span> <span class="n">ℝ</span> <span class="n">F</span><span class="o">]</span>

<span class="kd">def</span> <span class="n">smooth_at</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">E</span> <span class="bp">→</span> <span class="n">F</span><span class="o">)</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="n">E</span><span class="o">)</span> <span class="o">:</span> <span class="kt">Prop</span> <span class="o">:=</span> <span class="bp">∃</span> <span class="n">s</span> <span class="bp">∈</span> <span class="bp">𝓝</span> <span class="n">x</span><span class="o">,</span> <span class="n">times_cont_diff_on</span> <span class="n">ℝ</span> <span class="bp">⊤</span> <span class="n">f</span> <span class="n">s</span>

<span class="kd">lemma</span> <span class="n">smooth_surrounding</span> <span class="o">{</span><span class="n">x</span> <span class="o">:</span> <span class="n">F</span><span class="o">}</span> <span class="o">{</span><span class="n">d</span><span class="o">}</span> <span class="o">{</span><span class="n">p</span> <span class="o">:</span> <span class="n">fin</span> <span class="n">d</span> <span class="bp">→</span> <span class="n">F</span><span class="o">}</span> <span class="o">:</span>
  <span class="bp">∃</span> <span class="n">W</span> <span class="o">:</span> <span class="n">F</span> <span class="bp">×</span> <span class="o">(</span><span class="n">fin</span> <span class="n">d</span> <span class="bp">→</span> <span class="n">F</span><span class="o">)</span> <span class="bp">→</span> <span class="o">(</span><span class="n">fin</span> <span class="n">d</span> <span class="bp">→</span> <span class="n">ℝ</span><span class="o">),</span>
  <span class="bp">∀ᶠ</span> <span class="n">y</span> <span class="k">in</span> <span class="bp">𝓝</span> <span class="n">x</span><span class="o">,</span> <span class="bp">∀ᶠ</span> <span class="n">q</span> <span class="k">in</span> <span class="bp">𝓝</span> <span class="n">p</span><span class="o">,</span> <span class="n">smooth_at</span> <span class="n">W</span> <span class="o">(</span><span class="n">y</span><span class="o">,</span> <span class="n">q</span><span class="o">)</span>  <span class="o">:=</span>
<span class="gr">sorry</span>
</code></pre></div>



<a name="235877913"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/R%5Em%20is%20finite%20dimensional%20over%20R/near/235877913" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/R.5Em.20is.20finite.20dimensional.20over.20R.html#235877913">(Apr 23 2021 at 17:24)</a>:</h4>
<p>The failing lemma can be reduced to</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">lemma</span> <span class="n">smooth_fails</span> <span class="o">{</span><span class="n">d</span><span class="o">}</span> <span class="o">(</span><span class="n">W</span> <span class="o">:</span> <span class="n">F</span> <span class="bp">→</span> <span class="o">(</span><span class="n">fin</span> <span class="n">d</span> <span class="bp">→</span> <span class="n">ℝ</span><span class="o">))</span> <span class="o">(</span><span class="n">y</span> <span class="o">:</span> <span class="n">F</span><span class="o">)</span> <span class="o">:</span> <span class="n">smooth_at</span> <span class="n">W</span> <span class="n">y</span>  <span class="o">:=</span>
<span class="gr">sorry</span>
</code></pre></div>



<a name="235878979"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/R%5Em%20is%20finite%20dimensional%20over%20R/near/235878979" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/R.5Em.20is.20finite.20dimensional.20over.20R.html#235878979">(Apr 23 2021 at 17:31)</a>:</h4>
<p>Some more investigation:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">analysis.calculus.times_cont_diff</span>

<span class="sd">/-- non-dependent version of `is_noetherian_pi`, because typeclass inference struggles to infer `M` in the non-dependent case. -/</span>
<span class="kd">instance</span> <span class="n">is_noetherian_pi'</span> <span class="o">{</span><span class="n">R</span> <span class="n">ι</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">{</span><span class="n">M</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">ring</span> <span class="n">R</span><span class="o">]</span>
  <span class="o">[</span><span class="n">add_comm_group</span> <span class="n">M</span><span class="o">]</span> <span class="o">[</span><span class="n">semimodule</span> <span class="n">R</span> <span class="n">M</span><span class="o">]</span> <span class="o">[</span><span class="n">fintype</span> <span class="n">ι</span><span class="o">]</span>
  <span class="o">[</span><span class="n">is_noetherian</span> <span class="n">R</span> <span class="n">M</span><span class="o">]</span> <span class="o">:</span> <span class="n">is_noetherian</span> <span class="n">R</span> <span class="o">(</span><span class="n">ι</span> <span class="bp">→</span> <span class="n">M</span><span class="o">)</span> <span class="o">:=</span>
<span class="n">is_noetherian_pi</span>

<span class="c1">-- if this is an instance the original works</span>
<span class="kd">def</span> <span class="n">missing</span> <span class="o">(</span><span class="n">ι</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">[</span><span class="n">fintype</span> <span class="n">ι</span><span class="o">]</span> <span class="o">:</span> <span class="n">is_noetherian</span> <span class="n">ℝ</span> <span class="o">(</span><span class="n">ι</span> <span class="bp">→</span> <span class="n">ℝ</span><span class="o">)</span> <span class="o">:=</span>
<span class="kd">by</span> <span class="n">apply_instance</span>  <span class="c1">-- works fine</span>

<span class="n">open_locale</span> <span class="n">topological_space</span>

<span class="kd">variables</span> <span class="o">{</span><span class="n">E</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">normed_group</span> <span class="n">E</span><span class="o">]</span> <span class="o">[</span><span class="n">normed_space</span> <span class="n">ℝ</span> <span class="n">E</span><span class="o">]</span>
          <span class="o">{</span><span class="n">F</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">normed_group</span> <span class="n">F</span><span class="o">]</span> <span class="o">[</span><span class="n">normed_space</span> <span class="n">ℝ</span> <span class="n">F</span><span class="o">]</span> <span class="o">[</span><span class="n">is_noetherian</span> <span class="n">ℝ</span> <span class="n">F</span><span class="o">]</span>

<span class="kd">def</span> <span class="n">smooth_at</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">E</span> <span class="bp">→</span> <span class="n">F</span><span class="o">)</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="n">E</span><span class="o">)</span> <span class="o">:</span> <span class="kt">Prop</span> <span class="o">:=</span> <span class="bp">∃</span> <span class="n">s</span> <span class="bp">∈</span> <span class="bp">𝓝</span> <span class="n">x</span><span class="o">,</span> <span class="n">times_cont_diff_on</span> <span class="n">ℝ</span> <span class="bp">⊤</span> <span class="n">f</span> <span class="n">s</span>

<span class="kd">set_option</span> <span class="n">pp.implicit</span> <span class="n">true</span>

<span class="kd">lemma</span> <span class="n">smooth_fails</span> <span class="o">{</span><span class="n">d</span><span class="o">}</span> <span class="o">(</span><span class="n">W</span> <span class="o">:</span> <span class="n">F</span> <span class="bp">→</span> <span class="o">(</span><span class="n">fin</span> <span class="n">d</span> <span class="bp">→</span> <span class="n">ℝ</span><span class="o">))</span> <span class="o">(</span><span class="n">y</span> <span class="o">:</span> <span class="n">F</span><span class="o">)</span> <span class="o">:</span>
  <span class="bp">@</span><span class="n">smooth_at</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="o">(</span><span class="n">missing</span> <span class="n">_</span><span class="o">)</span> <span class="n">W</span> <span class="n">y</span>  <span class="o">:=</span>
<span class="gr">sorry</span>

<span class="kd">lemma</span> <span class="n">smooth_ok1</span> <span class="o">{</span><span class="n">d</span><span class="o">}</span> <span class="o">(</span><span class="n">W</span> <span class="o">:</span> <span class="n">F</span> <span class="bp">→</span> <span class="o">(</span><span class="n">fin</span> <span class="n">d</span> <span class="bp">→</span> <span class="n">ℝ</span><span class="o">))</span> <span class="o">(</span><span class="n">y</span> <span class="o">:</span> <span class="n">F</span><span class="o">)</span> <span class="o">:</span>
  <span class="bp">@</span><span class="n">smooth_at</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="o">(</span><span class="n">missing</span> <span class="bp">$</span> <span class="n">fin</span> <span class="n">d</span><span class="o">)</span> <span class="n">W</span> <span class="n">y</span>  <span class="o">:=</span>
<span class="gr">sorry</span>

<span class="kd">lemma</span> <span class="n">smooth_ok2</span> <span class="o">{</span><span class="n">d</span><span class="o">}</span> <span class="o">(</span><span class="n">W</span> <span class="o">:</span> <span class="n">F</span> <span class="bp">→</span> <span class="o">(</span><span class="n">fin</span> <span class="n">d</span> <span class="bp">→</span> <span class="n">ℝ</span><span class="o">))</span> <span class="o">(</span><span class="n">y</span> <span class="o">:</span> <span class="n">F</span><span class="o">)</span> <span class="o">:</span>
  <span class="bp">@</span><span class="n">smooth_at</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="o">(</span><span class="kd">by</span> <span class="n">exact</span> <span class="n">missing</span> <span class="n">_</span><span class="o">)</span> <span class="n">W</span> <span class="n">y</span>  <span class="o">:=</span>
<span class="gr">sorry</span>
</code></pre></div>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>