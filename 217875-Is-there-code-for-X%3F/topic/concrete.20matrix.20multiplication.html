---
layout: archive
title: Zulip Chat Archive
permalink: /stream/217875-Is-there-code-for-X%3F/topic/concrete.20matrix.20multiplication.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/index.html">Is there code for X?</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/concrete.20matrix.20multiplication.html">concrete matrix multiplication</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="291076067"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/concrete%20matrix%20multiplication/near/291076067" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jeremy Avigad <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/concrete.20matrix.20multiplication.html#291076067">(Jul 27 2022 at 16:51)</a>:</h4>
<p>Can anyone tell me how to replace the <code>sorry</code> below by a proof?</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">data.matrix.notation</span>
<span class="kn">import</span> <span class="n">data.real.basic</span>

<span class="kd">theorem</span> <span class="n">add_eq</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="n">d</span> <span class="n">e</span> <span class="n">f</span> <span class="n">g</span> <span class="n">h</span> <span class="o">:</span> <span class="n">real</span><span class="o">)</span> <span class="o">:</span>
  <span class="bp">!</span><span class="o">[</span><span class="bp">!</span><span class="o">[</span><span class="n">a</span><span class="o">,</span> <span class="n">b</span><span class="o">],</span> <span class="bp">!</span><span class="o">[</span><span class="n">c</span><span class="o">,</span> <span class="n">d</span><span class="o">]]</span> <span class="bp">+</span> <span class="bp">!</span><span class="o">[</span> <span class="bp">!</span><span class="o">[</span><span class="n">e</span><span class="o">,</span> <span class="n">f</span><span class="o">],</span> <span class="bp">!</span><span class="o">[</span><span class="n">g</span><span class="o">,</span> <span class="n">h</span><span class="o">]]</span> <span class="bp">=</span> <span class="bp">!</span><span class="o">[</span><span class="bp">!</span><span class="o">[</span><span class="n">a</span> <span class="bp">+</span> <span class="n">e</span><span class="o">,</span> <span class="n">b</span> <span class="bp">+</span> <span class="n">f</span><span class="o">],</span> <span class="bp">!</span><span class="o">[</span><span class="n">c</span> <span class="bp">+</span> <span class="n">g</span><span class="o">,</span> <span class="n">d</span> <span class="bp">+</span> <span class="n">h</span><span class="o">]]</span> <span class="o">:=</span>
<span class="kd">by</span> <span class="n">simp</span> <span class="n">only</span> <span class="o">[</span><span class="n">matrix.cons_add_cons</span><span class="o">,</span> <span class="n">matrix.empty_add_empty</span><span class="o">]</span>

<span class="kd">theorem</span> <span class="n">mul_eq</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="n">d</span> <span class="n">e</span> <span class="n">f</span> <span class="n">g</span> <span class="n">h</span> <span class="o">:</span> <span class="n">real</span><span class="o">)</span> <span class="o">:</span>
  <span class="bp">!</span><span class="o">[</span><span class="bp">!</span><span class="o">[</span><span class="n">a</span><span class="o">,</span> <span class="n">b</span><span class="o">],</span> <span class="bp">!</span><span class="o">[</span><span class="n">c</span><span class="o">,</span> <span class="n">d</span><span class="o">]]</span> <span class="bp">*</span> <span class="bp">!</span><span class="o">[</span> <span class="bp">!</span><span class="o">[</span><span class="n">e</span><span class="o">,</span> <span class="n">f</span><span class="o">],</span> <span class="bp">!</span><span class="o">[</span><span class="n">g</span><span class="o">,</span> <span class="n">h</span><span class="o">]]</span> <span class="bp">=</span>
    <span class="bp">!</span><span class="o">[</span><span class="bp">!</span><span class="o">[</span><span class="n">a</span> <span class="bp">*</span> <span class="n">e</span> <span class="bp">+</span> <span class="n">b</span> <span class="bp">*</span> <span class="n">f</span><span class="o">,</span> <span class="n">a</span> <span class="bp">*</span> <span class="n">g</span> <span class="bp">+</span> <span class="n">b</span> <span class="bp">*</span> <span class="n">h</span><span class="o">],</span> <span class="bp">!</span><span class="o">[</span><span class="n">c</span> <span class="bp">*</span> <span class="n">e</span> <span class="bp">+</span> <span class="n">d</span> <span class="bp">*</span> <span class="n">f</span><span class="o">,</span> <span class="n">c</span> <span class="bp">*</span> <span class="n">g</span> <span class="bp">+</span> <span class="n">d</span> <span class="bp">*</span> <span class="n">h</span><span class="o">]]</span> <span class="o">:=</span>
<span class="gr">sorry</span>
</code></pre></div>



<a name="291076813"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/concrete%20matrix%20multiplication/near/291076813" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/concrete.20matrix.20multiplication.html#291076813">(Jul 27 2022 at 16:57)</a>:</h4>
<p><a href="https://github.com/leanprover-community/mathlib/blob/master/test/matrix.lean#L53">https://github.com/leanprover-community/mathlib/blob/master/test/matrix.lean#L53</a> is the most recent mathlib way to state and prove this, which version are you on?</p>



<a name="291077586"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/concrete%20matrix%20multiplication/near/291077586" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jeremy Avigad <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/concrete.20matrix.20multiplication.html#291077586">(Jul 27 2022 at 17:02)</a>:</h4>
<p>I am probably working with an old version of mathlib, but I can update. Thanks!</p>



<a name="291079871"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/concrete%20matrix%20multiplication/near/291079871" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/concrete.20matrix.20multiplication.html#291079871">(Jul 27 2022 at 17:18)</a>:</h4>
<p><a href="https://leanprover-community.github.io/mathlib_docs/find/matrix.mul_fin_two">docs#matrix.mul_fin_two</a> is a direct statement of your second lemma</p>



<a name="291080030"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/concrete%20matrix%20multiplication/near/291080030" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/concrete.20matrix.20multiplication.html#291080030">(Jul 27 2022 at 17:19)</a>:</h4>
<p>When I find the time, I'm planning to adapt the approach from <a href="#narrow/stream/239415-metaprogramming-.2F-tactics/topic/A.20tactic.20for.20expanding.20matrices.20into.20coefficients">this Zulip thread</a> to generate these lemmas automaticaly for arbitrary <code>m</code> and <code>n</code></p>



<a name="291081711"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/concrete%20matrix%20multiplication/near/291081711" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jeremy Avigad <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/concrete.20matrix.20multiplication.html#291081711">(Jul 27 2022 at 17:31)</a>:</h4>
<p>Thanks again. I am trying to work this out for a friend who is thinking about using Lean in an undergraduate course on linear algebra. He says that even the 2x2 case will be helpful for students to work out definitions.</p>
<p>For the record, I also got this:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">theorem</span> <span class="n">transpose_eq</span> <span class="o">{</span><span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="n">d</span> <span class="o">:</span> <span class="n">real</span><span class="o">}</span> <span class="o">:</span> <span class="bp">!!</span><span class="o">[</span><span class="n">a</span><span class="o">,</span> <span class="n">b</span><span class="bp">;</span> <span class="n">c</span><span class="o">,</span> <span class="n">d</span><span class="o">]</span><span class="bp">ᵀ</span> <span class="bp">=</span> <span class="bp">!!</span><span class="o">[</span><span class="n">a</span><span class="o">,</span> <span class="n">c</span><span class="bp">;</span> <span class="n">b</span><span class="o">,</span> <span class="n">d</span><span class="o">]</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="n">ext</span> <span class="n">i</span> <span class="n">j</span><span class="o">,</span>
  <span class="n">dsimp</span> <span class="o">[</span><span class="n">matrix.of</span><span class="o">],</span>
  <span class="n">fin_cases</span> <span class="n">i</span><span class="bp">;</span> <span class="n">fin_cases</span> <span class="n">j</span><span class="bp">;</span> <span class="n">simp</span>
<span class="kd">end</span>
</code></pre></div>
<p>If there is a better way, I will be happy to hear it.</p>



<a name="291082191"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/concrete%20matrix%20multiplication/near/291082191" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/concrete.20matrix.20multiplication.html#291082191">(Jul 27 2022 at 17:35)</a>:</h4>
<p><code>dsimp [matrix.of]</code> is not something I was intending to be done</p>



<a name="291082244"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/concrete%20matrix%20multiplication/near/291082244" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/concrete.20matrix.20multiplication.html#291082244">(Jul 27 2022 at 17:35)</a>:</h4>
<p>Because doing that makes your goal not quite type correct any more</p>



<a name="291082430"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/concrete%20matrix%20multiplication/near/291082430" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/concrete.20matrix.20multiplication.html#291082430">(Jul 27 2022 at 17:36)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">theorem</span> <span class="n">transpose_eq</span> <span class="o">{</span><span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="n">d</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">}</span> <span class="o">:</span> <span class="bp">!!</span><span class="o">[</span><span class="n">a</span><span class="o">,</span> <span class="n">b</span><span class="bp">;</span> <span class="n">c</span><span class="o">,</span> <span class="n">d</span><span class="o">]</span><span class="bp">ᵀ</span> <span class="bp">=</span> <span class="bp">!!</span><span class="o">[</span><span class="n">a</span><span class="o">,</span> <span class="n">c</span><span class="bp">;</span> <span class="n">b</span><span class="o">,</span> <span class="n">d</span><span class="o">]</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="n">ext</span> <span class="n">i</span> <span class="n">j</span><span class="o">,</span>
  <span class="n">fin_cases</span> <span class="n">i</span><span class="bp">;</span> <span class="n">fin_cases</span> <span class="n">j</span><span class="bp">;</span> <span class="n">simp</span> <span class="o">[</span><span class="n">matrix.transpose_apply</span><span class="o">],</span>
<span class="kd">end</span>
</code></pre></div>
<p>is slightly better</p>



<a name="291082510"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/concrete%20matrix%20multiplication/near/291082510" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/concrete.20matrix.20multiplication.html#291082510">(Jul 27 2022 at 17:37)</a>:</h4>
<p>It's a bit weird how <code>simp</code> gets in a dead end without the help</p>



<a name="291083055"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/concrete%20matrix%20multiplication/near/291083055" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/concrete.20matrix.20multiplication.html#291083055">(Jul 27 2022 at 17:40)</a>:</h4>
<p>Again, probably we want a metaprogram like the one linked above here</p>



<a name="291102276"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/concrete%20matrix%20multiplication/near/291102276" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/concrete.20matrix.20multiplication.html#291102276">(Jul 27 2022 at 19:58)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110865">Jeremy Avigad</span> <a href="#narrow/stream/217875-Is-there-code-for-X.3F/topic/concrete.20matrix.20multiplication/near/291076067">said</a>:</p>
<blockquote>
<p><div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">theorem</span> <span class="n">mul_eq</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="n">d</span> <span class="n">e</span> <span class="n">f</span> <span class="n">g</span> <span class="n">h</span> <span class="o">:</span> <span class="n">real</span><span class="o">)</span> <span class="o">:</span>
  <span class="bp">!</span><span class="o">[</span><span class="bp">!</span><span class="o">[</span><span class="n">a</span><span class="o">,</span> <span class="n">b</span><span class="o">],</span> <span class="bp">!</span><span class="o">[</span><span class="n">c</span><span class="o">,</span> <span class="n">d</span><span class="o">]]</span> <span class="bp">*</span> <span class="bp">!</span><span class="o">[</span> <span class="bp">!</span><span class="o">[</span><span class="n">e</span><span class="o">,</span> <span class="n">f</span><span class="o">],</span> <span class="bp">!</span><span class="o">[</span><span class="n">g</span><span class="o">,</span> <span class="n">h</span><span class="o">]]</span> <span class="bp">=</span>
    <span class="bp">!</span><span class="o">[</span><span class="bp">!</span><span class="o">[</span><span class="n">a</span> <span class="bp">*</span> <span class="n">e</span> <span class="bp">+</span> <span class="n">b</span> <span class="bp">*</span> <span class="n">f</span><span class="o">,</span> <span class="n">a</span> <span class="bp">*</span> <span class="n">g</span> <span class="bp">+</span> <span class="n">b</span> <span class="bp">*</span> <span class="n">h</span><span class="o">],</span> <span class="bp">!</span><span class="o">[</span><span class="n">c</span> <span class="bp">*</span> <span class="n">e</span> <span class="bp">+</span> <span class="n">d</span> <span class="bp">*</span> <span class="n">f</span><span class="o">,</span> <span class="n">c</span> <span class="bp">*</span> <span class="n">g</span> <span class="bp">+</span> <span class="n">d</span> <span class="bp">*</span> <span class="n">h</span><span class="o">]]</span> <span class="o">:=</span>
<span class="gr">sorry</span>
</code></pre></div><br>
</p>
</blockquote>
<p><span class="user-mention" data-user-id="110865">@Jeremy Avigad</span> There's actually something terrible going on with this one when I try it locally. It's interpreting the multiplication as pi-type multiplication, i.e. pointwise multiplication of the entries.  I've never seen this before, I wonder if something changed recently?</p>



<a name="291102309"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/concrete%20matrix%20multiplication/near/291102309" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/concrete.20matrix.20multiplication.html#291102309">(Jul 27 2022 at 19:58)</a>:</h4>
<p>I disabled that with (!)</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">local</span> <span class="kn">attribute</span> <span class="o">[</span><span class="bp">-</span><span class="kd">instance</span><span class="o">]</span> <span class="n">pi.has_mul</span> <span class="n">pi.distrib</span> <span class="n">pi.semiring</span> <span class="n">pi.comm_semiring</span> <span class="n">pi.ring</span> <span class="n">pi.comm_ring</span>
  <span class="n">pi.mul_zero_class</span> <span class="n">pi.mul_zero_one_class</span> <span class="n">pi.mul_one_class</span> <span class="n">pi.monoid_with_zero</span> <span class="n">pi.comm_monoid</span>
  <span class="n">pi.semigroup_with_zero</span> <span class="n">pi.monoid</span> <span class="n">pi.div_inv_monoid</span> <span class="n">pi.division_monoid</span> <span class="n">pi.division_comm_monoid</span>
  <span class="n">pi.non_unital_non_assoc_semiring</span> <span class="n">pi.non_unital_non_assoc_ring</span> <span class="n">pi.comm_monoid_with_zero</span>
  <span class="n">pi.semigroup</span> <span class="n">pi.comm_semigroup</span>
  <span class="n">pi.non_unital_semiring</span> <span class="n">pi.non_unital_comm_semiring</span> <span class="n">pi.non_unital_ring</span> <span class="n">pi.non_unital_comm_ring</span>
  <span class="n">pi.non_assoc_semiring</span> <span class="n">pi.non_assoc_ring</span>
</code></pre></div>



<a name="291102380"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/concrete%20matrix%20multiplication/near/291102380" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/concrete.20matrix.20multiplication.html#291102380">(Jul 27 2022 at 19:59)</a>:</h4>
<p>And then Lean couldn't find the multiplication instance I wanted, although it did pick it up when I wrote <code>@has_mul.mul _ matrix.has_mul</code> rather than <code>*</code>.</p>



<a name="291102590"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/concrete%20matrix%20multiplication/near/291102590" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/concrete.20matrix.20multiplication.html#291102590">(Jul 27 2022 at 20:00)</a>:</h4>
<p>Yes, <span class="user-mention" data-user-id="310045">@Eric Wieser</span> changed this recently. You now should use <code>!![a, b; c, d]</code> (or something of sort) instead of <code>![![a, b], ![c, d]]</code>.</p>



<a name="291102671"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/concrete%20matrix%20multiplication/near/291102671" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yakov Pechersky <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/concrete.20matrix.20multiplication.html#291102671">(Jul 27 2022 at 20:01)</a>:</h4>
<p>And also why we have the cdot for matrix.mul</p>



<a name="291103008"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/concrete%20matrix%20multiplication/near/291103008" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/concrete.20matrix.20multiplication.html#291103008">(Jul 27 2022 at 20:03)</a>:</h4>
<p>To be clear, I didn't change the behavior, that's always been broken: what I changed was adding new syntax that is no longer broken in that way</p>



<a name="291103146"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/concrete%20matrix%20multiplication/near/291103146" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/concrete.20matrix.20multiplication.html#291103146">(Jul 27 2022 at 20:04)</a>:</h4>
<p>Anyway, this works for me:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">theorem</span> <span class="n">mul_eq</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="n">d</span> <span class="n">e</span> <span class="n">f</span> <span class="n">g</span> <span class="n">h</span> <span class="o">:</span> <span class="n">real</span><span class="o">)</span> <span class="o">:</span>
  <span class="bp">!!</span><span class="o">[</span><span class="n">a</span><span class="o">,</span> <span class="n">b</span><span class="bp">;</span> <span class="n">c</span><span class="o">,</span> <span class="n">d</span><span class="o">]</span> <span class="bp">*</span> <span class="bp">!!</span><span class="o">[</span><span class="n">e</span><span class="o">,</span> <span class="n">f</span><span class="bp">;</span> <span class="n">g</span><span class="o">,</span> <span class="n">h</span><span class="o">]</span> <span class="bp">=</span>
    <span class="bp">!!</span><span class="o">[</span><span class="n">a</span> <span class="bp">*</span> <span class="n">e</span> <span class="bp">+</span> <span class="n">b</span> <span class="bp">*</span> <span class="n">g</span><span class="o">,</span> <span class="n">a</span> <span class="bp">*</span> <span class="n">f</span> <span class="bp">+</span> <span class="n">b</span> <span class="bp">*</span> <span class="n">h</span><span class="bp">;</span> <span class="n">c</span> <span class="bp">*</span> <span class="n">e</span> <span class="bp">+</span> <span class="n">d</span> <span class="bp">*</span> <span class="n">g</span><span class="o">,</span> <span class="n">c</span> <span class="bp">*</span> <span class="n">f</span> <span class="bp">+</span> <span class="n">d</span> <span class="bp">*</span> <span class="n">h</span><span class="o">]</span> <span class="o">:=</span>
<span class="kd">by</span> <span class="n">ext</span> <span class="n">i</span> <span class="n">j</span><span class="bp">;</span> <span class="n">fin_cases</span> <span class="n">i</span><span class="bp">;</span> <span class="n">fin_cases</span> <span class="n">j</span><span class="bp">;</span> <span class="n">simp</span> <span class="o">[</span><span class="n">matrix.mul_apply</span><span class="o">]</span>
</code></pre></div>
<p>Note that there was a typo (<code>f</code> and <code>g</code> swapped) in the first version.  <code>ext i j; fin_cases i; fin_cases j; </code> is my algorithm for all matrix problems.</p>



<a name="291105325"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/concrete%20matrix%20multiplication/near/291105325" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/concrete.20matrix.20multiplication.html#291105325">(Jul 27 2022 at 20:24)</a>:</h4>
<p>Maybe next week I'll make a <code>matrix.of_mul_of</code> lemma that uses tactics to generate the goal types for us</p>



<a name="291208624"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/concrete%20matrix%20multiplication/near/291208624" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/concrete.20matrix.20multiplication.html#291208624">(Jul 28 2022 at 15:24)</a>:</h4>
<p>This was much more interesting than whatever I was supposed to be doing today: <a href="https://github.com/leanprover-community/mathlib/pull/15738">#15738</a>. Using <code>mul_fin</code> from that PR:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">example</span> <span class="o">{</span><span class="n">α</span><span class="o">}</span> <span class="o">[</span><span class="n">add_comm_monoid</span> <span class="n">α</span><span class="o">]</span> <span class="o">[</span><span class="n">has_mul</span> <span class="n">α</span><span class="o">]</span> <span class="o">(</span><span class="n">a₁₁</span> <span class="n">a₁₂</span> <span class="n">a₂₁</span> <span class="n">a₂₂</span> <span class="n">b₁₁</span> <span class="n">b₁₂</span> <span class="n">b₂₁</span> <span class="n">b₂₂</span> <span class="o">:</span> <span class="n">α</span><span class="o">)</span> <span class="o">:</span>
  <span class="bp">!!</span><span class="o">[</span><span class="n">a₁₁</span><span class="o">,</span> <span class="n">a₁₂</span><span class="bp">;</span>
     <span class="n">a₂₁</span><span class="o">,</span> <span class="n">a₂₂</span><span class="o">]</span> <span class="bp">⬝</span> <span class="bp">!!</span><span class="o">[</span><span class="n">b₁₁</span><span class="o">,</span> <span class="n">b₁₂</span><span class="bp">;</span>
                    <span class="n">b₂₁</span><span class="o">,</span> <span class="n">b₂₂</span><span class="o">]</span> <span class="bp">=</span> <span class="bp">!!</span><span class="o">[</span><span class="n">a₁₁</span> <span class="bp">*</span> <span class="n">b₁₁</span> <span class="bp">+</span> <span class="n">a₁₂</span> <span class="bp">*</span> <span class="n">b₂₁</span><span class="o">,</span> <span class="n">a₁₁</span> <span class="bp">*</span> <span class="n">b₁₂</span> <span class="bp">+</span> <span class="n">a₁₂</span> <span class="bp">*</span> <span class="n">b₂₂</span><span class="bp">;</span>
                                   <span class="n">a₂₁</span> <span class="bp">*</span> <span class="n">b₁₁</span> <span class="bp">+</span> <span class="n">a₂₂</span> <span class="bp">*</span> <span class="n">b₂₁</span><span class="o">,</span> <span class="n">a₂₁</span> <span class="bp">*</span> <span class="n">b₁₂</span> <span class="bp">+</span> <span class="n">a₂₂</span> <span class="bp">*</span> <span class="n">b₂₂</span><span class="o">]</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="n">rw</span> <span class="n">mul_fin</span><span class="o">,</span>
<span class="kd">end</span>

<span class="kd">example</span> <span class="o">{</span><span class="n">α</span><span class="o">}</span> <span class="o">[</span><span class="n">add_comm_monoid</span> <span class="n">α</span><span class="o">]</span> <span class="o">[</span><span class="n">has_mul</span> <span class="n">α</span><span class="o">]</span> <span class="o">(</span><span class="n">a₁₁</span> <span class="n">a₁₂</span> <span class="n">b₁₁</span> <span class="n">b₁₂</span> <span class="n">b₂₁</span> <span class="n">b₂₂</span> <span class="o">:</span> <span class="n">α</span><span class="o">)</span> <span class="o">:</span>
  <span class="bp">!!</span><span class="o">[</span><span class="n">a₁₁</span><span class="o">,</span> <span class="n">a₁₂</span><span class="o">]</span> <span class="bp">⬝</span> <span class="bp">!!</span><span class="o">[</span><span class="n">b₁₁</span><span class="o">,</span> <span class="n">b₁₂</span><span class="bp">;</span>
                    <span class="n">b₂₁</span><span class="o">,</span> <span class="n">b₂₂</span><span class="o">]</span> <span class="bp">=</span> <span class="bp">!!</span><span class="o">[</span><span class="n">a₁₁</span> <span class="bp">*</span> <span class="n">b₁₁</span> <span class="bp">+</span> <span class="n">a₁₂</span> <span class="bp">*</span> <span class="n">b₂₁</span><span class="o">,</span> <span class="n">a₁₁</span> <span class="bp">*</span> <span class="n">b₁₂</span> <span class="bp">+</span> <span class="n">a₁₂</span> <span class="bp">*</span> <span class="n">b₂₂</span><span class="bp">;</span><span class="o">]</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="n">rw</span> <span class="n">mul_fin</span><span class="o">,</span>
<span class="kd">end</span>
</code></pre></div>



<a name="291208957"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/concrete%20matrix%20multiplication/near/291208957" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/concrete.20matrix.20multiplication.html#291208957">(Jul 28 2022 at 15:27)</a>:</h4>
<p>Nice!</p>



<a name="291209165"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/concrete%20matrix%20multiplication/near/291209165" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/concrete.20matrix.20multiplication.html#291209165">(Jul 28 2022 at 15:28)</a>:</h4>
<p>I guess there's not much we can do about the fact that the equation is diagonal :-)</p>



<a name="291209258"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/concrete%20matrix%20multiplication/near/291209258" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/concrete.20matrix.20multiplication.html#291209258">(Jul 28 2022 at 15:29)</a>:</h4>
<p>I don't think the world is ready for the level of whitespace-sensitivity that would require</p>



<a name="291209308"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/concrete%20matrix%20multiplication/near/291209308" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/concrete.20matrix.20multiplication.html#291209308">(Jul 28 2022 at 15:29)</a>:</h4>
<p>Should this really be a tactic though?</p>



<a name="291209386"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/concrete%20matrix%20multiplication/near/291209386" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/concrete.20matrix.20multiplication.html#291209386">(Jul 28 2022 at 15:30)</a>:</h4>
<p><span class="user-mention silent" data-user-id="127136">Alex J. Best</span> <a href="#narrow/stream/217875-Is-there-code-for-X.3F/topic/concrete.20matrix.20multiplication/near/291209308">said</a>:</p>
<blockquote>
<p>Should this really be a tactic though?</p>
</blockquote>
<p>It's pretty useful to be able to use it in a rewrite chain</p>



<a name="291209429"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/concrete%20matrix%20multiplication/near/291209429" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/concrete.20matrix.20multiplication.html#291209429">(Jul 28 2022 at 15:30)</a>:</h4>
<p>The design is based off <a href="https://leanprover-community.github.io/mathlib_docs/find/category_theory.reassoc_of">docs#category_theory.reassoc_of</a></p>



<a name="291209715"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/concrete%20matrix%20multiplication/near/291209715" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/concrete.20matrix.20multiplication.html#291209715">(Jul 28 2022 at 15:32)</a>:</h4>
<p><span class="user-mention silent" data-user-id="310045">Eric Wieser</span> <a href="#narrow/stream/217875-Is-there-code-for-X.3F/topic/concrete.20matrix.20multiplication/near/291209386">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="127136">Alex J. Best</span> <a href="#narrow/stream/217875-Is-there-code-for-X.3F/topic/concrete.20matrix.20multiplication/near/291209308">said</a>:</p>
<blockquote>
<p>Should this really be a tactic though?</p>
</blockquote>
<p>It's pretty useful to be able to use it in a rewrite chain</p>
</blockquote>
<p>You could say the same about many tactics though</p>



<a name="291209766"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/concrete%20matrix%20multiplication/near/291209766" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/concrete.20matrix.20multiplication.html#291209766">(Jul 28 2022 at 15:32)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110038">Kevin Buzzard</span> <a href="#narrow/stream/217875-Is-there-code-for-X.3F/topic/concrete.20matrix.20multiplication/near/291209165">said</a>:</p>
<blockquote>
<p>I guess there's not much we can do about the fact that the equation is diagonal :-)</p>
</blockquote>
<p>You could invest in a rotatable screen:<br>
<a href="/user_uploads/3121/OKrTXA6Dw9AbADhugThO4vF2/image.png">image.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/3121/OKrTXA6Dw9AbADhugThO4vF2/image.png" title="image.png"><img src="/user_uploads/3121/OKrTXA6Dw9AbADhugThO4vF2/image.png"></a></div>



<a name="291209879"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/concrete%20matrix%20multiplication/near/291209879" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/concrete.20matrix.20multiplication.html#291209879">(Jul 28 2022 at 15:33)</a>:</h4>
<p>And we could massage a lot of them into rewrite lemmas with this sort of technique right? Or is there some special form such auto params have to take?</p>



<a name="291209918"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/concrete%20matrix%20multiplication/near/291209918" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/concrete.20matrix.20multiplication.html#291209918">(Jul 28 2022 at 15:33)</a>:</h4>
<p>Like can you make a <code>rw norm_num</code> in this way?</p>



<a name="291210109"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/concrete%20matrix%20multiplication/near/291210109" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/concrete.20matrix.20multiplication.html#291210109">(Jul 28 2022 at 15:34)</a>:</h4>
<p>Ah, one downside of trying to be clever here is that <code>mul_fin</code> isn't allowed in <code>simp</code> or <code>simp_rw</code></p>



<a name="291210114"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/concrete%20matrix%20multiplication/near/291210114" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/concrete.20matrix.20multiplication.html#291210114">(Jul 28 2022 at 15:34)</a>:</h4>
<p>And what happens when <code>library_search</code> and such try to apply this lemma?</p>



<a name="291210325"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/concrete%20matrix%20multiplication/near/291210325" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/concrete.20matrix.20multiplication.html#291210325">(Jul 28 2022 at 15:36)</a>:</h4>
<p>Library_search gives</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">Try</span> <span class="n">this</span><span class="o">:</span> <span class="n">refine</span> <span class="n">mul_fin</span>
  <span class="o">(</span><span class="n">id</span>
     <span class="o">((</span><span class="bp">λ</span> <span class="o">(</span><span class="n">_inst_1_1</span> <span class="o">:</span> <span class="n">has_mul</span> <span class="n">α</span><span class="o">)</span> <span class="o">(</span><span class="n">_inst_2_1</span> <span class="o">:</span> <span class="n">add_comm_monoid</span> <span class="n">α</span><span class="o">)</span>
       <span class="o">(</span><span class="n">b₀₀</span> <span class="n">b₀₁</span> <span class="n">b₁₀</span> <span class="n">b₁₁_1</span> <span class="n">a₀₀</span> <span class="n">a₀₁</span> <span class="n">a₁₀</span> <span class="n">a₁₁_1</span> <span class="o">:</span> <span class="n">α</span><span class="o">),</span>
         <span class="o">((</span><span class="bp">⇑</span><span class="n">of</span> <span class="bp">!</span><span class="o">[</span><span class="bp">!</span><span class="o">[</span><span class="n">a₀₀</span><span class="o">,</span> <span class="n">a₀₁</span><span class="o">],</span> <span class="bp">!</span><span class="o">[</span><span class="n">a₁₀</span><span class="o">,</span> <span class="n">a₁₁_1</span><span class="o">]])</span><span class="bp">.</span><span class="n">mul</span><span class="bp">ᵣ</span><span class="n">_eq</span>
            <span class="o">(</span><span class="bp">⇑</span><span class="n">of</span> <span class="bp">!</span><span class="o">[</span><span class="bp">!</span><span class="o">[</span><span class="n">b₀₀</span><span class="o">,</span> <span class="n">b₀₁</span><span class="o">],</span> <span class="bp">!</span><span class="o">[</span><span class="n">b₁₀</span><span class="o">,</span> <span class="n">b₁₁_1</span><span class="o">]]))</span><span class="bp">.</span><span class="n">symm</span><span class="o">)</span>
        <span class="n">_inst_2</span>
        <span class="n">_inst_1</span>
        <span class="n">b₁₁</span>
        <span class="n">b₁₂</span>
        <span class="n">b₂₁</span>
        <span class="n">b₂₂</span>
        <span class="n">a₁₁</span>
        <span class="n">a₁₂</span>
        <span class="n">a₂₁</span>
        <span class="n">a₂₂</span><span class="o">))</span>
</code></pre></div>



<a name="291210422"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/concrete%20matrix%20multiplication/near/291210422" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/concrete.20matrix.20multiplication.html#291210422">(Jul 28 2022 at 15:36)</a>:</h4>
<p>I guess I should have been consistent about 0 or 1-based numbering of matrices</p>



<a name="291210716"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/concrete%20matrix%20multiplication/near/291210716" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/concrete.20matrix.20multiplication.html#291210716">(Jul 28 2022 at 15:38)</a>:</h4>
<p>I think having some standard mechanism for generating lemmas templated by some arguments would be nice</p>



<a name="291214685"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/concrete%20matrix%20multiplication/near/291214685" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/concrete.20matrix.20multiplication.html#291214685">(Jul 28 2022 at 16:04)</a>:</h4>
<p>Yeah the thing that bothers me is that these are generated each time they are used, which maybe isn't a huge problem (tactics are run each time too).</p>



<a name="291215357"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/concrete%20matrix%20multiplication/near/291215357" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/concrete.20matrix.20multiplication.html#291215357">(Jul 28 2022 at 16:09)</a>:</h4>
<p>Maybe there's some way to cache the lemma for each value of <code>(l, m, n)</code></p>



<a name="291301351"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/concrete%20matrix%20multiplication/near/291301351" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/concrete.20matrix.20multiplication.html#291301351">(Jul 29 2022 at 09:41)</a>:</h4>
<p>I've updated the PR so that library_search now suggests</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">Try</span> <span class="n">this</span><span class="o">:</span> <span class="n">refine</span> <span class="n">mul_fin</span>
  <span class="o">(</span><span class="n">id</span> <span class="o">(</span><span class="n">mul_fin_aux</span> <span class="mi">2</span> <span class="mi">2</span> <span class="mi">2</span> <span class="n">a₁₁</span> <span class="n">a₁₂</span> <span class="n">a₂₁</span> <span class="n">a₂₂</span> <span class="n">b₁₁</span> <span class="n">b₁₂</span> <span class="n">b₂₁</span> <span class="n">b₂₂</span><span class="o">))</span>
</code></pre></div>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>