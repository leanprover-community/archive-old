---
layout: archive
title: Zulip Chat Archive
permalink: /stream/217875-Is-there-code-for-X%3F/topic/tsum_lt.3F.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/index.html">Is there code for X?</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/tsum_lt.3F.html">tsum_lt?</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="224662657"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/tsum_lt%3F/near/224662657" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/tsum_lt.3F.html#224662657">(Jan 31 2021 at 20:22)</a>:</h4>
<p>Dear All,</p>
<p>I am interested in proving the lemma below, but I am having a hard time.  Can someone help me find a proof?</p>
<p>Thank you very much!</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">topology.algebra.infinite_sum</span>

<span class="kd">lemma</span> <span class="n">tsum_lt</span> <span class="o">(</span><span class="n">f</span> <span class="n">g</span> <span class="o">:</span> <span class="n">ℕ</span> <span class="bp">→</span> <span class="n">ℝ</span><span class="o">)</span> <span class="o">(</span><span class="n">h0</span> <span class="o">:</span> <span class="bp">∀</span> <span class="o">(</span><span class="n">b</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">),</span> <span class="mi">0</span> <span class="bp">≤</span> <span class="n">f</span> <span class="n">b</span><span class="o">)</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="bp">∀</span> <span class="o">(</span><span class="n">b</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">),</span> <span class="n">f</span> <span class="n">b</span> <span class="bp">≤</span> <span class="n">g</span> <span class="n">b</span><span class="o">)</span>
  <span class="o">(</span><span class="n">hg</span><span class="o">:</span> <span class="n">summable</span> <span class="n">g</span><span class="o">)</span> <span class="o">{</span><span class="n">i</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">}</span> <span class="o">(</span><span class="n">hi</span> <span class="o">:</span> <span class="n">f</span> <span class="n">i</span> <span class="bp">&lt;</span> <span class="n">g</span> <span class="n">i</span><span class="o">)</span> <span class="o">:</span>
  <span class="bp">∑'</span> <span class="n">n</span><span class="o">,</span> <span class="n">f</span> <span class="n">n</span> <span class="bp">&lt;</span> <span class="bp">∑'</span> <span class="n">n</span><span class="o">,</span> <span class="n">g</span> <span class="n">n</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="gr">sorry</span>
<span class="kd">end</span>
</code></pre></div>



<a name="224662782"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/tsum_lt%3F/near/224662782" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/tsum_lt.3F.html#224662782">(Jan 31 2021 at 20:25)</a>:</h4>
<p>There's <a href="https://leanprover-community.github.io/mathlib_docs/find/tsum_le_tsum">docs#tsum_le_tsum</a> which gets you almost all the way there :)</p>



<a name="224663006"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/tsum_lt%3F/near/224663006" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/tsum_lt.3F.html#224663006">(Jan 31 2021 at 20:30)</a>:</h4>
<p>I had seen it, but I got stuck when I wanted to extract an element from the sum...</p>



<a name="224663024"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/tsum_lt%3F/near/224663024" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/tsum_lt.3F.html#224663024">(Jan 31 2021 at 20:31)</a>:</h4>
<p>I am also going to remove the unnecessary assumption <code>summable f</code></p>



<a name="224663116"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/tsum_lt%3F/near/224663116" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/tsum_lt.3F.html#224663116">(Jan 31 2021 at 20:33)</a>:</h4>
<p>Yeah this is still a bit messy even after tsum_le_tsum :-/ I would be tempted to define a new sequence h which is 0 away from i, and g(i)-f(i) at i, and then apply tsum_le_tsum to (f+h) and g.</p>



<a name="224663167"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/tsum_lt%3F/near/224663167" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/tsum_lt.3F.html#224663167">(Jan 31 2021 at 20:34)</a>:</h4>
<p>Ok, it seems a bit more laborious than I would have liked, but maybe it is simply a reflection of the fact that the API is not there yet...</p>



<a name="224663170"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/tsum_lt%3F/near/224663170" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/tsum_lt.3F.html#224663170">(Jan 31 2021 at 20:34)</a>:</h4>
<p>Presumably there's some lemma which gives you <code>summable f</code> straight back after you removed it.</p>



<a name="224663200"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/tsum_lt%3F/near/224663200" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/tsum_lt.3F.html#224663200">(Jan 31 2021 at 20:35)</a>:</h4>
<p>Well, the summable <code>f</code> follows from <code>summable_of_nonneg_of_le</code> which is already there...  so that is only a minor issue...</p>



<a name="224663203"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/tsum_lt%3F/near/224663203" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/tsum_lt.3F.html#224663203">(Jan 31 2021 at 20:35)</a>:</h4>
<p>API: Right -- there don't seem to be any results which give you that a sum is less than another sum. My proposal was the simplest way around this which I could think of.</p>



<a name="224663241"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/tsum_lt%3F/near/224663241" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/tsum_lt.3F.html#224663241">(Jan 31 2021 at 20:36)</a>:</h4>
<p>I'm getting an error with this code <span class="user-mention" data-user-id="321459">@Damiano Testa</span> :</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="mi">5</span><span class="o">:</span><span class="mi">3</span><span class="o">:</span> <span class="n">failed</span> <span class="n">to</span> <span class="n">synthesize</span> <span class="n">type</span> <span class="kd">class</span> <span class="kd">instance</span> <span class="n">for</span>
<span class="n">f</span> <span class="n">g</span> <span class="o">:</span> <span class="n">ℕ</span> <span class="bp">→</span> <span class="n">ℝ</span><span class="o">,</span>
<span class="n">h0</span> <span class="o">:</span> <span class="bp">∀</span> <span class="o">(</span><span class="n">b</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">),</span> <span class="mi">0</span> <span class="bp">≤</span> <span class="n">f</span> <span class="n">b</span><span class="o">,</span>
<span class="n">h</span> <span class="o">:</span> <span class="bp">∀</span> <span class="o">(</span><span class="n">b</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">),</span> <span class="n">f</span> <span class="n">b</span> <span class="bp">≤</span> <span class="n">g</span> <span class="n">b</span><span class="o">,</span>
<span class="n">hg</span> <span class="o">:</span> <span class="n">summable</span> <span class="n">g</span><span class="o">,</span>
<span class="n">i</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">,</span>
<span class="n">hi</span> <span class="o">:</span> <span class="n">f</span> <span class="n">i</span> <span class="bp">&lt;</span> <span class="n">g</span> <span class="n">i</span>
<span class="bp">⊢</span> <span class="n">add_comm_monoid</span> <span class="kt">Prop</span>
</code></pre></div>
<p>red squiggle under the first <code>∑'</code></p>



<a name="224663252"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/tsum_lt%3F/near/224663252" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/tsum_lt.3F.html#224663252">(Jan 31 2021 at 20:36)</a>:</h4>
<p>Anyway, I'll give up for tonight and try again tomorroq!</p>
<p>Thanks for your suggestions!</p>



<a name="224663265"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/tsum_lt%3F/near/224663265" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/tsum_lt.3F.html#224663265">(Jan 31 2021 at 20:36)</a>:</h4>
<p>Adam, that is weird: it works for me with only that import...</p>



<a name="224663266"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/tsum_lt%3F/near/224663266" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/tsum_lt.3F.html#224663266">(Jan 31 2021 at 20:36)</a>:</h4>
<p>Oh, just parens missing</p>



<a name="224663270"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/tsum_lt%3F/near/224663270" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/tsum_lt.3F.html#224663270">(Jan 31 2021 at 20:37)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">topology.algebra.infinite_sum</span>

<span class="kd">lemma</span> <span class="n">tsum_lt</span> <span class="o">(</span><span class="n">f</span> <span class="n">g</span> <span class="o">:</span> <span class="n">ℕ</span> <span class="bp">→</span> <span class="n">ℝ</span><span class="o">)</span> <span class="o">(</span><span class="n">h0</span> <span class="o">:</span> <span class="bp">∀</span> <span class="o">(</span><span class="n">b</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">),</span> <span class="mi">0</span> <span class="bp">≤</span> <span class="n">f</span> <span class="n">b</span><span class="o">)</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="bp">∀</span> <span class="o">(</span><span class="n">b</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">),</span> <span class="n">f</span> <span class="n">b</span> <span class="bp">≤</span> <span class="n">g</span> <span class="n">b</span><span class="o">)</span>
  <span class="o">(</span><span class="n">hg</span><span class="o">:</span> <span class="n">summable</span> <span class="n">g</span><span class="o">)</span> <span class="o">{</span><span class="n">i</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">}</span> <span class="o">(</span><span class="n">hi</span> <span class="o">:</span> <span class="n">f</span> <span class="n">i</span> <span class="bp">&lt;</span> <span class="n">g</span> <span class="n">i</span><span class="o">)</span> <span class="o">:</span>
  <span class="o">(</span><span class="bp">∑'</span> <span class="n">n</span><span class="o">,</span> <span class="n">f</span> <span class="n">n</span><span class="o">)</span> <span class="bp">&lt;</span> <span class="bp">∑'</span> <span class="n">n</span><span class="o">,</span> <span class="n">g</span> <span class="n">n</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="gr">sorry</span>
<span class="kd">end</span>
</code></pre></div>



<a name="224663281"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/tsum_lt%3F/near/224663281" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/tsum_lt.3F.html#224663281">(Jan 31 2021 at 20:37)</a>:</h4>
<p>The code works fine for me too. Are you on an old mathlib?</p>



<a name="224663290"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/tsum_lt%3F/near/224663290" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/tsum_lt.3F.html#224663290">(Jan 31 2021 at 20:37)</a>:</h4>
<p>I just upgraded mathlib....</p>



<a name="224663292"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/tsum_lt%3F/near/224663292" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/tsum_lt.3F.html#224663292">(Jan 31 2021 at 20:37)</a>:</h4>
<p>I think Eric or someone changed priorities of sums a week or two ago.</p>



<a name="224663298"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/tsum_lt%3F/near/224663298" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/tsum_lt.3F.html#224663298">(Jan 31 2021 at 20:37)</a>:</h4>
<p>Maybe I'm on an old mathlib then!</p>



<a name="224663344"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/tsum_lt%3F/near/224663344" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/tsum_lt.3F.html#224663344">(Jan 31 2021 at 20:38)</a>:</h4>
<p>Oh, I upgraded mathlib, but didn't restart the server.</p>



<a name="224663347"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/tsum_lt%3F/near/224663347" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/tsum_lt.3F.html#224663347">(Jan 31 2021 at 20:38)</a>:</h4>
<p>All good now :)</p>



<a name="224663543"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/tsum_lt%3F/near/224663543" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/tsum_lt.3F.html#224663543">(Jan 31 2021 at 20:42)</a>:</h4>
<p>Oh, we don't even have <code>tsum_pos</code> :(</p>



<a name="224664965"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/tsum_lt%3F/near/224664965" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/tsum_lt.3F.html#224664965">(Jan 31 2021 at 21:12)</a>:</h4>
<p>Ok, I am glad that it was not just me, then!</p>
<p>If no one else does it earlier, I may try to prove some of these results tomorrow!</p>



<a name="224664977"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/tsum_lt%3F/near/224664977" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/tsum_lt.3F.html#224664977">(Jan 31 2021 at 21:13)</a>:</h4>
<p>(If someone else wants to do it, though, I would be very grateful!)</p>



<a name="224670040"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/tsum_lt%3F/near/224670040" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/tsum_lt.3F.html#224670040">(Jan 31 2021 at 22:37)</a>:</h4>
<p>It was Johan, but I was the one who jogged his memory into fixing it</p>



<a name="224709201"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/tsum_lt%3F/near/224709201" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/tsum_lt.3F.html#224709201">(Feb 01 2021 at 10:45)</a>:</h4>
<p>Below is a proof of <code>tsum_lt</code>.</p>
<p>In case anyone feels like they want to simplify these proofs, please go ahead!  Otherwise, I might open a PR to include them somewhere.</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">topology.instances.ennreal</span>

<span class="kd">lemma</span> <span class="n">tsum_ite_eq_add</span> <span class="o">{</span><span class="n">f</span> <span class="o">:</span> <span class="n">ℕ</span> <span class="bp">→</span> <span class="n">ℝ</span><span class="o">}</span> <span class="o">(</span><span class="n">hf</span> <span class="o">:</span> <span class="n">summable</span> <span class="n">f</span><span class="o">)</span> <span class="o">(</span><span class="n">i</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="o">(</span><span class="n">a</span> <span class="o">:</span> <span class="n">ℝ</span><span class="o">)</span> <span class="o">:</span>
  <span class="bp">∑'</span> <span class="n">n</span><span class="o">,</span> <span class="o">((</span><span class="n">ite</span> <span class="o">(</span><span class="n">n</span> <span class="bp">=</span> <span class="n">i</span><span class="o">)</span> <span class="n">a</span> <span class="mi">0</span><span class="o">)</span> <span class="bp">+</span> <span class="n">f</span> <span class="n">n</span><span class="o">)</span> <span class="bp">=</span> <span class="n">a</span> <span class="bp">+</span> <span class="bp">∑'</span> <span class="n">n</span><span class="o">,</span> <span class="n">f</span> <span class="n">n</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="n">rw</span> <span class="o">[</span><span class="n">tsum_add</span> <span class="o">⟨</span><span class="n">a</span><span class="o">,</span> <span class="n">_</span><span class="o">⟩</span> <span class="n">hf</span><span class="o">,</span> <span class="bp">@</span><span class="n">tsum_eq_single</span> <span class="n">ℝ</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="n">i</span><span class="o">],</span>
  <span class="o">{</span> <span class="n">split_ifs</span><span class="bp">;</span> <span class="n">refl</span> <span class="o">},</span>
  <span class="o">{</span> <span class="n">exact</span> <span class="bp">λ</span> <span class="o">(</span><span class="n">j</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="o">(</span><span class="n">ji</span> <span class="o">:</span> <span class="bp">¬</span> <span class="n">j</span> <span class="bp">=</span> <span class="n">i</span><span class="o">),</span> <span class="bp">@</span><span class="n">if_neg</span> <span class="n">_</span> <span class="n">_</span> <span class="n">ji</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="o">},</span>
  <span class="o">{</span> <span class="n">convert</span> <span class="n">has_sum_ite_eq</span> <span class="n">i</span> <span class="n">a</span><span class="o">,</span>
    <span class="n">refine</span> <span class="n">funext</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">x</span><span class="o">,</span> <span class="n">_</span><span class="o">),</span>
    <span class="n">congr</span> <span class="o">}</span>
<span class="kd">end</span>

<span class="kd">lemma</span> <span class="n">tsum_eq</span> <span class="o">{</span><span class="n">f</span> <span class="n">g</span> <span class="o">:</span> <span class="n">ℕ</span> <span class="bp">→</span> <span class="n">ℝ</span><span class="o">}</span> <span class="o">(</span><span class="n">hfg</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">n</span><span class="o">,</span> <span class="n">f</span> <span class="n">n</span> <span class="bp">=</span> <span class="n">g</span> <span class="n">n</span><span class="o">)</span> <span class="o">:</span>
  <span class="bp">∑'</span> <span class="n">n</span><span class="o">,</span> <span class="n">f</span> <span class="n">n</span> <span class="bp">=</span> <span class="bp">∑'</span> <span class="n">n</span><span class="o">,</span> <span class="n">g</span> <span class="n">n</span> <span class="o">:=</span>
<span class="kd">by</span> <span class="n">simp_rw</span> <span class="o">[</span><span class="n">hfg</span><span class="o">]</span>

<span class="kd">lemma</span> <span class="n">tsum_ite_eq_extract</span> <span class="o">{</span><span class="n">f</span> <span class="o">:</span> <span class="n">ℕ</span> <span class="bp">→</span> <span class="n">ℝ</span><span class="o">}</span> <span class="o">(</span><span class="n">hf</span> <span class="o">:</span> <span class="n">summable</span> <span class="n">f</span><span class="o">)</span> <span class="o">(</span><span class="n">i</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="o">:</span>
  <span class="bp">∑'</span> <span class="n">n</span><span class="o">,</span> <span class="n">f</span> <span class="n">n</span> <span class="bp">=</span> <span class="n">f</span> <span class="n">i</span> <span class="bp">+</span> <span class="bp">∑'</span> <span class="n">n</span><span class="o">,</span> <span class="n">ite</span> <span class="o">(</span><span class="n">n</span> <span class="bp">≠</span> <span class="n">i</span><span class="o">)</span> <span class="o">(</span><span class="n">f</span> <span class="n">n</span><span class="o">)</span> <span class="mi">0</span> <span class="o">:=</span>
<span class="kd">by</span> <span class="n">rw</span> <span class="o">[</span><span class="bp">←</span> <span class="n">tsum_ite_eq_add</span> <span class="o">(</span><span class="n">hf.summable_of_eq_zero_or_self</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">j</span><span class="o">,</span> <span class="n">_</span><span class="o">))</span> <span class="n">i</span><span class="o">,</span> <span class="n">tsum_eq</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">j</span><span class="o">,</span> <span class="n">_</span><span class="o">)]</span><span class="bp">;</span>
  <span class="n">by_cases</span> <span class="n">ji</span> <span class="o">:</span> <span class="n">j</span> <span class="bp">=</span> <span class="n">i</span><span class="bp">;</span> <span class="n">simp</span> <span class="o">[</span><span class="n">ji</span><span class="o">]</span>

<span class="kd">lemma</span> <span class="n">tsum_lt</span> <span class="o">{</span><span class="n">f</span> <span class="n">g</span> <span class="o">:</span> <span class="n">ℕ</span> <span class="bp">→</span> <span class="n">ℝ</span><span class="o">}</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="bp">∀</span> <span class="o">(</span><span class="n">b</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">),</span> <span class="n">f</span> <span class="n">b</span> <span class="bp">≤</span> <span class="n">g</span> <span class="n">b</span><span class="o">)</span>
  <span class="o">(</span><span class="n">hf</span><span class="o">:</span> <span class="n">summable</span> <span class="n">f</span><span class="o">)</span> <span class="o">(</span><span class="n">hg</span><span class="o">:</span> <span class="n">summable</span> <span class="n">g</span><span class="o">)</span> <span class="o">{</span><span class="n">i</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">}</span> <span class="o">(</span><span class="n">hi</span> <span class="o">:</span> <span class="n">f</span> <span class="n">i</span> <span class="bp">&lt;</span> <span class="n">g</span> <span class="n">i</span><span class="o">)</span> <span class="o">:</span>
  <span class="bp">∑'</span> <span class="n">n</span><span class="o">,</span> <span class="n">f</span> <span class="n">n</span> <span class="bp">&lt;</span> <span class="bp">∑'</span> <span class="n">n</span><span class="o">,</span> <span class="n">g</span> <span class="n">n</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="n">rw</span> <span class="o">[</span><span class="n">tsum_ite_eq_extract</span> <span class="n">hf</span> <span class="n">i</span><span class="o">,</span> <span class="n">tsum_ite_eq_extract</span> <span class="n">hg</span> <span class="n">i</span><span class="o">],</span>
  <span class="n">refine</span> <span class="n">add_lt_add_of_lt_of_le</span> <span class="n">hi</span> <span class="o">(</span><span class="n">tsum_le_tsum</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">j</span><span class="o">,</span> <span class="n">_</span><span class="o">)</span> <span class="n">_</span> <span class="n">_</span><span class="o">),</span>
  <span class="n">by_cases</span> <span class="n">ji</span> <span class="o">:</span> <span class="n">j</span> <span class="bp">=</span> <span class="n">i</span><span class="bp">;</span> <span class="n">simp</span> <span class="o">[</span><span class="n">ji</span><span class="o">]</span><span class="bp">;</span> <span class="n">exact</span> <span class="n">h</span> <span class="n">j</span><span class="o">,</span>
  <span class="o">{</span> <span class="n">refine</span> <span class="n">hf.summable_of_eq_zero_or_self</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">j</span><span class="o">,</span> <span class="n">_</span><span class="o">),</span>
    <span class="n">by_cases</span> <span class="n">ji</span> <span class="o">:</span> <span class="n">j</span> <span class="bp">=</span> <span class="n">i</span><span class="bp">;</span> <span class="n">simp</span> <span class="o">[</span><span class="n">ji</span><span class="o">]</span> <span class="o">},</span>
  <span class="o">{</span> <span class="n">refine</span> <span class="n">hg.summable_of_eq_zero_or_self</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">j</span><span class="o">,</span> <span class="n">_</span><span class="o">),</span>
    <span class="n">by_cases</span> <span class="n">ji</span> <span class="o">:</span> <span class="n">j</span> <span class="bp">=</span> <span class="n">i</span><span class="bp">;</span> <span class="n">simp</span> <span class="o">[</span><span class="n">ji</span><span class="o">]</span> <span class="o">}</span>
<span class="kd">end</span>

<span class="kd">lemma</span> <span class="n">tsum_lt_of_nonneg</span> <span class="o">{</span><span class="n">f</span> <span class="n">g</span> <span class="o">:</span> <span class="n">ℕ</span> <span class="bp">→</span> <span class="n">ℝ</span><span class="o">}</span> <span class="o">(</span><span class="n">h0</span> <span class="o">:</span> <span class="bp">∀</span> <span class="o">(</span><span class="n">b</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">),</span> <span class="mi">0</span> <span class="bp">≤</span> <span class="n">f</span> <span class="n">b</span><span class="o">)</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="bp">∀</span> <span class="o">(</span><span class="n">b</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">),</span> <span class="n">f</span> <span class="n">b</span> <span class="bp">≤</span> <span class="n">g</span> <span class="n">b</span><span class="o">)</span>
  <span class="o">(</span><span class="n">hg</span><span class="o">:</span> <span class="n">summable</span> <span class="n">g</span><span class="o">)</span> <span class="o">{</span><span class="n">i</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">}</span> <span class="o">(</span><span class="n">hi</span> <span class="o">:</span> <span class="n">f</span> <span class="n">i</span> <span class="bp">&lt;</span> <span class="n">g</span> <span class="n">i</span><span class="o">)</span> <span class="o">:</span>
  <span class="bp">∑'</span> <span class="n">n</span><span class="o">,</span> <span class="n">f</span> <span class="n">n</span> <span class="bp">&lt;</span> <span class="bp">∑'</span> <span class="n">n</span><span class="o">,</span> <span class="n">g</span> <span class="n">n</span> <span class="o">:=</span>
<span class="n">tsum_lt</span> <span class="n">h</span> <span class="o">(</span><span class="n">summable_of_nonneg_of_le</span> <span class="n">h0</span> <span class="n">h</span> <span class="n">hg</span><span class="o">)</span> <span class="n">hg</span> <span class="n">hi</span>
</code></pre></div>



<a name="224711352"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/tsum_lt%3F/near/224711352" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/tsum_lt.3F.html#224711352">(Feb 01 2021 at 11:08)</a>:</h4>
<p>I slightly golfed the proofs and changed the statement of <code>tsum_lt</code>: what was <code>tsum_lt</code> at the beginning of the thread is now <code>tsum_lt_of_nonneg</code>.</p>



<a name="224711989"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/tsum_lt%3F/near/224711989" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/tsum_lt.3F.html#224711989">(Feb 01 2021 at 11:15)</a>:</h4>
<p><code>tsum_congr</code> might be a good name for <code>tsum_eq</code>, especially since it can be proved as:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">lemma</span> <span class="n">tsum_congr</span> <span class="o">{</span><span class="n">f</span> <span class="n">g</span> <span class="o">:</span> <span class="n">ℕ</span> <span class="bp">→</span> <span class="n">ℝ</span><span class="o">}</span> <span class="o">(</span><span class="n">hfg</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">n</span><span class="o">,</span> <span class="n">f</span> <span class="n">n</span> <span class="bp">=</span> <span class="n">g</span> <span class="n">n</span><span class="o">)</span> <span class="o">:</span>
  <span class="bp">∑'</span> <span class="n">n</span><span class="o">,</span> <span class="n">f</span> <span class="n">n</span> <span class="bp">=</span> <span class="bp">∑'</span> <span class="n">n</span><span class="o">,</span> <span class="n">g</span> <span class="n">n</span> <span class="o">:=</span>
<span class="n">congr_arg</span> <span class="n">tsum</span> <span class="o">(</span><span class="n">funext</span> <span class="n">hfg</span><span class="o">)</span>
</code></pre></div>



<a name="224712243"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/tsum_lt%3F/near/224712243" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/tsum_lt.3F.html#224712243">(Feb 01 2021 at 11:18)</a>:</h4>
<p>Eric, thank you very much for always checking my stuff!  I like your suggestion and I updated the code above!</p>



<a name="224712698"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/tsum_lt%3F/near/224712698" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/tsum_lt.3F.html#224712698">(Feb 01 2021 at 11:23)</a>:</h4>
<p>Similarly, you seem to be suffering because <a href="https://leanprover-community.github.io/mathlib_docs/find/tsum_ite_eq">docs#tsum_ite_eq</a> is missing a decidable assumption</p>



<a name="224712762"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/tsum_lt%3F/near/224712762" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/tsum_lt.3F.html#224712762">(Feb 01 2021 at 11:24)</a>:</h4>
<p>Which means it only applies to <code>classical.dec</code>, and not to the <code>nat.decidable_eq</code> that your proof uses</p>



<a name="224713091"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/tsum_lt%3F/near/224713091" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/tsum_lt.3F.html#224713091">(Feb 01 2021 at 11:28)</a>:</h4>
<p>I have <code>open_locale classical</code> in my actual file, although, since I could erase it and the proofs still went through, I did not include it in this snippet.  What could I simplify, using <code>classical</code>?  I know that some things become easier, but I do not really have a feel for what...</p>



<a name="224713664"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/tsum_lt%3F/near/224713664" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/tsum_lt.3F.html#224713664">(Feb 01 2021 at 11:35)</a>:</h4>
<p>Almost all of your <code>tsum_ite_eq_add</code> proof should be solved by <a href="https://leanprover-community.github.io/mathlib_docs/find/tsum_ite_eq">docs#tsum_ite_eq</a>, but it's not because the instances don't unify</p>



<a name="224713745"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/tsum_lt%3F/near/224713745" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/tsum_lt.3F.html#224713745">(Feb 01 2021 at 11:36)</a>:</h4>
<p>Fixed in <a href="https://github.com/leanprover-community/mathlib/issues/5993">#5993</a></p>



<a name="224713835"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/tsum_lt%3F/near/224713835" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/tsum_lt.3F.html#224713835">(Feb 01 2021 at 11:37)</a>:</h4>
<p>Ah, thank you so much!  This means that, once your PR gets accepted, the proofs here can be simplified, right?</p>



<a name="224713907"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/tsum_lt%3F/near/224713907" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/tsum_lt.3F.html#224713907">(Feb 01 2021 at 11:38)</a>:</h4>
<p>Yes. In the meantime, you can add</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="c1">-- fixed version of tsum_ite_eq until 5993 is merged</span>
<span class="kd">@[simp]</span> <span class="kd">lemma</span> <span class="n">tsum_ite_eq'</span> <span class="o">(</span><span class="n">i</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="o">(</span><span class="n">a</span> <span class="o">:</span> <span class="n">ℝ</span><span class="o">)</span> <span class="o">:</span>
  <span class="bp">∑'</span> <span class="n">n</span><span class="o">,</span> <span class="o">(</span><span class="n">ite</span> <span class="o">(</span><span class="n">n</span> <span class="bp">=</span> <span class="n">i</span><span class="o">)</span> <span class="n">a</span> <span class="mi">0</span><span class="o">)</span> <span class="bp">=</span> <span class="n">a</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="n">convert</span> <span class="n">tsum_ite_eq</span> <span class="n">i</span> <span class="n">a</span><span class="o">,</span>
  <span class="n">funext</span><span class="o">,</span> <span class="n">congr</span><span class="o">,</span>
<span class="kd">end</span>
</code></pre></div>



<a name="224806317"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/tsum_lt%3F/near/224806317" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/tsum_lt.3F.html#224806317">(Feb 01 2021 at 23:02)</a>:</h4>
<p>Alright, that pr is now merged</p>



<a name="224834091"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/tsum_lt%3F/near/224834091" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/tsum_lt.3F.html#224834091">(Feb 02 2021 at 06:40)</a>:</h4>
<p>Thank you very much!</p>



<a name="224985680"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/tsum_lt%3F/near/224985680" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/tsum_lt.3F.html#224985680">(Feb 03 2021 at 08:22)</a>:</h4>
<p>I created a PR introducing these lemmas: <a href="https://github.com/leanprover-community/mathlib/issues/6017">#6017</a></p>
<p>Eric, I took advantage of your simplifications, but there are certainly more simplifications to be made!</p>



<a name="225021895"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/tsum_lt%3F/near/225021895" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/tsum_lt.3F.html#225021895">(Feb 03 2021 at 14:24)</a>:</h4>
<p>I think the best statement of this lemma might actually be:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">lemma</span> <span class="n">tsum_lt_congr</span> <span class="o">{</span><span class="n">i</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">}</span> <span class="o">{</span><span class="n">f</span> <span class="n">g</span> <span class="o">:</span> <span class="n">ℕ</span> <span class="bp">→</span> <span class="n">ℝ</span><span class="o">}</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="n">f</span> <span class="bp">&lt;</span> <span class="n">g</span><span class="o">)</span> <span class="o">(</span><span class="n">hf</span> <span class="o">:</span> <span class="n">summable</span> <span class="n">f</span><span class="o">)</span> <span class="o">(</span><span class="n">hg</span> <span class="o">:</span> <span class="n">summable</span> <span class="n">g</span><span class="o">)</span> <span class="o">:</span>
  <span class="bp">∑'</span> <span class="n">n</span><span class="o">,</span> <span class="n">f</span> <span class="n">n</span> <span class="bp">&lt;</span> <span class="bp">∑'</span> <span class="n">n</span><span class="o">,</span> <span class="n">g</span> <span class="n">n</span> <span class="o">:=</span>
</code></pre></div>
<p>although the lemmas to make this easy to work with are missing (xref <a href="#narrow/stream/217875-Is-there.20code.20for.20X.3F/topic/lt.20on.20functions">this thread</a>)</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>