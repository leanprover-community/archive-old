---
layout: archive
title: Zulip Chat Archive
permalink: /stream/217875-Is-there-code-for-X%3F/topic/fin.20(n.20.2B.20m).20.E2.86.92.20fin.20n.20.E2.8A.95.20fin.20m.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/index.html">Is there code for X?</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/fin.20(n.20.2B.20m).20.E2.86.92.20fin.20n.20.E2.8A.95.20fin.20m.html">fin (n + m) → fin n ⊕ fin m</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="217880272"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/fin%20%28n%20%2B%20m%29%20%E2%86%92%20fin%20n%20%E2%8A%95%20fin%20m/near/217880272" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/fin.20(n.20.2B.20m).20.E2.86.92.20fin.20n.20.E2.8A.95.20fin.20m.html#217880272">(Nov 25 2020 at 12:55)</a>:</h4>
<p>A naive attempt is:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">def</span> <span class="n">fin_split</span> <span class="o">{</span><span class="n">n</span> <span class="n">m</span><span class="o">}</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">fin</span> <span class="o">(</span><span class="n">n</span> <span class="bp">+</span> <span class="n">m</span><span class="o">))</span> <span class="o">:</span> <span class="n">fin</span> <span class="n">n</span> <span class="bp">⊕</span> <span class="n">fin</span> <span class="n">m</span> <span class="o">:=</span>
<span class="k">if</span> <span class="n">h</span> <span class="o">:</span> <span class="bp">↑</span><span class="n">f</span> <span class="bp">&lt;</span> <span class="n">n</span> <span class="k">then</span> <span class="n">sum.inl</span> <span class="o">⟨</span><span class="n">f</span><span class="o">,</span> <span class="n">h</span><span class="o">⟩</span> <span class="k">else</span> <span class="n">sum.inr</span> <span class="o">(</span><span class="n">f.sub_nat</span> <span class="n">n</span> <span class="o">(</span><span class="n">le_of_not_lt</span> <span class="n">h</span><span class="o">)))</span>
</code></pre></div>
<p>Although this fails because of the difference between <code>fin (n + m)</code> and <code> fin (m + n)</code>, which I haven't yet worked out the right invocation of <code>eq.rec</code> to solve.</p>



<a name="217880898"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/fin%20%28n%20%2B%20m%29%20%E2%86%92%20fin%20n%20%E2%8A%95%20fin%20m/near/217880898" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/fin.20(n.20.2B.20m).20.E2.86.92.20fin.20n.20.E2.8A.95.20fin.20m.html#217880898">(Nov 25 2020 at 13:00)</a>:</h4>
<p><a href="https://leanprover-community.github.io/mathlib_docs/find/sum_fin_sum_equiv">docs#sum_fin_sum_equiv</a></p>



<a name="217881068"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/fin%20%28n%20%2B%20m%29%20%E2%86%92%20fin%20n%20%E2%8A%95%20fin%20m/near/217881068" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/fin.20(n.20.2B.20m).20.E2.86.92.20fin.20n.20.E2.8A.95.20fin.20m.html#217881068">(Nov 25 2020 at 13:02)</a>:</h4>
<p>Was not expecting it to be in a different file</p>



<a name="217881554"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/fin%20%28n%20%2B%20m%29%20%E2%86%92%20fin%20n%20%E2%8A%95%20fin%20m/near/217881554" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/fin.20(n.20.2B.20m).20.E2.86.92.20fin.20n.20.E2.8A.95.20fin.20m.html#217881554">(Nov 25 2020 at 13:06)</a>:</h4>
<p>How about this one?</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">def</span> <span class="n">sum_split_func</span> <span class="o">{</span><span class="n">α</span> <span class="n">β</span> <span class="n">γ</span> <span class="o">:</span> <span class="kt">Sort</span><span class="bp">*</span><span class="o">}</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">α</span> <span class="bp">⊕</span> <span class="n">β</span> <span class="bp">→</span> <span class="n">γ</span><span class="o">)</span> <span class="o">:</span> <span class="n">pprod</span> <span class="o">(</span><span class="n">α</span> <span class="bp">→</span> <span class="n">γ</span><span class="o">)</span> <span class="o">(</span><span class="n">β</span> <span class="bp">→</span> <span class="n">γ</span><span class="o">)</span> <span class="o">:=</span> <span class="kd">by</span> <span class="n">library_search</span>
</code></pre></div>
<p>To un- <a href="https://en.wikipedia.org/wiki/XY_problem">#xy</a> a bit, I'm trying to define</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">def</span> <span class="n">finvec_split</span> <span class="o">{</span><span class="n">n</span> <span class="n">m</span><span class="o">}</span> <span class="o">{</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Sort</span><span class="bp">*</span><span class="o">}</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">fin</span> <span class="o">(</span><span class="n">n</span> <span class="bp">+</span> <span class="n">m</span><span class="o">)</span> <span class="bp">→</span> <span class="n">α</span><span class="o">)</span> <span class="o">:</span> <span class="n">pprod</span> <span class="o">(</span><span class="n">fin</span> <span class="n">n</span> <span class="bp">→</span> <span class="n">α</span><span class="o">)</span> <span class="o">(</span><span class="n">fin</span> <span class="n">m</span> <span class="bp">→</span> <span class="n">α</span><span class="o">)</span> <span class="o">:=</span> <span class="n">sorry</span><span class="bp">`</span>
</code></pre></div>



<a name="217881693"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/fin%20%28n%20%2B%20m%29%20%E2%86%92%20fin%20n%20%E2%8A%95%20fin%20m/near/217881693" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/fin.20(n.20.2B.20m).20.E2.86.92.20fin.20n.20.E2.8A.95.20fin.20m.html#217881693">(Nov 25 2020 at 13:08)</a>:</h4>
<p>In that case you might be interested in <a href="https://github.com/leanprover-community/mathlib/issues/4406">#4406</a></p>



<a name="217882953"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/fin%20%28n%20%2B%20m%29%20%E2%86%92%20fin%20n%20%E2%8A%95%20fin%20m/near/217882953" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/fin.20(n.20.2B.20m).20.E2.86.92.20fin.20n.20.E2.8A.95.20fin.20m.html#217882953">(Nov 25 2020 at 13:20)</a>:</h4>
<p>To fully un- <a href="https://en.wikipedia.org/wiki/XY_problem">#xy</a>, I'm trying to implement</p>
<p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>f</mi><mo>∧</mo><mi>g</mi><mo stretchy="false">)</mo><mo stretchy="false">(</mo><msub><mi>u</mi><mn>1</mn></msub><mo separator="true">,</mo><mo>…</mo><mo separator="true">,</mo><msub><mi>u</mi><mrow><mi>m</mi><mo>+</mo><mi>n</mi></mrow></msub><mo stretchy="false">)</mo><mo>=</mo><msub><mo>∑</mo><mrow><mi>σ</mi><mo>∈</mo><mi mathvariant="normal">shuffle</mi><mo>⁡</mo><mo stretchy="false">(</mo><mi>m</mi><mo separator="true">,</mo><mi>n</mi><mo stretchy="false">)</mo></mrow></msub><mi mathvariant="normal">sign</mi><mo>⁡</mo><mo stretchy="false">(</mo><mi>σ</mi><mo stretchy="false">)</mo><mi>f</mi><mo stretchy="false">(</mo><msub><mi>u</mi><mrow><mi>σ</mi><mo stretchy="false">(</mo><mn>1</mn><mo stretchy="false">)</mo></mrow></msub><mo separator="true">,</mo><mo>…</mo><mo separator="true">,</mo><msub><mi>u</mi><mrow><mi>σ</mi><mo stretchy="false">(</mo><mi>m</mi><mo stretchy="false">)</mo></mrow></msub><mo stretchy="false">)</mo><mi>g</mi><mo stretchy="false">(</mo><msub><mi>u</mi><mrow><mi>σ</mi><mo stretchy="false">(</mo><mi>m</mi><mo>+</mo><mn>1</mn><mo stretchy="false">)</mo></mrow></msub><mo separator="true">,</mo><mo>…</mo><mo separator="true">,</mo><msub><mi>u</mi><mrow><mi>σ</mi><mo stretchy="false">(</mo><mi>m</mi><mo>+</mo><mi>n</mi><mo stretchy="false">)</mo></mrow></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(f \wedge g)(u_1, \dots, u_{m + n}) = \sum_{\sigma \in \operatorname{shuffle}(m, n)} \operatorname{sign}(\sigma) f(u_{\sigma(1)}, \dots, u_{\sigma(m)}) g(u_{\sigma(m+1)}, \dots, u_{\sigma(m+n)})</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">∧</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mclose">)</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">u</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner">…</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal">u</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.25833100000000003em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">m</span><span class="mbin mtight">+</span><span class="mord mathnormal mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.22471em;vertical-align:-0.47471em;"></span><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:-0.0000050000000000050004em;">∑</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.22528999999999993em;"><span style="top:-2.40029em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">σ</span><span class="mrel mtight">∈</span><span class="mop mtight"><span class="mord mathrm mtight">s</span><span class="mord mathrm mtight">h</span><span class="mord mathrm mtight">u</span><span class="mord mathrm mtight" style="margin-right:0.07778em;">f</span><span class="mord mathrm mtight" style="margin-right:0.07778em;">f</span><span class="mord mathrm mtight">l</span><span class="mord mathrm mtight">e</span></span><span class="mopen mtight">(</span><span class="mord mathnormal mtight">m</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight">n</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.47471em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop"><span class="mord mathrm">s</span><span class="mord mathrm">i</span><span class="mord mathrm" style="margin-right:0.01389em;">g</span><span class="mord mathrm">n</span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.03588em;">σ</span><span class="mclose">)</span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">u</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.34480000000000005em;"><span style="top:-2.5198em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">σ</span><span class="mopen mtight">(</span><span class="mord mtight">1</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3551999999999999em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner">…</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal">u</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.34480000000000005em;"><span style="top:-2.5198em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">σ</span><span class="mopen mtight">(</span><span class="mord mathnormal mtight">m</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3551999999999999em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">u</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.34480000000000005em;"><span style="top:-2.5198em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">σ</span><span class="mopen mtight">(</span><span class="mord mathnormal mtight">m</span><span class="mbin mtight">+</span><span class="mord mtight">1</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3551999999999999em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner">…</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal">u</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.34480000000000005em;"><span style="top:-2.5198em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">σ</span><span class="mopen mtight">(</span><span class="mord mathnormal mtight">m</span><span class="mbin mtight">+</span><span class="mord mathnormal mtight">n</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3551999999999999em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></p>
<p>which I have little doubt is currently absent from mathlib</p>



<a name="217883064"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/fin%20%28n%20%2B%20m%29%20%E2%86%92%20fin%20n%20%E2%8A%95%20fin%20m/near/217883064" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/fin.20(n.20.2B.20m).20.E2.86.92.20fin.20n.20.E2.8A.95.20fin.20m.html#217883064">(Nov 25 2020 at 13:21)</a>:</h4>
<p>latex debugging output nonexistent :-(</p>



<a name="217883082"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/fin%20%28n%20%2B%20m%29%20%E2%86%92%20fin%20n%20%E2%8A%95%20fin%20m/near/217883082" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/fin.20(n.20.2B.20m).20.E2.86.92.20fin.20n.20.E2.8A.95.20fin.20m.html#217883082">(Nov 25 2020 at 13:21)</a>:</h4>
<p>(deleted)</p>



<a name="217883616"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/fin%20%28n%20%2B%20m%29%20%E2%86%92%20fin%20n%20%E2%8A%95%20fin%20m/near/217883616" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/fin.20(n.20.2B.20m).20.E2.86.92.20fin.20n.20.E2.8A.95.20fin.20m.html#217883616">(Nov 25 2020 at 13:26)</a>:</h4>
<p>In that case it might make sense to step back and think about the strategy for proving facts you need about it (associativity?) before getting your hands dirty</p>



<a name="217883680"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/fin%20%28n%20%2B%20m%29%20%E2%86%92%20fin%20n%20%E2%8A%95%20fin%20m/near/217883680" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/fin.20(n.20.2B.20m).20.E2.86.92.20fin.20n.20.E2.8A.95.20fin.20m.html#217883680">(Nov 25 2020 at 13:27)</a>:</h4>
<p>For example, you might want to represent a shuffle by an <code>equiv</code> <code>fin m ⊕ fin n ≃ fin (m + n)</code> which is order-preserving on each of the guys on the left</p>



<a name="217883861"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/fin%20%28n%20%2B%20m%29%20%E2%86%92%20fin%20n%20%E2%8A%95%20fin%20m/near/217883861" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/fin.20(n.20.2B.20m).20.E2.86.92.20fin.20n.20.E2.8A.95.20fin.20m.html#217883861">(Nov 25 2020 at 13:29)</a>:</h4>
<p>I also wonder whether this generalizes to non-fin types, in the way that <a href="https://leanprover-community.github.io/mathlib_docs/find/perm.sign">docs#perm.sign</a> does</p>



<a name="217885256"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/fin%20%28n%20%2B%20m%29%20%E2%86%92%20fin%20n%20%E2%8A%95%20fin%20m/near/217885256" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/fin.20(n.20.2B.20m).20.E2.86.92.20fin.20n.20.E2.8A.95.20fin.20m.html#217885256">(Nov 25 2020 at 13:42)</a>:</h4>
<p>I think you still need something to fix the overall sign</p>



<a name="217905637"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/fin%20%28n%20%2B%20m%29%20%E2%86%92%20fin%20n%20%E2%8A%95%20fin%20m/near/217905637" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/fin.20(n.20.2B.20m).20.E2.86.92.20fin.20n.20.E2.8A.95.20fin.20m.html#217905637">(Nov 25 2020 at 16:16)</a>:</h4>
<p><span class="user-mention silent" data-user-id="310045">Eric Wieser</span> <a href="#narrow/stream/217875-Is-there.20code.20for.20X.3F/topic/fin.20(n.20.2B.20m).20.E2.86.92.20fin.20n.20.E2.8A.95.20fin.20m/near/217881554">said</a>:</p>
<blockquote>
<p>How about this one?</p>
<p><div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">def</span> <span class="n">sum_split_func</span> <span class="o">{</span><span class="n">α</span> <span class="n">β</span> <span class="n">γ</span> <span class="o">:</span> <span class="kt">Sort</span><span class="bp">*</span><span class="o">}</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">α</span> <span class="bp">⊕</span> <span class="n">β</span> <span class="bp">→</span> <span class="n">γ</span><span class="o">)</span> <span class="o">:</span> <span class="n">pprod</span> <span class="o">(</span><span class="n">α</span> <span class="bp">→</span> <span class="n">γ</span><span class="o">)</span> <span class="o">(</span><span class="n">β</span> <span class="bp">→</span> <span class="n">γ</span><span class="o">)</span> <span class="o">:=</span> <span class="o">⟨</span><span class="n">f</span> <span class="bp">∘</span> <span class="n">sum.inl</span><span class="o">,</span> <span class="n">f</span> <span class="bp">∘</span> <span class="n">sum.inr</span><span class="o">⟩</span>
</code></pre></div><br>
</p>
</blockquote>
<p>That's <a href="https://leanprover-community.github.io/mathlib_docs/find/equiv.sum_arrow_equiv_prod_arrow">docs#equiv.sum_arrow_equiv_prod_arrow</a></p>



<a name="217909235"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/fin%20%28n%20%2B%20m%29%20%E2%86%92%20fin%20n%20%E2%8A%95%20fin%20m/near/217909235" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/fin.20(n.20.2B.20m).20.E2.86.92.20fin.20n.20.E2.8A.95.20fin.20m.html#217909235">(Nov 25 2020 at 16:43)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110032">Reid Barton</span> <a href="#narrow/stream/217875-Is-there.20code.20for.20X.3F/topic/fin.20(n.20.2B.20m).20.E2.86.92.20fin.20n.20.E2.8A.95.20fin.20m/near/217883680">said</a>:</p>
<blockquote>
<p>For example, you might want to represent a shuffle by an <code>equiv</code> <code>fin m ⊕ fin n ≃ fin (m + n)</code> which is order-preserving on each of the guys on the left</p>
</blockquote>
<p>Which would be <code>{p : fin (m + n) ≃ fin m ⊕ fin r // monotone (p.symm ∘ sum.inr) ∧  monotone (p.symm ∘ sum.inl) }</code> I guess?</p>



<a name="217909806"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/fin%20%28n%20%2B%20m%29%20%E2%86%92%20fin%20n%20%E2%8A%95%20fin%20m/near/217909806" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/fin.20(n.20.2B.20m).20.E2.86.92.20fin.20n.20.E2.8A.95.20fin.20m.html#217909806">(Nov 25 2020 at 16:48)</a>:</h4>
<p>You can also represent a shuffle by a strictly monotone (hence injective) map <code>fin m \to fin (m+n)</code>.</p>



<a name="217909981"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/fin%20%28n%20%2B%20m%29%20%E2%86%92%20fin%20n%20%E2%8A%95%20fin%20m/near/217909981" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/fin.20(n.20.2B.20m).20.E2.86.92.20fin.20n.20.E2.8A.95.20fin.20m.html#217909981">(Nov 25 2020 at 16:49)</a>:</h4>
<p>But since you want to have easy access to the two inclusions from <code>fin m</code>and <code>fin n</code>, the presentation that Reid mentioned might be better</p>



<a name="217921885"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/fin%20%28n%20%2B%20m%29%20%E2%86%92%20fin%20n%20%E2%8A%95%20fin%20m/near/217921885" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/fin.20(n.20.2B.20m).20.E2.86.92.20fin.20n.20.E2.8A.95.20fin.20m.html#217921885">(Nov 25 2020 at 18:27)</a>:</h4>
<p>I was able to at least write my definition with</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">def</span> <span class="n">is_shuffle</span> <span class="o">{</span><span class="n">m</span> <span class="n">n</span><span class="o">}</span> <span class="o">(</span><span class="n">p</span> <span class="o">:</span> <span class="n">fin</span> <span class="n">m</span> <span class="bp">⊕</span> <span class="n">fin</span> <span class="n">n</span> <span class="bp">≃</span> <span class="n">fin</span> <span class="o">(</span><span class="n">m</span> <span class="bp">+</span> <span class="n">n</span><span class="o">))</span> <span class="o">:</span> <span class="kt">Prop</span> <span class="o">:=</span> <span class="n">monotone</span> <span class="o">(</span><span class="n">p</span> <span class="bp">∘</span> <span class="n">sum.inl</span><span class="o">)</span> <span class="bp">∧</span> <span class="n">monotone</span> <span class="o">(</span><span class="n">p</span> <span class="bp">∘</span> <span class="n">sum.inr</span><span class="o">)</span>

<span class="kd">instance</span> <span class="o">{</span><span class="n">m</span> <span class="n">n</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">}</span> <span class="o">:</span> <span class="n">decidable_pred</span> <span class="o">(</span><span class="bp">@</span><span class="n">is_shuffle</span> <span class="n">m</span> <span class="n">n</span><span class="o">)</span> <span class="o">:=</span>
<span class="bp">λ</span> <span class="n">p</span><span class="o">,</span> <span class="kd">by</span> <span class="o">{</span><span class="n">unfold</span> <span class="n">is_shuffle</span> <span class="n">monotone</span><span class="o">,</span> <span class="n">apply_instance</span><span class="o">}</span>

<span class="kd">@[derive has_coe_to_fun]</span>
<span class="kd">def</span> <span class="n">shuffle</span> <span class="o">(</span><span class="n">m</span> <span class="n">n</span><span class="o">)</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span> <span class="o">:=</span> <span class="o">{</span><span class="n">p</span> <span class="o">:</span> <span class="n">fin</span> <span class="n">m</span> <span class="bp">⊕</span> <span class="n">fin</span> <span class="n">n</span> <span class="bp">≃</span> <span class="n">fin</span> <span class="o">(</span><span class="n">m</span> <span class="bp">+</span> <span class="n">n</span><span class="o">)</span> <span class="bp">//</span> <span class="n">is_shuffle</span> <span class="n">p</span> <span class="o">}</span>

<span class="kn">namespace</span> <span class="n">shuffle</span>
<span class="kd">variables</span> <span class="o">{</span><span class="n">m</span> <span class="n">n</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">}</span>

<span class="kd">def</span> <span class="n">to_perm</span> <span class="o">(</span><span class="n">s</span> <span class="o">:</span> <span class="n">shuffle</span> <span class="n">m</span> <span class="n">n</span><span class="o">)</span> <span class="o">:=</span> <span class="n">sum_fin_sum_equiv.symm.trans</span> <span class="n">s.val</span>
<span class="kd">instance</span> <span class="o">:</span> <span class="n">has_coe_t</span> <span class="o">(</span><span class="n">shuffle</span> <span class="n">m</span> <span class="n">n</span><span class="o">)</span> <span class="o">(</span><span class="n">equiv.perm</span> <span class="bp">$</span> <span class="n">fin</span> <span class="o">(</span><span class="n">m</span> <span class="bp">+</span> <span class="n">n</span><span class="o">))</span> <span class="o">:=</span> <span class="o">⟨</span><span class="n">to_perm</span><span class="o">⟩</span>
<span class="kd">instance</span> <span class="o">:</span> <span class="n">fintype</span> <span class="o">(</span><span class="n">shuffle</span> <span class="n">m</span> <span class="n">n</span><span class="o">)</span> <span class="o">:=</span> <span class="n">subtype.fintype</span> <span class="n">_</span>

<span class="kd">end</span> <span class="n">shuffle</span>

<span class="kd">def</span> <span class="n">mul_fin</span> <span class="o">{</span><span class="n">n</span> <span class="n">m</span><span class="o">}</span> <span class="o">[</span><span class="n">monoid</span> <span class="n">N</span><span class="o">]</span> <span class="o">[</span><span class="n">semimodule</span> <span class="n">ℤ</span> <span class="n">N</span><span class="o">]</span> <span class="o">(</span><span class="n">a</span> <span class="o">:</span> <span class="n">alternating_map</span> <span class="n">R</span> <span class="n">M</span> <span class="n">N</span> <span class="o">(</span><span class="n">fin</span> <span class="n">m</span><span class="o">))</span> <span class="o">(</span><span class="n">b</span> <span class="o">:</span> <span class="n">alternating_map</span> <span class="n">R</span> <span class="n">M</span> <span class="n">N</span> <span class="o">(</span><span class="n">fin</span> <span class="n">n</span><span class="o">))</span> <span class="o">:</span>
  <span class="n">alternating_map</span> <span class="n">R</span> <span class="n">M</span> <span class="n">N</span> <span class="o">(</span><span class="n">fin</span> <span class="o">(</span><span class="n">m</span> <span class="bp">+</span> <span class="n">n</span><span class="o">))</span> <span class="o">:=</span>
<span class="o">{</span> <span class="n">to_fun</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="o">(</span><span class="n">v</span> <span class="o">:</span> <span class="n">fin</span> <span class="o">(</span><span class="n">m</span> <span class="bp">+</span> <span class="n">n</span><span class="o">)</span> <span class="bp">→</span> <span class="n">M</span><span class="o">),</span>
  <span class="c1">-- definition here</span>
  <span class="bp">∑</span> <span class="n">σ</span> <span class="o">:</span> <span class="n">shuffle</span> <span class="n">m</span> <span class="n">n</span><span class="o">,</span>
    <span class="o">(</span><span class="n">equiv.perm.sign</span> <span class="n">σ.to_perm</span> <span class="o">:</span> <span class="n">ℤ</span><span class="o">)</span> <span class="bp">•</span> <span class="o">(</span><span class="n">a</span> <span class="o">(</span><span class="n">v</span> <span class="bp">∘</span> <span class="n">σ</span> <span class="bp">∘</span> <span class="n">sum.inl</span><span class="o">)</span> <span class="bp">*</span> <span class="n">b</span> <span class="o">(</span><span class="n">v</span> <span class="bp">∘</span> <span class="n">σ</span> <span class="bp">∘</span> <span class="n">sum.inr</span><span class="o">)),</span>
  <span class="n">map_add'</span> <span class="o">:=</span> <span class="n">sorry</span><span class="o">,</span> <span class="n">map_smul'</span> <span class="o">:=</span> <span class="n">sorry</span><span class="o">,</span> <span class="n">map_eq_args'</span> <span class="o">:=</span> <span class="n">sorry</span> <span class="o">}</span>
</code></pre></div>
<p>Those first two sorries ought to be trivial but are awkward, and the last one will require some thought.</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>