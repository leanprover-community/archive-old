---
layout: archive
title: Zulip Chat Archive
permalink: /stream/217875-Is-there-code-for-X%3F/topic/Tactic.20for.20unions.2C.20intersections.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/index.html">Is there code for X?</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Tactic.20for.20unions.2C.20intersections.html">Tactic for unions, intersections</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="214444422"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Tactic%20for%20unions%2C%20intersections/near/214444422" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bjørn Kjos-Hanssen <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Tactic.20for.20unions.2C.20intersections.html#214444422">(Oct 24 2020 at 19:17)</a>:</h4>
<p>Is there a tactic that will solve things like: <code>(X ∪ Z ∪ Y) \ (X ∩ Z ∩ Y) = (X ∪ Y ∪ Z) \ (X ∩ Y ∩ Z)</code>? I wrote a rather long proof of it, which hopefully wasn't necessary...</p>



<a name="214444481"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Tactic%20for%20unions%2C%20intersections/near/214444481" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Tactic.20for.20unions.2C.20intersections.html#214444481">(Oct 24 2020 at 19:18)</a>:</h4>
<p>You could see if <code>mfld_set_tac</code>, written by <span class="user-mention" data-user-id="110050">@Sebastien Gouezel</span>, will work.  You might need to import some of the manifolds files to get access to it.</p>



<a name="214444682"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Tactic%20for%20unions%2C%20intersections/near/214444682" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kyle Miller <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Tactic.20for.20unions.2C.20intersections.html#214444682">(Oct 24 2020 at 19:22)</a>:</h4>
<p>Is this what you want?</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">example</span> <span class="o">{</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">(</span><span class="n">X</span> <span class="n">Y</span> <span class="n">Z</span> <span class="o">:</span> <span class="n">set</span> <span class="n">α</span><span class="o">)</span> <span class="o">:</span> <span class="o">(</span><span class="n">X</span> <span class="bp">∪</span> <span class="n">Z</span> <span class="bp">∪</span> <span class="n">Y</span><span class="o">)</span> <span class="bp">\</span> <span class="o">(</span><span class="n">X</span> <span class="bp">∩</span> <span class="n">Z</span> <span class="bp">∩</span> <span class="n">Y</span><span class="o">)</span> <span class="bp">=</span> <span class="o">(</span><span class="n">X</span> <span class="bp">∪</span> <span class="n">Y</span> <span class="bp">∪</span> <span class="n">Z</span><span class="o">)</span> <span class="bp">\</span> <span class="o">(</span><span class="n">X</span> <span class="bp">∩</span> <span class="n">Y</span> <span class="bp">∩</span> <span class="n">Z</span><span class="o">)</span> <span class="o">:=</span>
<span class="kd">by</span> <span class="n">finish</span>
</code></pre></div>



<a name="214444689"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Tactic%20for%20unions%2C%20intersections/near/214444689" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Tactic.20for.20unions.2C.20intersections.html#214444689">(Oct 24 2020 at 19:22)</a>:</h4>
<p>It seems that <code>finish</code> can take care of a lot of these small facts about sets.</p>



<a name="214444707"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Tactic%20for%20unions%2C%20intersections/near/214444707" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Tactic.20for.20unions.2C.20intersections.html#214444707">(Oct 24 2020 at 19:23)</a>:</h4>
<p>cf. <a href="#narrow/stream/217875-Is-there.20code.20for.20X.3F/topic/Simple.20set.20theory.20nonsense/near/212441928">https://leanprover.zulipchat.com/#narrow/stream/217875-Is-there.20code.20for.20X.3F/topic/Simple.20set.20theory.20nonsense/near/212441928</a></p>



<a name="214444712"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Tactic%20for%20unions%2C%20intersections/near/214444712" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bjørn Kjos-Hanssen <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Tactic.20for.20unions.2C.20intersections.html#214444712">(Oct 24 2020 at 19:23)</a>:</h4>
<p>Awesome, I had not heard of <code>finish</code></p>



<a name="214444771"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Tactic%20for%20unions%2C%20intersections/near/214444771" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kyle Miller <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Tactic.20for.20unions.2C.20intersections.html#214444771">(Oct 24 2020 at 19:24)</a>:</h4>
<p>When that doesn't work, it can be useful to use <code>ext, simp</code> to turn things into a theorem of logic. (And then later use <code>squeeze_simp</code> to remove a non-terminal <code>simp</code>.)</p>



<a name="214444774"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Tactic%20for%20unions%2C%20intersections/near/214444774" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Tactic.20for.20unions.2C.20intersections.html#214444774">(Oct 24 2020 at 19:24)</a>:</h4>
<p>In the conversation linked above you will find an example which finish can't solve, but for which <code>tidy</code>works.</p>



<a name="214444986"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Tactic%20for%20unions%2C%20intersections/near/214444986" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Tactic.20for.20unions.2C.20intersections.html#214444986">(Oct 24 2020 at 19:28)</a>:</h4>
<p>Actually, <code>mfld_set_tac</code> does exactly this :). Heres the code:<br>
<a href="https://github.com/leanprover-community/mathlib/blob/cae77dc794ad18c1bc6ed361b7902aa9b1fb2fda/src/data/equiv/local_equiv.lean#L88">https://github.com/leanprover-community/mathlib/blob/cae77dc794ad18c1bc6ed361b7902aa9b1fb2fda/src/data/equiv/local_equiv.lean#L88</a><br>
and basically it's <code>ext, split; simp</code> using a simp-set that contains a few extra set lemmas.</p>



<a name="214445000"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Tactic%20for%20unions%2C%20intersections/near/214445000" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kyle Miller <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Tactic.20for.20unions.2C.20intersections.html#214445000">(Oct 24 2020 at 19:29)</a>:</h4>
<p>Another proof:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">example</span> <span class="o">{</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">(</span><span class="n">X</span> <span class="n">Y</span> <span class="n">Z</span> <span class="o">:</span> <span class="n">set</span> <span class="n">α</span><span class="o">)</span> <span class="o">:</span> <span class="o">(</span><span class="n">X</span> <span class="bp">∪</span> <span class="n">Z</span> <span class="bp">∪</span> <span class="n">Y</span><span class="o">)</span> <span class="bp">\</span> <span class="o">(</span><span class="n">X</span> <span class="bp">∩</span> <span class="n">Z</span> <span class="bp">∩</span> <span class="n">Y</span><span class="o">)</span> <span class="bp">=</span> <span class="o">(</span><span class="n">X</span> <span class="bp">∪</span> <span class="n">Y</span> <span class="bp">∪</span> <span class="n">Z</span><span class="o">)</span> <span class="bp">\</span> <span class="o">(</span><span class="n">X</span> <span class="bp">∩</span> <span class="n">Y</span> <span class="bp">∩</span> <span class="n">Z</span><span class="o">)</span> <span class="o">:=</span>
<span class="kd">by</span> <span class="n">simp</span> <span class="n">only</span> <span class="o">[</span><span class="n">set.union_left_comm</span><span class="o">,</span> <span class="n">set.union_comm</span><span class="o">,</span> <span class="n">set.inter_left_comm</span><span class="o">,</span> <span class="n">set.inter_comm</span><span class="o">]</span>
</code></pre></div>

<p>Mario's pointed out that <code>simp</code> puts things into a normal form, and these <code>left_comm</code> lemmas are useful for this purpose.</p>



<a name="214445074"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Tactic%20for%20unions%2C%20intersections/near/214445074" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bjørn Kjos-Hanssen <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Tactic.20for.20unions.2C.20intersections.html#214445074">(Oct 24 2020 at 19:31)</a>:</h4>
<p>On the other hand, if I already have a proof written out, will replacing it by simply <code>by finish</code> make Lean take longer to check the proof?</p>



<a name="214445128"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Tactic%20for%20unions%2C%20intersections/near/214445128" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Tactic.20for.20unions.2C.20intersections.html#214445128">(Oct 24 2020 at 19:32)</a>:</h4>
<p>Well, that depends on your proof <span aria-label="upside down" class="emoji emoji-1f643" role="img" title="upside down">:upside_down:</span> but yes, probably.</p>



<a name="214445215"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Tactic%20for%20unions%2C%20intersections/near/214445215" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Tactic.20for.20unions.2C.20intersections.html#214445215">(Oct 24 2020 at 19:34)</a>:</h4>
<p>I would argue that one should prioritize speed of human comprehension over speed of computer comprehension, and writing <code>by finish</code> for a trivial lemma is the right way to get human comprehension!</p>



<a name="214445290"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Tactic%20for%20unions%2C%20intersections/near/214445290" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kyle Miller <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Tactic.20for.20unions.2C.20intersections.html#214445290">(Oct 24 2020 at 19:36)</a>:</h4>
<p>I wonder if the lemmas in the <code>simp only</code> proof I gave should be added to <code>mfld_set_tac</code> (I've never used this tactic,  so I don't know if that's in scope)</p>



<a name="214445379"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Tactic%20for%20unions%2C%20intersections/near/214445379" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kyle Miller <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Tactic.20for.20unions.2C.20intersections.html#214445379">(Oct 24 2020 at 19:38)</a>:</h4>
<p>Also, you might consider the <code>simp only</code> proof because it says "this lemma follows by commutativity of unions and intersections", is only one line, and appears to be orders of magnitude faster than <code>finish</code>. (But like <span class="user-mention" data-user-id="260507">@Heather Macbeth</span>  says, writing <code>by finish</code> is a great way to say "the proof is trivial"! <span aria-label="smile" class="emoji emoji-1f642" role="img" title="smile">:smile:</span>)</p>



<a name="214445485"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Tactic%20for%20unions%2C%20intersections/near/214445485" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bjørn Kjos-Hanssen <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Tactic.20for.20unions.2C.20intersections.html#214445485">(Oct 24 2020 at 19:41)</a>:</h4>
<p>Hmm... I wrote an even longer proof for <code>(X \ Y) ∪ (Y \ Z) ∪ (Z \ X) = (X ∪ Y ∪ Z) \ (X ∩ Y ∩ Z)</code>, for that one <code>finish</code> is not enough...</p>



<a name="214445492"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Tactic%20for%20unions%2C%20intersections/near/214445492" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Tactic.20for.20unions.2C.20intersections.html#214445492">(Oct 24 2020 at 19:41)</a>:</h4>
<p>tidy?</p>



<a name="214445576"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Tactic%20for%20unions%2C%20intersections/near/214445576" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kyle Miller <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Tactic.20for.20unions.2C.20intersections.html#214445576">(Oct 24 2020 at 19:43)</a>:</h4>
<p><code>ext, simp, tauto!</code> works</p>



<a name="214445582"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Tactic%20for%20unions%2C%20intersections/near/214445582" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Tactic.20for.20unions.2C.20intersections.html#214445582">(Oct 24 2020 at 19:43)</a>:</h4>
<p>There doesn't seem to be a <code>comm_ring</code> instance on <code>boolean_algebra</code>.  But if there were, would <code>by ring</code> solve this?</p>



<a name="214445593"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Tactic%20for%20unions%2C%20intersections/near/214445593" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Tactic.20for.20unions.2C.20intersections.html#214445593">(Oct 24 2020 at 19:43)</a>:</h4>
<p>It should!</p>



<a name="214445607"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Tactic%20for%20unions%2C%20intersections/near/214445607" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Tactic.20for.20unions.2C.20intersections.html#214445607">(Oct 24 2020 at 19:43)</a>:</h4>
<p><span class="user-mention silent" data-user-id="306601">Kyle Miller</span> <a href="#narrow/stream/217875-Is-there.20code.20for.20X.3F/topic/Tactic.20for.20unions.2C.20intersections/near/214445576">said</a>:</p>
<blockquote>
<p><code>ext, simp, tauto!</code> works</p>
</blockquote>
<p>nonterminal simp! :(</p>



<a name="214445658"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Tactic%20for%20unions%2C%20intersections/near/214445658" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kyle Miller <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Tactic.20for.20unions.2C.20intersections.html#214445658">(Oct 24 2020 at 19:44)</a>:</h4>
<p>It's left as an exercise to the reader to <code>squeeze_simp</code> <span aria-label="smile" class="emoji emoji-1f642" role="img" title="smile">:smile:</span></p>



<a name="214445706"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Tactic%20for%20unions%2C%20intersections/near/214445706" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Tactic.20for.20unions.2C.20intersections.html#214445706">(Oct 24 2020 at 19:45)</a>:</h4>
<p>I am introducing an alternate meaning of the emoji <span aria-label="pray" class="emoji emoji-1f64f" role="img" title="pray">:pray:</span> to refer to squeezing :)</p>



<a name="214445778"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Tactic%20for%20unions%2C%20intersections/near/214445778" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bjørn Kjos-Hanssen <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Tactic.20for.20unions.2C.20intersections.html#214445778">(Oct 24 2020 at 19:46)</a>:</h4>
<p>I guess it's too much to ask for a tactic proof of <code>|X\Y| + |Y\Z| + |Z\X| = |X\Z| + |Z\Y| + |Y\X|</code>? (where <code>|X|</code> is a <code>local notation</code> for <code>X.card</code>) <span aria-label="pray" class="emoji emoji-1f64f" role="img" title="pray">:pray:</span> I wrote a very long proof of that...</p>



<a name="214445798"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Tactic%20for%20unions%2C%20intersections/near/214445798" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Tactic.20for.20unions.2C.20intersections.html#214445798">(Oct 24 2020 at 19:47)</a>:</h4>
<p>There was an oddly similar question discussed here before</p>



<a name="214446056"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Tactic%20for%20unions%2C%20intersections/near/214446056" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Tactic.20for.20unions.2C.20intersections.html#214446056">(Oct 24 2020 at 19:53)</a>:</h4>
<p>I can't figure out how to search for it but it was to prove that <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">[</mo><mi>a</mi><mo separator="true">,</mo><mi>b</mi><mo stretchy="false">)</mo><mo>∪</mo><mo stretchy="false">[</mo><mi>b</mi><mo separator="true">,</mo><mi>c</mi><mo stretchy="false">)</mo><mo>∪</mo><mo stretchy="false">[</mo><mi>c</mi><mo separator="true">,</mo><mi>a</mi><mo stretchy="false">)</mo><mo>=</mo><mo stretchy="false">[</mo><mi>a</mi><mo separator="true">,</mo><mi>c</mi><mo stretchy="false">)</mo><mo>∪</mo><mo stretchy="false">[</mo><mi>b</mi><mo separator="true">,</mo><mi>a</mi><mo stretchy="false">)</mo><mo>∪</mo><mo stretchy="false">[</mo><mi>c</mi><mo separator="true">,</mo><mi>b</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">[a, b) \cup [b, c) \cup [c, a) = [a, c) \cup [b, a) \cup [c, b)</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord mathnormal">a</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal">b</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">∪</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord mathnormal">b</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal">c</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">∪</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord mathnormal">c</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal">a</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord mathnormal">a</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal">c</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">∪</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord mathnormal">b</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal">a</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">∪</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord mathnormal">c</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal">b</span><span class="mclose">)</span></span></span></span></p>



<a name="214446152"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Tactic%20for%20unions%2C%20intersections/near/214446152" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bjørn Kjos-Hanssen <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Tactic.20for.20unions.2C.20intersections.html#214446152">(Oct 24 2020 at 19:55)</a>:</h4>
<p>Sort of similar... although that one generalizes to n&gt;3, whereas mine doesn't readily.</p>



<a name="214446203"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Tactic%20for%20unions%2C%20intersections/near/214446203" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Tactic.20for.20unions.2C.20intersections.html#214446203">(Oct 24 2020 at 19:56)</a>:</h4>
<p>Right, because there is a multiplicity problem.</p>



<a name="214446309"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Tactic%20for%20unions%2C%20intersections/near/214446309" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Tactic.20for.20unions.2C.20intersections.html#214446309">(Oct 24 2020 at 19:58)</a>:</h4>
<p>Wait, isn't yours also true for n&gt;3 (if we use one cyclic order and the reverse cyclic order)?<br>
But it's no longer "equivalent" to the interval version</p>



<a name="214446575"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Tactic%20for%20unions%2C%20intersections/near/214446575" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Tactic.20for.20unions.2C.20intersections.html#214446575">(Oct 24 2020 at 20:03)</a>:</h4>
<p>Why isn't there a comm_ring instance on <code>set X</code>?</p>



<a name="214446651"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Tactic%20for%20unions%2C%20intersections/near/214446651" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Tactic.20for.20unions.2C.20intersections.html#214446651">(Oct 24 2020 at 20:04)</a>:</h4>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.24999999999999992em" columnalign="right left" columnspacing="0em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><munder><mo>∑</mo><mrow><mi>i</mi><mo>∈</mo><mi mathvariant="double-struck">Z</mi><mi mathvariant="normal">/</mi><mn>3</mn></mrow></munder><msub><mi>χ</mi><msub><mi>X</mi><mi>i</mi></msub></msub><mo stretchy="false">(</mo><mn>1</mn><mo>−</mo><msub><mi>χ</mi><msub><mi>X</mi><mrow><mi>i</mi><mo>+</mo><mn>1</mn></mrow></msub></msub><mo stretchy="false">)</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mo>∑</mo><msub><mi>χ</mi><msub><mi>X</mi><mi>i</mi></msub></msub><mo>−</mo><mo>∑</mo><msub><mi>χ</mi><msub><mi>X</mi><mi>i</mi></msub></msub><msub><mi>χ</mi><msub><mi>X</mi><mrow><mi>i</mi><mo>+</mo><mn>1</mn></mrow></msub></msub></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mo>∑</mo><msub><mi>χ</mi><msub><mi>X</mi><mi>i</mi></msub></msub><mo>−</mo><mo>∑</mo><msub><mi>χ</mi><msub><mi>X</mi><mi>i</mi></msub></msub><msub><mi>χ</mi><msub><mi>X</mi><mrow><mi>i</mi><mo>−</mo><mn>1</mn></mrow></msub></msub></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><munder><mo>∑</mo><mrow><mi>i</mi><mo>∈</mo><mi mathvariant="double-struck">Z</mi><mi mathvariant="normal">/</mi><mn>3</mn></mrow></munder><msub><mi>χ</mi><msub><mi>X</mi><mi>i</mi></msub></msub><mo stretchy="false">(</mo><mn>1</mn><mo>−</mo><msub><mi>χ</mi><msub><mi>X</mi><mrow><mi>i</mi><mo>−</mo><mn>1</mn></mrow></msub></msub><mo stretchy="false">)</mo></mrow></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{aligned}
\sum_{i\in \mathbb{Z}/3}\chi_{X_i}(1-\chi_{X_{i+1}})
&amp;=\sum\chi_{X_i}-\sum\chi_{X_i}\chi_{X_{i+1}}\\
&amp;=\sum\chi_{X_i}-\sum\chi_{X_i}\chi_{X_{i-1}}\\
&amp;=\sum_{i\in \mathbb{Z}/3}\chi_{X_i}(1-\chi_{X_{i-1}})
\end{aligned}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:7.632029999999999em;vertical-align:-3.5660149999999993em;"></span><span class="mord"><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:4.066015em;"><span style="top:-6.066015em;"><span class="pstrut" style="height:3.050005em;"></span><span class="mord"><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.050005em;"><span style="top:-1.808995em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">∈</span><span class="mord mtight"><span class="mord mathbb mtight">Z</span></span><span class="mord mtight">/</span><span class="mord mtight">3</span></span></span></span><span style="top:-3.0500049999999996em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">∑</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.516005em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal">χ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3280857142857143em;"><span style="top:-2.357em;margin-left:-0.07847em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2501em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathnormal">χ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.328331em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32808571428571426em;"><span style="top:-2.357em;margin-left:-0.07847em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.20252142857142857em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.291765em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span><span style="top:-3.2000100000000002em;"><span class="pstrut" style="height:3.050005em;"></span><span class="mord"></span></span><span style="top:-1.299995000000001em;"><span class="pstrut" style="height:3.050005em;"></span><span class="mord"></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:3.5660149999999993em;"><span></span></span></span></span></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:4.066015em;"><span style="top:-6.066015em;"><span class="pstrut" style="height:3.050005em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mop op-symbol large-op" style="position:relative;top:-0.000004999999999977245em;">∑</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal">χ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3280857142857143em;"><span style="top:-2.357em;margin-left:-0.07847em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2501em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mop op-symbol large-op" style="position:relative;top:-0.000004999999999977245em;">∑</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal">χ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3280857142857143em;"><span style="top:-2.357em;margin-left:-0.07847em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2501em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">χ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.328331em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32808571428571426em;"><span style="top:-2.357em;margin-left:-0.07847em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.20252142857142857em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.291765em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.2000100000000002em;"><span class="pstrut" style="height:3.050005em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mop op-symbol large-op" style="position:relative;top:-0.000004999999999977245em;">∑</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal">χ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3280857142857143em;"><span style="top:-2.357em;margin-left:-0.07847em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2501em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mop op-symbol large-op" style="position:relative;top:-0.000004999999999977245em;">∑</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal">χ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3280857142857143em;"><span style="top:-2.357em;margin-left:-0.07847em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2501em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">χ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.328331em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32808571428571426em;"><span style="top:-2.357em;margin-left:-0.07847em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.20252142857142857em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.291765em;"><span></span></span></span></span></span></span></span></span><span style="top:-1.299995000000001em;"><span class="pstrut" style="height:3.050005em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.050005em;"><span style="top:-1.808995em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">∈</span><span class="mord mtight"><span class="mord mathbb mtight">Z</span></span><span class="mord mtight">/</span><span class="mord mtight">3</span></span></span></span><span style="top:-3.0500049999999996em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">∑</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.516005em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal">χ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3280857142857143em;"><span style="top:-2.357em;margin-left:-0.07847em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2501em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathnormal">χ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.328331em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32808571428571426em;"><span style="top:-2.357em;margin-left:-0.07847em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.20252142857142857em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.291765em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:3.5660149999999993em;"><span></span></span></span></span></span></span></span></span></span></span></span></p>



<a name="214446881"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Tactic%20for%20unions%2C%20intersections/near/214446881" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Tactic.20for.20unions.2C.20intersections.html#214446881">(Oct 24 2020 at 20:09)</a>:</h4>
<p>and maybe the above can be automated after rewriting using <a href="https://leanprover-community.github.io/mathlib_docs/find/set.indicator_finset_sum">docs#set.indicator_finset_sum</a></p>



<a name="214447283"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Tactic%20for%20unions%2C%20intersections/near/214447283" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bjørn Kjos-Hanssen <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Tactic.20for.20unions.2C.20intersections.html#214447283">(Oct 24 2020 at 20:16)</a>:</h4>
<p>Oh right, <span class="user-mention" data-user-id="110032">@Reid Barton</span> <span class="user-mention" data-user-id="260507">@Heather Macbeth</span>  , it just doesn't have the internal version like <code>(X ∪ Y ∪ Z) \ (X ∩ Y ∩ Z)</code></p>



<a name="214447915"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Tactic%20for%20unions%2C%20intersections/near/214447915" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kyle Miller <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Tactic.20for.20unions.2C.20intersections.html#214447915">(Oct 24 2020 at 20:31)</a>:</h4>
<p>A slow proof:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">data.finset.basic</span>
<span class="kn">import</span> <span class="n">algebra.big_operators.basic</span>

<span class="n">open_locale</span> <span class="n">big_operators</span>
<span class="kn">open</span> <span class="n">finset</span>

<span class="kd">variables</span> <span class="o">{</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">decidable_eq</span> <span class="n">α</span><span class="o">]</span>

<span class="kd">def</span> <span class="n">indicate</span> <span class="o">(</span><span class="n">X</span> <span class="o">:</span> <span class="n">finset</span> <span class="n">α</span><span class="o">)</span> <span class="o">:</span> <span class="n">α</span> <span class="bp">→</span> <span class="n">ℕ</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">x</span><span class="o">,</span> <span class="k">if</span> <span class="n">x</span> <span class="bp">∈</span> <span class="n">X</span> <span class="k">then</span> <span class="mi">1</span> <span class="k">else</span> <span class="mi">0</span>
<span class="kd">def</span> <span class="n">count</span> <span class="o">(</span><span class="n">X</span> <span class="n">Y</span> <span class="n">Z</span> <span class="o">:</span> <span class="n">finset</span> <span class="n">α</span><span class="o">)</span> <span class="o">:</span> <span class="n">α</span> <span class="bp">→</span> <span class="n">ℕ</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">x</span><span class="o">,</span> <span class="n">indicate</span> <span class="o">(</span><span class="n">X</span> <span class="bp">\</span> <span class="n">Y</span><span class="o">)</span> <span class="n">x</span> <span class="bp">+</span> <span class="n">indicate</span> <span class="o">(</span><span class="n">Y</span> <span class="bp">\</span> <span class="n">Z</span><span class="o">)</span> <span class="n">x</span> <span class="bp">+</span> <span class="n">indicate</span> <span class="o">(</span><span class="n">Z</span> <span class="bp">\</span> <span class="n">X</span><span class="o">)</span> <span class="n">x</span>

<span class="kd">lemma</span> <span class="n">count_eq</span> <span class="o">(</span><span class="n">X</span> <span class="n">Y</span> <span class="n">Z</span> <span class="o">:</span> <span class="n">finset</span> <span class="n">α</span><span class="o">)</span> <span class="o">:</span> <span class="n">count</span> <span class="n">X</span> <span class="n">Y</span> <span class="n">Z</span> <span class="bp">=</span> <span class="n">count</span> <span class="n">X</span> <span class="n">Z</span> <span class="n">Y</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="n">ext</span> <span class="n">x</span><span class="o">,</span>
  <span class="n">dsimp</span> <span class="o">[</span><span class="n">count</span><span class="o">,</span> <span class="n">indicate</span><span class="o">],</span>
  <span class="n">simp</span> <span class="n">only</span> <span class="o">[</span><span class="n">mem_sdiff</span><span class="o">],</span>
  <span class="n">by_cases</span> <span class="n">hx</span> <span class="o">:</span> <span class="n">x</span> <span class="bp">∈</span> <span class="n">X</span><span class="bp">;</span> <span class="n">simp</span> <span class="o">[</span><span class="n">hx</span><span class="o">]</span><span class="bp">;</span> <span class="n">by_cases</span> <span class="n">hy</span> <span class="o">:</span> <span class="n">x</span> <span class="bp">∈</span> <span class="n">Y</span><span class="bp">;</span> <span class="n">simp</span> <span class="o">[</span><span class="n">hy</span><span class="o">]</span><span class="bp">;</span> <span class="n">by_cases</span> <span class="n">hz</span> <span class="o">:</span> <span class="n">x</span> <span class="bp">∈</span> <span class="n">Z</span><span class="bp">;</span> <span class="n">simp</span> <span class="o">[</span><span class="n">hz</span><span class="o">],</span>
<span class="kd">end</span>

<span class="kd">lemma</span> <span class="n">card_rot</span> <span class="o">(</span><span class="n">X</span> <span class="n">Y</span> <span class="n">Z</span> <span class="o">:</span> <span class="n">finset</span> <span class="n">α</span><span class="o">)</span> <span class="o">:</span> <span class="n">card</span> <span class="o">(</span><span class="n">X</span> <span class="bp">\</span> <span class="n">Y</span><span class="o">)</span> <span class="bp">+</span> <span class="n">card</span> <span class="o">(</span><span class="n">Y</span> <span class="bp">\</span> <span class="n">Z</span><span class="o">)</span> <span class="bp">+</span> <span class="n">card</span> <span class="o">(</span><span class="n">Z</span> <span class="bp">\</span> <span class="n">X</span><span class="o">)</span> <span class="bp">=</span> <span class="n">card</span> <span class="o">(</span><span class="n">X</span> <span class="bp">\</span> <span class="n">Z</span><span class="o">)</span> <span class="bp">+</span> <span class="n">card</span> <span class="o">(</span><span class="n">Z</span> <span class="bp">\</span> <span class="n">Y</span><span class="o">)</span> <span class="bp">+</span> <span class="n">card</span> <span class="o">(</span><span class="n">Y</span> <span class="bp">\</span> <span class="n">X</span><span class="o">)</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="k">have</span> <span class="n">key</span> <span class="o">:</span> <span class="bp">∑</span> <span class="n">x</span> <span class="k">in</span> <span class="n">X</span> <span class="bp">∪</span> <span class="n">Y</span> <span class="bp">∪</span> <span class="n">Z</span><span class="o">,</span> <span class="n">count</span> <span class="n">X</span> <span class="n">Y</span> <span class="n">Z</span> <span class="n">x</span> <span class="bp">=</span> <span class="bp">∑</span> <span class="n">x</span> <span class="k">in</span> <span class="n">X</span> <span class="bp">∪</span> <span class="n">Y</span> <span class="bp">∪</span> <span class="n">Z</span><span class="o">,</span> <span class="n">count</span> <span class="n">X</span> <span class="n">Z</span> <span class="n">Y</span> <span class="n">x</span><span class="o">,</span>
  <span class="o">{</span> <span class="n">simp</span> <span class="n">only</span> <span class="o">[</span><span class="n">count_eq</span><span class="o">]</span> <span class="o">},</span>
  <span class="n">dsimp</span> <span class="o">[</span><span class="n">count</span><span class="o">,</span> <span class="n">indicate</span><span class="o">]</span> <span class="n">at</span> <span class="n">key</span><span class="o">,</span>
  <span class="n">simp</span> <span class="n">only</span> <span class="o">[</span><span class="n">sum_add_distrib</span><span class="o">]</span> <span class="n">at</span> <span class="n">key</span><span class="o">,</span>
  <span class="n">simp</span> <span class="n">only</span> <span class="o">[</span><span class="bp">←</span><span class="n">sum_filter</span><span class="o">]</span> <span class="n">at</span> <span class="n">key</span><span class="o">,</span>
  <span class="n">simp</span> <span class="n">only</span> <span class="o">[</span><span class="n">sum_const</span><span class="o">,</span> <span class="n">nsmul_eq_mul</span><span class="o">,</span> <span class="n">mul_one</span><span class="o">,</span> <span class="n">nat.cast_id</span><span class="o">]</span> <span class="n">at</span> <span class="n">key</span><span class="o">,</span>
  <span class="n">convert</span> <span class="n">key</span><span class="bp">;</span> <span class="n">ext</span><span class="bp">;</span> <span class="n">simp</span> <span class="n">only</span> <span class="o">[</span><span class="n">mem_union</span><span class="o">,</span> <span class="n">mem_filter</span><span class="o">,</span> <span class="n">mem_sdiff</span><span class="o">,</span> <span class="n">union_assoc</span><span class="o">]</span><span class="bp">;</span> <span class="n">tauto</span><span class="bp">!</span><span class="o">,</span>
<span class="kd">end</span>
</code></pre></div>



<a name="214449004"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Tactic%20for%20unions%2C%20intersections/near/214449004" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kyle Miller <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Tactic.20for.20unions.2C.20intersections.html#214449004">(Oct 24 2020 at 20:54)</a>:</h4>
<p>A more satisfying proof:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">data.finset.basic</span>

<span class="kn">open</span> <span class="n">finset</span>

<span class="kd">variables</span> <span class="o">{</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">decidable_eq</span> <span class="n">α</span><span class="o">]</span>

<span class="kd">lemma</span> <span class="n">disj₁</span> <span class="o">(</span><span class="n">X</span> <span class="n">Y</span> <span class="n">Z</span> <span class="o">:</span> <span class="n">finset</span> <span class="n">α</span><span class="o">)</span> <span class="o">:</span> <span class="n">disjoint</span> <span class="o">((</span><span class="n">X</span> <span class="bp">\</span> <span class="n">Y</span><span class="o">)</span> <span class="bp">∪</span> <span class="o">(</span><span class="n">Y</span> <span class="bp">\</span> <span class="n">Z</span><span class="o">))</span> <span class="o">(</span><span class="n">Z</span> <span class="bp">\</span> <span class="n">X</span><span class="o">)</span> <span class="o">:=</span>
<span class="kd">by</span> <span class="o">{</span> <span class="n">rw</span> <span class="n">disjoint_iff</span><span class="o">,</span> <span class="n">ext</span><span class="o">,</span> <span class="n">simp</span> <span class="n">only</span> <span class="o">[</span><span class="n">mem_union</span><span class="o">,</span> <span class="n">mem_sdiff</span><span class="o">,</span> <span class="n">inf_eq_inter</span><span class="o">,</span> <span class="n">mem_inter</span><span class="o">],</span> <span class="n">tauto</span><span class="bp">!</span> <span class="o">}</span>

<span class="kd">lemma</span> <span class="n">disj₂</span> <span class="o">(</span><span class="n">X</span> <span class="n">Y</span> <span class="n">Z</span> <span class="o">:</span> <span class="n">finset</span> <span class="n">α</span><span class="o">)</span> <span class="o">:</span> <span class="n">disjoint</span> <span class="o">(</span><span class="n">X</span> <span class="bp">\</span> <span class="n">Y</span><span class="o">)</span> <span class="o">(</span><span class="n">Y</span> <span class="bp">\</span> <span class="n">Z</span><span class="o">)</span> <span class="o">:=</span>
<span class="kd">by</span> <span class="o">{</span> <span class="n">rw</span> <span class="n">disjoint_iff</span><span class="o">,</span> <span class="n">ext</span><span class="o">,</span> <span class="n">simp</span> <span class="n">only</span> <span class="o">[</span><span class="n">mem_sdiff</span><span class="o">,</span> <span class="n">inf_eq_inter</span><span class="o">,</span> <span class="n">mem_inter</span><span class="o">],</span> <span class="n">tauto</span><span class="bp">!</span> <span class="o">}</span>

<span class="kd">lemma</span> <span class="n">union_rot_sdiff</span> <span class="o">(</span><span class="n">X</span> <span class="n">Y</span> <span class="n">Z</span> <span class="o">:</span> <span class="n">finset</span> <span class="n">α</span><span class="o">)</span> <span class="o">:</span> <span class="o">(</span><span class="n">X</span> <span class="bp">\</span> <span class="n">Y</span><span class="o">)</span> <span class="bp">∪</span> <span class="o">(</span><span class="n">Y</span> <span class="bp">\</span> <span class="n">Z</span><span class="o">)</span> <span class="bp">∪</span> <span class="o">(</span><span class="n">Z</span> <span class="bp">\</span> <span class="n">X</span><span class="o">)</span> <span class="bp">=</span> <span class="o">(</span><span class="n">X</span> <span class="bp">\</span> <span class="n">Z</span><span class="o">)</span> <span class="bp">∪</span> <span class="o">(</span><span class="n">Z</span> <span class="bp">\</span> <span class="n">Y</span><span class="o">)</span> <span class="bp">∪</span> <span class="o">(</span><span class="n">Y</span> <span class="bp">\</span> <span class="n">X</span><span class="o">)</span> <span class="o">:=</span>
<span class="kd">by</span> <span class="o">{</span> <span class="n">ext</span><span class="o">,</span> <span class="n">simp</span> <span class="n">only</span> <span class="o">[</span><span class="n">mem_union</span><span class="o">,</span> <span class="n">mem_sdiff</span><span class="o">,</span> <span class="n">union_assoc</span><span class="o">],</span> <span class="n">tauto</span><span class="bp">!</span> <span class="o">}</span>

<span class="kd">lemma</span> <span class="n">card_rot</span> <span class="o">(</span><span class="n">X</span> <span class="n">Y</span> <span class="n">Z</span> <span class="o">:</span> <span class="n">finset</span> <span class="n">α</span><span class="o">)</span> <span class="o">:</span> <span class="n">card</span> <span class="o">(</span><span class="n">X</span> <span class="bp">\</span> <span class="n">Y</span><span class="o">)</span> <span class="bp">+</span> <span class="n">card</span> <span class="o">(</span><span class="n">Y</span> <span class="bp">\</span> <span class="n">Z</span><span class="o">)</span> <span class="bp">+</span> <span class="n">card</span> <span class="o">(</span><span class="n">Z</span> <span class="bp">\</span> <span class="n">X</span><span class="o">)</span> <span class="bp">=</span> <span class="n">card</span> <span class="o">(</span><span class="n">X</span> <span class="bp">\</span> <span class="n">Z</span><span class="o">)</span> <span class="bp">+</span> <span class="n">card</span> <span class="o">(</span><span class="n">Z</span> <span class="bp">\</span> <span class="n">Y</span><span class="o">)</span> <span class="bp">+</span> <span class="n">card</span> <span class="o">(</span><span class="n">Y</span> <span class="bp">\</span> <span class="n">X</span><span class="o">)</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="k">have</span> <span class="n">key</span> <span class="o">:=</span> <span class="n">congr_arg</span> <span class="n">card</span> <span class="o">(</span><span class="n">union_rot_sdiff</span> <span class="n">X</span> <span class="n">Y</span> <span class="n">Z</span><span class="o">),</span>
  <span class="n">rwa</span> <span class="o">[</span><span class="n">card_disjoint_union</span> <span class="o">(</span><span class="n">disj₁</span> <span class="n">X</span> <span class="n">Y</span> <span class="n">Z</span><span class="o">),</span> <span class="n">card_disjoint_union</span> <span class="o">(</span><span class="n">disj₁</span> <span class="n">X</span> <span class="n">Z</span> <span class="n">Y</span><span class="o">),</span>
       <span class="n">card_disjoint_union</span> <span class="o">(</span><span class="n">disj₂</span> <span class="n">X</span> <span class="n">Y</span> <span class="n">Z</span><span class="o">),</span> <span class="n">card_disjoint_union</span> <span class="o">(</span><span class="n">disj₂</span> <span class="n">X</span> <span class="n">Z</span> <span class="n">Y</span><span class="o">)]</span> <span class="n">at</span> <span class="n">key</span><span class="o">,</span>
<span class="kd">end</span>
</code></pre></div>



<a name="214450171"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Tactic%20for%20unions%2C%20intersections/near/214450171" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bjørn Kjos-Hanssen <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Tactic.20for.20unions.2C.20intersections.html#214450171">(Oct 24 2020 at 21:20)</a>:</h4>
<p>These are great <span class="user-mention" data-user-id="306601">@Kyle Miller</span>  ... I guess the second one has fewer exotic imports</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>