---
layout: archive
title: Zulip Chat Archive
permalink: /stream/217875-Is-there-code-for-X%3F/topic/Reindexing.20a.20dependent.20product.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/index.html">Is there code for X?</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Reindexing.20a.20dependent.20product.html">Reindexing a dependent product</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="262321296"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Reindexing%20a%20dependent%20product/near/262321296" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Oliver Nash <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Reindexing.20a.20dependent.20product.html#262321296">(Nov 22 2021 at 13:57)</a>:</h4>
<p>I've tripped up on an extremely elementary type theory issue and would appreciate some help.</p>



<a name="262321399"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Reindexing%20a%20dependent%20product/near/262321399" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Oliver Nash <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Reindexing.20a.20dependent.20product.html#262321399">(Nov 22 2021 at 13:58)</a>:</h4>
<p>How can I close the <code>sorry</code>s in the following:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">data.equiv.basic</span>

<span class="kd">def</span> <span class="n">foo</span> <span class="o">{</span><span class="n">ι</span> <span class="n">ι'</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">(</span><span class="n">σ</span> <span class="o">:</span> <span class="n">ι</span> <span class="bp">≃</span> <span class="n">ι'</span><span class="o">)</span> <span class="o">(</span><span class="n">α</span> <span class="o">:</span> <span class="n">ι</span> <span class="bp">→</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">(</span><span class="n">α'</span> <span class="o">:</span> <span class="n">ι'</span> <span class="bp">→</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span>
  <span class="o">(</span><span class="n">e</span> <span class="o">:</span> <span class="bp">∀</span> <span class="o">⦃</span><span class="n">i</span> <span class="n">j</span><span class="o">⦄,</span> <span class="n">σ</span> <span class="n">i</span> <span class="bp">=</span> <span class="n">j</span> <span class="bp">→</span> <span class="n">α</span> <span class="n">i</span> <span class="bp">≃</span> <span class="n">α'</span> <span class="n">j</span><span class="o">)</span> <span class="o">:</span> <span class="o">(</span><span class="bp">Π</span> <span class="n">i</span><span class="o">,</span> <span class="n">α</span> <span class="n">i</span><span class="o">)</span> <span class="bp">≃</span> <span class="bp">Π</span> <span class="n">i'</span><span class="o">,</span> <span class="n">α'</span> <span class="n">i'</span> <span class="o">:=</span>
<span class="o">{</span> <span class="n">to_fun</span>    <span class="o">:=</span> <span class="bp">λ</span> <span class="n">f</span> <span class="n">i'</span><span class="o">,</span> <span class="n">e</span> <span class="o">(</span><span class="n">σ.apply_symm_apply</span> <span class="n">i'</span><span class="o">)</span> <span class="bp">$</span> <span class="n">f</span> <span class="bp">$</span> <span class="n">σ.symm</span> <span class="n">i'</span><span class="o">,</span>
  <span class="n">inv_fun</span>   <span class="o">:=</span> <span class="bp">λ</span> <span class="n">F</span> <span class="n">i</span><span class="o">,</span> <span class="o">(</span><span class="n">e</span> <span class="n">rfl</span><span class="o">)</span><span class="bp">.</span><span class="n">symm</span> <span class="bp">$</span> <span class="n">F</span> <span class="bp">$</span> <span class="n">σ</span> <span class="n">i</span><span class="o">,</span>
  <span class="n">left_inv</span>  <span class="o">:=</span> <span class="bp">λ</span> <span class="n">f</span><span class="o">,</span> <span class="kd">by</span> <span class="o">{</span> <span class="n">ext</span> <span class="n">i</span><span class="o">,</span> <span class="n">simp</span> <span class="n">only</span><span class="o">,</span> <span class="gr">sorry</span><span class="o">,</span> <span class="o">},</span> <span class="c1">-- stuck because `α i` is different type to `α (σ.symm (σ i))`</span>
  <span class="n">right_inv</span> <span class="o">:=</span> <span class="gr">sorry</span><span class="o">,</span> <span class="o">}</span>
</code></pre></div>



<a name="262321433"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Reindexing%20a%20dependent%20product/near/262321433" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Oliver Nash <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Reindexing.20a.20dependent.20product.html#262321433">(Nov 22 2021 at 13:58)</a>:</h4>
<p>(It's likely this exists somewhere in Mathlib but I couldn't find it.)</p>



<a name="262322294"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Reindexing%20a%20dependent%20product/near/262322294" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Oliver Nash <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Reindexing.20a.20dependent.20product.html#262322294">(Nov 22 2021 at 14:04)</a>:</h4>
<p>Ah, this is basically <a href="https://leanprover-community.github.io/mathlib_docs/find/equiv.Pi_congr">docs#equiv.Pi_congr</a></p>



<a name="262322299"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Reindexing%20a%20dependent%20product/near/262322299" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Oliver Nash <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Reindexing.20a.20dependent.20product.html#262322299">(Nov 22 2021 at 14:04)</a>:</h4>
<p>Sorry for the noise.</p>



<a name="262352108"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Reindexing%20a%20dependent%20product/near/262352108" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kyle Miller <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Reindexing.20a.20dependent.20product.html#262352108">(Nov 22 2021 at 17:36)</a>:</h4>
<p>Just to share tips for how to bash through these sorts of dependent type issues, I've learned about how <code>generalize</code>, <code>generalize_proofs</code>, and <code>revert</code> can be very helpful.  The strategy is to try to generalize things until the goal is completely parameterized (make it be universally quantified over everything in sight that's causing you problems) and then try to use the hypotheses to do substitutions.  Then you can usually figure out what technical lemma you should write.</p>
<p>Doing the first part of this for the first sorry:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">def</span> <span class="n">foo</span> <span class="o">{</span><span class="n">ι</span> <span class="n">ι'</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">(</span><span class="n">σ</span> <span class="o">:</span> <span class="n">ι</span> <span class="bp">≃</span> <span class="n">ι'</span><span class="o">)</span> <span class="o">(</span><span class="n">α</span> <span class="o">:</span> <span class="n">ι</span> <span class="bp">→</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">(</span><span class="n">α'</span> <span class="o">:</span> <span class="n">ι'</span> <span class="bp">→</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span>
  <span class="o">(</span><span class="n">e</span> <span class="o">:</span> <span class="bp">Π</span> <span class="o">⦃</span><span class="n">i</span> <span class="n">j</span><span class="o">⦄,</span> <span class="n">σ</span> <span class="n">i</span> <span class="bp">=</span> <span class="n">j</span> <span class="bp">→</span> <span class="n">α</span> <span class="n">i</span> <span class="bp">≃</span> <span class="n">α'</span> <span class="n">j</span><span class="o">)</span> <span class="o">:</span> <span class="o">(</span><span class="bp">Π</span> <span class="n">i</span><span class="o">,</span> <span class="n">α</span> <span class="n">i</span><span class="o">)</span> <span class="bp">≃</span> <span class="bp">Π</span> <span class="n">i'</span><span class="o">,</span> <span class="n">α'</span> <span class="n">i'</span> <span class="o">:=</span>
<span class="o">{</span> <span class="n">to_fun</span>    <span class="o">:=</span> <span class="bp">λ</span> <span class="n">f</span> <span class="n">i'</span><span class="o">,</span> <span class="n">e</span> <span class="o">(</span><span class="n">σ.apply_symm_apply</span> <span class="n">i'</span><span class="o">)</span> <span class="bp">$</span> <span class="n">f</span> <span class="bp">$</span> <span class="n">σ.symm</span> <span class="n">i'</span><span class="o">,</span>
  <span class="n">inv_fun</span>   <span class="o">:=</span> <span class="bp">λ</span> <span class="n">F</span> <span class="n">i</span><span class="o">,</span> <span class="o">(</span><span class="n">e</span> <span class="n">rfl</span><span class="o">)</span><span class="bp">.</span><span class="n">symm</span> <span class="bp">$</span> <span class="n">F</span> <span class="bp">$</span> <span class="n">σ</span> <span class="n">i</span><span class="o">,</span>
  <span class="n">left_inv</span>  <span class="o">:=</span> <span class="bp">λ</span> <span class="n">f</span><span class="o">,</span> <span class="kd">begin</span>
    <span class="n">ext</span> <span class="n">i</span><span class="o">,</span>
    <span class="n">simp</span> <span class="n">only</span><span class="o">,</span>
    <span class="n">rw</span> <span class="n">equiv.symm_apply_eq</span><span class="o">,</span>
    <span class="n">generalize</span> <span class="n">hy</span> <span class="o">:</span> <span class="n">f</span> <span class="o">(</span><span class="n">σ.symm</span> <span class="o">(</span><span class="n">σ</span> <span class="n">i</span><span class="o">))</span> <span class="bp">=</span> <span class="n">y</span><span class="o">,</span>
    <span class="n">generalize_proofs</span> <span class="n">ha</span> <span class="n">hb</span><span class="o">,</span>
    <span class="n">generalize</span> <span class="n">hy'</span> <span class="o">:</span> <span class="n">f</span> <span class="n">i</span> <span class="bp">=</span> <span class="n">y'</span><span class="o">,</span>
    <span class="n">revert</span> <span class="n">ha</span> <span class="n">hb</span> <span class="n">y</span> <span class="n">y'</span><span class="o">,</span>
    <span class="n">generalize</span> <span class="n">hi'</span> <span class="o">:</span> <span class="n">σ.symm</span> <span class="o">(</span><span class="n">σ</span> <span class="n">i</span><span class="o">)</span> <span class="bp">=</span> <span class="n">i'</span><span class="o">,</span>
    <span class="n">intro</span> <span class="n">ha</span><span class="o">,</span>
    <span class="n">rw</span> <span class="n">equiv.apply_eq_iff_eq</span> <span class="n">at</span> <span class="n">ha</span><span class="o">,</span>
    <span class="n">subst</span> <span class="n">ha</span><span class="o">,</span>
    <span class="n">rintros</span> <span class="n">_</span> <span class="n">y</span> <span class="n">y'</span> <span class="n">rfl</span> <span class="n">rfl</span><span class="o">,</span>
    <span class="n">refl</span><span class="o">,</span>
  <span class="kd">end</span><span class="o">,</span>
  <span class="n">right_inv</span> <span class="o">:=</span> <span class="gr">sorry</span><span class="o">,</span> <span class="o">}</span>
</code></pre></div>



<a name="262352364"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Reindexing%20a%20dependent%20product/near/262352364" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kyle Miller <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Reindexing.20a.20dependent.20product.html#262352364">(Nov 22 2021 at 17:38)</a>:</h4>
<p>Conceptually, this is a strategy to make it easier to do simultaneous rewrites, which you often need to do when you have dependent types.  It also helps make the goal more proof irrelevant -- you don't really want to be spending time rewriting things inside proofs.</p>



<a name="262352588"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Reindexing%20a%20dependent%20product/near/262352588" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Oliver Nash <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Reindexing.20a.20dependent.20product.html#262352588">(Nov 22 2021 at 17:40)</a>:</h4>
<p>Oh wow, thanks very much. I've spent the bulk of today fighting with the type system and nearly going mad. I need to go and organise dinner now but I'll try again this evening and see if I can get there with these tips.</p>



<a name="262353112"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Reindexing%20a%20dependent%20product/near/262353112" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Oliver Nash <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Reindexing.20a.20dependent.20product.html#262353112">(Nov 22 2021 at 17:45)</a>:</h4>
<p>I've reduced my goal to this (copied from context: typeclasses can be relaxed):</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">analysis.normed_space.multilinear</span>

<span class="kd">universes</span> <span class="n">u₁</span> <span class="n">u₂</span> <span class="n">u₃</span> <span class="n">u₄</span> <span class="n">u₅</span>

<span class="kd">variables</span> <span class="o">{</span><span class="n">ι</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u₁</span><span class="o">}</span> <span class="o">{</span><span class="bp">𝕜</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u₂</span><span class="o">}</span> <span class="o">{</span><span class="n">E</span> <span class="o">:</span> <span class="n">ι</span> <span class="bp">→</span> <span class="kt">Type</span> <span class="n">u₄</span><span class="o">}</span> <span class="o">{</span><span class="n">F</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u₃</span><span class="o">}</span>
<span class="kd">variables</span> <span class="o">[</span><span class="n">decidable_eq</span> <span class="n">ι</span><span class="o">]</span> <span class="o">[</span><span class="n">fintype</span> <span class="n">ι</span><span class="o">]</span> <span class="o">[</span><span class="n">nondiscrete_normed_field</span> <span class="bp">𝕜</span><span class="o">]</span>
<span class="kd">variables</span> <span class="o">[</span><span class="n">normed_group</span> <span class="n">F</span><span class="o">]</span> <span class="o">[</span><span class="n">normed_space</span> <span class="bp">𝕜</span> <span class="n">F</span><span class="o">]</span>
<span class="kd">variables</span> <span class="o">[</span><span class="bp">∀</span> <span class="n">i</span><span class="o">,</span> <span class="n">normed_group</span> <span class="o">(</span><span class="n">E</span> <span class="n">i</span><span class="o">)]</span> <span class="o">[</span><span class="bp">∀</span> <span class="n">i</span><span class="o">,</span> <span class="n">normed_space</span> <span class="bp">𝕜</span> <span class="o">(</span><span class="n">E</span> <span class="n">i</span><span class="o">)]</span>

<span class="kd">def</span> <span class="n">multilinear_map.dom_dom_congr_linear_equiv'</span> <span class="o">{</span><span class="n">ι'</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u₅</span><span class="o">}</span> <span class="o">[</span><span class="n">decidable_eq</span> <span class="n">ι'</span><span class="o">]</span> <span class="o">(</span><span class="n">σ</span> <span class="o">:</span> <span class="n">ι</span> <span class="bp">≃</span> <span class="n">ι'</span><span class="o">)</span>
  <span class="o">(</span><span class="n">E'</span> <span class="o">:</span> <span class="n">ι'</span> <span class="bp">→</span> <span class="kt">Type</span> <span class="n">u₄</span><span class="o">)</span> <span class="o">[</span><span class="bp">∀</span> <span class="n">i</span><span class="o">,</span> <span class="n">normed_group</span> <span class="o">(</span><span class="n">E'</span> <span class="n">i</span><span class="o">)]</span> <span class="o">[</span><span class="bp">∀</span> <span class="n">i</span><span class="o">,</span> <span class="n">normed_space</span> <span class="bp">𝕜</span> <span class="o">(</span><span class="n">E'</span> <span class="n">i</span><span class="o">)]</span>
  <span class="o">(</span><span class="n">e</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">i'</span><span class="o">,</span>  <span class="n">E</span> <span class="o">(</span><span class="n">σ.symm</span> <span class="n">i'</span><span class="o">)</span> <span class="bp">≃ₗ</span><span class="o">[</span><span class="bp">𝕜</span><span class="o">]</span> <span class="n">E'</span> <span class="n">i'</span><span class="o">)</span> <span class="o">:</span>
  <span class="n">multilinear_map</span> <span class="bp">𝕜</span> <span class="n">E</span> <span class="n">F</span> <span class="bp">≃ₗ</span><span class="o">[</span><span class="bp">𝕜</span><span class="o">]</span> <span class="n">multilinear_map</span> <span class="bp">𝕜</span> <span class="n">E'</span> <span class="n">F</span> <span class="o">:=</span>
<span class="gr">sorry</span>
</code></pre></div>
<p>It's somewhat maddening to have burned hours on something so vacuous (albeit I did gain some limited expertise with dependent functions).</p>



<a name="262353179"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Reindexing%20a%20dependent%20product/near/262353179" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kyle Miller <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Reindexing.20a.20dependent.20product.html#262353179">(Nov 22 2021 at 17:45)</a>:</h4>
<p>Here's a possible technical lemma for then dealing with the dependent rewrite:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">def</span> <span class="n">foo</span> <span class="o">{</span><span class="n">ι</span> <span class="n">ι'</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">(</span><span class="n">σ</span> <span class="o">:</span> <span class="n">ι</span> <span class="bp">≃</span> <span class="n">ι'</span><span class="o">)</span> <span class="o">(</span><span class="n">α</span> <span class="o">:</span> <span class="n">ι</span> <span class="bp">→</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">(</span><span class="n">α'</span> <span class="o">:</span> <span class="n">ι'</span> <span class="bp">→</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span>
  <span class="o">(</span><span class="n">e</span> <span class="o">:</span> <span class="bp">Π</span> <span class="o">⦃</span><span class="n">i</span> <span class="n">j</span><span class="o">⦄,</span> <span class="n">σ</span> <span class="n">i</span> <span class="bp">=</span> <span class="n">j</span> <span class="bp">→</span> <span class="n">α</span> <span class="n">i</span> <span class="bp">≃</span> <span class="n">α'</span> <span class="n">j</span><span class="o">)</span> <span class="o">:</span> <span class="o">(</span><span class="bp">Π</span> <span class="n">i</span><span class="o">,</span> <span class="n">α</span> <span class="n">i</span><span class="o">)</span> <span class="bp">≃</span> <span class="bp">Π</span> <span class="n">i'</span><span class="o">,</span> <span class="n">α'</span> <span class="n">i'</span> <span class="o">:=</span>
<span class="o">{</span> <span class="n">to_fun</span>    <span class="o">:=</span> <span class="bp">λ</span> <span class="n">f</span> <span class="n">i'</span><span class="o">,</span> <span class="n">e</span> <span class="o">(</span><span class="n">σ.apply_symm_apply</span> <span class="n">i'</span><span class="o">)</span> <span class="bp">$</span> <span class="n">f</span> <span class="bp">$</span> <span class="n">σ.symm</span> <span class="n">i'</span><span class="o">,</span>
  <span class="n">inv_fun</span>   <span class="o">:=</span> <span class="bp">λ</span> <span class="n">F</span> <span class="n">i</span><span class="o">,</span> <span class="o">(</span><span class="n">e</span> <span class="n">rfl</span><span class="o">)</span><span class="bp">.</span><span class="n">symm</span> <span class="bp">$</span> <span class="n">F</span> <span class="bp">$</span> <span class="n">σ</span> <span class="n">i</span><span class="o">,</span>
  <span class="n">left_inv</span>  <span class="o">:=</span> <span class="bp">λ</span> <span class="n">f</span><span class="o">,</span> <span class="kd">begin</span>
    <span class="n">ext</span> <span class="n">i</span><span class="o">,</span>
    <span class="n">simp</span> <span class="n">only</span><span class="o">,</span>
    <span class="n">rw</span> <span class="n">equiv.symm_apply_eq</span><span class="o">,</span>
    <span class="k">have</span> <span class="o">:</span> <span class="bp">∀</span> <span class="o">{</span><span class="n">i</span> <span class="n">i'</span><span class="o">}</span> <span class="o">(</span><span class="n">ha</span> <span class="o">:</span> <span class="n">σ</span> <span class="n">i'</span> <span class="bp">=</span> <span class="n">σ</span> <span class="n">i</span><span class="o">)</span> <span class="o">(</span><span class="n">hb</span> <span class="o">:</span> <span class="n">σ</span> <span class="n">i</span> <span class="bp">=</span> <span class="n">σ</span> <span class="n">i</span><span class="o">)</span> <span class="o">{</span><span class="n">y</span> <span class="o">:</span> <span class="n">α</span> <span class="n">i'</span><span class="o">}</span> <span class="o">{</span><span class="n">y'</span> <span class="o">:</span> <span class="n">α</span> <span class="n">i</span><span class="o">},</span>
      <span class="n">f</span> <span class="n">i'</span> <span class="bp">=</span> <span class="n">y</span> <span class="bp">→</span> <span class="n">f</span> <span class="n">i</span> <span class="bp">=</span> <span class="n">y'</span> <span class="bp">→</span> <span class="n">e</span> <span class="n">ha</span> <span class="n">y</span> <span class="bp">=</span> <span class="n">e</span> <span class="n">hb</span> <span class="n">y'</span><span class="o">,</span>
    <span class="o">{</span> <span class="n">intros</span> <span class="n">i</span> <span class="n">i'</span> <span class="n">ha</span><span class="o">,</span>
      <span class="n">rw</span> <span class="n">equiv.apply_eq_iff_eq</span> <span class="n">at</span> <span class="n">ha</span><span class="o">,</span>
      <span class="n">subst</span> <span class="n">ha</span><span class="o">,</span>
      <span class="n">rintros</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="n">rfl</span> <span class="n">rfl</span><span class="o">,</span>
      <span class="n">refl</span> <span class="o">},</span>
    <span class="n">apply</span> <span class="n">this</span> <span class="n">_</span> <span class="n">rfl</span> <span class="n">rfl</span> <span class="n">rfl</span><span class="o">,</span>
  <span class="kd">end</span><span class="o">,</span>
  <span class="n">right_inv</span> <span class="o">:=</span> <span class="gr">sorry</span><span class="o">,</span> <span class="o">}</span>
</code></pre></div>



<a name="262353301"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Reindexing%20a%20dependent%20product/near/262353301" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kyle Miller <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Reindexing.20a.20dependent.20product.html#262353301">(Nov 22 2021 at 17:46)</a>:</h4>
<p>I extracted it from one of the goals from the first proof.  I'm sure it could be simplified more.</p>



<a name="262353379"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Reindexing%20a%20dependent%20product/near/262353379" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Oliver Nash <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Reindexing.20a.20dependent.20product.html#262353379">(Nov 22 2021 at 17:47)</a>:</h4>
<p>Thanks, I really better run now but I'll study this later.</p>



<a name="262355546"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Reindexing%20a%20dependent%20product/near/262355546" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kyle Miller <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Reindexing.20a.20dependent.20product.html#262355546">(Nov 22 2021 at 18:00)</a>:</h4>
<p>The first time I'd seen one of these rewrite lemmas was when <span class="user-mention" data-user-id="110049">@Mario Carneiro</span> kindly <a href="#narrow/stream/113489-new-members/topic/Showing.20a.20function.20is.20well-defined.20.28eq.2Erec.29/near/202749383">showed how it was done</a> (I suppose he was sort of the Virgil to dependent type hell).</p>



<a name="262360915"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Reindexing%20a%20dependent%20product/near/262360915" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Reindexing.20a.20dependent.20product.html#262360915">(Nov 22 2021 at 18:45)</a>:</h4>
<p>Kyle, it would be very nice if you could write a blog post about these tricks in the community blog. This kind of wisdom has been explicitly in scope of our blog from the beginning, but we haven't seen any such post up to now. You would need to find a simpler first example of course.</p>



<a name="262386272"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Reindexing%20a%20dependent%20product/near/262386272" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Floris van Doorn <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Reindexing.20a.20dependent.20product.html#262386272">(Nov 22 2021 at 22:25)</a>:</h4>
<p>This is basically <a href="https://leanprover-community.github.io/mathlib_docs/find/equiv.Pi_congr">docs#equiv.Pi_congr</a> modulo <a href="https://leanprover-community.github.io/mathlib_docs/find/forall_eq">docs#forall_eq</a> (but where <code>p</code> is a family of types instead of a predicate). (Oh, I now see this was mentioned)</p>



<a name="262578995"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Reindexing%20a%20dependent%20product/near/262578995" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Oliver Nash <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Reindexing.20a.20dependent.20product.html#262578995">(Nov 24 2021 at 12:01)</a>:</h4>
<p>I returned to this and created <a href="https://github.com/leanprover-community/mathlib/issues/10432">#10432</a> since it's nearly impossible to use <a href="https://leanprover-community.github.io/mathlib_docs/find/equiv.Pi_congr">docs#equiv.Pi_congr</a> and <a href="https://leanprover-community.github.io/mathlib_docs/find/equiv.Pi_congr'">docs#equiv.Pi_congr'</a> without these lemmas. <span class="user-mention" data-user-id="306601">@Kyle Miller</span> thank you very much for the tips btw: I would never have learned the required black magic without your help.</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>