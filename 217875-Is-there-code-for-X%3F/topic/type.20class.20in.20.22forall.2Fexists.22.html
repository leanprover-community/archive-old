---
layout: archive
title: Zulip Chat Archive
permalink: /stream/217875-Is-there-code-for-X%3F/topic/type.20class.20in.20.22forall.2Fexists.22.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/index.html">Is there code for X?</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/type.20class.20in.20.22forall.2Fexists.22.html">type class in "forall/exists"</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="242079675"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/type%20class%20in%20%22forall/exists%22/near/242079675" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Winston Yin <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/type.20class.20in.20.22forall.2Fexists.22.html#242079675">(Jun 09 2021 at 15:01)</a>:</h4>
<p>Why is Lean unable to infer <code>add_comm_monoid M</code> for <code>module R M</code> in the following:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">def</span> <span class="n">test</span>
  <span class="o">(</span><span class="n">R</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">_</span><span class="o">)</span> <span class="o">[</span><span class="n">semiring</span> <span class="n">R</span><span class="o">]</span> <span class="o">:</span> <span class="kt">Prop</span> <span class="o">:=</span>
<span class="bp">âˆƒ</span> <span class="o">(</span><span class="n">M</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">_</span><span class="o">)</span> <span class="o">[</span><span class="n">add_comm_monoid</span> <span class="n">M</span><span class="o">]</span> <span class="o">[</span><span class="n">module</span> <span class="n">R</span> <span class="n">M</span><span class="o">],</span> <span class="n">true</span>
</code></pre></div>



<a name="242079821"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/type%20class%20in%20%22forall/exists%22/near/242079821" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Winston Yin <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/type.20class.20in.20.22forall.2Fexists.22.html#242079821">(Jun 09 2021 at 15:02)</a>:</h4>
<p>In the same vein, how can I say "there exists some type M with a module structure over R such that..."?</p>



<a name="242080100"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/type%20class%20in%20%22forall/exists%22/near/242080100" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Winston Yin <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/type.20class.20in.20.22forall.2Fexists.22.html#242080100">(Jun 09 2021 at 15:04)</a>:</h4>
<p>Oops might've been the wrong stream. My apologies</p>



<a name="242080176"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/type%20class%20in%20%22forall/exists%22/near/242080176" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/type.20class.20in.20.22forall.2Fexists.22.html#242080176">(Jun 09 2021 at 15:04)</a>:</h4>
<p>Class inference is  used to have <code>[monoid M]</code> when you already have <code>[group M]</code>, or similarly. What you are saying looks a little weird mathematically. What are trying to do?</p>



<a name="242080331"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/type%20class%20in%20%22forall/exists%22/near/242080331" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/type.20class.20in.20.22forall.2Fexists.22.html#242080331">(Jun 09 2021 at 15:05)</a>:</h4>
<p>Is your question: every module is an additive monoid, why can't Lean figure this out?</p>



<a name="242080407"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/type%20class%20in%20%22forall/exists%22/near/242080407" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/type.20class.20in.20.22forall.2Fexists.22.html#242080407">(Jun 09 2021 at 15:06)</a>:</h4>
<p>If you want to prove your proposition (why it is a <code>def</code>?), you can say <code>use R</code>. Then the goals are solved by <code>apply_instance</code>.</p>



<a name="242080454"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/type%20class%20in%20%22forall/exists%22/near/242080454" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/type.20class.20in.20.22forall.2Fexists.22.html#242080454">(Jun 09 2021 at 15:06)</a>:</h4>
<p>The problem is, some things are modules over several rings. But they should be an additive monoid in a unique way, otherwise Lean gets confused.</p>



<a name="242080542"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/type%20class%20in%20%22forall/exists%22/near/242080542" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/type.20class.20in.20.22forall.2Fexists.22.html#242080542">(Jun 09 2021 at 15:07)</a>:</h4>
<p>So that's why we write <code>[add_comm_monoid M] [module R M]</code> (and <code>[module R M]</code> doesn't work if Lean can't find <code>add_comm_monoid M</code>)</p>



<a name="242080717"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/type%20class%20in%20%22forall/exists%22/near/242080717" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Winston Yin <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/type.20class.20in.20.22forall.2Fexists.22.html#242080717">(Jun 09 2021 at 15:08)</a>:</h4>
<p>I'll clarify my confusion</p>



<a name="242080866"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/type%20class%20in%20%22forall/exists%22/near/242080866" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Winston Yin <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/type.20class.20in.20.22forall.2Fexists.22.html#242080866">(Jun 09 2021 at 15:09)</a>:</h4>
<p>This works:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">def</span> <span class="n">test2</span>
  <span class="o">(</span><span class="n">R</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">_</span><span class="o">)</span> <span class="o">[</span><span class="n">semiring</span> <span class="n">R</span><span class="o">]</span> <span class="o">(</span><span class="n">M</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">_</span><span class="o">)</span> <span class="o">[</span><span class="n">add_comm_monoid</span> <span class="n">M</span><span class="o">]</span> <span class="o">[</span><span class="n">module</span> <span class="n">R</span> <span class="n">M</span><span class="o">]</span> <span class="o">:</span> <span class="kt">Prop</span> <span class="o">:=</span> <span class="n">true</span>
</code></pre></div>
<p>(Suppose I'm just trying to define some predicate on R and M)</p>



<a name="242080936"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/type%20class%20in%20%22forall/exists%22/near/242080936" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Winston Yin <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/type.20class.20in.20.22forall.2Fexists.22.html#242080936">(Jun 09 2021 at 15:09)</a>:</h4>
<p>Lean is able to infer <code>add_comm_monoid M</code> before it infers <code>module R M</code></p>



<a name="242081102"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/type%20class%20in%20%22forall/exists%22/near/242081102" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Winston Yin <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/type.20class.20in.20.22forall.2Fexists.22.html#242081102">(Jun 09 2021 at 15:10)</a>:</h4>
<p>But in the <code>test</code> above, when <code>(M : Type _) [add_comm_monoid M] [module R M]</code> are in the body of the definition behind an <code>exists</code>, Lean is no longer inferring <code>add_comm_monoid M</code> for the purpose of <code>module R M</code></p>



<a name="242081185"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/type%20class%20in%20%22forall/exists%22/near/242081185" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Oliver Nash <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/type.20class.20in.20.22forall.2Fexists.22.html#242081185">(Jun 09 2021 at 15:11)</a>:</h4>
<p>What are you trying to say mathematically?</p>



<a name="242081269"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/type%20class%20in%20%22forall/exists%22/near/242081269" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/type.20class.20in.20.22forall.2Fexists.22.html#242081269">(Jun 09 2021 at 15:11)</a>:</h4>
<p><span class="user-mention" data-user-id="416472">@Winston Yin</span> ok, I see. Write <code>by exactI</code> before <code>[module R M]</code></p>



<a name="242081392"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/type%20class%20in%20%22forall/exists%22/near/242081392" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/type.20class.20in.20.22forall.2Fexists.22.html#242081392">(Jun 09 2021 at 15:12)</a>:</h4>
<p>The problem is that Lean at certain points freezes the type class instance cache for performance reasons.</p>



<a name="242081449"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/type%20class%20in%20%22forall/exists%22/near/242081449" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/type.20class.20in.20.22forall.2Fexists.22.html#242081449">(Jun 09 2021 at 15:13)</a>:</h4>
<p>And <code>[add_comm_monoid M]</code> is not in the cache when <code>[module R M]</code> needs it.</p>



<a name="242081543"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/type%20class%20in%20%22forall/exists%22/near/242081543" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/type.20class.20in.20.22forall.2Fexists.22.html#242081543">(Jun 09 2021 at 15:13)</a>:</h4>
<p>I think the cache gets frozen after the <code>:</code>. So with existential statements, you need to reset the cache manually. You can do this using <code>by exactI</code>.</p>



<a name="242081578"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/type%20class%20in%20%22forall/exists%22/near/242081578" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Winston Yin <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/type.20class.20in.20.22forall.2Fexists.22.html#242081578">(Jun 09 2021 at 15:13)</a>:</h4>
<p>What I'm actually trying to do: define the notion of the decomposability of a group representation, so that if a vector space V is a representation (of a group, over a field, etc), it is decomposable if there exist V1 and V2 with <code>V = V1 \oplus V2</code></p>



<a name="242081616"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/type%20class%20in%20%22forall/exists%22/near/242081616" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/type.20class.20in.20.22forall.2Fexists.22.html#242081616">(Jun 09 2021 at 15:14)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">def</span> <span class="n">test</span>
  <span class="o">(</span><span class="n">R</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">_</span><span class="o">)</span> <span class="o">[</span><span class="n">semiring</span> <span class="n">R</span><span class="o">]</span> <span class="o">:</span> <span class="kt">Prop</span> <span class="o">:=</span>
<span class="bp">âˆƒ</span> <span class="o">(</span><span class="n">M</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">_</span><span class="o">)</span> <span class="o">[</span><span class="n">add_comm_monoid</span> <span class="n">M</span><span class="o">],</span> <span class="kd">by</span> <span class="n">exactI</span> <span class="o">[</span><span class="n">module</span> <span class="n">R</span> <span class="n">M</span><span class="o">]</span>
</code></pre></div>
<p>should work</p>



<a name="242081760"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/type%20class%20in%20%22forall/exists%22/near/242081760" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/type.20class.20in.20.22forall.2Fexists.22.html#242081760">(Jun 09 2021 at 15:14)</a>:</h4>
<p><span class="user-mention silent" data-user-id="416472">Winston Yin</span> <a href="#narrow/stream/217875-Is-there.20code.20for.20X.3F/topic/type.20class.20in.20.22forall.2Fexists.22/near/242081578">said</a>:</p>
<blockquote>
<p>What I'm actually trying to do: define the notion of the decomposability of a group representation, so that if a vector space V is a representation (of a group, over a field, etc), it is decomposable if there exist V1 and V2 with <code>V = V1 \oplus V2</code></p>
</blockquote>
<p>I would use <code>V1 V2 : subrepresentation V</code> for that, I think.</p>



<a name="242081761"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/type%20class%20in%20%22forall/exists%22/near/242081761" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Winston Yin <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/type.20class.20in.20.22forall.2Fexists.22.html#242081761">(Jun 09 2021 at 15:14)</a>:</h4>
<p>Let me try <code>exactI</code></p>



<a name="242081874"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/type%20class%20in%20%22forall/exists%22/near/242081874" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/type.20class.20in.20.22forall.2Fexists.22.html#242081874">(Jun 09 2021 at 15:15)</a>:</h4>
<p>For the definition I would use subreps. But then add a lemma that if <code>V = V1 \oplus V2</code> for random nontrivial reps V1 and V2, then of course <code>V</code> is decomposable.</p>



<a name="242081979"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/type%20class%20in%20%22forall/exists%22/near/242081979" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/type.20class.20in.20.22forall.2Fexists.22.html#242081979">(Jun 09 2021 at 15:16)</a>:</h4>
<p>Using subreps in the definition saves you all the trouble of <code>\exists (a type) [that is a monoid], by exactI [and a module]</code></p>



<a name="242081993"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/type%20class%20in%20%22forall/exists%22/near/242081993" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Winston Yin <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/type.20class.20in.20.22forall.2Fexists.22.html#242081993">(Jun 09 2021 at 15:16)</a>:</h4>
<p>Sorry, I wrote <code>true</code> earlier to simplify things. But I meant to write some Prop that depends on M itself</p>



<a name="242082049"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/type%20class%20in%20%22forall/exists%22/near/242082049" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/type.20class.20in.20.22forall.2Fexists.22.html#242082049">(Jun 09 2021 at 15:16)</a>:</h4>
<p>So write <code>by exactI \exist [module R M], blabla</code></p>



<a name="242082114"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/type%20class%20in%20%22forall/exists%22/near/242082114" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Winston Yin <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/type.20class.20in.20.22forall.2Fexists.22.html#242082114">(Jun 09 2021 at 15:17)</a>:</h4>
<p>I'll try to rephrase in terms of subreps</p>



<a name="242175801"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/type%20class%20in%20%22forall/exists%22/near/242175801" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Notification Bot <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/type.20class.20in.20.22forall.2Fexists.22.html#242175801">(Jun 10 2021 at 08:46)</a>:</h4>
<p>This topic was moved by <span class="user-mention silent" data-user-id="110087">Scott Morrison</span> to <a class="stream-topic" data-stream-id="113488" href="/#narrow/stream/113488-general/topic/type.20class.20in.20.22forall.2Fexists.22">#general &gt; type class in "forall/exists"</a></p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>