---
layout: archive
title: Zulip Chat Archive
permalink: /stream/217875-Is-there-code-for-X%3F/topic/semiring.2Balgebra.20.3D.3E.20ring.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/index.html">Is there code for X?</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/semiring.2Balgebra.20.3D.3E.20ring.html">semiring+algebra => ring</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="204968473"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/semiring%2Balgebra%20%3D%3E%20ring/near/204968473" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/semiring.2Balgebra.20.3D.3E.20ring.html#204968473">(Jul 24 2020 at 21:22)</a>:</h4>
<p>This is related to <span class="user-mention" data-user-id="310045">@Eric Wieser</span> 's comment on <a href="https://github.com/leanprover-community/mathlib/issues/3531">#3531</a> </p>
<p><code>by apply_instance</code> failed for this:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="n">ring_theory</span><span class="bp">.</span><span class="n">algebra</span>
<span class="kn">import</span> <span class="n">linear_algebra</span>

<span class="kn">variables</span> <span class="o">{</span><span class="n">R</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">comm_ring</span> <span class="n">R</span><span class="o">]</span> <span class="o">{</span><span class="n">A</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">semiring</span> <span class="n">A</span><span class="o">]</span> <span class="o">[</span><span class="n">algebra</span> <span class="n">R</span> <span class="n">A</span><span class="o">]</span>

<span class="kn">example</span> <span class="o">:</span> <span class="n">ring</span> <span class="n">A</span> <span class="o">:=</span>
<span class="o">{</span> <span class="n">neg</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">a</span><span class="o">,</span> <span class="o">(</span><span class="n">algebra_map</span> <span class="n">R</span> <span class="bp">_</span>  <span class="err">$</span> <span class="bp">-</span><span class="mi">1</span><span class="o">)</span> <span class="bp">*</span> <span class="n">a</span><span class="o">,</span>
  <span class="n">add_left_neg</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">a</span><span class="o">,</span>
  <span class="k">begin</span>
    <span class="k">have</span> <span class="o">:</span> <span class="o">(</span><span class="n">algebra_map</span> <span class="n">R</span> <span class="bp">_</span> <span class="mi">1</span><span class="o">)</span> <span class="bp">*</span> <span class="n">a</span> <span class="bp">=</span> <span class="n">a</span><span class="o">,</span> <span class="k">by</span> <span class="n">simp</span><span class="o">,</span>
    <span class="n">conv_lhs</span> <span class="o">{</span> <span class="n">congr</span><span class="o">,</span> <span class="n">skip</span><span class="o">,</span> <span class="n">rw</span> <span class="err">←</span><span class="n">this</span><span class="o">},</span> <span class="n">clear</span> <span class="n">this</span><span class="o">,</span>
    <span class="n">change</span> <span class="o">(</span><span class="n">algebra_map</span> <span class="n">R</span> <span class="bp">_</span> <span class="o">(</span><span class="bp">-</span><span class="mi">1</span><span class="o">))</span> <span class="bp">*</span> <span class="n">a</span> <span class="bp">+</span> <span class="bp">_</span> <span class="bp">=</span> <span class="bp">_</span><span class="o">,</span>
    <span class="n">rw</span> <span class="o">[</span><span class="err">←</span><span class="n">right_distrib</span><span class="o">,</span><span class="err">←</span> <span class="o">(</span><span class="n">algebra_map</span> <span class="n">R</span> <span class="n">A</span><span class="o">)</span><span class="bp">.</span><span class="n">map_add</span> <span class="o">(</span><span class="bp">-</span><span class="mi">1</span><span class="o">)</span> <span class="mi">1</span><span class="o">],</span>
    <span class="n">simp</span><span class="o">,</span>
  <span class="kn">end</span><span class="o">,</span>
  <span class="bp">..</span><span class="k">show</span> <span class="n">semiring</span> <span class="n">A</span><span class="o">,</span> <span class="k">by</span> <span class="n">apply_instance</span> <span class="o">}</span>
</code></pre></div>


<p>Does mathlib have this?</p>



<a name="204968685"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/semiring%2Balgebra%20%3D%3E%20ring/near/204968685" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/semiring.2Balgebra.20.3D.3E.20ring.html#204968685">(Jul 24 2020 at 21:25)</a>:</h4>
<p>This isn't suitable as an instance (<code>R</code> is undetermined), but I don't know whether it exists as a <code>def</code></p>



<a name="211235155"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/semiring%2Balgebra%20%3D%3E%20ring/near/211235155" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/semiring.2Balgebra.20.3D.3E.20ring.html#211235155">(Sep 25 2020 at 09:21)</a>:</h4>
<p>Done in <a href="https://github.com/leanprover-community/mathlib/issues/4252">#4252</a>, name suggestions appreciated</p>



<a name="211412388"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/semiring%2Balgebra%20%3D%3E%20ring/near/211412388" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/semiring.2Balgebra.20.3D.3E.20ring.html#211412388">(Sep 27 2020 at 11:40)</a>:</h4>
<p><a href="https://leanprover-community.github.io/mathlib_docs/find/semimodule.add_comm_monoid_to_add_comm_group">docs#semimodule.add_comm_monoid_to_add_comm_group</a>, and <a href="https://leanprover-community.github.io/mathlib_docs/find/algebra.semiring_to_ring">docs#algebra.semiring_to_ring</a></p>



<a name="211414740"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/semiring%2Balgebra%20%3D%3E%20ring/near/211414740" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/semiring.2Balgebra.20.3D.3E.20ring.html#211414740">(Sep 27 2020 at 12:40)</a>:</h4>
<p>Is it true that the resulting add_comm_group structure is independent of the choice of R? If so, can this be made a type class anyway?</p>



<a name="211415556"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/semiring%2Balgebra%20%3D%3E%20ring/near/211415556" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/semiring.2Balgebra.20.3D.3E.20ring.html#211415556">(Sep 27 2020 at 13:00)</a>:</h4>
<p>Additive inverses are unique since (-x)+x+(~x) can be simplified either to -x or ~x, so it can't matter which coefficient ring you use to construct the additive inverses? I'd still be pretty wary of adding these as instances.</p>



<a name="211415872"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/semiring%2Balgebra%20%3D%3E%20ring/near/211415872" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/semiring.2Balgebra.20.3D.3E.20ring.html#211415872">(Sep 27 2020 at 13:07)</a>:</h4>
<p>That's a nice and simple proof, thanks!</p>



<a name="211417090"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/semiring%2Balgebra%20%3D%3E%20ring/near/211417090" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/semiring.2Balgebra.20.3D.3E.20ring.html#211417090">(Sep 27 2020 at 13:39)</a>:</h4>
<p>Although I can't think of a way to exploit it to make the R arg implicit</p>



<a name="211417469"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/semiring%2Balgebra%20%3D%3E%20ring/near/211417469" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/semiring.2Balgebra.20.3D.3E.20ring.html#211417469">(Sep 27 2020 at 13:48)</a>:</h4>
<p>There are really two reasons this should not be an instance</p>



<a name="211417474"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/semiring%2Balgebra%20%3D%3E%20ring/near/211417474" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/semiring.2Balgebra.20.3D.3E.20ring.html#211417474">(Sep 27 2020 at 13:48)</a>:</h4>
<p>First, it just won't work because there is no way for Lean to guess what <code>R</code> you have in mind</p>



<a name="211417482"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/semiring%2Balgebra%20%3D%3E%20ring/near/211417482" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/semiring.2Balgebra.20.3D.3E.20ring.html#211417482">(Sep 27 2020 at 13:48)</a>:</h4>
<p>But even if that wasn't a problem, most of the time there will be a better instance available already</p>



<a name="211417572"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/semiring%2Balgebra%20%3D%3E%20ring/near/211417572" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/semiring.2Balgebra.20.3D.3E.20ring.html#211417572">(Sep 27 2020 at 13:51)</a>:</h4>
<p>So since you almost never want to use this instance anyways, much easier if it's not an instance and it's just used explicitly where desired</p>



<a name="211417586"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/semiring%2Balgebra%20%3D%3E%20ring/near/211417586" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/semiring.2Balgebra.20.3D.3E.20ring.html#211417586">(Sep 27 2020 at 13:51)</a>:</h4>
<p>As a general principle, instances shouldn't be for variables like in <code>ring A</code>.</p>



<a name="211424410"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/semiring%2Balgebra%20%3D%3E%20ring/near/211424410" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/semiring.2Balgebra.20.3D.3E.20ring.html#211424410">(Sep 27 2020 at 16:51)</a>:</h4>
<p>Not sure what you mean by your last message. Either way, I've run into trouble making this an instance even for specific instantiations, as in <a href="https://github.com/leanprover-community/mathlib/issues/4289">#4289</a></p>



<a name="211440068"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/semiring%2Balgebra%20%3D%3E%20ring/near/211440068" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/semiring.2Balgebra.20.3D.3E.20ring.html#211440068">(Sep 27 2020 at 23:35)</a>:</h4>
<p>Reid's last message is saying that you should never have "general" instances <code>S A</code> that work for <em>any</em> <code>A</code>. Instances like this will fire every time someone wants an <code>S A</code>, and so contribute very heavily to typeclass search (particularly if people looking for <code>R A</code> might be sent looking for <code>S A</code> along the way).</p>
<p>Instead ideally instances are doing a sort of "structural recursion", e.g. they provide an instance of some <code>S (B A)</code> in terms of <code>S A</code>. When this is happening, you can be more confident typeclass search will be efficient, and you're also much less likely to get non-definitionally equal instances colliding with each other.</p>



<a name="211440130"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/semiring%2Balgebra%20%3D%3E%20ring/near/211440130" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/semiring.2Balgebra.20.3D.3E.20ring.html#211440130">(Sep 27 2020 at 23:36)</a>:</h4>
<p>There's a linter warning about general instances that will always match, which suggests lowering the priority. Arguably it should suggest thinking very carefully about whether you <em>really</em> want this instance available in typeclass search, and if you're sure you do to only create it with low priority (so all the honest instances get to fire first).</p>



<a name="211467335"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/semiring%2Balgebra%20%3D%3E%20ring/near/211467335" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/semiring.2Balgebra.20.3D.3E.20ring.html#211467335">(Sep 28 2020 at 09:03)</a>:</h4>
<p>Would you be able to comment on whether the instances in <a href="https://github.com/leanprover-community/mathlib/issues/4289">#4289</a> are a bad idea, and if so how best to handle them?</p>



<a name="211470164"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/semiring%2Balgebra%20%3D%3E%20ring/near/211470164" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Oliver Nash <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/semiring.2Balgebra.20.3D.3E.20ring.html#211470164">(Sep 28 2020 at 09:34)</a>:</h4>
<p>I believe the instances in <a href="https://github.com/leanprover-community/mathlib/issues/4289">#4289</a> are fine because the scalars are part of the type (thus avoiding the underdetermined parameter in typeclass search). I agree with your assessment that the problem is a diamond issue, and I want to understand it. I bet there is also a simpler way to get it to manifest.</p>



<a name="211471579"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/semiring%2Balgebra%20%3D%3E%20ring/near/211471579" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/semiring.2Balgebra.20.3D.3E.20ring.html#211471579">(Sep 28 2020 at 09:50)</a>:</h4>
<p>Yes, this is just non-definitionally equal typeclasses instances. Typeclass <em>search</em> is working fine, you just don't like what you're getting!</p>



<a name="211471626"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/semiring%2Balgebra%20%3D%3E%20ring/near/211471626" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/semiring.2Balgebra.20.3D.3E.20ring.html#211471626">(Sep 28 2020 at 09:50)</a>:</h4>
<p>I'm worried that the only fix is going to be to tweak the inductive construction to do something different for the free ring...</p>



<a name="211472000"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/semiring%2Balgebra%20%3D%3E%20ring/near/211472000" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/semiring.2Balgebra.20.3D.3E.20ring.html#211472000">(Sep 28 2020 at 09:54)</a>:</h4>
<p>Interestingly the <code>free_algebra</code> typeclass seems to cause no problem, it's just the <code>tensor_algebra</code> one that does</p>



<a name="211472073"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/semiring%2Balgebra%20%3D%3E%20ring/near/211472073" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/semiring.2Balgebra.20.3D.3E.20ring.html#211472073">(Sep 28 2020 at 09:55)</a>:</h4>
<p>(as an aside, the <code>derive [algebra R]</code> attribute on <code>tensor_algebra</code> creates an instance <code>tensor_algebra.inst</code> instead of <code>tensor_algebra.algebra</code>, which is minorly unhelpful when debugging)</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>