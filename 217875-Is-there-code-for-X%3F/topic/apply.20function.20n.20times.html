---
layout: archive
title: Zulip Chat Archive
permalink: /stream/217875-Is-there-code-for-X%3F/topic/apply.20function.20n.20times.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/index.html">Is there code for X?</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/apply.20function.20n.20times.html">apply function n times</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="272552879"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/apply%20function%20n%20times/near/272552879" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bernd Losert <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/apply.20function.20n.20times.html#272552879">(Feb 20 2022 at 00:26)</a>:</h4>
<p>Is there a tactic that can take an n : ℕ, f : α → β, and x : α and produce f (f ... (f x)...), where f appears n times.</p>



<a name="272552894"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/apply%20function%20n%20times/near/272552894" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bernd Losert <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/apply.20function.20n.20times.html#272552894">(Feb 20 2022 at 00:26)</a>:</h4>
<p>(deleted)</p>



<a name="272553029"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/apply%20function%20n%20times/near/272553029" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/apply.20function.20n.20times.html#272553029">(Feb 20 2022 at 00:29)</a>:</h4>
<p>There's <a href="https://leanprover-community.github.io/mathlib_docs/find/nat.iterate">docs#nat.iterate</a> (assuming you mean <code>f : α → α</code>) -- why do you need a tactic?</p>



<a name="272553115"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/apply%20function%20n%20times/near/272553115" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bernd Losert <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/apply.20function.20n.20times.html#272553115">(Feb 20 2022 at 00:30)</a>:</h4>
<p>I can't use iterate because f is polymorphic and each application of f produce different types.</p>



<a name="272553147"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/apply%20function%20n%20times/near/272553147" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bernd Losert <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/apply.20function.20n.20times.html#272553147">(Feb 20 2022 at 00:31)</a>:</h4>
<p>For example, suppose <code>f</code> is <code>functor.map</code>.</p>



<a name="272553570"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/apply%20function%20n%20times/near/272553570" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/apply.20function.20n.20times.html#272553570">(Feb 20 2022 at 00:39)</a>:</h4>
<p>If the codomain and domain of <code>f</code> are different then I can make no sense of your question. What do the <code>...</code> mean in your first post?</p>



<a name="272553654"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/apply%20function%20n%20times/near/272553654" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/apply.20function.20n.20times.html#272553654">(Feb 20 2022 at 00:41)</a>:</h4>
<p>How do you know that the <code>n + 1</code>-th application will be polymorphic enough to accept the <code>n</code>-th output?</p>



<a name="272554201"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/apply%20function%20n%20times/near/272554201" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bernd Losert <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/apply.20function.20n.20times.html#272554201">(Feb 20 2022 at 00:50)</a>:</h4>
<p>A more concrete example: </p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">constant</span> <span class="n">xs</span> <span class="o">:</span> <span class="n">list</span> <span class="o">(</span><span class="n">list</span> <span class="o">(</span><span class="n">list</span> <span class="n">nat</span><span class="o">))</span>
<span class="kd">constant</span> <span class="n">f</span> <span class="o">:</span> <span class="n">nat</span> <span class="bp">→</span> <span class="n">string</span>

<span class="kd">def</span> <span class="n">ex</span> <span class="o">:</span> <span class="n">list</span> <span class="o">(</span><span class="n">list</span> <span class="o">(</span><span class="n">list</span> <span class="n">string</span><span class="o">))</span> <span class="o">:=</span> <span class="n">list.map</span> <span class="o">(</span><span class="n">list.map</span> <span class="o">(</span><span class="n">list.map</span> <span class="n">f</span><span class="o">))</span> <span class="n">xs</span>
</code></pre></div>



<a name="272554226"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/apply%20function%20n%20times/near/272554226" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bernd Losert <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/apply.20function.20n.20times.html#272554226">(Feb 20 2022 at 00:51)</a>:</h4>
<p>I want a tactic where I can write something like <code>(iterate 3 list.map f) xs</code></p>



<a name="272554332"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/apply%20function%20n%20times/near/272554332" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/apply.20function.20n.20times.html#272554332">(Feb 20 2022 at 00:53)</a>:</h4>
<p><code>iterate 3 { apply list.map f }, exact xs</code>?</p>



<a name="272554528"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/apply%20function%20n%20times/near/272554528" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bernd Losert <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/apply.20function.20n.20times.html#272554528">(Feb 20 2022 at 00:57)</a>:</h4>
<p>What is<code>iterate</code> in that line of code?</p>



<a name="272554547"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/apply%20function%20n%20times/near/272554547" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/apply.20function.20n.20times.html#272554547">(Feb 20 2022 at 00:57)</a>:</h4>
<p><a href="https://leanprover-community.github.io/mathlib_docs/find/tactic.interactive.iterate">docs#tactic.interactive.iterate</a></p>



<a name="272554756"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/apply%20function%20n%20times/near/272554756" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bernd Losert <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/apply.20function.20n.20times.html#272554756">(Feb 20 2022 at 01:00)</a>:</h4>
<p>Ah, OK. I tried</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">def</span> <span class="n">ex</span> <span class="o">:</span> <span class="n">list</span> <span class="o">(</span><span class="n">list</span> <span class="o">(</span><span class="n">list</span> <span class="n">string</span><span class="o">))</span> <span class="o">:=</span> <span class="kd">begin</span>
   <span class="n">iterate</span> <span class="mi">3</span> <span class="o">{</span> <span class="n">apply</span> <span class="n">list.map</span> <span class="n">f</span> <span class="o">},</span> <span class="n">exact</span> <span class="n">xs</span>
<span class="kd">end</span>
</code></pre></div>
<p>but it complains about <code>apply</code>.</p>



<a name="272555661"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/apply%20function%20n%20times/near/272555661" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/apply.20function.20n.20times.html#272555661">(Feb 20 2022 at 01:19)</a>:</h4>
<p>actually you aren't applying directly to the goal in that example so you have to modify it a bit</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">def</span> <span class="n">ex</span> <span class="o">:</span> <span class="n">list</span> <span class="o">(</span><span class="n">list</span> <span class="o">(</span><span class="n">list</span> <span class="n">string</span><span class="o">))</span> <span class="o">:=</span> <span class="kd">begin</span>
  <span class="k">have</span> <span class="o">:=</span> <span class="n">xs</span><span class="o">,</span> <span class="n">revert</span> <span class="n">this</span><span class="o">,</span>
  <span class="n">iterate</span> <span class="mi">3</span> <span class="o">{</span> <span class="n">apply</span> <span class="n">list.map</span> <span class="o">},</span> <span class="n">exact</span> <span class="n">f</span>
<span class="kd">end</span>
</code></pre></div>



<a name="272583789"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/apply%20function%20n%20times/near/272583789" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bernd Losert <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/apply.20function.20n.20times.html#272583789">(Feb 20 2022 at 10:51)</a>:</h4>
<p>Nice. I tried the following, but it does not work:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">noncomputable</span> <span class="kd">def</span> <span class="n">ex</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="o">:</span> <span class="n">nat.iterate</span> <span class="n">list</span> <span class="n">n</span> <span class="n">string</span> <span class="o">:=</span> <span class="kd">begin</span>
  <span class="k">have</span> <span class="o">:=</span> <span class="n">xs</span><span class="o">,</span> <span class="n">revert</span> <span class="n">this</span><span class="o">,</span>
  <span class="n">iterate</span> <span class="n">n</span> <span class="o">{</span> <span class="n">apply</span> <span class="n">list.map</span> <span class="o">},</span> <span class="n">exact</span> <span class="n">f</span>
<span class="kd">end</span>
</code></pre></div>



<a name="272583896"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/apply%20function%20n%20times/near/272583896" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/apply.20function.20n.20times.html#272583896">(Feb 20 2022 at 10:53)</a>:</h4>
<p>what's the type of <code>xs</code> here?</p>



<a name="272583906"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/apply%20function%20n%20times/near/272583906" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bernd Losert <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/apply.20function.20n.20times.html#272583906">(Feb 20 2022 at 10:53)</a>:</h4>
<p>Oops. I forgot to change that one.</p>



<a name="272583911"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/apply%20function%20n%20times/near/272583911" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/apply.20function.20n.20times.html#272583911">(Feb 20 2022 at 10:53)</a>:</h4>
<p>the way you're mixing the levels doesn't make sense here, you should just be able to use induction on n though</p>



<a name="272583915"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/apply%20function%20n%20times/near/272583915" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bernd Losert <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/apply.20function.20n.20times.html#272583915">(Feb 20 2022 at 10:53)</a>:</h4>
<p>Let me try again.</p>



<a name="272584011"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/apply%20function%20n%20times/near/272584011" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/apply.20function.20n.20times.html#272584011">(Feb 20 2022 at 10:55)</a>:</h4>
<p>I feel like the answers involving the <code>iterate</code> tactic were possibly misleading, but then, it's also quite unclear what you want to do or why</p>



<a name="272584091"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/apply%20function%20n%20times/near/272584091" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bernd Losert <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/apply.20function.20n.20times.html#272584091">(Feb 20 2022 at 10:56)</a>:</h4>
<p>Here you go:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">def</span> <span class="n">ex</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">nat</span> <span class="bp">→</span> <span class="n">string</span><span class="o">)</span> <span class="o">(</span><span class="n">xs</span> <span class="o">:</span> <span class="n">nat.iterate</span> <span class="n">list</span> <span class="n">n</span> <span class="n">nat</span><span class="o">)</span> <span class="o">:</span> <span class="n">nat.iterate</span> <span class="n">list</span> <span class="n">n</span> <span class="n">string</span> <span class="o">:=</span> <span class="kd">begin</span>
  <span class="k">have</span> <span class="o">:=</span> <span class="n">xs</span><span class="o">,</span> <span class="n">revert</span> <span class="n">this</span><span class="o">,</span>
  <span class="n">iterate</span> <span class="n">n</span> <span class="o">{</span> <span class="n">apply</span> <span class="n">list.map</span> <span class="o">},</span> <span class="n">exact</span> <span class="n">f</span>
<span class="kd">end</span>
</code></pre></div>



<a name="272584178"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/apply%20function%20n%20times/near/272584178" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/apply.20function.20n.20times.html#272584178">(Feb 20 2022 at 10:58)</a>:</h4>
<p>I guess you should move all arguments (except optionally <code>f</code>) to the right of the colon and use recursion</p>



<a name="272584323"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/apply%20function%20n%20times/near/272584323" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bernd Losert <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/apply.20function.20n.20times.html#272584323">(Feb 20 2022 at 11:00)</a>:</h4>
<p>That's a good idea actually. But why does it not work with the <code>iterate</code> tactic. Does that tactic only work with hard-code <code>n</code>?</p>



<a name="272584355"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/apply%20function%20n%20times/near/272584355" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/apply.20function.20n.20times.html#272584355">(Feb 20 2022 at 11:00)</a>:</h4>
<p>Right, it just doesn't make sense</p>



<a name="272584364"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/apply%20function%20n%20times/near/272584364" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/apply.20function.20n.20times.html#272584364">(Feb 20 2022 at 11:00)</a>:</h4>
<p><code>iterate</code> needs to know how many times to run the body, that number cannot be an internal variable</p>



<a name="272584383"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/apply%20function%20n%20times/near/272584383" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bernd Losert <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/apply.20function.20n.20times.html#272584383">(Feb 20 2022 at 11:01)</a>:</h4>
<p>Bummer... Oh well.</p>



<a name="272584397"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/apply%20function%20n%20times/near/272584397" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/apply.20function.20n.20times.html#272584397">(Feb 20 2022 at 11:01)</a>:</h4>
<p>There is a phase distinction here</p>



<a name="272584504"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/apply%20function%20n%20times/near/272584504" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bernd Losert <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/apply.20function.20n.20times.html#272584504">(Feb 20 2022 at 11:03)</a>:</h4>
<p>What do you mean by "phase"?</p>



<a name="272584576"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/apply%20function%20n%20times/near/272584576" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/apply.20function.20n.20times.html#272584576">(Feb 20 2022 at 11:04)</a>:</h4>
<p>e.g. compile-time vs run-time</p>



<a name="272584599"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/apply%20function%20n%20times/near/272584599" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/apply.20function.20n.20times.html#272584599">(Feb 20 2022 at 11:05)</a>:</h4>
<p>The tactic runs before the function itself (notionally) runs. So <code>n</code> doesn't refer to anything when the tactic executes, it's literally just the letter "n".</p>



<a name="272584720"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/apply%20function%20n%20times/near/272584720" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/apply.20function.20n.20times.html#272584720">(Feb 20 2022 at 11:07)</a>:</h4>
<p>It's like C macros, you cannot have a program expand a macro <code>n</code> times where <code>n</code> is a number the program read from stdin, because the macro expansion already had to be finished long ago</p>



<a name="272584843"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/apply%20function%20n%20times/near/272584843" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/apply.20function.20n.20times.html#272584843">(Feb 20 2022 at 11:09)</a>:</h4>
<p>In Lean it would make even less sense because the tactic block could be constructing a proof, and proofs don't even run at all.</p>



<a name="272584920"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/apply%20function%20n%20times/near/272584920" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bernd Losert <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/apply.20function.20n.20times.html#272584920">(Feb 20 2022 at 11:10)</a>:</h4>
<p>Yes, that makes sense. For some reason, I thought I could get away with doing this sort of thing in Lean. I have come across this limitation with other macro systems. I guess this is a fundametal issue with macros in general.</p>



<a name="272585299"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/apply%20function%20n%20times/near/272585299" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bernd Losert <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/apply.20function.20n.20times.html#272585299">(Feb 20 2022 at 11:17)</a>:</h4>
<p>So, I trying this, but I'm getting errors that I don't know how to fix:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">def</span> <span class="n">ex</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">nat</span> <span class="bp">→</span> <span class="n">string</span><span class="o">)</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">n</span><span class="o">,</span> <span class="o">(</span><span class="n">list</span><span class="bp">^</span><span class="o">[</span><span class="n">n</span><span class="o">]</span> <span class="n">nat</span><span class="o">)</span> <span class="bp">→</span> <span class="o">(</span><span class="n">list</span><span class="bp">^</span><span class="o">[</span><span class="n">n</span><span class="o">]</span> <span class="n">string</span><span class="o">)</span>
<span class="bp">|</span> <span class="o">(</span><span class="mi">0</span><span class="o">)</span> <span class="o">(</span><span class="n">n</span><span class="o">)</span> <span class="o">:=</span> <span class="n">f</span> <span class="n">n</span>
<span class="bp">|</span> <span class="o">(</span><span class="n">n</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)</span> <span class="o">([])</span> <span class="o">:=</span> <span class="o">[]</span>
<span class="bp">|</span> <span class="o">(</span><span class="n">n</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)</span> <span class="o">(</span><span class="n">list.cons</span> <span class="n">m</span> <span class="n">ms</span><span class="o">)</span> <span class="o">:=</span> <span class="gr">sorry</span><span class="o">,</span>
</code></pre></div>



<a name="272585627"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/apply%20function%20n%20times/near/272585627" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/apply.20function.20n.20times.html#272585627">(Feb 20 2022 at 11:23)</a>:</h4>
<p>Hmm, I think <code>nat.iterate</code> is defined inconveniently for this purpose</p>



<a name="272585639"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/apply%20function%20n%20times/near/272585639" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/apply.20function.20n.20times.html#272585639">(Feb 20 2022 at 11:23)</a>:</h4>
<p>You would prefer to have <code>list^[n+1] nat = list (list^[n] nat)</code></p>



<a name="272585757"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/apply%20function%20n%20times/near/272585757" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bernd Losert <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/apply.20function.20n.20times.html#272585757">(Feb 20 2022 at 11:25)</a>:</h4>
<p>OK. Let me define my own <code>nat.iterate</code> then and see if that helps.</p>



<a name="272585823"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/apply%20function%20n%20times/near/272585823" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/apply.20function.20n.20times.html#272585823">(Feb 20 2022 at 11:26)</a>:</h4>
<p>Maybe you can also work with this definition by also generalizing over the types <code>nat</code> and <code>string</code> and the function <code>f</code>, and writing something like <code>| (n + 1) f xs := ex n (list.map f) xs</code></p>



<a name="272585936"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/apply%20function%20n%20times/near/272585936" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/apply.20function.20n.20times.html#272585936">(Feb 20 2022 at 11:28)</a>:</h4>
<p>I feel like one of these is less efficient than the other, but I'm not sure which or whether that matters to you.</p>



<a name="272586624"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/apply%20function%20n%20times/near/272586624" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bernd Losert <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/apply.20function.20n.20times.html#272586624">(Feb 20 2022 at 11:40)</a>:</h4>
<p>Progress!</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">def</span> <span class="n">iter</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">α</span> <span class="bp">→</span> <span class="n">α</span><span class="o">)</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">n</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">,</span> <span class="n">α</span> <span class="bp">→</span> <span class="n">α</span>
<span class="bp">|</span> <span class="mi">0</span> <span class="o">:=</span> <span class="n">id</span>
<span class="bp">|</span> <span class="o">(</span><span class="n">n</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">a</span><span class="o">,</span> <span class="n">f</span> <span class="o">(</span><span class="n">iter</span> <span class="n">n</span> <span class="n">a</span><span class="o">)</span>

<span class="kd">def</span> <span class="n">ex</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">ℕ</span> <span class="bp">→</span> <span class="n">string</span><span class="o">)</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">n</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">,</span> <span class="o">(</span><span class="n">iter</span> <span class="n">list</span> <span class="n">n</span> <span class="n">nat</span><span class="o">)</span> <span class="bp">→</span> <span class="o">(</span><span class="n">iter</span> <span class="n">list</span> <span class="n">n</span> <span class="n">string</span><span class="o">)</span>
<span class="bp">|</span> <span class="o">(</span><span class="mi">0</span><span class="o">)</span> <span class="n">n</span> <span class="o">:=</span> <span class="n">f</span> <span class="n">n</span>
<span class="bp">|</span> <span class="o">(</span><span class="n">n</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)</span> <span class="o">[]</span> <span class="o">:=</span> <span class="o">[]</span>
<span class="bp">|</span> <span class="o">(</span><span class="n">n</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)</span> <span class="o">(</span><span class="n">m</span> <span class="o">::</span> <span class="n">ms</span><span class="o">)</span> <span class="o">:=</span> <span class="n">ex</span> <span class="n">n</span> <span class="n">m</span> <span class="o">::</span> <span class="n">list.map</span> <span class="o">(</span><span class="n">ex</span> <span class="n">n</span><span class="o">)</span> <span class="n">ms</span>
</code></pre></div>



<a name="272586738"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/apply%20function%20n%20times/near/272586738" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/apply.20function.20n.20times.html#272586738">(Feb 20 2022 at 11:42)</a>:</h4>
<p>You should be able to use <code>list.map</code> in the <code>(n + 1)</code> case without doing a case split on the list as well.</p>



<a name="272586885"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/apply%20function%20n%20times/near/272586885" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bernd Losert <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/apply.20function.20n.20times.html#272586885">(Feb 20 2022 at 11:45)</a>:</h4>
<p>Good catch. Thanks a lot.</p>



<a name="272586970"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/apply%20function%20n%20times/near/272586970" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bernd Losert <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/apply.20function.20n.20times.html#272586970">(Feb 20 2022 at 11:46)</a>:</h4>
<p>If I have a proof of <code>list^[n+1] nat = list (list^[n] nat)</code>, could I use that with the <code>nat.iterate</code> version somehow?</p>



<a name="272607292"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/apply%20function%20n%20times/near/272607292" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bernd Losert <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/apply.20function.20n.20times.html#272607292">(Feb 20 2022 at 18:07)</a>:</h4>
<p>So I tried to generalize the <code>ex</code> example, but it doesn't work:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">variables</span> <span class="o">{</span><span class="n">α</span> <span class="n">β</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">}</span>
<span class="kd">variable</span> <span class="o">{</span><span class="n">f</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span> <span class="bp">→</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">}</span>

<span class="kd">def</span> <span class="n">iter</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">α</span> <span class="bp">→</span> <span class="n">α</span><span class="o">)</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">n</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">,</span> <span class="n">α</span> <span class="bp">→</span> <span class="n">α</span>
<span class="bp">|</span> <span class="mi">0</span> <span class="o">:=</span> <span class="n">id</span>
<span class="bp">|</span> <span class="o">(</span><span class="n">n</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">a</span><span class="o">,</span> <span class="n">f</span> <span class="o">(</span><span class="n">iter</span> <span class="n">n</span> <span class="n">a</span><span class="o">)</span>

<span class="kd">def</span> <span class="n">map</span> <span class="o">[</span><span class="n">functor</span> <span class="n">f</span><span class="o">]</span> <span class="o">(</span><span class="n">m</span> <span class="o">:</span> <span class="n">α</span> <span class="bp">→</span> <span class="n">β</span><span class="o">)</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">n</span><span class="o">,</span> <span class="n">iter</span> <span class="n">f</span> <span class="n">n</span> <span class="n">α</span> <span class="bp">→</span> <span class="n">iter</span> <span class="n">f</span> <span class="n">n</span> <span class="n">β</span>
<span class="bp">|</span> <span class="mi">0</span> <span class="n">val</span> <span class="o">:=</span> <span class="n">m</span> <span class="n">val</span>
<span class="bp">|</span> <span class="o">(</span><span class="n">n</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)</span> <span class="n">val</span> <span class="o">:=</span> <span class="n">functor.map</span> <span class="o">(</span><span class="n">map</span> <span class="n">n</span><span class="o">)</span> <span class="n">val</span>
</code></pre></div>



<a name="272607413"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/apply%20function%20n%20times/near/272607413" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/apply.20function.20n.20times.html#272607413">(Feb 20 2022 at 18:09)</a>:</h4>
<p>It's probably not obvious to Lean what functor you want to <code>map</code> until you unfold <code>iter</code></p>



<a name="272607490"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/apply%20function%20n%20times/near/272607490" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bernd Losert <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/apply.20function.20n.20times.html#272607490">(Feb 20 2022 at 18:11)</a>:</h4>
<p>Yes. Should I pass the <code>functor f</code> instance to <code>functor.map</code>?</p>



<a name="272607511"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/apply%20function%20n%20times/near/272607511" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bernd Losert <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/apply.20function.20n.20times.html#272607511">(Feb 20 2022 at 18:11)</a>:</h4>
<p>Yeah, that works.</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>