---
layout: archive
title: Zulip Chat Archive
permalink: /stream/217875-Is-there-code-for-X%3F/topic/bidirectional.20maps.3F.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/index.html">Is there code for X?</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/bidirectional.20maps.3F.html">bidirectional maps?</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="211895482"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/bidirectional%20maps%3F/near/211895482" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> SnowFox <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/bidirectional.20maps.3F.html#211895482">(Oct 01 2020 at 11:18)</a>:</h4>
<p>Hello. I have an inductive type a la <code>inductive t | a | b | c</code>which uniquely maps to a natural number <code>| a := 1 | b := 5 | c := 30</code>. I want two functions <code>t_to_nat : t -&gt; nat</code> and <code>f_of_nat : nat -&gt; t</code>, but don't want to manually define them both. Is there a mathlib type I should be using? <code>finmap</code> sounds appropriate but I don't have sigma types here (yet).</p>



<a name="211895546"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/bidirectional%20maps%3F/near/211895546" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/bidirectional.20maps.3F.html#211895546">(Oct 01 2020 at 11:19)</a>:</h4>
<p>What should <code>f_of_nat 2</code> be?</p>



<a name="211895653"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/bidirectional%20maps%3F/near/211895653" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> SnowFox <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/bidirectional.20maps.3F.html#211895653">(Oct 01 2020 at 11:20)</a>:</h4>
<p>Ah, good point. Lets say I have a reserved illegal variant. :)</p>



<a name="211895931"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/bidirectional%20maps%3F/near/211895931" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> SnowFox <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/bidirectional.20maps.3F.html#211895931">(Oct 01 2020 at 11:24)</a>:</h4>
<p>Or just option; both work.</p>



<a name="211895965"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/bidirectional%20maps%3F/near/211895965" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> SnowFox <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/bidirectional.20maps.3F.html#211895965">(Oct 01 2020 at 11:25)</a>:</h4>
<p>It might also be fine to just assume a safe default; putting it on the caller to ensure the number is valid.</p>



<a name="211896800"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/bidirectional%20maps%3F/near/211896800" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/bidirectional.20maps.3F.html#211896800">(Oct 01 2020 at 11:36)</a>:</h4>
<p>It seems like somewhere there ought to be some <code>noncomputable def function.left_inverse_of_injective (f : α → β) (h : injective f) : β → α := sorry</code> which you could use here</p>



<a name="211897152"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/bidirectional%20maps%3F/near/211897152" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> SnowFox <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/bidirectional.20maps.3F.html#211897152">(Oct 01 2020 at 11:40)</a>:</h4>
<p>Hm?</p>



<a name="211897170"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/bidirectional%20maps%3F/near/211897170" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> SnowFox <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/bidirectional.20maps.3F.html#211897170">(Oct 01 2020 at 11:41)</a>:</h4>
<p>I don't see any such or similar function.</p>



<a name="211898082"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/bidirectional%20maps%3F/near/211898082" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> SnowFox <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/bidirectional.20maps.3F.html#211898082">(Oct 01 2020 at 11:51)</a>:</h4>
<p><span class="user-mention" data-user-id="310045">@Eric Wieser</span> This?</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="sd">/-- The inverse of a function (which is a left inverse if `f` is injective</span>
<span class="sd">  and a right inverse if `f` is surjective). -/</span>
<span class="kd">noncomputable</span> <span class="kd">def</span> <span class="n">inv_fun</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">α</span> <span class="bp">→</span> <span class="n">β</span><span class="o">)</span> <span class="o">:</span> <span class="n">β</span> <span class="bp">→</span> <span class="n">α</span> <span class="o">:=</span> <span class="n">inv_fun_on</span> <span class="n">f</span> <span class="n">set.univ</span>
</code></pre></div>



<a name="211898290"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/bidirectional%20maps%3F/near/211898290" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/bidirectional.20maps.3F.html#211898290">(Oct 01 2020 at 11:53)</a>:</h4>
<p>Yes, <a href="https://leanprover-community.github.io/mathlib_docs/find/function.inv_fun">docs#function.inv_fun</a> and <a href="https://leanprover-community.github.io/mathlib_docs/find/function.partial_inv">docs#function.partial_inv</a> look like what you want</p>



<a name="211898498"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/bidirectional%20maps%3F/near/211898498" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> SnowFox <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/bidirectional.20maps.3F.html#211898498">(Oct 01 2020 at 11:56)</a>:</h4>
<p><span class="user-mention" data-user-id="310045">@Eric Wieser</span> Given the <code>noncomputable</code> keyword, I'm not seeing how?</p>



<a name="211899472"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/bidirectional%20maps%3F/near/211899472" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> SnowFox <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/bidirectional.20maps.3F.html#211899472">(Oct 01 2020 at 12:07)</a>:</h4>
<p>I mean, I now have a <code>noncomputable def of_nat</code> but I need it to be computable.</p>



<a name="211900013"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/bidirectional%20maps%3F/near/211900013" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/bidirectional.20maps.3F.html#211900013">(Oct 01 2020 at 12:13)</a>:</h4>
<p>Ah, you didn't say it needed to be computable ;)</p>



<a name="211900093"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/bidirectional%20maps%3F/near/211900093" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> SnowFox <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/bidirectional.20maps.3F.html#211900093">(Oct 01 2020 at 12:14)</a>:</h4>
<p>I thought that was the default! :P</p>



<a name="211900171"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/bidirectional%20maps%3F/near/211900171" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/bidirectional.20maps.3F.html#211900171">(Oct 01 2020 at 12:15)</a>:</h4>
<p>We generally like noncomputable stuff (-;</p>



<a name="211901040"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/bidirectional%20maps%3F/near/211901040" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> SnowFox <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/bidirectional.20maps.3F.html#211901040">(Oct 01 2020 at 12:24)</a>:</h4>
<p>One idea I had, adding <code>@[pattern]</code> to the <code>to_nat</code> and trying to implement <code>def of_nat | (to_nat x) := x</code> but that hits "invalid function application in pattern, cannot be reduced to a constructor, possible solution mark as inaccessible"</p>



<a name="211901595"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/bidirectional%20maps%3F/near/211901595" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> SnowFox <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/bidirectional.20maps.3F.html#211901595">(Oct 01 2020 at 12:29)</a>:</h4>
<p>Unless someone has a better idea; I guess I'll go with a <code>list (t \x nat)</code> and hack together lookups over this...</p>



<a name="211944596"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/bidirectional%20maps%3F/near/211944596" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/bidirectional.20maps.3F.html#211944596">(Oct 01 2020 at 17:23)</a>:</h4>
<p><span class="user-mention" data-user-id="328454">@SnowFox</span> I think you need to be clearer about your actual application. It's certainly possible to write a tactic that does the necessary copy paste to make two functions the way you would expect</p>



<a name="212005965"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/bidirectional%20maps%3F/near/212005965" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> SnowFox <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/bidirectional.20maps.3F.html#212005965">(Oct 02 2020 at 05:21)</a>:</h4>
<p>To be concrete; I want a map between representations of RISC-V opcodes. An inductive type to introduce names and exhaustive coverage, and its numerical representation. However, some mappings depend on the integer length, XLEN. I.e. <code>(opcode.system, any XLEN) &lt;=&gt; nat.shiftl 3 5 + nat.shiftl 4 2 + 3</code>, and both <code>(opcode.c_fld, 32 or 64)</code> and <code>(opcode.c_lq, 128)</code> map to <code>nat.shiftl 1 13 + 0</code>.</p>



<a name="212006261"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/bidirectional%20maps%3F/near/212006261" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kyle Miller <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/bidirectional.20maps.3F.html#212006261">(Oct 02 2020 at 05:27)</a>:</h4>
<p>Ok, so you want an assembler/dissassembler pair?  (assembler being mnemonics -&gt; words and disassembler being words -&gt; mnemonics, the mnemonics encoded as inductive types?)</p>



<a name="212006273"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/bidirectional%20maps%3F/near/212006273" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> SnowFox <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/bidirectional.20maps.3F.html#212006273">(Oct 02 2020 at 05:27)</a>:</h4>
<p>Precisely, yes.</p>



<a name="212006276"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/bidirectional%20maps%3F/near/212006276" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kyle Miller <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/bidirectional.20maps.3F.html#212006276">(Oct 02 2020 at 05:27)</a>:</h4>
<p>Are you saying RISC-V has multiple mnemonics that have the same encoding?</p>



<a name="212006348"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/bidirectional%20maps%3F/near/212006348" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kyle Miller <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/bidirectional.20maps.3F.html#212006348">(Oct 02 2020 at 05:29)</a>:</h4>
<p>I'm not sure if you're going to be able to get around having to write a disassembler.  At least in Lean you'll be able to prove the disassembler is a right inverse to the assembler to verify you probably did it right!</p>



<a name="212006349"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/bidirectional%20maps%3F/near/212006349" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> SnowFox <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/bidirectional.20maps.3F.html#212006349">(Oct 02 2020 at 05:29)</a>:</h4>
<p>The mnemonics for RV{32,64,128}I are shared despite being incompatible due to the differing integer lengths; but RVC, the compressed extension has several mnemonics which don't exist under different XLENs, so they share the word/encoding.</p>



<a name="212006416"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/bidirectional%20maps%3F/near/212006416" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> SnowFox <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/bidirectional.20maps.3F.html#212006416">(Oct 02 2020 at 05:30)</a>:</h4>
<p>All uncompressed mnemonics are XLEN independent. Only the compressed opcodes depend on XLEN.</p>



<a name="212006423"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/bidirectional%20maps%3F/near/212006423" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kyle Miller <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/bidirectional.20maps.3F.html#212006423">(Oct 02 2020 at 05:30)</a>:</h4>
<p>Just out of curiosity, are the compressed extensions like ARM Thumb instructions?</p>



<a name="212006446"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/bidirectional%20maps%3F/near/212006446" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> SnowFox <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/bidirectional.20maps.3F.html#212006446">(Oct 02 2020 at 05:31)</a>:</h4>
<p>Er, not mnemonics in the sense of addi, sub, etc. These are the opcodes which determine the set of instructions by format. I.e. <code>addi</code> and <code>slli</code> are both under the <code>op_imm</code> opcode.</p>



<a name="212006505"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/bidirectional%20maps%3F/near/212006505" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> SnowFox <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/bidirectional.20maps.3F.html#212006505">(Oct 02 2020 at 05:32)</a>:</h4>
<p>I don't know the details of ARM Thumb instructions but I do know they differ. IIUC Thumb instructions are necessary, whereas for RISC-V the compressed instructions are only a hot subset of the uncompressed.</p>



<a name="212006548"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/bidirectional%20maps%3F/near/212006548" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kyle Miller <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/bidirectional.20maps.3F.html#212006548">(Oct 02 2020 at 05:34)</a>:</h4>
<p>So this function is only for encoding the instruction format as an integer? How many of these are there?</p>



<a name="212006672"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/bidirectional%20maps%3F/near/212006672" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> SnowFox <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/bidirectional.20maps.3F.html#212006672">(Oct 02 2020 at 05:36)</a>:</h4>
<p>Unless I've miscounted, 28 uncompressed (XLEN independent) and 33 compressed (XLEN dependent). But some of these are reserved or custom, for user defined instruction ranges.</p>



<a name="212006714"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/bidirectional%20maps%3F/near/212006714" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> SnowFox <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/bidirectional.20maps.3F.html#212006714">(Oct 02 2020 at 05:37)</a>:</h4>
<p>There are 6 uncompressed + 9 compressed "instruction formats", which are different to the opcodes.</p>



<a name="212006724"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/bidirectional%20maps%3F/near/212006724" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kyle Miller <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/bidirectional.20maps.3F.html#212006724">(Oct 02 2020 at 05:37)</a>:</h4>
<p>I've never done this, but in principle I think you could do Lean metaprogramming to read in your definition for the assembler and generate an inverse function.  I'm not aware of anything like this that already exists, and I'm also new to Lean so take my advice with that in mind</p>



<a name="212006778"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/bidirectional%20maps%3F/near/212006778" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> SnowFox <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/bidirectional.20maps.3F.html#212006778">(Oct 02 2020 at 05:38)</a>:</h4>
<p><a href="https://github.com/riscv/riscv-isa-manual/releases/download/draft-20200727-8088ba4/riscv-spec.pdf">https://github.com/riscv/riscv-isa-manual/releases/download/draft-20200727-8088ba4/riscv-spec.pdf</a></p>



<a name="212006784"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/bidirectional%20maps%3F/near/212006784" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> SnowFox <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/bidirectional.20maps.3F.html#212006784">(Oct 02 2020 at 05:38)</a>:</h4>
<p>Page 112 has the RVC opcodes.</p>



<a name="212006799"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/bidirectional%20maps%3F/near/212006799" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> SnowFox <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/bidirectional.20maps.3F.html#212006799">(Oct 02 2020 at 05:39)</a>:</h4>
<p>Page 129 has the standard RVI opcode map.</p>



<a name="212006801"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/bidirectional%20maps%3F/near/212006801" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kyle Miller <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/bidirectional.20maps.3F.html#212006801">(Oct 02 2020 at 05:39)</a>:</h4>
<p>If you have a nice data format to represent all the instruction types, you might also consider doing code generation, either within Lean or in another language.  (A number assemblers use a database of opcode and instruction encodings after all.)</p>



<a name="212006862"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/bidirectional%20maps%3F/near/212006862" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kyle Miller <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/bidirectional.20maps.3F.html#212006862">(Oct 02 2020 at 05:40)</a>:</h4>
<p>The proof that these are inverses of each other in a suitable sense could probably be mostly automated with tactics</p>



<a name="212006863"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/bidirectional%20maps%3F/near/212006863" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/bidirectional.20maps.3F.html#212006863">(Oct 02 2020 at 05:40)</a>:</h4>
<p>You should definitely do this with a tactic</p>



<a name="212006865"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/bidirectional%20maps%3F/near/212006865" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> SnowFox <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/bidirectional.20maps.3F.html#212006865">(Oct 02 2020 at 05:40)</a>:</h4>
<p>Yes, this would be ideal. I considered it too but didn't know how to approach this.</p>



<a name="212006875"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/bidirectional%20maps%3F/near/212006875" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kyle Miller <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/bidirectional.20maps.3F.html#212006875">(Oct 02 2020 at 05:41)</a>:</h4>
<p><span class="user-mention" data-user-id="110049">@Mario Carneiro</span> Define the function itself with a tactic?</p>



<a name="212006876"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/bidirectional%20maps%3F/near/212006876" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/bidirectional.20maps.3F.html#212006876">(Oct 02 2020 at 05:41)</a>:</h4>
<p>You can calibrate the input to be whatever is easiest and the tactic makes the definitions</p>



<a name="212006881"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/bidirectional%20maps%3F/near/212006881" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> SnowFox <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/bidirectional.20maps.3F.html#212006881">(Oct 02 2020 at 05:41)</a>:</h4>
<p>Pages 130 to 136 have the actual instructions.</p>



<a name="212006965"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/bidirectional%20maps%3F/near/212006965" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/bidirectional.20maps.3F.html#212006965">(Oct 02 2020 at 05:43)</a>:</h4>
<p>I've done disassembly for an ISA before and you get a lot more flexibility to generate the functions and proof producing assembler/disassembler with a custom input format</p>



<a name="212007059"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/bidirectional%20maps%3F/near/212007059" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> SnowFox <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/bidirectional.20maps.3F.html#212007059">(Oct 02 2020 at 05:44)</a>:</h4>
<p>I could write code to extract the opcodes from the .tex. Though there may be better formats available. I know rv8 has some opcode maps but they are old. I could manually update these; but at that point I may as well just start from scratch and define the format myself.</p>



<a name="212007073"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/bidirectional%20maps%3F/near/212007073" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/bidirectional.20maps.3F.html#212007073">(Oct 02 2020 at 05:45)</a>:</h4>
<p>Oh, I was thinking of you manually transcribing the tex (or the part of it you need), possibly with some regex preprocessing first</p>



<a name="212007128"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/bidirectional%20maps%3F/near/212007128" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/bidirectional.20maps.3F.html#212007128">(Oct 02 2020 at 05:46)</a>:</h4>
<p>If you want to stay up to date with a changing spec it would make sense to parse the .tex but otherwise it's just a one time job</p>



<a name="212007130"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/bidirectional%20maps%3F/near/212007130" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> SnowFox <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/bidirectional.20maps.3F.html#212007130">(Oct 02 2020 at 05:46)</a>:</h4>
<p><a href="https://github.com/riscv/riscv-opcodes">https://github.com/riscv/riscv-opcodes</a> These should be up to date</p>



<a name="212007163"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/bidirectional%20maps%3F/near/212007163" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/bidirectional.20maps.3F.html#212007163">(Oct 02 2020 at 05:47)</a>:</h4>
<p>aha, it's already formalized (in python, but still)</p>



<a name="212007178"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/bidirectional%20maps%3F/near/212007178" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/bidirectional.20maps.3F.html#212007178">(Oct 02 2020 at 05:47)</a>:</h4>
<p>so you could write a python program that spits out a lean file</p>



<a name="212007232"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/bidirectional%20maps%3F/near/212007232" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> SnowFox <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/bidirectional.20maps.3F.html#212007232">(Oct 02 2020 at 05:48)</a>:</h4>
<p>I'd like to take the lean route. Metaprogramming, reading in these opcode files.</p>



<a name="212007243"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/bidirectional%20maps%3F/near/212007243" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kyle Miller <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/bidirectional.20maps.3F.html#212007243">(Oct 02 2020 at 05:48)</a>:</h4>
<p><span class="user-mention" data-user-id="110049">@Mario Carneiro</span> Did you mean anything specifically by a custom input format?  Like, write some top-level command to read in a data file and generate Lean code?</p>



<a name="212007430"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/bidirectional%20maps%3F/near/212007430" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/bidirectional.20maps.3F.html#212007430">(Oct 02 2020 at 05:53)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">inductive</span> <span class="n">reg</span> <span class="bp">|</span> <span class="n">rs1</span> <span class="bp">|</span> <span class="n">rs2</span> <span class="bp">|</span> <span class="n">rd</span>

<span class="kd">inductive</span> <span class="n">instr</span> <span class="o">:</span> <span class="kt">Type</span>
<span class="bp">|</span> <span class="n">imm</span> <span class="o">(</span><span class="n">_</span> <span class="o">:</span> <span class="n">name</span><span class="o">)</span> <span class="o">(</span><span class="n">r1</span> <span class="n">r2</span> <span class="o">:</span> <span class="n">reg</span><span class="o">)</span> <span class="o">(</span><span class="n">bits</span> <span class="o">:</span> <span class="n">nat</span><span class="o">)</span> <span class="o">:</span> <span class="n">instr</span>
<span class="bp">|</span> <span class="n">reg3</span> <span class="o">(</span><span class="n">_</span> <span class="o">:</span> <span class="n">name</span><span class="o">)</span> <span class="o">(</span><span class="n">r1</span> <span class="n">r2</span> <span class="n">r3</span> <span class="o">:</span> <span class="n">reg</span><span class="o">)</span> <span class="o">:</span> <span class="n">instr</span>

<span class="kd">meta</span> <span class="kd">def</span> <span class="n">make_defs</span> <span class="o">(</span><span class="n">_</span> <span class="o">:</span> <span class="n">list</span> <span class="n">instr</span><span class="o">)</span> <span class="o">:</span> <span class="n">tactic</span> <span class="n">unit</span> <span class="o">:=</span> <span class="n">tactic.skip</span>

<span class="kn">open</span> <span class="n">reg</span> <span class="n">instr</span>
<span class="kd">run_cmd</span> <span class="n">make_defs</span> <span class="o">[</span>
  <span class="n">imm</span> <span class="bp">`</span><span class="n">ADD</span> <span class="n">rd</span> <span class="n">rs1</span> <span class="mi">12</span><span class="o">,</span>
  <span class="n">reg3</span> <span class="bp">`</span><span class="n">SUB</span> <span class="n">rd</span> <span class="n">rs1</span> <span class="n">rs2</span>
<span class="o">]</span>
</code></pre></div>



<a name="212007438"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/bidirectional%20maps%3F/near/212007438" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/bidirectional.20maps.3F.html#212007438">(Oct 02 2020 at 05:53)</a>:</h4>
<p>the details are entirely made up, but something like this</p>



<a name="212007511"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/bidirectional%20maps%3F/near/212007511" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kyle Miller <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/bidirectional.20maps.3F.html#212007511">(Oct 02 2020 at 05:54)</a>:</h4>
<p>Ah, ok.  I guess you could take the Python program in that repository and generate the code that goes into the <code>run_cmd</code></p>



<a name="212007528"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/bidirectional%20maps%3F/near/212007528" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/bidirectional.20maps.3F.html#212007528">(Oct 02 2020 at 05:54)</a>:</h4>
<p>the idea is that you have some terse syntax for defining instruction formats tailored for RISC-V, and then <code>make_defs</code> massages it into lean exprs</p>



<a name="212007618"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/bidirectional%20maps%3F/near/212007618" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/bidirectional.20maps.3F.html#212007618">(Oct 02 2020 at 05:56)</a>:</h4>
<p>and it could do what it likes with the data, for example defining the inductive type of instructions, a function to <code>list byte</code>, a function from <code>list byte</code>, a tactic that parses an instruction, etc etc</p>



<a name="212007650"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/bidirectional%20maps%3F/near/212007650" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> SnowFox <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/bidirectional.20maps.3F.html#212007650">(Oct 02 2020 at 05:57)</a>:</h4>
<p>Yes, something like this would be ideal. But I really don't know anything about tactic writing yet.</p>



<a name="212007683"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/bidirectional%20maps%3F/near/212007683" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/bidirectional.20maps.3F.html#212007683">(Oct 02 2020 at 05:58)</a>:</h4>
<p>You could also write a program (either in python or lean) to autogenerate lean definitions as strings</p>



<a name="212007741"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/bidirectional%20maps%3F/near/212007741" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/bidirectional.20maps.3F.html#212007741">(Oct 02 2020 at 05:59)</a>:</h4>
<p>or you could do the simpler thing and just write it manually (with lots of find/replace and multicursor editing)</p>



<a name="212007796"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/bidirectional%20maps%3F/near/212007796" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/bidirectional.20maps.3F.html#212007796">(Oct 02 2020 at 06:00)</a>:</h4>
<p>but I think the effort spent to write the metaprogram would pay off</p>



<a name="212007861"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/bidirectional%20maps%3F/near/212007861" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> SnowFox <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/bidirectional.20maps.3F.html#212007861">(Oct 02 2020 at 06:01)</a>:</h4>
<p>That's basically what I already have, though only for the opcode maps, not the addi/slli/add/sub/etc instructions. Though that may have been unnecessarily lower level.</p>



<a name="212007964"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/bidirectional%20maps%3F/near/212007964" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/bidirectional.20maps.3F.html#212007964">(Oct 02 2020 at 06:03)</a>:</h4>
<p>I don't think opcode maps are the best way to represent the instructions, since it's unnecessarily case-bashy</p>



<a name="212008021"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/bidirectional%20maps%3F/near/212008021" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kyle Miller <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/bidirectional.20maps.3F.html#212008021">(Oct 02 2020 at 06:04)</a>:</h4>
<p><span class="user-mention" data-user-id="110049">@Mario Carneiro</span>  It should be possible to make it so the tactic reads in the opcode file directly right?  I just don't know what kind of file I/O you can do.  (The parsing into some data type should be easy enough with the parser combinator library, assuming it's anything like Haskell's)</p>



<a name="212008039"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/bidirectional%20maps%3F/near/212008039" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/bidirectional.20maps.3F.html#212008039">(Oct 02 2020 at 06:04)</a>:</h4>
<p>Yeah you can do file IO</p>



<a name="212008054"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/bidirectional%20maps%3F/near/212008054" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/bidirectional.20maps.3F.html#212008054">(Oct 02 2020 at 06:05)</a>:</h4>
<p>I would be inclined to copy and paste into the lean file for stability though</p>



<a name="212008160"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/bidirectional%20maps%3F/near/212008160" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> SnowFox <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/bidirectional.20maps.3F.html#212008160">(Oct 02 2020 at 06:06)</a>:</h4>
<p>Or maybe a hash commitment on the Lean side to detect changes.</p>



<a name="212008188"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/bidirectional%20maps%3F/near/212008188" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/bidirectional.20maps.3F.html#212008188">(Oct 02 2020 at 06:07)</a>:</h4>
<p>well you don't really need to guard things on the lean side because your code will break</p>



<a name="212008210"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/bidirectional%20maps%3F/near/212008210" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> SnowFox <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/bidirectional.20maps.3F.html#212008210">(Oct 02 2020 at 06:07)</a>:</h4>
<p>Depends on what changes, but probably.</p>



<a name="212008218"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/bidirectional%20maps%3F/near/212008218" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/bidirectional.20maps.3F.html#212008218">(Oct 02 2020 at 06:07)</a>:</h4>
<p>but putting everything in the lean file makes it more portable, you don't need to worry about users not being able to read your files the same way</p>



<a name="212008276"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/bidirectional%20maps%3F/near/212008276" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/bidirectional.20maps.3F.html#212008276">(Oct 02 2020 at 06:08)</a>:</h4>
<p>plus parsing is going to be pretty slow, comparatively speaking</p>



<a name="212008310"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/bidirectional%20maps%3F/near/212008310" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/bidirectional.20maps.3F.html#212008310">(Oct 02 2020 at 06:09)</a>:</h4>
<p>the approach I showed is basically leveraging the C++ lean parser to do the dirty work</p>



<a name="212008510"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/bidirectional%20maps%3F/near/212008510" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kyle Miller <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/bidirectional.20maps.3F.html#212008510">(Oct 02 2020 at 06:10)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110049">Mario Carneiro</span> <a href="#narrow/stream/217875-Is-there.20code.20for.20X.3F/topic/bidirectional.20maps.3F/near/212008218">said</a>:</p>
<blockquote>
<p>but putting everything in the lean file makes it more portable, you don't need to worry about users not being able to read your files the same way</p>
</blockquote>
<p>I don't really understand this concern -- if it's a data file in the project, what would be the matter?  But it does seem reasonable re-encoding the data file as a Lean file (especially since the repository has a translator with multiple backends already)</p>



<a name="212008661"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/bidirectional%20maps%3F/near/212008661" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> SnowFox <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/bidirectional.20maps.3F.html#212008661">(Oct 02 2020 at 06:13)</a>:</h4>
<p>Hmm. Reading over the python, I think it might be decent to emit at least the array to paste into the Lean file.</p>



<a name="212008666"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/bidirectional%20maps%3F/near/212008666" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> SnowFox <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/bidirectional.20maps.3F.html#212008666">(Oct 02 2020 at 06:13)</a>:</h4>
<p>Time to learn Python I guess...</p>



<a name="212008683"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/bidirectional%20maps%3F/near/212008683" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/bidirectional.20maps.3F.html#212008683">(Oct 02 2020 at 06:13)</a>:</h4>
<p>My main experience with loading large files into lean is in the metamath import; running a pure lean parser over the metamath file directly was unusably slow, but translating the file into lean and then loading that was much better</p>



<a name="212008844"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/bidirectional%20maps%3F/near/212008844" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> SnowFox <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/bidirectional.20maps.3F.html#212008844">(Oct 02 2020 at 06:16)</a>:</h4>
<p>Regarding registers; I'm using abbreviations for <code>fin 32</code>  for each of <code>xreg</code> <code>freg</code> and <code>vreg</code>. The inductive type mocked above doesn't look right to me.</p>



<a name="212008858"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/bidirectional%20maps%3F/near/212008858" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/bidirectional.20maps.3F.html#212008858">(Oct 02 2020 at 06:16)</a>:</h4>
<p>Like I said, completely made up</p>



<a name="212008897"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/bidirectional%20maps%3F/near/212008897" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/bidirectional.20maps.3F.html#212008897">(Oct 02 2020 at 06:17)</a>:</h4>
<p>if you showed me a snippet of your ISA model I could make something a little more accurate</p>



<a name="212009302"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/bidirectional%20maps%3F/near/212009302" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/bidirectional.20maps.3F.html#212009302">(Oct 02 2020 at 06:18)</a>:</h4>
<p>I have a model of x86 <a href="https://github.com/digama0/mm0/blob/master/mm0-lean/x86/x86.lean">here</a> if it helps</p>



<a name="212009338"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/bidirectional%20maps%3F/near/212009338" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/bidirectional.20maps.3F.html#212009338">(Oct 02 2020 at 06:19)</a>:</h4>
<p>I haven't done RISC-V before though</p>



<a name="212009341"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/bidirectional%20maps%3F/near/212009341" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> SnowFox <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/bidirectional.20maps.3F.html#212009341">(Oct 02 2020 at 06:19)</a>:</h4>
<p>The spec is my model. Page 130-136 list all the instructions, starting with the uncompressed format list for the standard extensions.</p>
<p><a href="https://github.com/riscv/riscv-isa-manual/releases/download/draft-20200727-8088ba4/riscv-spec.pdf">https://github.com/riscv/riscv-isa-manual/releases/download/draft-20200727-8088ba4/riscv-spec.pdf</a></p>



<a name="212009345"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/bidirectional%20maps%3F/near/212009345" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> SnowFox <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/bidirectional.20maps.3F.html#212009345">(Oct 02 2020 at 06:19)</a>:</h4>
<p>Your link is a 404</p>



<a name="212009347"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/bidirectional%20maps%3F/near/212009347" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/bidirectional.20maps.3F.html#212009347">(Oct 02 2020 at 06:19)</a>:</h4>
<p>fixed</p>



<a name="212009357"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/bidirectional%20maps%3F/near/212009357" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> SnowFox <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/bidirectional.20maps.3F.html#212009357">(Oct 02 2020 at 06:19)</a>:</h4>
<p>Thanks.</p>



<a name="212009416"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/bidirectional%20maps%3F/near/212009416" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/bidirectional.20maps.3F.html#212009416">(Oct 02 2020 at 06:20)</a>:</h4>
<p>I mean your lean interpretation of the spec</p>



<a name="212010030"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/bidirectional%20maps%3F/near/212010030" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> SnowFox <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/bidirectional.20maps.3F.html#212010030">(Oct 02 2020 at 06:23)</a>:</h4>
<p>Not sure you want that ;)</p>



<a name="212010304"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/bidirectional%20maps%3F/near/212010304" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> SnowFox <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/bidirectional.20maps.3F.html#212010304">(Oct 02 2020 at 06:26)</a>:</h4>
<p>Current mess =&gt; <a href="https://gist.github.com/WildCryptoFox/6b95260808f8d1bf9fd6d7ca831ef5f2">https://gist.github.com/WildCryptoFox/6b95260808f8d1bf9fd6d7ca831ef5f2</a></p>



<a name="212010490"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/bidirectional%20maps%3F/near/212010490" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> SnowFox <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/bidirectional.20maps.3F.html#212010490">(Oct 02 2020 at 06:28)</a>:</h4>
<p>Any and all restructuring or Lean tips welcome.</p>



<a name="212011056"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/bidirectional%20maps%3F/near/212011056" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/bidirectional.20maps.3F.html#212011056">(Oct 02 2020 at 06:30)</a>:</h4>
<p>Here's my hand translation of the first few instructions:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">inductive</span> <span class="n">type</span> <span class="o">:</span> <span class="kt">Type</span>
<span class="bp">|</span> <span class="n">R_type</span> <span class="o">(</span><span class="n">funct3</span> <span class="o">:</span> <span class="n">nat</span><span class="o">)</span> <span class="o">:</span> <span class="n">type</span>
<span class="bp">|</span> <span class="n">I_type</span> <span class="o">(</span><span class="n">funct3</span> <span class="o">:</span> <span class="n">nat</span><span class="o">)</span> <span class="o">:</span> <span class="n">type</span>
<span class="bp">|</span> <span class="n">B_type</span> <span class="o">(</span><span class="n">funct3</span> <span class="o">:</span> <span class="n">nat</span><span class="o">)</span> <span class="o">:</span> <span class="n">type</span>
<span class="bp">|</span> <span class="n">U_type</span> <span class="o">:</span> <span class="n">type</span>
<span class="bp">|</span> <span class="n">J_type</span> <span class="o">:</span> <span class="n">type</span>

<span class="kd">meta</span> <span class="kd">def</span> <span class="n">make_defs</span> <span class="o">(</span><span class="n">_</span> <span class="o">:</span> <span class="n">list</span> <span class="o">(</span><span class="n">name</span> <span class="bp">×</span> <span class="n">nat</span> <span class="bp">×</span> <span class="n">type</span><span class="o">))</span> <span class="o">:</span> <span class="n">tactic</span> <span class="n">unit</span> <span class="o">:=</span> <span class="n">tactic.skip</span>

<span class="kn">open</span> <span class="n">type</span>
<span class="kd">run_cmd</span> <span class="n">make_defs</span> <span class="o">[</span>
  <span class="o">(</span><span class="bp">`</span><span class="n">LUI</span><span class="o">,</span>   <span class="mi">0b0110111</span><span class="o">,</span> <span class="n">U_type</span><span class="o">),</span>
  <span class="o">(</span><span class="bp">`</span><span class="n">AUIPC</span><span class="o">,</span> <span class="mi">0b0010111</span><span class="o">,</span> <span class="n">U_type</span><span class="o">),</span>
  <span class="o">(</span><span class="bp">`</span><span class="n">JAL</span><span class="o">,</span>   <span class="mi">0b1101111</span><span class="o">,</span> <span class="n">J_type</span><span class="o">),</span>
  <span class="o">(</span><span class="bp">`</span><span class="n">JALR</span><span class="o">,</span>  <span class="mi">0b1100111</span><span class="o">,</span> <span class="n">I_type</span> <span class="mi">0b000</span><span class="o">),</span>
  <span class="o">(</span><span class="bp">`</span><span class="n">BEQ</span><span class="o">,</span>   <span class="mi">0b1100011</span><span class="o">,</span> <span class="n">B_type</span> <span class="mi">0b001</span><span class="o">)</span>
<span class="o">]</span>
</code></pre></div>



<a name="212011177"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/bidirectional%20maps%3F/near/212011177" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/bidirectional.20maps.3F.html#212011177">(Oct 02 2020 at 06:31)</a>:</h4>
<p>also this should probably move to the <a class="stream" data-stream-id="236449" href="/#narrow/stream/236449-Program-verification">#Program verification</a> stream before everyone else gets bored to tears <span aria-label="grinning" class="emoji emoji-1f600" role="img" title="grinning">:grinning:</span></p>



<a name="212013731"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/bidirectional%20maps%3F/near/212013731" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> SnowFox <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/bidirectional.20maps.3F.html#212013731">(Oct 02 2020 at 06:35)</a>:</h4>
<p>My objective is an Equality Saturation enriched RVSDG -&gt; RISC-V optimizing compiler for a Lean-like language enriched with Resourceful Dependent Types. With sensitive data annotated a la resources to taint along data dependencies. I want a language and optimizing compiler for cryptography, such that cryptography can be specified as a clean reference and optimizations may be specified orthogonality and be applied without fear of leaking sensitive data through crypto-unsafe optimizations, like branching on secrets.</p>
<p>RVSDG = <a href="https://www.sintef.no/contentassets/11da6d67207348db98a30ddbdf3b0bba/reissmann_poster.pdf">https://www.sintef.no/contentassets/11da6d67207348db98a30ddbdf3b0bba/reissmann_poster.pdf</a><br>
Equality Saturation = <a href="https://www.cs.cornell.edu/~ross/publications/eqsat/">https://www.cs.cornell.edu/~ross/publications/eqsat/</a><br>
Resourceful Dependent Types = <a href="http://www.cse.chalmers.se/~abela/talkTYPES18.pdf">http://www.cse.chalmers.se/~abela/talkTYPES18.pdf</a> + <a href="http://www.cse.chalmers.se/~abela/types18.pdf">http://www.cse.chalmers.se/~abela/types18.pdf</a></p>



<a name="212014309"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/bidirectional%20maps%3F/near/212014309" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> SnowFox <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/bidirectional.20maps.3F.html#212014309">(Oct 02 2020 at 06:36)</a>:</h4>
<p>Well, that sounds like a good move. ;)</p>



<a name="212018263"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/bidirectional%20maps%3F/near/212018263" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> SnowFox <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/bidirectional.20maps.3F.html#212018263">(Oct 02 2020 at 06:39)</a>:</h4>
<p>(moved to <a href="#narrow/stream/236449-Program-verification/topic/RISC-V.20ISA.20in.20Lean/near/212017762">https://leanprover.zulipchat.com/#narrow/stream/236449-Program-verification/topic/RISC-V.20ISA.20in.20Lean/near/212017762</a>)</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>