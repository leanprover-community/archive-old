---
layout: archive
title: Zulip Chat Archive
permalink: /stream/217875-Is-there-code-for-X%3F/topic/break.20off.20last.20term.20of.20summation.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/index.html">Is there code for X?</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/break.20off.20last.20term.20of.20summation.html">break off last term of summation</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="229616797"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/break%20off%20last%20term%20of%20summation/near/229616797" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Benjamin Davidson <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/break.20off.20last.20term.20of.20summation.html#229616797">(Mar 10 2021 at 07:59)</a>:</h4>
<p>Does the following exist in mathlib? </p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">algebra.big_operators.intervals</span>
<span class="kn">open</span> <span class="n">finset</span>
<span class="n">open_locale</span> <span class="n">big_operators</span>

<span class="kd">example</span> <span class="o">{</span><span class="n">n</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">}</span> <span class="o">{</span><span class="n">f</span> <span class="o">:</span> <span class="n">ℕ</span> <span class="bp">→</span> <span class="n">ℕ</span><span class="o">}</span> <span class="o">:</span> <span class="bp">∑</span> <span class="n">i</span> <span class="k">in</span> <span class="n">range</span> <span class="n">n.succ</span><span class="o">,</span> <span class="n">f</span> <span class="n">i</span> <span class="bp">=</span> <span class="bp">∑</span> <span class="n">i</span> <span class="k">in</span> <span class="n">range</span> <span class="n">n</span><span class="o">,</span> <span class="n">f</span> <span class="n">i</span> <span class="bp">+</span> <span class="n">f</span> <span class="n">n</span> <span class="o">:=</span>
<span class="kd">by</span> <span class="n">rw</span> <span class="o">[</span><span class="bp">←</span> <span class="n">sum_range_add_sum_Ico</span> <span class="n">f</span> <span class="n">n.le_succ</span><span class="o">,</span> <span class="n">Ico.succ_singleton</span><span class="o">,</span> <span class="n">sum_singleton</span><span class="o">]</span>
</code></pre></div>
<p>I know it follows easily from <a href="https://leanprover-community.github.io/mathlib_docs/find/finset.sum_range_add_sum_Ico">docs#finset.sum_range_add_sum_Ico</a>, but I was surprised to not find it explicitly.</p>



<a name="229617047"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/break%20off%20last%20term%20of%20summation/near/229617047" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/break.20off.20last.20term.20of.20summation.html#229617047">(Mar 10 2021 at 08:00)</a>:</h4>
<p>Isn't it <a href="https://leanprover-community.github.io/mathlib_docs/find/finset.sum_range_succ">docs#finset.sum_range_succ</a> or <a href="https://leanprover-community.github.io/mathlib_docs/find/finset.sum_range_succ'">docs#finset.sum_range_succ'</a> ?</p>



<a name="229617264"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/break%20off%20last%20term%20of%20summation/near/229617264" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/break.20off.20last.20term.20of.20summation.html#229617264">(Mar 10 2021 at 08:01)</a>:</h4>
<p>One pulls off the first term, one the last term</p>



<a name="229618223"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/break%20off%20last%20term%20of%20summation/near/229618223" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Benjamin Davidson <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/break.20off.20last.20term.20of.20summation.html#229618223">(Mar 10 2021 at 08:11)</a>:</h4>
<p>Thank you! I don't know why I couldn't find this.</p>



<a name="229619101"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/break%20off%20last%20term%20of%20summation/near/229619101" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Benjamin Davidson <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/break.20off.20last.20term.20of.20summation.html#229619101">(Mar 10 2021 at 08:18)</a>:</h4>
<p><a href="https://leanprover-community.github.io/mathlib_docs/find/finset.sum_range_succ">docs#finset.sum_range_succ</a> has <code>f n + (∑ x in range n, f x)</code> as its RHS. Would it be worthwhile to add a version with an RHS of <code>(∑ x in range n, f x) + f n</code>? I think that would make it easier to find.</p>



<a name="229634503"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/break%20off%20last%20term%20of%20summation/near/229634503" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/break.20off.20last.20term.20of.20summation.html#229634503">(Mar 10 2021 at 10:31)</a>:</h4>
<p>That is strange. Maybe even experiment with just switching the order on the RHS in that lemma?</p>



<a name="229794884"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/break%20off%20last%20term%20of%20summation/near/229794884" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Benjamin Davidson <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/break.20off.20last.20term.20of.20summation.html#229794884">(Mar 11 2021 at 05:06)</a>:</h4>
<p>Sure, I'll give that a go.</p>



<a name="229797041"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/break%20off%20last%20term%20of%20summation/near/229797041" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Benjamin Davidson <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/break.20off.20last.20term.20of.20summation.html#229797041">(Mar 11 2021 at 05:31)</a>:</h4>
<p>Upon taking a closer look, why do both of the following lemmas exist? Is the additive version of the latter not the same as the former?</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">lemma</span> <span class="n">sum_range_succ</span> <span class="o">{</span><span class="n">β</span><span class="o">}</span> <span class="o">[</span><span class="n">add_comm_monoid</span> <span class="n">β</span><span class="o">]</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">ℕ</span> <span class="bp">→</span> <span class="n">β</span><span class="o">)</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="o">:</span>
  <span class="o">(</span><span class="bp">∑</span> <span class="n">x</span> <span class="k">in</span> <span class="n">range</span> <span class="o">(</span><span class="n">n</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">),</span> <span class="n">f</span> <span class="n">x</span><span class="o">)</span> <span class="bp">=</span> <span class="n">f</span> <span class="n">n</span> <span class="bp">+</span> <span class="o">(</span><span class="bp">∑</span> <span class="n">x</span> <span class="k">in</span> <span class="n">range</span> <span class="n">n</span><span class="o">,</span> <span class="n">f</span> <span class="n">x</span><span class="o">)</span> <span class="o">:=</span>
<span class="kd">by</span> <span class="n">rw</span> <span class="o">[</span><span class="n">range_succ</span><span class="o">,</span> <span class="n">sum_insert</span> <span class="n">not_mem_range_self</span><span class="o">]</span>

<span class="kd">@[to_additive]</span>
<span class="kd">lemma</span> <span class="n">prod_range_succ</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">ℕ</span> <span class="bp">→</span> <span class="n">β</span><span class="o">)</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="o">:</span>
  <span class="o">(</span><span class="bp">∏</span> <span class="n">x</span> <span class="k">in</span> <span class="n">range</span> <span class="o">(</span><span class="n">n</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">),</span> <span class="n">f</span> <span class="n">x</span><span class="o">)</span> <span class="bp">=</span> <span class="n">f</span> <span class="n">n</span> <span class="bp">*</span> <span class="o">(</span><span class="bp">∏</span> <span class="n">x</span> <span class="k">in</span> <span class="n">range</span> <span class="n">n</span><span class="o">,</span> <span class="n">f</span> <span class="n">x</span><span class="o">)</span> <span class="o">:=</span>
<span class="kd">by</span> <span class="n">rw</span> <span class="o">[</span><span class="n">range_succ</span><span class="o">,</span> <span class="n">prod_insert</span> <span class="n">not_mem_range_self</span><span class="o">]</span>
</code></pre></div>
<p>(from lines 651-658 of <code>algebra.big_operators.basic</code>)</p>



<a name="229816162"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/break%20off%20last%20term%20of%20summation/near/229816162" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/break.20off.20last.20term.20of.20summation.html#229816162">(Mar 11 2021 at 09:02)</a>:</h4>
<p><code>to_additive</code> is not generating a lemma there, it's just linking together the lemmas</p>



<a name="229816925"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/break%20off%20last%20term%20of%20summation/near/229816925" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Benjamin Davidson <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/break.20off.20last.20term.20of.20summation.html#229816925">(Mar 11 2021 at 09:09)</a>:</h4>
<p>May I ask what the point of that is?</p>



<a name="229820292"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/break%20off%20last%20term%20of%20summation/near/229820292" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/break.20off.20last.20term.20of.20summation.html#229820292">(Mar 11 2021 at 09:37)</a>:</h4>
<p>So that to_additive can still be used to generate copies of lemmas that use that lemma</p>



<a name="229983184"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/break%20off%20last%20term%20of%20summation/near/229983184" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Benjamin Davidson <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/break.20off.20last.20term.20of.20summation.html#229983184">(Mar 12 2021 at 06:27)</a>:</h4>
<p>Ah I see. Thanks!</p>



<a name="229983247"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/break%20off%20last%20term%20of%20summation/near/229983247" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Benjamin Davidson <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/break.20off.20last.20term.20of.20summation.html#229983247">(Mar 12 2021 at 06:28)</a>:</h4>
<p><span class="user-mention" data-user-id="110087">@Scott Morrison</span> Should I then also try to make the same commutative change to the <code>prod</code> lemma?</p>



<a name="229984586"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/break%20off%20last%20term%20of%20summation/near/229984586" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/break.20off.20last.20term.20of.20summation.html#229984586">(Mar 12 2021 at 06:46)</a>:</h4>
<p>I don't get it. Why is to_additive not being used to prove the second lemma? Is it one of those weird cases where it doesn't work for some reason?</p>



<a name="229984795"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/break%20off%20last%20term%20of%20summation/near/229984795" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Benjamin Davidson <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/break.20off.20last.20term.20of.20summation.html#229984795">(Mar 12 2021 at 06:49)</a>:</h4>
<p><span class="user-mention" data-user-id="110038">@Kevin Buzzard</span> Exactly, that's why I did a double-take! Strangely, though, if you remove the first (<code>sum</code>) lemma, the second (<code>prod</code>) lemma breaks, and I'm not sure why.</p>



<a name="230253263"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/break%20off%20last%20term%20of%20summation/near/230253263" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Benjamin Davidson <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/break.20off.20last.20term.20of.20summation.html#230253263">(Mar 14 2021 at 16:42)</a>:</h4>
<p>See <a href="https://github.com/leanprover-community/mathlib/issues/6676">#6676</a></p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>