---
layout: archive
title: Zulip Chat Archive
permalink: /stream/217875-Is-there-code-for-X%3F/topic/Birthday.20Problem.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/index.html">Is there code for X?</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Birthday.20Problem.html">Birthday Problem</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="234270145"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Birthday%20Problem/near/234270145" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Hunter Monroe <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Birthday.20Problem.html#234270145">(Apr 13 2021 at 05:21)</a>:</h4>
<p>The birthday theorem is one of the 100 theorems not in Lean. To include this in lean, would it be sufficient to show 365/365 x 364/365 x ... x 343/365 &lt; 1/2? In other theorem provers, the theorem is stated as follows. So it takes as input the number of people s=23 and the number of days in the year t=365, and then generically gives a function of s  and t, such that the inequality holds for those particular s and t.</p>
<p>HOL: |- !s t. s HAS_SIZE 23 /\ t HAS_SIZE 365<br>
           ==&gt; 2 * CARD {f | f IN (s -&gt; t) /\<br>
                             ?x y. x IN s /\ y IN s /\ ~(x = y) /\ f(x) = f(y)}<br>
               &gt;= CARD (s -&gt; t)</p>
<p>Isabelle:  assumes "card S = 23" "card T = 365"<br>
  shows "2 * card {f ∈ S→\&lt;^sub&gt;E S T. ¬ inj_on f S} ≥ card (S →\&lt;^sub&gt;E T)"</p>
<p>Mizar: let l := picks 23 (enumerate 365) in<br>
  2 * length (filter collision l) &gt; length l.</p>



<a name="234270335"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Birthday%20Problem/near/234270335" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Birthday.20Problem.html#234270335">(Apr 13 2021 at 05:24)</a>:</h4>
<p>Personally, I would want to see it phrased in terms of probability theory.</p>



<a name="234270351"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Birthday%20Problem/near/234270351" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Birthday.20Problem.html#234270351">(Apr 13 2021 at 05:24)</a>:</h4>
<p>And mathlib doesn't have much in that direction, unfortunately.</p>



<a name="234273138"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Birthday%20Problem/near/234273138" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Birthday.20Problem.html#234273138">(Apr 13 2021 at 06:06)</a>:</h4>
<p><span class="user-mention" data-user-id="397140">@Hunter Monroe</span> Actually, I don't think it really has to be probability theory. But it should be a statement that is recognizably the Birthday problem, before any maths has been done.</p>



<a name="234273681"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Birthday%20Problem/near/234273681" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Birthday.20Problem.html#234273681">(Apr 13 2021 at 06:14)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">data.multiset</span>

<span class="kn">namespace</span> <span class="n">multiset</span>

<span class="kd">variables</span> <span class="o">{</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">decidable_eq</span> <span class="n">α</span><span class="o">]</span>

<span class="kd">def</span> <span class="n">likely_collision</span> <span class="o">(</span><span class="n">s</span> <span class="o">:</span> <span class="n">multiset</span> <span class="o">(</span><span class="n">multiset</span> <span class="n">α</span><span class="o">))</span> <span class="o">:</span> <span class="kt">Prop</span> <span class="o">:=</span>
<span class="mi">2</span> <span class="bp">*</span> <span class="o">(</span><span class="n">s.filter</span> <span class="n">nodup</span><span class="o">)</span><span class="bp">.</span><span class="n">card</span> <span class="bp">&lt;</span> <span class="n">s.card</span>

<span class="kd">theorem</span> <span class="n">birthday</span> <span class="o">:</span> <span class="n">likely_collision</span> <span class="o">((</span><span class="n">multiset.range</span> <span class="mi">365</span><span class="o">)</span><span class="bp">.</span><span class="n">powerset_len</span> <span class="mi">23</span><span class="o">)</span> <span class="o">:=</span>
<span class="gr">sorry</span>

<span class="kd">end</span> <span class="n">multiset</span>
</code></pre></div>



<a name="234273810"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Birthday%20Problem/near/234273810" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Birthday.20Problem.html#234273810">(Apr 13 2021 at 06:16)</a>:</h4>
<p>Or maybe</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">def</span> <span class="n">likely_collision</span> <span class="o">(</span><span class="n">s</span> <span class="o">:</span> <span class="n">multiset</span> <span class="o">(</span><span class="n">multiset</span> <span class="n">α</span><span class="o">))</span> <span class="o">:</span> <span class="kt">Prop</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">s.filter</span> <span class="n">nodup</span><span class="o">)</span><span class="bp">.</span><span class="n">card</span> <span class="bp">&lt;</span> <span class="o">(</span><span class="n">s.filter</span> <span class="bp">$</span> <span class="bp">λ</span> <span class="n">a</span><span class="o">,</span> <span class="bp">¬</span> <span class="n">nodup</span> <span class="n">a</span><span class="o">)</span><span class="bp">.</span><span class="n">card</span>
</code></pre></div>



<a name="234275832"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Birthday%20Problem/near/234275832" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Birthday.20Problem.html#234275832">(Apr 13 2021 at 06:42)</a>:</h4>
<p>Hmm, it seems that <code>multiset.powerset_len</code> doesn't do what I thought it does.</p>



<a name="234277328"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Birthday%20Problem/near/234277328" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Birthday.20Problem.html#234277328">(Apr 13 2021 at 06:59)</a>:</h4>
<p>I think this version is at least math-correct:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">data.vector2</span>
<span class="kn">import</span> <span class="n">data.fintype.card</span>

<span class="kn">open</span> <span class="n">fintype</span> <span class="o">(</span><span class="n">card</span><span class="o">)</span>

<span class="kd">variables</span> <span class="o">(</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">[</span><span class="n">decidable_eq</span> <span class="n">α</span><span class="o">]</span> <span class="o">[</span><span class="n">fintype</span> <span class="n">α</span><span class="o">]</span>

<span class="kd">def</span> <span class="n">likely_collision</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="o">:</span> <span class="kt">Prop</span> <span class="o">:=</span>
<span class="mi">2</span> <span class="bp">*</span> <span class="o">(</span><span class="n">finset.univ.filter</span> <span class="bp">$</span> <span class="bp">λ</span> <span class="n">l</span> <span class="o">:</span> <span class="n">vector</span> <span class="n">α</span> <span class="n">n</span><span class="o">,</span> <span class="n">l.to_list.nodup</span><span class="o">)</span><span class="bp">.</span><span class="n">card</span> <span class="bp">&lt;</span> <span class="n">card</span> <span class="o">(</span><span class="n">vector</span> <span class="n">α</span> <span class="n">n</span><span class="o">)</span>

<span class="kd">theorem</span> <span class="n">birthday</span> <span class="o">:</span> <span class="n">likely_collision</span> <span class="o">(</span><span class="n">fin</span> <span class="mi">365</span><span class="o">)</span> <span class="mi">23</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="n">unfold</span> <span class="n">likely_collision</span><span class="o">,</span>
  <span class="n">rw</span> <span class="o">[</span><span class="n">card_vector</span><span class="o">,</span> <span class="n">fintype.card_fin</span><span class="o">],</span>
  <span class="gr">sorry</span>
<span class="kd">end</span>
</code></pre></div>



<a name="234324017"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Birthday%20Problem/near/234324017" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bhavik Mehta <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Birthday.20Problem.html#234324017">(Apr 13 2021 at 13:26)</a>:</h4>
<p><span class="user-mention" data-user-id="401024">@Matt Kempster</span> has also been working on this, and I think he's made a reasonable amount of progress</p>



<a name="234335112"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Birthday%20Problem/near/234335112" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Matt Kempster <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Birthday.20Problem.html#234335112">(Apr 13 2021 at 14:28)</a>:</h4>
<p>Yes I have, should I post what I have so far? It's very WIP but I think it's on the right track. It's not probability theory based at all - just counting numbers of injective functions from fin 23 to fin 365 and dividing by all functions from fun 23 to fin 365. This is basically how Metamath does it</p>



<a name="234421282"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Birthday%20Problem/near/234421282" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joseph Myers <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Birthday.20Problem.html#234421282">(Apr 14 2021 at 00:07)</a>:</h4>
<p>The value of <code>fintype.card (α ↪ β)</code> (for arbitrary <code>[fintype α] [fintype β]</code>) seems like it belongs in mathlib proper, with only the evaluation for <code>fin 23</code> and <code>fin 365</code> going in the mathlib archive. (The denominator is given by <code>fintype.card_fun</code>.)</p>



<a name="234442605"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Birthday%20Problem/near/234442605" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Matt Kempster <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Birthday.20Problem.html#234442605">(Apr 14 2021 at 05:20)</a>:</h4>
<p>Yep, very on the same page there. I'll push to a branch soon (tomorrow if I find time), but my work is pretty messy so far. Look forward to input and advice!</p>



<a name="234719144"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Birthday%20Problem/near/234719144" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Hunter Monroe <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Birthday.20Problem.html#234719144">(Apr 15 2021 at 17:27)</a>:</h4>
<p>We would just need to show (finset.filter (λ (l : vector (fin n) k), l.to_list.nodup) finset.univ).card = n* (left hand side but with n-1, k-1)</p>



<a name="234719393"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Birthday%20Problem/near/234719393" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yakov Pechersky <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Birthday.20Problem.html#234719393">(Apr 15 2021 at 17:28)</a>:</h4>
<p>You can use <code>list.of_fn</code> to skip the vector</p>



<a name="234719770"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Birthday%20Problem/near/234719770" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yakov Pechersky <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Birthday.20Problem.html#234719770">(Apr 15 2021 at 17:31)</a>:</h4>
<p>You can also probably use things about <code>powerset</code> to automatically get nodup subsets</p>



<a name="234719925"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Birthday%20Problem/near/234719925" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yakov Pechersky <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Birthday.20Problem.html#234719925">(Apr 15 2021 at 17:32)</a>:</h4>
<p><a href="https://leanprover-community.github.io/mathlib_docs/find/finset.card_powerset_len">docs#finset.card_powerset_len</a></p>



<a name="234719996"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Birthday%20Problem/near/234719996" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yakov Pechersky <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Birthday.20Problem.html#234719996">(Apr 15 2021 at 17:32)</a>:</h4>
<p><a href="https://leanprover-community.github.io/mathlib_docs/find/finset.powerset_len_eq_filter">docs#finset.powerset_len_eq_filter</a></p>



<a name="234720437"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Birthday%20Problem/near/234720437" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yakov Pechersky <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Birthday.20Problem.html#234720437">(Apr 15 2021 at 17:35)</a>:</h4>
<p>You could generalize to any <code>pi</code> fintype, via something like <a href="https://leanprover-community.github.io/mathlib_docs/find/fintype.card_pi">docs#fintype.card_pi</a> and <a href="https://leanprover-community.github.io/mathlib_docs/find/fintype.card_fun">docs#fintype.card_fun</a></p>



<a name="234721885"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Birthday%20Problem/near/234721885" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yakov Pechersky <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Birthday.20Problem.html#234721885">(Apr 15 2021 at 17:44)</a>:</h4>
<p>Ah I see Joseph said this already</p>



<a name="235711847"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Birthday%20Problem/near/235711847" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Birthday.20Problem.html#235711847">(Apr 22 2021 at 16:57)</a>:</h4>
<p>So I've got a nearly finished version, actually, and just thought I should search on Zulip to check if anyone else has done it, and saw this... Sorry Matt!</p>



<a name="235711973"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Birthday%20Problem/near/235711973" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Birthday.20Problem.html#235711973">(Apr 22 2021 at 16:58)</a>:</h4>
<p>well, if a bunch of people work on different problems eventually two people will work on the same problem <span aria-label="grinning" class="emoji emoji-1f600" role="img" title="grinning">:grinning:</span></p>



<a name="235711988"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Birthday%20Problem/near/235711988" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Birthday.20Problem.html#235711988">(Apr 22 2021 at 16:58)</a>:</h4>
<p>One thing that I found is that <code>norm_num</code> is slow at evaluating stuff like <code>365!/(365-23)!</code>, so I made this class to help; do people think it belongs in mathlib proper?</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">def</span> <span class="n">reverse_fac</span> <span class="o">:</span> <span class="n">ℕ</span> <span class="bp">→</span> <span class="n">ℕ</span> <span class="bp">→</span> <span class="n">ℕ</span>
<span class="bp">|</span> <span class="mi">0</span> <span class="mi">0</span>       <span class="o">:=</span> <span class="mi">1</span>
<span class="bp">|</span> <span class="mi">0</span> <span class="o">(</span><span class="n">k</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)</span> <span class="o">:=</span> <span class="mi">1</span>
<span class="bp">|</span> <span class="o">(</span><span class="n">n</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)</span> <span class="mi">0</span> <span class="o">:=</span> <span class="mi">1</span>
<span class="bp">|</span> <span class="o">(</span><span class="n">n</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)</span> <span class="o">(</span><span class="n">k</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)</span> <span class="o">:=</span> <span class="o">(</span><span class="n">n</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)</span> <span class="bp">*</span> <span class="n">reverse_fac</span> <span class="n">n</span> <span class="n">k</span>
</code></pre></div>



<a name="235712112"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Birthday%20Problem/near/235712112" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Birthday.20Problem.html#235712112">(Apr 22 2021 at 16:59)</a>:</h4>
<p>(and basically one lemma guaranteeing that it truly is equal to n! / (n-k)!)</p>



<a name="235712279"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Birthday%20Problem/near/235712279" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Birthday.20Problem.html#235712279">(Apr 22 2021 at 17:00)</a>:</h4>
<p>Yeah, if you write <code>365!/(365-23)!</code> that's what norm_num will evaluate</p>



<a name="235712379"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Birthday%20Problem/near/235712379" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Birthday.20Problem.html#235712379">(Apr 22 2021 at 17:00)</a>:</h4>
<p>if you want to evaluate the product of 23 terms instead of 365 you should use a function that evaluates that way</p>



<a name="235712626"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Birthday%20Problem/near/235712626" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Birthday.20Problem.html#235712626">(Apr 22 2021 at 17:02)</a>:</h4>
<p>this is what reverse_fac does^^ just asking whether it's worth putting in mathlib or just keep it in the archive file</p>



<a name="235713065"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Birthday%20Problem/near/235713065" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Birthday.20Problem.html#235713065">(Apr 22 2021 at 17:04)</a>:</h4>
<p>isn't there already something like this?</p>



<a name="235713105"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Birthday%20Problem/near/235713105" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Birthday.20Problem.html#235713105">(Apr 22 2021 at 17:04)</a>:</h4>
<p>they are called rising and falling factorials IIRC</p>



<a name="235713277"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Birthday%20Problem/near/235713277" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Birthday.20Problem.html#235713277">(Apr 22 2021 at 17:05)</a>:</h4>
<p>Oh there is <a href="https://leanprover-community.github.io/mathlib_docs/find/pochhammer">docs#pochhammer</a> but it is only for polynomials</p>



<a name="235713279"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Birthday%20Problem/near/235713279" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Birthday.20Problem.html#235713279">(Apr 22 2021 at 17:05)</a>:</h4>
<p><a href="https://leanprover-community.github.io/mathlib_docs/find/ring_theory.polynomial.pochhammer">docs#ring_theory.polynomial.pochhammer</a>, maybe? edit: sniped :b</p>



<a name="235713424"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Birthday%20Problem/near/235713424" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Birthday.20Problem.html#235713424">(Apr 22 2021 at 17:06)</a>:</h4>
<p>i'll try retrofit it with the eval theorems it has there</p>



<a name="235713507"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Birthday%20Problem/near/235713507" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Birthday.20Problem.html#235713507">(Apr 22 2021 at 17:07)</a>:</h4>
<p>because it ended up _not_ being trivial as expected and instead I ended up with this disaster:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">theorem</span> <span class="n">eval_reverse_fac</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">n</span> <span class="n">k</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">,</span> <span class="n">k</span> <span class="bp">≤</span> <span class="n">n</span> <span class="bp">→</span> <span class="n">n</span><span class="bp">!</span> <span class="bp">/</span> <span class="o">(</span><span class="n">n</span> <span class="bp">-</span> <span class="n">k</span><span class="o">)</span><span class="bp">!</span> <span class="bp">=</span> <span class="n">reverse_fac</span> <span class="n">n</span> <span class="n">k</span>
<span class="bp">|</span> <span class="mi">0</span> <span class="mi">0</span>       <span class="o">:=</span> <span class="kd">by</span> <span class="n">simp</span><span class="bp">!</span>
<span class="bp">|</span> <span class="mi">0</span> <span class="o">(</span><span class="n">k</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)</span> <span class="o">:=</span> <span class="kd">by</span> <span class="n">simp</span><span class="bp">!</span>
<span class="bp">|</span> <span class="o">(</span><span class="n">n</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)</span> <span class="mi">0</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">_</span><span class="o">,</span> <span class="kd">by</span> <span class="o">{</span> <span class="n">rw</span> <span class="o">[</span><span class="n">nat.sub_zero</span><span class="o">,</span> <span class="n">nat.div_self</span><span class="o">],</span> <span class="n">unfold</span> <span class="n">reverse_fac</span><span class="o">,</span> <span class="n">apply</span> <span class="n">factorial_pos</span> <span class="o">}</span>
<span class="bp">|</span> <span class="o">(</span><span class="n">n</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)</span> <span class="o">(</span><span class="n">k</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)</span> <span class="o">:=</span> <span class="kd">begin</span>
  <span class="n">intro</span> <span class="n">h</span><span class="o">,</span> <span class="n">replace</span> <span class="n">h</span> <span class="o">:=</span> <span class="n">le_of_succ_le_succ</span> <span class="n">h</span><span class="o">,</span>
  <span class="n">simp</span> <span class="n">only</span> <span class="o">[</span><span class="n">reverse_fac</span><span class="o">,</span> <span class="n">factorial</span><span class="o">,</span> <span class="n">succ_eq_add_one</span><span class="o">,</span> <span class="n">succ_sub_succ_eq_sub</span><span class="o">],</span>
  <span class="n">rw</span> <span class="bp">←</span><span class="n">eval_reverse_fac</span> <span class="n">_</span> <span class="n">_</span> <span class="n">h</span><span class="o">,</span>

  <span class="c1">-- at this point, we have two slightly different divisions. we fix them both</span>

  <span class="n">apply</span> <span class="n">mul_left_cancel'</span> <span class="o">(</span><span class="n">factorial_ne_zero</span> <span class="o">(</span><span class="n">n</span> <span class="bp">-</span> <span class="n">k</span><span class="o">)),</span>
  <span class="n">obtain</span> <span class="o">⟨</span><span class="n">a</span><span class="o">,</span> <span class="n">ha</span><span class="o">⟩</span> <span class="o">:=</span> <span class="n">factorial_dvd_factorial</span> <span class="o">(</span><span class="n">sub_le</span> <span class="n">n</span> <span class="n">k</span><span class="o">),</span>
  <span class="n">rw</span> <span class="n">nat.mul_div_cancel'</span><span class="o">,</span>
    <span class="n">swap</span><span class="o">,</span> <span class="o">{</span><span class="n">use</span> <span class="n">a</span> <span class="bp">*</span> <span class="o">(</span><span class="n">n</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">),</span> <span class="n">rw</span> <span class="n">ha</span><span class="o">,</span> <span class="n">ring</span><span class="o">},</span>
  <span class="n">symmetry</span><span class="o">,</span>
  <span class="k">calc</span> <span class="o">(</span><span class="n">n</span> <span class="bp">-</span> <span class="n">k</span><span class="o">)</span><span class="bp">!</span> <span class="bp">*</span> <span class="o">((</span><span class="n">n</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)</span> <span class="bp">*</span> <span class="o">(</span><span class="n">n</span><span class="bp">!</span> <span class="bp">/</span> <span class="o">(</span><span class="n">n</span> <span class="bp">-</span> <span class="n">k</span><span class="o">)</span><span class="bp">!</span><span class="o">))</span> <span class="bp">=</span> <span class="o">(</span><span class="n">n</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)</span> <span class="bp">*</span> <span class="o">((</span><span class="n">n</span> <span class="bp">-</span> <span class="n">k</span><span class="o">)</span><span class="bp">!</span> <span class="bp">*</span> <span class="o">(</span><span class="n">n</span><span class="bp">!</span> <span class="bp">/</span> <span class="o">(</span><span class="n">n</span> <span class="bp">-</span> <span class="n">k</span><span class="o">)</span><span class="bp">!</span><span class="o">))</span> <span class="o">:</span> <span class="kd">by</span> <span class="n">ac_refl</span>
                                          <span class="bp">...</span> <span class="bp">=</span> <span class="o">(</span><span class="n">n</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)</span> <span class="bp">*</span> <span class="n">n</span><span class="bp">!</span> <span class="o">:</span> <span class="kd">by</span> <span class="n">rw</span> <span class="n">nat.mul_div_cancel'</span> <span class="o">⟨</span><span class="n">a</span><span class="o">,</span> <span class="n">ha</span><span class="o">⟩</span>
<span class="kd">end</span>

<span class="c1">-- If I don't put the `skip` it errors?! (`simp` won't do this on its own btw)</span>
<span class="kd">@[simp]</span> <span class="kd">lemma</span> <span class="n">rev_fac_zero</span> <span class="o">(</span><span class="n">m</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="o">:</span> <span class="n">reverse_fac</span> <span class="n">m</span> <span class="mi">0</span> <span class="bp">=</span> <span class="mi">1</span> <span class="o">:=</span> <span class="kd">by</span> <span class="o">{</span><span class="n">cases</span> <span class="n">m</span><span class="bp">;</span> <span class="n">simp</span><span class="bp">!</span><span class="o">,</span> <span class="n">skip</span><span class="o">}</span>

<span class="kd">@[simp]</span> <span class="kd">lemma</span> <span class="n">zero_rev_fac</span> <span class="o">(</span><span class="n">m</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="o">:</span> <span class="n">reverse_fac</span> <span class="mi">0</span> <span class="n">m</span> <span class="bp">=</span> <span class="mi">1</span> <span class="o">:=</span> <span class="kd">by</span> <span class="o">{</span><span class="n">cases</span> <span class="n">m</span><span class="bp">;</span> <span class="n">simp</span><span class="bp">!</span><span class="o">,</span> <span class="n">skip</span><span class="o">}</span>
</code></pre></div>



<a name="235713599"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Birthday%20Problem/near/235713599" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Birthday.20Problem.html#235713599">(Apr 22 2021 at 17:07)</a>:</h4>
<p>but yeah factorials API isn't super well-developed</p>



<a name="235714203"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Birthday%20Problem/near/235714203" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Birthday.20Problem.html#235714203">(Apr 22 2021 at 17:11)</a>:</h4>
<p>Note that norm_num doesn't actually know how to compute factorials. It's just rewriting with the simp lemmas for factorial</p>



<a name="235714286"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Birthday%20Problem/near/235714286" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Birthday.20Problem.html#235714286">(Apr 22 2021 at 17:12)</a>:</h4>
<p>if you use simp lemmas for <code>reverse_fac</code> it will be just as good</p>



<a name="235714456"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Birthday%20Problem/near/235714456" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Birthday.20Problem.html#235714456">(Apr 22 2021 at 17:13)</a>:</h4>
<p>The reason your proof is a disaster is because you used <code>-</code> and <code>/</code> on <code>nat</code></p>



<a name="235714485"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Birthday%20Problem/near/235714485" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Birthday.20Problem.html#235714485">(Apr 22 2021 at 17:13)</a>:</h4>
<p>you should rewrite the theorem to use <code>+</code> and <code>*</code></p>



<a name="235714535"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Birthday%20Problem/near/235714535" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Birthday.20Problem.html#235714535">(Apr 22 2021 at 17:13)</a>:</h4>
<p>ahh, so instead I could do it as <code>(n + k)! = n! reverse_fac blah</code></p>



<a name="235714802"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Birthday%20Problem/near/235714802" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Birthday.20Problem.html#235714802">(Apr 22 2021 at 17:15)</a>:</h4>
<p>is it worth expressing the card as a division still or as this function? just thinking as it's going in mathlib</p>



<a name="235715321"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Birthday%20Problem/near/235715321" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Birthday.20Problem.html#235715321">(Apr 22 2021 at 17:19)</a>:</h4>
<p>for the birthday problem itself you should use a division for presentation purposes</p>



<a name="235715382"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Birthday%20Problem/near/235715382" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Birthday.20Problem.html#235715382">(Apr 22 2021 at 17:19)</a>:</h4>
<p>but once you have proven the lemma with <code>+</code> and <code>*</code> it's not hard to postprocess it to the <code>-</code> and <code>/</code> version</p>



<a name="235715643"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Birthday%20Problem/near/235715643" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Birthday.20Problem.html#235715643">(Apr 22 2021 at 17:21)</a>:</h4>
<p>I mean for the <code>card_embedding</code> function that will be kind of like <a href="https://leanprover-community.github.io/mathlib_docs/find/fintype.card_fun">docs#fintype.card_fun</a></p>



<a name="235771739"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Birthday%20Problem/near/235771739" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Matt Kempster <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Birthday.20Problem.html#235771739">(Apr 23 2021 at 01:00)</a>:</h4>
<p><span class="user-mention silent" data-user-id="284160">Eric Rodriguez</span> <a href="#narrow/stream/217875-Is-there.20code.20for.20X.3F/topic/Birthday.20Problem/near/235711847">said</a>:</p>
<blockquote>
<p>So I've got a nearly finished version, actually, and just thought I should search on Zulip to check if anyone else has done it, and saw this... Sorry Matt!</p>
</blockquote>
<p>No worries! I actually would say I was only ~30% done, and was starting to hit some major road blocks. I look forward to seeing your proof to compare &amp; contrast with my skeleton!</p>



<a name="236064517"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Birthday%20Problem/near/236064517" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Birthday.20Problem.html#236064517">(Apr 25 2021 at 13:15)</a>:</h4>
<p>It's done! The birthday problem has now been reduced to a call to <code>norm_num</code> :D Cleaning up the code, PR incoming soon :)</p>



<a name="236068933"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Birthday%20Problem/near/236068933" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Birthday.20Problem.html#236068933">(Apr 25 2021 at 14:24)</a>:</h4>
<p>Hmm, how to make Lean give up on code versions that I've already overwritten? For example, say I'm editing a big file, and I add an import, it'll start screaming at me that <code>data.finset.basi</code> doesn't exist, whilst of course I had typed <code>data.finset.basic</code> and it was just sort of delayed and doing old code, before trying again</p>



<a name="236069149"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Birthday%20Problem/near/236069149" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Birthday.20Problem.html#236069149">(Apr 25 2021 at 14:27)</a>:</h4>
<p>Restart vs code?</p>



<a name="236069582"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Birthday%20Problem/near/236069582" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Birthday.20Problem.html#236069582">(Apr 25 2021 at 14:35)</a>:</h4>
<p>hmm, wasn't too helpful. I'll just let CI deal with it, I'm only copy-pasting stuff right now anyways</p>



<a name="236069631"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Birthday%20Problem/near/236069631" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Birthday.20Problem.html#236069631">(Apr 25 2021 at 14:36)</a>:</h4>
<p>I changed stuff in <code>embedding.lean</code> and <code>fintype.lean</code> so I'm assuming it needs to recheck everything again, lol</p>



<a name="236071332"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Birthday%20Problem/near/236071332" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Birthday.20Problem.html#236071332">(Apr 25 2021 at 15:02)</a>:</h4>
<p><a href="https://github.com/leanprover-community/mathlib/issues/7363">#7363</a>!</p>



<a name="236071677"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/Birthday%20Problem/near/236071677" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/217875-Is-there-code-for-X%3F/topic/Birthday.20Problem.html#236071677">(Apr 25 2021 at 15:04)</a>:</h4>
<p>There's still a couple things to be done, but all the code itself is there ready to review; the other things are basically admin</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>