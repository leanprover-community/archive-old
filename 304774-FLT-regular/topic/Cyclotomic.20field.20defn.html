---
layout: archive
title: Zulip Chat Archive
permalink: /stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/index.html">FLT regular</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html">Cyclotomic field defn</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="258990096"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/258990096" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#258990096">(Oct 25 2021 at 17:09)</a>:</h4>
<p>I noticed this project so far is working with <code>adjoin_root cyclotomic</code>. I wonder if instead, <code>X^n-1.splitting_field</code>is a better option. I think the second option is better suited to Galois theory (as then the <code>.gal</code>has good defeq) and also easier to generalise to other fields. (it works for all fields with n ≠ 0, whilst I think this one may not)</p>



<a name="258990483"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/258990483" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Chris Birkbeck <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#258990483">(Oct 25 2021 at 17:12)</a>:</h4>
<p>I'm not sure how much Galois theory this project would strictly need. That said, maybe for more general things it would be good to have something that plays well with Galois theory.</p>



<a name="258990622"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/258990622" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#258990622">(Oct 25 2021 at 17:13)</a>:</h4>
<p>Yeah, the gal stuff I didn't mean for the project specifically, but just for general usage</p>



<a name="258991495"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/258991495" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#258991495">(Oct 25 2021 at 17:19)</a>:</h4>
<p>I hit some issues I didn't understand with the splitting field definition (see <a href="#narrow/stream/113488-general/topic/synthesized.20type.20class.20instance.20is.20not.20definitionally.20equal/near/258373075">https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/synthesized.20type.20class.20instance.20is.20not.20definitionally.20equal/near/258373075</a>)</p>



<a name="258991633"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/258991633" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#258991633">(Oct 25 2021 at 17:20)</a>:</h4>
<p>That said we should definitely provide an instance of <code>is_splitting_field</code> for our field, would that be sufficient for the gal defeq or no?</p>



<a name="258993105"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/258993105" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#258993105">(Oct 25 2021 at 17:31)</a>:</h4>
<p>.gal is defined as _.splitting_field alg_equiv[polynomial's base ring] _.splitting_field so no; we wouldn't have that the automorphisms are the same, although maybe a nice stopgap is to just provide the alg_equiv between the two and work with that</p>



<a name="258993244"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/258993244" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#258993244">(Oct 25 2021 at 17:32)</a>:</h4>
<p>For non Q rings its also nontrivial to show that the cyclotomic splf is the same as the X^n-1 splf; so that's another thing to consider (I spent a while on this)</p>



<a name="258993312"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/258993312" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thomas Browning <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#258993312">(Oct 25 2021 at 17:33)</a>:</h4>
<p>When proving abel-ruffini, I think we did things in terms of <code>X ^ n - 1</code>, and it seemed to work fine. I would suggest making a definition <code>cyclotomic_field n = (X ^ n - 1).splitting_field</code>.</p>



<a name="258993843"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/258993843" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thomas Browning <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#258993843">(Oct 25 2021 at 17:37)</a>:</h4>
<p>With regards to Galois theory, <code>polynomial.gal</code> is not what you should be using. We did most Galois theory in terms of arbitrary normal separable field extensions (see <code>galois.lean</code>).</p>



<a name="258994609"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/258994609" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thomas Browning <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#258994609">(Oct 25 2021 at 17:42)</a>:</h4>
<p>In particular, a result like "the Galois group of <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="double-struck">Q</mi><mo stretchy="false">(</mo><msub><mi>ζ</mi><mi>n</mi></msub><mo stretchy="false">)</mo><mi mathvariant="normal">/</mi><mi mathvariant="double-struck">Q</mi></mrow><annotation encoding="application/x-tex">\mathbb{Q}(\zeta_n)/\mathbb{Q}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathbb">Q</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07378em;">ζ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.07378em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mord">/</span><span class="mord mathbb">Q</span></span></span></span> is <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi mathvariant="double-struck">Z</mi><mi mathvariant="normal">/</mi><mi>n</mi><mi mathvariant="double-struck">Z</mi><msup><mo stretchy="false">)</mo><mo>×</mo></msup></mrow><annotation encoding="application/x-tex">(\mathbb{Z}/n\mathbb{Z})^\times</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.021331em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathbb">Z</span><span class="mord">/</span><span class="mord mathnormal">n</span><span class="mord mathbb">Z</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.771331em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mbin mtight">×</span></span></span></span></span></span></span></span></span></span></span>" should be phrased in terms of <code>E ≃ₐ[F] E</code>, rather than <code>(X ^ n - 1).gal</code>.</p>



<a name="258994671"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/258994671" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#258994671">(Oct 25 2021 at 17:42)</a>:</h4>
<p>What is the point of <code>polynomial.gal</code> then?</p>



<a name="258994947"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/258994947" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thomas Browning <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#258994947">(Oct 25 2021 at 17:45)</a>:</h4>
<p>Mostly, it's for when you're just interested in Galois groups of polynomials, rather than Galois groups of field extensions more generally. We used it for proving abel-ruffini.</p>



<a name="258995838"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/258995838" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#258995838">(Oct 25 2021 at 17:52)</a>:</h4>
<p>Well, if we are not able to prove <code>is_splitting_field</code> then it means something is missing the cyclotomic polynomial API, or somewhere else. And the whole API for splitting fields should use <code>is_splitting_field</code>.</p>



<a name="258996125"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/258996125" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#258996125">(Oct 25 2021 at 17:54)</a>:</h4>
<p>I am almost tempted to have <code>is_cyclotomic_field</code></p>



<a name="258996322"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/258996322" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#258996322">(Oct 25 2021 at 17:56)</a>:</h4>
<p>That would just be <code>is_splitting_field (X ^ n - 1)</code> right? I think that should suffice (at least for now).</p>



<a name="258996982"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/258996982" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#258996982">(Oct 25 2021 at 18:01)</a>:</h4>
<p>Yes, sure</p>



<a name="258996996"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/258996996" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#258996996">(Oct 25 2021 at 18:01)</a>:</h4>
<p>Let me try</p>



<a name="259001768"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259001768" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259001768">(Oct 25 2021 at 18:37)</a>:</h4>
<p>OK, <code>is_cyclotomic_field</code> seems to work. But now we have the problem for <code>cyclotomic_ring</code>...</p>



<a name="259002290"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259002290" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Chris Birkbeck <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259002290">(Oct 25 2021 at 18:41)</a>:</h4>
<p>the definition of <code>zeta'</code> in <code>cyclotomic_units</code>  seems to  now be broken.</p>



<a name="259002791"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259002791" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259002791">(Oct 25 2021 at 18:44)</a>:</h4>
<p>Do we already have some sort of <code>is_ring_of_integers</code>?</p>



<a name="259002826"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259002826" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259002826">(Oct 25 2021 at 18:45)</a>:</h4>
<p><span class="user-mention" data-user-id="238446">@Anne Baanen</span> I forgot the status...</p>



<a name="259003154"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259003154" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259003154">(Oct 25 2021 at 18:47)</a>:</h4>
<p><span class="user-mention silent" data-user-id="389019">Chris Birkbeck</span> <a href="#narrow/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn/near/259002290">said</a>:</p>
<blockquote>
<p>the definition of <code>zeta'</code> in <code>cyclotomic_units</code>  seems to  now be broken.</p>
</blockquote>
<p>I am fixing it</p>



<a name="259004227"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259004227" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259004227">(Oct 25 2021 at 18:55)</a>:</h4>
<p><span class="user-mention silent" data-user-id="112680">Johan Commelin</span> <a href="#narrow/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn/near/259002791">said</a>:</p>
<blockquote>
<p>Do we already have some sort of <code>is_ring_of_integers</code>?</p>
</blockquote>
<p>I guess something like <code>[is_fraction_ring S L] [is_dedekind_domain S]</code> takes that role?</p>



<a name="259004537"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259004537" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thomas Browning <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259004537">(Oct 25 2021 at 18:58)</a>:</h4>
<p>Could we just use <code>ring_of_integers</code>, and prove that <code>ring_of_integers</code> equals <code>algebra.adjoin</code>?</p>



<a name="259005150"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259005150" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259005150">(Oct 25 2021 at 19:03)</a>:</h4>
<p>Well, the point is that if we use <code>is_cyclotomic_fields</code> (that is nothing else than <code>is_splitting_field</code>) we probably want a characteristic predicate also for the ring of integers.</p>



<a name="259005911"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259005911" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259005911">(Oct 25 2021 at 19:09)</a>:</h4>
<p>It seems to me we have to decide how to write things before going on writing lemmas. If we change the basic definition then refactoring everything is going to be rather painful.</p>
<p>Let's start with the cyclotomic field. The most "clean" way I see is to define</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">class</span> <span class="n">is_cyclotomic_field</span> <span class="o">:</span> <span class="kt">Prop</span> <span class="o">:=</span> <span class="o">(</span><span class="n">out</span> <span class="o">:</span> <span class="n">is_splitting_field</span> <span class="n">ℚ</span> <span class="n">K</span> <span class="o">(</span><span class="n">X</span> <span class="bp">^</span> <span class="n">n</span> <span class="bp">-</span> <span class="mi">1</span><span class="o">))</span>
</code></pre></div>
<p>for <code>(K : Type*) [field K] [char_zero K]</code>. Of course we can have the explicit model</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">def</span> <span class="n">cyclotomic_field</span> <span class="o">[</span><span class="n">fact</span> <span class="o">(</span><span class="mi">0</span> <span class="bp">&lt;</span> <span class="n">n</span><span class="o">)]</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span> <span class="o">:=</span> <span class="n">adjoin_root</span> <span class="o">(</span><span class="n">cyclotomic</span> <span class="n">n</span> <span class="n">ℚ</span><span class="o">)</span>

<span class="kd">instance</span> <span class="o">:</span> <span class="n">is_cyclotomic_field</span> <span class="n">n</span> <span class="o">(</span><span class="n">cyclotomic_field</span> <span class="n">n</span><span class="o">)</span> <span class="o">:=</span> <span class="gr">sorry</span>
</code></pre></div>



<a name="259006038"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259006038" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259006038">(Oct 25 2021 at 19:10)</a>:</h4>
<p>Then everything is stated using <code>(K : Type*) [field K] [char_zero K] [is_cyclotomic_field p K]</code>, for example</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">def</span> <span class="n">zeta'</span> <span class="o">:</span> <span class="n">K</span> <span class="o">:=</span>
<span class="n">classical.some</span> <span class="o">(</span><span class="n">exists_root_of_splits</span> <span class="o">(</span><span class="n">algebra_map</span> <span class="n">ℚ</span> <span class="n">K</span><span class="o">)</span> <span class="o">(</span><span class="n">is_splitting_field.splits</span> <span class="n">_</span> <span class="n">_</span><span class="o">)</span>
  <span class="o">(</span><span class="n">degree_cyclotomic_pos</span> <span class="n">p</span> <span class="n">ℚ</span> <span class="n">hn.out</span><span class="o">)</span><span class="bp">.</span><span class="n">ne.symm</span><span class="o">)</span>
</code></pre></div>



<a name="259006114"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259006114" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259006114">(Oct 25 2021 at 19:11)</a>:</h4>
<p>The point of taking this approach is that the definition of <code>cyclotomic_field</code> doesn't matter, it is the fact that it has the <code>is_cyclotomic_field</code> instance that makes everything working.</p>



<a name="259007455"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259007455" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259007455">(Oct 25 2021 at 19:22)</a>:</h4>
<p>Yeah as long as we stick to a reasonable API it doesn't make too much difference which definition we end up using i hope</p>



<a name="259007581"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259007581" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259007581">(Oct 25 2021 at 19:23)</a>:</h4>
<p>And I think it's hard to make decisions about what actual definitions to use without trying them and seeing what goes right and wrong</p>



<a name="259007831"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259007831" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259007831">(Oct 25 2021 at 19:25)</a>:</h4>
<p>Ah, we have <a href="https://leanprover-community.github.io/mathlib_docs/find/is_integral_closure">docs#is_integral_closure</a>!</p>



<a name="259007984"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259007984" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259007984">(Oct 25 2021 at 19:26)</a>:</h4>
<p>So I suggest we try to use characteristic predicates everywhere. If at some point it becomes to complicated we can always start using the explicit models, but going the other way is going to be painful</p>



<a name="259010368"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259010368" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259010368">(Oct 25 2021 at 19:47)</a>:</h4>
<p>I know this isn't the focus of this project, but I really don't want to have multiple defns all over the place, so:<br>
<a href="https://kconrad.math.uconn.edu/blurbs/galoistheory/cyclotomic.pdf">https://kconrad.math.uconn.edu/blurbs/galoistheory/cyclotomic.pdf</a> suggests that cyclotomic fields works over char p in some cases. I think if we're defining this this way, it may be easier to say that is_cyclotomic_field n means that the nth roots of unity are full, which gives us zeta automatically (<a href="https://github.com/leanprover-community/mathlib/issues/9778">#9778</a> or <a href="https://github.com/leanprover-community/mathlib/issues/9779">#9779</a>, can't remember).</p>



<a name="259010406"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259010406" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259010406">(Oct 25 2021 at 19:47)</a>:</h4>
<p>The current way, the definition does not work for char p cyclotomic extensions</p>



<a name="259011668"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259011668" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259011668">(Oct 25 2021 at 19:57)</a>:</h4>
<p>Oh, I just realised what the second condition actually meant in is_splitting_field (which is totally sensible of course).</p>



<a name="259011724"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259011724" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259011724">(Oct 25 2021 at 19:57)</a>:</h4>
<p>Still, the current defn of the predicate isn't good either</p>



<a name="259015670"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259015670" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259015670">(Oct 25 2021 at 20:25)</a>:</h4>
<p>I don't understand which definition you propose.  You say "is_cyclotomic_field n means that the nth roots of unity are full", but this is satisfied by, for example, the complex numbers. We need in a way or in another specify that it is the splitting field, and not bigger.</p>



<a name="259015775"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259015775" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259015775">(Oct 25 2021 at 20:26)</a>:</h4>
<p>And this seems annoying to treat uniformly in char 0 and char p</p>



<a name="259015781"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259015781" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259015781">(Oct 25 2021 at 20:26)</a>:</h4>
<p>Generally a field extension <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>L</mi><mi mathvariant="normal">∣</mi><mi>K</mi></mrow><annotation encoding="application/x-tex">L|K</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">L</span><span class="mord">∣</span><span class="mord mathnormal" style="margin-right:0.07153em;">K</span></span></span></span> is called "cyclotomic" if it is "generated" by roots of unity.</p>



<a name="259015857"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259015857" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259015857">(Oct 25 2021 at 20:27)</a>:</h4>
<p>Yeah, sure, but we want something like <em>the</em> n-th cyclotomic field...</p>



<a name="259015903"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259015903" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259015903">(Oct 25 2021 at 20:27)</a>:</h4>
<p>What's the problem with char p?</p>



<a name="259015944"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259015944" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259015944">(Oct 25 2021 at 20:27)</a>:</h4>
<p>The p-cyclotomic extension of a field <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>K</mi></mrow><annotation encoding="application/x-tex">K</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">K</span></span></span></span> of characteristic <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi></mrow><annotation encoding="application/x-tex">p</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathnormal">p</span></span></span></span> is <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>K</mi></mrow><annotation encoding="application/x-tex">K</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">K</span></span></span></span> itself.</p>



<a name="259016015"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259016015" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259016015">(Oct 25 2021 at 20:28)</a>:</h4>
<p>I mean, if I want to use <code>is_splitting_field</code></p>



<a name="259016021"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259016021" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259016021">(Oct 25 2021 at 20:28)</a>:</h4>
<p>I need a base field</p>



<a name="259016148"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259016148" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259016148">(Oct 25 2021 at 20:29)</a>:</h4>
<p>What about <code>is_cyclotomic_extension F K n</code>?</p>



<a name="259016275"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259016275" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259016275">(Oct 25 2021 at 20:30)</a>:</h4>
<p>Defined using <code>is_splitting_field</code>?</p>



<a name="259016284"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259016284" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thomas Browning <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259016284">(Oct 25 2021 at 20:30)</a>:</h4>
<p>meaning?</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">class</span> <span class="n">is_cyclotomic_extension</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">out</span> <span class="o">:</span> <span class="n">is_splitting_field</span> <span class="n">F</span> <span class="n">K</span> <span class="o">(</span><span class="n">X</span> <span class="bp">^</span> <span class="n">n</span> <span class="bp">-</span> <span class="mi">1</span><span class="o">))</span>
</code></pre></div>



<a name="259016348"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259016348" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259016348">(Oct 25 2021 at 20:30)</a>:</h4>
<p>We will probably need some <code>abbreviation</code> to avoid writing <code>Q</code> everywhere, but why not</p>



<a name="259016475"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259016475" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259016475">(Oct 25 2021 at 20:31)</a>:</h4>
<p><span class="user-mention silent" data-user-id="253861">Thomas Browning</span> <a href="#narrow/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn/near/259016284">said</a>:</p>
<blockquote>
<p>meaning?</p>
<p><div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">class</span> <span class="n">is_cyclotomic_extension</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">out</span> <span class="o">:</span> <span class="n">is_splitting_field</span> <span class="n">F</span> <span class="n">K</span> <span class="o">(</span><span class="n">X</span> <span class="bp">^</span> <span class="n">n</span> <span class="bp">-</span> <span class="mi">1</span><span class="o">))</span>
</code></pre></div><br>
</p>
</blockquote>
<p>You can even just do</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">abbreviation</span>  <span class="n">is_cyclotomic_extension</span> <span class="o">:=</span> <span class="bp">...</span>
</code></pre></div>



<a name="259018057"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259018057" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259018057">(Oct 25 2021 at 20:44)</a>:</h4>
<p>I am done for today, but the basic definitions (for fields) are in <code>src/number_theory/cyclotomic/field/basic.lean</code>. If someone wants to generalize these to <code>is_cyclotomic_extension F n</code> please go ahead. Just be sure to provide the relevant instances, even only in char 0 (<code>sorry</code> as proof is perfectly fine of course).</p>



<a name="259018270"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259018270" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259018270">(Oct 25 2021 at 20:46)</a>:</h4>
<p><code>src/number_theory/cyclotomic/ring/</code> is for the ring of integers, it contains the statement</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">lemma</span> <span class="n">eq_adjoin</span> <span class="o">:</span> <span class="n">cyclotomic_ring</span> <span class="n">n</span> <span class="bp">=</span>
  <span class="n">algebra.adjoin</span> <span class="n">ℤ</span> <span class="o">{</span><span class="n">adjoin_root.root</span> <span class="o">(</span><span class="n">cyclotomic</span> <span class="n">n</span> <span class="n">ℚ</span><span class="o">)}</span> <span class="o">:=</span> <span class="gr">sorry</span>
</code></pre></div>
<p>that should be generalized to any <code>R [is_cyclotomic_ring R K]</code>.</p>



<a name="259019951"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259019951" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thomas Browning <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259019951">(Oct 25 2021 at 21:00)</a>:</h4>
<p>Could I have permission to push? (username tb65536)</p>



<a name="259028066"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259028066" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259028066">(Oct 25 2021 at 22:19)</a>:</h4>
<p>I'd also like it (although I won't for a bit) [user: ericrbg]</p>



<a name="259028862"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259028862" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259028862">(Oct 25 2021 at 22:25)</a>:</h4>
<p><span class="user-mention" data-user-id="253861">@Thomas Browning</span>, <span class="user-mention" data-user-id="284160">@Eric Rodriguez</span>, I've sent an invitation with write access.</p>



<a name="259031890"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259031890" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259031890">(Oct 25 2021 at 23:00)</a>:</h4>
<p>Just thinking out loud about defining cyclotomic extensions which will include the infinite case as well. Here's one proposal</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">field_theory.splitting_field</span>
<span class="kn">import</span> <span class="n">data.pnat.basic</span>

<span class="kd">structure</span> <span class="n">truncation_set</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">S</span> <span class="o">:</span> <span class="n">set</span> <span class="n">pnat</span><span class="o">)</span>
<span class="o">(</span><span class="n">div</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span><span class="o">)</span> <span class="o">:</span> <span class="n">a</span> <span class="bp">∈</span> <span class="n">S</span> <span class="bp">→</span> <span class="n">b</span> <span class="bp">∣</span> <span class="n">a</span> <span class="bp">→</span> <span class="n">b</span> <span class="bp">∈</span> <span class="n">S</span><span class="o">)</span>

<span class="kd">instance</span> <span class="n">truncation_set.has_mem</span> <span class="o">:</span> <span class="n">has_mem</span> <span class="n">pnat</span> <span class="n">truncation_set</span> <span class="o">:=</span> <span class="o">⟨</span><span class="bp">λ</span> <span class="n">a</span> <span class="n">S</span><span class="o">,</span> <span class="n">a</span> <span class="bp">∈</span> <span class="n">S.S</span><span class="o">⟩</span>

<span class="kd">class</span> <span class="n">is_cyclotomic_extension</span> <span class="o">(</span><span class="n">K</span> <span class="n">L</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">[</span><span class="n">field</span> <span class="n">K</span><span class="o">]</span> <span class="o">[</span><span class="n">field</span> <span class="n">L</span><span class="o">]</span> <span class="o">[</span><span class="n">algebra</span> <span class="n">K</span> <span class="n">L</span><span class="o">]</span> <span class="o">(</span><span class="n">S</span> <span class="o">:</span> <span class="n">truncation_set</span><span class="o">)</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">splits</span> <span class="o">(</span><span class="n">a</span> <span class="o">:</span> <span class="n">pnat</span><span class="o">)</span> <span class="o">(</span><span class="n">ha</span> <span class="o">:</span> <span class="n">a</span> <span class="bp">∈</span> <span class="n">S</span><span class="o">)</span> <span class="o">:</span> <span class="n">polynomial.splits</span> <span class="o">(</span><span class="n">algebra_map</span> <span class="n">K</span> <span class="n">L</span><span class="o">)</span> <span class="o">(</span><span class="n">polynomial.X</span><span class="bp">^</span><span class="o">(</span><span class="n">a</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="bp">-</span> <span class="mi">1</span><span class="o">))</span>
<span class="o">(</span><span class="n">adjoint_roots</span> <span class="o">:</span> <span class="n">algebra.adjoin</span> <span class="n">K</span> <span class="o">{</span> <span class="n">b</span> <span class="o">:</span> <span class="n">L</span> <span class="bp">|</span> <span class="bp">∃</span> <span class="n">a</span> <span class="o">:</span> <span class="n">pnat</span><span class="o">,</span> <span class="n">a</span> <span class="bp">∈</span> <span class="n">S</span> <span class="bp">∧</span> <span class="n">b</span><span class="bp">^</span><span class="o">(</span><span class="n">a</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="bp">=</span> <span class="mi">1</span> <span class="o">}</span> <span class="bp">=</span> <span class="bp">⊤</span><span class="o">)</span> <span class="c1">-- or some other equivalent condition</span>
</code></pre></div>
<p>Note that truncation sets also show up in the theory of big Witt vectors, so it wouldn't hurt to have that definition anyway :)</p>



<a name="259033163"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259033163" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thomas Browning <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259033163">(Oct 25 2021 at 23:15)</a>:</h4>
<p>If you're dealing with cyclotomic extensions, it seems like you should be looking at subsets of the integers closed under multiplication and taking divisors? (i.e., pick an <code>enat</code>for each prime).</p>



<a name="259033774"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259033774" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259033774">(Oct 25 2021 at 23:24)</a>:</h4>
<p>Why closed under multiplication?</p>



<a name="259033900"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259033900" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259033900">(Oct 25 2021 at 23:26)</a>:</h4>
<p>With the truncation set approach, I can consider the set {1,5} to consider  <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>K</mi><mo stretchy="false">(</mo><msub><mi>μ</mi><mn>5</mn></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">K(\mu_5)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">μ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">5</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span>, I can consider all powers of 5 to consider <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>K</mi><mo stretchy="false">(</mo><msub><mi>μ</mi><msup><mn>5</mn><mi mathvariant="normal">∞</mi></msup></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">K(\mu_{5^\infty})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">μ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mtight">5</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.5935428571428571em;"><span style="top:-2.786em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">∞</span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span>, etc</p>



<a name="259034082"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259034082" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259034082">(Oct 25 2021 at 23:29)</a>:</h4>
<p><span class="user-mention" data-user-id="253861">@Thomas Browning</span> I don't think making is_cyclotomic_field an abbreviation is looking like a good idea, it causes a typeclass loop according to #lint.</p>



<a name="259035012"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259035012" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thomas Browning <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259035012">(Oct 25 2021 at 23:45)</a>:</h4>
<p><span class="user-mention silent" data-user-id="243562">Adam Topaz</span> <a href="#narrow/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn/near/259033774">said</a>:</p>
<blockquote>
<p>Why closed under multiplication?</p>
</blockquote>
<p>Sorry, I meant closed under lcm.</p>



<a name="259035057"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259035057" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thomas Browning <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259035057">(Oct 25 2021 at 23:45)</a>:</h4>
<p><span class="user-mention silent" data-user-id="127136">Alex J. Best</span> <a href="#narrow/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn/near/259034082">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="253861">Thomas Browning</span> I don't think making is_cyclotomic_field an abbreviation is looking like a good idea, it causes a typeclass loop according to #lint.</p>
</blockquote>
<p>Ah, thanks for pointing this out. I'll push a fix (unless someone gets to it before me)</p>



<a name="259041730"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259041730" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259041730">(Oct 26 2021 at 01:35)</a>:</h4>
<p>Sure, adding a condition saying closed under lcm should be fine. I think if you take the lcm closure T of a truncation set S, then the projection W_T to W_S on big Witt vectors is an isomorphism.</p>



<a name="259052095"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259052095" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thomas Browning <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259052095">(Oct 26 2021 at 04:55)</a>:</h4>
<p>I feel like this is some sort of "completion" of the divisibility poset (you can "go off to infinity" at any subset of primes). Is there a way to generalize this precisely?</p>



<a name="259067870"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259067870" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259067870">(Oct 26 2021 at 08:48)</a>:</h4>
<p>I like Adam's idea. Indeed infinite cyclotomic extensions are more common than char p cyclotomic extensions (at least in what I do). The definition makes sense even for an arbitrary <code>S : set pnat</code>, right? We can have something like <code>is_truncation_set</code>, to use this assumption.</p>



<a name="259067902"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259067902" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259067902">(Oct 26 2021 at 08:49)</a>:</h4>
<p>In this way the definition is really super general, and we can always add other conditions later on.</p>



<a name="259068528"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259068528" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Chris Birkbeck <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259068528">(Oct 26 2021 at 08:56)</a>:</h4>
<p>I agree infinite cyclotomic extensions would be great.</p>



<a name="259068997"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259068997" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259068997">(Oct 26 2021 at 09:01)</a>:</h4>
<p>And it seems to me <code>S : set nat</code> is fine... if <code>S = {0}</code> we get <code>L = K</code></p>



<a name="259069034"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259069034" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259069034">(Oct 26 2021 at 09:01)</a>:</h4>
<p>This is of course mathematically irrelevant, but usually working with <code>nat</code> is easier than working with <code>pnat</code>.</p>



<a name="259087039"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259087039" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259087039">(Oct 26 2021 at 12:17)</a>:</h4>
<p>It seems the most general definition is</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">class</span> <span class="n">is_cyclotomic_extension</span> <span class="o">(</span><span class="n">K</span> <span class="n">L</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">[</span><span class="n">comm_ring</span> <span class="n">K</span><span class="o">]</span> <span class="o">[</span><span class="n">ring</span> <span class="n">L</span><span class="o">]</span> <span class="o">[</span><span class="n">algebra</span> <span class="n">K</span> <span class="n">L</span><span class="o">]</span> <span class="o">(</span><span class="n">S</span> <span class="o">:</span> <span class="n">set</span> <span class="n">nat</span><span class="o">)</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">ex_root</span> <span class="o">(</span><span class="n">a</span> <span class="o">:</span> <span class="n">nat</span><span class="o">)</span> <span class="o">(</span><span class="n">ha</span> <span class="o">:</span> <span class="n">a</span> <span class="bp">∈</span> <span class="n">S</span><span class="o">)</span> <span class="o">:</span> <span class="bp">∃</span> <span class="n">r</span> <span class="o">:</span> <span class="n">L</span><span class="o">,</span> <span class="n">polynomial.aeval</span> <span class="n">r</span> <span class="o">(</span><span class="n">polynomial.cyclotomic</span> <span class="n">a</span> <span class="n">K</span><span class="o">)</span> <span class="bp">=</span> <span class="mi">0</span><span class="o">)</span>
<span class="o">(</span><span class="n">adjoint_roots</span> <span class="o">:</span> <span class="n">algebra.adjoin</span> <span class="n">K</span> <span class="o">{</span> <span class="n">b</span> <span class="o">:</span> <span class="n">L</span> <span class="bp">|</span> <span class="bp">∃</span> <span class="n">a</span> <span class="o">:</span> <span class="n">nat</span><span class="o">,</span> <span class="n">a</span> <span class="bp">∈</span> <span class="n">S</span> <span class="bp">∧</span> <span class="n">b</span><span class="bp">^</span><span class="n">a</span> <span class="bp">=</span> <span class="mi">1</span> <span class="o">}</span> <span class="bp">=</span> <span class="bp">⊤</span><span class="o">)</span>
</code></pre></div>
<p>It makes sense in any characteristic and it allows base ring (instead of a base field) and infinite extensions. Maybe it's more elegant to use <code>root_of_unity</code> in the second condition, but this is only a personal taste.</p>



<a name="259088853"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259088853" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259088853">(Oct 26 2021 at 12:34)</a>:</h4>
<p>I don't see any real problem with <code>nat</code> instead of <code>pnat</code> (and  I prefer working with <code>nat</code>, the API is better). Does someone see a reason to prefer <code>pnat</code>?</p>



<a name="259090030"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259090030" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259090030">(Oct 26 2021 at 12:44)</a>:</h4>
<p>The definition you wrote won't work with Nat if S contains 0</p>



<a name="259090089"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259090089" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259090089">(Oct 26 2021 at 12:45)</a>:</h4>
<p>The second condition would reduce to saying that L is generated by L</p>



<a name="259090207"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259090207" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259090207">(Oct 26 2021 at 12:46)</a>:</h4>
<p>Hmm, that's a good point (-;</p>



<a name="259090253"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259090253" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259090253">(Oct 26 2021 at 12:46)</a>:</h4>
<p>And the first condition would reduce to saying that Phi_0 which is the constant 1 has a root, which cannot hold in a nontrivial ring</p>



<a name="259090340"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259090340" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259090340">(Oct 26 2021 at 12:47)</a>:</h4>
<p>Ah ops, I checked the first one with <code>X^n -1</code></p>



<a name="259090465"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259090465" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259090465">(Oct 26 2021 at 12:48)</a>:</h4>
<p>Well, maybe it is still OK, there no <code>S</code>-extensions if <code>S</code> contains <code>0</code>, do we care?</p>



<a name="259090502"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259090502" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259090502">(Oct 26 2021 at 12:48)</a>:</h4>
<p>I would prefer pnat tbh. Yes the API is less developed, but in my mind pnat is fundamentally multiplicative whereas Nat is additive. The cyclotomic theory is essentially multiplicative in nature, so it makes sense to me to use pnat</p>



<a name="259090578"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259090578" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259090578">(Oct 26 2021 at 12:49)</a>:</h4>
<p>OK, let's try <code>pnat</code>.</p>



<a name="259090904"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259090904" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259090904">(Oct 26 2021 at 12:51)</a>:</h4>
<p>With Nat and 0 in S, the trivial algebra would be cyclotomic <span aria-label="rofl" class="emoji emoji-1f923" role="img" title="rofl">:rofl:</span></p>



<a name="259091082"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259091082" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259091082">(Oct 26 2021 at 12:53)</a>:</h4>
<p>Don't tell our colleagues  that we really spend time thinking about the <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0</mn></mrow><annotation encoding="application/x-tex">0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span></span></span></span>-th cyclotomic extension of the trivial ring.</p>



<a name="259094889"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259094889" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259094889">(Oct 26 2021 at 13:22)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">ring_theory.polynomial.cyclotomic</span>

<span class="kd">variables</span> <span class="o">(</span><span class="n">K</span> <span class="n">L</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">[</span><span class="n">comm_ring</span> <span class="n">K</span><span class="o">]</span> <span class="o">[</span><span class="n">comm_ring</span> <span class="n">L</span><span class="o">]</span> <span class="o">[</span><span class="n">is_domain</span> <span class="n">L</span><span class="o">]</span> <span class="o">[</span><span class="n">algebra</span> <span class="n">K</span> <span class="n">L</span><span class="o">]</span>

<span class="kd">class</span> <span class="n">is_cyclotomic_extension</span> <span class="o">(</span><span class="n">S</span> <span class="o">:</span> <span class="n">set</span> <span class="n">ℕ</span><span class="bp">+</span><span class="o">)</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">ex_root</span> <span class="o">(</span><span class="n">a</span> <span class="o">:</span> <span class="n">ℕ</span><span class="bp">+</span><span class="o">)</span> <span class="o">(</span><span class="n">ha</span> <span class="o">:</span> <span class="n">a</span> <span class="bp">∈</span> <span class="n">S</span><span class="o">)</span> <span class="o">:</span> <span class="bp">∃</span> <span class="n">r</span> <span class="o">:</span> <span class="n">L</span><span class="o">,</span> <span class="n">polynomial.aeval</span> <span class="n">r</span> <span class="o">(</span><span class="n">polynomial.cyclotomic</span> <span class="n">a</span> <span class="n">K</span><span class="o">)</span> <span class="bp">=</span> <span class="mi">0</span><span class="o">)</span>
<span class="o">(</span><span class="n">adjoint_roots</span> <span class="o">:</span> <span class="n">algebra.adjoin</span> <span class="n">K</span> <span class="o">(</span><span class="n">set.Union</span> <span class="o">(</span><span class="bp">λ</span> <span class="o">(</span><span class="n">i</span> <span class="o">:</span> <span class="n">S</span><span class="o">),</span> <span class="o">((</span><span class="n">primitive_roots</span> <span class="n">i</span> <span class="n">L</span><span class="o">)</span> <span class="o">:</span> <span class="n">set</span> <span class="n">L</span><span class="o">)))</span> <span class="bp">=</span> <span class="bp">⊤</span><span class="o">)</span>
</code></pre></div>
<p>If there is anyone among you that believes this definition should not take place, speak now or forever hold your peace.</p>



<a name="259095149"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259095149" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Chris Birkbeck <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259095149">(Oct 26 2021 at 13:24)</a>:</h4>
<p>I'm happy with that.</p>



<a name="259095698"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259095698" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259095698">(Oct 26 2021 at 13:28)</a>:</h4>
<p><span class="user-mention" data-user-id="130384">@Riccardo Brasca</span> I think you can use nicer notation for that union, hopefully.</p>



<a name="259095743"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259095743" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259095743">(Oct 26 2021 at 13:28)</a>:</h4>
<p>Doesn't something like <code>⋃ i ∈ S, primitive_roots i L</code> work?</p>



<a name="259095978"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259095978" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259095978">(Oct 26 2021 at 13:30)</a>:</h4>
<p>Anyway, probably one of the first things after this definition will be some lemmas that give equivalent statements (e.g. using <code>roots_of_unity</code> instead of <code>primitive_roots</code>). All those versions will probably be useful in the end.</p>



<a name="259096029"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259096029" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259096029">(Oct 26 2021 at 13:30)</a>:</h4>
<p>What's the benefit of using primitive roots as opposed to all nth roots of unity?</p>



<a name="259096100"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259096100" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259096100">(Oct 26 2021 at 13:31)</a>:</h4>
<p>I feel like checking for all roots would be easier, so it might make sense to have that as the constructor</p>



<a name="259096648"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259096648" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259096648">(Oct 26 2021 at 13:35)</a>:</h4>
<p><code>⋃ i ∈ S, (primitive_roots ↑i L) : set L</code> this works. I used primitive roots because <code>roots_of_unity</code> is a subgroup of units of <code>L</code>, so there are even more coercions</p>



<a name="259096696"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259096696" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259096696">(Oct 26 2021 at 13:35)</a>:</h4>
<p>but it's doable of course. I think that it's better to use one of them rather than saying manually "roots of X^n-1"</p>



<a name="259096706"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259096706" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259096706">(Oct 26 2021 at 13:35)</a>:</h4>
<p>Maybe the constructor should just use <code>{b : L | ∃ i ∈ S, ... }</code>.</p>



<a name="259096795"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259096795" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259096795">(Oct 26 2021 at 13:36)</a>:</h4>
<p>And then a lemma can say: ooh, in fact you can use a primitive root of unity</p>



<a name="259096873"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259096873" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259096873">(Oct 26 2021 at 13:36)</a>:</h4>
<p>Exactly the opposite of what I was thinking, but I trust you guys more than myself  <span aria-label="grinning face with smiling eyes" class="emoji emoji-1f601" role="img" title="grinning face with smiling eyes">:grinning_face_with_smiling_eyes:</span></p>



<a name="259097093"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259097093" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259097093">(Oct 26 2021 at 13:38)</a>:</h4>
<p>So this one?</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">ring_theory.polynomial.cyclotomic</span>

<span class="kd">variables</span> <span class="o">(</span><span class="n">K</span> <span class="n">L</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">[</span><span class="n">comm_ring</span> <span class="n">K</span><span class="o">]</span> <span class="o">[</span><span class="n">ring</span> <span class="n">L</span><span class="o">]</span> <span class="o">[</span><span class="n">algebra</span> <span class="n">K</span> <span class="n">L</span><span class="o">]</span>

<span class="kd">class</span> <span class="n">is_cyclotomic_extension</span> <span class="o">(</span><span class="n">S</span> <span class="o">:</span> <span class="n">set</span> <span class="n">ℕ</span><span class="bp">+</span><span class="o">)</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">ex_root</span> <span class="o">(</span><span class="n">a</span> <span class="o">:</span> <span class="n">ℕ</span><span class="bp">+</span><span class="o">)</span> <span class="o">(</span><span class="n">ha</span> <span class="o">:</span> <span class="n">a</span> <span class="bp">∈</span> <span class="n">S</span><span class="o">)</span> <span class="o">:</span> <span class="bp">∃</span> <span class="n">r</span> <span class="o">:</span> <span class="n">L</span><span class="o">,</span> <span class="n">polynomial.aeval</span> <span class="n">r</span> <span class="o">(</span><span class="n">polynomial.cyclotomic</span> <span class="n">a</span> <span class="n">K</span><span class="o">)</span> <span class="bp">=</span> <span class="mi">0</span><span class="o">)</span>
<span class="o">(</span><span class="n">adjoint_roots</span> <span class="o">:</span> <span class="n">algebra.adjoin</span> <span class="n">K</span> <span class="o">{</span><span class="n">b</span> <span class="o">:</span> <span class="n">L</span> <span class="bp">|</span> <span class="bp">∃</span> <span class="n">a</span> <span class="o">:</span> <span class="n">ℕ</span><span class="bp">+</span><span class="o">,</span> <span class="n">a</span> <span class="bp">∈</span> <span class="n">S</span> <span class="bp">∧</span> <span class="n">b</span> <span class="bp">^</span> <span class="o">(</span><span class="n">a</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="bp">=</span> <span class="mi">1</span><span class="o">}</span> <span class="bp">=</span> <span class="bp">⊤</span><span class="o">)</span>
</code></pre></div>



<a name="259097140"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259097140" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259097140">(Oct 26 2021 at 13:38)</a>:</h4>
<p>That looks good to me!</p>



<a name="259097335"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259097335" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259097335">(Oct 26 2021 at 13:39)</a>:</h4>
<p>I guess this would imply L is commutative. Do we want to infer a comm_ring instance from this or just assume commutativity from the start?</p>



<a name="259097338"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259097338" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259097338">(Oct 26 2021 at 13:39)</a>:</h4>
<p>Should it be phrased as <code>⊤ ≤ _</code>? Because that's easier to verify?</p>



<a name="259097406"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259097406" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259097406">(Oct 26 2021 at 13:40)</a>:</h4>
<p>Or even just: <code>∀ x : L, x ∈ algebra.adjoin ...</code></p>



<a name="259097457"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259097457" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259097457">(Oct 26 2021 at 13:40)</a>:</h4>
<p>Then proofs don't need to start with <code>rw eq_top_iff</code></p>



<a name="259098460"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259098460" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259098460">(Oct 26 2021 at 13:47)</a>:</h4>
<p><span class="user-mention silent" data-user-id="243562">Adam Topaz</span> <a href="#narrow/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn/near/259097335">said</a>:</p>
<blockquote>
<p>I guess this would imply L is commutative. Do we want to infer a comm_ring instance from this or just assume commutativity from the start?</p>
</blockquote>
<p>Good question. We cannot add <code>... : comm_ring R := sorry</code>, right? Because a priori there could be a diamond for the two <code>ring</code> structures... and I don't want to prove it now if it is more than 5 minutes.</p>



<a name="259098877"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259098877" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259098877">(Oct 26 2021 at 13:50)</a>:</h4>
<p>I wouldn't worry about this for now.</p>



<a name="259098886"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259098886" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259098886">(Oct 26 2021 at 13:50)</a>:</h4>
<p>Just assume commutativity.</p>



<a name="259099231"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259099231" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259099231">(Oct 26 2021 at 13:53)</a>:</h4>
<p>I agree we should just assume commutativity! But I also don't think proving it as an instance would cause a diamond since the ring structure would come from the given ring structure of L.</p>



<a name="259099264"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259099264" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259099264">(Oct 26 2021 at 13:53)</a>:</h4>
<p>It might be a diamond, but the two ring instances would be defeq</p>



<a name="259099988"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259099988" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259099988">(Oct 26 2021 at 13:59)</a>:</h4>
<p>Sure, but if our proof is <code>sorry</code> then Lean cannot know the two structure are <code>defeq</code>. But let's just assume commutativity.</p>



<a name="259100246"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259100246" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259100246">(Oct 26 2021 at 14:01)</a>:</h4>
<p>Oh, I see. but if you write</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">instance</span> <span class="o">[</span><span class="n">is_cyclotomic_extension</span> <span class="n">K</span> <span class="n">L</span> <span class="n">S</span><span class="o">]</span> <span class="o">:</span> <span class="n">comm_ring</span> <span class="n">L</span> <span class="o">:=</span>
<span class="o">{</span> <span class="n">mul_comm'</span> <span class="o">:=</span> <span class="gr">sorry</span><span class="o">,</span>
<span class="bp">..</span> <span class="o">(</span><span class="n">infer_instance</span> <span class="o">:</span> <span class="n">ring</span> <span class="n">L</span><span class="o">)</span> <span class="o">}</span>
</code></pre></div>
<p>then it should be okay, right?</p>



<a name="259100433"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259100433" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259100433">(Oct 26 2021 at 14:02)</a>:</h4>
<p>Anyway, all rings are commutative so why do we even care ;)</p>



<a name="259100883"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259100883" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259100883">(Oct 26 2021 at 14:05)</a>:</h4>
<p>I've never used abbreviation, is this what we want?</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">variables</span> <span class="o">(</span><span class="n">S</span> <span class="o">:</span> <span class="n">set</span> <span class="n">ℕ</span><span class="bp">+</span><span class="o">)</span> <span class="o">(</span><span class="n">K</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">[</span><span class="n">field</span> <span class="n">K</span><span class="o">]</span> <span class="o">[</span><span class="n">char_zero</span> <span class="n">K</span><span class="o">]</span>

<span class="kd">abbreviation</span> <span class="n">is_cyclotomic_extension_rat</span> <span class="o">:=</span> <span class="n">is_cyclotomic_extension</span> <span class="n">S</span> <span class="n">ℚ</span> <span class="n">K</span>
<span class="bp">``</span>
</code></pre></div>



<a name="259103453"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259103453" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259103453">(Oct 26 2021 at 14:21)</a>:</h4>
<p><code>_rat</code> is longer than <code> ℚ </code>. So I think I wouldn't bother.</p>



<a name="259104689"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259104689" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259104689">(Oct 26 2021 at 14:29)</a>:</h4>
<p>good point</p>



<a name="259107685"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259107685" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thomas Browning <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259107685">(Oct 26 2021 at 14:47)</a>:</h4>
<p>Here's a worry: If we use an infinite <code>S</code> (e.g., all positive integers), then will <code>algebra.adjoin</code> give us the whole cyclotomic field, or only a subalgebra?</p>



<a name="259107932"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259107932" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259107932">(Oct 26 2021 at 14:49)</a>:</h4>
<p>We get the extension generated by all roots of unity.</p>



<a name="259107950"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259107950" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thomas Browning <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259107950">(Oct 26 2021 at 14:49)</a>:</h4>
<p>Is it obvious that <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="double-struck">Q</mi><mo stretchy="false">[</mo><msub><mi>ζ</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>ζ</mi><mn>2</mn></msub><mo separator="true">,</mo><mo>…</mo><mo stretchy="false">]</mo><mo>=</mo><mi mathvariant="double-struck">Q</mi><mo stretchy="false">(</mo><msub><mi>ζ</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>ζ</mi><mn>2</mn></msub><mo separator="true">,</mo><mo>…</mo><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\mathbb{Q}[\zeta_1,\zeta_2,\ldots]=\mathbb{Q}(\zeta_1,\zeta_2,\ldots)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathbb">Q</span><span class="mopen">[</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07378em;">ζ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.07378em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07378em;">ζ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.07378em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner">…</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathbb">Q</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07378em;">ζ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.07378em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07378em;">ζ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.07378em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner">…</span><span class="mclose">)</span></span></span></span> (algebra adjoin vs field adjoin)?</p>



<a name="259108117"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259108117" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259108117">(Oct 26 2021 at 14:50)</a>:</h4>
<p>Yes, any element is in a finitely generated subalgebra, so you don't have to worry about infinitely many generators.</p>



<a name="259110142"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259110142" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259110142">(Oct 26 2021 at 15:03)</a>:</h4>
<p>So we now have a very general definition <code>is_cyclotomic_extension</code>. I don't see how to write down an explicit model in the same degree of generality. For example we can take the splitting field of the cyclotomic polynomials, but this works only over fields and for <code>S</code> a singleton.</p>



<a name="259110273"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259110273" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259110273">(Oct 26 2021 at 15:03)</a>:</h4>
<p>But that doesn't matter right?</p>



<a name="259110385"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259110385" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259110385">(Oct 26 2021 at 15:04)</a>:</h4>
<p>You just setup the API as general as possible. And at the end of your project you specialize to <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">Q</mi><mo stretchy="false">(</mo><msub><mi>ζ</mi><mi>p</mi></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">ℚ(ζ_p)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.036108em;vertical-align:-0.286108em;"></span><span class="mord amsrm">Q</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07378em;">ζ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-left:-0.07378em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">p</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span>.</p>



<a name="259110466"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259110466" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thomas Browning <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259110466">(Oct 26 2021 at 15:04)</a>:</h4>
<p><span class="user-mention silent" data-user-id="130384">Riccardo Brasca</span> <a href="#narrow/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn/near/259110142">said</a>:</p>
<blockquote>
<p>So we now have a very general definition <code>is_cyclotomic_extension</code>. I don't see how to write down an explicit model in the same degree of generality. For example we can take the splitting field of the cyclotomic polynomials, but this works only over fields and for <code>S</code> a singleton.</p>
</blockquote>
<p>You could work in an algebraic closure and take a sup of subalgebras or intermediate fields.</p>



<a name="259110878"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259110878" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259110878">(Oct 26 2021 at 15:07)</a>:</h4>
<p>Mmh.. yes, it should be enoug. Once we have <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="double-struck">Q</mi><mo stretchy="false">(</mo><msub><mi>ζ</mi><mi>n</mi></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\mathbb{Q}(\zeta_n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathbb">Q</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07378em;">ζ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.07378em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span> we can say that <code>algebra.adjoin ℤ ζ</code> is a cyclotomic extension</p>



<a name="259110925"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259110925" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259110925">(Oct 26 2021 at 15:08)</a>:</h4>
<p>Where <code>ζ</code> is inside <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="double-struck">Q</mi><mo stretchy="false">(</mo><msub><mi>ζ</mi><mi>n</mi></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\mathbb{Q}(\zeta_n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathbb">Q</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07378em;">ζ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.07378em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></p>



<a name="259111334"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259111334" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thomas Browning <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259111334">(Oct 26 2021 at 15:10)</a>:</h4>
<p>If we really want to be fancy, we could build the infinite cyclotomic extension and take fixed fields by closed subgroups of the Galois group <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mover accent="true"><mi mathvariant="double-struck">Z</mi><mo stretchy="true">^</mo></mover><mo>×</mo></msup></mrow><annotation encoding="application/x-tex">\widehat{\mathbb{Z}}^\times</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.92889em;vertical-align:0em;"></span><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.92889em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathbb">Z</span></span><span class="svg-align" style="width:calc(100% - 0.16668em);margin-left:0.16668em;top:-3.68889em;"><span class="pstrut" style="height:3em;"></span><span style="height:0.24em;"><svg xmlns="http://www.w3.org/2000/svg" width='100%' height='0.24em' viewBox='0 0 1062 239' preserveAspectRatio='none'><path d='M529 0h5l519 115c5 1 9 5 9 10 0 1-1 2-1 3l-4 22
c-1 5-5 9-11 9h-2L532 67 19 159h-2c-5 0-9-4-11-9l-5-22c-1-6 2-12 8-13z'/></svg></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.771331em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mbin mtight">×</span></span></span></span></span></span></span></span></span></span></span>. This would also give us the <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi mathvariant="double-struck">Z</mi><mi>p</mi></msub></mrow><annotation encoding="application/x-tex">\mathbb{Z}_p</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.974998em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathbb">Z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">p</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span> from Iwasawa theory.</p>



<a name="259111375"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259111375" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thomas Browning <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259111375">(Oct 26 2021 at 15:10)</a>:</h4>
<p>(although Lean doesn't know this version of the Galois correspondence yet)</p>



<a name="259111512"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259111512" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259111512">(Oct 26 2021 at 15:11)</a>:</h4>
<p><span class="user-mention silent" data-user-id="253861">Thomas Browning</span> <a href="#narrow/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn/near/259111334">said</a>:</p>
<blockquote>
<p>If we really want to be fancy, we could build the infinite cyclotomic extension and take fixed fields by closed subgroups of the Galois group <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mover accent="true"><mi mathvariant="double-struck">Z</mi><mo stretchy="true">^</mo></mover><mo>×</mo></msup></mrow><annotation encoding="application/x-tex">\widehat{\mathbb{Z}}^\times</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.92889em;vertical-align:0em;"></span><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.92889em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathbb">Z</span></span><span class="svg-align" style="width:calc(100% - 0.16668em);margin-left:0.16668em;top:-3.68889em;"><span class="pstrut" style="height:3em;"></span><span style="height:0.24em;"><svg xmlns="http://www.w3.org/2000/svg" width='100%' height='0.24em' viewBox='0 0 1062 239' preserveAspectRatio='none'><path d='M529 0h5l519 115c5 1 9 5 9 10 0 1-1 2-1 3l-4 22
c-1 5-5 9-11 9h-2L532 67 19 159h-2c-5 0-9-4-11-9l-5-22c-1-6 2-12 8-13z'/></svg></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.771331em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mbin mtight">×</span></span></span></span></span></span></span></span></span></span></span>. This would also give us the <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi mathvariant="double-struck">Z</mi><mi>p</mi></msub></mrow><annotation encoding="application/x-tex">\mathbb{Z}_p</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.974998em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathbb">Z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">p</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span> from Iwasawa theory.</p>
</blockquote>
<p>This is where one would have to worry about characteristic...</p>



<a name="259111588"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259111588" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259111588">(Oct 26 2021 at 15:12)</a>:</h4>
<p><span class="user-mention" data-user-id="130384">@Riccardo Brasca</span> Right, so you will need an instance for <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">Q</mi><mo stretchy="false">(</mo><msub><mi>ζ</mi><mi>n</mi></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">ℚ(ζ_n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord amsrm">Q</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07378em;">ζ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.07378em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span>. But that should suffice. (Ok, and maybe for the integral version.)</p>



<a name="259111695"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259111695" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thomas Browning <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259111695">(Oct 26 2021 at 15:12)</a>:</h4>
<p>Could you do both simultaneously with <code>adjoin_root</code>?</p>



<a name="259111722"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259111722" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259111722">(Oct 26 2021 at 15:12)</a>:</h4>
<p>One question is this: Given a positive integer <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">n</span></span></span></span>, should we prove a cyclotomic instance for <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi><mo>=</mo><mo stretchy="false">{</mo><mi>n</mi><mo stretchy="false">}</mo></mrow><annotation encoding="application/x-tex">S = \{n\}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">{</span><span class="mord mathnormal">n</span><span class="mclose">}</span></span></span></span> or for <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi></mrow><annotation encoding="application/x-tex">S</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span></span></span></span> the divisors of <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">n</span></span></span></span>?</p>



<a name="259111866"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259111866" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thomas Browning <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259111866">(Oct 26 2021 at 15:13)</a>:</h4>
<p><span class="user-mention silent" data-user-id="243562">Adam Topaz</span> <a href="#narrow/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn/near/259111722">said</a>:</p>
<blockquote>
<p>One question is this: Given a positive integer <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">n</span></span></span></span>, should we prove a cyclotomic instance for <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi><mo>=</mo><mo stretchy="false">{</mo><mi>n</mi><mo stretchy="false">}</mo></mrow><annotation encoding="application/x-tex">S = \{n\}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">{</span><span class="mord mathnormal">n</span><span class="mclose">}</span></span></span></span> or for <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi></mrow><annotation encoding="application/x-tex">S</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span></span></span></span> the divisors of <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">n</span></span></span></span>?</p>
</blockquote>
<p>If we view S as saying "what roots of unity you want to adjoin", then I think {n} is more natural and less cumbersome?</p>



<a name="259111924"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259111924" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259111924">(Oct 26 2021 at 15:14)</a>:</h4>
<p>My question is exactly what is (in Lean) the integral version. Over a field we can use <code>splitting_field</code> and we are good. The problem with <code>adjoin_root</code> is that it add the root even if it is already there.</p>



<a name="259112028"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259112028" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thomas Browning <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259112028">(Oct 26 2021 at 15:14)</a>:</h4>
<p>Would taking an arbitrary irreducible factor of the cyclotomic polynomial work?</p>



<a name="259112050"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259112050" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259112050">(Oct 26 2021 at 15:15)</a>:</h4>
<p>It is by def the quotient of the polynomial ring by the polynomial. So if we don't have irreducibility this is very badly behaved</p>



<a name="259112118"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259112118" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259112118">(Oct 26 2021 at 15:15)</a>:</h4>
<p>No, we want all the roots</p>



<a name="259112280"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259112280" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thomas Browning <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259112280">(Oct 26 2021 at 15:16)</a>:</h4>
<p>Could you define some weird induction thing that takes a polynomial, pulls off an irreducible factor and applies <code>adjoin_root</code>, and repeats?</p>



<a name="259112322"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259112322" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thomas Browning <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259112322">(Oct 26 2021 at 15:16)</a>:</h4>
<p>This might even generalize the splitting field construction</p>



<a name="259112692"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259112692" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259112692">(Oct 26 2021 at 15:19)</a>:</h4>
<p>For the integral version, can't you use integral closure, or <code>algebra.adjoin</code>?</p>



<a name="259112701"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259112701" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259112701">(Oct 26 2021 at 15:19)</a>:</h4>
<p>Well, you are proposing to generalize <code>splitting_field</code> to rings. This is surely possible in some sense, but I am afraid it's going to be a lot of work.</p>
<p>Maybe the best thing is, for domains, to just consider <code>algebra.adjoin R T</code>, where <code>T</code> is the set of roots of unity in the field of fraction</p>



<a name="259112815"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259112815" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259112815">(Oct 26 2021 at 15:20)</a>:</h4>
<p>Yes exactly, having the field we can work there</p>



<a name="259112891"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259112891" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259112891">(Oct 26 2021 at 15:20)</a>:</h4>
<p>people are against using <code>integral_closure</code> since in general the thing is not integrally closed (it is for <code>Z</code>).</p>



<a name="259120401"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259120401" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259120401">(Oct 26 2021 at 16:09)</a>:</h4>
<p>I think I wrote down the relevant definitions. They are in <code>number_theory/cyclotomic/basic</code>. I am going to stop for today, but the idea is to get rid of <code>number_theory/cyclotomic/field/basic</code> and <code>number_theory/cyclotomic/ring/basic</code>, so if someone wants to modify the other files please go ahead. It should be easy.</p>



<a name="259120490"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259120490" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259120490">(Oct 26 2021 at 16:10)</a>:</h4>
<p>In <code>number_theory/cyclotomic/basic</code> there <em>a lot</em> of <code>sorry</code>, most of them are instances.</p>



<a name="259120624"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259120624" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259120624">(Oct 26 2021 at 16:10)</a>:</h4>
<p>I think that using <code>abbreviation</code>/<code>notation</code> or whatever instead of <code>def</code> some of them will become automatic, but in any case the majority should be easy.</p>



<a name="259121138"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259121138" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Chris Birkbeck <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259121138">(Oct 26 2021 at 16:14)</a>:</h4>
<p>Awesome!</p>



<a name="259207341"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259207341" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Chris Birkbeck <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259207341">(Oct 27 2021 at 08:34)</a>:</h4>
<p>So I was just trying to get the <code>class_group</code> stuff working with the new cyclotomic definition, but it gives me an error I'd not seen before <code>maximum class-instance resolution depth has been reached </code>. What does this mean?</p>



<a name="259208025"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259208025" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259208025">(Oct 27 2021 at 08:41)</a>:</h4>
<p>It means there is a cycle of instances</p>



<a name="259208049"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259208049" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259208049">(Oct 27 2021 at 08:41)</a>:</h4>
<p>Where is it?</p>



<a name="259208159"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259208159" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Chris Birkbeck <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259208159">(Oct 27 2021 at 08:42)</a>:</h4>
<p>aha, I tried the <code>set_option trace.class_instances true</code> but I cant really interpret the output to see the problem. (Sorry I'm still quite new at this!)</p>



<a name="259208250"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259208250" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Chris Birkbeck <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259208250">(Oct 27 2021 at 08:43)</a>:</h4>
<p>I pushed the changes if you want to see the error for yourself</p>



<a name="259208310"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259208310" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259208310">(Oct 27 2021 at 08:43)</a>:</h4>
<p>I've never understood the output if <code>set_option trace.class_instances true</code>: the problem is surely written, but it is too long to read.</p>



<a name="259208524"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259208524" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259208524">(Oct 27 2021 at 08:45)</a>:</h4>
<p>I suggest we try to have <code>master</code> compiling without errors all the time. But we can of course use other branches to play with errors</p>



<a name="259208544"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259208544" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259208544">(Oct 27 2021 at 08:45)</a>:</h4>
<p>But no problem for your commit :)</p>



<a name="259208637"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259208637" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Chris Birkbeck <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259208637">(Oct 27 2021 at 08:46)</a>:</h4>
<p>Ah sure that's probably a good idea! :)</p>



<a name="259208855"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259208855" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Chris Birkbeck <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259208855">(Oct 27 2021 at 08:48)</a>:</h4>
<p>Looking at the output it seems something happen here <code>[class_instances] cached instance for field ℚ
rat.field</code></p>



<a name="259209301"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259209301" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259209301">(Oct 27 2021 at 08:53)</a>:</h4>
<p>I've probably missed something about the new <code>open</code> command, but I don't understand how Lean find <code>cyclotomic_ring</code> that is now called something like <code>new_cyclotomic_field.cyclotomic_ring</code></p>



<a name="259209716"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259209716" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Chris Birkbeck <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259209716">(Oct 27 2021 at 08:57)</a>:</h4>
<p>Oh I added the <code>open new_cyclotomic_field</code> I thought it would just mean I dont have to type <code>new_cyclotomic_field.cyclotomic_ring</code> everytime.</p>



<a name="259209874"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259209874" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259209874">(Oct 27 2021 at 08:59)</a>:</h4>
<p>There is no <code>open</code> <a href="https://github.com/leanprover-community/flt-regular/blob/master/src/number_theory/cyclotomic/class_group.lean">here</a> or am I blind?</p>



<a name="259209899"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259209899" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259209899">(Oct 27 2021 at 08:59)</a>:</h4>
<p>But let me check the real error</p>



<a name="259209936"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259209936" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Chris Birkbeck <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259209936">(Oct 27 2021 at 08:59)</a>:</h4>
<p>Oh wait, maybe I pushed the wrong thing.</p>



<a name="259210165"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259210165" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Chris Birkbeck <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259210165">(Oct 27 2021 at 09:01)</a>:</h4>
<p>Yes I forgot to hit save before pushing, sorry!</p>



<a name="259210407"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259210407" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259210407">(Oct 27 2021 at 09:03)</a>:</h4>
<p>I get an <code>invalid namespace name 'new_cyclotomic_field'</code> error.</p>



<a name="259210497"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259210497" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Chris Birkbeck <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259210497">(Oct 27 2021 at 09:04)</a>:</h4>
<p>Yeah, did you delete that namespace?</p>



<a name="259210609"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259210609" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259210609">(Oct 27 2021 at 09:05)</a>:</h4>
<p>I didn't touch the namespace, there is something I don't understand. Let me see what really does the new <code>open</code>.</p>



<a name="259210737"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259210737" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Chris Birkbeck <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259210737">(Oct 27 2021 at 09:06)</a>:</h4>
<p>No I can see in your commit that you removed the that namespace from <code>cyclotomic/basic</code></p>



<a name="259210811"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259210811" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Chris Birkbeck <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259210811">(Oct 27 2021 at 09:07)</a>:</h4>
<p>But either way, thats not the problem. the class instance thing is still there.</p>



<a name="259210912"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259210912" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259210912">(Oct 27 2021 at 09:08)</a>:</h4>
<p>Ah ops, I messed up. Let's fix this, since there are two <code>cyclotomic_ring</code> and I want to be sure Lean is working with the good one.</p>



<a name="259211643"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259211643" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259211643">(Oct 27 2021 at 09:15)</a>:</h4>
<p>So,</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">instance</span> <span class="n">a</span> <span class="o">:</span> <span class="n">is_scalar_tower</span> <span class="n">ℤ</span> <span class="n">ℚ</span> <span class="o">(</span><span class="n">cyclotomic_field</span> <span class="n">n</span> <span class="n">ℚ</span><span class="o">)</span> <span class="o">:=</span> <span class="gr">sorry</span>

<span class="kd">noncomputable</span> <span class="kd">instance</span> <span class="n">class_group.fintype_of_cyclotomic_ring</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="n">ℕ</span><span class="bp">+</span><span class="o">)</span> <span class="o">:</span>
  <span class="n">fintype</span> <span class="o">(</span><span class="n">class_group</span> <span class="o">(</span><span class="n">cyclotomic_ring</span> <span class="n">n</span> <span class="n">ℤ</span> <span class="n">ℚ</span><span class="o">)</span> <span class="o">(</span><span class="n">cyclotomic_field</span> <span class="n">n</span> <span class="n">ℚ</span><span class="o">))</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="n">refine</span> <span class="bp">@</span><span class="n">class_group.fintype_of_admissible_of_finite</span>
    <span class="n">ℤ</span> <span class="o">(</span><span class="n">cyclotomic_ring</span> <span class="n">n</span> <span class="n">ℤ</span> <span class="n">ℚ</span><span class="o">)</span> <span class="n">ℚ</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span><span class="o">,</span>

<span class="kd">end</span>
</code></pre></div>
<p>complains with</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">failed</span> <span class="n">to</span> <span class="n">synthesize</span> <span class="n">type</span> <span class="kd">class</span> <span class="kd">instance</span> <span class="n">for</span>
<span class="n">n</span> <span class="o">:</span> <span class="n">ℕ</span><span class="bp">+</span>
<span class="bp">⊢</span> <span class="n">is_scalar_tower</span> <span class="n">ℤ</span> <span class="n">ℚ</span> <span class="o">(</span><span class="n">cyclotomic_field</span> <span class="n">n</span> <span class="n">ℚ</span><span class="o">)</span>
</code></pre></div>
<p>This usually means there is a diamond somewhere.</p>



<a name="259212525"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259212525" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259212525">(Oct 27 2021 at 09:26)</a>:</h4>
<p>Can you check that all the instances I wrote in <code>number_theory/cyclotomic/basic</code> are good? For example that I didn't write <code>algebra field ring</code> instead of <code>algebra ring field</code>. I am checking them too, but two pairs of eyes are better.</p>



<a name="259213971"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259213971" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259213971">(Oct 27 2021 at 09:41)</a>:</h4>
<p>Mmh,</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">instance</span> <span class="n">cyclotomic_ring_int_is_integral_closure</span> <span class="o">:</span>
  <span class="n">is_integral_closure</span> <span class="o">(</span><span class="n">cyclotomic_ring</span> <span class="n">n</span> <span class="n">A</span> <span class="n">K</span><span class="o">)</span> <span class="n">A</span> <span class="o">(</span><span class="n">cyclotomic_field</span> <span class="n">n</span> <span class="n">K</span><span class="o">)</span> <span class="o">:=</span> <span class="gr">sorry</span>

<span class="kd">noncomputable</span> <span class="kd">instance</span> <span class="n">class_group.fintype_of_cyclotomic_ring</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="n">ℕ</span><span class="bp">+</span><span class="o">)</span> <span class="o">[</span><span class="n">euclidean_domain</span> <span class="n">A</span><span class="o">]</span> <span class="o">:</span>
  <span class="n">fintype</span> <span class="o">(</span><span class="n">class_group</span> <span class="o">(</span><span class="n">cyclotomic_ring</span> <span class="n">n</span> <span class="n">A</span> <span class="n">K</span><span class="o">)</span> <span class="o">(</span><span class="n">cyclotomic_field</span> <span class="n">n</span> <span class="n">K</span><span class="o">))</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="n">letI</span> <span class="o">:</span> <span class="n">algebra</span> <span class="n">A</span> <span class="n">K</span> <span class="o">:=</span> <span class="n">infer_instance</span><span class="o">,</span>
  <span class="n">refine</span> <span class="bp">@</span><span class="n">class_group.fintype_of_admissible_of_finite</span>
    <span class="n">A</span> <span class="o">(</span><span class="n">cyclotomic_ring</span> <span class="n">n</span> <span class="n">A</span> <span class="n">K</span><span class="o">)</span> <span class="n">K</span> <span class="o">(</span><span class="n">cyclotomic_field</span> <span class="n">n</span> <span class="n">K</span><span class="o">)</span>
    <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span>
    <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span><span class="o">,</span>

<span class="kd">end</span>
</code></pre></div>
<p>says</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">failed</span> <span class="n">to</span> <span class="n">synthesize</span> <span class="n">type</span> <span class="kd">class</span> <span class="kd">instance</span> <span class="n">for</span>
<span class="n">A</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u_1</span><span class="o">,</span>
<span class="n">K</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u_2</span><span class="o">,</span>
<span class="n">_inst_1</span> <span class="o">:</span> <span class="n">comm_ring</span> <span class="n">A</span><span class="o">,</span>
<span class="n">_inst_2</span> <span class="o">:</span> <span class="n">field</span> <span class="n">K</span><span class="o">,</span>
<span class="n">_inst_3</span> <span class="o">:</span> <span class="n">is_domain</span> <span class="n">A</span><span class="o">,</span>
<span class="n">_inst_4</span> <span class="o">:</span> <span class="n">algebra</span> <span class="n">A</span> <span class="n">K</span><span class="o">,</span>
<span class="n">_inst_5</span> <span class="o">:</span> <span class="n">is_fraction_ring</span> <span class="n">A</span> <span class="n">K</span><span class="o">,</span>
<span class="n">n</span> <span class="o">:</span> <span class="n">ℕ</span><span class="bp">+</span><span class="o">,</span>
<span class="n">_inst_6</span> <span class="o">:</span> <span class="n">euclidean_domain</span> <span class="n">A</span><span class="o">,</span>
<span class="n">_inst</span> <span class="o">:</span> <span class="n">algebra</span> <span class="n">A</span> <span class="n">K</span> <span class="o">:=</span> <span class="n">infer_instance</span>
<span class="bp">⊢</span> <span class="n">algebra</span> <span class="n">A</span> <span class="n">K</span>
</code></pre></div>
<p>I don't understand.</p>



<a name="259214206"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259214206" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259214206">(Oct 27 2021 at 09:44)</a>:</h4>
<p>Lean wants</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="bp">@</span><span class="n">algebra.</span><span class="o">{</span><span class="n">u_1</span> <span class="n">u_2</span><span class="o">}</span> <span class="n">A</span> <span class="n">K</span> <span class="o">(</span><span class="bp">@</span><span class="n">comm_ring.to_comm_semiring.</span><span class="o">{</span><span class="n">u_1</span><span class="o">}</span> <span class="n">A</span> <span class="o">(</span><span class="bp">@</span><span class="n">euclidean_domain.to_comm_ring.</span><span class="o">{</span><span class="n">u_1</span><span class="o">}</span> <span class="n">A</span> <span class="n">_inst_6</span><span class="o">))</span>
    <span class="o">(</span><span class="bp">@</span><span class="n">ring.to_semiring.</span><span class="o">{</span><span class="n">u_2</span><span class="o">}</span> <span class="n">K</span> <span class="o">(</span><span class="bp">@</span><span class="n">division_ring.to_ring.</span><span class="o">{</span><span class="n">u_2</span><span class="o">}</span> <span class="n">K</span> <span class="o">(</span><span class="bp">@</span><span class="n">field.to_division_ring.</span><span class="o">{</span><span class="n">u_2</span><span class="o">}</span> <span class="n">K</span> <span class="n">_inst_2</span><span class="o">)))</span>
</code></pre></div>
<p>and we have</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="bp">@</span><span class="n">algebra.</span><span class="o">{</span><span class="n">u_1</span> <span class="n">u_2</span><span class="o">}</span> <span class="n">A</span> <span class="n">K</span> <span class="o">(</span><span class="bp">@</span><span class="n">comm_ring.to_comm_semiring.</span><span class="o">{</span><span class="n">u_1</span><span class="o">}</span> <span class="n">A</span> <span class="n">_inst_1</span><span class="o">)</span>
    <span class="o">(</span><span class="bp">@</span><span class="n">ring.to_semiring.</span><span class="o">{</span><span class="n">u_2</span><span class="o">}</span> <span class="n">K</span> <span class="o">(</span><span class="bp">@</span><span class="n">division_ring.to_ring.</span><span class="o">{</span><span class="n">u_2</span><span class="o">}</span> <span class="n">K</span> <span class="o">(</span><span class="bp">@</span><span class="n">field.to_division_ring.</span><span class="o">{</span><span class="n">u_2</span><span class="o">}</span> <span class="n">K</span>
</code></pre></div>



<a name="259214431"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259214431" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259214431">(Oct 27 2021 at 09:47)</a>:</h4>
<p>I have to stop for a couple of hours, but something is confusing me. It seems there a diamond here, but it's strange nobody found it before.</p>



<a name="259214542"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259214542" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259214542">(Oct 27 2021 at 09:48)</a>:</h4>
<p>Oh, OK, I see</p>



<a name="259214552"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259214552" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259214552">(Oct 27 2021 at 09:48)</a>:</h4>
<p><code>euclidean_domain</code> does not need <code>ring</code></p>



<a name="259214613"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259214613" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259214613">(Oct 27 2021 at 09:49)</a>:</h4>
<p>Bu the other problem is still there</p>



<a name="259214619"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259214619" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259214619">(Oct 27 2021 at 09:49)</a>:</h4>
<p>There is the algebra Q diamond and the rat field diamond, both of which will likely continue to cause us issues</p>



<a name="259218865"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259218865" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Chris Birkbeck <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259218865">(Oct 27 2021 at 10:31)</a>:</h4>
<p>Sorry I was away talking to a student.<br>
<span class="user-mention silent" data-user-id="130384">Riccardo Brasca</span> <a href="#narrow/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn/near/259212525">said</a>:</p>
<blockquote>
<p>Can you check that all the instances I wrote in <code>number_theory/cyclotomic/basic</code> are good? For example that I didn't write <code>algebra field ring</code> instead of <code>algebra ring field</code>. I am checking them too, but two pairs of eyes are better.</p>
</blockquote>
<p>Sorry I was afk talking to a student. I'll have a look now.</p>



<a name="259219040"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259219040" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Chris Birkbeck <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259219040">(Oct 27 2021 at 10:33)</a>:</h4>
<p>I have a noob question. What is a diamond? Is it when something can inherit the same properties from two different sources?</p>



<a name="259219227"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259219227" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259219227">(Oct 27 2021 at 10:35)</a>:</h4>
<p>Right -- it's when you suddenly find that you have two instances of e.g. <code>[algebra ℤ R]</code> which are perhaps propositionally equal but not <em>definitionally</em> equal, because Lean mananged to find two ring homomorphisms from the integers to R in its type class system.</p>



<a name="259219296"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259219296" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259219296">(Oct 27 2021 at 10:36)</a>:</h4>
<p>This is an issue because type class inference relies on definitional equality to work, basically, so diamonds can cause obscure/hard-to-diagnose errors.</p>



<a name="259219483"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259219483" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259219483">(Oct 27 2021 at 10:37)</a>:</h4>
<p>The famous example, the one which really made me understand diamonds, is that metric spaces and topological spaces are classes in Lean, and there's an instance which takes a metric space to a topological space, and an instance which takes two metric spaces and returns a metric space structure on the product, with the L^2 norm say (<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi><mo stretchy="false">(</mo><mo stretchy="false">(</mo><msub><mi>x</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>y</mi><mn>1</mn></msub><mo stretchy="false">)</mo><mo separator="true">,</mo><mo stretchy="false">(</mo><msub><mi>x</mi><mn>2</mn></msub><mo separator="true">,</mo><msub><mi>y</mi><mn>2</mn></msub><mo stretchy="false">)</mo><mo stretchy="false">)</mo><mo>:</mo><mo>=</mo><msqrt><mrow><mo stretchy="false">(</mo><mi>d</mi><mo stretchy="false">(</mo><msub><mi>x</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>y</mi><mn>1</mn></msub><msup><mo stretchy="false">)</mo><mn>2</mn></msup><mo>+</mo><mi>d</mi><mo stretchy="false">(</mo><msub><mi>x</mi><mn>2</mn></msub><mo separator="true">,</mo><msub><mi>y</mi><mn>2</mn></msub><msup><mo stretchy="false">)</mo><mn>2</mn></msup></mrow></msqrt></mrow><annotation encoding="application/x-tex">d((x_1,y_1),(x_2,y_2)):=\sqrt{(d(x_1,y_1)^2+d(x_2,y_2)^2}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">d</span><span class="mopen">((</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">))</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">:=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.24em;vertical-align:-0.30499999999999994em;"></span><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.935em;"><span class="svg-align" style="top:-3.2em;"><span class="pstrut" style="height:3.2em;"></span><span class="mord" style="padding-left:1em;"><span class="mopen">(</span><span class="mord mathnormal">d</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.740108em;"><span style="top:-2.9890000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord mathnormal">d</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.740108em;"><span style="top:-2.9890000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span><span style="top:-2.8950000000000005em;"><span class="pstrut" style="height:3.2em;"></span><span class="hide-tail" style="min-width:1.02em;height:1.28em;"><svg xmlns="http://www.w3.org/2000/svg" width='400em' height='1.28em' viewBox='0 0 400000 1296' preserveAspectRatio='xMinYMin slice'><path d='M263,681c0.7,0,18,39.7,52,119
c34,79.3,68.167,158.7,102.5,238c34.3,79.3,51.8,119.3,52.5,120
c340,-704.7,510.7,-1060.3,512,-1067
l0 -0
c4.7,-7.3,11,-11,19,-11
H40000v40H1012.3
s-271.3,567,-271.3,567c-38.7,80.7,-84,175,-136,283c-52,108,-89.167,185.3,-111.5,232
c-22.3,46.7,-33.8,70.3,-34.5,71c-4.7,4.7,-12.3,7,-23,7s-12,-1,-12,-1
s-109,-253,-109,-253c-72.7,-168,-109.3,-252,-110,-252c-10.7,8,-22,16.7,-34,26
c-22,17.3,-33.3,26,-34,26s-26,-26,-26,-26s76,-59,76,-59s76,-60,76,-60z
M1001 80h400000v40h-400000z'/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.30499999999999994em;"><span></span></span></span></span></span></span></span></span>) and there's an instance which takes two topological spaces and returns a topological space structure on the product.</p>



<a name="259219636"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259219636" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259219636">(Oct 27 2021 at 10:39)</a>:</h4>
<p>This gives a diamond! Because if you start with two metric spaces, then the product topology coming from the topologies has a basis which are "rectangles" (i.e. of the form <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>U</mi><mo>×</mo><mi>V</mi></mrow><annotation encoding="application/x-tex">U\times V</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.76666em;vertical-align:-0.08333em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">U</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span></span></span></span>) whereas the topology coming from the metric has a basis which are "discs" (i.e. distance from a fixed point is <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>&lt;</mo><mi>r</mi></mrow><annotation encoding="application/x-tex">&lt;r</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span></span></span></span>).</p>



<a name="259219664"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259219664" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259219664">(Oct 27 2021 at 10:39)</a>:</h4>
<p>It's a theorem that these two topologies are the same, but the proof is certainly not <code>rfl</code>!</p>



<a name="259219776"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259219776" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Chris Birkbeck <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259219776">(Oct 27 2021 at 10:40)</a>:</h4>
<p>Aha that makes perfect sense, thank you!</p>



<a name="259219803"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259219803" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259219803">(Oct 27 2021 at 10:40)</a>:</h4>
<p>Even if you make the metric on the product equal to the sup norm you still don't get <code>rfl</code> for your proof that the two topologies coincide, because one is "basis generated by products of all open sets" and the other is "basis generated by products of all open balls"</p>



<a name="259219845"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259219845" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259219845">(Oct 27 2021 at 10:41)</a>:</h4>
<p>The astonishing fix for this diamond, I think due to Johannes Hoelzl, is to make the topology part of the definition of a metric space!</p>



<a name="259219878"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259219878" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259219878">(Oct 27 2021 at 10:41)</a>:</h4>
<p>So a metric space in Lean is [what you think a metric space is] + [a topology] + [a proof that the topology is equal to the one induced by the metric]</p>



<a name="259220063"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259220063" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259220063">(Oct 27 2021 at 10:43)</a>:</h4>
<p>and then in the instance which defines a metric on the product of two metric spaces, you define the topology to be the product topology, and then you insert the proof that the metric product induces the product topology in the definition of the instance. This trivially fixes the diamond.</p>



<a name="259220171"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259220171" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259220171">(Oct 27 2021 at 10:44)</a>:</h4>
<p>If you've ever looked at the definition of a group in mathlib recently, you'll see that it contains a map <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="double-struck">Z</mi><mo>×</mo><mi>G</mi><mo>→</mo><mi>G</mi></mrow><annotation encoding="application/x-tex">\mathbb{Z}\times G\to G</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.77222em;vertical-align:-0.08333em;"></span><span class="mord mathbb">Z</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal">G</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">→</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal">G</span></span></span></span> and a proof that this map sends <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>n</mi><mo separator="true">,</mo><mi>g</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(n,g)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal">n</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mclose">)</span></span></span></span> to <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>g</mi><mi>n</mi></msup></mrow><annotation encoding="application/x-tex">g^n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.858832em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.664392em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span></span></span></span></span></span></span>, and this random extra field is there for the same sort of reason.</p>



<a name="259220559"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259220559" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Chris Birkbeck <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259220559">(Oct 27 2021 at 10:48)</a>:</h4>
<p>Ok great, I'll add diamonds to my list of things to worry about :)</p>



<a name="259220946"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259220946" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259220946">(Oct 27 2021 at 10:52)</a>:</h4>
<p><span class="user-mention silent" data-user-id="389019">Chris Birkbeck</span> <a href="#narrow/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn/near/259219040">said</a>:</p>
<blockquote>
<p>I have a noob question. What is a diamond? Is it when something can inherit the same properties from two different sources?</p>
</blockquote>
<p>Since yesterday we have a new way to answer this question! Meet our glossary <span aria-label="octopus" class="emoji emoji-1f419" role="img" title="octopus">:octopus:</span> <br>
<a href="https://leanprover-community.github.io/glossary.html#diamond">https://leanprover-community.github.io/glossary.html#diamond</a></p>



<a name="259221187"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259221187" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Chris Birkbeck <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259221187">(Oct 27 2021 at 10:55)</a>:</h4>
<p><span class="user-mention silent" data-user-id="112680">Johan Commelin</span> <a href="#narrow/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn/near/259220946">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="389019">Chris Birkbeck</span> <a href="#narrow/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn/near/259219040">said</a>:</p>
<blockquote>
<p>I have a noob question. What is a diamond? Is it when something can inherit the same properties from two different sources?</p>
</blockquote>
<p>Since yesterday we have a new way to answer this question! Meet our glossary <span aria-label="octopus" class="emoji emoji-1f419" role="img" title="octopus">:octopus:</span> <br>
<a href="https://leanprover-community.github.io/glossary.html#diamond">https://leanprover-community.github.io/glossary.html#diamond</a></p>
</blockquote>
<p>Oh this is great! thank you</p>



<a name="259221313"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259221313" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259221313">(Oct 27 2021 at 10:57)</a>:</h4>
<p>Credits to Julian Berman for writing it!</p>



<a name="259222531"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259222531" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259222531">(Oct 27 2021 at 11:10)</a>:</h4>
<p>I think that a mathematician would understand my explanation better than Julian's, because they would know a lot more about topological spaces than about terms and types. I should PR an extension of the explanation with the example maybe (when I'm out of teaching hell next week)</p>



<a name="259222644"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259222644" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259222644">(Oct 27 2021 at 11:11)</a>:</h4>
<p>Yeah, maybe the extended explanation can be written up somewhere (a gist?) and then we link to that?</p>



<a name="259222678"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259222678" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259222678">(Oct 27 2021 at 11:11)</a>:</h4>
<p>I guess the glossary should try to be concise, and link to other places for details.</p>



<a name="259222855"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259222855" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259222855">(Oct 27 2021 at 11:13)</a>:</h4>
<p>Gotcha</p>



<a name="259223027"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259223027" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259223027">(Oct 27 2021 at 11:15)</a>:</h4>
<p>In fact, the "See Also" part already links to the forgetful inheritance discussion from the mathlib paper.</p>



<a name="259223041"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259223041" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259223041">(Oct 27 2021 at 11:15)</a>:</h4>
<p>Which contains your metric space example.</p>



<a name="259224205"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259224205" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259224205">(Oct 27 2021 at 11:25)</a>:</h4>
<p><span class="user-mention" data-user-id="389019">@Chris Birkbeck</span> I am back at the computer. The diamond I was talking was completely my fault, I had <code>[ring A] [euclidean_domain A]</code>, so there were two structures of ring on <code>A</code>, and that confused Lean. Now I have <code>euclidean_domain A</code> but I still get the <code>maximum class-instance resolution</code>. Let's see what's wrong</p>



<a name="259225446"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259225446" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Chris Birkbeck <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259225446">(Oct 27 2021 at 11:37)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110038">Kevin Buzzard</span> <a href="#narrow/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn/near/259222531">said</a>:</p>
<blockquote>
<p>I think that a mathematician would understand my explanation better than Julian's, because they would know a lot more about topological spaces than about terms and types. I should PR an extension of the explanation with the example maybe (when I'm out of teaching hell next week)</p>
</blockquote>
<p>I agree with this. I understand the topology example much more than the typeclass description.</p>



<a name="259232201"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259232201" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Chris Birkbeck <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259232201">(Oct 27 2021 at 12:43)</a>:</h4>
<p>I'm not sure if this helps, but we get the same error if we try and do <code>instance : number_field ℚ := infer_instance</code></p>



<a name="259232564"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259232564" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Chris Birkbeck <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259232564">(Oct 27 2021 at 12:46)</a>:</h4>
<p>It seems <code>cyclotomic.basic.number_field</code> is what causes it to break</p>



<a name="259233925"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259233925" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259233925">(Oct 27 2021 at 12:57)</a>:</h4>
<p>Yes, there is something strange. But</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">number_theory.cyclotomic.basic</span>
<span class="kn">import</span> <span class="n">number_theory.class_number.finite</span>
<span class="kn">import</span> <span class="n">number_theory.class_number.admissible_abs</span>

<span class="kn">open</span> <span class="n">algebra</span> <span class="n">polynomial</span>

<span class="kd">variable</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="n">ℕ</span><span class="bp">+</span><span class="o">)</span>

<span class="kd">instance</span> <span class="o">:</span> <span class="n">is_fraction_ring</span>
  <span class="o">(</span><span class="n">adjoin</span> <span class="n">ℤ</span> <span class="o">{</span><span class="n">b</span> <span class="o">:</span> <span class="o">(</span><span class="n">cyclotomic</span> <span class="n">n</span> <span class="n">ℚ</span><span class="o">)</span><span class="bp">.</span><span class="n">splitting_field</span> <span class="bp">|</span> <span class="n">b</span> <span class="bp">^</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="bp">=</span> <span class="mi">1</span><span class="o">})</span>
  <span class="o">(</span><span class="n">cyclotomic</span> <span class="n">n</span> <span class="n">ℚ</span><span class="o">)</span><span class="bp">.</span><span class="n">splitting_field</span> <span class="o">:=</span> <span class="gr">sorry</span>

<span class="kd">noncomputable</span> <span class="kd">example</span> <span class="o">:</span>
  <span class="n">fintype</span> <span class="o">(</span><span class="n">class_group</span>
  <span class="o">(</span><span class="n">adjoin</span> <span class="n">ℤ</span> <span class="o">{</span><span class="n">b</span> <span class="o">:</span> <span class="o">(</span><span class="n">cyclotomic</span> <span class="n">n</span> <span class="n">ℚ</span><span class="o">)</span><span class="bp">.</span><span class="n">splitting_field</span> <span class="bp">|</span> <span class="n">b</span> <span class="bp">^</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="bp">=</span> <span class="mi">1</span><span class="o">})</span>
  <span class="o">(</span><span class="n">cyclotomic</span> <span class="n">n</span> <span class="n">ℚ</span><span class="o">)</span><span class="bp">.</span><span class="n">splitting_field</span><span class="o">)</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="k">have</span> <span class="n">sepKL</span> <span class="o">:</span> <span class="n">is_separable</span> <span class="n">ℚ</span> <span class="o">(</span><span class="n">cyclotomic</span> <span class="n">n</span> <span class="n">ℚ</span><span class="o">)</span><span class="bp">.</span><span class="n">splitting_field</span> <span class="o">:=</span> <span class="gr">sorry</span><span class="o">,</span>
  <span class="n">haveI</span> <span class="n">iicSRL</span> <span class="o">:</span> <span class="n">is_integral_closure</span>
    <span class="o">(</span><span class="n">adjoin</span> <span class="n">ℤ</span> <span class="o">{</span><span class="n">b</span> <span class="o">:</span> <span class="o">(</span><span class="n">cyclotomic</span> <span class="n">n</span> <span class="n">ℚ</span><span class="o">)</span><span class="bp">.</span><span class="n">splitting_field</span> <span class="bp">|</span> <span class="n">b</span> <span class="bp">^</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="bp">=</span> <span class="mi">1</span><span class="o">})</span> <span class="n">ℤ</span>
    <span class="o">(</span><span class="n">cyclotomic</span> <span class="n">n</span> <span class="n">ℚ</span><span class="o">)</span><span class="bp">.</span><span class="n">splitting_field</span> <span class="o">:=</span> <span class="gr">sorry</span><span class="o">,</span>
  <span class="n">refine</span> <span class="bp">@</span><span class="n">class_group.fintype_of_admissible_of_finite</span> <span class="n">ℤ</span>
    <span class="o">(</span><span class="n">adjoin</span> <span class="n">ℤ</span> <span class="o">{</span><span class="n">b</span> <span class="o">:</span> <span class="o">(</span><span class="n">cyclotomic</span> <span class="n">n</span> <span class="n">ℚ</span><span class="o">)</span><span class="bp">.</span><span class="n">splitting_field</span> <span class="bp">|</span> <span class="n">b</span> <span class="bp">^</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="bp">=</span> <span class="mi">1</span><span class="o">})</span>
    <span class="n">ℚ</span> <span class="o">(</span><span class="n">cyclotomic</span> <span class="n">n</span> <span class="n">ℚ</span><span class="o">)</span><span class="bp">.</span><span class="n">splitting_field</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span>
    <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="n">absolute_value.abs_is_admissible</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span><span class="o">,</span>

<span class="kd">end</span>
</code></pre></div>
<p>works.</p>



<a name="259233952"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259233952" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259233952">(Oct 27 2021 at 12:57)</a>:</h4>
<p>I've unfolded the def by hand.</p>



<a name="259234104"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259234104" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259234104">(Oct 27 2021 at 12:59)</a>:</h4>
<p>Ah, in</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">@[derive [comm_ring]</span><span class="o">]</span>
<span class="kd">def</span> <span class="n">cyclotomic_ring</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span> <span class="o">:=</span> <span class="n">adjoin</span> <span class="n">A</span> <span class="o">{</span> <span class="n">b</span> <span class="o">:</span> <span class="n">K</span> <span class="bp">|</span> <span class="n">b</span> <span class="bp">^</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="bp">=</span> <span class="mi">1</span> <span class="o">}</span>
</code></pre></div>
<p><code>K</code> should be <code>cyclotomic_field {n} K</code>!</p>



<a name="259234127"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259234127" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259234127">(Oct 27 2021 at 12:59)</a>:</h4>
<p>I am pushing this, that in any case fix a mistake</p>



<a name="259235368"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259235368" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259235368">(Oct 27 2021 at 13:08)</a>:</h4>
<p>So,</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">ring_theory.polynomial.cyclotomic</span>
<span class="kn">import</span> <span class="n">number_theory.class_number.finite</span>
<span class="kn">import</span> <span class="n">number_theory.class_number.admissible_abs</span>

<span class="kn">open</span> <span class="n">algebra</span> <span class="n">polynomial</span>

<span class="kd">variable</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="n">ℕ</span><span class="bp">+</span><span class="o">)</span>

<span class="kd">instance</span> <span class="o">:</span> <span class="n">is_fraction_ring</span>
  <span class="o">(</span><span class="n">adjoin</span> <span class="n">ℤ</span> <span class="o">{</span><span class="n">b</span> <span class="o">:</span> <span class="o">(</span><span class="n">cyclotomic</span> <span class="n">n</span> <span class="n">ℚ</span><span class="o">)</span><span class="bp">.</span><span class="n">splitting_field</span> <span class="bp">|</span> <span class="n">b</span> <span class="bp">^</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="bp">=</span> <span class="mi">1</span><span class="o">})</span>
  <span class="o">(</span><span class="n">cyclotomic</span> <span class="n">n</span> <span class="n">ℚ</span><span class="o">)</span><span class="bp">.</span><span class="n">splitting_field</span> <span class="o">:=</span> <span class="gr">sorry</span>

<span class="kd">noncomputable</span> <span class="kd">example</span> <span class="o">:</span>
  <span class="n">fintype</span> <span class="o">(</span><span class="n">class_group</span>
  <span class="o">(</span><span class="n">adjoin</span> <span class="n">ℤ</span> <span class="o">{</span><span class="n">b</span> <span class="o">:</span> <span class="o">(</span><span class="n">cyclotomic</span> <span class="n">n</span> <span class="n">ℚ</span><span class="o">)</span><span class="bp">.</span><span class="n">splitting_field</span> <span class="bp">|</span> <span class="n">b</span> <span class="bp">^</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="bp">=</span> <span class="mi">1</span><span class="o">})</span>
  <span class="o">(</span><span class="n">cyclotomic</span> <span class="n">n</span> <span class="n">ℚ</span><span class="o">)</span><span class="bp">.</span><span class="n">splitting_field</span><span class="o">)</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="n">haveI</span> <span class="n">iicSRL</span> <span class="o">:</span> <span class="n">is_integral_closure</span>
    <span class="o">(</span><span class="n">adjoin</span> <span class="n">ℤ</span> <span class="o">{</span><span class="n">b</span> <span class="o">:</span> <span class="o">(</span><span class="n">cyclotomic</span> <span class="n">n</span> <span class="n">ℚ</span><span class="o">)</span><span class="bp">.</span><span class="n">splitting_field</span> <span class="bp">|</span> <span class="n">b</span> <span class="bp">^</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="bp">=</span> <span class="mi">1</span><span class="o">})</span> <span class="n">ℤ</span>
    <span class="o">(</span><span class="n">cyclotomic</span> <span class="n">n</span> <span class="n">ℚ</span><span class="o">)</span><span class="bp">.</span><span class="n">splitting_field</span> <span class="o">:=</span> <span class="gr">sorry</span><span class="o">,</span>
  <span class="n">exact</span> <span class="n">class_group.fintype_of_admissible_of_finite</span> <span class="n">ℚ</span> <span class="o">(</span><span class="n">cyclotomic</span> <span class="n">n</span> <span class="n">ℚ</span><span class="o">)</span><span class="bp">.</span><span class="n">splitting_field</span>
    <span class="n">absolute_value.abs_is_admissible</span><span class="o">,</span>
<span class="kd">end</span>
</code></pre></div>
<p>works perfectly. But if I add <code>import number_theory.cyclotomic.basic</code> I get the error. So now it's just a matter of bisecting the file to see what causes the problem.</p>



<a name="259237002"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259237002" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259237002">(Oct 27 2021 at 13:20)</a>:</h4>
<p>I found the culprit! It's</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">instance</span> <span class="n">number_field</span> <span class="o">[</span><span class="n">is_cyclotomic_extension</span> <span class="n">S</span> <span class="n">K</span> <span class="n">L</span><span class="o">]</span> <span class="o">[</span><span class="n">number_field</span> <span class="n">K</span><span class="o">]</span> <span class="o">:</span> <span class="n">number_field</span> <span class="n">L</span> <span class="o">:=</span> <span class="gr">sorry</span>
</code></pre></div>
<p>And once you know it, the reason is clear: if <code>K</code> is a number field then <code>L</code> is, but I think we know that subfields of number fields are number fields, so Lean goes back to <code>K</code> and then again to <code>L</code> and so on.</p>



<a name="259238818"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259238818" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Chris Birkbeck <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259238818">(Oct 27 2021 at 13:33)</a>:</h4>
<p>Aha this is what it seemed like when I did this <code>instance : number_field ℚ := infer_instance</code> experiment. But I don't know how to fix it.</p>



<a name="259238967"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259238967" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259238967">(Oct 27 2021 at 13:34)</a>:</h4>
<p>It has to be a lemma, not an instance.</p>



<a name="259239018"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259239018" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259239018">(Oct 27 2021 at 13:34)</a>:</h4>
<p>But we have another problem, and this time it really seems a diamond.</p>



<a name="259239065"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259239065" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Chris Birkbeck <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259239065">(Oct 27 2021 at 13:35)</a>:</h4>
<p><span class="user-mention silent" data-user-id="130384">Riccardo Brasca</span> <a href="#narrow/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn/near/259238967">said</a>:</p>
<blockquote>
<p>It has to be a lemma, not an instance.</p>
</blockquote>
<p>Ahh ok.</p>



<a name="259239081"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259239081" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Chris Birkbeck <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259239081">(Oct 27 2021 at 13:35)</a>:</h4>
<p><span class="user-mention silent" data-user-id="130384">Riccardo Brasca</span> <a href="#narrow/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn/near/259239018">said</a>:</p>
<blockquote>
<p>But we have another problem, and this time it really seems a diamond.</p>
</blockquote>
<p>Oh no</p>



<a name="259239405"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259239405" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259239405">(Oct 27 2021 at 13:37)</a>:</h4>
<p>This</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">noncomputable</span> <span class="kd">instance</span> <span class="n">class_group.fintype_of_cyclotomic_ring</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="n">ℕ</span><span class="bp">+</span><span class="o">)</span> <span class="o">:</span>
  <span class="n">fintype</span> <span class="o">(</span><span class="n">class_group</span> <span class="o">(</span><span class="n">cyclotomic_ring</span> <span class="n">n</span> <span class="n">ℤ</span> <span class="n">ℚ</span><span class="o">)</span> <span class="o">(</span><span class="n">cyclotomic_field</span> <span class="n">n</span> <span class="n">ℚ</span><span class="o">))</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="k">have</span> <span class="n">h</span> <span class="o">:</span> <span class="n">is_scalar_tower</span> <span class="n">ℤ</span> <span class="n">ℚ</span> <span class="o">(</span><span class="n">cyclotomic_field</span> <span class="n">n</span> <span class="n">ℚ</span><span class="o">)</span> <span class="o">:=</span> <span class="n">infer_instance</span><span class="o">,</span>
  <span class="n">refine</span> <span class="bp">@</span><span class="n">class_group.fintype_of_admissible_of_finite</span> <span class="n">ℤ</span> <span class="n">_</span> <span class="n">ℚ</span> <span class="o">(</span><span class="n">cyclotomic_field</span> <span class="n">n</span> <span class="n">ℚ</span><span class="o">)</span>
  <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span>
  <span class="n">_</span>
  <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span><span class="o">,</span>

<span class="kd">end</span>
</code></pre></div>
<p>fails with</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">failed</span> <span class="n">to</span> <span class="n">synthesize</span> <span class="n">type</span> <span class="kd">class</span> <span class="kd">instance</span> <span class="n">for</span>
<span class="n">n</span> <span class="o">:</span> <span class="n">ℕ</span><span class="bp">+</span><span class="o">,</span>
<span class="n">h</span> <span class="o">:</span> <span class="n">is_scalar_tower</span> <span class="n">ℤ</span> <span class="n">ℚ</span> <span class="o">(</span><span class="n">cyclotomic_field</span> <span class="n">n</span> <span class="n">ℚ</span><span class="o">)</span>
<span class="bp">⊢</span> <span class="n">is_scalar_tower</span> <span class="n">ℤ</span> <span class="n">ℚ</span> <span class="o">(</span><span class="n">cyclotomic_field</span> <span class="n">n</span> <span class="n">ℚ</span><span class="o">)</span>
</code></pre></div>
<p>And if you try to put <code>h</code> insted of the isolated underscore, there is a giant <code>type mismatch at application</code> error.</p>



<a name="259239474"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259239474" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yakov Pechersky <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259239474">(Oct 27 2021 at 13:37)</a>:</h4>
<p>(deleted)</p>



<a name="259239617"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259239617" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259239617">(Oct 27 2021 at 13:38)</a>:</h4>
<p>I wanted to see the two types, that's why I used <code>have</code>.</p>



<a name="259239803"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259239803" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259239803">(Oct 27 2021 at 13:39)</a>:</h4>
<p>So <code>h</code> has type</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code>  <span class="bp">@</span><span class="n">is_scalar_tower</span> <span class="n">ℤ</span> <span class="n">ℚ</span> <span class="o">(</span><span class="bp">@</span><span class="n">cyclotomic_field</span> <span class="n">n</span> <span class="n">ℚ</span> <span class="n">rat.field</span><span class="o">)</span>
    <span class="o">(</span><span class="bp">@</span><span class="n">sub_neg_monoid.has_scalar_int</span> <span class="n">ℚ</span> <span class="o">(</span><span class="bp">@</span><span class="n">add_group.to_sub_neg_monoid</span> <span class="n">ℚ</span> <span class="n">rat.add_group</span><span class="o">))</span>
    <span class="o">(</span><span class="bp">@</span><span class="n">smul_with_zero.to_has_scalar</span> <span class="n">ℚ</span> <span class="o">(</span><span class="bp">@</span><span class="n">cyclotomic_field</span> <span class="n">n</span> <span class="n">ℚ</span> <span class="n">rat.field</span><span class="o">)</span>
       <span class="o">(</span><span class="bp">@</span><span class="n">mul_zero_class.to_has_zero</span> <span class="n">ℚ</span>
          <span class="o">(</span><span class="bp">@</span><span class="n">mul_zero_one_class.to_mul_zero_class</span> <span class="n">ℚ</span>
             <span class="o">(</span><span class="bp">@</span><span class="n">monoid_with_zero.to_mul_zero_one_class</span> <span class="n">ℚ</span>
                <span class="o">(</span><span class="bp">@</span><span class="n">semiring.to_monoid_with_zero</span> <span class="n">ℚ</span>
                   <span class="o">(</span><span class="bp">@</span><span class="n">comm_semiring.to_semiring</span> <span class="n">ℚ</span>
                      <span class="o">(</span><span class="bp">@</span><span class="n">comm_ring.to_comm_semiring</span> <span class="n">ℚ</span>
                         <span class="o">(</span><span class="bp">@</span><span class="n">euclidean_domain.to_comm_ring</span> <span class="n">ℚ</span> <span class="o">(</span><span class="bp">@</span><span class="n">field.to_euclidean_domain</span> <span class="n">ℚ</span> <span class="n">rat.field</span><span class="o">))))))))</span>
       <span class="o">(</span><span class="bp">@</span><span class="n">add_zero_class.to_has_zero</span> <span class="o">(</span><span class="bp">@</span><span class="n">cyclotomic_field</span> <span class="n">n</span> <span class="n">ℚ</span> <span class="n">rat.field</span><span class="o">)</span>
          <span class="o">(</span><span class="bp">@</span><span class="n">add_monoid.to_add_zero_class</span> <span class="o">(</span><span class="bp">@</span><span class="n">cyclotomic_field</span> <span class="n">n</span> <span class="n">ℚ</span> <span class="n">rat.field</span><span class="o">)</span>
             <span class="o">(</span><span class="bp">@</span><span class="n">add_comm_monoid.to_add_monoid</span> <span class="o">(</span><span class="bp">@</span><span class="n">cyclotomic_field</span> <span class="n">n</span> <span class="n">ℚ</span> <span class="n">rat.field</span><span class="o">)</span>
                <span class="o">(</span><span class="bp">@</span><span class="n">non_unital_non_assoc_semiring.to_add_comm_monoid</span> <span class="o">(</span><span class="bp">@</span><span class="n">cyclotomic_field</span> <span class="n">n</span> <span class="n">ℚ</span> <span class="n">rat.field</span><span class="o">)</span>
                   <span class="o">(</span><span class="bp">@</span><span class="n">non_assoc_semiring.to_non_unital_non_assoc_semiring</span> <span class="o">(</span><span class="bp">@</span><span class="n">cyclotomic_field</span> <span class="n">n</span> <span class="n">ℚ</span> <span class="n">rat.field</span><span class="o">)</span>
                      <span class="o">(</span><span class="bp">@</span><span class="n">semiring.to_non_assoc_semiring</span> <span class="o">(</span><span class="bp">@</span><span class="n">cyclotomic_field</span> <span class="n">n</span> <span class="n">ℚ</span> <span class="n">rat.field</span><span class="o">)</span>
                         <span class="o">(</span><span class="bp">@</span><span class="n">ring.to_semiring</span> <span class="o">(</span><span class="bp">@</span><span class="n">cyclotomic_field</span> <span class="n">n</span> <span class="n">ℚ</span> <span class="n">rat.field</span><span class="o">)</span>
                            <span class="o">(</span><span class="bp">@</span><span class="n">division_ring.to_ring</span> <span class="o">(</span><span class="bp">@</span><span class="n">cyclotomic_field</span> <span class="n">n</span> <span class="n">ℚ</span> <span class="n">rat.field</span><span class="o">)</span>
                               <span class="o">(</span><span class="bp">@</span><span class="n">field.to_division_ring</span> <span class="o">(</span><span class="bp">@</span><span class="n">cyclotomic_field</span> <span class="n">n</span> <span class="n">ℚ</span> <span class="n">rat.field</span><span class="o">)</span>
                                  <span class="o">(</span><span class="bp">@</span><span class="n">cyclotomic_field.field</span> <span class="n">n</span> <span class="n">ℚ</span> <span class="n">rat.field</span><span class="o">))))))))))</span>
       <span class="o">(</span><span class="bp">@</span><span class="n">mul_action_with_zero.to_smul_with_zero</span> <span class="n">ℚ</span> <span class="o">(</span><span class="bp">@</span><span class="n">cyclotomic_field</span> <span class="n">n</span> <span class="n">ℚ</span> <span class="n">rat.field</span><span class="o">)</span>
          <span class="o">(</span><span class="bp">@</span><span class="n">semiring.to_monoid_with_zero</span> <span class="n">ℚ</span>
             <span class="o">(</span><span class="bp">@</span><span class="n">comm_semiring.to_semiring</span> <span class="n">ℚ</span>
                <span class="o">(</span><span class="bp">@</span><span class="n">comm_ring.to_comm_semiring</span> <span class="n">ℚ</span>
                   <span class="o">(</span><span class="bp">@</span><span class="n">euclidean_domain.to_comm_ring</span> <span class="n">ℚ</span> <span class="o">(</span><span class="bp">@</span><span class="n">field.to_euclidean_domain</span> <span class="n">ℚ</span> <span class="n">rat.field</span><span class="o">)))))</span>
          <span class="o">(</span><span class="bp">@</span><span class="n">add_zero_class.to_has_zero</span> <span class="o">(</span><span class="bp">@</span><span class="n">cyclotomic_field</span> <span class="n">n</span> <span class="n">ℚ</span> <span class="n">rat.field</span><span class="o">)</span>
             <span class="o">(</span><span class="bp">@</span><span class="n">add_monoid.to_add_zero_class</span> <span class="o">(</span><span class="bp">@</span><span class="n">cyclotomic_field</span> <span class="n">n</span> <span class="n">ℚ</span> <span class="n">rat.field</span><span class="o">)</span>
                <span class="o">(</span><span class="bp">@</span><span class="n">add_comm_monoid.to_add_monoid</span> <span class="o">(</span><span class="bp">@</span><span class="n">cyclotomic_field</span> <span class="n">n</span> <span class="n">ℚ</span> <span class="n">rat.field</span><span class="o">)</span>
                   <span class="o">(</span><span class="bp">@</span><span class="n">non_unital_non_assoc_semiring.to_add_comm_monoid</span> <span class="o">(</span><span class="bp">@</span><span class="n">cyclotomic_field</span> <span class="n">n</span> <span class="n">ℚ</span> <span class="n">rat.field</span><span class="o">)</span>
                      <span class="o">(</span><span class="bp">@</span><span class="n">non_assoc_semiring.to_non_unital_non_assoc_semiring</span> <span class="o">(</span><span class="bp">@</span><span class="n">cyclotomic_field</span> <span class="n">n</span> <span class="n">ℚ</span> <span class="n">rat.field</span><span class="o">)</span>
                         <span class="o">(</span><span class="bp">@</span><span class="n">semiring.to_non_assoc_semiring</span> <span class="o">(</span><span class="bp">@</span><span class="n">cyclotomic_field</span> <span class="n">n</span> <span class="n">ℚ</span> <span class="n">rat.field</span><span class="o">)</span>
                            <span class="o">(</span><span class="bp">@</span><span class="n">ring.to_semiring</span> <span class="o">(</span><span class="bp">@</span><span class="n">cyclotomic_field</span> <span class="n">n</span> <span class="n">ℚ</span> <span class="n">rat.field</span><span class="o">)</span>
                               <span class="o">(</span><span class="bp">@</span><span class="n">division_ring.to_ring</span> <span class="o">(</span><span class="bp">@</span><span class="n">cyclotomic_field</span> <span class="n">n</span> <span class="n">ℚ</span> <span class="n">rat.field</span><span class="o">)</span>
                                  <span class="o">(</span><span class="bp">@</span><span class="n">field.to_division_ring</span> <span class="o">(</span><span class="bp">@</span><span class="n">cyclotomic_field</span> <span class="n">n</span> <span class="n">ℚ</span> <span class="n">rat.field</span><span class="o">)</span>
                                     <span class="o">(</span><span class="bp">@</span><span class="n">cyclotomic_field.field</span> <span class="n">n</span> <span class="n">ℚ</span> <span class="n">rat.field</span><span class="o">))))))))))</span>
          <span class="o">(</span><span class="bp">@</span><span class="n">module.to_mul_action_with_zero</span> <span class="n">ℚ</span> <span class="o">(</span><span class="bp">@</span><span class="n">cyclotomic_field</span> <span class="n">n</span> <span class="n">ℚ</span> <span class="n">rat.field</span><span class="o">)</span>
             <span class="o">(</span><span class="bp">@</span><span class="n">comm_semiring.to_semiring</span> <span class="n">ℚ</span>
                <span class="o">(</span><span class="bp">@</span><span class="n">comm_ring.to_comm_semiring</span> <span class="n">ℚ</span>
                   <span class="o">(</span><span class="bp">@</span><span class="n">euclidean_domain.to_comm_ring</span> <span class="n">ℚ</span> <span class="o">(</span><span class="bp">@</span><span class="n">field.to_euclidean_domain</span> <span class="n">ℚ</span> <span class="n">rat.field</span><span class="o">))))</span>
             <span class="o">(</span><span class="bp">@</span><span class="n">non_unital_non_assoc_semiring.to_add_comm_monoid</span> <span class="o">(</span><span class="bp">@</span><span class="n">cyclotomic_field</span> <span class="n">n</span> <span class="n">ℚ</span> <span class="n">rat.field</span><span class="o">)</span>
                <span class="o">(</span><span class="bp">@</span><span class="n">non_assoc_semiring.to_non_unital_non_assoc_semiring</span> <span class="o">(</span><span class="bp">@</span><span class="n">cyclotomic_field</span> <span class="n">n</span> <span class="n">ℚ</span> <span class="n">rat.field</span><span class="o">)</span>
                   <span class="o">(</span><span class="bp">@</span><span class="n">semiring.to_non_assoc_semiring</span> <span class="o">(</span><span class="bp">@</span><span class="n">cyclotomic_field</span> <span class="n">n</span> <span class="n">ℚ</span> <span class="n">rat.field</span><span class="o">)</span>
                      <span class="o">(</span><span class="bp">@</span><span class="n">ring.to_semiring</span> <span class="o">(</span><span class="bp">@</span><span class="n">cyclotomic_field</span> <span class="n">n</span> <span class="n">ℚ</span> <span class="n">rat.field</span><span class="o">)</span>
                         <span class="o">(</span><span class="bp">@</span><span class="n">division_ring.to_ring</span> <span class="o">(</span><span class="bp">@</span><span class="n">cyclotomic_field</span> <span class="n">n</span> <span class="n">ℚ</span> <span class="n">rat.field</span><span class="o">)</span>
                            <span class="o">(</span><span class="bp">@</span><span class="n">field.to_division_ring</span> <span class="o">(</span><span class="bp">@</span><span class="n">cyclotomic_field</span> <span class="n">n</span> <span class="n">ℚ</span> <span class="n">rat.field</span><span class="o">)</span>
                               <span class="o">(</span><span class="bp">@</span><span class="n">cyclotomic_field.field</span> <span class="n">n</span> <span class="n">ℚ</span> <span class="n">rat.field</span><span class="o">)))))))</span>
             <span class="o">(</span><span class="bp">@</span><span class="n">algebra.to_module</span> <span class="n">ℚ</span> <span class="o">(</span><span class="bp">@</span><span class="n">cyclotomic_field</span> <span class="n">n</span> <span class="n">ℚ</span> <span class="n">rat.field</span><span class="o">)</span>
                <span class="o">(</span><span class="bp">@</span><span class="n">comm_ring.to_comm_semiring</span> <span class="n">ℚ</span>
                   <span class="o">(</span><span class="bp">@</span><span class="n">euclidean_domain.to_comm_ring</span> <span class="n">ℚ</span> <span class="o">(</span><span class="bp">@</span><span class="n">field.to_euclidean_domain</span> <span class="n">ℚ</span> <span class="n">rat.field</span><span class="o">)))</span>
                <span class="o">(</span><span class="bp">@</span><span class="n">ring.to_semiring</span> <span class="o">(</span><span class="bp">@</span><span class="n">cyclotomic_field</span> <span class="n">n</span> <span class="n">ℚ</span> <span class="n">rat.field</span><span class="o">)</span>
                   <span class="o">(</span><span class="bp">@</span><span class="n">division_ring.to_ring</span> <span class="o">(</span><span class="bp">@</span><span class="n">cyclotomic_field</span> <span class="n">n</span> <span class="n">ℚ</span> <span class="n">rat.field</span><span class="o">)</span>
                      <span class="o">(</span><span class="bp">@</span><span class="n">field.to_division_ring</span> <span class="o">(</span><span class="bp">@</span><span class="n">cyclotomic_field</span> <span class="n">n</span> <span class="n">ℚ</span> <span class="n">rat.field</span><span class="o">)</span>
                         <span class="o">(</span><span class="bp">@</span><span class="n">cyclotomic_field.field</span> <span class="n">n</span> <span class="n">ℚ</span> <span class="n">rat.field</span><span class="o">))))</span>
                <span class="o">(</span><span class="bp">@</span><span class="n">cyclotomic_field.algebra</span> <span class="n">n</span> <span class="n">ℚ</span> <span class="n">rat.field</span><span class="o">)))))</span>
    <span class="o">(</span><span class="bp">@</span><span class="n">sub_neg_monoid.has_scalar_int</span> <span class="o">(</span><span class="bp">@</span><span class="n">cyclotomic_field</span> <span class="n">n</span> <span class="n">ℚ</span> <span class="n">rat.field</span><span class="o">)</span>
       <span class="o">(</span><span class="bp">@</span><span class="n">add_group.to_sub_neg_monoid</span> <span class="o">(</span><span class="bp">@</span><span class="n">cyclotomic_field</span> <span class="n">n</span> <span class="n">ℚ</span> <span class="n">rat.field</span><span class="o">)</span>
          <span class="o">(</span><span class="bp">@</span><span class="n">add_comm_group.to_add_group</span> <span class="o">(</span><span class="bp">@</span><span class="n">cyclotomic_field</span> <span class="n">n</span> <span class="n">ℚ</span> <span class="n">rat.field</span><span class="o">)</span>
             <span class="o">(</span><span class="bp">@</span><span class="n">ring.to_add_comm_group</span> <span class="o">(</span><span class="bp">@</span><span class="n">cyclotomic_field</span> <span class="n">n</span> <span class="n">ℚ</span> <span class="n">rat.field</span><span class="o">)</span>
                <span class="o">(</span><span class="bp">@</span><span class="n">division_ring.to_ring</span> <span class="o">(</span><span class="bp">@</span><span class="n">cyclotomic_field</span> <span class="n">n</span> <span class="n">ℚ</span> <span class="n">rat.field</span><span class="o">)</span>
                   <span class="o">(</span><span class="bp">@</span><span class="n">field.to_division_ring</span> <span class="o">(</span><span class="bp">@</span><span class="n">cyclotomic_field</span> <span class="n">n</span> <span class="n">ℚ</span> <span class="n">rat.field</span><span class="o">)</span>
                      <span class="o">(</span><span class="bp">@</span><span class="n">cyclotomic_field.field</span> <span class="n">n</span> <span class="n">ℚ</span> <span class="n">rat.field</span><span class="o">)))))))</span>
</code></pre></div>



<a name="259239971"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259239971" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259239971">(Oct 27 2021 at 13:40)</a>:</h4>
<p>And the type Lean wants is so long I cannot post here <span aria-label="upside down" class="emoji emoji-1f643" role="img" title="upside down">:upside_down:</span></p>



<a name="259240338"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259240338" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259240338">(Oct 27 2021 at 13:42)</a>:</h4>
<p>But it must come from the def of <code>cyclotomic_field n ℚ</code>, so it's fixable I hope.</p>



<a name="259247428"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259247428" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259247428">(Oct 27 2021 at 14:28)</a>:</h4>
<p>I've managed to reduce the size of the error, now the two types are almost readable. It's the error in <a href="https://github.com/leanprover-community/flt-regular/blob/master/src/number_theory/cyclotomic/class_group.lean">this</a> file.</p>



<a name="259247507"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259247507" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259247507">(Oct 27 2021 at 14:29)</a>:</h4>
<p><code>@add_comm_group.int_is_scalar_tower ℚ (cyclotomic_field n ℚ) _ _ _</code> has type</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code>  <span class="bp">@</span><span class="n">is_scalar_tower</span> <span class="n">ℤ</span> <span class="n">ℚ</span> <span class="o">(</span><span class="bp">@</span><span class="n">cyclotomic_field</span> <span class="n">n</span> <span class="n">ℚ</span> <span class="n">rat.field</span><span class="o">)</span>
    <span class="o">(</span><span class="bp">@</span><span class="n">sub_neg_monoid.has_scalar_int</span> <span class="n">ℚ</span>
       <span class="o">(</span><span class="bp">@</span><span class="n">add_group.to_sub_neg_monoid</span> <span class="n">ℚ</span>
          <span class="o">(</span><span class="bp">@</span><span class="n">add_comm_group.to_add_group</span> <span class="n">ℚ</span>
             <span class="o">(</span><span class="bp">@</span><span class="n">ring.to_add_comm_group</span> <span class="n">ℚ</span>
                <span class="o">(</span><span class="bp">@</span><span class="n">normed_ring.to_ring</span> <span class="n">ℚ</span>
                   <span class="o">(</span><span class="bp">@</span><span class="n">normed_comm_ring.to_normed_ring</span> <span class="n">ℚ</span> <span class="o">(</span><span class="bp">@</span><span class="n">normed_field.to_normed_comm_ring</span> <span class="n">ℚ</span> <span class="n">rat.normed_field</span><span class="o">)))))))</span>
    <span class="o">(</span><span class="bp">@</span><span class="n">smul_with_zero.to_has_scalar</span> <span class="n">ℚ</span> <span class="o">(</span><span class="bp">@</span><span class="n">cyclotomic_field</span> <span class="n">n</span> <span class="n">ℚ</span> <span class="n">rat.field</span><span class="o">)</span>
       <span class="o">(</span><span class="bp">@</span><span class="n">mul_zero_class.to_has_zero</span> <span class="n">ℚ</span>
          <span class="o">(</span><span class="bp">@</span><span class="n">mul_zero_one_class.to_mul_zero_class</span> <span class="n">ℚ</span>
             <span class="o">(</span><span class="bp">@</span><span class="n">monoid_with_zero.to_mul_zero_one_class</span> <span class="n">ℚ</span>
                <span class="o">(</span><span class="bp">@</span><span class="n">semiring.to_monoid_with_zero</span> <span class="n">ℚ</span>
                   <span class="o">(</span><span class="bp">@</span><span class="n">ring.to_semiring</span> <span class="n">ℚ</span>
                      <span class="o">(</span><span class="bp">@</span><span class="n">normed_ring.to_ring</span> <span class="n">ℚ</span>
                         <span class="o">(</span><span class="bp">@</span><span class="n">normed_comm_ring.to_normed_ring</span> <span class="n">ℚ</span>
                            <span class="o">(</span><span class="bp">@</span><span class="n">normed_field.to_normed_comm_ring</span> <span class="n">ℚ</span> <span class="n">rat.normed_field</span><span class="o">))))))))</span>
       <span class="o">(</span><span class="bp">@</span><span class="n">add_zero_class.to_has_zero</span> <span class="o">(</span><span class="bp">@</span><span class="n">cyclotomic_field</span> <span class="n">n</span> <span class="n">ℚ</span> <span class="n">rat.field</span><span class="o">)</span>
          <span class="o">(</span><span class="bp">@</span><span class="n">add_monoid.to_add_zero_class</span> <span class="o">(</span><span class="bp">@</span><span class="n">cyclotomic_field</span> <span class="n">n</span> <span class="n">ℚ</span> <span class="n">rat.field</span><span class="o">)</span>
             <span class="o">(</span><span class="bp">@</span><span class="n">add_comm_monoid.to_add_monoid</span> <span class="o">(</span><span class="bp">@</span><span class="n">cyclotomic_field</span> <span class="n">n</span> <span class="n">ℚ</span> <span class="n">rat.field</span><span class="o">)</span>
                <span class="o">(</span><span class="bp">@</span><span class="n">add_comm_group.to_add_comm_monoid</span> <span class="o">(</span><span class="bp">@</span><span class="n">cyclotomic_field</span> <span class="n">n</span> <span class="n">ℚ</span> <span class="n">rat.field</span><span class="o">)</span>
                   <span class="o">(</span><span class="bp">@</span><span class="n">ring.to_add_comm_group</span> <span class="o">(</span><span class="bp">@</span><span class="n">cyclotomic_field</span> <span class="n">n</span> <span class="n">ℚ</span> <span class="n">rat.field</span><span class="o">)</span>
                      <span class="o">(</span><span class="bp">@</span><span class="n">division_ring.to_ring</span> <span class="o">(</span><span class="bp">@</span><span class="n">cyclotomic_field</span> <span class="n">n</span> <span class="n">ℚ</span> <span class="n">rat.field</span><span class="o">)</span>
                         <span class="o">(</span><span class="bp">@</span><span class="n">field.to_division_ring</span> <span class="o">(</span><span class="bp">@</span><span class="n">cyclotomic_field</span> <span class="n">n</span> <span class="n">ℚ</span> <span class="n">rat.field</span><span class="o">)</span>
                            <span class="o">(</span><span class="bp">@</span><span class="n">cyclotomic_field.field</span> <span class="n">n</span> <span class="n">ℚ</span> <span class="n">rat.field</span><span class="o">))))))))</span>
       <span class="o">(</span><span class="bp">@</span><span class="n">mul_action_with_zero.to_smul_with_zero</span> <span class="n">ℚ</span> <span class="o">(</span><span class="bp">@</span><span class="n">cyclotomic_field</span> <span class="n">n</span> <span class="n">ℚ</span> <span class="n">rat.field</span><span class="o">)</span>
          <span class="o">(</span><span class="bp">@</span><span class="n">semiring.to_monoid_with_zero</span> <span class="n">ℚ</span>
             <span class="o">(</span><span class="bp">@</span><span class="n">ring.to_semiring</span> <span class="n">ℚ</span>
                <span class="o">(</span><span class="bp">@</span><span class="n">normed_ring.to_ring</span> <span class="n">ℚ</span>
                   <span class="o">(</span><span class="bp">@</span><span class="n">normed_comm_ring.to_normed_ring</span> <span class="n">ℚ</span> <span class="o">(</span><span class="bp">@</span><span class="n">normed_field.to_normed_comm_ring</span> <span class="n">ℚ</span> <span class="n">rat.normed_field</span><span class="o">)))))</span>
          <span class="o">(</span><span class="bp">@</span><span class="n">add_zero_class.to_has_zero</span> <span class="o">(</span><span class="bp">@</span><span class="n">cyclotomic_field</span> <span class="n">n</span> <span class="n">ℚ</span> <span class="n">rat.field</span><span class="o">)</span>
             <span class="o">(</span><span class="bp">@</span><span class="n">add_monoid.to_add_zero_class</span> <span class="o">(</span><span class="bp">@</span><span class="n">cyclotomic_field</span> <span class="n">n</span> <span class="n">ℚ</span> <span class="n">rat.field</span><span class="o">)</span>
                <span class="o">(</span><span class="bp">@</span><span class="n">add_comm_monoid.to_add_monoid</span> <span class="o">(</span><span class="bp">@</span><span class="n">cyclotomic_field</span> <span class="n">n</span> <span class="n">ℚ</span> <span class="n">rat.field</span><span class="o">)</span>
                   <span class="o">(</span><span class="bp">@</span><span class="n">add_comm_group.to_add_comm_monoid</span> <span class="o">(</span><span class="bp">@</span><span class="n">cyclotomic_field</span> <span class="n">n</span> <span class="n">ℚ</span> <span class="n">rat.field</span><span class="o">)</span>
                      <span class="o">(</span><span class="bp">@</span><span class="n">ring.to_add_comm_group</span> <span class="o">(</span><span class="bp">@</span><span class="n">cyclotomic_field</span> <span class="n">n</span> <span class="n">ℚ</span> <span class="n">rat.field</span><span class="o">)</span>
                         <span class="o">(</span><span class="bp">@</span><span class="n">division_ring.to_ring</span> <span class="o">(</span><span class="bp">@</span><span class="n">cyclotomic_field</span> <span class="n">n</span> <span class="n">ℚ</span> <span class="n">rat.field</span><span class="o">)</span>
                            <span class="o">(</span><span class="bp">@</span><span class="n">field.to_division_ring</span> <span class="o">(</span><span class="bp">@</span><span class="n">cyclotomic_field</span> <span class="n">n</span> <span class="n">ℚ</span> <span class="n">rat.field</span><span class="o">)</span>
                               <span class="o">(</span><span class="bp">@</span><span class="n">cyclotomic_field.field</span> <span class="n">n</span> <span class="n">ℚ</span> <span class="n">rat.field</span><span class="o">))))))))</span>
          <span class="o">(</span><span class="bp">@</span><span class="n">module.to_mul_action_with_zero</span> <span class="n">ℚ</span> <span class="o">(</span><span class="bp">@</span><span class="n">cyclotomic_field</span> <span class="n">n</span> <span class="n">ℚ</span> <span class="n">rat.field</span><span class="o">)</span>
             <span class="o">(</span><span class="bp">@</span><span class="n">ring.to_semiring</span> <span class="n">ℚ</span>
                <span class="o">(</span><span class="bp">@</span><span class="n">normed_ring.to_ring</span> <span class="n">ℚ</span>
                   <span class="o">(</span><span class="bp">@</span><span class="n">normed_comm_ring.to_normed_ring</span> <span class="n">ℚ</span> <span class="o">(</span><span class="bp">@</span><span class="n">normed_field.to_normed_comm_ring</span> <span class="n">ℚ</span> <span class="n">rat.normed_field</span><span class="o">))))</span>
             <span class="o">(</span><span class="bp">@</span><span class="n">add_comm_group.to_add_comm_monoid</span> <span class="o">(</span><span class="bp">@</span><span class="n">cyclotomic_field</span> <span class="n">n</span> <span class="n">ℚ</span> <span class="n">rat.field</span><span class="o">)</span>
                <span class="o">(</span><span class="bp">@</span><span class="n">ring.to_add_comm_group</span> <span class="o">(</span><span class="bp">@</span><span class="n">cyclotomic_field</span> <span class="n">n</span> <span class="n">ℚ</span> <span class="n">rat.field</span><span class="o">)</span>
                   <span class="o">(</span><span class="bp">@</span><span class="n">division_ring.to_ring</span> <span class="o">(</span><span class="bp">@</span><span class="n">cyclotomic_field</span> <span class="n">n</span> <span class="n">ℚ</span> <span class="n">rat.field</span><span class="o">)</span>
                      <span class="o">(</span><span class="bp">@</span><span class="n">field.to_division_ring</span> <span class="o">(</span><span class="bp">@</span><span class="n">cyclotomic_field</span> <span class="n">n</span> <span class="n">ℚ</span> <span class="n">rat.field</span><span class="o">)</span>
                         <span class="o">(</span><span class="bp">@</span><span class="n">cyclotomic_field.field</span> <span class="n">n</span> <span class="n">ℚ</span> <span class="n">rat.field</span><span class="o">)))))</span>
             <span class="o">(</span><span class="bp">@</span><span class="n">algebra.to_module</span> <span class="n">ℚ</span> <span class="o">(</span><span class="bp">@</span><span class="n">cyclotomic_field</span> <span class="n">n</span> <span class="n">ℚ</span> <span class="n">rat.field</span><span class="o">)</span> <span class="n">rat.comm_semiring</span>
                <span class="o">(</span><span class="bp">@</span><span class="n">ring.to_semiring</span> <span class="o">(</span><span class="bp">@</span><span class="n">cyclotomic_field</span> <span class="n">n</span> <span class="n">ℚ</span> <span class="n">rat.field</span><span class="o">)</span>
                   <span class="o">(</span><span class="bp">@</span><span class="n">division_ring.to_ring</span> <span class="o">(</span><span class="bp">@</span><span class="n">cyclotomic_field</span> <span class="n">n</span> <span class="n">ℚ</span> <span class="n">rat.field</span><span class="o">)</span>
                      <span class="o">(</span><span class="bp">@</span><span class="n">field.to_division_ring</span> <span class="o">(</span><span class="bp">@</span><span class="n">cyclotomic_field</span> <span class="n">n</span> <span class="n">ℚ</span> <span class="n">rat.field</span><span class="o">)</span>
                         <span class="o">(</span><span class="bp">@</span><span class="n">cyclotomic_field.field</span> <span class="n">n</span> <span class="n">ℚ</span> <span class="n">rat.field</span><span class="o">))))</span>
                <span class="o">(</span><span class="bp">@</span><span class="n">cyclotomic_field.algebra</span> <span class="n">n</span> <span class="n">ℚ</span> <span class="n">rat.field</span><span class="o">)))))</span>
    <span class="o">(</span><span class="bp">@</span><span class="n">sub_neg_monoid.has_scalar_int</span> <span class="o">(</span><span class="bp">@</span><span class="n">cyclotomic_field</span> <span class="n">n</span> <span class="n">ℚ</span> <span class="n">rat.field</span><span class="o">)</span>
       <span class="o">(</span><span class="bp">@</span><span class="n">add_group.to_sub_neg_monoid</span> <span class="o">(</span><span class="bp">@</span><span class="n">cyclotomic_field</span> <span class="n">n</span> <span class="n">ℚ</span> <span class="n">rat.field</span><span class="o">)</span>
          <span class="o">(</span><span class="bp">@</span><span class="n">add_comm_group.to_add_group</span> <span class="o">(</span><span class="bp">@</span><span class="n">cyclotomic_field</span> <span class="n">n</span> <span class="n">ℚ</span> <span class="n">rat.field</span><span class="o">)</span>
             <span class="o">(</span><span class="bp">@</span><span class="n">ring.to_add_comm_group</span> <span class="o">(</span><span class="bp">@</span><span class="n">cyclotomic_field</span> <span class="n">n</span> <span class="n">ℚ</span> <span class="n">rat.field</span><span class="o">)</span>
                <span class="o">(</span><span class="bp">@</span><span class="n">division_ring.to_ring</span> <span class="o">(</span><span class="bp">@</span><span class="n">cyclotomic_field</span> <span class="n">n</span> <span class="n">ℚ</span> <span class="n">rat.field</span><span class="o">)</span>
                   <span class="o">(</span><span class="bp">@</span><span class="n">field.to_division_ring</span> <span class="o">(</span><span class="bp">@</span><span class="n">cyclotomic_field</span> <span class="n">n</span> <span class="n">ℚ</span> <span class="n">rat.field</span><span class="o">)</span>
                      <span class="o">(</span><span class="bp">@</span><span class="n">cyclotomic_field.field</span> <span class="n">n</span> <span class="n">ℚ</span> <span class="n">rat.field</span><span class="o">)))))))</span>
</code></pre></div>



<a name="259247712"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259247712" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259247712">(Oct 27 2021 at 14:30)</a>:</h4>
<p>The actual type is still too big to fit in Zulip...</p>



<a name="259249480"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259249480" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Marc Masdeu <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259249480">(Oct 27 2021 at 14:40)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110038">Kevin Buzzard</span> <a href="#narrow/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn/near/259222531">said</a>:</p>
<blockquote>
<p>I think that a mathematician would understand my explanation better than Julian's, because they would know a lot more about topological spaces than about terms and types. I should PR an extension of the explanation with the example maybe (when I'm out of teaching hell next week)</p>
</blockquote>
<p>Isn't this explanation what's in <a href="https://leanprover-community.github.io/mathlib_docs/notes.html#forgetful%20inheritance">https://leanprover-community.github.io/mathlib_docs/notes.html#forgetful%20inheritance</a> ?</p>



<a name="259257430"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259257430" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259257430">(Oct 27 2021 at 15:28)</a>:</h4>
<p>yeah I didn't click through :-)</p>



<a name="259257938"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259257938" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259257938">(Oct 27 2021 at 15:31)</a>:</h4>
<p>The diamond error is that Lean is failing to solve</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">smul_with_zero.to_has_scalar</span> <span class="bp">=</span> <span class="n">sub_neg_monoid.has_scalar_int</span>
</code></pre></div>



<a name="259258723"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259258723" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259258723">(Oct 27 2021 at 15:36)</a>:</h4>
<p>Ah, thank's!! How did you find it?</p>



<a name="259258897"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259258897" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259258897">(Oct 27 2021 at 15:37)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">noncomputable</span> <span class="kd">lemma</span> <span class="n">class_group.fintype_of_cyclotomic_ring</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="n">ℕ</span><span class="bp">+</span><span class="o">)</span> <span class="o">:</span>
  <span class="n">fintype</span> <span class="o">(</span><span class="n">class_group</span> <span class="o">(</span><span class="n">cyclotomic_ring</span> <span class="n">n</span> <span class="n">ℤ</span> <span class="n">ℚ</span><span class="o">)</span> <span class="o">(</span><span class="n">cyclotomic_field</span> <span class="n">n</span> <span class="n">ℚ</span><span class="o">))</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="n">refine</span> <span class="bp">@</span><span class="n">class_group.fintype_of_admissible_of_finite</span> <span class="n">ℤ</span> <span class="n">_</span> <span class="n">ℚ</span> <span class="o">(</span><span class="n">cyclotomic_field</span> <span class="n">n</span> <span class="n">ℚ</span><span class="o">)</span>
  <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span>
  <span class="o">(</span><span class="kd">by</span> <span class="n">convert</span> <span class="bp">@</span><span class="n">add_comm_group.int_is_scalar_tower</span> <span class="n">ℚ</span> <span class="o">(</span><span class="n">cyclotomic_field</span> <span class="n">n</span> <span class="n">ℚ</span><span class="o">)</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span><span class="o">)</span>
  <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span><span class="o">,</span>

<span class="kd">end</span>
</code></pre></div>



<a name="259258956"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259258956" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259258956">(Oct 27 2021 at 15:38)</a>:</h4>
<p>I'm still thinking about it</p>



<a name="259259036"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259259036" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259259036">(Oct 27 2021 at 15:38)</a>:</h4>
<p>I am quite confused because</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">example</span> <span class="o">:</span> <span class="o">(</span><span class="n">smul_with_zero.to_has_scalar</span> <span class="o">:</span> <span class="n">has_scalar</span> <span class="n">ℤ</span> <span class="o">(</span><span class="n">cyclotomic_field</span> <span class="n">n</span> <span class="n">ℚ</span><span class="o">))</span> <span class="bp">=</span> <span class="n">sub_neg_monoid.has_scalar_int</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="n">refl</span><span class="o">,</span>
<span class="kd">end</span>
</code></pre></div>
<p>works</p>



<a name="259259125"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259259125" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259259125">(Oct 27 2021 at 15:39)</a>:</h4>
<p>Ah, in any case super nice trick using <code>convert</code> to reduce the size of the output.</p>



<a name="259259397"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259259397" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259259397">(Oct 27 2021 at 15:41)</a>:</h4>
<p>We've definitely still not got to the bottom of this</p>



<a name="259259567"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259259567" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259259567">(Oct 27 2021 at 15:42)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">noncomputable</span> <span class="kd">lemma</span> <span class="n">class_group.fintype_of_cyclotomic_ring</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="n">ℕ</span><span class="bp">+</span><span class="o">)</span> <span class="o">:</span>
  <span class="n">fintype</span> <span class="o">(</span><span class="n">class_group</span> <span class="o">(</span><span class="n">cyclotomic_ring</span> <span class="n">n</span> <span class="n">ℤ</span> <span class="n">ℚ</span><span class="o">)</span> <span class="o">(</span><span class="n">cyclotomic_field</span> <span class="n">n</span> <span class="n">ℚ</span><span class="o">))</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="n">refine</span> <span class="bp">@</span><span class="n">class_group.fintype_of_admissible_of_finite</span> <span class="n">ℤ</span> <span class="n">_</span> <span class="n">ℚ</span> <span class="o">(</span><span class="n">cyclotomic_field</span> <span class="n">n</span> <span class="n">ℚ</span><span class="o">)</span>
  <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span>
  <span class="o">(</span><span class="kd">by</span> <span class="o">{</span><span class="n">convert</span> <span class="bp">@</span><span class="n">add_comm_group.int_is_scalar_tower</span> <span class="n">ℚ</span> <span class="o">(</span><span class="n">cyclotomic_field</span> <span class="n">n</span> <span class="n">ℚ</span><span class="o">)</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span><span class="o">,</span> <span class="gr">sorry</span><span class="o">})</span>
  <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span><span class="o">,</span>
<span class="kd">end</span>
</code></pre></div>
<p>That tactic actually compiles without errors, leaving two goals.</p>



<a name="259259637"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259259637" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259259637">(Oct 27 2021 at 15:43)</a>:</h4>
<p>The two goals are OK</p>



<a name="259259646"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259259646" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259259646">(Oct 27 2021 at 15:43)</a>:</h4>
<p>One is <code>absolute value ℤ ℤ</code> -- so Lean is not inferring it</p>



<a name="259259679"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259259679" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259259679">(Oct 27 2021 at 15:43)</a>:</h4>
<p>But the goal before the <code>sorry</code> is not being closed with <code>refl</code></p>



<a name="259259965"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259259965" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259259965">(Oct 27 2021 at 15:45)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">number_theory.cyclotomic.basic</span>
<span class="kn">import</span> <span class="n">number_theory.class_number.finite</span>
<span class="kn">import</span> <span class="n">number_theory.class_number.admissible_abs</span>

<span class="kd">variable</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="n">ℕ</span><span class="bp">+</span><span class="o">)</span>

<span class="kn">section</span> <span class="n">finiteness</span>

<span class="kn">open</span> <span class="n">new_cyclotomic_field</span>

<span class="c1">--set_option pp.all true</span>

<span class="kn">local</span> <span class="kn">attribute</span> <span class="o">[</span><span class="bp">-</span><span class="kd">instance</span><span class="o">]</span> <span class="n">smul_with_zero.to_has_scalar</span>

<span class="kd">noncomputable</span> <span class="kd">lemma</span> <span class="n">class_group.fintype_of_cyclotomic_ring</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="n">ℕ</span><span class="bp">+</span><span class="o">)</span> <span class="o">:</span>
  <span class="n">fintype</span> <span class="o">(</span><span class="n">class_group</span> <span class="o">(</span><span class="n">cyclotomic_ring</span> <span class="n">n</span> <span class="n">ℤ</span> <span class="n">ℚ</span><span class="o">)</span> <span class="o">(</span><span class="n">cyclotomic_field</span> <span class="n">n</span> <span class="n">ℚ</span><span class="o">))</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="n">refine</span> <span class="bp">@</span><span class="n">class_group.fintype_of_admissible_of_finite</span> <span class="n">ℤ</span> <span class="n">_</span> <span class="n">ℚ</span> <span class="o">(</span><span class="n">cyclotomic_field</span> <span class="n">n</span> <span class="n">ℚ</span><span class="o">)</span>
  <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span>
  <span class="o">(</span><span class="kd">by</span> <span class="o">{</span><span class="n">convert</span> <span class="bp">@</span><span class="n">add_comm_group.int_is_scalar_tower</span> <span class="n">ℚ</span> <span class="o">(</span><span class="n">cyclotomic_field</span> <span class="n">n</span> <span class="n">ℚ</span><span class="o">)</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span><span class="o">,</span> <span class="gr">sorry</span><span class="o">})</span>
  <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="n">absolute_value.abs_is_admissible</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span><span class="o">,</span>
<span class="kd">end</span>

<span class="kd">end</span> <span class="n">finiteness</span>
</code></pre></div>



<a name="259260109"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259260109" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259260109">(Oct 27 2021 at 15:46)</a>:</h4>
<p>oh nice! Indeed I'd just discovered that the instance of <code>smul_with_zero.to_has_scalar</code> in the term was not the one that type class inference was discovering.</p>



<a name="259260349"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259260349" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259260349">(Oct 27 2021 at 15:48)</a>:</h4>
<p>But the <code>sorry</code> is still there, I have to think about it.</p>



<a name="259260394"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259260394" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259260394">(Oct 27 2021 at 15:48)</a>:</h4>
<p>Uuughh, this all looks really ugly. I'm cheering you on from the side. The joys of spelunking through the depths of mathlibs algebra hierarchy.</p>



<a name="259260528"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259260528" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259260528">(Oct 27 2021 at 15:49)</a>:</h4>
<p>My understanding so far is that Riccardo has managed to get type class inference to create a term of type <code>has_scalar ℤ (cyclotomic_field n ℚ)</code> which is not defeq to <code>(smul_with_zero.to_has_scalar : has_scalar ℤ (cyclotomic_field n ℚ))</code></p>



<a name="259260855"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259260855" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259260855">(Oct 27 2021 at 15:52)</a>:</h4>
<p>I agree that it's probably my fault, but I thought that all <code>Z</code>-action were defeq, we did a huge refactor to have this, didn't we?</p>



<a name="259261025"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259261025" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259261025">(Oct 27 2021 at 15:53)</a>:</h4>
<p>The definition of <code>cyclotomic_field n K</code> is</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">@[derive [field, algebra K]</span><span class="o">]</span>
<span class="kd">def</span> <span class="n">cyclotomic_field</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">w</span> <span class="o">:=</span> <span class="o">(</span><span class="n">cyclotomic</span> <span class="n">n</span> <span class="n">K</span><span class="o">)</span><span class="bp">.</span><span class="n">splitting_field</span>
</code></pre></div>



<a name="259261148"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259261148" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259261148">(Oct 27 2021 at 15:54)</a>:</h4>
<p>heh :-) certainly not all int actions are defeq, but somehow the idea is supposed to be that we only ever let Lean see the defeq ones :-)</p>



<a name="259261190"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259261190" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259261190">(Oct 27 2021 at 15:54)</a>:</h4>
<p>That <code>smul_wth_zero</code> must be coming from an "ugly" place, I guess.</p>



<a name="259261644"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259261644" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259261644">(Oct 27 2021 at 15:57)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="bp">@</span><span class="n">smul_with_zero.to_has_scalar</span> <span class="n">ℤ</span> <span class="o">(</span><span class="bp">@</span><span class="n">cyclotomic_field</span> <span class="n">n</span> <span class="n">ℚ</span> <span class="n">rat.field</span><span class="o">)</span>
      <span class="o">(</span><span class="bp">@</span><span class="n">mul_zero_class.to_has_zero</span> <span class="n">ℤ</span>
         <span class="o">(</span><span class="bp">@</span><span class="n">mul_zero_one_class.to_mul_zero_class</span> <span class="n">ℤ</span>
            <span class="o">(</span><span class="bp">@</span><span class="n">monoid_with_zero.to_mul_zero_one_class</span> <span class="n">ℤ</span>
               <span class="o">(</span><span class="bp">@</span><span class="n">semiring.to_monoid_with_zero</span> <span class="n">ℤ</span>
                  <span class="o">(</span><span class="bp">@</span><span class="n">comm_semiring.to_semiring</span> <span class="n">ℤ</span>
                     <span class="o">(</span><span class="bp">@</span><span class="n">comm_ring.to_comm_semiring</span> <span class="n">ℤ</span> <span class="o">(</span><span class="bp">@</span><span class="n">euclidean_domain.to_comm_ring</span> <span class="n">ℤ</span> <span class="n">int.euclidean_domain</span><span class="o">)))))))</span>
      <span class="o">(</span><span class="bp">@</span><span class="n">add_zero_class.to_has_zero</span> <span class="o">(</span><span class="bp">@</span><span class="n">cyclotomic_field</span> <span class="n">n</span> <span class="n">ℚ</span> <span class="n">rat.field</span><span class="o">)</span>
         <span class="o">(</span><span class="bp">@</span><span class="n">add_monoid.to_add_zero_class</span> <span class="o">(</span><span class="bp">@</span><span class="n">cyclotomic_field</span> <span class="n">n</span> <span class="n">ℚ</span> <span class="n">rat.field</span><span class="o">)</span>
            <span class="o">(</span><span class="bp">@</span><span class="n">add_comm_monoid.to_add_monoid</span> <span class="o">(</span><span class="bp">@</span><span class="n">cyclotomic_field</span> <span class="n">n</span> <span class="n">ℚ</span> <span class="n">rat.field</span><span class="o">)</span>
               <span class="o">(</span><span class="bp">@</span><span class="n">non_unital_non_assoc_semiring.to_add_comm_monoid</span> <span class="o">(</span><span class="bp">@</span><span class="n">cyclotomic_field</span> <span class="n">n</span> <span class="n">ℚ</span> <span class="n">rat.field</span><span class="o">)</span>
                  <span class="o">(</span><span class="bp">@</span><span class="n">non_assoc_semiring.to_non_unital_non_assoc_semiring</span> <span class="o">(</span><span class="bp">@</span><span class="n">cyclotomic_field</span> <span class="n">n</span> <span class="n">ℚ</span> <span class="n">rat.field</span><span class="o">)</span>
                     <span class="o">(</span><span class="bp">@</span><span class="n">semiring.to_non_assoc_semiring</span> <span class="o">(</span><span class="bp">@</span><span class="n">cyclotomic_field</span> <span class="n">n</span> <span class="n">ℚ</span> <span class="n">rat.field</span><span class="o">)</span>
                        <span class="o">(</span><span class="bp">@</span><span class="n">ring.to_semiring</span> <span class="o">(</span><span class="bp">@</span><span class="n">cyclotomic_field</span> <span class="n">n</span> <span class="n">ℚ</span> <span class="n">rat.field</span><span class="o">)</span>
                           <span class="o">(</span><span class="bp">@</span><span class="n">division_ring.to_ring</span> <span class="o">(</span><span class="bp">@</span><span class="n">cyclotomic_field</span> <span class="n">n</span> <span class="n">ℚ</span> <span class="n">rat.field</span><span class="o">)</span>
                              <span class="o">(</span><span class="bp">@</span><span class="n">field.to_division_ring</span> <span class="o">(</span><span class="bp">@</span><span class="n">cyclotomic_field</span> <span class="n">n</span> <span class="n">ℚ</span> <span class="n">rat.field</span><span class="o">)</span>
                                 <span class="o">(</span><span class="bp">@</span><span class="n">cyclotomic_field.field</span> <span class="n">n</span> <span class="n">ℚ</span> <span class="n">rat.field</span><span class="o">))))))))))</span>
      <span class="o">(</span><span class="bp">@</span><span class="n">mul_action_with_zero.to_smul_with_zero</span> <span class="n">ℤ</span> <span class="o">(</span><span class="bp">@</span><span class="n">cyclotomic_field</span> <span class="n">n</span> <span class="n">ℚ</span> <span class="n">rat.field</span><span class="o">)</span>
         <span class="o">(</span><span class="bp">@</span><span class="n">semiring.to_monoid_with_zero</span> <span class="n">ℤ</span>
            <span class="o">(</span><span class="bp">@</span><span class="n">comm_semiring.to_semiring</span> <span class="n">ℤ</span>
               <span class="o">(</span><span class="bp">@</span><span class="n">comm_ring.to_comm_semiring</span> <span class="n">ℤ</span> <span class="o">(</span><span class="bp">@</span><span class="n">euclidean_domain.to_comm_ring</span> <span class="n">ℤ</span> <span class="n">int.euclidean_domain</span><span class="o">))))</span>
         <span class="o">(</span><span class="bp">@</span><span class="n">add_zero_class.to_has_zero</span> <span class="o">(</span><span class="bp">@</span><span class="n">cyclotomic_field</span> <span class="n">n</span> <span class="n">ℚ</span> <span class="n">rat.field</span><span class="o">)</span>
            <span class="o">(</span><span class="bp">@</span><span class="n">add_monoid.to_add_zero_class</span> <span class="o">(</span><span class="bp">@</span><span class="n">cyclotomic_field</span> <span class="n">n</span> <span class="n">ℚ</span> <span class="n">rat.field</span><span class="o">)</span>
               <span class="o">(</span><span class="bp">@</span><span class="n">add_comm_monoid.to_add_monoid</span> <span class="o">(</span><span class="bp">@</span><span class="n">cyclotomic_field</span> <span class="n">n</span> <span class="n">ℚ</span> <span class="n">rat.field</span><span class="o">)</span>
                  <span class="o">(</span><span class="bp">@</span><span class="n">non_unital_non_assoc_semiring.to_add_comm_monoid</span> <span class="o">(</span><span class="bp">@</span><span class="n">cyclotomic_field</span> <span class="n">n</span> <span class="n">ℚ</span> <span class="n">rat.field</span><span class="o">)</span>
                     <span class="o">(</span><span class="bp">@</span><span class="n">non_assoc_semiring.to_non_unital_non_assoc_semiring</span> <span class="o">(</span><span class="bp">@</span><span class="n">cyclotomic_field</span> <span class="n">n</span> <span class="n">ℚ</span> <span class="n">rat.field</span><span class="o">)</span>
                        <span class="o">(</span><span class="bp">@</span><span class="n">semiring.to_non_assoc_semiring</span> <span class="o">(</span><span class="bp">@</span><span class="n">cyclotomic_field</span> <span class="n">n</span> <span class="n">ℚ</span> <span class="n">rat.field</span><span class="o">)</span>
                           <span class="o">(</span><span class="bp">@</span><span class="n">ring.to_semiring</span> <span class="o">(</span><span class="bp">@</span><span class="n">cyclotomic_field</span> <span class="n">n</span> <span class="n">ℚ</span> <span class="n">rat.field</span><span class="o">)</span>
                              <span class="o">(</span><span class="bp">@</span><span class="n">division_ring.to_ring</span> <span class="o">(</span><span class="bp">@</span><span class="n">cyclotomic_field</span> <span class="n">n</span> <span class="n">ℚ</span> <span class="n">rat.field</span><span class="o">)</span>
                                 <span class="o">(</span><span class="bp">@</span><span class="n">field.to_division_ring</span> <span class="o">(</span><span class="bp">@</span><span class="n">cyclotomic_field</span> <span class="n">n</span> <span class="n">ℚ</span> <span class="n">rat.field</span><span class="o">)</span>
                                    <span class="o">(</span><span class="bp">@</span><span class="n">cyclotomic_field.field</span> <span class="n">n</span> <span class="n">ℚ</span> <span class="n">rat.field</span><span class="o">))))))))))</span>
         <span class="o">(</span><span class="bp">@</span><span class="n">module.to_mul_action_with_zero</span> <span class="n">ℤ</span> <span class="o">(</span><span class="bp">@</span><span class="n">cyclotomic_field</span> <span class="n">n</span> <span class="n">ℚ</span> <span class="n">rat.field</span><span class="o">)</span>
            <span class="o">(</span><span class="bp">@</span><span class="n">comm_semiring.to_semiring</span> <span class="n">ℤ</span>
               <span class="o">(</span><span class="bp">@</span><span class="n">comm_ring.to_comm_semiring</span> <span class="n">ℤ</span> <span class="o">(</span><span class="bp">@</span><span class="n">euclidean_domain.to_comm_ring</span> <span class="n">ℤ</span> <span class="n">int.euclidean_domain</span><span class="o">)))</span>
            <span class="o">(</span><span class="bp">@</span><span class="n">non_unital_non_assoc_semiring.to_add_comm_monoid</span> <span class="o">(</span><span class="bp">@</span><span class="n">cyclotomic_field</span> <span class="n">n</span> <span class="n">ℚ</span> <span class="n">rat.field</span><span class="o">)</span>
               <span class="o">(</span><span class="bp">@</span><span class="n">non_assoc_semiring.to_non_unital_non_assoc_semiring</span> <span class="o">(</span><span class="bp">@</span><span class="n">cyclotomic_field</span> <span class="n">n</span> <span class="n">ℚ</span> <span class="n">rat.field</span><span class="o">)</span>
                  <span class="o">(</span><span class="bp">@</span><span class="n">semiring.to_non_assoc_semiring</span> <span class="o">(</span><span class="bp">@</span><span class="n">cyclotomic_field</span> <span class="n">n</span> <span class="n">ℚ</span> <span class="n">rat.field</span><span class="o">)</span>
                     <span class="o">(</span><span class="bp">@</span><span class="n">ring.to_semiring</span> <span class="o">(</span><span class="bp">@</span><span class="n">cyclotomic_field</span> <span class="n">n</span> <span class="n">ℚ</span> <span class="n">rat.field</span><span class="o">)</span>
                        <span class="o">(</span><span class="bp">@</span><span class="n">division_ring.to_ring</span> <span class="o">(</span><span class="bp">@</span><span class="n">cyclotomic_field</span> <span class="n">n</span> <span class="n">ℚ</span> <span class="n">rat.field</span><span class="o">)</span>
                           <span class="o">(</span><span class="bp">@</span><span class="n">field.to_division_ring</span> <span class="o">(</span><span class="bp">@</span><span class="n">cyclotomic_field</span> <span class="n">n</span> <span class="n">ℚ</span> <span class="n">rat.field</span><span class="o">)</span>
                              <span class="o">(</span><span class="bp">@</span><span class="n">cyclotomic_field.field</span> <span class="n">n</span> <span class="n">ℚ</span> <span class="n">rat.field</span><span class="o">)))))))</span>
            <span class="o">(</span><span class="bp">@</span><span class="n">algebra.to_module</span> <span class="n">ℤ</span> <span class="o">(</span><span class="bp">@</span><span class="n">cyclotomic_field</span> <span class="n">n</span> <span class="n">ℚ</span> <span class="n">rat.field</span><span class="o">)</span>
               <span class="o">(</span><span class="bp">@</span><span class="n">comm_ring.to_comm_semiring</span> <span class="n">ℤ</span> <span class="o">(</span><span class="bp">@</span><span class="n">euclidean_domain.to_comm_ring</span> <span class="n">ℤ</span> <span class="n">int.euclidean_domain</span><span class="o">))</span>
               <span class="o">(</span><span class="bp">@</span><span class="n">ring.to_semiring</span> <span class="o">(</span><span class="bp">@</span><span class="n">cyclotomic_field</span> <span class="n">n</span> <span class="n">ℚ</span> <span class="n">rat.field</span><span class="o">)</span>
                  <span class="o">(</span><span class="bp">@</span><span class="n">division_ring.to_ring</span> <span class="o">(</span><span class="bp">@</span><span class="n">cyclotomic_field</span> <span class="n">n</span> <span class="n">ℚ</span> <span class="n">rat.field</span><span class="o">)</span>
                     <span class="o">(</span><span class="bp">@</span><span class="n">field.to_division_ring</span> <span class="o">(</span><span class="bp">@</span><span class="n">cyclotomic_field</span> <span class="n">n</span> <span class="n">ℚ</span> <span class="n">rat.field</span><span class="o">)</span>
                        <span class="o">(</span><span class="bp">@</span><span class="n">cyclotomic_field.field</span> <span class="n">n</span> <span class="n">ℚ</span> <span class="n">rat.field</span><span class="o">))))</span>
               <span class="o">(</span><span class="bp">@</span><span class="n">new_cyclotomic_field.cyclotomic_field_algebra</span> <span class="n">n</span> <span class="n">ℤ</span> <span class="n">ℚ</span> <span class="n">int.comm_ring</span> <span class="n">rat.field</span> <span class="n">_</span>
                  <span class="o">(</span><span class="bp">@</span><span class="n">algebra_int</span> <span class="n">ℚ</span> <span class="o">(</span><span class="bp">@</span><span class="n">ordered_ring.to_ring</span> <span class="n">ℚ</span> <span class="n">rat.ordered_ring</span><span class="o">))</span>
                  <span class="n">rat.is_fraction_ring</span><span class="o">))))</span> <span class="bp">=</span>
    <span class="bp">@</span><span class="n">sub_neg_monoid.has_scalar_int</span> <span class="o">(</span><span class="bp">@</span><span class="n">cyclotomic_field</span> <span class="n">n</span> <span class="n">ℚ</span> <span class="n">rat.field</span><span class="o">)</span>
      <span class="o">(</span><span class="bp">@</span><span class="n">add_group.to_sub_neg_monoid</span> <span class="o">(</span><span class="bp">@</span><span class="n">cyclotomic_field</span> <span class="n">n</span> <span class="n">ℚ</span> <span class="n">rat.field</span><span class="o">)</span>
         <span class="o">(</span><span class="bp">@</span><span class="n">add_comm_group.to_add_group</span> <span class="o">(</span><span class="bp">@</span><span class="n">cyclotomic_field</span> <span class="n">n</span> <span class="n">ℚ</span> <span class="n">rat.field</span><span class="o">)</span>
            <span class="o">(</span><span class="bp">@</span><span class="n">ring.to_add_comm_group</span> <span class="o">(</span><span class="bp">@</span><span class="n">cyclotomic_field</span> <span class="n">n</span> <span class="n">ℚ</span> <span class="n">rat.field</span><span class="o">)</span>
               <span class="o">(</span><span class="bp">@</span><span class="n">division_ring.to_ring</span> <span class="o">(</span><span class="bp">@</span><span class="n">cyclotomic_field</span> <span class="n">n</span> <span class="n">ℚ</span> <span class="n">rat.field</span><span class="o">)</span>
                  <span class="o">(</span><span class="bp">@</span><span class="n">field.to_division_ring</span> <span class="o">(</span><span class="bp">@</span><span class="n">cyclotomic_field</span> <span class="n">n</span> <span class="n">ℚ</span> <span class="n">rat.field</span><span class="o">)</span>
                     <span class="o">(</span><span class="bp">@</span><span class="n">cyclotomic_field.field</span> <span class="n">n</span> <span class="n">ℚ</span> <span class="n">rat.field</span><span class="o">))))))</span>
</code></pre></div>
<p>Very good</p>



<a name="259264556"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259264556" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259264556">(Oct 27 2021 at 16:16)</a>:</h4>
<p>The bad instance is coming from <code>algebra.to_has_scalar</code></p>



<a name="259265296"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259265296" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259265296">(Oct 27 2021 at 16:22)</a>:</h4>
<p>Yes, I just arrived to the conclusion that the problem is the <code>Z</code>-algebra structure on the cyclotomic field.</p>



<a name="259265361"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259265361" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259265361">(Oct 27 2021 at 16:22)</a>:</h4>
<p>Let me check where it comes from.</p>



<a name="259265476"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259265476" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Chris Birkbeck <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259265476">(Oct 27 2021 at 16:23)</a>:</h4>
<p>Does it come from <code>cyclotomic_field_algebra</code>?</p>



<a name="259265720"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259265720" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259265720">(Oct 27 2021 at 16:24)</a>:</h4>
<p>Yes, the bad instance has <code>new_cyclotomic_field.cyclotomic_field_algebra n ℤ ℚ</code> in it</p>



<a name="259265827"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259265827" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259265827">(Oct 27 2021 at 16:25)</a>:</h4>
<p>It's</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">instance</span> <span class="n">cyclotomic_field_algebra</span> <span class="o">:</span> <span class="n">algebra</span> <span class="n">A</span> <span class="o">(</span><span class="n">cyclotomic_field</span> <span class="n">n</span> <span class="n">K</span><span class="o">)</span> <span class="o">:=</span>
<span class="o">((</span><span class="n">algebra_map</span> <span class="n">K</span> <span class="o">(</span><span class="n">cyclotomic_field</span> <span class="n">n</span> <span class="n">K</span><span class="o">))</span><span class="bp">.</span><span class="n">comp</span> <span class="o">(</span><span class="n">algebra_map</span> <span class="n">A</span> <span class="n">K</span><span class="o">))</span><span class="bp">.</span><span class="n">to_algebra</span>
</code></pre></div>



<a name="259266103"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259266103" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Chris Birkbeck <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259266103">(Oct 27 2021 at 16:27)</a>:</h4>
<p>Maybe for it doesn't like that its a composition when defined for <code>Z</code>?</p>



<a name="259267154"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259267154" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259267154">(Oct 27 2021 at 16:34)</a>:</h4>
<p>Can it be universe related:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">example</span> <span class="o">:</span> <span class="o">(</span><span class="n">new_cyclotomic_field.cyclotomic_field_algebra</span> <span class="n">n</span> <span class="n">ℤ</span> <span class="n">ℚ</span><span class="o">)</span> <span class="bp">=</span>
  <span class="n">algebra</span> <span class="n">ℤ</span> <span class="o">(</span><span class="n">cyclotomic_field</span> <span class="n">n</span> <span class="n">ℚ</span><span class="o">)</span> <span class="o">:=</span> <span class="gr">sorry</span>
</code></pre></div>
<p>is not happy with</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">type</span> <span class="n">mismatch</span> <span class="n">at</span> <span class="n">application</span>
  <span class="n">new_cyclotomic_field.cyclotomic_field_algebra</span> <span class="n">n</span> <span class="n">ℤ</span> <span class="n">ℚ</span> <span class="bp">=</span> <span class="n">algebra</span> <span class="n">ℤ</span> <span class="o">(</span><span class="n">cyclotomic_field</span> <span class="n">n</span> <span class="n">ℚ</span><span class="o">)</span>
<span class="n">term</span>
  <span class="n">algebra</span> <span class="n">ℤ</span> <span class="o">(</span><span class="n">cyclotomic_field</span> <span class="n">n</span> <span class="n">ℚ</span><span class="o">)</span>
<span class="n">has</span> <span class="n">type</span>
  <span class="kt">Type</span> <span class="o">:</span> <span class="kt">Type</span> <span class="mi">1</span>
<span class="n">but</span> <span class="n">is</span> <span class="n">expected</span> <span class="n">to</span> <span class="k">have</span> <span class="n">type</span>
  <span class="n">algebra</span> <span class="n">ℤ</span> <span class="o">(</span><span class="n">cyclotomic_field</span> <span class="n">n</span> <span class="n">ℚ</span><span class="o">)</span> <span class="o">:</span> <span class="kt">Type</span>
</code></pre></div>



<a name="259267322"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259267322" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259267322">(Oct 27 2021 at 16:35)</a>:</h4>
<p>that's some type error, you have (term) = (type of the term)</p>



<a name="259267513"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259267513" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259267513">(Oct 27 2021 at 16:36)</a>:</h4>
<p>But this works :-/</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">noncomputable</span> <span class="kd">def</span> <span class="n">foo</span> <span class="o">:</span> <span class="n">algebra</span> <span class="n">ℤ</span> <span class="o">(</span><span class="n">cyclotomic_field</span> <span class="n">n</span> <span class="n">ℚ</span><span class="o">)</span> <span class="o">:=</span> <span class="n">infer_instance</span>
<span class="kd">example</span> <span class="o">:</span> <span class="n">new_cyclotomic_field.cyclotomic_field_algebra</span> <span class="n">n</span> <span class="n">ℤ</span> <span class="n">ℚ</span> <span class="bp">=</span> <span class="n">foo</span> <span class="n">n</span> <span class="o">:=</span> <span class="n">rfl</span>
</code></pre></div>



<a name="259267673"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259267673" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259267673">(Oct 27 2021 at 16:37)</a>:</h4>
<p>oh but that's just because type class inference finds precisely this term</p>



<a name="259267900"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259267900" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259267900">(Oct 27 2021 at 16:38)</a>:</h4>
<p>so here's the problem:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="c1">-- this is `new_cyclotomic_field.cyclotomic_field_algebra n ℤ ℚ`</span>
<span class="kd">noncomputable</span> <span class="kd">def</span> <span class="n">foo</span> <span class="o">:</span> <span class="n">algebra</span> <span class="n">ℤ</span> <span class="o">(</span><span class="n">cyclotomic_field</span> <span class="n">n</span> <span class="n">ℚ</span><span class="o">)</span> <span class="o">:=</span> <span class="kd">by</span> <span class="n">show_term</span> <span class="o">{</span><span class="n">apply_instance</span><span class="o">}</span>
<span class="c1">-- remove the instance</span>
<span class="kn">local</span> <span class="kn">attribute</span> <span class="o">[</span><span class="bp">-</span><span class="kd">instance</span><span class="o">]</span> <span class="n">new_cyclotomic_field.cyclotomic_field_algebra</span>
<span class="c1">-- still works, now `algebra_int`</span>
<span class="kd">noncomputable</span> <span class="kd">def</span> <span class="n">bar</span> <span class="o">:</span> <span class="n">algebra</span> <span class="n">ℤ</span> <span class="o">(</span><span class="n">cyclotomic_field</span> <span class="n">n</span> <span class="n">ℚ</span><span class="o">)</span> <span class="o">:=</span> <span class="kd">by</span> <span class="n">show_term</span> <span class="o">{</span><span class="n">apply_instance</span><span class="o">}</span>
<span class="c1">-- but they're not defeq</span>
<span class="kd">example</span> <span class="o">:</span> <span class="n">foo</span> <span class="n">n</span> <span class="bp">=</span> <span class="n">bar</span> <span class="n">n</span> <span class="o">:=</span> <span class="n">rfl</span> <span class="c1">-- fails</span>
</code></pre></div>



<a name="259268018"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259268018" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259268018">(Oct 27 2021 at 16:39)</a>:</h4>
<p>The new instance <code>new_cyclotomic_field.cyclotomic_field_algebra</code> is giving a non-defeq <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="double-struck">Z</mi></mrow><annotation encoding="application/x-tex">\Z</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68889em;vertical-align:0em;"></span><span class="mord mathbb">Z</span></span></span></span>-algebra structure</p>



<a name="259268066"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259268066" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Chris Birkbeck <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259268066">(Oct 27 2021 at 16:39)</a>:</h4>
<p>Yeah it must be because its defined as a composition</p>



<a name="259268072"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259268072" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259268072">(Oct 27 2021 at 16:39)</a>:</h4>
<p>Oh gosh, thank you</p>



<a name="259268154"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259268154" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Chris Birkbeck <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259268154">(Oct 27 2021 at 16:40)</a>:</h4>
<p>or not, I dont know</p>



<a name="259268315"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259268315" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259268315">(Oct 27 2021 at 16:41)</a>:</h4>
<p>In any case this is a problem that we have to solve</p>



<a name="259268338"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259268338" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259268338">(Oct 27 2021 at 16:41)</a>:</h4>
<p>Let me see if I have enough time</p>



<a name="259268966"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259268966" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259268966">(Oct 27 2021 at 16:45)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">example</span> <span class="o">(</span><span class="n">A</span> <span class="n">K</span> <span class="n">L</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">)</span> <span class="o">[</span><span class="n">comm_ring</span> <span class="n">A</span><span class="o">]</span> <span class="o">[</span><span class="n">field</span> <span class="n">K</span><span class="o">]</span> <span class="o">[</span><span class="n">field</span> <span class="n">L</span><span class="o">]</span> <span class="o">[</span><span class="n">algebra</span> <span class="n">A</span> <span class="n">K</span><span class="o">]</span> <span class="o">[</span><span class="n">algebra</span> <span class="n">K</span> <span class="n">L</span><span class="o">]</span> <span class="o">:</span> <span class="n">algebra</span> <span class="n">A</span> <span class="n">L</span> <span class="o">:=</span>
<span class="n">infer_instance</span> <span class="c1">-- fails</span>
</code></pre></div>
<p>Is this expected to fail? (i.e. do I need more imports?) I thought it would be worth looking at how analogues of <code>cyclotomic_field_algebra</code> are defined in mathlib.</p>



<a name="259269349"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259269349" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259269349">(Oct 27 2021 at 16:47)</a>:</h4>
<p><span class="user-mention" data-user-id="110038">@Kevin Buzzard</span> Yes, that's supposed to fail. You need to use scalar towers.</p>



<a name="259269425"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259269425" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259269425">(Oct 27 2021 at 16:48)</a>:</h4>
<p>Lean cannot guess which <code>K</code> it should be looking for.</p>



<a name="259269434"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259269434" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259269434">(Oct 27 2021 at 16:48)</a>:</h4>
<p>I thought that was the whole point of scalar towers?</p>



<a name="259269534"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259269534" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259269534">(Oct 27 2021 at 16:48)</a>:</h4>
<p>So the issue is that if A is the integers and if <code>algebra A K</code> is the instance discovered by type class inference (<code>algebra_int</code>) then we want<code>algebra A L</code> to end up also being defeq to this instance.</p>



<a name="259270143"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259270143" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259270143">(Oct 27 2021 at 16:52)</a>:</h4>
<p>Right now this fails (of course):</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">example</span> <span class="o">(</span><span class="n">K</span> <span class="n">L</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">)</span> <span class="o">[</span><span class="n">field</span> <span class="n">K</span><span class="o">]</span> <span class="o">[</span><span class="n">field</span> <span class="n">L</span><span class="o">]</span> <span class="o">[</span><span class="n">algebra</span> <span class="n">K</span> <span class="n">L</span><span class="o">]</span> <span class="o">:</span>
  <span class="o">(</span><span class="n">int.cast_ring_hom</span> <span class="n">L</span> <span class="o">:</span> <span class="n">ℤ</span> <span class="bp">→+*</span> <span class="n">L</span><span class="o">)</span> <span class="bp">=</span> <span class="o">(</span><span class="n">algebra_map</span> <span class="n">K</span> <span class="n">L</span><span class="o">)</span><span class="bp">.</span><span class="n">comp</span> <span class="o">(</span><span class="n">int.cast_ring_hom</span> <span class="n">K</span><span class="o">)</span> <span class="o">:=</span> <span class="n">rfl</span> <span class="c1">-- fails</span>
</code></pre></div>
<p>because the RHS has got some random <code>_inst_3</code> in it. So </p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">instance</span> <span class="n">cyclotomic_field_algebra</span> <span class="o">:</span> <span class="n">algebra</span> <span class="n">A</span> <span class="o">(</span><span class="n">cyclotomic_field</span> <span class="n">n</span> <span class="n">K</span><span class="o">)</span> <span class="o">:=</span>
<span class="o">((</span><span class="n">algebra_map</span> <span class="n">K</span> <span class="o">(</span><span class="n">cyclotomic_field</span> <span class="n">n</span> <span class="n">K</span><span class="o">))</span><span class="bp">.</span><span class="n">comp</span> <span class="o">(</span><span class="n">algebra_map</span> <span class="n">A</span> <span class="n">K</span><span class="o">))</span><span class="bp">.</span><span class="n">to_algebra</span>
</code></pre></div>
<p>will always cause trouble if <code>A = ℤ</code></p>



<a name="259270148"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259270148" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259270148">(Oct 27 2021 at 16:52)</a>:</h4>
<p>I'm actually surprised that we haven't hit this issue earlier...</p>



<a name="259270240"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259270240" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259270240">(Oct 27 2021 at 16:53)</a>:</h4>
<p>There are tons of <code>instance : algebra A blabla</code> in mathlib. But <code>blabla</code> will always already have an <code>algebra ℤ blabla</code> instance coming from <code>algebra_int</code>.</p>



<a name="259270280"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259270280" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259270280">(Oct 27 2021 at 16:53)</a>:</h4>
<p>maybe <code>algebra_int</code> shouldn't be an instance?</p>



<a name="259270293"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259270293" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259270293">(Oct 27 2021 at 16:53)</a>:</h4>
<p><code>algebra_int</code> has priority 99, perhaps this helps (by which I mean perhaps this is why we didn't run into it before)</p>



<a name="259270467"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259270467" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259270467">(Oct 27 2021 at 16:54)</a>:</h4>
<p>Yeah, maybe. Having <code>algebra_int</code> not be an instance is quite disappointing though.</p>



<a name="259270546"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259270546" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259270546">(Oct 27 2021 at 16:55)</a>:</h4>
<p>The alternative is to have all <code>algebra A B</code> instances extend <code>is_scalar_tower \Z A B</code> or something like that?</p>



<a name="259270730"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259270730" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259270730">(Oct 27 2021 at 16:56)</a>:</h4>
<p>That feels very much like how we have solved previous problems of this nature</p>



<a name="259270734"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259270734" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259270734">(Oct 27 2021 at 16:56)</a>:</h4>
<p>Does that even help? You would get an <code>is_scalar_tower ℤ ℤ B</code>, which shows that the two scalar actions are propeq. But they still wouldn't be defeq.</p>



<a name="259270786"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259270786" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259270786">(Oct 27 2021 at 16:57)</a>:</h4>
<p>sigh</p>



<a name="259272270"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259272270" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259272270">(Oct 27 2021 at 17:06)</a>:</h4>
<p>I have to stop, but I agree with Johan that it is strange we never encountered  this before.</p>



<a name="259272661"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259272661" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259272661">(Oct 27 2021 at 17:09)</a>:</h4>
<p>Maybe this is why:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">src</span><span class="bp">/</span><span class="n">ring_theory</span><span class="bp">/</span><span class="n">subsemiring.lean</span>
<span class="mi">842</span><span class="bp">-</span><span class="sd">/-- The action by a subsemiring is the action by the underlying semiring. -/</span>
<span class="mi">843</span><span class="bp">-</span><span class="kd">instance</span> <span class="o">[</span><span class="n">add_comm_monoid</span> <span class="n">α</span><span class="o">]</span> <span class="o">[</span><span class="n">module</span> <span class="n">R'</span> <span class="n">α</span><span class="o">]</span> <span class="o">(</span><span class="n">S</span> <span class="o">:</span> <span class="n">subsemiring</span> <span class="n">R'</span><span class="o">)</span> <span class="o">:</span> <span class="n">module</span> <span class="n">S</span> <span class="n">α</span> <span class="o">:=</span>
<span class="mi">844</span><span class="o">:{</span> <span class="n">smul</span> <span class="o">:=</span> <span class="o">(</span><span class="bp">•</span><span class="o">),</span> <span class="bp">..</span> <span class="n">module.comp_hom</span> <span class="n">_</span> <span class="n">S.subtype</span> <span class="o">}</span>

<span class="n">src</span><span class="bp">/</span><span class="n">algebra</span><span class="bp">/</span><span class="n">module</span><span class="bp">/</span><span class="n">basic.lean</span>
<span class="mi">107</span><span class="bp">-</span><span class="kd">@[reducible]</span> <span class="kd">def</span> <span class="n">module.comp_hom</span> <span class="o">[</span><span class="n">semiring</span> <span class="n">S</span><span class="o">]</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">S</span> <span class="bp">→+*</span> <span class="n">R</span><span class="o">)</span> <span class="o">:</span>
<span class="mi">108</span><span class="bp">-</span>  <span class="n">module</span> <span class="n">S</span> <span class="n">M</span> <span class="o">:=</span>
<span class="mi">109</span><span class="o">:{</span> <span class="n">smul</span> <span class="o">:=</span> <span class="n">has_scalar.comp.smul</span> <span class="n">f</span><span class="o">,</span>

<span class="n">src</span><span class="bp">/</span><span class="n">group_theory</span><span class="bp">/</span><span class="n">group_action</span><span class="bp">/</span><span class="n">defs.lean</span>
<span class="mi">169</span><span class="bp">-</span>  <span class="n">an</span> <span class="n">additive</span> <span class="n">action</span> <span class="n">of</span> <span class="bp">`</span><span class="n">N</span><span class="bp">`</span> <span class="n">on</span> <span class="bp">`</span><span class="n">α</span><span class="bp">`</span> <span class="s2">"-/]</span>
<span class="s2">170-def comp (g : N → M) : has_scalar N α :=</span>
<span class="s2">171:{ smul := has_scalar.comp.smul g }</span>
<span class="s2">--</span>
<span class="s2">309-@[reducible, to_additive] def comp_hom [monoid N] (g : N →* M) :</span>
<span class="s2">310-  mul_action N α :=</span>
<span class="s2">311:{ smul := has_scalar.comp.smul g,</span>
<span class="s2">--</span>
<span class="s2">396-@[reducible] def distrib_mul_action.comp_hom [monoid N] (f : N →* M) :</span>
<span class="s2">397-  distrib_mul_action N A :=</span>
<span class="s2">398:{ smul := has_scalar.comp.smul f,</span>
<span class="s2">--</span>
<span class="s2">476-@[reducible] def mul_distrib_mul_action.comp_hom [monoid N] (f : N →* M) :</span>
<span class="s2">477-  mul_distrib_mul_action N A :=</span>
<span class="s2">478:{ smul := has_scalar.comp.smul f,</span>
</code></pre></div>



<a name="259272734"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259272734" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259272734">(Oct 27 2021 at 17:09)</a>:</h4>
<p>All these examples use <code>.comp</code> for the definition of <code>smul</code>. But they are all defs.</p>



<a name="259272860"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259272860" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259272860">(Oct 27 2021 at 17:10)</a>:</h4>
<p>i.e. none of them are instances</p>



<a name="259272867"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259272867" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259272867">(Oct 27 2021 at 17:10)</a>:</h4>
<p>There is also</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="mi">288</span><span class="bp">-</span><span class="kd">instance</span> <span class="n">lift2_alg</span> <span class="o">{</span><span class="n">F</span> <span class="o">:</span> <span class="n">intermediate_field</span> <span class="n">K</span> <span class="n">L</span><span class="o">}</span> <span class="o">{</span><span class="n">E</span> <span class="o">:</span> <span class="n">intermediate_field</span> <span class="n">F</span> <span class="n">L</span><span class="o">}</span> <span class="o">:</span> <span class="n">algebra</span> <span class="n">K</span> <span class="n">E</span> <span class="o">:=</span>
<span class="mi">289</span><span class="bp">-</span><span class="o">{</span> <span class="n">to_fun</span> <span class="o">:=</span> <span class="o">(</span><span class="n">algebra_map</span> <span class="n">F</span> <span class="n">E</span><span class="o">)</span><span class="bp">.</span><span class="n">comp</span> <span class="o">(</span><span class="n">algebra_map</span> <span class="n">K</span> <span class="n">F</span><span class="o">),</span>
<span class="mi">290</span><span class="bp">-</span>  <span class="n">map_zero'</span> <span class="o">:=</span> <span class="o">((</span><span class="n">algebra_map</span> <span class="n">F</span> <span class="n">E</span><span class="o">)</span><span class="bp">.</span><span class="n">comp</span> <span class="o">(</span><span class="n">algebra_map</span> <span class="n">K</span> <span class="n">F</span><span class="o">))</span><span class="bp">.</span><span class="n">map_zero</span><span class="o">,</span>
<span class="mi">291</span><span class="bp">-</span>  <span class="n">map_one'</span> <span class="o">:=</span> <span class="o">((</span><span class="n">algebra_map</span> <span class="n">F</span> <span class="n">E</span><span class="o">)</span><span class="bp">.</span><span class="n">comp</span> <span class="o">(</span><span class="n">algebra_map</span> <span class="n">K</span> <span class="n">F</span><span class="o">))</span><span class="bp">.</span><span class="n">map_one</span><span class="o">,</span>
<span class="mi">292</span><span class="bp">-</span>  <span class="n">map_add'</span> <span class="o">:=</span> <span class="o">((</span><span class="n">algebra_map</span> <span class="n">F</span> <span class="n">E</span><span class="o">)</span><span class="bp">.</span><span class="n">comp</span> <span class="o">(</span><span class="n">algebra_map</span> <span class="n">K</span> <span class="n">F</span><span class="o">))</span><span class="bp">.</span><span class="n">map_add</span><span class="o">,</span>
<span class="mi">293</span><span class="bp">-</span>  <span class="n">map_mul'</span> <span class="o">:=</span> <span class="o">((</span><span class="n">algebra_map</span> <span class="n">F</span> <span class="n">E</span><span class="o">)</span><span class="bp">.</span><span class="n">comp</span> <span class="o">(</span><span class="n">algebra_map</span> <span class="n">K</span> <span class="n">F</span><span class="o">))</span><span class="bp">.</span><span class="n">map_mul</span><span class="o">,</span>
<span class="mi">294</span><span class="o">:</span>  <span class="n">smul</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">a</span> <span class="n">b</span><span class="o">,</span> <span class="o">(((</span><span class="n">algebra_map</span> <span class="n">F</span> <span class="n">E</span><span class="o">)</span><span class="bp">.</span><span class="n">comp</span> <span class="o">(</span><span class="n">algebra_map</span> <span class="n">K</span> <span class="n">F</span><span class="o">))</span> <span class="n">a</span><span class="o">)</span> <span class="bp">*</span> <span class="n">b</span><span class="o">,</span>
</code></pre></div>
<p>So maybe we can construct a problem there when <code>K = ℚ</code>.</p>



<a name="259272965"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259272965" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259272965">(Oct 27 2021 at 17:11)</a>:</h4>
<p><code>rat.algebra_rat</code> is indeed an instance (every char 0 division ring is a Q-algebra)</p>



<a name="259273770"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259273770" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259273770">(Oct 27 2021 at 17:16)</a>:</h4>
<p>So</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">instance</span> <span class="n">cyclotomic_field_algebra</span> <span class="o">:</span> <span class="n">algebra</span> <span class="n">A</span> <span class="o">(</span><span class="n">cyclotomic_field</span> <span class="n">n</span> <span class="n">K</span><span class="o">)</span> <span class="o">:=</span>
<span class="o">((</span><span class="n">algebra_map</span> <span class="n">K</span> <span class="o">(</span><span class="n">cyclotomic_field</span> <span class="n">n</span> <span class="n">K</span><span class="o">))</span><span class="bp">.</span><span class="n">comp</span> <span class="o">(</span><span class="n">algebra_map</span> <span class="n">A</span> <span class="n">K</span><span class="o">))</span><span class="bp">.</span><span class="n">to_algebra</span>
</code></pre></div>
<p>is evil. Right? What are the assumption on <code>A</code> and <code>K</code> here?</p>



<a name="259273785"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259273785" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259273785">(Oct 27 2021 at 17:16)</a>:</h4>
<p>I should clone the repo.</p>



<a name="259273894"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259273894" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Chris Birkbeck <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259273894">(Oct 27 2021 at 17:17)</a>:</h4>
<p>We have <code>[is_domain A] [algebra A K] [is_fraction_ring A K]</code></p>



<a name="259273946"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259273946" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259273946">(Oct 27 2021 at 17:17)</a>:</h4>
<p>K is the fraction field</p>



<a name="259276395"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259276395" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259276395">(Oct 27 2021 at 17:34)</a>:</h4>
<p>Aha. Then I guess we should just make this a def. And provide the relevant is_scalar_tower instances for it (after making it an instance locally).</p>



<a name="259276433"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259276433" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259276433">(Oct 27 2021 at 17:34)</a>:</h4>
<p>Do you think you will need this as an instance a lot?</p>



<a name="259276514"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259276514" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259276514">(Oct 27 2021 at 17:35)</a>:</h4>
<p>We are going to work with Z, so a def is perfectly fine</p>



<a name="259276515"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259276515" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259276515">(Oct 27 2021 at 17:35)</a>:</h4>
<p>Certainly, when you specialize to <code>ℤ</code> and <code>ℚ</code>, you can give the "correct" instance, which doesn't cause a diamond.</p>



<a name="259276640"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259276640" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259276640">(Oct 27 2021 at 17:36)</a>:</h4>
<p>The definition is <em>much</em> more general than what we need</p>



<a name="259276818"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259276818" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259276818">(Oct 27 2021 at 17:37)</a>:</h4>
<p>Right, that's what I suspected.</p>



<a name="259307459"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259307459" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259307459">(Oct 27 2021 at 21:15)</a>:</h4>
<p>Skimming this thread, I'd claim any algebra instance created with <code>(x.comp y).to_algebra</code> will turn out to be evil</p>



<a name="259307638"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259307638" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259307638">(Oct 27 2021 at 21:16)</a>:</h4>
<p>However mathematicians want to say "B is an A-algebra and C is a B-algebra so C is obviously an A-algebra"</p>



<a name="259307778"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259307778" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259307778">(Oct 27 2021 at 21:17)</a>:</h4>
<p>because if everything is a commutative ring then "B is an A-algebra" is just code for <code>f : A -&gt;+* B</code></p>



<a name="259311336"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259311336" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259311336">(Oct 27 2021 at 21:46)</a>:</h4>
<p>There is no problem in changing the definition, but I don't see how to get rid of the diamond</p>



<a name="259313177"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259313177" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259313177">(Oct 27 2021 at 22:04)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110038">Kevin Buzzard</span> <a href="#narrow/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn/near/259307638">said</a>:</p>
<blockquote>
<p>However mathematicians want to say "B is an A-algebra and C is a B-algebra so C is obviously an A-algebra"</p>
</blockquote>
<p>That's incompatible with the design currently used by mathlib, which is to say "B is an A-algebra, C is a B-algebra, C is an A-algebra <em>in the obvious way</em>", where the last part is <code>is_scalar_tower A B C</code>.</p>



<a name="259313474"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259313474" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259313474">(Oct 27 2021 at 22:07)</a>:</h4>
<p>I'll try a PR to <code>intermediate_field.lift2_alg</code> to fix the smul-diamond.</p>



<a name="259313626"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259313626" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259313626">(Oct 27 2021 at 22:09)</a>:</h4>
<p>But using <code>is_scalar_tower</code> isn't going to fix the diamond, right?</p>



<a name="259314979"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259314979" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259314979">(Oct 27 2021 at 22:21)</a>:</h4>
<p>It fixes one of the two diamonds</p>



<a name="259315062"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259315062" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259315062">(Oct 27 2021 at 22:22)</a>:</h4>
<p>(the one in <code>smul</code> but not the one in <code>algebra_map</code>)</p>



<a name="259317502"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259317502" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259317502">(Oct 27 2021 at 22:46)</a>:</h4>
<p>Done: <a href="https://github.com/leanprover-community/mathlib/issues/10012">#10012</a>. It's great when the fix is to <del>delete code!</del> replace actual proofs with "we already proved this"</p>



<a name="259322364"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259322364" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259322364">(Oct 27 2021 at 23:48)</a>:</h4>
<p>At a glance I think this fixes the problem at the top of the thread, since it was a diamond in <code>has_scalar</code> not <code>algebra_map</code></p>



<a name="259353213"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259353213" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259353213">(Oct 28 2021 at 08:07)</a>:</h4>
<p>So, I made <code>cyclotomic_field_algebra</code> a lemma instead of an instance. We can just put</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">local</span> <span class="kn">attribute</span> <span class="o">[</span><span class="kd">instance</span><span class="o">]</span> <span class="n">new_cyclotomic_field.cyclotomic_field_algebra</span>
</code></pre></div>
<p>if we need it.</p>



<a name="259353326"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259353326" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259353326">(Oct 28 2021 at 08:08)</a>:</h4>
<p>Now this is one is solved, the same thing happens with the other <code>is_scalar_tower</code> is <a href="https://leanprover-community.github.io/mathlib_docs/find/class_group.fintype_of_admissible_of_finite">docs#class_group.fintype_of_admissible_of_finite</a>, but it is surely the same diamond.</p>



<a name="259355203"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259355203" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259355203">(Oct 28 2021 at 08:26)</a>:</h4>
<p><code>number_theory/cyclotomic/class_group</code> finally compiles without errors <span aria-label="grinning" class="emoji emoji-1f600" role="img" title="grinning">:grinning:</span></p>



<a name="259355207"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259355207" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259355207">(Oct 28 2021 at 08:26)</a>:</h4>
<p>Thanks to everybody!</p>



<a name="259358026"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259358026" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259358026">(Oct 28 2021 at 08:53)</a>:</h4>
<p>I will try this afternoon to make <code>number_theory/cyclotomic/cyclotomic_units</code> using the new definition.</p>



<a name="259372145"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259372145" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259372145">(Oct 28 2021 at 11:10)</a>:</h4>
<p>I think <a href="https://github.com/leanprover-community/mathlib/issues/10019">#10019</a> might solve some more algebra issues, but I might need to change <code>splitting_field</code> too</p>



<a name="259374124"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259374124" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259374124">(Oct 28 2021 at 11:31)</a>:</h4>
<p>Thanks! In any case we can work without the algebra instance (over Z), and have it later.</p>



<a name="259374183"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259374183" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259374183">(Oct 28 2021 at 11:32)</a>:</h4>
<p>I don't think we need cyclotomic fields over anything than Q for this project.</p>



<a name="259378006"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259378006" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259378006">(Oct 28 2021 at 12:09)</a>:</h4>
<p>Looking more closely at <code>new_cyclotomic_field.cyclotomic_field_algebra</code>, the diamond is caused by the nasty recursion stuff going on to define the field instance</p>



<a name="259378167"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259378167" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259378167">(Oct 28 2021 at 12:10)</a>:</h4>
<p>The <code>field.zsmul</code> that appears in that recursion is not defeq to the <code>algebra.smul</code> that appears in the algebra recursion</p>



<a name="259380158"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259380158" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259380158">(Oct 28 2021 at 12:28)</a>:</h4>
<p>Here's an example of how recursors can create diamonds:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">variables</span> <span class="o">{</span><span class="n">α</span> <span class="n">β</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">(</span><span class="n">f0</span> <span class="o">:</span> <span class="n">α</span><span class="o">)</span> <span class="o">(</span><span class="n">fs</span> <span class="o">:</span> <span class="n">ℕ</span> <span class="bp">→</span> <span class="n">α</span> <span class="bp">→</span> <span class="n">α</span><span class="o">)</span> <span class="o">(</span><span class="n">g0</span> <span class="o">:</span> <span class="n">β</span><span class="o">)</span> <span class="o">(</span><span class="n">gs</span> <span class="o">:</span> <span class="n">ℕ</span> <span class="bp">→</span> <span class="n">β</span> <span class="bp">→</span> <span class="n">β</span><span class="o">)</span>

<span class="kd">def</span> <span class="n">rec1</span> <span class="o">:</span> <span class="n">ℕ</span> <span class="bp">→</span> <span class="n">α</span> <span class="bp">×</span> <span class="n">β</span>
<span class="bp">|</span> <span class="mi">0</span> <span class="o">:=</span> <span class="o">(</span><span class="n">f0</span><span class="o">,</span> <span class="n">g0</span><span class="o">)</span>
<span class="bp">|</span> <span class="o">(</span><span class="n">n</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)</span> <span class="o">:=</span> <span class="o">(</span><span class="n">fs</span> <span class="n">n</span> <span class="o">(</span><span class="n">rec1</span> <span class="n">n</span><span class="o">)</span><span class="bp">.</span><span class="mi">1</span><span class="o">,</span> <span class="n">gs</span> <span class="n">n</span> <span class="o">(</span><span class="n">rec1</span> <span class="n">n</span><span class="o">)</span><span class="bp">.</span><span class="mi">2</span><span class="o">)</span>

<span class="kd">def</span> <span class="n">rec2</span> <span class="o">:</span> <span class="n">ℕ</span> <span class="bp">→</span> <span class="n">α</span> <span class="bp">×</span> <span class="n">β</span>
<span class="bp">|</span> <span class="n">n</span> <span class="o">:=</span> <span class="o">(</span><span class="n">nat.rec_on</span> <span class="n">n</span> <span class="n">f0</span> <span class="n">fs</span><span class="o">,</span> <span class="n">nat.rec_on</span> <span class="n">n</span> <span class="n">g0</span> <span class="n">gs</span><span class="o">)</span>

<span class="c1">-- not definitionally equal</span>
<span class="kd">example</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="o">:</span> <span class="n">rec1</span> <span class="n">f0</span> <span class="n">fs</span> <span class="n">g0</span> <span class="n">gs</span> <span class="n">n</span> <span class="bp">=</span> <span class="n">rec2</span> <span class="n">f0</span> <span class="n">fs</span> <span class="n">g0</span> <span class="n">gs</span> <span class="n">n</span> <span class="o">:=</span> <span class="n">rfl</span>

<span class="c1">-- but equal nonetheless</span>
<span class="kd">lemma</span> <span class="n">rec1_eq_rec2</span> <span class="o">:</span> <span class="bp">Π</span> <span class="n">n</span><span class="o">,</span> <span class="n">rec1</span> <span class="n">f0</span> <span class="n">fs</span> <span class="n">g0</span> <span class="n">gs</span> <span class="n">n</span> <span class="bp">=</span> <span class="n">rec2</span> <span class="n">f0</span> <span class="n">fs</span> <span class="n">g0</span> <span class="n">gs</span> <span class="n">n</span>
<span class="bp">|</span> <span class="mi">0</span> <span class="o">:=</span> <span class="n">rfl</span>
<span class="bp">|</span> <span class="o">(</span><span class="n">n</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)</span> <span class="o">:=</span> <span class="kd">begin</span>
  <span class="k">have</span> <span class="o">:=</span> <span class="n">rec1_eq_rec2</span> <span class="n">n</span><span class="o">,</span>
  <span class="n">dsimp</span> <span class="o">[</span><span class="n">rec1</span><span class="o">,</span> <span class="n">rec2</span><span class="o">,</span> <span class="bp">←</span><span class="n">nat.succ_eq_add_one</span><span class="o">],</span>
  <span class="n">rw</span> <span class="n">this</span><span class="o">,</span>
  <span class="n">refl</span><span class="o">,</span>
<span class="kd">end</span>
</code></pre></div>



<a name="259434306"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259434306" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Chris Birkbeck <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259434306">(Oct 28 2021 at 18:46)</a>:</h4>
<p>Sorry, I've been afk all day today (and will be on most Thursdays), but I'll try and catch-up on all this today/tomorrow :)</p>



<a name="259436641"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259436641" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259436641">(Oct 28 2021 at 19:02)</a>:</h4>
<p>The replacement for lift_alg2 is merged, did it make any difference?</p>



<a name="259442948"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259442948" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Chris Birkbeck <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259442948">(Oct 28 2021 at 19:52)</a>:</h4>
<p>it's working now! edit: no its not. I hadn't read all the messages :(</p>



<a name="259443010"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259443010" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Chris Birkbeck <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259443010">(Oct 28 2021 at 19:53)</a>:</h4>
<p>Thank you!</p>



<a name="259443808"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259443808" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259443808">(Oct 28 2021 at 19:59)</a>:</h4>
<p>You should make the two def an instance to check if it's really working. I can do this tomorrow</p>



<a name="259444397"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/259444397" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Chris Birkbeck <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#259444397">(Oct 28 2021 at 20:03)</a>:</h4>
<p>Oh no you're right. I made them instances and its complaining about  <code>is_scalar_tower ℤ ℚ (cyclotomic_field n ℚ)</code></p>



<a name="260889849"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/260889849" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#260889849">(Nov 10 2021 at 01:52)</a>:</h4>
<p>i just pushed some old work that I did on cyclotomic things, maybe it can give some inspiration for figuring out the general proofs for <code>is_cyclotomic_extension {n} A B</code></p>



<a name="261048400"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/261048400" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#261048400">(Nov 10 2021 at 20:15)</a>:</h4>
<p>I was looking and thinking, and I think the best way to go about getting any primitive root (at which point the API is good enough for us to do pretty much whatever) is through finding that the cardinality of the roots of unity set is <code>n</code>. I think my specialized argument works, mostly, apart from it requires that <code>X^n-1</code> splits, whilst we "only" have that there is a root of <code>cyclotomic n F</code>.</p>
<p>We definitely need to assume that our cyclotomic extension is normal, because otherwise we get to the weird Frobenius-y counterexamples, which leads to my final question: do we have a maths-proof that if <code>cyclotomic n F</code> splits, then so does <code>X ^ n - 1</code>? It seems perfectly reasonable to me, but every proof that I'd think of assumes we have a prim-root of unity.</p>



<a name="261050421"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/261050421" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#261050421">(Nov 10 2021 at 20:30)</a>:</h4>
<p>In <code>ready_for_mathlib/cyclotomic</code> there is</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">lemma</span> <span class="n">is_root_cyclotomic_iff</span> <span class="o">{</span><span class="n">n</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">}</span> <span class="o">{</span><span class="n">R</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">comm_ring</span> <span class="n">R</span><span class="o">]</span> <span class="o">[</span><span class="n">is_domain</span> <span class="n">R</span><span class="o">]</span> <span class="o">{</span><span class="n">μ</span> <span class="o">:</span> <span class="n">R</span><span class="o">}</span>
  <span class="o">:</span> <span class="n">is_primitive_root</span> <span class="n">μ</span> <span class="n">n</span> <span class="bp">↔</span> <span class="n">is_root</span> <span class="o">(</span><span class="n">cyclotomic</span> <span class="n">n</span> <span class="n">R</span><span class="o">)</span> <span class="n">μ</span> <span class="o">:=</span> <span class="gr">sorry</span>
</code></pre></div>
<p>It shouldn't be difficult.</p>



<a name="261052498"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/261052498" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#261052498">(Nov 10 2021 at 20:48)</a>:</h4>
<p>char_zero simplifies it (it's wrong for some charp; φ₄ ∈ F₂[x], for example) but I don't think it's as trivial as it seems mathematically</p>



<a name="261053228"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/261053228" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#261053228">(Nov 10 2021 at 20:54)</a>:</h4>
<p>Ahahah, yes, that is obviously false, one needs to assume <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mo mathvariant="normal">≠</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">n \neq 0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel"><span class="mrel"><span class="mord vbox"><span class="thinbox"><span class="rlap"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="inner"><span class="mord"><span class="mrel"></span></span></span><span class="fix"></span></span></span></span></span><span class="mrel">=</span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span></span></span></span> in the base ring.</p>



<a name="261053558"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/261053558" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#261053558">(Nov 10 2021 at 20:57)</a>:</h4>
<p>A simple proof is: let <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi></mrow><annotation encoding="application/x-tex">a</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">a</span></span></span></span> be a root, then <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>a</mi><mi>n</mi></msup><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">a^n = 1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.664392em;vertical-align:0em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.664392em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span> (since <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>ψ</mi><mi>n</mi></msub></mrow><annotation encoding="application/x-tex">\psi_n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">ψ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> divides <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>X</mi><mi>n</mi></msup><mo>−</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">X^n-1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.76666em;vertical-align:-0.08333em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.664392em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span>) so <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi></mrow><annotation encoding="application/x-tex">a</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">a</span></span></span></span> is a <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">n</span></span></span></span>-th root of unity.  If <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>a</mi><mi>m</mi></msup><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">a^m=1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.664392em;vertical-align:0em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.664392em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">m</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span> with <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi><mo>&lt;</mo><mi>n</mi></mrow><annotation encoding="application/x-tex">m &lt; n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mord mathnormal">m</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">n</span></span></span></span>, then we obtain a repeated root of <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>X</mi><mi>n</mi></msup><mo>−</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">X^n-1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.76666em;vertical-align:-0.08333em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.664392em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span>, that is impossible.</p>



<a name="261053691"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/261053691" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#261053691">(Nov 10 2021 at 20:58)</a>:</h4>
<p>I used a similar strategy to prove the irreducibility, so all of these is doable without too much effort even in Lean.</p>



<a name="261054276"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/261054276" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#261054276">(Nov 10 2021 at 21:02)</a>:</h4>
<p>To obtain the repeated root we write <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>X</mi><mi>n</mi></msup><mo>−</mo><mn>1</mn><mo>=</mo><msub><mi mathvariant="normal">Ψ</mi><mi>n</mi></msub><msub><mo>∏</mo><mrow><mi>i</mi><mi mathvariant="normal">∣</mi><mi>n</mi><mo separator="true">,</mo><mi>i</mi><mo>&lt;</mo><mi>n</mi></mrow></msub><msub><mi mathvariant="normal">Ψ</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">X^n-1 = \Psi_n \prod_{i | n, i &lt; n}\Psi_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.76666em;vertical-align:-0.08333em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.664392em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.22471em;vertical-align:-0.47471em;"></span><span class="mord"><span class="mord">Ψ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:-0.0000050000000000050004em;">∏</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.22528999999999993em;"><span style="top:-2.40029em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mord mtight">∣</span><span class="mord mathnormal mtight">n</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight">i</span><span class="mrel mtight">&lt;</span><span class="mord mathnormal mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.47471em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord">Ψ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>, and <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>X</mi><mi>m</mi></msup><mo>−</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">X^m-1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.76666em;vertical-align:-0.08333em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.664392em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">m</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span> appears in the second product.</p>



<a name="261054526"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/261054526" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#261054526">(Nov 10 2021 at 21:04)</a>:</h4>
<p>Even better: we prove first of all that <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi></mrow><annotation encoding="application/x-tex">a</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">a</span></span></span></span> is a <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">n</span></span></span></span>-th root of unity iff it is the root of some <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi mathvariant="normal">Ψ</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">\Psi_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord">Ψ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> with <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi><mi mathvariant="normal">∣</mi><mi>n</mi></mrow><annotation encoding="application/x-tex">i|n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">i</span><span class="mord">∣</span><span class="mord mathnormal">n</span></span></span></span> (this is trivial since we have the product formula). Then it's clear that we obtain a double root.</p>



<a name="261054833"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/261054833" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#261054833">(Nov 10 2021 at 21:06)</a>:</h4>
<p>Ooh, I was looking at the product formula for cyclotomic', which requires a primitive root to be there. Woop! That's good news :)  ill try work on this soon</p>



<a name="261054856"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/261054856" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#261054856">(Nov 10 2021 at 21:07)</a>:</h4>
<p>(also <a href="https://github.com/leanprover-community/mathlib/issues/9779">#9779</a> ever relevant...)</p>



<a name="261055019"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/261055019" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#261055019">(Nov 10 2021 at 21:08)</a>:</h4>
<p><code>cyclotomic'</code> is just implementation, it should never be used unless something is missing in the API for cyclotomic. But then one should add it :)</p>



<a name="261055210"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/261055210" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#261055210">(Nov 10 2021 at 21:10)</a>:</h4>
<p>Ah yes, if we now squarefreeness over any ring even better! For fields it's already there</p>



<a name="261055306"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/261055306" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#261055306">(Nov 10 2021 at 21:11)</a>:</h4>
<p>But <a href="https://leanprover-community.github.io/mathlib_docs/find/polynomial.separable.squarefree">docs#polynomial.separable.squarefree</a> is over a field, so one has to generalize this too</p>



<a name="261055765"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/261055765" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#261055765">(Nov 10 2021 at 21:15)</a>:</h4>
<p>I will not have time tomorrow, but I can write all the details on Friday.</p>



<a name="261227993"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/261227993" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#261227993">(Nov 12 2021 at 09:18)</a>:</h4>
<p><span class="user-mention" data-user-id="284160">@Eric Rodriguez</span> Did you make any progress on the roots of cyclotomic polynomials?</p>



<a name="261228100"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/261228100" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#261228100">(Nov 12 2021 at 09:19)</a>:</h4>
<p>I see you did :)</p>



<a name="261238999"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/261238999" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#261238999">(Nov 12 2021 at 11:18)</a>:</h4>
<p>It's now done!! :) Proof could use with a bit of neatening up but I will do that when I'm not on a potato laptop ;b</p>



<a name="261239572"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/261239572" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#261239572">(Nov 12 2021 at 11:25)</a>:</h4>
<p>Very nice! The only place you uses a field rather than a domain is <a href="https://leanprover-community.github.io/mathlib_docs/find/polynomial.separable.squarefree">docs#polynomial.separable.squarefree</a> right?</p>



<a name="261240829"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/261240829" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#261240829">(Nov 12 2021 at 11:39)</a>:</h4>
<p>Yes! And that's actually just too strong of a requirement, too:</p>
<div class="spoiler-block"><div class="spoiler-header">
</div><div class="spoiler-content" aria-hidden="true">
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">field_theory.separable</span>

<span class="kd">variables</span> <span class="o">{</span><span class="n">F</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">comm_ring</span> <span class="n">F</span><span class="o">]</span> <span class="o">[</span><span class="n">is_domain</span> <span class="n">F</span><span class="o">]</span>

<span class="kn">open</span> <span class="n">polynomial</span>
<span class="n">open_locale</span> <span class="n">classical</span>

<span class="kd">lemma</span> <span class="n">multiplicity_le_one_of_separable</span> <span class="o">{</span><span class="n">p</span> <span class="n">q</span> <span class="o">:</span> <span class="n">polynomial</span> <span class="n">F</span><span class="o">}</span> <span class="o">(</span><span class="n">hq</span> <span class="o">:</span> <span class="bp">¬</span> <span class="n">is_unit</span> <span class="n">q</span><span class="o">)</span>
  <span class="o">(</span><span class="n">hsep</span> <span class="o">:</span> <span class="n">separable</span> <span class="n">p</span><span class="o">)</span> <span class="o">:</span> <span class="n">multiplicity</span> <span class="n">q</span> <span class="n">p</span> <span class="bp">≤</span> <span class="mi">1</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="n">contrapose</span><span class="bp">!</span> <span class="n">hq</span><span class="o">,</span>
  <span class="n">apply</span> <span class="n">is_unit_of_self_mul_dvd_separable</span> <span class="n">hsep</span><span class="o">,</span>
  <span class="n">rw</span> <span class="bp">←</span> <span class="n">sq</span><span class="o">,</span>
  <span class="n">apply</span> <span class="n">multiplicity.pow_dvd_of_le_multiplicity</span><span class="o">,</span>
  <span class="n">simpa</span> <span class="n">only</span> <span class="o">[</span><span class="n">nat.cast_one</span><span class="o">,</span> <span class="n">nat.cast_bit0</span><span class="o">]</span> <span class="n">using</span> <span class="n">enat.add_one_le_of_lt</span> <span class="n">hq</span>
<span class="kd">end</span>

<span class="kd">lemma</span> <span class="n">separable.squarefree</span> <span class="o">{</span><span class="n">p</span> <span class="o">:</span> <span class="n">polynomial</span> <span class="n">F</span><span class="o">}</span>  <span class="o">(</span><span class="n">hsep</span> <span class="o">:</span> <span class="n">separable</span> <span class="n">p</span><span class="o">)</span> <span class="o">:</span> <span class="n">squarefree</span> <span class="n">p</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="n">rw</span> <span class="n">multiplicity.squarefree_iff_multiplicity_le_one</span> <span class="n">p</span><span class="o">,</span>
  <span class="n">intro</span> <span class="n">f</span><span class="o">,</span>
  <span class="n">by_cases</span> <span class="n">hunit</span> <span class="o">:</span> <span class="n">is_unit</span> <span class="n">f</span><span class="o">,</span>
  <span class="o">{</span> <span class="n">exact</span> <span class="n">or.inr</span> <span class="n">hunit</span> <span class="o">},</span>
  <span class="n">exact</span> <span class="n">or.inl</span> <span class="o">(</span><span class="n">multiplicity_le_one_of_separable</span> <span class="n">hunit</span> <span class="n">hsep</span><span class="o">)</span>
<span class="kd">end</span>
</code></pre></div>
</div></div>



<a name="261240956"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/261240956" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#261240956">(Nov 12 2021 at 11:40)</a>:</h4>
<p>oh, maybe it's a bit more dependent on it thinking about it, but I think it just takes replacing <code>↑n ≠ 0</code> to <code>is_unit n</code>, possibly</p>



<a name="261241209"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/261241209" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#261241209">(Nov 12 2021 at 11:44)</a>:</h4>
<p>We don't want <code>is_unit n</code> (this is false in the ring of integers), <code>↑n ≠ 0</code> is perfect I think.</p>



<a name="261241226"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/261241226" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#261241226">(Nov 12 2021 at 11:44)</a>:</h4>
<p>The main application for us will be the ring of integers in some cyclotomic field</p>



<a name="261241650"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/261241650" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#261241650">(Nov 12 2021 at 11:50)</a>:</h4>
<p>Feel free to add your generalization of <code>separable.squarefree</code> to the project!</p>



<a name="261241703"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/261241703" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#261241703">(Nov 12 2021 at 11:51)</a>:</h4>
<p>the state of the art so far is <a href="https://leanprover-community.github.io/mathlib_docs/find/polynomial.separable_X_pow_sub_C_unit">docs#polynomial.separable_X_pow_sub_C_unit</a>, I've not given much thought to the separability/squarefreeness of X^n-1 in general rings; that's the main issue</p>



<a name="261241721"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/261241721" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#261241721">(Nov 12 2021 at 11:51)</a>:</h4>
<p>it's just the same as the usual code with the typeclasses updated ^^ I will refactor mathlib soon instead</p>



<a name="261242147"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/261242147" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#261242147">(Nov 12 2021 at 11:56)</a>:</h4>
<p>Ah, in <a href="https://leanprover-community.github.io/mathlib_docs/find/polynomial.separable_X_pow_sub_C_unit">docs#polynomial.separable_X_pow_sub_C_unit</a> there is <code>hn : is_unit ↑n</code>...</p>



<a name="261242204"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/261242204" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#261242204">(Nov 12 2021 at 11:57)</a>:</h4>
<p>So we really need fields</p>



<a name="261242305"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/261242305" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#261242305">(Nov 12 2021 at 11:59)</a>:</h4>
<p>We can probably "cheat" using the field of fraction: a root of the cyclotomic polynomial over a domain is a primitive root when considered in in the field of fraction, so it is a primitive root even in the domain.</p>



<a name="261423949"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/261423949" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#261423949">(Nov 14 2021 at 15:52)</a>:</h4>
<p>oh... so it turns out we reinvented the wheel! (EDIT:) <a href="https://leanprover-community.github.io/mathlib_docs/find/polynomial.order_of_root_cyclotomic_eq">docs#polynomial.order_of_root_cyclotomic_eq</a>. The proof looks pretty identical to my proof, too</p>



<a name="261423963"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/261423963" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#261423963">(Nov 14 2021 at 15:53)</a>:</h4>
<p>(yes, it's currently only for zmod, but I assume that's just what was needed)</p>



<a name="261433208"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/261433208" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#261433208">(Nov 14 2021 at 19:05)</a>:</h4>
<p>Oh, and I even wrote that proof!</p>



<a name="261447197"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/261447197" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#261447197">(Nov 15 2021 at 00:37)</a>:</h4>
<p>I'm having a jaunt at all this right now, and I'm just considering how to structure the <code>basic.lean</code>. I think for <code>splitting_field_cyclotomic</code> and most things after it it'll be nice to have the defn of <code>zeta'</code>, which is currently in <code>cyclotomic_units</code> (we now get that it's a primitive root for "free"). however, this proof is limited (currently) to fields; is the correct approach to use the localization trick to generalize this result to <code>comm_ring</code>s, and then use that there? or just sorry that proof for now, copy everything in, and try work on everything else? it does move it a lot earlier in the import hierarchy</p>



<a name="261473212"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/261473212" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#261473212">(Nov 15 2021 at 09:14)</a>:</h4>
<p>I think it's false for a general ring, but we want it for a domain. The proof using the field of fraction should be easy, right?</p>



<a name="261474674"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/261474674" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#261474674">(Nov 15 2021 at 09:30)</a>:</h4>
<p>But I agree that <code>zeta'</code> should be available as soon as possible</p>



<a name="261543093"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/261543093" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#261543093">(Nov 15 2021 at 19:00)</a>:</h4>
<p>OK, my today has been taken up with the separable generalization, which is now finished: <a href="https://github.com/leanprover-community/mathlib/issues/10337">#10337</a>. will be back to flt in a bit :)</p>



<a name="261793607"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/261793607" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#261793607">(Nov 17 2021 at 14:46)</a>:</h4>
<p>I think the definition of <code>is_cyclotomic_extension</code> will not change anymore (at least not in the near future), so it's probably a good idea to finish the basic API and open a PR. I will start working on the sorry in <code>number_theory/cyclotomic/basic</code>, but if you think you have basic results/definition somewhere else (like for example the definition of <code>zeta'</code>) don't hesitate to move them to <code>basic</code>.</p>



<a name="261857712"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/261857712" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Chris Birkbeck <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#261857712">(Nov 17 2021 at 22:08)</a>:</h4>
<p>Awesome. I'm super busy this week, but I should have lots more time for this next week, so I can help with these sorrys (if any remain!)</p>



<a name="262012597"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/262012597" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#262012597">(Nov 19 2021 at 00:33)</a>:</h4>
<p>i've finally had some time to look at some things, but I think this is the sort of thing where I'd want people's inputs. Firstly, I think <code>n : R ≠ 0</code> will be pretty important for the basic cyclotomic theory, so I propose carrying around in a <code>fact</code>. Everyone accept this as ok?</p>



<a name="262012671"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/262012671" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#262012671">(Nov 19 2021 at 00:34)</a>:</h4>
<p>Secondly, there's a TC timeout in <code>cyclotomic_units:182</code> - do we worry about it now? Or until we unsorry instances? I don't know how to debug such things</p>



<a name="262038717"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/262038717" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#262038717">(Nov 19 2021 at 08:23)</a>:</h4>
<p>Using <code>:= by convert ...</code> instead of <code>:= ...</code> seems to fix the timeout for me. I didn't investigate why.</p>



<a name="262046227"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/262046227" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#262046227">(Nov 19 2021 at 09:51)</a>:</h4>
<p>What do you think of the <code>fact</code> idea?</p>



<a name="262046995"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/262046995" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#262046995">(Nov 19 2021 at 09:59)</a>:</h4>
<p>My student Ashvni has been working with p-adic stuff and told me yesterday that <code>fact p.prime</code> drove her nuts :-) In the definition of the p-adic numbers the decision was made to make p the parameter rather than hp : prime p, so what we write in lean corresponds to what we write in papers, but it also makes things quite inconvenient in practice apparently. On the other hand we used facts quite a bit in the perfectoid project. <span class="user-mention" data-user-id="112680">@Johan Commelin</span> did facts drive you nuts? Don't forget the alternative, which is just to carry hn : n ≠ 0 around by hand</p>



<a name="262047490"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/262047490" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#262047490">(Nov 19 2021 at 10:04)</a>:</h4>
<p>We didn't use <code>fact</code> in the perfectoid project. Do you mean LTE?</p>



<a name="262047520"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/262047520" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#262047520">(Nov 19 2021 at 10:04)</a>:</h4>
<p>I found the <code>fact</code>s quite convenient. Certainly <code>fact p.prime</code> has been quite pleasant to use for me.</p>



<a name="262047587"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/262047587" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#262047587">(Nov 19 2021 at 10:05)</a>:</h4>
<p>What exactly are the problems that Ashvni is hitting?</p>



<a name="262050199"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/262050199" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#262050199">(Nov 19 2021 at 10:35)</a>:</h4>
<p><span class="user-mention" data-user-id="284160">@Eric Rodriguez</span>  I don't have any strong opinion about your <code>fact</code> idea, but it is surely true that <code>n : R ≠ 0</code> is needed in a lot of places. In my opinion we should try to keep things as modular as possible, so we should have a subfolder of the (nonexistent) <code>number_theory/cyclotomic</code> folder called <code>separable</code> (or whatever) where we put all the results that need <code>n : R ≠ 0</code>.  We should try to see if having the assumption as <code>fact</code> really reduces what we have to write.</p>



<a name="262050432"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/262050432" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#262050432">(Nov 19 2021 at 10:37)</a>:</h4>
<p>Here is one reason why <code>fact</code> is sometimes a powerful tool: before we used <code>fact</code> we had two separate types <code>zmod</code> and <code>zmodp</code>. The latter was only defined for primes, and it carried a field instance. But with <code>fact</code> we could unify these, and now <code>zmod n</code> has a ring instance, but in the presence of <code>fact p.prime</code> then <code>zmod p</code> will also have a field instance.</p>



<a name="262064644"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/262064644" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#262064644">(Nov 19 2021 at 13:17)</a>:</h4>
<p>Yes, this is a very important feature of fact, I think the annoyance comes when you have to things that are based on fact and things that just use a regular hypothesis. You have to start writing <code>out</code> everywhere, not so bad, but also take care that tactics can see the fact. For instance library_searhc</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">data.nat.prime</span>

<span class="kd">lemma</span> <span class="n">a</span> <span class="o">{</span><span class="n">p</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">}</span> <span class="o">[</span><span class="n">fact</span> <span class="n">p.prime</span><span class="o">]</span> <span class="o">:</span> <span class="mi">2</span> <span class="bp">≤</span> <span class="n">p</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="n">library_search</span><span class="o">,</span> <span class="c1">--fails</span>

<span class="kd">end</span>


<span class="kd">lemma</span> <span class="n">b</span> <span class="o">{</span><span class="n">p</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">}</span> <span class="o">(</span><span class="n">hp</span> <span class="o">:</span> <span class="n">p.prime</span><span class="o">)</span> <span class="o">:</span> <span class="mi">2</span> <span class="bp">≤</span> <span class="n">p</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="n">library_search</span><span class="o">,</span> <span class="c1">--works</span>

<span class="kd">end</span>
</code></pre></div>



<a name="262064928"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/262064928" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#262064928">(Nov 19 2021 at 13:19)</a>:</h4>
<p>I'm not sure if the intended use of <code>fact</code> is to make the hypotheses regular parameters and do <code>haveI : fact p.prime := hp</code> when you know you are going to need it, or to make the hypotheses facts and use <code>have hp : p.prime := fact.out</code> when you want the actual thing</p>



<a name="262065699"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/262065699" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#262065699">(Nov 19 2021 at 13:26)</a>:</h4>
<p>My rule of thumb is: if you would start the LaTeX version of the file with "For the rest of this paper, we fix a prime number <code>p</code>", then you use <code>fact</code>. But if you are working with various prime numbers, or various types of prime numbers, then regular parameters is probably better.</p>



<a name="262065774"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/262065774" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#262065774">(Nov 19 2021 at 13:27)</a>:</h4>
<p>Yeah for the library as it is right now you really do need both, so you have to convert between the two at some point</p>



<a name="262065913"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/262065913" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#262065913">(Nov 19 2021 at 13:28)</a>:</h4>
<p>Note that you can also assume <code>[hp : fact p.prime]</code>. Then <code>hp.1</code> is a term of type <code>p.prime</code>. Which works quite smoothly, I think.</p>



<a name="262065998"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/262065998" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#262065998">(Nov 19 2021 at 13:29)</a>:</h4>
<p>But in my example you still have to either know the lemma library searched for, or ahead of time add the line <code>have := hp.1</code> to your context for every fact</p>



<a name="262066039"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/262066039" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#262066039">(Nov 19 2021 at 13:29)</a>:</h4>
<p>Or fix <code>library_search</code> <span aria-label="rofl" class="emoji emoji-1f923" role="img" title="rofl">:rofl:</span></p>



<a name="262066421"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/262066421" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#262066421">(Nov 19 2021 at 13:32)</a>:</h4>
<p>You have to make a lot of other tactics  fact aware too though!</p>



<a name="262066432"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/262066432" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#262066432">(Nov 19 2021 at 13:33)</a>:</h4>
<p>Like assumption for instance</p>



<a name="262066756"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/262066756" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#262066756">(Nov 19 2021 at 13:36)</a>:</h4>
<p>Ooh, sure, if you want interop with all tactics.</p>



<a name="262066821"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/262066821" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#262066821">(Nov 19 2021 at 13:36)</a>:</h4>
<p>I was thinking of the discussion that extracts proof fields out of structures, before running a tactic such as <code>library_search</code>.</p>



<a name="262066833"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/262066833" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#262066833">(Nov 19 2021 at 13:37)</a>:</h4>
<p>Well I would just love all the benefits of fact without having to modify my proofs and habits, at least thats what gets to me about it</p>



<a name="262066868"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/262066868" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#262066868">(Nov 19 2021 at 13:37)</a>:</h4>
<p>Yeah it would be nice to have a "unfact" tactic, but its still unfortunate to run it at all</p>



<a name="262172924"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/262172924" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#262172924">(Nov 20 2021 at 09:10)</a>:</h4>
<p>I will not have time to work on this during the weekend, but if someone wants to contribute I am stuck at (this is in <code>number_theory/cyclotomic/basic</code>)</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">lemma</span> <span class="n">union_left</span> <span class="o">[</span><span class="n">h</span> <span class="o">:</span> <span class="n">is_cyclotomic_extension</span> <span class="n">T</span> <span class="n">A</span> <span class="n">B</span><span class="o">]</span> <span class="o">(</span><span class="n">hS</span> <span class="o">:</span> <span class="n">S</span> <span class="bp">⊆</span> <span class="n">T</span><span class="o">)</span> <span class="o">:</span>
  <span class="n">is_cyclotomic_extension</span> <span class="n">S</span> <span class="n">A</span> <span class="o">(</span><span class="n">adjoin</span> <span class="n">A</span> <span class="o">{</span> <span class="n">b</span> <span class="o">:</span> <span class="n">B</span> <span class="bp">|</span> <span class="bp">∃</span> <span class="n">a</span> <span class="o">:</span> <span class="n">ℕ</span><span class="bp">+</span><span class="o">,</span> <span class="n">a</span> <span class="bp">∈</span> <span class="n">S</span> <span class="bp">∧</span> <span class="n">b</span> <span class="bp">^</span> <span class="o">(</span><span class="n">a</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="bp">=</span> <span class="mi">1</span> <span class="o">})</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="n">refine</span> <span class="o">⟨</span><span class="bp">λ</span> <span class="n">n</span> <span class="n">hn</span><span class="o">,</span> <span class="n">_</span><span class="o">,</span> <span class="bp">λ</span> <span class="n">b</span><span class="o">,</span> <span class="n">_</span><span class="o">⟩,</span>
  <span class="o">{</span> <span class="n">obtain</span> <span class="o">⟨</span><span class="n">b</span><span class="o">,</span> <span class="n">hb</span><span class="o">⟩</span> <span class="o">:=</span> <span class="o">((</span><span class="n">iff</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span><span class="o">)</span><span class="bp">.</span><span class="mi">1</span> <span class="n">h</span><span class="o">)</span><span class="bp">.</span><span class="mi">1</span> <span class="n">n</span> <span class="o">(</span><span class="n">hS</span> <span class="n">hn</span><span class="o">),</span>
    <span class="n">refine</span> <span class="o">⟨⟨</span><span class="n">b</span><span class="o">,</span> <span class="n">subset_adjoin</span> <span class="o">⟨</span><span class="n">n</span><span class="o">,</span> <span class="n">hn</span><span class="o">,</span> <span class="n">_</span><span class="o">⟩⟩,</span> <span class="n">_</span><span class="o">⟩,</span>
    <span class="o">{</span> <span class="n">rw</span> <span class="o">[</span><span class="n">aeval_def</span><span class="o">,</span> <span class="n">eval₂_eq_eval_map</span><span class="o">,</span> <span class="n">map_cyclotomic</span><span class="o">,</span> <span class="bp">←</span> <span class="n">is_root.def</span><span class="o">]</span> <span class="n">at</span> <span class="n">hb</span><span class="o">,</span>
      <span class="k">suffices</span> <span class="o">:</span> <span class="o">(</span><span class="n">X</span> <span class="bp">^</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="bp">-</span> <span class="mi">1</span><span class="o">)</span><span class="bp">.</span><span class="n">is_root</span> <span class="n">b</span><span class="o">,</span>
      <span class="o">{</span> <span class="n">simpa</span> <span class="o">[</span><span class="n">sub_eq_zero</span><span class="o">]</span> <span class="n">using</span> <span class="n">this</span> <span class="o">},</span>
      <span class="n">rw</span> <span class="o">[</span><span class="bp">←</span> <span class="o">(</span><span class="n">eq_cyclotomic_iff</span> <span class="n">n.pos</span> <span class="n">_</span><span class="o">)</span><span class="bp">.</span><span class="mi">1</span> <span class="n">rfl</span><span class="o">],</span>
      <span class="n">exact</span> <span class="n">root_mul_right_of_is_root</span> <span class="n">_</span> <span class="n">hb</span> <span class="o">},</span>
      <span class="n">rwa</span> <span class="o">[</span><span class="bp">←</span> <span class="n">subalgebra.coe_eq_zero</span><span class="o">,</span> <span class="n">aeval_subalgebra_coe</span><span class="o">,</span> <span class="n">subtype.coe_mk</span><span class="o">]</span> <span class="o">},</span>
  <span class="o">{</span> <span class="gr">sorry</span> <span class="o">}</span>
<span class="kd">end</span>
</code></pre></div>
<p>The goal is</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="bp">...</span>
<span class="n">b</span><span class="o">:</span> <span class="bp">↥</span><span class="o">(</span><span class="n">adjoin</span> <span class="n">A</span> <span class="o">{</span><span class="n">b</span> <span class="o">:</span> <span class="n">B</span> <span class="bp">|</span> <span class="bp">∃</span> <span class="o">(</span><span class="n">a</span> <span class="o">:</span> <span class="n">ℕ</span><span class="bp">+</span><span class="o">),</span> <span class="n">a</span> <span class="bp">∈</span> <span class="n">S</span> <span class="bp">∧</span> <span class="n">b</span> <span class="bp">^</span> <span class="bp">↑</span><span class="n">a</span> <span class="bp">=</span> <span class="mi">1</span><span class="o">})</span>
<span class="bp">⊢</span> <span class="n">b</span> <span class="bp">∈</span> <span class="n">adjoin</span> <span class="n">A</span> <span class="o">{</span><span class="n">b</span> <span class="o">:</span> <span class="bp">↥</span><span class="o">(</span><span class="n">adjoin</span> <span class="n">A</span> <span class="o">{</span><span class="n">b</span> <span class="o">:</span> <span class="n">B</span> <span class="bp">|</span> <span class="bp">∃</span> <span class="o">(</span><span class="n">a</span> <span class="o">:</span> <span class="n">ℕ</span><span class="bp">+</span><span class="o">),</span> <span class="n">a</span> <span class="bp">∈</span> <span class="n">S</span> <span class="bp">∧</span> <span class="n">b</span> <span class="bp">^</span> <span class="bp">↑</span><span class="n">a</span> <span class="bp">=</span> <span class="mi">1</span><span class="o">})</span> <span class="bp">|</span> <span class="bp">∃</span> <span class="o">(</span><span class="n">a</span> <span class="o">:</span> <span class="n">ℕ</span><span class="bp">+</span><span class="o">),</span> <span class="n">a</span> <span class="bp">∈</span> <span class="n">S</span> <span class="bp">∧</span> <span class="n">b</span> <span class="bp">^</span> <span class="bp">↑</span><span class="n">a</span> <span class="bp">=</span> <span class="mi">1</span><span class="o">}</span>
</code></pre></div>
<p>I didn't tried hard, but working with subtypes is annoying! One this is done (or maybe a better reformulation?) the ending the proof of </p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">lemma</span> <span class="n">finite</span> <span class="o">[</span><span class="n">h₁</span> <span class="o">:</span> <span class="n">fintype</span> <span class="n">S</span><span class="o">]</span> <span class="o">[</span><span class="n">h₂</span> <span class="o">:</span> <span class="n">is_cyclotomic_extension</span> <span class="n">S</span> <span class="n">A</span> <span class="n">B</span><span class="o">]</span> <span class="o">:</span> <span class="n">finite</span> <span class="n">A</span> <span class="n">B</span>
</code></pre></div>
<p>should be easy.</p>



<a name="262196148"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/262196148" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#262196148">(Nov 20 2021 at 18:00)</a>:</h4>
<p>this is such a pesky goal...</p>



<a name="262199953"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/262199953" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#262199953">(Nov 20 2021 at 19:21)</a>:</h4>
<p>I agree... But I don't see a better formulation of the result, that is meaningful</p>



<a name="262210954"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/262210954" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yakov Pechersky <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#262210954">(Nov 20 2021 at 23:33)</a>:</h4>
<p>You should be able to say "cases b with b hb" to destruct the subtype</p>



<a name="262213981"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/262213981" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#262213981">(Nov 21 2021 at 00:55)</a>:</h4>
<p>I have to sleep now, but that seems to help, thank you!</p>



<a name="263309380"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/263309380" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#263309380">(Dec 01 2021 at 15:42)</a>:</h4>
<p>Is someone working on the last sorrys in <code>number_theory/cyclotomic/basic</code>? If not I will try to work on them tomorrow.<br>
Once these sorrys are done I think we can PR the definition.</p>



<a name="263309554"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/263309554" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Chris Birkbeck <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#263309554">(Dec 01 2021 at 15:43)</a>:</h4>
<p>So I had said I was going to help with these, but I've had less time than I thought, so haven't been able to look at this :(</p>



<a name="263309580"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/263309580" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Chris Birkbeck <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#263309580">(Dec 01 2021 at 15:43)</a>:</h4>
<p>Sorry!</p>



<a name="263310067"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/263310067" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#263310067">(Dec 01 2021 at 15:46)</a>:</h4>
<p>No problem!</p>



<a name="263310484"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/263310484" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#263310484">(Dec 01 2021 at 15:49)</a>:</h4>
<p>Yes, I was going to work on them,but I got distracted by the cyclotomic positive proof and degree applications... Hopefully I'll give them a look tonight!</p>



<a name="263458253"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/263458253" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#263458253">(Dec 02 2021 at 15:55)</a>:</h4>
<p>I've proved four sorrys. Now all the basic facts about <code>is_cyclotomic_extension</code> are sorry free. Any ideas on something basic missing? Otherwise would just go for a PR and see what people think about this.</p>



<a name="263488318"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/263488318" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Chris Birkbeck <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#263488318">(Dec 02 2021 at 19:24)</a>:</h4>
<p>Go for it :)  I guess we'll find out later on what other things we need (if any).</p>



<a name="264248750"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/264248750" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#264248750">(Dec 09 2021 at 02:22)</a>:</h4>
<p>I just uploaded a proof that <code>cyclotomic_field n K</code> is a cyclotomic extension (which is pretty much previous work refactored a bit). this approach currently doesn't scale to <code>cyclotomic_ring</code>, and I don't see an obvious workaround; I'm not too versed in <code>no_smul_divisors</code> and such like, but what we need is that the <code>algebra_map K (cyclotomic_ring n K)</code> is injective (which morally it is as it's morally the inclusion map), but I don't see an obvious way to prove that from what we have about algebras and such, e.g. by sidetracking through the fraction ring. If I don't come up with a better solution by tomorrow, I'm just going to sprinkle some <code>char_zero</code> and work on actual FLT instead of side-tracking myself about char-p cyclotomic extensions of domains...</p>



<a name="264276689"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/264276689" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#264276689">(Dec 09 2021 at 09:43)</a>:</h4>
<p>Great work! I am still quite busy this week, but I will try to have a look. I am not completely sure we will need that <code>cyclotomic_ring</code> is a cyclotomic extension, maybe knowing that its field of fraction is <code>cyclotomic_field</code> will be enough.</p>



<a name="264651723"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/264651723" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#264651723">(Dec 13 2021 at 00:11)</a>:</h4>
<p>I've just bumped again, if anyone has time please check I've not moved things wrongly.</p>



<a name="264652271"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/264652271" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#264652271">(Dec 13 2021 at 00:25)</a>:</h4>
<p>I also tried to bump today, and made basically the same changes as you so mostly LGTM.<br>
However one difference is I came to the conclusion that we should just assume</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">instance</span> <span class="n">is_cyclotomic_extension</span> <span class="o">[</span><span class="n">char_zero</span> <span class="n">K</span><span class="o">]</span> <span class="o">:</span>
</code></pre></div>
<p>as IMO it is way too unwieldy to keep this fact about nested coes floating around, what do you think? For this project I don't think we will need this theory for positive characteristic (though it might be handy), but if we do need it I think we should worry about the extension to that case then rather than having this extra TC now.</p>



<a name="264652280"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/264652280" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#264652280">(Dec 13 2021 at 00:25)</a>:</h4>
<p>I think the instance is still true if the characteristic divides n right? its just the proof is very annoying</p>



<a name="264652723"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/264652723" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#264652723">(Dec 13 2021 at 00:37)</a>:</h4>
<p>I don't know the proof if the fact isn't true; it's definitely a completely different route to get there, though (I thought I found some counterexamples in Sage a couple days ago, but it was just a off-by-one error instead of anything real). But yea, I definitely think we should have that instance and forget about non-char zero. I added a <code>fact</code> that implies it, but maybe it's better to make my current instance a <code>def</code> and make a <code>char_zero</code> instance for now</p>



<a name="264672675"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/264672675" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#264672675">(Dec 13 2021 at 07:54)</a>:</h4>
<p>Which result are you talking about?</p>



<a name="264672687"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/264672687" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#264672687">(Dec 13 2021 at 07:55)</a>:</h4>
<p>In any case I am pretty sure that for this project <code>char_zero</code> is enough.</p>



<a name="264685083"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/264685083" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#264685083">(Dec 13 2021 at 10:13)</a>:</h4>
<p>Whether <code>cyclotomic_field</code> is actually a cyclotomic extension in the case where <code>is_root_cyclotomic_iff</code> doesn't apply</p>



<a name="264691004"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/264691004" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#264691004">(Dec 13 2021 at 11:07)</a>:</h4>
<p>I think this is true because if <code>F</code> is a field of characteristic <code>p</code> and <code>n = m * p ^ s</code>, with <code>p</code> that does not divide <code>m</code>, then <code>cyclotomic n F = (cyclotomic m F) ^(p^s - p^(s-1))</code>, but we don't have this result yet</p>



<a name="265174341"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/265174341" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#265174341">(Dec 16 2021 at 15:43)</a>:</h4>
<p>Sorry for my long absence, I was super busy lately. I am preparing a PR with a definition of cyclotomic field, so this will be fixed once and for all.</p>



<a name="265205460"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/265205460" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#265205460">(Dec 16 2021 at 19:19)</a>:</h4>
<p><a href="https://github.com/leanprover-community/mathlib/pull/10849">#10849</a></p>



<a name="265649954"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/265649954" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#265649954">(Dec 21 2021 at 05:48)</a>:</h4>
<p>sorry for always posting here when I make minimal progress; we're close to finishing off the proof of <code>cyclotomic_ring</code> being a cyclotomic extension; I'm once again stuck on proving things are non-zero... if people want to take a look, that's there, else  hopefully I'll wake up with inspiration into how to turn <code>algebra_map K (cyclotomic_ring n K)</code> being injective into <code>subalgebra.inclusion \bot (cyclotomic_ring n K)</code> being injective (which is already in the library). Considering I always seem to work on the boring stuff lately, is there any other part of the proof people would like me to help out with instead? I'm happy to help anywhere^^</p>



<a name="265660238"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/265660238" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#265660238">(Dec 21 2021 at 08:43)</a>:</h4>
<p>Having a look now</p>



<a name="265666772"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/265666772" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#265666772">(Dec 21 2021 at 09:56)</a>:</h4>
<p>This is indeed quite annoying, but I will do it.</p>



<a name="265666943"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/265666943" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#265666943">(Dec 21 2021 at 09:58)</a>:</h4>
<p>If you are looking for something slightly more interesting, there is <code>zeta'.embeddings_equiv_primitive_roots</code> in <code>src/number_theory/cyclotomic/cyclotomic_units.lean</code>.</p>



<a name="265666964"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/265666964" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#265666964">(Dec 21 2021 at 09:58)</a>:</h4>
<p>This is false in general, but true over <code>ℚ</code>, that is enough for us</p>



<a name="265666978"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/265666978" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#265666978">(Dec 21 2021 at 09:58)</a>:</h4>
<p>It probable makes sense to think a little bit to a more general version</p>



<a name="265681489"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/265681489" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#265681489">(Dec 21 2021 at 12:52)</a>:</h4>
<p>Injectivity of <code>algebra_map A (cyclotomic_ring n A K)</code> is done.</p>



<a name="265685407"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/265685407" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#265685407">(Dec 21 2021 at 13:37)</a>:</h4>
<p>Now the only <code>sorry</code> left in <code>src/ready_for_mathlib/cyclotomic/basic.lean</code> is</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">is_fraction_ring</span> <span class="o">(</span><span class="n">cyclotomic_ring</span> <span class="n">n</span> <span class="n">A</span> <span class="n">K</span><span class="o">)</span> <span class="o">(</span><span class="n">cyclotomic_field</span> <span class="n">n</span> <span class="n">K</span><span class="o">)</span>
</code></pre></div>
<p>I am not sure we need this now, so I made it a lemma, just to bu sure it's not used automatically somewhere</p>



<a name="265685719"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/265685719" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#265685719">(Dec 21 2021 at 13:40)</a>:</h4>
<p>Ops, we already use it... so let me prove the instance</p>



<a name="265696455"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/265696455" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#265696455">(Dec 21 2021 at 15:20)</a>:</h4>
<p><span class="user-mention" data-user-id="284160">@Eric Rodriguez</span>  I see we are working on the same proof... no problem of course.<br>
Have you any idea for <code>surj</code>?</p>



<a name="265696521"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/265696521" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#265696521">(Dec 21 2021 at 15:21)</a>:</h4>
<p>It seems the only nontrivial statement for <code>is_fraction_ring</code>...</p>



<a name="265696689"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/265696689" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#265696689">(Dec 21 2021 at 15:21)</a>:</h4>
<p>Ops, you finished <code>eq_iff_exists</code>, and your proof is better than mine :)</p>



<a name="265697187"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/265697187" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#265697187">(Dec 21 2021 at 15:24)</a>:</h4>
<p>I'm currently thinking of getting the power basis for <code>cyclotomic_field</code>; hopefully that then just lets us use the existing fraction_ring instance to do everything else</p>



<a name="265697206"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/265697206" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#265697206">(Dec 21 2021 at 15:25)</a>:</h4>
<p>I think it's in <code>ring_theory.adjoin.basis</code> or something</p>



<a name="265698564"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/265698564" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#265698564">(Dec 21 2021 at 15:36)</a>:</h4>
<p>Using that <code>cyclotomic_field n K</code> is <code>adjoin K ...</code> I think we can do it with <code>algebra.adjoin_induction</code> without too much trouble</p>



<a name="265698613"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/265698613" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#265698613">(Dec 21 2021 at 15:37)</a>:</h4>
<p>Currently we know this if <code>(((n : ℕ) : A) ≠ 0</code>, but sooner or later we will remove this</p>



<a name="265699614"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/265699614" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#265699614">(Dec 21 2021 at 15:45)</a>:</h4>
<p>The proof of the cyclotomic power thing doesn't seem too bad, just mildly irritating, too. I think Alex's homogenization+factorization stuff will come in handy there</p>



<a name="265699773"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/265699773" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#265699773">(Dec 21 2021 at 15:46)</a>:</h4>
<p>What's the cyclotomic power thing?</p>



<a name="265700354"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/265700354" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#265700354">(Dec 21 2021 at 15:51)</a>:</h4>
<p>ɸ_{np^k}(x) = ɸₙ(x^p^k)/ɸₙ(x^p^(k-1)) modulo off by one errors</p>



<a name="265700375"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/265700375" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#265700375">(Dec 21 2021 at 15:51)</a>:</h4>
<p>Nonsense</p>



<a name="265700719"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/265700719" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#265700719">(Dec 21 2021 at 15:54)</a>:</h4>
<p>My math proof consists of going to <code>C</code>, where everything splits, and comparing the roots (with multiplicity)</p>



<a name="265701023"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/265701023" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#265701023">(Dec 21 2021 at 15:56)</a>:</h4>
<p>That does seem annoying, well I hope it helps but it still seems tricky yes</p>



<a name="265701683"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/265701683" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#265701683">(Dec 21 2021 at 16:01)</a>:</h4>
<p>In any case we don't need it</p>



<a name="265701924"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/265701924" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#265701924">(Dec 21 2021 at 16:03)</a>:</h4>
<p>I thought it was helpful to get rid of some of the char_zero assumptions (or <code>p \ne 0 </code> in <code>K</code>)?</p>



<a name="265702703"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/265702703" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#265702703">(Dec 21 2021 at 16:08)</a>:</h4>
<p>I don't see where we need it, but of course it would be nice to do everything in full generality.</p>
<p>Having this assumption seems to me a good compromise since I will be very easy to remove it when someone will prove the full result</p>



<a name="265713577"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/265713577" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#265713577">(Dec 21 2021 at 17:40)</a>:</h4>
<p><code>src/ready_for_mathlib/cyclotomic/basic.lean</code> is finally <code>sorry</code> free.</p>



<a name="265713816"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/265713816" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#265713816">(Dec 21 2021 at 17:42)</a>:</h4>
<p>The proof of</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">is_fraction_ring</span> <span class="o">(</span><span class="n">cyclotomic_ring</span> <span class="n">n</span> <span class="n">A</span> <span class="n">K</span><span class="o">)</span> <span class="o">(</span><span class="n">cyclotomic_field</span> <span class="n">n</span> <span class="n">K</span><span class="o">)</span>
</code></pre></div>
<p>is not that nice, but at least it works</p>



<a name="266957001"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/266957001" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#266957001">(Jan 05 2022 at 16:32)</a>:</h4>
<p>I've PRed more basic properties of cyclotomic extensions in <a href="https://github.com/leanprover-community/mathlib/pull/11264">#11264</a>.</p>



<a name="270133411"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Cyclotomic%20field%20defn/near/270133411" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Cyclotomic.20field.20defn.html#270133411">(Feb 01 2022 at 00:56)</a>:</h4>
<p>by the way, the <code>algebra_rat</code> diamond came up again when doing the galois proof. was fairly easy to get round when I realised it happened. I'm now going to re-fix <code>ne_zero</code> and then get some sleep</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>