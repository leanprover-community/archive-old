---
layout: archive
title: Zulip Chat Archive
permalink: /stream/304774-FLT-regular/topic/Deploy.20error.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/index.html">FLT regular</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Deploy.20error.html">Deploy error</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="278894906"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Deploy%20error/near/278894906" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Deploy.20error.html#278894906">(Apr 13 2022 at 21:42)</a>:</h4>
<p>Does anyone understand the error CI is reporting? It is in the "deploy" step.</p>



<a name="278895260"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Deploy%20error/near/278895260" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Chris Birkbeck <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Deploy.20error.html#278895260">(Apr 13 2022 at 21:46)</a>:</h4>
<p>hmm it seems to have messed up the blueprint</p>



<a name="278896001"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Deploy%20error/near/278896001" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Deploy.20error.html#278896001">(Apr 13 2022 at 21:53)</a>:</h4>
<p>Can be related to <a href="#narrow/stream/304774-FLT-regular/topic/blueprint/near/271765391">this</a>?</p>



<a name="278896160"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Deploy%20error/near/278896160" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Chris Birkbeck <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Deploy.20error.html#278896160">(Apr 13 2022 at 21:55)</a>:</h4>
<p>It could be, I would have thought it would have broken sooner. I did check it a few weeks ago and it was working.</p>



<a name="278896510"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Deploy%20error/near/278896510" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Chris Birkbeck <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Deploy.20error.html#278896510">(Apr 13 2022 at 21:58)</a>:</h4>
<p>(at least I think it was a few weeks ago, I may have lost all notion of time)</p>



<a name="278896902"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Deploy%20error/near/278896902" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mauricio Collares <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Deploy.20error.html#278896902">(Apr 13 2022 at 22:01)</a>:</h4>
<p>It's probably due to <a href="https://github.blog/2022-04-12-git-security-vulnerability-announced/">https://github.blog/2022-04-12-git-security-vulnerability-announced/</a> (<code>git</code> was updated in Alpine since the last commit: <a href="https://pkgs.alpinelinux.org/package/edge/main/x86/git">https://pkgs.alpinelinux.org/package/edge/main/x86/git</a>)</p>



<a name="278897161"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Deploy%20error/near/278897161" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mauricio Collares <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Deploy.20error.html#278897161">(Apr 13 2022 at 22:03)</a>:</h4>
<p>The error means git thinks it's not running on a repository, and Git 2.35.2 changed how far Git looks for a <code>.git</code> folder to determine it's in a repository in some cases.</p>



<a name="278899095"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Deploy%20error/near/278899095" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Chris Birkbeck <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Deploy.20error.html#278899095">(Apr 13 2022 at 22:23)</a>:</h4>
<p>Aha I see. Any idea on how to fix this?  I looked online and people mentioned things like adding  directories to a "<a href="http://safe.directory">safe.directory</a>" but I'm not sure how to do this, or if this would even work</p>



<a name="278899441"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Deploy%20error/near/278899441" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mauricio Collares <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Deploy.20error.html#278899441">(Apr 13 2022 at 22:26)</a>:</h4>
<p>I submitted a PR to flt-regular with this suggestion, but it is completely untested</p>



<a name="278899632"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Deploy%20error/near/278899632" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Chris Birkbeck <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Deploy.20error.html#278899632">(Apr 13 2022 at 22:29)</a>:</h4>
<p>sure lets try it! the blueprint cant get any more broken <span aria-label="joy" class="emoji emoji-1f602" role="img" title="joy">:joy:</span></p>



<a name="278899984"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Deploy%20error/near/278899984" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Deploy.20error.html#278899984">(Apr 13 2022 at 22:33)</a>:</h4>
<p>This has nothing to do with the dependency graph stuff I mentioned in February</p>



<a name="278900003"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Deploy%20error/near/278900003" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Deploy.20error.html#278900003">(Apr 13 2022 at 22:33)</a>:</h4>
<p>The error comes from <a href="https://github.com/gitpython-developers/GitPython">https://github.com/gitpython-developers/GitPython</a></p>



<a name="278900078"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Deploy%20error/near/278900078" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Deploy.20error.html#278900078">(Apr 13 2022 at 22:34)</a>:</h4>
<p>It could be that newer versions of git are no longer compatible with that python library and that the security issue forced GitHub to update git</p>



<a name="278900099"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Deploy%20error/near/278900099" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mauricio Collares <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Deploy.20error.html#278900099">(Apr 13 2022 at 22:34)</a>:</h4>
<p><span class="user-mention silent" data-user-id="389019">Chris Birkbeck</span> <a href="#narrow/stream/304774-FLT-regular/topic/Deploy.20error/near/278899632">said</a>:</p>
<blockquote>
<p>sure lets try it! the blueprint cant get any more broken <span aria-label="joy" class="emoji emoji-1f602" role="img" title="joy">:joy:</span></p>
</blockquote>
<p>Another alternative would be to not use <code>apk</code> to install <code>git</code>, and just rely on the provided Git binary. Lots of projects are hitting similar issues, and they will probably be addressed soon, so being on the bleeding edge is not advisable.</p>



<a name="278900896"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Deploy%20error/near/278900896" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mauricio Collares <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Deploy.20error.html#278900896">(Apr 13 2022 at 22:44)</a>:</h4>
<p>Yeah, that didn't work :/</p>



<a name="278900929"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Deploy%20error/near/278900929" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Chris Birkbeck <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Deploy.20error.html#278900929">(Apr 13 2022 at 22:44)</a>:</h4>
<p>yeah :( at least its now tested</p>



<a name="278901012"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Deploy%20error/near/278901012" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mauricio Collares <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Deploy.20error.html#278901012">(Apr 13 2022 at 22:45)</a>:</h4>
<p>But I saw those messages in the log:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">WARNING</span><span class="o">:</span> <span class="n">Running</span> <span class="n">pip</span> <span class="n">as</span> <span class="n">the</span> <span class="bp">'</span><span class="n">root'</span> <span class="n">user</span> <span class="n">can</span> <span class="n">result</span> <span class="k">in</span> <span class="n">broken</span> <span class="n">permissions</span> <span class="n">and</span> <span class="n">conflicting</span> <span class="n">behaviour</span> <span class="k">with</span> <span class="n">the</span> <span class="n">system</span> <span class="n">package</span> <span class="n">manager.</span> <span class="n">It</span> <span class="n">is</span> <span class="n">recommended</span> <span class="n">to</span> <span class="n">use</span> <span class="n">a</span> <span class="n">virtual</span> <span class="n">environment</span> <span class="n">instead</span><span class="o">:</span> <span class="n">https</span><span class="o">:</span><span class="bp">//</span><span class="n">pip.pypa.io</span><span class="bp">/</span><span class="n">warnings</span><span class="bp">/</span><span class="n">venv</span>
<span class="n">WARNING</span><span class="o">:</span> <span class="n">The</span> <span class="n">directory</span> <span class="bp">'/</span><span class="n">github</span><span class="bp">/</span><span class="n">home</span><span class="bp">/.</span><span class="n">cache</span><span class="bp">/</span><span class="n">pip'</span> <span class="n">or</span> <span class="n">its</span> <span class="n">parent</span> <span class="n">directory</span> <span class="n">is</span> <span class="n">not</span> <span class="n">owned</span> <span class="n">or</span> <span class="n">is</span> <span class="n">not</span> <span class="n">writable</span> <span class="kd">by</span> <span class="n">the</span> <span class="n">current</span> <span class="n">user.</span> <span class="n">The</span> <span class="n">cache</span> <span class="n">has</span> <span class="n">been</span> <span class="n">disabled.</span> <span class="n">Check</span> <span class="n">the</span> <span class="n">permissions</span> <span class="n">and</span> <span class="n">owner</span> <span class="n">of</span> <span class="n">that</span> <span class="n">directory.</span> <span class="n">If</span> <span class="n">executing</span> <span class="n">pip</span> <span class="k">with</span> <span class="n">sudo</span><span class="o">,</span> <span class="n">you</span> <span class="n">should</span> <span class="n">use</span> <span class="n">sudo's</span> <span class="bp">-</span><span class="n">H</span> <span class="n">flag.</span>
</code></pre></div>
<p>This seems to suggest the deploy commands are being run as root, while the checkout isn't (which would cause the issue).</p>



<a name="278901311"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Deploy%20error/near/278901311" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mauricio Collares <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Deploy.20error.html#278901311">(Apr 13 2022 at 22:49)</a>:</h4>
<p>Git configs are per-user, right? So (besides the possibly-wrong directory name), I think I should have added that command to the "Install Leanblueprint and generate web in tex env" step itself, since that's probably the only thing that runs inside the TeXLive docker environment.</p>



<a name="278901367"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Deploy%20error/near/278901367" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mauricio Collares <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Deploy.20error.html#278901367">(Apr 13 2022 at 22:49)</a>:</h4>
<p>And since things are being run inside the container, we really have to install git ourselves via apk, so my alternative solution makes no sense.</p>



<a name="278901716"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Deploy%20error/near/278901716" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Chris Birkbeck <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Deploy.20error.html#278901716">(Apr 13 2022 at 22:53)</a>:</h4>
<p>aha ok, where in that step would it go? or perhaps you can just try PRing the fix again?</p>



<a name="278901830"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Deploy%20error/near/278901830" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mauricio Collares <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Deploy.20error.html#278901830">(Apr 13 2022 at 22:55)</a>:</h4>
<p>Submitted! I hope the backticks do the expected thing, as I didn't know if Git would do the right thing if I asked it to add <code>.</code> to <code>safe.directory</code></p>



<a name="278901910"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Deploy%20error/near/278901910" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Chris Birkbeck <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Deploy.20error.html#278901910">(Apr 13 2022 at 22:56)</a>:</h4>
<p><span aria-label="fingers crossed" class="emoji emoji-1f91e" role="img" title="fingers crossed">:fingers_crossed:</span></p>



<a name="278902315"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Deploy%20error/near/278902315" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Deploy.20error.html#278902315">(Apr 13 2022 at 23:01)</a>:</h4>
<p>I'm done for today, but thanks for working on this!</p>



<a name="278903323"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Deploy%20error/near/278903323" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mauricio Collares <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Deploy.20error.html#278903323">(Apr 13 2022 at 23:13)</a>:</h4>
<p>Okay, this time it worked! I don't know which of the two commands did the trick though :)</p>



<a name="278903891"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Deploy%20error/near/278903891" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Chris Birkbeck <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Deploy.20error.html#278903891">(Apr 13 2022 at 23:20)</a>:</h4>
<p>great! unfortunately the blueprint is still messed up. I'll have to get back to this tomorrow or Friday :(</p>



<a name="278904656"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Deploy%20error/near/278904656" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mauricio Collares <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Deploy.20error.html#278904656">(Apr 13 2022 at 23:31)</a>:</h4>
<p>The blueprint broke on March 26th. <a href="https://github.com/leanprover-community/flt-regular/commit/b2a67c94be89ab8b2f351661419e8246c083f90c">https://github.com/leanprover-community/flt-regular/commit/b2a67c94be89ab8b2f351661419e8246c083f90c</a>. Same thing happened to liquid, but I believe <span class="user-mention" data-user-id="112680">@Johan Commelin</span> just disabled CI and generated files manually.</p>



<a name="278906339"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Deploy%20error/near/278906339" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mauricio Collares <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Deploy.20error.html#278906339">(Apr 13 2022 at 23:56)</a>:</h4>
<p>Looks like plastex uses <a href="https://github.com/plastex/plastex/blob/master/plasTeX/Renderers/PageTemplate/__init__.py#L21">jinja2.contextfunction</a>, which was <a href="https://github.com/pallets/jinja/pull/1389">deprecated</a> a year ago and <a href="https://jinja.palletsprojects.com/en/3.1.x/changes/#version-3-1-0">removed</a> in Jinja 3.1.0 (released March 23rd). There are some examples of the new API at <a href="https://jinja.palletsprojects.com/en/3.1.x/api/#evaluation-context">https://jinja.palletsprojects.com/en/3.1.x/api/#evaluation-context</a></p>



<a name="278921713"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Deploy%20error/near/278921713" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Deploy.20error.html#278921713">(Apr 14 2022 at 04:21)</a>:</h4>
<p>cc <span class="user-mention" data-user-id="110031">@Patrick Massot</span></p>



<a name="278932174"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Deploy%20error/near/278932174" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Deploy.20error.html#278932174">(Apr 14 2022 at 07:36)</a>:</h4>
<p>I have zero time today but I tried a blind fix. If it works then great but otherwise this will have to wait a bit</p>



<a name="279060753"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Deploy%20error/near/279060753" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Chris Birkbeck <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Deploy.20error.html#279060753">(Apr 15 2022 at 08:37)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110031">Patrick Massot</span> <a href="#narrow/stream/304774-FLT-regular/topic/Deploy.20error/near/278932174">said</a>:</p>
<blockquote>
<p>I have zero time today but I tried a blind fix. If it works then great but otherwise this will have to wait a bit</p>
</blockquote>
<p>Well the blueprint is working again, so it seems to have worked! Thank you!</p>



<a name="279061127"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/304774-FLT%20regular/topic/Deploy%20error/near/279061127" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/304774-FLT-regular/topic/Deploy.20error.html#279061127">(Apr 15 2022 at 08:42)</a>:</h4>
<p>Thanks!!</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>