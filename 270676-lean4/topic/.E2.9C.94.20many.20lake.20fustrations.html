---
layout: archive
title: Zulip Chat Archive
permalink: /stream/270676-lean4/topic/.E2.9C.94.20many.20lake.20fustrations.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/index.html">lean4</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.E2.9C.94.20many.20lake.20fustrations.html">âœ” many lake fustrations</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="274924511"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%E2%9C%94%20many%20lake%20fustrations/near/274924511" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joseph O <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.E2.9C.94.20many.20lake.20fustrations.html#274924511">(Mar 11 2022 at 02:29)</a>:</h4>
<p>everytime i try to use a git URL with lake, i get some sort of error <br>
<a href="/user_uploads/3121/Xhn1siiqgYR_60b9nVj5M0Ek/image.png">image.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/3121/Xhn1siiqgYR_60b9nVj5M0Ek/image.png" title="image.png"><img src="/user_uploads/3121/Xhn1siiqgYR_60b9nVj5M0Ek/image.png"></a></div>



<a name="274924563"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%E2%9C%94%20many%20lake%20fustrations/near/274924563" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joseph O <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.E2.9C.94.20many.20lake.20fustrations.html#274924563">(Mar 11 2022 at 02:30)</a>:</h4>
<p>This is just one of them (the only one in my current project)</p>



<a name="274924573"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%E2%9C%94%20many%20lake%20fustrations/near/274924573" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joseph O <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.E2.9C.94.20many.20lake.20fustrations.html#274924573">(Mar 11 2022 at 02:30)</a>:</h4>
<p>I was sucessfully able to use one of my own libs in another project</p>



<a name="274924611"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%E2%9C%94%20many%20lake%20fustrations/near/274924611" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.E2.9C.94.20many.20lake.20fustrations.html#274924611">(Mar 11 2022 at 02:31)</a>:</h4>
<p>what git url? It is complaining about your lakefile, what is in it</p>



<a name="274925710"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%E2%9C%94%20many%20lake%20fustrations/near/274925710" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joseph O <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.E2.9C.94.20many.20lake.20fustrations.html#274925710">(Mar 11 2022 at 02:50)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">Lake</span>
<span class="kn">open</span> <span class="n">Lake</span> <span class="n">DSL</span>

<span class="n">package</span> <span class="n">Tuple</span> <span class="o">{</span>
  <span class="n">dependencies</span> <span class="o">:=</span> <span class="bp">#</span><span class="o">[</span>
    <span class="o">{</span> <span class="n">name</span> <span class="o">:=</span> <span class="bp">`</span><span class="n">mathlib4</span><span class="o">,</span>
      <span class="n">src</span> <span class="o">:=</span> <span class="n">Source.git</span> <span class="s2">"https://github.com/leanprover-community/mathlib4.git"</span> <span class="s2">"master"</span><span class="o">}</span>
  <span class="o">]</span>
<span class="o">}</span>
</code></pre></div>



<a name="274925733"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%E2%9C%94%20many%20lake%20fustrations/near/274925733" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joseph O <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.E2.9C.94.20many.20lake.20fustrations.html#274925733">(Mar 11 2022 at 02:51)</a>:</h4>
<p>a better error:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">PS</span> <span class="n">C</span><span class="o">:</span><span class="bp">\</span><span class="n">Users</span><span class="bp">\</span><span class="n">vatis</span><span class="bp">\</span><span class="n">Desktop</span><span class="bp">\</span><span class="n">programming</span><span class="bp">\</span><span class="n">Tuple</span><span class="bp">&gt;</span> <span class="n">lake</span> <span class="n">build</span>
<span class="n">info</span><span class="o">:</span> <span class="n">mathlib4</span><span class="o">:</span> <span class="n">trying</span> <span class="n">to</span> <span class="n">update</span> <span class="bp">.\</span><span class="n">lean_packages</span><span class="bp">\</span><span class="n">mathlib4</span> <span class="n">to</span> <span class="n">revision</span> <span class="n">master</span>
<span class="n">error</span><span class="o">:</span> <span class="n">Tuple</span> <span class="o">(</span><span class="k">in</span> <span class="bp">.</span><span class="o">)</span> <span class="n">depends</span> <span class="n">on</span> <span class="n">mathlib4</span><span class="o">,</span> <span class="n">but</span> <span class="n">resolved</span> <span class="n">dependency</span> <span class="n">has</span> <span class="n">name</span> <span class="n">mathlib</span> <span class="o">(</span><span class="k">in</span> <span class="bp">.\</span><span class="n">lean_packages</span><span class="bp">\</span><span class="n">mathlib4</span><span class="bp">\.</span><span class="o">)</span>
<span class="n">PS</span> <span class="n">C</span><span class="o">:</span><span class="bp">\</span><span class="n">Users</span><span class="bp">\</span><span class="n">vatis</span><span class="bp">\</span><span class="n">Desktop</span><span class="bp">\</span><span class="n">programming</span><span class="bp">\</span><span class="n">Tuple</span><span class="bp">&gt;</span>
</code></pre></div>



<a name="274925979"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%E2%9C%94%20many%20lake%20fustrations/near/274925979" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.E2.9C.94.20many.20lake.20fustrations.html#274925979">(Mar 11 2022 at 02:55)</a>:</h4>
<p>The package name should be just <code>mathlib</code>. [<a href="#narrow/stream/270676-lean4/topic/doc-gen4.20package.20name.20.26.20lakefile.20parsing/near/274771537">Related</a>]</p>
<p>Why ask the user to fill in a package name if, in the end, it can figure out what it should be?</p>



<a name="274926332"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%E2%9C%94%20many%20lake%20fustrations/near/274926332" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joseph O <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.E2.9C.94.20many.20lake.20fustrations.html#274926332">(Mar 11 2022 at 03:01)</a>:</h4>
<p>ah thanks its working now</p>



<a name="274926432"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%E2%9C%94%20many%20lake%20fustrations/near/274926432" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Notification Bot <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.E2.9C.94.20many.20lake.20fustrations.html#274926432">(Mar 11 2022 at 03:02)</a>:</h4>
<p><span class="user-mention silent" data-user-id="467926">Joseph O</span> has marked this topic as resolved.</p>



<a name="274932526"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%E2%9C%94%20many%20lake%20fustrations/near/274932526" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Xubai Wang <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.E2.9C.94.20many.20lake.20fustrations.html#274932526">(Mar 11 2022 at 05:09)</a>:</h4>
<p><span class="user-mention silent" data-user-id="451983">Arthur Paulino</span> <a href="#narrow/stream/270676-lean4/topic/.E2.9C.94.20many.20lake.20fustrations/near/274925979">said</a>:</p>
<blockquote>
<p>Why ask the user to fill in a package name if, in the end, it can figure out what it should be?</p>
</blockquote>
<p>It seems that <code>name</code> will be used as vanity name in the future, and people can rename the package to avoid name clash of modules.</p>



<a name="285760804"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%E2%9C%94%20many%20lake%20fustrations/near/285760804" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.E2.9C.94.20many.20lake.20fustrations.html#285760804">(Jun 11 2022 at 05:34)</a>:</h4>
<p><span class="user-mention silent" data-user-id="451983">Arthur Paulino</span> <a href="#narrow/stream/270676-lean4/topic/.E2.9C.94.20many.20lake.20fustrations/near/274925979">said</a>:</p>
<blockquote>
<p>Why ask the user to fill in a package name if, in the end, it can figure out what it should be?</p>
</blockquote>
<p>Was scrolling through old lake-related thread and stumbled upon this and it felt was worth mentioning the current reason for needing this.  Lake can only figure out the name of a package itself <em>after</em> it has cloned it into some directory. However, it needs a unique name for the package <em>before</em> cloning to give to the directory it will be cloning the package into. The name a user provides is the name Lake uses. The sanity check afterwards helps keep things consistent and prevent weird breaks (i.e., the user naming every dependency foo and getting weird errors when Lake tries to clone every dependency into a foo directory).</p>
<p>If there was some way to get a name for a repository / package before cloning it, I could make the name optional, but I simply don't know of a way to do so.  Note that parsing the URL is insufficient because Lake still needs to be able to handle cases where the URL is nonstandard. For instance, Lake's own <a href="https://github.com/leanprover/lake/blob/master/examples/git/lakefile.lean">Git example</a> that clones the local repository to test. It is not really possible to derive any intelligent name from <code>../..</code>! <span aria-label="rofl" class="emoji emoji-1f923" role="img" title="rofl">:rofl:</span>  However, I suppose I could try some simply heuristic to derive a name from the URL and fall back to demanding a name if some goes wrong (though I am not sure how I would easily determine if something went wrong).</p>
<p>What do all of you think? Any ideas?</p>



<a name="285762881"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%E2%9C%94%20many%20lake%20fustrations/near/285762881" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Tomas Skrivan <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.E2.9C.94.20many.20lake.20fustrations.html#285762881">(Jun 11 2022 at 06:19)</a>:</h4>
<p>Having the name optional only if the GitHub link is provided should cover most cases, no?</p>
<p>But can't you always just copy dependency's lakefile to a temporary directory and extract the name?</p>



<a name="285766110"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%E2%9C%94%20many%20lake%20fustrations/near/285766110" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.E2.9C.94.20many.20lake.20fustrations.html#285766110">(Jun 11 2022 at 07:47)</a>:</h4>
<p>I'm pretty sure <code>git clone</code> itself just takes the last URL component and strips off any <code>.git</code> if you don't specify a directory to clone into, or at least something close to that</p>



<a name="285767051"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%E2%9C%94%20many%20lake%20fustrations/near/285767051" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Evgeniy Kuznetsov <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.E2.9C.94.20many.20lake.20fustrations.html#285767051">(Jun 11 2022 at 08:14)</a>:</h4>
<p>You can use hash of the path as a unique name of directory and, if necessary,  append a human readable suffix after package name resolution:<br>
<code>&lt;hash of path&gt;_&lt;package name&gt;</code></p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>