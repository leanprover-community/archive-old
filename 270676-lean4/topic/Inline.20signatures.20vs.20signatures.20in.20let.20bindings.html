---
layout: archive
title: Zulip Chat Archive
permalink: /stream/270676-lean4/topic/Inline.20signatures.20vs.20signatures.20in.20let.20bindings.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/index.html">lean4</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Inline.20signatures.20vs.20signatures.20in.20let.20bindings.html">Inline signatures vs signatures in let bindings</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="288813332"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Inline%20signatures%20vs%20signatures%20in%20let%20bindings/near/288813332" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> cognivore <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Inline.20signatures.20vs.20signatures.20in.20let.20bindings.html#288813332">(Jul 07 2022 at 14:27)</a>:</h4>
<p><span class="user-mention" data-user-id="451983">@Arthur Paulino</span> has encouraged me to report this: <a href="https://github.com/cognivore/FuncDep.lean/commit/55c9a46fd9fb94874861e3fe8ef7c7c9080f765e#r77932527">https://github.com/cognivore/FuncDep.lean/commit/55c9a46fd9fb94874861e3fe8ef7c7c9080f765e#r77932527</a></p>



<a name="288813477"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Inline%20signatures%20vs%20signatures%20in%20let%20bindings/near/288813477" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> cognivore <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Inline.20signatures.20vs.20signatures.20in.20let.20bindings.html#288813477">(Jul 07 2022 at 14:28)</a>:</h4>
<p>It should work because <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>instCountParts_String.</mtext><mi>α</mi></mrow><annotation encoding="application/x-tex"> \text{instCountParts\_String.}\alpha </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9933em;vertical-align:-0.31em;"></span><span class="mord text"><span class="mord">instCountParts_String.</span></span><span class="mord mathnormal" style="margin-right:0.0037em;">α</span></span></span></span> is <a href="https://github.com/cognivore/FuncDep.lean/blob/main/FuncDep.lean#L10"> <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="double-struck">N</mi></mrow><annotation encoding="application/x-tex"> \mathbb{N} </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6889em;"></span><span class="mord mathbb">N</span></span></span></span> </a>.</p>



<a name="288813567"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Inline%20signatures%20vs%20signatures%20in%20let%20bindings/near/288813567" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Inline.20signatures.20vs.20signatures.20in.20let.20bindings.html#288813567">(Jul 07 2022 at 14:29)</a>:</h4>
<p>Oh, what about <code>let n₂' := ((FuncDep.CountParts_.φ "Tarmogoyf" 'o') : Nat)</code>?</p>



<a name="288813597"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Inline%20signatures%20vs%20signatures%20in%20let%20bindings/near/288813597" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Inline.20signatures.20vs.20signatures.20in.20let.20bindings.html#288813597">(Jul 07 2022 at 14:29)</a>:</h4>
<p>(just to make sure we're helping Lean with the right term)</p>



<a name="288813628"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Inline%20signatures%20vs%20signatures%20in%20let%20bindings/near/288813628" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> cognivore <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Inline.20signatures.20vs.20signatures.20in.20let.20bindings.html#288813628">(Jul 07 2022 at 14:29)</a>:</h4>
<p>It won't work. Or do you assume that <code>:</code> is right-associative <em>and</em> <code>'o' : Nat</code> would typecheck?  :D</p>



<a name="288813642"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Inline%20signatures%20vs%20signatures%20in%20let%20bindings/near/288813642" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> cognivore <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Inline.20signatures.20vs.20signatures.20in.20let.20bindings.html#288813642">(Jul 07 2022 at 14:29)</a>:</h4>
<p>I'll try, one sec.</p>



<a name="288813710"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Inline%20signatures%20vs%20signatures%20in%20let%20bindings/near/288813710" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> cognivore <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Inline.20signatures.20vs.20signatures.20in.20let.20bindings.html#288813710">(Jul 07 2022 at 14:30)</a>:</h4>
<p><span class="user-mention silent" data-user-id="451983">Arthur Paulino</span> <a href="#narrow/stream/270676-lean4/topic/Inline.20signatures.20vs.20signatures.20in.20let.20bindings/near/288813567">said</a>:</p>
<blockquote>
<p>Oh, what about <code>let n₂' := ((FuncDep.CountParts_.φ "Tarmogoyf" 'o') : Nat)</code>?</p>
</blockquote>
<p>Same error.</p>



<a name="288815307"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Inline%20signatures%20vs%20signatures%20in%20let%20bindings/near/288815307" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Inline.20signatures.20vs.20signatures.20in.20let.20bindings.html#288815307">(Jul 07 2022 at 14:41)</a>:</h4>
<p>Here's a more distilled <a href="https://leanprover-community.github.io/mwe.html">#mwe</a>:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">class</span> <span class="n">CountParts_</span> <span class="o">(</span><span class="n">S</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">)</span> <span class="n">where</span>
  <span class="n">μ</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">v</span>
  <span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">w</span>
  <span class="n">φ</span> <span class="o">:</span> <span class="n">S</span> <span class="bp">→</span> <span class="n">μ</span> <span class="bp">→</span> <span class="n">α</span>

<span class="kd">instance</span> <span class="o">:</span> <span class="n">CountParts_</span> <span class="n">String</span> <span class="n">where</span>
  <span class="n">μ</span> <span class="o">:=</span> <span class="n">Char</span>
  <span class="n">α</span> <span class="o">:=</span> <span class="n">Nat</span>
  <span class="n">φ</span> <span class="n">haystack</span> <span class="n">needle</span> <span class="o">:=</span> <span class="n">haystack.foldl</span> <span class="o">(</span><span class="k">fun</span> <span class="n">acc</span> <span class="n">x</span> <span class="bp">=&gt;</span> <span class="n">acc</span> <span class="bp">+</span> <span class="k">if</span> <span class="n">x</span> <span class="bp">==</span> <span class="n">needle</span> <span class="k">then</span> <span class="mi">1</span> <span class="k">else</span> <span class="mi">0</span><span class="o">)</span> <span class="mi">0</span>

<span class="kd">class</span> <span class="n">CountParts</span> <span class="o">(</span><span class="n">S</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">)</span> <span class="o">(</span><span class="n">μ</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">v</span><span class="o">)</span> <span class="o">(</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">w</span><span class="o">)</span> <span class="n">where</span>
  <span class="n">φ</span> <span class="o">:</span> <span class="n">S</span> <span class="bp">→</span> <span class="n">μ</span> <span class="bp">→</span> <span class="n">α</span>

<span class="c">/-</span><span class="cm"> Somehow, Lean manages to see `Nat ~ CountParts_.α String` in the instance declaration! -/</span>
<span class="kd">instance</span> <span class="o">:</span> <span class="n">CountParts</span> <span class="n">String</span> <span class="n">Char</span> <span class="n">Nat</span> <span class="n">where</span>
  <span class="n">φ</span> <span class="n">haystack</span> <span class="n">needle</span> <span class="o">:=</span>
    <span class="k">let</span> <span class="n">y</span> <span class="o">:</span> <span class="n">Nat</span> <span class="o">:=</span> <span class="n">instCountParts_String.φ</span> <span class="n">haystack</span> <span class="n">needle</span>
    <span class="n">y</span> <span class="bp">+</span> <span class="mi">1</span>

<span class="kd">instance</span> <span class="o">:</span> <span class="n">CountParts</span> <span class="n">String</span> <span class="n">Char</span> <span class="n">Nat</span> <span class="n">where</span>
  <span class="n">φ</span> <span class="n">haystack</span> <span class="n">needle</span> <span class="o">:=</span> <span class="o">(</span><span class="n">instCountParts_String.φ</span> <span class="n">haystack</span> <span class="n">needle</span><span class="o">)</span> <span class="bp">+</span> <span class="mi">1</span>
<span class="c1">-- failed to synthesize instance</span>
<span class="c1">--   HAdd (CountParts_.α String) Nat ?m.4026</span>

<span class="kd">instance</span> <span class="o">:</span> <span class="n">CountParts</span> <span class="n">String</span> <span class="n">Char</span> <span class="n">Nat</span> <span class="n">where</span>
  <span class="n">φ</span> <span class="n">haystack</span> <span class="n">needle</span> <span class="o">:=</span> <span class="o">((</span><span class="n">instCountParts_String.φ</span> <span class="n">haystack</span> <span class="n">needle</span><span class="o">)</span> <span class="o">:</span> <span class="n">Nat</span><span class="o">)</span> <span class="bp">+</span> <span class="mi">1</span>
<span class="c1">-- failed to synthesize instance</span>
<span class="c1">--   HAdd (CountParts_.α String) Nat ?m.4098</span>
</code></pre></div>
<p>We were trying to understand why the first instance typechecks and the others don't<br>
We're on nightly from 2022-05-29 btw</p>



<a name="288816693"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Inline%20signatures%20vs%20signatures%20in%20let%20bindings/near/288816693" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Inline.20signatures.20vs.20signatures.20in.20let.20bindings.html#288816693">(Jul 07 2022 at 14:51)</a>:</h4>
<p>I just tested on a more recent version (<code>leanprover/lean4:nightly-2022-07-04</code>) and the same error occurs</p>



<a name="288825159"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Inline%20signatures%20vs%20signatures%20in%20let%20bindings/near/288825159" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Inline.20signatures.20vs.20signatures.20in.20let.20bindings.html#288825159">(Jul 07 2022 at 15:49)</a>:</h4>
<p>If I understand correctly, the difference is that <code>(x : T)</code> doesn't actually assign type <code>T</code> to <code>x</code> (it just hints at it) whereas <code>let y : T := x</code> actually does.</p>



<a name="288825557"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Inline%20signatures%20vs%20signatures%20in%20let%20bindings/near/288825557" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Inline.20signatures.20vs.20signatures.20in.20let.20bindings.html#288825557">(Jul 07 2022 at 15:51)</a>:</h4>
<p>Here is an old thread with a part by <span class="user-mention" data-user-id="110049">@Mario Carneiro</span>  on the topic: <a href="#narrow/stream/270676-lean4/topic/OptionM.20and.20DecEq/near/236380370">https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/OptionM.20and.20DecEq/near/236380370</a></p>



<a name="288827332"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Inline%20signatures%20vs%20signatures%20in%20let%20bindings/near/288827332" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Inline.20signatures.20vs.20signatures.20in.20let.20bindings.html#288827332">(Jul 07 2022 at 16:04)</a>:</h4>
<p>The underlying cause is that class projections are not reducible. It works with</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">attribute</span> <span class="o">[</span><span class="n">reducible</span><span class="o">]</span> <span class="n">CountParts_.α</span>
</code></pre></div>



<a name="288949113"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Inline%20signatures%20vs%20signatures%20in%20let%20bindings/near/288949113" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> cognivore <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Inline.20signatures.20vs.20signatures.20in.20let.20bindings.html#288949113">(Jul 08 2022 at 14:41)</a>:</h4>
<p>Wow, thank you, Sebastian! That's an interesting thing to learn about for me as a beginner <span aria-label="bow" class="emoji emoji-1f647" role="img" title="bow">:bow:</span></p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>