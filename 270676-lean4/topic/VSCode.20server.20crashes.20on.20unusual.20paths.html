---
layout: archive
title: Zulip Chat Archive
permalink: /stream/270676-lean4/topic/VSCode.20server.20crashes.20on.20unusual.20paths.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/index.html">lean4</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/VSCode.20server.20crashes.20on.20unusual.20paths.html">VSCode server crashes on unusual paths</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="282965477"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/VSCode%20server%20crashes%20on%20unusual%20paths/near/282965477" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Raghuram <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/VSCode.20server.20crashes.20on.20unusual.20paths.html#282965477">(May 19 2022 at 17:37)</a>:</h4>
<p>When opening files with certain paths containing <code>'</code> and/or <code>"</code> in VSCode, the Lean 4 server crashes repeatedly until VSCode stops trying to restart it.  The error messages shown in the Output pane are about <code>/bin/sh</code>, <code>-c</code> and matching quotes/unexpected EOFs</p>



<a name="282965503"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/VSCode%20server%20crashes%20on%20unusual%20paths/near/282965503" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Raghuram <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/VSCode.20server.20crashes.20on.20unusual.20paths.html#282965503">(May 19 2022 at 17:37)</a>:</h4>
<p>Does this happen for anyone using Emacs?</p>



<a name="282993420"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/VSCode%20server%20crashes%20on%20unusual%20paths/near/282993420" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Julian Berman <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/VSCode.20server.20crashes.20on.20unusual.20paths.html#282993420">(May 19 2022 at 21:17)</a>:</h4>
<p>I don't see that in neovim (it seems to work), if that helps.</p>



<a name="282993723"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/VSCode%20server%20crashes%20on%20unusual%20paths/near/282993723" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Julian Berman <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/VSCode.20server.20crashes.20on.20unusual.20paths.html#282993723">(May 19 2022 at 21:21)</a>:</h4>
<p>(and in the background I see <code>julian           11760   0.0  0.7 409823072  59408 s001  S+    5:17PM   0:00.10 /opt/homebrew/Cellar/lean@4/HEAD-d13fac6/bin/lean --worker file:///Users/julian/Development/lean-scratch4/Scratch/foobar%22baz.lean</code>)</p>



<a name="283033226"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/VSCode%20server%20crashes%20on%20unusual%20paths/near/283033226" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/VSCode.20server.20crashes.20on.20unusual.20paths.html#283033226">(May 20 2022 at 07:25)</a>:</h4>
<p><span class="user-mention" data-user-id="501683">@Raghuram</span> Could you post the messages?</p>



<a name="283036509"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/VSCode%20server%20crashes%20on%20unusual%20paths/near/283036509" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Raghuram <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/VSCode.20server.20crashes.20on.20unusual.20paths.html#283036509">(May 20 2022 at 08:05)</a>:</h4>
<p>In the Output pane:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">Lean</span> <span class="o">(</span><span class="n">version</span> <span class="mi">4</span><span class="bp">.</span><span class="mi">0</span><span class="bp">.</span><span class="mi">0</span><span class="bp">-</span><span class="n">nightly</span><span class="bp">-</span><span class="mi">2022</span><span class="bp">-</span><span class="mi">05</span><span class="bp">-</span><span class="mi">19</span><span class="o">,</span> <span class="n">commit</span> <span class="n">d13fac6f458b</span><span class="o">,</span> <span class="n">Release</span><span class="o">)</span>
<span class="bp">/</span><span class="n">bin</span><span class="bp">/</span><span class="n">sh</span><span class="o">:</span> <span class="bp">-</span><span class="n">c</span><span class="o">:</span> <span class="n">line</span> <span class="mi">1</span><span class="o">:</span> <span class="n">unexpected</span> <span class="n">EOF</span> <span class="n">while</span> <span class="n">looking</span> <span class="n">for</span> <span class="n">matching</span> <span class="bp">`''</span>
<span class="bp">/</span><span class="n">bin</span><span class="bp">/</span><span class="n">sh</span><span class="o">:</span> <span class="bp">-</span><span class="n">c</span><span class="o">:</span> <span class="n">line</span> <span class="mi">2</span><span class="o">:</span> <span class="n">syntax</span> <span class="n">error</span><span class="o">:</span> <span class="n">unexpected</span> <span class="kd">end</span> <span class="n">of</span> <span class="n">file</span>
<span class="o">[</span><span class="n">Info</span>  <span class="bp">-</span> <span class="mi">1</span><span class="o">:</span><span class="mi">31</span><span class="o">:</span><span class="mi">22</span> <span class="n">pm</span><span class="o">]</span> <span class="n">Connection</span> <span class="n">to</span> <span class="n">server</span> <span class="n">got</span> <span class="n">closed.</span> <span class="n">Server</span> <span class="n">will</span> <span class="n">restart.</span>
</code></pre></div>
<p>with the last 3 lines repeating until VSCode gives up.  This is for the path <code>~/Desktop/Folder'/File.lean</code>.</p>



<a name="283037714"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/VSCode%20server%20crashes%20on%20unusual%20paths/near/283037714" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/VSCode.20server.20crashes.20on.20unusual.20paths.html#283037714">(May 20 2022 at 08:18)</a>:</h4>
<p>Hmm, it's not clear to me where that shell script is coming from</p>



<a name="283050139"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/VSCode%20server%20crashes%20on%20unusual%20paths/near/283050139" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/VSCode.20server.20crashes.20on.20unusual.20paths.html#283050139">(May 20 2022 at 10:26)</a>:</h4>
<p>Maybe <a href="https://github.com/leanprover/vscode-lean4/blob/06aef42870aa8afaf714e69b493bab86559c7cdf/vscode-lean4/src/leanclient.ts#L167">https://github.com/leanprover/vscode-lean4/blob/06aef42870aa8afaf714e69b493bab86559c7cdf/vscode-lean4/src/leanclient.ts#L167</a>?</p>



<a name="283050606"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/VSCode%20server%20crashes%20on%20unusual%20paths/near/283050606" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/VSCode.20server.20crashes.20on.20unusual.20paths.html#283050606">(May 20 2022 at 10:32)</a>:</h4>
<p><code>shell = True</code> usually means "who knows whether this is going to be sensibly escaped"</p>



<a name="283054114"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/VSCode%20server%20crashes%20on%20unusual%20paths/near/283054114" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Raghuram <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/VSCode.20server.20crashes.20on.20unusual.20paths.html#283054114">(May 20 2022 at 11:09)</a>:</h4>
<p><span class="user-mention silent" data-user-id="310045">Eric Wieser</span> <a href="#narrow/stream/270676-lean4/topic/VSCode.20server.20crashes.20on.20unusual.20paths/near/283050139">said</a>:</p>
<blockquote>
<p>Maybe <a href="https://github.com/leanprover/vscode-lean4/blob/06aef42870aa8afaf714e69b493bab86559c7cdf/vscode-lean4/src/leanclient.ts#L167">https://github.com/leanprover/vscode-lean4/blob/06aef42870aa8afaf714e69b493bab86559c7cdf/vscode-lean4/src/leanclient.ts#L167</a>?</p>
</blockquote>
<p>There is a function <code>escapeRegexp</code> on line 33 of the same file which (I think) adds <code>\</code>s before matches for <code>/[.*+?^${}()|[\]\\]/g</code>; maybe <code>'</code> and <code>"</code> need to be added to that regexp?</p>



<a name="283054567"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/VSCode%20server%20crashes%20on%20unusual%20paths/near/283054567" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Raghuram <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/VSCode.20server.20crashes.20on.20unusual.20paths.html#283054567">(May 20 2022 at 11:14)</a>:</h4>
<p>Never mind; that's only used to construct another regexp.</p>



<a name="283054568"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/VSCode%20server%20crashes%20on%20unusual%20paths/near/283054568" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/VSCode.20server.20crashes.20on.20unusual.20paths.html#283054568">(May 20 2022 at 11:14)</a>:</h4>
<p>That's used for something different.  Namely when you move your cursor over a word, then it highlights all occurrences of the word in the file (unless the server has better information).  The regexp is used to use escape that word.</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>