---
layout: archive
title: Zulip Chat Archive
permalink: /stream/270676-lean4/topic/Annoying.20LCNF.20errors.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/index.html">lean4</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Annoying.20LCNF.20errors.html">Annoying LCNF errors</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="301269857"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Annoying%20LCNF%20errors/near/301269857" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Uranus Testing <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Annoying.20LCNF.20errors.html#301269857">(Sep 28 2022 at 16:02)</a>:</h4>
<p>After updating Lean I started getting a bunch of strange errors from the codegen (because problem disappears if I mark <code>vect.subst</code> as a theorem). Here’s MWE of such one:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">namespace</span> <span class="n">MWE</span>

<span class="kd">universe</span> <span class="n">u</span> <span class="n">v</span> <span class="n">w</span>

<span class="kd">inductive</span> <span class="n">Id</span> <span class="o">{</span><span class="n">A</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">}</span> <span class="o">:</span> <span class="n">A</span> <span class="bp">→</span> <span class="n">A</span> <span class="bp">→</span> <span class="kt">Type</span> <span class="n">u</span>
<span class="bp">|</span> <span class="n">refl</span> <span class="o">{</span><span class="n">a</span> <span class="o">:</span> <span class="n">A</span><span class="o">}</span> <span class="o">:</span> <span class="n">Id</span> <span class="n">a</span> <span class="n">a</span>

<span class="kn">attribute</span> <span class="o">[</span><span class="n">eliminator</span><span class="o">]</span> <span class="n">Id.casesOn</span>

<span class="kd">infix</span><span class="o">:</span><span class="mi">50</span> <span class="o">(</span><span class="n">priority</span> <span class="o">:=</span> <span class="n">high</span><span class="o">)</span> <span class="s2">" = "</span> <span class="bp">=&gt;</span> <span class="n">Id</span>

<span class="kd">inductive</span> <span class="n">Unit</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span>
<span class="bp">|</span> <span class="n">star</span> <span class="o">:</span> <span class="n">Unit</span>

<span class="kn">attribute</span> <span class="o">[</span><span class="n">eliminator</span><span class="o">]</span> <span class="n">Unit.casesOn</span>

<span class="kd">notation</span> <span class="s2">"𝟏"</span> <span class="bp">=&gt;</span> <span class="n">Unit</span>
<span class="kd">notation</span> <span class="s2">"★"</span> <span class="bp">=&gt;</span> <span class="n">Unit.star</span>
<span class="kd">notation</span> <span class="s2">"ℕ"</span> <span class="bp">=&gt;</span> <span class="n">Nat</span>

<span class="kd">def</span> <span class="n">vect</span> <span class="o">(</span><span class="n">A</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">)</span> <span class="o">:</span> <span class="n">ℕ</span> <span class="bp">→</span> <span class="kt">Type</span> <span class="n">u</span>
<span class="bp">|</span> <span class="n">Nat.zero</span>   <span class="bp">=&gt;</span> <span class="mi">𝟏</span>
<span class="bp">|</span> <span class="n">Nat.succ</span> <span class="n">n</span> <span class="bp">=&gt;</span> <span class="n">A</span> <span class="bp">×</span> <span class="n">vect</span> <span class="n">A</span> <span class="n">n</span>

<span class="kd">def</span> <span class="n">vect.const</span> <span class="o">{</span><span class="n">A</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">}</span> <span class="o">(</span><span class="n">a</span> <span class="o">:</span> <span class="n">A</span><span class="o">)</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">n</span><span class="o">,</span> <span class="n">vect</span> <span class="n">A</span> <span class="n">n</span>
<span class="bp">|</span> <span class="n">Nat.zero</span>   <span class="bp">=&gt;</span> <span class="bp">★</span>
<span class="bp">|</span> <span class="n">Nat.succ</span> <span class="n">n</span> <span class="bp">=&gt;</span> <span class="o">(</span><span class="n">a</span><span class="o">,</span> <span class="n">const</span> <span class="n">a</span> <span class="n">n</span><span class="o">)</span>

<span class="kd">def</span> <span class="n">vect.map</span> <span class="o">{</span><span class="n">A</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">}</span> <span class="o">{</span><span class="n">B</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">v</span><span class="o">}</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">A</span> <span class="bp">→</span> <span class="n">B</span><span class="o">)</span> <span class="o">:</span>
  <span class="bp">∀</span> <span class="o">{</span><span class="n">n</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">},</span> <span class="n">vect</span> <span class="n">A</span> <span class="n">n</span> <span class="bp">→</span> <span class="n">vect</span> <span class="n">B</span> <span class="n">n</span>
<span class="bp">|</span> <span class="n">Nat.zero</span>   <span class="bp">=&gt;</span> <span class="bp">λ</span> <span class="n">_</span> <span class="bp">=&gt;</span> <span class="bp">★</span>
<span class="bp">|</span> <span class="n">Nat.succ</span> <span class="n">n</span> <span class="bp">=&gt;</span> <span class="bp">λ</span> <span class="n">v</span> <span class="bp">=&gt;</span> <span class="o">(</span><span class="n">f</span> <span class="n">v.1</span><span class="o">,</span> <span class="n">map</span> <span class="n">f</span> <span class="n">v.2</span><span class="o">)</span>

<span class="kd">def</span> <span class="n">transport</span> <span class="o">{</span><span class="n">A</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">}</span> <span class="o">(</span><span class="n">B</span> <span class="o">:</span> <span class="n">A</span> <span class="bp">→</span> <span class="kt">Type</span> <span class="n">v</span><span class="o">)</span> <span class="o">{</span><span class="n">a</span> <span class="n">b</span> <span class="o">:</span> <span class="n">A</span><span class="o">}</span> <span class="o">(</span><span class="n">p</span> <span class="o">:</span> <span class="n">a</span> <span class="bp">=</span> <span class="n">b</span><span class="o">)</span> <span class="o">:</span> <span class="n">B</span> <span class="n">a</span> <span class="bp">→</span> <span class="n">B</span> <span class="n">b</span> <span class="o">:=</span>
<span class="kd">by</span> <span class="o">{</span> <span class="n">induction</span> <span class="n">p</span><span class="bp">;</span> <span class="n">apply</span> <span class="n">id</span> <span class="o">}</span>

<span class="c">/-</span><span class="cm"></span>
<span class="cm">type mismatch at LCNF application</span>
<span class="cm">  map f _x.12</span>
<span class="cm">argument f has type</span>
<span class="cm">  B → A</span>
<span class="cm">but is expected to have type</span>
<span class="cm">  A → A</span>
<span class="cm">-/</span>
<span class="kd">def</span> <span class="n">vect.subst</span> <span class="o">{</span><span class="n">A</span> <span class="n">B</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">}</span> <span class="o">(</span><span class="n">p</span> <span class="o">:</span> <span class="n">A</span> <span class="bp">=</span> <span class="n">B</span><span class="o">)</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">B</span> <span class="bp">→</span> <span class="n">A</span><span class="o">)</span> <span class="o">{</span><span class="n">n</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">}</span> <span class="o">(</span><span class="n">v</span> <span class="o">:</span> <span class="n">vect</span> <span class="n">A</span> <span class="n">n</span><span class="o">)</span> <span class="o">:</span>
  <span class="n">vect.map</span> <span class="n">f</span> <span class="o">(</span><span class="n">transport</span> <span class="o">(</span><span class="n">vect</span> <span class="bp">·</span> <span class="n">n</span><span class="o">)</span> <span class="n">p</span> <span class="n">v</span><span class="o">)</span> <span class="bp">=</span> <span class="n">vect.map</span> <span class="o">(</span><span class="n">f</span> <span class="bp">∘</span> <span class="n">transport</span> <span class="n">id</span> <span class="n">p</span><span class="o">)</span> <span class="n">v</span> <span class="o">:=</span>
<span class="kd">by</span> <span class="o">{</span> <span class="n">induction</span> <span class="n">p</span><span class="bp">;</span> <span class="n">apply</span> <span class="n">Id.refl</span> <span class="o">}</span>
</code></pre></div>



<a name="301277019"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Annoying%20LCNF%20errors/near/301277019" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> James Gallicchio <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Annoying.20LCNF.20errors.html#301277019">(Sep 28 2022 at 16:33)</a>:</h4>
<p>I think these bugs are being reported on GitHub, see <a href="#narrow/stream/270676-lean4/topic/LCNF.20local.20context.20contains.20unused.20local.20variable.20declaratio/near/301102923">https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/LCNF.20local.20context.20contains.20unused.20local.20variable.20declaratio/near/301102923</a></p>



<a name="301310093"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Annoying%20LCNF%20errors/near/301310093" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Annoying.20LCNF.20errors.html#301310093">(Sep 28 2022 at 19:22)</a>:</h4>
<p><span class="user-mention" data-user-id="112857">@Leonardo de Moura</span> Someone found a "mixing types and data" issue :)</p>



<a name="301331343"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Annoying%20LCNF%20errors/near/301331343" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Leonardo de Moura <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Annoying.20LCNF.20errors.html#301331343">(Sep 28 2022 at 21:28)</a>:</h4>
<p>I will take a look.</p>



<a name="301340485"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Annoying%20LCNF%20errors/near/301340485" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Leonardo de Moura <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Annoying.20LCNF.20errors.html#301340485">(Sep 28 2022 at 22:40)</a>:</h4>
<p>Pushed a fix for this issue. Great example for the test suite. Thanks for posting it.</p>



<a name="301424293"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Annoying%20LCNF%20errors/near/301424293" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Uranus Testing <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Annoying.20LCNF.20errors.html#301424293">(Sep 29 2022 at 12:03)</a>:</h4>
<p>It seems that’s not all. Even after fix <a href="https://github.com/forked-from-1kasper/ground_zero/blob/ff203bdc1fe3bf7e54f718f47cd9c76d994d4f20/GroundZero/Theorems/Equiv.lean#L227-L232">this definition</a> still reports a weird error:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">type</span> <span class="n">mismatch</span> <span class="n">at</span> <span class="n">LCNF</span> <span class="n">application</span>
  <span class="n">contrRespectsEquiv</span> <span class="n">_x.5</span> <span class="n">_x.8</span>
<span class="n">argument</span> <span class="n">_x.5</span> <span class="n">has</span> <span class="n">type</span>
  <span class="o">(</span><span class="n">_</span> <span class="o">:</span> <span class="o">(</span><span class="n">_</span> <span class="o">:</span> <span class="n">B</span><span class="o">)</span> <span class="bp">×</span> <span class="n">lcErased</span> <span class="bp">=</span> <span class="n">lcErased</span> <span class="bp">→</span> <span class="o">(</span><span class="n">_</span> <span class="o">:</span> <span class="n">B</span><span class="o">)</span> <span class="bp">×</span> <span class="n">lcErased</span> <span class="bp">=</span> <span class="n">lcErased</span><span class="o">)</span> <span class="bp">×</span>
    <span class="o">((</span><span class="n">_</span> <span class="o">:</span> <span class="o">(</span><span class="n">_</span> <span class="o">:</span> <span class="n">B</span><span class="o">)</span> <span class="bp">×</span> <span class="n">lcErased</span> <span class="bp">=</span> <span class="n">lcErased</span> <span class="bp">→</span> <span class="o">(</span><span class="n">_</span> <span class="o">:</span> <span class="n">B</span><span class="o">)</span> <span class="bp">×</span> <span class="n">lcErased</span> <span class="bp">=</span> <span class="n">lcErased</span><span class="o">)</span> <span class="bp">×</span>
        <span class="o">((</span><span class="n">_</span> <span class="o">:</span> <span class="n">B</span><span class="o">)</span> <span class="bp">×</span> <span class="n">lcErased</span> <span class="bp">=</span> <span class="n">lcErased</span> <span class="bp">→</span> <span class="n">lcErased</span> <span class="bp">=</span> <span class="n">lcErased</span><span class="o">))</span> <span class="bp">×</span>
      <span class="o">(</span><span class="n">_</span> <span class="o">:</span> <span class="o">(</span><span class="n">_</span> <span class="o">:</span> <span class="n">B</span><span class="o">)</span> <span class="bp">×</span> <span class="n">lcErased</span> <span class="bp">=</span> <span class="n">lcErased</span> <span class="bp">→</span> <span class="o">(</span><span class="n">_</span> <span class="o">:</span> <span class="n">B</span><span class="o">)</span> <span class="bp">×</span> <span class="n">lcErased</span> <span class="bp">=</span> <span class="n">lcErased</span><span class="o">)</span> <span class="bp">×</span>
        <span class="o">((</span><span class="n">_</span> <span class="o">:</span> <span class="n">B</span><span class="o">)</span> <span class="bp">×</span> <span class="n">lcErased</span> <span class="bp">=</span> <span class="n">lcErased</span> <span class="bp">→</span> <span class="n">lcErased</span> <span class="bp">=</span> <span class="n">lcErased</span><span class="o">)</span>
<span class="n">but</span> <span class="n">is</span> <span class="n">expected</span> <span class="n">to</span> <span class="k">have</span> <span class="n">type</span>
  <span class="o">(</span><span class="n">_</span> <span class="o">:</span> <span class="n">Sigma</span> <span class="o">(</span><span class="n">Types.Id</span> <span class="n">lcErased</span><span class="o">)</span> <span class="bp">→</span> <span class="o">(</span><span class="n">_</span> <span class="o">:</span> <span class="n">B</span><span class="o">)</span> <span class="bp">×</span> <span class="n">lcErased</span> <span class="bp">=</span> <span class="n">lcErased</span><span class="o">)</span> <span class="bp">×</span>
    <span class="o">((</span><span class="n">_</span> <span class="o">:</span> <span class="o">(</span><span class="n">_</span> <span class="o">:</span> <span class="n">B</span><span class="o">)</span> <span class="bp">×</span> <span class="n">lcErased</span> <span class="bp">=</span> <span class="n">lcErased</span> <span class="bp">→</span> <span class="n">Sigma</span> <span class="o">(</span><span class="n">Types.Id</span> <span class="n">lcErased</span><span class="o">))</span> <span class="bp">×</span>
        <span class="o">(</span><span class="n">Sigma</span> <span class="o">(</span><span class="n">Types.Id</span> <span class="n">lcErased</span><span class="o">)</span> <span class="bp">→</span> <span class="n">lcErased</span> <span class="bp">=</span> <span class="n">lcErased</span><span class="o">))</span> <span class="bp">×</span>
      <span class="o">(</span><span class="n">_</span> <span class="o">:</span> <span class="o">(</span><span class="n">_</span> <span class="o">:</span> <span class="n">B</span><span class="o">)</span> <span class="bp">×</span> <span class="n">lcErased</span> <span class="bp">=</span> <span class="n">lcErased</span> <span class="bp">→</span> <span class="n">Sigma</span> <span class="o">(</span><span class="n">Types.Id</span> <span class="n">lcErased</span><span class="o">))</span> <span class="bp">×</span>
        <span class="o">((</span><span class="n">_</span> <span class="o">:</span> <span class="n">B</span><span class="o">)</span> <span class="bp">×</span> <span class="n">lcErased</span> <span class="bp">=</span> <span class="n">lcErased</span> <span class="bp">→</span> <span class="n">lcErased</span> <span class="bp">=</span> <span class="n">lcErased</span><span class="o">)</span>
</code></pre></div>
<p>Here’s another MWE:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">namespace</span> <span class="n">MWE</span>

<span class="kd">universe</span> <span class="n">u</span> <span class="n">v</span> <span class="n">w</span>

<span class="kd">inductive</span> <span class="n">Id</span> <span class="o">{</span><span class="n">A</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">}</span> <span class="o">:</span> <span class="n">A</span> <span class="bp">→</span> <span class="n">A</span> <span class="bp">→</span> <span class="kt">Type</span> <span class="n">u</span>
<span class="bp">|</span> <span class="n">refl</span> <span class="o">{</span><span class="n">a</span> <span class="o">:</span> <span class="n">A</span><span class="o">}</span> <span class="o">:</span> <span class="n">Id</span> <span class="n">a</span> <span class="n">a</span>

<span class="kn">attribute</span> <span class="o">[</span><span class="n">eliminator</span><span class="o">]</span> <span class="n">Id.casesOn</span>

<span class="kd">infix</span><span class="o">:</span><span class="mi">50</span> <span class="o">(</span><span class="n">priority</span> <span class="o">:=</span> <span class="n">high</span><span class="o">)</span> <span class="s2">" = "</span> <span class="bp">=&gt;</span> <span class="n">Id</span>

<span class="kd">def</span> <span class="n">contr</span> <span class="o">(</span><span class="n">A</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">)</span> <span class="o">:=</span> <span class="bp">Σ</span> <span class="o">(</span><span class="n">a</span> <span class="o">:</span> <span class="n">A</span><span class="o">),</span> <span class="bp">∀</span> <span class="n">b</span><span class="o">,</span> <span class="n">a</span> <span class="bp">=</span> <span class="n">b</span>

<span class="kd">def</span> <span class="n">singl</span> <span class="o">{</span><span class="n">A</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">}</span> <span class="o">(</span><span class="n">a</span> <span class="o">:</span> <span class="n">A</span><span class="o">)</span> <span class="o">:=</span>
<span class="bp">Σ</span> <span class="n">b</span><span class="o">,</span> <span class="n">a</span> <span class="bp">=</span> <span class="n">b</span>

<span class="kd">def</span> <span class="n">Corr</span> <span class="o">(</span><span class="n">A</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">)</span> <span class="o">(</span><span class="n">B</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">v</span><span class="o">)</span> <span class="o">:=</span>
<span class="bp">Σ</span> <span class="o">(</span><span class="n">R</span> <span class="o">:</span> <span class="n">A</span> <span class="bp">→</span> <span class="n">B</span> <span class="bp">→</span> <span class="kt">Type</span> <span class="n">w</span><span class="o">),</span> <span class="o">(</span><span class="bp">∀</span> <span class="n">a</span><span class="o">,</span> <span class="n">contr</span> <span class="o">(</span><span class="bp">Σ</span> <span class="n">b</span><span class="o">,</span> <span class="n">R</span> <span class="n">a</span> <span class="n">b</span><span class="o">))</span> <span class="bp">×</span> <span class="o">(</span><span class="bp">∀</span> <span class="n">b</span><span class="o">,</span> <span class="n">contr</span> <span class="o">(</span><span class="bp">Σ</span> <span class="n">a</span><span class="o">,</span> <span class="n">R</span> <span class="n">a</span> <span class="n">b</span><span class="o">))</span>

<span class="kd">def</span> <span class="n">Homotopy</span> <span class="o">{</span><span class="n">A</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">}</span> <span class="o">{</span><span class="n">B</span> <span class="o">:</span> <span class="n">A</span> <span class="bp">→</span> <span class="kt">Type</span> <span class="n">v</span><span class="o">}</span> <span class="o">(</span><span class="n">f</span> <span class="n">g</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">x</span><span class="o">,</span> <span class="n">B</span> <span class="n">x</span><span class="o">)</span> <span class="o">:=</span>
<span class="bp">∀</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="n">A</span><span class="o">),</span> <span class="n">f</span> <span class="n">x</span> <span class="bp">=</span> <span class="n">g</span> <span class="n">x</span>
<span class="kd">infix</span><span class="o">:</span><span class="mi">80</span> <span class="s2">" ~ "</span> <span class="bp">=&gt;</span> <span class="n">Homotopy</span>

<span class="kd">def</span> <span class="n">isQinv</span> <span class="o">{</span><span class="n">A</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">}</span> <span class="o">{</span><span class="n">B</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">v</span><span class="o">}</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">A</span> <span class="bp">→</span> <span class="n">B</span><span class="o">)</span> <span class="o">(</span><span class="n">g</span> <span class="o">:</span> <span class="n">B</span> <span class="bp">→</span> <span class="n">A</span><span class="o">)</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">f</span> <span class="bp">∘</span> <span class="n">g</span> <span class="bp">~</span> <span class="n">id</span><span class="o">)</span> <span class="bp">×</span> <span class="o">(</span><span class="n">g</span> <span class="bp">∘</span> <span class="n">f</span> <span class="bp">~</span> <span class="n">id</span><span class="o">)</span>

<span class="kd">def</span> <span class="n">Qinv</span> <span class="o">{</span><span class="n">A</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">}</span> <span class="o">{</span><span class="n">B</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">v</span><span class="o">}</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">A</span> <span class="bp">→</span> <span class="n">B</span><span class="o">)</span> <span class="o">:=</span>
<span class="bp">Σ</span> <span class="o">(</span><span class="n">g</span> <span class="o">:</span> <span class="n">B</span> <span class="bp">→</span> <span class="n">A</span><span class="o">),</span> <span class="n">isQinv</span> <span class="n">f</span> <span class="n">g</span>

<span class="kd">def</span> <span class="n">Qinv.eqv</span> <span class="o">(</span><span class="n">A</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">)</span> <span class="o">(</span><span class="n">B</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">v</span><span class="o">)</span> <span class="o">:=</span>
<span class="bp">Σ</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">A</span> <span class="bp">→</span> <span class="n">B</span><span class="o">),</span> <span class="n">Qinv</span> <span class="n">f</span>

<span class="kd">def</span> <span class="n">linv</span> <span class="o">{</span><span class="n">A</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">}</span> <span class="o">{</span><span class="n">B</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">v</span><span class="o">}</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">A</span> <span class="bp">→</span> <span class="n">B</span><span class="o">)</span> <span class="o">:=</span>
<span class="bp">Σ</span> <span class="o">(</span><span class="n">g</span> <span class="o">:</span> <span class="n">B</span> <span class="bp">→</span> <span class="n">A</span><span class="o">),</span> <span class="n">g</span> <span class="bp">∘</span> <span class="n">f</span> <span class="bp">~</span> <span class="n">id</span>

<span class="kd">def</span> <span class="n">rinv</span> <span class="o">{</span><span class="n">A</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">}</span> <span class="o">{</span><span class="n">B</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">v</span><span class="o">}</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">A</span> <span class="bp">→</span> <span class="n">B</span><span class="o">)</span> <span class="o">:=</span>
<span class="bp">Σ</span> <span class="o">(</span><span class="n">g</span> <span class="o">:</span> <span class="n">B</span> <span class="bp">→</span> <span class="n">A</span><span class="o">),</span> <span class="n">f</span> <span class="bp">∘</span> <span class="n">g</span> <span class="bp">~</span> <span class="n">id</span>

<span class="kd">def</span> <span class="n">biinv</span> <span class="o">{</span><span class="n">A</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">}</span> <span class="o">{</span><span class="n">B</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">v</span><span class="o">}</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">A</span> <span class="bp">→</span> <span class="n">B</span><span class="o">)</span> <span class="o">:=</span>
<span class="n">linv</span> <span class="n">f</span> <span class="bp">×</span> <span class="n">rinv</span> <span class="n">f</span>

<span class="kd">def</span> <span class="n">Equiv</span> <span class="o">(</span><span class="n">A</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">)</span> <span class="o">(</span><span class="n">B</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">v</span><span class="o">)</span> <span class="o">:</span> <span class="kt">Type</span> <span class="o">(</span><span class="n">max</span> <span class="n">u</span> <span class="n">v</span><span class="o">)</span> <span class="o">:=</span>
<span class="bp">Σ</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">A</span> <span class="bp">→</span> <span class="n">B</span><span class="o">),</span> <span class="n">biinv</span> <span class="n">f</span>
<span class="kd">infix</span><span class="o">:</span><span class="mi">25</span> <span class="s2">" ≃ "</span> <span class="bp">=&gt;</span> <span class="n">Equiv</span>

<span class="kd">axiom</span> <span class="n">ax₁</span> <span class="o">{</span><span class="n">A</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">}</span> <span class="o">{</span><span class="n">B</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">v</span><span class="o">}</span> <span class="o">:</span> <span class="n">A</span> <span class="bp">≃</span> <span class="n">B</span> <span class="bp">→</span> <span class="n">contr</span> <span class="n">A</span> <span class="bp">→</span> <span class="n">contr</span> <span class="n">B</span>
<span class="kd">axiom</span> <span class="n">ax₂</span> <span class="o">{</span><span class="n">A</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">v</span><span class="o">}</span> <span class="o">{</span><span class="n">B</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">}</span> <span class="o">(</span><span class="n">f</span> <span class="n">g</span> <span class="o">:</span> <span class="n">A</span> <span class="bp">→</span> <span class="n">B</span><span class="o">)</span> <span class="o">:</span> <span class="o">(</span><span class="bp">Σ</span> <span class="n">x</span><span class="o">,</span> <span class="n">f</span> <span class="n">x</span> <span class="bp">=</span> <span class="n">g</span> <span class="n">x</span><span class="o">)</span> <span class="bp">≃</span> <span class="o">(</span><span class="bp">Σ</span> <span class="n">x</span><span class="o">,</span> <span class="n">g</span> <span class="n">x</span> <span class="bp">=</span> <span class="n">f</span> <span class="n">x</span><span class="o">)</span>
<span class="kd">axiom</span> <span class="n">ax₄</span> <span class="o">{</span><span class="n">A</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">}</span> <span class="o">{</span><span class="n">B</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">v</span><span class="o">}</span> <span class="o">(</span><span class="n">w</span> <span class="o">:</span> <span class="n">Qinv.eqv</span> <span class="n">A</span> <span class="n">B</span><span class="o">)</span> <span class="o">(</span><span class="n">b</span> <span class="o">:</span> <span class="n">B</span><span class="o">)</span> <span class="o">:</span> <span class="n">contr</span> <span class="o">(</span><span class="bp">Σ</span> <span class="n">a</span><span class="o">,</span> <span class="n">b</span> <span class="bp">=</span> <span class="n">w.1</span> <span class="n">a</span><span class="o">)</span>
<span class="kd">axiom</span> <span class="n">ax₃</span> <span class="o">{</span><span class="n">A</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">}</span> <span class="o">(</span><span class="n">a</span> <span class="o">:</span> <span class="n">A</span><span class="o">)</span> <span class="o">:</span> <span class="n">contr</span> <span class="o">(</span><span class="n">singl</span> <span class="n">a</span><span class="o">)</span>

<span class="kd">def</span> <span class="n">corrOfQinv</span> <span class="o">{</span><span class="n">A</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">}</span> <span class="o">{</span><span class="n">B</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">v</span><span class="o">}</span> <span class="o">:</span> <span class="n">Qinv.eqv</span> <span class="n">A</span> <span class="n">B</span> <span class="bp">→</span> <span class="n">Corr</span> <span class="n">A</span> <span class="n">B</span> <span class="o">:=</span>
<span class="kd">by</span> <span class="o">{</span> <span class="n">intro</span> <span class="n">w</span><span class="bp">;</span> <span class="n">exists</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">a</span> <span class="n">b</span> <span class="bp">=&gt;</span> <span class="n">b</span> <span class="bp">=</span> <span class="n">w.1</span> <span class="n">a</span><span class="o">)</span><span class="bp">;</span> <span class="n">apply</span> <span class="n">Prod.mk</span> <span class="bp">&lt;;&gt;</span> <span class="n">intro</span> <span class="n">x</span><span class="bp">;</span>
     <span class="n">apply</span> <span class="n">ax₁</span><span class="bp">;</span> <span class="n">apply</span> <span class="n">ax₂</span><span class="bp">;</span> <span class="n">apply</span> <span class="n">ax₃</span><span class="bp">;</span> <span class="n">apply</span> <span class="n">ax₄</span> <span class="o">}</span>
</code></pre></div>



<a name="301424850"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Annoying%20LCNF%20errors/near/301424850" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Uranus Testing <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Annoying.20LCNF.20errors.html#301424850">(Sep 29 2022 at 12:07)</a>:</h4>
<p>It’s interesting also that if we replace last definition (<code>corrOfQinv</code>) with <code>theorem</code>, it will report other error:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">application</span> <span class="n">type</span> <span class="n">mismatch</span>
  <span class="bp">?</span><span class="n">m.23082</span> <span class="bp">=</span> <span class="n">Sigma.fst</span> <span class="n">w</span> <span class="n">a</span>
<span class="n">argument</span>
  <span class="n">Sigma.fst</span> <span class="n">w</span> <span class="n">a</span>
<span class="n">has</span> <span class="n">type</span>
  <span class="n">B</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">v</span>
<span class="n">but</span> <span class="n">is</span> <span class="n">expected</span> <span class="n">to</span> <span class="k">have</span> <span class="n">type</span>
  <span class="bp">?</span><span class="n">m.23103</span> <span class="n">a</span> <span class="n">b</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u_1</span>
</code></pre></div>



<a name="301439509"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Annoying%20LCNF%20errors/near/301439509" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Leonardo de Moura <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Annoying.20LCNF.20errors.html#301439509">(Sep 29 2022 at 13:25)</a>:</h4>
<p>I will take a look.</p>



<a name="301501136"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Annoying%20LCNF%20errors/near/301501136" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Leonardo de Moura <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Annoying.20LCNF.20errors.html#301501136">(Sep 29 2022 at 18:07)</a>:</h4>
<p>Pushed a fix for the LCNF error.</p>



<a name="301501190"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Annoying%20LCNF%20errors/near/301501190" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Leonardo de Moura <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Annoying.20LCNF.20errors.html#301501190">(Sep 29 2022 at 18:07)</a>:</h4>
<p>I have added the example to the test suite.</p>



<a name="301935406"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Annoying%20LCNF%20errors/near/301935406" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Uranus Testing <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Annoying.20LCNF.20errors.html#301935406">(Oct 02 2022 at 13:29)</a>:</h4>
<p>These (new) errors seem to be related to the previous:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">namespace</span> <span class="n">MWE</span>

<span class="kd">inductive</span> <span class="n">Id</span> <span class="o">{</span><span class="n">A</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">}</span> <span class="o">:</span> <span class="n">A</span> <span class="bp">→</span> <span class="n">A</span> <span class="bp">→</span> <span class="kt">Type</span> <span class="n">u</span>
<span class="bp">|</span> <span class="n">refl</span> <span class="o">{</span><span class="n">a</span> <span class="o">:</span> <span class="n">A</span><span class="o">}</span> <span class="o">:</span> <span class="n">Id</span> <span class="n">a</span> <span class="n">a</span>

<span class="kn">attribute</span> <span class="o">[</span><span class="n">eliminator</span><span class="o">]</span> <span class="n">Id.casesOn</span>

<span class="kd">infix</span><span class="o">:</span><span class="mi">50</span> <span class="o">(</span><span class="n">priority</span> <span class="o">:=</span> <span class="n">high</span><span class="o">)</span> <span class="s2">" = "</span> <span class="bp">=&gt;</span> <span class="n">Id</span>

<span class="kd">def</span> <span class="n">symm</span> <span class="o">{</span><span class="n">A</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">}</span> <span class="o">{</span><span class="n">a</span> <span class="n">b</span> <span class="o">:</span> <span class="n">A</span><span class="o">}</span> <span class="o">(</span><span class="n">p</span> <span class="o">:</span> <span class="n">a</span> <span class="bp">=</span> <span class="n">b</span><span class="o">)</span> <span class="o">:</span> <span class="n">b</span> <span class="bp">=</span> <span class="n">a</span> <span class="o">:=</span>
<span class="kd">by</span> <span class="o">{</span> <span class="n">induction</span> <span class="n">p</span><span class="bp">;</span> <span class="n">exact</span> <span class="n">Id.refl</span> <span class="o">}</span>

<span class="kd">def</span> <span class="n">transportconst</span> <span class="o">{</span><span class="n">A</span> <span class="n">B</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">}</span> <span class="o">:</span> <span class="n">A</span> <span class="bp">=</span> <span class="n">B</span> <span class="bp">→</span> <span class="n">A</span> <span class="bp">→</span> <span class="n">B</span> <span class="o">:=</span>
<span class="kd">by</span> <span class="o">{</span> <span class="n">intros</span> <span class="n">p</span> <span class="n">x</span><span class="bp">;</span> <span class="n">induction</span> <span class="n">p</span><span class="bp">;</span> <span class="n">exact</span> <span class="n">x</span> <span class="o">}</span>

<span class="kd">def</span> <span class="n">transportconstInv</span> <span class="o">{</span><span class="n">A</span> <span class="n">B</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">}</span> <span class="o">(</span><span class="n">e</span> <span class="o">:</span> <span class="n">A</span> <span class="bp">=</span> <span class="n">B</span><span class="o">)</span> <span class="o">:</span> <span class="n">B</span> <span class="bp">→</span> <span class="n">A</span> <span class="o">:=</span>
<span class="n">transportconst</span> <span class="o">(</span><span class="n">symm</span> <span class="n">e</span><span class="o">)</span>

<span class="c">/-</span><span class="cm"></span>
<span class="cm">type mismatch at LCNF application</span>
<span class="cm">  Id.refl</span>
<span class="cm">argument x has type</span>
<span class="cm">  B</span>
<span class="cm">but is expected to have type</span>
<span class="cm">  A</span>
<span class="cm">-/</span>
<span class="kd">def</span> <span class="n">transportconstOverInv</span> <span class="o">{</span><span class="n">A</span> <span class="n">B</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">}</span> <span class="o">(</span><span class="n">p</span> <span class="o">:</span> <span class="n">A</span> <span class="bp">=</span> <span class="n">B</span><span class="o">)</span> <span class="o">:</span>
  <span class="bp">∀</span> <span class="n">x</span><span class="o">,</span> <span class="n">transportconst</span> <span class="o">(</span><span class="n">symm</span> <span class="n">p</span><span class="o">)</span> <span class="n">x</span> <span class="bp">=</span> <span class="n">transportconstInv</span> <span class="n">p</span> <span class="n">x</span> <span class="o">:=</span>
<span class="kd">by</span> <span class="o">{</span> <span class="n">intro</span> <span class="n">x</span><span class="bp">;</span> <span class="n">apply</span> <span class="n">Id.refl</span> <span class="o">}</span>

<span class="c">/-</span><span class="cm"></span>
<span class="cm">type mismatch at `MWE.transportconstInv'`, value has type</span>
<span class="cm">  (A B : Type u) → A = B → B → B</span>
<span class="cm">but is expected to have type</span>
<span class="cm">  {A B : Type u} → A = B → B → A</span>
<span class="cm">-/</span>
<span class="kd">def</span> <span class="n">transportconstInv'</span> <span class="o">{</span><span class="n">A</span> <span class="n">B</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">}</span> <span class="o">:</span> <span class="n">A</span> <span class="bp">=</span> <span class="n">B</span> <span class="bp">→</span> <span class="n">B</span> <span class="bp">→</span> <span class="n">A</span> <span class="o">:=</span>
<span class="n">transportconst</span> <span class="bp">∘</span> <span class="n">symm</span>
</code></pre></div>



<a name="301945836"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Annoying%20LCNF%20errors/near/301945836" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Leonardo de Moura <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Annoying.20LCNF.20errors.html#301945836">(Oct 02 2022 at 15:16)</a>:</h4>
<p>Pushed a fix for this one. <a href="https://github.com/leanprover/lean4/commit/31d59e337bc2baf021f8025b9d18b37648359585">https://github.com/leanprover/lean4/commit/31d59e337bc2baf021f8025b9d18b37648359585</a></p>



<a name="302056742"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Annoying%20LCNF%20errors/near/302056742" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Uranus Testing <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Annoying.20LCNF.20errors.html#302056742">(Oct 03 2022 at 12:51)</a>:</h4>
<p>It’s strange, but the following isn’t working now, while previous example works.</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">namespace</span> <span class="n">MWE</span>

<span class="kd">inductive</span> <span class="n">Id</span> <span class="o">{</span><span class="n">A</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">}</span> <span class="o">:</span> <span class="n">A</span> <span class="bp">→</span> <span class="n">A</span> <span class="bp">→</span> <span class="kt">Type</span> <span class="n">u</span>
<span class="bp">|</span> <span class="n">refl</span> <span class="o">{</span><span class="n">a</span> <span class="o">:</span> <span class="n">A</span><span class="o">}</span> <span class="o">:</span> <span class="n">Id</span> <span class="n">a</span> <span class="n">a</span>

<span class="kn">attribute</span> <span class="o">[</span><span class="n">eliminator</span><span class="o">]</span> <span class="n">Id.casesOn</span>

<span class="kd">infix</span><span class="o">:</span><span class="mi">50</span> <span class="o">(</span><span class="n">priority</span> <span class="o">:=</span> <span class="n">high</span><span class="o">)</span> <span class="s2">" = "</span> <span class="bp">=&gt;</span> <span class="n">Id</span>

<span class="kd">def</span> <span class="n">symm</span> <span class="o">{</span><span class="n">A</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">}</span> <span class="o">{</span><span class="n">a</span> <span class="n">b</span> <span class="o">:</span> <span class="n">A</span><span class="o">}</span> <span class="o">(</span><span class="n">p</span> <span class="o">:</span> <span class="n">a</span> <span class="bp">=</span> <span class="n">b</span><span class="o">)</span> <span class="o">:</span> <span class="n">b</span> <span class="bp">=</span> <span class="n">a</span> <span class="o">:=</span>
<span class="kd">by</span> <span class="o">{</span> <span class="n">induction</span> <span class="n">p</span><span class="bp">;</span> <span class="n">exact</span> <span class="n">Id.refl</span> <span class="o">}</span>

<span class="kd">def</span> <span class="n">transport</span> <span class="o">{</span><span class="n">A</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">}</span> <span class="o">(</span><span class="n">B</span> <span class="o">:</span> <span class="n">A</span> <span class="bp">→</span> <span class="kt">Type</span> <span class="n">v</span><span class="o">)</span> <span class="o">{</span><span class="n">a</span> <span class="n">b</span> <span class="o">:</span> <span class="n">A</span><span class="o">}</span> <span class="o">(</span><span class="n">p</span> <span class="o">:</span> <span class="n">a</span> <span class="bp">=</span> <span class="n">b</span><span class="o">)</span> <span class="o">:</span> <span class="n">B</span> <span class="n">a</span> <span class="bp">→</span> <span class="n">B</span> <span class="n">b</span> <span class="o">:=</span>
<span class="kd">by</span> <span class="o">{</span> <span class="n">induction</span> <span class="n">p</span><span class="bp">;</span> <span class="n">exact</span> <span class="n">id</span> <span class="o">}</span>

<span class="kd">def</span> <span class="n">transportconst</span> <span class="o">{</span><span class="n">A</span> <span class="n">B</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">}</span> <span class="o">:</span> <span class="n">A</span> <span class="bp">=</span> <span class="n">B</span> <span class="bp">→</span> <span class="n">A</span> <span class="bp">→</span> <span class="n">B</span> <span class="o">:=</span>
<span class="n">transport</span> <span class="n">id</span>

<span class="kd">def</span> <span class="n">transportconstInv</span> <span class="o">{</span><span class="n">A</span> <span class="n">B</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">}</span> <span class="o">(</span><span class="n">e</span> <span class="o">:</span> <span class="n">A</span> <span class="bp">=</span> <span class="n">B</span><span class="o">)</span> <span class="o">:</span> <span class="n">B</span> <span class="bp">→</span> <span class="n">A</span> <span class="o">:=</span>
<span class="n">transportconst</span> <span class="o">(</span><span class="n">symm</span> <span class="n">e</span><span class="o">)</span>

<span class="kd">def</span> <span class="n">transportconstOverInv</span> <span class="o">{</span><span class="n">A</span> <span class="n">B</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">}</span> <span class="o">(</span><span class="n">p</span> <span class="o">:</span> <span class="n">A</span> <span class="bp">=</span> <span class="n">B</span><span class="o">)</span> <span class="o">:</span>
  <span class="bp">∀</span> <span class="n">x</span><span class="o">,</span> <span class="n">transportconst</span> <span class="o">(</span><span class="n">symm</span> <span class="n">p</span><span class="o">)</span> <span class="n">x</span> <span class="bp">=</span> <span class="n">transportconstInv</span> <span class="n">p</span> <span class="n">x</span> <span class="o">:=</span>
<span class="kd">by</span> <span class="o">{</span> <span class="n">intro</span> <span class="n">x</span><span class="bp">;</span> <span class="n">apply</span> <span class="n">Id.refl</span> <span class="o">}</span>

<span class="kd">def</span> <span class="n">transportconstInv'</span> <span class="o">{</span><span class="n">A</span> <span class="n">B</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">}</span> <span class="o">:</span> <span class="n">A</span> <span class="bp">=</span> <span class="n">B</span> <span class="bp">→</span> <span class="n">B</span> <span class="bp">→</span> <span class="n">A</span> <span class="o">:=</span>
<span class="n">transportconst</span> <span class="bp">∘</span> <span class="n">symm</span>
</code></pre></div>



<a name="302063463"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Annoying%20LCNF%20errors/near/302063463" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Leonardo de Moura <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Annoying.20LCNF.20errors.html#302063463">(Oct 03 2022 at 13:28)</a>:</h4>
<p>I will take a look.</p>



<a name="302103852"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Annoying%20LCNF%20errors/near/302103852" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Leonardo de Moura <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Annoying.20LCNF.20errors.html#302103852">(Oct 03 2022 at 16:50)</a>:</h4>
<p>Pushed a fix for this one. <a href="https://github.com/leanprover/lean4/commit/fed7ff27e83173a9e2817002095c6bb55abd5ef4">https://github.com/leanprover/lean4/commit/fed7ff27e83173a9e2817002095c6bb55abd5ef4</a></p>



<a name="303142516"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Annoying%20LCNF%20errors/near/303142516" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Uranus Testing <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Annoying.20LCNF.20errors.html#303142516">(Oct 09 2022 at 15:02)</a>:</h4>
<p>Fresh problems:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">namespace</span> <span class="n">MWE</span>

<span class="kd">inductive</span> <span class="n">Id</span> <span class="o">{</span><span class="n">A</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">}</span> <span class="o">:</span> <span class="n">A</span> <span class="bp">→</span> <span class="n">A</span> <span class="bp">→</span> <span class="kt">Type</span> <span class="n">u</span>
<span class="bp">|</span> <span class="n">refl</span> <span class="o">{</span><span class="n">a</span> <span class="o">:</span> <span class="n">A</span><span class="o">}</span> <span class="o">:</span> <span class="n">Id</span> <span class="n">a</span> <span class="n">a</span>

<span class="kn">attribute</span> <span class="o">[</span><span class="n">eliminator</span><span class="o">]</span> <span class="n">Id.casesOn</span>

<span class="kd">infix</span><span class="o">:</span><span class="mi">50</span> <span class="o">(</span><span class="n">priority</span> <span class="o">:=</span> <span class="n">high</span><span class="o">)</span> <span class="s2">" = "</span> <span class="bp">=&gt;</span> <span class="n">Id</span>

<span class="kd">def</span> <span class="n">symm</span> <span class="o">{</span><span class="n">A</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">}</span> <span class="o">{</span><span class="n">a</span> <span class="n">b</span> <span class="o">:</span> <span class="n">A</span><span class="o">}</span> <span class="o">(</span><span class="n">p</span> <span class="o">:</span> <span class="n">a</span> <span class="bp">=</span> <span class="n">b</span><span class="o">)</span> <span class="o">:</span> <span class="n">b</span> <span class="bp">=</span> <span class="n">a</span> <span class="o">:=</span>
<span class="kd">by</span> <span class="o">{</span> <span class="n">induction</span> <span class="n">p</span><span class="bp">;</span> <span class="n">exact</span> <span class="n">Id.refl</span> <span class="o">}</span>

<span class="kd">def</span> <span class="n">map</span> <span class="o">{</span><span class="n">A</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">}</span> <span class="o">{</span><span class="n">B</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">v</span><span class="o">}</span> <span class="o">{</span><span class="n">a</span> <span class="n">b</span> <span class="o">:</span> <span class="n">A</span><span class="o">}</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">A</span> <span class="bp">→</span> <span class="n">B</span><span class="o">)</span> <span class="o">(</span><span class="n">p</span> <span class="o">:</span> <span class="n">a</span> <span class="bp">=</span> <span class="n">b</span><span class="o">)</span> <span class="o">:</span> <span class="n">f</span> <span class="n">a</span> <span class="bp">=</span> <span class="n">f</span> <span class="n">b</span> <span class="o">:=</span>
<span class="kd">by</span> <span class="o">{</span> <span class="n">induction</span> <span class="n">p</span><span class="bp">;</span> <span class="n">apply</span> <span class="n">Id.refl</span> <span class="o">}</span>

<span class="kd">def</span> <span class="n">transport</span> <span class="o">{</span><span class="n">A</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">}</span> <span class="o">(</span><span class="n">B</span> <span class="o">:</span> <span class="n">A</span> <span class="bp">→</span> <span class="kt">Type</span> <span class="n">v</span><span class="o">)</span> <span class="o">{</span><span class="n">a</span> <span class="n">b</span> <span class="o">:</span> <span class="n">A</span><span class="o">}</span> <span class="o">(</span><span class="n">p</span> <span class="o">:</span> <span class="n">a</span> <span class="bp">=</span> <span class="n">b</span><span class="o">)</span> <span class="o">:</span> <span class="n">B</span> <span class="n">a</span> <span class="bp">→</span> <span class="n">B</span> <span class="n">b</span> <span class="o">:=</span>
<span class="kd">by</span> <span class="o">{</span> <span class="n">induction</span> <span class="n">p</span><span class="bp">;</span> <span class="n">exact</span> <span class="n">id</span> <span class="o">}</span>

<span class="kd">def</span> <span class="n">boolToUniverse</span> <span class="o">:</span> <span class="n">Bool</span> <span class="bp">→</span> <span class="kt">Type</span>
<span class="bp">|</span> <span class="n">true</span>  <span class="bp">=&gt;</span> <span class="n">Unit</span>
<span class="bp">|</span> <span class="n">false</span> <span class="bp">=&gt;</span> <span class="n">Empty</span>

<span class="kd">def</span> <span class="n">ffNeqTt</span> <span class="o">:</span> <span class="n">false</span> <span class="bp">=</span> <span class="n">true</span> <span class="bp">→</span> <span class="n">Empty</span> <span class="o">:=</span>
<span class="bp">λ</span> <span class="n">p</span> <span class="bp">=&gt;</span> <span class="n">transport</span> <span class="n">boolToUniverse</span> <span class="o">(</span><span class="n">symm</span> <span class="n">p</span><span class="o">)</span> <span class="o">()</span>

<span class="kd">def</span> <span class="n">isZero</span> <span class="o">:</span> <span class="n">Nat</span> <span class="bp">→</span> <span class="n">Bool</span>
<span class="bp">|</span> <span class="n">Nat.zero</span>   <span class="bp">=&gt;</span> <span class="n">true</span>
<span class="bp">|</span> <span class="n">Nat.succ</span> <span class="n">_</span> <span class="bp">=&gt;</span> <span class="n">false</span>

<span class="c">/-</span><span class="cm"></span>
<span class="cm">type mismatch at LCNF application</span>
<span class="cm">  ffNeqTt h</span>
<span class="cm">argument h has type</span>
<span class="cm">  Id Nat lcErased lcErased</span>
<span class="cm">but is expected to have type</span>
<span class="cm">  Id Bool lcErased lcErased</span>
<span class="cm">-/</span>
<span class="kd">def</span> <span class="n">succNeqZero</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="n">Nat</span><span class="o">)</span> <span class="o">:</span> <span class="n">Nat.succ</span> <span class="n">n</span> <span class="bp">=</span> <span class="mi">0</span> <span class="bp">→</span> <span class="n">Empty</span> <span class="o">:=</span>
<span class="bp">λ</span> <span class="n">h</span> <span class="bp">=&gt;</span> <span class="n">ffNeqTt</span> <span class="o">(</span><span class="n">map</span> <span class="n">isZero</span> <span class="n">h</span><span class="o">)</span>
</code></pre></div>



<a name="303165688"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Annoying%20LCNF%20errors/near/303165688" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Leonardo de Moura <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Annoying.20LCNF.20errors.html#303165688">(Oct 09 2022 at 19:29)</a>:</h4>
<p>Pushed a fix for this one. <a href="https://github.com/leanprover/lean4/commit/cc09afc5e14dc032f17e3d1d40e3121832a924be">https://github.com/leanprover/lean4/commit/cc09afc5e14dc032f17e3d1d40e3121832a924be</a></p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>