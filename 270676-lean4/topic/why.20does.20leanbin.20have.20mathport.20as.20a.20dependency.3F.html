---
layout: archive
title: Zulip Chat Archive
permalink: /stream/270676-lean4/topic/why.20does.20leanbin.20have.20mathport.20as.20a.20dependency.3F.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/index.html">lean4</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/why.20does.20leanbin.20have.20mathport.20as.20a.20dependency.3F.html">why does leanbin have mathport as a dependency?</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="258311301"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/why%20does%20leanbin%20have%20mathport%20as%20a%20dependency%3F/near/258311301" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/why.20does.20leanbin.20have.20mathport.20as.20a.20dependency.3F.html#258311301">(Oct 20 2021 at 04:39)</a>:</h4>
<p><span class="user-mention" data-user-id="230999">@Daniel Selsam</span>, I am confused about why in the mathport repository, in <code>Lib4/leanbin/lakefile.lean</code>, we have <code>mathport</code> itself as a dependency. Could you explain this to me?</p>



<a name="258311329"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/why%20does%20leanbin%20have%20mathport%20as%20a%20dependency%3F/near/258311329" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/why.20does.20leanbin.20have.20mathport.20as.20a.20dependency.3F.html#258311329">(Oct 20 2021 at 04:39)</a>:</h4>
<p>That's probably a workaround until we get <code>Mathport.Prelude</code> upstreamed to mathlib4</p>



<a name="258311342"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/why%20does%20leanbin%20have%20mathport%20as%20a%20dependency%3F/near/258311342" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/why.20does.20leanbin.20have.20mathport.20as.20a.20dependency.3F.html#258311342">(Oct 20 2021 at 04:40)</a>:</h4>
<p>I second this, it confused me as well</p>



<a name="258311398"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/why%20does%20leanbin%20have%20mathport%20as%20a%20dependency%3F/near/258311398" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/why.20does.20leanbin.20have.20mathport.20as.20a.20dependency.3F.html#258311398">(Oct 20 2021 at 04:40)</a>:</h4>
<p>PS: I haven't compiled mathport in a while, I was waiting for the lake stuff to settle down</p>



<a name="258311462"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/why%20does%20leanbin%20have%20mathport%20as%20a%20dependency%3F/near/258311462" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/why.20does.20leanbin.20have.20mathport.20as.20a.20dependency.3F.html#258311462">(Oct 20 2021 at 04:41)</a>:</h4>
<p>We need <code>Mathport.Prelude</code> to be available to compile both mathport and the files produced by mathport</p>



<a name="258311538"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/why%20does%20leanbin%20have%20mathport%20as%20a%20dependency%3F/near/258311538" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/why.20does.20leanbin.20have.20mathport.20as.20a.20dependency.3F.html#258311538">(Oct 20 2021 at 04:42)</a>:</h4>
<p>I don't understand though how <code>Mathport.Prelude</code> even gets pulled in while compiling <code>.lean</code> files in <code>leanbin</code> or <code>mathbin</code>. I can't find it being imported anywhere.</p>



<a name="258311545"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/why%20does%20leanbin%20have%20mathport%20as%20a%20dependency%3F/near/258311545" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Daniel Selsam <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/why.20does.20leanbin.20have.20mathport.20as.20a.20dependency.3F.html#258311545">(Oct 20 2021 at 04:43)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110087">Scott Morrison</span> <a href="#narrow/stream/270676-lean4/topic/why.20does.20leanbin.20have.20mathport.20as.20a.20dependency.3F/near/258311301">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="230999">Daniel Selsam</span>, I am confused about why in the mathport repository, in <code>Lib4/leanbin/lakefile.lean</code>, we have <code>mathport</code> itself as a dependency. Could you explain this to me?</p>
</blockquote>
<p><span class="user-mention" data-user-id="110049">@Mario Carneiro</span> is right, it is a temporary workaround since <code>Mathport.Prelude</code> is a dependency, and it has not been upstreamed to Mathlib4 yet.</p>



<a name="258311642"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/why%20does%20leanbin%20have%20mathport%20as%20a%20dependency%3F/near/258311642" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/why.20does.20leanbin.20have.20mathport.20as.20a.20dependency.3F.html#258311642">(Oct 20 2021 at 04:44)</a>:</h4>
<p>The leanbin generated files depend on <code>Mathport.Prelude</code>, i.e. they reference it in the "import lines"</p>



<a name="258311663"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/why%20does%20leanbin%20have%20mathport%20as%20a%20dependency%3F/near/258311663" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/why.20does.20leanbin.20have.20mathport.20as.20a.20dependency.3F.html#258311663">(Oct 20 2021 at 04:44)</a>:</h4>
<p>Ah, you mean the oleans there generated in leanbin.</p>



<a name="258311675"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/why%20does%20leanbin%20have%20mathport%20as%20a%20dependency%3F/near/258311675" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Daniel Selsam <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/why.20does.20leanbin.20have.20mathport.20as.20a.20dependency.3F.html#258311675">(Oct 20 2021 at 04:45)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110087">Scott Morrison</span> <a href="#narrow/stream/270676-lean4/topic/why.20does.20leanbin.20have.20mathport.20as.20a.20dependency.3F/near/258311538">said</a>:</p>
<blockquote>
<p>I don't understand though how <code>Mathport.Prelude</code> even gets pulled in while compiling <code>.lean</code> files in <code>leanbin</code> or <code>mathbin</code>. I can't find it being imported anywhere.</p>
</blockquote>
<p>When generating the environment for binport/synport-ing a file with no imports, we start by importing <code>Mathport</code> and <code>Mathlib4</code>: <a href="https://github.com/leanprover/mathport/blob/master/Mathport.lean#L27">https://github.com/leanprover/mathport/blob/master/Mathport.lean#L27</a> Once/if <code>Mathport.Prelude</code> is moved to <code>Mathlib4</code>, then we would only need to import <code>Mathlib4</code> here.</p>



<a name="258311685"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/why%20does%20leanbin%20have%20mathport%20as%20a%20dependency%3F/near/258311685" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/why.20does.20leanbin.20have.20mathport.20as.20a.20dependency.3F.html#258311685">(Oct 20 2021 at 04:45)</a>:</h4>
<p>(Silly me was looking for <code>import Mathport.*</code> in the files generated by synport.)</p>



<a name="258311688"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/why%20does%20leanbin%20have%20mathport%20as%20a%20dependency%3F/near/258311688" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/why.20does.20leanbin.20have.20mathport.20as.20a.20dependency.3F.html#258311688">(Oct 20 2021 at 04:45)</a>:</h4>
<p>by leanbin you mean the olean files generated from the lean 3 core library, right?</p>



<a name="258311802"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/why%20does%20leanbin%20have%20mathport%20as%20a%20dependency%3F/near/258311802" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/why.20does.20leanbin.20have.20mathport.20as.20a.20dependency.3F.html#258311802">(Oct 20 2021 at 04:47)</a>:</h4>
<p>The olean files generated by mathport differ subtly from the lean files, since the oleans are made by binport and the leans by synport</p>



<a name="258311815"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/why%20does%20leanbin%20have%20mathport%20as%20a%20dependency%3F/near/258311815" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/why.20does.20leanbin.20have.20mathport.20as.20a.20dependency.3F.html#258311815">(Oct 20 2021 at 04:47)</a>:</h4>
<p>Yes, I think I get it now.</p>



<a name="258311836"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/why%20does%20leanbin%20have%20mathport%20as%20a%20dependency%3F/near/258311836" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/why.20does.20leanbin.20have.20mathport.20as.20a.20dependency.3F.html#258311836">(Oct 20 2021 at 04:47)</a>:</h4>
<p>in particular, the binport oleans always import <code>Mathport.Prelude</code> but synport files don't</p>



<a name="258311880"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/why%20does%20leanbin%20have%20mathport%20as%20a%20dependency%3F/near/258311880" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/why.20does.20leanbin.20have.20mathport.20as.20a.20dependency.3F.html#258311880">(Oct 20 2021 at 04:48)</a>:</h4>
<p>which explains your confusion in the other thread</p>



<a name="258311949"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/why%20does%20leanbin%20have%20mathport%20as%20a%20dependency%3F/near/258311949" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/why.20does.20leanbin.20have.20mathport.20as.20a.20dependency.3F.html#258311949">(Oct 20 2021 at 04:49)</a>:</h4>
<p>synport files do actually need <code>Mathport.Prelude</code> or something roughly equivalent to it to be transitively imported, but we're relying on the user to work that out</p>



<a name="258311971"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/why%20does%20leanbin%20have%20mathport%20as%20a%20dependency%3F/near/258311971" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/why.20does.20leanbin.20have.20mathport.20as.20a.20dependency.3F.html#258311971">(Oct 20 2021 at 04:49)</a>:</h4>
<p>we would rather have whatever that is be a piece of mathlib4, because mathlib4 isn't supposed to depend directly on mathport</p>



<a name="258312147"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/why%20does%20leanbin%20have%20mathport%20as%20a%20dependency%3F/near/258312147" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/why.20does.20leanbin.20have.20mathport.20as.20a.20dependency.3F.html#258312147">(Oct 20 2021 at 04:52)</a>:</h4>
<p>So --- would it be a useful thing for me to do to start moving <code>Mathport/Prelude/</code> into mathlib4?</p>



<a name="258312210"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/why%20does%20leanbin%20have%20mathport%20as%20a%20dependency%3F/near/258312210" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/why.20does.20leanbin.20have.20mathport.20as.20a.20dependency.3F.html#258312210">(Oct 20 2021 at 04:53)</a>:</h4>
<p><span class="user-mention" data-user-id="230999">@Daniel Selsam</span> What is the status of building mathport depending on mathlib4?</p>



<a name="258312225"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/why%20does%20leanbin%20have%20mathport%20as%20a%20dependency%3F/near/258312225" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/why.20does.20leanbin.20have.20mathport.20as.20a.20dependency.3F.html#258312225">(Oct 20 2021 at 04:53)</a>:</h4>
<p>I think that is a prerequisite for this move</p>



<a name="258312234"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/why%20does%20leanbin%20have%20mathport%20as%20a%20dependency%3F/near/258312234" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/why.20does.20leanbin.20have.20mathport.20as.20a.20dependency.3F.html#258312234">(Oct 20 2021 at 04:53)</a>:</h4>
<p>although I suppose you can do a copy now</p>



<a name="258312277"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/why%20does%20leanbin%20have%20mathport%20as%20a%20dependency%3F/near/258312277" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/why.20does.20leanbin.20have.20mathport.20as.20a.20dependency.3F.html#258312277">(Oct 20 2021 at 04:54)</a>:</h4>
<p><del>mathport currently builds off a recent-but-not-quite-master commit from mathlib4</del><br>
Ah, I'm still confused. :-)</p>



<a name="258312278"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/why%20does%20leanbin%20have%20mathport%20as%20a%20dependency%3F/near/258312278" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/why.20does.20leanbin.20have.20mathport.20as.20a.20dependency.3F.html#258312278">(Oct 20 2021 at 04:54)</a>:</h4>
<p><span class="user-mention" data-user-id="110049">@Mario Carneiro</span> looking at what is in <a href="https://github.com/leanprover/mathport/tree/master/Mathport/Prelude"><code>Mathport.Prelude</code></a> it seems like the <code>#align</code> command is most used to build the initial state of the <code>renameExt</code> -- shouldn't that just be an internal part of the <code>Environment</code> mathport builds?</p>



<a name="258312308"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/why%20does%20leanbin%20have%20mathport%20as%20a%20dependency%3F/near/258312308" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/why.20does.20leanbin.20have.20mathport.20as.20a.20dependency.3F.html#258312308">(Oct 20 2021 at 04:54)</a>:</h4>
<p>The <code>#align</code> command is intended to proliferate in mathlib4 for the duration of the port</p>



<a name="258312336"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/why%20does%20leanbin%20have%20mathport%20as%20a%20dependency%3F/near/258312336" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/why.20does.20leanbin.20have.20mathport.20as.20a.20dependency.3F.html#258312336">(Oct 20 2021 at 04:55)</a>:</h4>
<p>oh, that surprises me</p>



<a name="258312348"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/why%20does%20leanbin%20have%20mathport%20as%20a%20dependency%3F/near/258312348" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/why.20does.20leanbin.20have.20mathport.20as.20a.20dependency.3F.html#258312348">(Oct 20 2021 at 04:55)</a>:</h4>
<p>it is there to improve the quality of binport/synport translations when porting files high up in the dependency tree</p>



<a name="258312415"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/why%20does%20leanbin%20have%20mathport%20as%20a%20dependency%3F/near/258312415" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/why.20does.20leanbin.20have.20mathport.20as.20a.20dependency.3F.html#258312415">(Oct 20 2021 at 04:56)</a>:</h4>
<p>once mathlib is completely ported we won't need <code>#align</code> anymore, but that will be a while</p>



<a name="258312440"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/why%20does%20leanbin%20have%20mathport%20as%20a%20dependency%3F/near/258312440" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/why.20does.20leanbin.20have.20mathport.20as.20a.20dependency.3F.html#258312440">(Oct 20 2021 at 04:56)</a>:</h4>
<p>actually even after the port is done we might want to keep <code>#align</code> around until we completely drop support for lean 3 migration</p>



<a name="258312448"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/why%20does%20leanbin%20have%20mathport%20as%20a%20dependency%3F/near/258312448" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/why.20does.20leanbin.20have.20mathport.20as.20a.20dependency.3F.html#258312448">(Oct 20 2021 at 04:57)</a>:</h4>
<p>Actually, I <em>think</em> I was right above, that mathport is being built with a dependency on mathlib4. The <code>lakefile.lean</code> just says:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">Lake</span>

<span class="kn">open</span> <span class="n">Lake</span> <span class="n">DSL</span> <span class="n">System</span>

<span class="n">package</span> <span class="n">mathport</span> <span class="o">{</span>
  <span class="n">dependencies</span> <span class="o">:=</span> <span class="bp">#</span><span class="o">[{</span>
    <span class="n">name</span> <span class="o">:=</span> <span class="s2">"mathlib"</span><span class="o">,</span>
    <span class="c1">-- We point to a particular commit in mathlib4,</span>
    <span class="c1">-- as changes to tactics in mathlib4 often cause breakages here,</span>
    <span class="c1">-- particularly in `Mathport/Syntax/Translate/Tactic/Mathlib.lean`.</span>
    <span class="c1">-- We'll need to keep updating that file, and bumping the commit here.</span>
    <span class="n">src</span> <span class="o">:=</span> <span class="n">Source.git</span> <span class="s2">"https://github.com/leanprover-community/mathlib4.git"</span> <span class="s2">"b28a3d51e722d8b43367035e0eb5790b4cb6da53"</span><span class="o">,</span>
    <span class="n">dir</span> <span class="o">:=</span> <span class="n">FilePath.mk</span> <span class="s2">"."</span>
  <span class="o">}],</span>
  <span class="n">binRoot</span> <span class="o">:=</span> <span class="bp">`</span><span class="n">MathportApp</span>
  <span class="n">moreLinkArgs</span> <span class="o">:=</span>
    <span class="k">if</span> <span class="n">Platform.isWindows</span> <span class="k">then</span>
      <span class="bp">#</span><span class="o">[</span><span class="s2">"-Wl,--export-all"</span><span class="o">]</span>
    <span class="k">else</span>
      <span class="bp">#</span><span class="o">[</span><span class="s2">"-rdynamic"</span><span class="o">]</span>
<span class="o">}</span>
</code></pre></div>



<a name="258312463"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/why%20does%20leanbin%20have%20mathport%20as%20a%20dependency%3F/near/258312463" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/why.20does.20leanbin.20have.20mathport.20as.20a.20dependency.3F.html#258312463">(Oct 20 2021 at 04:57)</a>:</h4>
<p>so we're not quite depending on mathlib4 master, but it's a commit or two behind.</p>



<a name="258312464"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/why%20does%20leanbin%20have%20mathport%20as%20a%20dependency%3F/near/258312464" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/why.20does.20leanbin.20have.20mathport.20as.20a.20dependency.3F.html#258312464">(Oct 20 2021 at 04:57)</a>:</h4>
<p>since third party projects can also benefit from it</p>



<a name="258312540"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/why%20does%20leanbin%20have%20mathport%20as%20a%20dependency%3F/near/258312540" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/why.20does.20leanbin.20have.20mathport.20as.20a.20dependency.3F.html#258312540">(Oct 20 2021 at 04:58)</a>:</h4>
<p>yeah, from what I see mathport is based off mathlib4 so you should just be able to merge <code>Mathport.Prelude</code> into <code>mathlib4</code> proper, right?</p>



<a name="258312547"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/why%20does%20leanbin%20have%20mathport%20as%20a%20dependency%3F/near/258312547" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/why.20does.20leanbin.20have.20mathport.20as.20a.20dependency.3F.html#258312547">(Oct 20 2021 at 04:58)</a>:</h4>
<p><span class="user-mention" data-user-id="110087">@Scott Morrison</span> Does that lakefile actually work though? I'm still eagerly awaiting your "how to build mathport" description</p>



<a name="258312554"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/why%20does%20leanbin%20have%20mathport%20as%20a%20dependency%3F/near/258312554" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/why.20does.20leanbin.20have.20mathport.20as.20a.20dependency.3F.html#258312554">(Oct 20 2021 at 04:58)</a>:</h4>
<p>yes it does</p>



<a name="258312569"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/why%20does%20leanbin%20have%20mathport%20as%20a%20dependency%3F/near/258312569" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/why.20does.20leanbin.20have.20mathport.20as.20a.20dependency.3F.html#258312569">(Oct 20 2021 at 04:58)</a>:</h4>
<p>Yes! That lakefile actually works, and has been merged into the master branch of mathport.</p>



<a name="258312598"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/why%20does%20leanbin%20have%20mathport%20as%20a%20dependency%3F/near/258312598" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/why.20does.20leanbin.20have.20mathport.20as.20a.20dependency.3F.html#258312598">(Oct 20 2021 at 04:59)</a>:</h4>
<p>You can build mathport, and run it, from the Makefile.</p>



<a name="258312616"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/why%20does%20leanbin%20have%20mathport%20as%20a%20dependency%3F/near/258312616" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/why.20does.20leanbin.20have.20mathport.20as.20a.20dependency.3F.html#258312616">(Oct 20 2021 at 04:59)</a>:</h4>
<p>It even works inside a Docker container (I wanted to be sure there were no stray dependencies on anything outside the <code>mathport</code> folder!)</p>



<a name="258312749"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/why%20does%20leanbin%20have%20mathport%20as%20a%20dependency%3F/near/258312749" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/why.20does.20leanbin.20have.20mathport.20as.20a.20dependency.3F.html#258312749">(Oct 20 2021 at 05:00)</a>:</h4>
<p>The "how to build mathport" description is in the comments at the top of the Makefile, and is hopefully pretty thorough. The README just refers you to the Makefile for now.</p>



<a name="258312768"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/why%20does%20leanbin%20have%20mathport%20as%20a%20dependency%3F/near/258312768" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/why.20does.20leanbin.20have.20mathport.20as.20a.20dependency.3F.html#258312768">(Oct 20 2021 at 05:00)</a>:</h4>
<p>In that case, I guess a move should work, provided you change <code>import Mathport.Prelude</code> in the sources to <code>import Mathlib.Init</code> and ensure that <code>Mathlib.Init</code> contains everything we need</p>



<a name="258312787"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/why%20does%20leanbin%20have%20mathport%20as%20a%20dependency%3F/near/258312787" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/why.20does.20leanbin.20have.20mathport.20as.20a.20dependency.3F.html#258312787">(Oct 20 2021 at 05:01)</a>:</h4>
<p>What I would argue should be done though (at least eventually) is that <code>leanbin</code>, etc. should depend on <code>mathport</code> and its build step should be either poritng Lean 3 or downloading the prebuilt artifacts (if they are available)</p>



<a name="258312833"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/why%20does%20leanbin%20have%20mathport%20as%20a%20dependency%3F/near/258312833" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/why.20does.20leanbin.20have.20mathport.20as.20a.20dependency.3F.html#258312833">(Oct 20 2021 at 05:01)</a>:</h4>
<p>Actually maybe <code>Mathlib.Init</code> is too low level - <code>Mathport.Prelude</code> (purports to) include all lean 3 and mathlib tactics</p>



<a name="258312934"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/why%20does%20leanbin%20have%20mathport%20as%20a%20dependency%3F/near/258312934" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/why.20does.20leanbin.20have.20mathport.20as.20a.20dependency.3F.html#258312934">(Oct 20 2021 at 05:03)</a>:</h4>
<p>Maybe <code>Mathlib.MathportPrelude</code> is better for the near term</p>



<a name="258314904"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/why%20does%20leanbin%20have%20mathport%20as%20a%20dependency%3F/near/258314904" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/why.20does.20leanbin.20have.20mathport.20as.20a.20dependency.3F.html#258314904">(Oct 20 2021 at 05:35)</a>:</h4>
<p>Returning to the original topic of this thread, I am now very confused!</p>
<p>I just rebuilt <code>mathport</code>, having, as an experiment, deleted the dependency on <code>mathport</code> in <code>Leanbin/lakefile.lean</code>.</p>
<p>.... contrary to the explanations above it seems everything works just as well....?</p>



<a name="258314994"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/why%20does%20leanbin%20have%20mathport%20as%20a%20dependency%3F/near/258314994" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/why.20does.20leanbin.20have.20mathport.20as.20a.20dependency.3F.html#258314994">(Oct 20 2021 at 05:36)</a>:</h4>
<p>Local dependencies will be resolved the normal way by lake</p>



<a name="258315047"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/why%20does%20leanbin%20have%20mathport%20as%20a%20dependency%3F/near/258315047" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/why.20does.20leanbin.20have.20mathport.20as.20a.20dependency.3F.html#258315047">(Oct 20 2021 at 05:37)</a>:</h4>
<p>Did you try using the built program though? <code>mathport</code> needs those files at runtime too</p>



<a name="258315134"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/why%20does%20leanbin%20have%20mathport%20as%20a%20dependency%3F/near/258315134" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/why.20does.20leanbin.20have.20mathport.20as.20a.20dependency.3F.html#258315134">(Oct 20 2021 at 05:38)</a>:</h4>
<p>I mean, I did a full run of mathport on lean3 and mathlib3, and can open the synported files, etc., and see exactly the same error messages as before.</p>



<a name="258316906"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/why%20does%20leanbin%20have%20mathport%20as%20a%20dependency%3F/near/258316906" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/why.20does.20leanbin.20have.20mathport.20as.20a.20dependency.3F.html#258316906">(Oct 20 2021 at 06:04)</a>:</h4>
<p>(I've spun off a docker build with that dependency removed, to check in a clean environment. I think the point may just be that we're setting <code>LEAN_PATH</code> when we actually run <code>mathport</code>, and so it is finding those files even without <code>Leanbin/lakefile.lean</code> recording a dependency on <code>mathport</code>.)</p>



<a name="258497260"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/why%20does%20leanbin%20have%20mathport%20as%20a%20dependency%3F/near/258497260" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/why.20does.20leanbin.20have.20mathport.20as.20a.20dependency.3F.html#258497260">(Oct 21 2021 at 07:06)</a>:</h4>
<p>I finished checking that we can remove the dependency specified in the <code>Lib4/leanbin/lakefile.lean</code> to <code>mathport</code>: <a href="https://github.com/leanprover/mathport/pull/35">https://github.com/leanprover/mathport/pull/35</a>. This does build from scratch successfully, for what it's worth.</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>