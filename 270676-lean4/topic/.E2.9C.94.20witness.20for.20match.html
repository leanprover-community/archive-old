---
layout: archive
title: Zulip Chat Archive
permalink: /stream/270676-lean4/topic/.E2.9C.94.20witness.20for.20match.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/index.html">lean4</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.E2.9C.94.20witness.20for.20match.html">✔ witness for match</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="254690151"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%E2%9C%94%20witness%20for%20match/near/254690151" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Siddhartha Gadgil <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.E2.9C.94.20witness.20for.20match.html#254690151">(Sep 24 2021 at 11:42)</a>:</h4>
<p>I remember hearing in one of the lean 4 intro talks that a witness for the match equality can be obtained analogous to <code>if c: a = b then ... else ...</code>, but I cannot remember the sytnax. Could someone who remembers this offhand help.</p>
<p>For example, if <code>optNat</code> has type <code>Option Nat</code> then in</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="k">match</span> <span class="n">optNat</span> <span class="k">with</span>
<span class="bp">|</span> <span class="n">none</span> <span class="bp">=&gt;</span> <span class="bp">...</span>
<span class="bp">|</span>  <span class="n">some</span> <span class="n">j</span> <span class="bp">=&gt;</span> <span class="bp">...</span>
</code></pre></div>
<p>in the two branches I would like to have equations <code>optNat = none</code> and <code>optNat = some j</code></p>
<p>Thanks.</p>



<a name="254692286"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%E2%9C%94%20witness%20for%20match/near/254692286" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Chris B <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.E2.9C.94.20witness.20for.20match.html#254692286">(Sep 24 2021 at 12:02)</a>:</h4>
<p>It's subtle:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="k">match</span> <span class="n">h</span><span class="o">:</span><span class="n">optNat</span> <span class="k">with</span>
<span class="bp">...</span>
</code></pre></div>
<p>There are a couple of examples in this slide (the link should take you to the timestamp 44:28) <a href="https://youtu.be/UeGvhfW1v9M?t=2668">https://youtu.be/UeGvhfW1v9M?t=2668</a></p>
<div class="youtube-video message_inline_image"><a data-id="UeGvhfW1v9M" href="https://youtu.be/UeGvhfW1v9M?t=2668"><img src="https://uploads.zulipusercontent.net/73e3907a94b165629af5b952079c1032a1fec3c0/68747470733a2f2f692e7974696d672e636f6d2f76692f556547766866573176394d2f64656661756c742e6a7067"></a></div>



<a name="254693686"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%E2%9C%94%20witness%20for%20match/near/254693686" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Siddhartha Gadgil <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.E2.9C.94.20witness.20for.20match.html#254693686">(Sep 24 2021 at 12:15)</a>:</h4>
<p>Thanks.</p>



<a name="254693691"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%E2%9C%94%20witness%20for%20match/near/254693691" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Notification Bot <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.E2.9C.94.20witness.20for.20match.html#254693691">(Sep 24 2021 at 12:15)</a>:</h4>
<p><span class="user-mention silent" data-user-id="266304">Siddhartha Gadgil</span> has marked this topic as resolved.</p>



<a name="258219255"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%E2%9C%94%20witness%20for%20match/near/258219255" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Marcus Rossel <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.E2.9C.94.20witness.20for.20match.html#258219255">(Oct 19 2021 at 15:50)</a>:</h4>
<p>Note, the absence of whitespace is important here! <code>h : optNat</code> doesn't work.</p>



<a name="258229410"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%E2%9C%94%20witness%20for%20match/near/258229410" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Xubai Wang <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.E2.9C.94.20witness.20for.20match.html#258229410">(Oct 19 2021 at 16:44)</a>:</h4>
<p>Does Lean have something like pattern matching guard? </p>
<p>Or in a more specific example, how can I tell the <code>match</code> expression that <code>h : x &lt; 64</code>?</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">def</span> <span class="n">base64</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="n">UInt8</span><span class="o">)</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="n">x</span> <span class="bp">&lt;</span> <span class="mi">64</span><span class="o">)</span> <span class="o">:</span> <span class="n">Char</span> <span class="o">:=</span>
  <span class="k">match</span> <span class="n">x</span> <span class="k">with</span>
    <span class="bp">|</span> <span class="mi">0</span> <span class="bp">=&gt;</span> <span class="sc">'A'</span>
    <span class="bp">|</span> <span class="mi">1</span> <span class="bp">=&gt;</span> <span class="sc">'B'</span>
    <span class="bp">|</span> <span class="bp">...</span>
    <span class="bp">|</span> <span class="mi">63</span>  <span class="bp">=&gt;</span> <span class="sc">'/'</span>
    <span class="bp">|</span> <span class="n">y</span><span class="bp">@</span><span class="o">(</span><span class="n">h'</span><span class="o">:</span> <span class="n">y</span> <span class="bp">≥</span> <span class="mi">64</span><span class="o">)</span> <span class="bp">=&gt;</span> <span class="n">absurd</span> <span class="n">h</span> <span class="n">h'</span> <span class="c1">-- how to absurd x ≥ 64?</span>
</code></pre></div>



<a name="258297958"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%E2%9C%94%20witness%20for%20match/near/258297958" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.E2.9C.94.20witness.20for.20match.html#258297958">(Oct 20 2021 at 01:12)</a>:</h4>
<p>no, there is not, although I have wanted it a few times</p>



<a name="258298082"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%E2%9C%94%20witness%20for%20match/near/258298082" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.E2.9C.94.20witness.20for.20match.html#258298082">(Oct 20 2021 at 01:14)</a>:</h4>
<p>I would go for the rust style syntax</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">def</span> <span class="n">base64</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="n">UInt8</span><span class="o">)</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="n">x</span> <span class="bp">&lt;</span> <span class="mi">64</span><span class="o">)</span> <span class="o">:</span> <span class="n">Char</span> <span class="o">:=</span>
  <span class="k">match</span> <span class="n">x</span> <span class="k">with</span>
    <span class="bp">|</span> <span class="mi">0</span> <span class="bp">=&gt;</span> <span class="sc">'A'</span>
    <span class="bp">|</span> <span class="mi">1</span> <span class="bp">=&gt;</span> <span class="sc">'B'</span>
    <span class="bp">|</span> <span class="bp">...</span>
    <span class="bp">|</span> <span class="mi">63</span>  <span class="bp">=&gt;</span> <span class="sc">'/'</span>
    <span class="bp">|</span> <span class="n">y</span> <span class="k">if</span> <span class="n">h'</span><span class="o">:</span> <span class="n">y</span> <span class="bp">≥</span> <span class="mi">64</span> <span class="bp">=&gt;</span> <span class="n">absurd</span> <span class="n">h</span> <span class="n">h'</span>
</code></pre></div>
<p>although this probably still wouldn't work because the desugaring I am imagining wouldn't be able to prove that the wildcard branch is unreachable</p>



<a name="258298455"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%E2%9C%94%20witness%20for%20match/near/258298455" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.E2.9C.94.20witness.20for.20match.html#258298455">(Oct 20 2021 at 01:19)</a>:</h4>
<p>For this specific example there is a variation that works:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">def</span> <span class="n">base64</span> <span class="o">:</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="n">UInt8</span><span class="o">)</span> <span class="bp">→</span> <span class="n">x</span> <span class="bp">&lt;</span> <span class="mi">64</span> <span class="bp">→</span> <span class="n">Char</span>
  <span class="bp">|</span> <span class="o">⟨</span><span class="mi">0</span><span class="o">,</span> <span class="n">_</span><span class="o">⟩,</span> <span class="n">_</span> <span class="bp">=&gt;</span> <span class="sc">'A'</span>
  <span class="bp">|</span> <span class="o">⟨</span><span class="mi">1</span><span class="o">,</span> <span class="n">_</span><span class="o">⟩,</span> <span class="n">_</span> <span class="bp">=&gt;</span> <span class="sc">'B'</span>
  <span class="bp">...</span>
  <span class="bp">|</span> <span class="o">⟨</span><span class="mi">63</span><span class="o">,</span> <span class="n">_</span><span class="o">⟩,</span> <span class="n">_</span> <span class="bp">=&gt;</span> <span class="sc">'/'</span>
  <span class="bp">|</span> <span class="o">⟨</span><span class="n">y</span><span class="bp">+</span><span class="mi">64</span><span class="o">,</span> <span class="n">_</span><span class="o">⟩,</span> <span class="n">h</span> <span class="bp">=&gt;</span> <span class="o">(</span><span class="n">Nat.not_le_of_gt</span> <span class="n">h</span> <span class="o">(</span><span class="n">Nat.le_add_left</span> <span class="n">_</span> <span class="n">_</span><span class="o">))</span><span class="bp">.</span><span class="n">elim</span>
</code></pre></div>



<a name="258298691"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%E2%9C%94%20witness%20for%20match/near/258298691" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Xubai Wang <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.E2.9C.94.20witness.20for.20match.html#258298691">(Oct 20 2021 at 01:22)</a>:</h4>
<p>It seems <code>Fin</code> can get this done, but I fail to figure out where the magic comes from.</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">def</span> <span class="n">base64</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="n">UInt8</span><span class="o">)</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="n">x</span> <span class="bp">&lt;</span> <span class="mi">2</span><span class="o">)</span> <span class="o">:</span> <span class="n">Char</span> <span class="o">:=</span>
  <span class="k">let</span> <span class="n">x'</span> <span class="o">:</span> <span class="n">Fin</span> <span class="mi">2</span> <span class="o">:=</span> <span class="o">⟨</span> <span class="n">x.toNat</span> <span class="o">,</span> <span class="n">h</span> <span class="o">⟩</span>
  <span class="k">match</span> <span class="n">x'</span> <span class="k">with</span>
    <span class="bp">|</span> <span class="mi">0</span> <span class="bp">=&gt;</span> <span class="sc">'A'</span>
    <span class="bp">|</span> <span class="mi">1</span> <span class="bp">=&gt;</span> <span class="sc">'B'</span>
</code></pre></div>



<a name="258298985"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%E2%9C%94%20witness%20for%20match/near/258298985" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Xubai Wang <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.E2.9C.94.20witness.20for.20match.html#258298985">(Oct 20 2021 at 01:27)</a>:</h4>
<p><code>{ n : Nat // n &lt; 2 }</code> also working.</p>
<p>So can we just construct some subtype with constraints and then <code>match</code> can automatically figure it out?</p>



<a name="258299375"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%E2%9C%94%20witness%20for%20match/near/258299375" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.E2.9C.94.20witness.20for.20match.html#258299375">(Oct 20 2021 at 01:33)</a>:</h4>
<p>oh, indeed just dropping the extra branch in my version works</p>



<a name="258299385"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%E2%9C%94%20witness%20for%20match/near/258299385" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Xubai Wang <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.E2.9C.94.20witness.20for.20match.html#258299385">(Oct 20 2021 at 01:34)</a>:</h4>
<p>But the constraints on <code>Char</code> is not working</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">def</span> <span class="n">base64Rev</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="n">Char</span><span class="o">)</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="n">x</span> <span class="bp">=</span> <span class="sc">'A'</span> <span class="bp">∨</span> <span class="n">x</span> <span class="bp">=</span> <span class="sc">'B'</span><span class="o">)</span> <span class="o">:</span> <span class="n">UInt8</span> <span class="o">:=</span>
  <span class="k">let</span> <span class="n">x'</span> <span class="o">:</span> <span class="o">{</span> <span class="n">n</span> <span class="o">:</span> <span class="n">Char</span> <span class="bp">//</span> <span class="n">x</span> <span class="bp">=</span> <span class="sc">'A'</span> <span class="bp">∨</span> <span class="n">x</span> <span class="bp">=</span> <span class="sc">'B'</span> <span class="o">}:=</span> <span class="o">⟨</span> <span class="n">x</span> <span class="o">,</span> <span class="n">h</span> <span class="o">⟩</span>
  <span class="k">match</span> <span class="n">x'</span> <span class="k">with</span>  <span class="c1">--failed to compile pattern matching, stuck at remaining variables: [val✝:(Char)]</span>
    <span class="bp">|</span> <span class="o">⟨</span> <span class="sc">'A'</span><span class="o">,</span> <span class="n">_</span> <span class="o">⟩</span> <span class="bp">=&gt;</span> <span class="mi">0</span>
    <span class="bp">|</span> <span class="o">⟨</span> <span class="sc">'B'</span><span class="o">,</span> <span class="n">_</span> <span class="o">⟩</span> <span class="bp">=&gt;</span> <span class="mi">1</span>
</code></pre></div>
<p>Do I need to write some theorems to achieve this?</p>



<a name="258299426"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%E2%9C%94%20witness%20for%20match/near/258299426" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.E2.9C.94.20witness.20for.20match.html#258299426">(Oct 20 2021 at 01:34)</a>:</h4>
<p>but using <code>UInt8</code> literals doesn't work</p>



<a name="258299503"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%E2%9C%94%20witness%20for%20match/near/258299503" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.E2.9C.94.20witness.20for.20match.html#258299503">(Oct 20 2021 at 01:35)</a>:</h4>
<p>No, the pattern matcher doesn't have a way to take theorems</p>



<a name="258299558"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%E2%9C%94%20witness%20for%20match/near/258299558" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.E2.9C.94.20witness.20for.20match.html#258299558">(Oct 20 2021 at 01:36)</a>:</h4>
<p>the best you can do is craft things so that the wildcard case has all the information you need and prove an unreachability theorem about it</p>



<a name="258299617"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%E2%9C%94%20witness%20for%20match/near/258299617" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.E2.9C.94.20witness.20for.20match.html#258299617">(Oct 20 2021 at 01:37)</a>:</h4>
<p>That last example is harder, because matches do not build up statements saying that earlier branches don't match</p>



<a name="258299671"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%E2%9C%94%20witness%20for%20match/near/258299671" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.E2.9C.94.20witness.20for.20match.html#258299671">(Oct 20 2021 at 01:38)</a>:</h4>
<p>I would just write that using two if statements</p>



<a name="258299832"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%E2%9C%94%20witness%20for%20match/near/258299832" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.E2.9C.94.20witness.20for.20match.html#258299832">(Oct 20 2021 at 01:41)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">def</span> <span class="n">base64Rev</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="n">Char</span><span class="o">)</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="n">x</span> <span class="bp">=</span> <span class="sc">'A'</span> <span class="bp">∨</span> <span class="n">x</span> <span class="bp">=</span> <span class="sc">'B'</span><span class="o">)</span> <span class="o">:</span> <span class="n">UInt8</span> <span class="o">:=</span>
  <span class="k">if</span> <span class="n">h₁</span> <span class="o">:</span> <span class="n">x</span> <span class="bp">=</span> <span class="sc">'A'</span> <span class="k">then</span> <span class="mi">0</span> <span class="k">else</span>
  <span class="k">have</span><span class="o">:</span> <span class="n">x</span> <span class="bp">=</span> <span class="sc">'B'</span> <span class="o">:=</span> <span class="n">h.elim</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">h₂</span> <span class="bp">=&gt;</span> <span class="n">absurd</span> <span class="n">h₂</span> <span class="n">h₁</span><span class="o">)</span> <span class="n">id</span>
  <span class="mi">1</span>
</code></pre></div>
<p>Here you don't actually need the <code>have</code> though, so it could just be written <code>if x = 'A' then 0 else 1</code></p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>