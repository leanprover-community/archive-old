---
layout: archive
title: Zulip Chat Archive
permalink: /stream/270676-lean4/topic/hypothesis.20can't.20be.20used.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/index.html">lean4</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/hypothesis.20can't.20be.20used.html">hypothesis can't be used</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="280252919"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/hypothesis%20can%27t%20be%20used/near/280252919" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/hypothesis.20can't.20be.20used.html#280252919">(Apr 26 2022 at 18:35)</a>:</h4>
<p>Hi! I want to apologize upfront for yet-another-long-mwe, but this time I am not being able to use a hypothesis in my context with <code>simp</code> or <code>rw</code></p>
<p><a href="https://gist.github.com/arthurpaulino/22807b35054a638838974b73ad789315">https://gist.github.com/arthurpaulino/22807b35054a638838974b73ad789315</a></p>
<p>The issue is that <code>h'</code> can't be used on lines 394 and 395. I'm not entirely sure if I'm doing something wrong, but I <em>suspect</em> this should have worked</p>
<p>Thanks in advance for your attention <span aria-label="pray" class="emoji emoji-1f64f" role="img" title="pray">:pray:</span></p>



<a name="280253843"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/hypothesis%20can%27t%20be%20used/near/280253843" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Leonardo de Moura <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/hypothesis.20can't.20be.20used.html#280253843">(Apr 26 2022 at 18:41)</a>:</h4>
<p>The following threads should clarify what is going on<br>
<a href="#narrow/stream/270676-lean4/topic/Circumventing.20.22motive.20not.20type-correct.22">https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Circumventing.20.22motive.20not.20type-correct.22</a><br>
<a href="#narrow/stream/270676-lean4/topic/Cannot.20rewrite.20term.20being.20cased.20on">https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Cannot.20rewrite.20term.20being.20cased.20on</a></p>



<a name="280254045"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/hypothesis%20can%27t%20be%20used/near/280254045" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Leonardo de Moura <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/hypothesis.20can't.20be.20used.html#280254045">(Apr 26 2022 at 18:42)</a>:</h4>
<p>To minimize the problem, we have to change how we encode the <code>match h : ... with ...</code> notation. It will happen, but not in the near future.</p>



<a name="280254911"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/hypothesis%20can%27t%20be%20used/near/280254911" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/hypothesis.20can't.20be.20used.html#280254911">(Apr 26 2022 at 18:48)</a>:</h4>
<p>Ah, alright, thanks!!<br>
Let me read those <span aria-label="+1" class="emoji emoji-1f44d" role="img" title="+1">:+1:</span></p>



<a name="280254986"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/hypothesis%20can%27t%20be%20used/near/280254986" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Leonardo de Moura <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/hypothesis.20can't.20be.20used.html#280254986">(Apr 26 2022 at 18:48)</a>:</h4>
<p>The second one is the most relevant.</p>



<a name="280256181"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/hypothesis%20can%27t%20be%20used/near/280256181" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> James Gallicchio <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/hypothesis.20can't.20be.20used.html#280256181">(Apr 26 2022 at 18:57)</a>:</h4>
<p>Both those topics are mine, and I'm still pretty lost about how to do the right generalization -- maybe we can learn how to work around this together <span class="user-mention" data-user-id="451983">@Arthur Paulino</span> <span aria-label="joy" class="emoji emoji-1f602" role="img" title="joy">:joy:</span></p>



<a name="280257102"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/hypothesis%20can%27t%20be%20used/near/280257102" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/hypothesis.20can't.20be.20used.html#280257102">(Apr 26 2022 at 19:03)</a>:</h4>
<p>Sure, from what I understood, I have to manually provide a motive for my <code>consume</code> function (and I don't know what a motive is yet). Now that Leo has pointed out the root cause of the issue, I'll try to minimize my <a href="https://leanprover-community.github.io/mwe.html">#mwe</a> later and work on it. For now I'll just sorry that part out</p>



<a name="280257305"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/hypothesis%20can%27t%20be%20used/near/280257305" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/hypothesis.20can't.20be.20used.html#280257305">(Apr 26 2022 at 19:04)</a>:</h4>
<p><span class="user-mention" data-user-id="407274">@James Gallicchio</span> how far are you on the investigation?</p>



<a name="280257787"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/hypothesis%20can%27t%20be%20used/near/280257787" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> James Gallicchio <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/hypothesis.20can't.20be.20used.html#280257787">(Apr 26 2022 at 19:08)</a>:</h4>
<p>Oh, actually, your case is maybe simple to solve, lemme try to fill this sorry in...</p>



<a name="280259304"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/hypothesis%20can%27t%20be%20used/near/280259304" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Julian Berman <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/hypothesis.20can't.20be.20used.html#280259304">(Apr 26 2022 at 19:20)</a>:</h4>
<p><span class="user-mention silent" data-user-id="451983">Arthur Paulino</span> <a href="#narrow/stream/270676-lean4/topic/hypothesis.20can't.20be.20used/near/280257102">said</a>:</p>
<blockquote>
<p>Sure, from what I understood, I have to manually provide a motive for my <code>consume</code> function (and I don't know what a motive is yet). Now that Leo has pointed out the root cause of the issue, I'll try to minimize my <a href="https://leanprover-community.github.io/mwe.html">#mwe</a> later and work on it. For now I'll just sorry that part out</p>
</blockquote>
<p>Off-topic, but I don't know what a motive is precisely either yet, even though I know it's present in a particularly common Lean 3 error message. If you get a good handle on what one is, the glossary would benefit from having an entry for it!</p>



<a name="280260379"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/hypothesis%20can%27t%20be%20used/near/280260379" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> James Gallicchio <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/hypothesis.20can't.20be.20used.html#280260379">(Apr 26 2022 at 19:27)</a>:</h4>
<p>I think a motive is a (potentially dependent) type which a recursor is eliminating into. The "target" type of a recursion/induction. So for inductive arguments trying to prove <code>\forall n. P(n)</code>, the <code>P</code> is the motive. Or for a recursive function from <code>MyType</code> to <code>Nat</code>, the motive is <code>fun (_ : MyType) =&gt; Nat</code></p>



<a name="280260645"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/hypothesis%20can%27t%20be%20used/near/280260645" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> James Gallicchio <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/hypothesis.20can't.20be.20used.html#280260645">(Apr 26 2022 at 19:29)</a>:</h4>
<p><span class="user-mention silent" data-user-id="407274">James Gallicchio</span> <a href="#narrow/stream/270676-lean4/topic/hypothesis.20can't.20be.20used/near/280257787">said</a>:</p>
<blockquote>
<p>Oh, actually, your case is maybe simple to solve, lemme try to fill this sorry in...</p>
</blockquote>
<p>after spending 15 min on this i give up <span aria-label="joy" class="emoji emoji-1f602" role="img" title="joy">:joy:</span> but it seems quite similar to the example Mario solved <a href="#narrow/stream/270676-lean4/topic/Cannot.20rewrite.20term.20being.20cased.20on/near/274325641">here</a></p>



<a name="280266519"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/hypothesis%20can%27t%20be%20used/near/280266519" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/hypothesis.20can't.20be.20used.html#280266519">(Apr 26 2022 at 20:18)</a>:</h4>
<p>Here's a fix for this proof:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">theorem</span> <span class="n">State.retProgression</span> <span class="o">:</span>
    <span class="bp">∃</span> <span class="n">n</span><span class="o">,</span> <span class="o">(</span><span class="n">ret</span> <span class="n">v</span> <span class="n">c</span> <span class="n">k</span><span class="bp">^</span><span class="o">[</span><span class="n">n</span><span class="o">])</span><span class="bp">.</span><span class="n">isEnd</span> <span class="bp">∨</span> <span class="o">(</span><span class="n">ret</span> <span class="n">v</span> <span class="n">c</span> <span class="n">k</span><span class="bp">^</span><span class="o">[</span><span class="n">n</span><span class="o">])</span><span class="bp">.</span><span class="n">isProg</span> <span class="o">:=</span> <span class="kd">by</span>
  <span class="n">induction</span> <span class="n">k</span> <span class="n">generalizing</span> <span class="n">v</span> <span class="n">c</span> <span class="k">with</span>
  <span class="bp">|</span> <span class="n">app</span> <span class="n">e</span> <span class="n">es</span> <span class="n">k</span> <span class="n">hi</span> <span class="bp">=&gt;</span>
    <span class="n">cases</span> <span class="n">v</span> <span class="k">with</span>
    <span class="bp">|</span> <span class="n">lam</span> <span class="n">lm</span> <span class="bp">=&gt;</span>
      <span class="n">cases</span> <span class="n">lm</span> <span class="k">with</span>
      <span class="bp">|</span> <span class="n">mk</span> <span class="n">ns</span> <span class="n">h</span> <span class="n">p</span> <span class="bp">=&gt;</span>
        <span class="n">cases</span> <span class="n">h'</span> <span class="o">:</span> <span class="n">consume</span> <span class="n">p</span> <span class="n">ns</span> <span class="n">es</span> <span class="k">with</span>
        <span class="bp">|</span> <span class="n">none</span> <span class="bp">=&gt;</span>
          <span class="n">refine</span> <span class="o">⟨</span><span class="mi">1</span><span class="o">,</span> <span class="bp">?</span><span class="n">_</span><span class="o">⟩</span>
          <span class="n">simp</span> <span class="o">[</span><span class="n">stepN</span><span class="o">,</span> <span class="n">step</span><span class="o">,</span> <span class="n">h'</span><span class="o">]</span>
          <span class="k">let</span> <span class="n">isOk</span> <span class="o">:=</span> <span class="k">fun</span> <span class="o">(</span><span class="n">s</span> <span class="o">:</span> <span class="n">State</span><span class="o">)</span> <span class="bp">=&gt;</span> <span class="n">s.isEnd</span> <span class="bp">∨</span> <span class="n">s.isProg</span>
          <span class="k">suffices</span> <span class="bp">∀</span> <span class="n">o</span> <span class="n">h</span><span class="o">,</span> <span class="n">o</span> <span class="bp">=</span> <span class="n">none</span> <span class="bp">→</span>
            <span class="n">isOk</span> <span class="o">(</span><span class="n">step.match_2</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="o">(</span><span class="k">fun</span> <span class="n">x</span> <span class="n">h'</span> <span class="bp">=&gt;</span> <span class="n">State</span><span class="o">)</span> <span class="n">o</span> <span class="n">h</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span><span class="o">)</span> <span class="k">from</span> <span class="n">this</span> <span class="n">_</span> <span class="n">rfl</span> <span class="n">h'</span>
          <span class="n">intro</span> <span class="n">o</span> <span class="n">h</span> <span class="n">h2</span><span class="bp">;</span> <span class="n">subst</span> <span class="n">h2</span><span class="bp">;</span> <span class="n">simp</span>
          <span class="gr">sorry</span>
        <span class="bp">|</span> <span class="n">some</span> <span class="n">x</span> <span class="bp">=&gt;</span>
          <span class="gr">sorry</span>
    <span class="bp">|</span> <span class="n">_</span> <span class="bp">=&gt;</span> <span class="n">exact</span> <span class="o">⟨</span><span class="mi">1</span><span class="o">,</span> <span class="gr">sorry</span><span class="o">⟩</span>
  <span class="bp">|</span> <span class="n">_</span> <span class="bp">=&gt;</span> <span class="gr">sorry</span>
</code></pre></div>



<a name="280267324"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/hypothesis%20can%27t%20be%20used/near/280267324" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/hypothesis.20can't.20be.20used.html#280267324">(Apr 26 2022 at 20:25)</a>:</h4>
<p>I don't understand that <em>yet</em>, but it gives me the errors:</p>
<div class="codehilite" data-code-language="Text only"><pre><span></span><code>application type mismatch
  match ?m.40719 with
  | Except.error m =&gt; ?m.40720 m
  | Except.ok x =&gt; fun h' =&gt; State
argument
  fun x h' =&gt; State
has type
  (x : Value) → ?m.40727 x → Type : Sort (max 2 ?u.40724)
but is expected to have type
  (v : Value) → ?m.40718 (Except.ok v) : Sort (imax 1 ?u.40717)
</code></pre></div>
<p>And</p>
<div class="codehilite" data-code-language="Text only"><pre><span></span><code>function expected at
  match ?m.40719 with
  | Except.error m =&gt; ?m.40720 m
  | Except.ok v =&gt; ?m.40752 v
term has type
  ?m.40718 ?m.40719
</code></pre></div>
<p>Thanks for helping out <span aria-label="pray" class="emoji emoji-1f64f" role="img" title="pray">:pray:</span></p>



<a name="280270397"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/hypothesis%20can%27t%20be%20used/near/280270397" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/hypothesis.20can't.20be.20used.html#280270397">(Apr 26 2022 at 20:51)</a>:</h4>
<p>It looks like some of the captured variables are different, try moving the <code>(fun x h' =&gt; State)</code> argument earlier</p>



<a name="280270512"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/hypothesis%20can%27t%20be%20used/near/280270512" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/hypothesis.20can't.20be.20used.html#280270512">(Apr 26 2022 at 20:52)</a>:</h4>
<p>Here's the type of <code>State.step.match_2</code> for me:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="k">#check</span> <span class="bp">@</span><span class="n">State.step.match_2</span>
</code></pre></div>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">State.step.match_2</span> <span class="o">:</span> <span class="o">(</span><span class="n">es</span> <span class="o">:</span> <span class="n">NEList</span> <span class="n">Expression</span><span class="o">)</span> <span class="bp">→</span>
  <span class="o">(</span><span class="n">ns</span> <span class="o">:</span> <span class="n">NEList</span> <span class="n">String</span><span class="o">)</span> <span class="bp">→</span>
    <span class="o">(</span><span class="n">p</span> <span class="o">:</span> <span class="n">Program</span><span class="o">)</span> <span class="bp">→</span>
      <span class="o">(</span><span class="n">motive</span> <span class="o">:</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="n">Option</span> <span class="o">(</span><span class="n">Option</span> <span class="o">(</span><span class="n">NEList</span> <span class="n">String</span><span class="o">)</span> <span class="bp">×</span> <span class="n">Program</span><span class="o">))</span> <span class="bp">→</span> <span class="n">consume</span> <span class="n">p</span> <span class="n">ns</span> <span class="n">es</span> <span class="bp">=</span> <span class="n">x</span> <span class="bp">→</span> <span class="kt">Sort</span> <span class="n">u_1</span><span class="o">)</span> <span class="bp">→</span>
        <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="n">Option</span> <span class="o">(</span><span class="n">Option</span> <span class="o">(</span><span class="n">NEList</span> <span class="n">String</span><span class="o">)</span> <span class="bp">×</span> <span class="n">Program</span><span class="o">))</span> <span class="bp">→</span>
          <span class="o">(</span><span class="n">h'</span> <span class="o">:</span> <span class="n">consume</span> <span class="n">p</span> <span class="n">ns</span> <span class="n">es</span> <span class="bp">=</span> <span class="n">x</span><span class="o">)</span> <span class="bp">→</span>
            <span class="o">((</span><span class="n">l</span> <span class="o">:</span> <span class="n">NEList</span> <span class="n">String</span><span class="o">)</span> <span class="bp">→</span>
                <span class="o">(</span><span class="n">p_1</span> <span class="o">:</span> <span class="n">Program</span><span class="o">)</span> <span class="bp">→</span> <span class="o">(</span><span class="n">h'</span> <span class="o">:</span> <span class="n">consume</span> <span class="n">p</span> <span class="n">ns</span> <span class="n">es</span> <span class="bp">=</span> <span class="n">some</span> <span class="o">(</span><span class="n">some</span> <span class="n">l</span><span class="o">,</span> <span class="n">p_1</span><span class="o">))</span> <span class="bp">→</span> <span class="n">motive</span> <span class="o">(</span><span class="n">some</span> <span class="o">(</span><span class="n">some</span> <span class="n">l</span><span class="o">,</span> <span class="n">p_1</span><span class="o">))</span> <span class="n">h'</span><span class="o">)</span> <span class="bp">→</span>
              <span class="o">((</span><span class="n">p_1</span> <span class="o">:</span> <span class="n">Program</span><span class="o">)</span> <span class="bp">→</span> <span class="o">(</span><span class="n">h'</span> <span class="o">:</span> <span class="n">consume</span> <span class="n">p</span> <span class="n">ns</span> <span class="n">es</span> <span class="bp">=</span> <span class="n">some</span> <span class="o">(</span><span class="n">none</span><span class="o">,</span> <span class="n">p_1</span><span class="o">))</span> <span class="bp">→</span> <span class="n">motive</span> <span class="o">(</span><span class="n">some</span> <span class="o">(</span><span class="n">none</span><span class="o">,</span> <span class="n">p_1</span><span class="o">))</span> <span class="n">h'</span><span class="o">)</span> <span class="bp">→</span>
                <span class="o">((</span><span class="n">h'</span> <span class="o">:</span> <span class="n">consume</span> <span class="n">p</span> <span class="n">ns</span> <span class="n">es</span> <span class="bp">=</span> <span class="n">none</span><span class="o">)</span> <span class="bp">→</span> <span class="n">motive</span> <span class="n">none</span> <span class="n">h'</span><span class="o">)</span> <span class="bp">→</span> <span class="n">motive</span> <span class="n">x</span> <span class="n">h'</span>
</code></pre></div>



<a name="280270764"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/hypothesis%20can%27t%20be%20used/near/280270764" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/hypothesis.20can't.20be.20used.html#280270764">(Apr 26 2022 at 20:54)</a>:</h4>
<p>I obtained the term in the <code>suffices</code> by setting <code>set_option pp.match false</code> and then locating the <code>(fun x h' =&gt; State)</code> (this is <code>motive</code>), <code>(consume p ns es)</code> (which is <code>o</code>) and <code>(_ : consume p ns es = consume p ns es)</code> (which is <code>h</code>) arguments in the match expression in the goal</p>



<a name="280270807"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/hypothesis%20can%27t%20be%20used/near/280270807" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/hypothesis.20can't.20be.20used.html#280270807">(Apr 26 2022 at 20:54)</a>:</h4>
<p>I expect there is some lean version mismatch that has caused things to work out differently for you</p>



<a name="280270895"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/hypothesis%20can%27t%20be%20used/near/280270895" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/hypothesis.20can't.20be.20used.html#280270895">(Apr 26 2022 at 20:55)</a>:</h4>
<p>I'm running <code>Lean (version 4.0.0-nightly-2022-04-16, commit 726b735c6df7, Release)</code></p>



<a name="280273145"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/hypothesis%20can%27t%20be%20used/near/280273145" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/hypothesis.20can't.20be.20used.html#280273145">(Apr 26 2022 at 21:14)</a>:</h4>
<p>I'm using today's nightly. Will check that soon!</p>



<a name="280275069"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/hypothesis%20can%27t%20be%20used/near/280275069" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/hypothesis.20can't.20be.20used.html#280275069">(Apr 26 2022 at 21:31)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="k">#check</span> <span class="bp">@</span><span class="n">State.step.match_2</span>
<span class="c1">-- State.step.match_2 : (motive : Except String Value → Sort u_1) →</span>
<span class="c1">--   (x : Except String Value) → ((m : String) → motive (Except.error m)) → ((v : Value) → motive (Except.ok v)) → motive x</span>
</code></pre></div>



<a name="280907318"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/hypothesis%20can%27t%20be%20used/near/280907318" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> James Gallicchio <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/hypothesis.20can't.20be.20used.html#280907318">(May 02 2022 at 17:39)</a>:</h4>
<p>Once again consulting the Mario oracle to find the correct chant of generalization to proceed in a proof:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">constant</span> <span class="n">UninitPointed.</span><span class="o">{</span><span class="n">u</span><span class="o">}</span> <span class="o">(</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">)</span> <span class="o">:</span> <span class="n">NonemptyType.</span><span class="o">{</span><span class="n">u</span><span class="o">}</span>

<span class="kd">def</span> <span class="n">Uninit.</span><span class="o">{</span><span class="n">u</span><span class="o">}</span> <span class="o">(</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">)</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span> <span class="o">:=</span> <span class="o">(</span><span class="n">UninitPointed</span> <span class="n">α</span><span class="o">)</span><span class="bp">.</span><span class="n">type</span>

<span class="kn">namespace</span> <span class="n">Uninit</span>

<span class="kd">instance</span> <span class="o">:</span> <span class="n">Nonempty</span> <span class="o">(</span><span class="n">Uninit</span> <span class="n">α</span><span class="o">)</span> <span class="o">:=</span> <span class="o">(</span><span class="n">UninitPointed</span> <span class="n">α</span><span class="o">)</span><span class="bp">.</span><span class="n">property</span>

<span class="n">unsafe</span> <span class="kd">def</span> <span class="n">uninitUnsafe</span> <span class="o">{</span><span class="n">α</span><span class="o">}</span> <span class="o">:</span> <span class="n">Uninit</span> <span class="n">α</span> <span class="o">:=</span> <span class="n">unsafeCast</span> <span class="o">()</span>
<span class="kd">@[implementedBy uninitUnsafe]</span>
<span class="kd">constant</span> <span class="n">uninit</span> <span class="o">{</span><span class="n">α</span><span class="o">}</span> <span class="o">:</span> <span class="n">Uninit</span> <span class="n">α</span>

<span class="n">unsafe</span> <span class="kd">def</span> <span class="n">initUnsafe</span> <span class="o">(</span><span class="n">a</span> <span class="o">:</span> <span class="n">α</span><span class="o">)</span> <span class="o">:</span> <span class="n">Uninit</span> <span class="n">α</span> <span class="o">:=</span> <span class="n">unsafeCast</span> <span class="n">a</span>
<span class="kd">@[implementedBy initUnsafe]</span>
<span class="kd">constant</span> <span class="n">init</span> <span class="o">(</span><span class="n">a</span> <span class="o">:</span> <span class="n">α</span><span class="o">)</span> <span class="o">:</span> <span class="n">Uninit</span> <span class="n">α</span>

<span class="kd">instance</span> <span class="o">:</span> <span class="n">Inhabited</span> <span class="o">(</span><span class="n">Uninit</span> <span class="n">α</span><span class="o">)</span> <span class="o">:=</span> <span class="o">⟨</span><span class="n">uninit</span><span class="o">⟩</span>

<span class="kd">noncomputable</span> <span class="kd">constant</span> <span class="n">getValue</span><span class="bp">?</span> <span class="o">:</span> <span class="n">Uninit</span> <span class="n">α</span> <span class="bp">→</span> <span class="n">Option</span> <span class="n">α</span>

<span class="kd">def</span> <span class="n">ofOption</span> <span class="o">:</span> <span class="n">Option</span> <span class="n">α</span> <span class="bp">→</span> <span class="n">Uninit</span> <span class="n">α</span>
<span class="bp">|</span> <span class="n">none</span> <span class="bp">=&gt;</span> <span class="n">uninit</span>
<span class="bp">|</span> <span class="n">some</span> <span class="n">a</span> <span class="bp">=&gt;</span> <span class="n">init</span> <span class="n">a</span>

<span class="kd">axiom</span> <span class="n">getValue_ofOption</span> <span class="o">:</span> <span class="bp">∀</span> <span class="o">{</span><span class="n">α</span><span class="o">}</span> <span class="o">(</span><span class="n">a</span> <span class="o">:</span> <span class="n">Option</span> <span class="n">α</span><span class="o">),</span> <span class="n">getValue</span><span class="bp">?</span> <span class="o">(</span><span class="n">ofOption</span> <span class="n">a</span><span class="o">)</span> <span class="bp">=</span> <span class="n">a</span>
<span class="kd">axiom</span> <span class="n">ofOption_getValue</span> <span class="o">:</span> <span class="bp">∀</span> <span class="o">{</span><span class="n">α</span><span class="o">}</span> <span class="o">(</span><span class="n">a</span> <span class="o">:</span> <span class="n">Uninit</span> <span class="n">α</span><span class="o">),</span> <span class="n">ofOption</span> <span class="o">(</span><span class="n">getValue</span><span class="bp">?</span> <span class="n">a</span><span class="o">)</span> <span class="bp">=</span> <span class="n">a</span>

<span class="kd">noncomputable</span> <span class="kd">def</span> <span class="n">isInit</span> <span class="o">(</span><span class="n">a</span> <span class="o">:</span> <span class="n">Uninit</span> <span class="n">α</span><span class="o">)</span> <span class="o">:</span> <span class="n">Bool</span> <span class="o">:=</span> <span class="n">Option.isSome</span> <span class="o">(</span><span class="n">getValue</span><span class="bp">?</span> <span class="n">a</span><span class="o">)</span>

<span class="n">unsafe</span> <span class="kd">def</span> <span class="n">getValueUnsafe</span> <span class="o">(</span><span class="n">a</span> <span class="o">:</span> <span class="n">Uninit</span> <span class="n">α</span><span class="o">)</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="o">(</span><span class="n">getValue</span><span class="bp">?</span> <span class="n">a</span><span class="o">)</span><span class="bp">.</span><span class="n">isSome</span><span class="o">)</span> <span class="o">:</span> <span class="n">α</span> <span class="o">:=</span> <span class="n">unsafeCast</span> <span class="n">a</span>

<span class="kd">@[implementedBy getValueUnsafe]</span>
<span class="kd">def</span> <span class="n">getValue</span> <span class="o">(</span><span class="n">a</span> <span class="o">:</span> <span class="n">Uninit</span> <span class="n">α</span><span class="o">)</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="o">(</span><span class="n">getValue</span><span class="bp">?</span> <span class="n">a</span><span class="o">)</span><span class="bp">.</span><span class="n">isSome</span><span class="o">)</span> <span class="o">:</span> <span class="n">α</span> <span class="o">:=</span>
  <span class="k">match</span> <span class="n">getValue</span><span class="bp">?</span> <span class="n">a</span><span class="o">,</span> <span class="n">h</span> <span class="k">with</span>
  <span class="bp">|</span> <span class="n">some</span> <span class="n">a</span><span class="o">,</span> <span class="n">h</span> <span class="bp">=&gt;</span> <span class="n">a</span>
  <span class="bp">|</span> <span class="n">none</span><span class="o">,</span> <span class="n">h</span> <span class="bp">=&gt;</span> <span class="kd">by</span> <span class="n">contradiction</span>

<span class="kd">set_option</span> <span class="n">pp.match</span> <span class="n">false</span>

<span class="kd">@[simp]</span>
<span class="kd">theorem</span> <span class="n">getValue_init</span> <span class="o">(</span><span class="n">h</span><span class="o">)</span> <span class="o">:</span> <span class="o">(</span><span class="n">init</span> <span class="n">a</span><span class="o">)</span><span class="bp">.</span><span class="n">getValue</span> <span class="n">h</span> <span class="bp">=</span> <span class="n">a</span> <span class="o">:=</span> <span class="kd">by</span>
  <span class="n">unfold</span> <span class="n">getValue</span>
  <span class="n">unfold</span> <span class="n">getValue.match_1</span>
  <span class="gr">sorry</span>
</code></pre></div>



<a name="280907425"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/hypothesis%20can%27t%20be%20used/near/280907425" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> James Gallicchio <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/hypothesis.20can't.20be.20used.html#280907425">(May 02 2022 at 17:40)</a>:</h4>
<p>I will attempt a few more random generalizations in the meantime</p>



<a name="280910262"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/hypothesis%20can%27t%20be%20used/near/280910262" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Leonardo de Moura <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/hypothesis.20can't.20be.20used.html#280910262">(May 02 2022 at 18:01)</a>:</h4>
<p>Here is an option using the <code>generalize</code> tactic</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">@[simp]</span>
<span class="kd">theorem</span> <span class="n">getValue_init</span> <span class="o">(</span><span class="n">h</span><span class="o">)</span> <span class="o">:</span> <span class="o">(</span><span class="n">init</span> <span class="n">a</span><span class="o">)</span><span class="bp">.</span><span class="n">getValue</span> <span class="n">h</span> <span class="bp">=</span> <span class="n">a</span> <span class="o">:=</span> <span class="kd">by</span>
  <span class="n">unfold</span> <span class="n">getValue</span>
  <span class="n">generalize</span> <span class="n">h'</span> <span class="o">:</span> <span class="n">getValue</span><span class="bp">?</span> <span class="o">(</span><span class="n">init</span> <span class="n">a</span><span class="o">)</span> <span class="bp">=</span> <span class="n">x</span><span class="o">,</span> <span class="n">h</span> <span class="bp">=</span> <span class="n">hx</span>
  <span class="n">split</span>
  <span class="n">next</span> <span class="n">a</span> <span class="n">h</span> <span class="bp">=&gt;</span> <span class="gr">sorry</span>
  <span class="n">next</span> <span class="bp">=&gt;</span> <span class="n">contradiction</span>
</code></pre></div>



<a name="280911172"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/hypothesis%20can%27t%20be%20used/near/280911172" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Leonardo de Moura <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/hypothesis.20can't.20be.20used.html#280911172">(May 02 2022 at 18:07)</a>:</h4>
<p>The notation <code>h = hx</code> is a bit cryptic, but it is there because the type of <code>h</code> depends on <code>getValue? (init a)</code>. We should add a better notation for this.</p>



<a name="280911580"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/hypothesis%20can%27t%20be%20used/near/280911580" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Leonardo de Moura <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/hypothesis.20can't.20be.20used.html#280911580">(May 02 2022 at 18:11)</a>:</h4>
<p>We can also use <code>h = h</code>, but it looks even more cryptic. BTW, the use of <code>=</code> in the <code>generalize</code> tactic is also a bit misleading. Any suggestions on how to improve this notation?</p>



<a name="280911622"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/hypothesis%20can%27t%20be%20used/near/280911622" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/hypothesis.20can't.20be.20used.html#280911622">(May 02 2022 at 18:11)</a>:</h4>
<p>Aside: Any chance <code>generalize</code> can support <code>at</code>? Mathlib has a <code>generalize_hyp</code> command which does not do anything except this relatively straightforward generalization</p>



<a name="280911721"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/hypothesis%20can%27t%20be%20used/near/280911721" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Leonardo de Moura <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/hypothesis.20can't.20be.20used.html#280911721">(May 02 2022 at 18:12)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110049">Mario Carneiro</span> <a href="#narrow/stream/270676-lean4/topic/hypothesis.20can't.20be.20used/near/280911622">said</a>:</p>
<blockquote>
<p>Aside: Any chance <code>generalize</code> can support <code>at</code>? Mathlib has a <code>generalize_hyp</code> command which does not do anything except this relatively straightforward generalization</p>
</blockquote>
<p>Yes, we can add support for <code>at</code>.</p>



<a name="280911729"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/hypothesis%20can%27t%20be%20used/near/280911729" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/hypothesis.20can't.20be.20used.html#280911729">(May 02 2022 at 18:12)</a>:</h4>
<p>Is that <code>h = hx</code> syntax new in lean 4 <code>generalize</code>? I don't recognize it from lean 3</p>



<a name="280911831"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/hypothesis%20can%27t%20be%20used/near/280911831" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Leonardo de Moura <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/hypothesis.20can't.20be.20used.html#280911831">(May 02 2022 at 18:13)</a>:</h4>
<p><code>generalize</code> in Lean 4 can take a telescope and simultaneously generalize many terms.</p>



<a name="280911915"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/hypothesis%20can%27t%20be%20used/near/280911915" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/hypothesis.20can't.20be.20used.html#280911915">(May 02 2022 at 18:14)</a>:</h4>
<p>how about <code>hx := h</code> instead of <code>h = hx</code>?</p>



<a name="280911967"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/hypothesis%20can%27t%20be%20used/near/280911967" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/hypothesis.20can't.20be.20used.html#280911967">(May 02 2022 at 18:15)</a>:</h4>
<p>the <code>=</code> is backwards but I think we have precedent for using <code>hx := &lt;- h</code> at this point if we want it the other way around</p>



<a name="280912039"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/hypothesis%20can%27t%20be%20used/near/280912039" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/hypothesis.20can't.20be.20used.html#280912039">(May 02 2022 at 18:15)</a>:</h4>
<p>ah crap, maybe that doesn't work as well in lean 4 since that's actually an expression</p>



<a name="280912098"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/hypothesis%20can%27t%20be%20used/near/280912098" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/hypothesis.20can't.20be.20used.html#280912098">(May 02 2022 at 18:16)</a>:</h4>
<p>I suppose you can parse the arrow anyway, <code>rw</code> does that too</p>



<a name="280912141"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/hypothesis%20can%27t%20be%20used/near/280912141" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Leonardo de Moura <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/hypothesis.20can't.20be.20used.html#280912141">(May 02 2022 at 18:16)</a>:</h4>
<p>What about the fact that the types of <code>h</code> and <code>hx</code> are different?</p>



<a name="280912214"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/hypothesis%20can%27t%20be%20used/near/280912214" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/hypothesis.20can't.20be.20used.html#280912214">(May 02 2022 at 18:17)</a>:</h4>
<p>oh I see... <code>(x, h) := (e1, e2)</code>? Possibly without parens too</p>



<a name="280912245"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/hypothesis%20can%27t%20be%20used/near/280912245" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/hypothesis.20can't.20be.20used.html#280912245">(May 02 2022 at 18:17)</a>:</h4>
<p>it might be harder to read for a long telescope though</p>



<a name="280912357"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/hypothesis%20can%27t%20be%20used/near/280912357" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/hypothesis.20can't.20be.20used.html#280912357">(May 02 2022 at 18:18)</a>:</h4>
<p>maybe it's just better to live with the slightly mismatched types</p>



<a name="280912427"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/hypothesis%20can%27t%20be%20used/near/280912427" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Leonardo de Moura <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/hypothesis.20can't.20be.20used.html#280912427">(May 02 2022 at 18:19)</a>:</h4>
<p>Thanks for the feedback. The suggestions are already better than the current notation.</p>



<a name="280912480"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/hypothesis%20can%27t%20be%20used/near/280912480" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/hypothesis.20can't.20be.20used.html#280912480">(May 02 2022 at 18:19)</a>:</h4>
<p><span aria-label="+1" class="emoji emoji-1f44d" role="img" title="+1">:+1:</span></p>



<a name="280912563"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/hypothesis%20can%27t%20be%20used/near/280912563" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Leonardo de Moura <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/hypothesis.20can't.20be.20used.html#280912563">(May 02 2022 at 18:19)</a>:</h4>
<p>If you have more ideas, please keep posting them here.</p>



<a name="280919172"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/hypothesis%20can%27t%20be%20used/near/280919172" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kyle Miller <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/hypothesis.20can't.20be.20used.html#280919172">(May 02 2022 at 19:09)</a>:</h4>
<p>Another idea: have the syntax look more like binders rather than patterns, like <code>generalize (h : a = b) (e = f) (h' : c = d)</code></p>



<a name="280947362"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/hypothesis%20can%27t%20be%20used/near/280947362" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Leonardo de Moura <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/hypothesis.20can't.20be.20used.html#280947362">(May 02 2022 at 23:16)</a>:</h4>
<p><span class="user-mention" data-user-id="306601">@Kyle Miller</span> Thanks for sharing. I have a question.  Some of the equalities are actually heterogeneous. Should we enforce it in the new notation? That is, sign an error if one uses <code>=</code>, but the equality is heterogeneous.</p>



<a name="280952348"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/hypothesis%20can%27t%20be%20used/near/280952348" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> James Gallicchio <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/hypothesis.20can't.20be.20used.html#280952348">(May 03 2022 at 00:31)</a>:</h4>
<p>Personally I'd prefer some sort of English which makes it read better, something like<br>
<code>generalize h' : getValue? (init a), h as x, hx</code><br>
It would feel a bit more similar to the other tactics where you list new identifiers at the end</p>



<a name="280952428"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/hypothesis%20can%27t%20be%20used/near/280952428" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> James Gallicchio <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/hypothesis.20can't.20be.20used.html#280952428">(May 03 2022 at 00:32)</a>:</h4>
<p>But thank you! The generalize tactic actually seems perfect for circumventing this issue</p>



<a name="280952826"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/hypothesis%20can%27t%20be%20used/near/280952826" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> James Gallicchio <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/hypothesis.20can't.20be.20used.html#280952826">(May 03 2022 at 00:38)</a>:</h4>
<p>Wait, can you generalize multiple terms at once? If not, then I feel like the most natural would be<br>
<code>generalize h' : getValue? (init a) as x in h1, h2, ...</code><br>
where the hypotheses <code>h1, ...</code> keep their names but have new types</p>



<a name="280953008"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/hypothesis%20can%27t%20be%20used/near/280953008" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/hypothesis.20can't.20be.20used.html#280953008">(May 03 2022 at 00:41)</a>:</h4>
<p>Was it where Mario was getting at with the <code>at</code> suggestion?</p>



<a name="280953427"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/hypothesis%20can%27t%20be%20used/near/280953427" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> James Gallicchio <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/hypothesis.20can't.20be.20used.html#280953427">(May 03 2022 at 00:49)</a>:</h4>
<p>ooh potentially, I don't know what generalize_hyp does</p>



<a name="280953832"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/hypothesis%20can%27t%20be%20used/near/280953832" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/hypothesis.20can't.20be.20used.html#280953832">(May 03 2022 at 00:55)</a>:</h4>
<p><code>_hyp</code> in Lean 3 meta code base usually means that you're doing something with a variable in the context instead of with the target. The <code>at</code> word is a good indicator that one can do <code>at h1 h2 |-</code> or <code>at *</code> (it's common syntax in mathlib)</p>



<a name="280954038"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/hypothesis%20can%27t%20be%20used/near/280954038" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/hypothesis.20can't.20be.20used.html#280954038">(May 03 2022 at 00:58)</a>:</h4>
<p>Using <code>as</code> makes a lot of sense when you read it out loud. But I don't know other tactics that make use of "as" in their syntax (is this a concern?)</p>



<a name="280954220"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/hypothesis%20can%27t%20be%20used/near/280954220" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> James Gallicchio <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/hypothesis.20can't.20be.20used.html#280954220">(May 03 2022 at 01:00)</a>:</h4>
<p>It's similar to ML binding patterns <code>x as p</code>, where <code>x</code> is bound to whatever matches <code>p</code></p>



<a name="280969074"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/hypothesis%20can%27t%20be%20used/near/280969074" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/hypothesis.20can't.20be.20used.html#280969074">(May 03 2022 at 05:28)</a>:</h4>
<p><span class="user-mention silent" data-user-id="451983">Arthur Paulino</span> <a href="#narrow/stream/270676-lean4/topic/hypothesis.20can't.20be.20used/near/280954038">said</a>:</p>
<blockquote>
<p>Using <code>as</code> makes a lot of sense when you read it out loud. But I don't know other tactics that make use of "as" in their syntax (is this a concern?)</p>
</blockquote>
<p>It is a concern, because these sorts of filler words have to be keywords for the most part, which precludes their use in identifiers. <code>as</code> comes up quite a bit in theorems about lists where the lists are called <code>as</code> and <code>bs</code></p>



<a name="280969096"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/hypothesis%20can%27t%20be%20used/near/280969096" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/hypothesis.20can't.20be.20used.html#280969096">(May 03 2022 at 05:29)</a>:</h4>
<p>as a result it's generally best to stick to a somewhat restrictive grammar of filler words in tactics like <code>with</code>, <code>using</code>, <code>from</code>, or more unusual words like <code>generalizing</code></p>



<a name="280969195"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/hypothesis%20can%27t%20be%20used/near/280969195" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/hypothesis.20can't.20be.20used.html#280969195">(May 03 2022 at 05:30)</a>:</h4>
<p><code>set</code> is precedent for this kind of input, it uses <code>set x : t := val with h</code> where <code>h</code> receives the equation <code>x = val</code></p>



<a name="280969285"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/hypothesis%20can%27t%20be%20used/near/280969285" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/hypothesis.20can't.20be.20used.html#280969285">(May 03 2022 at 05:32)</a>:</h4>
<p>and you could easily have a comma or indent-newline sequence of such things for <code>generalize</code></p>



<a name="280969403"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/hypothesis%20can%27t%20be%20used/near/280969403" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/hypothesis.20can't.20be.20used.html#280969403">(May 03 2022 at 05:35)</a>:</h4>
<p>I think you could also add a type ascription on <code>h</code> if you wanted to change the type of it to something defeq or get an error if it's a heq and you didn't expect that, e.g. <code>generalize x := val with (h : x = val)</code></p>



<a name="280969431"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/hypothesis%20can%27t%20be%20used/near/280969431" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/hypothesis.20can't.20be.20used.html#280969431">(May 03 2022 at 05:35)</a>:</h4>
<p>I would probably leave the ascription off most of the time but it works syntactically</p>



<a name="281098728"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/hypothesis%20can%27t%20be%20used/near/281098728" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Leonardo de Moura <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/hypothesis.20can't.20be.20used.html#281098728">(May 04 2022 at 00:53)</a>:</h4>
<p>I just pushed a commit that improves the <code>split</code> tactic. It uses a custom generalization procedure, and can now handle  <code>match</code> expressions such as <code>match h : Q.F.force with ...</code>. It is not heavily tested yet, but can already handle examples by <span class="user-mention" data-user-id="407274">@James Gallicchio</span> and <span class="user-mention" data-user-id="451983">@Arthur Paulino</span> that used to fail.<br>
<a href="https://github.com/leanprover/lean4/blob/94b5a9b460ce0a258b77503198f5319f8739e84a/tests/lean/run/james1.lean">https://github.com/leanprover/lean4/blob/94b5a9b460ce0a258b77503198f5319f8739e84a/tests/lean/run/james1.lean</a><br>
<a href="https://github.com/leanprover/lean4/blob/94b5a9b460ce0a258b77503198f5319f8739e84a/tests/lean/run/arthur2.lean">https://github.com/leanprover/lean4/blob/94b5a9b460ce0a258b77503198f5319f8739e84a/tests/lean/run/arthur2.lean</a><br>
From the first test:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">def</span> <span class="n">deq</span> <span class="o">(</span><span class="n">Q</span> <span class="o">:</span> <span class="n">LazyBatchQueue</span> <span class="n">τ</span><span class="o">)</span> <span class="o">:</span> <span class="n">Option</span> <span class="o">(</span><span class="n">τ</span> <span class="bp">×</span> <span class="n">LazyBatchQueue</span> <span class="n">τ</span><span class="o">)</span> <span class="o">:=</span>
  <span class="k">match</span> <span class="n">h</span> <span class="o">:</span> <span class="n">Q.F.force</span> <span class="k">with</span>
  <span class="bp">|</span> <span class="n">some</span> <span class="o">(</span><span class="n">x</span><span class="o">,</span> <span class="n">F'</span><span class="o">)</span> <span class="bp">=&gt;</span>
    <span class="n">some</span> <span class="o">(</span><span class="n">x</span><span class="o">,</span>
      <span class="o">⟨</span><span class="n">F'</span><span class="o">,</span> <span class="n">Q.F_len</span> <span class="bp">-</span> <span class="mi">1</span><span class="o">,</span>
        <span class="kd">by</span> <span class="n">simp</span> <span class="o">[</span><span class="n">LazyList.F_force_some_len_minus_one</span> <span class="n">h</span><span class="o">,</span> <span class="n">Q.h_lens</span><span class="o">]⟩)</span>
  <span class="bp">|</span> <span class="n">none</span> <span class="bp">=&gt;</span> <span class="n">none</span>

<span class="kd">theorem</span> <span class="n">deq_correct</span> <span class="o">(</span><span class="n">Q</span> <span class="o">:</span> <span class="n">LazyBatchQueue</span> <span class="n">τ</span><span class="o">)</span> <span class="o">:</span> <span class="n">deq</span> <span class="n">Q</span> <span class="bp">=</span> <span class="n">none</span> <span class="bp">↔</span> <span class="n">Q.F.force</span> <span class="bp">=</span> <span class="n">none</span> <span class="o">:=</span> <span class="kd">by</span>
  <span class="n">simp</span> <span class="o">[</span><span class="n">deq</span><span class="o">]</span>
  <span class="n">split</span> <span class="bp">&lt;;&gt;</span> <span class="n">simp</span> <span class="o">[</span><span class="bp">*</span><span class="o">]</span>
</code></pre></div>



<a name="281098969"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/hypothesis%20can%27t%20be%20used/near/281098969" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/hypothesis.20can't.20be.20used.html#281098969">(May 04 2022 at 00:57)</a>:</h4>
<p>Thanks!!!</p>



<a name="281230597"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/hypothesis%20can%27t%20be%20used/near/281230597" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Leonardo de Moura <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/hypothesis.20can't.20be.20used.html#281230597">(May 04 2022 at 22:45)</a>:</h4>
<p>BTW, the new generalizer for the split tactic can also handle the <code>geValue</code> example above:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">def</span> <span class="n">getValue</span> <span class="o">(</span><span class="n">a</span> <span class="o">:</span> <span class="n">Uninit</span> <span class="n">α</span><span class="o">)</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="o">(</span><span class="n">getValue</span><span class="bp">?</span> <span class="n">a</span><span class="o">)</span><span class="bp">.</span><span class="n">isSome</span><span class="o">)</span> <span class="o">:</span> <span class="n">α</span> <span class="o">:=</span>
  <span class="k">match</span> <span class="n">getValue</span><span class="bp">?</span> <span class="n">a</span><span class="o">,</span> <span class="n">h</span> <span class="k">with</span>
  <span class="bp">|</span> <span class="n">some</span> <span class="n">a</span><span class="o">,</span> <span class="n">h</span> <span class="bp">=&gt;</span> <span class="n">a</span>
  <span class="bp">|</span> <span class="n">none</span><span class="o">,</span> <span class="n">h</span> <span class="bp">=&gt;</span> <span class="kd">by</span> <span class="n">contradiction</span>

<span class="kd">@[simp]</span>
<span class="kd">theorem</span> <span class="n">getValue_init</span> <span class="o">(</span><span class="n">h</span><span class="o">)</span> <span class="o">:</span> <span class="o">(</span><span class="n">init</span> <span class="n">a</span><span class="o">)</span><span class="bp">.</span><span class="n">getValue</span> <span class="n">h</span> <span class="bp">=</span> <span class="n">a</span> <span class="o">:=</span> <span class="kd">by</span>
  <span class="n">unfold</span> <span class="n">getValue</span>
  <span class="n">split</span>
  <span class="n">next</span> <span class="n">a'</span> <span class="n">h'</span> <span class="n">heq₁</span> <span class="n">heq₂</span> <span class="bp">=&gt;</span>
   <span class="c">/-</span><span class="cm"></span>
<span class="cm">      a' : α</span>
<span class="cm">      h' : Option.isSome (some a') = true</span>
<span class="cm">      heq₁ : getValue? (init a) = some a'</span>
<span class="cm">      heq₂ : HEq h h'</span>
<span class="cm">      ⊢ a' = a</span>
<span class="cm">   -/</span>
   <span class="gr">sorry</span>
  <span class="n">next</span> <span class="bp">=&gt;</span> <span class="n">contradiction</span>
</code></pre></div>



<a name="281276297"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/hypothesis%20can%27t%20be%20used/near/281276297" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> James Gallicchio <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/hypothesis.20can't.20be.20used.html#281276297">(May 05 2022 at 09:50)</a>:</h4>
<p>This is already helping me make lots of progress, thank you so much!</p>



<a name="282345385"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/hypothesis%20can%27t%20be%20used/near/282345385" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Evgeniy Kuznetsov <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/hypothesis.20can't.20be.20used.html#282345385">(May 14 2022 at 10:26)</a>:</h4>
<p><span class="user-mention" data-user-id="112857">@Leonardo de Moura</span> , just discovered <code>nightly-2022-05-04</code> split regression:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">class</span> <span class="n">Foo</span> <span class="o">(</span><span class="n">f</span><span class="o">:</span> <span class="kt">Type</span><span class="o">)</span> <span class="n">where</span>
  <span class="n">foo</span> <span class="o">:</span> <span class="n">Option</span> <span class="n">f</span>

<span class="kd">def</span> <span class="n">bar</span> <span class="o">(</span><span class="n">self</span><span class="o">:</span> <span class="n">Foo</span> <span class="n">f</span><span class="o">)</span> <span class="o">:=</span> <span class="k">if</span> <span class="k">let</span> <span class="bp">.</span><span class="n">some</span> <span class="n">_</span> <span class="o">:=</span> <span class="n">self.foo</span> <span class="k">then</span> <span class="n">True</span> <span class="k">else</span> <span class="n">True</span>

<span class="kd">example</span> <span class="o">[</span><span class="n">self</span><span class="o">:</span> <span class="n">Foo</span> <span class="n">f</span><span class="o">]:</span>
  <span class="n">bar</span> <span class="n">self</span> <span class="bp">→</span> <span class="n">True</span> <span class="bp">∧</span> <span class="n">bar</span> <span class="n">self</span> <span class="o">:=</span> <span class="kd">by</span>
  <span class="n">unfold</span> <span class="n">bar</span>
  <span class="n">intro</span> <span class="n">hi</span>
  <span class="n">constructor</span><span class="bp">;</span> <span class="n">trivial</span>
  <span class="n">split</span> <span class="bp">&lt;;&gt;</span> <span class="n">simp</span>
</code></pre></div>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">tactic</span> <span class="bp">'</span><span class="n">split'</span> <span class="n">failed</span>
<span class="n">case</span> <span class="n">right</span>
<span class="n">f</span> <span class="o">:</span> <span class="kt">Type</span>
<span class="n">self</span> <span class="o">:</span> <span class="n">Foo</span> <span class="n">f</span>
<span class="n">hi</span> <span class="o">:</span>
  <span class="k">match</span> <span class="n">Foo.foo</span> <span class="k">with</span>
  <span class="bp">|</span> <span class="n">some</span> <span class="n">val</span> <span class="bp">=&gt;</span> <span class="n">True</span>
  <span class="bp">|</span> <span class="n">x</span> <span class="bp">=&gt;</span> <span class="n">True</span>
<span class="bp">⊢</span> <span class="k">match</span> <span class="n">Foo.foo</span> <span class="k">with</span>
  <span class="bp">|</span> <span class="n">some</span> <span class="n">val</span> <span class="bp">=&gt;</span> <span class="n">True</span>
  <span class="bp">|</span> <span class="n">x</span> <span class="bp">=&gt;</span> <span class="n">True</span>
</code></pre></div>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>