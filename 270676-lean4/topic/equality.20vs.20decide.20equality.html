---
layout: archive
title: Zulip Chat Archive
permalink: /stream/270676-lean4/topic/equality.20vs.20decide.20equality.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/index.html">lean4</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/equality.20vs.20decide.20equality.html">equality vs decide equality</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="323036201"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/equality%20vs%20decide%20equality/near/323036201" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Shreyas Srinivas <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/equality.20vs.20decide.20equality.html#323036201">(Jan 23 2023 at 14:39)</a>:</h4>
<p>I have a goal as follows:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="o">(</span><span class="k">match</span> <span class="n">decide</span> <span class="o">(</span><span class="n">n</span> <span class="bp">%</span> <span class="mi">2</span> <span class="bp">=</span> <span class="mi">1</span><span class="o">)</span> <span class="k">with</span>
  <span class="bp">|</span> <span class="n">true</span> <span class="bp">=&gt;</span> <span class="mi">1</span>
  <span class="bp">|</span> <span class="n">false</span> <span class="bp">=&gt;</span> <span class="mi">0</span><span class="o">)</span> <span class="bp">=</span>
  <span class="n">n</span> <span class="bp">%</span> <span class="mi">2</span>
</code></pre></div>
<p>When I use <code>cases (decide (n%2) = 1)</code>,  I get two cases:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">unsolved</span> <span class="n">goals</span>
<span class="n">case</span> <span class="n">false</span>
<span class="n">n</span><span class="o">:</span> <span class="n">ℕ</span>
<span class="bp">⊢</span> <span class="o">(</span><span class="k">match</span> <span class="n">false</span> <span class="k">with</span>
  <span class="bp">|</span> <span class="n">true</span> <span class="bp">=&gt;</span> <span class="mi">1</span>
  <span class="bp">|</span> <span class="n">false</span> <span class="bp">=&gt;</span> <span class="mi">0</span><span class="o">)</span> <span class="bp">=</span>
  <span class="n">n</span> <span class="bp">%</span> <span class="mi">2</span>


<span class="n">case</span> <span class="n">true</span>
<span class="n">n</span><span class="o">:</span> <span class="n">ℕ</span>
<span class="bp">⊢</span> <span class="o">(</span><span class="k">match</span> <span class="n">true</span> <span class="k">with</span>
  <span class="bp">|</span> <span class="n">true</span> <span class="bp">=&gt;</span> <span class="mi">1</span>
  <span class="bp">|</span> <span class="n">false</span> <span class="bp">=&gt;</span> <span class="mi">0</span><span class="o">)</span> <span class="bp">=</span>
  <span class="n">n</span> <span class="bp">%</span> <span class="mi">2</span>
</code></pre></div>



<a name="323036517"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/equality%20vs%20decide%20equality/near/323036517" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Shreyas Srinivas <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/equality.20vs.20decide.20equality.html#323036517">(Jan 23 2023 at 14:40)</a>:</h4>
<p>This seems in line with the way cases works as a tactic. But how do  I get lean to recognize that <code>n%2</code> is either <code>1</code> or not <code>1</code>. More generally how should I close a goal like this with <code>decide</code> around an equality.</p>



<a name="323037085"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/equality%20vs%20decide%20equality/near/323037085" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Shreyas Srinivas <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/equality.20vs.20decide.20equality.html#323037085">(Jan 23 2023 at 14:42)</a>:</h4>
<p>In lean 3 there is a lemma <code>cond_to_bool_mod_two</code> for <code>nat</code>. I can't find the lean4 equivalent</p>



<a name="323038025"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/equality%20vs%20decide%20equality/near/323038025" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/equality.20vs.20decide.20equality.html#323038025">(Jan 23 2023 at 14:46)</a>:</h4>
<p>I think you need <code>cases h : decide (n%2 = 1)</code> if you want to avoid a dead end</p>



<a name="323038804"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/equality%20vs%20decide%20equality/near/323038804" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/equality.20vs.20decide.20equality.html#323038804">(Jan 23 2023 at 14:49)</a>:</h4>
<p>Does <code>split</code> help?</p>



<a name="323039318"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/equality%20vs%20decide%20equality/near/323039318" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Shreyas Srinivas <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/equality.20vs.20decide.20equality.html#323039318">(Jan 23 2023 at 14:51)</a>:</h4>
<p>If  I apply split, I am left with two goals:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">ase</span> <span class="n">h_1</span>
<span class="n">n</span><span class="o">:</span> <span class="n">ℕ</span>
<span class="bp">⊢</span> <span class="mi">1</span> <span class="bp">=</span> <span class="n">n</span> <span class="bp">%</span> <span class="mi">2</span>


<span class="n">case</span> <span class="n">h_2</span>
<span class="n">n</span><span class="o">:</span> <span class="n">ℕ</span>
<span class="bp">⊢</span> <span class="mi">0</span> <span class="bp">=</span> <span class="n">n</span> <span class="bp">%</span> <span class="mi">2</span>
</code></pre></div>
<p>with no hypothesis to close them with.</p>



<a name="323039628"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/equality%20vs%20decide%20equality/near/323039628" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Shreyas Srinivas <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/equality.20vs.20decide.20equality.html#323039628">(Jan 23 2023 at 14:52)</a>:</h4>
<p>The cases method gives me two hypothesis inside <code>decide</code></p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">case</span> <span class="n">false</span>
<span class="n">n</span><span class="o">:</span> <span class="n">ℕ</span>
<span class="n">h</span><span class="o">:</span> <span class="n">decide</span> <span class="o">(</span><span class="n">n</span> <span class="bp">%</span> <span class="mi">2</span> <span class="bp">=</span> <span class="mi">1</span><span class="o">)</span> <span class="bp">=</span> <span class="n">false</span>
<span class="bp">⊢</span> <span class="mi">0</span> <span class="bp">=</span> <span class="n">n</span> <span class="bp">%</span> <span class="mi">2</span>


<span class="n">case</span> <span class="n">true</span>
<span class="n">n</span><span class="o">:</span> <span class="n">ℕ</span>
<span class="n">h</span><span class="o">:</span> <span class="n">decide</span> <span class="o">(</span><span class="n">n</span> <span class="bp">%</span> <span class="mi">2</span> <span class="bp">=</span> <span class="mi">1</span><span class="o">)</span> <span class="bp">=</span> <span class="n">true</span>
<span class="bp">⊢</span> <span class="mi">1</span> <span class="bp">=</span> <span class="n">n</span> <span class="bp">%</span> <span class="mi">2</span>
</code></pre></div>



<a name="323039834"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/equality%20vs%20decide%20equality/near/323039834" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/equality.20vs.20decide.20equality.html#323039834">(Jan 23 2023 at 14:53)</a>:</h4>
<p>Did you use <code>split</code> <em>instead</em> of <code>cases</code>?</p>



<a name="323040364"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/equality%20vs%20decide%20equality/near/323040364" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Shreyas Srinivas <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/equality.20vs.20decide.20equality.html#323040364">(Jan 23 2023 at 14:55)</a>:</h4>
<p>yes</p>



<a name="323040499"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/equality%20vs%20decide%20equality/near/323040499" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Shreyas Srinivas <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/equality.20vs.20decide.20equality.html#323040499">(Jan 23 2023 at 14:56)</a>:</h4>
<p>I applied them separately</p>



<a name="323041349"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/equality%20vs%20decide%20equality/near/323041349" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Shreyas Srinivas <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/equality.20vs.20decide.20equality.html#323041349">(Jan 23 2023 at 14:59)</a>:</h4>
<p>About <code>nat.cond_to_bool_mod_two</code>, in lean 3, it is found in <code>core/init.data.nat.lemmas</code> (source : <a href="https://leanprover-community.github.io/mathlib_docs/init/data/nat/lemmas.html#nat.cond_to_bool_mod_two">lean 3 docs</a> ). Most of the lemmas here seem to have moved to <code>std.data.nat.lemmas</code> (source : <a href="https://leanprover-community.github.io/mathlib4_docs/Std/Data/Nat/Lemmas.html">lean 4 docs</a> ), but  I cannot the lemma for <code>cond</code> in the lean4 version</p>



<a name="323041763"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/equality%20vs%20decide%20equality/near/323041763" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/equality.20vs.20decide.20equality.html#323041763">(Jan 23 2023 at 15:00)</a>:</h4>
<p>Perhaps it's worth pointing out that <code>match decide (n % 2 = 1) with ...</code> is a very strange way to spell <code>if n % 2 = 1 then ...</code></p>



<a name="323041830"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/equality%20vs%20decide%20equality/near/323041830" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/equality.20vs.20decide.20equality.html#323041830">(Jan 23 2023 at 15:01)</a>:</h4>
<p>So it's no surprise that you can't find many lemmas to help you</p>



<a name="323043728"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/equality%20vs%20decide%20equality/near/323043728" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Shreyas Srinivas <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/equality.20vs.20decide.20equality.html#323043728">(Jan 23 2023 at 15:07)</a>:</h4>
<p>It is a mathport thing</p>



<a name="323044177"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/equality%20vs%20decide%20equality/near/323044177" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Shreyas Srinivas <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/equality.20vs.20decide.20equality.html#323044177">(Jan 23 2023 at 15:09)</a>:</h4>
<p>In lean 3 there was a theorem with the goal <code>bitvec.to_nat (to_bool (n % 2 = 1) ::ᵥ nil) = n % 2</code><br>
Mathport changed that to <code>Bitvec.toNat (decide (n % 2 = 1) ::ᵥ nil) = n % 2</code></p>



<a name="323046293"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/equality%20vs%20decide%20equality/near/323046293" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/equality.20vs.20decide.20equality.html#323046293">(Jan 23 2023 at 15:17)</a>:</h4>
<p><span class="user-mention silent" data-user-id="466334">Shreyas Srinivas</span> <a href="#narrow/stream/270676-lean4/topic/equality.20vs.20decide.20equality/near/323041349">said</a>:</p>
<blockquote>
<p>About <code>nat.cond_to_bool_mod_two</code>, in lean 3, it is found in <code>core/init.data.nat.lemmas</code> (source : <a href="https://leanprover-community.github.io/mathlib_docs/init/data/nat/lemmas.html#nat.cond_to_bool_mod_two">lean 3 docs</a> ). Most of the lemmas here seem to have moved to <code>std.data.nat.lemmas</code> (source : <a href="https://leanprover-community.github.io/mathlib4_docs/Std/Data/Nat/Lemmas.html">lean 4 docs</a> ), but  I cannot the lemma for <code>cond</code> in the lean4 version</p>
</blockquote>
<p>Then you should port this lemma to <code>Mathlib/Init/Data/Nat/Lemmas</code></p>



<a name="323046984"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/equality%20vs%20decide%20equality/near/323046984" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/equality.20vs.20decide.20equality.html#323046984">(Jan 23 2023 at 15:20)</a>:</h4>
<p><span class="user-mention silent" data-user-id="466334">Shreyas Srinivas</span> <a href="#narrow/stream/270676-lean4/topic/equality.20vs.20decide.20equality/near/323039628">said</a>:</p>
<blockquote>
<p>The cases method gives me two hypothesis inside <code>decide</code></p>
</blockquote>
<p>This looks like you're at least still at a provable goal.</p>



<a name="323048960"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/equality%20vs%20decide%20equality/near/323048960" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Shreyas Srinivas <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/equality.20vs.20decide.20equality.html#323048960">(Jan 23 2023 at 15:28)</a>:</h4>
<p>Found a <a href="https://github.com/leanprover-community/mathlib4/blob/60f31f1099e2302376812924ac30a0fff322ae8d/Mathlib/Init/Data/Nat/Lemmas.lean#L290">note</a> in the file here</p>



<a name="323050144"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/equality%20vs%20decide%20equality/near/323050144" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Shreyas Srinivas <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/equality.20vs.20decide.20equality.html#323050144">(Jan 23 2023 at 15:33)</a>:</h4>
<p><span class="user-mention silent" data-user-id="310045">Eric Wieser</span> <a href="#narrow/stream/270676-lean4/topic/equality.20vs.20decide.20equality/near/323046984">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="466334">Shreyas Srinivas</span> <a href="#narrow/stream/270676-lean4/topic/equality.20vs.20decide.20equality/near/323039628">said</a>:</p>
<blockquote>
<p>The cases method gives me two hypothesis inside <code>decide</code></p>
</blockquote>
<p>This looks like you're at least still at a provable goal.</p>
</blockquote>
<p>I am not familiar with how to use something inside a <code>decide</code> call yet.</p>



<a name="323050321"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/equality%20vs%20decide%20equality/near/323050321" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Shreyas Srinivas <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/equality.20vs.20decide.20equality.html#323050321">(Jan 23 2023 at 15:33)</a>:</h4>
<p>throwing<code>rw</code> or <code>simp</code> at it doesn't seem to work.</p>



<a name="323050330"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/equality%20vs%20decide%20equality/near/323050330" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/equality.20vs.20decide.20equality.html#323050330">(Jan 23 2023 at 15:33)</a>:</h4>
<p>There should be a lemma that says <code>decide p = true</code> iff <code>p</code></p>



<a name="323050641"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/equality%20vs%20decide%20equality/near/323050641" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Shreyas Srinivas <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/equality.20vs.20decide.20equality.html#323050641">(Jan 23 2023 at 15:34)</a>:</h4>
<p>I am not sure that can be an <code>iff</code>. not all propositions are decidable.</p>



<a name="323050642"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/equality%20vs%20decide%20equality/near/323050642" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/equality.20vs.20decide.20equality.html#323050642">(Jan 23 2023 at 15:34)</a>:</h4>
<p>Is there a reason you can't do <code>by_cases h : x % 2 = 1,</code> like the Lean3 proof?</p>



<a name="323051232"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/equality%20vs%20decide%20equality/near/323051232" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Shreyas Srinivas <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/equality.20vs.20decide.20equality.html#323051232">(Jan 23 2023 at 15:37)</a>:</h4>
<p>The original proof is </p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code> <span class="n">simp</span> <span class="o">[</span><span class="n">bits_to_nat_to_list</span><span class="o">],</span>
  <span class="n">unfold</span> <span class="n">bits_to_nat</span> <span class="n">add_lsb</span> <span class="n">list.foldl</span> <span class="n">cond</span><span class="o">,</span>
  <span class="n">simp</span> <span class="o">[</span><span class="n">cond_to_bool_mod_two</span><span class="o">],</span>
</code></pre></div>



<a name="323051290"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/equality%20vs%20decide%20equality/near/323051290" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Shreyas Srinivas <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/equality.20vs.20decide.20equality.html#323051290">(Jan 23 2023 at 15:37)</a>:</h4>
<p>I'll try <code>by_cases</code> now</p>



<a name="323051722"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/equality%20vs%20decide%20equality/near/323051722" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Shreyas Srinivas <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/equality.20vs.20decide.20equality.html#323051722">(Jan 23 2023 at 15:38)</a>:</h4>
<p>okay that works.</p>



<a name="323052671"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/equality%20vs%20decide%20equality/near/323052671" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/equality.20vs.20decide.20equality.html#323052671">(Jan 23 2023 at 15:43)</a>:</h4>
<p>Why did you write your own proof instead of using the mathport one?</p>



<a name="323052712"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/equality%20vs%20decide%20equality/near/323052712" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/equality.20vs.20decide.20equality.html#323052712">(Jan 23 2023 at 15:43)</a>:</h4>
<p>If you're porting stuff, you should use the mathport output</p>



<a name="323053137"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/equality%20vs%20decide%20equality/near/323053137" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Shreyas Srinivas <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/equality.20vs.20decide.20equality.html#323053137">(Jan 23 2023 at 15:45)</a>:</h4>
<p>I did. The last step was the issue. I am just replacing that one</p>



<a name="323053219"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/equality%20vs%20decide%20equality/near/323053219" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Shreyas Srinivas <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/equality.20vs.20decide.20equality.html#323053219">(Jan 23 2023 at 15:45)</a>:</h4>
<p><code>simp [cond_to_bool_mod_two]</code> does nothing in lean4 because the lemma doesn't exist yet.</p>



<a name="323053952"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/equality%20vs%20decide%20equality/near/323053952" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Shreyas Srinivas <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/equality.20vs.20decide.20equality.html#323053952">(Jan 23 2023 at 15:49)</a>:</h4>
<p>Btw, I put this in lean4, because the question of how to handle equalities inside <code>decide</code> seemed like it might be of general interest.</p>



<a name="323054296"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/equality%20vs%20decide%20equality/near/323054296" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kyle Miller <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/equality.20vs.20decide.20equality.html#323054296">(Jan 23 2023 at 15:50)</a>:</h4>
<p><span class="user-mention silent" data-user-id="466334">Shreyas Srinivas</span> <a href="#narrow/stream/270676-lean4/topic/equality.20vs.20decide.20equality/near/323050641">said</a>:</p>
<blockquote>
<p>I am not sure that can be an <code>iff</code>. not all propositions are decidable.</p>
</blockquote>
<p><a href="https://leanprover-community.github.io/mathlib4_docs/find/?pattern=decide_eq_true_iff#doc">docs4#decide_eq_true_iff</a></p>



<a name="323054502"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/equality%20vs%20decide%20equality/near/323054502" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Shreyas Srinivas <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/equality.20vs.20decide.20equality.html#323054502">(Jan 23 2023 at 15:51)</a>:</h4>
<p>Ah okay, so there is a Decidable instance on <code>p</code> and it works.</p>



<a name="323057489"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/equality%20vs%20decide%20equality/near/323057489" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Shreyas Srinivas <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/equality.20vs.20decide.20equality.html#323057489">(Jan 23 2023 at 16:04)</a>:</h4>
<p>This one is on <a href="https://bit.ly/3cKk3ld">#queue4</a> now (Data.Bitvec.Core)</p>



<a name="323063842"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/equality%20vs%20decide%20equality/near/323063842" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/equality.20vs.20decide.20equality.html#323063842">(Jan 23 2023 at 16:30)</a>:</h4>
<p><span class="user-mention silent" data-user-id="466334">Shreyas Srinivas</span> <a href="#narrow/stream/270676-lean4/topic/equality.20vs.20decide.20equality/near/323053219">said</a>:</p>
<blockquote>
<p><code>simp [cond_to_bool_mod_two]</code> does nothing in lean4 because the lemma doesn't exist yet.</p>
</blockquote>
<p>Right, so at that point you should find <code>cond_to_bool_mod_two</code> in mathport rather than looking for a different proof!</p>



<a name="323064150"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/equality%20vs%20decide%20equality/near/323064150" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Shreyas Srinivas <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/equality.20vs.20decide.20equality.html#323064150">(Jan 23 2023 at 16:31)</a>:</h4>
<p>It was not there.<br>
<span class="user-mention silent" data-user-id="466334">Shreyas Srinivas</span> <a href="#narrow/stream/270676-lean4/topic/equality.20vs.20decide.20equality/near/323048960">said</a>:</p>
<blockquote>
<p>Found a <a href="https://github.com/leanprover-community/mathlib4/blob/60f31f1099e2302376812924ac30a0fff322ae8d/Mathlib/Init/Data/Nat/Lemmas.lean#L290">note</a> in the file here</p>
</blockquote>
<p>This theorem is a todo</p>



<a name="323064635"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/equality%20vs%20decide%20equality/near/323064635" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/equality.20vs.20decide.20equality.html#323064635">(Jan 23 2023 at 16:33)</a>:</h4>
<p>Great, sounds like now is the time to do it</p>



<a name="323064872"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/equality%20vs%20decide%20equality/near/323064872" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/equality.20vs.20decide.20equality.html#323064872">(Jan 23 2023 at 16:34)</a>:</h4>
<p>Should just need copying in from <a href="https://github.com/leanprover-community/lean3port/blob/44b836ec48e1882103ab9ac0fea4dce2bf402797/Leanbin/Init/Data/Nat/Lemmas.lean#L1502-L1508">https://github.com/leanprover-community/lean3port/blob/44b836ec48e1882103ab9ac0fea4dce2bf402797/Leanbin/Init/Data/Nat/Lemmas.lean#L1502-L1508</a></p>



<a name="323067086"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/equality%20vs%20decide%20equality/near/323067086" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Shreyas Srinivas <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/equality.20vs.20decide.20equality.html#323067086">(Jan 23 2023 at 16:44)</a>:</h4>
<p><span class="user-mention silent" data-user-id="310045">Eric Wieser</span> <a href="#narrow/stream/270676-lean4/topic/equality.20vs.20decide.20equality/near/323064872">said</a>:</p>
<blockquote>
<p>Should just need copying in from <a href="https://github.com/leanprover-community/lean3port/blob/44b836ec48e1882103ab9ac0fea4dce2bf402797/Leanbin/Init/Data/Nat/Lemmas.lean#L1502-L1508">https://github.com/leanprover-community/lean3port/blob/44b836ec48e1882103ab9ac0fea4dce2bf402797/Leanbin/Init/Data/Nat/Lemmas.lean#L1502-L1508</a></p>
</blockquote>
<p>Got it. done and pushed.</p>



<a name="323069459"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/equality%20vs%20decide%20equality/near/323069459" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Shreyas Srinivas <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/equality.20vs.20decide.20equality.html#323069459">(Jan 23 2023 at 16:54)</a>:</h4>
<p>It actually breaks the proof. Do I need to add the @[simp] attribute to the theorem.</p>



<a name="323069787"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/equality%20vs%20decide%20equality/near/323069787" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Shreyas Srinivas <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/equality.20vs.20decide.20equality.html#323069787">(Jan 23 2023 at 16:55)</a>:</h4>
<p>That did not fix it either.</p>



<a name="323071252"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/equality%20vs%20decide%20equality/near/323071252" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Shreyas Srinivas <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/equality.20vs.20decide.20equality.html#323071252">(Jan 23 2023 at 17:01)</a>:</h4>
<p><span class="user-mention" data-user-id="310045">@Eric Wieser</span> the proof is broken again.</p>



<a name="323071465"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/equality%20vs%20decide%20equality/near/323071465" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/equality.20vs.20decide.20equality.html#323071465">(Jan 23 2023 at 17:02)</a>:</h4>
<p>Broken in what way? The cache isn't available yet so I can't try it myself</p>



<a name="323072639"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/equality%20vs%20decide%20equality/near/323072639" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Shreyas Srinivas <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/equality.20vs.20decide.20equality.html#323072639">(Jan 23 2023 at 17:07)</a>:</h4>
<p><code>simp [Nat.cond_decide_mod_two]</code> does nothing</p>



<a name="323072782"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/equality%20vs%20decide%20equality/near/323072782" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Shreyas Srinivas <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/equality.20vs.20decide.20equality.html#323072782">(Jan 23 2023 at 17:08)</a>:</h4>
<p><span class="user-mention silent" data-user-id="466334">Shreyas Srinivas</span> <a href="#narrow/stream/270676-lean4/topic/equality.20vs.20decide.20equality/near/323072639">said</a>:</p>
<blockquote>
<p><code>simp [Nat.cond_decide_mod_two]</code> does nothing</p>
</blockquote>
<p>This is the lean4 equivalent of lean3's <code>simp [cond_to_bool_mod_two],</code></p>



<a name="323073049"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/equality%20vs%20decide%20equality/near/323073049" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/equality.20vs.20decide.20equality.html#323073049">(Jan 23 2023 at 17:09)</a>:</h4>
<p>(deleted)</p>



<a name="323073457"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/equality%20vs%20decide%20equality/near/323073457" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/equality.20vs.20decide.20equality.html#323073457">(Jan 23 2023 at 17:11)</a>:</h4>
<p><code>simp [Nat.cond_decide_mod_two, -Bool.cond_decide]</code> works</p>



<a name="323073522"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/equality%20vs%20decide%20equality/near/323073522" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/equality.20vs.20decide.20equality.html#323073522">(Jan 23 2023 at 17:11)</a>:</h4>
<p>Remember to add a porting note when you use that, because it's not what mathlib3 had</p>



<a name="323074490"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/equality%20vs%20decide%20equality/near/323074490" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Shreyas Srinivas <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/equality.20vs.20decide.20equality.html#323074490">(Jan 23 2023 at 17:15)</a>:</h4>
<p>changing <code>Init.Data.Nat.Lemmas</code> leads to a very long build time. Is it because lake is rebuilding all downstream packages ?</p>



<a name="323074786"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/equality%20vs%20decide%20equality/near/323074786" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Shreyas Srinivas <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/equality.20vs.20decide.20equality.html#323074786">(Jan 23 2023 at 17:17)</a>:</h4>
<p><span class="user-mention silent" data-user-id="310045">Eric Wieser</span> <a href="#narrow/stream/270676-lean4/topic/equality.20vs.20decide.20equality/near/323073457">said</a>:</p>
<blockquote>
<p><code>simp [Nat.cond_decide_mod_two, -Bool.cond_decide]</code> works</p>
</blockquote>
<p>Doesn't work.<br>
I still have the following state:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">unsolved</span> <span class="n">goals</span>
<span class="n">n</span><span class="o">:</span> <span class="n">ℕ</span>
<span class="bp">⊢</span> <span class="o">(</span><span class="k">match</span> <span class="n">decide</span> <span class="o">(</span><span class="n">n</span> <span class="bp">%</span> <span class="mi">2</span> <span class="bp">=</span> <span class="mi">1</span><span class="o">)</span> <span class="k">with</span>
  <span class="bp">|</span> <span class="n">true</span> <span class="bp">=&gt;</span> <span class="mi">1</span>
  <span class="bp">|</span> <span class="n">false</span> <span class="bp">=&gt;</span> <span class="mi">0</span><span class="o">)</span> <span class="bp">=</span>
  <span class="n">n</span> <span class="bp">%</span> <span class="mi">2</span>
</code></pre></div>



<a name="323074912"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/equality%20vs%20decide%20equality/near/323074912" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/equality.20vs.20decide.20equality.html#323074912">(Jan 23 2023 at 17:17)</a>:</h4>
<p>Sorry, I keep getting tricked by the error appearing on the <code>by</code> line</p>



<a name="323075021"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/equality%20vs%20decide%20equality/near/323075021" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Shreyas Srinivas <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/equality.20vs.20decide.20equality.html#323075021">(Jan 23 2023 at 17:18)</a>:</h4>
<p>The proof I had plugged in was working. Should I plug it back in?</p>



<a name="323075363"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/equality%20vs%20decide%20equality/near/323075363" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/equality.20vs.20decide.20equality.html#323075363">(Jan 23 2023 at 17:19)</a>:</h4>
<p>No, I think it would be better to understand why the old proof doesn't work</p>



<a name="323075427"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/equality%20vs%20decide%20equality/near/323075427" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/equality.20vs.20decide.20equality.html#323075427">(Jan 23 2023 at 17:19)</a>:</h4>
<p>You could work that our by using <code>simp?</code> in mathlib3 and 4, and seeing what changed</p>



<a name="323075580"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/equality%20vs%20decide%20equality/near/323075580" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/equality.20vs.20decide.20equality.html#323075580">(Jan 23 2023 at 17:20)</a>:</h4>
<p>This works I think?</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">theorem</span> <span class="n">bits_toNat_decide</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="o">:</span> <span class="n">Bitvec.toNat</span> <span class="o">(</span><span class="n">decide</span> <span class="o">(</span><span class="n">n</span> <span class="bp">%</span> <span class="mi">2</span> <span class="bp">=</span> <span class="mi">1</span><span class="o">)</span> <span class="o">::</span><span class="bp">ᵥ</span> <span class="n">nil</span><span class="o">)</span> <span class="bp">=</span> <span class="n">n</span> <span class="bp">%</span> <span class="mi">2</span> <span class="o">:=</span> <span class="kd">by</span>
  <span class="n">simp</span> <span class="o">[</span><span class="n">bitsToNat_toList</span><span class="o">]</span>
  <span class="n">unfold</span> <span class="n">bitsToNat</span> <span class="n">addLsb</span> <span class="n">List.foldl</span>
  <span class="n">simp</span> <span class="o">[</span><span class="n">Nat.cond_decide_mod_two</span><span class="o">,</span> <span class="bp">-</span><span class="n">Bool.cond_decide</span><span class="o">]</span>
</code></pre></div>



<a name="323076053"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/equality%20vs%20decide%20equality/near/323076053" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Shreyas Srinivas <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/equality.20vs.20decide.20equality.html#323076053">(Jan 23 2023 at 17:22)</a>:</h4>
<p>yeah that works</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>