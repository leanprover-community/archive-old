---
layout: archive
title: Zulip Chat Archive
permalink: /stream/270676-lean4/topic/Compiler.20stuck.20computing.20something.2E.2E.2E.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/index.html">lean4</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Compiler.20stuck.20computing.20something.2E.2E.2E.html">Compiler stuck computing something...</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="299193185"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Compiler%20stuck%20computing%20something.../near/299193185" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sofia Snow <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Compiler.20stuck.20computing.20something.2E.2E.2E.html#299193185">(Sep 16 2022 at 16:05)</a>:</h4>
<p>Hello. I tried adding the <code>Linear</code> definition below, noted the LSP stopped responding and all cores pegged at 100%. The compiler doesn't seem to like the inductive constructors of the <code>Linear</code> proposition, nor does it like it as a type.</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">inductive</span> <span class="n">Cover</span> <span class="o">:</span> <span class="o">(</span><span class="n">x</span> <span class="n">y</span> <span class="n">z</span> <span class="o">:</span> <span class="n">List</span> <span class="n">α</span><span class="o">)</span> <span class="bp">-&gt;</span> <span class="kt">Type</span> <span class="n">u</span>
  <span class="bp">|</span> <span class="n">done</span>  <span class="o">:</span> <span class="n">Cover</span> <span class="o">[]</span> <span class="o">[]</span> <span class="o">[]</span>
  <span class="bp">|</span> <span class="n">left</span>  <span class="o">:</span> <span class="n">Cover</span> <span class="n">x</span> <span class="n">y</span> <span class="n">z</span> <span class="bp">-&gt;</span> <span class="n">Cover</span> <span class="o">(</span><span class="n">t</span> <span class="o">::</span> <span class="n">x</span><span class="o">)</span> <span class="n">y</span> <span class="o">(</span><span class="n">t</span> <span class="o">::</span> <span class="n">z</span><span class="o">)</span>
  <span class="bp">|</span> <span class="n">right</span> <span class="o">:</span> <span class="n">Cover</span> <span class="n">x</span> <span class="n">y</span> <span class="n">z</span> <span class="bp">-&gt;</span> <span class="n">Cover</span> <span class="n">x</span> <span class="o">(</span><span class="n">t</span> <span class="o">::</span> <span class="n">y</span><span class="o">)</span> <span class="o">(</span><span class="n">t</span> <span class="o">::</span> <span class="n">z</span><span class="o">)</span>
  <span class="bp">|</span> <span class="n">both</span>  <span class="o">:</span> <span class="n">Cover</span> <span class="n">x</span> <span class="n">y</span> <span class="n">z</span> <span class="bp">-&gt;</span> <span class="n">Cover</span> <span class="o">(</span><span class="n">t</span> <span class="o">::</span> <span class="n">x</span><span class="o">)</span> <span class="o">(</span><span class="n">t</span> <span class="o">::</span> <span class="n">y</span><span class="o">)</span> <span class="o">(</span><span class="n">t</span> <span class="o">::</span> <span class="n">z</span><span class="o">)</span>

<span class="kd">inductive</span> <span class="n">Linear</span> <span class="o">:</span> <span class="n">Cover</span> <span class="n">x</span> <span class="n">y</span> <span class="n">z</span> <span class="bp">-&gt;</span> <span class="kt">Prop</span>
  <span class="bp">|</span> <span class="n">done</span> <span class="o">:</span> <span class="n">Linear</span> <span class="bp">.</span><span class="n">done</span>
  <span class="bp">|</span> <span class="n">left</span> <span class="o">:</span> <span class="n">Linear</span> <span class="n">c</span> <span class="bp">-&gt;</span> <span class="n">Linear</span> <span class="o">(</span><span class="bp">.</span><span class="n">left</span> <span class="n">c</span><span class="o">)</span>
  <span class="bp">|</span> <span class="n">right</span> <span class="o">:</span> <span class="n">Linear</span> <span class="n">c</span> <span class="bp">-&gt;</span> <span class="n">Linear</span> <span class="o">(</span><span class="bp">.</span><span class="n">right</span> <span class="n">c</span><span class="o">)</span>
</code></pre></div>



<a name="299193629"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Compiler%20stuck%20computing%20something.../near/299193629" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sofia Snow <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Compiler.20stuck.20computing.20something.2E.2E.2E.html#299193629">(Sep 16 2022 at 16:07)</a>:</h4>
<p>Noticed on an older nightly, so I updated, running nightly-2022-09-15 now.</p>



<a name="299250103"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Compiler%20stuck%20computing%20something.../near/299250103" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Leonardo de Moura <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Compiler.20stuck.20computing.20something.2E.2E.2E.html#299250103">(Sep 16 2022 at 22:24)</a>:</h4>
<p>I can reproduce this issue. Created an issue for it <a href="https://github.com/leanprover/lean4/issues/1616">https://github.com/leanprover/lean4/issues/1616</a></p>



<a name="314437421"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Compiler%20stuck%20computing%20something.../near/314437421" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Compiler.20stuck.20computing.20something.2E.2E.2E.html#314437421">(Dec 07 2022 at 11:52)</a>:</h4>
<p>Hi! I'm also facing an issue in which the compiler is getting stuck. Here's the <a href="https://leanprover-community.github.io/mwe.html">#mwe</a>:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">Std.Data.RBMap</span>

<span class="n">abbrev</span> <span class="n">MultilinearPolynomial</span> <span class="n">α</span> <span class="o">:=</span> <span class="n">Std.RBMap</span> <span class="n">Nat</span> <span class="n">α</span> <span class="n">compare</span>

<span class="kn">namespace</span> <span class="n">MultilinearPolynomial</span>

<span class="sd">/-- Instantiates a MPL from the list of raw `(b, c)` pairs -/</span>
<span class="kd">def</span> <span class="n">ofPairs</span> <span class="o">(</span><span class="n">pairs</span> <span class="o">:</span> <span class="n">List</span> <span class="bp">$</span> <span class="n">Nat</span> <span class="bp">×</span> <span class="n">α</span><span class="o">)</span> <span class="o">:</span> <span class="n">MultilinearPolynomial</span> <span class="n">α</span> <span class="o">:=</span>
  <span class="bp">.</span><span class="n">ofList</span> <span class="n">pairs</span> <span class="n">_</span>

<span class="kd">end</span> <span class="n">MultilinearPolynomial</span>

<span class="n">abbrev</span> <span class="n">Zmod</span> <span class="o">(</span><span class="n">_</span> <span class="o">:</span> <span class="n">Nat</span><span class="o">)</span> <span class="o">:</span> <span class="kt">Type</span> <span class="o">:=</span> <span class="n">Int</span>

<span class="kd">instance</span> <span class="o">[</span><span class="n">Ord</span> <span class="n">α</span><span class="o">]</span> <span class="o">[</span><span class="n">Ord</span> <span class="n">β</span><span class="o">]</span> <span class="o">:</span> <span class="n">Ord</span> <span class="o">(</span><span class="n">α</span> <span class="bp">×</span> <span class="n">β</span><span class="o">)</span> <span class="n">where</span> <span class="n">compare</span>
  <span class="bp">|</span> <span class="o">(</span><span class="n">a₁</span><span class="o">,</span> <span class="n">b₁</span><span class="o">),</span> <span class="o">(</span><span class="n">a₂</span><span class="o">,</span> <span class="n">b₂</span><span class="o">)</span> <span class="bp">=&gt;</span>
    <span class="k">let</span> <span class="n">a</span> <span class="o">:=</span> <span class="n">compare</span> <span class="n">a₁</span> <span class="n">a₂</span>
    <span class="k">if</span> <span class="n">a</span> <span class="bp">==</span> <span class="bp">.</span><span class="n">eq</span> <span class="k">then</span> <span class="n">compare</span> <span class="n">b₁</span> <span class="n">b₂</span> <span class="k">else</span> <span class="n">a</span>

<span class="kd">def</span> <span class="n">multilinearLagrangePolynomialCache</span> <span class="o">:</span>
    <span class="n">Std.RBMap</span> <span class="o">(</span><span class="n">Nat</span> <span class="bp">×</span> <span class="n">Nat</span><span class="o">)</span> <span class="o">(</span><span class="n">MultilinearPolynomial</span> <span class="bp">$</span> <span class="n">Zmod</span> <span class="n">n</span><span class="o">)</span> <span class="n">compare</span> <span class="o">:=</span> <span class="bp">.</span><span class="n">ofList</span> <span class="o">[</span>
  <span class="o">((</span><span class="mi">2</span><span class="o">,</span> <span class="mi">3</span><span class="o">),</span> <span class="bp">.</span><span class="n">ofPairs</span> <span class="o">[(</span><span class="mi">0</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">3</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">4</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">5</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">6</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">7</span><span class="o">,</span> <span class="mi">1</span><span class="o">)]),</span>
  <span class="o">((</span><span class="mi">5</span><span class="o">,</span> <span class="mi">3</span><span class="o">),</span> <span class="bp">.</span><span class="n">ofPairs</span> <span class="o">[(</span><span class="mi">0</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">3</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">4</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">5</span><span class="o">,</span> <span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">6</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">7</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">)]),</span>
  <span class="o">((</span><span class="mi">2</span><span class="o">,</span> <span class="mi">1</span><span class="o">),</span> <span class="bp">.</span><span class="n">ofPairs</span> <span class="o">[(</span><span class="mi">0</span><span class="o">,</span> <span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">)]),</span>
  <span class="o">((</span><span class="mi">3</span><span class="o">,</span> <span class="mi">2</span><span class="o">),</span> <span class="bp">.</span><span class="n">ofPairs</span> <span class="o">[(</span><span class="mi">0</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">3</span><span class="o">,</span> <span class="mi">1</span><span class="o">)]),</span>
  <span class="o">((</span><span class="mi">1</span><span class="o">,</span> <span class="mi">3</span><span class="o">),</span> <span class="bp">.</span><span class="n">ofPairs</span> <span class="o">[(</span><span class="mi">0</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">3</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">4</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">5</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">6</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">7</span><span class="o">,</span> <span class="mi">1</span><span class="o">)]),</span>
  <span class="o">((</span><span class="mi">4</span><span class="o">,</span> <span class="mi">1</span><span class="o">),</span> <span class="bp">.</span><span class="n">ofPairs</span> <span class="o">[(</span><span class="mi">0</span><span class="o">,</span> <span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">)]),</span>
  <span class="o">((</span><span class="mi">5</span><span class="o">,</span> <span class="mi">4</span><span class="o">),</span> <span class="bp">.</span><span class="n">ofPairs</span> <span class="o">[(</span><span class="mi">0</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">3</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">4</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">5</span><span class="o">,</span> <span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">6</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">7</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">8</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">9</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">10</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">11</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">12</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">13</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">14</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">15</span><span class="o">,</span> <span class="mi">1</span><span class="o">)]),</span>
  <span class="o">((</span><span class="mi">0</span><span class="o">,</span> <span class="mi">2</span><span class="o">),</span> <span class="bp">.</span><span class="n">ofPairs</span> <span class="o">[(</span><span class="mi">0</span><span class="o">,</span> <span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">3</span><span class="o">,</span> <span class="mi">1</span><span class="o">)]),</span>
  <span class="o">((</span><span class="mi">0</span><span class="o">,</span> <span class="mi">1</span><span class="o">),</span> <span class="bp">.</span><span class="n">ofPairs</span> <span class="o">[(</span><span class="mi">0</span><span class="o">,</span> <span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">)]),</span>
  <span class="o">((</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">),</span> <span class="bp">.</span><span class="n">ofPairs</span> <span class="o">[(</span><span class="mi">0</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">3</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">)]),</span>
  <span class="o">((</span><span class="mi">2</span><span class="o">,</span> <span class="mi">2</span><span class="o">),</span> <span class="bp">.</span><span class="n">ofPairs</span> <span class="o">[(</span><span class="mi">0</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">3</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">)]),</span>
  <span class="o">((</span><span class="mi">3</span><span class="o">,</span> <span class="mi">3</span><span class="o">),</span> <span class="bp">.</span><span class="n">ofPairs</span> <span class="o">[(</span><span class="mi">0</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">3</span><span class="o">,</span> <span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">4</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">5</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">6</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">7</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">)]),</span>
  <span class="o">((</span><span class="mi">4</span><span class="o">,</span> <span class="mi">2</span><span class="o">),</span> <span class="bp">.</span><span class="n">ofPairs</span> <span class="o">[(</span><span class="mi">0</span><span class="o">,</span> <span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">3</span><span class="o">,</span> <span class="mi">1</span><span class="o">)]),</span>
  <span class="o">((</span><span class="mi">2</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="bp">.</span><span class="n">ofPairs</span> <span class="o">[(</span><span class="mi">0</span><span class="o">,</span> <span class="mi">1</span><span class="o">)]),</span>
  <span class="o">((</span><span class="mi">2</span><span class="o">,</span> <span class="mi">5</span><span class="o">),</span> <span class="bp">.</span><span class="n">ofPairs</span> <span class="o">[(</span><span class="mi">0</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">3</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">4</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">5</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">6</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">7</span><span class="o">,</span> <span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">8</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">9</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">10</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">11</span><span class="o">,</span> <span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">12</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">13</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">14</span><span class="o">,</span> <span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">15</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">16</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">17</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">18</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">19</span><span class="o">,</span> <span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">20</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">21</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">22</span><span class="o">,</span> <span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">23</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">24</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">25</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">26</span><span class="o">,</span> <span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">27</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">28</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">29</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">30</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">31</span><span class="o">,</span> <span class="mi">1</span><span class="o">)]),</span>
  <span class="o">((</span><span class="mi">3</span><span class="o">,</span> <span class="mi">1</span><span class="o">),</span> <span class="bp">.</span><span class="n">ofPairs</span> <span class="o">[(</span><span class="mi">0</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">1</span><span class="o">)]),</span>
  <span class="o">((</span><span class="mi">5</span><span class="o">,</span> <span class="mi">2</span><span class="o">),</span> <span class="bp">.</span><span class="n">ofPairs</span> <span class="o">[(</span><span class="mi">0</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">3</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">)]),</span>
  <span class="o">((</span><span class="mi">5</span><span class="o">,</span> <span class="mi">1</span><span class="o">),</span> <span class="bp">.</span><span class="n">ofPairs</span> <span class="o">[(</span><span class="mi">0</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">1</span><span class="o">)]),</span>
  <span class="o">((</span><span class="mi">4</span><span class="o">,</span> <span class="mi">3</span><span class="o">),</span> <span class="bp">.</span><span class="n">ofPairs</span> <span class="o">[(</span><span class="mi">0</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">3</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">4</span><span class="o">,</span> <span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">5</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">6</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">7</span><span class="o">,</span> <span class="mi">1</span><span class="o">)]),</span>
  <span class="o">((</span><span class="mi">1</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="bp">.</span><span class="n">ofPairs</span> <span class="o">[(</span><span class="mi">0</span><span class="o">,</span> <span class="mi">1</span><span class="o">)]),</span>
  <span class="o">((</span><span class="mi">5</span><span class="o">,</span> <span class="mi">5</span><span class="o">),</span> <span class="bp">.</span><span class="n">ofPairs</span> <span class="o">[(</span><span class="mi">0</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">3</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">4</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">5</span><span class="o">,</span> <span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">6</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">7</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">8</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">9</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">10</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">11</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">12</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">13</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">14</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">15</span><span class="o">,</span> <span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">16</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">17</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">18</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">19</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">20</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">21</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">22</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">23</span><span class="o">,</span> <span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">24</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">25</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">26</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">27</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">28</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">29</span><span class="o">,</span> <span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">30</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">31</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">)]),</span>
  <span class="o">((</span><span class="mi">0</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="bp">.</span><span class="n">ofPairs</span> <span class="o">[(</span><span class="mi">0</span><span class="o">,</span> <span class="mi">1</span><span class="o">)]),</span>
  <span class="o">((</span><span class="mi">3</span><span class="o">,</span> <span class="mi">5</span><span class="o">),</span> <span class="bp">.</span><span class="n">ofPairs</span> <span class="o">[(</span><span class="mi">0</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">3</span><span class="o">,</span> <span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">4</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">5</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">6</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">7</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">8</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">9</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">10</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">11</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">12</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">13</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">14</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">15</span><span class="o">,</span> <span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">16</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">17</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">18</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">19</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">20</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">21</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">22</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">23</span><span class="o">,</span> <span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">24</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">25</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">26</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">27</span><span class="o">,</span> <span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">28</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">29</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">30</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">31</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">)]),</span>
  <span class="o">((</span><span class="mi">4</span><span class="o">,</span> <span class="mi">4</span><span class="o">),</span> <span class="bp">.</span><span class="n">ofPairs</span> <span class="o">[(</span><span class="mi">0</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">3</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">4</span><span class="o">,</span> <span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">5</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">6</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">7</span><span class="o">,</span> <span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">8</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">9</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">10</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">11</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">12</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">13</span><span class="o">,</span> <span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">14</span><span class="o">,</span> <span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">15</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">)]),</span>
  <span class="o">((</span><span class="mi">1</span><span class="o">,</span> <span class="mi">1</span><span class="o">),</span> <span class="bp">.</span><span class="n">ofPairs</span> <span class="o">[(</span><span class="mi">0</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">1</span><span class="o">)]),</span>
  <span class="o">((</span><span class="mi">3</span><span class="o">,</span> <span class="mi">4</span><span class="o">),</span> <span class="bp">.</span><span class="n">ofPairs</span> <span class="o">[(</span><span class="mi">0</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">3</span><span class="o">,</span> <span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">4</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">5</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">6</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">7</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">8</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">9</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">10</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">11</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">12</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">13</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">14</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">15</span><span class="o">,</span> <span class="mi">1</span><span class="o">)]),</span>
  <span class="o">((</span><span class="mi">5</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="bp">.</span><span class="n">ofPairs</span> <span class="o">[(</span><span class="mi">0</span><span class="o">,</span> <span class="mi">1</span><span class="o">)]),</span>
  <span class="o">((</span><span class="mi">0</span><span class="o">,</span> <span class="mi">5</span><span class="o">),</span> <span class="bp">.</span><span class="n">ofPairs</span> <span class="o">[(</span><span class="mi">0</span><span class="o">,</span> <span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">3</span><span class="o">,</span> <span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">4</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">5</span><span class="o">,</span> <span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">6</span><span class="o">,</span> <span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">7</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">8</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">9</span><span class="o">,</span> <span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">10</span><span class="o">,</span> <span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">11</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">12</span><span class="o">,</span> <span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">13</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">14</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">15</span><span class="o">,</span> <span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">16</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">17</span><span class="o">,</span> <span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">18</span><span class="o">,</span> <span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">19</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">20</span><span class="o">,</span> <span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">21</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">22</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">23</span><span class="o">,</span> <span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">24</span><span class="o">,</span> <span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">25</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">26</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">27</span><span class="o">,</span> <span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">28</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">29</span><span class="o">,</span> <span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">30</span><span class="o">,</span> <span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">31</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">)]),</span>
  <span class="o">((</span><span class="mi">2</span><span class="o">,</span> <span class="mi">4</span><span class="o">),</span> <span class="bp">.</span><span class="n">ofPairs</span> <span class="o">[(</span><span class="mi">0</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">3</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">4</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">5</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">6</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">7</span><span class="o">,</span> <span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">8</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">9</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">10</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">11</span><span class="o">,</span> <span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">12</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">13</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">14</span><span class="o">,</span> <span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">15</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">)]),</span>
  <span class="o">((</span><span class="mi">4</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="bp">.</span><span class="n">ofPairs</span> <span class="o">[(</span><span class="mi">0</span><span class="o">,</span> <span class="mi">1</span><span class="o">)]),</span>
  <span class="o">((</span><span class="mi">0</span><span class="o">,</span> <span class="mi">4</span><span class="o">),</span> <span class="bp">.</span><span class="n">ofPairs</span> <span class="o">[(</span><span class="mi">0</span><span class="o">,</span> <span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">3</span><span class="o">,</span> <span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">4</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">5</span><span class="o">,</span> <span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">6</span><span class="o">,</span> <span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">7</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">8</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">9</span><span class="o">,</span> <span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">10</span><span class="o">,</span> <span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">11</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">12</span><span class="o">,</span> <span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">13</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">14</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">15</span><span class="o">,</span> <span class="mi">1</span><span class="o">)]),</span>
  <span class="o">((</span><span class="mi">4</span><span class="o">,</span> <span class="mi">5</span><span class="o">),</span> <span class="bp">.</span><span class="n">ofPairs</span> <span class="o">[(</span><span class="mi">0</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">3</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">4</span><span class="o">,</span> <span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">5</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">6</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">7</span><span class="o">,</span> <span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">8</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">9</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">10</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">11</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">12</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">13</span><span class="o">,</span> <span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">14</span><span class="o">,</span> <span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">15</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">16</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">17</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">18</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">19</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">20</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">21</span><span class="o">,</span> <span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">22</span><span class="o">,</span> <span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">23</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">24</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">25</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">26</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">27</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">28</span><span class="o">,</span> <span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">29</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">30</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">31</span><span class="o">,</span> <span class="mi">1</span><span class="o">)]),</span>
  <span class="o">((</span><span class="mi">1</span><span class="o">,</span> <span class="mi">4</span><span class="o">),</span> <span class="bp">.</span><span class="n">ofPairs</span> <span class="o">[(</span><span class="mi">0</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">3</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">4</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">5</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">6</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">7</span><span class="o">,</span> <span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">8</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">9</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">10</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">11</span><span class="o">,</span> <span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">12</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">13</span><span class="o">,</span> <span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">14</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">15</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">)]),</span>
  <span class="o">((</span><span class="mi">1</span><span class="o">,</span> <span class="mi">5</span><span class="o">),</span> <span class="bp">.</span><span class="n">ofPairs</span> <span class="o">[(</span><span class="mi">0</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">3</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">4</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">5</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">6</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">7</span><span class="o">,</span> <span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">8</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">9</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">10</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">11</span><span class="o">,</span> <span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">12</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">13</span><span class="o">,</span> <span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">14</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">15</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">16</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">17</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">18</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">19</span><span class="o">,</span> <span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">20</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">21</span><span class="o">,</span> <span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">22</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">23</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">24</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">25</span><span class="o">,</span> <span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">26</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">27</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">28</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">29</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">30</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">31</span><span class="o">,</span> <span class="mi">1</span><span class="o">)]),</span>
  <span class="o">((</span><span class="mi">3</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="bp">.</span><span class="n">ofPairs</span> <span class="o">[(</span><span class="mi">0</span><span class="o">,</span> <span class="mi">1</span><span class="o">)]),</span>
  <span class="o">((</span><span class="mi">0</span><span class="o">,</span> <span class="mi">3</span><span class="o">),</span> <span class="bp">.</span><span class="n">ofPairs</span> <span class="o">[(</span><span class="mi">0</span><span class="o">,</span> <span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">3</span><span class="o">,</span> <span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">4</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">5</span><span class="o">,</span> <span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">6</span><span class="o">,</span> <span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">7</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">)])</span>
<span class="o">]</span> <span class="n">_</span>
</code></pre></div>
<p>It works with 25 polynomials but then 36 makes it get stuck. And I need a much bigger cache, maybe ~300 polynomials. I'm using <code>4.0.0-nightly-2022-11-14</code>. Am I doing something in a bad way? Thanks in advance!<br>
cc <span class="user-mention" data-user-id="455674">@Matej Penciak</span></p>



<a name="314458796"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Compiler%20stuck%20computing%20something.../near/314458796" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Compiler.20stuck.20computing.20something.2E.2E.2E.html#314458796">(Dec 07 2022 at 13:44)</a>:</h4>
<p>Both heap profiling and time profiling point to <code>Lean.MetavarContext.MkBinding.{visit, elim}</code>, although I'm not sure that says much other than that it's looking at a huge number of exprs for some reason, probably a loss of subterm sharing somewhere</p>



<a name="314459164"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Compiler%20stuck%20computing%20something.../near/314459164" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Compiler.20stuck.20computing.20something.2E.2E.2E.html#314459164">(Dec 07 2022 at 13:45)</a>:</h4>
<p>It seems like a bad idea that the cache used here has no upper bound that I can see</p>



<a name="314459421"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Compiler%20stuck%20computing%20something.../near/314459421" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Compiler.20stuck.20computing.20something.2E.2E.2E.html#314459421">(Dec 07 2022 at 13:47)</a>:</h4>
<p>Usually caches <em>with</em> upper bounds are the reason for things suddenly going south above a certain term size. When there is sharing, the memory used by the cache usually is the least concern.</p>



<a name="314460315"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Compiler%20stuck%20computing%20something.../near/314460315" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Compiler.20stuck.20computing.20something.2E.2E.2E.html#314460315">(Dec 07 2022 at 13:51)</a>:</h4>
<p>We saw <code>MkBinding</code> before in <a href="https://github.com/leanprover/lean4/pull/1390#issuecomment-1205107076">https://github.com/leanprover/lean4/pull/1390#issuecomment-1205107076</a>, though the leaf spending most of the time there was <code>elimMVars</code></p>



<a name="314460403"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Compiler%20stuck%20computing%20something.../near/314460403" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Compiler.20stuck.20computing.20something.2E.2E.2E.html#314460403">(Dec 07 2022 at 13:52)</a>:</h4>
<p>Sorry, I didn't understand. Should I use an upper bound? (how do I do that?)<br>
And how do I make use of the sharing Sebastian mentioned?</p>



<a name="314460742"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Compiler%20stuck%20computing%20something.../near/314460742" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Compiler.20stuck.20computing.20something.2E.2E.2E.html#314460742">(Dec 07 2022 at 13:54)</a>:</h4>
<p>You know what, I think it's the use of <code>.ofPairs</code></p>



<a name="314460806"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Compiler%20stuck%20computing%20something.../near/314460806" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Compiler.20stuck.20computing.20something.2E.2E.2E.html#314460806">(Dec 07 2022 at 13:54)</a>:</h4>
<p>This causes each subterm to get postponed and I think this messes everything up</p>



<a name="314461239"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Compiler%20stuck%20computing%20something.../near/314461239" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Compiler.20stuck.20computing.20something.2E.2E.2E.html#314461239">(Dec 07 2022 at 13:56)</a>:</h4>
<p>But also, you should be aware that lean has some known problems with large literals inside source files. You should try to use a custom elaborator to avoid some of the costs, but others can't be avoided as long as you are producing an <code>Expr</code> at the end. Deep expressions are also bad, and even if you use something with nice binary recursion the compiler will linearize it and die anyway</p>



<a name="314461454"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Compiler%20stuck%20computing%20something.../near/314461454" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Compiler.20stuck.20computing.20something.2E.2E.2E.html#314461454">(Dec 07 2022 at 13:57)</a>:</h4>
<p>Reading data externally at runtime should be fine though, e.g. loading up a huge data structure parsed from JSON</p>



<a name="314461642"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Compiler%20stuck%20computing%20something.../near/314461642" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Compiler.20stuck.20computing.20something.2E.2E.2E.html#314461642">(Dec 07 2022 at 13:58)</a>:</h4>
<p>I tried replacing <code>.ofPairs</code> by <code>.ofList ... _</code> and had the same issue</p>



<a name="314461708"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Compiler%20stuck%20computing%20something.../near/314461708" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Compiler.20stuck.20computing.20something.2E.2E.2E.html#314461708">(Dec 07 2022 at 13:59)</a>:</h4>
<p>you're still using dot-ident there</p>



<a name="314461744"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Compiler%20stuck%20computing%20something.../near/314461744" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Compiler.20stuck.20computing.20something.2E.2E.2E.html#314461744">(Dec 07 2022 at 13:59)</a>:</h4>
<p>Use <code>MultilinearPolynomial.ofPairs</code></p>



<a name="314461871"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Compiler%20stuck%20computing%20something.../near/314461871" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Compiler.20stuck.20computing.20something.2E.2E.2E.html#314461871">(Dec 07 2022 at 13:59)</a>:</h4>
<p>Lean doesn't know the type of that slot until it elaborates everything else</p>



<a name="314462060"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Compiler%20stuck%20computing%20something.../near/314462060" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Compiler.20stuck.20computing.20something.2E.2E.2E.html#314462060">(Dec 07 2022 at 14:00)</a>:</h4>
<p>and I think the repeated re-elaboration is generating a lot of allocations</p>



<a name="314462403"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Compiler%20stuck%20computing%20something.../near/314462403" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Compiler.20stuck.20computing.20something.2E.2E.2E.html#314462403">(Dec 07 2022 at 14:02)</a>:</h4>
<p>It solved the issue <span aria-label="open mouth" class="emoji emoji-1f62e" role="img" title="open mouth">:open_mouth:</span> thanks!!</p>



<a name="314463075"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Compiler%20stuck%20computing%20something.../near/314463075" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Compiler.20stuck.20computing.20something.2E.2E.2E.html#314463075">(Dec 07 2022 at 14:05)</a>:</h4>
<p>Hmm, <code>elabDotIdent</code> should probably suspend immediately when the expected type is not known</p>



<a name="314463182"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Compiler%20stuck%20computing%20something.../near/314463182" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Compiler.20stuck.20computing.20something.2E.2E.2E.html#314463182">(Dec 07 2022 at 14:05)</a>:</h4>
<p>But there's still some hanging going on. I will remove the nesting with <code>RB</code> stuff and just cache simple types like lists and pairs</p>



<a name="314463283"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Compiler%20stuck%20computing%20something.../near/314463283" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Compiler.20stuck.20computing.20something.2E.2E.2E.html#314463283">(Dec 07 2022 at 14:06)</a>:</h4>
<p>The error message here should give you some sense of what lean is having to deal with to elaborate this expression:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">def</span> <span class="n">multilinearLagrangePolynomialCache</span> <span class="o">:</span>
    <span class="n">List</span> <span class="o">((</span><span class="n">Nat</span> <span class="bp">×</span> <span class="n">Nat</span><span class="o">)</span> <span class="bp">×</span> <span class="n">MultilinearPolynomial</span> <span class="o">(</span><span class="n">Zmod</span> <span class="n">n</span><span class="o">))</span> <span class="o">:=</span> <span class="o">[</span>
  <span class="o">((</span><span class="mi">2</span><span class="o">,</span> <span class="mi">3</span><span class="o">),</span> <span class="bp">.</span><span class="n">ofPairs</span> <span class="o">[]),</span>
  <span class="o">((</span><span class="mi">5</span><span class="o">,</span> <span class="mi">3</span><span class="o">),</span> <span class="bp">.</span><span class="n">ofPairs</span> <span class="o">[]),</span>
  <span class="o">((</span><span class="mi">2</span><span class="o">,</span> <span class="mi">1</span><span class="o">),</span> <span class="bp">.</span><span class="n">ofPairs</span> <span class="o">[]),</span>
  <span class="o">((</span><span class="mi">3</span><span class="o">,</span> <span class="mi">2</span><span class="o">),</span> <span class="bp">.</span><span class="n">ofPairs</span> <span class="o">[]),</span>
  <span class="o">((</span><span class="mi">1</span><span class="o">,</span> <span class="mi">3</span><span class="o">),</span> <span class="bp">.</span><span class="n">ofPairs</span> <span class="o">[]),</span>
  <span class="o">((</span><span class="mi">4</span><span class="o">,</span> <span class="mi">1</span><span class="o">),</span> <span class="bp">.</span><span class="n">ofPairs</span> <span class="o">[]),</span>
  <span class="o">((</span><span class="mi">5</span><span class="o">,</span> <span class="mi">4</span><span class="o">),</span> <span class="bp">.</span><span class="n">ofPairs</span> <span class="o">[]),</span>
  <span class="o">((</span><span class="mi">0</span><span class="o">,</span> <span class="mi">2</span><span class="o">),</span> <span class="bp">.</span><span class="n">ofPairs</span> <span class="o">[]),</span>
  <span class="o">((</span><span class="mi">0</span><span class="o">,</span> <span class="mi">1</span><span class="o">),</span> <span class="bp">.</span><span class="n">ofPairs</span> <span class="o">[]),</span>
  <span class="o">((</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">),</span> <span class="bp">.</span><span class="n">ofPairs</span> <span class="o">[]),</span>
  <span class="o">((</span><span class="mi">2</span><span class="o">,</span> <span class="mi">2</span><span class="o">),</span> <span class="bp">.</span><span class="n">ofPairs</span> <span class="o">[]),</span>
  <span class="o">((</span><span class="mi">3</span><span class="o">,</span> <span class="mi">3</span><span class="o">),</span> <span class="bp">.</span><span class="n">ofPairs</span> <span class="o">[]),</span>
  <span class="o">((</span><span class="mi">4</span><span class="o">,</span> <span class="mi">2</span><span class="o">),</span> <span class="bp">.</span><span class="n">ofPairs</span> <span class="o">[]),</span>
  <span class="o">((</span><span class="mi">2</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="bp">.</span><span class="n">ofPairs</span> <span class="o">[]),</span>
  <span class="o">((</span><span class="mi">2</span><span class="o">,</span> <span class="mi">5</span><span class="o">),</span> <span class="bp">.</span><span class="n">ofPairs</span> <span class="o">[]),</span>
  <span class="o">((</span><span class="mi">3</span><span class="o">,</span> <span class="mi">1</span><span class="o">),</span> <span class="bp">.</span><span class="n">ofPairs</span> <span class="o">[]),</span>
  <span class="o">((</span><span class="mi">5</span><span class="o">,</span> <span class="mi">2</span><span class="o">),</span> <span class="bp">.</span><span class="n">ofPairs</span> <span class="o">[]),</span>
  <span class="o">((</span><span class="mi">5</span><span class="o">,</span> <span class="mi">1</span><span class="o">),</span> <span class="bp">.</span><span class="n">ofPairs</span> <span class="o">[]),</span>
  <span class="o">((</span><span class="mi">4</span><span class="o">,</span> <span class="mi">3</span><span class="o">),</span> <span class="bp">.</span><span class="n">ofPairs</span> <span class="o">[]),</span>
  <span class="o">((</span><span class="mi">1</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="bp">.</span><span class="n">ofPairs</span> <span class="o">[]),</span>
  <span class="o">((</span><span class="mi">5</span><span class="o">,</span> <span class="mi">5</span><span class="o">),</span> <span class="bp">.</span><span class="n">ofPairs</span> <span class="o">[]),</span>
  <span class="o">((</span><span class="mi">0</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="bp">.</span><span class="n">ofPairs</span> <span class="o">[]),</span>
  <span class="o">((</span><span class="mi">3</span><span class="o">,</span> <span class="mi">5</span><span class="o">),</span> <span class="bp">.</span><span class="n">ofPairs</span> <span class="o">[]),</span>
  <span class="o">((</span><span class="mi">4</span><span class="o">,</span> <span class="mi">4</span><span class="o">),</span> <span class="bp">.</span><span class="n">ofPairs</span> <span class="o">[]),</span>
  <span class="o">((</span><span class="mi">1</span><span class="o">,</span> <span class="mi">1</span><span class="o">),</span> <span class="bp">.</span><span class="n">ofPairs</span> <span class="o">[]),</span>
  <span class="o">((</span><span class="mi">3</span><span class="o">,</span> <span class="mi">4</span><span class="o">),</span> <span class="bp">.</span><span class="n">ofPairs</span> <span class="o">[]),</span>
  <span class="o">((</span><span class="mi">5</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="bp">.</span><span class="n">ofPairs</span> <span class="o">[]),</span>
  <span class="o">((</span><span class="mi">0</span><span class="o">,</span> <span class="mi">5</span><span class="o">),</span> <span class="bp">.</span><span class="n">ofPairs</span> <span class="o">[]),</span>
  <span class="o">((</span><span class="mi">2</span><span class="o">,</span> <span class="mi">4</span><span class="o">),</span> <span class="bp">.</span><span class="n">ofPairs</span> <span class="o">[]),</span>
  <span class="o">((</span><span class="mi">4</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="bp">.</span><span class="n">ofPairs</span> <span class="o">[]),</span>
  <span class="o">((</span><span class="mi">0</span><span class="o">,</span> <span class="mi">4</span><span class="o">),</span> <span class="bp">.</span><span class="n">ofPairs</span> <span class="o">[]),</span>
  <span class="o">((</span><span class="mi">4</span><span class="o">,</span> <span class="mi">5</span><span class="o">),</span> <span class="bp">.</span><span class="n">ofPairs</span> <span class="o">[]),</span>
  <span class="o">((</span><span class="mi">1</span><span class="o">,</span> <span class="mi">4</span><span class="o">),</span> <span class="bp">.</span><span class="n">ofPairs</span> <span class="o">[]),</span>
  <span class="o">((</span><span class="mi">1</span><span class="o">,</span> <span class="mi">5</span><span class="o">),</span> <span class="bp">.</span><span class="n">ofPairs</span> <span class="o">[]),</span>
  <span class="o">((</span><span class="mi">3</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="bp">.</span><span class="n">ofPairs</span> <span class="o">[]),</span>
  <span class="o">((</span><span class="mi">0</span><span class="o">,</span> <span class="mi">3</span><span class="o">),</span> <span class="bp">.</span><span class="n">ofPairs</span> <span class="o">[])</span>
<span class="o">]</span> <span class="n">_</span>
</code></pre></div>



<a name="314463620"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Compiler%20stuck%20computing%20something.../near/314463620" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Compiler.20stuck.20computing.20something.2E.2E.2E.html#314463620">(Dec 07 2022 at 14:08)</a>:</h4>
<p>we end up with a ton of metavariables in a ton of distinct contexts because of all the let statements, which is basically a worst case for the elaborator</p>



<a name="314464024"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Compiler%20stuck%20computing%20something.../near/314464024" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Compiler.20stuck.20computing.20something.2E.2E.2E.html#314464024">(Dec 07 2022 at 14:09)</a>:</h4>
<p>I thought the let-macro for list literals didn't trigger until length 64 though</p>



<a name="314464530"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Compiler%20stuck%20computing%20something.../near/314464530" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Compiler.20stuck.20computing.20something.2E.2E.2E.html#314464530">(Dec 07 2022 at 14:11)</a>:</h4>
<p><code>elemsAndSeps.size &lt; 64</code>, note the <code>And</code></p>



<a name="314464741"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Compiler%20stuck%20computing%20something.../near/314464741" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Compiler.20stuck.20computing.20something.2E.2E.2E.html#314464741">(Dec 07 2022 at 14:12)</a>:</h4>
<p>This is my plan for caching:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">def</span> <span class="n">multilinearLagrangePolynomialCacheData</span> <span class="o">:</span> <span class="n">List</span> <span class="bp">$</span> <span class="o">(</span><span class="n">Nat</span> <span class="bp">×</span> <span class="n">Nat</span><span class="o">)</span> <span class="bp">×</span> <span class="n">List</span> <span class="o">(</span><span class="n">Nat</span> <span class="bp">×</span> <span class="n">Int</span><span class="o">)</span> <span class="o">:=</span> <span class="o">[</span>
  <span class="o">((</span><span class="mi">1</span><span class="o">,</span> <span class="mi">1</span><span class="o">),</span> <span class="o">[(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">1</span><span class="o">)]),</span>
  <span class="o">((</span><span class="mi">3</span><span class="o">,</span> <span class="mi">1</span><span class="o">),</span> <span class="o">[(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">1</span><span class="o">)]),</span>
  <span class="o">((</span><span class="mi">4</span><span class="o">,</span> <span class="mi">4</span><span class="o">),</span> <span class="o">[(</span><span class="mi">4</span><span class="o">,</span> <span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">5</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">6</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">7</span><span class="o">,</span> <span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">12</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">13</span><span class="o">,</span> <span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">14</span><span class="o">,</span> <span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">15</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">)]),</span>
  <span class="o">((</span><span class="mi">1</span><span class="o">,</span> <span class="mi">3</span><span class="o">),</span> <span class="o">[(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">3</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">5</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">7</span><span class="o">,</span> <span class="mi">1</span><span class="o">)]),</span>
  <span class="o">((</span><span class="mi">3</span><span class="o">,</span> <span class="mi">4</span><span class="o">),</span> <span class="o">[(</span><span class="mi">3</span><span class="o">,</span> <span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">7</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">11</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">15</span><span class="o">,</span> <span class="mi">1</span><span class="o">)]),</span>
  <span class="o">((</span><span class="mi">2</span><span class="o">,</span> <span class="mi">3</span><span class="o">),</span> <span class="o">[(</span><span class="mi">2</span><span class="o">,</span> <span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">3</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">6</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">7</span><span class="o">,</span> <span class="mi">1</span><span class="o">)]),</span>
  <span class="o">((</span><span class="mi">0</span><span class="o">,</span> <span class="mi">4</span><span class="o">),</span> <span class="o">[(</span><span class="mi">0</span><span class="o">,</span> <span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">3</span><span class="o">,</span> <span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">4</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">5</span><span class="o">,</span> <span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">6</span><span class="o">,</span> <span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">7</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">8</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">9</span><span class="o">,</span> <span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">10</span><span class="o">,</span> <span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">11</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">12</span><span class="o">,</span> <span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">13</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">14</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">15</span><span class="o">,</span> <span class="mi">1</span><span class="o">)]),</span>
  <span class="o">((</span><span class="mi">0</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">[(</span><span class="mi">0</span><span class="o">,</span> <span class="mi">1</span><span class="o">)]),</span>
  <span class="o">((</span><span class="mi">3</span><span class="o">,</span> <span class="mi">2</span><span class="o">),</span> <span class="o">[(</span><span class="mi">3</span><span class="o">,</span> <span class="mi">1</span><span class="o">)]),</span>
  <span class="o">((</span><span class="mi">1</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">[(</span><span class="mi">0</span><span class="o">,</span> <span class="mi">1</span><span class="o">)]),</span>
  <span class="o">((</span><span class="mi">3</span><span class="o">,</span> <span class="mi">3</span><span class="o">),</span> <span class="o">[(</span><span class="mi">3</span><span class="o">,</span> <span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">7</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">)]),</span>
  <span class="o">((</span><span class="mi">2</span><span class="o">,</span> <span class="mi">2</span><span class="o">),</span> <span class="o">[(</span><span class="mi">2</span><span class="o">,</span> <span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">3</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">)]),</span>
  <span class="o">((</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">),</span> <span class="o">[(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">3</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">)]),</span>
  <span class="o">((</span><span class="mi">3</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">[(</span><span class="mi">0</span><span class="o">,</span> <span class="mi">1</span><span class="o">)]),</span>
  <span class="o">((</span><span class="mi">0</span><span class="o">,</span> <span class="mi">3</span><span class="o">),</span> <span class="o">[(</span><span class="mi">0</span><span class="o">,</span> <span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">3</span><span class="o">,</span> <span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">4</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">5</span><span class="o">,</span> <span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">6</span><span class="o">,</span> <span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">7</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">)]),</span>
  <span class="o">((</span><span class="mi">4</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">[(</span><span class="mi">0</span><span class="o">,</span> <span class="mi">1</span><span class="o">)]),</span>
  <span class="o">((</span><span class="mi">4</span><span class="o">,</span> <span class="mi">2</span><span class="o">),</span> <span class="o">[(</span><span class="mi">0</span><span class="o">,</span> <span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">3</span><span class="o">,</span> <span class="mi">1</span><span class="o">)]),</span>
  <span class="o">((</span><span class="mi">0</span><span class="o">,</span> <span class="mi">1</span><span class="o">),</span> <span class="o">[(</span><span class="mi">0</span><span class="o">,</span> <span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">)]),</span>
  <span class="o">((</span><span class="mi">2</span><span class="o">,</span> <span class="mi">4</span><span class="o">),</span> <span class="o">[(</span><span class="mi">2</span><span class="o">,</span> <span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">3</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">6</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">7</span><span class="o">,</span> <span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">10</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">11</span><span class="o">,</span> <span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">14</span><span class="o">,</span> <span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">15</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">)]),</span>
  <span class="o">((</span><span class="mi">0</span><span class="o">,</span> <span class="mi">2</span><span class="o">),</span> <span class="o">[(</span><span class="mi">0</span><span class="o">,</span> <span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">3</span><span class="o">,</span> <span class="mi">1</span><span class="o">)]),</span>
  <span class="o">((</span><span class="mi">4</span><span class="o">,</span> <span class="mi">1</span><span class="o">),</span> <span class="o">[(</span><span class="mi">0</span><span class="o">,</span> <span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">)]),</span>
  <span class="o">((</span><span class="mi">2</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">[(</span><span class="mi">0</span><span class="o">,</span> <span class="mi">1</span><span class="o">)]),</span>
  <span class="o">((</span><span class="mi">4</span><span class="o">,</span> <span class="mi">3</span><span class="o">),</span> <span class="o">[(</span><span class="mi">4</span><span class="o">,</span> <span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">5</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">6</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">7</span><span class="o">,</span> <span class="mi">1</span><span class="o">)]),</span>
  <span class="o">((</span><span class="mi">1</span><span class="o">,</span> <span class="mi">4</span><span class="o">),</span> <span class="o">[(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">3</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">5</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">7</span><span class="o">,</span> <span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">9</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">11</span><span class="o">,</span> <span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">13</span><span class="o">,</span> <span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">15</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">)]),</span>
  <span class="o">((</span><span class="mi">2</span><span class="o">,</span> <span class="mi">1</span><span class="o">),</span> <span class="o">[(</span><span class="mi">0</span><span class="o">,</span> <span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">)])</span>
<span class="o">]</span>
</code></pre></div>
<p>That shouldn't raise any red flag, right? No metavariables involved as far as I can see</p>



<a name="314464836"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Compiler%20stuck%20computing%20something.../near/314464836" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Compiler.20stuck.20computing.20something.2E.2E.2E.html#314464836">(Dec 07 2022 at 14:13)</a>:</h4>
<p>Don't use long list literals if you can avoid it</p>



<a name="314464864"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Compiler%20stuck%20computing%20something.../near/314464864" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Compiler.20stuck.20computing.20something.2E.2E.2E.html#314464864">(Dec 07 2022 at 14:13)</a>:</h4>
<p>longer than <del>64</del> 32 elements</p>



<a name="314464996"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Compiler%20stuck%20computing%20something.../near/314464996" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Compiler.20stuck.20computing.20something.2E.2E.2E.html#314464996">(Dec 07 2022 at 14:14)</a>:</h4>
<p>How can I cache then? I can't be in IO</p>



<a name="314465134"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Compiler%20stuck%20computing%20something.../near/314465134" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Compiler.20stuck.20computing.20something.2E.2E.2E.html#314465134">(Dec 07 2022 at 14:14)</a>:</h4>
<p>Should we simply have a custom elaborator for list literals?</p>



<a name="314465139"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Compiler%20stuck%20computing%20something.../near/314465139" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Compiler.20stuck.20computing.20something.2E.2E.2E.html#314465139">(Dec 07 2022 at 14:14)</a>:</h4>
<p>you can use an <code>init</code> declaration</p>



<a name="314465146"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Compiler%20stuck%20computing%20something.../near/314465146" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Compiler.20stuck.20computing.20something.2E.2E.2E.html#314465146">(Dec 07 2022 at 14:14)</a>:</h4>
<p>the macro is terrible and needs to be replaced but last time someone posted about this leo basically said this only comes up in code which is misusing lean anyway so it's not a high priority</p>



<a name="314465170"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Compiler%20stuck%20computing%20something.../near/314465170" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Compiler.20stuck.20computing.20something.2E.2E.2E.html#314465170">(Dec 07 2022 at 14:14)</a>:</h4>
<p>I was planning on doing just that</p>



<a name="314465334"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Compiler%20stuck%20computing%20something.../near/314465334" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Compiler.20stuck.20computing.20something.2E.2E.2E.html#314465334">(Dec 07 2022 at 14:15)</a>:</h4>
<p>Where can I find an example of an <code>init</code> declaration?</p>



<a name="314465474"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Compiler%20stuck%20computing%20something.../near/314465474" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Compiler.20stuck.20computing.20something.2E.2E.2E.html#314465474">(Dec 07 2022 at 14:16)</a>:</h4>
<p><code>initialize foo : HashMap A B &lt;- (bla : IO (HashMap A B))</code></p>



<a name="314465908"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Compiler%20stuck%20computing%20something.../near/314465908" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Compiler.20stuck.20computing.20something.2E.2E.2E.html#314465908">(Dec 07 2022 at 14:18)</a>:</h4>
<p>It doesn't really solve the problem of storing high information content definitions in <code>Expr</code> though, since it's still a regular declaration</p>



<a name="314466117"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Compiler%20stuck%20computing%20something.../near/314466117" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Compiler.20stuck.20computing.20something.2E.2E.2E.html#314466117">(Dec 07 2022 at 14:19)</a>:</h4>
<p>but it's generally a good idea not to lean on the elaborator too hard in such definitions, write things with explicit types</p>



<a name="314466311"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Compiler%20stuck%20computing%20something.../near/314466311" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Compiler.20stuck.20computing.20something.2E.2E.2E.html#314466311">(Dec 07 2022 at 14:20)</a>:</h4>
<p>But the list I wrote only has simple types</p>



<a name="314466453"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Compiler%20stuck%20computing%20something.../near/314466453" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Compiler.20stuck.20computing.20something.2E.2E.2E.html#314466453">(Dec 07 2022 at 14:21)</a>:</h4>
<p>Should I write a custom elaborator for lists then? Is the <code>[]</code> syntax the issue?</p>



<a name="314466615"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Compiler%20stuck%20computing%20something.../near/314466615" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Compiler.20stuck.20computing.20something.2E.2E.2E.html#314466615">(Dec 07 2022 at 14:21)</a>:</h4>
<p>yes, it's a major component of the problem in this case</p>



<a name="314466750"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Compiler%20stuck%20computing%20something.../near/314466750" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Compiler.20stuck.20computing.20something.2E.2E.2E.html#314466750">(Dec 07 2022 at 14:22)</a>:</h4>
<p>I would use a custom DSL to make the input terser anyway</p>



<a name="314467845"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Compiler%20stuck%20computing%20something.../near/314467845" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Compiler.20stuck.20computing.20something.2E.2E.2E.html#314467845">(Dec 07 2022 at 14:27)</a>:</h4>
<p>Alright, thanks! I'll report back after trying it</p>



<a name="314474270"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Compiler%20stuck%20computing%20something.../near/314474270" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Compiler.20stuck.20computing.20something.2E.2E.2E.html#314474270">(Dec 07 2022 at 14:54)</a>:</h4>
<p>Does the <code>#[]</code> syntax suffer from the same issue?</p>



<a name="314499809"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Compiler%20stuck%20computing%20something.../near/314499809" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Compiler.20stuck.20computing.20something.2E.2E.2E.html#314499809">(Dec 07 2022 at 16:25)</a>:</h4>
<p>Hmm, I'm getting the following error with the DSL:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">maximum</span> <span class="n">recursion</span> <span class="n">depth</span> <span class="n">has</span> <span class="n">been</span> <span class="n">reached</span> <span class="o">(</span><span class="n">use</span> <span class="bp">`</span><span class="kd">set_option</span> <span class="n">maxRecDepth</span> <span class="bp">&lt;</span><span class="n">num</span><span class="bp">&gt;`</span> <span class="n">to</span> <span class="n">increase</span> <span class="n">limit</span><span class="o">)</span>
</code></pre></div>



<a name="314507049"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Compiler%20stuck%20computing%20something.../near/314507049" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Compiler.20stuck.20computing.20something.2E.2E.2E.html#314507049">(Dec 07 2022 at 16:54)</a>:</h4>
<p>This is the cache file with the DSL:<br>
<a href="https://github.com/yatima-inc/YatimaStdLib.lean/blob/ap/multilinear-extension/YatimaStdLib/MLE/Cache.lean">https://github.com/yatima-inc/YatimaStdLib.lean/blob/ap/multilinear-extension/YatimaStdLib/MLE/Cache.lean</a></p>
<p>Why is it reaching the maximum recursion depth?</p>



<a name="314507166"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Compiler%20stuck%20computing%20something.../near/314507166" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Compiler.20stuck.20computing.20something.2E.2E.2E.html#314507166">(Dec 07 2022 at 16:55)</a>:</h4>
<p>Well, not that version. But it crashes if I add like 100 lines</p>



<a name="314541248"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Compiler%20stuck%20computing%20something.../near/314541248" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Compiler.20stuck.20computing.20something.2E.2E.2E.html#314541248">(Dec 07 2022 at 19:25)</a>:</h4>
<p>Is there something I'm doing wrong in the DSL elaborator?<br>
<a href="https://github.com/yatima-inc/YatimaStdLib.lean/blob/ap/multilinear-extension/YatimaStdLib/MLE/CacheDSL.lean">https://github.com/yatima-inc/YatimaStdLib.lean/blob/ap/multilinear-extension/YatimaStdLib/MLE/CacheDSL.lean</a></p>



<a name="314587521"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Compiler%20stuck%20computing%20something.../near/314587521" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Compiler.20stuck.20computing.20something.2E.2E.2E.html#314587521">(Dec 08 2022 at 01:12)</a>:</h4>
<p>Why is mkListLit not tail recursive? It should be written using a foldr</p>



<a name="314588613"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Compiler%20stuck%20computing%20something.../near/314588613" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Compiler.20stuck.20computing.20something.2E.2E.2E.html#314588613">(Dec 08 2022 at 01:29)</a>:</h4>
<p>You mean the function from core, right?</p>



<a name="314588621"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Compiler%20stuck%20computing%20something.../near/314588621" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Compiler.20stuck.20computing.20something.2E.2E.2E.html#314588621">(Dec 08 2022 at 01:29)</a>:</h4>
<p>Maybe I can make a customized version</p>



<a name="314589382"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Compiler%20stuck%20computing%20something.../near/314589382" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Compiler.20stuck.20computing.20something.2E.2E.2E.html#314589382">(Dec 08 2022 at 01:40)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">def</span> <span class="n">mkListLit</span> <span class="o">(</span><span class="n">type</span> <span class="o">:</span> <span class="n">Expr</span><span class="o">)</span> <span class="o">(</span><span class="n">xs</span> <span class="o">:</span> <span class="n">List</span> <span class="n">Expr</span><span class="o">)</span> <span class="o">:</span> <span class="n">MetaM</span> <span class="n">Expr</span> <span class="o">:=</span> <span class="k">do</span>
  <span class="k">let</span> <span class="n">u</span> <span class="bp">←</span> <span class="n">getDecLevel</span> <span class="n">type</span>
  <span class="k">let</span> <span class="n">cons</span> <span class="o">:=</span> <span class="bp">.</span><span class="n">const</span> <span class="bp">``</span><span class="n">List.cons</span> <span class="o">[</span><span class="n">u</span><span class="o">]</span>
  <span class="n">return</span> <span class="n">xs.foldr</span> <span class="o">(</span><span class="n">init</span> <span class="o">:=</span> <span class="n">mkApp</span> <span class="o">(</span><span class="n">mkConst</span> <span class="bp">``</span><span class="n">List.nil</span> <span class="o">[</span><span class="n">u</span><span class="o">])</span> <span class="n">type</span><span class="o">)</span> <span class="k">fun</span> <span class="n">e</span> <span class="n">acc</span> <span class="bp">=&gt;</span>
    <span class="n">mkApp</span> <span class="o">(</span><span class="n">mkApp</span> <span class="o">(</span><span class="n">mkApp</span> <span class="n">cons</span> <span class="n">type</span><span class="o">)</span> <span class="n">e</span><span class="o">)</span> <span class="n">acc</span>
</code></pre></div>



<a name="314589625"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Compiler%20stuck%20computing%20something.../near/314589625" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Compiler.20stuck.20computing.20something.2E.2E.2E.html#314589625">(Dec 08 2022 at 01:44)</a>:</h4>
<p>Still reaching maximum depth tho <span aria-label="dizzy" class="emoji emoji-1f635" role="img" title="dizzy">:dizzy:</span></p>



<a name="314589840"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Compiler%20stuck%20computing%20something.../near/314589840" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Compiler.20stuck.20computing.20something.2E.2E.2E.html#314589840">(Dec 08 2022 at 01:48)</a>:</h4>
<p>My next attempt will be using an initializer, reading the cached polynomials from a JSON file</p>



<a name="314589858"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Compiler%20stuck%20computing%20something.../near/314589858" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Compiler.20stuck.20computing.20something.2E.2E.2E.html#314589858">(Dec 08 2022 at 01:48)</a>:</h4>
<p>I think that's a good idea</p>



<a name="314589879"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Compiler%20stuck%20computing%20something.../near/314589879" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Compiler.20stuck.20computing.20something.2E.2E.2E.html#314589879">(Dec 08 2022 at 01:49)</a>:</h4>
<p>Another suggestion I have is to try using <code>List.append</code> in a binary tree for long enough lists; this is kind of like what the macro was doing but without all the let stuff</p>



<a name="314589964"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Compiler%20stuck%20computing%20something.../near/314589964" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Compiler.20stuck.20computing.20something.2E.2E.2E.html#314589964">(Dec 08 2022 at 01:50)</a>:</h4>
<p><code>List.append</code> in a binary tree? How come?</p>



<a name="314589991"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Compiler%20stuck%20computing%20something.../near/314589991" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Compiler.20stuck.20computing.20something.2E.2E.2E.html#314589991">(Dec 08 2022 at 01:51)</a>:</h4>
<p>that is, replace <code>[x1, ...., x2n]</code> with <code>[x1, ..., xn] ++ [x(n+1), ..., x2n]</code></p>



<a name="314590002"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Compiler%20stuck%20computing%20something.../near/314590002" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Compiler.20stuck.20computing.20something.2E.2E.2E.html#314590002">(Dec 08 2022 at 01:51)</a>:</h4>
<p>It decreases the depth of the expr</p>



<a name="314590146"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Compiler%20stuck%20computing%20something.../near/314590146" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Compiler.20stuck.20computing.20something.2E.2E.2E.html#314590146">(Dec 08 2022 at 01:53)</a>:</h4>
<p>this is important because most lean internal functions on <code>Expr</code> are not tail recursive, they use the C stack directly and there is no stack splitting fallback so a lot of stuff struggles not to blow the stack</p>



<a name="314590346"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Compiler%20stuck%20computing%20something.../near/314590346" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Compiler.20stuck.20computing.20something.2E.2E.2E.html#314590346">(Dec 08 2022 at 01:57)</a>:</h4>
<p>That's a good thing to learn! But I feel like I should just quit this strategy of caching values on a Lean file via an <a href="https://github.com/yatima-inc/YatimaStdLib.lean/blob/f260374c9e081ff8444cd2e7242d445bed8edc53/YatimaStdLib/MLE/MultilinearExtension.lean#L29"><code>IO</code> function</a> that (over)writes Lean code</p>



<a name="314590513"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Compiler%20stuck%20computing%20something.../near/314590513" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Compiler.20stuck.20computing.20something.2E.2E.2E.html#314590513">(Dec 08 2022 at 01:59)</a>:</h4>
<p>oh yeah, autogenerated lean files are always hit the hardest by these kind of restrictions</p>



<a name="314590693"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Compiler%20stuck%20computing%20something.../near/314590693" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Compiler.20stuck.20computing.20something.2E.2E.2E.html#314590693">(Dec 08 2022 at 02:02)</a>:</h4>
<p>I might come back asking for help on initializers on another thread though. But for now I'm satisfied with my current understanding. Thanks for all the help!</p>



<a name="314590922"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Compiler%20stuck%20computing%20something.../near/314590922" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Compiler.20stuck.20computing.20something.2E.2E.2E.html#314590922">(Dec 08 2022 at 02:05)</a>:</h4>
<p><span class="user-mention silent" data-user-id="451983">Arthur Paulino</span> <a href="#narrow/stream/270676-lean4/topic/Compiler.20stuck.20computing.20something.2E.2E.2E/near/314589382">said</a>:</p>
<blockquote>
<p><div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">def</span> <span class="n">mkListLit</span> <span class="o">(</span><span class="n">type</span> <span class="o">:</span> <span class="n">Expr</span><span class="o">)</span> <span class="o">(</span><span class="n">xs</span> <span class="o">:</span> <span class="n">List</span> <span class="n">Expr</span><span class="o">)</span> <span class="o">:</span> <span class="n">MetaM</span> <span class="n">Expr</span> <span class="o">:=</span> <span class="k">do</span>
  <span class="k">let</span> <span class="n">u</span> <span class="bp">←</span> <span class="n">getDecLevel</span> <span class="n">type</span>
  <span class="k">let</span> <span class="n">cons</span> <span class="o">:=</span> <span class="bp">.</span><span class="n">const</span> <span class="bp">``</span><span class="n">List.cons</span> <span class="o">[</span><span class="n">u</span><span class="o">]</span>
  <span class="n">return</span> <span class="n">xs.foldr</span> <span class="o">(</span><span class="n">init</span> <span class="o">:=</span> <span class="n">mkApp</span> <span class="o">(</span><span class="n">mkConst</span> <span class="bp">``</span><span class="n">List.nil</span> <span class="o">[</span><span class="n">u</span><span class="o">])</span> <span class="n">type</span><span class="o">)</span> <span class="k">fun</span> <span class="n">e</span> <span class="n">acc</span> <span class="bp">=&gt;</span>
    <span class="n">mkApp</span> <span class="o">(</span><span class="n">mkApp</span> <span class="o">(</span><span class="n">mkApp</span> <span class="n">cons</span> <span class="n">type</span><span class="o">)</span> <span class="n">e</span><span class="o">)</span> <span class="n">acc</span>
</code></pre></div><br>
</p>
</blockquote>
<p>But that could be upstreamed to core regardless</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>