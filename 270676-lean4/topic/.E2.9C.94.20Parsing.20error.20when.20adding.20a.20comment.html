---
layout: archive
title: Zulip Chat Archive
permalink: /stream/270676-lean4/topic/.E2.9C.94.20Parsing.20error.20when.20adding.20a.20comment.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/index.html">lean4</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.E2.9C.94.20Parsing.20error.20when.20adding.20a.20comment.html">✔ Parsing error when adding a comment</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="270478255"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%E2%9C%94%20Parsing%20error%20when%20adding%20a%20comment/near/270478255" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> František Silváši <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.E2.9C.94.20Parsing.20error.20when.20adding.20a.20comment.html#270478255">(Feb 02 2022 at 23:55)</a>:</h4>
<p>On <code>leanprover/lean4:nightly-2022-02-02</code>, the following does not compile with an error <code>expected 'abbrev', 'axiom', 'class', 'constant', 'def', 'elab', 'elab_rules', 'example', 'inductive', 'instance', 'macro', 'macro_rules', 'structure', 'syntax' or 'theorem'</code>.</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="sd">/-- Foo is a function! -/</span>
<span class="kn">open</span> <span class="n">Nat</span> <span class="k">in</span>
<span class="kd">def</span> <span class="n">foo</span> <span class="o">:</span> <span class="n">Nat</span> <span class="o">:=</span> <span class="mi">42</span>
<span class="c1">-- Error.</span>
</code></pre></div>
<p>Removing the preceding comment fixes the issue.</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">open</span> <span class="n">Nat</span> <span class="k">in</span>
<span class="kd">def</span> <span class="n">foo</span> <span class="o">:</span> <span class="n">Nat</span> <span class="o">:=</span> <span class="mi">42</span>
<span class="c1">-- Compiles ok.</span>
</code></pre></div>
<p>Bug or feature?</p>



<a name="270478354"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%E2%9C%94%20Parsing%20error%20when%20adding%20a%20comment/near/270478354" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.E2.9C.94.20Parsing.20error.20when.20adding.20a.20comment.html#270478354">(Feb 02 2022 at 23:56)</a>:</h4>
<p>The comment has to come after the <code>open in</code></p>



<a name="270478384"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%E2%9C%94%20Parsing%20error%20when%20adding%20a%20comment/near/270478384" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.E2.9C.94.20Parsing.20error.20when.20adding.20a.20comment.html#270478384">(Feb 02 2022 at 23:56)</a>:</h4>
<p>otherwise it will be commenting the generated <code>section</code></p>



<a name="270478417"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%E2%9C%94%20Parsing%20error%20when%20adding%20a%20comment/near/270478417" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> František Silváši <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.E2.9C.94.20Parsing.20error.20when.20adding.20a.20comment.html#270478417">(Feb 02 2022 at 23:56)</a>:</h4>
<p>Oh so <code>open in</code> creates an ad hoc <code>section</code>, I understand now. Thank you.</p>



<a name="270478423"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%E2%9C%94%20Parsing%20error%20when%20adding%20a%20comment/near/270478423" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Notification Bot <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.E2.9C.94.20Parsing.20error.20when.20adding.20a.20comment.html#270478423">(Feb 02 2022 at 23:56)</a>:</h4>
<p><span class="user-mention silent" data-user-id="364929">František Silváši</span> has marked this topic as resolved.</p>



<a name="270479953"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%E2%9C%94%20Parsing%20error%20when%20adding%20a%20comment/near/270479953" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.E2.9C.94.20Parsing.20error.20when.20adding.20a.20comment.html#270479953">(Feb 03 2022 at 00:11)</a>:</h4>
<p>That seems a bit awkward if the docstring is, say, 20 lines long</p>



<a name="270480059"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%E2%9C%94%20Parsing%20error%20when%20adding%20a%20comment/near/270480059" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.E2.9C.94.20Parsing.20error.20when.20adding.20a.20comment.html#270480059">(Feb 03 2022 at 00:12)</a>:</h4>
<p>I guess maybe one could argue that only ordinary comments should be that long.</p>



<a name="270480270"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%E2%9C%94%20Parsing%20error%20when%20adding%20a%20comment/near/270480270" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.E2.9C.94.20Parsing.20error.20when.20adding.20a.20comment.html#270480270">(Feb 03 2022 at 00:15)</a>:</h4>
<p>Some mathlib tactic docstrings are very long, containing examples of usage etc</p>



<a name="270481211"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%E2%9C%94%20Parsing%20error%20when%20adding%20a%20comment/near/270481211" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.E2.9C.94.20Parsing.20error.20when.20adding.20a.20comment.html#270481211">(Feb 03 2022 at 00:25)</a>:</h4>
<p>I suppose it's not really that awkward, since no one would complain if you wrote <code>section</code>, <code>open Nat</code>, long docstring <code>def ...</code>, <code>end</code>.</p>



<a name="270481590"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%E2%9C%94%20Parsing%20error%20when%20adding%20a%20comment/near/270481590" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.E2.9C.94.20Parsing.20error.20when.20adding.20a.20comment.html#270481590">(Feb 03 2022 at 00:29)</a>:</h4>
<p>it is a bit unfortunate. I don't think it can be fixed without making <code>open in</code> part of the def syntax though</p>



<a name="270482248"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%E2%9C%94%20Parsing%20error%20when%20adding%20a%20comment/near/270482248" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> František Silváši <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.E2.9C.94.20Parsing.20error.20when.20adding.20a.20comment.html#270482248">(Feb 03 2022 at 00:36)</a>:</h4>
<p>It's really not a big deal even if a docstring is long, the set of open namespaces is, at least from personal experience, rarely necessary to understand the code, so it being 'out of sight' is immaterial. It's something I type in for the machine to understand what I'm referring to, humans would know regardless.</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>