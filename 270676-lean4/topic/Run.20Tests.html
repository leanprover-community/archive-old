---
layout: archive
title: Zulip Chat Archive
permalink: /stream/270676-lean4/topic/Run.20Tests.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/index.html">lean4</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Run.20Tests.html">Run Tests</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="238915810"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Run%20Tests/near/238915810" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Run.20Tests.html#238915810">(May 15 2021 at 18:16)</a>:</h4>
<p>When adding a test that is just suppose tor run without error to Lean 4., does it go in the <code>lean/test/run</code> directory? If so, how do you make the test run when using <code>make tests</code> because it seems like tests added to that directory aren't automatically added to queue for <code>make tests</code> (or I may just be missing something).</p>



<a name="238918855"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Run%20Tests/near/238918855" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Daniel Selsam <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Run.20Tests.html#238918855">(May 15 2021 at 19:07)</a>:</h4>
<p><span class="user-mention" data-user-id="315577">@Mac</span> When I put a <code>.lean</code> file in <code>tests/lean/run</code>, it is automatically run as part of <code>make test</code>. Are you sure it isn't being run for you too? FYI the full test name should be "leanruntest_&lt;oldname&gt;.lean".</p>



<a name="238919206"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Run%20Tests/near/238919206" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Run.20Tests.html#238919206">(May 15 2021 at 19:13)</a>:</h4>
<p>Hmm, that's what I thought should happen. Maybe it's because I didn't rebuild after adding the tests?</p>



<a name="238919290"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Run%20Tests/near/238919290" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Run.20Tests.html#238919290">(May 15 2021 at 19:15)</a>:</h4>
<p>Oh! Yep, that's it! <span aria-label="smile" class="emoji emoji-1f642" role="img" title="smile">:smile:</span>  <br>
I didn't think adding tests would require a rebuild.</p>



<a name="238919481"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Run%20Tests/near/238919481" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Daniel Selsam <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Run.20Tests.html#238919481">(May 15 2021 at 19:18)</a>:</h4>
<p>FYI It does not require a rebuild for me.</p>



<a name="238919596"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Run%20Tests/near/238919596" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Run.20Tests.html#238919596">(May 15 2021 at 19:20)</a>:</h4>
<p>Interesting! That's weird.<br>
(Fyi, just to clarify, by "rebuild" I mean running <code>make</code> -- the new lean binary is not necessary though)</p>



<a name="238919715"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Run%20Tests/near/238919715" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Run.20Tests.html#238919715">(May 15 2021 at 19:22)</a>:</h4>
<p>This may have to due to with the fact I am on Windows, using VSCode, using MSYS2, and/or using GCC as my compiler. (I am using MSYS2/MINGW64 GCC because Lean 4 does not build properly with MSYS2/MINGW64 Clang 11  on my setup).</p>



<a name="238956735"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Run%20Tests/near/238956735" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Run.20Tests.html#238956735">(May 16 2021 at 07:18)</a>:</h4>
<p>We use globs in CMake to collect the tests, which is not recommended because of this issue, but I'm not aware of a reasonable alternative either</p>



<a name="238956765"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Run%20Tests/near/238956765" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Run.20Tests.html#238956765">(May 16 2021 at 07:19)</a>:</h4>
<p><span class="user-mention silent" data-user-id="315577">Mac</span> <a href="#narrow/stream/270676-lean4/topic/Run.20Tests/near/238919715">said</a>:</p>
<blockquote>
<p>MSYS2/MINGW64 GCC because Lean 4 does not build properly with MSYS2/MINGW64 Clang 11  on my setup).</p>
</blockquote>
<p>That's weird, since that is how the official Windows release is built</p>



<a name="238960516"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Run%20Tests/near/238960516" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Run.20Tests.html#238960516">(May 16 2021 at 08:33)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110024">Sebastian Ullrich</span> <a href="#narrow/stream/270676-lean4/topic/Run.20Tests/near/238956765">said</a>:</p>
<blockquote>
<p>That's weird, since that is how the official Windows release is built</p>
</blockquote>
<p>Yep. The first time I built it, I didn't notice that line and didn't specify it to build with Clang so CMake ended up defaulting to GCC . When I later discovered my mistake and tried a fresh rebuild with Clang things broke. Thus I ended up reverting back to using GCC and everything still works. Surprisingly, it was still building even when the Windows CI/CD broke due to symbol issues, so maybe GCC doesn't have the same symbol issues (or something else is weird)?</p>



<a name="238960709"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Run%20Tests/near/238960709" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Run.20Tests.html#238960709">(May 16 2021 at 08:36)</a>:</h4>
<p>Oh! Technically, according to <code>CMakeCache.txt</code>, my build is using the MSYS2's <code>c++</code> (which I believe is GCC -- based on it using other GNU Binutils such as <code>ld</code>):</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="bp">$</span> <span class="n">c</span><span class="bp">++</span> <span class="c1">--version</span>
<span class="n">c</span><span class="bp">++.</span><span class="n">exe</span> <span class="o">(</span><span class="n">Rev10</span><span class="o">,</span> <span class="n">Built</span> <span class="kd">by</span> <span class="n">MSYS2</span> <span class="n">project</span><span class="o">)</span> <span class="mi">10</span><span class="bp">.</span><span class="mi">2</span><span class="bp">.</span><span class="mi">0</span>
<span class="n">Copyright</span> <span class="o">(</span><span class="n">C</span><span class="o">)</span> <span class="mi">2020</span> <span class="n">Free</span> <span class="n">Software</span> <span class="n">Foundation</span><span class="o">,</span> <span class="n">Inc.</span>
</code></pre></div>



<a name="238964769"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Run%20Tests/near/238964769" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Run.20Tests.html#238964769">(May 16 2021 at 09:54)</a>:</h4>
<p>clang should also be using <code>ld</code> on Windows by default. It might be some minor difference like g++'s runtime library using fewer symbols than clang's or something</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>