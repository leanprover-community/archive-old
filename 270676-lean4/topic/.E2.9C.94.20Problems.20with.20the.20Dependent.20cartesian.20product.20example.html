---
layout: archive
title: Zulip Chat Archive
permalink: /stream/270676-lean4/topic/.E2.9C.94.20Problems.20with.20the.20Dependent.20cartesian.20product.20example.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/index.html">lean4</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.E2.9C.94.20Problems.20with.20the.20Dependent.20cartesian.20product.20example.html">✔ Problems with the Dependent cartesian product example</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="280855930"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%E2%9C%94%20Problems%20with%20the%20Dependent%20cartesian%20product%20example/near/280855930" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Stefano <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.E2.9C.94.20Problems.20with.20the.20Dependent.20cartesian.20product.20example.html#280855930">(May 02 2022 at 10:20)</a>:</h4>
<p><span class="user-mention silent" data-user-id="346070">Tomas Skrivan</span> <a href="#narrow/stream/270676-lean4/topic/Problems.20with.20the.20Dependent.20cartesian.20product.20example/near/280855558">said</a>:</p>
<blockquote>
<p>You have a typo there, the type after colon <code>:</code> should not be <code>(a : α) × (b : β a) </code> but <code>(a : α) × (β a)</code>.</p>
</blockquote>
<p>Hi <span class="user-mention" data-user-id="346070">@Tomas Skrivan</span> <br>
and thanks for your fast answer.<br>
Your suggestion is to make my code like the code in the example. But mine is not a typo it is what I'm trying to do and I don't understand why I can't have an element <code>(b : β a)</code> in the return type, and what does it means the error message that I received.</p>



<a name="280856080"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%E2%9C%94%20Problems%20with%20the%20Dependent%20cartesian%20product%20example/near/280856080" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Tomas Skrivan <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.E2.9C.94.20Problems.20with.20the.20Dependent.20cartesian.20product.20example.html#280856080">(May 02 2022 at 10:22)</a>:</h4>
<p>This works for me:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">variable</span> <span class="o">(</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">)</span>
<span class="kd">variable</span> <span class="o">(</span><span class="n">β</span> <span class="o">:</span> <span class="n">α</span> <span class="bp">→</span> <span class="kt">Type</span> <span class="n">v</span><span class="o">)</span>
<span class="kd">def</span> <span class="n">f</span> <span class="o">(</span><span class="n">a</span> <span class="o">:</span> <span class="n">α</span><span class="o">)(</span><span class="n">b</span><span class="o">:</span> <span class="n">β</span> <span class="n">a</span><span class="o">)</span> <span class="o">:</span> <span class="o">(</span><span class="n">a</span> <span class="o">:</span> <span class="n">α</span><span class="o">)</span> <span class="bp">×</span> <span class="n">β</span> <span class="n">a</span> <span class="o">:=</span> <span class="o">⟨</span><span class="n">a</span><span class="o">,</span> <span class="n">b</span><span class="o">⟩</span>
</code></pre></div>
<p>This does not work for me and I'm not sure how it is supposed to be different to the above if it is not a typo:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">variable</span> <span class="o">(</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">)</span>
<span class="kd">variable</span> <span class="o">(</span><span class="n">β</span> <span class="o">:</span> <span class="n">α</span> <span class="bp">→</span> <span class="kt">Type</span> <span class="n">v</span><span class="o">)</span>
<span class="kd">def</span> <span class="n">f</span> <span class="o">(</span><span class="n">a</span> <span class="o">:</span> <span class="n">α</span><span class="o">)</span> <span class="o">(</span><span class="n">b</span> <span class="o">:</span> <span class="n">β</span> <span class="n">a</span><span class="o">)</span> <span class="o">:</span> <span class="o">(</span><span class="n">a</span> <span class="o">:</span> <span class="n">α</span><span class="o">)</span> <span class="bp">×</span> <span class="o">(</span><span class="n">b</span> <span class="o">:</span> <span class="n">β</span> <span class="n">a</span><span class="o">)</span> <span class="o">:=</span> <span class="o">⟨</span><span class="n">a</span><span class="o">,</span> <span class="n">b</span><span class="o">⟩</span>
</code></pre></div>



<a name="280856249"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%E2%9C%94%20Problems%20with%20the%20Dependent%20cartesian%20product%20example/near/280856249" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Stefano <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.E2.9C.94.20Problems.20with.20the.20Dependent.20cartesian.20product.20example.html#280856249">(May 02 2022 at 10:24)</a>:</h4>
<p>Same here (the one on top works fine, I took it from the documentation). Hence my question.<br>
My understanding is that the 2 snippets should be equivalent. And the error message I receive is not helping me to understand where I did something wrong.<br>
Bear in mind I'm a newbie with Lean4.</p>



<a name="280856665"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%E2%9C%94%20Problems%20with%20the%20Dependent%20cartesian%20product%20example/near/280856665" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Tomas Skrivan <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.E2.9C.94.20Problems.20with.20the.20Dependent.20cartesian.20product.20example.html#280856665">(May 02 2022 at 10:30)</a>:</h4>
<p>Ohh then there has to be a typo in the documentation <span aria-label="grinning" class="emoji emoji-1f600" role="img" title="grinning">:grinning:</span> Looks at these variants:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">variable</span> <span class="o">(</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">)</span>
<span class="kd">variable</span> <span class="o">(</span><span class="n">β</span> <span class="o">:</span> <span class="n">α</span> <span class="bp">→</span> <span class="kt">Type</span> <span class="n">v</span><span class="o">)</span>
<span class="kd">def</span> <span class="n">f1</span> <span class="o">(</span><span class="n">a</span> <span class="o">:</span> <span class="n">α</span><span class="o">)</span> <span class="o">(</span><span class="n">b</span> <span class="o">:</span> <span class="n">β</span> <span class="n">a</span><span class="o">)</span> <span class="o">:</span> <span class="o">(</span><span class="n">a</span> <span class="o">:</span> <span class="n">α</span><span class="o">)</span> <span class="bp">×</span> <span class="o">(</span><span class="n">β</span> <span class="n">a</span><span class="o">)</span> <span class="o">:=</span> <span class="o">⟨</span><span class="n">_</span><span class="o">,</span> <span class="n">b</span><span class="o">⟩</span>
<span class="kd">def</span> <span class="n">f2</span> <span class="o">(</span><span class="n">a</span> <span class="o">:</span> <span class="n">α</span><span class="o">)</span> <span class="o">(</span><span class="n">b</span> <span class="o">:</span> <span class="n">β</span> <span class="n">a</span><span class="o">)</span> <span class="o">:</span> <span class="o">(</span><span class="n">β</span> <span class="n">a</span><span class="o">)</span> <span class="o">:=</span> <span class="n">b</span>
<span class="kd">def</span> <span class="n">f3</span> <span class="o">(</span><span class="n">a</span> <span class="o">:</span> <span class="n">α</span><span class="o">)</span> <span class="o">(</span><span class="n">b</span> <span class="o">:</span> <span class="n">β</span> <span class="n">a</span><span class="o">)</span> <span class="o">:</span> <span class="o">(</span><span class="n">b</span> <span class="o">:</span> <span class="n">β</span> <span class="n">a</span><span class="o">)</span> <span class="o">:=</span> <span class="n">b</span>
</code></pre></div>
<ul>
<li><code>f1</code> you do not need to specify <code>a</code> because it is inferred from the expected type. </li>
<li><code>f2</code> is just demonstrating that <code>β a</code> is a type</li>
<li><code>f3</code> is showing that <code>(b : β a)</code> is not a type, therefore it does not make sense to define an element of that "type". <code>f3</code> gives an error </li>
</ul>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code> <span class="n">error</span><span class="o">:</span> <span class="n">type</span> <span class="n">expected</span>
<span class="n">failed</span> <span class="n">to</span> <span class="n">synthesize</span> <span class="kd">instance</span>
  <span class="n">CoeSort</span> <span class="o">(</span><span class="n">β</span> <span class="n">a</span><span class="o">)</span> <span class="bp">?</span><span class="n">m.39241type</span> <span class="n">expected</span>
</code></pre></div>
<p>The first line is exactly saying that <code>(b : β a)</code> is not a type. The rest is saying that Lean tried and failed to type cast <code>(b : β a)</code> to a type. In Lean <code>Coe</code>/coercion does type casting you might be familiar with from different languages.</p>



<a name="280857320"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%E2%9C%94%20Problems%20with%20the%20Dependent%20cartesian%20product%20example/near/280857320" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Stefano <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.E2.9C.94.20Problems.20with.20the.20Dependent.20cartesian.20product.20example.html#280857320">(May 02 2022 at 10:39)</a>:</h4>
<p><span class="user-mention silent" data-user-id="346070">Tomas Skrivan</span> <a href="#narrow/stream/270676-lean4/topic/Problems.20with.20the.20Dependent.20cartesian.20product.20example/near/280856665">said</a>:</p>
<blockquote>
<p>Ohh then there has to be a typo in the documentation <span aria-label="grinning" class="emoji emoji-1f600" role="img" title="grinning">:grinning:</span> Looks at these variants:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">variable</span> <span class="o">(</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">)</span>
<span class="kd">variable</span> <span class="o">(</span><span class="n">β</span> <span class="o">:</span> <span class="n">α</span> <span class="bp">→</span> <span class="kt">Type</span> <span class="n">v</span><span class="o">)</span>
<span class="kd">def</span> <span class="n">f1</span> <span class="o">(</span><span class="n">a</span> <span class="o">:</span> <span class="n">α</span><span class="o">)</span> <span class="o">(</span><span class="n">b</span> <span class="o">:</span> <span class="n">β</span> <span class="n">a</span><span class="o">)</span> <span class="o">:</span> <span class="o">(</span><span class="n">a</span> <span class="o">:</span> <span class="n">α</span><span class="o">)</span> <span class="bp">×</span> <span class="o">(</span><span class="n">β</span> <span class="n">a</span><span class="o">)</span> <span class="o">:=</span> <span class="o">⟨</span><span class="n">_</span><span class="o">,</span> <span class="n">b</span><span class="o">⟩</span>
<span class="kd">def</span> <span class="n">f2</span> <span class="o">(</span><span class="n">a</span> <span class="o">:</span> <span class="n">α</span><span class="o">)</span> <span class="o">(</span><span class="n">b</span> <span class="o">:</span> <span class="n">β</span> <span class="n">a</span><span class="o">)</span> <span class="o">:</span> <span class="o">(</span><span class="n">β</span> <span class="n">a</span><span class="o">)</span> <span class="o">:=</span> <span class="n">b</span>
<span class="kd">def</span> <span class="n">f3</span> <span class="o">(</span><span class="n">a</span> <span class="o">:</span> <span class="n">α</span><span class="o">)</span> <span class="o">(</span><span class="n">b</span> <span class="o">:</span> <span class="n">β</span> <span class="n">a</span><span class="o">)</span> <span class="o">:</span> <span class="o">(</span><span class="n">b</span> <span class="o">:</span> <span class="n">β</span> <span class="n">a</span><span class="o">)</span> <span class="o">:=</span> <span class="n">b</span>
</code></pre></div>
<ul>
<li><code>f1</code> you do not need to specify <code>a</code> because it is inferred from the expected type. </li>
<li><code>f2</code> is just demonstrating that <code>β a</code> is a type</li>
<li><code>f3</code> is showing that <code>(b : β a)</code> is not a type, therefore it does not make sense to define an element of that "type". <code>f3</code> gives an error </li>
</ul>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code> <span class="n">error</span><span class="o">:</span> <span class="n">type</span> <span class="n">expected</span>
<span class="n">failed</span> <span class="n">to</span> <span class="n">synthesize</span> <span class="kd">instance</span>
  <span class="n">CoeSort</span> <span class="o">(</span><span class="n">β</span> <span class="n">a</span><span class="o">)</span> <span class="bp">?</span><span class="n">m.39241type</span> <span class="n">expected</span>
</code></pre></div>
<p>The first line is exactly saying that <code>(b : β a)</code> is not a type. The rest is saying that Lean tried and failed to type cast <code>(b : β a)</code> to a type. In Lean <code>Coe</code>/coercion does type casting you might be familiar with from different languages.</p>
</blockquote>
<p>Thanks (again).<br>
I guess I'm starting to see what you mean. My head is starting to hurt but I will come along. <span aria-label="hurt" class="emoji emoji-1f915" role="img" title="hurt">:hurt:</span> <span aria-label="joy" class="emoji emoji-1f602" role="img" title="joy">:joy:</span> <br>
The error msg (in my case) is still a mystery, though. ;) </p>
<blockquote>
<p>type mismatch<br>
b<br>
has type<br>
β a : Type v<br>
but is expected to have type<br>
β a : Type v</p>
</blockquote>



<a name="280857691"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%E2%9C%94%20Problems%20with%20the%20Dependent%20cartesian%20product%20example/near/280857691" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Notification Bot <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.E2.9C.94.20Problems.20with.20the.20Dependent.20cartesian.20product.20example.html#280857691">(May 02 2022 at 10:44)</a>:</h4>
<p><span class="user-mention silent" data-user-id="497983">Stefano</span> has marked this topic as resolved.</p>



<a name="280858914"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%E2%9C%94%20Problems%20with%20the%20Dependent%20cartesian%20product%20example/near/280858914" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Tomas Skrivan <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.E2.9C.94.20Problems.20with.20the.20Dependent.20cartesian.20product.20example.html#280858914">(May 02 2022 at 10:59)</a>:</h4>
<p>Right the error is really mysterious, look at this:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">variable</span> <span class="o">(</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">)</span>
<span class="kd">variable</span> <span class="o">(</span><span class="n">β</span> <span class="o">:</span> <span class="n">α</span> <span class="bp">→</span> <span class="kt">Type</span><span class="o">)</span>
<span class="kd">def</span> <span class="n">f</span> <span class="o">(</span><span class="n">a</span> <span class="o">:</span> <span class="n">α</span><span class="o">)</span> <span class="o">(</span><span class="n">b</span> <span class="o">:</span> <span class="n">β</span> <span class="n">a</span><span class="o">)</span> <span class="o">:</span> <span class="o">(</span><span class="n">a</span> <span class="o">:</span> <span class="n">α</span><span class="o">)</span> <span class="bp">×</span> <span class="o">(</span><span class="n">b</span> <span class="o">:</span> <span class="n">β</span> <span class="n">a</span><span class="o">)</span> <span class="o">:=</span> <span class="o">⟨</span><span class="n">a</span><span class="o">,</span> <span class="n">b</span><span class="o">⟩</span>
<span class="kd">def</span> <span class="n">g</span> <span class="o">(</span><span class="n">a</span> <span class="o">:</span> <span class="n">α</span><span class="o">)</span> <span class="o">(</span><span class="n">b</span> <span class="o">:</span> <span class="n">β</span> <span class="n">a</span><span class="o">)</span> <span class="o">:</span> <span class="o">(</span><span class="n">a'</span> <span class="o">:</span> <span class="n">α</span><span class="o">)</span> <span class="bp">×</span> <span class="o">(</span><span class="n">b</span> <span class="o">:</span> <span class="n">β</span> <span class="n">a'</span><span class="o">)</span> <span class="o">:=</span> <span class="o">⟨</span><span class="n">a</span><span class="o">,</span> <span class="n">b</span><span class="o">⟩</span>
</code></pre></div>
<p>There are two different <code>a</code> in the definition of <code>f</code> and that is confusing. <code>g</code> uses different symbols for them. The dependent product <code>(a' : α) × (β a')</code> acts a bit like lambda <code>fun (a' : α)  =&gt; f a'</code>, it introduces a new variable <code>a'</code> that can be used in the definition of the type for the second element. The error becomes a little less mysterious</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code> <span class="n">error</span><span class="o">:</span> <span class="n">type</span> <span class="n">mismatch</span>
  <span class="n">b</span>
<span class="n">has</span> <span class="n">type</span>
  <span class="n">β</span> <span class="n">a</span> <span class="o">:</span> <span class="kt">Type</span>
<span class="n">but</span> <span class="n">is</span> <span class="n">expected</span> <span class="n">to</span> <span class="k">have</span> <span class="n">type</span>
  <span class="n">β</span> <span class="n">a'</span> <span class="o">:</span> <span class="kt">Type</span>
</code></pre></div>



<a name="280883655"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%E2%9C%94%20Problems%20with%20the%20Dependent%20cartesian%20product%20example/near/280883655" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Leonardo de Moura <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.E2.9C.94.20Problems.20with.20the.20Dependent.20cartesian.20product.20example.html#280883655">(May 02 2022 at 14:52)</a>:</h4>
<p>Yes, the error message is very confusing. There are two different issues: a bug in the Lean Server, and notation confusion.<br>
The first one is easier, and I have pushed a fix for it. <a href="https://github.com/leanprover/lean4/commit/fe00dd8f292ed280684403b4cf6444a83f1b81bd">https://github.com/leanprover/lean4/commit/fe00dd8f292ed280684403b4cf6444a83f1b81bd</a><br>
Note that, in the command line the error is </p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">error</span><span class="o">:</span> <span class="n">type</span> <span class="n">mismatch</span>
  <span class="n">b</span>
<span class="n">has</span> <span class="n">type</span>
  <span class="n">β</span> <span class="n">a</span><span class="bp">✝</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">v</span>
<span class="n">but</span> <span class="n">is</span> <span class="n">expected</span> <span class="n">to</span> <span class="k">have</span> <span class="n">type</span>
  <span class="n">β</span> <span class="n">a</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">v</span>
</code></pre></div>
<p>and it makes it clear that there are two different <code>a</code>s. It is not super clear, but it gives us a hint.<br>
If we re-write <code>f</code> and avoid variable shadowing </p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">def</span> <span class="n">f</span> <span class="o">(</span><span class="n">a_1</span> <span class="o">:</span> <span class="n">α</span><span class="o">)(</span><span class="n">b</span><span class="o">:</span> <span class="n">β</span> <span class="n">a_1</span><span class="o">)</span> <span class="o">:</span> <span class="o">(</span><span class="n">a_2</span> <span class="o">:</span> <span class="n">α</span><span class="o">)</span> <span class="bp">×</span> <span class="o">(</span><span class="n">b</span> <span class="o">:</span> <span class="n">β</span> <span class="n">a_2</span><span class="o">)</span> <span class="o">:=</span> <span class="o">⟨</span><span class="n">a_1</span><span class="o">,</span> <span class="n">b</span><span class="o">⟩</span>
</code></pre></div>
<p>We get the error</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">error</span><span class="o">:</span> <span class="n">type</span> <span class="n">mismatch</span>
  <span class="n">b</span>
<span class="n">has</span> <span class="n">type</span>
  <span class="n">β</span> <span class="n">a_1</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">v</span>
<span class="n">but</span> <span class="n">is</span> <span class="n">expected</span> <span class="n">to</span> <span class="k">have</span> <span class="n">type</span>
  <span class="n">β</span> <span class="n">a_2</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">v</span>
</code></pre></div>
<p>The second issue is trickier. Note that <code>(e : ty)</code> is the type ascription notation in Lean. It says, elaborate <code>e</code> with expected type <code>ty</code>.<br>
The dependent pair notation is not "symmetric", and is defined as </p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">macro</span><span class="o">:</span><span class="mi">35</span> <span class="n">xs</span><span class="o">:</span><span class="n">bracketedExplicitBinders</span> <span class="s2">" × "</span> <span class="n">b</span><span class="o">:</span><span class="n">term</span><span class="o">:</span><span class="mi">35</span>  <span class="o">:</span> <span class="n">term</span> <span class="bp">=&gt;</span> <span class="n">expandBrackedBinders</span> <span class="bp">``</span><span class="n">Sigma</span> <span class="n">xs</span> <span class="n">b</span>
</code></pre></div>
<p>The term <code>(a : α) × (b : β a)</code> is notation for <code>Sigma fun (a : α) =&gt; (b : β a)</code>. That is, the <code>(b : β a)</code> is being processed as a type ascription, and is indeed very confusing. Not sure what the best fix is. This is not the first type the type ascription notation generates confusion. One option is to change the type ascription notation.  Another option is to generate an error if the type ascription is used in the second part of the dependent pair notation. That is, if users really want to use a type ascription notation there, they would have to use <code>(a : α) × ((b : β a))</code>.</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>