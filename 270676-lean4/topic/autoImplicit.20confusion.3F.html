---
layout: archive
title: Zulip Chat Archive
permalink: /stream/270676-lean4/topic/autoImplicit.20confusion.3F.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/index.html">lean4</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/autoImplicit.20confusion.3F.html">autoImplicit confusion?</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="280607127"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/autoImplicit%20confusion%3F/near/280607127" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> James Gallicchio <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/autoImplicit.20confusion.3F.html#280607127">(Apr 29 2022 at 09:22)</a>:</h4>
<p>Ah okay, thanks for taking a look</p>
<p>(Also, I didn't mean to make this in <a class="stream" data-stream-id="287929" href="/#narrow/stream/287929-mathlib4">#mathlib4</a>, if someone has the power to move it to <a class="stream" data-stream-id="270676" href="/#narrow/stream/270676-lean4">#lean4</a> I'd be grateful)</p>



<a name="280607418"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/autoImplicit%20confusion%3F/near/280607418" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Notification Bot <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/autoImplicit.20confusion.3F.html#280607418">(Apr 29 2022 at 09:25)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110024">Sebastian Ullrich</span> has marked this topic as resolved.</p>



<a name="280607421"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/autoImplicit%20confusion%3F/near/280607421" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Notification Bot <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/autoImplicit.20confusion.3F.html#280607421">(Apr 29 2022 at 09:25)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110024">Sebastian Ullrich</span> has marked this topic as resolved.</p>



<a name="280607454"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/autoImplicit%20confusion%3F/near/280607454" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/autoImplicit.20confusion.3F.html#280607454">(Apr 29 2022 at 09:25)</a>:</h4>
<p>(whoops, wrong button... also, race condition in Zulip)</p>



<a name="280607540"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/autoImplicit%20confusion%3F/near/280607540" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Notification Bot <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/autoImplicit.20confusion.3F.html#280607540">(Apr 29 2022 at 09:26)</a>:</h4>
<p>This topic was moved here from <a class="stream-topic" data-stream-id="287929" href="/#narrow/stream/287929-mathlib4/topic/.E2.9C.94.20autoImplicit.20confusion.3F">#mathlib4 &gt; ✔ autoImplicit confusion?</a> by <span class="user-mention silent" data-user-id="110024">Sebastian Ullrich</span>.</p>



<a name="280607576"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/autoImplicit%20confusion%3F/near/280607576" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Notification Bot <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/autoImplicit.20confusion.3F.html#280607576">(Apr 29 2022 at 09:26)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110024">Sebastian Ullrich</span> has marked this topic as unresolved.</p>



<a name="280620177"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/autoImplicit%20confusion%3F/near/280620177" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Leonardo de Moura <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/autoImplicit.20confusion.3F.html#280620177">(Apr 29 2022 at 11:40)</a>:</h4>
<p>The declaration is accepted because of the "auto implicit chaining" feature. We can try to refine this feature, but this is the expected behavior for this feature. From our release notes:</p>
<ul>
<li>Added auto implicit "chaining". Unassigned metavariables occurring in the auto implicit types now become new auto implicit locals. Consider the following example:</li>
</ul>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code>  <span class="kd">inductive</span> <span class="n">HasType</span> <span class="o">:</span> <span class="n">Fin</span> <span class="n">n</span> <span class="bp">→</span> <span class="n">Vector</span> <span class="n">Ty</span> <span class="n">n</span> <span class="bp">→</span> <span class="n">Ty</span> <span class="bp">→</span> <span class="kt">Type</span> <span class="n">where</span>
    <span class="bp">|</span> <span class="n">stop</span> <span class="o">:</span> <span class="n">HasType</span> <span class="mi">0</span> <span class="o">(</span><span class="n">ty</span> <span class="o">::</span> <span class="n">ctx</span><span class="o">)</span> <span class="n">ty</span>
    <span class="bp">|</span> <span class="n">pop</span>  <span class="o">:</span> <span class="n">HasType</span> <span class="n">k</span> <span class="n">ctx</span> <span class="n">ty</span> <span class="bp">→</span> <span class="n">HasType</span> <span class="n">k.succ</span> <span class="o">(</span><span class="n">u</span> <span class="o">::</span> <span class="n">ctx</span><span class="o">)</span> <span class="n">ty</span>
</code></pre></div>
<p><code>ctx</code> is an auto implicit local in the two constructors, and it has type <code>ctx : Vector Ty ?m</code>. Without auto implicit "chaining", the metavariable <code>?m</code> will remain unassigned. The new feature creates yet another implicit local <code>n : Nat</code> and assigns <code>n</code> to <code>?m</code>. So, the declaration above is shorthand for</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code>  <span class="kd">inductive</span> <span class="n">HasType</span> <span class="o">:</span> <span class="o">{</span><span class="n">n</span> <span class="o">:</span> <span class="n">Nat</span><span class="o">}</span> <span class="bp">→</span> <span class="n">Fin</span> <span class="n">n</span> <span class="bp">→</span> <span class="n">Vector</span> <span class="n">Ty</span> <span class="n">n</span> <span class="bp">→</span> <span class="n">Ty</span> <span class="bp">→</span> <span class="kt">Type</span> <span class="n">where</span>
    <span class="bp">|</span> <span class="n">stop</span> <span class="o">:</span> <span class="o">{</span><span class="n">ty</span> <span class="o">:</span> <span class="n">Ty</span><span class="o">}</span> <span class="bp">→</span> <span class="o">{</span><span class="n">n</span> <span class="o">:</span> <span class="n">Nat</span><span class="o">}</span> <span class="bp">→</span> <span class="o">{</span><span class="n">ctx</span> <span class="o">:</span> <span class="n">Vector</span> <span class="n">Ty</span> <span class="n">n</span><span class="o">}</span> <span class="bp">→</span> <span class="n">HasType</span> <span class="mi">0</span> <span class="o">(</span><span class="n">ty</span> <span class="o">::</span> <span class="n">ctx</span><span class="o">)</span> <span class="n">ty</span>
    <span class="bp">|</span> <span class="n">pop</span>  <span class="o">:</span> <span class="o">{</span><span class="n">n</span> <span class="o">:</span> <span class="n">Nat</span><span class="o">}</span> <span class="bp">→</span> <span class="o">{</span><span class="n">k</span> <span class="o">:</span> <span class="n">Fin</span> <span class="n">n</span><span class="o">}</span> <span class="bp">→</span> <span class="o">{</span><span class="n">ctx</span> <span class="o">:</span> <span class="n">Vector</span> <span class="n">Ty</span> <span class="n">n</span><span class="o">}</span> <span class="bp">→</span> <span class="o">{</span><span class="n">ty</span> <span class="o">:</span> <span class="n">Ty</span><span class="o">}</span> <span class="bp">→</span> <span class="n">HasType</span> <span class="n">k</span> <span class="n">ctx</span> <span class="n">ty</span> <span class="bp">→</span> <span class="n">HasType</span> <span class="n">k.succ</span> <span class="o">(</span><span class="n">u</span> <span class="o">::</span> <span class="n">ctx</span><span class="o">)</span> <span class="n">ty</span>
</code></pre></div>



<a name="280620275"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/autoImplicit%20confusion%3F/near/280620275" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Leonardo de Moura <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/autoImplicit.20confusion.3F.html#280620275">(Apr 29 2022 at 11:41)</a>:</h4>
<p>We can claim this is a bug since <code>x</code> is not an auto implicit in the <code>Foo</code> example above. So, the metavariable occurring there should not become a new parameter.</p>



<a name="280858196"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/autoImplicit%20confusion%3F/near/280858196" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> James Gallicchio <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/autoImplicit.20confusion.3F.html#280858196">(May 02 2022 at 10:50)</a>:</h4>
<p>That makes sense -- I too would consider it a bug, since the behavior feels surprising in a way that auto-implicit generally does not</p>



<a name="281226458"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/autoImplicit%20confusion%3F/near/281226458" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Leonardo de Moura <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/autoImplicit.20confusion.3F.html#281226458">(May 04 2022 at 22:06)</a>:</h4>
<p>Pushed the following.<br>
<a href="https://github.com/leanprover/lean4/commit/04d3c6feebb81eb684be1c64289b8a5ddf7b7ba8">https://github.com/leanprover/lean4/commit/04d3c6feebb81eb684be1c64289b8a5ddf7b7ba8</a></p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">inductive</span> <span class="n">Foo</span>
<span class="bp">|</span> <span class="n">bar</span> <span class="o">(</span><span class="n">x</span><span class="o">)</span> <span class="o">:</span> <span class="n">Foo</span>
</code></pre></div>
<p>now produces an error.</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>