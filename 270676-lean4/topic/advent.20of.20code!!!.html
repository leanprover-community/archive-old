---
layout: archive
title: Zulip Chat Archive
permalink: /stream/270676-lean4/topic/advent.20of.20code!!!.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/index.html">lean4</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/advent.20of.20code!!!.html">advent of code!!!</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="263415524"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/advent%20of%20code%21%21%21/near/263415524" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Huỳnh Trần Khanh <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/advent.20of.20code!!!.html#263415524">(Dec 02 2021 at 10:09)</a>:</h4>
<p>hey... would you like to do this year's advent of code in lean 4? <a href="https://adventofcode.com">https://adventofcode.com</a></p>



<a name="263416685"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/advent%20of%20code%21%21%21/near/263416685" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Henrik Böving <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/advent.20of.20code!!!.html#263416685">(Dec 02 2021 at 10:21)</a>:</h4>
<p>I would imagine that at some point the (at the moment) rather rudimentary stdlib might hit its limits but the first few days should definitely be doable.</p>



<a name="263418390"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/advent%20of%20code%21%21%21/near/263418390" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/advent.20of.20code!!!.html#263418390">(Dec 02 2021 at 10:38)</a>:</h4>
<p>obviously the goal is to build the standard library in the process :)</p>



<a name="263425680"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/advent%20of%20code%21%21%21/near/263425680" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alcides Fonseca <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/advent.20of.20code!!!.html#263425680">(Dec 02 2021 at 11:52)</a>:</h4>
<p><span class="user-mention silent" data-user-id="270523">Huỳnh Trần Khanh</span> <a href="#narrow/stream/270676-lean4/topic/advent.20of.20code!!!/near/263415524">said</a>:</p>
<blockquote>
<p>hey... would you like to do this year's advent of code in lean 4? <a href="https://adventofcode.com">https://adventofcode.com</a></p>
</blockquote>
<p>I've been trying to keep up with it: <a href="https://github.com/alcides/AoC2021Lean4">https://github.com/alcides/AoC2021Lean4</a></p>
<p>I couldn't find the IO documented, so I've looked at the solutions of last year: <a href="https://github.com/rwbarton/advent-of-lean-4">https://github.com/rwbarton/advent-of-lean-4</a></p>
<p>I wonder whether the lean4 would be open for PRs regarding the documentation, and if there were any general guidelines regarding expecting quality.</p>



<a name="263427139"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/advent%20of%20code%21%21%21/near/263427139" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Huỳnh Trần Khanh <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/advent.20of.20code!!!.html#263427139">(Dec 02 2021 at 12:08)</a>:</h4>
<p><span class="user-mention" data-user-id="284775">@Alcides Fonseca</span>  ah yeah lean4 documentation is like... pretty bare bones at the moment, i assume this is because the devs are still pretty busy developing lean4 itself <span aria-label="joy" class="emoji emoji-1f602" role="img" title="joy">:joy:</span></p>
<p>but i think this guide is pretty helpful lol <a href="https://agentultra.github.io/lean-4-hackers/">https://agentultra.github.io/lean-4-hackers/</a></p>



<a name="263427144"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/advent%20of%20code%21%21%21/near/263427144" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Henrik Böving <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/advent.20of.20code!!!.html#263427144">(Dec 02 2021 at 12:08)</a>:</h4>
<p>They are in principle open for docs and little tutorials over here: <a href="https://github.com/leanprover/lean4/tree/master/doc">https://github.com/leanprover/lean4/tree/master/doc</a> as noted here <a href="https://github.com/leanprover/lean4/blob/master/CONTRIBUTING.md#documentation">https://github.com/leanprover/lean4/blob/master/CONTRIBUTING.md#documentation</a></p>



<a name="263427189"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/advent%20of%20code%21%21%21/near/263427189" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Henrik Böving <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/advent.20of.20code!!!.html#263427189">(Dec 02 2021 at 12:09)</a>:</h4>
<p>My approach for if I want to know something about Lean 4 at the moment is to just look how the stdlib/compiler does stuff by reading the source code really, I've found most of it to be quite understandable.</p>



<a name="263437637"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/advent%20of%20code%21%21%21/near/263437637" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/advent.20of.20code!!!.html#263437637">(Dec 02 2021 at 13:37)</a>:</h4>
<p>Here is a little snippet of code I wrote a while back that makes working with File I/O a little easier. It may be of use inn tasks like these:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">Std.Data.HashSet</span>

<span class="kn">open</span> <span class="n">Std</span> <span class="n">System</span>

<span class="n">partial</span> <span class="kd">def</span> <span class="n">forEachLine</span>
<span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="n">IO.FS.Handle</span><span class="o">)</span> <span class="o">(</span><span class="n">init</span> <span class="o">:</span> <span class="n">α</span><span class="o">)</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">String</span> <span class="bp">→</span> <span class="n">α</span> <span class="bp">→</span> <span class="n">IO</span> <span class="o">(</span><span class="n">ForInStep</span> <span class="n">α</span><span class="o">))</span> <span class="o">:</span> <span class="n">IO</span> <span class="n">α</span> <span class="o">:=</span> <span class="k">do</span>
  <span class="k">let</span> <span class="n">rec</span> <span class="n">loop</span> <span class="n">a</span> <span class="o">:=</span> <span class="k">do</span>
    <span class="k">match</span> <span class="o">(</span><span class="bp">←</span> <span class="n">f</span> <span class="o">(</span><span class="bp">←</span> <span class="n">h.getLine</span><span class="o">)</span> <span class="n">a</span><span class="o">)</span> <span class="k">with</span>
    <span class="bp">|</span> <span class="n">ForInStep.done</span> <span class="n">a</span>  <span class="bp">=&gt;</span> <span class="n">pure</span> <span class="n">a</span>
    <span class="bp">|</span> <span class="n">ForInStep.yield</span> <span class="n">a</span> <span class="bp">=&gt;</span> <span class="n">loop</span> <span class="n">a</span>
  <span class="n">loop</span> <span class="n">init</span>

<span class="kd">instance</span> <span class="o">:</span> <span class="n">ForIn</span> <span class="n">IO</span> <span class="n">IO.FS.Handle</span> <span class="n">String</span> <span class="n">where</span>
  <span class="n">forIn</span> <span class="o">:=</span> <span class="n">forEachLine</span>

<span class="kd">instance</span> <span class="o">:</span> <span class="n">ForIn</span> <span class="n">IO</span> <span class="n">FilePath</span> <span class="n">String</span> <span class="n">where</span>
  <span class="n">forIn</span> <span class="n">path</span> <span class="n">init</span> <span class="n">f</span> <span class="o">:=</span> <span class="k">do</span>
    <span class="k">let</span> <span class="n">h</span> <span class="bp">←</span> <span class="n">IO.FS.Handle.mk</span> <span class="n">path</span> <span class="n">IO.FS.Mode.read</span> <span class="n">false</span>
    <span class="n">forEachLine</span> <span class="n">h</span> <span class="n">init</span> <span class="n">f</span>

<span class="c">/-</span><span class="cm"> Print the common lines between two files. -/</span>
<span class="kd">def</span> <span class="n">comm</span> <span class="o">(</span><span class="n">file1</span> <span class="o">:</span> <span class="n">FilePath</span><span class="o">)</span> <span class="o">(</span><span class="n">file2</span> <span class="o">:</span> <span class="n">FilePath</span><span class="o">)</span> <span class="o">:</span> <span class="n">IO</span> <span class="n">PUnit</span> <span class="o">:=</span> <span class="k">do</span>
  <span class="k">let</span> <span class="n">mut</span> <span class="n">lines</span> <span class="o">:=</span> <span class="n">HashSet.empty</span>
  <span class="n">for</span> <span class="n">line</span> <span class="k">in</span> <span class="n">file1</span> <span class="k">do</span>
    <span class="n">lines</span> <span class="o">:=</span> <span class="n">lines.insert</span> <span class="n">line</span>
  <span class="n">for</span> <span class="n">line</span> <span class="k">in</span> <span class="n">file2</span> <span class="k">do</span>
    <span class="k">if</span> <span class="n">lines.contains</span> <span class="n">line</span> <span class="k">then</span>
      <span class="n">IO.print</span> <span class="n">line</span>
</code></pre></div>



<a name="263437717"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/advent%20of%20code%21%21%21/near/263437717" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/advent.20of.20code!!!.html#263437717">(Dec 02 2021 at 13:38)</a>:</h4>
<p>With the two <code>ForIn</code> instances you can just use <code>for ... in</code> to iterate over the lines in a file! :)</p>



<a name="263437969"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/advent%20of%20code%21%21%21/near/263437969" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/advent.20of.20code!!!.html#263437969">(Dec 02 2021 at 13:40)</a>:</h4>
<p>In general I'm a big fan of adding more <code>ForIn</code> instances, but these seem really misleading.</p>



<a name="263437999"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/advent%20of%20code%21%21%21/near/263437999" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/advent.20of.20code!!!.html#263437999">(Dec 02 2021 at 13:40)</a>:</h4>
<p>I would have expected them to iterate over the path components, if anything.</p>



<a name="263438059"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/advent%20of%20code%21%21%21/near/263438059" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/advent.20of.20code!!!.html#263438059">(Dec 02 2021 at 13:40)</a>:</h4>
<p><span class="user-mention" data-user-id="110043">@Gabriel Ebner</span> yeah, the <code>FilePath</code> one is probably excessive. The <code>Handle</code> one seems good though.</p>



<a name="263438183"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/advent%20of%20code%21%21%21/near/263438183" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/advent.20of.20code!!!.html#263438183">(Dec 02 2021 at 13:41)</a>:</h4>
<p>I'd at least put a wrapper around it, like <code>def Lines := IO Handle</code> and <code>def linesOf : FilePath -&gt; Lines</code> etc.</p>



<a name="263438282"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/advent%20of%20code%21%21%21/near/263438282" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/advent.20of.20code!!!.html#263438282">(Dec 02 2021 at 13:42)</a>:</h4>
<p><span class="user-mention" data-user-id="110043">@Gabriel Ebner</span> I mostly was just copying Python which also has <code>for ... in</code> iterate over the lines of a handle.</p>



<a name="263438546"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/advent%20of%20code%21%21%21/near/263438546" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/advent.20of.20code!!!.html#263438546">(Dec 02 2021 at 13:45)</a>:</h4>
<p>Obviously it should be a <code>for</code> elaborator that adapts semantics depending on whether you name the loop variable <code>line</code>, <code>word</code>, or <code>char</code></p>



<a name="263438637"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/advent%20of%20code%21%21%21/near/263438637" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/advent.20of.20code!!!.html#263438637">(Dec 02 2021 at 13:45)</a>:</h4>
<p>Following, <span class="user-mention" data-user-id="110043">@Gabriel Ebner</span>'s idea, here is a snippet that uses a distinct <code>def</code>:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">def</span> <span class="n">Lines</span> <span class="o">(</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">)</span> <span class="o">:=</span> <span class="n">α</span>
<span class="kd">@[inline]</span> <span class="kd">def</span> <span class="n">linesOf</span> <span class="o">:</span> <span class="n">α</span> <span class="bp">→</span> <span class="n">Lines</span> <span class="n">α</span> <span class="o">:=</span> <span class="n">id</span>

<span class="kd">instance</span> <span class="o">:</span> <span class="n">ForIn</span> <span class="n">IO</span> <span class="o">(</span><span class="n">Lines</span> <span class="n">IO.FS.Handle</span><span class="o">)</span> <span class="n">String</span> <span class="n">where</span>
  <span class="n">forIn</span> <span class="o">:=</span> <span class="n">forEachLine</span>

<span class="kd">instance</span> <span class="o">:</span> <span class="n">ForIn</span> <span class="n">IO</span> <span class="o">(</span><span class="n">Lines</span> <span class="n">FilePath</span><span class="o">)</span> <span class="n">String</span> <span class="n">where</span>
  <span class="n">forIn</span> <span class="n">path</span> <span class="n">init</span> <span class="n">f</span> <span class="o">:=</span> <span class="k">do</span>
    <span class="k">let</span> <span class="n">h</span> <span class="bp">←</span> <span class="n">IO.FS.Handle.mk</span> <span class="n">path</span> <span class="n">IO.FS.Mode.read</span> <span class="n">false</span>
    <span class="n">forEachLine</span> <span class="n">h</span> <span class="n">init</span> <span class="n">f</span>

<span class="c">/-</span><span class="cm"> Print the common lines between two files. -/</span>
<span class="kd">def</span> <span class="n">comm</span> <span class="o">(</span><span class="n">file1</span> <span class="o">:</span> <span class="n">FilePath</span><span class="o">)</span> <span class="o">(</span><span class="n">file2</span> <span class="o">:</span> <span class="n">FilePath</span><span class="o">)</span> <span class="o">:</span> <span class="n">IO</span> <span class="n">PUnit</span> <span class="o">:=</span> <span class="k">do</span>
  <span class="k">let</span> <span class="n">mut</span> <span class="n">lines</span> <span class="o">:=</span> <span class="n">HashSet.empty</span>
  <span class="n">for</span> <span class="n">line</span> <span class="k">in</span> <span class="n">linesOf</span> <span class="n">file1</span> <span class="k">do</span>
    <span class="n">lines</span> <span class="o">:=</span> <span class="n">lines.insert</span> <span class="n">line</span>
  <span class="n">for</span> <span class="n">line</span> <span class="k">in</span> <span class="n">linesOf</span> <span class="n">file2</span> <span class="k">do</span>
    <span class="k">if</span> <span class="n">lines.contains</span> <span class="n">line</span> <span class="k">then</span>
      <span class="n">IO.print</span> <span class="n">line</span>
</code></pre></div>



<a name="263438945"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/advent%20of%20code%21%21%21/near/263438945" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/advent.20of.20code!!!.html#263438945">(Dec 02 2021 at 13:48)</a>:</h4>
<p>Not much difference to <code>IO.FS.lines</code> left then except for streaming?</p>



<a name="263439047"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/advent%20of%20code%21%21%21/near/263439047" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/advent.20of.20code!!!.html#263439047">(Dec 02 2021 at 13:49)</a>:</h4>
<p><span class="user-mention" data-user-id="110024">@Sebastian Ullrich</span> exactly, the main point is streaming.</p>



<a name="263439153"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/advent%20of%20code%21%21%21/near/263439153" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/advent.20of.20code!!!.html#263439153">(Dec 02 2021 at 13:50)</a>:</h4>
<p>Which should not be relevant for AoC I'd hope, or else I'd pity their servers <span aria-label="grimacing" class="emoji emoji-1f62c" role="img" title="grimacing">:grimacing:</span></p>



<a name="263439265"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/advent%20of%20code%21%21%21/near/263439265" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/advent.20of.20code!!!.html#263439265">(Dec 02 2021 at 13:50)</a>:</h4>
<p><span class="user-mention" data-user-id="110024">@Sebastian Ullrich</span> Fair enough. It is also more declarative, which is nice. :)</p>



<a name="263440063"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/advent%20of%20code%21%21%21/near/263440063" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/advent.20of.20code!!!.html#263440063">(Dec 02 2021 at 13:56)</a>:</h4>
<p><span class="user-mention" data-user-id="110024">@Sebastian Ullrich</span> also, this does not trim newlines (which <code>IO.FS.lines</code> does, but Python's <code>for ... in</code> does not).</p>



<a name="263440482"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/advent%20of%20code%21%21%21/near/263440482" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/advent.20of.20code!!!.html#263440482">(Dec 02 2021 at 14:00)</a>:</h4>
<p>I would not be surprised if stdlibs of various languages can be split 50/50 on this question</p>



<a name="263537442"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/advent%20of%20code%21%21%21/near/263537442" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Calvin Lee <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/advent.20of.20code!!!.html#263537442">(Dec 03 2021 at 05:25)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110049">Mario Carneiro</span> <a href="#narrow/stream/270676-lean4/topic/advent.20of.20code!!!/near/263418390">said</a>:</p>
<blockquote>
<p>obviously the goal is to build the standard library in the process :)</p>
</blockquote>
<p>hullo, I'm doing AOC in Lean 4 :)<br>
I just updated my old vector library for use in day <a href="https://github.com/leanprover-community/mathlib/issues/3">#3</a>, is that something that should get added to the stdlib or is it something that would be good as a standalone library?</p>



<a name="263537594"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/advent%20of%20code%21%21%21/near/263537594" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/advent.20of.20code!!!.html#263537594">(Dec 03 2021 at 05:28)</a>:</h4>
<p>not knowing anything about it, I would say sure, PRs to mathlib4 to add tools for dealing with lean 4 stuff are welcome</p>



<a name="263537728"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/advent%20of%20code%21%21%21/near/263537728" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/advent.20of.20code!!!.html#263537728">(Dec 03 2021 at 05:30)</a>:</h4>
<p>you may or may not want to hold off, since you might find something else to add for day 4. Either way is fine</p>



<a name="263537798"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/advent%20of%20code%21%21%21/near/263537798" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/advent.20of.20code!!!.html#263537798">(Dec 03 2021 at 05:32)</a>:</h4>
<p>most projects of any appreciable size accrue a "<code>for_mathlib</code>" file containing stuff that really ought to be upstreamed to the relevant library because it's not project specific</p>



<a name="263538224"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/advent%20of%20code%21%21%21/near/263538224" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Calvin Lee <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/advent.20of.20code!!!.html#263538224">(Dec 03 2021 at 05:40)</a>:</h4>
<p>I'm not using mathlib right now because I didn't think mathlib4 was very complete and I'm mostly just programming<br>
I thought some standalone libraries for "outside of mathlib programming" might be nice in general</p>



<a name="263539092"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/advent%20of%20code%21%21%21/near/263539092" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/advent.20of.20code!!!.html#263539092">(Dec 03 2021 at 05:58)</a>:</h4>
<p>It's not very complete. The point is for you to change that :)</p>



<a name="263539276"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/advent%20of%20code%21%21%21/near/263539276" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/advent.20of.20code!!!.html#263539276">(Dec 03 2021 at 06:01)</a>:</h4>
<p>as for mathlib vs stdlib, that question will work itself out eventually, and my suggestion is just to treat mathlib4 as a programming library for now. I don't see any reason not to depend on it for your AOC stuff</p>



<a name="263539347"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/advent%20of%20code%21%21%21/near/263539347" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/advent.20of.20code!!!.html#263539347">(Dec 03 2021 at 06:02)</a>:</h4>
<p>the important thing is to actually start building those libraries and dumping them somewhere; rearranging files and splitting projects is comparatively easy</p>



<a name="263568680"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/advent%20of%20code%21%21%21/near/263568680" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alcides Fonseca <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/advent.20of.20code!!!.html#263568680">(Dec 03 2021 at 11:56)</a>:</h4>
<p>I had the same feeling as <span class="user-mention" data-user-id="382349">@Calvin Lee</span>. I was hoping for a count method in Lists (even if it required decidable_eq or similar). I believe it should life in the lean4 stdlib, but I believe many smallish PRs would not be welcome at this point. I'll try to make a list and commit them to mathlib4 or to another specific repo for archival purposes.</p>



<a name="263568886"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/advent%20of%20code%21%21%21/near/263568886" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Henrik Böving <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/advent.20of.20code!!!.html#263568886">(Dec 03 2021 at 11:58)</a>:</h4>
<p>There was recently a thread about stdlib here: <a href="#narrow/stream/270676-lean4/topic/Absolute.20value.20for.20Float/near/262585765">https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Absolute.20value.20for.20Float/near/262585765</a></p>
<p>It boils down to the fact that what Lean 4 calls Std is basically the minimum set of Lean utilities required to compile the compiler and LSP server and not actually a standard library in the regular sense...and after some discussion we more or less agreed to stuff everything into mathlib4 now and maybe have some separate std lib extension library later on.</p>



<a name="263576437"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/advent%20of%20code%21%21%21/near/263576437" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/advent.20of.20code!!!.html#263576437">(Dec 03 2021 at 13:07)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110049">Mario Carneiro</span> <a href="#narrow/stream/270676-lean4/topic/advent.20of.20code!!!/near/263537594">said</a>:</p>
<blockquote>
<p>not knowing anything about it, I would say sure, PRs to mathlib4 to add tools for dealing with lean 4 stuff are welcome</p>
</blockquote>
<p>What is the plan for <code>mathlib4</code> to grow? Forking and PRing or acquiring writing access to non-protected branches?</p>



<a name="263579962"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/advent%20of%20code%21%21%21/near/263579962" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/advent.20of.20code!!!.html#263579962">(Dec 03 2021 at 13:34)</a>:</h4>
<p><span class="user-mention silent" data-user-id="395550">Henrik Böving</span> <a href="#narrow/stream/270676-lean4/topic/advent.20of.20code!!!/near/263568886">said</a>:</p>
<blockquote>
<p>after some discussion we more or less agreed to stuff everything into mathlib4 now and maybe have some separate std lib extension library later on.</p>
</blockquote>
<p><em>We</em> did? XD</p>



<a name="263586951"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/advent%20of%20code%21%21%21/near/263586951" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Henrik Böving <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/advent.20of.20code!!!.html#263586951">(Dec 03 2021 at 14:28)</a>:</h4>
<p>More or less :P</p>



<a name="263614239"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/advent%20of%20code%21%21%21/near/263614239" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/advent.20of.20code!!!.html#263614239">(Dec 03 2021 at 17:50)</a>:</h4>
<p><span class="user-mention" data-user-id="451983">@Arthur Paulino</span> PRs should be fine, we don't have a heavy CI setup like mathlib</p>



<a name="264126854"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/advent%20of%20code%21%21%21/near/264126854" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/advent.20of.20code!!!.html#264126854">(Dec 08 2021 at 08:53)</a>:</h4>
<p>I was goaded into finally participating in AoC by friends. My solution for today takes 134s in the interpreter... or 4s when compiled <span aria-label="open mouth" class="emoji emoji-1f62e" role="img" title="open mouth">:open_mouth:</span> .</p>



<a name="264127238"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/advent%20of%20code%21%21%21/near/264127238" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/advent.20of.20code!!!.html#264127238">(Dec 08 2021 at 08:57)</a>:</h4>
<p>It would be lovely to see people working together on the problems in Lean, but is this sort of thing frowned upon? If so, it would be lovely to see some discussion afterwards about how different people found the questions</p>



<a name="264127293"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/advent%20of%20code%21%21%21/near/264127293" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/advent.20of.20code!!!.html#264127293">(Dec 08 2021 at 08:57)</a>:</h4>
<p>Last year it was just Reid saying "I did it, here's the repo"</p>



<a name="264127411"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/advent%20of%20code%21%21%21/near/264127411" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Henrik Böving <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/advent.20of.20code!!!.html#264127411">(Dec 08 2021 at 08:58)</a>:</h4>
<p>Usually in AoC everyone works for themselves and afterwards there is some discussion about how people did it. E.g. someone on reddit posted a mini paper on yesterday: <a href="https://www.reddit.com/r/adventofcode/comments/rawxad/2021_day_7_part_2_i_wrote_a_paper_on_todays/">https://www.reddit.com/r/adventofcode/comments/rawxad/2021_day_7_part_2_i_wrote_a_paper_on_todays/</a></p>



<a name="264128225"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/advent%20of%20code%21%21%21/near/264128225" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Huỳnh Trần Khanh <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/advent.20of.20code!!!.html#264128225">(Dec 08 2021 at 09:06)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110038">Kevin Buzzard</span> <a href="#narrow/stream/270676-lean4/topic/advent.20of.20code!!!/near/264127238">said</a>:</p>
<blockquote>
<p>It would be lovely to see people working together on the problems in Lean, but is this sort of thing frowned upon? If so, it would be lovely to see some discussion afterwards about how different people found the questions</p>
</blockquote>
<p>not frowned upon at all, feel free to do this if you like</p>



<a name="264163988"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/advent%20of%20code%21%21%21/near/264163988" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/advent.20of.20code!!!.html#264163988">(Dec 08 2021 at 14:41)</a>:</h4>
<p>I just finished day 8, and using <code>#eval ...</code> inside the lean file with no compilation gets me the right answer in about 2 seconds.<br>
I don't know if I had the most efficient approach. this was a fun puzzle :)</p>
<p>My code is here (<em>spoiler ahead, obviously</em>)</p>
<div class="spoiler-block"><div class="spoiler-header">
</div><div class="spoiler-content" aria-hidden="true">
<p><a href="https://github.com/adamtopaz/lean4_advent_2021/blob/master/day8/part2.lean">https://github.com/adamtopaz/lean4_advent_2021/blob/master/day8/part2.lean</a></p>
</div></div>



<a name="264164162"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/advent%20of%20code%21%21%21/near/264164162" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/advent.20of.20code!!!.html#264164162">(Dec 08 2021 at 14:42)</a>:</h4>
<p>In my defense, I tried for the simplest possible solution :) . It's 23 lines.</p>



<a name="264164195"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/advent%20of%20code%21%21%21/near/264164195" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/advent.20of.20code!!!.html#264164195">(Dec 08 2021 at 14:42)</a>:</h4>
<p>Yeah, mine is a bit longer :)</p>



<a name="264164463"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/advent%20of%20code%21%21%21/near/264164463" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Taucher <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/advent.20of.20code!!!.html#264164463">(Dec 08 2021 at 14:44)</a>:</h4>
<p>Maybe next year the site could add an <code>Advent of Code</code> stream. Then if the code is indexed by search engines it might give Lean more visibility in the programming world.</p>



<a name="265049050"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/advent%20of%20code%21%21%21/near/265049050" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alcides Fonseca <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/advent.20of.20code!!!.html#265049050">(Dec 15 2021 at 17:58)</a>:</h4>
<p>I don’t know if anyone has solved part 2 of today’s challenge (day 15). It is a standard pathfinding algorithm, but with a largish size. I’ve found lean to be really slow (even using a tail recursive function). My solution took around 10 minutes on my mbp, but I was expecting it to be solved in one minute, based on other languages.</p>
<p>I guess my slowdown could be due to using arrays (has a sorting method included, unlike lists). Anyone else having the same issue?</p>
<p><a href="https://github.com/alcides/AoC2021Lean4/blob/master/15/b.lean">https://github.com/alcides/AoC2021Lean4/blob/master/15/b.lean</a></p>



<a name="265049201"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/advent%20of%20code%21%21%21/near/265049201" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/advent.20of.20code!!!.html#265049201">(Dec 15 2021 at 17:59)</a>:</h4>
<p>Is it actually tail recursive?</p>



<a name="265049514"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/advent%20of%20code%21%21%21/near/265049514" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/advent.20of.20code!!!.html#265049514">(Dec 15 2021 at 18:00)</a>:</h4>
<p>1) You're using insertionSort, this could be a bit slow.</p>



<a name="265049538"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/advent%20of%20code%21%21%21/near/265049538" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/advent.20of.20code!!!.html#265049538">(Dec 15 2021 at 18:01)</a>:</h4>
<p>failure of TCO and accidental sharing are the first things I would check for</p>



<a name="265049931"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/advent%20of%20code%21%21%21/near/265049931" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/advent.20of.20code!!!.html#265049931">(Dec 15 2021 at 18:03)</a>:</h4>
<p>2) Array sorting is apparently pretty slow if you run the code in the interpreter.  You might need to compile it, see this other discussion: <a href="#narrow/stream/270676-lean4/topic/include.20lean.2Eh/near/264881145">https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/include.20lean.2Eh/near/264881145</a></p>



<a name="265049958"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/advent%20of%20code%21%21%21/near/265049958" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/advent.20of.20code!!!.html#265049958">(Dec 15 2021 at 18:03)</a>:</h4>
<p>I would expect arrays to be faster than lists, not slower, unless you have a lot of sharing</p>



<a name="265050463"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/advent%20of%20code%21%21%21/near/265050463" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/advent.20of.20code!!!.html#265050463">(Dec 15 2021 at 18:07)</a>:</h4>
<p>(My bad Dijkstra takes 4s interpreted, 0.4s compiled for part 2)</p>



<a name="265050787"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/advent%20of%20code%21%21%21/near/265050787" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/advent.20of.20code!!!.html#265050787">(Dec 15 2021 at 18:09)</a>:</h4>
<p>Your  string parsing (especially <code>parseMatrix</code>) is also doing way to much conversion between Lists and Arrays (<code>toList</code> and <code>toArray</code> are both O(n) operations).</p>



<a name="265051044"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/advent%20of%20code%21%21%21/near/265051044" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/advent.20of.20code!!!.html#265051044">(Dec 15 2021 at 18:11)</a>:</h4>
<p>Everything in there should ideally just be <code>Array</code>s</p>



<a name="265051103"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/advent%20of%20code%21%21%21/near/265051103" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/advent.20of.20code!!!.html#265051103">(Dec 15 2021 at 18:11)</a>:</h4>
<p>that's probably not the bottleneck though, since it only happens once. Now that I see this is Dijkstra, that <code>insertionSort</code> looks like the culprit since it's doing an O(n^2) operation where it should be O(log n)</p>



<a name="265051919"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/advent%20of%20code%21%21%21/near/265051919" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/advent.20of.20code!!!.html#265051919">(Dec 15 2021 at 18:17)</a>:</h4>
<p><span class="user-mention" data-user-id="110049">@Mario Carneiro</span> The script is converting an <code>Array</code> of lines (of a very large file) to a <code>List</code>. Then for each <code>String</code> line, it is converting it to a <code>List</code>(allocating a list node for each character of the line) and then to an <code>Array</code>. Then it is converting the entire result back to an <code>Array</code>. That is a lot of heavy duty memory  allocations. While <code>insertionSort</code> is a problem, I would not be surprised if the bottleneck is nonetheless the memory conversion.</p>



<a name="265051996"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/advent%20of%20code%21%21%21/near/265051996" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/advent.20of.20code!!!.html#265051996">(Dec 15 2021 at 18:17)</a>:</h4>
<p>It does happen in the first phase of the program, so it should not be hard to benchmark that part</p>



<a name="265052021"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/advent%20of%20code%21%21%21/near/265052021" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/advent.20of.20code!!!.html#265052021">(Dec 15 2021 at 18:17)</a>:</h4>
<p>I agree that there are a lot of unnecessary conversions there</p>



<a name="265052179"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/advent%20of%20code%21%21%21/near/265052179" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/advent.20of.20code!!!.html#265052179">(Dec 15 2021 at 18:18)</a>:</h4>
<p>The issue is that the <code>insertionSort</code> sorts the entire priority queue on every iteration, meaning that the overall complexity is somewhere around O(n^3) or O(n^4) for an n * n grid graph</p>



<a name="265052318"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/advent%20of%20code%21%21%21/near/265052318" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alcides Fonseca <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/advent.20of.20code!!!.html#265052318">(Dec 15 2021 at 18:19)</a>:</h4>
<p>I am aware of that bottleneck in the parsing. But I have been doing the same thing every day, and it has not been an issue. The reason for that is that I am trying to spend less time writing code (I have other tasks to do), and unfortunately List and Array do not have the same utility methods, so I end up doing the conversion every now and then. But I'm sure that is not the issue, but rather Dijksgtra (i didn't mention it, because I didn't want to spoiler anyone :-)</p>



<a name="265052578"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/advent%20of%20code%21%21%21/near/265052578" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/advent.20of.20code!!!.html#265052578">(Dec 15 2021 at 18:21)</a>:</h4>
<p>If you can't be bothered to write the code yourself, you could instead put an issue on mathlib4 for any missing utility theorems so that we can at least record the problem and maybe get around to it later</p>



<a name="265052587"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/advent%20of%20code%21%21%21/near/265052587" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alcides Fonseca <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/advent.20of.20code!!!.html#265052587">(Dec 15 2021 at 18:21)</a>:</h4>
<p>I tried to use the binary insert instead of sorting, but it didn't work correct (probably misuse, or I didn't understand what the function was supposed to do).</p>
<p>I know that I should have implemented an ordered insert on the array, but I wanted to take this opportunity to use the current stdlib and identify what I need from it. That is one example.</p>



<a name="265052652"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/advent%20of%20code%21%21%21/near/265052652" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/advent.20of.20code!!!.html#265052652">(Dec 15 2021 at 18:22)</a>:</h4>
<p>Finally a use case for spoiler tags <span aria-label="grinning face with smiling eyes" class="emoji emoji-1f601" role="img" title="grinning face with smiling eyes">:grinning_face_with_smiling_eyes:</span></p>



<a name="265052710"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/advent%20of%20code%21%21%21/near/265052710" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alcides Fonseca <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/advent.20of.20code!!!.html#265052710">(Dec 15 2021 at 18:22)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110049">Mario Carneiro</span> <a href="#narrow/stream/270676-lean4/topic/advent.20of.20code!!!/near/265052578">said</a>:</p>
<blockquote>
<p>If you can't be bothered to write the code yourself, you could instead put an issue on mathlib4 for any missing utility theorems so that we can at least record the problem and maybe get around to it later</p>
</blockquote>
<p>That is the point of this exercice. I am writing down all the missing functions I feel I need, and I hope to contribute them early next year.</p>



<a name="265052909"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/advent%20of%20code%21%21%21/near/265052909" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alcides Fonseca <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/advent.20of.20code!!!.html#265052909">(Dec 15 2021 at 18:23)</a>:</h4>
<p>I would also like to prove some things about these programs, or write them in a more type-safe approach (I am using a lot of ! methods). But I'll leave that for after the challenge.+</p>



<a name="265053051"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/advent%20of%20code%21%21%21/near/265053051" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/advent.20of.20code!!!.html#265053051">(Dec 15 2021 at 18:24)</a>:</h4>
<p>It's usually pretty easy to know what to prove once you have the functions, provided the function isn't written in a way that precludes proof (i.e. <code>partial</code>)</p>



<a name="265053588"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/advent%20of%20code%21%21%21/near/265053588" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/advent.20of.20code!!!.html#265053588">(Dec 15 2021 at 18:28)</a>:</h4>
<p>I'm not sure what your input is, maybe the distribution makes this reasonable, but the <code>wrap9</code> function has a really bad asymptotic complexity</p>



<a name="265054063"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/advent%20of%20code%21%21%21/near/265054063" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alcides Fonseca <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/advent.20of.20code!!!.html#265054063">(Dec 15 2021 at 18:31)</a>:</h4>
<p>The highest input for that function will be 19. That is now the source of the slowdown. I agree with you that it should be the insertionSort.</p>



<a name="265054233"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/advent%20of%20code%21%21%21/near/265054233" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/advent.20of.20code!!!.html#265054233">(Dec 15 2021 at 18:32)</a>:</h4>
<p><span class="user-mention" data-user-id="110024">@Sebastian Ullrich</span> Do you know why <code>Array.back</code> and <code>Array.pop</code> have the interface that they do? It seems like it would work better with the reference counting to have them combined into one function. And I'm always afraid of the <code>pop</code> causing a copy if the <code>back</code> call floats after it somehow.</p>



<a name="265054508"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/advent%20of%20code%21%21%21/near/265054508" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/advent.20of.20code!!!.html#265054508">(Dec 15 2021 at 18:34)</a>:</h4>
<p>Allocating a pair for the return value wouldn't exactly be ideal either, no? I know the floating story is not completely clear yet, but ideally we should guarantee that this never happens imo.</p>



<a name="265054562"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/advent%20of%20code%21%21%21/near/265054562" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/advent.20of.20code!!!.html#265054562">(Dec 15 2021 at 18:34)</a>:</h4>
<p>I think we're all counting on return value unboxing. <span aria-label="smile" class="emoji emoji-1f642" role="img" title="smile">:smile:</span></p>



<a name="265054587"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/advent%20of%20code%21%21%21/near/265054587" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/advent.20of.20code!!!.html#265054587">(Dec 15 2021 at 18:35)</a>:</h4>
<p>Eventually :)</p>



<a name="265054610"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/advent%20of%20code%21%21%21/near/265054610" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/advent.20of.20code!!!.html#265054610">(Dec 15 2021 at 18:35)</a>:</h4>
<p>Is there any hope of LLVM doing this already?</p>



<a name="265054694"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/advent%20of%20code%21%21%21/near/265054694" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/advent.20of.20code!!!.html#265054694">(Dec 15 2021 at 18:36)</a>:</h4>
<p>An alternative interface that doesn't rely on pair unboxing is <code>IORef (Array A) -&gt; IO A</code></p>



<a name="265054805"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/advent%20of%20code%21%21%21/near/265054805" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/advent.20of.20code!!!.html#265054805">(Dec 15 2021 at 18:36)</a>:</h4>
<p>More seriously, the same problem is also there with tons of other functions and other types like string.  Bundling back/pop only fixes a single instance.</p>



<a name="265054884"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/advent%20of%20code%21%21%21/near/265054884" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/advent.20of.20code!!!.html#265054884">(Dec 15 2021 at 18:37)</a>:</h4>
<p>you mean back/pop on string?</p>



<a name="265054929"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/advent%20of%20code%21%21%21/near/265054929" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/advent.20of.20code!!!.html#265054929">(Dec 15 2021 at 18:37)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110049">Mario Carneiro</span> <a href="#narrow/stream/270676-lean4/topic/advent.20of.20code!!!/near/265054610">said</a>:</p>
<blockquote>
<p>Is there any hope of LLVM doing this already?</p>
</blockquote>
<p>Last time I looked, LLVM doesn't know anything about annihilating (custom) malloc-free pairs</p>



<a name="265055047"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/advent%20of%20code%21%21%21/near/265055047" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/advent.20of.20code!!!.html#265055047">(Dec 15 2021 at 18:38)</a>:</h4>
<p>maybe if it inlines the custom code... generating LLVM directly would probably help here</p>



<a name="265055129"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/advent%20of%20code%21%21%21/near/265055129" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/advent.20of.20code!!!.html#265055129">(Dec 15 2021 at 18:39)</a>:</h4>
<p>We definitely don't want to inline the allocator any more than we already do</p>



<a name="265055281"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/advent%20of%20code%21%21%21/near/265055281" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/advent.20of.20code!!!.html#265055281">(Dec 15 2021 at 18:40)</a>:</h4>
<p>Are <code>lean_object</code>s ever stack allocated?</p>



<a name="265055386"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/advent%20of%20code%21%21%21/near/265055386" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/advent.20of.20code!!!.html#265055386">(Dec 15 2021 at 18:40)</a>:</h4>
<p>These transient pairs would work well with escape analysis</p>



<a name="265055415"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/advent%20of%20code%21%21%21/near/265055415" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/advent.20of.20code!!!.html#265055415">(Dec 15 2021 at 18:41)</a>:</h4>
<p>Not right now, no</p>



<a name="265300275"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/advent%20of%20code%21%21%21/near/265300275" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Tim Hunter <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/advent.20of.20code!!!.html#265300275">(Dec 17 2021 at 14:14)</a>:</h4>
<p>By the way, what is a recommended way to write small unit tests for lean? I started to compile a collection of extra methods that I was missing from scala, haskell, etc. but I am not sure how to add small tests to them:<br>
<a href="https://github.com/tjhunter/advent_of_code_lean4_2021/blob/main/MyAdvent/AdventStd.lean">https://github.com/tjhunter/advent_of_code_lean4_2021/blob/main/MyAdvent/AdventStd.lean</a></p>
<p>The most interesting can be sent as a PR if there is interest for it. (also, any advice on the code is welcome!)</p>



<a name="265365403"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/advent%20of%20code%21%21%21/near/265365403" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/advent.20of.20code!!!.html#265365403">(Dec 17 2021 at 21:50)</a>:</h4>
<p><span class="user-mention" data-user-id="460889">@Tim Hunter</span> the common approach is just to write a test file with <code>#eval</code> statements that test the code and then run <code>lean</code> on the file to verify that it does not error.</p>



<a name="265473451"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/advent%20of%20code%21%21%21/near/265473451" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alcides Fonseca <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/advent.20of.20code!!!.html#265473451">(Dec 19 2021 at 10:30)</a>:</h4>
<p><span class="user-mention silent" data-user-id="315577">Mac</span> <a href="#narrow/stream/270676-lean4/topic/advent.20of.20code!!!/near/265365403">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="460889">Tim Hunter</span> the common approach is just to write a test file with <code>#eval</code> statements that test the code and then run <code>lean</code> on the file to verify that it does not error.</p>
</blockquote>
<p>I've been using eval for small utilities. However, because some functions have to be tested with large-ish inputs (like today's puzzle), I end up just making a lot of changes to the main function. But I agree some little DSL might be useful.</p>



<a name="265474377"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/advent%20of%20code%21%21%21/near/265474377" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alcides Fonseca <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/advent.20of.20code!!!.html#265474377">(Dec 19 2021 at 10:57)</a>:</h4>
<p>Btw, regarding today's puzzle, I only managed to run it when compiled. The interpreted version was too slow to be practical. I wonder if this could be useful for performance (regression) testing?</p>
<div class="spoiler-block"><div class="spoiler-header">
<p>Link to my solution</p>
</div><div class="spoiler-content" aria-hidden="true">
<p><a href="https://github.com/alcides/AoC2021Lean4/blob/master/19/a.lean">https://github.com/alcides/AoC2021Lean4/blob/master/19/a.lean</a></p>
<p>I know there are a few alternatives to reduce complexity:
* using sets/hashmaps to reduce the time iterating arrays.
* someone commented a fingerprint approach using triangles.</p>
<p>But I do not have infinite amount of time to play with this, so the first solution that works is fine.</p>
<p>It took &lt;30s in the compiled version, but more than 1 hour in the interpreted version. It is still halfway right now.</p>
</div></div>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>