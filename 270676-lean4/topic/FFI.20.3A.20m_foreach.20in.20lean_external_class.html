---
layout: archive
title: Zulip Chat Archive
permalink: /stream/270676-lean4/topic/FFI.20.3A.20m_foreach.20in.20lean_external_class.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/index.html">lean4</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/FFI.20.3A.20m_foreach.20in.20lean_external_class.html">FFI : m_foreach in lean_external_class</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="285535657"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/FFI%20%3A%20m_foreach%20in%20lean_external_class/near/285535657" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> He-chien Tsai <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/FFI.20.3A.20m_foreach.20in.20lean_external_class.html#285535657">(Jun 09 2022 at 13:40)</a>:</h4>
<p>What's  m_foreach in <a href="https://github.com/leanprover/lean4/blob/master/tests/compiler/foreign/myfuns.cpp">sample code</a> supposed to be? Only two clues is at <a href="https://github.com/leanprover/lean4/blob/eb170d1f43e8d30d0149aef0ede2d7c31d5f2a08/src/runtime/object.cpp#L502">here</a> and <a href="https://github.com/leanprover/lean4/blob/eb170d1f43e8d30d0149aef0ede2d7c31d5f2a08/src/runtime/object.cpp#L574">here</a>.</p>



<a name="285558961"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/FFI%20%3A%20m_foreach%20in%20lean_external_class/near/285558961" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/FFI.20.3A.20m_foreach.20in.20lean_external_class.html#285558961">(Jun 09 2022 at 16:16)</a>:</h4>
<p>I don't see a use of <code>m_foreach</code> in the sample code you linked. However, if you are just generally curious, <code>m_foreach</code> is a field of <code>lean_external_class</code> that is used to iterate over the nested lean objects in an Lean external object. For example, if the struct you are wrapping has fields that are Lean objects (i.e., of type <code>lean_object</code>) you would provide a <code>foreach</code> method that  invokes the passed  function (i.e., the <code>b_lean_obj_arg</code>  on the each of those fields).</p>



<a name="285622650"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/FFI%20%3A%20m_foreach%20in%20lean_external_class/near/285622650" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> He-chien Tsai <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/FFI.20.3A.20m_foreach.20in.20lean_external_class.html#285622650">(Jun 10 2022 at 02:25)</a>:</h4>
<p>I mess up variables in original post, edited. In sample code, lean_register_external_class assigns S_finalize and S_foreach to m_finalize and m_foreach at <a href="https://github.com/leanprover/lean4/blob/eb170d1f43e8d30d0149aef0ede2d7c31d5f2a08/src/runtime/object.cpp#L2178">here</a>, but the only two lines which call m_foreach doesn't explicitly show what's m_foreach supposed to do, sample code literally do nothing. What's S_foreach in sample code supposed to do if it has nested objects?</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>