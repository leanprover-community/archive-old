---
layout: archive
title: Zulip Chat Archive
permalink: /stream/270676-lean4/topic/lol.20another.20WASM.20question.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/index.html">lean4</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/lol.20another.20WASM.20question.html">lol another WASM question</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="242308345"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/lol%20another%20WASM%20question/near/242308345" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Huỳnh Trần Khanh <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/lol.20another.20WASM.20question.html#242308345">(Jun 11 2021 at 07:10)</a>:</h4>
<p>ok so this is another WASM question and you might think in your head oh why does this guy love WASM so much. is Lean 4 significantly faster than Lean 3 on WASM? in the future I might package Lean 4 for use on the web because why not <span aria-label="joy" class="emoji emoji-1f602" role="img" title="joy">:joy:</span> Lean 3 can be annoyingly slow on WASM sometimes</p>



<a name="242308602"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/lol%20another%20WASM%20question/near/242308602" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Huỳnh Trần Khanh <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/lol.20another.20WASM.20question.html#242308602">(Jun 11 2021 at 07:14)</a>:</h4>
<p>if Lean 4 is still slow on WASM I might need to consider other approaches, for example running Lean 4 on a server with appropriate sandboxing</p>



<a name="242309388"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/lol%20another%20WASM%20question/near/242309388" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/lol.20another.20WASM.20question.html#242309388">(Jun 11 2021 at 07:25)</a>:</h4>
<p>It will probably be faster for builtin stuff and about the same for interpreted stuff. But WASM may significantly complicate the bootstrapping/plugin situation for libraries like mathlib that depend on compiled tactics</p>



<a name="242384891"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/lol%20another%20WASM%20question/near/242384891" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Wojciech Nawrocki <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/lol.20another.20WASM.20question.html#242384891">(Jun 11 2021 at 18:26)</a>:</h4>
<p><span class="user-mention" data-user-id="270523">@Huỳnh Trần Khanh</span> it depends on what you mean by "Lean 4 on WASM". We recently added an Emscripten build which can run under Node.js. Precise benchmarks TBD, but it is currently slower than native. However there is lots of optimisation work specific to Emscripten to be done. What is your intended use-case for "Lean4 on the web"? A build that will be usable in the browser as a library is WIP. But there are no immediate plans for running the LSP server in browsers (although it would be cool). Also we require the Emscripten runtime. A standalone/WASI build is not planned.</p>



<a name="242385095"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/lol%20another%20WASM%20question/near/242385095" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Wojciech Nawrocki <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/lol.20another.20WASM.20question.html#242385095">(Jun 11 2021 at 18:28)</a>:</h4>
<blockquote>
<p>WASM may significantly complicate the bootstrapping/plugin situation for libraries like mathlib that depend on compiled tactics</p>
</blockquote>
<p>Amazingly enough, the Emscripten people implemented a (admittedly simple, but good enough) dynamic linker, so we <em>can</em> load dylibs/plugins.</p>



<a name="242452054"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/lol%20another%20WASM%20question/near/242452054" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ryan Lahfa <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/lol.20another.20WASM.20question.html#242452054">(Jun 12 2021 at 13:57)</a>:</h4>
<p><span class="user-mention silent" data-user-id="128280">Wojciech Nawrocki</span> <a href="#narrow/stream/270676-lean4/topic/lol.20another.20WASM.20question/near/242384891">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="270523">Huỳnh Trần Khanh</span> it depends on what you mean by "Lean 4 on WASM". We recently added an Emscripten build which can run under Node.js. Precise benchmarks TBD, but it is currently slower than native. However there is lots of optimisation work specific to Emscripten to be done. What is your intended use-case for "Lean4 on the web"? A build that will be usable in the browser as a library is WIP. But there are no immediate plans for running the LSP server in browsers (although it would be cool). Also we require the Emscripten runtime. A standalone/WASI build is not planned.</p>
</blockquote>
<p>Is this public? I'm interested, I was planning to tackle the WASM Lean 4 issue but didn't had any time to fix it</p>



<a name="242455364"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/lol%20another%20WASM%20question/near/242455364" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/lol.20another.20WASM.20question.html#242455364">(Jun 12 2021 at 15:05)</a>:</h4>
<p><a href="https://github.com/leanprover/lean4/pull/505">https://github.com/leanprover/lean4/pull/505</a></p>



<a name="274288178"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/lol%20another%20WASM%20question/near/274288178" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Xubai Wang <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/lol.20another.20WASM.20question.html#274288178">(Mar 06 2022 at 06:12)</a>:</h4>
<p><span class="user-mention silent" data-user-id="128280">Wojciech Nawrocki</span> <a href="#narrow/stream/270676-lean4/topic/lol.20another.20WASM.20question/near/242384891">said</a>:</p>
<blockquote>
<p>A standalone/WASI build is not planned.</p>
</blockquote>
<p>Why is that? It seems Emscripten does not provide more functionality than WASI (thread is unavailable in both), and <a href="https://github.com/appcypher/awesome-wasm-langs">many</a> languages prefer standalone (rust) or wasi (swiftwasm, tinygo). Also WASI is the WebAssembly standard.</p>



<a name="274288486"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/lol%20another%20WASM%20question/near/274288486" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Xubai Wang <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/lol.20another.20WASM.20question.html#274288486">(Mar 06 2022 at 06:20)</a>:</h4>
<p>Also in lean 3 Emscripten compiles the whole lean program into <code>lean.js</code> and <code>lean.wasm</code>. What can I do if I just want  to compile a single lake project?</p>



<a name="274295721"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/lol%20another%20WASM%20question/near/274295721" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/lol.20another.20WASM.20question.html#274295721">(Mar 06 2022 at 09:28)</a>:</h4>
<blockquote>
<p>It seems Emscripten does not provide more functionality than WASI</p>
</blockquote>
<p>I don't think that's true, Emscripten supports C++ exceptions that Lean uses. But I don't think the stdlib implementation needs them, so building a standalone Lean 4 program against WASI <em>might</em> be possible.</p>



<a name="274297513"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/lol%20another%20WASM%20question/near/274297513" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Xubai Wang <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/lol.20another.20WASM.20question.html#274297513">(Mar 06 2022 at 10:12)</a>:</h4>
<p>Oh yes, exception for WASM is still in proposal stage <span aria-label="upside down" class="emoji emoji-1f643" role="img" title="upside down">:upside_down:</span>  (WASI will have hope when all C++ stuff is moved to Lean).</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>