---
layout: archive
title: Zulip Chat Archive
permalink: /stream/270676-lean4/topic/Abysmal.20performance.20when.20.20doing.20large.20inductions.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/index.html">lean4</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Abysmal.20performance.20when.20.20doing.20large.20inductions.html">Abysmal performance when  doing large inductions</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="278570389"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Abysmal%20performance%20when%20%20doing%20large%20inductions/near/278570389" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jad Ghalayini <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Abysmal.20performance.20when.20.20doing.20large.20inductions.html#278570389">(Apr 11 2022 at 15:23)</a>:</h4>
<p>So when I'm trying to do a large induction with e.g. 30 cases; I get really really bad performance, especially if I have a large automated branch at the end handling say 25 of the cases: every time I modify one of the upper 5 cases, I need to wait for 2 minutes before the infoview updates and I can think about what to write next. Would it be possible to somehow cache work so this is not the case (the cases of the induction should be completely independent of each other no?)</p>



<a name="278572041"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Abysmal%20performance%20when%20%20doing%20large%20inductions/near/278572041" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Leonardo de Moura <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Abysmal.20performance.20when.20.20doing.20large.20inductions.html#278572041">(Apr 11 2022 at 15:33)</a>:</h4>
<p>We have a new <code>checkpoint</code> tactic. It is an experimental stage right now, but it was added for this kind of scenario.<br>
Could you try the following?</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">checkpoint</span> <span class="n">induction</span> <span class="n">n</span> <span class="bp">&lt;;&gt;</span> <span class="n">try</span> <span class="o">(</span><span class="bp">&lt;</span><span class="n">tactic</span> <span class="n">that</span> <span class="n">takes</span> <span class="n">care</span> <span class="n">of</span> <span class="n">the</span> <span class="mi">25</span> <span class="n">cases</span><span class="bp">&gt;</span><span class="o">)</span>
<span class="n">case</span> <span class="bp">&lt;</span><span class="n">remainin</span><span class="bp">-</span><span class="n">case</span><span class="bp">-</span><span class="mi">1</span><span class="bp">&gt;</span> <span class="bp">=&gt;</span> <span class="bp">...</span>
<span class="bp">...</span>
<span class="n">case</span> <span class="bp">&lt;</span><span class="n">remainin</span><span class="bp">-</span><span class="n">case</span><span class="bp">-</span><span class="mi">5</span><span class="bp">&gt;</span> <span class="bp">=&gt;</span> <span class="bp">...</span>
</code></pre></div>
<p>Here is an example</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">constant</span> <span class="n">f</span> <span class="o">:</span> <span class="n">Nat</span> <span class="bp">→</span> <span class="n">Nat</span>
<span class="kd">@[simp]</span> <span class="kd">axiom</span> <span class="n">f_eq_1</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="n">Nat</span><span class="o">)</span> <span class="o">:</span> <span class="n">f</span> <span class="o">(</span><span class="n">n</span><span class="bp">+</span><span class="mi">1</span><span class="o">)</span> <span class="bp">=</span> <span class="n">f</span> <span class="n">n</span>
<span class="kd">@[simp]</span> <span class="kd">axiom</span> <span class="n">f_eq_2</span> <span class="o">:</span> <span class="n">f</span> <span class="mi">0</span> <span class="bp">=</span> <span class="mi">1</span>

<span class="kd">inductive</span> <span class="n">Foo</span> <span class="n">where</span>
  <span class="bp">|</span> <span class="n">c1</span> <span class="bp">|</span> <span class="n">c2</span> <span class="bp">|</span> <span class="n">c3</span> <span class="bp">|</span> <span class="n">c4</span> <span class="bp">|</span> <span class="n">c5</span> <span class="bp">|</span> <span class="n">c6</span> <span class="bp">|</span> <span class="n">c7</span>

<span class="kd">def</span> <span class="n">h</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="n">Nat</span><span class="o">)</span> <span class="o">:=</span> <span class="mi">1</span>

<span class="kd">def</span> <span class="n">g</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="n">Foo</span><span class="o">)</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="n">Nat</span><span class="o">)</span> <span class="o">:</span> <span class="n">Nat</span> <span class="o">:=</span>
  <span class="k">match</span> <span class="n">n</span> <span class="k">with</span>
  <span class="bp">|</span> <span class="bp">.</span><span class="n">c7</span> <span class="bp">=&gt;</span> <span class="n">h</span> <span class="n">x</span>
  <span class="bp">|</span> <span class="n">_</span>   <span class="bp">=&gt;</span> <span class="n">f</span> <span class="mi">1000</span>

<span class="kd">set_option</span> <span class="n">maxRecDepth</span> <span class="mi">100000</span>

<span class="kd">example</span> <span class="o">:</span> <span class="n">g</span> <span class="n">n</span> <span class="n">x</span> <span class="bp">=</span> <span class="mi">1</span> <span class="o">:=</span> <span class="kd">by</span>
  <span class="n">checkpoint</span> <span class="n">induction</span> <span class="n">n</span> <span class="bp">&lt;;&gt;</span> <span class="n">try</span> <span class="n">simp</span> <span class="o">[</span><span class="n">g</span><span class="o">]</span>
  <span class="n">case</span> <span class="n">c7</span> <span class="bp">=&gt;</span>
   <span class="n">simp</span> <span class="o">[</span><span class="n">h</span><span class="o">]</span>
</code></pre></div>



<a name="278611808"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Abysmal%20performance%20when%20%20doing%20large%20inductions/near/278611808" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Leonardo de Moura <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Abysmal.20performance.20when.20.20doing.20large.20inductions.html#278611808">(Apr 11 2022 at 20:25)</a>:</h4>
<p>Another trick is to temporarily use the <code>stop</code> tactic to disable parts of your proof. <br>
We could also write the example above as</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">example</span> <span class="o">:</span> <span class="n">g</span> <span class="n">n</span> <span class="n">x</span> <span class="bp">=</span> <span class="mi">1</span> <span class="o">:=</span> <span class="kd">by</span>
  <span class="n">induction</span> <span class="n">n</span> <span class="k">with</span>
  <span class="bp">|</span> <span class="n">c7</span> <span class="bp">=&gt;</span> <span class="c">/-</span><span class="cm"> we can now comfortably work on this branch without delay -/</span> <span class="n">done</span>
  <span class="bp">|</span> <span class="n">_</span> <span class="bp">=&gt;</span> <span class="n">stop</span> <span class="n">simp</span> <span class="o">[</span><span class="n">g</span><span class="o">]</span> <span class="c">/-</span><span class="cm"> stop disabled the else branch. -/</span>
</code></pre></div>



<a name="278611928"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Abysmal%20performance%20when%20%20doing%20large%20inductions/near/278611928" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Leonardo de Moura <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Abysmal.20performance.20when.20.20doing.20large.20inductions.html#278611928">(Apr 11 2022 at 20:26)</a>:</h4>
<p><span class="user-mention" data-user-id="110049">@Mario Carneiro</span> suggested other tricks in the following thread <a href="#narrow/stream/270676-lean4/topic/Partial.20evaluation.20of.20a.20file">https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partial.20evaluation.20of.20a.20file</a></p>



<a name="278612009"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Abysmal%20performance%20when%20%20doing%20large%20inductions/near/278612009" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Abysmal.20performance.20when.20.20doing.20large.20inductions.html#278612009">(Apr 11 2022 at 20:27)</a>:</h4>
<p>the <code>stop</code> tactic is called <code>sorry { ... }</code> in current lean 3</p>



<a name="279307771"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Abysmal%20performance%20when%20%20doing%20large%20inductions/near/279307771" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Leonardo de Moura <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Abysmal.20performance.20when.20.20doing.20large.20inductions.html#279307771">(Apr 18 2022 at 17:03)</a>:</h4>
<p>We have added the <code>save</code> tactic yesterday. It is often more convenient to use than <code>checkpoint</code>.<br>
See <a href="https://github.com/leanprover/lean4/blob/master/RELEASES.md">https://github.com/leanprover/lean4/blob/master/RELEASES.md</a> for additional details.</p>



<a name="279307988"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Abysmal%20performance%20when%20%20doing%20large%20inductions/near/279307988" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Leonardo de Moura <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Abysmal.20performance.20when.20.20doing.20large.20inductions.html#279307988">(Apr 18 2022 at 17:05)</a>:</h4>
<p>Example:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">macro</span> <span class="s2">"expensive_tactic"</span> <span class="o">:</span> <span class="n">tactic</span> <span class="bp">=&gt;</span> <span class="bp">`</span><span class="o">(</span><span class="n">sleep</span> <span class="mi">5000</span><span class="o">)</span> <span class="c1">-- sleeps for 5 seconds</span>

<span class="kd">example</span> <span class="o">(</span><span class="n">h₁</span> <span class="o">:</span> <span class="n">x</span> <span class="bp">=</span> <span class="n">y</span><span class="o">)</span> <span class="o">(</span><span class="n">h₂</span> <span class="o">:</span> <span class="n">y</span> <span class="bp">=</span> <span class="n">z</span><span class="o">)</span> <span class="o">:</span> <span class="n">z</span> <span class="bp">=</span> <span class="n">x</span> <span class="o">:=</span> <span class="kd">by</span>
  <span class="n">expensive_tactic</span>
  <span class="n">save</span>
  <span class="c1">-- We can comfortably  make changes after the `save`</span>
  <span class="c1">-- and get quick feedback from the editor.</span>
  <span class="k">have</span> <span class="o">:</span> <span class="n">y</span> <span class="bp">=</span> <span class="n">x</span> <span class="o">:=</span> <span class="n">h₁.symm</span>
  <span class="k">have</span> <span class="o">:</span> <span class="n">z</span> <span class="bp">=</span> <span class="n">y</span> <span class="o">:=</span> <span class="n">h₂.symm</span>
  <span class="n">trace</span> <span class="s2">"hello world"</span>
  <span class="n">apply</span> <span class="n">this.trans</span>
  <span class="n">exact</span> <span class="o">‹</span><span class="n">y</span> <span class="bp">=</span> <span class="n">x</span><span class="o">›</span>
</code></pre></div>



<a name="279616452"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Abysmal%20performance%20when%20%20doing%20large%20inductions/near/279616452" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jad Ghalayini <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Abysmal.20performance.20when.20.20doing.20large.20inductions.html#279616452">(Apr 20 2022 at 23:28)</a>:</h4>
<p>Would it be possible to automatically detect that branches of an induction are independent , rather than depending on a certain order? For example, the expensive tactic which solves the 25 cases is in the last branch.</p>



<a name="279616480"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Abysmal%20performance%20when%20%20doing%20large%20inductions/near/279616480" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jad Ghalayini <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Abysmal.20performance.20when.20.20doing.20large.20inductions.html#279616480">(Apr 20 2022 at 23:28)</a>:</h4>
<p>Or are they not actually independent in the case of induction ... generalizing ... with | ...</p>



<a name="279617200"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Abysmal%20performance%20when%20%20doing%20large%20inductions/near/279617200" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jad Ghalayini <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Abysmal.20performance.20when.20.20doing.20large.20inductions.html#279617200">(Apr 20 2022 at 23:37)</a>:</h4>
<p>On a related note, why is <code>simp</code> on anything defined via a large <code>match</code> expression so slow?</p>



<a name="279617237"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Abysmal%20performance%20when%20%20doing%20large%20inductions/near/279617237" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jad Ghalayini <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Abysmal.20performance.20when.20.20doing.20large.20inductions.html#279617237">(Apr 20 2022 at 23:38)</a>:</h4>
<p>My proofs all become super slow whenever I do <code>simp only [big_match]</code> for an expression like <code>big_match (constructor_14 a) (constructor_3 b)</code></p>



<a name="279617293"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Abysmal%20performance%20when%20%20doing%20large%20inductions/near/279617293" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jad Ghalayini <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Abysmal.20performance.20when.20.20doing.20large.20inductions.html#279617293">(Apr 20 2022 at 23:38)</a>:</h4>
<p>Even though as far as I can tell it should be fast as it's just a simple rewrite; and similar rewrites using theorems are very fast</p>



<a name="279617328"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Abysmal%20performance%20when%20%20doing%20large%20inductions/near/279617328" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jad Ghalayini <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Abysmal.20performance.20when.20.20doing.20large.20inductions.html#279617328">(Apr 20 2022 at 23:38)</a>:</h4>
<p>Should I prove a theorem for each case of the match?</p>



<a name="279617363"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Abysmal%20performance%20when%20%20doing%20large%20inductions/near/279617363" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jad Ghalayini <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Abysmal.20performance.20when.20.20doing.20large.20inductions.html#279617363">(Apr 20 2022 at 23:39)</a>:</h4>
<p>Seems hard to automate, and harder to put into <code>simp</code> in the case of the automated cases</p>



<a name="279617369"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Abysmal%20performance%20when%20%20doing%20large%20inductions/near/279617369" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jad Ghalayini <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Abysmal.20performance.20when.20.20doing.20large.20inductions.html#279617369">(Apr 20 2022 at 23:39)</a>:</h4>
<p>Is there a better way to do such "obvious" reductions?</p>



<a name="279765563"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Abysmal%20performance%20when%20%20doing%20large%20inductions/near/279765563" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Leonardo de Moura <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Abysmal.20performance.20when.20.20doing.20large.20inductions.html#279765563">(Apr 22 2022 at 01:15)</a>:</h4>
<p><span class="user-mention silent" data-user-id="461231">Jad Ghalayini</span> <a href="#narrow/stream/270676-lean4/topic/Abysmal.20performance.20when.20.20doing.20large.20inductions/near/279617200">said</a>:</p>
<blockquote>
<p>On a related note, why is <code>simp</code> on anything defined via a large <code>match</code> expression so slow?</p>
</blockquote>
<p>It is hard to tell without seeing the actual example, but I suspect the problem is not <code>simp</code>, but the generation of equality theorems for the <code>match</code> expression. I have seen some massive proofs when the <code>match</code> expression has many overlapping patterns.<br>
Lean 4 generates these theorems on demand when they are first needed.</p>



<a name="279765682"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Abysmal%20performance%20when%20%20doing%20large%20inductions/near/279765682" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Leonardo de Moura <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Abysmal.20performance.20when.20.20doing.20large.20inductions.html#279765682">(Apr 22 2022 at 01:17)</a>:</h4>
<p><span class="user-mention silent" data-user-id="461231">Jad Ghalayini</span> <a href="#narrow/stream/270676-lean4/topic/Abysmal.20performance.20when.20.20doing.20large.20inductions/near/279617237">said</a>:</p>
<blockquote>
<p>My proofs all become super slow whenever I do <code>simp only [big_match]</code> for an expression like <code>big_match (constructor_14 a) (constructor_3 b)</code></p>
</blockquote>
<p>If you copy and paste the <code>theorem</code> as an <code>example</code> after the <code>theorem</code> is the <code>example</code> also slow?</p>



<a name="279765763"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Abysmal%20performance%20when%20%20doing%20large%20inductions/near/279765763" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Leonardo de Moura <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Abysmal.20performance.20when.20.20doing.20large.20inductions.html#279765763">(Apr 22 2022 at 01:18)</a>:</h4>
<p><span class="user-mention silent" data-user-id="461231">Jad Ghalayini</span> <a href="#narrow/stream/270676-lean4/topic/Abysmal.20performance.20when.20.20doing.20large.20inductions/near/279617328">said</a>:</p>
<blockquote>
<p>Should I prove a theorem for each case of the match?</p>
</blockquote>
<p>You should not need to. Have you tried the new <code>save</code> and <code>stop</code> tactics?</p>



<a name="279765887"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Abysmal%20performance%20when%20%20doing%20large%20inductions/near/279765887" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Leonardo de Moura <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Abysmal.20performance.20when.20.20doing.20large.20inductions.html#279765887">(Apr 22 2022 at 01:20)</a>:</h4>
<p><span class="user-mention silent" data-user-id="461231">Jad Ghalayini</span> <a href="#narrow/stream/270676-lean4/topic/Abysmal.20performance.20when.20.20doing.20large.20inductions/near/279617369">said</a>:</p>
<blockquote>
<p>Is there a better way to do such "obvious" reductions?</p>
</blockquote>
<p>If the reductions are definitional, then we can add an option that skips the match equality theorem generation and relies only on definitional reduction for <code>match</code> expressions.</p>



<a name="279765923"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Abysmal%20performance%20when%20%20doing%20large%20inductions/near/279765923" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Leonardo de Moura <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Abysmal.20performance.20when.20.20doing.20large.20inductions.html#279765923">(Apr 22 2022 at 01:21)</a>:</h4>
<p><span class="user-mention silent" data-user-id="461231">Jad Ghalayini</span> <a href="#narrow/stream/270676-lean4/topic/Abysmal.20performance.20when.20.20doing.20large.20inductions/near/279616452">said</a>:</p>
<blockquote>
<p>Would it be possible to automatically detect that branches of an induction are independent , rather than depending on a certain order? For example, the expensive tactic which solves the 25 cases is in the last branch.</p>
</blockquote>
<p>It is not clear to me what you are asking and/or proposing.</p>



<a name="279937461"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Abysmal%20performance%20when%20%20doing%20large%20inductions/near/279937461" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jad Ghalayini <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Abysmal.20performance.20when.20.20doing.20large.20inductions.html#279937461">(Apr 23 2022 at 17:46)</a>:</h4>
<p><span class="user-mention silent" data-user-id="112857">Leonardo de Moura</span> <a href="#narrow/stream/270676-lean4/topic/Abysmal.20performance.20when.20.20doing.20large.20inductions/near/279765682">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="461231">Jad Ghalayini</span> <a href="#narrow/stream/270676-lean4/topic/Abysmal.20performance.20when.20.20doing.20large.20inductions/near/279617237">said</a>:</p>
<blockquote>
<p>My proofs all become super slow whenever I do <code>simp only [big_match]</code> for an expression like <code>big_match (constructor_14 a) (constructor_3 b)</code></p>
</blockquote>
<p>If you copy and paste the <code>theorem</code> as an <code>example</code> after the <code>theorem</code> is the <code>example</code> also slow?</p>
</blockquote>
<p>No it's actually instant. I even made sure it wasn't parallelism by commenting it out, letting everything run, and then uncommenting it</p>



<a name="279937476"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Abysmal%20performance%20when%20%20doing%20large%20inductions/near/279937476" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jad Ghalayini <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Abysmal.20performance.20when.20.20doing.20large.20inductions.html#279937476">(Apr 23 2022 at 17:47)</a>:</h4>
<p><span class="user-mention silent" data-user-id="112857">Leonardo de Moura</span> <a href="#narrow/stream/270676-lean4/topic/Abysmal.20performance.20when.20.20doing.20large.20inductions/near/279765763">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="461231">Jad Ghalayini</span> <a href="#narrow/stream/270676-lean4/topic/Abysmal.20performance.20when.20.20doing.20large.20inductions/near/279617328">said</a>:</p>
<blockquote>
<p>Should I prove a theorem for each case of the match?</p>
</blockquote>
<p>You should not need to. Have you tried the new <code>save</code> and <code>stop</code> tactics?</p>
</blockquote>
<p>These don't seem to be working for me; editing below a <code>save</code> still causes the whole thing to start again for some reason and takes forever (even when there's nothing or very little under the <code>save</code>, and when replacing other tactics with <code>stop</code> does seem to speed things up)</p>



<a name="279937556"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Abysmal%20performance%20when%20%20doing%20large%20inductions/near/279937556" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jad Ghalayini <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Abysmal.20performance.20when.20.20doing.20large.20inductions.html#279937556">(Apr 23 2022 at 17:48)</a>:</h4>
<p><span class="user-mention silent" data-user-id="112857">Leonardo de Moura</span> <a href="#narrow/stream/270676-lean4/topic/Abysmal.20performance.20when.20.20doing.20large.20inductions/near/279765923">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="461231">Jad Ghalayini</span> <a href="#narrow/stream/270676-lean4/topic/Abysmal.20performance.20when.20.20doing.20large.20inductions/near/279616452">said</a>:</p>
<blockquote>
<p>Would it be possible to automatically detect that branches of an induction are independent , rather than depending on a certain order? For example, the expensive tactic which solves the 25 cases is in the last branch.</p>
</blockquote>
<p>It is not clear to me what you are asking and/or proposing.</p>
</blockquote>
<p>Well as far as I understand, say we do</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">induction</span> <span class="n">H</span> <span class="k">with</span>
<span class="bp">|</span> <span class="n">label1</span> <span class="bp">=&gt;</span> <span class="bp">...</span>
<span class="bp">|</span> <span class="n">label2</span> <span class="bp">=&gt;</span> <span class="bp">...</span>
<span class="bp">|</span> <span class="n">label3</span> <span class="bp">=&gt;</span> <span class="bp">...</span>
</code></pre></div>
<p>As far as I understand, those branches are totally independent, so why not save them individually as checkpoints so editing one branch does not affect the others?</p>



<a name="279937600"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Abysmal%20performance%20when%20%20doing%20large%20inductions/near/279937600" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jad Ghalayini <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Abysmal.20performance.20when.20.20doing.20large.20inductions.html#279937600">(Apr 23 2022 at 17:49)</a>:</h4>
<p><span class="user-mention silent" data-user-id="112857">Leonardo de Moura</span> <a href="#narrow/stream/270676-lean4/topic/Abysmal.20performance.20when.20.20doing.20large.20inductions/near/279765563">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="461231">Jad Ghalayini</span> <a href="#narrow/stream/270676-lean4/topic/Abysmal.20performance.20when.20.20doing.20large.20inductions/near/279617200">said</a>:</p>
<blockquote>
<p>On a related note, why is <code>simp</code> on anything defined via a large <code>match</code> expression so slow?</p>
</blockquote>
<p>It is hard to tell without seeing the actual example, but I suspect the problem is not <code>simp</code>, but the generation of equality theorems for the <code>match</code> expression. I have seen some massive proofs when the <code>match</code> expression has many overlapping patterns.<br>
Lean 4 generates these theorems on demand when they are first needed.</p>
</blockquote>
<p>This is weird because I have a lot of thoerems using <code>simp</code> to handle the same match statemement, and they're all <em>very very slow</em>. Like it's not just one slow one. But, as I said, copying the exact <em>same</em> theorem was indeed fast.</p>



<a name="279937610"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Abysmal%20performance%20when%20%20doing%20large%20inductions/near/279937610" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jad Ghalayini <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Abysmal.20performance.20when.20.20doing.20large.20inductions.html#279937610">(Apr 23 2022 at 17:49)</a>:</h4>
<p>Thanks so much for your help btw, I really appreciate the responsiveness!</p>



<a name="279938826"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Abysmal%20performance%20when%20%20doing%20large%20inductions/near/279938826" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jad Ghalayini <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Abysmal.20performance.20when.20.20doing.20large.20inductions.html#279938826">(Apr 23 2022 at 18:18)</a>:</h4>
<p>Also btw I've managed to get by a little using the <code>reduce</code> tactic before rewriting, but apparently that's for debugging purposes only. Much faster, though...</p>



<a name="279938835"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Abysmal%20performance%20when%20%20doing%20large%20inductions/near/279938835" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jad Ghalayini <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Abysmal.20performance.20when.20.20doing.20large.20inductions.html#279938835">(Apr 23 2022 at 18:18)</a>:</h4>
<p>Since I am basically using <code>simp</code> to do reduction; <em>is</em> there a better way to do this?</p>



<a name="279938942"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Abysmal%20performance%20when%20%20doing%20large%20inductions/near/279938942" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Henrik Böving <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Abysmal.20performance.20when.20.20doing.20large.20inductions.html#279938942">(Apr 23 2022 at 18:21)</a>:</h4>
<p>maybe <code>dsimp</code> ? It performs simp using definitional equality only</p>



<a name="279939261"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Abysmal%20performance%20when%20%20doing%20large%20inductions/near/279939261" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Leonardo de Moura <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Abysmal.20performance.20when.20.20doing.20large.20inductions.html#279939261">(Apr 23 2022 at 18:29)</a>:</h4>
<blockquote>
<p>These don't seem to be working for me; editing below a save still causes the whole thing to start again for some reason and takes forever (even when there's nothing or very little under the save)</p>
</blockquote>
<p>This is the expected behavior. There is no cache yet when you are typing <code>save</code>, and the whole tactic will be executed from the beginning. Our plan is to add in the future an option <code>set_option tactic.cache true</code> that will introduce <code>save</code> automatically for us for potentially expensive tactics such as <code>simp</code>. We also want to allow the user to register their own tactics as "expensive".</p>
<blockquote>
<p>As far as I understand, those branches are totally independent, so why not save them individually as checkpoints so editing one branch does not affect the others?</p>
</blockquote>
<p>It is not that simple. As you are typing in one of the branches, you are introducing syntax errors. The syntax errors temporarily disable branches. Try the following</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">inductive</span> <span class="n">Foo</span> <span class="n">where</span>
  <span class="bp">|</span> <span class="n">c1</span> <span class="bp">|</span> <span class="n">c2</span> <span class="bp">|</span> <span class="n">c3</span>

<span class="kd">example</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="n">Foo</span><span class="o">)</span> <span class="o">:</span> <span class="n">True</span> <span class="o">:=</span> <span class="kd">by</span>
  <span class="n">induction</span> <span class="n">x</span> <span class="k">with</span>
  <span class="bp">|</span> <span class="n">c1</span> <span class="bp">=&gt;</span> <span class="n">case</span> <span class="c1">-- You are tying here</span>
  <span class="bp">|</span> <span class="n">c2</span> <span class="bp">=&gt;</span> <span class="n">simp</span> <span class="c1">-- Note that `simp` is not highlighted because it was not even parsed, let alone elaborated</span>
<span class="c1">--^ parsing error here</span>
  <span class="bp">|</span> <span class="n">c3</span> <span class="bp">=&gt;</span> <span class="n">simp</span>
</code></pre></div>
<p><em>EDIT</em>: this is not the only obstacle, but it is the simplest to explain.</p>
<blockquote>
<p>This is weird because I have a lot of thoerems using simp to handle the same match statemement, and they're all very very slow. Like it's not just one slow one. But, as I said, copying the exact same theorem was indeed fast.</p>
</blockquote>
<p>We may have a bug in our cache, and may be recomputing things. A <a href="https://leanprover-community.github.io/mwe.html">#mwe</a> would help us a lot.</p>
<blockquote>
<p>Also btw I've managed to get by a little using the reduce tactic before rewriting, but apparently that's for debugging purposes only. Much faster, though...</p>
</blockquote>
<p>It makes sense. <code>reduce</code> performs only definitional reductions and will never try to generate equation theorems for a <code>match</code> expression.</p>



<a name="279939339"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Abysmal%20performance%20when%20%20doing%20large%20inductions/near/279939339" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Leonardo de Moura <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Abysmal.20performance.20when.20.20doing.20large.20inductions.html#279939339">(Apr 23 2022 at 18:31)</a>:</h4>
<p><span class="user-mention silent" data-user-id="461231">Jad Ghalayini</span> <a href="#narrow/stream/270676-lean4/topic/Abysmal.20performance.20when.20.20doing.20large.20inductions/near/279938835">said</a>:</p>
<blockquote>
<p>Since I am basically using <code>simp</code> to do reduction; <em>is</em> there a better way to do this?</p>
</blockquote>
<p><code>simp</code> is the way to go. We should work together to fix the performance problem and avoid unnecessary workarounds.</p>



<a name="279939637"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Abysmal%20performance%20when%20%20doing%20large%20inductions/near/279939637" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jad Ghalayini <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Abysmal.20performance.20when.20.20doing.20large.20inductions.html#279939637">(Apr 23 2022 at 18:39)</a>:</h4>
<p><span class="user-mention" data-user-id="112857">@Leonardo de Moura</span> sounds good! I can get started on an MWE probably tonight; that said, do you know when a definitional-match-only simp could be available, as it's getting to the point where it's stalling all my progress as theorems just become unworkable?</p>



<a name="279939782"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Abysmal%20performance%20when%20%20doing%20large%20inductions/near/279939782" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Leonardo de Moura <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Abysmal.20performance.20when.20.20doing.20large.20inductions.html#279939782">(Apr 23 2022 at 18:42)</a>:</h4>
<p>Yes, we have support for definitional and non-definitional <code>match</code> simplifications. <code>simp</code> by default tries both. I am hopeful we will be able to fix the performance issue. If it cannot be fixed, we can add a flag to <code>simp</code> to disable non-definitional match simplifications.</p>



<a name="279940308"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Abysmal%20performance%20when%20%20doing%20large%20inductions/near/279940308" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jad Ghalayini <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Abysmal.20performance.20when.20.20doing.20large.20inductions.html#279940308">(Apr 23 2022 at 18:57)</a>:</h4>
<p>Would it be possible to add the flag now as a stopgap so I can get on with my proofs haha?</p>



<a name="279940312"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Abysmal%20performance%20when%20%20doing%20large%20inductions/near/279940312" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jad Ghalayini <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Abysmal.20performance.20when.20.20doing.20large.20inductions.html#279940312">(Apr 23 2022 at 18:57)</a>:</h4>
<p>Or is there some kind of dsimp-like tactic I can use?</p>



<a name="279941149"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Abysmal%20performance%20when%20%20doing%20large%20inductions/near/279941149" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Leonardo de Moura <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Abysmal.20performance.20when.20.20doing.20large.20inductions.html#279941149">(Apr 23 2022 at 19:17)</a>:</h4>
<p>I will add a <code>dsimp</code>-like tactic.</p>



<a name="279981396"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Abysmal%20performance%20when%20%20doing%20large%20inductions/near/279981396" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Leonardo de Moura <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Abysmal.20performance.20when.20.20doing.20large.20inductions.html#279981396">(Apr 24 2022 at 13:26)</a>:</h4>
<p>We have <code>dsimp</code> and <code>dsimp!</code> tactics in the nightly build <a href="https://github.com/leanprover/lean4-nightly/releases/tag/nightly-2022-04-24">https://github.com/leanprover/lean4-nightly/releases/tag/nightly-2022-04-24</a></p>



<a name="280146686"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Abysmal%20performance%20when%20%20doing%20large%20inductions/near/280146686" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jad Ghalayini <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Abysmal.20performance.20when.20.20doing.20large.20inductions.html#280146686">(Apr 26 2022 at 00:12)</a>:</h4>
<p>Unfortunately, even using <code>dsimp</code>, it's still about the same speed</p>



<a name="280146711"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Abysmal%20performance%20when%20%20doing%20large%20inductions/near/280146711" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jad Ghalayini <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Abysmal.20performance.20when.20.20doing.20large.20inductions.html#280146711">(Apr 26 2022 at 00:12)</a>:</h4>
<p>The test program,</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">LeanExperiments.Dependencies</span>

<span class="kd">set_option</span> <span class="n">maxHeartbeats</span> <span class="mi">1000000</span>

<span class="kd">theorem</span> <span class="n">Term.stlc_wknth_true</span> <span class="o">{</span><span class="n">t</span><span class="o">:</span> <span class="n">Term</span><span class="o">}</span> <span class="o">{</span><span class="bp">Γ</span><span class="o">:</span> <span class="n">Sparsity</span><span class="o">}</span> <span class="o">{</span><span class="n">n</span><span class="o">:</span> <span class="n">Nat</span><span class="o">}</span>
<span class="o">:</span> <span class="o">(</span><span class="n">t.wknth</span> <span class="n">n</span><span class="o">)</span><span class="bp">.</span><span class="n">stlc</span> <span class="o">(</span><span class="bp">Γ.</span><span class="n">wknth</span> <span class="n">n</span> <span class="n">true</span><span class="o">)</span> <span class="bp">=</span> <span class="o">(</span><span class="n">t.stlc</span> <span class="bp">Γ</span><span class="o">)</span><span class="bp">.</span><span class="n">wknth</span> <span class="o">(</span><span class="bp">Γ.</span><span class="n">ix</span> <span class="n">n</span><span class="o">)</span>
<span class="o">:=</span> <span class="kd">by</span> <span class="o">{</span>
  <span class="n">revert</span> <span class="bp">Γ</span> <span class="n">n</span><span class="bp">;</span>
  <span class="n">induction</span> <span class="n">t</span> <span class="k">with</span>
  <span class="bp">|</span> <span class="n">var</span> <span class="n">v</span> <span class="bp">=&gt;</span>
    <span class="n">intro</span> <span class="bp">Γ</span> <span class="n">n</span><span class="bp">;</span>
    <span class="n">dsimp</span> <span class="n">only</span> <span class="o">[</span><span class="n">wknth</span><span class="o">,</span> <span class="n">wk</span><span class="o">]</span>
    <span class="n">repeat</span> <span class="n">rw</span> <span class="o">[</span><span class="n">stlc_var</span><span class="o">]</span>
    <span class="n">dsimp</span> <span class="n">only</span> <span class="o">[</span><span class="n">Sparsity.stlc</span><span class="o">]</span>
    <span class="n">split</span>
    <span class="bp">.</span> <span class="k">have</span> <span class="n">H</span><span class="o">:</span> <span class="bp">Γ.</span><span class="n">dep</span> <span class="n">v</span> <span class="bp">=</span> <span class="n">true</span> <span class="o">:=</span> <span class="kd">by</span>
        <span class="n">rw</span> <span class="o">[</span><span class="bp">&lt;-</span><span class="n">Sparsity.wknth_dep</span><span class="o">]</span>
        <span class="n">assumption</span>
      <span class="n">rw</span> <span class="o">[</span><span class="n">Sparsity.wknth_ix_true'</span> <span class="n">H</span><span class="o">]</span>
      <span class="n">rw</span> <span class="o">[</span><span class="n">if_pos</span> <span class="n">H</span><span class="o">]</span>
      <span class="n">dsimp</span> <span class="n">only</span> <span class="o">[</span><span class="n">Stlc.wknth</span><span class="o">,</span> <span class="n">Stlc.wk</span><span class="o">]</span>
      <span class="n">simp</span> <span class="n">only</span> <span class="o">[</span><span class="n">Wk.wknth_var</span><span class="o">]</span>
    <span class="bp">.</span> <span class="n">rw</span> <span class="o">[</span><span class="n">if_neg</span><span class="o">]</span>
      <span class="n">rfl</span>
      <span class="n">simp</span> <span class="n">only</span> <span class="o">[</span><span class="n">Sparsity.wknth_dep</span><span class="o">]</span> <span class="n">at</span> <span class="bp">*</span>
      <span class="n">assumption</span>
  <span class="bp">|</span> <span class="n">_</span> <span class="bp">=&gt;</span>
    <span class="n">intro</span> <span class="bp">Γ</span> <span class="n">n</span><span class="bp">;</span>
    <span class="n">dsimp</span> <span class="n">only</span> <span class="o">[</span><span class="n">wknth</span><span class="o">,</span> <span class="n">wk</span><span class="o">]</span>
    <span class="n">repeat</span> <span class="n">rw</span> <span class="o">[</span><span class="n">Wk.lift_wknth_merge</span><span class="o">]</span>
    <span class="n">repeat</span> <span class="n">rw</span> <span class="o">[</span><span class="n">Wk.liftn_wknth_merge</span><span class="o">]</span>
    <span class="n">repeat</span> <span class="n">rw</span> <span class="o">[</span><span class="bp">&lt;-</span><span class="n">wknth_def</span><span class="o">]</span>
    <span class="n">try</span> <span class="o">(</span><span class="n">rename</span> <span class="n">TermKind</span> <span class="n">_</span> <span class="bp">=&gt;</span> <span class="n">k</span><span class="bp">;</span> <span class="n">cases</span> <span class="n">k</span><span class="o">)</span><span class="bp">;</span>
    <span class="n">try</span> <span class="o">(</span><span class="n">rename</span> <span class="n">AnnotSort</span> <span class="bp">=&gt;</span> <span class="n">s</span><span class="bp">;</span> <span class="n">cases</span> <span class="n">s</span><span class="o">)</span><span class="bp">;</span>
    <span class="n">all_goals</span> <span class="n">try</span> <span class="n">rfl</span><span class="bp">;</span>
    <span class="n">all_goals</span> <span class="o">(</span>
      <span class="n">dsimp</span> <span class="n">only</span> <span class="o">[</span><span class="n">stlc</span><span class="o">]</span>
      <span class="n">simp</span> <span class="n">only</span> <span class="o">[</span><span class="n">Sparsity.wknth_merge</span><span class="o">]</span>
      <span class="n">simp</span> <span class="n">only</span> <span class="o">[</span><span class="bp">*</span><span class="o">]</span>
      <span class="n">repeat</span> <span class="n">rw</span> <span class="o">[</span><span class="n">Term.stlc_ty_wknth</span><span class="o">]</span>
      <span class="n">try</span> <span class="n">rfl</span>
    <span class="o">)</span>
<span class="o">}</span>
</code></pre></div>
<p>still takes 29 seconds to typecheck; and even simply just writing <code>dsimp [stlc]</code> takes a few seconds each time</p>



<a name="280146723"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Abysmal%20performance%20when%20%20doing%20large%20inductions/near/280146723" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jad Ghalayini <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Abysmal.20performance.20when.20.20doing.20large.20inductions.html#280146723">(Apr 26 2022 at 00:13)</a>:</h4>
<p>Now this match isn't that huge, only about 20 branches, so I'm confused</p>



<a name="280146737"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Abysmal%20performance%20when%20%20doing%20large%20inductions/near/280146737" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jad Ghalayini <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Abysmal.20performance.20when.20.20doing.20large.20inductions.html#280146737">(Apr 26 2022 at 00:13)</a>:</h4>
<p>I can probably work towards an MWE tomorrow, but any idea what gives?</p>



<a name="280146839"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Abysmal%20performance%20when%20%20doing%20large%20inductions/near/280146839" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jad Ghalayini <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Abysmal.20performance.20when.20.20doing.20large.20inductions.html#280146839">(Apr 26 2022 at 00:14)</a>:</h4>
<p>This does seem to be quite <code>simp</code>-specific since <code>rw</code> and <code>reduce</code> are both so fast I can't even tell I'm waiting for anything</p>



<a name="280146856"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Abysmal%20performance%20when%20%20doing%20large%20inductions/near/280146856" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Leonardo de Moura <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Abysmal.20performance.20when.20.20doing.20large.20inductions.html#280146856">(Apr 26 2022 at 00:15)</a>:</h4>
<p>The <code>split</code> tactic will (indirectly) generate the equality theorems for the <code>match</code>-expression.</p>



<a name="280146859"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Abysmal%20performance%20when%20%20doing%20large%20inductions/near/280146859" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jad Ghalayini <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Abysmal.20performance.20when.20.20doing.20large.20inductions.html#280146859">(Apr 26 2022 at 00:15)</a>:</h4>
<p>On the other hand intuition tells me this kind of simple unfolding should be faster than <code>reduce</code>, so why isn't it?</p>



<a name="280146878"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Abysmal%20performance%20when%20%20doing%20large%20inductions/near/280146878" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jad Ghalayini <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Abysmal.20performance.20when.20.20doing.20large.20inductions.html#280146878">(Apr 26 2022 at 00:15)</a>:</h4>
<p><span class="user-mention" data-user-id="112857">@Leonardo de Moura</span> ah but even my other programs without <code>split</code> are still slow</p>



<a name="280146886"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Abysmal%20performance%20when%20%20doing%20large%20inductions/near/280146886" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jad Ghalayini <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Abysmal.20performance.20when.20.20doing.20large.20inductions.html#280146886">(Apr 26 2022 at 00:15)</a>:</h4>
<p>Lemme give another example</p>



<a name="280146892"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Abysmal%20performance%20when%20%20doing%20large%20inductions/near/280146892" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Leonardo de Moura <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Abysmal.20performance.20when.20.20doing.20large.20inductions.html#280146892">(Apr 26 2022 at 00:15)</a>:</h4>
<p><span class="user-mention silent" data-user-id="461231">Jad Ghalayini</span> <a href="#narrow/stream/270676-lean4/topic/Abysmal.20performance.20when.20.20doing.20large.20inductions/near/280146859">said</a>:</p>
<blockquote>
<p>On the other hand intuition tells me this kind of simple unfolding should be faster than <code>reduce</code>, so why isn't it?</p>
</blockquote>
<p>We need a <a href="https://leanprover-community.github.io/mwe.html">#mwe</a> to be able to answer this question.</p>



<a name="280146907"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Abysmal%20performance%20when%20%20doing%20large%20inductions/near/280146907" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jad Ghalayini <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Abysmal.20performance.20when.20.20doing.20large.20inductions.html#280146907">(Apr 26 2022 at 00:15)</a>:</h4>
<p>Makes sense will get to it</p>



<a name="280146949"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Abysmal%20performance%20when%20%20doing%20large%20inductions/near/280146949" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Leonardo de Moura <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Abysmal.20performance.20when.20.20doing.20large.20inductions.html#280146949">(Apr 26 2022 at 00:16)</a>:</h4>
<p>Thanks.</p>



<a name="280146962"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Abysmal%20performance%20when%20%20doing%20large%20inductions/near/280146962" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jad Ghalayini <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Abysmal.20performance.20when.20.20doing.20large.20inductions.html#280146962">(Apr 26 2022 at 00:16)</a>:</h4>
<p>Np, sorry for putting it off, just had a hectic week, barely time to even work on the proofs themselves haha!</p>



<a name="280146969"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Abysmal%20performance%20when%20%20doing%20large%20inductions/near/280146969" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jad Ghalayini <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Abysmal.20performance.20when.20.20doing.20large.20inductions.html#280146969">(Apr 26 2022 at 00:16)</a>:</h4>
<p>Thanks for all the support, really appreciate it!</p>



<a name="280148190"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Abysmal%20performance%20when%20%20doing%20large%20inductions/near/280148190" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jad Ghalayini <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Abysmal.20performance.20when.20.20doing.20large.20inductions.html#280148190">(Apr 26 2022 at 00:37)</a>:</h4>
<p>Actually decided to stop procrastinating and made an MWE</p>



<a name="280148241"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Abysmal%20performance%20when%20%20doing%20large%20inductions/near/280148241" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jad Ghalayini <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Abysmal.20performance.20when.20.20doing.20large.20inductions.html#280148241">(Apr 26 2022 at 00:38)</a>:</h4>
<p><span class="user-mention" data-user-id="112857">@Leonardo de Moura</span>  the program</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">inductive</span> <span class="n">Level1</span><span class="o">:</span> <span class="kt">Type</span>
<span class="bp">|</span> <span class="n">one</span>
<span class="bp">|</span> <span class="n">two</span>
<span class="bp">|</span> <span class="n">three</span>
<span class="bp">|</span> <span class="n">four</span>
<span class="bp">|</span> <span class="n">five</span>
<span class="bp">|</span> <span class="n">six</span>
<span class="bp">|</span> <span class="n">seven</span>
<span class="bp">|</span> <span class="n">eight</span>
<span class="bp">|</span> <span class="n">nine</span>
<span class="bp">|</span> <span class="n">ten</span>

<span class="kd">inductive</span> <span class="n">Level2</span><span class="o">:</span> <span class="kt">Type</span>
<span class="bp">|</span> <span class="n">emp</span>
<span class="bp">|</span> <span class="n">yi</span> <span class="o">(</span><span class="n">l</span><span class="o">:</span> <span class="n">Level1</span><span class="o">)</span> <span class="o">(</span><span class="n">e</span><span class="o">:</span> <span class="n">Level2</span><span class="o">)</span>
<span class="bp">|</span> <span class="n">er</span> <span class="o">(</span><span class="n">l</span><span class="o">:</span> <span class="n">Level1</span><span class="o">)</span> <span class="o">(</span><span class="n">e</span><span class="o">:</span> <span class="n">Level2</span><span class="o">)</span>
<span class="bp">|</span> <span class="n">san</span> <span class="o">(</span><span class="n">l</span><span class="o">:</span> <span class="n">Level1</span><span class="o">)</span> <span class="o">(</span><span class="n">e</span><span class="o">:</span> <span class="n">Level2</span><span class="o">)</span>
<span class="bp">|</span> <span class="n">si</span> <span class="o">(</span><span class="n">l</span><span class="o">:</span> <span class="n">Level1</span><span class="o">)</span> <span class="o">(</span><span class="n">e</span><span class="o">:</span> <span class="n">Level2</span><span class="o">)</span>
<span class="bp">|</span> <span class="n">wu</span> <span class="o">(</span><span class="n">l</span><span class="o">:</span> <span class="n">Level1</span><span class="o">)</span> <span class="o">(</span><span class="n">e</span><span class="o">:</span> <span class="n">Level2</span><span class="o">)</span>
<span class="bp">|</span> <span class="n">liu</span> <span class="o">(</span><span class="n">l</span><span class="o">:</span> <span class="n">Level1</span><span class="o">)</span> <span class="o">(</span><span class="n">e</span><span class="o">:</span> <span class="n">Level2</span><span class="o">)</span>
<span class="bp">|</span> <span class="n">qi</span> <span class="o">(</span><span class="n">l</span><span class="o">:</span> <span class="n">Level1</span><span class="o">)</span> <span class="o">(</span><span class="n">e</span><span class="o">:</span> <span class="n">Level2</span><span class="o">)</span>
<span class="bp">|</span> <span class="n">ba</span> <span class="o">(</span><span class="n">l</span><span class="o">:</span> <span class="n">Level1</span><span class="o">)</span> <span class="o">(</span><span class="n">e</span><span class="o">:</span> <span class="n">Level2</span><span class="o">)</span>
<span class="bp">|</span> <span class="n">jiu</span> <span class="o">(</span><span class="n">l</span><span class="o">:</span> <span class="n">Level1</span><span class="o">)</span> <span class="o">(</span><span class="n">e</span><span class="o">:</span> <span class="n">Level2</span><span class="o">)</span>
<span class="bp">|</span> <span class="n">shi</span> <span class="o">(</span><span class="n">l</span><span class="o">:</span> <span class="n">Level1</span><span class="o">)</span> <span class="o">(</span><span class="n">e</span><span class="o">:</span> <span class="n">Level2</span><span class="o">)</span>

<span class="kn">open</span> <span class="n">Level1</span>
<span class="kn">open</span> <span class="n">Level2</span>

<span class="kd">def</span> <span class="n">Level1.make_sentence</span><span class="o">:</span> <span class="n">List</span> <span class="n">Level1</span> <span class="bp">-&gt;</span> <span class="n">Level2</span>
<span class="bp">|</span> <span class="o">[]</span> <span class="bp">=&gt;</span> <span class="n">emp</span>
<span class="bp">|</span> <span class="n">one</span><span class="o">::</span><span class="n">xs</span> <span class="bp">=&gt;</span> <span class="n">yi</span> <span class="n">one</span> <span class="o">(</span><span class="n">make_sentence</span> <span class="n">xs</span><span class="o">)</span>
<span class="bp">|</span> <span class="n">two</span><span class="o">::</span><span class="n">xs</span> <span class="bp">=&gt;</span> <span class="n">er</span> <span class="n">two</span> <span class="o">(</span><span class="n">make_sentence</span> <span class="n">xs</span><span class="o">)</span>
<span class="bp">|</span> <span class="n">three</span><span class="o">::</span><span class="n">xs</span> <span class="bp">=&gt;</span> <span class="n">san</span> <span class="n">three</span> <span class="o">(</span><span class="n">make_sentence</span> <span class="n">xs</span><span class="o">)</span>
<span class="bp">|</span> <span class="n">four</span><span class="o">::</span><span class="n">xs</span> <span class="bp">=&gt;</span> <span class="n">si</span> <span class="n">four</span> <span class="o">(</span><span class="n">make_sentence</span> <span class="n">xs</span><span class="o">)</span>
<span class="bp">|</span> <span class="n">five</span><span class="o">::</span><span class="n">xs</span> <span class="bp">=&gt;</span> <span class="n">wu</span> <span class="n">five</span> <span class="o">(</span><span class="n">make_sentence</span> <span class="n">xs</span><span class="o">)</span>
<span class="bp">|</span> <span class="n">six</span><span class="o">::</span><span class="n">xs</span> <span class="bp">=&gt;</span> <span class="n">liu</span> <span class="n">six</span> <span class="o">(</span><span class="n">make_sentence</span> <span class="n">xs</span><span class="o">)</span>
<span class="bp">|</span> <span class="n">seven</span><span class="o">::</span><span class="n">xs</span> <span class="bp">=&gt;</span> <span class="n">qi</span> <span class="n">seven</span> <span class="o">(</span><span class="n">make_sentence</span> <span class="n">xs</span><span class="o">)</span>
<span class="bp">|</span> <span class="n">eight</span><span class="o">::</span><span class="n">xs</span> <span class="bp">=&gt;</span> <span class="n">ba</span> <span class="n">eight</span> <span class="o">(</span><span class="n">make_sentence</span> <span class="n">xs</span><span class="o">)</span>
<span class="bp">|</span> <span class="n">nine</span><span class="o">::</span><span class="n">xs</span> <span class="bp">=&gt;</span> <span class="n">jiu</span> <span class="n">nine</span> <span class="o">(</span><span class="n">make_sentence</span> <span class="n">xs</span><span class="o">)</span>
<span class="bp">|</span> <span class="n">ten</span><span class="o">::</span><span class="n">xs</span> <span class="bp">=&gt;</span> <span class="n">shi</span> <span class="n">ten</span> <span class="o">(</span><span class="n">make_sentence</span> <span class="n">xs</span><span class="o">)</span>

<span class="kd">def</span> <span class="n">Level2.is_translation</span><span class="o">:</span> <span class="n">Level2</span> <span class="bp">-&gt;</span> <span class="n">Bool</span>
<span class="bp">|</span> <span class="n">yi</span> <span class="n">one</span> <span class="n">e</span> <span class="bp">=&gt;</span> <span class="n">e.is_translation</span>
<span class="bp">|</span> <span class="n">er</span> <span class="n">two</span> <span class="n">e</span> <span class="bp">=&gt;</span> <span class="n">e.is_translation</span>
<span class="bp">|</span> <span class="n">san</span> <span class="n">three</span> <span class="n">e</span> <span class="bp">=&gt;</span> <span class="n">e.is_translation</span>
<span class="bp">|</span> <span class="n">si</span> <span class="n">four</span> <span class="n">e</span> <span class="bp">=&gt;</span> <span class="n">e.is_translation</span>
<span class="bp">|</span> <span class="n">wu</span> <span class="n">five</span> <span class="n">e</span> <span class="bp">=&gt;</span> <span class="n">e.is_translation</span>
<span class="bp">|</span> <span class="n">liu</span> <span class="n">six</span> <span class="n">e</span> <span class="bp">=&gt;</span> <span class="n">e.is_translation</span>
<span class="bp">|</span> <span class="n">qi</span> <span class="n">seven</span> <span class="n">e</span> <span class="bp">=&gt;</span> <span class="n">e.is_translation</span>
<span class="bp">|</span> <span class="n">ba</span> <span class="n">eight</span> <span class="n">e</span> <span class="bp">=&gt;</span> <span class="n">e.is_translation</span>
<span class="bp">|</span> <span class="n">jiu</span> <span class="n">nine</span> <span class="n">e</span> <span class="bp">=&gt;</span> <span class="n">e.is_translation</span>
<span class="bp">|</span> <span class="n">shi</span> <span class="n">ten</span> <span class="n">e</span> <span class="bp">=&gt;</span> <span class="n">e.is_translation</span>
<span class="bp">|</span> <span class="n">emp</span> <span class="bp">=&gt;</span> <span class="n">true</span>
<span class="bp">|</span> <span class="n">_</span> <span class="bp">=&gt;</span> <span class="n">false</span>


<span class="kd">def</span> <span class="n">Level1.sentence_is_translation'</span> <span class="o">{</span><span class="n">l</span><span class="o">:</span> <span class="n">List</span> <span class="n">Level1</span><span class="o">}:</span>
  <span class="o">(</span><span class="n">make_sentence</span> <span class="n">l</span><span class="o">)</span><span class="bp">.</span><span class="n">is_translation</span> <span class="bp">=</span> <span class="n">true</span>
<span class="o">:=</span> <span class="kd">by</span> <span class="o">{</span>
  <span class="n">induction</span> <span class="n">l</span> <span class="k">with</span>
  <span class="bp">|</span> <span class="n">nil</span> <span class="bp">=&gt;</span> <span class="n">rfl</span>
  <span class="bp">|</span> <span class="n">cons</span> <span class="n">l</span> <span class="n">xs</span> <span class="n">I</span> <span class="bp">=&gt;</span>
    <span class="n">cases</span> <span class="n">l</span> <span class="bp">&lt;;&gt;</span>
    <span class="n">conv</span> <span class="bp">=&gt;</span>
      <span class="n">lhs</span>
      <span class="n">reduce</span>
      <span class="n">rw</span> <span class="o">[</span><span class="n">I</span><span class="o">]</span>
<span class="o">}</span>

<span class="kd">def</span> <span class="n">Level1.sentence_is_translation</span> <span class="o">{</span><span class="n">l</span><span class="o">:</span> <span class="n">List</span> <span class="n">Level1</span><span class="o">}:</span>
  <span class="o">(</span><span class="n">make_sentence</span> <span class="n">l</span><span class="o">)</span><span class="bp">.</span><span class="n">is_translation</span> <span class="bp">=</span> <span class="n">true</span>
<span class="o">:=</span> <span class="kd">by</span> <span class="o">{</span>
  <span class="n">induction</span> <span class="n">l</span> <span class="k">with</span>
  <span class="bp">|</span> <span class="n">nil</span> <span class="bp">=&gt;</span> <span class="n">rfl</span>
  <span class="bp">|</span> <span class="n">cons</span> <span class="n">l</span> <span class="n">xs</span> <span class="n">I</span> <span class="bp">=&gt;</span>
    <span class="n">cases</span> <span class="n">l</span> <span class="bp">&lt;;&gt;</span>
    <span class="n">dsimp</span> <span class="n">only</span> <span class="o">[</span><span class="n">make_sentence</span><span class="o">,</span> <span class="n">is_translation</span><span class="o">]</span> <span class="bp">&lt;;&gt;</span>
    <span class="n">exact</span> <span class="n">I</span>
<span class="o">}</span>
</code></pre></div>



<a name="280148257"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Abysmal%20performance%20when%20%20doing%20large%20inductions/near/280148257" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jad Ghalayini <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Abysmal.20performance.20when.20.20doing.20large.20inductions.html#280148257">(Apr 26 2022 at 00:38)</a>:</h4>
<p>Could probably be made slightly smaller but illustrates the point</p>



<a name="280148268"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Abysmal%20performance%20when%20%20doing%20large%20inductions/near/280148268" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jad Ghalayini <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Abysmal.20performance.20when.20.20doing.20large.20inductions.html#280148268">(Apr 26 2022 at 00:38)</a>:</h4>
<p>sentence_is_translation' typechecks instantaneously</p>



<a name="280148279"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Abysmal%20performance%20when%20%20doing%20large%20inductions/near/280148279" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jad Ghalayini <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Abysmal.20performance.20when.20.20doing.20large.20inductions.html#280148279">(Apr 26 2022 at 00:38)</a>:</h4>
<p>sentence_is_translation takes a couple of seconds</p>



<a name="280148684"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Abysmal%20performance%20when%20%20doing%20large%20inductions/near/280148684" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Leonardo de Moura <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Abysmal.20performance.20when.20.20doing.20large.20inductions.html#280148684">(Apr 26 2022 at 00:45)</a>:</h4>
<p>Thanks for creating the <a href="https://leanprover-community.github.io/mwe.html">#mwe</a>. I will work on it.</p>



<a name="280150349"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Abysmal%20performance%20when%20%20doing%20large%20inductions/near/280150349" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Leonardo de Moura <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Abysmal.20performance.20when.20.20doing.20large.20inductions.html#280150349">(Apr 26 2022 at 01:14)</a>:</h4>
<p>Pushed the following fix: <a href="https://github.com/leanprover/lean4/commit/3cf642688bcf12356292590822a8a372fbe04630">https://github.com/leanprover/lean4/commit/3cf642688bcf12356292590822a8a372fbe04630</a><br>
<code>Level1.sentence_is_translation</code> should be very fast now. <br>
The bottle neck is the equation theorem generation as we suspected. I will try to improve it tomorrow.</p>



<a name="280233743"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Abysmal%20performance%20when%20%20doing%20large%20inductions/near/280233743" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jad Ghalayini <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Abysmal.20performance.20when.20.20doing.20large.20inductions.html#280233743">(Apr 26 2022 at 16:18)</a>:</h4>
<p><span class="user-mention" data-user-id="112857">@Leonardo de Moura</span> works great now, thanks!</p>



<a name="280233774"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Abysmal%20performance%20when%20%20doing%20large%20inductions/near/280233774" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jad Ghalayini <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Abysmal.20performance.20when.20.20doing.20large.20inductions.html#280233774">(Apr 26 2022 at 16:18)</a>:</h4>
<p>Any chance we could get <code>dsimp</code> support in <code>conv</code> though?</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>