---
layout: archive
title: Zulip Chat Archive
permalink: /stream/270676-lean4/topic/Self-contained.20native.20toolchain.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/index.html">lean4</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Self-contained.20native.20toolchain.html">Self-contained native toolchain</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="261641481"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Self-contained%20native%20toolchain/near/261641481" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Self-contained.20native.20toolchain.html#261641481">(Nov 16 2021 at 13:41)</a>:</h4>
<p>There's now a "release candidate" for a self-contained LLVM toolchain bundled with Lean at <a href="https://github.com/Kha/lean4/releases/tag/v4.0.0-bundle-rc">https://github.com/Kha/lean4/releases/tag/v4.0.0-bundle-rc</a> (PR: <a href="https://github.com/leanprover/lean4/pull/795">https://github.com/leanprover/lean4/pull/795</a>). What this means is that this Lean release should contain everything necessary to compile Lean into native shared libraries or executables. In particular, it is an important step towards automatically compiling e.g. mathlib tactics into native code during building and editing without the user having to set up a compiler, linker, headers, ... first.</p>
<p>I would be grateful if people could try and test-drive the release on various machines. You could for example try to build the Lake binary with it:</p>
<div class="codehilite" data-code-language="Bash"><pre><span></span><code>elan self update  <span class="c1"># needs at least 1.3.0</span>
git clone https://github.com/leanprover/lake.git
<span class="nb">cd</span> lake
lake +Kha/lean4:v4.0.0-bundle-rc build
./build/bin/lake
</code></pre></div>
<p>While you should not need to install any further dependencies (and ideally have as few development dependencies already installed as possible), these are the system dependencies I am aware of:</p>
<ul>
<li>Linux: glibc &gt;= 2.27 (e.g. Ubuntu &gt;= 18.04), should be the same as current Lean 4</li>
<li>Windows: &gt;= 10</li>
<li>macOS: &gt;= 10.15 I think... so should be fine. M1 with Rosetta seems to just work as well.</li>
<li>NixOS: <a href="https://nixpk.gs/pr-tracker.html?pr=146162">https://nixpk.gs/pr-tracker.html?pr=146162</a></li>
</ul>



<a name="261642422"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Self-contained%20native%20toolchain/near/261642422" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yakov Pechersky <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Self-contained.20native.20toolchain.html#261642422">(Nov 16 2021 at 13:48)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">elan</span> <span class="n">self</span> <span class="n">update</span>
<span class="n">info</span><span class="o">:</span> <span class="n">checking</span> <span class="n">for</span> <span class="n">self</span><span class="bp">-</span><span class="n">updates</span>
<span class="n">info</span><span class="o">:</span> <span class="n">downloading</span> <span class="n">self</span><span class="bp">-</span><span class="n">update</span>
<span class="n">Error</span><span class="o">(</span><span class="n">Download</span><span class="o">(</span><span class="n">HttpStatus</span><span class="o">(</span><span class="mi">404</span><span class="o">)),</span> <span class="n">State</span> <span class="o">{</span> <span class="n">next_error</span><span class="o">:</span> <span class="n">None</span><span class="o">,</span> <span class="n">backtrace</span><span class="o">:</span> <span class="n">InternalBacktrace</span> <span class="o">{</span> <span class="n">backtrace</span><span class="o">:</span> <span class="n">None</span> <span class="o">}</span> <span class="o">})</span>
<span class="n">error</span><span class="o">:</span> <span class="n">could</span> <span class="n">not</span> <span class="n">download</span> <span class="n">file</span> <span class="k">from</span> <span class="bp">'</span><span class="n">https</span><span class="o">:</span><span class="bp">//</span><span class="n">github.com</span><span class="bp">/</span><span class="n">Kha</span><span class="bp">/</span><span class="n">elan</span><span class="bp">/</span><span class="n">releases</span><span class="bp">/</span><span class="n">download</span><span class="bp">/</span><span class="n">v1.3.1</span><span class="bp">/</span><span class="n">elan</span><span class="bp">-</span><span class="n">x86_64</span><span class="bp">-</span><span class="n">unknown</span><span class="bp">-</span><span class="n">linux</span><span class="bp">-</span><span class="n">musl.tar.gz'</span> <span class="n">to</span> <span class="bp">'/</span><span class="n">tmp</span><span class="bp">/</span><span class="n">elan</span><span class="bp">-</span><span class="n">update.dNmYPBGPZL8a</span><span class="bp">/</span><span class="n">elan</span><span class="bp">-</span><span class="n">x86_64</span><span class="bp">-</span><span class="n">unknown</span><span class="bp">-</span><span class="n">linux</span><span class="bp">-</span><span class="n">musl.tar.gz'</span>
<span class="n">info</span><span class="o">:</span> <span class="n">caused</span> <span class="kd">by</span><span class="o">:</span> <span class="n">http</span> <span class="n">request</span> <span class="n">returned</span> <span class="n">an</span> <span class="n">unsuccessful</span> <span class="n">status</span> <span class="n">code</span><span class="o">:</span> <span class="mi">404</span>
</code></pre></div>
<p>On WSL Windows 10</p>



<a name="261643983"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Self-contained%20native%20toolchain/near/261643983" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Self-contained.20native.20toolchain.html#261643983">(Nov 16 2021 at 13:58)</a>:</h4>
<p>Looks like it works for me:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">git</span> <span class="n">clone</span> <span class="n">https</span><span class="o">:</span><span class="bp">//</span><span class="n">github.com</span><span class="bp">/</span><span class="n">leanprover</span><span class="bp">/</span><span class="n">lake.git</span>
<span class="n">cd</span> <span class="n">lake</span>
<span class="n">lake</span> <span class="bp">+</span><span class="n">Kha</span><span class="bp">/</span><span class="n">lean4</span><span class="o">:</span><span class="n">v4.0.0</span><span class="bp">-</span><span class="n">bundle</span><span class="bp">-</span><span class="n">rc</span> <span class="n">build</span>
<span class="bp">./</span><span class="n">build</span><span class="bp">/</span><span class="n">bin</span><span class="bp">/</span><span class="n">lake</span>
<span class="n">info</span><span class="o">:</span> <span class="n">checking</span> <span class="n">for</span> <span class="n">self</span><span class="bp">-</span><span class="n">updates</span>
<span class="n">Cloning</span> <span class="n">into</span> <span class="bp">'</span><span class="n">lake'...</span>
<span class="n">remote</span><span class="o">:</span> <span class="n">Enumerating</span> <span class="n">objects</span><span class="o">:</span> <span class="mi">2179</span><span class="o">,</span> <span class="n">done.</span>
<span class="n">remote</span><span class="o">:</span> <span class="n">Counting</span> <span class="n">objects</span><span class="o">:</span> <span class="mi">100</span><span class="bp">%</span> <span class="o">(</span><span class="mi">2179</span><span class="bp">/</span><span class="mi">2179</span><span class="o">),</span> <span class="n">done.</span>
<span class="n">remote</span><span class="o">:</span> <span class="n">Compressing</span> <span class="n">objects</span><span class="o">:</span> <span class="mi">100</span><span class="bp">%</span> <span class="o">(</span><span class="mi">1346</span><span class="bp">/</span><span class="mi">1346</span><span class="o">),</span> <span class="n">done.</span>
<span class="n">remote</span><span class="o">:</span> <span class="n">Total</span> <span class="mi">2179</span> <span class="o">(</span><span class="n">delta</span> <span class="mi">1496</span><span class="o">),</span> <span class="n">reused</span> <span class="mi">1423</span> <span class="o">(</span><span class="n">delta</span> <span class="mi">746</span><span class="o">),</span> <span class="n">pack</span><span class="bp">-</span><span class="n">reused</span> <span class="mi">0</span>
<span class="n">Receiving</span> <span class="n">objects</span><span class="o">:</span> <span class="mi">100</span><span class="bp">%</span> <span class="o">(</span><span class="mi">2179</span><span class="bp">/</span><span class="mi">2179</span><span class="o">),</span> <span class="mi">340</span><span class="bp">.</span><span class="mi">66</span> <span class="n">KiB</span> <span class="bp">|</span> <span class="mi">2</span><span class="bp">.</span><span class="mi">52</span> <span class="n">MiB</span><span class="bp">/</span><span class="n">s</span><span class="o">,</span> <span class="n">done.</span>
<span class="n">Resolving</span> <span class="n">deltas</span><span class="o">:</span> <span class="mi">100</span><span class="bp">%</span> <span class="o">(</span><span class="mi">1496</span><span class="bp">/</span><span class="mi">1496</span><span class="o">),</span> <span class="n">done.</span>
<span class="n">info</span><span class="o">:</span> <span class="n">downloading</span> <span class="n">component</span> <span class="bp">'</span><span class="n">lean'</span>
<span class="mi">106</span><span class="bp">.</span><span class="mi">3</span> <span class="n">MiB</span> <span class="bp">/</span> <span class="mi">106</span><span class="bp">.</span><span class="mi">3</span> <span class="n">MiB</span> <span class="o">(</span><span class="mi">100</span> <span class="bp">%</span><span class="o">)</span>   <span class="mi">3</span><span class="bp">.</span><span class="mi">2</span> <span class="n">MiB</span><span class="bp">/</span><span class="n">s</span> <span class="n">ETA</span><span class="o">:</span>   <span class="mi">0</span> <span class="n">s</span>
<span class="n">info</span><span class="o">:</span> <span class="n">installing</span> <span class="n">component</span> <span class="bp">'</span><span class="n">lean'</span>
<span class="bp">&gt;</span> <span class="n">LEAN_PATH</span><span class="bp">=./</span><span class="n">build</span><span class="bp">/</span><span class="n">lib</span> <span class="bp">/</span><span class="n">home</span><span class="bp">/</span><span class="n">alex</span><span class="bp">/.</span><span class="n">elan</span><span class="bp">/</span><span class="n">toolchains</span><span class="bp">/</span><span class="n">Kha</span><span class="c1">--lean4---v4.0.0-bundle-rc/bin/lean -R ./. -o ./build/lib/Lake/LeanVersion.olean -c ./build/ir/Lake/LeanVersion.c ././Lake/LeanVersion.lean</span>
<span class="bp">&gt;</span> <span class="n">LEAN_PATH</span><span class="bp">=./</span><span class="n">build</span><span class="bp">/</span><span class="n">lib</span> <span class="bp">/</span><span class="n">home</span><span class="bp">/</span><span class="n">alex</span><span class="bp">/.</span><span class="n">elan</span><span class="bp">/</span><span class="n">toolchains</span><span class="bp">/</span><span class="n">Kha</span><span class="c1">--lean4---v4.0.0-bundle-rc/bin/lean -R ./. -o ./build/lib/Lake/Build/Trace.olean -c ./build/ir/Lake/Build/Trace.c ././Lake/Build/Trace.lean</span>
<span class="bp">&gt;</span> <span class="n">LEAN_PATH</span><span class="bp">=./</span><span class="n">build</span><span class="bp">/</span><span class="n">lib</span> <span class="bp">/</span><span class="n">home</span><span class="bp">/</span><span class="n">alex</span><span class="bp">/.</span><span class="n">elan</span><span class="bp">/</span><span class="n">toolchains</span><span class="bp">/</span><span class="n">Kha</span><span class="c1">--lean4---v4.0.0-bundle-rc/bin/lean -R ./. -o ./build/lib/Lake/Util/Async.olean -c ./build/ir/Lake/Util/Async.c ././Lake/Util/Async.lean</span>
<span class="bp">&gt;</span> <span class="n">LEAN_PATH</span><span class="bp">=./</span><span class="n">build</span><span class="bp">/</span><span class="n">lib</span> <span class="bp">/</span><span class="n">home</span><span class="bp">/</span><span class="n">alex</span><span class="bp">/.</span><span class="n">elan</span><span class="bp">/</span><span class="n">toolchains</span><span class="bp">/</span><span class="n">Kha</span><span class="c1">--lean4---v4.0.0-bundle-rc/bin/lean -R ./. -o ./build/lib/Lake/Util/LogT.olean -c ./build/ir/Lake/Util/LogT.c ././Lake/Util/LogT.lean</span>
<span class="bp">&gt;</span> <span class="n">LEAN_PATH</span><span class="bp">=./</span><span class="n">build</span><span class="bp">/</span><span class="n">lib</span> <span class="bp">/</span><span class="n">home</span><span class="bp">/</span><span class="n">alex</span><span class="bp">/.</span><span class="n">elan</span><span class="bp">/</span><span class="n">toolchains</span><span class="bp">/</span><span class="n">Kha</span><span class="c1">--lean4---v4.0.0-bundle-rc/bin/lean -R ./. -o ./build/lib/Lake/Config/InstallPath.olean -c ./build/ir/Lake/Config/InstallPath.c ././Lake/Config/InstallPath.lean</span>
<span class="bp">&gt;</span> <span class="n">LEAN_PATH</span><span class="bp">=./</span><span class="n">build</span><span class="bp">/</span><span class="n">lib</span> <span class="bp">/</span><span class="n">home</span><span class="bp">/</span><span class="n">alex</span><span class="bp">/.</span><span class="n">elan</span><span class="bp">/</span><span class="n">toolchains</span><span class="bp">/</span><span class="n">Kha</span><span class="c1">--lean4---v4.0.0-bundle-rc/bin/lean -R ./. -o ./build/lib/Lake/Config/OpaquePackage.olean -c ./build/ir/Lake/Config/OpaquePackage.c ././Lake/Config/OpaquePackage.lean</span>
<span class="bp">&gt;</span> <span class="n">LEAN_PATH</span><span class="bp">=./</span><span class="n">build</span><span class="bp">/</span><span class="n">lib</span> <span class="bp">/</span><span class="n">home</span><span class="bp">/</span><span class="n">alex</span><span class="bp">/.</span><span class="n">elan</span><span class="bp">/</span><span class="n">toolchains</span><span class="bp">/</span><span class="n">Kha</span><span class="c1">--lean4---v4.0.0-bundle-rc/bin/lean -R ./. -o ./build/lib/Lake/Config/Workspace.olean -c ./build/ir/Lake/Config/Workspace.c ././Lake/Config/Workspace.lean</span>
<span class="bp">&gt;</span> <span class="n">LEAN_PATH</span><span class="bp">=./</span><span class="n">build</span><span class="bp">/</span><span class="n">lib</span> <span class="bp">/</span><span class="n">home</span><span class="bp">/</span><span class="n">alex</span><span class="bp">/.</span><span class="n">elan</span><span class="bp">/</span><span class="n">toolchains</span><span class="bp">/</span><span class="n">Kha</span><span class="c1">--lean4---v4.0.0-bundle-rc/bin/lean -R ./. -o ./build/lib/Lake/Config/Glob.olean -c ./build/ir/Lake/Config/Glob.c ././Lake/Config/Glob.lean</span>
<span class="bp">&gt;</span> <span class="n">LEAN_PATH</span><span class="bp">=./</span><span class="n">build</span><span class="bp">/</span><span class="n">lib</span> <span class="bp">/</span><span class="n">home</span><span class="bp">/</span><span class="n">alex</span><span class="bp">/.</span><span class="n">elan</span><span class="bp">/</span><span class="n">toolchains</span><span class="bp">/</span><span class="n">Kha</span><span class="c1">--lean4---v4.0.0-bundle-rc/bin/lean -R ./. -o ./build/lib/Lake/Config/Script.olean -c ./build/ir/Lake/Config/Script.c ././Lake/Config/Script.lean</span>
<span class="bp">&gt;</span> <span class="n">LEAN_PATH</span><span class="bp">=./</span><span class="n">build</span><span class="bp">/</span><span class="n">lib</span> <span class="bp">/</span><span class="n">home</span><span class="bp">/</span><span class="n">alex</span><span class="bp">/.</span><span class="n">elan</span><span class="bp">/</span><span class="n">toolchains</span><span class="bp">/</span><span class="n">Kha</span><span class="c1">--lean4---v4.0.0-bundle-rc/bin/lean -R ./. -o ./build/lib/Lake/Build/Recursive.olean -c ./build/ir/Lake/Build/Recursive.c ././Lake/Build/Recursive.lean</span>
<span class="bp">&gt;</span> <span class="n">LEAN_PATH</span><span class="bp">=./</span><span class="n">build</span><span class="bp">/</span><span class="n">lib</span> <span class="bp">/</span><span class="n">home</span><span class="bp">/</span><span class="n">alex</span><span class="bp">/.</span><span class="n">elan</span><span class="bp">/</span><span class="n">toolchains</span><span class="bp">/</span><span class="n">Kha</span><span class="c1">--lean4---v4.0.0-bundle-rc/bin/lean -R ./. -o ./build/lib/Lake/DSL/Attributes.olean -c ./build/ir/Lake/DSL/Attributes.c ././Lake/DSL/Attributes.lean</span>
<span class="bp">&gt;</span> <span class="n">LEAN_PATH</span><span class="bp">=./</span><span class="n">build</span><span class="bp">/</span><span class="n">lib</span> <span class="bp">/</span><span class="n">home</span><span class="bp">/</span><span class="n">alex</span><span class="bp">/.</span><span class="n">elan</span><span class="bp">/</span><span class="n">toolchains</span><span class="bp">/</span><span class="n">Kha</span><span class="c1">--lean4---v4.0.0-bundle-rc/bin/lean -R ./. -o ./build/lib/Lake/Util/MainM.olean -c ./build/ir/Lake/Util/MainM.c ././Lake/Util/MainM.lean</span>
<span class="bp">&gt;</span> <span class="n">LEAN_PATH</span><span class="bp">=./</span><span class="n">build</span><span class="bp">/</span><span class="n">lib</span> <span class="bp">/</span><span class="n">home</span><span class="bp">/</span><span class="n">alex</span><span class="bp">/.</span><span class="n">elan</span><span class="bp">/</span><span class="n">toolchains</span><span class="bp">/</span><span class="n">Kha</span><span class="c1">--lean4---v4.0.0-bundle-rc/bin/lean -R ./. -o ./build/lib/Lake/Util/CliT.olean -c ./build/ir/Lake/Util/CliT.c ././Lake/Util/CliT.lean</span>
<span class="bp">&gt;</span> <span class="bp">/</span><span class="n">home</span><span class="bp">/</span><span class="n">alex</span><span class="bp">/.</span><span class="n">elan</span><span class="bp">/</span><span class="n">toolchains</span><span class="bp">/</span><span class="n">Kha</span><span class="c1">--lean4---v4.0.0-bundle-rc/bin/leanc -c -o ./build/ir/Lake/Config/OpaquePackage.o ./build/ir/Lake/Config/OpaquePackage.c -O3 -DNDEBUG</span>
<span class="bp">&gt;</span> <span class="bp">/</span><span class="n">home</span><span class="bp">/</span><span class="n">alex</span><span class="bp">/.</span><span class="n">elan</span><span class="bp">/</span><span class="n">toolchains</span><span class="bp">/</span><span class="n">Kha</span><span class="c1">--lean4---v4.0.0-bundle-rc/bin/leanc -c -o ./build/ir/Lake/LeanVersion.o ./build/ir/Lake/LeanVersion.c -O3 -DNDEBUG</span>
<span class="bp">&gt;</span> <span class="bp">/</span><span class="n">home</span><span class="bp">/</span><span class="n">alex</span><span class="bp">/.</span><span class="n">elan</span><span class="bp">/</span><span class="n">toolchains</span><span class="bp">/</span><span class="n">Kha</span><span class="c1">--lean4---v4.0.0-bundle-rc/bin/leanc -c -o ./build/ir/Lake/Config/Script.o ./build/ir/Lake/Config/Script.c -O3 -DNDEBUG</span>
<span class="bp">&gt;</span> <span class="n">LEAN_PATH</span><span class="bp">=./</span><span class="n">build</span><span class="bp">/</span><span class="n">lib</span> <span class="bp">/</span><span class="n">home</span><span class="bp">/</span><span class="n">alex</span><span class="bp">/.</span><span class="n">elan</span><span class="bp">/</span><span class="n">toolchains</span><span class="bp">/</span><span class="n">Kha</span><span class="c1">--lean4---v4.0.0-bundle-rc/bin/lean -R ./. -o ./build/lib/Lake/Util/Git.olean -c ./build/ir/Lake/Util/Git.c ././Lake/Util/Git.lean</span>
<span class="bp">&gt;</span> <span class="n">LEAN_PATH</span><span class="bp">=./</span><span class="n">build</span><span class="bp">/</span><span class="n">lib</span> <span class="bp">/</span><span class="n">home</span><span class="bp">/</span><span class="n">alex</span><span class="bp">/.</span><span class="n">elan</span><span class="bp">/</span><span class="n">toolchains</span><span class="bp">/</span><span class="n">Kha</span><span class="c1">--lean4---v4.0.0-bundle-rc/bin/lean -R ./. -o ./build/lib/Lake/Version.olean -c ./build/ir/Lake/Version.c ././Lake/Version.lean</span>
<span class="bp">&gt;</span> <span class="bp">/</span><span class="n">home</span><span class="bp">/</span><span class="n">alex</span><span class="bp">/.</span><span class="n">elan</span><span class="bp">/</span><span class="n">toolchains</span><span class="bp">/</span><span class="n">Kha</span><span class="c1">--lean4---v4.0.0-bundle-rc/bin/leanc -c -o ./build/ir/Lake/Config/Workspace.o ./build/ir/Lake/Config/Workspace.c -O3 -DNDEBUG</span>
<span class="bp">&gt;</span> <span class="bp">/</span><span class="n">home</span><span class="bp">/</span><span class="n">alex</span><span class="bp">/.</span><span class="n">elan</span><span class="bp">/</span><span class="n">toolchains</span><span class="bp">/</span><span class="n">Kha</span><span class="c1">--lean4---v4.0.0-bundle-rc/bin/leanc -c -o ./build/ir/Lake/DSL/Attributes.o ./build/ir/Lake/DSL/Attributes.c -O3 -DNDEBUG</span>
<span class="bp">&gt;</span> <span class="bp">/</span><span class="n">home</span><span class="bp">/</span><span class="n">alex</span><span class="bp">/.</span><span class="n">elan</span><span class="bp">/</span><span class="n">toolchains</span><span class="bp">/</span><span class="n">Kha</span><span class="c1">--lean4---v4.0.0-bundle-rc/bin/leanc -c -o ./build/ir/Lake/Util/LogT.o ./build/ir/Lake/Util/LogT.c -O3 -DNDEBUG</span>
<span class="bp">&gt;</span> <span class="n">LEAN_PATH</span><span class="bp">=./</span><span class="n">build</span><span class="bp">/</span><span class="n">lib</span> <span class="bp">/</span><span class="n">home</span><span class="bp">/</span><span class="n">alex</span><span class="bp">/.</span><span class="n">elan</span><span class="bp">/</span><span class="n">toolchains</span><span class="bp">/</span><span class="n">Kha</span><span class="c1">--lean4---v4.0.0-bundle-rc/bin/lean -R ./. -o ./build/lib/Lake/Build/MonadCore.olean -c ./build/ir/Lake/Build/MonadCore.c ././Lake/Build/MonadCore.lean</span>
<span class="bp">&lt;</span><span class="n">SNIP</span><span class="bp">&gt;</span>
<span class="bp">./</span><span class="n">build</span><span class="bp">/</span><span class="n">ir</span><span class="bp">/</span><span class="n">Lake</span><span class="bp">/</span><span class="n">Config</span><span class="bp">/</span><span class="n">InstallPath.o</span> <span class="bp">./</span><span class="n">build</span><span class="bp">/</span><span class="n">ir</span><span class="bp">/</span><span class="n">Lake</span><span class="bp">/</span><span class="n">Build</span><span class="bp">/</span><span class="n">Module.o</span> <span class="bp">./</span><span class="n">build</span><span class="bp">/</span><span class="n">ir</span><span class="bp">/</span><span class="n">Lake</span><span class="bp">/</span><span class="n">LeanVersion.o</span> <span class="bp">./</span><span class="n">build</span><span class="bp">/</span><span class="n">ir</span><span class="bp">/</span><span class="n">Lake</span><span class="bp">/</span><span class="n">Build</span><span class="bp">/</span><span class="n">Trace.o</span> <span class="bp">./</span><span class="n">build</span><span class="bp">/</span><span class="n">ir</span><span class="bp">/</span><span class="n">Lake</span><span class="bp">/</span><span class="n">Build</span><span class="bp">/</span><span class="n">MonadCore.o</span> <span class="bp">./</span><span class="n">build</span><span class="bp">/</span><span class="n">ir</span><span class="bp">/</span><span class="n">Lake</span><span class="bp">/</span><span class="n">Config</span><span class="bp">/</span><span class="n">Script.o</span> <span class="bp">-</span><span class="n">rdynamic</span>
<span class="n">Lake</span> <span class="n">version</span> <span class="mi">3</span><span class="bp">.</span><span class="mi">0</span><span class="bp">.</span><span class="mi">0</span><span class="bp">-</span><span class="n">pre</span> <span class="o">(</span><span class="n">Lean</span> <span class="n">version</span> <span class="n">master</span> <span class="o">(</span><span class="mi">4</span><span class="bp">.</span><span class="mi">0</span><span class="bp">.</span><span class="mi">0</span><span class="o">))</span>

<span class="n">USAGE</span><span class="o">:</span>
  <span class="n">lake</span> <span class="o">[</span><span class="n">OPTIONS</span><span class="o">]</span> <span class="bp">&lt;</span><span class="n">COMMAND</span><span class="bp">&gt;</span>

<span class="n">OPTIONS</span><span class="o">:</span>
  <span class="c1">--version             print version and exit</span>
  <span class="c1">--help, -h            print help of the program or a command and exit</span>
  <span class="c1">--dir, -d=file        use the package configuration in a specific directory</span>
  <span class="c1">--file, -f=file       use a specific file for the package configuration</span>
  <span class="c1">--lean=cmd            specify the `lean` command used by Lake</span>

<span class="n">COMMANDS</span><span class="o">:</span>
  <span class="n">new</span> <span class="bp">&lt;</span><span class="n">name</span><span class="bp">&gt;</span>            <span class="n">create</span> <span class="n">a</span> <span class="n">Lean</span> <span class="n">package</span> <span class="k">in</span> <span class="n">a</span> <span class="n">new</span> <span class="n">directory</span>
  <span class="n">init</span> <span class="bp">&lt;</span><span class="n">name</span><span class="bp">&gt;</span>           <span class="n">create</span> <span class="n">a</span> <span class="n">Lean</span> <span class="n">package</span> <span class="k">in</span> <span class="n">the</span> <span class="n">current</span> <span class="n">directory</span>
  <span class="n">server</span>                <span class="n">start</span> <span class="n">the</span> <span class="n">Lean</span> <span class="n">language</span> <span class="n">server</span>
  <span class="n">run</span> <span class="bp">&lt;</span><span class="n">script</span><span class="bp">&gt;</span>          <span class="n">run</span> <span class="n">arbitrary</span> <span class="n">package</span> <span class="n">scripts</span>
  <span class="n">configure</span>             <span class="n">download</span> <span class="n">and</span> <span class="n">build</span> <span class="n">dependencies</span>
  <span class="n">build</span> <span class="o">[</span><span class="bp">&lt;</span><span class="n">targets</span><span class="bp">&gt;...</span><span class="o">]</span>  <span class="n">configure</span> <span class="n">and</span> <span class="n">build</span> <span class="n">targets</span>
  <span class="n">clean</span>                 <span class="n">remove</span> <span class="n">build</span> <span class="n">outputs</span>

<span class="n">See</span> <span class="bp">`</span><span class="n">lake</span> <span class="n">help</span> <span class="bp">&lt;</span><span class="n">command</span><span class="bp">&gt;`</span> <span class="n">for</span> <span class="n">more</span> <span class="n">information</span> <span class="n">on</span> <span class="n">a</span> <span class="n">specific</span> <span class="n">command.</span>
</code></pre></div>



<a name="261643989"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Self-contained%20native%20toolchain/near/261643989" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Henrik Böving <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Self-contained.20native.20toolchain.html#261643989">(Nov 16 2021 at 13:59)</a>:</h4>
<p>Works for me on Fedora 35 without any issues for lake, lean4-socket and the few small projects I built myself with lake \o/ <span class="user-mention" data-user-id="110024">@Sebastian Ullrich</span></p>



<a name="261644044"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Self-contained%20native%20toolchain/near/261644044" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Self-contained.20native.20toolchain.html#261644044">(Nov 16 2021 at 13:59)</a>:</h4>
<p><span class="user-mention" data-user-id="308899">@Yakov Pechersky</span> Ah, I assume you haven't updated elan in a while. You'll probably need to reinstall it via</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">curl</span> <span class="n">https</span><span class="o">:</span><span class="bp">//</span><span class="n">raw.githubusercontent.com</span><span class="bp">/</span><span class="n">leanprover</span><span class="bp">/</span><span class="n">elan</span><span class="bp">/</span><span class="n">master</span><span class="bp">/</span><span class="n">elan</span><span class="bp">-</span><span class="n">init.sh</span> <span class="bp">-</span><span class="n">sSf</span> <span class="bp">|</span> <span class="n">sh</span>
</code></pre></div>



<a name="261644653"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Self-contained%20native%20toolchain/near/261644653" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Self-contained.20native.20toolchain.html#261644653">(Nov 16 2021 at 14:03)</a>:</h4>
<p><code>lean4-socket</code> fails for me on nixos.  I guess we need support for the system compiler in lake:</p>
<div class="codehilite" data-code-language="Text only"><pre><span></span><code>examples/gethostname
error: ./../../././native/native.c:13:10: fatal error: 'stdlib.h' file not found
#include &lt;stdlib.h&gt;
         ^~~~~~~~~~
1 error generated.

error: external command leanc exited with status 1
error: build failed
</code></pre></div>



<a name="261645060"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Self-contained%20native%20toolchain/near/261645060" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Henrik Böving <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Self-contained.20native.20toolchain.html#261645060">(Nov 16 2021 at 14:06)</a>:</h4>
<p>Oh if i try to run the examples it fails as well :( Seems like it only ever then tries to compile the C code.</p>



<a name="261695473"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Self-contained%20native%20toolchain/near/261695473" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Self-contained.20native.20toolchain.html#261695473">(Nov 16 2021 at 19:40)</a>:</h4>
<p>Works for me on macOS (11.6).</p>



<a name="261697353"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Self-contained%20native%20toolchain/near/261697353" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Self-contained.20native.20toolchain.html#261697353">(Nov 16 2021 at 19:52)</a>:</h4>
<p>I <a href="https://gist.github.com/semorrison/c810d3fb9ad189e2c3a65d129f7a15c6">tried in an <code>ubuntu</code> Docker container</a>, just installing <code>git</code> and <code>curl</code> from <code>apt-get</code>, then installing <code>elan</code>, then your instructions.</p>
<p>Curiously, <code>lake +Kha/lean4:v4.0.0-bundle-rc build</code> builds, but then <code>./build/bin/lake</code> takes about 70s before returning. Subsequent runs seem fine!?</p>



<a name="261700212"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Self-contained%20native%20toolchain/near/261700212" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Wojciech Nawrocki <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Self-contained.20native.20toolchain.html#261700212">(Nov 16 2021 at 20:13)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110087">Scott Morrison</span> <a href="#narrow/stream/270676-lean4/topic/Self-contained.20native.20toolchain/near/261697353">said</a>:</p>
<blockquote>
<p>Curiously, <code>lake +Kha/lean4:v4.0.0-bundle-rc build</code> builds, but then <code>./build/bin/lake</code> takes about 70s before returning. Subsequent runs seem fine!?</p>
</blockquote>
<p>I also observed this.</p>



<a name="261712626"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Self-contained%20native%20toolchain/near/261712626" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Self-contained.20native.20toolchain.html#261712626">(Nov 16 2021 at 21:57)</a>:</h4>
<p>Looking at your dockerfile, I believe the last <code>lake build</code> call will download then lean version specified in <code>/home/lean/lake/lean-toolchain</code>.</p>



<a name="261713076"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Self-contained%20native%20toolchain/near/261713076" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Self-contained.20native.20toolchain.html#261713076">(Nov 16 2021 at 22:00)</a>:</h4>
<p>Do you mean the <code>./build/bin/lake</code> call, rather than "the last `lake build'" call?</p>



<a name="261713110"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Self-contained%20native%20toolchain/near/261713110" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Self-contained.20native.20toolchain.html#261713110">(Nov 16 2021 at 22:00)</a>:</h4>
<p>You might also want to pass <code>--default-toolchain none</code> to the elan installer.  Then you don't need to <code>elan uninstall stable</code>.</p>



<a name="261903493"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Self-contained%20native%20toolchain/near/261903493" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Self-contained.20native.20toolchain.html#261903493">(Nov 18 2021 at 09:25)</a>:</h4>
<p><span class="user-mention" data-user-id="110024">@Sebastian Ullrich</span> I see that you've just merged the PR.  What is the recommended way to compile interfaces to native libraries now?  The <code>leanc</code> wrapper no longer finds system libraries.  Try e.g. <code>lake run examples</code> in <a href="https://github.com/xubaiw/lean4-socket">https://github.com/xubaiw/lean4-socket</a> as mentioned above:</p>
<div class="codehilite" data-code-language="Text only"><pre><span></span><code>examples/sockaddr
error: ./../../././native/native.c:13:10: fatal error: 'stdlib.h' file not found
#include &lt;stdlib.h&gt;
         ^~~~~~~~~~
1 error generated.

error: external command leanc exited with status 1
error: build failed
</code></pre></div>



<a name="261904045"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Self-contained%20native%20toolchain/near/261904045" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Self-contained.20native.20toolchain.html#261904045">(Nov 18 2021 at 09:31)</a>:</h4>
<p>Ah sorry, I didn't take a closer look at how this is set up in existing projects. I think the clean solution is to replace calls to <code>leanc</code> with <code>cc $(leanc --print-cflags)</code>.</p>



<a name="261905235"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Self-contained%20native%20toolchain/near/261905235" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Self-contained.20native.20toolchain.html#261905235">(Nov 18 2021 at 09:44)</a>:</h4>
<p><span class="user-mention" data-user-id="315577">@Mac</span> This is probably a good time to expose <code>leanc</code>'s <code>cflags/ldflags</code> variables as declarations? We can stick them in uhhhh <code>Lean.Compiler.FFI</code> I guess.</p>



<a name="261905786"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Self-contained%20native%20toolchain/near/261905786" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Self-contained.20native.20toolchain.html#261905786">(Nov 18 2021 at 09:51)</a>:</h4>
<p><span class="user-mention" data-user-id="110024">@Sebastian Ullrich</span> sounds good to me</p>



<a name="261916114"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Self-contained%20native%20toolchain/near/261916114" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Self-contained.20native.20toolchain.html#261916114">(Nov 18 2021 at 11:43)</a>:</h4>
<p><span class="user-mention" data-user-id="315577">@Mac</span> I've reviewed the possible <code>cflags</code> options and the <em>only</em> flag apart from the <code>-I</code> relevant for building custom .o files is <code>-fPIC</code> on Linux. But since the question of whether position-independent code is needed depends on what the eventual link target is, I wonder if that should be regarded a build system concern. "All you need to compile against the Lean API is to include <code>$LEAN_SYSROOT/include</code>" sounds like a good invariant to guarantee to me.</p>



<a name="261971017"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Self-contained%20native%20toolchain/near/261971017" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Self-contained.20native.20toolchain.html#261971017">(Nov 18 2021 at 18:42)</a>:</h4>
<p><span class="user-mention" data-user-id="110024">@Sebastian Ullrich</span> Cool! Furthermore, Lake already provides that path with <code>getLeanIncludeDir</code>. </p>
<p>Personally, though, I still think it would a good idea to expose <code>leanc</code>'s  configuration options (default compiler, internal/extra cflags,  internal/static/shared ldflags) in Lean proper so that tools (like Lake) can potentially leverage them in customized approaches.</p>



<a name="261979146"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Self-contained%20native%20toolchain/near/261979146" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Self-contained.20native.20toolchain.html#261979146">(Nov 18 2021 at 19:37)</a>:</h4>
<p>See PR :)</p>



<a name="262106309"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Self-contained%20native%20toolchain/near/262106309" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Self-contained.20native.20toolchain.html#262106309">(Nov 19 2021 at 18:14)</a>:</h4>
<p><span aria-label="eyes" class="emoji emoji-1f440" role="img" title="eyes">:eyes:</span> </p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="bp">$</span> <span class="n">git</span> <span class="n">diff</span>
<span class="n">diff</span> <span class="c1">--git a/lakefile.lean b/lakefile.lean</span>
<span class="n">index</span> <span class="n">fde5791..a5a070b</span> <span class="mi">100644</span>
<span class="c1">--- a/lakefile.lean</span>
<span class="bp">+++</span> <span class="n">b</span><span class="bp">/</span><span class="n">lakefile.lean</span>
<span class="bp">@@</span> <span class="bp">-</span><span class="mi">4</span><span class="o">,</span><span class="mi">3</span> <span class="bp">+</span><span class="mi">4</span><span class="o">,</span><span class="mi">5</span> <span class="bp">@@</span> <span class="kn">open</span> <span class="n">System</span> <span class="n">Lake</span> <span class="n">DSL</span>
 <span class="n">package</span> <span class="n">lake</span> <span class="n">where</span>
   <span class="n">binRoot</span> <span class="o">:=</span> <span class="bp">`</span><span class="n">Lake.Main</span>
   <span class="n">supportInterpreter</span> <span class="o">:=</span> <span class="n">true</span>
<span class="bp">+</span>  <span class="n">moreLeancArgs</span> <span class="o">:=</span> <span class="bp">#</span><span class="o">[</span><span class="s2">"-target"</span><span class="o">,</span> <span class="s2">"x86_64-w64-windows-gnu"</span><span class="o">,</span> <span class="s2">"-fno-PIC"</span><span class="o">,</span> <span class="s2">"--sysroot"</span><span class="o">,</span> <span class="s2">"/home/sebastian/Downloads/lean-4.0.0-windows"</span><span class="o">]</span>
<span class="bp">+</span>  <span class="n">moreLinkArgs</span> <span class="o">:=</span> <span class="bp">#</span><span class="o">[</span><span class="s2">"-target"</span><span class="o">,</span> <span class="s2">"x86_64-w64-windows-gnu"</span><span class="o">,</span> <span class="s2">"-fno-PIC"</span><span class="o">,</span> <span class="s2">"--sysroot"</span><span class="o">,</span> <span class="s2">"/home/sebastian/Downloads/lean-4.0.0-windows"</span><span class="o">]</span>

<span class="bp">$</span> <span class="bp">~/</span><span class="n">Downloads</span><span class="bp">/</span><span class="n">lean</span><span class="bp">-</span><span class="mi">4</span><span class="bp">.</span><span class="mi">0</span><span class="bp">.</span><span class="mi">0</span><span class="bp">-</span><span class="n">linux</span><span class="bp">/</span><span class="n">bin</span><span class="bp">/</span><span class="n">lake</span> <span class="n">build</span>
<span class="bp">...</span>
<span class="n">error</span><span class="o">:</span> <span class="n">lld</span><span class="o">:</span> <span class="n">error</span><span class="o">:</span> <span class="n">unknown</span> <span class="n">argument</span><span class="o">:</span> <span class="c1">--as-needed</span>

<span class="bp">$</span> <span class="bp">/</span><span class="n">home</span><span class="bp">/</span><span class="n">sebastian</span><span class="bp">/</span><span class="n">Downloads</span><span class="bp">/</span><span class="n">lean</span><span class="bp">-</span><span class="mi">4</span><span class="bp">.</span><span class="mi">0</span><span class="bp">.</span><span class="mi">0</span><span class="bp">-</span><span class="n">linux</span><span class="bp">/</span><span class="n">bin</span><span class="bp">/</span><span class="n">leanc</span> <span class="bp">-</span><span class="n">o</span> <span class="bp">./</span><span class="n">build</span><span class="bp">/</span><span class="n">bin</span><span class="bp">/</span><span class="n">lake</span> <span class="bp">...</span> <span class="bp">#</span> <span class="n">massage</span> <span class="n">linker</span> <span class="n">cmdline</span> <span class="n">a</span> <span class="n">bit</span> <span class="n">since</span> <span class="bp">`</span><span class="n">leanc</span><span class="bp">`</span> <span class="n">doesn't</span> <span class="n">check</span> <span class="n">for</span> <span class="bp">`-</span><span class="n">target</span><span class="bp">`</span> <span class="n">yet...</span>

<span class="bp">$</span> <span class="n">file</span> <span class="n">build</span><span class="bp">/</span><span class="n">bin</span><span class="bp">/</span><span class="n">lake.exe</span>
<span class="n">build</span><span class="bp">/</span><span class="n">bin</span><span class="bp">/</span><span class="n">lake.exe</span><span class="o">:</span> <span class="n">PE32</span><span class="bp">+</span> <span class="n">executable</span> <span class="o">(</span><span class="n">console</span><span class="o">)</span> <span class="n">x86</span><span class="bp">-</span><span class="mi">64</span><span class="o">,</span> <span class="n">for</span> <span class="n">MS</span> <span class="n">Windows</span>

<span class="bp">$</span> <span class="n">WINEPATH</span><span class="bp">=~/</span><span class="n">Downloads</span><span class="bp">/</span><span class="n">lean</span><span class="bp">-</span><span class="mi">4</span><span class="bp">.</span><span class="mi">0</span><span class="bp">.</span><span class="mi">0</span><span class="bp">-</span><span class="n">windows</span><span class="bp">/</span><span class="n">bin</span> <span class="n">nix</span> <span class="n">shell</span> <span class="n">nixpkgs</span><span class="bp">#</span><span class="n">wineWowPackages.stable</span> <span class="bp">-</span><span class="n">c</span> <span class="n">wine</span> <span class="n">build</span><span class="bp">/</span><span class="n">bin</span><span class="bp">/</span><span class="n">lake.exe</span>
<span class="mi">0050</span><span class="o">:</span><span class="n">err</span><span class="o">:</span><span class="n">ole</span><span class="o">:</span><span class="n">start_rpcss</span> <span class="n">Failed</span> <span class="n">to</span> <span class="n">start</span> <span class="n">RpcSs</span> <span class="n">service</span>
<span class="n">Lake</span> <span class="n">version</span> <span class="mi">3</span><span class="bp">.</span><span class="mi">0</span><span class="bp">.</span><span class="mi">0</span><span class="bp">-</span><span class="n">pre</span> <span class="o">(</span><span class="n">Lean</span> <span class="n">version</span> <span class="n">master</span> <span class="o">(</span><span class="mi">4</span><span class="bp">.</span><span class="mi">0</span><span class="bp">.</span><span class="mi">0</span><span class="o">))</span>

<span class="n">USAGE</span><span class="o">:</span>
  <span class="n">lake</span> <span class="o">[</span><span class="n">OPTIONS</span><span class="o">]</span> <span class="bp">&lt;</span><span class="n">COMMAND</span><span class="bp">&gt;</span>
<span class="bp">...</span>
</code></pre></div>



<a name="262107299"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Self-contained%20native%20toolchain/near/262107299" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Self-contained.20native.20toolchain.html#262107299">(Nov 19 2021 at 18:22)</a>:</h4>
<p>Step 3 shows that a bit more setup is yet to be done, but the bundled release for Windows apparently contains all the files necessary to cross-compile Lean programs to Windows. Supposedly the same is true for the other two platforms.</p>



<a name="262109265"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Self-contained%20native%20toolchain/near/262109265" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Self-contained.20native.20toolchain.html#262109265">(Nov 19 2021 at 18:36)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="bp">$</span> <span class="n">git</span> <span class="n">diff</span>
<span class="n">diff</span> <span class="c1">--git a/lakefile.lean b/lakefile.lean</span>
<span class="n">index</span> <span class="n">fde5791..7c68820</span> <span class="mi">100644</span>
<span class="c1">--- a/lakefile.lean</span>
<span class="bp">+++</span> <span class="n">b</span><span class="bp">/</span><span class="n">lakefile.lean</span>
<span class="bp">@@</span> <span class="bp">-</span><span class="mi">4</span><span class="o">,</span><span class="mi">3</span> <span class="bp">+</span><span class="mi">4</span><span class="o">,</span><span class="mi">5</span> <span class="bp">@@</span> <span class="kn">open</span> <span class="n">System</span> <span class="n">Lake</span> <span class="n">DSL</span>
 <span class="n">package</span> <span class="n">lake</span> <span class="n">where</span>
   <span class="n">binRoot</span> <span class="o">:=</span> <span class="bp">`</span><span class="n">Lake.Main</span>
   <span class="n">supportInterpreter</span> <span class="o">:=</span> <span class="n">true</span>
<span class="bp">+</span>  <span class="n">moreLeancArgs</span> <span class="o">:=</span> <span class="bp">#</span><span class="o">[</span><span class="s2">"-target"</span><span class="o">,</span> <span class="s2">"x86_64-apple-darwin"</span><span class="o">,</span> <span class="s2">"--sysroot"</span><span class="o">,</span> <span class="s2">"/home/sebastian/Downloads/lean-4.0.0-darwin"</span><span class="o">]</span>
<span class="bp">+</span>  <span class="n">moreLinkArgs</span> <span class="o">:=</span> <span class="bp">#</span><span class="o">[</span><span class="s2">"-target"</span><span class="o">,</span> <span class="s2">"x86_64-apple-darwin"</span><span class="o">,</span> <span class="s2">"--sysroot"</span><span class="o">,</span> <span class="s2">"/home/sebastian/Downloads/lean-4.0.0-darwin"</span><span class="o">]</span>

<span class="bp">$</span> <span class="n">file</span> <span class="n">build</span><span class="bp">/</span><span class="n">bin</span><span class="bp">/</span><span class="n">lake</span>
<span class="n">build</span><span class="bp">/</span><span class="n">bin</span><span class="bp">/</span><span class="n">lake</span><span class="o">:</span> <span class="n">Mach</span><span class="bp">-</span><span class="n">O</span> <span class="mi">64</span><span class="bp">-</span><span class="n">bit</span> <span class="n">x86_64</span> <span class="n">executable</span><span class="o">,</span> <span class="n">flags</span><span class="o">:</span><span class="bp">&lt;</span><span class="n">NOUNDEFS</span><span class="bp">|</span><span class="n">DYLDLINK</span><span class="bp">|</span><span class="n">TWOLEVEL</span><span class="bp">|</span><span class="n">WEAK_DEFINES</span><span class="bp">|</span><span class="n">BINDS_TO_WEAK</span><span class="bp">|</span><span class="n">PIE</span><span class="bp">|</span><span class="n">HAS_TLV_DESCRIPTORS</span><span class="bp">&gt;</span>
</code></pre></div>



<a name="262112898"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Self-contained%20native%20toolchain/near/262112898" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Self-contained.20native.20toolchain.html#262112898">(Nov 19 2021 at 18:59)</a>:</h4>
<p>Nice!  Does elan still have the code to install multiple targets?</p>



<a name="262119909"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Self-contained%20native%20toolchain/near/262119909" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Self-contained.20native.20toolchain.html#262119909">(Nov 19 2021 at 19:47)</a>:</h4>
<p>I don't think so, but the obvious next step is for elan's <code>leanc</code> to recognize <code>-target</code>, download the appropriate release on the fly (into the existing toolchain dir?), and pass it as <code>--sysroot</code>, no? <span aria-label="laughter tears" class="emoji emoji-1f602" role="img" title="laughter tears">:laughter_tears:</span></p>



<a name="262120031"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Self-contained%20native%20toolchain/near/262120031" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Self-contained.20native.20toolchain.html#262120031">(Nov 19 2021 at 19:48)</a>:</h4>
<p>(It doesn't quite work that way because the <code>leanc</code> <code>lake</code> will call will not be elan's)</p>



<a name="263274595"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Self-contained%20native%20toolchain/near/263274595" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Floris van Doorn <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Self-contained.20native.20toolchain.html#263274595">(Dec 01 2021 at 11:12)</a>:</h4>
<p>This works for me on both Windows 10 and Ubuntu 20.04</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>