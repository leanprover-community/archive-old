---
layout: archive
title: Zulip Chat Archive
permalink: /stream/270676-lean4/topic/Gadts.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/index.html">lean4</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Gadts.html">Gadts</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="275447487"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Gadts/near/275447487" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joseph O <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Gadts.html#275447487">(Mar 15 2022 at 23:02)</a>:</h4>
<p>What does this error mean and how do i fix it? <br>
<a href="/user_uploads/3121/6pjuBMNo3hPMVtBQ2Rlt34_V/image.png">image.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/3121/6pjuBMNo3hPMVtBQ2Rlt34_V/image.png" title="image.png"><img src="/user_uploads/3121/6pjuBMNo3hPMVtBQ2Rlt34_V/image.png"></a></div>



<a name="275447606"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Gadts/near/275447606" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Edward Ayers <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Gadts.html#275447606">(Mar 15 2022 at 23:03)</a>:</h4>
<p>What is <code>Boolbn</code>?</p>



<a name="275447719"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Gadts/near/275447719" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Edward Ayers <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Gadts.html#275447719">(Mar 15 2022 at 23:04)</a>:</h4>
<p>Also it looks like you are mixing α and a</p>



<a name="275448167"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Gadts/near/275448167" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Edward Ayers <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Gadts.html#275448167">(Mar 15 2022 at 23:10)</a>:</h4>
<p>The problem that the error is talking about is that you need to increase the universe level of the output type of GADT</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">inductive</span> <span class="n">GADT</span> <span class="o">:</span> <span class="kt">Type</span> <span class="bp">→</span> <span class="kt">Type</span> <span class="bp">→</span> <span class="kt">Type</span> <span class="bp">→</span> <span class="kt">Type</span> <span class="mi">1</span> <span class="n">where</span>
<span class="bp">|</span> <span class="n">C1</span> <span class="o">:</span> <span class="n">α</span> <span class="bp">→</span> <span class="n">β</span> <span class="bp">→</span> <span class="n">GADT</span> <span class="n">α</span> <span class="n">β</span> <span class="n">Bool</span>
<span class="bp">|</span> <span class="n">C2</span> <span class="o">:</span> <span class="n">α</span> <span class="bp">→</span> <span class="n">GADT</span> <span class="n">α</span> <span class="n">α</span> <span class="n">α</span>
<span class="bp">|</span> <span class="n">C3</span> <span class="o">:</span> <span class="n">β</span> <span class="bp">→</span> <span class="n">γ</span> <span class="bp">→</span> <span class="n">GADT</span> <span class="n">γ</span> <span class="n">β</span> <span class="n">Int</span>
</code></pre></div>



<a name="275448172"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Gadts/near/275448172" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joseph O <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Gadts.html#275448172">(Mar 15 2022 at 23:10)</a>:</h4>
<p>Huh thats weird. Ok, let me try to apply the fixes</p>



<a name="275448230"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Gadts/near/275448230" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Gadts.html#275448230">(Mar 15 2022 at 23:11)</a>:</h4>
<p><span class="user-mention" data-user-id="467926">@Joseph O</span> have you considered upgrading from constantly posting screenshots to posting code in triple backticks? It's much easier to read on mobile and also mush easier to write!</p>



<a name="275448418"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Gadts/near/275448418" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Gadts.html#275448418">(Mar 15 2022 at 23:13)</a>:</h4>
<p>You can copy/past the error message as a Lean commentary in the code block</p>



<a name="275448435"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Gadts/near/275448435" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joseph O <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Gadts.html#275448435">(Mar 15 2022 at 23:13)</a>:</h4>
<p>I just find it more convenient to include the error message as well in place</p>



<a name="275448458"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Gadts/near/275448458" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joseph O <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Gadts.html#275448458">(Mar 15 2022 at 23:13)</a>:</h4>
<p>But I will put it in code blocks from now on</p>



<a name="275448763"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Gadts/near/275448763" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Gadts.html#275448763">(Mar 15 2022 at 23:17)</a>:</h4>
<p>If we think it's hard to understand where the error is coming from (because we can't see the the red underlines), at least we can copy your code and see it for ourselves.<br>
Also, some troubles require tweaking the code so we can understand what's happening</p>



<a name="275449449"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Gadts/near/275449449" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Edward Ayers <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Gadts.html#275449449">(Mar 15 2022 at 23:26)</a>:</h4>
<p>It does seem a bit weird though. Does anyone know why the following errors if I uncomment the second line?</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">inductive</span> <span class="n">G</span> <span class="o">:</span> <span class="kt">Type</span>  <span class="bp">→</span> <span class="kt">Type</span> <span class="bp">→</span> <span class="kt">Type</span>  <span class="n">where</span>
<span class="bp">|</span> <span class="n">C1</span> <span class="o">:</span> <span class="n">α</span> <span class="bp">→</span> <span class="n">β</span> <span class="bp">→</span> <span class="n">G</span> <span class="n">α</span> <span class="n">β</span>
<span class="c1">-- | C2 : α → G α α</span>
</code></pre></div>



<a name="275449482"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Gadts/near/275449482" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Edward Ayers <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Gadts.html#275449482">(Mar 15 2022 at 23:26)</a>:</h4>
<p>Another example</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">inductive</span> <span class="n">G</span> <span class="o">:</span> <span class="kt">Type</span> <span class="bp">→</span> <span class="kt">Type</span>  <span class="n">where</span>
<span class="bp">|</span> <span class="n">C1</span> <span class="o">:</span> <span class="n">α</span> <span class="bp">→</span> <span class="n">G</span> <span class="n">Int</span>
</code></pre></div>



<a name="275449796"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Gadts/near/275449796" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Gadts.html#275449796">(Mar 15 2022 at 23:30)</a>:</h4>
<p>This works:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">inductive</span> <span class="n">G</span> <span class="o">{</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">}</span> <span class="o">:</span> <span class="kt">Type</span> <span class="bp">→</span> <span class="kt">Type</span>  <span class="n">where</span>
<span class="bp">|</span> <span class="n">C1</span> <span class="o">:</span> <span class="n">α</span> <span class="bp">→</span> <span class="n">G</span> <span class="n">Int</span>
</code></pre></div>
<p>But I don't understand why (given that the <a href="#narrow/stream/270676-lean4/topic/Gadts/near/275449482">code above</a> failed)</p>



<a name="275450115"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Gadts/near/275450115" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Gadts.html#275450115">(Mar 15 2022 at 23:33)</a>:</h4>
<p>This looks like <a href="#narrow/stream/270676-lean4/topic/Regression.20in.20implicit.20argument.20inference">https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Regression.20in.20implicit.20argument.20inference</a></p>



<a name="275450628"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Gadts/near/275450628" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Edward Ayers <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Gadts.html#275450628">(Mar 15 2022 at 23:35)</a>:</h4>
<p><span class="user-mention" data-user-id="451983">@Arthur Paulino</span> your example is ok because α is now a parameter</p>



<a name="275450669"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Gadts/near/275450669" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Gadts.html#275450669">(Mar 15 2022 at 23:36)</a>:</h4>
<p>I haven't checked the last few nightlies, but if <span class="user-mention" data-user-id="121918">@Edward Ayers</span> you are on the most recent version and leo implemented the index inference algorithm he mentioned at the end, then I would guess that your first example is comparing</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">inductive</span> <span class="n">G</span> <span class="o">{</span><span class="n">α</span> <span class="n">β</span><span class="o">}</span> <span class="o">:</span> <span class="kt">Type</span>  <span class="bp">→</span> <span class="kt">Type</span> <span class="bp">→</span> <span class="kt">Type</span>  <span class="n">where</span>
<span class="bp">|</span> <span class="n">C1</span> <span class="o">:</span> <span class="n">α</span> <span class="bp">→</span> <span class="n">β</span> <span class="bp">→</span> <span class="n">G</span> <span class="n">α</span> <span class="n">β</span>
<span class="c1">-- | C2 : α → G α α</span>
</code></pre></div>
<p>to</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">inductive</span> <span class="n">G</span> <span class="o">{</span><span class="n">α</span><span class="o">}</span> <span class="o">:</span> <span class="bp">∀</span> <span class="o">{</span><span class="n">β</span><span class="o">},</span> <span class="kt">Type</span>  <span class="bp">→</span> <span class="kt">Type</span> <span class="bp">→</span> <span class="kt">Type</span>  <span class="n">where</span>
<span class="bp">|</span> <span class="n">C1</span> <span class="o">:</span> <span class="n">α</span> <span class="bp">→</span> <span class="n">β</span> <span class="bp">→</span> <span class="n">G</span> <span class="n">α</span> <span class="n">β</span>
<span class="bp">|</span> <span class="n">C2</span> <span class="o">:</span> <span class="n">α</span> <span class="bp">→</span> <span class="n">G</span> <span class="n">α</span> <span class="n">α</span>
</code></pre></div>



<a name="275450682"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Gadts/near/275450682" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Edward Ayers <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Gadts.html#275450682">(Mar 15 2022 at 23:36)</a>:</h4>
<p>I think my second example fails correctly right?</p>



<a name="275450705"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Gadts/near/275450705" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Gadts.html#275450705">(Mar 15 2022 at 23:36)</a>:</h4>
<p>well, it's also possible to rewrite all these examples so that they live in <code>Type</code></p>



<a name="275450713"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Gadts/near/275450713" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Gadts.html#275450713">(Mar 15 2022 at 23:37)</a>:</h4>
<p>but not with the obvious encoding</p>



<a name="275450790"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Gadts/near/275450790" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Gadts.html#275450790">(Mar 15 2022 at 23:38)</a>:</h4>
<p>For the second example you would write</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">inductive</span> <span class="n">G</span> <span class="o">(</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">)</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">where</span>
<span class="bp">|</span> <span class="n">C1</span> <span class="o">:</span> <span class="n">α</span> <span class="bp">=</span> <span class="n">Int</span> <span class="bp">→</span> <span class="n">G</span> <span class="n">α</span>
</code></pre></div>



<a name="275450804"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Gadts/near/275450804" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Gadts.html#275450804">(Mar 15 2022 at 23:38)</a>:</h4>
<p>and yes that's an equality of types</p>



<a name="275450811"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Gadts/near/275450811" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Gadts.html#275450811">(Mar 15 2022 at 23:38)</a>:</h4>
<p><span class="user-mention silent" data-user-id="121918">Edward Ayers</span> <a href="#narrow/stream/270676-lean4/topic/Gadts/near/275450628">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="451983">Arthur Paulino</span> your example is ok because α is now a parameter</p>
</blockquote>
<p>Ah, I thought Lean was able to create implicit parameters for me as it usually does with theorems</p>



<a name="275450832"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Gadts/near/275450832" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Gadts.html#275450832">(Mar 15 2022 at 23:39)</a>:</h4>
<p>The bug report I linked was because the inference algorithm changed to prefer them as indices</p>



<a name="275452218"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Gadts/near/275452218" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Edward Ayers <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Gadts.html#275452218">(Mar 15 2022 at 23:56)</a>:</h4>
<p>Please correct me if I've messed this up. You get the "is too big for the corresponding inductive datatype" error if the constructor's type is <code>(p₁ : π₁) → ... → (pₘ : πₘ) → (x₁ : α₁) → (x₂ : α₂) ... → (xₙ : αₙ) → G ..</code> where the <code>pᵢ</code> are the parameters and one of the <code>αᵢ : Type u</code> where <code>u</code> is greater than or equal to the universe that the inductive type lives in.</p>
<p>So, the examples here (including OP example) fail because the inference system is not setting  (not necessarily erroneously) <code>α</code>, <code>β</code> to be parameters of <code>G</code>?</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>