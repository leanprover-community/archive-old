---
layout: archive
title: Zulip Chat Archive
permalink: /stream/270676-lean4/topic/Syntax.20match.20not.20forcing.20types.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/index.html">lean4</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Syntax.20match.20not.20forcing.20types.html">Syntax match not forcing types</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="308805947"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Syntax%20match%20not%20forcing%20types/near/308805947" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reinier van der Gronden <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Syntax.20match.20not.20forcing.20types.html#308805947">(Nov 09 2022 at 15:01)</a>:</h4>
<p>In the following MWE, I want to match on the syntax of an introduction tactic - but only the one where the input is a list of identifiers, not where fancy patterns are used.  The example at the bottom shows that when using this tactic with something that in my opinion should not match, it still does. The variable <code>ids</code> is typed as <code>TSyntaxArray 'ident</code>, but it is clearly not when looking at the raw representation. Why is this? How else can you match on specific implementations of the intro tactic?</p>
<p>Tag for <span class="user-mention" data-user-id="256311">@Jannis Limperg</span> , who was also curious about this.</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">Lean</span>
<span class="kn">open</span>
  <span class="n">Lean</span>
  <span class="n">Lean.Elab.Tactic</span>
<span class="k">#eval</span> <span class="n">Lean.versionString</span> <span class="c1">-- 4.0.0-nightly-2022-11-09</span>

<span class="kd">def</span> <span class="n">myTactic</span> <span class="o">(</span><span class="n">t</span> <span class="o">:</span> <span class="n">TSyntax</span> <span class="bp">`</span><span class="n">tactic</span><span class="o">)</span> <span class="o">:</span> <span class="n">TacticM</span> <span class="n">Unit</span> <span class="o">:=</span> <span class="k">do</span>
  <span class="k">match</span> <span class="n">t</span> <span class="k">with</span>
  <span class="bp">|</span> <span class="bp">`</span><span class="o">(</span><span class="n">tactic</span><span class="bp">|</span><span class="n">intro</span> <span class="bp">$</span><span class="n">ids</span><span class="o">:</span><span class="n">ident</span><span class="bp">*</span><span class="o">)</span> <span class="bp">=&gt;</span>
    <span class="c1">-- ids is supposed to be TSyntaxArray `ident, but its content is not:</span>
    <span class="n">addTrace</span> <span class="bp">`</span><span class="n">test</span> <span class="n">m</span><span class="bp">!</span><span class="s2">"{ids.map (fun id =&gt; repr id.raw)}"</span>
    <span class="c1">--[Lean.Syntax.node</span>
    <span class="c1">--  (Lean.SourceInfo.none)</span>
    <span class="c1">--  `Lean.Parser.Term.anonymousCtor</span>
    <span class="c1">-- ...</span>
    <span class="c1">-- ]</span>
  <span class="bp">|</span> <span class="n">_</span> <span class="bp">=&gt;</span> <span class="n">pure</span> <span class="o">()</span>


<span class="n">elab</span> <span class="bp">&amp;</span><span class="s2">"myTactic "</span> <span class="n">t</span><span class="o">:</span><span class="n">tactic</span> <span class="o">:</span> <span class="n">tactic</span> <span class="bp">=&gt;</span>
  <span class="n">myTactic</span> <span class="n">t</span>

<span class="kd">example</span> <span class="o">:</span> <span class="n">α</span> <span class="bp">∧</span> <span class="n">β</span> <span class="bp">→</span> <span class="n">α</span> <span class="o">:=</span> <span class="kd">by</span>
  <span class="n">myTactic</span> <span class="n">intro</span> <span class="o">⟨</span><span class="n">ha</span><span class="o">,</span> <span class="n">_</span><span class="o">⟩</span>
  <span class="gr">sorry</span>
</code></pre></div>



<a name="308819746"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Syntax%20match%20not%20forcing%20types/near/308819746" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Syntax.20match.20not.20forcing.20types.html#308819746">(Nov 09 2022 at 16:09)</a>:</h4>
<p>I'm somewhat surprised <code>intro $ids:ident*</code> works / is not a type error. <code>intro $[$ids:ident]*</code> has the intended behavior, and should be required for this kind of pattern matching</p>



<a name="308959716"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Syntax%20match%20not%20forcing%20types/near/308959716" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reinier van der Gronden <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Syntax.20match.20not.20forcing.20types.html#308959716">(Nov 10 2022 at 10:35)</a>:</h4>
<p>That's interesting, then what is the difference between those notations? In the builtintactic intro, they do a match with <code>:term*</code>, so I thought that was the general way to catch a list of syntax category objects.</p>



<a name="309017195"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Syntax%20match%20not%20forcing%20types/near/309017195" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Syntax.20match.20not.20forcing.20types.html#309017195">(Nov 10 2022 at 15:46)</a>:</h4>
<p>The <code>$t*</code> or <code>$t:term*</code> is an atomic binder, it just matches the entire syntax array argument without any further processing. The <code>$[...]*</code> syntax says to go into each element of the array and do a further match to bind things and pattern match the innards further (which is more expensive). It's roughly analogous to a pattern like <code>| (t : List Term) =&gt;</code> vs <code>| [(t : Ident)] =&gt;</code>, the first one does no further matches and just binds what remains as <code>t</code> of type <code>List Term</code> while the second one does a match to check that the list has a specific form and binds an inner element.</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>