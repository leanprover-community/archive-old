---
layout: archive
title: Zulip Chat Archive
permalink: /stream/270676-lean4/topic/mathport.3Awf-refl.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/index.html">lean4</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/mathport.3Awf-refl.html">mathport:wf-refl</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="232776390"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/mathport%3Awf-refl/near/232776390" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Daniel Selsam <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/mathport.3Awf-refl.html#232776390">(Apr 01 2021 at 15:26)</a>:</h4>
<p><span class="user-mention" data-user-id="110049">@Mario Carneiro</span> To backport Lean4's behavior for <a href="https://github.com/dselsam/mathport/issues/20">https://github.com/dselsam/mathport/issues/20</a> I think you only need to change these lines in Lean3: <a href="https://github.com/leanprover-community/lean/blob/master/src/library/type_context.cpp#L715-L718">https://github.com/leanprover-community/lean/blob/master/src/library/type_context.cpp#L715-L718</a> Some proofs will break though, of course.</p>



<a name="233865053"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/mathport%3Awf-refl/near/233865053" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Daniel Selsam <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/mathport.3Awf-refl.html#233865053">(Apr 09 2021 at 17:57)</a>:</h4>
<p>I am trying to patch <a href="https://github.com/leanprover-community/lean/blob/master/tests/lean/run/fib_wrec.lean#L26">https://github.com/leanprover-community/lean/blob/master/tests/lean/run/fib_wrec.lean#L26</a> after this change. What is best practice in lean3 for non-rfl-ing well-founded proofs?</p>



<a name="233865690"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/mathport%3Awf-refl/near/233865690" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/mathport.3Awf-refl.html#233865690">(Apr 09 2021 at 18:01)</a>:</h4>
<p>Hah! I can't answer your question but I do know that <code>fib 5</code> is supposed to be 5 :-)</p>



<a name="233865899"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/mathport%3Awf-refl/near/233865899" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/mathport.3Awf-refl.html#233865899">(Apr 09 2021 at 18:02)</a>:</h4>
<p>I think you should be able to prove that one by something like <code>repeat {rw fib, simp}</code></p>



<a name="233865945"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/mathport%3Awf-refl/near/233865945" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/mathport.3Awf-refl.html#233865945">(Apr 09 2021 at 18:03)</a>:</h4>
<p>probably just delete the test</p>



<a name="233866776"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/mathport%3Awf-refl/near/233866776" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Daniel Selsam <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/mathport.3Awf-refl.html#233866776">(Apr 09 2021 at 18:08)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110049">Mario Carneiro</span> <a href="#narrow/stream/270676-lean4/topic/mathport.3Awf-refl/near/233865899">said</a>:</p>
<blockquote>
<p>I think you should be able to prove that one by something like <code>repeat {rw fib, simp}</code></p>
</blockquote>
<p>Doesn't work.</p>



<a name="233866918"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/mathport%3Awf-refl/near/233866918" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Daniel Selsam <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/mathport.3Awf-refl.html#233866918">(Apr 09 2021 at 18:09)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110049">Mario Carneiro</span> <a href="#narrow/stream/270676-lean4/topic/mathport.3Awf-refl/near/233865945">said</a>:</p>
<blockquote>
<p>probably just delete the test</p>
</blockquote>
<p>Since we will need to propagate this change to mathlib as well, we ought to find a robust solution.</p>



<a name="233867657"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/mathport%3Awf-refl/near/233867657" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Daniel Selsam <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/mathport.3Awf-refl.html#233867657">(Apr 09 2021 at 18:14)</a>:</h4>
<p>Probably best to allow <code>reflexivity (md := transparency.all)</code></p>



<a name="233922297"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/mathport%3Awf-refl/near/233922297" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/mathport.3Awf-refl.html#233922297">(Apr 10 2021 at 03:40)</a>:</h4>
<p><span class="user-mention silent" data-user-id="230999">Daniel Selsam</span> <a href="#narrow/stream/270676-lean4/topic/mathport.3Awf-refl/near/233866918">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="110049">Mario Carneiro</span> <a href="#narrow/stream/270676-lean4/topic/mathport.3Awf-refl/near/233865945">said</a>:</p>
<blockquote>
<p>probably just delete the test</p>
</blockquote>
<p>Since we will need to propagate this change to mathlib as well, we ought to find a robust solution.</p>
</blockquote>
<p>This presumes that this kind of code is typical for mathlib, and I don't think it is. We do need to propagate the change to mathlib, but we will find out what the fallout is then and it's probably not anything like this fib test</p>



<a name="233922341"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/mathport%3Awf-refl/near/233922341" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/mathport.3Awf-refl.html#233922341">(Apr 10 2021 at 03:41)</a>:</h4>
<p>Generally theorems about well founded definitions are proved by <code>rw</code> or <code>simp</code> with the equation coming out of the wf definition, rather than deep rfl. Or at least that's my hypothesis that needs to be tested on mathlib</p>



<a name="236827285"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/mathport%3Awf-refl/near/236827285" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/mathport.3Awf-refl.html#236827285">(Apr 30 2021 at 12:35)</a>:</h4>
<p>I've tried porting mathlib to this change (<a href="https://github.com/leanprover-community/mathlib/issues/7264">#7264</a>) and it's just really painful.</p>
<ul>
<li><code>dec_trivial</code> breaks if the expressions contains <code>fin</code></li>
<li>Different ways of writing numerals in <code>fin</code> are no longer definitionally equal: <code>(1 : fin 2)</code>, <code>fin.succ (0 : fin 1)</code>, <code>((1 : ℕ) : fin 2)</code>, <code>⟨1, one_lt_two⟩</code> all mean something different.<br>
The <code>fin</code> problem is particularly problematic because they appear in a lot of places, and in types.</li>
</ul>
<p>The reason this breaks is because <code>nat.mod</code> no longer reduces in the kernel.  So my proposal would be to define <code>nat.mod</code> without well-founded recursion (and also <code>nat.div</code> because it's in the same file).  <a href="https://github.com/leanprover-community/lean/issues/570">lean#570</a>  Opinions?</p>



<a name="236827660"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/mathport%3Awf-refl/near/236827660" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/mathport.3Awf-refl.html#236827660">(Apr 30 2021 at 12:39)</a>:</h4>
<p>Seems like a good idea to me. There is an obvious bound on recursion depth, so a definition by recursion on fuel will work fine and will compute better in the kernel. <code>#eval</code> of course replaces the definition so it doesn't matter</p>



<a name="236827789"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/mathport%3Awf-refl/near/236827789" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/mathport.3Awf-refl.html#236827789">(Apr 30 2021 at 12:40)</a>:</h4>
<p>we may also want to introduce <code>acc</code> in type at some point</p>



<a name="236828779"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/mathport%3Awf-refl/near/236828779" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/mathport.3Awf-refl.html#236828779">(Apr 30 2021 at 12:50)</a>:</h4>
<p>In Lean 4, this works anyhow no matter how <code>Nat.mod</code> is defined because <code>Nat.mod</code> is magic in the kernel.</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>