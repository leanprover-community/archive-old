---
layout: archive
title: Zulip Chat Archive
permalink: /stream/270676-lean4/topic/mkSimpAttr.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/index.html">lean4</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/mkSimpAttr.html">mkSimpAttr</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="266189490"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/mkSimpAttr/near/266189490" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Simon Hudon <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/mkSimpAttr.html#266189490">(Dec 27 2021 at 17:26)</a>:</h4>
<p>In Lean 3, we have a meta function to create a customized <code>simp</code> attribute. Does that exist in Lean 4 already?</p>



<a name="266189519"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/mkSimpAttr/near/266189519" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/mkSimpAttr.html#266189519">(Dec 27 2021 at 17:26)</a>:</h4>
<p><code>registerSimpAttr</code></p>



<a name="266189597"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/mkSimpAttr/near/266189597" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Simon Hudon <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/mkSimpAttr.html#266189597">(Dec 27 2021 at 17:28)</a>:</h4>
<p>Thanks!</p>



<a name="266189733"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/mkSimpAttr/near/266189733" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Simon Hudon <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/mkSimpAttr.html#266189733">(Dec 27 2021 at 17:29)</a>:</h4>
<p>Follow-up: I noticed something called preprocess and postprocess with <code>simp</code>. Does that mean that we can create our own pre / postprocessing functions, a bit like <code>reassoc</code> in mathlib / category theory?</p>



<a name="266190031"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/mkSimpAttr/near/266190031" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/mkSimpAttr.html#266190031">(Dec 27 2021 at 17:32)</a>:</h4>
<p><code>rg -i postprocess src</code> doesn't return anything, can you be more specific?</p>



<a name="266190051"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/mkSimpAttr/near/266190051" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/mkSimpAttr.html#266190051">(Dec 27 2021 at 17:33)</a>:</h4>
<p>Big-picture wise nothing has changed.  We still don't have simpprocs.</p>



<a name="266190074"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/mkSimpAttr/near/266190074" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/mkSimpAttr.html#266190074">(Dec 27 2021 at 17:33)</a>:</h4>
<p>You can still write your own simplifiers, with blackjack and simpprocs.</p>



<a name="266190177"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/mkSimpAttr/near/266190177" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Simon Hudon <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/mkSimpAttr.html#266190177">(Dec 27 2021 at 17:34)</a>:</h4>
<p>What are blackjack and simpprocs?</p>



<a name="266190333"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/mkSimpAttr/near/266190333" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/mkSimpAttr.html#266190333">(Dec 27 2021 at 17:36)</a>:</h4>
<p>Blackjack is a form of gambling.  Simpprocs are a feature in the Isabelle simplifier, which allows you to register -- in the same way as simp lemmas -- functions that are executed during simplification.</p>



<a name="266190350"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/mkSimpAttr/near/266190350" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/mkSimpAttr.html#266190350">(Dec 27 2021 at 17:36)</a>:</h4>
<p>The combination just means "with whatever features you want".</p>



<a name="266190390"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/mkSimpAttr/near/266190390" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/mkSimpAttr.html#266190390">(Dec 27 2021 at 17:37)</a>:</h4>
<p>Standard link: <a href="https://github.com/leanprover/lean/wiki/Simplifier-Features">https://github.com/leanprover/lean/wiki/Simplifier-Features</a></p>



<a name="266190546"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/mkSimpAttr/near/266190546" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/mkSimpAttr.html#266190546">(Dec 27 2021 at 17:39)</a>:</h4>
<p>Standard link: <a href="https://en.wikipedia.org/wiki/Blackjack">https://en.wikipedia.org/wiki/Blackjack</a></p>



<a name="266191224"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/mkSimpAttr/near/266191224" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Simon Hudon <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/mkSimpAttr.html#266191224">(Dec 27 2021 at 17:48)</a>:</h4>
<p>Specifically, what I was referring to are <code>↑ ↓</code> in the syntax of <code>simp</code> attributes</p>



<a name="266194391"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/mkSimpAttr/near/266194391" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/mkSimpAttr.html#266194391">(Dec 27 2021 at 18:30)</a>:</h4>
<p>Ah those.  To be honest, today is the first time I've seen them.  They allow you to specify if a simp lemma is applied before recursing into the arguments, or afterwards.  (Default is post, for pre-lemmas you need to be super super careful not to run into confluence issues.)  The pre/post-flag can't be used for anything like <code>reassoc</code>.</p>



<a name="266194792"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/mkSimpAttr/near/266194792" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Simon Hudon <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/mkSimpAttr.html#266194792">(Dec 27 2021 at 18:36)</a>:</h4>
<p><span aria-label="+1" class="emoji emoji-1f44d" role="img" title="+1">:+1:</span></p>



<a name="266195150"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/mkSimpAttr/near/266195150" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Simon Hudon <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/mkSimpAttr.html#266195150">(Dec 27 2021 at 18:42)</a>:</h4>
<p>I'm thinking about how <code>reassoc</code> could be redesigned so that we don't have to mark lemmas as <code>reassoc</code>. What I'm thinking of is that I'd create an additional <code>simp</code> attribute to use with a customized <code>simp</code> tactic. In that cache, I'd put all the <code>simp</code> lemmas but also their <code>reassoc</code> version as well. The reassoc versions would be created when the cache is updated and for the lemmas that you list as arguments to <code>simp</code>. Does that seem like a reasonable design to you?</p>



<a name="266195930"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/mkSimpAttr/near/266195930" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/mkSimpAttr.html#266195930">(Dec 27 2021 at 18:55)</a>:</h4>
<p>I don't think a custom <code>simp</code> tactic is a good idea.  The whole point of <code>reassoc</code> is to automate writing simp lemmas for the default <code>simp</code> tactic, not to add yet another tactic.</p>



<a name="266196056"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/mkSimpAttr/near/266196056" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/mkSimpAttr.html#266196056">(Dec 27 2021 at 18:56)</a>:</h4>
<p>BTW, if you add <code>@[simp]</code> to a lemma like <code>foo : a ↔ b</code>, then Lean 4 will declare a helper lemma <code>foo_aux : a = b</code> and add that to the simp extension instead.  So I think it's perfectly fine to have reassoc add helper lemmas as well.</p>



<a name="266196704"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/mkSimpAttr/near/266196704" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Simon Hudon <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/mkSimpAttr.html#266196704">(Dec 27 2021 at 19:05)</a>:</h4>
<p>The idea is that <code>reassoc</code> is not the only feature that needs to create buddy lemmas. In mathlib, there's also <code>higher_order</code> which creates point-free formulations which are very useful when working with <code>Functor</code>, <code>Foldable</code> and <code>Traversable</code>. I'd like to be able to declare once that <code>reassoc</code> lemmas are useful, point-free lemmas are useful and so on if necessary rather than going around tagging every possible lemma with both attributes. I think with a custom version of <code>simp</code>, you can create a <code>scoped</code> macro and have the same syntax as <code>simp</code> (down to the name) and the whole device can be made invisible</p>



<a name="266196778"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/mkSimpAttr/near/266196778" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Simon Hudon <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/mkSimpAttr.html#266196778">(Dec 27 2021 at 19:06)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110043">Gabriel Ebner</span> <a href="#narrow/stream/270676-lean4/topic/mkSimpAttr/near/266196056">said</a>:</p>
<blockquote>
<p>BTW, if you add <code>@[simp]</code> to a lemma like <code>foo : a ↔ b</code>, then Lean 4 will declare a helper lemma <code>foo_aux : a = b</code> and add that to the simp extension instead.  So I think it's perfectly fine to have reassoc add helper lemmas as well.</p>
</blockquote>
<p>Do you think the same machinery could be highjacked to create our own companion lemmas?</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>