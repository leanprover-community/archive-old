---
layout: archive
title: Zulip Chat Archive
permalink: /stream/270676-lean4/topic/better.20way.20of.20union.20type.3F.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/index.html">lean4</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/better.20way.20of.20union.20type.3F.html">better way of union type?</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="280891743"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/better%20way%20of%20union%20type%3F/near/280891743" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joseph O <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/better.20way.20of.20union.20type.3F.html#280891743">(May 02 2022 at 15:47)</a>:</h4>
<p>Is there a better way of doing this</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">inductive</span> <span class="n">ValT</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">where</span>
  <span class="bp">|</span> <span class="n">int</span> <span class="o">:</span> <span class="n">Int</span> <span class="bp">→</span> <span class="n">ValT</span>
  <span class="bp">|</span> <span class="n">float</span> <span class="o">:</span> <span class="n">Float</span> <span class="bp">→</span> <span class="n">ValT</span>

<span class="kd">inductive</span> <span class="n">RPN</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">where</span>
  <span class="bp">|</span> <span class="n">add</span> <span class="o">:</span> <span class="n">RPN</span> <span class="bp">→</span> <span class="n">RPN</span> <span class="bp">→</span> <span class="n">RPN</span>
  <span class="bp">|</span> <span class="n">mul</span> <span class="o">:</span> <span class="n">RPN</span> <span class="bp">→</span> <span class="n">RPN</span> <span class="bp">→</span> <span class="n">RPN</span>
  <span class="bp">|</span> <span class="n">val</span> <span class="o">:</span> <span class="n">ValT</span> <span class="bp">→</span> <span class="n">RPN</span>
</code></pre></div>
<p>to have <code>val</code> be a constructor that takes in an <code>Int</code> or <code>Float</code> without a second inductive?</p>



<a name="280892172"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/better%20way%20of%20union%20type%3F/near/280892172" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Horatiu Cheval <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/better.20way.20of.20union.20type.3F.html#280892172">(May 02 2022 at 15:50)</a>:</h4>
<p>Your <code>ValT</code> is essentially a sum type, so it's the same as</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">inductive</span> <span class="n">RPN</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">where</span>
  <span class="bp">|</span> <span class="n">add</span> <span class="o">:</span> <span class="n">RPN</span> <span class="bp">→</span> <span class="n">RPN</span> <span class="bp">→</span> <span class="n">RPN</span>
  <span class="bp">|</span> <span class="n">mul</span> <span class="o">:</span> <span class="n">RPN</span> <span class="bp">→</span> <span class="n">RPN</span> <span class="bp">→</span> <span class="n">RPN</span>
  <span class="bp">|</span> <span class="n">val</span> <span class="o">:</span> <span class="n">Int</span> <span class="bp">⊕</span> <span class="n">Float</span> <span class="bp">→</span> <span class="n">RPN</span>
</code></pre></div>



<a name="280892508"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/better%20way%20of%20union%20type%3F/near/280892508" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joseph O <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/better.20way.20of.20union.20type.3F.html#280892508">(May 02 2022 at 15:53)</a>:</h4>
<p>Thanks</p>



<a name="280892510"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/better%20way%20of%20union%20type%3F/near/280892510" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Leonardo de Moura <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/better.20way.20of.20union.20type.3F.html#280892510">(May 02 2022 at 15:53)</a>:</h4>
<p>Yes, <span class="user-mention" data-user-id="329243">@Horatiu Cheval</span> is right. <br>
Note that, <code>Int ⊕ Float</code> is a notation for <code>Sum Int Float</code>. <br>
That being said, I often prefer the version using <code>ValT</code>, the constructor names and type names often make the code easier to maintain.</p>



<a name="280892562"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/better%20way%20of%20union%20type%3F/near/280892562" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joseph O <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/better.20way.20of.20union.20type.3F.html#280892562">(May 02 2022 at 15:53)</a>:</h4>
<p>You are probably right</p>



<a name="280892731"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/better%20way%20of%20union%20type%3F/near/280892731" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joseph O <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/better.20way.20of.20union.20type.3F.html#280892731">(May 02 2022 at 15:54)</a>:</h4>
<p>I also have a small metaprogramming error. I was following the <code>Arith</code> tutorial, and this is my code so far,</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">inductive</span> <span class="n">ValT</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">where</span>
  <span class="bp">|</span> <span class="n">int</span> <span class="o">:</span> <span class="n">Int</span> <span class="bp">→</span> <span class="n">ValT</span>
  <span class="bp">|</span> <span class="n">float</span> <span class="o">:</span> <span class="n">Float</span> <span class="bp">→</span> <span class="n">ValT</span>

<span class="kd">inductive</span> <span class="n">RPN</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">where</span>
  <span class="bp">|</span> <span class="n">add</span> <span class="o">:</span> <span class="n">RPN</span> <span class="bp">→</span> <span class="n">RPN</span> <span class="bp">→</span> <span class="n">RPN</span>
  <span class="bp">|</span> <span class="n">mul</span> <span class="o">:</span> <span class="n">RPN</span> <span class="bp">→</span> <span class="n">RPN</span> <span class="bp">→</span> <span class="n">RPN</span>
  <span class="bp">|</span> <span class="n">val</span> <span class="o">:</span> <span class="n">ValT</span> <span class="bp">→</span> <span class="n">RPN</span>

<span class="n">declare_syntax_cat</span> <span class="n">rpn</span>
<span class="n">syntax</span> <span class="n">num</span> <span class="o">:</span> <span class="n">rpn</span>
<span class="n">syntax</span> <span class="n">rpn</span> <span class="n">rpn</span> <span class="s2">"+"</span> <span class="o">:</span> <span class="n">rpn</span>
<span class="n">syntax</span> <span class="n">rpn</span> <span class="n">rpn</span> <span class="s2">"*"</span> <span class="o">:</span> <span class="n">rpn</span>

<span class="n">syntax</span> <span class="s2">"`[rpn| "</span> <span class="n">rpn</span> <span class="s2">"]"</span> <span class="o">:</span> <span class="n">term</span>

<span class="n">macro_rules</span>
  <span class="bp">|</span> <span class="bp">`</span><span class="o">(</span><span class="bp">`</span><span class="o">[</span><span class="n">rpn</span><span class="bp">|</span> <span class="bp">$</span><span class="n">num</span><span class="o">:</span><span class="n">numLit</span> <span class="o">])</span> <span class="bp">=&gt;</span> <span class="bp">`</span><span class="o">(</span><span class="n">RPN.val</span> <span class="o">(</span><span class="n">ValT.int</span> <span class="bp">$</span><span class="n">num</span><span class="o">))</span>
</code></pre></div>
<p>(im making my own variation)<br>
but in the first tule of the <code>macro_rules</code>, im getting this error:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">expected</span> <span class="bp">'</span><span class="n">num'</span><span class="o">,</span> <span class="bp">'</span><span class="n">rpn'</span> <span class="n">or</span> <span class="n">numeral</span>
</code></pre></div>



<a name="280892737"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/better%20way%20of%20union%20type%3F/near/280892737" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joseph O <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/better.20way.20of.20union.20type.3F.html#280892737">(May 02 2022 at 15:54)</a>:</h4>
<p>Any ideas?</p>



<a name="280892759"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/better%20way%20of%20union%20type%3F/near/280892759" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Henrik Böving <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/better.20way.20of.20union.20type.3F.html#280892759">(May 02 2022 at 15:54)</a>:</h4>
<p><span class="user-mention silent" data-user-id="112857">Leonardo de Moura</span> <a href="#narrow/stream/270676-lean4/topic/better.20way.20of.20union.20type.3F/near/280892510">said</a>:</p>
<blockquote>
<p>Yes, <span class="user-mention silent" data-user-id="329243">Horatiu Cheval</span> is right. <br>
Note that, <code>Int ⊕ Float</code> is a notation for <code>Sum Int Float</code>. <br>
That being said, I often prefer the version using <code>ValT</code>, the constructor names and type names often make the code easier to maintain.</p>
</blockquote>
<p>In what situations would you prefer <code>Sum</code> over custom <code>inductive</code>s?</p>



<a name="280892817"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/better%20way%20of%20union%20type%3F/near/280892817" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Henrik Böving <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/better.20way.20of.20union.20type.3F.html#280892817">(May 02 2022 at 15:55)</a>:</h4>
<p><span class="user-mention silent" data-user-id="467926">Joseph O</span> <a href="#narrow/stream/270676-lean4/topic/better.20way.20of.20union.20type.3F/near/280892737">said</a>:</p>
<blockquote>
<p>Any ideas?</p>
</blockquote>
<p>the <code>numLit</code> parser is now also called <code>num</code></p>



<a name="280892834"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/better%20way%20of%20union%20type%3F/near/280892834" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joseph O <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/better.20way.20of.20union.20type.3F.html#280892834">(May 02 2022 at 15:55)</a>:</h4>
<p>oh</p>



<a name="280892862"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/better%20way%20of%20union%20type%3F/near/280892862" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joseph O <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/better.20way.20of.20union.20type.3F.html#280892862">(May 02 2022 at 15:55)</a>:</h4>
<p>Then the tutorial needs to be updated</p>



<a name="280893004"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/better%20way%20of%20union%20type%3F/near/280893004" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joseph O <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/better.20way.20of.20union.20type.3F.html#280893004">(May 02 2022 at 15:56)</a>:</h4>
<p>Using <code>Sum</code>, would this be valid?</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">inductive</span> <span class="n">RPN</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">where</span>
  <span class="bp">|</span> <span class="n">add</span> <span class="o">:</span> <span class="n">RPN</span> <span class="bp">→</span> <span class="n">RPN</span> <span class="bp">→</span> <span class="n">RPN</span>
  <span class="bp">|</span> <span class="n">mul</span> <span class="o">:</span> <span class="n">RPN</span> <span class="bp">→</span> <span class="n">RPN</span> <span class="bp">→</span> <span class="n">RPN</span>
  <span class="bp">|</span> <span class="n">val</span> <span class="o">:</span> <span class="n">Int</span> <span class="bp">⊕</span> <span class="n">Float</span> <span class="bp">→</span> <span class="n">RPN</span>

<span class="n">declare_syntax_cat</span> <span class="n">rpn</span>
<span class="n">syntax</span> <span class="n">num</span> <span class="o">:</span> <span class="n">rpn</span>
<span class="n">syntax</span> <span class="n">rpn</span> <span class="n">rpn</span> <span class="s2">"+"</span> <span class="o">:</span> <span class="n">rpn</span>
<span class="n">syntax</span> <span class="n">rpn</span> <span class="n">rpn</span> <span class="s2">"*"</span> <span class="o">:</span> <span class="n">rpn</span>

<span class="n">syntax</span> <span class="s2">"`[rpn| "</span> <span class="n">rpn</span> <span class="s2">"]"</span> <span class="o">:</span> <span class="n">term</span>

<span class="n">macro_rules</span>
  <span class="bp">|</span> <span class="bp">`</span><span class="o">(</span><span class="bp">`</span><span class="o">[</span><span class="n">rpn</span><span class="bp">|</span> <span class="bp">$</span><span class="n">num</span><span class="o">:</span><span class="n">num</span> <span class="o">])</span> <span class="bp">=&gt;</span> <span class="bp">`</span><span class="o">(</span><span class="n">RPN.val</span> <span class="bp">$</span><span class="n">num</span><span class="o">)</span>
</code></pre></div>



<a name="280894588"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/better%20way%20of%20union%20type%3F/near/280894588" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Leonardo de Moura <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/better.20way.20of.20union.20type.3F.html#280894588">(May 02 2022 at 16:07)</a>:</h4>
<p><span class="user-mention silent" data-user-id="395550">Henrik Böving</span> <a href="#narrow/stream/270676-lean4/topic/better.20way.20of.20union.20type.3F/near/280892759">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="112857">Leonardo de Moura</span> <a href="#narrow/stream/270676-lean4/topic/better.20way.20of.20union.20type.3F/near/280892510">said</a>:</p>
<blockquote>
<p>Yes, <span class="user-mention silent" data-user-id="329243">Horatiu Cheval</span> is right. <br>
Note that, <code>Int ⊕ Float</code> is a notation for <code>Sum Int Float</code>. <br>
That being said, I often prefer the version using <code>ValT</code>, the constructor names and type names often make the code easier to maintain.</p>
</blockquote>
<p>In what situations would you prefer <code>Sum</code> over custom <code>inductive</code>s?</p>
</blockquote>
<p>I rarely use <code>Sum</code>. I just checked the Lean 4 codebase, and we used it in very few places. One problem is that if we have more than two cases,  the patterns are inconvenient to write and the code looks cryptic. Example. </p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">def</span> <span class="n">f</span> <span class="o">(</span><span class="n">s</span> <span class="o">:</span> <span class="n">Nat</span> <span class="bp">⊕</span> <span class="n">Int</span> <span class="bp">⊕</span> <span class="n">Bool</span><span class="o">)</span> <span class="o">:</span> <span class="n">String</span> <span class="o">:=</span>
  <span class="k">match</span> <span class="n">s</span> <span class="k">with</span>
  <span class="bp">|</span> <span class="bp">.</span><span class="n">inl</span> <span class="n">_</span>        <span class="bp">=&gt;</span> <span class="s2">"nat"</span>
  <span class="bp">|</span> <span class="bp">.</span><span class="n">inr</span> <span class="o">(</span><span class="bp">.</span><span class="n">inl</span> <span class="n">_</span><span class="o">)</span> <span class="bp">=&gt;</span> <span class="s2">"int"</span>
  <span class="bp">|</span> <span class="bp">.</span><span class="n">inr</span> <span class="o">(</span><span class="bp">.</span><span class="n">inr</span> <span class="n">_</span><span class="o">)</span> <span class="bp">=&gt;</span> <span class="s2">"bool"</span>
</code></pre></div>
<p>I think better notation could address this issue, and the decision would be similar to the <code>Prod</code> vs. custom structure. I often regret using <code>Prod</code> for bigger tuples instead of a structure when maintaining the code later :)<br>
One place where we found <code>Sum</code> (actually <code>PSum</code>) very useful is for auto-generated code. If you print mutual definitions where we show termination using well-founded recursion, you will find the <code>PSum</code>s we use in our encoding.</p>



<a name="280894924"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/better%20way%20of%20union%20type%3F/near/280894924" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joseph O <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/better.20way.20of.20union.20type.3F.html#280894924">(May 02 2022 at 16:10)</a>:</h4>
<p>for some reason when i uncomment the commented line here</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">declare_syntax_cat</span> <span class="n">rpn</span>
<span class="n">syntax</span> <span class="n">num</span> <span class="o">:</span> <span class="n">rpn</span>
<span class="n">syntax</span> <span class="n">rpn</span> <span class="n">rpn</span> <span class="s2">"+"</span> <span class="o">:</span> <span class="n">rpn</span>
<span class="n">syntax</span> <span class="n">rpn</span> <span class="n">rpn</span> <span class="s2">"*"</span> <span class="o">:</span> <span class="n">rpn</span>
<span class="c1">-- syntax rpn+ : rpn</span>
</code></pre></div>
<p>it crashes the server</p>



<a name="280895586"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/better%20way%20of%20union%20type%3F/near/280895586" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joseph O <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/better.20way.20of.20union.20type.3F.html#280895586">(May 02 2022 at 16:12)</a>:</h4>
<p>I want to handle things like <code>%rpn( 1 2 3 4 )</code></p>



<a name="280895805"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/better%20way%20of%20union%20type%3F/near/280895805" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Leonardo de Moura <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/better.20way.20of.20union.20type.3F.html#280895805">(May 02 2022 at 16:13)</a>:</h4>
<p><span class="user-mention silent" data-user-id="467926">Joseph O</span> <a href="#narrow/stream/270676-lean4/topic/better.20way.20of.20union.20type.3F/near/280894924">said</a>:</p>
<blockquote>
<p>for some reason when i uncomment the commented line here</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">declare_syntax_cat</span> <span class="n">rpn</span>
<span class="n">syntax</span> <span class="n">num</span> <span class="o">:</span> <span class="n">rpn</span>
<span class="n">syntax</span> <span class="n">rpn</span> <span class="n">rpn</span> <span class="s2">"+"</span> <span class="o">:</span> <span class="n">rpn</span>
<span class="n">syntax</span> <span class="n">rpn</span> <span class="n">rpn</span> <span class="s2">"*"</span> <span class="o">:</span> <span class="n">rpn</span>
<span class="c1">-- syntax rpn+ : rpn</span>
</code></pre></div>
<p>it crashes the server</p>
</blockquote>
<p>Could you please try with the latest nightly build? I didn't manage to reproduce the crash.</p>



<a name="280895985"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/better%20way%20of%20union%20type%3F/near/280895985" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joseph O <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/better.20way.20of.20union.20type.3F.html#280895985">(May 02 2022 at 16:15)</a>:</h4>
<p>I am using <code>leanprover/lean4:nightly-2022-04-28</code></p>



<a name="280896021"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/better%20way%20of%20union%20type%3F/near/280896021" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joseph O <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/better.20way.20of.20union.20type.3F.html#280896021">(May 02 2022 at 16:15)</a>:</h4>
<p><a href="/user_uploads/3121/_OM1aU2KnN3eoPt-2-pWB_Zk/image.png">image.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/3121/_OM1aU2KnN3eoPt-2-pWB_Zk/image.png" title="image.png"><img src="/user_uploads/3121/_OM1aU2KnN3eoPt-2-pWB_Zk/image.png"></a></div>



<a name="280896116"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/better%20way%20of%20union%20type%3F/near/280896116" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Leonardo de Moura <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/better.20way.20of.20union.20type.3F.html#280896116">(May 02 2022 at 16:16)</a>:</h4>
<p>Ok, your <a href="https://leanprover-community.github.io/mwe.html">#mwe</a> is not just</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">declare_syntax_cat</span> <span class="n">rpn</span>
<span class="n">syntax</span> <span class="n">num</span> <span class="o">:</span> <span class="n">rpn</span>
<span class="n">syntax</span> <span class="n">rpn</span> <span class="n">rpn</span> <span class="s2">"+"</span> <span class="o">:</span> <span class="n">rpn</span>
<span class="n">syntax</span> <span class="n">rpn</span> <span class="n">rpn</span> <span class="s2">"*"</span> <span class="o">:</span> <span class="n">rpn</span>
<span class="n">syntax</span> <span class="n">rpn</span><span class="bp">+</span> <span class="o">:</span> <span class="n">rpn</span>
</code></pre></div>



<a name="280896156"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/better%20way%20of%20union%20type%3F/near/280896156" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joseph O <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/better.20way.20of.20union.20type.3F.html#280896156">(May 02 2022 at 16:16)</a>:</h4>
<p>Ok here is a MWE:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">inductive</span> <span class="n">RPN</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">where</span>
  <span class="bp">|</span> <span class="n">add</span> <span class="o">:</span> <span class="n">RPN</span> <span class="bp">→</span> <span class="n">RPN</span> <span class="bp">→</span> <span class="n">RPN</span>
  <span class="bp">|</span> <span class="n">mul</span> <span class="o">:</span> <span class="n">RPN</span> <span class="bp">→</span> <span class="n">RPN</span> <span class="bp">→</span> <span class="n">RPN</span>
  <span class="bp">|</span> <span class="n">val</span> <span class="o">:</span> <span class="n">Int</span> <span class="bp">→</span> <span class="n">RPN</span>
  <span class="n">deriving</span> <span class="n">Repr</span>

<span class="n">declare_syntax_cat</span> <span class="n">rpn</span>
<span class="n">syntax</span> <span class="n">num</span> <span class="o">:</span> <span class="n">rpn</span>
<span class="n">syntax</span> <span class="n">rpn</span> <span class="n">rpn</span> <span class="s2">"+"</span> <span class="o">:</span> <span class="n">rpn</span>
<span class="n">syntax</span> <span class="n">rpn</span> <span class="n">rpn</span> <span class="s2">"*"</span> <span class="o">:</span> <span class="n">rpn</span>
<span class="n">syntax</span> <span class="n">rpn</span><span class="bp">+</span> <span class="o">:</span> <span class="n">rpn</span>

<span class="n">syntax</span> <span class="s2">"%rpn( "</span> <span class="n">rpn</span> <span class="s2">")"</span> <span class="o">:</span> <span class="n">term</span>

<span class="n">macro_rules</span>
  <span class="bp">|</span> <span class="bp">`</span><span class="o">(</span><span class="bp">%</span><span class="n">rpn</span><span class="o">(</span> <span class="bp">$</span><span class="n">num</span><span class="o">:</span><span class="n">num</span> <span class="o">))</span> <span class="bp">=&gt;</span> <span class="bp">`</span><span class="o">(</span><span class="n">RPN.val</span> <span class="bp">$</span><span class="n">num</span><span class="o">)</span>
  <span class="bp">|</span> <span class="bp">`</span><span class="o">(</span><span class="bp">%</span><span class="n">rpn</span><span class="o">(</span> <span class="bp">$</span><span class="n">x</span><span class="o">:</span><span class="n">rpn</span> <span class="bp">$</span><span class="n">y</span><span class="o">:</span><span class="n">rpn</span> <span class="bp">+</span><span class="o">))</span> <span class="bp">=&gt;</span> <span class="bp">`</span><span class="o">(</span><span class="n">RPN.add</span> <span class="bp">%</span><span class="n">rpn</span><span class="o">(</span> <span class="bp">$</span><span class="n">x</span> <span class="o">)</span> <span class="bp">%</span><span class="n">rpn</span><span class="o">(</span> <span class="bp">$</span><span class="n">y</span> <span class="o">))</span>
  <span class="bp">|</span> <span class="bp">`</span><span class="o">(</span><span class="bp">%</span><span class="n">rpn</span><span class="o">(</span> <span class="bp">$</span><span class="n">x</span><span class="o">:</span><span class="n">rpn</span> <span class="bp">$</span><span class="n">y</span><span class="o">:</span><span class="n">rpn</span> <span class="bp">*</span><span class="o">))</span> <span class="bp">=&gt;</span> <span class="bp">`</span><span class="o">(</span><span class="n">RPN.mul</span> <span class="bp">%</span><span class="n">rpn</span><span class="o">(</span> <span class="bp">$</span><span class="n">x</span> <span class="o">)</span> <span class="bp">%</span><span class="n">rpn</span><span class="o">(</span> <span class="bp">$</span><span class="n">y</span> <span class="o">))</span>
  <span class="bp">|</span> <span class="bp">`</span><span class="o">(</span><span class="bp">%</span><span class="n">rpn</span><span class="o">(</span> <span class="bp">$</span><span class="n">x</span><span class="o">:</span><span class="n">rpn</span> <span class="o">))</span> <span class="bp">=&gt;</span> <span class="bp">`</span><span class="o">(</span><span class="bp">%</span><span class="n">rpn</span><span class="o">(</span> <span class="bp">$</span><span class="n">x</span> <span class="o">))</span>

<span class="k">#check</span> <span class="bp">%</span><span class="n">rpn</span><span class="o">(</span><span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span><span class="o">)</span>
</code></pre></div>



<a name="280897658"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/better%20way%20of%20union%20type%3F/near/280897658" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Leonardo de Moura <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/better.20way.20of.20union.20type.3F.html#280897658">(May 02 2022 at 16:29)</a>:</h4>
<p>It is a stack overflow when parsing <code>#check %rpn(1 2 3 4 5)</code>. The problem is the command <code>syntax rpn+ : rpn</code>. We should produce an error message in this case since this kind of parser will always produce a stack overflow.</p>



<a name="280901704"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/better%20way%20of%20union%20type%3F/near/280901704" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/better.20way.20of.20union.20type.3F.html#280901704">(May 02 2022 at 16:59)</a>:</h4>
<p><span class="user-mention" data-user-id="467926">@Joseph O</span> I faced this same issue and Mario helped me with <a href="https://github.com/arthurpaulino/FxyLang/blob/afcd0db77d320438d625bac9cb8cf55413c47e52/FxyLang/Implementation/Syntax.lean#L35">this solution</a></p>
<p>The idea is to create a syntax category specifically for sequences of syntax items of the same structure</p>



<a name="280901951"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/better%20way%20of%20union%20type%3F/near/280901951" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Leonardo de Moura <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/better.20way.20of.20union.20type.3F.html#280901951">(May 02 2022 at 17:01)</a>:</h4>
<p>There are many ways to encode this kind of example in Lean. Here is an example:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">inductive</span> <span class="n">Atom</span> <span class="n">where</span>
  <span class="bp">|</span> <span class="n">val</span> <span class="o">(</span><span class="n">v</span> <span class="o">:</span> <span class="n">Int</span><span class="o">)</span>
  <span class="bp">|</span> <span class="n">add</span>
  <span class="bp">|</span> <span class="n">mul</span>
  <span class="n">deriving</span> <span class="n">Repr</span>

<span class="kd">def</span> <span class="n">RPN</span> <span class="o">:=</span> <span class="n">List</span> <span class="n">Atom</span>

<span class="kd">def</span> <span class="n">eval</span> <span class="o">:</span> <span class="n">RPN</span> <span class="bp">→</span> <span class="o">(</span><span class="n">vs</span> <span class="o">:</span> <span class="n">List</span> <span class="n">Int</span> <span class="o">:=</span> <span class="o">[])</span> <span class="bp">→</span> <span class="n">Except</span> <span class="n">String</span> <span class="o">(</span><span class="n">List</span> <span class="n">Int</span><span class="o">)</span>
  <span class="bp">|</span> <span class="o">[],</span>          <span class="n">vs</span>             <span class="bp">=&gt;</span> <span class="bp">.</span><span class="n">ok</span> <span class="n">vs</span>
  <span class="bp">|</span> <span class="bp">.</span><span class="n">val</span>         <span class="n">v</span> <span class="o">::</span> <span class="n">rpn</span><span class="o">,</span> <span class="n">vs</span>   <span class="bp">=&gt;</span> <span class="n">eval</span> <span class="n">rpn</span> <span class="o">(</span><span class="n">v</span> <span class="o">::</span> <span class="n">vs</span><span class="o">)</span>
  <span class="bp">|</span> <span class="bp">.</span><span class="n">add</span> <span class="o">::</span> <span class="n">rpn</span><span class="o">,</span> <span class="n">v₁</span> <span class="o">::</span> <span class="n">v₂</span> <span class="o">::</span> <span class="n">vs</span> <span class="bp">=&gt;</span> <span class="n">eval</span> <span class="n">rpn</span> <span class="o">((</span><span class="n">v₁</span><span class="bp">+</span><span class="n">v₂</span><span class="o">)::</span><span class="n">vs</span><span class="o">)</span>
  <span class="bp">|</span> <span class="bp">.</span><span class="n">mul</span> <span class="o">::</span> <span class="n">rpn</span><span class="o">,</span> <span class="n">v₁</span> <span class="o">::</span> <span class="n">v₂</span> <span class="o">::</span> <span class="n">vs</span> <span class="bp">=&gt;</span> <span class="n">eval</span> <span class="n">rpn</span> <span class="o">((</span><span class="n">v₁</span><span class="bp">*</span><span class="n">v₂</span><span class="o">)::</span><span class="n">vs</span><span class="o">)</span>
  <span class="bp">|</span> <span class="n">_</span><span class="o">,</span>           <span class="n">_</span>              <span class="bp">=&gt;</span> <span class="bp">.</span><span class="n">error</span> <span class="s2">"insufficient args"</span>

<span class="n">declare_syntax_cat</span> <span class="n">rpn</span>
<span class="n">syntax</span> <span class="n">num</span> <span class="o">:</span> <span class="n">rpn</span>
<span class="n">syntax</span> <span class="n">rpn</span> <span class="n">num</span> <span class="s2">"+"</span> <span class="o">:</span> <span class="n">rpn</span>
<span class="n">syntax</span> <span class="n">rpn</span> <span class="n">num</span> <span class="s2">"*"</span> <span class="o">:</span> <span class="n">rpn</span>
<span class="n">syntax</span> <span class="n">rpn</span> <span class="n">num</span> <span class="o">:</span> <span class="n">rpn</span>

<span class="n">syntax</span> <span class="s2">"%rpn( "</span> <span class="n">rpn</span> <span class="s2">")"</span> <span class="o">:</span> <span class="n">term</span>

<span class="n">macro_rules</span>
  <span class="bp">|</span> <span class="bp">`</span><span class="o">(</span><span class="bp">%</span><span class="n">rpn</span><span class="o">(</span> <span class="bp">$</span><span class="n">num</span><span class="o">:</span><span class="n">num</span> <span class="o">))</span>       <span class="bp">=&gt;</span> <span class="bp">`</span><span class="o">([</span><span class="n">Atom.val</span> <span class="bp">$</span><span class="n">num</span><span class="o">])</span>
  <span class="bp">|</span> <span class="bp">`</span><span class="o">(</span><span class="bp">%</span><span class="n">rpn</span><span class="o">(</span> <span class="bp">$</span><span class="n">x</span><span class="o">:</span><span class="n">rpn</span> <span class="bp">$</span><span class="n">y</span><span class="o">:</span><span class="n">num</span> <span class="bp">+</span><span class="o">))</span> <span class="bp">=&gt;</span> <span class="bp">`</span><span class="o">(</span><span class="bp">%</span><span class="n">rpn</span><span class="o">(</span> <span class="bp">$</span><span class="n">x</span><span class="o">:</span><span class="n">rpn</span> <span class="o">)</span> <span class="bp">++</span> <span class="o">[</span><span class="n">Atom.val</span> <span class="bp">$</span><span class="n">y</span><span class="o">:</span><span class="n">num</span><span class="o">,</span> <span class="n">Atom.add</span><span class="o">])</span>
  <span class="bp">|</span> <span class="bp">`</span><span class="o">(</span><span class="bp">%</span><span class="n">rpn</span><span class="o">(</span> <span class="bp">$</span><span class="n">x</span><span class="o">:</span><span class="n">rpn</span> <span class="bp">$</span><span class="n">y</span><span class="o">:</span><span class="n">num</span> <span class="bp">*</span><span class="o">))</span> <span class="bp">=&gt;</span> <span class="bp">`</span><span class="o">(</span><span class="bp">%</span><span class="n">rpn</span><span class="o">(</span> <span class="bp">$</span><span class="n">x</span><span class="o">:</span><span class="n">rpn</span> <span class="o">)</span> <span class="bp">++</span> <span class="o">[</span><span class="n">Atom.val</span> <span class="bp">$</span><span class="n">y</span><span class="o">:</span><span class="n">num</span><span class="o">,</span> <span class="n">Atom.mul</span><span class="o">])</span>
  <span class="bp">|</span> <span class="bp">`</span><span class="o">(</span><span class="bp">%</span><span class="n">rpn</span><span class="o">(</span> <span class="bp">$</span><span class="n">x</span><span class="o">:</span><span class="n">rpn</span> <span class="bp">$</span><span class="n">y</span><span class="o">:</span><span class="n">num</span><span class="o">))</span>   <span class="bp">=&gt;</span> <span class="bp">`</span><span class="o">(</span><span class="bp">%</span><span class="n">rpn</span><span class="o">(</span><span class="bp">$</span><span class="n">x</span><span class="o">:</span><span class="n">rpn</span><span class="o">)</span> <span class="bp">++</span> <span class="o">[</span><span class="n">Atom.val</span> <span class="bp">$</span><span class="n">y</span><span class="o">:</span><span class="n">num</span><span class="o">])</span>

<span class="k">#eval</span> <span class="n">eval</span> <span class="bp">%</span><span class="n">rpn</span><span class="o">(</span><span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span><span class="o">)</span>

<span class="k">#eval</span> <span class="n">eval</span> <span class="bp">%</span><span class="n">rpn</span><span class="o">(</span><span class="mi">1</span> <span class="mi">1</span> <span class="bp">+</span> <span class="mi">3</span> <span class="bp">*</span> <span class="mi">5</span> <span class="bp">+</span><span class="o">)</span>
</code></pre></div>



<a name="280902221"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/better%20way%20of%20union%20type%3F/near/280902221" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joseph O <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/better.20way.20of.20union.20type.3F.html#280902221">(May 02 2022 at 17:03)</a>:</h4>
<p>Wow thanks</p>



<a name="281016837"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/better%20way%20of%20union%20type%3F/near/281016837" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/better.20way.20of.20union.20type.3F.html#281016837">(May 03 2022 at 14:00)</a>:</h4>
<p><span class="user-mention silent" data-user-id="467926">Joseph O</span> <a href="#narrow/stream/270676-lean4/topic/better.20way.20of.20union.20type.3F/near/280892862">said</a>:</p>
<blockquote>
<p>Then the tutorial needs to be updated</p>
</blockquote>
<p><span class="user-mention" data-user-id="467926">@Joseph O</span>  Go ahead and make a brief pull request!</p>



<a name="281038034"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/better%20way%20of%20union%20type%3F/near/281038034" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joseph O <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/better.20way.20of.20union.20type.3F.html#281038034">(May 03 2022 at 16:18)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110038">Kevin Buzzard</span> <a href="#narrow/stream/270676-lean4/topic/better.20way.20of.20union.20type.3F/near/281016837">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="467926">Joseph O</span> <a href="#narrow/stream/270676-lean4/topic/better.20way.20of.20union.20type.3F/near/280892862">said</a>:</p>
<blockquote>
<p>Then the tutorial needs to be updated</p>
</blockquote>
<p><span class="user-mention silent" data-user-id="467926">Joseph O</span>  Go ahead and make a brief pull request!</p>
</blockquote>
<p>Done :)</p>



<a name="281038555"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/better%20way%20of%20union%20type%3F/near/281038555" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joseph O <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/better.20way.20of.20union.20type.3F.html#281038555">(May 03 2022 at 16:22)</a>:</h4>
<p>By the way, <span class="user-mention" data-user-id="112857">@Leonardo de Moura</span> I added a small thing to the syntax to embed terms, </p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">declare_syntax_cat</span> <span class="n">rpn</span>
<span class="n">syntax</span> <span class="n">num</span> <span class="o">:</span> <span class="n">rpn</span>
<span class="n">syntax</span> <span class="n">rpn</span> <span class="n">num</span> <span class="s2">"+"</span> <span class="o">:</span> <span class="n">rpn</span>
<span class="n">syntax</span> <span class="n">rpn</span> <span class="n">num</span> <span class="s2">"*"</span> <span class="o">:</span> <span class="n">rpn</span>
<span class="n">syntax</span> <span class="n">rpn</span> <span class="n">num</span> <span class="o">:</span> <span class="n">rpn</span>
<span class="n">syntax</span> <span class="s2">"["</span> <span class="n">term</span> <span class="s2">"]"</span> <span class="o">:</span> <span class="n">rpn</span>

<span class="n">syntax</span> <span class="s2">"%rpn( "</span> <span class="n">rpn</span> <span class="s2">")"</span> <span class="o">:</span> <span class="n">term</span>

<span class="n">macro_rules</span>
  <span class="bp">|</span> <span class="bp">`</span><span class="o">(</span><span class="bp">%</span><span class="n">rpn</span><span class="o">(</span> <span class="bp">$</span><span class="n">num</span><span class="o">:</span><span class="n">num</span> <span class="o">))</span>       <span class="bp">=&gt;</span> <span class="bp">`</span><span class="o">([</span><span class="n">Atom.val</span> <span class="bp">$</span><span class="n">num</span><span class="o">])</span>
  <span class="bp">|</span> <span class="bp">`</span><span class="o">(</span><span class="bp">%</span><span class="n">rpn</span><span class="o">(</span> <span class="o">[</span> <span class="bp">$</span><span class="n">e</span><span class="o">:</span><span class="n">term</span> <span class="o">]</span> <span class="o">))</span>    <span class="bp">=&gt;</span> <span class="bp">`</span><span class="o">([</span><span class="n">e</span><span class="o">])</span>
  <span class="bp">|</span> <span class="bp">`</span><span class="o">(</span><span class="bp">%</span><span class="n">rpn</span><span class="o">(</span> <span class="bp">$</span><span class="n">x</span><span class="o">:</span><span class="n">rpn</span> <span class="bp">$</span><span class="n">y</span><span class="o">:</span><span class="n">num</span> <span class="bp">+</span><span class="o">))</span> <span class="bp">=&gt;</span> <span class="bp">`</span><span class="o">(</span><span class="bp">%</span><span class="n">rpn</span><span class="o">(</span> <span class="bp">$</span><span class="n">x</span><span class="o">:</span><span class="n">rpn</span> <span class="o">)</span> <span class="bp">++</span> <span class="o">[</span><span class="n">Atom.val</span> <span class="bp">$</span><span class="n">y</span><span class="o">:</span><span class="n">num</span><span class="o">,</span> <span class="n">Atom.add</span><span class="o">])</span>
  <span class="bp">|</span> <span class="bp">`</span><span class="o">(</span><span class="bp">%</span><span class="n">rpn</span><span class="o">(</span> <span class="bp">$</span><span class="n">x</span><span class="o">:</span><span class="n">rpn</span> <span class="bp">$</span><span class="n">y</span><span class="o">:</span><span class="n">num</span> <span class="bp">*</span><span class="o">))</span> <span class="bp">=&gt;</span> <span class="bp">`</span><span class="o">(</span><span class="bp">%</span><span class="n">rpn</span><span class="o">(</span> <span class="bp">$</span><span class="n">x</span><span class="o">:</span><span class="n">rpn</span> <span class="o">)</span> <span class="bp">++</span> <span class="o">[</span><span class="n">Atom.val</span> <span class="bp">$</span><span class="n">y</span><span class="o">:</span><span class="n">num</span><span class="o">,</span> <span class="n">Atom.mul</span><span class="o">])</span>
  <span class="bp">|</span> <span class="bp">`</span><span class="o">(</span><span class="bp">%</span><span class="n">rpn</span><span class="o">(</span> <span class="bp">$</span><span class="n">x</span><span class="o">:</span><span class="n">rpn</span> <span class="bp">$</span><span class="n">y</span><span class="o">:</span><span class="n">num</span><span class="o">))</span>   <span class="bp">=&gt;</span> <span class="bp">`</span><span class="o">(</span><span class="bp">%</span><span class="n">rpn</span><span class="o">(</span><span class="bp">$</span><span class="n">x</span><span class="o">:</span><span class="n">rpn</span><span class="o">)</span> <span class="bp">++</span> <span class="o">[</span><span class="n">Atom.val</span> <span class="bp">$</span><span class="n">y</span><span class="o">:</span><span class="n">num</span><span class="o">])</span>
</code></pre></div>
<p>yet </p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">def</span> <span class="n">a</span> <span class="o">:=</span> <span class="mi">1</span>
<span class="k">#eval</span> <span class="n">eval</span> <span class="bp">%</span><span class="n">rpn</span><span class="o">([</span><span class="n">a</span><span class="o">]</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span><span class="o">)</span>
</code></pre></div>
<p>gives the error</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">unknown</span> <span class="n">identifier</span> <span class="bp">'</span><span class="n">e</span><span class="bp">✝'</span>

<span class="n">cannot</span> <span class="n">evaluate</span> <span class="n">code</span> <span class="n">because</span> <span class="bp">'</span><span class="n">_eval._lambda_1'</span> <span class="n">uses</span> <span class="bp">'</span><span class="gr">sorry</span><span class="bp">'</span> <span class="n">and</span><span class="bp">/</span><span class="n">or</span> <span class="n">contains</span> <span class="n">errors</span>
</code></pre></div>
<p>Why is this happening?</p>



<a name="281040135"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/better%20way%20of%20union%20type%3F/near/281040135" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/better.20way.20of.20union.20type.3F.html#281040135">(May 03 2022 at 16:32)</a>:</h4>
<p>It looks like you forgot a <code>$</code> in front of <code>e</code> in <code> `([e]) </code></p>



<a name="281040501"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/better%20way%20of%20union%20type%3F/near/281040501" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joseph O <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/better.20way.20of.20union.20type.3F.html#281040501">(May 03 2022 at 16:35)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110024">Sebastian Ullrich</span> <a href="#narrow/stream/270676-lean4/topic/better.20way.20of.20union.20type.3F/near/281040135">said</a>:</p>
<blockquote>
<p>It looks like you forgot a <code>$</code> in front of <code>e</code> in <code> `([e]) </code></p>
</blockquote>
<p>Oh my bad. Then I assume the guide forgot one too</p>



<a name="281040722"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/better%20way%20of%20union%20type%3F/near/281040722" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joseph O <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/better.20way.20of.20union.20type.3F.html#281040722">(May 03 2022 at 16:36)</a>:</h4>
<p>Nevermind</p>



<a name="281040723"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/better%20way%20of%20union%20type%3F/near/281040723" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joseph O <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/better.20way.20of.20union.20type.3F.html#281040723">(May 03 2022 at 16:37)</a>:</h4>
<p>Thanks</p>



<a name="281040738"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/better%20way%20of%20union%20type%3F/near/281040738" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Notification Bot <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/better.20way.20of.20union.20type.3F.html#281040738">(May 03 2022 at 16:37)</a>:</h4>
<p><span class="user-mention silent" data-user-id="467926">Joseph O</span> has marked this topic as resolved.</p>



<a name="281045073"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/better%20way%20of%20union%20type%3F/near/281045073" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Notification Bot <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/better.20way.20of.20union.20type.3F.html#281045073">(May 03 2022 at 17:06)</a>:</h4>
<p><span class="user-mention silent" data-user-id="467926">Joseph O</span> has marked this topic as unresolved.</p>



<a name="281045167"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/better%20way%20of%20union%20type%3F/near/281045167" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joseph O <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/better.20way.20of.20union.20type.3F.html#281045167">(May 03 2022 at 17:07)</a>:</h4>
<p>Just one small thing, using the exact same code from above, it doesn't let me have an embedded term in the middle:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">def</span> <span class="n">a</span> <span class="o">:=</span> <span class="mi">1</span>
<span class="kd">def</span> <span class="n">b</span> <span class="o">:=</span> <span class="mi">2</span>
<span class="k">#eval</span> <span class="n">eval</span> <span class="bp">%</span><span class="n">rpn</span><span class="o">([</span><span class="n">a</span><span class="o">]</span> <span class="o">[</span><span class="n">b</span><span class="o">]</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span><span class="o">)</span>
</code></pre></div>
<p>error:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">expected</span> <span class="sc">')'</span>
</code></pre></div>
<p>any ideas?</p>



<a name="281046667"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/better%20way%20of%20union%20type%3F/near/281046667" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/better.20way.20of.20union.20type.3F.html#281046667">(May 03 2022 at 17:18)</a>:</h4>
<p>How does the notation accept multiple numbers? If that part is clear to you, you should be able to solve this issue by yourself.</p>



<a name="281046768"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/better%20way%20of%20union%20type%3F/near/281046768" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joseph O <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/better.20way.20of.20union.20type.3F.html#281046768">(May 03 2022 at 17:19)</a>:</h4>
<p>I dont know. The syntaxes for both look almost identical:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">syntax</span> <span class="n">num</span> <span class="o">:</span> <span class="n">rpn</span>
<span class="n">syntax</span> <span class="s2">"["</span> <span class="n">term</span> <span class="s2">"]"</span> <span class="o">:</span> <span class="n">rpn</span>
</code></pre></div>



<a name="281046793"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/better%20way%20of%20union%20type%3F/near/281046793" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joseph O <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/better.20way.20of.20union.20type.3F.html#281046793">(May 03 2022 at 17:19)</a>:</h4>
<p>even in the macro_rules</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">macro_rules</span>
  <span class="bp">|</span> <span class="bp">`</span><span class="o">(</span><span class="bp">%</span><span class="n">rpn</span><span class="o">(</span> <span class="bp">$</span><span class="n">num</span><span class="o">:</span><span class="n">num</span> <span class="o">))</span>       <span class="bp">=&gt;</span> <span class="bp">`</span><span class="o">([</span><span class="n">Atom.val</span> <span class="bp">$</span><span class="n">num</span><span class="o">])</span>
  <span class="bp">|</span> <span class="bp">`</span><span class="o">(</span><span class="bp">%</span><span class="n">rpn</span><span class="o">(</span> <span class="o">[</span> <span class="bp">$</span><span class="n">e</span><span class="o">:</span><span class="n">term</span> <span class="o">]</span> <span class="o">))</span>    <span class="bp">=&gt;</span> <span class="bp">`</span><span class="o">([</span><span class="n">Atom.val</span> <span class="bp">$</span><span class="n">e</span><span class="o">])</span>
</code></pre></div>



<a name="281046830"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/better%20way%20of%20union%20type%3F/near/281046830" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joseph O <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/better.20way.20of.20union.20type.3F.html#281046830">(May 03 2022 at 17:19)</a>:</h4>
<p>Oh wait</p>



<a name="281046844"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/better%20way%20of%20union%20type%3F/near/281046844" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joseph O <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/better.20way.20of.20union.20type.3F.html#281046844">(May 03 2022 at 17:19)</a>:</h4>
<p>Nevermind, I see it now</p>



<a name="281047043"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/better%20way%20of%20union%20type%3F/near/281047043" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joseph O <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/better.20way.20of.20union.20type.3F.html#281047043">(May 03 2022 at 17:21)</a>:</h4>
<p>actually implementing the rule produces the same error</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="bp">|</span> <span class="bp">`</span><span class="o">(</span><span class="bp">%</span><span class="n">rpn</span><span class="o">(</span> <span class="bp">$</span><span class="n">x</span><span class="o">:</span><span class="n">rpn</span> <span class="o">[</span> <span class="bp">$</span><span class="n">e</span><span class="o">:</span><span class="n">term</span> <span class="o">]))</span> <span class="bp">=&gt;</span> <span class="bp">`</span><span class="o">(</span><span class="bp">%</span><span class="n">rpn</span><span class="o">(</span><span class="bp">$</span><span class="n">x</span><span class="o">:</span><span class="n">rpn</span><span class="o">)</span> <span class="bp">++</span> <span class="o">[</span><span class="n">Atom.val</span> <span class="bp">$</span><span class="n">e</span><span class="o">:</span><span class="n">term</span><span class="o">])</span>
</code></pre></div>



<a name="281047296"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/better%20way%20of%20union%20type%3F/near/281047296" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joseph O <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/better.20way.20of.20union.20type.3F.html#281047296">(May 03 2022 at 17:22)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">expected</span> <span class="sc">')'</span>
</code></pre></div>



<a name="281047521"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/better%20way%20of%20union%20type%3F/near/281047521" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/better.20way.20of.20union.20type.3F.html#281047521">(May 03 2022 at 17:24)</a>:</h4>
<p>Yes, the rule is one part, but it doesn't by itself change what syntax the parser accepts. There is another requisite part.</p>



<a name="281047582"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/better%20way%20of%20union%20type%3F/near/281047582" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joseph O <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/better.20way.20of.20union.20type.3F.html#281047582">(May 03 2022 at 17:24)</a>:</h4>
<p>I found it</p>



<a name="281047628"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/better%20way%20of%20union%20type%3F/near/281047628" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joseph O <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/better.20way.20of.20union.20type.3F.html#281047628">(May 03 2022 at 17:25)</a>:</h4>
<p>Yup I fixed it, Thanks</p>



<a name="281047734"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/better%20way%20of%20union%20type%3F/near/281047734" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joseph O <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/better.20way.20of.20union.20type.3F.html#281047734">(May 03 2022 at 17:26)</a>:</h4>
<p>Do we have a function in lean 4 that take a list of strings and converts and joins it with a seperator?</p>



<a name="281047938"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/better%20way%20of%20union%20type%3F/near/281047938" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sébastien Michelland <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/better.20way.20of.20union.20type.3F.html#281047938">(May 03 2022 at 17:27)</a>:</h4>
<p>What about <a href="https://leanprover-community.github.io/mathlib4_docs/Init/Data/String/Basic.html#String.intercalate">String.intercalate</a>?</p>



<a name="281049381"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/better%20way%20of%20union%20type%3F/near/281049381" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/better.20way.20of.20union.20type.3F.html#281049381">(May 03 2022 at 17:37)</a>:</h4>
<p><span class="user-mention" data-user-id="467926">@Joseph O</span> feel free to copy it:<br>
<a href="https://github.com/arthurpaulino/FxyLang/blob/afcd0db77d320438d625bac9cb8cf55413c47e52/FxyLang/Implementation/Parser.lean#L93">Link</a></p>



<a name="281049652"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/better%20way%20of%20union%20type%3F/near/281049652" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/better.20way.20of.20union.20type.3F.html#281049652">(May 03 2022 at 17:39)</a>:</h4>
<p>Oh, that seems to be <code>String.intercalate</code>!</p>



<a name="281049738"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/better%20way%20of%20union%20type%3F/near/281049738" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Henrik Böving <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/better.20way.20of.20union.20type.3F.html#281049738">(May 03 2022 at 17:40)</a>:</h4>
<p>And the one in stdlib is even tail recursive \o/</p>



<a name="281050766"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/better%20way%20of%20union%20type%3F/near/281050766" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joseph O <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/better.20way.20of.20union.20type.3F.html#281050766">(May 03 2022 at 17:46)</a>:</h4>
<p>yet intercalate doesnt work for <code>#eval List.intercalate " " ["h", "i"]</code></p>



<a name="281051271"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/better%20way%20of%20union%20type%3F/near/281051271" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Henrik Böving <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/better.20way.20of.20union.20type.3F.html#281051271">(May 03 2022 at 17:50)</a>:</h4>
<p>Of course not, after all you want the string and not the list variant.</p>



<a name="281051297"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/better%20way%20of%20union%20type%3F/near/281051297" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joseph O <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/better.20way.20of.20union.20type.3F.html#281051297">(May 03 2022 at 17:50)</a>:</h4>
<p>Oh right</p>



<a name="281051309"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/better%20way%20of%20union%20type%3F/near/281051309" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joseph O <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/better.20way.20of.20union.20type.3F.html#281051309">(May 03 2022 at 17:50)</a>:</h4>
<p><span aria-label="face palm" class="emoji emoji-1f926" role="img" title="face palm">:face_palm:</span></p>



<a name="281051346"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/better%20way%20of%20union%20type%3F/near/281051346" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joseph O <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/better.20way.20of.20union.20type.3F.html#281051346">(May 03 2022 at 17:50)</a>:</h4>
<p>There we go</p>



<a name="281051900"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/better%20way%20of%20union%20type%3F/near/281051900" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joseph O <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/better.20way.20of.20union.20type.3F.html#281051900">(May 03 2022 at 17:54)</a>:</h4>
<p>Wait no way <code>List.get</code> uses <code>Fin</code> now</p>



<a name="281051966"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/better%20way%20of%20union%20type%3F/near/281051966" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joseph O <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/better.20way.20of.20union.20type.3F.html#281051966">(May 03 2022 at 17:54)</a>:</h4>
<p>I wonder if the change was because of my Soup project...</p>



<a name="281052532"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/better%20way%20of%20union%20type%3F/near/281052532" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joseph O <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/better.20way.20of.20union.20type.3F.html#281052532">(May 03 2022 at 17:58)</a>:</h4>
<p>Suggestion on how to make this less repetitive?</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">declare_syntax_cat</span> <span class="n">rpn</span>
<span class="n">syntax</span> <span class="s2">"["</span> <span class="n">term</span> <span class="s2">"]"</span> <span class="o">:</span> <span class="n">rpn</span>
<span class="n">syntax</span> <span class="n">num</span> <span class="o">:</span> <span class="n">rpn</span>
<span class="n">syntax</span> <span class="n">rpn</span> <span class="n">num</span> <span class="s2">"+"</span> <span class="o">:</span> <span class="n">rpn</span>
<span class="n">syntax</span> <span class="n">rpn</span> <span class="n">num</span> <span class="s2">"*"</span> <span class="o">:</span> <span class="n">rpn</span>
<span class="n">syntax</span> <span class="n">rpn</span> <span class="s2">"["</span> <span class="n">term</span> <span class="s2">"]"</span> <span class="s2">"+"</span> <span class="o">:</span> <span class="n">rpn</span>
<span class="n">syntax</span> <span class="n">rpn</span> <span class="s2">"["</span> <span class="n">term</span> <span class="s2">"]"</span> <span class="s2">"*"</span> <span class="o">:</span> <span class="n">rpn</span>
<span class="n">syntax</span> <span class="n">rpn</span> <span class="n">num</span> <span class="o">:</span> <span class="n">rpn</span>
<span class="n">syntax</span> <span class="n">rpn</span> <span class="s2">"["</span> <span class="n">term</span> <span class="s2">"]"</span> <span class="o">:</span> <span class="n">rpn</span>

<span class="n">syntax</span> <span class="s2">"%rpn( "</span> <span class="n">rpn</span> <span class="s2">")"</span> <span class="o">:</span> <span class="n">term</span>

<span class="n">macro_rules</span>
  <span class="bp">|</span> <span class="bp">`</span><span class="o">(</span><span class="bp">%</span><span class="n">rpn</span><span class="o">(</span> <span class="bp">$</span><span class="n">num</span><span class="o">:</span><span class="n">num</span> <span class="o">))</span>       <span class="bp">=&gt;</span> <span class="bp">`</span><span class="o">([</span><span class="n">Atom.val</span> <span class="bp">$</span><span class="n">num</span><span class="o">])</span>
  <span class="bp">|</span> <span class="bp">`</span><span class="o">(</span><span class="bp">%</span><span class="n">rpn</span><span class="o">(</span> <span class="o">[</span> <span class="bp">$</span><span class="n">e</span><span class="o">:</span><span class="n">term</span> <span class="o">]</span> <span class="o">))</span>    <span class="bp">=&gt;</span> <span class="bp">`</span><span class="o">([</span><span class="n">Atom.val</span> <span class="bp">$</span><span class="n">e</span><span class="o">])</span>
  <span class="bp">|</span> <span class="bp">`</span><span class="o">(</span><span class="bp">%</span><span class="n">rpn</span><span class="o">(</span> <span class="bp">$</span><span class="n">x</span><span class="o">:</span><span class="n">rpn</span> <span class="bp">$</span><span class="n">y</span><span class="o">:</span><span class="n">num</span> <span class="bp">+</span><span class="o">))</span> <span class="bp">=&gt;</span> <span class="bp">`</span><span class="o">(</span><span class="bp">%</span><span class="n">rpn</span><span class="o">(</span> <span class="bp">$</span><span class="n">x</span><span class="o">:</span><span class="n">rpn</span> <span class="o">)</span> <span class="bp">++</span> <span class="o">[</span><span class="n">Atom.val</span> <span class="bp">$</span><span class="n">y</span><span class="o">:</span><span class="n">num</span><span class="o">,</span> <span class="n">Atom.add</span><span class="o">])</span>
  <span class="bp">|</span> <span class="bp">`</span><span class="o">(</span><span class="bp">%</span><span class="n">rpn</span><span class="o">(</span> <span class="bp">$</span><span class="n">x</span><span class="o">:</span><span class="n">rpn</span> <span class="bp">$</span><span class="n">y</span><span class="o">:</span><span class="n">num</span> <span class="bp">*</span><span class="o">))</span> <span class="bp">=&gt;</span> <span class="bp">`</span><span class="o">(</span><span class="bp">%</span><span class="n">rpn</span><span class="o">(</span> <span class="bp">$</span><span class="n">x</span><span class="o">:</span><span class="n">rpn</span> <span class="o">)</span> <span class="bp">++</span> <span class="o">[</span><span class="n">Atom.val</span> <span class="bp">$</span><span class="n">y</span><span class="o">:</span><span class="n">num</span><span class="o">,</span> <span class="n">Atom.mul</span><span class="o">])</span>
  <span class="bp">|</span> <span class="bp">`</span><span class="o">(</span><span class="bp">%</span><span class="n">rpn</span><span class="o">(</span> <span class="bp">$</span><span class="n">x</span><span class="o">:</span><span class="n">rpn</span> <span class="o">[</span> <span class="bp">$</span><span class="n">e</span><span class="o">:</span><span class="n">term</span> <span class="o">]</span> <span class="bp">+</span><span class="o">))</span> <span class="bp">=&gt;</span> <span class="bp">`</span><span class="o">(</span><span class="bp">%</span><span class="n">rpn</span><span class="o">(</span> <span class="bp">$</span><span class="n">x</span><span class="o">:</span><span class="n">rpn</span> <span class="o">)</span> <span class="bp">++</span> <span class="o">[</span><span class="n">Atom.val</span> <span class="bp">$</span><span class="n">e</span><span class="o">:</span><span class="n">term</span><span class="o">,</span> <span class="n">Atom.add</span><span class="o">])</span>
  <span class="bp">|</span> <span class="bp">`</span><span class="o">(</span><span class="bp">%</span><span class="n">rpn</span><span class="o">(</span> <span class="bp">$</span><span class="n">x</span><span class="o">:</span><span class="n">rpn</span> <span class="o">[</span> <span class="bp">$</span><span class="n">e</span><span class="o">:</span><span class="n">term</span> <span class="o">]</span> <span class="bp">*</span><span class="o">))</span> <span class="bp">=&gt;</span> <span class="bp">`</span><span class="o">(</span><span class="bp">%</span><span class="n">rpn</span><span class="o">(</span> <span class="bp">$</span><span class="n">x</span><span class="o">:</span><span class="n">rpn</span> <span class="o">)</span> <span class="bp">++</span> <span class="o">[</span><span class="n">Atom.val</span> <span class="bp">$</span><span class="n">e</span><span class="o">:</span><span class="n">term</span><span class="o">,</span> <span class="n">Atom.mul</span><span class="o">])</span>
  <span class="bp">|</span> <span class="bp">`</span><span class="o">(</span><span class="bp">%</span><span class="n">rpn</span><span class="o">(</span> <span class="bp">$</span><span class="n">x</span><span class="o">:</span><span class="n">rpn</span> <span class="bp">$</span><span class="n">y</span><span class="o">:</span><span class="n">num</span><span class="o">))</span>   <span class="bp">=&gt;</span> <span class="bp">`</span><span class="o">(</span><span class="bp">%</span><span class="n">rpn</span><span class="o">(</span><span class="bp">$</span><span class="n">x</span><span class="o">:</span><span class="n">rpn</span><span class="o">)</span> <span class="bp">++</span> <span class="o">[</span><span class="n">Atom.val</span> <span class="bp">$</span><span class="n">y</span><span class="o">:</span><span class="n">num</span><span class="o">])</span>
  <span class="bp">|</span> <span class="bp">`</span><span class="o">(</span><span class="bp">%</span><span class="n">rpn</span><span class="o">(</span> <span class="bp">$</span><span class="n">x</span><span class="o">:</span><span class="n">rpn</span> <span class="o">[</span> <span class="bp">$</span><span class="n">e</span><span class="o">:</span><span class="n">term</span> <span class="o">]))</span> <span class="bp">=&gt;</span> <span class="bp">`</span><span class="o">(</span><span class="bp">%</span><span class="n">rpn</span><span class="o">(</span><span class="bp">$</span><span class="n">x</span><span class="o">:</span><span class="n">rpn</span><span class="o">)</span> <span class="bp">++</span> <span class="o">[</span><span class="n">Atom.val</span> <span class="bp">$</span><span class="n">e</span><span class="o">:</span><span class="n">term</span><span class="o">])</span>
</code></pre></div>



<a name="281067338"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/better%20way%20of%20union%20type%3F/near/281067338" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joseph O <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/better.20way.20of.20union.20type.3F.html#281067338">(May 03 2022 at 19:51)</a>:</h4>
<p>Anyone?</p>



<a name="281067421"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/better%20way%20of%20union%20type%3F/near/281067421" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joseph O <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/better.20way.20of.20union.20type.3F.html#281067421">(May 03 2022 at 19:51)</a>:</h4>
<p>Then I guess there is no way (though I doubt that)</p>



<a name="281067690"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/better%20way%20of%20union%20type%3F/near/281067690" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/better.20way.20of.20union.20type.3F.html#281067690">(May 03 2022 at 19:53)</a>:</h4>
<p>It's possible but you need to rethink your syntax structure to be more general</p>



<a name="281068137"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/better%20way%20of%20union%20type%3F/near/281068137" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joseph O <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/better.20way.20of.20union.20type.3F.html#281068137">(May 03 2022 at 19:57)</a>:</h4>
<p><span class="user-mention silent" data-user-id="451983">Arthur Paulino</span> <a href="#narrow/stream/270676-lean4/topic/better.20way.20of.20union.20type.3F/near/281067690">said</a>:</p>
<blockquote>
<p>It's possible but you need to rethink your syntax structure to be more general</p>
</blockquote>
<p>Im pretty new to macros, so I don't know what structure to use. Do you have one in mind?</p>



<a name="281068283"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/better%20way%20of%20union%20type%3F/near/281068283" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/better.20way.20of.20union.20type.3F.html#281068283">(May 03 2022 at 19:58)</a>:</h4>
<p><a href="https://github.com/leanprover-community/mathlib4/blob/master/Mathlib/Tactic/Basic.lean">this file</a> contains some examples with more flexible syntaxes. Check the ones with interrogation marks</p>



<a name="281069462"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/better%20way%20of%20union%20type%3F/near/281069462" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/better.20way.20of.20union.20type.3F.html#281069462">(May 03 2022 at 20:07)</a>:</h4>
<p>For example, "+" and "*" can be grouped in a syntax category "operator". And it is optional in your term</p>



<a name="281069813"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/better%20way%20of%20union%20type%3F/near/281069813" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/better.20way.20of.20union.20type.3F.html#281069813">(May 03 2022 at 20:10)</a>:</h4>
<p>But I wouldn't bother too much about learning these details at the moment. I heard Sebastian is working on something that might cause some shake up on Lean 4 <code>syntax</code></p>



<a name="281069917"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/better%20way%20of%20union%20type%3F/near/281069917" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/better.20way.20of.20union.20type.3F.html#281069917">(May 03 2022 at 20:11)</a>:</h4>
<p>There is no planned change to <code>syntax</code> itself</p>



<a name="281070109"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/better%20way%20of%20union%20type%3F/near/281070109" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/better.20way.20of.20union.20type.3F.html#281070109">(May 03 2022 at 20:12)</a>:</h4>
<p><span class="user-mention" data-user-id="110024">@Sebastian Ullrich</span> can you explain what will be changed? <span aria-label="pray" class="emoji emoji-1f64f" role="img" title="pray">:pray:</span>🏼</p>



<a name="281075170"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/better%20way%20of%20union%20type%3F/near/281075170" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/better.20way.20of.20union.20type.3F.html#281075170">(May 03 2022 at 20:49)</a>:</h4>
<p>It's about making macro programming more type-safe by annotating a <code>Syntax</code> wrapper with the carried syntax kind</p>



<a name="281075614"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/better%20way%20of%20union%20type%3F/near/281075614" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/better.20way.20of.20union.20type.3F.html#281075614">(May 03 2022 at 20:52)</a>:</h4>
<p>Ah, then we shouldn't notice too much difference except for those errors that happened when we didn't explicitly say the syntax kind?</p>
<p><span class="user-mention" data-user-id="467926">@Joseph O</span> can you show the definition of <code>Atom</code> and <code>++</code> as well?</p>



<a name="281082562"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/better%20way%20of%20union%20type%3F/near/281082562" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/better.20way.20of.20union.20type.3F.html#281082562">(May 03 2022 at 21:55)</a>:</h4>
<p>Here's a disastrously longer code that might serve the purpose of teaching about elaboration:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">Lean</span>

<span class="kd">inductive</span> <span class="n">Atom</span> <span class="n">where</span>
  <span class="bp">|</span> <span class="n">val</span> <span class="o">(</span><span class="n">v</span> <span class="o">:</span> <span class="n">Int</span><span class="o">)</span>
  <span class="bp">|</span> <span class="n">add</span>
  <span class="bp">|</span> <span class="n">mul</span>
  <span class="n">deriving</span> <span class="n">Repr</span>

<span class="n">declare_syntax_cat</span>    <span class="n">rpn_item</span>
<span class="n">syntax</span> <span class="s2">"["</span> <span class="n">term</span> <span class="s2">"]"</span> <span class="o">:</span> <span class="n">rpn_item</span>
<span class="n">syntax</span> <span class="n">num</span>          <span class="o">:</span> <span class="n">rpn_item</span>

<span class="n">declare_syntax_cat</span> <span class="n">rpn_op</span>
<span class="n">syntax</span> <span class="s2">" + "</span>     <span class="o">:</span> <span class="n">rpn_op</span>
<span class="n">syntax</span> <span class="s2">" * "</span>     <span class="o">:</span> <span class="n">rpn_op</span>

<span class="n">declare_syntax_cat</span>              <span class="n">rpn</span>
<span class="n">syntax</span> <span class="n">rpn_item</span>               <span class="o">:</span> <span class="n">rpn</span>
<span class="n">syntax</span> <span class="n">rpn</span> <span class="n">rpn_item</span> <span class="o">(</span><span class="n">rpn_op</span><span class="o">)</span><span class="bp">?</span> <span class="o">:</span> <span class="n">rpn</span>

<span class="kn">open</span> <span class="n">Lean</span> <span class="n">Elab</span> <span class="n">Meta</span>

<span class="kd">def</span> <span class="n">elabItem</span> <span class="o">:</span> <span class="n">Syntax</span> <span class="bp">→</span> <span class="n">TermElabM</span> <span class="n">Expr</span>
  <span class="bp">|</span> <span class="bp">`</span><span class="o">(</span><span class="n">rpn_item</span><span class="bp">|</span> <span class="bp">$</span><span class="n">num</span><span class="o">:</span><span class="n">num</span><span class="o">)</span> <span class="bp">=&gt;</span>
    <span class="n">return</span> <span class="n">mkApp</span> <span class="o">(</span><span class="n">mkConst</span> <span class="bp">``</span><span class="n">Atom.val</span><span class="o">)</span> <span class="bp">$</span>
      <span class="n">mkApp</span> <span class="o">(</span><span class="n">mkConst</span> <span class="bp">``</span><span class="n">Int.ofNat</span><span class="o">)</span> <span class="o">(</span><span class="n">mkNatLit</span> <span class="n">num.toNat</span><span class="o">)</span>
  <span class="bp">|</span> <span class="bp">`</span><span class="o">(</span><span class="n">rpn_item</span><span class="bp">|</span> <span class="o">[</span> <span class="bp">$</span><span class="n">e</span><span class="o">:</span><span class="n">term</span> <span class="o">])</span> <span class="bp">=&gt;</span>
    <span class="n">return</span> <span class="n">mkApp</span> <span class="o">(</span><span class="n">mkConst</span> <span class="bp">``</span><span class="n">Atom.val</span><span class="o">)</span> <span class="o">(</span><span class="bp">←</span> <span class="n">Term.elabTerm</span> <span class="n">e</span> <span class="n">none</span><span class="o">)</span>
  <span class="bp">|</span> <span class="n">_</span> <span class="bp">=&gt;</span> <span class="n">throwUnsupportedSyntax</span>

<span class="kd">def</span> <span class="n">elabOp</span> <span class="o">:</span> <span class="n">Syntax</span> <span class="bp">→</span> <span class="n">TermElabM</span> <span class="n">Expr</span>
  <span class="bp">|</span> <span class="bp">`</span><span class="o">(</span><span class="n">rpn_op</span><span class="bp">|</span> <span class="bp">+</span><span class="o">)</span> <span class="bp">=&gt;</span> <span class="n">return</span> <span class="n">mkConst</span> <span class="bp">``</span><span class="n">Atom.add</span>
  <span class="bp">|</span> <span class="bp">`</span><span class="o">(</span><span class="n">rpn_op</span><span class="bp">|</span> <span class="bp">*</span><span class="o">)</span> <span class="bp">=&gt;</span> <span class="n">return</span> <span class="n">mkConst</span> <span class="bp">``</span><span class="n">Atom.mul</span>
  <span class="bp">|</span> <span class="n">_</span> <span class="bp">=&gt;</span> <span class="n">throwUnsupportedSyntax</span>

<span class="n">partial</span> <span class="kd">def</span> <span class="n">elabRPN</span> <span class="o">:</span> <span class="n">Syntax</span> <span class="bp">→</span> <span class="n">TermElabM</span> <span class="n">Expr</span>
  <span class="bp">|</span> <span class="bp">`</span><span class="o">(</span><span class="n">rpn</span><span class="bp">|</span> <span class="bp">$</span><span class="n">i</span><span class="o">:</span><span class="n">rpn_item</span><span class="o">)</span> <span class="bp">=&gt;</span> <span class="k">do</span> <span class="n">mkListLit</span> <span class="o">(</span><span class="n">mkConst</span> <span class="bp">``</span><span class="n">Atom</span><span class="o">)</span> <span class="o">[</span><span class="bp">←</span> <span class="n">elabItem</span> <span class="n">i</span><span class="o">]</span>
  <span class="bp">|</span> <span class="bp">`</span><span class="o">(</span><span class="n">rpn</span><span class="bp">|</span> <span class="bp">$</span><span class="n">r</span><span class="o">:</span><span class="n">rpn</span> <span class="bp">$</span><span class="n">i</span><span class="o">:</span><span class="n">rpn_item</span> <span class="bp">$</span><span class="o">[</span><span class="bp">$</span><span class="n">o</span><span class="o">:</span><span class="n">rpn_op</span><span class="o">]</span><span class="bp">?</span><span class="o">)</span> <span class="bp">=&gt;</span> <span class="k">do</span>
    <span class="k">match</span> <span class="n">o</span> <span class="k">with</span>
    <span class="bp">|</span> <span class="n">some</span> <span class="n">o</span> <span class="bp">=&gt;</span>
      <span class="k">let</span> <span class="n">l</span> <span class="bp">←</span> <span class="n">mkListLit</span> <span class="o">(</span><span class="n">mkConst</span> <span class="bp">``</span><span class="n">Atom</span><span class="o">)</span> <span class="o">[</span><span class="bp">←</span> <span class="n">elabItem</span> <span class="n">i</span><span class="o">,</span> <span class="bp">←</span> <span class="n">elabOp</span> <span class="n">o</span><span class="o">]</span>
      <span class="n">mkAppM</span> <span class="bp">``</span><span class="n">List.append</span> <span class="bp">#</span><span class="o">[(</span><span class="bp">←</span> <span class="n">elabRPN</span> <span class="n">r</span><span class="o">),</span> <span class="n">l</span><span class="o">]</span>
    <span class="bp">|</span> <span class="n">none</span> <span class="bp">=&gt;</span>
      <span class="k">let</span> <span class="n">l</span> <span class="bp">←</span> <span class="n">mkListLit</span> <span class="o">(</span><span class="n">mkConst</span> <span class="bp">``</span><span class="n">Atom</span><span class="o">)</span> <span class="o">[</span><span class="bp">←</span> <span class="n">elabItem</span> <span class="n">i</span><span class="o">]</span>
      <span class="n">mkAppM</span> <span class="bp">``</span><span class="n">List.append</span> <span class="bp">#</span><span class="o">[(</span><span class="bp">←</span> <span class="n">elabRPN</span> <span class="n">r</span><span class="o">),</span> <span class="n">l</span><span class="o">]</span>
  <span class="bp">|</span> <span class="n">_</span> <span class="bp">=&gt;</span> <span class="n">throwUnsupportedSyntax</span>

<span class="n">elab</span> <span class="s2">"%rpn("</span> <span class="n">rpn</span><span class="o">:</span><span class="n">rpn</span> <span class="s2">")"</span> <span class="o">:</span> <span class="n">term</span> <span class="bp">=&gt;</span> <span class="n">elabRPN</span> <span class="n">rpn</span>

<span class="kd">def</span> <span class="n">a</span> <span class="o">:</span> <span class="n">Int</span> <span class="o">:=</span> <span class="mi">8</span>
<span class="k">#eval</span> <span class="bp">%</span><span class="n">rpn</span><span class="o">([</span><span class="n">a</span><span class="o">]</span> <span class="mi">1</span> <span class="mi">2</span> <span class="bp">*</span><span class="o">)</span> <span class="c1">-- [Atom.val 8, Atom.val 1, Atom.val 2, Atom.mul]</span>
</code></pre></div>



<a name="281088042"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/better%20way%20of%20union%20type%3F/near/281088042" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joseph O <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/better.20way.20of.20union.20type.3F.html#281088042">(May 03 2022 at 22:42)</a>:</h4>
<p>I think I might stick with mine...</p>



<a name="281088109"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/better%20way%20of%20union%20type%3F/near/281088109" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joseph O <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/better.20way.20of.20union.20type.3F.html#281088109">(May 03 2022 at 22:43)</a>:</h4>
<p>Like these I dont understand:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">open</span> <span class="n">Lean</span> <span class="n">Elab</span> <span class="n">Meta</span>

<span class="kd">def</span> <span class="n">elabItem</span> <span class="o">:</span> <span class="n">Syntax</span> <span class="bp">→</span> <span class="n">TermElabM</span> <span class="n">Expr</span>
  <span class="bp">|</span> <span class="bp">`</span><span class="o">(</span><span class="n">rpn_item</span><span class="bp">|</span> <span class="bp">$</span><span class="n">num</span><span class="o">:</span><span class="n">num</span><span class="o">)</span> <span class="bp">=&gt;</span>
    <span class="n">return</span> <span class="n">mkApp</span> <span class="o">(</span><span class="n">mkConst</span> <span class="bp">``</span><span class="n">Atom.val</span><span class="o">)</span> <span class="bp">$</span>
      <span class="n">mkApp</span> <span class="o">(</span><span class="n">mkConst</span> <span class="bp">``</span><span class="n">Int.ofNat</span><span class="o">)</span> <span class="o">(</span><span class="n">mkNatLit</span> <span class="n">num.toNat</span><span class="o">)</span>
  <span class="bp">|</span> <span class="bp">`</span><span class="o">(</span><span class="n">rpn_item</span><span class="bp">|</span> <span class="o">[</span> <span class="bp">$</span><span class="n">e</span><span class="o">:</span><span class="n">term</span> <span class="o">])</span> <span class="bp">=&gt;</span>
    <span class="n">return</span> <span class="n">mkApp</span> <span class="o">(</span><span class="n">mkConst</span> <span class="bp">``</span><span class="n">Atom.val</span><span class="o">)</span> <span class="o">(</span><span class="bp">←</span> <span class="n">Term.elabTerm</span> <span class="n">e</span> <span class="n">none</span><span class="o">)</span>
  <span class="bp">|</span> <span class="n">_</span> <span class="bp">=&gt;</span> <span class="n">throwUnsupportedSyntax</span>

<span class="kd">def</span> <span class="n">elabOp</span> <span class="o">:</span> <span class="n">Syntax</span> <span class="bp">→</span> <span class="n">TermElabM</span> <span class="n">Expr</span>
  <span class="bp">|</span> <span class="bp">`</span><span class="o">(</span><span class="n">rpn_op</span><span class="bp">|</span> <span class="bp">+</span><span class="o">)</span> <span class="bp">=&gt;</span> <span class="n">return</span> <span class="n">mkConst</span> <span class="bp">``</span><span class="n">Atom.add</span>
  <span class="bp">|</span> <span class="bp">`</span><span class="o">(</span><span class="n">rpn_op</span><span class="bp">|</span> <span class="bp">*</span><span class="o">)</span> <span class="bp">=&gt;</span> <span class="n">return</span> <span class="n">mkConst</span> <span class="bp">``</span><span class="n">Atom.mul</span>
  <span class="bp">|</span> <span class="n">_</span> <span class="bp">=&gt;</span> <span class="n">throwUnsupportedSyntax</span>

<span class="n">partial</span> <span class="kd">def</span> <span class="n">elabRPN</span> <span class="o">:</span> <span class="n">Syntax</span> <span class="bp">→</span> <span class="n">TermElabM</span> <span class="n">Expr</span>
  <span class="bp">|</span> <span class="bp">`</span><span class="o">(</span><span class="n">rpn</span><span class="bp">|</span> <span class="bp">$</span><span class="n">i</span><span class="o">:</span><span class="n">rpn_item</span><span class="o">)</span> <span class="bp">=&gt;</span> <span class="k">do</span> <span class="n">mkListLit</span> <span class="o">(</span><span class="n">mkConst</span> <span class="bp">``</span><span class="n">Atom</span><span class="o">)</span> <span class="o">[</span><span class="bp">←</span> <span class="n">elabItem</span> <span class="n">i</span><span class="o">]</span>
  <span class="bp">|</span> <span class="bp">`</span><span class="o">(</span><span class="n">rpn</span><span class="bp">|</span> <span class="bp">$</span><span class="n">r</span><span class="o">:</span><span class="n">rpn</span> <span class="bp">$</span><span class="n">i</span><span class="o">:</span><span class="n">rpn_item</span> <span class="bp">$</span><span class="o">[</span><span class="bp">$</span><span class="n">o</span><span class="o">:</span><span class="n">rpn_op</span><span class="o">]</span><span class="bp">?</span><span class="o">)</span> <span class="bp">=&gt;</span> <span class="k">do</span>
    <span class="k">match</span> <span class="n">o</span> <span class="k">with</span>
    <span class="bp">|</span> <span class="n">some</span> <span class="n">o</span> <span class="bp">=&gt;</span>
      <span class="k">let</span> <span class="n">l</span> <span class="bp">←</span> <span class="n">mkListLit</span> <span class="o">(</span><span class="n">mkConst</span> <span class="bp">``</span><span class="n">Atom</span><span class="o">)</span> <span class="o">[</span><span class="bp">←</span> <span class="n">elabItem</span> <span class="n">i</span><span class="o">,</span> <span class="bp">←</span> <span class="n">elabOp</span> <span class="n">o</span><span class="o">]</span>
      <span class="n">mkAppM</span> <span class="bp">``</span><span class="n">List.append</span> <span class="bp">#</span><span class="o">[(</span><span class="bp">←</span> <span class="n">elabRPN</span> <span class="n">r</span><span class="o">),</span> <span class="n">l</span><span class="o">]</span>
    <span class="bp">|</span> <span class="n">none</span> <span class="bp">=&gt;</span>
      <span class="k">let</span> <span class="n">l</span> <span class="bp">←</span> <span class="n">mkListLit</span> <span class="o">(</span><span class="n">mkConst</span> <span class="bp">``</span><span class="n">Atom</span><span class="o">)</span> <span class="o">[</span><span class="bp">←</span> <span class="n">elabItem</span> <span class="n">i</span><span class="o">]</span>
      <span class="n">mkAppM</span> <span class="bp">``</span><span class="n">List.append</span> <span class="bp">#</span><span class="o">[(</span><span class="bp">←</span> <span class="n">elabRPN</span> <span class="n">r</span><span class="o">),</span> <span class="n">l</span><span class="o">]</span>
  <span class="bp">|</span> <span class="n">_</span> <span class="bp">=&gt;</span> <span class="n">throwUnsupportedSyntax</span>
<span class="bp">```</span>
</code></pre></div>



<a name="281088924"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/better%20way%20of%20union%20type%3F/near/281088924" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joseph O <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/better.20way.20of.20union.20type.3F.html#281088924">(May 03 2022 at 22:51)</a>:</h4>
<p>also, <span class="user-mention" data-user-id="451983">@Arthur Paulino</span> your version fails at <code>#eval %rpn([1+2] 3 +)</code></p>



<a name="281089394"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/better%20way%20of%20union%20type%3F/near/281089394" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/better.20way.20of.20union.20type.3F.html#281089394">(May 03 2022 at 22:55)</a>:</h4>
<p>Alright, not worth debugging at the moment</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>