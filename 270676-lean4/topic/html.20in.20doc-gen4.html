---
layout: archive
title: Zulip Chat Archive
permalink: /stream/270676-lean4/topic/html.20in.20doc-gen4.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/index.html">lean4</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/html.20in.20doc-gen4.html">html in doc-gen4</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="263893752"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/html%20in%20doc-gen4/near/263893752" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Henrik Böving <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/html.20in.20doc-gen4.html#263893752">(Dec 06 2021 at 18:24)</a>:</h4>
<p>I'll take a look into that as soon as I get there then!</p>
<p>A final question, regarding HTML templating, would it be more reasonable to implement some HTML like DSL in Lean itself and write with that or to implement a custom parser for something like Jinja2 etc. and use external templates? Does it even matter?</p>



<a name="263893954"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/html%20in%20doc-gen4/near/263893954" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/html.20in.20doc-gen4.html#263893954">(Dec 06 2021 at 18:25)</a>:</h4>
<p>I would make a DSL in Lean.</p>



<a name="263894248"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/html%20in%20doc-gen4/near/263894248" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/html.20in.20doc-gen4.html#263894248">(Dec 06 2021 at 18:27)</a>:</h4>
<p>One of the most annoying things (imho) in jinja2 is that it doesn't check well-formedness of the HTML.  That is you can write <code>&lt;div&gt;&lt;p&gt;{% include "child.j2" %}&lt;/p&gt;</code> and you'll only notice that something is wrong once you look at the page in the browser.  This kind of error would immediately become impossible in Lean.</p>



<a name="263896259"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/html%20in%20doc-gen4/near/263896259" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/html.20in.20doc-gen4.html#263896259">(Dec 06 2021 at 18:38)</a>:</h4>
<p>I assume JSX/TSX would be a better source of inspiration, though I've never used them</p>



<a name="263896612"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/html%20in%20doc-gen4/near/263896612" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/html.20in.20doc-gen4.html#263896612">(Dec 06 2021 at 18:41)</a>:</h4>
<p>You can also look at the webserver demo: <a href="https://github.com/leanprover/lean4/blob/7b6732a137a436a64e00f9d319e2a345b517be2d/tests/playground/webserver/Webserver.lean#L172-L174">https://github.com/leanprover/lean4/blob/7b6732a137a436a64e00f9d319e2a345b517be2d/tests/playground/webserver/Webserver.lean#L172-L174</a></p>



<a name="263896693"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/html%20in%20doc-gen4/near/263896693" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/html.20in.20doc-gen4.html#263896693">(Dec 06 2021 at 18:42)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110024">Sebastian Ullrich</span> <a href="#narrow/stream/270676-lean4/topic/html.20in.20doc-gen4/near/263896259">said</a>:</p>
<blockquote>
<p>I assume JSX/TSX would be a better source of inspiration, though I've never used them</p>
</blockquote>
<p><span class="user-mention" data-user-id="395550">@Henrik Böving</span>, note that <span class="user-mention" data-user-id="128280">@Wojciech Nawrocki</span> already wrote a JSX like DSL for Lean 4 in PR <a href="https://github.com/leanprover/lean4/pull/723">#723</a> so you could probably just adapt that.</p>



<a name="263899272"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/html%20in%20doc-gen4/near/263899272" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/html.20in.20doc-gen4.html#263899272">(Dec 06 2021 at 19:00)</a>:</h4>
<p>Jinja2 is really great. JSX looks a lot less attractive, but comparing the two is probably meaningless anyway, they have different purposes.</p>



<a name="263900832"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/html%20in%20doc-gen4/near/263900832" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/html.20in.20doc-gen4.html#263900832">(Dec 06 2021 at 19:12)</a>:</h4>
<p>Interesting how opinions can differ.  What do you like about jinja2 compared to jsx?</p>



<a name="263900902"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/html%20in%20doc-gen4/near/263900902" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/html.20in.20doc-gen4.html#263900902">(Dec 06 2021 at 19:12)</a>:</h4>
<p>It's really straightforward to understand and use, and nice to write.</p>



<a name="263900977"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/html%20in%20doc-gen4/near/263900977" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/html.20in.20doc-gen4.html#263900977">(Dec 06 2021 at 19:13)</a>:</h4>
<p>Note that we use jinja2 a <em>lot</em> on our community website.</p>



<a name="263901197"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/html%20in%20doc-gen4/near/263901197" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/html.20in.20doc-gen4.html#263901197">(Dec 06 2021 at 19:15)</a>:</h4>
<p>I think that's only a question of experience.  If you have used more jsx then jsx will feel more straightforward.  (As a bonus there's no if-then-else or for or include or filter syntax to learn in jsx, it's literally the same syntax as javascript.  In the Lean DSL, it's literally Lean expressions.)</p>



<a name="263901359"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/html%20in%20doc-gen4/near/263901359" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/html.20in.20doc-gen4.html#263901359">(Dec 06 2021 at 19:16)</a>:</h4>
<p>(Did I mention that you have type-checking in your templates?  You'll never forget to declare a filter again.)</p>



<a name="263923826"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/html%20in%20doc-gen4/near/263923826" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Wojciech Nawrocki <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/html.20in.20doc-gen4.html#263923826">(Dec 06 2021 at 21:00)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110024">Sebastian Ullrich</span> <a href="#narrow/stream/270676-lean4/topic/html.20in.20doc-gen4/near/263830096">said</a>:</p>
<blockquote>
<p>The delaborator attaches synthetic positions to the generated <code>Syntax</code> objects that can be used to retrieve the original <code>Expr</code>, which you could e.g. check for being an <code>Expr.const</code>, or an application thereof (<code>Expr.getAppFn</code>) if you also want to e.g. link <code>+</code> to <code>Add.add</code>. The function for looking up the subterm given the position should be <a href="https://github.com/leanprover/lean4/blob/45917f2f900f177259eebc7a6740193f86292927/src/Lean/Widget/InteractiveCode.lean#L39">https://github.com/leanprover/lean4/blob/45917f2f900f177259eebc7a6740193f86292927/src/Lean/Widget/InteractiveCode.lean#L39</a>, though apparently it is currently unused (because a TypeScript version is used instead in the client?).</p>
</blockquote>
<p>The association between Syntax elements and their source Exprs is currently unused because it is subsumed by the <code>InfoTree</code> output. Basically the delaborator will give you back a Syntax together with an RBMap from positions within this syntax to <code>Elab.Info</code> objects, as in <a href="https://github.com/leanprover/lean4/blob/7b6732a137a436a64e00f9d319e2a345b517be2d/src/Lean/Widget/InteractiveCode.lean#L82">here</a>. You can then query this RBMap and in your example at the ℕ syntax tree it will contain something like (iirc) <code>Elab.Info.ofTermInfo</code> with an <code>expr</code> whose value is <code>Nat : Type</code>.</p>



<a name="264131942"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/html%20in%20doc-gen4/near/264131942" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/html.20in.20doc-gen4.html#264131942">(Dec 08 2021 at 09:40)</a>:</h4>
<blockquote>
<p>The delaborator attaches synthetic positions to the generated <code>Syntax</code> objects <em>that can be used to retrieve the original <code>Expr</code></em>, [...] The function for looking up the subterm given the position should be [<code>Lean.Widget.traverse</code>] apparently it is currently unused [...]</p>
</blockquote>
<p>I forgot to comment on this remark, but I have to warn you that it is only half-true.  Such a function could work for direct subterms (for example <code>a + 0</code> as a subterm of <code>42 * (a+0)</code>), but the pretty-printer also produces syntax which does not directly correspond to subterms.  These have a dedicated position called <code>nextExtraPos</code>.</p>
<p>And this is not just a theoretical possibility: core Lean already makes use of this feature.  Namely when pretty-printing structure instances: the expression <code>A.mk 42</code> is printed as <code>{ a := 42 }</code>.  The field name <code>a</code> is not a subterm of the original expression, but it has information attached.  Users can also add their own delaborators which may even have whole expressions and not just identifiers on these non-existing positions.</p>
<p>As Wojciech said, please just use the <code>InfoTree</code> output instead.  The current <code>Lean.Widget.traverse</code> implementation also silently returns the wrong(?) result for these non-existing positions, so avoid it.</p>



<a name="264766729"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/html%20in%20doc-gen4/near/264766729" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Henrik Böving <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/html.20in.20doc-gen4.html#264766729">(Dec 13 2021 at 20:38)</a>:</h4>
<p><span class="user-mention silent" data-user-id="315577">Mac</span> <a href="#narrow/stream/270676-lean4/topic/html.20in.20doc-gen4/near/263896693">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="110024">Sebastian Ullrich</span> <a href="#narrow/stream/270676-lean4/topic/html.20in.20doc-gen4/near/263896259">said</a>:</p>
<blockquote>
<p>I assume JSX/TSX would be a better source of inspiration, though I've never used them</p>
</blockquote>
<p><span class="user-mention silent" data-user-id="395550">Henrik Böving</span>, note that <span class="user-mention silent" data-user-id="128280">Wojciech Nawrocki</span> already wrote a JSX like DSL for Lean 4 in PR <a href="https://github.com/leanprover/lean4/pull/723">#723</a> so you could probably just adapt that.</p>
</blockquote>
<p>Its making progress with Lean/JSX: <br>
<a href="/user_uploads/3121/0y8n_1kNSna4RNxmfypwy9mS/image.png">image.png</a> </p>
<div class="message_inline_image"><a href="/user_uploads/3121/0y8n_1kNSna4RNxmfypwy9mS/image.png" title="image.png"><img src="/user_uploads/3121/0y8n_1kNSna4RNxmfypwy9mS/image.png"></a></div><p>Also working with that DSL was an absolute joy, basically everything I wanted just worked <span aria-label="tm" class="emoji emoji-2122" role="img" title="tm">:tm:</span> \o/</p>



<a name="264766838"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/html%20in%20doc-gen4/near/264766838" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Henrik Böving <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/html.20in.20doc-gen4.html#264766838">(Dec 13 2021 at 20:39)</a>:</h4>
<p>I also hope its fine I'm basically copy pasting the css and js files from doc-gen? They are both under apache2 after all...</p>



<a name="264772409"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/html%20in%20doc-gen4/near/264772409" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/html.20in.20doc-gen4.html#264772409">(Dec 13 2021 at 21:28)</a>:</h4>
<p><span class="user-mention" data-user-id="395550">@Henrik Böving</span> You <a href="#narrow/stream/270676-lean4/topic/doc-gen4/near/264464665">recently said</a> that we wouldn't need to rely on something like Read the Docs. Do you have other ideas to make the task of hosting documentation easy and accessible?</p>



<a name="264772518"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/html%20in%20doc-gen4/near/264772518" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Henrik Böving <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/html.20in.20doc-gen4.html#264772518">(Dec 13 2021 at 21:29)</a>:</h4>
<p>Right now its just a static webpage so you could even put it on github pages if you wanted to.</p>



<a name="264772683"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/html%20in%20doc-gen4/near/264772683" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/html.20in.20doc-gen4.html#264772683">(Dec 13 2021 at 21:30)</a>:</h4>
<p>But then you'd need a <code>...github.io</code> repository for every project?<br>
Or push <code>doc</code> folders to a centralized <code>.github.io</code> repository and separate by path (like <code>arthurpaulino.github.io/proj1</code>, <code>arthurpaulino.github.io/proj2</code>, ...)</p>



<a name="264773391"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/html%20in%20doc-gen4/near/264773391" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Henrik Böving <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/html.20in.20doc-gen4.html#264773391">(Dec 13 2021 at 21:37)</a>:</h4>
<p>That's at least how mathlib is doing it right now. <a href="https://github.com/leanprover-community/mathlib_docs">https://github.com/leanprover-community/mathlib_docs</a>. I would imagine that if lean actually takes off to the point where a lot of people are interested in the rendered and searchable documentation of libraries (right now I can only think of mathlib4 and the lean compiler itself + maybe this stdlib++ thing we have been talking about) a service like <a href="https://docs.rs">https://docs.rs</a> would eventually emerge.</p>



<a name="265442814"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/html%20in%20doc-gen4/near/265442814" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Henrik Böving <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/html.20in.20doc-gen4.html#265442814">(Dec 18 2021 at 20:52)</a>:</h4>
<p><span class="user-mention silent" data-user-id="128280">Wojciech Nawrocki</span> <a href="#narrow/stream/270676-lean4/topic/html.20in.20doc-gen4/near/263923826">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="110024">Sebastian Ullrich</span> <a href="#narrow/stream/270676-lean4/topic/html.20in.20doc-gen4/near/263830096">said</a>:</p>
<blockquote>
<p>The delaborator attaches synthetic positions to the generated <code>Syntax</code> objects that can be used to retrieve the original <code>Expr</code>, which you could e.g. check for being an <code>Expr.const</code>, or an application thereof (<code>Expr.getAppFn</code>) if you also want to e.g. link <code>+</code> to <code>Add.add</code>. The function for looking up the subterm given the position should be <a href="https://github.com/leanprover/lean4/blob/45917f2f900f177259eebc7a6740193f86292927/src/Lean/Widget/InteractiveCode.lean#L39">https://github.com/leanprover/lean4/blob/45917f2f900f177259eebc7a6740193f86292927/src/Lean/Widget/InteractiveCode.lean#L39</a>, though apparently it is currently unused (because a TypeScript version is used instead in the client?).</p>
</blockquote>
<p>The association between Syntax elements and their source Exprs is currently unused because it is subsumed by the <code>InfoTree</code> output. Basically the delaborator will give you back a Syntax together with an RBMap from positions within this syntax to <code>Elab.Info</code> objects, as in <a href="https://github.com/leanprover/lean4/blob/7b6732a137a436a64e00f9d319e2a345b517be2d/src/Lean/Widget/InteractiveCode.lean#L82">here</a>. You can then query this RBMap and in your example at the ℕ syntax tree it will contain something like (iirc) <code>Elab.Info.ofTermInfo</code> with an <code>expr</code> whose value is <code>Nat : Type</code>.</p>
</blockquote>
<p>I saw that in the Widget module you use this <code>TaggedText</code> type with <code>CodeTokens</code> so I decided to take a look at that as well but I'm facing a slight isuee, for a type such as: <code>IO ℕ</code> it produces (the info's themselves are replaced with 1s so i can actually pretty print it):</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">Lean.Widget.TaggedText.tag</span>
  <span class="mi">1</span>
  <span class="o">(</span><span class="n">Lean.Widget.TaggedText.append</span>
    <span class="bp">#</span><span class="o">[</span><span class="n">Lean.Widget.TaggedText.text</span> <span class="s2">"IO "</span><span class="o">,</span> <span class="n">Lean.Widget.TaggedText.tag</span> <span class="mi">1</span> <span class="o">(</span><span class="n">Lean.Widget.TaggedText.text</span> <span class="s2">"ℕ"</span><span class="o">)])</span>
</code></pre></div>
<p>so with these tagged things it seems like the information about what <code>IO</code> itself actually is is attached to the entire application of <code>IO</code> (and indeed the <code>Expr</code> associated with this group is an application so that's perfectly fine) but for my purposes it would of course be better if the information about the type <code>IO</code> was attached there as well and not just represented as a <code>TaggedText.text</code> so I tried to take another step back and look at the output of format but:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">Std.Format.group</span>
  <span class="o">(</span><span class="n">Std.Format.group</span>
    <span class="o">(</span><span class="n">Std.Format.nest</span>
      <span class="mi">2</span>
      <span class="o">(</span><span class="n">Std.Format.tag</span>
        <span class="mi">1</span>
        <span class="o">(</span><span class="n">Std.Format.append</span>
          <span class="o">(</span><span class="n">Std.Format.group</span> <span class="o">(</span><span class="n">Std.Format.nest</span> <span class="mi">2</span> <span class="o">(</span><span class="n">Std.Format.text</span> <span class="s2">"IO"</span><span class="o">))</span> <span class="o">(</span><span class="n">Std.Format.FlattenBehavior.fill</span><span class="o">))</span>
          <span class="o">(</span><span class="n">Std.Format.append</span>
            <span class="o">(</span><span class="n">Std.Format.line</span><span class="o">)</span>
            <span class="o">(</span><span class="n">Std.Format.group</span>
              <span class="o">(</span><span class="n">Std.Format.nest</span> <span class="mi">2</span> <span class="o">(</span><span class="n">Std.Format.tag</span> <span class="mi">5</span> <span class="o">(</span><span class="n">Std.Format.text</span> <span class="s2">"ℕ"</span><span class="o">)))</span>
              <span class="o">(</span><span class="n">Std.Format.FlattenBehavior.fill</span><span class="o">))))))</span>
    <span class="o">(</span><span class="n">Std.Format.FlattenBehavior.fill</span><span class="o">))</span>
  <span class="o">(</span><span class="n">Std.Format.FlattenBehavior.fill</span><span class="o">)</span>
</code></pre></div>
<p>Format already associates this tag info with the entire application instead of just the single type as well...so now I'm kind of lost which datastructure I want to operate on to actually get information I want? Shall I operate on the raw <code>Syntax</code> output for this? I'm just asking so I don't go down a rabbit hole just to learn that it was pointless all the time.</p>



<a name="265535298"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/html%20in%20doc-gen4/near/265535298" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Henrik Böving <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/html.20in.20doc-gen4.html#265535298">(Dec 20 2021 at 08:48)</a>:</h4>
<p>Or maybe <span class="user-mention" data-user-id="110043">@Gabriel Ebner</span> has an idea about this?</p>



<a name="265536168"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/html%20in%20doc-gen4/near/265536168" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/html.20in.20doc-gen4.html#265536168">(Dec 20 2021 at 08:57)</a>:</h4>
<p>From what I can tell the delaborator doesn't add any information to syntax trees produced for constants yet.</p>



<a name="265536259"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/html%20in%20doc-gen4/near/265536259" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/html.20in.20doc-gen4.html#265536259">(Dec 20 2021 at 08:58)</a>:</h4>
<p>That's because this feature has so far only been used for the interactive widgets, where we want information for the whole application and not the head symbol.</p>



<a name="265536538"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/html%20in%20doc-gen4/near/265536538" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/html.20in.20doc-gen4.html#265536538">(Dec 20 2021 at 09:00)</a>:</h4>
<p>What I think should happen:</p>
<ol>
<li>Call annotateCurPos&amp;addTermInfo from delabConst.</li>
<li>Ignore those extra infos in tagExprInfos.</li>
</ol>



<a name="265536892"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/html%20in%20doc-gen4/near/265536892" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Henrik Böving <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/html.20in.20doc-gen4.html#265536892">(Dec 20 2021 at 09:04)</a>:</h4>
<p>Ah so getting this to work properly does actually require some changes in the compiler?</p>



<a name="265537060"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/html%20in%20doc-gen4/near/265537060" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/html.20in.20doc-gen4.html#265537060">(Dec 20 2021 at 09:06)</a>:</h4>
<p>AFAICT yes, this requires some changes in lean.</p>



<a name="265537130"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/html%20in%20doc-gen4/near/265537130" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Henrik Böving <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/html.20in.20doc-gen4.html#265537130">(Dec 20 2021 at 09:07)</a>:</h4>
<p>Do you think this is a change someone (such as me :p) should contribute or should I just open an issue about it?</p>



<a name="265537494"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/html%20in%20doc-gen4/near/265537494" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/html.20in.20doc-gen4.html#265537494">(Dec 20 2021 at 09:12)</a>:</h4>
<p>I've outlined the change above, I'd guess it's about ten lines of code or so and should be straightforward. ^^</p>



<a name="265537545"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/html%20in%20doc-gen4/near/265537545" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/html.20in.20doc-gen4.html#265537545">(Dec 20 2021 at 09:12)</a>:</h4>
<p>cc <span class="user-mention" data-user-id="110024">@Sebastian Ullrich</span> <span class="user-mention" data-user-id="128280">@Wojciech Nawrocki</span> Do you also think this is the way to go here?</p>



<a name="265537606"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/html%20in%20doc-gen4/near/265537606" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/html.20in.20doc-gen4.html#265537606">(Dec 20 2021 at 09:13)</a>:</h4>
<p>Anything that makes the delaborator match the elaborator more closely sounds reasonable to me</p>



<a name="265543278"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/html%20in%20doc-gen4/near/265543278" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/html.20in.20doc-gen4.html#265543278">(Dec 20 2021 at 10:12)</a>:</h4>
<p>I'm very happy to see work on doc-gen4 but I always wonder. How does this interact with the work on <a href="https://github.com/insightmind/LeanInk/">LeanInk</a>? It seems to me there should be at least some overlap. Is there any coordination here?</p>



<a name="265544121"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/html%20in%20doc-gen4/near/265544121" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Henrik Böving <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/html.20in.20doc-gen4.html#265544121">(Dec 20 2021 at 10:21)</a>:</h4>
<p>There isn't any coordination right now no. If I understood the purpose of Leanink/Alectryon correctly it's a tool, mostly meant for interactively exploring the state of a tactic proof at different steps throughout the proof right? The program itself mainly focuses on obtaining these states from the Lean compiler and handing them over to Alectryon via an export format. So it's basically a tool for taking a look at the internals of a proof.</p>
<p>Meanwhile the focus of doc-gen4 is to provide more of an external view on a Lean module, ala "what do I get if I import module XYZ" and also navigating between modules. I would imagine that both could indeed be combined by e.g. linking from doc-gen4 theorem's to the ink view and maybe from the types etc. used in Alectryon back to doc-gen4? But that sounds like something that would be done when both tools are at least sort of mature themselves.</p>
<p>What does <span class="user-mention" data-user-id="451040">@Niklas Bülow</span> think about our overlap? And how/if the tools should integrate into each other?</p>



<a name="265546483"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/html%20in%20doc-gen4/near/265546483" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/html.20in.20doc-gen4.html#265546483">(Dec 20 2021 at 10:44)</a>:</h4>
<p>Exactly, I think both should be combined. It's annoying in the current Lean 3 doc-gen that you can't easily see proofs, and it's even worse you can't see the body of a definition.</p>



<a name="265546828"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/html%20in%20doc-gen4/near/265546828" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Taucher <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/html.20in.20doc-gen4.html#265546828">(Dec 20 2021 at 10:48)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110031">Patrick Massot</span> <a href="#narrow/stream/270676-lean4/topic/html.20in.20doc-gen4/near/265546483">said</a>:</p>
<blockquote>
<p>can't easily see proofs</p>
</blockquote>
<p>For <code>see</code> I am thinking that the proof would be static text inline with the document.</p>
<p>Are you and/or meaning <code>link to</code> in that one can click on a link if the document is open in a viewer such as an internet browser or PDF reader?</p>



<a name="265547349"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/html%20in%20doc-gen4/near/265547349" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/html.20in.20doc-gen4.html#265547349">(Dec 20 2021 at 10:54)</a>:</h4>
<p>I'm sorry, I don't understand the question. By seeing proofs, I mean getting at least as much information on a proof as you can get from within VSCode.</p>



<a name="265550062"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/html%20in%20doc-gen4/near/265550062" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Taucher <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/html.20in.20doc-gen4.html#265550062">(Dec 20 2021 at 11:20)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110031">Patrick Massot</span> <a href="#narrow/stream/270676-lean4/topic/html.20in.20doc-gen4/near/265547349">said</a>:</p>
<blockquote>
<p>By seeing proofs, I mean getting at least as much information on a proof as you can get from within VSCode.</p>
</blockquote>
<p>That clarifies it enough that I understand what you mean. Thanks.</p>



<a name="265619398"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/html%20in%20doc-gen4/near/265619398" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Niklas Bülow <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/html.20in.20doc-gen4.html#265619398">(Dec 20 2021 at 21:48)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110031">Patrick Massot</span> <a href="#narrow/stream/270676-lean4/topic/html.20in.20doc-gen4/near/265546483">said</a>:</p>
<blockquote>
<p>Exactly, I think both should be combined. It's annoying in the current Lean 3 doc-gen that you can't easily see proofs, and it's even worse you can't see the body of a definition.</p>
</blockquote>
<p>I think making use of LeanInk and Alectryon for doc-gen4 would benefit the generated docs a lot. LeanInk itself just extracts the necessary data from the lean compiler so Alectryon can then generate a website that allows exploring the lean code interactively. doc-gen could use this to embed explorable code snippets of a given proof into the documentation.</p>
<p>LeanInk currently only extracts the tactic info and displays them at the corresponding location in the code. This implementation is complete. We are now trying to extend the functionality to also display type information and probably the doc-string on hover, similar to the hover popups in VSCode. </p>
<p>We could probably implement an interface in LeanInk, so it can be used as a dependency more easily. This would allow doc-gen4 to call it directly and maybe give it some additional info (links to other doc pages etc.). Alectryon does offer a way to generate HTML directly from the export format that LeanInk generates, so calling that should be sufficient for the use case.</p>



<a name="265623089"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/html%20in%20doc-gen4/near/265623089" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/html.20in.20doc-gen4.html#265623089">(Dec 20 2021 at 22:24)</a>:</h4>
<p>It would be really nice to make sure the work you do on LeanInk is not too much tied to Alectryon. Getting all that information out of a Lean file without pretending to be an editor is a really important task. One thing that makes current Alectryon a lot less useful than it could be is that it really work at a single file level, and doesn't include "jump to definition" links.</p>



<a name="265630295"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/html%20in%20doc-gen4/near/265630295" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Niklas Bülow <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/html.20in.20doc-gen4.html#265630295">(Dec 20 2021 at 23:55)</a>:</h4>
<p>Sorry, I think I’m not fully understanding what you’re trying to say.</p>



<a name="265638035"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/html%20in%20doc-gen4/near/265638035" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/html.20in.20doc-gen4.html#265638035">(Dec 21 2021 at 01:43)</a>:</h4>
<p>One (minor) concern that I have is that Alectryon is a Python lib whereas <code>doc-gen4</code> is a pure Lean 4 package, AFAIK. So adding <code>LeanInk</code> as a dependency of <code>doc-gen4</code> would carry out the Python dependency.</p>
<p>Lean setup, however, already depends on having Python available <span aria-label="big smile" class="emoji emoji-1f604" role="img" title="big smile">:big_smile:</span></p>



<a name="265665505"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/html%20in%20doc-gen4/near/265665505" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/html.20in.20doc-gen4.html#265665505">(Dec 21 2021 at 09:42)</a>:</h4>
<p>Niklas, could you tell me more precisely what you don't understand? Let's take an example. If you look at <a href="https://alectryon-paper.github.io/snippets/ide.html">https://alectryon-paper.github.io/snippets/ide.html</a>, you can see tactic state everywhere, but there is no way you can see what is the statement of <code>Mult.mult_plus_distr_l</code> or jump to the definition of <code>sum</code>.  This is why I say Alectryon is a great tool, but not enough. So I hope than LeanInk will be able to generate more data, either for consumption by Alectryon or, preferably, for consumption by any other tool.</p>



<a name="265665832"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/html%20in%20doc-gen4/near/265665832" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/html.20in.20doc-gen4.html#265665832">(Dec 21 2021 at 09:46)</a>:</h4>
<p>Note that I also think we should have more powerful ways to read Lean 4 files. For instance it would be very nice if we could allows users to build alternative implementations of tactics that would probably be a bit slower,  hence unsuitable for interactive use, but would emit more information for LeanInk/doc-gen4.  For a semi-realistic example, each tactic line could also output the constructed partial proof term, as in mathlib's <a href="https://leanprover-community.github.io/mathlib_docs/tactics.html#show_term">tactic#show_term</a>.</p>



<a name="265665986"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/html%20in%20doc-gen4/near/265665986" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/html.20in.20doc-gen4.html#265665986">(Dec 21 2021 at 09:48)</a>:</h4>
<p>I don't think that requires changing the tactic though, you can get that information from the tactic state already (so you don't even need to run the proof again).</p>



<a name="265666099"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/html%20in%20doc-gen4/near/265666099" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/html.20in.20doc-gen4.html#265666099">(Dec 21 2021 at 09:49)</a>:</h4>
<p>I completely agree that it would be awesome to have LeanInk in doc-gen4 and with more features.</p>



<a name="265666572"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/html%20in%20doc-gen4/near/265666572" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/html.20in.20doc-gen4.html#265666572">(Dec 21 2021 at 09:54)</a>:</h4>
<p>Gabriel, I don't understand how the tactic static could give you the partial proof term.</p>



<a name="265666616"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/html%20in%20doc-gen4/near/265666616" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/html.20in.20doc-gen4.html#265666616">(Dec 21 2021 at 09:55)</a>:</h4>
<p>And what I actually have in mind is constructing a natural language proof from a tactic script.</p>



<a name="265667201"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/html%20in%20doc-gen4/near/265667201" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/html.20in.20doc-gen4.html#265667201">(Dec 21 2021 at 10:00)</a>:</h4>
<blockquote>
<p>Gabriel, I don't understand how the tactic static could give you the partial proof term.</p>
</blockquote>
<p>Goals are represented as metavariables in Lean.  Solving a goal with a proof term is technically the same as assigning the proof term to the metavariable.  And the tactic state contains the meta-variable assignment.  So if you have the tactic state from before and after you can just look if any goal metavariables have been assigned, and that's the partial proof term.</p>



<a name="265668318"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/html%20in%20doc-gen4/near/265668318" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/html.20in.20doc-gen4.html#265668318">(Dec 21 2021 at 10:13)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110031">Patrick Massot</span> <a href="#narrow/stream/270676-lean4/topic/html.20in.20doc-gen4/near/265665505">said</a>:</p>
<blockquote>
<p>So I hope than LeanInk will be able to generate more data, either for consumption by Alectryon or, preferably, for consumption by any other tool.</p>
</blockquote>
<p>Yes, adding more metadata to the output is the plan as Niklas mentioned. See e.g. <a href="https://github.com/insightmind/LeanInk/blob/main/test/theorem_proving/009.lean.leanInk.expected">https://github.com/insightmind/LeanInk/blob/main/test/theorem_proving/009.lean.leanInk.expected</a> for the current output.</p>



<a name="265669489"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/html%20in%20doc-gen4/near/265669489" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/html.20in.20doc-gen4.html#265669489">(Dec 21 2021 at 10:24)</a>:</h4>
<p>Note that the most fundamental difference between LeanInk and doc-gen is that LeanInk works from the Lean source input (including literate comments in between code) while doc-gen works from the delaborated .olean input. The latter is not inferior, it means that e.g. <code>variable</code>s are inlined into all signatures, which is the right thing to do for API docs. But because both views of the same Lean module are useful, the simplest way to combine their strengths would be to generate both and add links between them, like Haddock does. It would still be nice if they shared the behavior and perhaps implementation of common features such as hover of course.</p>



<a name="265671013"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/html%20in%20doc-gen4/near/265671013" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/html.20in.20doc-gen4.html#265671013">(Dec 21 2021 at 10:44)</a>:</h4>
<p>I don't understand why LeanInk couldn't reconstruct the signature with inlined variables.</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>