---
layout: archive
title: Zulip Chat Archive
permalink: /stream/270676-lean4/topic/lakefile.20dependencies.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/index.html">lean4</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/lakefile.20dependencies.html">lakefile dependencies</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="289735072"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/lakefile%20dependencies/near/289735072" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jesse Vogel <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/lakefile.20dependencies.html#289735072">(Jul 15 2022 at 14:34)</a>:</h4>
<p>It has been a few months since I updated my lean version, but something has changed so that my lakefile.lean doesn't work anymore. I get the following error: <code>'dependencies' is not a field of structure 'Lake.PackageConfig'</code>. How should I add dependencies now? My lakefile.lean is as follows:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">Lake</span>
<span class="kn">open</span> <span class="n">Lake</span> <span class="n">DSL</span>

<span class="n">package</span> <span class="n">MyPackage</span> <span class="o">{</span>
  <span class="n">dependencies</span> <span class="o">:=</span> <span class="bp">#</span><span class="o">[{</span>
    <span class="n">name</span> <span class="o">:=</span> <span class="bp">`</span><span class="n">name</span>
    <span class="n">src</span> <span class="o">:=</span> <span class="n">Source.git</span> <span class="s2">"&lt;url&gt;"</span> <span class="s2">"&lt;commit&gt;"</span>
  <span class="o">}]</span>
<span class="o">}</span>
</code></pre></div>



<a name="289735391"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/lakefile%20dependencies/near/289735391" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Julian Berman <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/lakefile.20dependencies.html#289735391">(Jul 15 2022 at 14:36)</a>:</h4>
<p>The DSL syntax changed. The Lake readme has <a href="https://github.com/leanprover/lake#creating-and-building-a-package">an example</a>, basically change it to:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">Lake</span>
<span class="kn">open</span> <span class="n">Lake</span> <span class="n">DSL</span>

<span class="n">package</span> <span class="n">MyPackage</span>

<span class="n">require</span> <span class="n">name</span> <span class="k">from</span> <span class="n">git</span>
  <span class="s2">"&lt;url&gt;"</span>
</code></pre></div>



<a name="289735527"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/lakefile%20dependencies/near/289735527" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/lakefile.20dependencies.html#289735527">(Jul 15 2022 at 14:37)</a>:</h4>
<p>You usually want to drop <code>@"&lt;commit&gt;"</code>, it is persisted in the manifest.json</p>



<a name="289735578"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/lakefile%20dependencies/near/289735578" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Julian Berman <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/lakefile.20dependencies.html#289735578">(Jul 15 2022 at 14:37)</a>:</h4>
<p>Ah interesting, good to know.</p>



<a name="289735696"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/lakefile%20dependencies/near/289735696" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Julian Berman <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/lakefile.20dependencies.html#289735696">(Jul 15 2022 at 14:38)</a>:</h4>
<p>(Obviously what Sebastian said, though if you have <code>lean_packages/</code> in your gitignore remember to un-ignore <code>lean_packages/manifest.json</code> then)</p>



<a name="289738015"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/lakefile%20dependencies/near/289738015" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Tomas Skrivan <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/lakefile.20dependencies.html#289738015">(Jul 15 2022 at 14:56)</a>:</h4>
<p>Another thing I have encountered recently. My build fails if I'm offline as dependencies can't be updated. How can I ignore this?</p>



<a name="289755302"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/lakefile%20dependencies/near/289755302" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/lakefile.20dependencies.html#289755302">(Jul 15 2022 at 17:07)</a>:</h4>
<p><span class="user-mention" data-user-id="346070">@Tomas Skrivan</span> Lake should not be trying to update dependencies if you are running a regular <code>lake build</code> instead of a <code>lake update</code> (and you have already download an initial set of dependencies). Can you elaborate more on the problem you are experiencing?</p>



<a name="289756688"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/lakefile%20dependencies/near/289756688" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Tomas Skrivan <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/lakefile.20dependencies.html#289756688">(Jul 15 2022 at 17:19)</a>:</h4>
<p><span class="user-mention" data-user-id="315577">@Mac</span>  When I disconnect from the internet and run <code>lake build</code> I get the following error:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">error</span><span class="o">:</span> <span class="n">stderr</span><span class="o">:</span>
<span class="n">fatal</span><span class="o">:</span> <span class="n">unable</span> <span class="n">to</span> <span class="n">access</span> <span class="bp">'</span><span class="n">https</span><span class="o">:</span><span class="bp">//</span><span class="n">github.com</span><span class="bp">/</span><span class="n">leanprover</span><span class="bp">-</span><span class="n">community</span><span class="bp">/</span><span class="n">mathlib4.git</span><span class="bp">/'</span><span class="o">:</span> <span class="n">Could</span> <span class="n">not</span> <span class="n">resolve</span> <span class="n">host</span><span class="o">:</span> <span class="n">github.com</span>
<span class="n">error</span><span class="o">:</span> <span class="n">git</span> <span class="n">exited</span> <span class="k">with</span> <span class="n">code</span> <span class="mi">128</span>
</code></pre></div>
<p>My lakefile is:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">Lake</span>
<span class="kn">open</span> <span class="n">Lake</span> <span class="n">DSL</span> <span class="n">System</span>

<span class="n">package</span> <span class="n">scilean</span>

<span class="n">require</span> <span class="n">mathlib</span> <span class="k">from</span> <span class="n">git</span>
  <span class="s2">"https://github.com/leanprover-community/mathlib4.git"</span><span class="bp">@</span><span class="s2">"8f609e0ed826dde127c8bc322cb6f91c5369d37a"</span>

<span class="kd">@[defaultTarget]</span>
<span class="n">lean_lib</span> <span class="n">SciLean</span> <span class="o">{</span>
  <span class="n">roots</span> <span class="o">:=</span> <span class="bp">#</span><span class="o">[</span><span class="bp">`</span><span class="n">SciLean</span><span class="o">]</span>
<span class="o">}</span>
</code></pre></div>
<p>Lean version is: <code>leanprover/lean4:nightly-2022-07-11</code></p>



<a name="289759569"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/lakefile%20dependencies/near/289759569" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/lakefile.20dependencies.html#289759569">(Jul 15 2022 at 17:42)</a>:</h4>
<p><span class="user-mention" data-user-id="346070">@Tomas Skrivan</span> do you think you could make that an issue on the Lake repo? Or, if you'd rather I can do it myself.</p>



<a name="289759827"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/lakefile%20dependencies/near/289759827" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Tomas Skrivan <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/lakefile.20dependencies.html#289759827">(Jul 15 2022 at 17:44)</a>:</h4>
<p><span class="user-mention" data-user-id="315577">@Mac</span>  Sure, I make an issue and try to reproduce it on a clean repo.</p>



<a name="289759934"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/lakefile%20dependencies/near/289759934" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/lakefile.20dependencies.html#289759934">(Jul 15 2022 at 17:45)</a>:</h4>
<p>Thanks! I do believe I already have a fix. The issue is mostly for posterity sake (and it give a number to the test <span aria-label="wink" class="emoji emoji-1f609" role="img" title="wink">:wink:</span>)</p>



<a name="289760662"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/lakefile%20dependencies/near/289760662" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Tomas Skrivan <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/lakefile.20dependencies.html#289760662">(Jul 15 2022 at 17:52)</a>:</h4>
<p>Github <a href="https://github.com/leanprover/lake/issues/104">issue #104</a></p>



<a name="291228000"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/lakefile%20dependencies/near/291228000" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> z battleman <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/lakefile.20dependencies.html#291228000">(Jul 28 2022 at 17:46)</a>:</h4>
<p>In trying to do this it's telling me it's expecting a command at the line where I call the <code>require</code>. I suspect its because my syntax for the package is different, but I'm not sure. Does anyone know how to do this? Here is my Lakefile</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">Lake</span>
<span class="kn">open</span> <span class="n">System</span> <span class="n">Lake</span> <span class="n">DSL</span>

<span class="kd">def</span> <span class="n">cDir</span> <span class="o">:</span> <span class="n">FilePath</span> <span class="o">:=</span> <span class="s2">"c"</span>
<span class="kd">def</span> <span class="n">ffiSrc</span> <span class="o">:=</span> <span class="n">cDir</span> <span class="bp">/</span> <span class="s2">"bindings.c"</span>
<span class="kd">def</span> <span class="n">buildDir</span> <span class="o">:=</span> <span class="n">defaultBuildDir</span>
<span class="kd">def</span> <span class="n">packagesDir</span> <span class="o">:=</span> <span class="s2">"third_party"</span>

<span class="kd">def</span> <span class="n">ffiOTarget</span> <span class="o">(</span><span class="n">pkgDir</span> <span class="o">:</span> <span class="n">FilePath</span><span class="o">)</span> <span class="o">:</span> <span class="n">FileTarget</span> <span class="o">:=</span>
  <span class="k">let</span> <span class="n">oFile</span> <span class="o">:=</span> <span class="n">pkgDir</span> <span class="bp">/</span> <span class="n">buildDir</span> <span class="bp">/</span> <span class="n">cDir</span> <span class="bp">/</span> <span class="s2">"bindings.o"</span>
  <span class="k">let</span> <span class="n">srcTarget</span> <span class="o">:=</span> <span class="n">inputFileTarget</span> <span class="bp">&lt;|</span> <span class="n">pkgDir</span> <span class="bp">/</span> <span class="n">ffiSrc</span>
  <span class="n">fileTargetWithDep</span> <span class="n">oFile</span> <span class="n">srcTarget</span> <span class="k">fun</span> <span class="n">srcFile</span> <span class="bp">=&gt;</span> <span class="k">do</span>
    <span class="n">compileO</span> <span class="n">oFile</span> <span class="n">srcFile</span> <span class="bp">#</span><span class="o">[</span><span class="s2">"-I"</span><span class="o">,</span> <span class="o">(</span><span class="bp">←</span> <span class="n">getLeanIncludeDir</span><span class="o">)</span><span class="bp">.</span><span class="n">toString</span><span class="o">,</span>
                             <span class="s2">"-I"</span><span class="o">,</span> <span class="s2">"third_party/OpenBLASLib/include"</span><span class="o">]</span>


<span class="kd">def</span> <span class="n">cLibTarget</span> <span class="o">(</span><span class="n">pkgDir</span> <span class="o">:</span> <span class="n">FilePath</span><span class="o">)</span> <span class="o">:</span> <span class="n">FileTarget</span> <span class="o">:=</span>
  <span class="k">let</span> <span class="n">libFile</span> <span class="o">:=</span> <span class="n">pkgDir</span> <span class="bp">/</span> <span class="n">buildDir</span> <span class="bp">/</span> <span class="n">cDir</span> <span class="bp">/</span> <span class="s2">"libffi.a"</span>
  <span class="n">staticLibTarget</span> <span class="n">libFile</span> <span class="bp">#</span><span class="o">[</span><span class="n">ffiOTarget</span> <span class="n">pkgDir</span><span class="o">]</span>


<span class="n">package</span> <span class="n">LeanAlg</span> <span class="o">(</span><span class="n">pkgDir</span><span class="o">)</span> <span class="o">(</span><span class="n">args</span><span class="o">)</span> <span class="o">{</span>

  <span class="c1">-- customize layout</span>
  <span class="c1">--srcDir := "LeanAlg"</span>
  <span class="c1">--libRoots := #[`mathVec, `mathMatrix]</span>
  <span class="c1">-- specify the lib as an additional target</span>
  <span class="n">moreLibTargets</span> <span class="o">:=</span> <span class="bp">#</span><span class="o">[</span><span class="n">cLibTarget</span> <span class="n">pkgDir</span><span class="o">]</span>
  <span class="n">moreLinkArgs</span> <span class="o">:=</span> <span class="bp">#</span><span class="o">[</span><span class="s2">"-L"</span><span class="o">,</span> <span class="s2">"./third_party/OpenBLASLib/lib"</span><span class="o">,</span>
                    <span class="s2">"-lopenblas"</span><span class="o">,</span>
                    <span class="s2">"-Wl,-R./third_party/OpenBLASLib/lib"</span><span class="o">]</span>
<span class="o">}</span>

<span class="n">require</span> <span class="n">mathlib</span> <span class="k">from</span> <span class="n">git</span>
  <span class="s2">"https://github.com/leanprover-community/mathlib4.git"</span>
</code></pre></div>



<a name="291233812"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/lakefile%20dependencies/near/291233812" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/lakefile.20dependencies.html#291233812">(Jul 28 2022 at 18:35)</a>:</h4>
<p>What version of Lean is this?</p>



<a name="291240497"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/lakefile%20dependencies/near/291240497" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> z battleman <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/lakefile.20dependencies.html#291240497">(Jul 28 2022 at 19:31)</a>:</h4>
<p>it's the nightly version of lean4 (<code>version 4.0.0-nightly-2022-04-28</code>)</p>



<a name="291240819"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/lakefile%20dependencies/near/291240819" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/lakefile.20dependencies.html#291240819">(Jul 28 2022 at 19:33)</a>:</h4>
<p><span class="user-mention" data-user-id="483794">@z battleman</span> that version is older than the addition of the <code>require</code> command. You may wish to update to the latest nightly mathlib4 supports (i.e., 07-24)</p>



<a name="291240953"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/lakefile%20dependencies/near/291240953" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> z battleman <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/lakefile.20dependencies.html#291240953">(Jul 28 2022 at 19:34)</a>:</h4>
<p>ah that makes sense. I just updated. But now its upset at the syntax of  the <code>package LeanAlg</code> line so I'll try to fix that. Thank you :)</p>



<a name="291244062"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/lakefile%20dependencies/near/291244062" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> z battleman <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/lakefile.20dependencies.html#291244062">(Jul 28 2022 at 19:59)</a>:</h4>
<p>oh that broke a lot of things... in all my files I'm getting  <code>error loading library: libleanffi.a.so</code> and when I try to build I'm just getting <code>exit with status 139</code> does anyone recognize these?</p>



<a name="291245655"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/lakefile%20dependencies/near/291245655" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> z battleman <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/lakefile.20dependencies.html#291245655">(Jul 28 2022 at 20:12)</a>:</h4>
<p>here's my attempt to port my lakefile</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">Lake</span>
<span class="kn">open</span> <span class="n">System</span> <span class="n">Lake</span> <span class="n">DSL</span>

<span class="n">lean_lib</span> <span class="n">LeanAlg</span>

<span class="kd">def</span> <span class="n">cDir</span> <span class="o">:</span> <span class="n">FilePath</span> <span class="o">:=</span> <span class="s2">"c"</span>
<span class="kd">def</span> <span class="n">ffiSrc</span> <span class="o">:=</span> <span class="n">cDir</span> <span class="bp">/</span> <span class="s2">"bindings.c"</span>
<span class="kd">def</span> <span class="n">buildDir</span> <span class="o">:=</span> <span class="n">defaultBuildDir</span>
<span class="kd">def</span> <span class="n">packagesDir</span> <span class="o">:=</span> <span class="s2">"third_party"</span>
<span class="kd">def</span> <span class="n">pkgDir</span> <span class="o">:=</span> <span class="n">__dir__</span>

<span class="kd">def</span> <span class="n">ffiOTarget</span> <span class="o">:</span> <span class="n">FileTarget</span> <span class="o">:=</span>
  <span class="k">let</span> <span class="n">oFile</span> <span class="o">:=</span> <span class="n">pkgDir</span> <span class="bp">/</span> <span class="n">buildDir</span> <span class="bp">/</span> <span class="n">cDir</span> <span class="bp">/</span> <span class="s2">"bindings.o"</span>
  <span class="k">let</span> <span class="n">srcTarget</span> <span class="o">:=</span> <span class="n">inputFileTarget</span> <span class="bp">&lt;|</span> <span class="n">pkgDir</span> <span class="bp">/</span> <span class="n">ffiSrc</span>
  <span class="n">fileTargetWithDep</span> <span class="n">oFile</span> <span class="n">srcTarget</span> <span class="k">fun</span> <span class="n">srcFile</span> <span class="bp">=&gt;</span> <span class="k">do</span>
    <span class="n">compileO</span> <span class="n">oFile</span> <span class="n">srcFile</span> <span class="bp">#</span><span class="o">[</span><span class="s2">"-I"</span><span class="o">,</span> <span class="o">(</span><span class="bp">←</span> <span class="n">getLeanIncludeDir</span><span class="o">)</span><span class="bp">.</span><span class="n">toString</span><span class="o">,</span> <span class="s2">"-fPIC"</span><span class="o">,</span>
                             <span class="s2">"-I"</span><span class="o">,</span> <span class="s2">"third_party/OpenBLASLib/include"</span><span class="o">]</span>

<span class="kd">def</span> <span class="n">cLibTarget</span> <span class="o">(</span><span class="n">pkgDir</span> <span class="o">:</span> <span class="n">FilePath</span><span class="o">)</span> <span class="o">:</span> <span class="n">FileTarget</span> <span class="o">:=</span>
  <span class="k">let</span> <span class="n">libFile</span> <span class="o">:=</span> <span class="n">pkgDir</span> <span class="bp">/</span> <span class="n">buildDir</span> <span class="bp">/</span> <span class="n">cDir</span> <span class="bp">/</span> <span class="s2">"libffi.a"</span>
  <span class="n">staticLibTarget</span> <span class="n">libFile</span> <span class="bp">#</span><span class="o">[</span><span class="n">ffiOTarget</span><span class="o">]</span>

<span class="n">extern_lib</span> <span class="n">cLib</span> <span class="o">:=</span>
  <span class="k">let</span> <span class="n">libFile</span> <span class="o">:=</span> <span class="n">buildDir</span> <span class="bp">/</span> <span class="n">nameToStaticLib</span> <span class="s2">"libffi"</span>
  <span class="n">staticLibTarget</span> <span class="n">libFile</span> <span class="bp">#</span><span class="o">[</span><span class="n">ffiOTarget</span><span class="o">]</span>


<span class="n">package</span> <span class="n">LeanAlg</span> <span class="o">{</span>
  <span class="c1">-- customize layout</span>
  <span class="c1">--srcDir := "LeanAlg"</span>
  <span class="c1">--libRoots := #[`mathVec, `mathMatrix]</span>
  <span class="c1">-- specify the lib as an additional target</span>
  <span class="n">moreLibTargets</span> <span class="o">:=</span> <span class="bp">#</span><span class="o">[</span><span class="n">cLibTarget</span> <span class="n">__dir__</span><span class="o">]</span>
  <span class="n">moreLinkArgs</span> <span class="o">:=</span> <span class="bp">#</span><span class="o">[</span><span class="s2">"-L"</span><span class="o">,</span> <span class="s2">"./third_party/OpenBLASLib/lib"</span><span class="o">,</span>
                    <span class="s2">"-lopenblas"</span><span class="o">,</span>
                    <span class="s2">"-Wl,-R./third_party/OpenBLASLib/lib"</span><span class="o">]</span>
  <span class="n">precompileModules</span> <span class="o">:=</span> <span class="n">true</span>
<span class="o">}</span>

<span class="c1">--require mathlib from git</span>
<span class="c1">--  "https://github.com/leanprover-community/mathlib4.git"</span>
</code></pre></div>



<a name="291246768"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/lakefile%20dependencies/near/291246768" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> z battleman <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/lakefile.20dependencies.html#291246768">(Jul 28 2022 at 20:20)</a>:</h4>
<p>ah well I got it to build at least by removing <code>precompileModules</code> and changing around some other things. Now its segfaulting of course, but that's progress :)</p>



<a name="291250098"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/lakefile%20dependencies/near/291250098" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> z battleman <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/lakefile.20dependencies.html#291250098">(Jul 28 2022 at 20:48)</a>:</h4>
<p>Is there anything obvious that would cause it to segault like ordering of arguments or whatnot?</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">Lake</span>
<span class="kn">open</span> <span class="n">System</span> <span class="n">Lake</span> <span class="n">DSL</span>

<span class="n">lean_lib</span> <span class="n">LeanAlg</span>

<span class="n">package</span> <span class="n">LeanAlg</span> <span class="o">{</span>
  <span class="c1">-- customize layout</span>
  <span class="c1">--srcDir := "LeanAlg"</span>
  <span class="c1">--libRoots := #[`mathVec, `mathMatrix]</span>
  <span class="c1">-- specify the lib as an additional target</span>
  <span class="c1">--moreLibTargets := #[cLibTarget __dir__]</span>
  <span class="n">srcDir</span> <span class="o">:=</span> <span class="s2">"LeanAlg"</span>
  <span class="n">moreLinkArgs</span> <span class="o">:=</span> <span class="bp">#</span><span class="o">[</span><span class="s2">"-L"</span><span class="o">,</span> <span class="s2">"./third_party/OpenBLASLib/lib"</span><span class="o">,</span>
                    <span class="s2">"-lopenblas"</span><span class="o">,</span>
                    <span class="s2">"-Wl,-R./third_party/OpenBLASLib/lib"</span><span class="o">]</span>
  <span class="c1">--precompileModules := true</span>
<span class="o">}</span>

<span class="kd">@[defaultTarget]</span> <span class="n">lean_exe</span> <span class="n">test</span> <span class="o">{</span>
  <span class="n">root</span> <span class="o">:=</span> <span class="bp">`</span><span class="n">Main</span>
<span class="o">}</span>
<span class="kd">def</span> <span class="n">packagesDir</span> <span class="o">:=</span> <span class="s2">"third_party"</span>
<span class="kd">def</span> <span class="n">pkgDir</span> <span class="o">:=</span> <span class="n">__dir__</span>
<span class="kd">def</span> <span class="n">cSrcDir</span> <span class="o">:=</span> <span class="n">pkgDir</span> <span class="bp">/</span> <span class="s2">"c"</span>
<span class="kd">def</span> <span class="n">cBuildDir</span> <span class="o">:=</span> <span class="n">pkgDir</span> <span class="bp">/</span> <span class="n">_package.buildDir</span> <span class="bp">/</span> <span class="s2">"c"</span>

<span class="kd">def</span> <span class="n">ffiOTarget</span> <span class="o">:</span> <span class="n">FileTarget</span> <span class="o">:=</span>
  <span class="k">let</span> <span class="n">oFile</span> <span class="o">:=</span> <span class="n">cBuildDir</span> <span class="bp">/</span> <span class="s2">"bindings.o"</span>
  <span class="k">let</span> <span class="n">srcTarget</span> <span class="o">:=</span> <span class="n">inputFileTarget</span> <span class="bp">&lt;|</span> <span class="n">cSrcDir</span> <span class="bp">/</span> <span class="s2">"bindings.c"</span>
  <span class="n">fileTargetWithDep</span> <span class="n">oFile</span> <span class="n">srcTarget</span> <span class="k">fun</span> <span class="n">srcFile</span> <span class="bp">=&gt;</span> <span class="k">do</span>
    <span class="n">compileO</span> <span class="n">oFile</span> <span class="n">srcFile</span> <span class="bp">#</span><span class="o">[</span><span class="s2">"-I"</span><span class="o">,</span> <span class="o">(</span><span class="bp">←</span> <span class="n">getLeanIncludeDir</span><span class="o">)</span><span class="bp">.</span><span class="n">toString</span><span class="o">,</span>
                             <span class="s2">"-I"</span><span class="o">,</span> <span class="s2">"third_party/OpenBLASLib/include"</span><span class="o">]</span>

<span class="c1">--def cLibTarget (pkgDir : FilePath) : FileTarget :=</span>
<span class="c1">--  let libFile := pkgDir / buildDir / cDir / "libffi.a"</span>
<span class="c1">--  staticLibTarget libFile #[ffiOTarget]</span>

<span class="n">extern_lib</span> <span class="n">cLib</span> <span class="o">:=</span>
  <span class="k">let</span> <span class="n">libFile</span> <span class="o">:=</span> <span class="n">cBuildDir</span> <span class="bp">/</span> <span class="n">nameToStaticLib</span> <span class="s2">"libffi"</span>
  <span class="n">staticLibTarget</span> <span class="n">libFile</span> <span class="bp">#</span><span class="o">[</span><span class="n">ffiOTarget</span><span class="o">]</span>
</code></pre></div>
<p>The only thing that changed on the Lean end is that this is no longer accepted</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">@[extern "mathMatrix_initialize"]</span>
<span class="kn">private</span> <span class="kd">constant</span> <span class="n">mathMatrix_initializer</span> <span class="o">:</span> <span class="n">IO</span> <span class="n">Unit</span>

<span class="n">builtin_initialize</span> <span class="n">mathMatrix_initializer</span>
</code></pre></div>
<p>so I rmeoved them, but I'm not sure if they need to be replaced</p>



<a name="291250978"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/lakefile%20dependencies/near/291250978" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> z battleman <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/lakefile.20dependencies.html#291250978">(Jul 28 2022 at 20:56)</a>:</h4>
<p>oh... those being gone would definitely cause a segfault, but I'm not sure how to replace them with the current Lean4 syntax</p>



<a name="291252048"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/lakefile%20dependencies/near/291252048" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> z battleman <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/lakefile.20dependencies.html#291252048">(Jul 28 2022 at 21:06)</a>:</h4>
<p>ah, this did it</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">@[extern "mathMatrix_initialize"]</span>
<span class="n">opaque</span> <span class="n">mathMatrix_initializer</span> <span class="o">:</span> <span class="n">IO</span> <span class="n">Unit</span>

<span class="n">builtin_initialize</span> <span class="n">mathMatrix_initializer</span>
</code></pre></div>
<p>Thanks for the help!!</p>



<a name="291280599"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/lakefile%20dependencies/near/291280599" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/lakefile.20dependencies.html#291280599">(Jul 29 2022 at 03:44)</a>:</h4>
<p><span class="user-mention silent" data-user-id="483794">z battleman</span> <a href="#narrow/stream/270676-lean4/topic/lakefile.20dependencies/near/291246768">said</a>:</p>
<blockquote>
<p>ah well I got it to build at least by removing <code>precompileModules</code> and changing around some other things. Now its segfaulting of course, but that's progress :)</p>
</blockquote>
<p>You should be able to add this back (I believe the problem was the existence of the <code>moreLibTargets</code> setting).</p>



<a name="291280982"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/lakefile%20dependencies/near/291280982" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> z battleman <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/lakefile.20dependencies.html#291280982">(Jul 29 2022 at 03:53)</a>:</h4>
<p>I've been trying to add it back to some luck. It is compiling, but Lean is unable to find the <code>.so</code> file associated with it. It's in the <code>build/c/</code> directory though so I'm not sure why its failing to find it</p>



<a name="291281057"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/lakefile%20dependencies/near/291281057" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/lakefile.20dependencies.html#291281057">(Jul 29 2022 at 03:54)</a>:</h4>
<p><span class="user-mention" data-user-id="483794">@z battleman</span> what OS are you on?</p>



<a name="291281086"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/lakefile%20dependencies/near/291281086" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> z battleman <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/lakefile.20dependencies.html#291281086">(Jul 29 2022 at 03:55)</a>:</h4>
<p>I'm on Arch Kernel version  <code>5.18.9-arch1-1</code></p>



<a name="291281101"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/lakefile%20dependencies/near/291281101" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/lakefile.20dependencies.html#291281101">(Jul 29 2022 at 03:55)</a>:</h4>
<p>And what is the specific error you are getting from Lean?</p>



<a name="291281164"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/lakefile%20dependencies/near/291281164" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> z battleman <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/lakefile.20dependencies.html#291281164">(Jul 29 2022 at 03:56)</a>:</h4>
<p><code>error loading library, libleanffi.so: cannot open shared object file. No such file or directory</code></p>



<a name="291281173"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/lakefile%20dependencies/near/291281173" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> z battleman <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/lakefile.20dependencies.html#291281173">(Jul 29 2022 at 03:57)</a>:</h4>
<p>the file definitely is in <code>./build/c/</code></p>



<a name="291281188"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/lakefile%20dependencies/near/291281188" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/lakefile.20dependencies.html#291281188">(Jul 29 2022 at 03:57)</a>:</h4>
<p>Oh wait, one problem (hopefully that one) is that you have name the library you passed to <code>nameToStaticLib</code> "libffi", it should just be "ffi", the definition will add the <code>lib</code> prefix (on non-Windows).</p>



<a name="291281242"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/lakefile%20dependencies/near/291281242" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> z battleman <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/lakefile.20dependencies.html#291281242">(Jul 29 2022 at 03:58)</a>:</h4>
<p>ah sorry that's an old version with that typo, its currently  <code>"leanffi"</code>. Here is the most recent version</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">Lake</span>
<span class="kn">open</span> <span class="n">System</span> <span class="n">Lake</span> <span class="n">DSL</span>


<span class="n">package</span> <span class="n">LeanAlg</span> <span class="o">{</span>
  <span class="c1">-- customize layout</span>
  <span class="c1">--srcDir := "LeanAlg"</span>
  <span class="c1">--libRoots := #[`mathVec, `mathMatrix]</span>
  <span class="c1">-- specify the lib as an additional target</span>
  <span class="c1">--moreLibTargets := #[cLibTarget __dir__]</span>
  <span class="n">moreLinkArgs</span> <span class="o">:=</span> <span class="bp">#</span><span class="o">[</span><span class="s2">"-L"</span><span class="o">,</span> <span class="s2">"./third_party/OpenBLASLib/lib"</span><span class="o">,</span>
                    <span class="s2">"-lopenblas"</span><span class="o">,</span>
                    <span class="s2">"-Wl,-R./third_party/OpenBLASLib/lib"</span><span class="o">]</span>

  <span class="n">precompileModules</span> <span class="o">:=</span> <span class="n">true</span>
  <span class="n">packagesDir</span> <span class="o">:=</span> <span class="s2">"third_party"</span>
<span class="o">}</span>

<span class="kd">@[defaultTarget]</span> <span class="n">lean_exe</span> <span class="n">test</span> <span class="o">{</span>
  <span class="n">root</span> <span class="o">:=</span> <span class="bp">`</span><span class="n">Main</span>
<span class="o">}</span>

<span class="kd">def</span> <span class="n">pkgDir</span> <span class="o">:=</span> <span class="n">__dir__</span>
<span class="kd">def</span> <span class="n">cSrcDir</span> <span class="o">:=</span> <span class="n">pkgDir</span> <span class="bp">/</span> <span class="s2">"c"</span>
<span class="kd">def</span> <span class="n">cBuildDir</span> <span class="o">:=</span> <span class="n">pkgDir</span> <span class="bp">/</span> <span class="n">_package.buildDir</span> <span class="bp">/</span> <span class="s2">"c"</span>

<span class="kd">def</span> <span class="n">ffiOTarget</span> <span class="o">:</span> <span class="n">FileTarget</span> <span class="o">:=</span>
  <span class="k">let</span> <span class="n">oFile</span> <span class="o">:=</span> <span class="n">cBuildDir</span> <span class="bp">/</span> <span class="s2">"bindings.o"</span>
  <span class="k">let</span> <span class="n">srcTarget</span> <span class="o">:=</span> <span class="n">inputFileTarget</span> <span class="bp">&lt;|</span> <span class="n">cSrcDir</span> <span class="bp">/</span> <span class="s2">"bindings.c"</span>
  <span class="n">fileTargetWithDep</span> <span class="n">oFile</span> <span class="n">srcTarget</span> <span class="k">fun</span> <span class="n">srcFile</span> <span class="bp">=&gt;</span> <span class="k">do</span>
    <span class="n">compileO</span> <span class="n">oFile</span> <span class="n">srcFile</span> <span class="bp">#</span><span class="o">[</span><span class="s2">"-I"</span><span class="o">,</span> <span class="o">(</span><span class="bp">←</span> <span class="n">getLeanIncludeDir</span><span class="o">)</span><span class="bp">.</span><span class="n">toString</span><span class="o">,</span>
                             <span class="s2">"-I"</span><span class="o">,</span> <span class="s2">"third_party/OpenBLASLib/include"</span><span class="o">]</span>

<span class="c1">--def cLibTarget (pkgDir : FilePath) : FileTarget :=</span>
<span class="c1">--  let libFile := pkgDir / buildDir / cDir / "libffi.a"</span>
<span class="c1">--  staticLibTarget libFile #[ffiOTarget]</span>

<span class="n">extern_lib</span> <span class="n">cLib</span> <span class="o">:=</span>
  <span class="k">let</span> <span class="n">libFile</span> <span class="o">:=</span> <span class="n">cBuildDir</span> <span class="bp">/</span> <span class="n">nameToStaticLib</span> <span class="s2">"leanffi"</span>
  <span class="n">staticLibTarget</span> <span class="n">libFile</span> <span class="bp">#</span><span class="o">[</span><span class="n">ffiOTarget</span><span class="o">]</span>

<span class="n">require</span> <span class="n">mathlib</span> <span class="k">from</span> <span class="n">git</span>
  <span class="s2">"https://github.com/leanprover-community/mathlib4.git"</span>
</code></pre></div>
<p>Although I plan to change it from an executable to a library tomorrow</p>



<a name="291281423"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/lakefile%20dependencies/near/291281423" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/lakefile.20dependencies.html#291281423">(Jul 29 2022 at 04:02)</a>:</h4>
<p>Do you have the command line invocation that is erroring (i.e., the part starting with <code>&gt; .../lean...</code>)?</p>



<a name="291281467"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/lakefile%20dependencies/near/291281467" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> z battleman <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/lakefile.20dependencies.html#291281467">(Jul 29 2022 at 04:03)</a>:</h4>
<p>its occuring in the info window. The executables run correctly. Admittedly I don't know enough about running lean from the command line to reproduce it... sorry</p>



<a name="291281753"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/lakefile%20dependencies/near/291281753" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/lakefile.20dependencies.html#291281753">(Jul 29 2022 at 04:10)</a>:</h4>
<p><span class="user-mention" data-user-id="483794">@z battleman</span>  No worries, the info part helps. I didn't mean run lean directly from the command line. When you run <code>lake build</code> it should spit out a lot of logging which includes a the invocations of <code>lean</code> used to builds files (in the form <code>&gt; [env-vars] [cmd] [args]</code>)</p>



<a name="291281863"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/lakefile%20dependencies/near/291281863" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> z battleman <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/lakefile.20dependencies.html#291281863">(Jul 29 2022 at 04:13)</a>:</h4>
<p>I'm not entirely sure what you're looking for in particular so here's the output</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="bp">&gt;</span> <span class="n">cc</span> <span class="bp">-</span><span class="n">c</span> <span class="bp">-</span><span class="n">o</span> <span class="bp">./</span><span class="n">build</span><span class="bp">/</span><span class="n">c</span><span class="bp">/</span><span class="n">bindings.o</span> <span class="bp">./</span><span class="n">c</span><span class="bp">/</span><span class="n">bindings.c</span> <span class="bp">-</span><span class="n">I</span> <span class="bp">/</span><span class="n">home</span><span class="bp">/</span><span class="n">zaxioms</span><span class="bp">/.</span><span class="n">elan</span><span class="bp">/</span><span class="n">toolchains</span><span class="bp">/</span><span class="n">leanprover</span><span class="c1">--lean4---nightly-2022-07-24/include -I third_party/OpenBLASLib/include</span>
<span class="bp">&gt;</span> <span class="bp">/</span><span class="n">home</span><span class="bp">/</span><span class="n">zaxioms</span><span class="bp">/.</span><span class="n">elan</span><span class="bp">/</span><span class="n">toolchains</span><span class="bp">/</span><span class="n">leanprover</span><span class="c1">--lean4---nightly-2022-07-24/bin/llvm-ar rcs ./build/c/libleanffi.a ./build/c/bindings.o</span>
<span class="bp">&gt;</span> <span class="bp">/</span><span class="n">home</span><span class="bp">/</span><span class="n">zaxioms</span><span class="bp">/.</span><span class="n">elan</span><span class="bp">/</span><span class="n">toolchains</span><span class="bp">/</span><span class="n">leanprover</span><span class="c1">--lean4---nightly-2022-07-24/bin/leanc -shared -o ./build/c/libleanffi.so -Wl,--whole-archive ./build/c/libleanffi.a -Wl,--no-whole-archive</span>
<span class="bp">&gt;</span> <span class="n">LEAN_PATH</span><span class="bp">=./</span><span class="n">third_party</span><span class="bp">/</span><span class="n">mathlib</span><span class="bp">/</span><span class="n">build</span><span class="bp">/</span><span class="n">lib</span><span class="o">:</span><span class="bp">./</span><span class="n">build</span><span class="bp">/</span><span class="n">lib</span> <span class="n">LD_LIBRARY_PATH</span><span class="bp">=/</span><span class="n">home</span><span class="bp">/</span><span class="n">zaxioms</span><span class="bp">/.</span><span class="n">elan</span><span class="bp">/</span><span class="n">toolchains</span><span class="bp">/</span><span class="n">leanprover</span><span class="c1">--lean4---nightly-2022-07-24/lib:./build/lib:./build/c /home/zaxioms/.elan/toolchains/leanprover--lean4---nightly-2022-07-24/bin/lean ./././LeanAlg/genVec.lean -R ././. -o ./build/lib/LeanAlg/genVec.olean -i ./build/lib/LeanAlg/genVec.ilean -c ./build/ir/LeanAlg/genVec.c --load-dynlib=libleanffi.so</span>
<span class="bp">&gt;</span> <span class="n">LEAN_PATH</span><span class="bp">=./</span><span class="n">third_party</span><span class="bp">/</span><span class="n">mathlib</span><span class="bp">/</span><span class="n">build</span><span class="bp">/</span><span class="n">lib</span><span class="o">:</span><span class="bp">./</span><span class="n">build</span><span class="bp">/</span><span class="n">lib</span> <span class="n">LD_LIBRARY_PATH</span><span class="bp">=/</span><span class="n">home</span><span class="bp">/</span><span class="n">zaxioms</span><span class="bp">/.</span><span class="n">elan</span><span class="bp">/</span><span class="n">toolchains</span><span class="bp">/</span><span class="n">leanprover</span><span class="c1">--lean4---nightly-2022-07-24/lib:./build/lib:./build/c /home/zaxioms/.elan/toolchains/leanprover--lean4---nightly-2022-07-24/bin/lean ./././LeanAlg/utils/FloatUtils.lean -R ././. -o ./build/lib/LeanAlg/utils/FloatUtils.olean -i ./build/lib/LeanAlg/utils/FloatUtils.ilean -c ./build/ir/LeanAlg/utils/FloatUtils.c --load-dynlib=libleanffi.so</span>
<span class="bp">&gt;</span> <span class="bp">/</span><span class="n">home</span><span class="bp">/</span><span class="n">zaxioms</span><span class="bp">/.</span><span class="n">elan</span><span class="bp">/</span><span class="n">toolchains</span><span class="bp">/</span><span class="n">leanprover</span><span class="c1">--lean4---nightly-2022-07-24/bin/leanc -c -o ./build/ir/LeanAlg/utils/FloatUtils.o ./build/ir/LeanAlg/utils/FloatUtils.c -O3 -DNDEBUG</span>
<span class="bp">&gt;</span> <span class="n">LEAN_PATH</span><span class="bp">=./</span><span class="n">third_party</span><span class="bp">/</span><span class="n">mathlib</span><span class="bp">/</span><span class="n">build</span><span class="bp">/</span><span class="n">lib</span><span class="o">:</span><span class="bp">./</span><span class="n">build</span><span class="bp">/</span><span class="n">lib</span> <span class="n">LD_LIBRARY_PATH</span><span class="bp">=/</span><span class="n">home</span><span class="bp">/</span><span class="n">zaxioms</span><span class="bp">/.</span><span class="n">elan</span><span class="bp">/</span><span class="n">toolchains</span><span class="bp">/</span><span class="n">leanprover</span><span class="c1">--lean4---nightly-2022-07-24/lib:./build/lib:./build/c /home/zaxioms/.elan/toolchains/leanprover--lean4---nightly-2022-07-24/bin/lean ./././LeanAlg/mathVec.lean -R ././. -o ./build/lib/LeanAlg/mathVec.olean -i ./build/lib/LeanAlg/mathVec.ilean -c ./build/ir/LeanAlg/mathVec.c --load-dynlib=libleanffi.so</span>
<span class="bp">&gt;</span> <span class="bp">/</span><span class="n">home</span><span class="bp">/</span><span class="n">zaxioms</span><span class="bp">/.</span><span class="n">elan</span><span class="bp">/</span><span class="n">toolchains</span><span class="bp">/</span><span class="n">leanprover</span><span class="c1">--lean4---nightly-2022-07-24/bin/leanc -c -o ./build/ir/LeanAlg/genVec.o ./build/ir/LeanAlg/genVec.c -O3 -DNDEBUG</span>

<span class="bp">&gt;</span> <span class="bp">/</span><span class="n">home</span><span class="bp">/</span><span class="n">zaxioms</span><span class="bp">/.</span><span class="n">elan</span><span class="bp">/</span><span class="n">toolchains</span><span class="bp">/</span><span class="n">leanprover</span><span class="c1">--lean4---nightly-2022-07-24/bin/leanc -c -o ./build/ir/LeanAlg/mathVec.o ./build/ir/LeanAlg/mathVec.c -O3 -DNDEBUG</span>
<span class="bp">&gt;</span> <span class="n">LEAN_PATH</span><span class="bp">=./</span><span class="n">third_party</span><span class="bp">/</span><span class="n">mathlib</span><span class="bp">/</span><span class="n">build</span><span class="bp">/</span><span class="n">lib</span><span class="o">:</span><span class="bp">./</span><span class="n">build</span><span class="bp">/</span><span class="n">lib</span> <span class="n">LD_LIBRARY_PATH</span><span class="bp">=/</span><span class="n">home</span><span class="bp">/</span><span class="n">zaxioms</span><span class="bp">/.</span><span class="n">elan</span><span class="bp">/</span><span class="n">toolchains</span><span class="bp">/</span><span class="n">leanprover</span><span class="c1">--lean4---nightly-2022-07-24/lib:./build/lib:./build/c /home/zaxioms/.elan/toolchains/leanprover--lean4---nightly-2022-07-24/bin/lean ./././LeanAlg/mathMatrix.lean -R ././. -o ./build/lib/LeanAlg/mathMatrix.olean -i ./build/lib/LeanAlg/mathMatrix.ilean -c ./build/ir/LeanAlg/mathMatrix.c --load-dynlib=libleanffi.so</span>
<span class="bp">&gt;</span> <span class="n">LEAN_PATH</span><span class="bp">=./</span><span class="n">third_party</span><span class="bp">/</span><span class="n">mathlib</span><span class="bp">/</span><span class="n">build</span><span class="bp">/</span><span class="n">lib</span><span class="o">:</span><span class="bp">./</span><span class="n">build</span><span class="bp">/</span><span class="n">lib</span> <span class="n">LD_LIBRARY_PATH</span><span class="bp">=/</span><span class="n">home</span><span class="bp">/</span><span class="n">zaxioms</span><span class="bp">/.</span><span class="n">elan</span><span class="bp">/</span><span class="n">toolchains</span><span class="bp">/</span><span class="n">leanprover</span><span class="c1">--lean4---nightly-2022-07-24/lib:./build/lib:./build/c /home/zaxioms/.elan/toolchains/leanprover--lean4---nightly-2022-07-24/bin/lean ./././LeanAlg/tests/mathVecTest.lean -R ././. -o ./build/lib/LeanAlg/tests/mathVecTest.olean -i ./build/lib/LeanAlg/tests/mathVecTest.ilean -c ./build/ir/LeanAlg/tests/mathVecTest.c --load-dynlib=libleanffi.so</span>

<span class="bp">&gt;</span> <span class="bp">/</span><span class="n">home</span><span class="bp">/</span><span class="n">zaxioms</span><span class="bp">/.</span><span class="n">elan</span><span class="bp">/</span><span class="n">toolchains</span><span class="bp">/</span><span class="n">leanprover</span><span class="c1">--lean4---nightly-2022-07-24/bin/leanc -c -o ./build/ir/LeanAlg/mathMatrix.o ./build/ir/LeanAlg/mathMatrix.c -O3 -DNDEBUG</span>
<span class="bp">&gt;</span> <span class="n">LEAN_PATH</span><span class="bp">=./</span><span class="n">third_party</span><span class="bp">/</span><span class="n">mathlib</span><span class="bp">/</span><span class="n">build</span><span class="bp">/</span><span class="n">lib</span><span class="o">:</span><span class="bp">./</span><span class="n">build</span><span class="bp">/</span><span class="n">lib</span> <span class="n">LD_LIBRARY_PATH</span><span class="bp">=/</span><span class="n">home</span><span class="bp">/</span><span class="n">zaxioms</span><span class="bp">/.</span><span class="n">elan</span><span class="bp">/</span><span class="n">toolchains</span><span class="bp">/</span><span class="n">leanprover</span><span class="c1">--lean4---nightly-2022-07-24/lib:./build/lib:./build/c /home/zaxioms/.elan/toolchains/leanprover--lean4---nightly-2022-07-24/bin/lean ./././LeanAlg/tests/mathMatrixTest.lean -R ././. -o ./build/lib/LeanAlg/tests/mathMatrixTest.olean -i ./build/lib/LeanAlg/tests/mathMatrixTest.ilean -c ./build/ir/LeanAlg/tests/mathMatrixTest.c --load-dynlib=libleanffi.so</span>

<span class="bp">&gt;</span> <span class="bp">/</span><span class="n">home</span><span class="bp">/</span><span class="n">zaxioms</span><span class="bp">/.</span><span class="n">elan</span><span class="bp">/</span><span class="n">toolchains</span><span class="bp">/</span><span class="n">leanprover</span><span class="c1">--lean4---nightly-2022-07-24/bin/leanc -c -o ./build/ir/LeanAlg/tests/mathVecTest.o ./build/ir/LeanAlg/tests/mathVecTest.c -O3 -DNDEBUG</span>
<span class="bp">&gt;</span> <span class="n">LEAN_PATH</span><span class="bp">=./</span><span class="n">third_party</span><span class="bp">/</span><span class="n">mathlib</span><span class="bp">/</span><span class="n">build</span><span class="bp">/</span><span class="n">lib</span><span class="o">:</span><span class="bp">./</span><span class="n">build</span><span class="bp">/</span><span class="n">lib</span> <span class="n">LD_LIBRARY_PATH</span><span class="bp">=/</span><span class="n">home</span><span class="bp">/</span><span class="n">zaxioms</span><span class="bp">/.</span><span class="n">elan</span><span class="bp">/</span><span class="n">toolchains</span><span class="bp">/</span><span class="n">leanprover</span><span class="c1">--lean4---nightly-2022-07-24/lib:./build/lib:./build/c /home/zaxioms/.elan/toolchains/leanprover--lean4---nightly-2022-07-24/bin/lean ./././Main.lean -R ././. -o ./build/lib/Main.olean -i ./build/lib/Main.ilean -c ./build/ir/Main.c --load-dynlib=libleanffi.so</span>
<span class="bp">&gt;</span> <span class="bp">/</span><span class="n">home</span><span class="bp">/</span><span class="n">zaxioms</span><span class="bp">/.</span><span class="n">elan</span><span class="bp">/</span><span class="n">toolchains</span><span class="bp">/</span><span class="n">leanprover</span><span class="c1">--lean4---nightly-2022-07-24/bin/leanc -c -o ./build/ir/LeanAlg/tests/mathMatrixTest.o ./build/ir/LeanAlg/tests/mathMatrixTest.c -O3 -DNDEBUG</span>
<span class="bp">&gt;</span> <span class="bp">/</span><span class="n">home</span><span class="bp">/</span><span class="n">zaxioms</span><span class="bp">/.</span><span class="n">elan</span><span class="bp">/</span><span class="n">toolchains</span><span class="bp">/</span><span class="n">leanprover</span><span class="c1">--lean4---nightly-2022-07-24/bin/leanc -c -o ./build/ir/Main.o ./build/ir/Main.c -O3 -DNDEBUG</span>
<span class="bp">&gt;</span> <span class="bp">/</span><span class="n">home</span><span class="bp">/</span><span class="n">zaxioms</span><span class="bp">/.</span><span class="n">elan</span><span class="bp">/</span><span class="n">toolchains</span><span class="bp">/</span><span class="n">leanprover</span><span class="c1">--lean4---nightly-2022-07-24/bin/leanc -o ./build/bin/test ./build/ir/Main.o ./build/ir/LeanAlg/genVec.o ./build/ir/LeanAlg/mathVec.o ./build/ir/LeanAlg/utils/FloatUtils.o ./build/ir/LeanAlg/mathMatrix.o ./build/ir/LeanAlg/tests/mathMatrixTest.o ./build/ir/LeanAlg/tests/mathVecTest.o ./build/c/libleanffi.a -L ./third_party/OpenBLASLib/lib -lopenblas -Wl,-R./third_party/OpenBLASLib/lib</span>
</code></pre></div>
<p>(if you can point out whats relevant I can delete the rest to avoid clogging the thread)</p>



<a name="291284654"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/lakefile%20dependencies/near/291284654" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/lakefile.20dependencies.html#291284654">(Jul 29 2022 at 05:20)</a>:</h4>
<p>Looks good to me. You mentioned that error only appears in the  infoview, right?</p>



<a name="291284727"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/lakefile%20dependencies/near/291284727" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/lakefile.20dependencies.html#291284727">(Jul 29 2022 at 05:22)</a>:</h4>
<p>My two suggestions: </p>
<ul>
<li>You have a <code>lean-toolchain</code> file in your project, correct? What nightly are using?</li>
<li>If you are using VSCode, you can run try running <code>Developer: Reload Window</code> from the command palette and seeing if that helps.</li>
</ul>



<a name="291314467"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/lakefile%20dependencies/near/291314467" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> z battleman <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/lakefile.20dependencies.html#291314467">(Jul 29 2022 at 12:27)</a>:</h4>
<p>My lean-toolchain is nightly version 07-24-22. I use neovim with lean.nvim, but I could try vscode and see if that works. Also, to be a bit more specific, the error isnt occuring the infowindow itself, but rather my language server is detecting it and nothing is loading in the infowindow (which I think is just trying to load it into the info window, but I'm not sure if that distinction is important)</p>



<a name="291318155"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/lakefile%20dependencies/near/291318155" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> z battleman <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/lakefile.20dependencies.html#291318155">(Jul 29 2022 at 13:07)</a>:</h4>
<p>I just checked, it's the same issue in VScode :( </p>
<p>(and this time officially <em>in</em> the info window haha)</p>



<a name="291347189"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/lakefile%20dependencies/near/291347189" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/lakefile.20dependencies.html#291347189">(Jul 29 2022 at 16:16)</a>:</h4>
<p><span class="user-mention" data-user-id="483794">@z battleman</span>  try running the following in your lean server environment:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="k">#eval</span> <span class="k">show</span> <span class="n">IO</span> <span class="n">_</span> <span class="k">from</span> <span class="k">do</span>
  <span class="k">let</span> <span class="n">path</span> <span class="o">:=</span> <span class="o">(</span><span class="bp">←</span> <span class="n">IO.getEnv</span> <span class="s2">"LD_LIBRARY_PATH"</span><span class="o">)</span><span class="bp">.</span><span class="n">getD</span> <span class="s2">""</span>
  <span class="n">return</span> <span class="n">System.SearchPath.parse</span> <span class="n">path</span>
</code></pre></div>
<p>If things are working correctly, you should see <code>build/c</code> in the list of paths the <code>#eval</code> prints.</p>



<a name="291357152"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/lakefile%20dependencies/near/291357152" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> z battleman <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/lakefile.20dependencies.html#291357152">(Jul 29 2022 at 17:41)</a>:</h4>
<p>Its not there, I'm just getting </p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="o">[</span><span class="n">FilePath.mk</span> <span class="s2">"/home/zaxioms/.elan/toolchains/leanprover--lean4---nightly-2022-07-24/lib"</span><span class="o">,</span>
 <span class="n">FilePath.mk</span> <span class="s2">"./third_party/mathlib/build/lib"</span><span class="o">,</span>
 <span class="n">FilePath.mk</span> <span class="s2">"./build/lib"</span><span class="o">]</span>
</code></pre></div>
<p>in the <code>./build/lib</code> directory are a bunch of <code>.so</code> files associated with the individual files, but I assume the one that its looking for "ties them all together" so to speak</p>



<a name="291358687"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/lakefile%20dependencies/near/291358687" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/lakefile.20dependencies.html#291358687">(Jul 29 2022 at 17:52)</a>:</h4>
<p><span class="user-mention" data-user-id="483794">@z battleman</span> yep, that is a bug. A short term solution would be to output <code>libleanffi</code> to <code>build/lib</code> rather than <code>build/c</code></p>



<a name="291358864"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/lakefile%20dependencies/near/291358864" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> z battleman <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/lakefile.20dependencies.html#291358864">(Jul 29 2022 at 17:53)</a>:</h4>
<p>hopefully that'll work for now. Thanks!</p>



<a name="291361177"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/lakefile%20dependencies/near/291361177" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> z battleman <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/lakefile.20dependencies.html#291361177">(Jul 29 2022 at 18:10)</a>:</h4>
<p>well it found the file, but now it says that </p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">libc</span><span class="bp">++</span><span class="n">abi</span><span class="o">:</span> <span class="n">terminating</span> <span class="k">with</span> <span class="n">uncaught</span> <span class="n">exception</span> <span class="n">of</span> <span class="n">type</span> <span class="n">lean</span><span class="o">::</span><span class="n">exception</span><span class="o">:</span> <span class="n">could</span> <span class="n">not</span> <span class="n">find</span> <span class="n">native</span> <span class="n">implementation</span> <span class="n">of</span> <span class="n">external</span> <span class="n">declaration</span> <span class="bp">'</span><span class="n">mathMatrix.id'</span> <span class="o">(</span><span class="n">symbols</span> <span class="bp">'</span><span class="n">l_mathMatrix_id___boxed'</span> <span class="n">or</span> <span class="bp">'</span><span class="n">l_mathMatrix_id'</span><span class="o">)</span>
</code></pre></div>
<p>considering the files run at all, these defintely exist in my <code>c</code> code but it seems like they might not being detected by the compiler when it is compiling the <code>so</code>?  Is this something that can happen?</p>
<p>Here it is in the <code>ir</code> directory generated</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">LEAN_EXPORT</span> <span class="n">lean_object</span><span class="bp">*</span> <span class="n">l_mathMatrix_id___boxed</span><span class="o">(</span><span class="n">lean_object</span><span class="bp">*</span> <span class="n">x_1</span><span class="o">)</span> <span class="o">{</span>
<span class="n">_start</span><span class="o">:</span>
<span class="o">{</span>
<span class="n">lean_object</span><span class="bp">*</span> <span class="n">x_2</span><span class="bp">;</span>
<span class="n">x_2</span> <span class="bp">=</span> <span class="n">mathMatrix_new_id</span><span class="o">(</span><span class="n">x_1</span><span class="o">)</span><span class="bp">;</span>
<span class="n">return</span> <span class="n">x_2</span><span class="bp">;</span>
<span class="o">}</span>
</code></pre></div>



<a name="291362089"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/lakefile%20dependencies/near/291362089" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/lakefile.20dependencies.html#291362089">(Jul 29 2022 at 18:17)</a>:</h4>
<p>How are you calling your C code from Lean?</p>



<a name="291362307"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/lakefile%20dependencies/near/291362307" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> z battleman <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/lakefile.20dependencies.html#291362307">(Jul 29 2022 at 18:19)</a>:</h4>
<p>just with <code>#eval</code></p>



<a name="291363444"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/lakefile%20dependencies/near/291363444" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/lakefile.20dependencies.html#291363444">(Jul 29 2022 at 18:28)</a>:</h4>
<p>The <code>#eval</code> needs to be in a different file from the <code>extern</code></p>



<a name="291364391"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/lakefile%20dependencies/near/291364391" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> z battleman <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/lakefile.20dependencies.html#291364391">(Jul 29 2022 at 18:35)</a>:</h4>
<p>oh that works!! thank you so much!</p>



<a name="305353004"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/lakefile%20dependencies/near/305353004" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yakov Pechersky <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/lakefile.20dependencies.html#305353004">(Oct 21 2022 at 13:21)</a>:</h4>
<p>I've hit the offline issue again, preventing offline porting, because the lakefile for mathlib4 won't parse. <a href="https://github.com/leanprover/lake/issues/104#issuecomment-1286953208">https://github.com/leanprover/lake/issues/104#issuecomment-1286953208</a></p>



<a name="308184896"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/lakefile%20dependencies/near/308184896" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> James Gallicchio <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/lakefile.20dependencies.html#308184896">(Nov 05 2022 at 20:38)</a>:</h4>
<p>I'm having a slightly different issue from what <span class="user-mention" data-user-id="483794">@zbatt</span> had; for some reason, an executable generated by <code>lake build</code> doesn't have <code>libunwind.so</code> linked correctly:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="bp">$</span> <span class="n">ldd</span> <span class="bp">./</span><span class="n">build</span><span class="bp">/</span><span class="n">bin</span><span class="bp">/</span><span class="n">eternity2</span>
        <span class="n">linux</span><span class="bp">-</span><span class="n">vdso.so.1</span> <span class="o">(</span><span class="mi">0x00007fffa8bd2000</span><span class="o">)</span>
        <span class="n">libc</span><span class="bp">++.</span><span class="n">so.1</span> <span class="bp">=&gt;</span> <span class="bp">/</span><span class="n">usr</span><span class="bp">/</span><span class="n">lib</span><span class="bp">/</span><span class="n">x86_64</span><span class="bp">-</span><span class="n">linux</span><span class="bp">-</span><span class="n">gnu</span><span class="bp">/</span><span class="n">libc</span><span class="bp">++.</span><span class="n">so.1</span> <span class="o">(</span><span class="mi">0x00007f4854a6b000</span><span class="o">)</span>
        <span class="n">libc</span><span class="bp">++</span><span class="n">abi.so.1</span> <span class="bp">=&gt;</span> <span class="bp">/</span><span class="n">usr</span><span class="bp">/</span><span class="n">lib</span><span class="bp">/</span><span class="n">x86_64</span><span class="bp">-</span><span class="n">linux</span><span class="bp">-</span><span class="n">gnu</span><span class="bp">/</span><span class="n">libc</span><span class="bp">++</span><span class="n">abi.so.1</span> <span class="o">(</span><span class="mi">0x00007f4854a33000</span><span class="o">)</span>
        <span class="n">libunwind.so.1</span> <span class="bp">=&gt;</span> <span class="n">not</span> <span class="n">found</span>
        <span class="n">libm.so.6</span> <span class="bp">=&gt;</span> <span class="bp">/</span><span class="n">lib</span><span class="bp">/</span><span class="n">x86_64</span><span class="bp">-</span><span class="n">linux</span><span class="bp">-</span><span class="n">gnu</span><span class="bp">/</span><span class="n">libm.so.6</span> <span class="o">(</span><span class="mi">0x00007f48548e4000</span><span class="o">)</span>
        <span class="n">libdl.so.2</span> <span class="bp">=&gt;</span> <span class="bp">/</span><span class="n">lib</span><span class="bp">/</span><span class="n">x86_64</span><span class="bp">-</span><span class="n">linux</span><span class="bp">-</span><span class="n">gnu</span><span class="bp">/</span><span class="n">libdl.so.2</span> <span class="o">(</span><span class="mi">0x00007f48548de000</span><span class="o">)</span>
        <span class="n">libpthread.so.0</span> <span class="bp">=&gt;</span> <span class="bp">/</span><span class="n">lib</span><span class="bp">/</span><span class="n">x86_64</span><span class="bp">-</span><span class="n">linux</span><span class="bp">-</span><span class="n">gnu</span><span class="bp">/</span><span class="n">libpthread.so.0</span> <span class="o">(</span><span class="mi">0x00007f48548bb000</span><span class="o">)</span>
        <span class="n">libc.so.6</span> <span class="bp">=&gt;</span> <span class="bp">/</span><span class="n">lib</span><span class="bp">/</span><span class="n">x86_64</span><span class="bp">-</span><span class="n">linux</span><span class="bp">-</span><span class="n">gnu</span><span class="bp">/</span><span class="n">libc.so.6</span> <span class="o">(</span><span class="mi">0x00007f48546c7000</span><span class="o">)</span>
        <span class="n">librt.so.1</span> <span class="bp">=&gt;</span> <span class="bp">/</span><span class="n">lib</span><span class="bp">/</span><span class="n">x86_64</span><span class="bp">-</span><span class="n">linux</span><span class="bp">-</span><span class="n">gnu</span><span class="bp">/</span><span class="n">librt.so.1</span> <span class="o">(</span><span class="mi">0x00007f48546bd000</span><span class="o">)</span>
        <span class="n">libgcc_s.so.1</span> <span class="bp">=&gt;</span> <span class="bp">/</span><span class="n">lib</span><span class="bp">/</span><span class="n">x86_64</span><span class="bp">-</span><span class="n">linux</span><span class="bp">-</span><span class="n">gnu</span><span class="bp">/</span><span class="n">libgcc_s.so.1</span> <span class="o">(</span><span class="mi">0x00007f48546a2000</span><span class="o">)</span>
        <span class="bp">/</span><span class="n">lib64</span><span class="bp">/</span><span class="n">ld</span><span class="bp">-</span><span class="n">linux</span><span class="bp">-</span><span class="n">x86</span><span class="bp">-</span><span class="mi">64</span><span class="bp">.</span><span class="n">so.2</span> <span class="o">(</span><span class="mi">0x00007f4857c13000</span><span class="o">)</span>
</code></pre></div>
<p>but if I add the lean toolchain <code>lib/</code> folder to the LD_LIBRARY_PATH environment variable it runs fine. i think this is also why i hadn't noticed it until now, cuz <code>lake exe eternity2</code> has LD_LIBRARY_PATH set properly</p>



<a name="308184931"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/lakefile%20dependencies/near/308184931" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> James Gallicchio <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/lakefile.20dependencies.html#308184931">(Nov 05 2022 at 20:38)</a>:</h4>
<p>obviously low priority since I can work around it right now but I'm not sure if I'm doing something weird or if this is a bug in lake</p>



<a name="308185128"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/lakefile%20dependencies/near/308185128" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> James Gallicchio <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/lakefile.20dependencies.html#308185128">(Nov 05 2022 at 20:41)</a>:</h4>
<p><a href="https://github.com/JamesGallicchio/eternity2/tree/8e7b7927d350467e281a674616ddb29c1578b89d">https://github.com/JamesGallicchio/eternity2/tree/8e7b7927d350467e281a674616ddb29c1578b89d</a> leaving this commit here in case we want to debug at some point</p>



<a name="308193769"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/lakefile%20dependencies/near/308193769" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/lakefile.20dependencies.html#308193769">(Nov 05 2022 at 22:40)</a>:</h4>
<p>libunwind is supposed to be linked statically: <a href="https://github.com/leanprover/lean4/blob/8b9fe9b6c2714b51dc8b25c3f90304e488ec29a6/script/prepare-llvm-linux.sh#L60">https://github.com/leanprover/lean4/blob/8b9fe9b6c2714b51dc8b25c3f90304e488ec29a6/script/prepare-llvm-linux.sh#L60</a>. But your additional linker flags may have affected that in some way</p>



<a name="308197646"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/lakefile%20dependencies/near/308197646" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> James Gallicchio <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/lakefile.20dependencies.html#308197646">(Nov 05 2022 at 23:39)</a>:</h4>
<p>hrm, interesting</p>



<a name="308197776"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/lakefile%20dependencies/near/308197776" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> James Gallicchio <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/lakefile.20dependencies.html#308197776">(Nov 05 2022 at 23:41)</a>:</h4>
<p>oh, wait, I had a lingering <code>-lstdlib++</code> in my linker args, seems to work now</p>



<a name="308197791"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/lakefile%20dependencies/near/308197791" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> James Gallicchio <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/lakefile.20dependencies.html#308197791">(Nov 05 2022 at 23:41)</a>:</h4>
<p>sorry for the noise!</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>