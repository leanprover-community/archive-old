---
layout: archive
title: Zulip Chat Archive
permalink: /stream/270676-lean4/topic/VS.20Code.20syntax.20highlighting.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/index.html">lean4</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/VS.20Code.20syntax.20highlighting.html">VS Code syntax highlighting</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="314728487"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/VS%20Code%20syntax%20highlighting/near/314728487" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/VS.20Code.20syntax.20highlighting.html#314728487">(Dec 08 2022 at 17:36)</a>:</h4>
<p><span class="user-mention" data-user-id="404479">@Trebor Huang</span> Thanks!  I tried this, VS Code is insisting that it's displaying green text (<code>#008000</code>) despite the evidence of my eyes.<br>
<a href="/user_uploads/3121/SgjGhbqxwxzEi3KK0wafUFF4/Screen-Shot-2022-12-08-at-6.35.23-PM.png">Screen-Shot-2022-12-08-at-6.35.23-PM.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/3121/SgjGhbqxwxzEi3KK0wafUFF4/Screen-Shot-2022-12-08-at-6.35.23-PM.png" title="Screen-Shot-2022-12-08-at-6.35.23-PM.png"><img src="/user_uploads/3121/SgjGhbqxwxzEi3KK0wafUFF4/Screen-Shot-2022-12-08-at-6.35.23-PM.png"></a></div>



<a name="314730891"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/VS%20Code%20syntax%20highlighting/near/314730891" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Matej Penciak <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/VS.20Code.20syntax.20highlighting.html#314730891">(Dec 08 2022 at 17:48)</a>:</h4>
<p>I can confirm that this is also happening for me: </p>
<p><a href="/user_uploads/3121/LXA5jv15sF7D1HsFvcVqhqgP/image.png">image.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/3121/LXA5jv15sF7D1HsFvcVqhqgP/image.png" title="image.png"><img src="/user_uploads/3121/LXA5jv15sF7D1HsFvcVqhqgP/image.png"></a></div><p>(#7B9246 is the usual Green for comments)</p>



<a name="314732023"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/VS%20Code%20syntax%20highlighting/near/314732023" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Matej Penciak <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/VS.20Code.20syntax.20highlighting.html#314732023">(Dec 08 2022 at 17:54)</a>:</h4>
<p>Interestingly, it doesn't happen on other repositories I'm working on (which are, unsurprisingly, a lot smaller than Mathlib4)</p>
<p><a href="/user_uploads/3121/kTffQh0DeFXjUmQauraPDRrd/image.png">image.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/3121/kTffQh0DeFXjUmQauraPDRrd/image.png" title="image.png"><img src="/user_uploads/3121/kTffQh0DeFXjUmQauraPDRrd/image.png"></a></div>



<a name="314754630"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/VS%20Code%20syntax%20highlighting/near/314754630" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/VS.20Code.20syntax.20highlighting.html#314754630">(Dec 08 2022 at 19:30)</a>:</h4>
<p>I'm pretty sure it doesn't happen with mathlib3, or else we would have noticed this long ago!</p>



<a name="314772753"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/VS%20Code%20syntax%20highlighting/near/314772753" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/VS.20Code.20syntax.20highlighting.html#314772753">(Dec 08 2022 at 21:12)</a>:</h4>
<p>I'm pretty sure that's caused by an out of date semantic highlighting cache</p>



<a name="314773148"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/VS%20Code%20syntax%20highlighting/near/314773148" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/VS.20Code.20syntax.20highlighting.html#314773148">(Dec 08 2022 at 21:15)</a>:</h4>
<p>That is, lean sent some semantic highlighting spans saying import should be blue, and then you commented out the import and for whatever reason the re-elaboration job got delayed or lost and the server never sent an update saying that it shouldn't be blue anymore because it's in a comment. You still get the comment in green because the standard regex highlighter is being run by vscode directly, but it's just doing it's best to preserve the semantic highlighting spans until it hears back from lean</p>



<a name="314773492"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/VS%20Code%20syntax%20highlighting/near/314773492" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/VS.20Code.20syntax.20highlighting.html#314773492">(Dec 08 2022 at 21:17)</a>:</h4>
<p>As a test, next time it happens try commenting out a whole block of text, not just the import line. I would predict that all the variables and theorem names are still colored</p>



<a name="314773532"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/VS%20Code%20syntax%20highlighting/near/314773532" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/VS.20Code.20syntax.20highlighting.html#314773532">(Dec 08 2022 at 21:17)</a>:</h4>
<p>even in normal operation this persists for a few seconds</p>



<a name="314776765"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/VS%20Code%20syntax%20highlighting/near/314776765" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/VS.20Code.20syntax.20highlighting.html#314776765">(Dec 08 2022 at 21:37)</a>:</h4>
<p>Thanks Mario, that's very instructive.</p>
<p>If the server's updates about semantic highlighting are buggy in this way, would it be worth using only the regex highlighter run by vscode directly?  What features would I lose?</p>



<a name="314777121"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/VS%20Code%20syntax%20highlighting/near/314777121" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/VS.20Code.20syntax.20highlighting.html#314777121">(Dec 08 2022 at 21:39)</a>:</h4>
<p>The semantic highlighting is super useful in lean 4, because the set of keywords and tactics is user-extensible</p>



<a name="314777505"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/VS%20Code%20syntax%20highlighting/near/314777505" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/VS.20Code.20syntax.20highlighting.html#314777505">(Dec 08 2022 at 21:42)</a>:</h4>
<p>semantic highlighting enables the following:</p>
<ul>
<li>Highlighting <code>linear_combination</code> like a keyword</li>
<li>Highlighting local variables<ul>
<li>Highlighting auto-bound variables (really important for bug catching!)</li>
</ul>
</li>
<li>highlighting variables inside interpolated strings like <code>s!"{foo} + {bar}"</code> (which is helpful if you write <code>"{foo} + {bar}"</code> instead and notice it's not highlighted)</li>
</ul>



<a name="314779427"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/VS%20Code%20syntax%20highlighting/near/314779427" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/VS.20Code.20syntax.20highlighting.html#314779427">(Dec 08 2022 at 21:55)</a>:</h4>
<p>Thanks to this conversation I'm reading the Lean 4 manual <a href="https://leanprover.github.io/lean4/doc/semantic_highlighting.html">section on semantic highlighting</a> for the first time.  I was going to object to this part of your comment<br>
<span class="user-mention silent" data-user-id="110049">Mario Carneiro</span> <a href="#narrow/stream/270676-lean4/topic/VS.20Code.20syntax.20highlighting/near/314777505">said</a>:</p>
<blockquote>
<p>semantic highlighting enables the following:</p>
<ul>
<li>Highlighting local variables</li>
</ul>
</blockquote>
<p>until I saw from the manual that </p>
<blockquote>
<p>this may be insufficient if your color theme does not distinguish enough syntax categories or distinguishes them very subtly. For instance the default Light+ theme uses color <code>#001080</code> for variables. This is awfully close to <code>#000000</code> that is used as the default text color. This makes it very easy to miss an accidental use of auto bound implicit arguments. For instance in</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">def</span> <span class="n">my_id</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="n">nat</span><span class="o">)</span> <span class="o">:=</span> <span class="n">n</span>
</code></pre></div>
<p>maybe <code>nat</code> is a typo and <code>Nat</code> was intended. If your color theme is good enough then you should see that <code>n</code> and <code>nat</code> have the same color since they are both marked as variables by semantic highlighting.</p>
</blockquote>



<a name="314779585"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/VS%20Code%20syntax%20highlighting/near/314779585" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/VS.20Code.20syntax.20highlighting.html#314779585">(Dec 08 2022 at 21:56)</a>:</h4>
<p>Can someone recommend a VS Code light theme for Lean 4 which has all syntax categories unambiguous?</p>



<a name="314779813"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/VS%20Code%20syntax%20highlighting/near/314779813" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/VS.20Code.20syntax.20highlighting.html#314779813">(Dec 08 2022 at 21:57)</a>:</h4>
<p>the best one among the light themes I have installed is Solarized Light</p>



<a name="314779954"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/VS%20Code%20syntax%20highlighting/near/314779954" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/VS.20Code.20syntax.20highlighting.html#314779954">(Dec 08 2022 at 21:58)</a>:</h4>
<p>the dark themes have much clearer coloration it seems</p>



<a name="314780099"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/VS%20Code%20syntax%20highlighting/near/314780099" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/VS.20Code.20syntax.20highlighting.html#314780099">(Dec 08 2022 at 21:59)</a>:</h4>
<p>Thanks!</p>



<a name="314780284"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/VS%20Code%20syntax%20highlighting/near/314780284" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/VS.20Code.20syntax.20highlighting.html#314780284">(Dec 08 2022 at 22:00)</a>:</h4>
<p>Now that I see what semantic highlighting can do for me I am less enthused about the simple solution of throwing it out the window :)</p>



<a name="314780450"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/VS%20Code%20syntax%20highlighting/near/314780450" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/VS.20Code.20syntax.20highlighting.html#314780450">(Dec 08 2022 at 22:01)</a>:</h4>
<p>I think that lean might just be using the wrong textmate scopes here. Many themes have pictures that clearly indicate some good highlighting and then when you try them the highlighting is much more subtle</p>



<a name="314780929"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/VS%20Code%20syntax%20highlighting/near/314780929" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/VS.20Code.20syntax.20highlighting.html#314780929">(Dec 08 2022 at 22:04)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110049">Mario Carneiro</span> <a href="#narrow/stream/270676-lean4/topic/VS.20Code.20syntax.20highlighting/near/314772753">said</a>:</p>
<blockquote>
<p>I'm pretty sure that's caused by an out of date semantic highlighting cache</p>
</blockquote>
<blockquote>
<p>for whatever reason the re-elaboration job got delayed or lost and the server never sent an update saying that it shouldn't be blue anymore</p>
</blockquote>
<p>Back to the original question, is there any hope of making this server interaction more robust?  It seems like it would be very hard to debug.</p>



<a name="314782239"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/VS%20Code%20syntax%20highlighting/near/314782239" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/VS.20Code.20syntax.20highlighting.html#314782239">(Dec 08 2022 at 22:14)</a>:</h4>
<p>it needs a repro</p>



<a name="314782469"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/VS%20Code%20syntax%20highlighting/near/314782469" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/VS.20Code.20syntax.20highlighting.html#314782469">(Dec 08 2022 at 22:16)</a>:</h4>
<p>Apparently you have to semantic highlighting is opt in by custom themes, so you have to set</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code>  <span class="s2">"editor.semanticTokenColorCustomizations"</span><span class="o">:</span> <span class="o">{</span> <span class="s2">"enabled"</span><span class="o">:</span> <span class="n">true</span> <span class="o">},</span>
</code></pre></div>
<p>in your settings.json to turn it on if the theme doesn't turn it on themselves</p>



<a name="314782526"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/VS%20Code%20syntax%20highlighting/near/314782526" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/VS.20Code.20syntax.20highlighting.html#314782526">(Dec 08 2022 at 22:16)</a>:</h4>
<p>Atom One Light looks pretty good, the variables are bright red which should help</p>



<a name="314785628"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/VS%20Code%20syntax%20highlighting/near/314785628" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/VS.20Code.20syntax.20highlighting.html#314785628">(Dec 08 2022 at 22:38)</a>:</h4>
<p><a href="https://vscodethemes.com/e/dunstontc.dark-plus-syntax/light-plus-syntax-high-contrast">This one</a> looks pretty good, tagline "VS Code's default theme, but just a little bit better."</p>



<a name="314811189"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/VS%20Code%20syntax%20highlighting/near/314811189" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Matej Penciak <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/VS.20Code.20syntax.20highlighting.html#314811189">(Dec 09 2022 at 03:01)</a>:</h4>
<p>For a little bit of shameless self promotion: While I was getting over a bad cold, I actually made my own VSCode theme that matched my terminal theme:<br>
<a href="/user_uploads/3121/FaIzaSz9E73rxJjgD8o0Aaf5/image.png">image.png</a> <br>
In the process I discovered that there were a few semantic tokens the Lean LSP provides that weren't differentiated by the VS Code Dark+ theme, and adjusted them. Unfortunately it's a dark mode theme only :(</p>
<div class="message_inline_image"><a href="/user_uploads/3121/FaIzaSz9E73rxJjgD8o0Aaf5/image.png" title="image.png"><img src="/user_uploads/3121/FaIzaSz9E73rxJjgD8o0Aaf5/image.png"></a></div><p>It works best with Lean 4 because that's what I use the most, but it also works with Lean 3 as well.<br>
It also supports Python, Rust, C/C++, JS/TS, Haskell, JSON, YAML, TOML, CSS, HTML, LaTeX (probably others I forgot) with varying degrees of polish, but it's really easy to fix when I notice anything that doesn't look quite right.</p>
<p>Bonus: I also added an icon theme for <code>.lean</code> files and <code>lean-toolchain</code> with little copies of <span class="user-mention" data-user-id="451983">@Arthur Paulino</span>'s Lean logo from this thread: <a href="#narrow/stream/113488-general/topic/Is.20lean's.20logo.20here.3F/near/268144940">https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Is.20lean's.20logo.20here.3F/near/268144940</a> (also a little lake emoji for the lakefile)</p>
<p><a href="/user_uploads/3121/BVICutwdHWJYp0jm7NvXg9Jk/image.png">image.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/3121/BVICutwdHWJYp0jm7NvXg9Jk/image.png" title="image.png"><img src="/user_uploads/3121/BVICutwdHWJYp0jm7NvXg9Jk/image.png"></a></div>



<a name="314812779"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/VS%20Code%20syntax%20highlighting/near/314812779" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/VS.20Code.20syntax.20highlighting.html#314812779">(Dec 09 2022 at 03:21)</a>:</h4>
<p>How can I get it? <span aria-label="eyes" class="emoji emoji-1f440" role="img" title="eyes">:eyes:</span></p>



<a name="315151744"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/VS%20Code%20syntax%20highlighting/near/315151744" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Matej Penciak <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/VS.20Code.20syntax.20highlighting.html#315151744">(Dec 11 2022 at 02:38)</a>:</h4>
<p><span class="user-mention silent" data-user-id="451983">Arthur Paulino</span> <a href="#narrow/stream/270676-lean4/topic/VS.20Code.20syntax.20highlighting/near/314812779">said</a>:</p>
<blockquote>
<p>How can I get it? <span aria-label="eyes" class="emoji emoji-1f440" role="img" title="eyes">:eyes:</span></p>
</blockquote>
<p>I made the repo public: <a href="https://github.com/mpenciak/afterglow">https://github.com/mpenciak/afterglow</a></p>
<p>All you have to do is run <code>code --install-extension afterglow-0.0.1.vsix</code> in the folder</p>
<p>Alternatively, if you don't feel comfortable installing a random package found online then you can build it from source by running <code>vsce package</code> in the folder (You'll need to install vsce from npm <code>npm install -g @vscode/vsce</code>) and then install the resulting <code>.vsix</code> file</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>