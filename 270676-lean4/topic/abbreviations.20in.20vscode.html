---
layout: archive
title: Zulip Chat Archive
permalink: /stream/270676-lean4/topic/abbreviations.20in.20vscode.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/index.html">lean4</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/abbreviations.20in.20vscode.html">abbreviations in vscode</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="226099681"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/abbreviations%20in%20vscode/near/226099681" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/abbreviations.20in.20vscode.html#226099681">(Feb 12 2021 at 05:24)</a>:</h4>
<p>I could have sworn this worked before, but right now I am not getting replacements on abbreviations like <code>\alpha</code> via the lean 4 vscode extension (leanprover.lean4 v0.0.5). It works fine if I enable the lean 3 extension instead, I've tried disabling other extensions and so on but no luck. I assume this works for others because lean 4 is pretty unwriteable without unicode abbreviations, since a lot of core syntax depends on it</p>



<a name="226100160"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/abbreviations%20in%20vscode/near/226100160" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/abbreviations.20in.20vscode.html#226100160">(Feb 12 2021 at 05:36)</a>:</h4>
<p>It seems to have stopped working for me too (on macOS). Maybe there was something in the recent update of VS Code?</p>



<a name="226103121"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/abbreviations%20in%20vscode/near/226103121" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/abbreviations.20in.20vscode.html#226103121">(Feb 12 2021 at 06:46)</a>:</h4>
<p>Hmm, if I open the VS Code settings tab and then go back to the editor tab, the input starts working again.</p>



<a name="226103202"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/abbreviations%20in%20vscode/near/226103202" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/abbreviations.20in.20vscode.html#226103202">(Feb 12 2021 at 06:49)</a>:</h4>
<p>Actually, just switching back and forth between two file tabs seems to get it working again.</p>



<a name="226110684"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/abbreviations%20in%20vscode/near/226110684" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/abbreviations.20in.20vscode.html#226110684">(Feb 12 2021 at 08:50)</a>:</h4>
<p>I've seen the same behavior in lean 3</p>



<a name="226116257"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/abbreviations%20in%20vscode/near/226116257" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/abbreviations.20in.20vscode.html#226116257">(Feb 12 2021 at 09:48)</a>:</h4>
<p>I've just experienced the same issue as well.  Thanks for the workaround!</p>



<a name="226119896"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/abbreviations%20in%20vscode/near/226119896" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Marc Huisinga <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/abbreviations.20in.20vscode.html#226119896">(Feb 12 2021 at 10:25)</a>:</h4>
<p>I'm running into the same issue now but the workaround does not seem to work. Huh.</p>



<a name="226126225"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/abbreviations%20in%20vscode/near/226126225" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Marc Huisinga <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/abbreviations.20in.20vscode.html#226126225">(Feb 12 2021 at 11:41)</a>:</h4>
<p>The problem is that this here returns false (I'm still investigating why, the languageId of the document is <code>lean4</code> and it is in fact matching against <code>lean4</code>): <a href="https://github.com/leanprover-community/vscode-lean4/blob/master/src/abbreviation/rewriter/AbbreviationRewriterFeature.ts#L49">https://github.com/leanprover-community/vscode-lean4/blob/master/src/abbreviation/rewriter/AbbreviationRewriterFeature.ts#L49</a><br>
also, I believe that if condition three lines above should call <code>.get()</code> on the setting :)</p>



<a name="226126443"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/abbreviations%20in%20vscode/near/226126443" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/abbreviations.20in.20vscode.html#226126443">(Feb 12 2021 at 11:44)</a>:</h4>
<p>My first guess is that right after opening a file, the id is still <code>lean</code> before the extension changes it to <code>lean4</code>.</p>



<a name="226126649"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/abbreviations%20in%20vscode/near/226126649" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Marc Huisinga <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/abbreviations.20in.20vscode.html#226126649">(Feb 12 2021 at 11:46)</a>:</h4>
<p>You're right, I was missled by the debugger showing me a later state.</p>



<a name="226127070"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/abbreviations%20in%20vscode/near/226127070" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Marc Huisinga <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/abbreviations.20in.20vscode.html#226127070">(Feb 12 2021 at 11:52)</a>:</h4>
<p>Adding an <code>await</code> to <code>setLean4LanguageId</code> makes it work :)</p>



<a name="226128566"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/abbreviations%20in%20vscode/near/226128566" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/abbreviations.20in.20vscode.html#226128566">(Feb 12 2021 at 12:06)</a>:</h4>
<p>The fix is underway to a vscode near you!</p>



<a name="226128707"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/abbreviations%20in%20vscode/near/226128707" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Marc Huisinga <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/abbreviations.20in.20vscode.html#226128707">(Feb 12 2021 at 12:08)</a>:</h4>
<p>The new version will also have support for a simple (non-widget) goal view.</p>



<a name="226132968"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/abbreviations%20in%20vscode/near/226132968" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/abbreviations.20in.20vscode.html#226132968">(Feb 12 2021 at 12:56)</a>:</h4>
<p>Is there an associated fix to the lean3 extension?</p>



<a name="226133038"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/abbreviations%20in%20vscode/near/226133038" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Marc Huisinga <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/abbreviations.20in.20vscode.html#226133038">(Feb 12 2021 at 12:57)</a>:</h4>
<p>The bug that this fixed was specific to vscode-lean4</p>



<a name="226136935"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/abbreviations%20in%20vscode/near/226136935" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/abbreviations.20in.20vscode.html#226136935">(Feb 12 2021 at 13:34)</a>:</h4>
<p>Then I must be seeing a different bug with similar manifestation</p>



<a name="226240209"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/abbreviations%20in%20vscode/near/226240209" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Marc Huisinga <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/abbreviations.20in.20vscode.html#226240209">(Feb 13 2021 at 11:17)</a>:</h4>
<p><span class="user-mention silent" data-user-id="310045">Eric Wieser</span> <a href="#narrow/stream/270676-lean4/topic/abbreviations.20in.20vscode/near/226136935">said</a>:</p>
<blockquote>
<p>Then I must be seeing a different bug with similar manifestation</p>
</blockquote>
<p>I can confirm that after fixing the above issue, abbreviations still sometimes stop working (in vscode-lean4). I'll take a look later.</p>



<a name="226308091"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/abbreviations%20in%20vscode/near/226308091" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/abbreviations.20in.20vscode.html#226308091">(Feb 14 2021 at 14:56)</a>:</h4>
<p>Abbreviations have been really weird in Lean 3 recently, although I just spent a while playing around and couldn't reproduce. I'll look out for the issue.</p>



<a name="226315217"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/abbreviations%20in%20vscode/near/226315217" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/abbreviations.20in.20vscode.html#226315217">(Feb 14 2021 at 17:17)</a>:</h4>
<p>This happens for me every time:</p>
<ul>
<li>New file, don't save it</li>
<li>Set syntax lean (3). Type some ascii, goal view works fine</li>
<li>Type \alpha. No substitution happens.</li>
<li>Switch to another tab, switch back</li>
<li>\alpha now works</li>
</ul>



<a name="226316521"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/abbreviations%20in%20vscode/near/226316521" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/abbreviations.20in.20vscode.html#226316521">(Feb 14 2021 at 17:49)</a>:</h4>
<p>I don't see this, it works fine for me (on Ubuntu). Note that I only use VS Code for Lean 3 so I don't know what "set syntax Lean (3)" means.</p>



<a name="226316618"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/abbreviations%20in%20vscode/near/226316618" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/abbreviations.20in.20vscode.html#226316618">(Feb 14 2021 at 17:52)</a>:</h4>
<p>It means "I don't have lean 4 installed in any form"</p>



<a name="226316658"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/abbreviations%20in%20vscode/near/226316658" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/abbreviations.20in.20vscode.html#226316658">(Feb 14 2021 at 17:52)</a>:</h4>
<p>But I'm on windows</p>



<a name="226860995"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/abbreviations%20in%20vscode/near/226860995" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Marc Huisinga <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/abbreviations.20in.20vscode.html#226860995">(Feb 18 2021 at 18:55)</a>:</h4>
<p>I didn't get to looking at the other issue yet, but I think I just ran into another issue with the new abbreviations. Specifically, I undo'd a bunch, looked at some older state of the file and then redo'd a bunch. <br>
At some point during redoing, it stopped at some intermediate state next to an abbreviation I was typing in and eagerly completed the abbreviation (At least I think that's what happened?), which made me lose the rest of the redo history.<br>
It stopped next to a "\n" that I was typing in via "\\n" and eagerly replaced that with "¬".</p>



<a name="237138938"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/abbreviations%20in%20vscode/near/237138938" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/abbreviations.20in.20vscode.html#237138938">(May 03 2021 at 10:07)</a>:</h4>
<p>I've a partial fix to this problem in <a href="https://github.com/leanprover/vscode-lean/pull/263">https://github.com/leanprover/vscode-lean/pull/263</a></p>



<a name="252392777"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/abbreviations%20in%20vscode/near/252392777" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Chris Lovett <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/abbreviations.20in.20vscode.html#252392777">(Sep 08 2021 at 01:08)</a>:</h4>
<p>Are people still seeing the bug with \ not working sometimes in latest version of vscore-lean4 ? I can't seem to repro the bug. Looking at the code I can force a similar repro if I force this.dontTrackNewAbbr to get stuck a "true" in  <a href="https://github.com/lovettchris/vscode-lean4/blob/master/vscode-lean4/src/abbreviation/rewriter/AbbreviationRewriter.ts">AbbreviationRewriter1.ts</a> , which is what I suspect is happening, but looking at the code there is a try catch protecting that flag so I don't see how it can get stuck on. Switching active files back and forth completely reconstructs AbbreviationRewriter which is why that is a workaround. So I need a repro.  In the meantime, this PR might help get more info if someone does fine a repro: <a href="https://github.com/leanprover-community/vscode-lean4/pull/35">https://github.com/leanprover-community/vscode-lean4/pull/35</a></p>



<a name="271165897"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/abbreviations%20in%20vscode/near/271165897" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/abbreviations.20in.20vscode.html#271165897">(Feb 08 2022 at 17:56)</a>:</h4>
<p>I use <code>;</code> to escape unicode. Recently, when I've been encountering this problem, not even resetting VS Code solves it (it used to when <code>\</code> was my escaping character). But I want to mention a <del>weird</del> workaround that I found.</p>
<p>The workaround is simply expanding the extensions menu and clicking on the <code>lean4</code> extension.</p>
<p><a href="/user_uploads/3121/h-iont0nVE3AcQUH_D9glouF/image.png">image.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/3121/h-iont0nVE3AcQUH_D9glouF/image.png" title="image.png"><img src="/user_uploads/3121/h-iont0nVE3AcQUH_D9glouF/image.png"></a></div><p>Then I can just close the extension tab and it starts working again</p>



<a name="271166810"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/abbreviations%20in%20vscode/near/271166810" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/abbreviations.20in.20vscode.html#271166810">(Feb 08 2022 at 18:02)</a>:</h4>
<blockquote>
<p>this problem</p>
</blockquote>
<p>I think I lost tracked of the issues in this thread.  Can you explain the issue more clearly, ideally with steps to reproduce it?</p>



<a name="271167580"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/abbreviations%20in%20vscode/near/271167580" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/abbreviations.20in.20vscode.html#271167580">(Feb 08 2022 at 18:07)</a>:</h4>
<p>The problem is that escaping unicode suddenly stops working. For instance, when you want to type <code>α</code> then you type <code>\</code> and <code>a</code> and it just stays as <code>\a</code>.</p>
<p>Unfortunately, I <em>still</em> haven't figured out a way to reproduce it. So I thought that a diagnosis by workaround might give us some clue about what's going on. For some reason, simply clicking on the <code>lean4</code> extension icon solves it (until it happens again)</p>



<a name="271383959"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/abbreviations%20in%20vscode/near/271383959" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Chris Lovett <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/abbreviations.20in.20vscode.html#271383959">(Feb 10 2022 at 04:06)</a>:</h4>
<p><span class="user-mention" data-user-id="451983">@Arthur Paulino</span> you would have to type <code>\</code> and <code>a</code> and <code>space</code> to get the abbreviation to activate to <code>α</code>.  </p>
<p>But can you try disabling all other extensions you have loaded in VS code and see if it still repro's in that kind of pristine environment?</p>



<a name="271383992"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/abbreviations%20in%20vscode/near/271383992" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Chris Lovett <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/abbreviations.20in.20vscode.html#271383992">(Feb 10 2022 at 04:07)</a>:</h4>
<p>For example, I'm seeing a lot of uncaught exceptions from other extensions while typing inside a Lean source file, especially the github copilot extension... so I'm wondering if there's some bad extension that is confusing things here...</p>



<a name="271384114"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/abbreviations%20in%20vscode/near/271384114" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/abbreviations.20in.20vscode.html#271384114">(Feb 10 2022 at 04:09)</a>:</h4>
<p><span class="user-mention silent" data-user-id="434989">Chris Lovett</span> <a href="#narrow/stream/270676-lean4/topic/abbreviations.20in.20vscode/near/271383959">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="451983">Arthur Paulino</span> you would have to type <code>\</code> and <code>a</code> and <code>space</code> to get the abbreviation to activate to <code>α</code>.  </p>
<p>But can you try disabling all other extensions you have loaded in VS code and see if it still repro's in that kind of pristine environment?</p>
</blockquote>
<p>I'm aware of how you'd trigger the abbreviation, but I don't have other extensions except for one that makes certain characters glow in another color</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>