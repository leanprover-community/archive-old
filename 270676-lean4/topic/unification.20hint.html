---
layout: archive
title: Zulip Chat Archive
permalink: /stream/270676-lean4/topic/unification.20hint.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/index.html">lean4</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/unification.20hint.html">unification hint</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="221746513"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/unification%20hint/near/221746513" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/unification.20hint.html#221746513">(Jan 06 2021 at 09:09)</a>:</h4>
<p>What is unification hint and where can I learn more about it?</p>



<a name="221747501"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/unification%20hint/near/221747501" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/unification.20hint.html#221747501">(Jan 06 2021 at 09:23)</a>:</h4>
<p>Also this question, but for lean3</p>



<a name="222112010"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/unification%20hint/near/222112010" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/unification.20hint.html#222112010">(Jan 08 2021 at 19:03)</a>:</h4>
<p>Is there a way to make the following code work?</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">structure</span> <span class="n">Magma</span> <span class="n">where</span>
  <span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span>
  <span class="n">mul</span> <span class="o">:</span> <span class="n">α</span> <span class="bp">→</span> <span class="n">α</span> <span class="bp">→</span> <span class="n">α</span>

<span class="kd">instance</span> <span class="o">:</span> <span class="n">CoeSort</span> <span class="n">Magma</span> <span class="kt">Type</span> <span class="n">where</span>
  <span class="n">coe</span> <span class="n">M</span> <span class="o">:=</span> <span class="n">M.α</span>

<span class="kd">infixl</span><span class="o">:</span><span class="mi">70</span> <span class="o">(</span><span class="n">priority</span> <span class="o">:=</span> <span class="n">high</span><span class="o">)</span> <span class="s2">"**"</span> <span class="bp">=&gt;</span> <span class="n">Magma.mul</span>

<span class="kd">def</span> <span class="n">Nat.Magma</span> <span class="o">:</span> <span class="n">Magma</span> <span class="n">where</span>
  <span class="n">α</span> <span class="o">:=</span> <span class="n">Nat</span>
  <span class="n">mul</span> <span class="n">a</span> <span class="n">b</span> <span class="o">:=</span> <span class="n">Nat.mul</span> <span class="n">a</span> <span class="n">b</span>

<span class="n">unif_hint</span> <span class="o">(</span><span class="n">S</span> <span class="o">:</span> <span class="n">Magma</span><span class="o">)</span> <span class="n">where</span>
  <span class="n">S.α</span> <span class="bp">=?=</span> <span class="n">Nat</span>
  <span class="bp">|-</span>
  <span class="n">S</span> <span class="bp">=?=</span> <span class="n">Nat.Magma</span>

<span class="k">#check</span> <span class="o">(</span><span class="mi">3</span> <span class="o">:</span> <span class="n">Nat</span><span class="o">)</span> <span class="bp">**</span> <span class="mi">3</span>
</code></pre></div>



<a name="222114651"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/unification%20hint/near/222114651" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/unification.20hint.html#222114651">(Jan 08 2021 at 19:26)</a>:</h4>
<p><a href="https://leanprover.github.io/lean4/doc/unifhint.html">https://leanprover.github.io/lean4/doc/unifhint.html</a><br>
<span aria-label="sad" class="emoji emoji-2639" role="img" title="sad">:sad:</span></p>



<a name="222116414"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/unification%20hint/near/222116414" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alexander Bentkamp <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/unification.20hint.html#222116414">(Jan 08 2021 at 19:42)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">structure</span> <span class="n">Magma</span> <span class="n">where</span>
  <span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span>
  <span class="n">mul</span> <span class="o">:</span> <span class="n">α</span> <span class="bp">→</span> <span class="n">α</span> <span class="bp">→</span> <span class="n">α</span>

<span class="c1">-- instance : CoeSort Magma Type where</span>
<span class="c1">--   coe M := M.α</span>

<span class="kd">infixl</span><span class="o">:</span><span class="mi">70</span> <span class="o">(</span><span class="n">priority</span> <span class="o">:=</span> <span class="n">high</span><span class="o">)</span> <span class="s2">"**"</span> <span class="bp">=&gt;</span> <span class="n">Magma.mul</span> <span class="n">_</span> <span class="c1">-- added underscore</span>

<span class="kd">def</span> <span class="n">Nat.Magma</span> <span class="o">:</span> <span class="n">Magma</span> <span class="n">where</span>
  <span class="n">α</span> <span class="o">:=</span> <span class="n">Nat</span>
  <span class="n">mul</span> <span class="n">a</span> <span class="n">b</span> <span class="o">:=</span> <span class="n">Nat.mul</span> <span class="n">a</span> <span class="n">b</span>

<span class="n">unif_hint</span> <span class="o">(</span><span class="n">S</span> <span class="o">:</span> <span class="n">Magma</span><span class="o">)</span> <span class="n">where</span>
  <span class="n">S</span> <span class="bp">=?=</span> <span class="n">Nat.Magma</span>
  <span class="bp">|-</span>
  <span class="n">S.α</span> <span class="bp">=?=</span> <span class="n">Nat</span>
  <span class="c1">--swapped</span>

<span class="k">#check</span> <span class="o">(</span><span class="mi">3</span> <span class="o">:</span> <span class="n">Nat</span><span class="o">)</span> <span class="bp">**</span> <span class="o">(</span><span class="mi">3</span> <span class="o">:</span> <span class="n">Nat</span><span class="o">)</span> <span class="c1">-- added type hint</span>
</code></pre></div>



<a name="222116452"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/unification%20hint/near/222116452" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/unification.20hint.html#222116452">(Jan 08 2021 at 19:43)</a>:</h4>
<p>nice!</p>



<a name="222116685"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/unification%20hint/near/222116685" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/unification.20hint.html#222116685">(Jan 08 2021 at 19:45)</a>:</h4>
<p>The underscore and type hint I completely understand, but what's going on with the swapped syntax in the  unification hint itself?</p>



<a name="222116901"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/unification%20hint/near/222116901" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/unification.20hint.html#222116901">(Jan 08 2021 at 19:47)</a>:</h4>
<p>I guess because normally one would try to check a typing judgment by matching it against the conclusions of inference rules</p>



<a name="222116989"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/unification%20hint/near/222116989" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alexander Bentkamp <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/unification.20hint.html#222116989">(Jan 08 2021 at 19:48)</a>:</h4>
<p>In the unification hint paper <a href="https://www.cs.unibo.it/~sacerdot/PAPERS/tphol09.pdf">https://www.cs.unibo.it/~sacerdot/PAPERS/tphol09.pdf</a> they also use this order.</p>



<a name="222117015"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/unification%20hint/near/222117015" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/unification.20hint.html#222117015">(Jan 08 2021 at 19:48)</a>:</h4>
<p>Well this sure is exciting to see.</p>



<a name="222117040"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/unification%20hint/near/222117040" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/unification.20hint.html#222117040">(Jan 08 2021 at 19:48)</a>:</h4>
<p>but how well can this scale?</p>



<a name="222117063"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/unification%20hint/near/222117063" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/unification.20hint.html#222117063">(Jan 08 2021 at 19:49)</a>:</h4>
<p>Yeah that's something we should experiment with.</p>



<a name="222117221"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/unification%20hint/near/222117221" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/unification.20hint.html#222117221">(Jan 08 2021 at 19:50)</a>:</h4>
<p>I mean, what if I want to reason with an arbitrary Magma? Do I need to keep writing <code>S.\a</code> all the time?</p>



<a name="222117253"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/unification%20hint/near/222117253" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/unification.20hint.html#222117253">(Jan 08 2021 at 19:51)</a>:</h4>
<p>Yeah good question. Why can't we have the CoeSort as well?</p>



<a name="222117293"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/unification%20hint/near/222117293" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/unification.20hint.html#222117293">(Jan 08 2021 at 19:51)</a>:</h4>
<p>(Looks like adding the <code>CoeSort</code> instance doesn't break anything.)</p>



<a name="222117386"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/unification%20hint/near/222117386" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/unification.20hint.html#222117386">(Jan 08 2021 at 19:52)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">structure</span> <span class="n">Magma</span> <span class="n">where</span>
  <span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span>
  <span class="n">mul</span> <span class="o">:</span> <span class="n">α</span> <span class="bp">→</span> <span class="n">α</span> <span class="bp">→</span> <span class="n">α</span>

<span class="kd">instance</span> <span class="o">:</span> <span class="n">CoeSort</span> <span class="n">Magma</span> <span class="kt">Type</span> <span class="n">where</span>
  <span class="n">coe</span> <span class="n">M</span> <span class="o">:=</span> <span class="n">M.α</span>

<span class="kd">infixl</span><span class="o">:</span><span class="mi">70</span> <span class="o">(</span><span class="n">priority</span> <span class="o">:=</span> <span class="n">high</span><span class="o">)</span> <span class="s2">"**"</span> <span class="bp">=&gt;</span> <span class="n">Magma.mul</span> <span class="n">_</span> <span class="c1">-- added underscore</span>

<span class="kd">def</span> <span class="n">Nat.Magma</span> <span class="o">:</span> <span class="n">Magma</span> <span class="n">where</span>
  <span class="n">α</span> <span class="o">:=</span> <span class="n">Nat</span>
  <span class="n">mul</span> <span class="n">a</span> <span class="n">b</span> <span class="o">:=</span> <span class="n">Nat.mul</span> <span class="n">a</span> <span class="n">b</span>

<span class="n">unif_hint</span> <span class="o">(</span><span class="n">S</span> <span class="o">:</span> <span class="n">Magma</span><span class="o">)</span> <span class="n">where</span>
  <span class="n">S</span> <span class="bp">=?=</span> <span class="n">Nat.Magma</span>
  <span class="bp">|-</span>
  <span class="n">S.α</span> <span class="bp">=?=</span> <span class="n">Nat</span>

<span class="k">#check</span> <span class="o">(</span><span class="mi">3</span> <span class="o">:</span> <span class="n">Nat</span><span class="o">)</span> <span class="bp">**</span> <span class="o">(</span><span class="mi">3</span> <span class="o">:</span> <span class="n">Nat</span><span class="o">)</span> <span class="c1">-- added type hint</span>

<span class="kd">variables</span> <span class="o">(</span><span class="n">M</span> <span class="o">:</span> <span class="n">Magma</span><span class="o">)</span> <span class="o">(</span><span class="n">m</span> <span class="o">:</span> <span class="n">M</span><span class="o">)</span>
</code></pre></div>



<a name="222117973"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/unification%20hint/near/222117973" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/unification.20hint.html#222117973">(Jan 08 2021 at 19:57)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">structure</span> <span class="n">Magma</span> <span class="n">where</span>
  <span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span>
  <span class="n">mul</span> <span class="o">:</span> <span class="n">α</span> <span class="bp">→</span> <span class="n">α</span> <span class="bp">→</span> <span class="n">α</span>

<span class="kd">instance</span> <span class="o">:</span> <span class="n">CoeSort</span> <span class="n">Magma</span> <span class="kt">Type</span> <span class="n">where</span>
  <span class="n">coe</span> <span class="n">M</span> <span class="o">:=</span> <span class="n">M.α</span>

<span class="kd">infixl</span><span class="o">:</span><span class="mi">70</span> <span class="o">(</span><span class="n">priority</span> <span class="o">:=</span> <span class="n">high</span><span class="o">)</span> <span class="s2">"**"</span> <span class="bp">=&gt;</span> <span class="n">Magma.mul</span> <span class="n">_</span>

<span class="kd">def</span> <span class="n">mul_assoc</span> <span class="o">(</span><span class="n">S</span> <span class="o">:</span> <span class="n">Magma</span><span class="o">)</span> <span class="o">:</span> <span class="kt">Prop</span> <span class="o">:=</span>
<span class="bp">∀</span> <span class="n">x</span> <span class="n">y</span> <span class="n">z</span> <span class="o">:</span> <span class="n">S</span><span class="o">,</span> <span class="o">(</span><span class="n">x</span> <span class="bp">**</span> <span class="n">y</span><span class="o">)</span> <span class="bp">**</span> <span class="n">z</span> <span class="bp">=</span> <span class="n">x</span> <span class="bp">**</span> <span class="o">(</span><span class="n">y</span> <span class="bp">**</span> <span class="n">z</span><span class="o">)</span>
</code></pre></div>



<a name="222117988"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/unification%20hint/near/222117988" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/unification.20hint.html#222117988">(Jan 08 2021 at 19:57)</a>:</h4>
<p>looks like this works as-is</p>



<a name="222118269"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/unification%20hint/near/222118269" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/unification.20hint.html#222118269">(Jan 08 2021 at 20:00)</a>:</h4>
<p>ok but can we build a bundled algberaic hierarchy without having to write every lemma 37 times?</p>



<a name="222204094"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/unification%20hint/near/222204094" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Cyril Cohen <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/unification.20hint.html#222204094">(Jan 10 2021 at 03:51)</a>:</h4>
<p>The answer is yes and the solution is in the literature: the "Packaging mathematical structures", "Competing inheritance paths in dependent type theory [...]" and "Hierarchy builder" papers are a good start to explain how to do so with Canonical structures which are a strict subset of unification hints. An extensive use case on a large hierarchy can be found in the <a href="https://github.com/math-comp/math-comp">Coq mathematical components library</a>. I also wrote a short demo in lean3, for a lean meeting that someone found in the zulip archives and posted again in the topic of the same name but for lean3. Please have a look.</p>



<a name="222227882"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/unification%20hint/near/222227882" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex Peattie <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/unification.20hint.html#222227882">(Jan 10 2021 at 15:48)</a>:</h4>
<p>I think this is the post/demo in question: <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/unification.20hints.html#158613068">https://leanprover-community.github.io/archive/stream/113488-general/topic/unification.20hints.html#158613068</a></p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>