---
layout: archive
title: Zulip Chat Archive
permalink: /stream/270676-lean4/topic/IntellISense.20for.20Language.20Embeddings.3F.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/index.html">lean4</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/IntellISense.20for.20Language.20Embeddings.3F.html">IntellISense for Language Embeddings?</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="265671349"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/IntellISense%20for%20Language%20Embeddings%3F/near/265671349" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/IntellISense.20for.20Language.20Embeddings.3F.html#265671349">(Dec 21 2021 at 10:48)</a>:</h4>
<p>So I just finished a big update to <a href="https://github.com/tydeu/lean4-alloy">Alloy</a> that allows for the full embedding of C code into Lean and I am wondering how feasible would it be in either the short or long term to get the Lean extension to do C Intellisense on the C code -- or, more generally, augment the editor's IntelliSense in various ways from within Lean?</p>
<p>I imagine this would be a lot of work, but I know that it is possible for one language drive another in VS Code, I am curious if there is even the possibility of  supporting this in the future and I would be more than happy to help where I can should such a project materialize.</p>



<a name="265671961"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/IntellISense%20for%20Language%20Embeddings%3F/near/265671961" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/IntellISense.20for.20Language.20Embeddings.3F.html#265671961">(Dec 21 2021 at 10:56)</a>:</h4>
<p>See <a href="https://github.com/microsoft/language-server-protocol/issues/1366">https://github.com/microsoft/language-server-protocol/issues/1366</a></p>



<a name="265672305"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/IntellISense%20for%20Language%20Embeddings%3F/near/265672305" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/IntellISense.20for.20Language.20Embeddings.3F.html#265672305">(Dec 21 2021 at 11:00)</a>:</h4>
<blockquote>
<p>augment the [completion LSP response] in various ways from within Lean?</p>
</blockquote>
<p>I think that would be useful, also for other projects.  I guess you could then start ccls as a subprocess, send it the current function as a C file, and then proxy the LSP requests.</p>



<a name="265672589"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/IntellISense%20for%20Language%20Embeddings%3F/near/265672589" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/IntellISense.20for.20Language.20Embeddings.3F.html#265672589">(Dec 21 2021 at 11:03)</a>:</h4>
<p><span class="user-mention" data-user-id="110043">@Gabriel Ebner</span> Thanks! Yeah, I know that it is possible to interleave languages within a VS Code extension, but is it feasible for this (and/or other IntelliSense features) to be driven by Lean itself? Or would that likely need another VS Code extension on top of Lean 4 one to make such a thing possible? That is, would it be possible to do something like Widgets for IntelliSense (or can Widgets already do that)?</p>



<a name="265672728"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/IntellISense%20for%20Language%20Embeddings%3F/near/265672728" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/IntellISense.20for.20Language.20Embeddings.3F.html#265672728">(Dec 21 2021 at 11:05)</a>:</h4>
<p>It is not currently possible to override LSP request handlers from a Lean plugin, but that would be a trivial extension <a href="https://github.com/leanprover/lean4/blob/552a488f352a51e194cf9b5ddda908faf952e3b3/src/Lean/Server/Requests.lean#L142-L143">https://github.com/leanprover/lean4/blob/552a488f352a51e194cf9b5ddda908faf952e3b3/src/Lean/Server/Requests.lean#L142-L143</a></p>



<a name="265672758"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/IntellISense%20for%20Language%20Embeddings%3F/near/265672758" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/IntellISense.20for.20Language.20Embeddings.3F.html#265672758">(Dec 21 2021 at 11:05)</a>:</h4>
<p>We don't really want to override here, we want to aggregate the results.</p>



<a name="265672892"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/IntellISense%20for%20Language%20Embeddings%3F/near/265672892" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/IntellISense.20for.20Language.20Embeddings.3F.html#265672892">(Dec 21 2021 at 11:06)</a>:</h4>
<p>Well, you can call the original one from the override :) . But a more general chaining system would be nice.</p>



<a name="265672921"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/IntellISense%20for%20Language%20Embeddings%3F/near/265672921" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/IntellISense.20for.20Language.20Embeddings.3F.html#265672921">(Dec 21 2021 at 11:06)</a>:</h4>
<blockquote>
<p>but is it feasible for this [...] features to be driven by Lean itself?</p>
</blockquote>
<p>I think that's the most reasonable option.  The LSP issue I've linked above says that that's their preferred approach.  The vscode docs second this.</p>



<a name="265672993"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/IntellISense%20for%20Language%20Embeddings%3F/near/265672993" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/IntellISense.20for.20Language.20Embeddings.3F.html#265672993">(Dec 21 2021 at 11:07)</a>:</h4>
<p>More concretely, I would just start a C language server (like ccls) from inside lean and use that to answer the completion requests.</p>



<a name="265673978"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/IntellISense%20for%20Language%20Embeddings%3F/near/265673978" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/IntellISense.20for.20Language.20Embeddings.3F.html#265673978">(Dec 21 2021 at 11:19)</a>:</h4>
<p><span class="user-mention" data-user-id="110043">@Gabriel Ebner</span> Cool! I sadly have very little understanding of how the Lean server works, so I guess I had better start familiarizing myself with it. <span aria-label="laughing" class="emoji emoji-1f606" role="img" title="laughing">:laughing:</span>  Any tips, tricks, hints, advice on the Lean LSP that might help me orient such a project?</p>
<p>To illustrate my minimal knowledge on topic, my understanding (from what I have picked up in discussions) s that the elaborator builds up something called an 'info tree' which is used to handle requests. Thus, I imagine to do delegation here, the plugin would need to start a C language server, send/update the relevant C snippets to the server, keep some mapping between the C code locations and the Lean code locations in the info tree and then use those mapping to translate requests from client on the Lean the source to requests on the the C source which are then sent to the server. Is that somewhat right?</p>



<a name="265674122"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/IntellISense%20for%20Language%20Embeddings%3F/near/265674122" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/IntellISense.20for.20Language.20Embeddings.3F.html#265674122">(Dec 21 2021 at 11:21)</a>:</h4>
<p>Yes, I think that's the right general approach.  The part that isn't supported yet is hijacking the completion request for the Lean LSP server.  But you can already experiment with starting the other LSP server, we have a pretty full-featured LSP library after all.</p>



<a name="265674465"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/IntellISense%20for%20Language%20Embeddings%3F/near/265674465" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/IntellISense.20for.20Language.20Embeddings.3F.html#265674465">(Dec 21 2021 at 11:24)</a>:</h4>
<blockquote>
<p>keep some mapping between the C code locations and the Lean code locations in the info tree</p>
</blockquote>
<p>As far as I understand the alloy library doesn't do any fancy translation, it just prints the atoms and identifiers in the syntax tree to a C file.  I would just compute this mapping in the completion request.  You can get the macro-expanded syntax tree from the info tree, and you have the cursor position from the request, this should be enough information to craft a request to the C server.</p>



<a name="265675455"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/IntellISense%20for%20Language%20Embeddings%3F/near/265675455" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/IntellISense.20for.20Language.20Embeddings.3F.html#265675455">(Dec 21 2021 at 11:37)</a>:</h4>
<p><span class="user-mention" data-user-id="110043">@Gabriel Ebner</span> wouldn't that still require reconstructing the entire C file worth of C commands  on each request in order to determine where the offset from the current command's syntax is relative to the whole the C file? I guess, though, assuming that the reprint of the syntax tree to the C language server does not change any offsets within the command, that would just some basic addition of the lengths of each command's syntax.</p>



<a name="265675570"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/IntellISense%20for%20Language%20Embeddings%3F/near/265675570" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/IntellISense.20for.20Language.20Embeddings.3F.html#265675570">(Dec 21 2021 at 11:39)</a>:</h4>
<p>Yes, but I don't think the position computation is a big problem.  ∑ previous_commands + index_in_current_one  (I'm not sure if the C server needs some time to process the file.)</p>



<a name="265676103"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/IntellISense%20for%20Language%20Embeddings%3F/near/265676103" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/IntellISense.20for.20Language.20Embeddings.3F.html#265676103">(Dec 21 2021 at 11:46)</a>:</h4>
<p><span class="user-mention" data-user-id="110043">@Gabriel Ebner</span> Makes sense. One other question: is it feasible to leverage the existing C language server used by the user's VS Code extensions to handle the request, rather than choosing one server and starting that? The reason I ask, is that I imagine if Lean starts it own server it may not be configured in the same way as the one the user usually uses in VS Code (or whatever LSP client is being used).</p>



<a name="265680583"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/IntellISense%20for%20Language%20Embeddings%3F/near/265680583" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/IntellISense.20for.20Language.20Embeddings.3F.html#265680583">(Dec 21 2021 at 12:41)</a>:</h4>
<blockquote>
<p>is it feasible to leverage the existing C language server used by the user's VS Code extensions to handle the request, rather than choosing one server and starting that?</p>
</blockquote>
<p>Which LSP server to start, and what arguments (include paths) to give it is a valid issue.  Note that users may also use other editors than vscode.  I'm not aware of any general way to get the LSP binary path + arguments for another extension from within vscode.</p>



<a name="265681406"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/IntellISense%20for%20Language%20Embeddings%3F/near/265681406" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Julian Berman <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/IntellISense.20for.20Language.20Embeddings.3F.html#265681406">(Dec 21 2021 at 12:51)</a>:</h4>
<p>Is <a href="https://code.visualstudio.com/api/language-extensions/embedded-languages#language-services">https://code.visualstudio.com/api/language-extensions/embedded-languages#language-services</a> a thing to read?</p>



<a name="265681497"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/IntellISense%20for%20Language%20Embeddings%3F/near/265681497" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Julian Berman <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/IntellISense.20for.20Language.20Embeddings.3F.html#265681497">(Dec 21 2021 at 12:52)</a>:</h4>
<p>It seems to be what <a href="https://github.com/microsoft/vscode-html-languageservice">https://github.com/microsoft/vscode-html-languageservice</a> uses which surely has to deal with similar things</p>



<a name="265681889"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/IntellISense%20for%20Language%20Embeddings%3F/near/265681889" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/IntellISense.20for.20Language.20Embeddings.3F.html#265681889">(Dec 21 2021 at 12:56)</a>:</h4>
<p>AFAIU, language services are just LSP-servers-as-a-library.</p>



<a name="265682073"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/IntellISense%20for%20Language%20Embeddings%3F/near/265682073" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Julian Berman <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/IntellISense.20for.20Language.20Embeddings.3F.html#265682073">(Dec 21 2021 at 12:58)</a>:</h4>
<p>It doesn't seem they're too different from my skim so far, yeah -- there's some sample code it seems here <a href="https://github.com/microsoft/vscode-extension-samples/tree/main/lsp-embedded-language-service">https://github.com/microsoft/vscode-extension-samples/tree/main/lsp-embedded-language-service</a> that I'm about to flip through</p>



<a name="265729230"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/IntellISense%20for%20Language%20Embeddings%3F/near/265729230" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/IntellISense.20for.20Language.20Embeddings.3F.html#265729230">(Dec 21 2021 at 20:12)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110043">Gabriel Ebner</span> <a href="#narrow/stream/270676-lean4/topic/IntellISense.20for.20Language.20Embeddings.3F/near/265680583">said</a>:</p>
<blockquote>
<p>Note that users may also use other editors than vscode.  I'm not aware of any general way to get the LSP binary path + arguments for another extension from within vscode.</p>
</blockquote>
<p>There is <a href="https://code.visualstudio.com/api/language-extensions/embedded-languages#request-forwarding">Request Forwarding</a> on the client side to invoke another language extension to handle requests. I'm not sure if there is a way to do this server side, though.</p>



<a name="289135339"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/IntellISense%20for%20Language%20Embeddings%3F/near/289135339" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/IntellISense.20for.20Language.20Embeddings.3F.html#289135339">(Jul 11 2022 at 02:09)</a>:</h4>
<p>I am resuscitating  this old thread because I have developed <a href="https://github.com/tydeu/lean4-alloy">Alloy</a> to the point where the last major feature it needs is C/C++ LSP support. I have installed <code>ccls</code> as a test language server to call out to and plan to use the <code>chainLspRequestHandler</code> (from the old <a href="https://github.com/leanprover/lean4/pull/903">PR</a>) to pass requests along to it. However, I am not very well versed on the inner workings of an LSP. Does anyone have any advice  on how to proceed from here and/or tips on what I should watch out for in this undertaking?</p>



<a name="289136207"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/IntellISense%20for%20Language%20Embeddings%3F/near/289136207" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/IntellISense.20for.20Language.20Embeddings.3F.html#289136207">(Jul 11 2022 at 02:29)</a>:</h4>
<p>Also, IIRC and understand the code, request handlers can only be registered via plugins (through <code>builtin_initialize</code>), not by normal <code>initialize</code> blocks. I am curious as to what the rational behind that is?</p>



<a name="289155481"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/IntellISense%20for%20Language%20Embeddings%3F/near/289155481" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/IntellISense.20for.20Language.20Embeddings.3F.html#289155481">(Jul 11 2022 at 07:45)</a>:</h4>
<p>One major problem I am having is the C/C++ language servers (<code>clangd</code> and <code>ccls</code>) both seem to want to have a real directory and real files to compile. That is, while the LSP specification supports virtual documents, <code>clangd</code> and <code>ccls</code> do not appear to.</p>



<a name="289157664"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/IntellISense%20for%20Language%20Embeddings%3F/near/289157664" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/IntellISense.20for.20Language.20Embeddings.3F.html#289157664">(Jul 11 2022 at 08:10)</a>:</h4>
<p>Okay, so apparently providing it with a blank c file and then the virtual document does work (it uses the text of the virtual document), but just the virtual document without a corresponding c file does not?</p>



<a name="289161198"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/IntellISense%20for%20Language%20Embeddings%3F/near/289161198" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/IntellISense.20for.20Language.20Embeddings.3F.html#289161198">(Jul 11 2022 at 08:44)</a>:</h4>
<p>Hilariously, this means that passing <code>file:///dev/null</code> as the document uri works to create a virtual document, but I don't think there is a parallel on non-MSYS2 Windows?</p>



<a name="289161468"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/IntellISense%20for%20Language%20Embeddings%3F/near/289161468" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/IntellISense.20for.20Language.20Embeddings.3F.html#289161468">(Jul 11 2022 at 08:46)</a>:</h4>
<p>Windows has some "fun" pseudo files in any folder <a href="https://stackoverflow.com/questions/313111/is-there-a-dev-null-on-windows">https://stackoverflow.com/questions/313111/is-there-a-dev-null-on-windows</a></p>



<a name="289161945"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/IntellISense%20for%20Language%20Embeddings%3F/near/289161945" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/IntellISense.20for.20Language.20Embeddings.3F.html#289161945">(Jul 11 2022 at 08:50)</a>:</h4>
<p>Thanks! Yep, just saw that.</p>



<a name="289163379"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/IntellISense%20for%20Language%20Embeddings%3F/near/289163379" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/IntellISense.20for.20Language.20Embeddings.3F.html#289163379">(Jul 11 2022 at 09:04)</a>:</h4>
<p>Does Lean have any synchronization primitives (e.g., locks / mutexes)? I am not sure how else I am suppose to synchronize message and version ids across the various request threads (plus other shared state about the connection with the language server).</p>



<a name="289164240"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/IntellISense%20for%20Language%20Embeddings%3F/near/289164240" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/IntellISense.20for.20Language.20Embeddings.3F.html#289164240">(Jul 11 2022 at 09:13)</a>:</h4>
<p><a href="https://github.com/leanprover/lean4/issues/1280">https://github.com/leanprover/lean4/issues/1280</a></p>



<a name="289164272"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/IntellISense%20for%20Language%20Embeddings%3F/near/289164272" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/IntellISense.20for.20Language.20Embeddings.3F.html#289164272">(Jul 11 2022 at 09:14)</a>:</h4>
<p><code>IO.Ref</code> works well enough for the Lean language server</p>



<a name="289164578"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/IntellISense%20for%20Language%20Embeddings%3F/near/289164578" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/IntellISense.20for.20Language.20Embeddings.3F.html#289164578">(Jul 11 2022 at 09:16)</a>:</h4>
<p>Thanks again! I should probably be looking for these things before I ask the question. <span aria-label="laughter tears" class="emoji emoji-1f602" role="img" title="laughter tears">:laughter_tears:</span><br>
(It is also morning and I have yet to sleep so that may be part of the problem. <span aria-label="zzz" class="emoji emoji-1f4a4" role="img" title="zzz">:zzz:</span>)</p>



<a name="289165110"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/IntellISense%20for%20Language%20Embeddings%3F/near/289165110" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/IntellISense.20for.20Language.20Embeddings.3F.html#289165110">(Jul 11 2022 at 09:22)</a>:</h4>
<p>I guess my last major question for the moment (which there may also already be an easy answer I have not yet found): is there a way to hook into the Lean server's main loop to forward request / diagnostics from C server or should I just invoke <code>publishDiagnostics</code> etc. directly from the request handlers I am chaining?</p>



<a name="289165581"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/IntellISense%20for%20Language%20Embeddings%3F/near/289165581" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/IntellISense.20for.20Language.20Embeddings.3F.html#289165581">(Jul 11 2022 at 09:27)</a>:</h4>
<p>If you don't somehow change the behavior of the current <code>publishDiagnostics</code>-calling code, the two different sets of messages will just override each other in the editor, no?</p>



<a name="289871472"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/IntellISense%20for%20Language%20Embeddings%3F/near/289871472" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/IntellISense.20for.20Language.20Embeddings.3F.html#289871472">(Jul 17 2022 at 08:09)</a>:</h4>
<p>So I have made a lot of progress on Alloy with LSP integration and have got basic hovers working (still need to have a proper work thread for the server, though). However, I encountered this fun bit of formatting when it comes to markdown hover text:</p>
<p><a href="/user_uploads/3121/l7oQnerP6p1YsAbIBVlrcb9l/AlloyMarkdownHoverFormatting.PNG">AlloyMarkdownHoverFormatting.PNG</a></p>
<div class="message_inline_image"><a href="/user_uploads/3121/l7oQnerP6p1YsAbIBVlrcb9l/AlloyMarkdownHoverFormatting.PNG" title="AlloyMarkdownHoverFormatting.PNG"><img src="/user_uploads/3121/l7oQnerP6p1YsAbIBVlrcb9l/AlloyMarkdownHoverFormatting.PNG"></a></div><p>Is there some way to get this to render nicer <span class="user-mention" data-user-id="110043">@Gabriel Ebner</span> , <span class="user-mention" data-user-id="128280">@Wojciech Nawrocki</span> , or <span class="user-mention" data-user-id="434989">@Chris Lovett</span>? I made sure to update to the VSCode Lean 4 extension to v0.0.84 because I thought that the line height may have been fixed by Wojciech's PR <a href="https://github.com/leanprover/vscode-lean4/pull/215">#215</a>, but unfortunately it was not.</p>



<a name="289871521"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/IntellISense%20for%20Language%20Embeddings%3F/near/289871521" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/IntellISense.20for.20Language.20Embeddings.3F.html#289871521">(Jul 17 2022 at 08:10)</a>:</h4>
<p>The hovers are completely different from the infoview issue.</p>



<a name="289871524"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/IntellISense%20for%20Language%20Embeddings%3F/near/289871524" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/IntellISense.20for.20Language.20Embeddings.3F.html#289871524">(Jul 17 2022 at 08:10)</a>:</h4>
<p>Can you post the markdown that you're sending?</p>



<a name="289871622"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/IntellISense%20for%20Language%20Embeddings%3F/near/289871622" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/IntellISense.20for.20Language.20Embeddings.3F.html#289871622">(Jul 17 2022 at 08:13)</a>:</h4>
<p><code>clangd</code> produces the following markdown for the hover above:</p>
<div class="codehilite" data-code-language="Markdown"><pre><span></span><code><span class="gu">### function `printf`</span>

---
→ <span class="sb">`int`</span>
Parameters:
<span class="k">-</span> <span class="sb">`const char * __format`</span>

---
```objective-cpp
inline int printf(const char *__format, ...)
```
</code></pre></div>



<a name="289871706"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/IntellISense%20for%20Language%20Embeddings%3F/near/289871706" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/IntellISense.20for.20Language.20Embeddings.3F.html#289871706">(Jul 17 2022 at 08:15)</a>:</h4>
<p>Okay, then it renders just as it should.</p>



<a name="289871771"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/IntellISense%20for%20Language%20Embeddings%3F/near/289871771" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/IntellISense.20for.20Language.20Embeddings.3F.html#289871771">(Jul 17 2022 at 08:16)</a>:</h4>
<p><span class="user-mention" data-user-id="110043">@Gabriel Ebner</span> the horizontal line is suppose to merge with the code block that comes after it?</p>



<a name="289871859"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/IntellISense%20for%20Language%20Embeddings%3F/near/289871859" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/IntellISense.20for.20Language.20Embeddings.3F.html#289871859">(Jul 17 2022 at 08:18)</a>:</h4>
<p>Ah, now I see what you mean.  I was distracted by the headline followed by a horizontal line followed by an arrow.</p>



<a name="289871886"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/IntellISense%20for%20Language%20Embeddings%3F/near/289871886" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/IntellISense.20for.20Language.20Embeddings.3F.html#289871886">(Jul 17 2022 at 08:19)</a>:</h4>
<p>I'm using <code>ccls</code> instead of <code>clangd</code>, which has more sensible hovers.  (Docstring followed by horizontal line followed by type signature.)</p>



<a name="289872726"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/IntellISense%20for%20Language%20Embeddings%3F/near/289872726" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/IntellISense.20for.20Language.20Embeddings.3F.html#289872726">(Jul 17 2022 at 08:39)</a>:</h4>
<p>I am using <code>clangd</code> because I was having great difficulty getting <code>ccls</code> to work in a root-less, virtual document manner.</p>



<a name="289872859"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/IntellISense%20for%20Language%20Embeddings%3F/near/289872859" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/IntellISense.20for.20Language.20Embeddings.3F.html#289872859">(Jul 17 2022 at 08:42)</a>:</h4>
<p><code>ccls</code> wants <code>file://</code> document URIs and does not seem to allow the <code>file:///dev/null/</code> trick I figured out to get <code>clangd</code> to work with virtual documents.</p>



<a name="289873238"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/IntellISense%20for%20Language%20Embeddings%3F/near/289873238" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/IntellISense.20for.20Language.20Embeddings.3F.html#289873238">(Jul 17 2022 at 08:52)</a>:</h4>
<p>While the null URI tricks does allow the  <code>ccls</code> server to run, it will complain that the virtual document is not indexed and error out.</p>



<a name="289873781"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/IntellISense%20for%20Language%20Embeddings%3F/near/289873781" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/IntellISense.20for.20Language.20Embeddings.3F.html#289873781">(Jul 17 2022 at 09:05)</a>:</h4>
<p><span class="user-mention" data-user-id="110043">@Gabriel Ebner</span> so is the verdict that there is no neat way to fix the formatting? I put an extra newline between the bar and the the code block (thinking that the grouping maybe be the problem) but that still did not work:</p>
<div class="codehilite" data-code-language="Markdown"><pre><span></span><code><span class="gu">### function `printf`</span>

---

→ <span class="sb">`int`</span>
Parameters:
<span class="k">-</span> <span class="sb">`const char * __format`</span>

---

```objective-cpp
inline int printf(const char *__format, ...)
```
</code></pre></div>



<a name="289874848"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/IntellISense%20for%20Language%20Embeddings%3F/near/289874848" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/IntellISense.20for.20Language.20Embeddings.3F.html#289874848">(Jul 17 2022 at 09:30)</a>:</h4>
<p>The formatting works "as intended".  clangd wants weird horizontal bars and duplicate type signatures, so it gets them.  Just to make sure, do you get the same formatting if you use clangd directly on a C file?</p>



<a name="289875566"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/IntellISense%20for%20Language%20Embeddings%3F/near/289875566" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mauricio Collares <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/IntellISense.20for.20Language.20Embeddings.3F.html#289875566">(Jul 17 2022 at 09:50)</a>:</h4>
<p>The problem is the non-existent padding between the second horizontal line and the code block, I assume?</p>



<a name="289876069"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/IntellISense%20for%20Language%20Embeddings%3F/near/289876069" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/IntellISense.20for.20Language.20Embeddings.3F.html#289876069">(Jul 17 2022 at 10:04)</a>:</h4>
<p>Personally, I think the whole message is the problem.  But I believe Mac is particularly unhappy about the missing padding, yes.</p>



<a name="289876106"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/IntellISense%20for%20Language%20Embeddings%3F/near/289876106" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/IntellISense.20for.20Language.20Embeddings.3F.html#289876106">(Jul 17 2022 at 10:05)</a>:</h4>
<p><a href="https://github.com/clangd/clangd/issues/747">https://github.com/clangd/clangd/issues/747</a></p>



<a name="289899974"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/IntellISense%20for%20Language%20Embeddings%3F/near/289899974" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/IntellISense.20for.20Language.20Embeddings.3F.html#289899974">(Jul 17 2022 at 19:20)</a>:</h4>
<p>Another question, <span class="user-mention" data-user-id="110043">@Gabriel Ebner</span> / <span class="user-mention" data-user-id="128280">@Wojciech Nawrocki</span> : Is there anything wrong with lightening the requirement of <code>register/chainLspRequestHandler</code> from <code>builtin_intiialize</code> to just <code>initialize</code> (so that users can register/chain handlers without plugins)? I am currently doing that manually by copying the definition and removing the check, but it seems feasible to do it in core as well (though we probably do want at least an <code>Lean.initializing</code> check there).</p>



<a name="289901514"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/IntellISense%20for%20Language%20Embeddings%3F/near/289901514" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Wojciech Nawrocki <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/IntellISense.20for.20Language.20Embeddings.3F.html#289901514">(Jul 17 2022 at 19:57)</a>:</h4>
<p>I can never remember why that check is there, so it's probably fine?</p>



<a name="289915234"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/IntellISense%20for%20Language%20Embeddings%3F/near/289915234" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/IntellISense.20for.20Language.20Embeddings.3F.html#289915234">(Jul 18 2022 at 01:53)</a>:</h4>
<p>On a somewhat related note, I ended up encoding the entirety of the <code>ClientCapabilities</code> LSP <a href="https://microsoft.github.io/language-server-protocol/specifications/lsp/3.17/specification/#clientCapabilities">specification</a> into Lean  for Alloy (see <a href="https://github.com/tydeu/lean4-alloy/blob/3b4a9a630c7ab766c6b9f2c3c5c3e7f30e6b7ca0/Alloy/Util/Server/Capabilities.lean">here</a>). Is that something worth PR'ing <span class="user-mention" data-user-id="128280">@Wojciech Nawrocki</span>? (I'm asking you as you are one of the authors of the <a href="https://github.com/leanprover/lean4/blob/5083d47e4d3ca8ad6ff7f955b7f02d46cab1fdfb/src/Lean/Data/Lsp/Capabilities.lean">current fragment</a> of the specification in the Lean core).</p>



<a name="289915651"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/IntellISense%20for%20Language%20Embeddings%3F/near/289915651" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Wojciech Nawrocki <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/IntellISense.20for.20Language.20Embeddings.3F.html#289915651">(Jul 18 2022 at 02:04)</a>:</h4>
<p>Hm, are you planning to make use of having these in core? I think the attitude so far has been to add what we need but ignore the rest.</p>



<a name="289916086"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/IntellISense%20for%20Language%20Embeddings%3F/near/289916086" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/IntellISense.20for.20Language.20Embeddings.3F.html#289916086">(Jul 18 2022 at 02:16)</a>:</h4>
<p>True. No, I don't have any plans at the moment. My reason for asking was that some of the TODOs in the server code (such as <a href="https://github.com/leanprover/lean4/blob/5083d47e4d3ca8ad6ff7f955b7f02d46cab1fdfb/src/Lean/Data/Lsp/Basic.lean#L180-L181">here</a> and <a href="https://github.com/leanprover/lean4/blob/5083d47e4d3ca8ad6ff7f955b7f02d46cab1fdfb/src/Lean/Data/Lsp/Capabilities.lean#L45">here</a>) suggested to me that the goal of the LSP code may be to encode the entire LSP specification, but what was done thus far was just what was most expedient to complete (and necessary for the Lean server's current functionality). Thus, I was curious if a PR of some of the rest of the specification would be appreciated.</p>



<a name="289931495"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/IntellISense%20for%20Language%20Embeddings%3F/near/289931495" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/IntellISense.20for.20Language.20Embeddings.3F.html#289931495">(Jul 18 2022 at 07:30)</a>:</h4>
<p><span class="user-mention" data-user-id="315577">@Mac</span> Since you've already done the work, I think it would be a waste not to upstream it. Especially since maintenance and, hopefully, compilation overhead should be pretty low.</p>



<a name="289932848"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/IntellISense%20for%20Language%20Embeddings%3F/near/289932848" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/IntellISense.20for.20Language.20Embeddings.3F.html#289932848">(Jul 18 2022 at 07:47)</a>:</h4>
<p>I've sometimes wondered if we shouldn't store the original json for open-ended definitions like the client capabilities.  Any fixed schema is going to truncate something here.  In particular it is impossible to access any of the left out fields from user code, because the watchdog already strips it out.</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">structure</span> <span class="n">WithOriginalJson</span> <span class="o">(</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">)</span> <span class="n">where</span>
  <span class="n">val</span> <span class="o">:</span> <span class="n">α</span>
  <span class="n">json</span> <span class="o">:</span> <span class="n">Json</span>

<span class="kd">instance</span> <span class="o">:</span> <span class="n">FromJson</span> <span class="o">(</span><span class="n">WithOriginalJson</span> <span class="n">α</span><span class="o">)</span> <span class="n">where</span>
  <span class="n">fromJson</span><span class="bp">?</span> <span class="n">j</span> <span class="o">:=</span> <span class="n">return</span> <span class="o">⟨</span><span class="bp">←</span> <span class="n">fromJson</span><span class="bp">?</span> <span class="n">j</span><span class="o">,</span> <span class="n">j</span><span class="o">⟩</span>

<span class="kd">instance</span> <span class="o">:</span> <span class="n">ToJson</span> <span class="o">(</span><span class="n">WithOriginalJson</span> <span class="n">α</span><span class="o">)</span> <span class="n">where</span>
  <span class="n">toJson</span> <span class="o">:=</span> <span class="n">WithOriginalJson.json</span>
</code></pre></div>



<a name="289942824"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/IntellISense%20for%20Language%20Embeddings%3F/near/289942824" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Wojciech Nawrocki <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/IntellISense.20for.20Language.20Embeddings.3F.html#289942824">(Jul 18 2022 at 09:43)</a>:</h4>
<p>Hm, are you planning to make use of having these in core? I think the attitude so far has been to add what we need but ignore the rest.</p>



<a name="289996693"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/IntellISense%20for%20Language%20Embeddings%3F/near/289996693" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/IntellISense.20for.20Language.20Embeddings.3F.html#289996693">(Jul 18 2022 at 17:18)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110043">Gabriel Ebner</span> <a href="#narrow/stream/270676-lean4/topic/IntellISense.20for.20Language.20Embeddings.3F/near/289932848">said</a>:</p>
<blockquote>
<p>I've sometimes wondered if we shouldn't store the original json for open-ended definitions like the client capabilities.  Any fixed schema is going to truncate something here. </p>
</blockquote>
<p>While I do I like idea, it is worth noting that client capabilities are not an open-ended definition according to the schema. There is one field <code>experimental</code> which is user defined (and which I implement by parameterizing <code>ClientCapabilities</code> by a type <code>Experimental</code> which defaults to <code>Json</code>), everything else is very fixed (according to the spec -- that of course doesn't stop implementers from violating the spec).</p>



<a name="289999858"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/IntellISense%20for%20Language%20Embeddings%3F/near/289999858" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/IntellISense.20for.20Language.20Embeddings.3F.html#289999858">(Jul 18 2022 at 17:45)</a>:</h4>
<p>This is a good point.  I was actually thinking of upgrades in the LSP specification version.  Because that's precisely where you need client capabilities: to figure out if the client supports the newest feature that just appeared in the spec today.  But I guess that's similar to new fields being added to <code>Diagnostic</code>.</p>



<a name="290069272"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/IntellISense%20for%20Language%20Embeddings%3F/near/290069272" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/IntellISense.20for.20Language.20Embeddings.3F.html#290069272">(Jul 19 2022 at 08:42)</a>:</h4>
<p>New problem: the Lean LSP specification does not support the full range of default semantic tokens and modifiers, thus I can't forward the highlights for such tokens from <code>clangd</code>. Would a quick PR that expands <code>SemanticTokenType</code> and <code>SemanticTokenModifier</code> to include the full list be welcomed?</p>



<a name="290070318"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/IntellISense%20for%20Language%20Embeddings%3F/near/290070318" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/IntellISense.20for.20Language.20Embeddings.3F.html#290070318">(Jul 19 2022 at 08:52)</a>:</h4>
<p>I went ahead and made one: <a href="https://github.com/leanprover/lean4/pull/1325">#1325</a>. Hope that is okay. (Still need to wait to make sure I didn't break anything, though.)</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>