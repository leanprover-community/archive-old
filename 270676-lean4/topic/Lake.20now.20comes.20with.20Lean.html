---
layout: archive
title: Zulip Chat Archive
permalink: /stream/270676-lean4/topic/Lake.20now.20comes.20with.20Lean.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/index.html">lean4</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Lake.20now.20comes.20with.20Lean.html">Lake now comes with Lean</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="257786621"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Lake%20now%20comes%20with%20Lean/near/257786621" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Lake.20now.20comes.20with.20Lean.html#257786621">(Oct 16 2021 at 00:48)</a>:</h4>
<p>I am happy to announce that the latest Lean 4 nightly <code>10-16</code> now ships with <code>lake</code>! <span aria-label="celebration" class="emoji emoji-1f388" role="img" title="celebration">:celebration:</span> </p>
<div class="codehilite" data-code-language="Text only"><pre><span></span><code>$ elan which lake
C:\Users\Mac\.elan\toolchains\leanprover--lean4---nightly\bin\lake.exe
$ lake --version
Lake version 3.0.0-pre (Lean version 4.0.0-nightly-2021-10-16)
</code></pre></div>



<a name="257797436"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Lake%20now%20comes%20with%20Lean/near/257797436" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Xubai Wang <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Lake.20now.20comes.20with.20Lean.html#257797436">(Oct 16 2021 at 03:43)</a>:</h4>
<p>When running <code>lake</code> on Windows MSYS2, a bunch of errors arise during the link process, even with the simplest <code>lake new</code> template.</p>
<div class="codehilite" data-code-language="Bash"><pre><span></span><code>$ lake build
&gt; <span class="nv">LEAN_PATH</span><span class="o">=</span>.<span class="se">\b</span>uild<span class="se">\l</span>ib c:<span class="se">\U</span>sers<span class="se">\x</span>ubaiw<span class="se">\.</span>elan<span class="se">\t</span>oolchains<span class="se">\l</span>eanprover--lean4---nightly-2021-10-16<span class="se">\b</span>in<span class="se">\l</span>ean -R .<span class="se">\.</span> -o .<span class="se">\b</span>uild<span class="se">\l</span>ib<span class="se">\F</span>oo.olean -c .<span class="se">\b</span>uild<span class="se">\i</span>r<span class="se">\F</span>oo.c .<span class="se">\.\F</span>oo.lean
&gt; c:<span class="se">\U</span>sers<span class="se">\x</span>ubaiw<span class="se">\.</span>elan<span class="se">\t</span>oolchains<span class="se">\l</span>eanprover--lean4---nightly-2021-10-16<span class="se">\b</span>in<span class="se">\l</span>eanc -c -o .<span class="se">\b</span>uild<span class="se">\i</span>r<span class="se">\F</span>oo.o .<span class="se">\b</span>uild<span class="se">\i</span>r<span class="se">\F</span>oo.c -O3 -DNDEBUG -lstdc++
&gt; <span class="nv">LEAN_PATH</span><span class="o">=</span>.<span class="se">\b</span>uild<span class="se">\l</span>ib c:<span class="se">\U</span>sers<span class="se">\x</span>ubaiw<span class="se">\.</span>elan<span class="se">\t</span>oolchains<span class="se">\l</span>eanprover--lean4---nightly-2021-10-16<span class="se">\b</span>in<span class="se">\l</span>ean -R .<span class="se">\.</span> -o .<span class="se">\b</span>uild<span class="se">\l</span>ib<span class="se">\M</span>ain.olean -c .<span class="se">\b</span>uild<span class="se">\i</span>r<span class="se">\M</span>ain.c .<span class="se">\.\M</span>ain.lean
&gt; c:<span class="se">\U</span>sers<span class="se">\x</span>ubaiw<span class="se">\.</span>elan<span class="se">\t</span>oolchains<span class="se">\l</span>eanprover--lean4---nightly-2021-10-16<span class="se">\b</span>in<span class="se">\l</span>eanc -c -o .<span class="se">\b</span>uild<span class="se">\i</span>r<span class="se">\M</span>ain.o .<span class="se">\b</span>uild<span class="se">\i</span>r<span class="se">\M</span>ain.c -O3 -DNDEBUG -lstdc++
&gt; c:<span class="se">\U</span>sers<span class="se">\x</span>ubaiw<span class="se">\.</span>elan<span class="se">\t</span>oolchains<span class="se">\l</span>eanprover--lean4---nightly-2021-10-16<span class="se">\b</span>in<span class="se">\l</span>eanc -o .<span class="se">\b</span>uild<span class="se">\b</span>in<span class="se">\f</span>oo.exe .<span class="se">\b</span>uild<span class="se">\i</span>r<span class="se">\F</span>oo.o .<span class="se">\b</span>uild<span class="se">\i</span>r<span class="se">\M</span>ain.o -lstdc++
/usr/lib/gcc/x86_64-pc-msys/10.2.0/../../../../x86_64-pc-msys/bin/ld: c:<span class="se">\U</span>sers<span class="se">\x</span>ubaiw<span class="se">\.</span>elan<span class="se">\t</span>oolchains<span class="se">\l</span>eanprover--lean4---nightly-2021-10-16<span class="se">\l</span>ib<span class="se">\l</span>ean/libleanrt.a<span class="o">(</span>object.cpp.obj<span class="o">)</span>:object.cpp:<span class="o">(</span>.text+0x105<span class="o">)</span>: undefined reference to <span class="sb">`</span>std::basic_ostream&lt;char, std::char_traits&lt;char&gt; &gt;<span class="p">&amp;</span> std::__ostream_insert&lt;char, std::char_traits&lt;char&gt; &gt;<span class="o">(</span>std::basic_ostream&lt;char, std::char_traits&lt;char&gt; &gt;<span class="p">&amp;</span>, char const*, long long<span class="o">)</span><span class="s1">'</span>
<span class="s1">/usr/lib/gcc/x86_64-pc-msys/10.2.0/../../../../x86_64-pc-msys/bin/ld: c:\Users\xubaiw\.elan\toolchains\leanprover--lean4---nightly-2021-10-16\lib\lean/libleanrt.a(object.cpp.obj):object.cpp:(.text+0x11a): undefined reference to `std::basic_ostream&lt;char, std::char_traits&lt;char&gt; &gt;&amp; std::__ostream_insert&lt;char, std::char_traits&lt;char&gt; &gt;(std::basic_ostream&lt;char, std::char_traits&lt;char&gt; &gt;&amp;, char const*, long long)'</span>
/usr/lib/gcc/x86_64-pc-msys/10.2.0/../../../../x86_64-pc-msys/bin/ld: c:<span class="se">\U</span>sers<span class="se">\x</span>ubaiw<span class="se">\.</span>elan<span class="se">\t</span>oolchains<span class="se">\l</span>eanprover--lean4---nightly-2021-10-16<span class="se">\l</span>ib<span class="se">\l</span>ean/libleanrt.a<span class="o">(</span>object.cpp.obj<span class="o">)</span>:object.cpp:<span class="o">(</span>.text+0xe57<span class="o">)</span>: undefined reference to <span class="sb">`</span>operator new<span class="o">[](</span>unsigned long long<span class="o">)</span><span class="err">'</span>
<span class="c1"># many more</span>
</code></pre></div>
<p>But as both <code>lean --run</code> and <code>g++</code> works correctly on this machine, I'm assuming Lean and c compilers are installed correctly.<br>
Do we need some special configurations on MSYS2?</p>



<a name="257797865"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Lake%20now%20comes%20with%20Lean/near/257797865" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Xubai Wang <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Lake.20now.20comes.20with.20Lean.html#257797865">(Oct 16 2021 at 03:50)</a>:</h4>
<p>Since most of the errors are like <code>undefined reference to operator new</code>,  it's very likely the problem arises from libc++, but adding <code>-lstdc++</code> flag to <code>moreLinkArgs</code> doesn't work.</p>



<a name="257807796"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Lake%20now%20comes%20with%20Lean/near/257807796" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Lake.20now.20comes.20with.20Lean.html#257807796">(Oct 16 2021 at 06:42)</a>:</h4>
<p>Does/did it work with <code>leanpkg</code> before?</p>



<a name="257808172"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Lake%20now%20comes%20with%20Lean/near/257808172" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Lake.20now.20comes.20with.20Lean.html#257808172">(Oct 16 2021 at 06:49)</a>:</h4>
<p>I've <a href="#narrow/stream/270676-lean4/topic/build.20requirements.20for.20Lean4">noticed previously</a> that the build instructions given in the manual don't actually install <code>stdc++</code> on some systems (e.g. a bare ubuntu machine), and you need to also <code>apt-get install -y libstdc++-9-dev</code> in order to run the full test suite and/or do some things with Lake.</p>



<a name="257808969"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Lake%20now%20comes%20with%20Lean/near/257808969" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Xubai Wang <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Lake.20now.20comes.20with.20Lean.html#257808969">(Oct 16 2021 at 07:02)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110024">Sebastian Ullrich</span> <a href="#narrow/stream/270676-lean4/topic/Lake.20now.20comes.20with.20Lean/near/257807796">said</a>:</p>
<blockquote>
<p>Does/did it work with <code>leanpkg</code> before?</p>
</blockquote>
<p>Both <code>leanpkg</code> and <code>leanmake</code> fails due to the same reason, so it must be a problem of <code>leanc</code>.</p>



<a name="257809377"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Lake%20now%20comes%20with%20Lean/near/257809377" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Xubai Wang <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Lake.20now.20comes.20with.20Lean.html#257809377">(Oct 16 2021 at 07:09)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110087">Scott Morrison</span> <a href="#narrow/stream/270676-lean4/topic/Lake.20now.20comes.20with.20Lean/near/257808172">said</a>:</p>
<blockquote>
<p>I've <a href="#narrow/stream/270676-lean4/topic/build.20requirements.20for.20Lean4">noticed previously</a> that the build instructions given in the manual don't actually install <code>stdc++</code> on some systems (e.g. a bare ubuntu machine), and you need to also <code>apt-get install -y libstdc++-9-dev</code> in order to run the full test suite and/or do some things with Lake.</p>
</blockquote>
<p>I'll try it. <br>
Lean 4 manual doesn't mention which compiler to use, so I just use <code>pacman -S msys/gcc</code>.</p>



<a name="257809449"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Lake%20now%20comes%20with%20Lean/near/257809449" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Lake.20now.20comes.20with.20Lean.html#257809449">(Oct 16 2021 at 07:10)</a>:</h4>
<p><span class="user-mention" data-user-id="315577">@Mac</span>, I've updated mathlib4 to use <code>Lake</code> on <a href="https://github.com/leanprover-community/mathlib4/issues/74">mathlib4#74</a>.</p>
<p>However it's a bit annoying that we have to type <code>lake build :oleans</code>, rather than just <code>lake build</code>. <code>mathlib4</code> doesn't have a main executable, and probably never will! Is there something we can do to ameliorate this, ideally in Lake, otherwise in <code>mathlib4</code>s <code>lakefile</code>?</p>



<a name="257809499"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Lake%20now%20comes%20with%20Lean/near/257809499" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Lake.20now.20comes.20with.20Lean.html#257809499">(Oct 16 2021 at 07:12)</a>:</h4>
<p><span class="user-mention" data-user-id="414345">@Xubai Wang</span>, are you looking at <a href="https://leanprover.github.io/lean4/doc/make/index.html">https://leanprover.github.io/lean4/doc/make/index.html</a>? It has instructions for building from source on windows, and gives advice on compilers.</p>



<a name="257809833"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Lake%20now%20comes%20with%20Lean/near/257809833" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Lake.20now.20comes.20with.20Lean.html#257809833">(Oct 16 2021 at 07:17)</a>:</h4>
<p>Also, <span class="user-mention" data-user-id="315577">@Mac</span>, to run the tests in mathlib4 I'm just using <code>env LEAN_PATH=build/lib lean test/$*</code>. Could you show me the lake way to do this?</p>



<a name="257810311"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Lake%20now%20comes%20with%20Lean/near/257810311" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Xubai Wang <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Lake.20now.20comes.20with.20Lean.html#257810311">(Oct 16 2021 at 07:24)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110087">Scott Morrison</span> <a href="#narrow/stream/270676-lean4/topic/Lake.20now.20comes.20with.20Lean/near/257809499">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="414345">Xubai Wang</span>, are you looking at <a href="https://leanprover.github.io/lean4/doc/make/index.html">https://leanprover.github.io/lean4/doc/make/index.html</a>? It has instructions for building from source on windows, and gives advice on compilers.</p>
</blockquote>
<p>Thanks! It works now.</p>



<a name="257835712"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Lake%20now%20comes%20with%20Lean/near/257835712" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Lake.20now.20comes.20with.20Lean.html#257835712">(Oct 16 2021 at 14:28)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110087">Scott Morrison</span> <a href="#narrow/stream/270676-lean4/topic/Lake.20now.20comes.20with.20Lean/near/257809449">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="315577">Mac</span>, I've updated mathlib4 to use <code>Lake</code> on <a href="https://github.com/leanprover-community/mathlib4/issues/74">mathlib4#74</a>.</p>
<p>However it's a bit annoying that we have to type <code>lake build :oleans</code>, rather than just <code>lake build</code>. <code>mathlib4</code> doesn't have a main executable, and probably never will! Is there something we can do to ameliorate this, ideally in Lake, otherwise in <code>mathlib4</code>s <code>lakefile</code>?</p>
</blockquote>
<p>Yes, you can set <a href="https://github.com/leanprover/lake/blob/bc89105dc5194ac13d3a7634b928f5d0651f138a/Lake/Package.lean#L174"><code>defaultFacet</code></a> in your <code>lakefile.lean</code> to <code>defaultFacet := PackageFacet.oleans</code>. </p>
<p>I am also hoping to make Lake have smarter defaults in the future by making the bin target an optional configuration.</p>



<a name="257888113"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Lake%20now%20comes%20with%20Lean/near/257888113" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Lake.20now.20comes.20with.20Lean.html#257888113">(Oct 17 2021 at 04:50)</a>:</h4>
<p>Thanks, I've added this setting to the mathlib4 PR: <a href="https://github.com/leanprover-community/mathlib4/pull/74">https://github.com/leanprover-community/mathlib4/pull/74</a>.</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>