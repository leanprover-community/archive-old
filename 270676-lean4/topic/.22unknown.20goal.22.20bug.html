---
layout: archive
title: Zulip Chat Archive
permalink: /stream/270676-lean4/topic/.22unknown.20goal.22.20bug.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/index.html">lean4</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.22unknown.20goal.22.20bug.html">"unknown goal" bug</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="314186844"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%22unknown%20goal%22%20bug/near/314186844" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thomas Murrills <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.22unknown.20goal.22.20bug.html#314186844">(Dec 06 2022 at 08:05)</a>:</h4>
<p>Providing these field values as <code>by intros; trivial</code> leaves us with no errors. Also, it's just <code>le_sup_inf</code> that seems to have an issue, which might be a clue.</p>



<a name="314187029"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%22unknown%20goal%22%20bug/near/314187029" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Notification Bot <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.22unknown.20goal.22.20bug.html#314187029">(Dec 06 2022 at 08:06)</a>:</h4>
<p>A message was moved here from <a class="stream-topic" data-stream-id="270676" href="/#narrow/stream/270676-lean4/topic/.5BRFC.5D.20refine_struct.20functionality.20via.20new.20.3F.2E.2E.20syntax">#lean4 &gt; [RFC] refine_struct functionality via new ?.. syntax</a> by <span class="user-mention silent" data-user-id="548935">Thomas Murrills</span>.</p>



<a name="314187072"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%22unknown%20goal%22%20bug/near/314187072" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Notification Bot <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.22unknown.20goal.22.20bug.html#314187072">(Dec 06 2022 at 08:06)</a>:</h4>
<p>A message was moved here from <a class="stream-topic" data-stream-id="270676" href="/#narrow/stream/270676-lean4/topic/.5BRFC.5D.20refine_struct.20functionality.20via.20new.20.3F.2E.2E.20syntax">#lean4 &gt; [RFC] refine_struct functionality via new ?.. syntax</a> by <span class="user-mention silent" data-user-id="548935">Thomas Murrills</span>.</p>



<a name="314187110"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%22unknown%20goal%22%20bug/near/314187110" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Notification Bot <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.22unknown.20goal.22.20bug.html#314187110">(Dec 06 2022 at 08:07)</a>:</h4>
<p>A message was moved here from <a class="stream-topic" data-stream-id="270676" href="/#narrow/stream/270676-lean4/topic/.5BRFC.5D.20refine_struct.20functionality.20via.20new.20.3F.2E.2E.20syntax">#lean4 &gt; [RFC] refine_struct functionality via new ?.. syntax</a> by <span class="user-mention silent" data-user-id="548935">Thomas Murrills</span>.</p>



<a name="314192049"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%22unknown%20goal%22%20bug/near/314192049" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.22unknown.20goal.22.20bug.html#314192049">(Dec 06 2022 at 08:46)</a>:</h4>
<p>Could you file an <a href="https://leanprover-community.github.io/mwe.html">#mwe</a>?</p>



<a name="314196644"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%22unknown%20goal%22%20bug/near/314196644" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thomas Murrills <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.22unknown.20goal.22.20bug.html#314196644">(Dec 06 2022 at 09:19)</a>:</h4>
<p>I can try :) But given how large the structures involved are I expect that finding where something is going wrong will be a considerable part of the challenge…is there any capability in Lean to trace back what functions called what other functions that eventually led to a given error? (as opposed to <code>trace</code>-ing specific messages—or maybe there is some specific trace class that represents this?) Somehow this is coming from <code>withGoalCtx</code> but I have no idea what called that (or what prepared its arguments for it)</p>



<a name="314203766"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%22unknown%20goal%22%20bug/near/314203766" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.22unknown.20goal.22.20bug.html#314203766">(Dec 06 2022 at 10:08)</a>:</h4>
<p>I would just try to do this by hand: make up two structures, one extending the other, and make two instances like in your example. If that doesn't reproduce the error, BooleanAlgebra is not that far into mathlib. I think it would be possible to just reduce this to a MWE step-by-step. I would put this instance in a new file, then repeat the following steps:</p>
<ul>
<li>remove an import X</li>
<li>if that fails because it can't find a declaration Y, copy and paste Y into your file, go back to the start.</li>
</ul>



<a name="314203797"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%22unknown%20goal%22%20bug/near/314203797" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.22unknown.20goal.22.20bug.html#314203797">(Dec 06 2022 at 10:08)</a>:</h4>
<p>I can help if the second approach proves necessary. (I have lots of practice at stripping mathlib to MWEs recently...)</p>



<a name="314226999"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%22unknown%20goal%22%20bug/near/314226999" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.22unknown.20goal.22.20bug.html#314226999">(Dec 06 2022 at 12:33)</a>:</h4>
<p>Let me echo that -- a working example even on a branch of mathlib4 is a good way to start (at that point you can show it to others and they can see what you're seeing, and if you're lucky then that's already enough). If that's still too big and it's necessary to remove mathlib4 from the picture then this can be kind of an algorithmic process which e.g. I could try on the tube journey home if someone else doesn't do it first.</p>



<a name="314336313"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%22unknown%20goal%22%20bug/near/314336313" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thomas Murrills <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.22unknown.20goal.22.20bug.html#314336313">(Dec 06 2022 at 22:12)</a>:</h4>
<p>Progress! (the following is longer, but self-contained)</p>



<a name="314336394"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%22unknown%20goal%22%20bug/near/314336394" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thomas Murrills <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.22unknown.20goal.22.20bug.html#314336394">(Dec 06 2022 at 22:13)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">Aesop</span>

<span class="kd">class</span> <span class="n">LE'</span> <span class="o">(</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">)</span> <span class="n">where</span>
  <span class="n">le</span> <span class="o">:</span> <span class="n">α</span> <span class="bp">→</span> <span class="n">α</span> <span class="bp">→</span> <span class="kt">Prop</span>

<span class="kd">class</span> <span class="n">HasSup'</span> <span class="o">(</span><span class="n">α</span><span class="o">)</span> <span class="n">where</span>
  <span class="n">sup</span> <span class="o">:</span> <span class="n">α</span> <span class="bp">→</span> <span class="n">α</span> <span class="bp">→</span> <span class="n">α</span>

<span class="kd">class</span> <span class="n">HasInf'</span> <span class="o">(</span><span class="n">α</span><span class="o">)</span> <span class="n">where</span>
  <span class="n">inf</span> <span class="o">:</span> <span class="n">α</span> <span class="bp">→</span> <span class="n">α</span> <span class="bp">→</span> <span class="n">α</span>

<span class="kd">class</span> <span class="n">HasCompl'</span> <span class="o">(</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">_</span><span class="o">)</span> <span class="n">where</span>
  <span class="n">compl</span> <span class="o">:</span> <span class="n">α</span> <span class="bp">→</span> <span class="n">α</span>

<span class="kd">class</span> <span class="n">SDiff'</span> <span class="o">(</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">)</span> <span class="n">where</span>
  <span class="n">sdiff</span> <span class="o">:</span> <span class="n">α</span> <span class="bp">→</span> <span class="n">α</span> <span class="bp">→</span> <span class="n">α</span>

<span class="kd">class</span> <span class="n">DistribLattice'</span> <span class="o">(</span><span class="n">α</span><span class="o">)</span> <span class="kd">extends</span> <span class="n">LE'</span> <span class="n">α</span><span class="o">,</span> <span class="n">HasSup'</span> <span class="n">α</span><span class="o">,</span> <span class="n">HasInf'</span> <span class="n">α</span> <span class="n">where</span>
  <span class="n">le_sup_inf</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">x</span> <span class="n">y</span> <span class="n">z</span> <span class="o">:</span> <span class="n">α</span><span class="o">,</span> <span class="n">le</span> <span class="o">(</span><span class="n">inf</span> <span class="o">(</span><span class="n">sup</span> <span class="n">x</span> <span class="n">y</span><span class="o">)</span> <span class="o">(</span><span class="n">sup</span> <span class="n">x</span> <span class="n">z</span><span class="o">))</span> <span class="o">(</span><span class="n">sup</span> <span class="n">x</span> <span class="o">(</span><span class="n">inf</span> <span class="n">y</span> <span class="n">z</span><span class="o">))</span>

<span class="kd">class</span> <span class="n">BooleanAlgebra'</span> <span class="o">(</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">)</span> <span class="kd">extends</span>
  <span class="n">DistribLattice'</span> <span class="n">α</span><span class="o">,</span> <span class="n">HasCompl'</span> <span class="n">α</span><span class="o">,</span> <span class="n">SDiff'</span> <span class="n">α</span> <span class="n">where</span>
<span class="n">sdiff_eq</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">x</span> <span class="n">y</span> <span class="o">:</span> <span class="n">α</span><span class="o">,</span> <span class="n">sdiff</span> <span class="n">x</span> <span class="n">y</span> <span class="bp">=</span> <span class="n">inf</span> <span class="n">x</span> <span class="o">(</span><span class="n">compl</span> <span class="n">y</span><span class="o">)</span> <span class="o">:=</span> <span class="kd">by</span> <span class="n">aesop</span>

<span class="kd">def</span> <span class="n">booleanAlgebra'</span> <span class="o">:</span> <span class="n">BooleanAlgebra'</span> <span class="n">PUnit</span> <span class="o">:=</span>
  <span class="o">{</span> <span class="n">le</span> <span class="o">:=</span> <span class="k">fun</span> <span class="n">_</span> <span class="n">_</span> <span class="bp">=&gt;</span> <span class="n">True</span><span class="o">,</span> <span class="n">sup</span> <span class="o">:=</span> <span class="k">fun</span> <span class="n">_</span> <span class="n">_</span> <span class="bp">=&gt;</span> <span class="bp">.</span><span class="n">unit</span><span class="o">,</span> <span class="n">inf</span> <span class="o">:=</span> <span class="k">fun</span> <span class="n">_</span> <span class="n">_</span> <span class="bp">=&gt;</span> <span class="bp">.</span><span class="n">unit</span><span class="o">,</span>
     <span class="n">compl</span> <span class="o">:=</span> <span class="k">fun</span> <span class="n">_</span> <span class="bp">=&gt;</span> <span class="bp">.</span><span class="n">unit</span><span class="o">,</span> <span class="n">sdiff</span> <span class="o">:=</span> <span class="k">fun</span> <span class="n">_</span> <span class="n">_</span> <span class="bp">=&gt;</span> <span class="bp">.</span><span class="n">unit</span><span class="o">,</span>
     <span class="n">sdiff_eq</span> <span class="o">:=</span> <span class="kd">by</span> <span class="n">aesop</span><span class="o">,</span> <span class="n">le_sup_inf</span> <span class="o">:=</span> <span class="bp">?</span><span class="n">x</span><span class="o">}</span>
</code></pre></div>



<a name="314343149"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%22unknown%20goal%22%20bug/near/314343149" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thomas Murrills <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.22unknown.20goal.22.20bug.html#314343149">(Dec 06 2022 at 22:59)</a>:</h4>
<p>Ok, I think this is pretty close to an <a href="https://leanprover-community.github.io/mwe.html">#mwe</a> !</p>



<a name="314343166"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%22unknown%20goal%22%20bug/near/314343166" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thomas Murrills <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.22unknown.20goal.22.20bug.html#314343166">(Dec 06 2022 at 22:59)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">Aesop</span>

<span class="kd">class</span> <span class="n">Foo</span> <span class="o">(</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">)</span> <span class="n">where</span>
  <span class="n">f</span> <span class="o">:</span> <span class="n">α</span> <span class="bp">→</span> <span class="n">α</span>
  <span class="n">p</span> <span class="o">:</span> <span class="n">True</span>

<span class="kd">class</span> <span class="n">Bar</span> <span class="o">(</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">)</span> <span class="kd">extends</span>
  <span class="n">Foo</span> <span class="n">α</span> <span class="n">where</span>
  <span class="n">eq</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">x</span> <span class="o">:</span> <span class="n">α</span><span class="o">,</span> <span class="n">f</span> <span class="n">x</span> <span class="bp">=</span> <span class="n">f</span> <span class="n">x</span>

<span class="kd">def</span> <span class="n">bar</span> <span class="o">:</span> <span class="n">Bar</span> <span class="n">Unit</span> <span class="o">:=</span>
  <span class="o">{</span> <span class="n">f</span> <span class="o">:=</span> <span class="k">fun</span> <span class="n">_</span> <span class="bp">=&gt;</span> <span class="o">(),</span> <span class="n">eq</span> <span class="o">:=</span> <span class="kd">by</span> <span class="n">aesop</span><span class="o">,</span> <span class="n">p</span> <span class="o">:=</span> <span class="bp">?</span><span class="n">x</span><span class="o">}</span>
</code></pre></div>



<a name="314343298"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%22unknown%20goal%22%20bug/near/314343298" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thomas Murrills <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.22unknown.20goal.22.20bug.html#314343298">(Dec 06 2022 at 23:00)</a>:</h4>
<p>If I move either <code>f</code> or <code>p</code> down into <code>Bar</code>, the "unknown goal" error disappears.</p>



<a name="314343680"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%22unknown%20goal%22%20bug/near/314343680" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thomas Murrills <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.22unknown.20goal.22.20bug.html#314343680">(Dec 06 2022 at 23:02)</a>:</h4>
<p>Note that <code>by aesop</code> is what's underlined in red here, so I think it's an aesop error—especially since replacing it with <code>by intros; rfl</code>resolves the error.</p>



<a name="314343928"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%22unknown%20goal%22%20bug/near/314343928" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jannis Limperg <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.22unknown.20goal.22.20bug.html#314343928">(Dec 06 2022 at 23:04)</a>:</h4>
<p>Definitely an Aesop bug. I'll take a look, thanks!</p>



<a name="314466315"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%22unknown%20goal%22%20bug/near/314466315" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jannis Limperg <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.22unknown.20goal.22.20bug.html#314466315">(Dec 07 2022 at 14:20)</a>:</h4>
<p>Fixed. Thank you for the nice MWE!</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>