---
layout: archive
title: Zulip Chat Archive
permalink: /stream/270676-lean4/topic/Lean.20tossing.20an.20error.20over.20having.20exactly.20what.20it.20wants.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/index.html">lean4</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Lean.20tossing.20an.20error.20over.20having.20exactly.20what.20it.20wants.html">Lean tossing an error over having exactly what it wants</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="286027320"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Lean%20tossing%20an%20error%20over%20having%20exactly%20what%20it%20wants/near/286027320" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Aron <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Lean.20tossing.20an.20error.20over.20having.20exactly.20what.20it.20wants.html#286027320">(Jun 14 2022 at 06:33)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">Mathlib.Logic.Basic</span>
<span class="c1">-- def exunique (p : α → Prop) := ∃ (x : α), (p x ∧ ∀ y, p y → x = y)</span>

<span class="c1">-- syntax "∃!" term "," term: term</span>
<span class="c1">-- macro_rules</span>
<span class="c1">-- | `(∃! $t:term, $p:term) =&gt; `(exunique (fun $t =&gt; $p))</span>

<span class="kd">class</span> <span class="n">incidence</span> <span class="o">(</span><span class="n">point</span> <span class="n">line</span><span class="o">:</span> <span class="kt">Type</span><span class="o">)</span> <span class="o">(</span><span class="n">inc</span><span class="o">:</span><span class="n">point</span> <span class="bp">→</span> <span class="n">line</span> <span class="bp">→</span> <span class="kt">Prop</span><span class="o">)</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">one</span><span class="o">:</span> <span class="bp">∀</span> <span class="n">P</span> <span class="n">Q</span><span class="o">,</span> <span class="n">P</span> <span class="bp">≠</span> <span class="n">Q</span> <span class="bp">→</span> <span class="bp">∃!</span> <span class="n">l</span><span class="o">,</span> <span class="n">inc</span> <span class="n">P</span> <span class="n">l</span> <span class="bp">∧</span> <span class="n">inc</span> <span class="n">Q</span> <span class="n">l</span><span class="o">)</span>
<span class="o">(</span><span class="n">two</span><span class="o">:</span> <span class="bp">∀</span> <span class="n">l</span><span class="o">,</span> <span class="bp">∃</span> <span class="n">P</span> <span class="n">Q</span><span class="o">,</span> <span class="n">P</span> <span class="bp">≠</span> <span class="n">Q</span> <span class="bp">∧</span> <span class="n">inc</span> <span class="n">P</span> <span class="n">l</span> <span class="bp">∧</span> <span class="n">inc</span> <span class="n">Q</span> <span class="n">l</span><span class="o">)</span>
<span class="o">(</span><span class="n">three</span><span class="o">:</span> <span class="bp">∃</span> <span class="n">P</span> <span class="n">Q</span> <span class="n">R</span><span class="o">,</span> <span class="n">P</span> <span class="bp">≠</span> <span class="n">Q</span> <span class="bp">∧</span> <span class="n">P</span> <span class="bp">≠</span> <span class="n">R</span> <span class="bp">∧</span> <span class="n">Q</span> <span class="bp">≠</span> <span class="n">R</span> <span class="bp">∧</span> <span class="bp">∀</span> <span class="n">l</span><span class="o">,</span> <span class="bp">¬</span><span class="o">(</span><span class="n">inc</span> <span class="n">P</span> <span class="n">l</span> <span class="bp">∧</span> <span class="n">inc</span> <span class="n">Q</span> <span class="n">l</span> <span class="bp">∧</span> <span class="n">inc</span> <span class="n">R</span> <span class="n">l</span><span class="o">))</span>

<span class="kd">variable</span> <span class="o">{</span><span class="n">point</span> <span class="n">line</span><span class="o">:</span><span class="kt">Type</span><span class="o">}</span>
<span class="kd">variable</span> <span class="o">(</span><span class="n">inc</span><span class="o">:</span><span class="n">point</span> <span class="bp">→</span> <span class="n">line</span> <span class="bp">→</span> <span class="kt">Prop</span><span class="o">)</span>
<span class="kd">variable</span> <span class="o">[</span><span class="n">i</span><span class="o">:</span> <span class="n">incidence</span> <span class="n">point</span> <span class="n">line</span> <span class="n">inc</span><span class="o">]</span>

<span class="c1">-- many lines and theorems hidden for your convenience</span>

<span class="kd">theorem</span> <span class="n">t6</span><span class="o">:</span> <span class="bp">∃</span> <span class="n">l1</span> <span class="n">l2</span> <span class="n">l3</span><span class="o">,</span> <span class="n">l1</span><span class="bp">≠</span><span class="n">l2</span><span class="bp">∧</span><span class="n">l1</span><span class="bp">≠</span><span class="n">l3</span><span class="bp">∧</span><span class="n">l2</span><span class="bp">≠</span><span class="n">l3</span><span class="bp">∧∀</span> <span class="n">p</span><span class="o">,</span><span class="bp">¬</span><span class="o">(</span><span class="n">inc</span> <span class="n">p</span> <span class="n">l1</span> <span class="bp">∧</span> <span class="n">inc</span> <span class="n">p</span> <span class="n">l2</span> <span class="bp">∧</span> <span class="n">inc</span> <span class="n">p</span> <span class="n">l3</span><span class="o">)</span> <span class="o">:=</span><span class="kd">by</span>
<span class="k">have</span> <span class="o">⟨</span><span class="n">a</span><span class="o">,</span><span class="n">b</span><span class="o">,</span><span class="n">c</span><span class="o">,</span><span class="n">h'a'n'b</span><span class="o">,</span><span class="n">h'a'n'c</span><span class="o">,</span><span class="n">h'b'n'c</span><span class="o">,</span><span class="n">h'n'col</span><span class="o">⟩:=</span><span class="n">i.three</span>
<span class="k">have</span> <span class="o">⟨</span><span class="n">l'ab</span><span class="o">,</span><span class="n">h'lab'ppty</span><span class="o">,</span><span class="n">h'lab'uq</span><span class="o">⟩:=</span> <span class="n">i.one</span> <span class="n">a</span> <span class="n">b</span> <span class="n">h'a'n'b</span>
<span class="k">have</span> <span class="o">⟨</span><span class="n">l'ac</span><span class="o">,</span><span class="n">h'lac'ppty</span><span class="o">,</span><span class="n">h'lac'uq</span><span class="o">⟩:=</span> <span class="n">i.one</span> <span class="n">a</span> <span class="n">c</span> <span class="n">h'a'n'c</span>
<span class="k">have</span> <span class="o">⟨</span><span class="n">l'bc</span><span class="o">,</span><span class="n">h'lbc'ppty</span><span class="o">,</span><span class="n">h'lbc'uq</span><span class="o">⟩:=</span> <span class="n">i.one</span> <span class="n">b</span> <span class="n">c</span> <span class="n">h'b'n'c</span>
<span class="n">refine</span> <span class="o">⟨</span><span class="n">l'ab</span><span class="o">,</span><span class="n">l'ac</span><span class="o">,</span><span class="n">l'bc</span><span class="o">,</span><span class="bp">?</span><span class="n">_</span><span class="o">,</span><span class="bp">?</span><span class="n">_</span><span class="o">,</span><span class="bp">?</span><span class="n">_</span><span class="o">,</span><span class="bp">?</span><span class="n">_</span><span class="o">⟩</span>
<span class="o">{</span>
<span class="n">intro</span> <span class="n">h'lab'lac</span>
<span class="k">have</span> <span class="n">h'c'lab</span><span class="o">:=</span> <span class="n">Eq.substr</span> <span class="n">h'lab'lac</span> <span class="n">h'lac'ppty</span>

<span class="o">}</span>
<span class="o">{</span><span class="gr">sorry</span><span class="o">}</span>
<span class="o">{</span><span class="gr">sorry</span><span class="o">}</span>
<span class="o">{</span><span class="gr">sorry</span><span class="o">}</span>
</code></pre></div>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">Trying.lean</span><span class="o">:</span><span class="mi">253</span><span class="o">:</span><span class="mi">35</span><span class="o">:</span> <span class="n">error</span><span class="o">:</span> <span class="n">application</span> <span class="n">type</span> <span class="n">mismatch</span>
  <span class="n">Eq.substr</span> <span class="n">h'lab'lac</span> <span class="n">h'lac'ppty</span>
<span class="n">argument</span>
  <span class="n">h'lac'ppty</span>
<span class="n">has</span> <span class="n">type</span>
  <span class="o">(</span><span class="k">fun</span> <span class="n">l</span> <span class="bp">=&gt;</span> <span class="n">inc</span> <span class="n">a</span> <span class="n">l</span> <span class="bp">∧</span> <span class="n">inc</span> <span class="n">c</span> <span class="n">l</span><span class="o">)</span> <span class="n">l'ac</span> <span class="o">:</span> <span class="kt">Prop</span>
<span class="n">but</span> <span class="n">is</span> <span class="n">expected</span> <span class="n">to</span> <span class="k">have</span> <span class="n">type</span>
  <span class="o">(</span><span class="k">fun</span> <span class="n">l</span> <span class="bp">=&gt;</span> <span class="n">inc</span> <span class="n">a</span> <span class="n">l</span> <span class="bp">∧</span> <span class="n">inc</span> <span class="n">c</span> <span class="n">l</span><span class="o">)</span> <span class="n">l'ac</span> <span class="o">:</span> <span class="kt">Prop</span>
<span class="bp">././</span><span class="n">Trying.lean</span><span class="o">:</span><span class="mi">256</span><span class="o">:</span><span class="mi">1</span><span class="o">:</span> <span class="n">warning</span><span class="o">:</span> <span class="n">declaration</span> <span class="n">uses</span> <span class="bp">'</span><span class="gr">sorry</span><span class="bp">'</span>
<span class="bp">././</span><span class="n">Trying.lean</span><span class="o">:</span><span class="mi">257</span><span class="o">:</span><span class="mi">1</span><span class="o">:</span> <span class="n">warning</span><span class="o">:</span> <span class="n">declaration</span> <span class="n">uses</span> <span class="bp">'</span><span class="gr">sorry</span><span class="bp">'</span>
<span class="bp">././</span><span class="n">Trying.lean</span><span class="o">:</span><span class="mi">258</span><span class="o">:</span><span class="mi">1</span><span class="o">:</span> <span class="n">warning</span><span class="o">:</span> <span class="n">declaration</span> <span class="n">uses</span> <span class="bp">'</span><span class="gr">sorry</span><span class="bp">'</span>
</code></pre></div>
<p>It has the type it expects. What's the problem?</p>



<a name="286029285"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Lean%20tossing%20an%20error%20over%20having%20exactly%20what%20it%20wants/near/286029285" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Horațiu Cheval <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Lean.20tossing.20an.20error.20over.20having.20exactly.20what.20it.20wants.html#286029285">(Jun 14 2022 at 07:01)</a>:</h4>
<p>It works if you pass the motive explicitly</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="k">have</span> <span class="n">h'c'lab</span> <span class="o">:=</span> <span class="bp">@</span><span class="n">Eq.substr</span> <span class="n">_</span> <span class="o">(</span><span class="k">fun</span> <span class="n">l</span> <span class="bp">=&gt;</span> <span class="n">inc</span> <span class="n">a</span> <span class="n">l</span> <span class="bp">∧</span> <span class="n">inc</span> <span class="n">c</span> <span class="n">l</span><span class="o">)</span> <span class="n">_</span> <span class="n">_</span> <span class="n">h'lab'lac</span> <span class="n">h'lac'ppty</span>
</code></pre></div>



<a name="286059375"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Lean%20tossing%20an%20error%20over%20having%20exactly%20what%20it%20wants/near/286059375" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Marc Huisinga <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Lean.20tossing.20an.20error.20over.20having.20exactly.20what.20it.20wants.html#286059375">(Jun 14 2022 at 11:55)</a>:</h4>
<p>Note that <code>rw</code> makes all the motive woes disappear, e.g. <code>rw [←h'lab'lac] at h'lac'ppty</code> works as well.</p>



<a name="286088339"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Lean%20tossing%20an%20error%20over%20having%20exactly%20what%20it%20wants/near/286088339" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Leonardo de Moura <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Lean.20tossing.20an.20error.20over.20having.20exactly.20what.20it.20wants.html#286088339">(Jun 14 2022 at 15:18)</a>:</h4>
<p>The following section should be useful:<br>
<a href="https://leanprover.github.io/theorem_proving_in_lean4/quantifiers_and_equality.html#equality">https://leanprover.github.io/theorem_proving_in_lean4/quantifiers_and_equality.html#equality</a></p>
<blockquote>
<p>Notice that the second implicit parameter to Eq.subst, which provides the context in which the substitution is to occur, has type α → Prop. Inferring this predicate therefore requires an instance of higher-order unification. In full generality, the problem of determining whether a higher-order unifier exists is undecidable, and Lean can at best provide imperfect and approximate solutions to the problem. As a result, Eq.subst doesn't always do what you want it to. The macro h ▸ e uses more effective heuristics for computing this implicit parameter, and often succeeds in situations where applying Eq.subst fails.</p>
</blockquote>



<a name="286088704"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Lean%20tossing%20an%20error%20over%20having%20exactly%20what%20it%20wants/near/286088704" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Leonardo de Moura <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Lean.20tossing.20an.20error.20over.20having.20exactly.20what.20it.20wants.html#286088704">(Jun 14 2022 at 15:21)</a>:</h4>
<p>The macro <code>h ▸ e</code> is quite handy when we are in term-mode (and do not want to switch to tactic-mode and use <code>rw</code>).</p>



<a name="286097626"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Lean%20tossing%20an%20error%20over%20having%20exactly%20what%20it%20wants/near/286097626" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Aron <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Lean.20tossing.20an.20error.20over.20having.20exactly.20what.20it.20wants.html#286097626">(Jun 14 2022 at 16:20)</a>:</h4>
<p>I usually use rw, but I can't figure out how to assign the hypothesis a new name when I'm done with it.</p>



<a name="286104213"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Lean%20tossing%20an%20error%20over%20having%20exactly%20what%20it%20wants/near/286104213" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Horațiu Cheval <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Lean.20tossing.20an.20error.20over.20having.20exactly.20what.20it.20wants.html#286104213">(Jun 14 2022 at 17:09)</a>:</h4>
<p>You can always do <code>have new_hypothesis := old_hypothesis</code> if you want a new name, and maybe discard the old hypothesis afterwards (I forgot if there is a tactic that does both)</p>



<a name="286104679"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Lean%20tossing%20an%20error%20over%20having%20exactly%20what%20it%20wants/near/286104679" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Horațiu Cheval <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Lean.20tossing.20an.20error.20over.20having.20exactly.20what.20it.20wants.html#286104679">(Jun 14 2022 at 17:12)</a>:</h4>
<p>Or variations thereof like <code>have new_hypothesis : new_statement := by rw [h] at old_hypothesis; assumption</code></p>



<a name="286107548"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Lean%20tossing%20an%20error%20over%20having%20exactly%20what%20it%20wants/near/286107548" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex Keizer <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Lean.20tossing.20an.20error.20over.20having.20exactly.20what.20it.20wants.html#286107548">(Jun 14 2022 at 17:34)</a>:</h4>
<p><span class="user-mention silent" data-user-id="329243">Horațiu Cheval</span> <a href="#narrow/stream/270676-lean4/topic/Lean.20tossing.20an.20error.20over.20having.20exactly.20what.20it.20wants/near/286104213">said</a>:</p>
<blockquote>
<p>You can always do <code>have new_hypothesis := old_hypothesis</code> if you want a new name, and maybe discard the old hypothesis afterwards (I forgot if there is a tactic that does both)</p>
</blockquote>
<p>There's <code>rename</code> which works somewhat similarly, except you have to specify the type of the old hypothesis, rather than it's name. I think it's mostly intended to work with inaccessible/unnamed hypotheses, but also works here.</p>



<a name="286107884"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Lean%20tossing%20an%20error%20over%20having%20exactly%20what%20it%20wants/near/286107884" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Horațiu Cheval <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Lean.20tossing.20an.20error.20over.20having.20exactly.20what.20it.20wants.html#286107884">(Jun 14 2022 at 17:37)</a>:</h4>
<p>Good to know!</p>



<a name="286108046"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Lean%20tossing%20an%20error%20over%20having%20exactly%20what%20it%20wants/near/286108046" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Aron <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Lean.20tossing.20an.20error.20over.20having.20exactly.20what.20it.20wants.html#286108046">(Jun 14 2022 at 17:38)</a>:</h4>
<p>I've been trying to get <code>rename</code> to work, do you have a use case?</p>



<a name="286110580"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Lean%20tossing%20an%20error%20over%20having%20exactly%20what%20it%20wants/near/286110580" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Aron <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Lean.20tossing.20an.20error.20over.20having.20exactly.20what.20it.20wants.html#286110580">(Jun 14 2022 at 18:01)</a>:</h4>
<p>And how do you discard hypotheses?</p>



<a name="286110900"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Lean%20tossing%20an%20error%20over%20having%20exactly%20what%20it%20wants/near/286110900" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Horațiu Cheval <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Lean.20tossing.20an.20error.20over.20having.20exactly.20what.20it.20wants.html#286110900">(Jun 14 2022 at 18:03)</a>:</h4>
<p>In Lean 3 it used to be the <code>clear</code> tactic, applied to the hypothesis to discard. I'm not at my computer right now to check if it's the same in Lean 4.</p>



<a name="286112593"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Lean%20tossing%20an%20error%20over%20having%20exactly%20what%20it%20wants/near/286112593" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex Keizer <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Lean.20tossing.20an.20error.20over.20having.20exactly.20what.20it.20wants.html#286112593">(Jun 14 2022 at 18:16)</a>:</h4>
<p><code>clear</code> also works as described in lean4!</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>