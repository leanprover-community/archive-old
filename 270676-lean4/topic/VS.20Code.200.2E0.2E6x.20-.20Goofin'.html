---
layout: archive
title: Zulip Chat Archive
permalink: /stream/270676-lean4/topic/VS.20Code.200.2E0.2E6x.20-.20Goofin'.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/index.html">lean4</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/VS.20Code.200.2E0.2E6x.20-.20Goofin'.html">VS Code 0.0.6x - Goofin'</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="270401414"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/VS%20Code%200.0.6x%20-%20Goofin%27/near/270401414" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/VS.20Code.200.2E0.2E6x.20-.20Goofin'.html#270401414">(Feb 02 2022 at 15:25)</a>:</h4>
<p>Seems like it was solved for me, thanks!</p>



<a name="270401839"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/VS%20Code%200.0.6x%20-%20Goofin%27/near/270401839" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/VS.20Code.200.2E0.2E6x.20-.20Goofin'.html#270401839">(Feb 02 2022 at 15:27)</a>:</h4>
<p>Hm, now it's crashing a lot and the connection with the server is closing. I'll try to reproduce it consistently</p>



<a name="270403488"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/VS%20Code%200.0.6x%20-%20Goofin%27/near/270403488" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/VS.20Code.200.2E0.2E6x.20-.20Goofin'.html#270403488">(Feb 02 2022 at 15:37)</a>:</h4>
<p>I'm not being able to make it crash again, but it's acting a bit weird when opening new files. It looks unresponsive for a few seconds and then starts loading up</p>



<a name="270407259"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/VS%20Code%200.0.6x%20-%20Goofin%27/near/270407259" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> František Silváši <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/VS.20Code.200.2E0.2E6x.20-.20Goofin'.html#270407259">(Feb 02 2022 at 15:57)</a>:</h4>
<p>I've edited the topic name :).</p>



<a name="270408321"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/VS%20Code%200.0.6x%20-%20Goofin%27/near/270408321" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Notification Bot <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/VS.20Code.200.2E0.2E6x.20-.20Goofin'.html#270408321">(Feb 02 2022 at 16:02)</a>:</h4>
<p><span class="user-mention silent" data-user-id="364929">František Silváši</span> has marked this topic as unresolved.</p>



<a name="270414746"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/VS%20Code%200.0.6x%20-%20Goofin%27/near/270414746" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/VS.20Code.200.2E0.2E6x.20-.20Goofin'.html#270414746">(Feb 02 2022 at 16:37)</a>:</h4>
<p>0.0.63 is out. Can you check again please?</p>



<a name="270416548"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/VS%20Code%200.0.6x%20-%20Goofin%27/near/270416548" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/VS.20Code.200.2E0.2E6x.20-.20Goofin'.html#270416548">(Feb 02 2022 at 16:47)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110043">Gabriel Ebner</span> <a href="#narrow/stream/270676-lean4/topic/VS.20Code.200.2E0.2E6x.20-.20Goofin'/near/270414746">said</a>:</p>
<blockquote>
<p>0.0.63 is out. Can you check again please?</p>
</blockquote>
<p>Looks smooth for now! Thanks again!<br>
Will report back if I find anything strange</p>
<p>BTW: did you address anything that could be related to the escape hotkey reset? (I use <code>;</code> instead of <code>\</code>)</p>



<a name="270418492"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/VS%20Code%200.0.6x%20-%20Goofin%27/near/270418492" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/VS.20Code.200.2E0.2E6x.20-.20Goofin'.html#270418492">(Feb 02 2022 at 16:57)</a>:</h4>
<blockquote>
<p>BTW: did you address anything that could be related to the escape hotkey reset? (I use ; instead of \)</p>
</blockquote>
<p>I don't think so.  But I wouldn't know how that could happen in the first place.</p>
<p>If you tell me how to reproduce, I'll fix it.</p>



<a name="270419428"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/VS%20Code%200.0.6x%20-%20Goofin%27/near/270419428" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/VS.20Code.200.2E0.2E6x.20-.20Goofin'.html#270419428">(Feb 02 2022 at 17:02)</a>:</h4>
<p>Yeah, I will need to tweak it some more before I can reproduce it consistently</p>



<a name="270435266"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/VS%20Code%200.0.6x%20-%20Goofin%27/near/270435266" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/VS.20Code.200.2E0.2E6x.20-.20Goofin'.html#270435266">(Feb 02 2022 at 18:32)</a>:</h4>
<blockquote>
<p>That is, functions with many references perhaps?</p>
</blockquote>
<p>In case anybody was wondering what actually happened:</p>
<p>When vscode opens a hover with a source code snippet, it opens the corresponding file as a text document.  From the extension side this kind of document looks exactly like a file the user opened intentionally.  But if we told the Lean server that a file was opened, it would start a Lean worker process for that file.  It would start a Lean process every time you hover!  Clearly this must be avoided.</p>
<p>So we've put in a hack that prevents the vscode LSP library from sending the didOpen notification.  Instead, we subscribe to the onDidChangeVisibleTextEditors event and manually send didOpen notification only for these visible text editors.</p>
<p>There's a second complication: to support installing both the Lean 3 and Lean 4 extension at the same time, the Lean 4 extensions needs to change the language id of a file to <code>lean4</code> after it's opened.  This also used to be triggered by the visible editors event.  (Changing the language id closes and reopens the text document.  IIRC, the hover doesn't like that and opens the file again.)</p>
<p>The recent multi-root workspace PR <a href="https://github.com/leanprover/vscode-lean4/pull/104">https://github.com/leanprover/vscode-lean4/pull/104</a> inadvertently duplicated the setTextDocumentLanguage call and also triggered it when a document was opened.  From what I can tell, changing the language id of the hovered file makes the hover open the file again, sending it into an endless loop.  Setting the language id twice resulting in one of the calls failing, printing endless error messages on the console (thankfully, this made diagnosing the issue trivial).</p>
<p>cc <span class="user-mention" data-user-id="434989">@Chris Lovett</span></p>



<a name="270438482"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/VS%20Code%200.0.6x%20-%20Goofin%27/near/270438482" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> František Silváši <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/VS.20Code.200.2E0.2E6x.20-.20Goofin'.html#270438482">(Feb 02 2022 at 18:55)</a>:</h4>
<p>IOW 'just move on to Lean 4 already'! <span aria-label="stuck out tongue closed eyes" class="emoji emoji-1f61d" role="img" title="stuck out tongue closed eyes">:stuck_out_tongue_closed_eyes:</span></p>



<a name="270480844"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/VS%20Code%200.0.6x%20-%20Goofin%27/near/270480844" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/VS.20Code.200.2E0.2E6x.20-.20Goofin'.html#270480844">(Feb 03 2022 at 00:21)</a>:</h4>
<p>Do you want to help porting the 700K lines of mathlib3? Once they're all done I'm moving immediately!</p>



<a name="270832042"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/VS%20Code%200.0.6x%20-%20Goofin%27/near/270832042" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/VS.20Code.200.2E0.2E6x.20-.20Goofin'.html#270832042">(Feb 05 2022 at 15:20)</a>:</h4>
<p>Just found another issue that's easy to replicate: when doing <code>#check Nat</code> and ctrl+clicking on it, it opens <code>Prelude.lean</code> but I can't ctrl+click anything there</p>



<a name="270832068"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/VS%20Code%200.0.6x%20-%20Goofin%27/near/270832068" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Henrik Böving <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/VS.20Code.200.2E0.2E6x.20-.20Goofin'.html#270832068">(Feb 05 2022 at 15:21)</a>:</h4>
<p>That is because once you are in the compiler you would need a seperate configuration for that to work out properly (the development guide goes into detail about how to set that up) its not the fault of the plugin</p>



<a name="270837647"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/VS%20Code%200.0.6x%20-%20Goofin%27/near/270837647" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/VS.20Code.200.2E0.2E6x.20-.20Goofin'.html#270837647">(Feb 05 2022 at 17:04)</a>:</h4>
<p>No, there is no inherent problem with browsing the Lean part of the stdlib taken from a release without further setup, and in fact it just works in Emacs. But that is because lsp-mode will automatically open a workspace (or ask you about it) when you enter a separate project, while in VS Code opening a workspace is always an explicit action afaik.</p>



<a name="270837852"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/VS%20Code%200.0.6x%20-%20Goofin%27/near/270837852" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/VS.20Code.200.2E0.2E6x.20-.20Goofin'.html#270837852">(Feb 05 2022 at 17:09)</a>:</h4>
<p>I have (vague) memories of being able to do it a few weeks ago</p>



<a name="270837911"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/VS%20Code%200.0.6x%20-%20Goofin%27/near/270837911" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/VS.20Code.200.2E0.2E6x.20-.20Goofin'.html#270837911">(Feb 05 2022 at 17:10)</a>:</h4>
<p>Yes, I accidentally opened a VS Code copy with an older extension version and it worked for me as well</p>



<a name="270837928"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/VS%20Code%200.0.6x%20-%20Goofin%27/near/270837928" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/VS.20Code.200.2E0.2E6x.20-.20Goofin'.html#270837928">(Feb 05 2022 at 17:11)</a>:</h4>
<p>There have been quite a few fundamental changes in the extension in the recent past, some breakage is to be expected</p>



<a name="270838002"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/VS%20Code%200.0.6x%20-%20Goofin%27/near/270838002" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/VS.20Code.200.2E0.2E6x.20-.20Goofin'.html#270838002">(Feb 05 2022 at 17:13)</a>:</h4>
<p><a href="https://github.com/leanprover/vscode-lean4/issues/115">https://github.com/leanprover/vscode-lean4/issues/115</a></p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>