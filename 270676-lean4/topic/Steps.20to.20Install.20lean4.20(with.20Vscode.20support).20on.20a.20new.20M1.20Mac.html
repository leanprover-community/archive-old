---
layout: archive
title: Zulip Chat Archive
permalink: /stream/270676-lean4/topic/Steps.20to.20Install.20lean4.20(with.20Vscode.20support).20on.20a.20new.20M1.20Mac.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/index.html">lean4</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Steps.20to.20Install.20lean4.20(with.20Vscode.20support).20on.20a.20new.20M1.20Mac.html">Steps to Install lean4 (with Vscode support) on a new M1 Mac</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="270705385"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Steps%20to%20Install%20lean4%20%28with%20Vscode%20support%29%20on%20a%20new%20M1%20Mac/near/270705385" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alcides Fonseca <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Steps.20to.20Install.20lean4.20(with.20Vscode.20support).20on.20a.20new.20M1.20Mac.html#270705385">(Feb 04 2022 at 12:08)</a>:</h4>
<p>I wrote a simple instruction list to get lean4 running on a new macOS installation with VSCode: <a href="http://wiki.alcidesfonseca.com/blog/lean4-on-m1/">http://wiki.alcidesfonseca.com/blog/lean4-on-m1/</a></p>
<p>This gathers information from elsewhere (Mostly <a href="#narrow/stream/113489-new-members/topic/M1.20Macs.3A.20Installing.20the.20Lean.203.20toolchain">https://leanprover.zulipchat.com/#narrow/stream/113489-new-members/topic/M1.20Macs.3A.20Installing.20the.20Lean.203.20toolchain</a>) and also deals with permission issues.</p>
<p>From what I understand the issue is that GitHub actions don't support M1 for the nightly build. Is there any chance where we this M1 build crowdsourced and placing it in a central server (I wouldn't mind doing an almost-daily build and uploading it)? I wouldn't mind doing this, even if it's for my own use.</p>



<a name="270713287"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Steps%20to%20Install%20lean4%20%28with%20Vscode%20support%29%20on%20a%20new%20M1%20Mac/near/270713287" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Steps.20to.20Install.20lean4.20(with.20Vscode.20support).20on.20a.20new.20M1.20Mac.html#270713287">(Feb 04 2022 at 13:21)</a>:</h4>
<p>It is far easier to install elan without homebrew: <a href="#narrow/stream/113489-new-members/topic/M1.20Macs.3A.20Installing.20the.20Lean.203.20toolchain/near/261663503">https://leanprover.zulipchat.com/#narrow/stream/113489-new-members/topic/M1.20Macs.3A.20Installing.20the.20Lean.203.20toolchain/near/261663503</a></p>



<a name="270713566"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Steps%20to%20Install%20lean4%20%28with%20Vscode%20support%29%20on%20a%20new%20M1%20Mac/near/270713566" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Steps.20to.20Install.20lean4.20(with.20Vscode.20support).20on.20a.20new.20M1.20Mac.html#270713566">(Feb 04 2022 at 13:23)</a>:</h4>
<p>But that will install the emulated elan, right?</p>



<a name="270713690"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Steps%20to%20Install%20lean4%20%28with%20Vscode%20support%29%20on%20a%20new%20M1%20Mac/near/270713690" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Steps.20to.20Install.20lean4.20(with.20Vscode.20support).20on.20a.20new.20M1.20Mac.html#270713690">(Feb 04 2022 at 13:24)</a>:</h4>
<p>Yes, but does that matter if Lean is emulated anyway?</p>



<a name="270713742"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Steps%20to%20Install%20lean4%20%28with%20Vscode%20support%29%20on%20a%20new%20M1%20Mac/near/270713742" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Steps.20to.20Install.20lean4.20(with.20Vscode.20support).20on.20a.20new.20M1.20Mac.html#270713742">(Feb 04 2022 at 13:24)</a>:</h4>
<p>Alcides' question is about actual M1 builds.</p>



<a name="270714021"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Steps%20to%20Install%20lean4%20%28with%20Vscode%20support%29%20on%20a%20new%20M1%20Mac/near/270714021" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Steps.20to.20Install.20lean4.20(with.20Vscode.20support).20on.20a.20new.20M1.20Mac.html#270714021">(Feb 04 2022 at 13:27)</a>:</h4>
<p><code>leanprover/lean4:nightly</code> should be an x86 release</p>



<a name="270714283"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Steps%20to%20Install%20lean4%20%28with%20Vscode%20support%29%20on%20a%20new%20M1%20Mac/near/270714283" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Steps.20to.20Install.20lean4.20(with.20Vscode.20support).20on.20a.20new.20M1.20Mac.html#270714283">(Feb 04 2022 at 13:28)</a>:</h4>
<p>I think we're talking about different things.  It's well documented that you can install the emulated lean build with the emulated elan.  But we should be setting up proper M1 builds at some point.</p>



<a name="270714374"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Steps%20to%20Install%20lean4%20%28with%20Vscode%20support%29%20on%20a%20new%20M1%20Mac/near/270714374" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Steps.20to.20Install.20lean4.20(with.20Vscode.20support).20on.20a.20new.20M1.20Mac.html#270714374">(Feb 04 2022 at 13:29)</a>:</h4>
<p>Ok, sure. I was only talking about the simplest way to install Lean right now.</p>



<a name="270714578"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Steps%20to%20Install%20lean4%20%28with%20Vscode%20support%29%20on%20a%20new%20M1%20Mac/near/270714578" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Steps.20to.20Install.20lean4.20(with.20Vscode.20support).20on.20a.20new.20M1.20Mac.html#270714578">(Feb 04 2022 at 13:31)</a>:</h4>
<p>I'd like to come back to cross compilation before the first release, I just haven't found the time yet</p>



<a name="270715053"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Steps%20to%20Install%20lean4%20%28with%20Vscode%20support%29%20on%20a%20new%20M1%20Mac/near/270715053" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Steps.20to.20Install.20lean4.20(with.20Vscode.20support).20on.20a.20new.20M1.20Mac.html#270715053">(Feb 04 2022 at 13:35)</a>:</h4>
<p>For linux/aarch64 it's straightforward to buy VMs and set up a custom runner if we don't want to bother with cross-compilation.  Unfortunately macos/aarch64 doesn't have any reasonable cloud hosting and even if we had an M1 build machine, the github actions runner doesn't work out of the box (apparently both M1 and the latest macos release are unsupported).  Last time I looked, cross-compilation from x86_64 to aarch64 was also uncharted territory.</p>



<a name="270715315"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Steps%20to%20Install%20lean4%20%28with%20Vscode%20support%29%20on%20a%20new%20M1%20Mac/near/270715315" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Steps.20to.20Install.20lean4.20(with.20Vscode.20support).20on.20a.20new.20M1.20Mac.html#270715315">(Feb 04 2022 at 13:37)</a>:</h4>
<p>It <em>seems</em> to work fine for Zig, but it wouldn't be the first time that their approach didn't quite work out for us</p>



<a name="270715622"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Steps%20to%20Install%20lean4%20%28with%20Vscode%20support%29%20on%20a%20new%20M1%20Mac/near/270715622" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Steps.20to.20Install.20lean4.20(with.20Vscode.20support).20on.20a.20new.20M1.20Mac.html#270715622">(Feb 04 2022 at 13:40)</a>:</h4>
<p>But I dearly hope that pure compilation &amp; linking is completely independent of the host platform for a native cross compiler like LLVM. That leaves external dependencies, which we should already have covered.</p>



<a name="270715837"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Steps%20to%20Install%20lean4%20%28with%20Vscode%20support%29%20on%20a%20new%20M1%20Mac/near/270715837" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Steps.20to.20Install.20lean4.20(with.20Vscode.20support).20on.20a.20new.20M1.20Mac.html#270715837">(Feb 04 2022 at 13:42)</a>:</h4>
<p>I was mostly wondering about system libraries.  I thought the x86_64 version of macos didn't ship with the arm builds.</p>



<a name="270716055"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Steps%20to%20Install%20lean4%20%28with%20Vscode%20support%29%20on%20a%20new%20M1%20Mac/near/270716055" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Steps.20to.20Install.20lean4.20(with.20Vscode.20support).20on.20a.20new.20M1.20Mac.html#270716055">(Feb 04 2022 at 13:44)</a>:</h4>
<p><code>libSystem.tbd</code> is all we need. I don't know if it is platform-dependent, but if so, we can copy it from an M1 machine once.</p>



<a name="270716324"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Steps%20to%20Install%20lean4%20%28with%20Vscode%20support%29%20on%20a%20new%20M1%20Mac/near/270716324" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Steps.20to.20Install.20lean4.20(with.20Vscode.20support).20on.20a.20new.20M1.20Mac.html#270716324">(Feb 04 2022 at 13:46)</a>:</h4>
<p>In the meantime, I added a few words to the elan readme: <a href="https://github.com/leanprover/elan/pull/61">https://github.com/leanprover/elan/pull/61</a></p>



<a name="270781756"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Steps%20to%20Install%20lean4%20%28with%20Vscode%20support%29%20on%20a%20new%20M1%20Mac/near/270781756" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Stevens <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Steps.20to.20Install.20lean4.20(with.20Vscode.20support).20on.20a.20new.20M1.20Mac.html#270781756">(Feb 04 2022 at 22:28)</a>:</h4>
<p>By the way, I'm still gradually chipping away at getting a working lean4 setup on M1 with Nix, and it's looking very promising - as far as I can tell, it all Just Works except that I still have some hoops to jump through to teach the Lean VSCode plugin where to look, but I have successfully built mathlib4 locally using aarch64-darwin</p>



<a name="270818799"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Steps%20to%20Install%20lean4%20%28with%20Vscode%20support%29%20on%20a%20new%20M1%20Mac/near/270818799" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Stevens <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Steps.20to.20Install.20lean4.20(with.20Vscode.20support).20on.20a.20new.20M1.20Mac.html#270818799">(Feb 05 2022 at 10:24)</a>:</h4>
<p>(yeah, native Nix on Darwin M1 does Just Work modulo sometimes having to reboot the machine because some part of Nix gets stuck in some way I haven't debugged - <a href="https://github.com/leanprover-community/mathlib4/compare/master...Smaug123:flake?expand=1">https://github.com/leanprover-community/mathlib4/compare/master...Smaug123:flake?expand=1</a> and <code>nix run .#vscode-dev</code>, given an ambient nix-darwin setup with the appropriate link to Lean <a href="https://github.com/Smaug123/nix-dotfiles/blob/main/home.nix#L74">https://github.com/Smaug123/nix-dotfiles/blob/main/home.nix#L74</a> and a <code>nix build</code> of <a href="https://github.com/leanprover/lean4">https://github.com/leanprover/lean4</a> having been <code>elan toolchain link</code>ed into the right place)</p>



<a name="270838847"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Steps%20to%20Install%20lean4%20%28with%20Vscode%20support%29%20on%20a%20new%20M1%20Mac/near/270838847" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Steps.20to.20Install.20lean4.20(with.20Vscode.20support).20on.20a.20new.20M1.20Mac.html#270838847">(Feb 05 2022 at 17:28)</a>:</h4>
<p>Fair note: I haven't updated the vscode-lean4 version used by <code>vscode-dev</code> in ages because I wasn't aware of any users of it. Feel free to update.</p>



<a name="270843610"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Steps%20to%20Install%20lean4%20%28with%20Vscode%20support%29%20on%20a%20new%20M1%20Mac/near/270843610" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Stevens <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Steps.20to.20Install.20lean4.20(with.20Vscode.20support).20on.20a.20new.20M1.20Mac.html#270843610">(Feb 05 2022 at 19:06)</a>:</h4>
<p>Cheers - I don't really have the free time to do anything with this stuff at the moment, but I bumped the extension for <code>vscode-dev</code> in <a href="https://github.com/leanprover/lean4/pull/1003/files">https://github.com/leanprover/lean4/pull/1003/files</a> just in case</p>



<a name="270843809"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Steps%20to%20Install%20lean4%20%28with%20Vscode%20support%29%20on%20a%20new%20M1%20Mac/near/270843809" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Steps.20to.20Install.20lean4.20(with.20Vscode.20support).20on.20a.20new.20M1.20Mac.html#270843809">(Feb 05 2022 at 19:10)</a>:</h4>
<p>Now that I think about it, the main reason I didn't expect users regardless of the popularity of the Nix setup in general is that in contrast to emacs-dev, it does not allow you to install any additional extensions.</p>



<a name="270843825"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Steps%20to%20Install%20lean4%20%28with%20Vscode%20support%29%20on%20a%20new%20M1%20Mac/near/270843825" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Stevens <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Steps.20to.20Install.20lean4.20(with.20Vscode.20support).20on.20a.20new.20M1.20Mac.html#270843825">(Feb 05 2022 at 19:11)</a>:</h4>
<p>Yeah, I was literally just thinking how to shoehorn vsvim in there</p>



<a name="270843917"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Steps%20to%20Install%20lean4%20%28with%20Vscode%20support%29%20on%20a%20new%20M1%20Mac/near/270843917" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Steps.20to.20Install.20lean4.20(with.20Vscode.20support).20on.20a.20new.20M1.20Mac.html#270843917">(Feb 05 2022 at 19:13)</a>:</h4>
<p>The main issue is that VS Code has no concept of multi-layered configuration - <a href="https://github.com/microsoft/vscode/issues/27972">https://github.com/microsoft/vscode/issues/27972</a></p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>