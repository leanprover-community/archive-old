---
layout: archive
title: Zulip Chat Archive
permalink: /stream/270676-lean4/topic/making.20lean.20and.20lean4.20coexist.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/index.html">lean4</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/making.20lean.20and.20lean4.20coexist.html">making lean and lean4 coexist</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="270620205"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/making%20lean%20and%20lean4%20coexist/near/270620205" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alice Laroche <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/making.20lean.20and.20lean4.20coexist.html#270620205">(Feb 03 2022 at 21:26)</a>:</h4>
<p>So... it's embarrising.<br>
I tried to tweak some configuration in VS Code and now the <code>lean</code> extension try to run even if i'm in a <code>lean4</code> folder, and i can't run <code>lean4.restartServer</code></p>



<a name="270620442"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/making%20lean%20and%20lean4%20coexist/near/270620442" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/making.20lean.20and.20lean4.20coexist.html#270620442">(Feb 03 2022 at 21:28)</a>:</h4>
<p>You can disable extensions for a given workspace by right clicking them in the extensions bar</p>



<a name="270620941"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/making%20lean%20and%20lean4%20coexist/near/270620941" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alice Laroche <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/making.20lean.20and.20lean4.20coexist.html#270620941">(Feb 03 2022 at 21:31)</a>:</h4>
<p>Well it work... kinda. <br>
Before i didn't had to disactivate extensions. And for some reason,i don't have infoview in Lean sources anymore</p>



<a name="270621933"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/making%20lean%20and%20lean4%20coexist/near/270621933" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/making.20lean.20and.20lean4.20coexist.html#270621933">(Feb 03 2022 at 21:39)</a>:</h4>
<p>I managed to make it work by allowing the Lean 4 extension to pop in every Lean project, except for mathlib (the only Lean 3 project I tweak). And the Lean 3 extension is restricted to mathlib</p>



<a name="270622876"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/making%20lean%20and%20lean4%20coexist/near/270622876" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alice Laroche <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/making.20lean.20and.20lean4.20coexist.html#270622876">(Feb 03 2022 at 21:46)</a>:</h4>
<p>Hmm, Lean 4 is enabled globaly tho<br>
Like, why nothing show up in the infoview<br>
<a href="/user_uploads/3121/3Z0CYSBwrFOVBKDbB0OJTCbY/image.png">image.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/3121/3Z0CYSBwrFOVBKDbB0OJTCbY/image.png" title="image.png"><img src="/user_uploads/3121/3Z0CYSBwrFOVBKDbB0OJTCbY/image.png"></a></div>



<a name="270623133"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/making%20lean%20and%20lean4%20coexist/near/270623133" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Marc Huisinga <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/making.20lean.20and.20lean4.20coexist.html#270623133">(Feb 03 2022 at 21:48)</a>:</h4>
<p>Are you running Windows by any chance?</p>



<a name="270623332"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/making%20lean%20and%20lean4%20coexist/near/270623332" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alice Laroche <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/making.20lean.20and.20lean4.20coexist.html#270623332">(Feb 03 2022 at 21:50)</a>:</h4>
<p>Nop, brrr, this is good ol' arch</p>



<a name="270623447"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/making%20lean%20and%20lean4%20coexist/near/270623447" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/making.20lean.20and.20lean4.20coexist.html#270623447">(Feb 03 2022 at 21:51)</a>:</h4>
<p>Which version of the Lean 4 extension are you using?</p>



<a name="270623534"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/making%20lean%20and%20lean4%20coexist/near/270623534" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alice Laroche <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/making.20lean.20and.20lean4.20coexist.html#270623534">(Feb 03 2022 at 21:51)</a>:</h4>
<p>last one, 0.63</p>



<a name="270624784"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/making%20lean%20and%20lean4%20coexist/near/270624784" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/making.20lean.20and.20lean4.20coexist.html#270624784">(Feb 03 2022 at 22:01)</a>:</h4>
<p>My first thought: is that the Lean 3 extension infoview or the Lean 4 extension infoview?</p>



<a name="270625725"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/making%20lean%20and%20lean4%20coexist/near/270625725" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/making.20lean.20and.20lean4.20coexist.html#270625725">(Feb 03 2022 at 22:08)</a>:</h4>
<p>maybe they should have a different title bar so you can tell the difference</p>



<a name="270625869"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/making%20lean%20and%20lean4%20coexist/near/270625869" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/making.20lean.20and.20lean4.20coexist.html#270625869">(Feb 03 2022 at 22:09)</a>:</h4>
<p>I think they are currently indistinguishable</p>



<a name="270626016"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/making%20lean%20and%20lean4%20coexist/near/270626016" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alice Laroche <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/making.20lean.20and.20lean4.20coexist.html#270626016">(Feb 03 2022 at 22:10)</a>:</h4>
<p>You can distinguish them by adding some different CSS to both<br>
But it's not a great solution</p>



<a name="270626501"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/making%20lean%20and%20lean4%20coexist/near/270626501" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Marc Huisinga <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/making.20lean.20and.20lean4.20coexist.html#270626501">(Feb 03 2022 at 22:14)</a>:</h4>
<p>FWIW on the latest nightly and Lean 4 VSCode extension version, my editor doesn't seem to be responsive either (No diagnostics, no infoview contents, etc.). I tried both Windows and WSL and older nightlies where I think it used to work as well.</p>



<a name="270626857"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/making%20lean%20and%20lean4%20coexist/near/270626857" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alice Laroche <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/making.20lean.20and.20lean4.20coexist.html#270626857">(Feb 03 2022 at 22:17)</a>:</h4>
<p>So what actually happend was , while I was tweaking configuration, the extension updated and change behavior... i guess ?</p>



<a name="270627131"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/making%20lean%20and%20lean4%20coexist/near/270627131" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Marc Huisinga <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/making.20lean.20and.20lean4.20coexist.html#270627131">(Feb 03 2022 at 22:19)</a>:</h4>
<p><span class="user-mention silent" data-user-id="221921">Marc Huisinga</span> <a href="#narrow/stream/270676-lean4/topic/making.20lean.20and.20lean4.20coexist/near/270626501">said</a>:</p>
<blockquote>
<p>FWIW on the latest nightly and Lean 4 VSCode extension version, my editor doesn't seem to be responsive either (No diagnostics, no infoview contents, etc.). I tried both Windows and WSL and older nightlies where I think it used to work as well.</p>
</blockquote>
<p>Ah, this may be related to me opening single files, not entire Lean projects?</p>



<a name="270705010"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/making%20lean%20and%20lean4%20coexist/near/270705010" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/making.20lean.20and.20lean4.20coexist.html#270705010">(Feb 04 2022 at 12:04)</a>:</h4>
<blockquote>
<p>Ah, this may be related to me opening single files, not entire Lean projects?</p>
</blockquote>
<p>I didn't even know that vscode had such a mode.  It's certainly completely untested.</p>



<a name="270705232"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/making%20lean%20and%20lean4%20coexist/near/270705232" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/making.20lean.20and.20lean4.20coexist.html#270705232">(Feb 04 2022 at 12:06)</a>:</h4>
<blockquote>
<p>is that the Lean 3 extension infoview or the Lean 4 extension infoview? [...] maybe they should have a different title bar so you can tell the difference</p>
</blockquote>
<p>Yeah, it would be good to show some status info.  Lean version in the status bar.  And "server not running" or smth in the infoview instead of "no info found" and "no messages".</p>



<a name="270708580"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/making%20lean%20and%20lean4%20coexist/near/270708580" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Marc Huisinga <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/making.20lean.20and.20lean4.20coexist.html#270708580">(Feb 04 2022 at 12:41)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110043">Gabriel Ebner</span> <a href="#narrow/stream/270676-lean4/topic/making.20lean.20and.20lean4.20coexist/near/270705010">said</a>:</p>
<blockquote>
<blockquote>
<p>Ah, this may be related to me opening single files, not entire Lean projects?</p>
</blockquote>
<p>I didn't even know that vscode had such a mode.  It's certainly completely untested.</p>
</blockquote>
<p>Opening single Lean 4 files worked fine until a few updates ago (as long as you have some global Lean installation). The server has (had?) support for it as well, since I thought that creating a single file and running a bit of isolated Lean code is neat for testing things, similar to how you'd just launch up a REPL.</p>



<a name="270708767"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/making%20lean%20and%20lean4%20coexist/near/270708767" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/making.20lean.20and.20lean4.20coexist.html#270708767">(Feb 04 2022 at 12:43)</a>:</h4>
<p>Did some limited testing right now.  Create a file <code>x/y.lean</code> without lakefile.  Then <code>code x</code> and opening <code>y.lean</code> works.  But <code>code x/y.lean</code> doesn't.  That's what I meant by special single-file mode.</p>



<a name="270708859"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/making%20lean%20and%20lean4%20coexist/near/270708859" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/making.20lean.20and.20lean4.20coexist.html#270708859">(Feb 04 2022 at 12:44)</a>:</h4>
<p>Also the UI is very different.  E.g. you don't get the usual modal trust dialog, but a notification that the extensions are disabled.</p>



<a name="270710877"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/making%20lean%20and%20lean4%20coexist/near/270710877" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Marc Huisinga <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/making.20lean.20and.20lean4.20coexist.html#270710877">(Feb 04 2022 at 13:01)</a>:</h4>
<p>That's what I meant as well.</p>



<a name="270738495"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/making%20lean%20and%20lean4%20coexist/near/270738495" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Marc Huisinga <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/making.20lean.20and.20lean4.20coexist.html#270738495">(Feb 04 2022 at 16:28)</a>:</h4>
<p>Hm, my extensions aren't disabled when I open a single new .lean file, but I don't seem to get the trust dialog either, which is strange</p>



<a name="271076777"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/making%20lean%20and%20lean4%20coexist/near/271076777" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Chris Lovett <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/making.20lean.20and.20lean4.20coexist.html#271076777">(Feb 08 2022 at 03:27)</a>:</h4>
<p>I have a fix in progress here with some questions about how you want this to behave: <a href="https://github.com/leanprover/vscode-lean4/pull/117">https://github.com/leanprover/vscode-lean4/pull/117</a></p>



<a name="271078314"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/making%20lean%20and%20lean4%20coexist/near/271078314" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Julian Berman <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/making.20lean.20and.20lean4.20coexist.html#271078314">(Feb 08 2022 at 03:59)</a>:</h4>
<p><code>lean.nvim</code> does the stdlib path walking you mention  (actually just it looks for <code>/lib/lean</code> in the path) and I think it works pretty well.</p>



<a name="271083802"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/making%20lean%20and%20lean4%20coexist/near/271083802" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Chris Lovett <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/making.20lean.20and.20lean4.20coexist.html#271083802">(Feb 08 2022 at 05:43)</a>:</h4>
<p>Right my question is if you open <code>leanprover--lean4---nightly\lib\lean\src\Init\System\IO.lean</code> do you expect it to find and use <code>leanprover--lean4---nightly\lib\lean\src\leanpkg.toml</code> or an inherited <code>lean-toolchain</code> in the case of something like mathlib.  Specifically it would start a <code>lean --server</code> in that folder so that  any other files opened in that directory tree would also use the same <code>lean --server</code>.  I think this is probably the right behavior, but I just wanted to check if this matches your expectation.</p>



<a name="271093741"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/making%20lean%20and%20lean4%20coexist/near/271093741" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/making.20lean.20and.20lean4.20coexist.html#271093741">(Feb 08 2022 at 08:19)</a>:</h4>
<p><span class="user-mention silent" data-user-id="434989">Chris Lovett</span> <a href="#narrow/stream/270676-lean4/topic/making.20lean.20and.20lean4.20coexist/near/271083802">said</a>:</p>
<blockquote>
<p><code>leanprover--lean4---nightly\lib\lean\src\leanpkg.toml</code></p>
</blockquote>
<p>We have no such file, do we?</p>



<a name="271093879"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/making%20lean%20and%20lean4%20coexist/near/271093879" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/making.20lean.20and.20lean4.20coexist.html#271093879">(Feb 08 2022 at 08:20)</a>:</h4>
<p><span class="user-mention silent" data-user-id="321696">Julian Berman</span> <a href="#narrow/stream/270676-lean4/topic/making.20lean.20and.20lean4.20coexist/near/271078314">said</a>:</p>
<blockquote>
<p><code>lean.nvim</code> does the stdlib path walking you mention  (actually just it looks for <code>/lib/lean</code> in the path) and I think it works pretty well.</p>
</blockquote>
<p><span class="user-mention" data-user-id="321696">@Julian Berman</span> Btw, note <a href="https://github.com/leanprover/lean4/pull/989">https://github.com/leanprover/lean4/pull/989</a></p>



<a name="271097698"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/making%20lean%20and%20lean4%20coexist/near/271097698" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Chris Lovett <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/making.20lean.20and.20lean4.20coexist.html#271097698">(Feb 08 2022 at 08:59)</a>:</h4>
<blockquote>
<p>We have no such file, do we?</p>
</blockquote>
<p>Woops you are right, I must have mistaken <code>Leanpkg.lean</code> for <code>leanpkg.toml</code>.  But anyway, the same applies to mathlib4, if someone uses "file/open..." and opens <code>mathlib4\Mathlib\Data\List\Basic.lean</code> I assume the vscode extension should find the <code>mathlib4\lean-toolchain</code> file and start the <code>lean --server</code> in that folder, right?</p>



<a name="271107805"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/making%20lean%20and%20lean4%20coexist/near/271107805" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/making.20lean.20and.20lean4.20coexist.html#271107805">(Feb 08 2022 at 10:30)</a>:</h4>
<blockquote>
<p>I assume the vscode extension should find the mathlib4\lean-toolchain file and start the lean --server in that folder, right?</p>
</blockquote>
<p>Right.  For reference, the lean.nvim plugin looks for <code>lean-toolchain</code>, <code>leanpkg.toml</code>, and <code>lakefile.lean</code> files as well as the <code>lib/lean</code> directory (which will soon become <code>src/lean</code>).</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>