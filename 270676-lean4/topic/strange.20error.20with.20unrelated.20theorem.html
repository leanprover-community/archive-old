---
layout: archive
title: Zulip Chat Archive
permalink: /stream/270676-lean4/topic/strange.20error.20with.20unrelated.20theorem.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/index.html">lean4</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/strange.20error.20with.20unrelated.20theorem.html">strange error with unrelated theorem</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="279468169"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/strange%20error%20with%20unrelated%20theorem/near/279468169" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/strange.20error.20with.20unrelated.20theorem.html#279468169">(Apr 19 2022 at 21:02)</a>:</h4>
<p>I'm getting a strange error on <a href="https://github.com/arthurpaulino/FxyLang/blob/23e369fdae15d5220cad8516bd772b14950c8476/FxyLang/Reasoning/Definitions.lean#L76">this theorem</a> when commenting out the theorem above it (<code>State.skipStep</code>). Even simply replacing the proof of <code>State.skipStep</code> by a <code>sorry</code> causes the same error:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">failed</span> <span class="n">to</span> <span class="n">generate</span> <span class="n">equality</span> <span class="n">theorems</span> <span class="n">for</span> <span class="bp">`</span><span class="k">match</span><span class="bp">`</span> <span class="n">expression</span>
<span class="n">case</span> <span class="n">lam.mk</span>
<span class="n">motive</span> <span class="o">:</span> <span class="n">Value</span> <span class="bp">→</span> <span class="kt">Sort</span> <span class="n">u_1</span>
<span class="n">h_1</span> <span class="o">:</span> <span class="o">(</span><span class="n">ns</span> <span class="o">:</span> <span class="n">NEList</span> <span class="n">String</span><span class="o">)</span> <span class="bp">→</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="n">NEList.noDup</span> <span class="n">ns</span> <span class="bp">=</span> <span class="n">true</span><span class="o">)</span> <span class="bp">→</span> <span class="o">(</span><span class="n">p</span> <span class="o">:</span> <span class="n">Program</span><span class="o">)</span> <span class="bp">→</span> <span class="n">motive</span> <span class="o">(</span><span class="n">Value.lam</span> <span class="o">(</span><span class="n">Lambda.mk</span> <span class="n">ns</span> <span class="n">h</span> <span class="n">p</span><span class="o">))</span>
<span class="n">h_2</span> <span class="o">:</span> <span class="o">(</span><span class="n">v</span> <span class="o">:</span> <span class="n">Value</span><span class="o">)</span> <span class="bp">→</span> <span class="n">motive</span> <span class="n">v</span>
<span class="n">l</span><span class="bp">✝</span> <span class="o">:</span> <span class="n">NEList</span> <span class="n">String</span>
<span class="n">a</span><span class="bp">✝¹</span> <span class="o">:</span> <span class="n">NEList.noDup</span> <span class="n">l</span><span class="bp">✝</span> <span class="bp">=</span> <span class="n">true</span>
<span class="n">a</span><span class="bp">✝</span> <span class="o">:</span> <span class="n">Program</span>
<span class="o">:</span> <span class="bp">∀</span> <span class="o">(</span><span class="n">ns</span> <span class="o">:</span> <span class="n">NEList</span> <span class="n">String</span><span class="o">)</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="n">NEList.noDup</span> <span class="n">ns</span> <span class="bp">=</span> <span class="n">true</span><span class="o">)</span> <span class="o">(</span><span class="n">p</span> <span class="o">:</span> <span class="n">Program</span><span class="o">),</span>
  <span class="n">Value.lam</span> <span class="o">(</span><span class="n">Lambda.mk</span> <span class="n">l</span><span class="bp">✝</span> <span class="n">a</span><span class="bp">✝¹</span> <span class="n">a</span><span class="bp">✝</span><span class="o">)</span> <span class="bp">=</span> <span class="n">Value.lam</span> <span class="o">(</span><span class="n">Lambda.mk</span> <span class="n">ns</span> <span class="n">h</span> <span class="n">p</span><span class="o">)</span> <span class="bp">→</span> <span class="n">False</span>
<span class="bp">⊢</span> <span class="n">h_1</span> <span class="n">l</span><span class="bp">✝</span> <span class="n">a</span><span class="bp">✝¹</span> <span class="n">a</span><span class="bp">✝</span> <span class="bp">=</span> <span class="n">h_2</span> <span class="o">(</span><span class="n">Value.lam</span> <span class="o">(</span><span class="n">Lambda.mk</span> <span class="n">l</span><span class="bp">✝</span> <span class="n">a</span><span class="bp">✝¹</span> <span class="n">a</span><span class="bp">✝</span><span class="o">))</span>
</code></pre></div>



<a name="279468866"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/strange%20error%20with%20unrelated%20theorem/near/279468866" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/strange.20error.20with.20unrelated.20theorem.html#279468866">(Apr 19 2022 at 21:09)</a>:</h4>
<p>Forgot to mention: I'm using <code>leanprover/lean4:nightly-2022-04-19</code></p>



<a name="279545776"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/strange%20error%20with%20unrelated%20theorem/near/279545776" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Leonardo de Moura <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/strange.20error.20with.20unrelated.20theorem.html#279545776">(Apr 20 2022 at 13:51)</a>:</h4>
<p>Could you please create a <a href="https://leanprover-community.github.io/mwe.html">#mwe</a> for this issue?</p>



<a name="279546232"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/strange%20error%20with%20unrelated%20theorem/near/279546232" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/strange.20error.20with.20unrelated.20theorem.html#279546232">(Apr 20 2022 at 13:54)</a>:</h4>
<p>I tried to but I couldn't :(<br>
It seems to rely on the pile of definitions from my repo</p>



<a name="279547047"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/strange%20error%20with%20unrelated%20theorem/near/279547047" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Leonardo de Moura <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/strange.20error.20with.20unrelated.20theorem.html#279547047">(Apr 20 2022 at 14:00)</a>:</h4>
<p>The error seems to happen when Lean tries to create the equation theorems for <code>stepN</code> or <code>step</code>. Could you confirm which one triggers the problem by using the command:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">attribute</span> <span class="o">[</span><span class="n">simp</span><span class="o">]</span> <span class="n">stepN</span>
<span class="kn">attribute</span> <span class="o">[</span><span class="n">simp</span><span class="o">]</span> <span class="n">step</span>
</code></pre></div>
<p><code>stepN</code>  looks very simple. So, I am betting the problem is on <code>step</code>, but I did not find its definition yet.<br>
The next step would be to keep reducing the complexity of <code>step</code> while the bug is still triggered.<br>
We would be very grateful if you could go over this minimization problem. It would save us a lot of time.</p>



<a name="279547693"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/strange%20error%20with%20unrelated%20theorem/near/279547693" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/strange.20error.20with.20unrelated.20theorem.html#279547693">(Apr 20 2022 at 14:06)</a>:</h4>
<p>Both of the following work:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">attribute</span> <span class="o">[</span><span class="n">simp</span><span class="o">]</span> <span class="n">stepN</span>
<span class="kn">attribute</span> <span class="o">[</span><span class="n">simp</span><span class="o">]</span> <span class="n">step</span>
</code></pre></div>
<p>The definition of <a href="https://github.com/arthurpaulino/FxyLang/blob/8cc9cea05bd6f3b75b9b4f9f35062afba37fe368/FxyLang/Implementation/Execution.lean#L121"><code>step</code></a> is indeed involved. I'll try to minimize the problem but since the problem arises in a theorem when commenting out another (apparently unrelated) theorem, I am not very optimistic about it</p>



<a name="279562455"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/strange%20error%20with%20unrelated%20theorem/near/279562455" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/strange.20error.20with.20unrelated.20theorem.html#279562455">(Apr 20 2022 at 15:51)</a>:</h4>
<p><span class="user-mention" data-user-id="112857">@Leonardo de Moura</span> here's a gist with a piece of self-contained Lean code:<br>
<a href="https://gist.github.com/arthurpaulino/410aeaedba79282402127183d8d6f863">https://gist.github.com/arthurpaulino/410aeaedba79282402127183d8d6f863</a></p>



<a name="279562867"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/strange%20error%20with%20unrelated%20theorem/near/279562867" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/strange.20error.20with.20unrelated.20theorem.html#279562867">(Apr 20 2022 at 15:54)</a>:</h4>
<p>The code is shorter because I only took the necessary definitions but I wasn't able to find a smaller instance of the issue</p>



<a name="279564437"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/strange%20error%20with%20unrelated%20theorem/near/279564437" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sébastien Michelland <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/strange.20error.20with.20unrelated.20theorem.html#279564437">(Apr 20 2022 at 16:04)</a>:</h4>
<p>FWIW, I wanted to give it a try so I installed <code>leanprover/lean4:nightly-2022-04-19</code> but the server keeps crashing on my computer.</p>



<a name="279565978"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/strange%20error%20with%20unrelated%20theorem/near/279565978" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Leonardo de Moura <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/strange.20error.20with.20unrelated.20theorem.html#279565978">(Apr 20 2022 at 16:15)</a>:</h4>
<p><span class="user-mention silent" data-user-id="451983">Arthur Paulino</span> <a href="#narrow/stream/270676-lean4/topic/strange.20error.20with.20unrelated.20theorem/near/279562455">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="112857">Leonardo de Moura</span> here's a gist with a piece of self-contained Lean code:<br>
<a href="https://gist.github.com/arthurpaulino/410aeaedba79282402127183d8d6f863">https://gist.github.com/arthurpaulino/410aeaedba79282402127183d8d6f863</a></p>
</blockquote>
<p>Thanks! I managed to reproduce the problem. I am investigating.</p>



<a name="279579260"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/strange%20error%20with%20unrelated%20theorem/near/279579260" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Leonardo de Moura <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/strange.20error.20with.20unrelated.20theorem.html#279579260">(Apr 20 2022 at 17:49)</a>:</h4>
<p><span class="user-mention" data-user-id="451983">@Arthur Paulino</span> Pushed a fix for this <a href="https://github.com/leanprover/lean4/commit/73076b855c94eaa1a380e05411b60ca19df191f6">https://github.com/leanprover/lean4/commit/73076b855c94eaa1a380e05411b60ca19df191f6</a></p>



<a name="279579536"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/strange%20error%20with%20unrelated%20theorem/near/279579536" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/strange.20error.20with.20unrelated.20theorem.html#279579536">(Apr 20 2022 at 17:51)</a>:</h4>
<p>Thanks!!</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>