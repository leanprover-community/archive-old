---
layout: archive
title: Zulip Chat Archive
permalink: /stream/270676-lean4/topic/docs4.23.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/index.html">lean4</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/docs4.23.html">docs4#</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="271750091"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/docs4%23/near/271750091" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Henrik Böving <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/docs4.23.html#271750091">(Feb 13 2022 at 15:03)</a>:</h4>
<p>I just ported the doc-gen search over to doc-gen4 (<a href="https://leanprover-community.github.io/mathlib4_docs/">https://leanprover-community.github.io/mathlib4_docs/</a>), including the <code>/find/decl</code> endpoints so in theory someone with the correct permissions should be able to set up something similar to this docs# stuff the Lean 3 people are using (I propose docs4#)</p>



<a name="272011509"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/docs4%23/near/272011509" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Notification Bot <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/docs4.23.html#272011509">(Feb 15 2022 at 17:47)</a>:</h4>
<p><span class="user-mention silent" data-user-id="395550">Henrik Böving</span> has marked this topic as unresolved.</p>



<a name="272011572"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/docs4%23/near/272011572" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Henrik Böving <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/docs4.23.html#272011572">(Feb 15 2022 at 17:47)</a>:</h4>
<p>I think that should be fine for a first PoC yes, but we should definitely try to swap it out for a pure Lean 4 parser at some point.</p>



<a name="272012211"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/docs4%23/near/272012211" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/docs4.23.html#272012211">(Feb 15 2022 at 17:52)</a>:</h4>
<p>References that might help:</p>
<ul>
<li><a href="https://github.com/Neilshweky/Haskell-Markdown-Parser">https://github.com/Neilshweky/Haskell-Markdown-Parser</a></li>
<li><a href="https://github.com/Riphal/haskell-markdown-parser">https://github.com/Riphal/haskell-markdown-parser</a></li>
<li><a href="https://github.com/hashanp/haskell-markdown">https://github.com/hashanp/haskell-markdown</a></li>
</ul>



<a name="272019022"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/docs4%23/near/272019022" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Xubai Wang <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/docs4.23.html#272019022">(Feb 15 2022 at 18:40)</a>:</h4>
<p><span class="user-mention silent" data-user-id="395550">Henrik Böving</span> <a href="#narrow/stream/270676-lean4/topic/docs4.23/near/272011572">said</a>:</p>
<blockquote>
<p>I think that should be fine for a first PoC yes, but we should definitely try to swap it out for a pure Lean 4 parser at some point.</p>
</blockquote>
<p>I agree with it, but as I have started a new semester, it will take more time than I have expected.</p>
<p><span class="user-mention" data-user-id="451983">@Arthur Paulino</span> Thanks, I will read about that.</p>



<a name="272019479"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/docs4%23/near/272019479" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/docs4.23.html#272019479">(Feb 15 2022 at 18:44)</a>:</h4>
<p><span class="user-mention" data-user-id="414345">@Xubai Wang</span> if/when you start the pure Lean 4 parser, feel free to ping me and I will help</p>



<a name="272019938"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/docs4%23/near/272019938" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Xubai Wang <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/docs4.23.html#272019938">(Feb 15 2022 at 18:48)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110038">Kevin Buzzard</span> <a href="#narrow/stream/270676-lean4/topic/docs4.23/near/271771892">said</a>:</p>
<blockquote>
<p>That definition doesn't have a docstring!</p>
</blockquote>
<p>Both doc string and mod doc rendering has been done <a href="https://github.com/leanprover/doc-gen4/pull/33/files">here</a>, based on <a href="https://github.com/xubaiw/CMark.lean">cmark</a> and <a href="#narrow/stream/270676-lean4/topic/Add.20position.20info.20to.20module.20doc">positioned mod doc</a>. Once lean supports the latter feature, we can immediately merge these commits.</p>



<a name="272019989"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/docs4%23/near/272019989" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Xubai Wang <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/docs4.23.html#272019989">(Feb 15 2022 at 18:48)</a>:</h4>
<p><span class="user-mention" data-user-id="451983">@Arthur Paulino</span> Sure!</p>



<a name="272246413"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/docs4%23/near/272246413" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/docs4.23.html#272246413">(Feb 17 2022 at 11:34)</a>:</h4>
<p>I went ahead and defined a markdown DSL inspired by those Haskell references that I posted.<br>
However, if I am to parse the string, I might do it in a "try hard" way.</p>
<p>What's a smarter way of doing so? I've searched on Lean 4 repo and I couldn't find an API for regular expressions</p>



<a name="272246649"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/docs4%23/near/272246649" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/docs4.23.html#272246649">(Feb 17 2022 at 11:36)</a>:</h4>
<p>I would try using these parser combinators: <a href="https://github.com/leanprover/lean4/blob/6b1297fe85575c91cf613640bdd96cd1241d1a9e/src/Lean/Data/Parsec.lean">https://github.com/leanprover/lean4/blob/6b1297fe85575c91cf613640bdd96cd1241d1a9e/src/Lean/Data/Parsec.lean</a> (example XML parser: <a href="https://github.com/leanprover/lean4/blob/95aec2cf93762530a9c69dfc98c165a8b54238e2/src/Lean/Data/Xml/Parser.lean">https://github.com/leanprover/lean4/blob/95aec2cf93762530a9c69dfc98c165a8b54238e2/src/Lean/Data/Xml/Parser.lean</a>)</p>



<a name="272246664"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/docs4%23/near/272246664" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/docs4.23.html#272246664">(Feb 17 2022 at 11:37)</a>:</h4>
<p>We don't have regular expressions (yet).</p>



<a name="272247192"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/docs4%23/near/272247192" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/docs4.23.html#272247192">(Feb 17 2022 at 11:42)</a>:</h4>
<p>Thanks! Will check those out</p>



<a name="272251114"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/docs4%23/near/272251114" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Xubai Wang <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/docs4.23.html#272251114">(Feb 17 2022 at 12:22)</a>:</h4>
<p>I would recommend looking at <a href="https://github.com/pzp1997/harkdown">harkdown</a> and <a href="https://github.com/jgm/commonmark-hs">commonmark-hs</a> (especially the latter one for its extensibility, we may need more features like equations and diagrams). They both implement CommonMark, using Parsec and following the two stage (block -&gt; inline) approach.</p>
<p><span class="user-mention silent" data-user-id="110043">Gabriel Ebner</span> <a href="#narrow/stream/270676-lean4/topic/docs4.23/near/272246649">said</a>:</p>
<blockquote>
<p>I would try using these parser combinators: <a href="https://github.com/leanprover/lean4/blob/6b1297fe85575c91cf613640bdd96cd1241d1a9e/src/Lean/Data/Parsec.lean">https://github.com/leanprover/lean4/blob/6b1297fe85575c91cf613640bdd96cd1241d1a9e/src/Lean/Data/Parsec.lean</a> (example XML parser: <a href="https://github.com/leanprover/lean4/blob/95aec2cf93762530a9c69dfc98c165a8b54238e2/src/Lean/Data/Xml/Parser.lean">https://github.com/leanprover/lean4/blob/95aec2cf93762530a9c69dfc98c165a8b54238e2/src/Lean/Data/Xml/Parser.lean</a>)</p>
</blockquote>
<p>The Lean Parsec itself cannot fit in this job, as the <a href="https://spec.commonmark.org/0.30/#link-reference-definitions">link reference definitions</a> element in CommonMark requires recording user state. One approach I can think of (and tried) is to extend <code>Parsec</code> with <code>StateT</code>:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">def</span> <span class="n">LinkRefMap</span> <span class="o">:=</span> <span class="n">HashMap</span> <span class="n">String</span> <span class="o">(</span><span class="n">String</span> <span class="bp">×</span> <span class="n">Option</span> <span class="n">String</span><span class="o">)</span>

<span class="kd">def</span> <span class="n">StateParsec</span> <span class="n">σ</span> <span class="o">:=</span> <span class="n">StateT</span> <span class="n">σ</span> <span class="n">Parsec</span>

<span class="kd">instance</span> <span class="o">:</span> <span class="n">MonadLift</span> <span class="n">Parsec</span> <span class="o">(</span><span class="n">StateParsec</span> <span class="n">σ</span><span class="o">)</span> <span class="n">where</span>   <span class="c1">-- to reuse current Parsec code</span>
  <span class="n">monadLift</span> <span class="n">p</span> <span class="o">:=</span> <span class="k">match</span> <span class="n">p</span> <span class="n">s</span> <span class="k">with</span>
  <span class="bp">|</span> <span class="n">Parsec.ParseResult.success</span> <span class="n">it</span> <span class="n">res</span> <span class="bp">=&gt;</span> <span class="n">Parsec.ParseResult.success</span> <span class="n">it</span> <span class="o">(</span><span class="n">res</span><span class="o">,</span> <span class="n">st</span><span class="o">)</span>
  <span class="bp">|</span> <span class="n">Parsec.ParseResult.error</span> <span class="n">it</span> <span class="n">err</span> <span class="bp">=&gt;</span> <span class="n">Parsec.ParseResult.error</span> <span class="n">it</span> <span class="n">err</span>

<span class="kd">def</span> <span class="n">Parser</span> <span class="o">:=</span> <span class="n">StateParsec</span> <span class="n">LinkRefMap</span>

<span class="kd">def</span> <span class="n">partial</span> <span class="o">:</span> <span class="n">Parser</span> <span class="n">Partial</span> <span class="o">:=</span> <span class="gr">sorry</span>  <span class="c1">-- block only</span>

<span class="kd">def</span> <span class="n">markdown</span> <span class="o">:</span> <span class="n">Parser</span> <span class="n">Markdown</span> <span class="o">:=</span> <span class="gr">sorry</span>  <span class="c1">-- full with both block and inline elements</span>
</code></pre></div>



<a name="272251538"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/docs4%23/near/272251538" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/docs4.23.html#272251538">(Feb 17 2022 at 12:26)</a>:</h4>
<p>You also don't have to limit yourself to haskell libraries (all the examples given thus far seem to have this in common so I guess it's not a coincidence). Better to use a good / well tested library than an FP library as basis</p>



<a name="272251886"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/docs4%23/near/272251886" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/docs4.23.html#272251886">(Feb 17 2022 at 12:30)</a>:</h4>
<p><span class="user-mention" data-user-id="414345">@Xubai Wang</span> It should be enough to <code>abbrev Parser := StateT LinkRefMap Parsec</code>.  If you make it an abbrev, then you get the MonadLift/etc. instances automatically.</p>



<a name="272251989"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/docs4%23/near/272251989" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/docs4.23.html#272251989">(Feb 17 2022 at 12:31)</a>:</h4>
<p>Just for the record, this is the DSL I wrote yesterday:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">inductive</span> <span class="n">Inline</span>
  <span class="bp">|</span> <span class="n">text</span>   <span class="o">:</span> <span class="n">String</span> <span class="bp">→</span> <span class="n">Inline</span>
  <span class="bp">|</span> <span class="n">bold</span>   <span class="o">:</span> <span class="n">String</span> <span class="bp">→</span> <span class="n">Inline</span>
  <span class="bp">|</span> <span class="n">italic</span> <span class="o">:</span> <span class="n">String</span> <span class="bp">→</span> <span class="n">Inline</span>
  <span class="bp">|</span> <span class="n">link</span>   <span class="o">:</span> <span class="n">String</span> <span class="bp">→</span> <span class="n">String</span> <span class="bp">→</span> <span class="n">Inline</span>
  <span class="bp">|</span> <span class="n">image</span>  <span class="o">:</span> <span class="n">String</span> <span class="bp">→</span> <span class="n">String</span> <span class="bp">→</span> <span class="n">Inline</span>
  <span class="bp">|</span> <span class="n">code</span>   <span class="o">:</span> <span class="n">String</span> <span class="bp">→</span> <span class="n">Inline</span>

<span class="kd">inductive</span> <span class="n">HeaderLevel</span>
  <span class="bp">|</span> <span class="n">h1</span> <span class="bp">|</span> <span class="n">h2</span> <span class="bp">|</span> <span class="n">h3</span> <span class="bp">|</span> <span class="n">h4</span> <span class="bp">|</span> <span class="n">h5</span> <span class="bp">|</span> <span class="n">h6</span>

<span class="n">abbrev</span> <span class="n">Content</span> <span class="o">:=</span> <span class="n">List</span> <span class="n">Inline</span>

<span class="kd">inductive</span> <span class="n">Block</span>
  <span class="bp">|</span> <span class="n">header</span>    <span class="o">:</span> <span class="n">HeaderLevel</span> <span class="bp">→</span> <span class="n">Content</span> <span class="bp">→</span> <span class="n">Block</span>
  <span class="bp">|</span> <span class="n">paragraph</span> <span class="o">:</span> <span class="n">Content</span>     <span class="bp">→</span> <span class="n">Block</span>
  <span class="bp">|</span> <span class="n">quote</span>     <span class="o">:</span> <span class="n">Content</span>     <span class="bp">→</span> <span class="n">Block</span>
  <span class="bp">|</span> <span class="n">itemize</span>   <span class="o">:</span> <span class="n">List</span> <span class="n">Block</span>  <span class="bp">→</span> <span class="n">Block</span>
  <span class="bp">|</span> <span class="n">enumerate</span> <span class="o">:</span> <span class="n">List</span> <span class="n">Block</span>  <span class="bp">→</span> <span class="n">Block</span>
  <span class="bp">|</span> <span class="n">codeBlock</span> <span class="o">:</span> <span class="n">String</span>      <span class="bp">→</span> <span class="n">String</span>  <span class="bp">→</span> <span class="n">Block</span>
  <span class="bp">|</span> <span class="n">divider</span>   <span class="o">:</span> <span class="n">Block</span>
</code></pre></div>



<a name="272252152"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/docs4%23/near/272252152" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Xubai Wang <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/docs4.23.html#272252152">(Feb 17 2022 at 12:33)</a>:</h4>
<p>Yes, <a href="https://github.com/markdown-it/markdown-it">markdown-it</a> is also an good option to look at, and it provides the highest flexibility among all the packages I have looked at. commonmark-hs is limited due to its <code>SyntaxSpec</code> definitions, while markdown-it uses a chain of rules. But in order to imitate it we need more flexible data structure, and I don't know how to get this done in a strongly typed functional language.</p>



<a name="272265386"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/docs4%23/near/272265386" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Matthew Ballard <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/docs4.23.html#272265386">(Feb 17 2022 at 14:19)</a>:</h4>
<p>Can latex be included in documentation for either v3 or v4?</p>



<a name="272266036"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/docs4%23/near/272266036" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Xubai Wang <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/docs4.23.html#272266036">(Feb 17 2022 at 14:24)</a>:</h4>
<p>In doc-gen3 the mathjax is used (see this <a href="https://leanprover-community.github.io/mathlib_docs/analysis/mean_inequalities.html">page</a>). And in doc-gen4 we will continue to use mathjax since mathml is not supported by Chrome.</p>



<a name="272266291"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/docs4%23/near/272266291" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Matthew Ballard <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/docs4.23.html#272266291">(Feb 17 2022 at 14:26)</a>:</h4>
<p>Great! I assume it is rendered client side?</p>



<a name="272266352"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/docs4%23/near/272266352" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/docs4.23.html#272266352">(Feb 17 2022 at 14:26)</a>:</h4>
<p>Yeah, more info <a href="https://www.mathjax.org/">here</a></p>



<a name="272266597"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/docs4%23/near/272266597" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Matthew Ballard <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/docs4.23.html#272266597">(Feb 17 2022 at 14:28)</a>:</h4>
<p>I use katex for course notes and render it on my machine before pushing (now using mdbook, before I did it client-side). What I would give for an extended markdown language that provides support for theorem environments and easy cross-linking...</p>



<a name="272268576"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/docs4%23/near/272268576" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/docs4.23.html#272268576">(Feb 17 2022 at 14:42)</a>:</h4>
<p><span class="user-mention" data-user-id="306577">@Matthew Ballard</span> offtopic, but <a href="https://github.com/arthurpaulino/arthurpaulino.github.io/blob/fe0df02bad00910e551785e367a1e8f0d5531119/_includes/head.html#L17">this is how</a> I set MathJax in my blog. If your repo has templates, you can just add that line inside the <code>&lt;head&gt;</code> of your pages and they will render LaTeX automagically.<br>
Or you can follow <a href="https://www.mathjax.org/#gettingstarted">these instructions</a></p>
<p>Then <a href="https://github.com/arthurpaulino/arthurpaulino.github.io/blob/fe0df02bad00910e551785e367a1e8f0d5531119/_posts/2017-12-28-backpropagation.md?plain=1#L67">this is how</a> you can type stuff that will be rendered in LaTeX. It's written in Brazilian portuguese, but you'll get what I mean</p>



<a name="272285032"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/docs4%23/near/272285032" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jireh Loreaux <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/docs4.23.html#272285032">(Feb 17 2022 at 16:31)</a>:</h4>
<p><span class="user-mention" data-user-id="306577">@Matthew Ballard</span>  I wrote a plugin for Gitit that uses Pandoc's native divs to support these features. The Gitit server keeps a database (just a text file) of information used for cross-linking and it has support for automatic numbering within each page. The code is kind of garbage and you have to run your own server, but I used it for a few semesters with students and I keep it for my private use too. If you want, I'll give you access to the code.</p>



<a name="272296165"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/docs4%23/near/272296165" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Xubai Wang <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/docs4.23.html#272296165">(Feb 17 2022 at 17:43)</a>:</h4>
<p>Hey, guys. I would like to collect some feedback on intra-documentation links.</p>
<p>I have rendered my Socket.lean package to GitHub Pages, and such a <a href="https://github.com/xubaiw/Socket.lean/blob/b1407dbffe84ac920db24a312f48ba9e4820ab76/Socket/Basic.lean#L24-L44">definition</a></p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="sd">/--</span>
<span class="sd">  Opaque reference to underlying platform specific socket.</span>
<span class="sd">  To create a `Socket`, refer to [`Socket.mk`](#Socket.Socket.mk). Then you</span>
<span class="sd">  can manipulate the `Socket` using common socket functions like</span>
<span class="sd">  [`Socket.bind`](#Socket.Socket.bind),[`Socket.connect`](#Socket.Socket.connect),</span>
<span class="sd">  etc. For all functions available, refer to the [`Socket` module](Socket/Socket.html).</span>
<span class="sd">  *NOTE*: `NonemptyType` is used to implement `Inhabited` for `Socket`. [detailed explanation](#explanation-usage-of-nonemptytype)</span>
<span class="sd">  ```lean</span>
<span class="sd">  import Socket</span>
<span class="sd">  open Socket</span>
<span class="sd">  def main : IO Unit := do</span>
<span class="sd">    let s ← Socket.mk</span>
<span class="sd">    -- some socket operations</span>
<span class="sd">    s.close</span>
<span class="sd">  ```</span>
<span class="sd">-/</span>
<span class="kd">def</span> <span class="n">Socket</span> <span class="o">:</span> <span class="kt">Type</span> <span class="o">:=</span> <span class="n">Socket.Nonempty.type</span>
</code></pre></div>
<p>renders to <a href="https://xubaiw.github.io/Socket.lean/Socket/Basic.html#Socket.Socket">https://xubaiw.github.io/Socket.lean/Socket/Basic.html#Socket.Socket</a>, with the following screen capture</p>
<p><a href="/user_uploads/3121/j0reajyOPS_tyKLxJ4XvU4OP/截屏2022-02-18-上午1.42.58.png">Socket.Socket</a></p>
<div class="message_inline_image"><a href="/user_uploads/3121/j0reajyOPS_tyKLxJ4XvU4OP/截屏2022-02-18-上午1.42.58.png" title="Socket.Socket"><img src="/user_uploads/3121/j0reajyOPS_tyKLxJ4XvU4OP/截屏2022-02-18-上午1.42.58.png"></a></div><p>So the plain code spans <code> ` Socket ` </code> and <code> ` Inhabited ` </code> automatically turns into links, <code>[`Socket.mk`](#Socket.Socket.mk)</code> automatically get linked to <code>Socket.mk</code> in another page (note that there is a <code>#</code> prefix),<br>
<code>[</code>Socket<code> module](Socket/Socket.html)</code> is prefixed with baseUrl, and<code>[detailed explanation](#explanation-usage-of-nonemptytype)</code> get linked to that id in this page.</p>
<p>I'm not very familiar with old doc-gen3 (and fail to find some intra documentation links in mathlib), and not sure whether this design is "correct", good enough or not, but it feels more consistent than the Rust <a href="https://stackoverflow.com/questions/31582064/how-to-link-to-other-fns-structs-enums-traits-in-rustdoc#answer-53504254">way</a>. These are the pseudo processing steps:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="c1">-- parse as name or id</span>
<span class="k">if</span> <span class="n">link</span> <span class="n">starts</span> <span class="k">with</span> <span class="s2">"#"</span>
    <span class="k">if</span> <span class="n">name</span> <span class="n">found</span> <span class="n">globally</span> <span class="o">(</span><span class="n">precise</span><span class="o">)</span> <span class="n">or</span> <span class="k">in</span> <span class="n">current</span> <span class="n">module</span>
        <span class="bp">|</span> <span class="n">yes</span> <span class="bp">=&gt;</span> <span class="n">link</span> <span class="n">it</span> <span class="n">to</span> <span class="n">the</span> <span class="n">name</span>
        <span class="bp">|</span> <span class="n">no</span> <span class="bp">=&gt;</span> <span class="k">do</span> <span class="n">not</span> <span class="n">modify</span> <span class="o">(</span><span class="n">id</span> <span class="n">on</span> <span class="n">the</span> <span class="n">same</span> <span class="n">page</span><span class="o">)</span>
<span class="c1">-- parse as absolute or relative url</span>
<span class="k">else</span>
    <span class="bp">|</span> <span class="n">absolute</span>  <span class="bp">=&gt;</span> <span class="k">do</span> <span class="n">not</span> <span class="n">modify</span>
    <span class="bp">|</span> <span class="n">relative</span> <span class="bp">=&gt;</span> <span class="n">add</span> <span class="n">module</span> <span class="n">base</span>
</code></pre></div>



<a name="272296669"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/docs4%23/near/272296669" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Xubai Wang <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/docs4.23.html#272296669">(Feb 17 2022 at 17:47)</a>:</h4>
<p>I also wonder if there are some other missing doc string features that someone can remind me of (except for code highlighting and equations, I will work on them tomorrow).</p>



<a name="272299951"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/docs4%23/near/272299951" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/docs4.23.html#272299951">(Feb 17 2022 at 18:08)</a>:</h4>
<p>I don't think we have a special way to link to definitions in doc-gen 3 (except for writing the full definition name).  The proposed syntax looks reasonable enough, although it would be nice if it didn't fail silently if the declaration can't be found.</p>



<a name="272300038"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/docs4%23/near/272300038" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/docs4.23.html#272300038">(Feb 17 2022 at 18:09)</a>:</h4>
<p>BTW:</p>
<blockquote>
<p>NOTE: NonemptyType is used to implement Inhabited for Socket. detailed explanation</p>
</blockquote>
<p>This is Nonempty now, not Inhabited.</p>



<a name="272300608"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/docs4%23/near/272300608" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Xubai Wang <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/docs4.23.html#272300608">(Feb 17 2022 at 18:13)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110043">Gabriel Ebner</span> <a href="#narrow/stream/270676-lean4/topic/docs4.23/near/272299951">said</a>:</p>
<blockquote>
<p>I don't think we have a special way to link to definitions in doc-gen 3 (except for writing the full definition name).  The proposed syntax looks reasonable enough, although it would be nice if it didn't fail silently if the declaration can't be found.</p>
</blockquote>
<p>But we also need to link to headings (#id), in this example the <code>#explanation-usage-of-nonemptytype</code>.</p>
<p>Since id and name share the same syntax, so if explicit failure is required we may pick another syntax for name first.</p>



<a name="272301297"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/docs4%23/near/272301297" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/docs4.23.html#272301297">(Feb 17 2022 at 18:18)</a>:</h4>
<p>That's what I was hinting at.</p>



<a name="272301849"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/docs4%23/near/272301849" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Xubai Wang <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/docs4.23.html#272301849">(Feb 17 2022 at 18:22)</a>:</h4>
<p>I cannot come up with a good alternative, maybe <code>@</code>, <code>%</code>, <code>~</code> or <code>-&gt;</code>?</p>



<a name="272304947"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/docs4%23/near/272304947" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/docs4.23.html#272304947">(Feb 17 2022 at 18:45)</a>:</h4>
<p><code>@decl</code> has the advantage that it is valid Lean syntax.  My other suggestion would have been <code>##decl</code>.</p>



<a name="272306003"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/docs4%23/near/272306003" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Xubai Wang <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/docs4.23.html#272306003">(Feb 17 2022 at 18:53)</a>:</h4>
<p><code>##decl</code> looks great!</p>



<a name="272521172"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/docs4%23/near/272521172" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Xubai Wang <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/docs4.23.html#272521172">(Feb 19 2022 at 14:21)</a>:</h4>
<p>My <a href="https://github.com/xubaiw/Unicode.lean">Unicode.lean</a> package may do some help to CommonMark parsing, as the specification involves <a href="https://spec.commonmark.org/0.30/#unicode-punctuation-character">some unicode stuff</a>.</p>



<a name="272584588"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/docs4%23/near/272584588" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Henrik Böving <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/docs4.23.html#272584588">(Feb 20 2022 at 11:04)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110038">Kevin Buzzard</span> <a href="#narrow/stream/270676-lean4/topic/docs4.23/near/271771892">said</a>:</p>
<blockquote>
<p>That definition doesn't have a docstring!</p>
</blockquote>
<p><a href="https://leanprover-community.github.io/mathlib4_docs/Mathlib/Data/List/Basic.html">https://leanprover-community.github.io/mathlib4_docs/Mathlib/Data/List/Basic.html</a> doc strings are alive thanks to <span class="user-mention" data-user-id="414345">@Xubai Wang</span> <span aria-label="octopus" class="emoji emoji-1f419" role="img" title="octopus">:octopus:</span></p>



<a name="272606342"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/docs4%23/near/272606342" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Henrik Böving <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/docs4.23.html#272606342">(Feb 20 2022 at 17:49)</a>:</h4>
<p>Before we merge <a href="https://github.com/leanprover/doc-gen4/pull/38#issuecomment-1046287290">https://github.com/leanprover/doc-gen4/pull/38#issuecomment-1046287290</a> is it possible to change the src# and docs# links to support this format? <span class="user-mention" data-user-id="110024">@Sebastian Ullrich</span> I don't know how powerful Zulip is in this regard so just to make sure we don't have to revert it right away.</p>



<a name="272606730"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/docs4%23/near/272606730" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/docs4.23.html#272606730">(Feb 20 2022 at 17:56)</a>:</h4>
<p>What's changed, just the <code>#</code>? The current rules look like this:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">docs4</span><span class="bp">#</span><span class="o">(</span><span class="bp">?</span><span class="n">P</span><span class="bp">&lt;</span><span class="n">decl</span><span class="bp">&gt;</span><span class="o">[</span><span class="bp">\</span><span class="n">w_.'</span><span class="bp">-</span><span class="o">]</span><span class="bp">*</span><span class="o">[</span><span class="bp">\</span><span class="n">w_'</span><span class="bp">-</span><span class="o">])</span>    <span class="n">https</span><span class="o">:</span><span class="bp">//</span><span class="n">leanprover</span><span class="bp">-</span><span class="n">community.github.io</span><span class="bp">/</span><span class="n">mathlib4_docs</span><span class="bp">/</span><span class="n">find</span><span class="bp">/%</span><span class="o">(</span><span class="n">decl</span><span class="o">)</span><span class="n">s</span>
</code></pre></div>



<a name="272606755"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/docs4%23/near/272606755" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Henrik Böving <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/docs4.23.html#272606755">(Feb 20 2022 at 17:57)</a>:</h4>
<p>Yeah and for the src# you'd need to append the /src to it</p>



<a name="272639639"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/docs4%23/near/272639639" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/docs4.23.html#272639639">(Feb 21 2022 at 04:21)</a>:</h4>
<p>That's how src# links already work, so if you are doing the same thing then it should just work</p>



<a name="272641804"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/docs4%23/near/272641804" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Xubai Wang <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/docs4.23.html#272641804">(Feb 21 2022 at 05:04)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110049">Mario Carneiro</span> <a href="#narrow/stream/270676-lean4/topic/docs4.23/near/272639639">said</a>:</p>
<blockquote>
<p>That's how src# links already work, so if you are doing the same thing then it should just work</p>
</blockquote>
<p>There is a bit difference. We now need an extra <code>#</code> number hash before declaration name, like <code>&lt;base&gt;/find/#mul_le_mul</code> and <code>&lt;base&gt;/find/#mul_le_mul/src</code>. The original way is not Windows friendly, and <code>#</code> is inevitable as we are limited to static serving.</p>



<a name="272642656"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/docs4%23/near/272642656" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/docs4.23.html#272642656">(Feb 21 2022 at 05:21)</a>:</h4>
<p>Doesn't <code>?</code> also have a special meaning in URL strings?</p>



<a name="272642673"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/docs4%23/near/272642673" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/docs4.23.html#272642673">(Feb 21 2022 at 05:22)</a>:</h4>
<p>although this is after the fragment specifier so maybe it's okay</p>



<a name="272642752"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/docs4%23/near/272642752" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/docs4.23.html#272642752">(Feb 21 2022 at 05:23)</a>:</h4>
<p>Does that mean that <code>&lt;base&gt;/find/</code> is now a huge page with every definition in it?</p>



<a name="272645208"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/docs4%23/near/272645208" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Xubai Wang <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/docs4.23.html#272645208">(Feb 21 2022 at 06:05)</a>:</h4>
<p>No, it just works the same way of search. It fetches the "every definition" and then do the search.</p>



<a name="272645414"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/docs4%23/near/272645414" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Xubai Wang <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/docs4.23.html#272645414">(Feb 21 2022 at 06:08)</a>:</h4>
<p>It doesn't lead to obvious time delay when I test it on Mathlib4 locally. But if you are worried about the performance, we can then store the "every definition" in browser cache (indexedDB) and add a hash file to check if it needs to be updated.</p>



<a name="272646373"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/docs4%23/near/272646373" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Xubai Wang <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/docs4.23.html#272646373">(Feb 21 2022 at 06:24)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110049">Mario Carneiro</span> <a href="#narrow/stream/270676-lean4/topic/docs4.23/near/272642656">said</a>:</p>
<blockquote>
<p>Doesn't <code>?</code> also have a special meaning in URL strings?</p>
</blockquote>
<p>Oh yes, I forgot about that. And <code>?</code> is a definitely more extensible solution. We may use <code>/find/?query=&lt;decl&gt;&amp;type=src</code>, and may add more options to that later (e.g. <code>type=interactive</code> for LeanInk integration). <span class="user-mention" data-user-id="395550">@Henrik Böving</span>  How do you think about that?</p>



<a name="272646736"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/docs4%23/near/272646736" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/docs4.23.html#272646736">(Feb 21 2022 at 06:31)</a>:</h4>
<p>I was going to suggest that myself, but <code>?</code> itself causes a problem with that</p>



<a name="272646751"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/docs4%23/near/272646751" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/docs4.23.html#272646751">(Feb 21 2022 at 06:31)</a>:</h4>
<p>You would need the linkifier to do percent encoding</p>



<a name="272646820"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/docs4%23/near/272646820" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/docs4.23.html#272646820">(Feb 21 2022 at 06:32)</a>:</h4>
<p>(I'm wondering whether any of this is making Leo and Sebastian reconsider <code>?</code> in identifiers...)</p>



<a name="272647124"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/docs4%23/near/272647124" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Xubai Wang <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/docs4.23.html#272647124">(Feb 21 2022 at 06:37)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110049">Mario Carneiro</span> <a href="#narrow/stream/270676-lean4/topic/docs4.23/near/272646751">said</a>:</p>
<blockquote>
<p>You would need the linkifier to do percent encoding</p>
</blockquote>
<p>I think it's not a problem for modern browsers?</p>
<p><a href="/user_uploads/3121/jED69XkdHdYWNJllILESpL88/截屏2022-02-21-下午2.36.23.png">screen capture</a></p>
<div class="message_inline_image"><a href="/user_uploads/3121/jED69XkdHdYWNJllILESpL88/截屏2022-02-21-下午2.36.23.png" title="screen capture"><img src="/user_uploads/3121/jED69XkdHdYWNJllILESpL88/截屏2022-02-21-下午2.36.23.png"></a></div>



<a name="272648166"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/docs4%23/near/272648166" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/docs4.23.html#272648166">(Feb 21 2022 at 06:54)</a>:</h4>
<p>well, depending on how precise the parser is, that string might be rejected as not a URL</p>



<a name="272659823"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/docs4%23/near/272659823" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/docs4.23.html#272659823">(Feb 21 2022 at 09:08)</a>:</h4>
<p>Read RFC 3986: <a href="https://datatracker.ietf.org/doc/html/rfc3986/#section-3.4">https://datatracker.ietf.org/doc/html/rfc3986/#section-3.4</a>  The question mark is not an issue; the query string begins with the first question mark and only ends with a <code>#</code> character.  As long as we don't get Haskell-style <code>UInt8#</code> identifiers we should be fine.</p>



<a name="272659900"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/docs4%23/near/272659900" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/docs4.23.html#272659900">(Feb 21 2022 at 09:09)</a>:</h4>
<p>We could also put the query in the fragment identifier, which has no such restriction.  That is, <code>/find/src/#&lt;decl&gt;</code>.</p>



<a name="272667219"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/docs4%23/near/272667219" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Xubai Wang <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/docs4.23.html#272667219">(Feb 21 2022 at 10:11)</a>:</h4>
<p>Comparing these two, personally I would stand behind the <code>?</code> query syntax:</p>
<ol>
<li><code>?</code> Query has a clearer semantic, we are requesting for a redirect service rather than some element on one page.</li>
<li><code>#</code> Fragment is path based and can not be combined with each other, which is less extensible.</li>
<li>For developing, <code>#</code> requires writing one more Lean module (and corresponding JS module) for that, while for <code>?</code> we only need to modify the endpoint JS file.</li>
</ol>
<p>I also suggest renaming the endpoint from <code>/find</code> to <code>/endpoint</code> in case we need to change the Zulip linkifier in future.</p>



<a name="272667395"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/docs4%23/near/272667395" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/docs4.23.html#272667395">(Feb 21 2022 at 10:13)</a>:</h4>
<blockquote>
<p>For developing, # requires writing one more Lean module (and corresponding JS module) for that, while for ? we only need to modify the endpoint JS file.</p>
</blockquote>
<p>I'm not sure I understand this point, you can access both <code>#</code> and <code>?</code> from javascript.  You could even do <code>/find/#src/&lt;decl&gt;</code> if you don't want to do two pages.</p>



<a name="272668735"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/docs4%23/near/272668735" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Xubai Wang <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/docs4.23.html#272668735">(Feb 21 2022 at 10:24)</a>:</h4>
<p>That's true.</p>



<a name="272669264"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/docs4%23/near/272669264" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/docs4.23.html#272669264">(Feb 21 2022 at 10:29)</a>:</h4>
<p>not a fan of <code>/endpoint</code>, that's a bit too jargon for my taste</p>



<a name="272673427"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/docs4%23/near/272673427" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Xubai Wang <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/docs4.23.html#272673427">(Feb 21 2022 at 11:04)</a>:</h4>
<p>Reading about the fragment <a href="https://datatracker.ietf.org/doc/html/rfc3986/#section-3.5">part</a> of RFC 3986, fragment is used to represent a portion or a view of the primary resource. <br>
So semantically best syntax might be <code>/find?q=Nat.add#src</code> and <code>/find?q=Nat.add#doc</code> <span aria-label="upside down" class="emoji emoji-1f643" role="img" title="upside down">:upside_down:</span></p>



<a name="272673700"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/docs4%23/near/272673700" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/docs4.23.html#272673700">(Feb 21 2022 at 11:06)</a>:</h4>
<p>That intention is long gone, <code>#</code> is used for many other things today.</p>



<a name="272673921"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/docs4%23/near/272673921" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/docs4.23.html#272673921">(Feb 21 2022 at 11:08)</a>:</h4>
<p>heh, just look up at the url of this zulip page</p>



<a name="272677236"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/docs4%23/near/272677236" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Xubai Wang <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/docs4.23.html#272677236">(Feb 21 2022 at 11:45)</a>:</h4>
<p>That also follows the portion meaning, and as zulip is not statically served, it won't conflict with the semantic for html.</p>
<p>Well, I think we are now some bit off the topic. The actual syntax of <code>find</code> doesn't matter a lot, as users will not interact with it directly. Any windows-compatible way is good enough. :D</p>



<a name="272994544"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/docs4%23/near/272994544" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Henrik Böving <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/docs4.23.html#272994544">(Feb 23 2022 at 18:50)</a>:</h4>
<p><span class="user-mention" data-user-id="110024">@Sebastian Ullrich</span> the search syntax was now changed as explained here <a href="https://github.com/leanprover/doc-gen4/pull/38#issuecomment-1048238235">https://github.com/leanprover/doc-gen4/pull/38#issuecomment-1048238235</a>, src stuff should work as well now, furthermore generating documentation under Windows should now work flawlessly as well since we no longer create the problematic files @windows users feel free to try.</p>



<a name="272994596"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/docs4%23/near/272994596" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/docs4.23.html#272994596">(Feb 23 2022 at 18:50)</a>:</h4>
<p>are the links live now?</p>



<a name="272994725"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/docs4%23/near/272994725" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Henrik Böving <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/docs4.23.html#272994725">(Feb 23 2022 at 18:52)</a>:</h4>
<p>Ehh, sebastian or someone with the correct permissions would need to change the way Zulip links the docs4# and src4# stuff but the github pages end should work yes</p>



<a name="272994824"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/docs4%23/near/272994824" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/docs4.23.html#272994824">(Feb 23 2022 at 18:52)</a>:</h4>
<p>that's me, I'm looking for the syntax to add</p>



<a name="272994925"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/docs4%23/near/272994925" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/docs4.23.html#272994925">(Feb 23 2022 at 18:53)</a>:</h4>
<p>I lost track of what syntax got implemented in the end</p>



<a name="272994969"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/docs4%23/near/272994969" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Henrik Böving <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/docs4.23.html#272994969">(Feb 23 2022 at 18:53)</a>:</h4>
<p>That's the one linked in the issue comment above ^ (well both work now :p, pick your poison)</p>



<a name="272995170"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/docs4%23/near/272995170" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/docs4.23.html#272995170">(Feb 23 2022 at 18:55)</a>:</h4>
<p><a href="https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Nat.add#doc">docs4#Nat.add</a> <a href="https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Nat.add#src">src4#Nat.add</a></p>



<a name="272995431"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/docs4%23/near/272995431" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Henrik Böving <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/docs4.23.html#272995431">(Feb 23 2022 at 18:57)</a>:</h4>
<p>So now where we got all the "easy" features implemented we can start looking into the fancy stuff <span aria-label="eyes" class="emoji emoji-1f440" role="img" title="eyes">:eyes:</span>, how is leanink doing? <span class="user-mention" data-user-id="451040">@Niklas Bülow</span></p>



<a name="273432611"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/docs4%23/near/273432611" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Niklas Bülow <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/docs4.23.html#273432611">(Feb 27 2022 at 23:55)</a>:</h4>
<p>Sorry, for the slight delay in responding. I'm currently in the process of writing down my bachelor thesis, but I'll probably complete it in the next few weeks. Do you already have something in mind on how we can integrate both tools with each other? or a preferred interface point in doc-gen4 from where you would like to interact with LeanInk?</p>



<a name="273448856"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/docs4%23/near/273448856" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Xubai Wang <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/docs4.23.html#273448856">(Feb 28 2022 at 05:56)</a>:</h4>
<p>Can we put it in a <code>&lt;details&gt;</code> fold like <code>Equations</code> and <code>Instances</code>? Or a separate page to be linked to like <code>source</code>?</p>



<a name="273458836"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/docs4%23/near/273458836" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/docs4.23.html#273458836">(Feb 28 2022 at 08:39)</a>:</h4>
<p>Yes, a (separate) <code>source</code> link (or moving the current one to a GH icon or something) like in Haddock sounds good &amp; simple to me.<br>
<a href="https://hackage.haskell.org/package/transformers-0.6.0.4/docs/Control-Monad-Trans-State-Lazy.html#t:StateT">https://hackage.haskell.org/package/transformers-0.6.0.4/docs/Control-Monad-Trans-State-Lazy.html#t:StateT</a><br>
<a href="https://hackage.haskell.org/package/transformers-0.6.0.4/docs/src/Control.Monad.Trans.State.Lazy.html#StateT">https://hackage.haskell.org/package/transformers-0.6.0.4/docs/src/Control.Monad.Trans.State.Lazy.html#StateT</a></p>



<a name="273462219"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/docs4%23/near/273462219" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Xubai Wang <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/docs4.23.html#273462219">(Feb 28 2022 at 09:13)</a>:</h4>
<p>How about naming it <code>interactive</code> or simply <code>ink</code>, rather than replacing  the <code>source</code>?  There seems to be lots of interactive widgets in Alectryon.</p>



<a name="273464630"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/docs4%23/near/273464630" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/docs4.23.html#273464630">(Feb 28 2022 at 09:37)</a>:</h4>
<p>The interactive source would be superior to the GitHub link in every aspect, I don't really see why we would want to keep both. The interactive source could still include a link to GitHub just in case, but there is no need to clutter the docs4 page.</p>



<a name="273467646"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/docs4%23/near/273467646" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/docs4.23.html#273467646">(Feb 28 2022 at 10:06)</a>:</h4>
<p>The github page allows you to see the list of commits touching the file, the git-blame output, etc., which is not in the interactive source.  But I agree, the default link should go to the interactive source.</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>