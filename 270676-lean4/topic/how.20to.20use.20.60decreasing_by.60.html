---
layout: archive
title: Zulip Chat Archive
permalink: /stream/270676-lean4/topic/how.20to.20use.20.60decreasing_by.60.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/index.html">lean4</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/how.20to.20use.20.60decreasing_by.60.html">how to use `decreasing_by`</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="272747104"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/how%20to%20use%20%60decreasing_by%60/near/272747104" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Simon Hudon <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/how.20to.20use.20.60decreasing_by.60.html#272747104">(Feb 22 2022 at 00:13)</a>:</h4>
<p>When using <code>decreasing_by</code>, the default tactics seem to get disabled. Is there an idiomatic way to keep it enabled and just specify and finishing tactic? Or is there a way to invoke (part of) the default tactic?</p>



<a name="272775059"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/how%20to%20use%20%60decreasing_by%60/near/272775059" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/how.20to.20use.20.60decreasing_by.60.html#272775059">(Feb 22 2022 at 08:56)</a>:</h4>
<p>The default tactic has a name, you can just call it</p>



<a name="272775463"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/how%20to%20use%20%60decreasing_by%60/near/272775463" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/how.20to.20use.20.60decreasing_by.60.html#272775463">(Feb 22 2022 at 09:00)</a>:</h4>
<p><code>decreasing_tactic</code></p>



<a name="272776524"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/how%20to%20use%20%60decreasing_by%60/near/272776524" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/how.20to.20use.20.60decreasing_by.60.html#272776524">(Feb 22 2022 at 09:10)</a>:</h4>
<p>Unfortunately it just fails if the current heuristics are not sufficient, so it's not really possible to "enhance" it. But you can always just copy and override it; for example, this one crudely takes care of many inequations generated by "almost-structural recursion" while we're waiting for <code>linarith</code>.</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">macro_rules</span>
<span class="bp">|</span> <span class="bp">`</span><span class="o">(</span><span class="n">tactic</span><span class="bp">|</span> <span class="n">decreasing_tactic</span><span class="o">)</span> <span class="bp">=&gt;</span>
 <span class="bp">`</span><span class="o">(</span><span class="n">tactic</span><span class="bp">|</span>
   <span class="o">(</span><span class="n">simp</span> <span class="o">[</span><span class="n">invImage</span><span class="o">,</span> <span class="n">InvImage</span><span class="o">,</span> <span class="n">Prod.lex</span><span class="o">,</span> <span class="n">sizeOfWFRel</span><span class="o">,</span> <span class="n">measure</span><span class="o">,</span> <span class="n">Nat.lt_wfRel</span><span class="o">,</span> <span class="n">WellFoundedRelation.rel</span><span class="o">]</span>
    <span class="n">repeat</span> <span class="o">(</span><span class="n">first</span> <span class="bp">|</span> <span class="n">apply</span> <span class="n">Prod.Lex.right</span> <span class="bp">|</span> <span class="n">apply</span> <span class="n">Prod.Lex.left</span><span class="o">)</span>
    <span class="n">repeat</span> <span class="o">(</span><span class="n">first</span> <span class="bp">|</span> <span class="n">apply</span> <span class="n">PSigma.Lex.right</span> <span class="bp">|</span> <span class="n">apply</span> <span class="n">PSigma.Lex.left</span><span class="o">)</span>
    <span class="n">simp</span> <span class="o">[</span><span class="n">Nat.add_comm</span> <span class="o">(</span><span class="n">n</span> <span class="o">:=</span> <span class="mi">1</span><span class="o">),</span> <span class="n">Nat.succ_add</span><span class="o">,</span> <span class="n">Nat.mul_succ</span><span class="o">]</span>
    <span class="n">try</span> <span class="n">apply</span> <span class="n">Nat.lt_succ_of_le</span>
    <span class="n">repeat</span> <span class="n">apply</span> <span class="n">Nat.le_step</span>
    <span class="n">first</span>
    <span class="bp">|</span> <span class="n">repeat</span> <span class="n">first</span> <span class="bp">|</span> <span class="n">apply</span> <span class="n">Nat.le_add_left</span> <span class="bp">|</span> <span class="n">apply</span> <span class="n">Nat.le_add_right_of_le</span>
    <span class="bp">|</span> <span class="n">assumption</span>
    <span class="n">all_goals</span> <span class="n">apply</span> <span class="n">Nat.le_refl</span>
<span class="o">))</span>
</code></pre></div>



<a name="272776735"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/how%20to%20use%20%60decreasing_by%60/near/272776735" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/how.20to.20use.20.60decreasing_by.60.html#272776735">(Feb 22 2022 at 09:12)</a>:</h4>
<p>Yeah, I think what you really want for those sizeof bounds is to be able to prove <code>a &lt; b</code> where <code>a</code> and <code>b</code> are sums such that every element of <code>a + 1</code> is in <code>b</code></p>



<a name="272776863"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/how%20to%20use%20%60decreasing_by%60/near/272776863" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/how.20to.20use.20.60decreasing_by.60.html#272776863">(Feb 22 2022 at 09:14)</a>:</h4>
<p>Do you think that such a tactic should go in core? I can see how to write it</p>



<a name="272778130"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/how%20to%20use%20%60decreasing_by%60/near/272778130" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/how.20to.20use.20.60decreasing_by.60.html#272778130">(Feb 22 2022 at 09:27)</a>:</h4>
<p>Would that be preferable to linarith in some way? Leo is already working on the latter.</p>



<a name="272778847"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/how%20to%20use%20%60decreasing_by%60/near/272778847" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/how.20to.20use.20.60decreasing_by.60.html#272778847">(Feb 22 2022 at 09:34)</a>:</h4>
<p>it's likely to be significantly faster</p>



<a name="272778875"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/how%20to%20use%20%60decreasing_by%60/near/272778875" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/how.20to.20use.20.60decreasing_by.60.html#272778875">(Feb 22 2022 at 09:34)</a>:</h4>
<p>good to know that leo is writing linarith though</p>



<a name="272779080"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/how%20to%20use%20%60decreasing_by%60/near/272779080" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/how.20to.20use.20.60decreasing_by.60.html#272779080">(Feb 22 2022 at 09:36)</a>:</h4>
<p>also 100% of the autogenerated well founded subgoals that I have seen are either in that grammar (after unfolding a bunch of definitions) or linarith would not have helped anyway</p>



<a name="272887990"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/how%20to%20use%20%60decreasing_by%60/near/272887990" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Simon Hudon <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/how.20to.20use.20.60decreasing_by.60.html#272887990">(Feb 23 2022 at 00:45)</a>:</h4>
<p>Thanks! That should do nicely for now</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>