---
layout: archive
title: Zulip Chat Archive
permalink: /stream/270676-lean4/topic/OptionM.20and.20DecEq.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/index.html">lean4</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/OptionM.20and.20DecEq.html">OptionM and DecEq</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="236378237"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/OptionM%20and%20DecEq/near/236378237" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Viteri <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/OptionM.20and.20DecEq.html#236378237">(Apr 27 2021 at 17:36)</a>:</h4>
<p>I have a datatype which contains an OptionM.<br>
Though each individual part of my datatype derives DecidableEq, the proof that the whole datatype is DecidableEq does not go through.</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">inductive</span> <span class="n">bleh</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">where</span>
<span class="bp">|</span> <span class="n">dep</span> <span class="o">:</span> <span class="n">bleh</span>
<span class="n">deriving</span> <span class="n">DecidableEq</span>

<span class="k">#eval</span> <span class="n">decEq</span> <span class="o">(</span><span class="n">Option.some</span> <span class="n">bleh.dep</span> <span class="o">:</span> <span class="n">OptionM</span> <span class="n">bleh</span><span class="o">)</span>
            <span class="o">(</span><span class="n">Option.some</span> <span class="n">bleh.dep</span> <span class="o">:</span> <span class="n">OptionM</span> <span class="n">bleh</span><span class="o">)</span>

<span class="kd">structure</span> <span class="n">bleh2</span> <span class="n">where</span> <span class="n">val</span> <span class="o">:</span> <span class="n">OptionM</span> <span class="n">bleh</span>

<span class="kd">theorem</span> <span class="n">bleh2.eqOfVeq</span> <span class="o">:</span> <span class="bp">∀</span> <span class="o">{</span><span class="n">a</span> <span class="n">b</span> <span class="o">:</span> <span class="n">bleh2</span><span class="o">},</span> <span class="n">Eq</span> <span class="n">a.val</span> <span class="n">b.val</span> <span class="bp">→</span> <span class="n">Eq</span> <span class="n">a</span> <span class="n">b</span>
<span class="bp">|</span> <span class="o">⟨</span><span class="n">a</span><span class="o">⟩,</span> <span class="o">⟨</span><span class="n">b</span><span class="o">⟩,</span> <span class="n">p</span> <span class="bp">=&gt;</span> <span class="n">congrArg</span> <span class="n">bleh2.mk</span> <span class="n">p</span>

<span class="kd">instance</span> <span class="o">:</span> <span class="n">DecidableEq</span> <span class="n">bleh2</span> <span class="o">:=</span>
<span class="k">fun</span>
 <span class="bp">|</span> <span class="o">⟨</span><span class="n">a</span><span class="o">⟩,</span> <span class="o">⟨</span><span class="n">b</span><span class="o">⟩</span> <span class="bp">=&gt;</span> <span class="n">bleh2.eqOfVeq</span> <span class="o">(</span><span class="n">decEq</span> <span class="n">a</span> <span class="n">b</span><span class="o">)</span>
</code></pre></div>
<p>At (decEq a b) I get:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">failed</span> <span class="n">to</span> <span class="n">synthesize</span> <span class="kd">instance</span>
  <span class="n">DecidableEq</span> <span class="o">(</span><span class="n">OptionM</span> <span class="n">bleh</span><span class="o">)</span>
</code></pre></div>



<a name="236379000"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/OptionM%20and%20DecEq/near/236379000" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/OptionM.20and.20DecEq.html#236379000">(Apr 27 2021 at 17:42)</a>:</h4>
<p>There appears to be a missing decidability instance for <code>OptionM</code>. If you add it things work as expected:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">inductive</span> <span class="n">bleh</span> <span class="o">:</span> <span class="kt">Type</span>
<span class="bp">|</span> <span class="n">dep</span> <span class="o">:</span> <span class="n">bleh</span>
<span class="n">deriving</span> <span class="n">DecidableEq</span>

<span class="kd">instance</span> <span class="o">[</span><span class="n">DecidableEq</span> <span class="n">α</span><span class="o">]</span> <span class="o">:</span> <span class="n">DecidableEq</span> <span class="o">(</span><span class="n">OptionM</span> <span class="n">α</span><span class="o">)</span> <span class="o">:=</span> <span class="n">instDecidableEqOption</span>

<span class="kd">structure</span> <span class="n">bleh2</span> <span class="n">where</span> <span class="n">val</span> <span class="o">:</span> <span class="n">OptionM</span> <span class="n">bleh</span>
<span class="n">deriving</span> <span class="n">DecidableEq</span>

<span class="bp">#</span><span class="n">synth</span> <span class="n">DecidableEq</span> <span class="n">bleh2</span>
</code></pre></div>



<a name="236379717"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/OptionM%20and%20DecEq/near/236379717" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Viteri <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/OptionM.20and.20DecEq.html#236379717">(Apr 27 2021 at 17:47)</a>:</h4>
<p>Hmm then why did the following run?</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="k">#eval</span> <span class="n">decEq</span> <span class="o">(</span><span class="n">Option.some</span> <span class="n">bleh.dep</span> <span class="o">:</span> <span class="n">OptionM</span> <span class="n">bleh</span><span class="o">)</span>
            <span class="o">(</span><span class="n">Option.some</span> <span class="n">bleh.dep</span> <span class="o">:</span> <span class="n">OptionM</span> <span class="n">bleh</span><span class="o">)</span>
</code></pre></div>



<a name="236380370"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/OptionM%20and%20DecEq/near/236380370" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/OptionM.20and.20DecEq.html#236380370">(Apr 27 2021 at 17:51)</a>:</h4>
<p>because type ascriptions don't actually change the type of anything, the <code>decEq</code> there is seeing two things of type <code>Option bleh</code> and calling the instance for <code>Option</code></p>



<a name="236380547"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/OptionM%20and%20DecEq/near/236380547" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/OptionM.20and.20DecEq.html#236380547">(Apr 27 2021 at 17:52)</a>:</h4>
<p>if you use <code>show OptionM bleh from Option.some bleh.dep</code> instead it should call <code>OptionM</code>'s instance</p>



<a name="236381103"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/OptionM%20and%20DecEq/near/236381103" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Viteri <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/OptionM.20and.20DecEq.html#236381103">(Apr 27 2021 at 17:55)</a>:</h4>
<p><code>#check (1:Int) + 1</code><br>
changes the type, so I am not sure what you mean</p>



<a name="236381740"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/OptionM%20and%20DecEq/near/236381740" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Viteri <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/OptionM.20and.20DecEq.html#236381740">(Apr 27 2021 at 17:59)</a>:</h4>
<p>Also did you find instDecidableEqOption by looking through the c code?</p>



<a name="236381812"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/OptionM%20and%20DecEq/near/236381812" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/OptionM.20and.20DecEq.html#236381812">(Apr 27 2021 at 18:00)</a>:</h4>
<p>In that case <code>(1:Int)</code> was used to help infer what <code>1</code> means, resulting in something like <code>@One.one Int</code> which has type <code>Int</code></p>



<a name="236381873"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/OptionM%20and%20DecEq/near/236381873" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/OptionM.20and.20DecEq.html#236381873">(Apr 27 2021 at 18:00)</a>:</h4>
<p>I used <code>#synth</code></p>



<a name="236381954"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/OptionM%20and%20DecEq/near/236381954" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/OptionM.20and.20DecEq.html#236381954">(Apr 27 2021 at 18:00)</a>:</h4>
<p>I originally tried guessing the name but the naming scheme has changed from lean 3</p>



<a name="236382059"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/OptionM%20and%20DecEq/near/236382059" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Viteri <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/OptionM.20and.20DecEq.html#236382059">(Apr 27 2021 at 18:01)</a>:</h4>
<p>ok</p>



<a name="236382346"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/OptionM%20and%20DecEq/near/236382346" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/OptionM.20and.20DecEq.html#236382346">(Apr 27 2021 at 18:03)</a>:</h4>
<p>here's an example of how type ascription doesn't actually change the type</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">def</span> <span class="n">Foo</span> <span class="o">:=</span> <span class="n">Nat</span>
<span class="kd">def</span> <span class="n">foo</span> <span class="o">:</span> <span class="n">Nat</span> <span class="o">:=</span> <span class="mi">1</span>
<span class="k">#check</span> <span class="o">(</span><span class="n">foo</span> <span class="o">:</span> <span class="n">Foo</span><span class="o">)</span> <span class="c1">-- foo : Nat</span>
<span class="k">#check</span> <span class="k">show</span> <span class="n">Foo</span> <span class="k">from</span> <span class="n">foo</span> <span class="c1">-- (fun (this : Foo) =&gt; this) foo : Foo</span>
</code></pre></div>



<a name="236382509"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/OptionM%20and%20DecEq/near/236382509" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/OptionM.20and.20DecEq.html#236382509">(Apr 27 2021 at 18:04)</a>:</h4>
<p>If <code>Foo</code> wasn't defeq to <code>Nat</code> then the first <code>#check</code> would have failed, but other than that and the side effects of unification it doesn't affect the term</p>



<a name="236382707"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/OptionM%20and%20DecEq/near/236382707" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/OptionM.20and.20DecEq.html#236382707">(Apr 27 2021 at 18:05)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">def</span> <span class="n">Foo</span> <span class="o">:=</span> <span class="n">Nat</span>
<span class="kd">def</span> <span class="n">mysorry</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">α</span><span class="o">,</span> <span class="n">α</span> <span class="o">:=</span> <span class="gr">sorry</span>
<span class="k">#check</span> <span class="n">mysorry</span> <span class="n">_</span> <span class="c1">-- mysorry ?m.17 : ?m.17</span>
<span class="k">#check</span> <span class="o">(</span><span class="n">mysorry</span> <span class="n">_</span> <span class="o">:</span> <span class="n">Foo</span><span class="o">)</span> <span class="c1">-- mysorry Foo : Foo</span>
<span class="k">#check</span> <span class="o">(</span><span class="n">mysorry</span> <span class="n">Nat</span> <span class="o">:</span> <span class="n">Foo</span><span class="o">)</span> <span class="c1">-- mysorry Nat : Nat</span>
</code></pre></div>
<p>this is the effect you are seeing with the <code>1:Nat</code> example</p>



<a name="236383361"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/OptionM%20and%20DecEq/near/236383361" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Viteri <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/OptionM.20and.20DecEq.html#236383361">(Apr 27 2021 at 18:10)</a>:</h4>
<p>I find it interesting that <code>show Foo from foo</code> creates a lambda and an application.<br>
Do you have any idea how I would write the instDecidableEqOption proof by hand? Right now it is pushing a proof through the Id monad in a way that seems magical to me.</p>



<a name="236383459"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/OptionM%20and%20DecEq/near/236383459" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/OptionM.20and.20DecEq.html#236383459">(Apr 27 2021 at 18:11)</a>:</h4>
<p><code>instDecidableEqOption</code> is just a proof that <code>Option A</code> has decidable equality by cases, the Id monad doesn't come up</p>



<a name="236383525"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/OptionM%20and%20DecEq/near/236383525" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/OptionM.20and.20DecEq.html#236383525">(Apr 27 2021 at 18:11)</a>:</h4>
<p>The observation here is that <code>OptionM A</code> is defeq to <code>Option A</code>, so the proof that <code>Option A</code> has decidable equality is also the proof that <code>OptionM A</code> has decidable equality</p>



<a name="236383612"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/OptionM%20and%20DecEq/near/236383612" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/OptionM.20and.20DecEq.html#236383612">(Apr 27 2021 at 18:12)</a>:</h4>
<p>That's because <code>OptionM A</code> is <code>OptionT Id A</code> which is <code>Id (Option A)</code> which is <code>Option A</code></p>



<a name="236384154"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/OptionM%20and%20DecEq/near/236384154" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Viteri <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/OptionM.20and.20DecEq.html#236384154">(Apr 27 2021 at 18:15)</a>:</h4>
<p>I don't see a proof that Option has decidable equality in the lean files?</p>



<a name="236384548"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/OptionM%20and%20DecEq/near/236384548" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/OptionM.20and.20DecEq.html#236384548">(Apr 27 2021 at 18:18)</a>:</h4>
<p>it links to</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">deriving</span> <span class="kd">instance</span> <span class="n">DecidableEq</span> <span class="n">for</span> <span class="n">Option</span>
</code></pre></div>
<p>in Init.Data.Option.Basic</p>



<a name="236384696"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/OptionM%20and%20DecEq/near/236384696" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/OptionM.20and.20DecEq.html#236384696">(Apr 27 2021 at 18:19)</a>:</h4>
<p>The <code>#print</code> proof looks a bit more mysterious:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">def</span> <span class="n">instDecidableEqOption.</span><span class="o">{</span><span class="n">u_1</span><span class="o">}</span> <span class="o">:</span> <span class="o">{</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u_1</span><span class="o">}</span> <span class="bp">→</span> <span class="o">[</span><span class="n">inst</span> <span class="o">:</span> <span class="n">DecidableEq</span> <span class="n">α</span><span class="o">]</span> <span class="bp">→</span> <span class="n">DecidableEq</span> <span class="o">(</span><span class="n">Option</span> <span class="n">α</span><span class="o">)</span> <span class="o">:=</span>
<span class="o">[</span><span class="n">anonymous</span><span class="o">]</span>
</code></pre></div>
<p>I guess it's been erased somehow? <span class="user-mention" data-user-id="110024">@Sebastian Ullrich</span> do you know what's happening here?</p>



<a name="236384757"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/OptionM%20and%20DecEq/near/236384757" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Viteri <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/OptionM.20and.20DecEq.html#236384757">(Apr 27 2021 at 18:20)</a>:</h4>
<p>also deriving for OptionM doesn't work</p>



<a name="236384845"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/OptionM%20and%20DecEq/near/236384845" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Viteri <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/OptionM.20and.20DecEq.html#236384845">(Apr 27 2021 at 18:20)</a>:</h4>
<p>because "OptionM is not an inductive type"</p>



<a name="236384875"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/OptionM%20and%20DecEq/near/236384875" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/OptionM.20and.20DecEq.html#236384875">(Apr 27 2021 at 18:20)</a>:</h4>
<p>right, because it's not</p>



<a name="236384905"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/OptionM%20and%20DecEq/near/236384905" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Viteri <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/OptionM.20and.20DecEq.html#236384905">(Apr 27 2021 at 18:20)</a>:</h4>
<p>which is why I thought I needed a separate proof in the first place</p>



<a name="236384990"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/OptionM%20and%20DecEq/near/236384990" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/OptionM.20and.20DecEq.html#236384990">(Apr 27 2021 at 18:21)</a>:</h4>
<p>well, mathlib has a derive handler for defs too, which maybe should be upstreamed to lean 4</p>



<a name="236385771"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/OptionM%20and%20DecEq/near/236385771" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Viteri <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/OptionM.20and.20DecEq.html#236385771">(Apr 27 2021 at 18:25)</a>:</h4>
<p>with pp.all true</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">def</span> <span class="n">instDecidableEqOption.</span><span class="o">{</span><span class="n">u_1</span><span class="o">}</span> <span class="o">:</span> <span class="o">{</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u_1</span><span class="o">}</span> <span class="bp">→</span>
  <span class="o">[</span><span class="n">inst</span> <span class="o">:</span> <span class="n">DecidableEq.</span><span class="o">{</span><span class="n">u_1</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">}</span> <span class="n">α</span><span class="o">]</span> <span class="bp">→</span> <span class="n">DecidableEq.</span><span class="o">{</span><span class="n">u_1</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">}</span> <span class="o">(</span><span class="n">Option.</span><span class="o">{</span><span class="n">u_1</span><span class="o">}</span> <span class="n">α</span><span class="o">)</span> <span class="o">:=</span>
<span class="k">fun</span> <span class="o">{</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u_1</span><span class="o">}</span> <span class="o">[</span><span class="n">inst</span> <span class="o">:</span> <span class="n">DecidableEq.</span><span class="o">{</span><span class="n">u_1</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">}</span> <span class="n">α</span><span class="o">]</span> <span class="bp">=&gt;</span>
  <span class="bp">@</span><span class="n">_private.Init.Data.Option.Basic.0.decEqOption.</span><span class="o">{</span><span class="n">u_1</span><span class="o">}</span> <span class="n">α</span> <span class="k">fun</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="o">:</span> <span class="n">α</span><span class="o">)</span> <span class="bp">=&gt;</span> <span class="n">inst</span> <span class="n">a</span> <span class="n">b</span>
</code></pre></div>



<a name="236385827"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/OptionM%20and%20DecEq/near/236385827" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Viteri <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/OptionM.20and.20DecEq.html#236385827">(Apr 27 2021 at 18:25)</a>:</h4>
<p>maybe it is anonymous because of this private bit</p>



<a name="236385945"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/OptionM%20and%20DecEq/near/236385945" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Viteri <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/OptionM.20and.20DecEq.html#236385945">(Apr 27 2021 at 18:26)</a>:</h4>
<p>where I have no idea what inst is</p>



<a name="236385993"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/OptionM%20and%20DecEq/near/236385993" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/OptionM.20and.20DecEq.html#236385993">(Apr 27 2021 at 18:26)</a>:</h4>
<p>that's a variable</p>



<a name="236386011"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/OptionM%20and%20DecEq/near/236386011" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Viteri <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/OptionM.20and.20DecEq.html#236386011">(Apr 27 2021 at 18:26)</a>:</h4>
<p>oh right</p>



<a name="236386083"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/OptionM%20and%20DecEq/near/236386083" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/OptionM.20and.20DecEq.html#236386083">(Apr 27 2021 at 18:27)</a>:</h4>
<p>oof I can't <code>#print _private.Init.Data.Option.Basic.0.decEqOption</code>, this is awkward</p>



<a name="236386224"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/OptionM%20and%20DecEq/near/236386224" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Viteri <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/OptionM.20and.20DecEq.html#236386224">(Apr 27 2021 at 18:28)</a>:</h4>
<p>Cannot #check  _private.Init.Data.Option.Basic.0.decEqOption</p>



<a name="236386513"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/OptionM%20and%20DecEq/near/236386513" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Viteri <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/OptionM.20and.20DecEq.html#236386513">(Apr 27 2021 at 18:30)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">lean_object</span><span class="bp">*</span> <span class="n">l___private_Init_Data_Option_Basic_0__decEqOption____x40_Init_Data_Option_Basic___hyg_588____at_instDecidableEqOption___spec__1</span><span class="o">(</span><span class="n">lean_object</span><span class="bp">*</span> <span class="n">x_1</span><span class="o">)</span> <span class="o">{</span>
<span class="n">_start</span><span class="o">:</span>
<span class="o">{</span>
<span class="n">lean_object</span><span class="bp">*</span> <span class="n">x_2</span><span class="bp">;</span>
<span class="n">x_2</span> <span class="bp">=</span> <span class="n">lean_alloc_closure</span><span class="o">((</span><span class="n">void</span><span class="bp">*</span><span class="o">)(</span><span class="n">l___private_Init_Data_Option_Basic_0__decEqOption____x40_Init_Data_Option_Basic___hyg_588____at_instDecidableEqOption___spec__1___rarg</span><span class="o">),</span> <span class="mi">3</span><span class="o">,</span> <span class="mi">0</span><span class="o">)</span><span class="bp">;</span>
<span class="n">return</span> <span class="n">x_2</span><span class="bp">;</span>
<span class="o">}</span>
<span class="o">}</span>
</code></pre></div>



<a name="236386538"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/OptionM%20and%20DecEq/near/236386538" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/OptionM.20and.20DecEq.html#236386538">(Apr 27 2021 at 18:30)</a>:</h4>
<p>It's not even visible from inside <code>Init.Data.Option.Basic</code>, it looks like this</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">def</span> <span class="n">instDecidableEqOption.</span><span class="o">{</span><span class="n">u_1</span><span class="o">}</span> <span class="o">:</span> <span class="o">{</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u_1</span><span class="o">}</span> <span class="bp">→</span>
  <span class="o">[</span><span class="n">inst</span> <span class="o">:</span> <span class="n">DecidableEq.</span><span class="o">{</span><span class="n">u_1</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">}</span> <span class="n">α</span><span class="o">]</span> <span class="bp">→</span> <span class="n">DecidableEq.</span><span class="o">{</span><span class="n">u_1</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">}</span> <span class="o">(</span><span class="n">Option.</span><span class="o">{</span><span class="n">u_1</span><span class="o">}</span> <span class="n">α</span><span class="o">)</span> <span class="o">:=</span>
<span class="k">fun</span> <span class="o">{</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u_1</span><span class="o">}</span> <span class="o">[</span><span class="n">inst</span> <span class="o">:</span> <span class="n">DecidableEq.</span><span class="o">{</span><span class="n">u_1</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">}</span> <span class="n">α</span><span class="o">]</span> <span class="bp">=&gt;</span> <span class="bp">@</span><span class="n">_private.0.decEqOption</span><span class="bp">✝.</span><span class="o">{</span><span class="n">u_1</span><span class="o">}</span> <span class="n">α</span> <span class="k">fun</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="o">:</span> <span class="n">α</span><span class="o">)</span> <span class="bp">=&gt;</span> <span class="n">inst</span> <span class="n">a</span> <span class="n">b</span>
</code></pre></div>
<p>it's double protected, it's got the <code>✝</code> too</p>



<a name="236386676"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/OptionM%20and%20DecEq/near/236386676" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Viteri <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/OptionM.20and.20DecEq.html#236386676">(Apr 27 2021 at 18:31)</a>:</h4>
<p>does cross mean irreducible?</p>



<a name="236386709"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/OptionM%20and%20DecEq/near/236386709" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/OptionM.20and.20DecEq.html#236386709">(Apr 27 2021 at 18:31)</a>:</h4>
<p>it means inaccessible</p>



<a name="236386729"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/OptionM%20and%20DecEq/near/236386729" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Viteri <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/OptionM.20and.20DecEq.html#236386729">(Apr 27 2021 at 18:31)</a>:</h4>
<p>ok</p>



<a name="236386737"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/OptionM%20and%20DecEq/near/236386737" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/OptionM.20and.20DecEq.html#236386737">(Apr 27 2021 at 18:31)</a>:</h4>
<p>as in you can't type the name <code>decEqOption</code> and refer to it</p>



<a name="236386848"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/OptionM%20and%20DecEq/near/236386848" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/OptionM.20and.20DecEq.html#236386848">(Apr 27 2021 at 18:32)</a>:</h4>
<p>The definition exists, but you need tactic hacks to see it</p>



<a name="236386880"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/OptionM%20and%20DecEq/near/236386880" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Viteri <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/OptionM.20and.20DecEq.html#236386880">(Apr 27 2021 at 18:32)</a>:</h4>
<p>I wonder why the proof of Option decEq is such a secret</p>



<a name="236386956"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/OptionM%20and%20DecEq/near/236386956" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Viteri <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/OptionM.20and.20DecEq.html#236386956">(Apr 27 2021 at 18:32)</a>:</h4>
<p>maybe has to do with the staging?</p>



<a name="236386959"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/OptionM%20and%20DecEq/near/236386959" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/OptionM.20and.20DecEq.html#236386959">(Apr 27 2021 at 18:32)</a>:</h4>
<p>I'm guessing this is just done by default in the derive handler</p>



<a name="236387070"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/OptionM%20and%20DecEq/near/236387070" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Viteri <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/OptionM.20and.20DecEq.html#236387070">(Apr 27 2021 at 18:33)</a>:</h4>
<p>but it is not like the c is generated from the derive handler</p>



<a name="236387118"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/OptionM%20and%20DecEq/near/236387118" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/OptionM.20and.20DecEq.html#236387118">(Apr 27 2021 at 18:33)</a>:</h4>
<p>The C has nothing to do with it</p>



<a name="236387207"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/OptionM%20and%20DecEq/near/236387207" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/OptionM.20and.20DecEq.html#236387207">(Apr 27 2021 at 18:34)</a>:</h4>
<p>The derive handler just made a <code>private def</code></p>



<a name="236387253"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/OptionM%20and%20DecEq/near/236387253" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Viteri <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/OptionM.20and.20DecEq.html#236387253">(Apr 27 2021 at 18:34)</a>:</h4>
<p>ok</p>



<a name="236387269"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/OptionM%20and%20DecEq/near/236387269" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/OptionM.20and.20DecEq.html#236387269">(Apr 27 2021 at 18:34)</a>:</h4>
<p>and private defs are a real pain to look at</p>



<a name="236387306"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/OptionM%20and%20DecEq/near/236387306" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/OptionM.20and.20DecEq.html#236387306">(Apr 27 2021 at 18:34)</a>:</h4>
<p>let alone prove properties about</p>



<a name="236387308"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/OptionM%20and%20DecEq/near/236387308" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Viteri <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/OptionM.20and.20DecEq.html#236387308">(Apr 27 2021 at 18:34)</a>:</h4>
<p>ok, so mystery mostly solved</p>



<a name="236388848"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/OptionM%20and%20DecEq/near/236388848" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/OptionM.20and.20DecEq.html#236388848">(Apr 27 2021 at 18:45)</a>:</h4>
<p>ah, I got so close but <code>printIdCore</code> is private</p>



<a name="236388952"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/OptionM%20and%20DecEq/near/236388952" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Viteri <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/OptionM.20and.20DecEq.html#236388952">(Apr 27 2021 at 18:46)</a>:</h4>
<p>how did you get closer</p>



<a name="236389230"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/OptionM%20and%20DecEq/near/236389230" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/OptionM.20and.20DecEq.html#236389230">(Apr 27 2021 at 18:48)</a>:</h4>
<p>eh, I'll just use homebrew <code>#print</code></p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">Lean</span>

<span class="kn">open</span> <span class="n">Lean</span> <span class="n">Elab</span>
<span class="k">#eval</span> <span class="k">show</span> <span class="n">TermElabM</span> <span class="n">Unit</span> <span class="k">from</span> <span class="k">do</span>
  <span class="k">let</span> <span class="n">some</span> <span class="n">d</span> <span class="bp">←</span> <span class="n">pure</span> <span class="bp">$</span> <span class="o">(</span><span class="bp">←</span> <span class="n">getEnv</span><span class="o">)</span><span class="bp">.</span><span class="n">find</span><span class="bp">?</span> <span class="bp">`</span><span class="n">instDecidableEqOption</span> <span class="bp">|</span> <span class="n">throwError</span> <span class="s2">""</span>
  <span class="k">let</span> <span class="n">decEqOption</span> <span class="o">:=</span> <span class="n">d.value</span><span class="bp">!.</span><span class="n">bindingBody</span><span class="bp">!.</span><span class="n">bindingBody</span><span class="bp">!.</span><span class="n">getAppFn.constName</span><span class="bp">!</span>
  <span class="k">let</span> <span class="n">some</span> <span class="n">d</span> <span class="bp">←</span> <span class="n">pure</span> <span class="bp">$</span> <span class="o">(</span><span class="bp">←</span> <span class="n">getEnv</span><span class="o">)</span><span class="bp">.</span><span class="n">find</span><span class="bp">?</span> <span class="n">decEqOption</span> <span class="bp">|</span> <span class="n">throwError</span> <span class="s2">""</span>
  <span class="n">logInfo</span> <span class="n">d.value</span><span class="bp">!</span>

<span class="c1">-- fun {α : Type u_1} (x x_1 : Option α) =&gt;</span>
<span class="c1">--   match x, x_1 with</span>
<span class="c1">--   | none, none =&gt; isTrue proof_1</span>
<span class="c1">--   | none, some x =&gt; isFalse (proof_2 x)</span>
<span class="c1">--   | some x, none =&gt; isFalse (proof_3 x)</span>
<span class="c1">--   | some a, some b =&gt; if h : a = b then Eq.ndrec (isTrue (proof_4 a)) h else isFalse (proof_5 a b h)</span>
</code></pre></div>



<a name="236389879"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/OptionM%20and%20DecEq/near/236389879" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/OptionM.20and.20DecEq.html#236389879">(Apr 27 2021 at 18:53)</a>:</h4>
<p>oh, and the excavation yielded an unexpected observation: that <code>Eq.ndrec</code> shouldn't be there, it should say <code>isTrue (proof_4 a b h)</code>. Kernel computation can sometimes get stuck on that</p>



<a name="236390134"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/OptionM%20and%20DecEq/near/236390134" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Viteri <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/OptionM.20and.20DecEq.html#236390134">(Apr 27 2021 at 18:55)</a>:</h4>
<p>what is this <code>let decEqOption := d.value!.bindingBody!.bindingBody!.getAppFn.constName</code></p>



<a name="236390281"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/OptionM%20and%20DecEq/near/236390281" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Viteri <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/OptionM.20and.20DecEq.html#236390281">(Apr 27 2021 at 18:56)</a>:</h4>
<p>you use that to get the name which you then search for?</p>



<a name="236390341"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/OptionM%20and%20DecEq/near/236390341" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/OptionM.20and.20DecEq.html#236390341">(Apr 27 2021 at 18:57)</a>:</h4>
<p>yeah, we know the name is being used in the definition of <code>instDecidableEqOption</code> so I pull it out of the expr</p>



<a name="236390392"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/OptionM%20and%20DecEq/near/236390392" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Viteri <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/OptionM.20and.20DecEq.html#236390392">(Apr 27 2021 at 18:57)</a>:</h4>
<p>I see</p>



<a name="236390400"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/OptionM%20and%20DecEq/near/236390400" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/OptionM.20and.20DecEq.html#236390400">(Apr 27 2021 at 18:57)</a>:</h4>
<p>there is a fancy tactic for doing this in mathlib</p>



<a name="236390498"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/OptionM%20and%20DecEq/near/236390498" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Viteri <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/OptionM.20and.20DecEq.html#236390498">(Apr 27 2021 at 18:58)</a>:</h4>
<p>how to search for proof_1</p>



<a name="236390523"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/OptionM%20and%20DecEq/near/236390523" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/OptionM.20and.20DecEq.html#236390523">(Apr 27 2021 at 18:58)</a>:</h4>
<p>more digging, of course that's private too</p>



<a name="236390552"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/OptionM%20and%20DecEq/near/236390552" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Viteri <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/OptionM.20and.20DecEq.html#236390552">(Apr 27 2021 at 18:58)</a>:</h4>
<p>maybe the current name.proof_1</p>



<a name="236390574"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/OptionM%20and%20DecEq/near/236390574" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/OptionM.20and.20DecEq.html#236390574">(Apr 27 2021 at 18:59)</a>:</h4>
<p>none of these names can be typed explicitly</p>



<a name="236390615"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/OptionM%20and%20DecEq/near/236390615" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/OptionM.20and.20DecEq.html#236390615">(Apr 27 2021 at 18:59)</a>:</h4>
<p>they contain numeric components as well as hygiene suffixes</p>



<a name="236390624"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/OptionM%20and%20DecEq/near/236390624" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Viteri <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/OptionM.20and.20DecEq.html#236390624">(Apr 27 2021 at 18:59)</a>:</h4>
<p>why shouldn't  it be Eq.ndrec (isTrue ...) h</p>



<a name="236390778"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/OptionM%20and%20DecEq/near/236390778" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Viteri <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/OptionM.20and.20DecEq.html#236390778">(Apr 27 2021 at 19:00)</a>:</h4>
<p>no I see, because the output is a decidability proof</p>



<a name="236390792"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/OptionM%20and%20DecEq/near/236390792" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Viteri <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/OptionM.20and.20DecEq.html#236390792">(Apr 27 2021 at 19:00)</a>:</h4>
<p>must end in isTrue or isFalse</p>



<a name="236390795"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/OptionM%20and%20DecEq/near/236390795" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/OptionM.20and.20DecEq.html#236390795">(Apr 27 2021 at 19:00)</a>:</h4>
<p>because evaluating that expression to a constructor, i.e. <code>isTrue ...</code>, requires evaluating <code>h</code>, which might not work if <code>h</code> uses an axiom</p>



<a name="236391075"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/OptionM%20and%20DecEq/near/236391075" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Viteri <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/OptionM.20and.20DecEq.html#236391075">(Apr 27 2021 at 19:02)</a>:</h4>
<p>but a = b is decidable itself?</p>



<a name="236391124"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/OptionM%20and%20DecEq/near/236391124" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Viteri <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/OptionM.20and.20DecEq.html#236391124">(Apr 27 2021 at 19:02)</a>:</h4>
<p>and h : a = b</p>



<a name="236391135"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/OptionM%20and%20DecEq/near/236391135" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/OptionM.20and.20DecEq.html#236391135">(Apr 27 2021 at 19:02)</a>:</h4>
<p>right, which means <code>h</code> is coming from the decidability proof of <code>DecidableEq A</code> which could be anything</p>



<a name="236391347"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/OptionM%20and%20DecEq/near/236391347" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/OptionM.20and.20DecEq.html#236391347">(Apr 27 2021 at 19:04)</a>:</h4>
<p>it wouldn't be that unusual for an axiom to come up either, for example the proof of <code>DecidableEq (Bool -&gt; Nat)</code> is surely going to use funext</p>



<a name="236391367"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/OptionM%20and%20DecEq/near/236391367" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Viteri <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/OptionM.20and.20DecEq.html#236391367">(Apr 27 2021 at 19:04)</a>:</h4>
<p>so the issue is that if you prove a type has dec eq using some axioms, inference of Option dec eq might block?</p>



<a name="236391382"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/OptionM%20and%20DecEq/near/236391382" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/OptionM.20and.20DecEq.html#236391382">(Apr 27 2021 at 19:04)</a>:</h4>
<p>right</p>



<a name="236391479"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/OptionM%20and%20DecEq/near/236391479" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/OptionM.20and.20DecEq.html#236391479">(Apr 27 2021 at 19:05)</a>:</h4>
<p>well not inference but rather computation making use of the derived instance on Option</p>



<a name="236391482"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/OptionM%20and%20DecEq/near/236391482" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Viteri <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/OptionM.20and.20DecEq.html#236391482">(Apr 27 2021 at 19:05)</a>:</h4>
<p>so Option (Bool -&gt; Nat) cannot have dec eq?</p>



<a name="236391641"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/OptionM%20and%20DecEq/near/236391641" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/OptionM.20and.20DecEq.html#236391641">(Apr 27 2021 at 19:06)</a>:</h4>
<p>it has dec eq but <code>if x = x then a else b = a</code> won't be <code>rfl</code> when <code>x</code> has type <code>Option (Bool -&gt; Nat)</code></p>



<a name="236391735"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/OptionM%20and%20DecEq/near/236391735" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Viteri <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/OptionM.20and.20DecEq.html#236391735">(Apr 27 2021 at 19:06)</a>:</h4>
<p>so if you eval to check if a= b where <code>a b : Option (Bool -&gt; Nat)</code> it will block</p>



<a name="236391792"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/OptionM%20and%20DecEq/near/236391792" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/OptionM.20and.20DecEq.html#236391792">(Apr 27 2021 at 19:07)</a>:</h4>
<p>yes (in the kernel, not in C)</p>



<a name="236391808"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/OptionM%20and%20DecEq/near/236391808" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Viteri <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/OptionM.20and.20DecEq.html#236391808">(Apr 27 2021 at 19:07)</a>:</h4>
<p>ok nice</p>



<a name="236391940"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/OptionM%20and%20DecEq/near/236391940" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/OptionM.20and.20DecEq.html#236391940">(Apr 27 2021 at 19:08)</a>:</h4>
<p>the compiler treats <code>Eq.ndrec</code> like an identity function so it doesn't block and it doesn't compute <code>h</code> either</p>



<a name="236397915"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/OptionM%20and%20DecEq/near/236397915" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Viteri <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/OptionM.20and.20DecEq.html#236397915">(Apr 27 2021 at 19:52)</a>:</h4>
<p>I tried to instantiate the same solution for EvalMeta (Option a)</p>



<a name="236397954"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/OptionM%20and%20DecEq/near/236397954" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Viteri <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/OptionM.20and.20DecEq.html#236397954">(Apr 27 2021 at 19:53)</a>:</h4>
<p>synth tells me to look for instMetaEval</p>



<a name="236398016"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/OptionM%20and%20DecEq/near/236398016" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Viteri <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/OptionM.20and.20DecEq.html#236398016">(Apr 27 2021 at 19:53)</a>:</h4>
<p>but instMetaEval or Lean.instMetaEval does not seem to be in scope</p>



<a name="236398040"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/OptionM%20and%20DecEq/near/236398040" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Viteri <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/OptionM.20and.20DecEq.html#236398040">(Apr 27 2021 at 19:53)</a>:</h4>
<p>grepping through lean src is similarly unsuccessful</p>



<a name="236398422"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/OptionM%20and%20DecEq/near/236398422" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Viteri <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/OptionM.20and.20DecEq.html#236398422">(Apr 27 2021 at 19:56)</a>:</h4>
<p>trying </p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="k">#eval</span> <span class="k">show</span> <span class="n">TermElabM</span> <span class="n">Unit</span> <span class="k">from</span> <span class="k">do</span>
  <span class="k">let</span> <span class="n">some</span> <span class="n">d</span> <span class="bp">←</span> <span class="n">pure</span> <span class="bp">$</span> <span class="o">(</span><span class="bp">←</span> <span class="n">getEnv</span><span class="o">)</span><span class="bp">.</span><span class="n">find</span><span class="bp">?</span> <span class="bp">`</span><span class="n">instMetaEval</span> <span class="bp">|</span> <span class="n">throwError</span> <span class="s2">""</span>
  <span class="n">logInfo</span> <span class="n">d.value</span><span class="bp">!</span>
</code></pre></div>
<p>hangs</p>



<a name="236399263"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/OptionM%20and%20DecEq/near/236399263" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/OptionM.20and.20DecEq.html#236399263">(Apr 27 2021 at 20:02)</a>:</h4>
<p>make sure you have an up to date installation, the issue with empty messages hanging the server has been fixed recently</p>



<a name="236399325"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/OptionM%20and%20DecEq/near/236399325" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Viteri <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/OptionM.20and.20DecEq.html#236399325">(Apr 27 2021 at 20:03)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="bp">~/</span><span class="n">LocalSoftware</span><span class="bp">/</span><span class="n">signatures</span><span class="bp">/</span><span class="n">lean4</span> <span class="bp">$</span> <span class="n">lean</span> <span class="c1">--version</span>
<span class="n">Lean</span> <span class="o">(</span><span class="n">version</span> <span class="mi">4</span><span class="bp">.</span><span class="mi">0</span><span class="bp">.</span><span class="mi">0</span><span class="bp">-</span><span class="n">nightly</span><span class="bp">-</span><span class="mi">2021</span><span class="bp">-</span><span class="mi">04</span><span class="bp">-</span><span class="mi">27</span><span class="o">,</span> <span class="n">commit</span> <span class="mi">1</span><span class="n">f05f5bf1193</span><span class="o">,</span> <span class="n">Release</span><span class="o">)</span>
</code></pre></div>



<a name="236399462"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/OptionM%20and%20DecEq/near/236399462" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/OptionM.20and.20DecEq.html#236399462">(Apr 27 2021 at 20:03)</a>:</h4>
<p>It was fixed in the extension, not Lean</p>



<a name="236399628"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/OptionM%20and%20DecEq/near/236399628" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Viteri <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/OptionM.20and.20DecEq.html#236399628">(Apr 27 2021 at 20:04)</a>:</h4>
<p>then the question is which extension -- vscode or emacs (I'm using emacs)</p>



<a name="236399675"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/OptionM%20and%20DecEq/near/236399675" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/OptionM.20and.20DecEq.html#236399675">(Apr 27 2021 at 20:05)</a>:</h4>
<p><span class="user-mention silent" data-user-id="228135">Scott Viteri</span> <a href="#narrow/stream/270676-lean4/topic/OptionM.20and.20DecEq/near/236397954">said</a>:</p>
<blockquote>
<p>synth tells me to look for instMetaEval</p>
</blockquote>
<p>how did you do this</p>



<a name="236399725"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/OptionM%20and%20DecEq/near/236399725" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/OptionM.20and.20DecEq.html#236399725">(Apr 27 2021 at 20:05)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">variable</span> <span class="o">(</span><span class="n">a</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">)</span> <span class="o">[</span><span class="n">MetaEval</span> <span class="n">a</span><span class="o">]</span>
<span class="bp">#</span><span class="n">synth</span> <span class="n">MetaEval</span> <span class="o">(</span><span class="n">Option</span> <span class="n">a</span><span class="o">)</span>
</code></pre></div>
<p>doesn't seem to work for me</p>



<a name="236399740"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/OptionM%20and%20DecEq/near/236399740" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/OptionM.20and.20DecEq.html#236399740">(Apr 27 2021 at 20:05)</a>:</h4>
<p>Ah, it never was an issue in Emacs - it would simply show you the line and column and then an empty message afterwards</p>



<a name="236399753"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/OptionM%20and%20DecEq/near/236399753" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Viteri <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/OptionM.20and.20DecEq.html#236399753">(Apr 27 2021 at 20:05)</a>:</h4>
<p><code>#synth Lean.MetaEval (Option Nat)</code></p>



<a name="236399787"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/OptionM%20and%20DecEq/near/236399787" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Viteri <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/OptionM.20and.20DecEq.html#236399787">(Apr 27 2021 at 20:05)</a>:</h4>
<p>Ok, then not my issue</p>



<a name="236399855"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/OptionM%20and%20DecEq/near/236399855" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/OptionM.20and.20DecEq.html#236399855">(Apr 27 2021 at 20:06)</a>:</h4>
<p><code>#print instMetaEval</code> reveals that it's actually <code>Lean.instMetaEval</code></p>



<a name="236399885"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/OptionM%20and%20DecEq/near/236399885" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Viteri <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/OptionM.20and.20DecEq.html#236399885">(Apr 27 2021 at 20:06)</a>:</h4>
<p>hmm tried it</p>



<a name="236399890"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/OptionM%20and%20DecEq/near/236399890" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/OptionM.20and.20DecEq.html#236399890">(Apr 27 2021 at 20:06)</a>:</h4>
<p>you can also use <code> ``instMetaEval</code> to make name resolution kick in</p>



<a name="236399963"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/OptionM%20and%20DecEq/near/236399963" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/OptionM.20and.20DecEq.html#236399963">(Apr 27 2021 at 20:07)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110024">Sebastian Ullrich</span> <a href="#narrow/stream/270676-lean4/topic/OptionM.20and.20DecEq/near/236399740">said</a>:</p>
<blockquote>
<p>Ah, it never was an issue in Emacs - it would simply show you the line and column and then an empty message afterwards</p>
</blockquote>
<p>Yep, that's exactly what it's doing for me:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">Messages</span> <span class="o">(</span><span class="mi">2</span><span class="o">)</span>
<span class="mi">4</span><span class="o">:</span><span class="mi">0</span><span class="o">:</span>

<span class="mi">4</span><span class="o">:</span><span class="mi">0</span><span class="o">:</span>
</code></pre></div>
<p>No hang</p>



<a name="236399974"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/OptionM%20and%20DecEq/near/236399974" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/OptionM.20and.20DecEq.html#236399974">(Apr 27 2021 at 20:07)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="k">#eval</span> <span class="k">show</span> <span class="n">TermElabM</span> <span class="n">Unit</span> <span class="k">from</span> <span class="k">do</span>
  <span class="k">let</span> <span class="n">some</span> <span class="n">d</span> <span class="bp">←</span> <span class="n">pure</span> <span class="bp">$</span> <span class="o">(</span><span class="bp">←</span> <span class="n">getEnv</span><span class="o">)</span><span class="bp">.</span><span class="n">find</span><span class="bp">?</span> <span class="bp">``</span><span class="n">instMetaEval</span> <span class="bp">|</span> <span class="n">throwError</span> <span class="s2">"a"</span>
  <span class="n">logInfo</span> <span class="n">d.value</span><span class="bp">!</span>
<span class="c1">-- fun {α : Type u} =&gt;</span>
<span class="c1">--   { eval :=</span>
<span class="c1">--       fun (env : Lean.Environment) (opts : Lean.Options) (a : α) (hideUnit : Bool) =&gt;</span>
<span class="c1">--         do</span>
<span class="c1">--           Lean.Eval.eval (fun (x : Unit) =&gt; a) hideUnit</span>
<span class="c1">--           pure env }</span>
</code></pre></div>



<a name="236399979"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/OptionM%20and%20DecEq/near/236399979" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Viteri <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/OptionM.20and.20DecEq.html#236399979">(Apr 27 2021 at 20:07)</a>:</h4>
<p>Oh, Lean.instMetaEval gives a different error message</p>



<a name="236400002"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/OptionM%20and%20DecEq/near/236400002" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Viteri <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/OptionM.20and.20DecEq.html#236400002">(Apr 27 2021 at 20:07)</a>:</h4>
<p>I need to implement Eval as well</p>



<a name="236400010"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/OptionM%20and%20DecEq/near/236400010" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/OptionM.20and.20DecEq.html#236400010">(Apr 27 2021 at 20:07)</a>:</h4>
<p>although I'm getting <code>Error: index out of bounds</code> in the output window from something</p>



<a name="236400099"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/OptionM%20and%20DecEq/near/236400099" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Viteri <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/OptionM.20and.20DecEq.html#236400099">(Apr 27 2021 at 20:08)</a>:</h4>
<p>oh, why does `` make it work in the metaprogram?</p>



<a name="236400185"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/OptionM%20and%20DecEq/near/236400185" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/OptionM.20and.20DecEq.html#236400185">(Apr 27 2021 at 20:08)</a>:</h4>
<p>That resolves names in the current namespace / <code>open</code></p>



<a name="236400215"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/OptionM%20and%20DecEq/near/236400215" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/OptionM.20and.20DecEq.html#236400215">(Apr 27 2021 at 20:09)</a>:</h4>
<p>so since <code>Lean</code> is open it resolves to <code>Lean.instMetaEval</code></p>



<a name="236400278"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/OptionM%20and%20DecEq/near/236400278" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/OptionM.20and.20DecEq.html#236400278">(Apr 27 2021 at 20:09)</a>:</h4>
<p>(I haven't been showing it but my file has</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">Lean</span>

<span class="kn">open</span> <span class="n">Lean</span> <span class="n">Elab</span>
</code></pre></div>
<p>at the top)</p>



<a name="236400335"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/OptionM%20and%20DecEq/near/236400335" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/OptionM.20and.20DecEq.html#236400335">(Apr 27 2021 at 20:10)</a>:</h4>
<p>btw</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">variable</span>
</code></pre></div>
<p>is throwing a panic for me, is this already reported?</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">PANIC</span> <span class="n">at</span> <span class="n">Lean.Elab.Command.getBracketedBinderIds</span> <span class="n">Lean.Elab.Command</span><span class="o">:</span><span class="mi">292</span><span class="o">:</span><span class="mi">56</span><span class="o">:</span> <span class="n">unreachable</span> <span class="n">code</span> <span class="n">has</span> <span class="n">been</span> <span class="n">reached</span>
</code></pre></div>



<a name="236400531"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/OptionM%20and%20DecEq/near/236400531" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Viteri <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/OptionM.20and.20DecEq.html#236400531">(Apr 27 2021 at 20:11)</a>:</h4>
<p>Fixed my problems with </p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">instance</span> <span class="o">[</span><span class="n">DecidableEq</span> <span class="n">α</span><span class="o">]</span> <span class="o">:</span> <span class="n">DecidableEq</span> <span class="o">(</span><span class="n">OptionM</span> <span class="n">α</span><span class="o">)</span> <span class="o">:=</span>
  <span class="n">instDecidableEqOption</span>

<span class="kd">instance</span> <span class="o">[</span><span class="n">ToString</span> <span class="n">α</span><span class="o">]</span> <span class="o">:</span> <span class="n">ToString</span> <span class="o">(</span><span class="n">OptionM</span> <span class="n">α</span><span class="o">)</span> <span class="o">:=</span>
  <span class="n">instToStringOption</span>

<span class="kd">instance</span> <span class="o">[</span><span class="n">Lean.Eval</span> <span class="n">α</span><span class="o">]</span> <span class="o">[</span><span class="n">ToString</span> <span class="n">α</span><span class="o">]</span> <span class="o">:</span> <span class="n">Lean.Eval</span> <span class="o">(</span><span class="n">OptionM</span> <span class="n">α</span><span class="o">)</span> <span class="o">:=</span>
  <span class="n">Lean.instEval</span>

<span class="kd">instance</span> <span class="o">[</span><span class="n">Lean.MetaEval</span> <span class="n">α</span><span class="o">]</span> <span class="o">[</span><span class="n">ToString</span> <span class="n">α</span><span class="o">]</span> <span class="o">:</span> <span class="n">Lean.MetaEval</span> <span class="o">(</span><span class="n">OptionM</span> <span class="n">α</span><span class="o">)</span> <span class="o">:=</span>
  <span class="n">Lean.instMetaEval</span>
</code></pre></div>



<a name="236400668"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/OptionM%20and%20DecEq/near/236400668" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Viteri <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/OptionM.20and.20DecEq.html#236400668">(Apr 27 2021 at 20:12)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110049">Mario Carneiro</span> <a href="#narrow/stream/270676-lean4/topic/OptionM.20and.20DecEq/near/236400185">said</a>:</p>
<blockquote>
<p>That resolves names in the current namespace / <code>open</code></p>
</blockquote>
<p>Ok, and why does #print succeed when #check does not</p>



<a name="236400783"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/OptionM%20and%20DecEq/near/236400783" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/OptionM.20and.20DecEq.html#236400783">(Apr 27 2021 at 20:13)</a>:</h4>
<p>not sure what you mean?</p>



<a name="236400858"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/OptionM%20and%20DecEq/near/236400858" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/OptionM.20and.20DecEq.html#236400858">(Apr 27 2021 at 20:14)</a>:</h4>
<p>these both work for me</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">Lean</span>
<span class="kn">open</span> <span class="n">Lean</span> <span class="n">Elab</span>
<span class="k">#print</span> <span class="n">instMetaEval</span>
<span class="k">#check</span> <span class="bp">@</span><span class="n">instMetaEval</span>
</code></pre></div>



<a name="236400904"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/OptionM%20and%20DecEq/near/236400904" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/OptionM.20and.20DecEq.html#236400904">(Apr 27 2021 at 20:14)</a>:</h4>
<p>you need the <code>@</code> in check since otherwise it will try to solve a typeclass problem</p>



<a name="236401414"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/OptionM%20and%20DecEq/near/236401414" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Viteri <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/OptionM.20and.20DecEq.html#236401414">(Apr 27 2021 at 20:18)</a>:</h4>
<p>ok that was my problem</p>



<a name="236401420"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/OptionM%20and%20DecEq/near/236401420" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Viteri <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/OptionM.20and.20DecEq.html#236401420">(Apr 27 2021 at 20:18)</a>:</h4>
<p>didn't read the error</p>



<a name="236401591"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/OptionM%20and%20DecEq/near/236401591" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Viteri <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/OptionM.20and.20DecEq.html#236401591">(Apr 27 2021 at 20:20)</a>:</h4>
<p>actually that is not true -- I just had it open somewhere that didn't have "open Lean Elab"</p>



<a name="236403497"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/OptionM%20and%20DecEq/near/236403497" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Viteri <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/OptionM.20and.20DecEq.html#236403497">(Apr 27 2021 at 20:34)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110024">Sebastian Ullrich</span> <a href="#narrow/stream/270676-lean4/topic/OptionM.20and.20DecEq/near/236399963">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="110024">Sebastian Ullrich</span> <a href="#narrow/stream/270676-lean4/topic/OptionM.20and.20DecEq/near/236399740">said</a>:</p>
<blockquote>
<p>Ah, it never was an issue in Emacs - it would simply show you the line and column and then an empty message afterwards</p>
</blockquote>
<p>Yep, that's exactly what it's doing for me:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">Messages</span> <span class="o">(</span><span class="mi">2</span><span class="o">)</span>
<span class="mi">4</span><span class="o">:</span><span class="mi">0</span><span class="o">:</span>

<span class="mi">4</span><span class="o">:</span><span class="mi">0</span><span class="o">:</span>
</code></pre></div>
<p>No hang</p>
</blockquote>
<p>You are right -- I saw that #eval was not underlined, which made me think it was still computing</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>