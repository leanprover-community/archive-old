---
layout: archive
title: Zulip Chat Archive
permalink: /stream/270676-lean4/topic/for.2C.20unexpected.20need.20for.20type.20ascription.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/index.html">lean4</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/for.2C.20unexpected.20need.20for.20type.20ascription.html">for, unexpected need for type ascription</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="269048837"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/for%2C%20unexpected%20need%20for%20type%20ascription/near/269048837" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kyle Miller <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/for.2C.20unexpected.20need.20for.20type.20ascription.html#269048837">(Jan 24 2022 at 00:45)</a>:</h4>
<p>I was experimenting with using parsec and trying out <code>do</code>/<code>mut</code>/<code>for</code>, and I came across a type error that was surprising to me.  In the code below, if you remove the type ascription at the <code>-- ?</code>, there is an error "failed to synthesize instance <code>HAdd Nat Nat (Parsec Nat)</code>". This behavior also appears even if the loop contains monadic actions (for example, adding a <code>skip</code>).</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">Lean.Data.Parsec</span>

<span class="kn">open</span> <span class="n">Lean</span> <span class="n">Lean.Parsec</span>

<span class="kd">def</span> <span class="n">num</span> <span class="o">:</span> <span class="n">Parsec</span> <span class="n">Int</span> <span class="o">:=</span> <span class="k">do</span>
  <span class="k">let</span> <span class="n">neg</span> <span class="o">:</span> <span class="n">Bool</span> <span class="bp">←</span> <span class="o">(</span><span class="n">skipChar</span> <span class="sc">'-'</span> <span class="bp">*&gt;</span> <span class="n">pure</span> <span class="n">true</span><span class="o">)</span> <span class="bp">&lt;|&gt;</span> <span class="n">pure</span> <span class="n">false</span>
  <span class="k">let</span> <span class="n">mut</span> <span class="n">n</span> <span class="o">:</span> <span class="n">Nat</span> <span class="o">:=</span> <span class="mi">0</span>
  <span class="n">for</span> <span class="n">c</span> <span class="k">in</span> <span class="bp">←</span> <span class="n">many1</span> <span class="o">(</span><span class="n">satisfy</span> <span class="n">Char.isDigit</span><span class="o">)</span> <span class="k">do</span>
    <span class="n">n</span> <span class="bp">←</span> <span class="o">(</span><span class="mi">10</span> <span class="bp">*</span> <span class="n">n</span> <span class="bp">+</span> <span class="o">(</span><span class="n">c.toNat</span> <span class="bp">-</span> <span class="sc">'0'</span><span class="bp">.</span><span class="n">toNat</span><span class="o">)</span> <span class="o">:</span> <span class="n">Nat</span><span class="o">)</span> <span class="c1">-- ?</span>
  <span class="n">pure</span> <span class="bp">$</span> <span class="k">if</span> <span class="n">neg</span> <span class="k">then</span> <span class="bp">-</span><span class="n">n</span> <span class="k">else</span> <span class="n">n</span>

<span class="kd">def</span> <span class="n">parse</span> <span class="o">(</span><span class="n">s</span> <span class="o">:</span> <span class="n">String</span><span class="o">)</span> <span class="o">:</span> <span class="n">Except</span> <span class="n">String</span> <span class="n">Int</span> <span class="o">:=</span>
  <span class="k">match</span> <span class="o">(</span><span class="n">num</span> <span class="bp">&lt;*</span> <span class="n">eof</span><span class="o">)</span> <span class="n">s.mkIterator</span> <span class="k">with</span>
  <span class="bp">|</span> <span class="n">ParseResult.success</span> <span class="n">_</span> <span class="n">res</span> <span class="bp">=&gt;</span> <span class="n">Except.ok</span> <span class="n">res</span>
  <span class="bp">|</span> <span class="n">ParseResult.error</span> <span class="n">it</span> <span class="n">err</span>  <span class="bp">=&gt;</span> <span class="n">Except.error</span> <span class="n">s</span><span class="bp">!</span><span class="s2">"offset {it.i.repr}: {err}"</span>

<span class="k">#eval</span> <span class="n">parse</span> <span class="s2">"22"</span>
<span class="k">#eval</span> <span class="n">parse</span> <span class="s2">"-222"</span>
</code></pre></div>



<a name="269049398"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/for%2C%20unexpected%20need%20for%20type%20ascription/near/269049398" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/for.2C.20unexpected.20need.20for.20type.20ascription.html#269049398">(Jan 24 2022 at 00:57)</a>:</h4>
<p><span class="user-mention" data-user-id="306601">@Kyle Miller</span> for some reason it works if you do <code>n := (10 * n + (c.toNat - '0'.toNat))</code> instead</p>



<a name="269049574"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/for%2C%20unexpected%20need%20for%20type%20ascription/near/269049574" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kyle Miller <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/for.2C.20unexpected.20need.20for.20type.20ascription.html#269049574">(Jan 24 2022 at 01:00)</a>:</h4>
<p>Ah, thanks. I forgot that <code>:=</code> was the actual notation for updates, and that <code>&lt;- ...</code> was for <code>:= (&lt;- ...)</code></p>



<a name="269049625"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/for%2C%20unexpected%20need%20for%20type%20ascription/near/269049625" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kyle Miller <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/for.2C.20unexpected.20need.20for.20type.20ascription.html#269049625">(Jan 24 2022 at 01:01)</a>:</h4>
<p>Is it inferring the identity monad, then, for <code>&lt;-</code> here?</p>



<a name="269049763"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/for%2C%20unexpected%20need%20for%20type%20ascription/near/269049763" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/for.2C.20unexpected.20need.20for.20type.20ascription.html#269049763">(Jan 24 2022 at 01:04)</a>:</h4>
<p>Now I'm a bit confused. I thought I had used <code>&lt;-</code> for updates before <span aria-label="thinking" class="emoji emoji-1f914" role="img" title="thinking">:thinking:</span> <br>
Idk the answer to your question but I was trying to explicitly access the id monad</p>



<a name="269049850"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/for%2C%20unexpected%20need%20for%20type%20ascription/near/269049850" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Henrik Böving <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/for.2C.20unexpected.20need.20for.20type.20ascription.html#269049850">(Jan 24 2022 at 01:06)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">def</span> <span class="n">foo</span> <span class="o">:</span> <span class="n">IO</span> <span class="n">Nat</span> <span class="o">:=</span> <span class="n">return</span> <span class="mi">10</span>

<span class="kd">def</span> <span class="n">bar</span> <span class="o">:</span> <span class="n">IO</span> <span class="n">Nat</span> <span class="o">:=</span> <span class="k">do</span>
  <span class="k">let</span> <span class="n">mut</span> <span class="n">x</span> <span class="o">:=</span> <span class="mi">12</span>
  <span class="n">x</span> <span class="bp">←</span> <span class="n">foo</span>
  <span class="n">x</span>

<span class="k">#eval</span> <span class="n">bar</span>
</code></pre></div>
<p>It does work out</p>



<a name="269050027"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/for%2C%20unexpected%20need%20for%20type%20ascription/near/269050027" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/for.2C.20unexpected.20need.20for.20type.20ascription.html#269050027">(Jan 24 2022 at 01:10)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">def</span> <span class="n">bar</span> <span class="o">:</span> <span class="n">IO</span> <span class="n">Nat</span> <span class="o">:=</span> <span class="k">do</span>
  <span class="k">let</span> <span class="n">mut</span> <span class="n">x</span> <span class="o">:=</span> <span class="mi">12</span>
  <span class="n">x</span> <span class="bp">←</span> <span class="n">x</span> <span class="bp">+</span> <span class="mi">1</span>
  <span class="n">x</span>
</code></pre></div>
<p>Doesn't tho</p>



<a name="269050037"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/for%2C%20unexpected%20need%20for%20type%20ascription/near/269050037" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/for.2C.20unexpected.20need.20for.20type.20ascription.html#269050037">(Jan 24 2022 at 01:10)</a>:</h4>
<p><span class="user-mention silent" data-user-id="306601">Kyle Miller</span> <a href="#narrow/stream/270676-lean4/topic/for.2C.20unexpected.20need.20for.20type.20ascription/near/269049625">said</a>:</p>
<blockquote>
<p>Is it inferring the identity monad, then, for <code>&lt;-</code> here?</p>
</blockquote>
<p>It's inferring the <code>Parsec</code> monad because you are in a <code>Parsec</code> do block</p>



<a name="269050043"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/for%2C%20unexpected%20need%20for%20type%20ascription/near/269050043" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/for.2C.20unexpected.20need.20for.20type.20ascription.html#269050043">(Jan 24 2022 at 01:10)</a>:</h4>
<p>if you write <code>n &lt;- _</code> then the <code>_</code> should be a <code>Parsec Nat</code></p>



<a name="269050055"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/for%2C%20unexpected%20need%20for%20type%20ascription/near/269050055" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/for.2C.20unexpected.20need.20for.20type.20ascription.html#269050055">(Jan 24 2022 at 01:11)</a>:</h4>
<p>if you type ascribe it as a <code>Nat</code> then it inserts the <code>pure</code> coercion</p>



<a name="269050074"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/for%2C%20unexpected%20need%20for%20type%20ascription/near/269050074" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/for.2C.20unexpected.20need.20for.20type.20ascription.html#269050074">(Jan 24 2022 at 01:11)</a>:</h4>
<p>the correct thing to do here is use <code>n := ...</code>instead of <code>n &lt;- ...</code>. Note no <code>let</code></p>



<a name="269050120"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/for%2C%20unexpected%20need%20for%20type%20ascription/near/269050120" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/for.2C.20unexpected.20need.20for.20type.20ascription.html#269050120">(Jan 24 2022 at 01:12)</a>:</h4>
<p>omitting the <code>let</code> is how you know it's an update of a mutable variable and not a shadowed variable</p>



<a name="269050125"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/for%2C%20unexpected%20need%20for%20type%20ascription/near/269050125" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kyle Miller <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/for.2C.20unexpected.20need.20for.20type.20ascription.html#269050125">(Jan 24 2022 at 01:12)</a>:</h4>
<p><span class="user-mention" data-user-id="110049">@Mario Carneiro</span> I get the <code>Parsec</code> do block part, and I'd forgotten that updates were with <code>:=</code>.</p>
<p>Why is the ascription inserting a <code>pure</code>?</p>



<a name="269050130"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/for%2C%20unexpected%20need%20for%20type%20ascription/near/269050130" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/for.2C.20unexpected.20need.20for.20type.20ascription.html#269050130">(Jan 24 2022 at 01:12)</a>:</h4>
<p>the <code>:=</code> vs <code>&lt;-</code> determines whether the rhs is a monadic expression or a pure expression</p>



<a name="269050147"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/for%2C%20unexpected%20need%20for%20type%20ascription/near/269050147" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kyle Miller <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/for.2C.20unexpected.20need.20for.20type.20ascription.html#269050147">(Jan 24 2022 at 01:13)</a>:</h4>
<p>What led me astray is that <code>&lt;-</code> works at all, like in <span class="user-mention" data-user-id="395550">@Henrik Böving</span>'s example</p>



<a name="269050149"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/for%2C%20unexpected%20need%20for%20type%20ascription/near/269050149" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/for.2C.20unexpected.20need.20for.20type.20ascription.html#269050149">(Jan 24 2022 at 01:13)</a>:</h4>
<p><span class="user-mention silent" data-user-id="306601">Kyle Miller</span> <a href="#narrow/stream/270676-lean4/topic/for.2C.20unexpected.20need.20for.20type.20ascription/near/269050125">said</a>:</p>
<blockquote>
<p>Why is the ascription inserting a <code>pure</code>?</p>
</blockquote>
<p>because there is a coercion from <code>A</code> to <code>m A</code>  where <code>m</code> is a monad</p>



<a name="269050163"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/for%2C%20unexpected%20need%20for%20type%20ascription/near/269050163" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/for.2C.20unexpected.20need.20for.20type.20ascription.html#269050163">(Jan 24 2022 at 01:13)</a>:</h4>
<p>(actually I'm not sure whether it's literally a coercion in the <code>Coe</code> sense or whether this is special magic specific to the <code>do</code> DSL)</p>



<a name="269050165"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/for%2C%20unexpected%20need%20for%20type%20ascription/near/269050165" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kyle Miller <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/for.2C.20unexpected.20need.20for.20type.20ascription.html#269050165">(Jan 24 2022 at 01:14)</a>:</h4>
<p>Would this be a place where there ought to be an explicit <code>Id.run</code>?</p>



<a name="269050227"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/for%2C%20unexpected%20need%20for%20type%20ascription/near/269050227" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/for.2C.20unexpected.20need.20for.20type.20ascription.html#269050227">(Jan 24 2022 at 01:14)</a>:</h4>
<p>no, <code>Id.run</code> is going the other way: you want an <code>A</code> and you are providing an <code>Id A</code></p>



<a name="269050244"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/for%2C%20unexpected%20need%20for%20type%20ascription/near/269050244" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kyle Miller <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/for.2C.20unexpected.20need.20for.20type.20ascription.html#269050244">(Jan 24 2022 at 01:14)</a>:</h4>
<p>Like</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">def</span> <span class="n">foo</span> <span class="o">:</span> <span class="n">IO</span> <span class="n">Nat</span> <span class="o">:=</span> <span class="n">return</span> <span class="mi">10</span>

<span class="kd">def</span> <span class="n">bar</span> <span class="o">:</span> <span class="n">IO</span> <span class="n">Nat</span> <span class="o">:=</span> <span class="k">do</span>
  <span class="k">let</span> <span class="n">mut</span> <span class="n">x</span> <span class="o">:=</span> <span class="mi">12</span>
  <span class="n">x</span> <span class="bp">←</span> <span class="n">Id.run</span> <span class="n">foo</span>
  <span class="n">x</span>

<span class="k">#eval</span> <span class="n">bar</span>
</code></pre></div>



<a name="269050262"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/for%2C%20unexpected%20need%20for%20type%20ascription/near/269050262" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/for.2C.20unexpected.20need.20for.20type.20ascription.html#269050262">(Jan 24 2022 at 01:15)</a>:</h4>
<p>here you have an <code>A</code> and you want an <code>m A</code></p>



<a name="269050273"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/for%2C%20unexpected%20need%20for%20type%20ascription/near/269050273" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/for.2C.20unexpected.20need.20for.20type.20ascription.html#269050273">(Jan 24 2022 at 01:15)</a>:</h4>
<p>that's what <code>pure</code> does</p>



<a name="269050280"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/for%2C%20unexpected%20need%20for%20type%20ascription/near/269050280" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Henrik Böving <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/for.2C.20unexpected.20need.20for.20type.20ascription.html#269050280">(Jan 24 2022 at 01:15)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="bp">#</span><span class="n">synth</span> <span class="n">Coe</span> <span class="n">Nat</span> <span class="o">(</span><span class="n">Id</span> <span class="n">Nat</span><span class="o">)</span>
</code></pre></div>
<p>Fails <span class="user-mention" data-user-id="110049">@Mario Carneiro</span> so it appears there is no coercion here.</p>



<a name="269050312"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/for%2C%20unexpected%20need%20for%20type%20ascription/near/269050312" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kyle Miller <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/for.2C.20unexpected.20need.20for.20type.20ascription.html#269050312">(Jan 24 2022 at 01:15)</a>:</h4>
<p>Oh, right, I did get that backwards with what <code>Id.run</code> is meant to do. Still, it seems like this is something where users should be encouraged to insert a <code>pure</code> themselves if they really mean to use <code>&lt;-</code> rather than <code>:=</code>.</p>



<a name="269050402"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/for%2C%20unexpected%20need%20for%20type%20ascription/near/269050402" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kyle Miller <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/for.2C.20unexpected.20need.20for.20type.20ascription.html#269050402">(Jan 24 2022 at 01:17)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110049">Mario Carneiro</span> <a href="#narrow/stream/270676-lean4/topic/for.2C.20unexpected.20need.20for.20type.20ascription/near/269050055">said</a>:</p>
<blockquote>
<p>if you type ascribe it as a <code>Nat</code> then it inserts the <code>pure</code> coercion</p>
</blockquote>
<p>Just to mention where my followup question came from: I thought you were saying it would put the <code>pure</code> because of the ascription, not because the ascription causes the arithmetic to be a <code>Nat</code>, so then Lean inserts a <code>pure</code> outside the ascription, so to speak.</p>



<a name="269050408"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/for%2C%20unexpected%20need%20for%20type%20ascription/near/269050408" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/for.2C.20unexpected.20need.20for.20type.20ascription.html#269050408">(Jan 24 2022 at 01:17)</a>:</h4>
<p><span class="user-mention silent" data-user-id="306601">Kyle Miller</span> <a href="#narrow/stream/270676-lean4/topic/for.2C.20unexpected.20need.20for.20type.20ascription/near/269050312">said</a>:</p>
<blockquote>
<p>Oh, right, I did get that backwards with what <code>Id.run</code> is meant to do. Still, it seems like this is something where users should be encouraged to insert a <code>pure</code> themselves if they really mean to use <code>&lt;-</code> rather than <code>:=</code>.</p>
</blockquote>
<p>Yes, that's exactly what I do in these situations</p>



<a name="269050464"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/for%2C%20unexpected%20need%20for%20type%20ascription/near/269050464" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/for.2C.20unexpected.20need.20for.20type.20ascription.html#269050464">(Jan 24 2022 at 01:18)</a>:</h4>
<p>I like to omit the <code>pure</code> when I can, but it doesn't work in a case like <code>def foo : IO Nat := do 2 + 2</code></p>



<a name="269050465"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/for%2C%20unexpected%20need%20for%20type%20ascription/near/269050465" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kyle Miller <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/for.2C.20unexpected.20need.20for.20type.20ascription.html#269050465">(Jan 24 2022 at 01:18)</a>:</h4>
<p>What I mean is, can Lean encourage this by making it be an error if there's no <code>pure</code>?</p>



<a name="269050482"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/for%2C%20unexpected%20need%20for%20type%20ascription/near/269050482" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/for.2C.20unexpected.20need.20for.20type.20ascription.html#269050482">(Jan 24 2022 at 01:19)</a>:</h4>
<p>it's convenient to have the <code>pure</code> auto-inserted, and it makes it feel more like imperative code</p>



<a name="269050489"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/for%2C%20unexpected%20need%20for%20type%20ascription/near/269050489" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kyle Miller <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/for.2C.20unexpected.20need.20for.20type.20ascription.html#269050489">(Jan 24 2022 at 01:19)</a>:</h4>
<p>Specifically for this <code>&lt;-</code> update, though.</p>



<a name="269050494"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/for%2C%20unexpected%20need%20for%20type%20ascription/near/269050494" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kyle Miller <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/for.2C.20unexpected.20need.20for.20type.20ascription.html#269050494">(Jan 24 2022 at 01:19)</a>:</h4>
<p>Because then why have <code>:=</code> too?</p>



<a name="269050500"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/for%2C%20unexpected%20need%20for%20type%20ascription/near/269050500" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/for.2C.20unexpected.20need.20for.20type.20ascription.html#269050500">(Jan 24 2022 at 01:19)</a>:</h4>
<p>??</p>



<a name="269050506"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/for%2C%20unexpected%20need%20for%20type%20ascription/near/269050506" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/for.2C.20unexpected.20need.20for.20type.20ascription.html#269050506">(Jan 24 2022 at 01:19)</a>:</h4>
<p>If you are using <code>&lt;-</code> then you specifically want a monadic value on the right</p>



<a name="269050556"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/for%2C%20unexpected%20need%20for%20type%20ascription/near/269050556" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kyle Miller <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/for.2C.20unexpected.20need.20for.20type.20ascription.html#269050556">(Jan 24 2022 at 01:20)</a>:</h4>
<p>Right, so why have it auto-insert <code>pure</code> if it's not a monadic value on the right?</p>



<a name="269050563"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/for%2C%20unexpected%20need%20for%20type%20ascription/near/269050563" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/for.2C.20unexpected.20need.20for.20type.20ascription.html#269050563">(Jan 24 2022 at 01:20)</a>:</h4>
<p>It didn't insert the <code>pure</code> until you type ascribed it</p>



<a name="269050581"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/for%2C%20unexpected%20need%20for%20type%20ascription/near/269050581" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/for.2C.20unexpected.20need.20for.20type.20ascription.html#269050581">(Jan 24 2022 at 01:21)</a>:</h4>
<p>with the type ascription it's clearly the right thing to do, and without it it's unclear what to do and it opts to avoid the auto-insertion</p>



<a name="269050583"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/for%2C%20unexpected%20need%20for%20type%20ascription/near/269050583" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kyle Miller <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/for.2C.20unexpected.20need.20for.20type.20ascription.html#269050583">(Jan 24 2022 at 01:21)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">def</span> <span class="n">bar</span> <span class="o">:</span> <span class="n">IO</span> <span class="n">Nat</span> <span class="o">:=</span> <span class="k">do</span>
  <span class="k">let</span> <span class="n">y</span> <span class="o">:</span> <span class="n">Nat</span> <span class="o">:=</span> <span class="mi">5</span>
  <span class="k">let</span> <span class="n">mut</span> <span class="n">x</span> <span class="o">:</span> <span class="n">Nat</span> <span class="o">:=</span> <span class="mi">12</span>
  <span class="n">x</span> <span class="bp">←</span> <span class="n">y</span>
  <span class="n">x</span>

<span class="kd">def</span> <span class="n">bar'</span> <span class="o">:</span> <span class="n">IO</span> <span class="n">Nat</span> <span class="o">:=</span> <span class="k">do</span>
  <span class="k">let</span> <span class="n">y</span> <span class="o">:</span> <span class="n">Nat</span> <span class="o">:=</span> <span class="mi">5</span>
  <span class="k">let</span> <span class="n">mut</span> <span class="n">x</span> <span class="o">:</span> <span class="n">Nat</span> <span class="o">:=</span> <span class="mi">12</span>
  <span class="n">x</span> <span class="o">:=</span> <span class="n">y</span>
  <span class="n">x</span>
</code></pre></div>



<a name="269050625"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/for%2C%20unexpected%20need%20for%20type%20ascription/near/269050625" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/for.2C.20unexpected.20need.20for.20type.20ascription.html#269050625">(Jan 24 2022 at 01:22)</a>:</h4>
<p>I presume those both work</p>



<a name="269050630"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/for%2C%20unexpected%20need%20for%20type%20ascription/near/269050630" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kyle Miller <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/for.2C.20unexpected.20need.20for.20type.20ascription.html#269050630">(Jan 24 2022 at 01:22)</a>:</h4>
<p>They do both work, which is what I'm referring to.</p>



<a name="269050632"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/for%2C%20unexpected%20need%20for%20type%20ascription/near/269050632" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/for.2C.20unexpected.20need.20for.20type.20ascription.html#269050632">(Jan 24 2022 at 01:22)</a>:</h4>
<p>because the type of <code>y</code> is known</p>



<a name="269050640"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/for%2C%20unexpected%20need%20for%20type%20ascription/near/269050640" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/for.2C.20unexpected.20need.20for.20type.20ascription.html#269050640">(Jan 24 2022 at 01:22)</a>:</h4>
<p>this is the usual setting where a <code>\u</code> would be inserted</p>



<a name="269050645"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/for%2C%20unexpected%20need%20for%20type%20ascription/near/269050645" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/for.2C.20unexpected.20need.20for.20type.20ascription.html#269050645">(Jan 24 2022 at 01:23)</a>:</h4>
<p>you have type <code>A</code> and you want type <code>B</code> and lean knows they can't be the same</p>



<a name="269050704"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/for%2C%20unexpected%20need%20for%20type%20ascription/near/269050704" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kyle Miller <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/for.2C.20unexpected.20need.20for.20type.20ascription.html#269050704">(Jan 24 2022 at 01:24)</a>:</h4>
<p>Ok, but <em>should</em> it work here? I get more-or-less what mechanisms make it work, but would it be possible to make it not work? Is there any reason that it should, given that there's also <code>:=</code> syntax?</p>



<a name="269050727"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/for%2C%20unexpected%20need%20for%20type%20ascription/near/269050727" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/for.2C.20unexpected.20need.20for.20type.20ascription.html#269050727">(Jan 24 2022 at 01:24)</a>:</h4>
<p>I think it's a more orthogonal design if it does work</p>



<a name="269050745"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/for%2C%20unexpected%20need%20for%20type%20ascription/near/269050745" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/for.2C.20unexpected.20need.20for.20type.20ascription.html#269050745">(Jan 24 2022 at 01:25)</a>:</h4>
<p>who knows, maybe it is inconvenient to use <code>:=</code> for whatever reason (e.g. in a macro)</p>



<a name="269051037"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/for%2C%20unexpected%20need%20for%20type%20ascription/near/269051037" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kyle Miller <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/for.2C.20unexpected.20need.20for.20type.20ascription.html#269051037">(Jan 24 2022 at 01:31)</a>:</h4>
<p>Given that <code>do</code> notation's been changed to require <code>Id.run</code> for the id monad, I feel like it's rather surprising that <code>&lt;-</code> works for non-monadic RHS's.  (I just mean "surprising" from the point of view of someone learning the language.)</p>



<a name="269051250"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/for%2C%20unexpected%20need%20for%20type%20ascription/near/269051250" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/for.2C.20unexpected.20need.20for.20type.20ascription.html#269051250">(Jan 24 2022 at 01:36)</a>:</h4>
<p>generally you can use a non-monadic expression where a monadic expression is expected. This is an instance of coercion (although it seems to be implemented in a slightly different way than the generic <code>Coe</code>, likely because <code>A -&gt; m A</code> is a really generic type)</p>



<a name="269051285"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/for%2C%20unexpected%20need%20for%20type%20ascription/near/269051285" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/for.2C.20unexpected.20need.20for.20type.20ascription.html#269051285">(Jan 24 2022 at 01:37)</a>:</h4>
<p>Certainly coercion is weird from a strict type theory perspective - it's literally a type error and the compiler accepts it anyway</p>



<a name="269051350"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/for%2C%20unexpected%20need%20for%20type%20ascription/near/269051350" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/for.2C.20unexpected.20need.20for.20type.20ascription.html#269051350">(Jan 24 2022 at 01:38)</a>:</h4>
<p>but I would rather not see it removed, since it is one of the things that makes lean <code>do</code> notation more pleasant to write than Haskell <code>do</code> notation</p>



<a name="269052283"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/for%2C%20unexpected%20need%20for%20type%20ascription/near/269052283" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/for.2C.20unexpected.20need.20for.20type.20ascription.html#269052283">(Jan 24 2022 at 02:00)</a>:</h4>
<p>I think the main concern would be, if you blur the distinction a bit between <code>x : a</code> and <code>pure x : IO a</code>, then you may also accidentally blur <code>m : IO a</code> and <code>pure m : IO (IO a)</code>, and what you think is <code>m &gt;&gt; n</code> may actually be <code>pure m &gt;&gt; n</code>, which will also typecheck but be equivalent to just <code>n</code></p>



<a name="269052600"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/for%2C%20unexpected%20need%20for%20type%20ascription/near/269052600" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/for.2C.20unexpected.20need.20for.20type.20ascription.html#269052600">(Jan 24 2022 at 02:05)</a>:</h4>
<p>Since this isn't a <code>Coe</code> I think that latter thing will actually not work</p>



<a name="269052620"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/for%2C%20unexpected%20need%20for%20type%20ascription/near/269052620" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/for.2C.20unexpected.20need.20for.20type.20ascription.html#269052620">(Jan 24 2022 at 02:05)</a>:</h4>
<p>this is magic that only triggers in do block positions like <code>do let x &lt;- _</code> or <code>do bla (&lt;- _) </code> or <code>do _; _</code></p>



<a name="269052697"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/for%2C%20unexpected%20need%20for%20type%20ascription/near/269052697" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/for.2C.20unexpected.20need.20for.20type.20ascription.html#269052697">(Jan 24 2022 at 02:07)</a>:</h4>
<p>Aren't there other forms for all of those (e.g. <code>let x := _</code>), other than the last one (last underscore)?</p>



<a name="269052783"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/for%2C%20unexpected%20need%20for%20type%20ascription/near/269052783" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/for.2C.20unexpected.20need.20for.20type.20ascription.html#269052783">(Jan 24 2022 at 02:08)</a>:</h4>
<p>GHCi has a similar sort of ambiguity to the last one, where if you type something of type <code>IO _</code> in the interpreter, it will execute it, otherwise evaluate it</p>



<a name="269052905"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/for%2C%20unexpected%20need%20for%20type%20ascription/near/269052905" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/for.2C.20unexpected.20need.20for.20type.20ascription.html#269052905">(Jan 24 2022 at 02:11)</a>:</h4>
<p>But in the interpreter, the stakes are low as you will probably figure it out immediately if ghci misunderstood what you intended.</p>



<a name="269053126"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/for%2C%20unexpected%20need%20for%20type%20ascription/near/269053126" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/for.2C.20unexpected.20need.20for.20type.20ascription.html#269053126">(Jan 24 2022 at 02:17)</a>:</h4>
<p>You definitely don't want <code>do x; y</code> to mean <code>do pure x; y</code>.</p>



<a name="269053312"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/for%2C%20unexpected%20need%20for%20type%20ascription/near/269053312" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/for.2C.20unexpected.20need.20for.20type.20ascription.html#269053312">(Jan 24 2022 at 02:21)</a>:</h4>
<p>you might, if <code>x</code> actually has side effects</p>



<a name="269053323"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/for%2C%20unexpected%20need%20for%20type%20ascription/near/269053323" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/for.2C.20unexpected.20need.20for.20type.20ascription.html#269053323">(Jan 24 2022 at 02:21)</a>:</h4>
<p>like the equivalent of lean 3 <code>trace</code></p>



<a name="269053377"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/for%2C%20unexpected%20need%20for%20type%20ascription/near/269053377" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/for.2C.20unexpected.20need.20for.20type.20ascription.html#269053377">(Jan 24 2022 at 02:22)</a>:</h4>
<p>But it's still better for it to be a compiler error surely?</p>



<a name="269053380"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/for%2C%20unexpected%20need%20for%20type%20ascription/near/269053380" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/for.2C.20unexpected.20need.20for.20type.20ascription.html#269053380">(Jan 24 2022 at 02:22)</a>:</h4>
<p>because you can always insert <code>pure</code> yourself</p>



<a name="269053579"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/for%2C%20unexpected%20need%20for%20type%20ascription/near/269053579" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/for.2C.20unexpected.20need.20for.20type.20ascription.html#269053579">(Jan 24 2022 at 02:24)</a>:</h4>
<p>It's much more likely you intended to write a monadic action but messed up somehow, and luckily because you are using a typed language the compiler caught your error, right...?</p>



<a name="269053611"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/for%2C%20unexpected%20need%20for%20type%20ascription/near/269053611" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/for.2C.20unexpected.20need.20for.20type.20ascription.html#269053611">(Jan 24 2022 at 02:25)</a>:</h4>
<p>pshh, obviously the point of type systems is so that the compiler can always guess what you mean and never give you any type errors</p>



<a name="269053759"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/for%2C%20unexpected%20need%20for%20type%20ascription/near/269053759" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/for.2C.20unexpected.20need.20for.20type.20ascription.html#269053759">(Jan 24 2022 at 02:27)</a>:</h4>
<p>I remember thinking about how coercions have lead to the return of the "garbage theorem" when we found out that<br>
<code>(n1 n2) : nat</code> typechecks for <code>n1, n2 : nat</code></p>



<a name="269054097"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/for%2C%20unexpected%20need%20for%20type%20ascription/near/269054097" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/for.2C.20unexpected.20need.20for.20type.20ascription.html#269054097">(Jan 24 2022 at 02:34)</a>:</h4>
<p>Anyways, I don't think this <code>pure</code> insertion existed the last time I used Lean 4, but if the only useful place for it is indeed in the last line of a do block, that seems like a simpler and more predictable rule</p>



<a name="269054109"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/for%2C%20unexpected%20need%20for%20type%20ascription/near/269054109" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/for.2C.20unexpected.20need.20for.20type.20ascription.html#269054109">(Jan 24 2022 at 02:34)</a>:</h4>
<p>I have been looking for the code that does it and I haven't found it yet</p>



<a name="269065050"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/for%2C%20unexpected%20need%20for%20type%20ascription/near/269065050" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/for.2C.20unexpected.20need.20for.20type.20ascription.html#269065050">(Jan 24 2022 at 06:40)</a>:</h4>
<p>Personally, I agree with <span class="user-mention" data-user-id="306601">@Kyle Miller</span> and <span class="user-mention" data-user-id="110032">@Reid Barton</span> and think the auto <code>pure</code> is more trouble than it is worth. <span class="user-mention" data-user-id="110049">@Mario Carneiro</span> did you find an examples for where it is particularly convenient (outside the last line of a do block)? I think the feature is used a lot less often than one might think and that adding the explicit <code>pure</code> would not really be much of a hassle.</p>



<a name="269069674"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/for%2C%20unexpected%20need%20for%20type%20ascription/near/269069674" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Siddhartha Gadgil <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/for.2C.20unexpected.20need.20for.20type.20ascription.html#269069674">(Jan 24 2022 at 08:00)</a>:</h4>
<p>Incidentally I normally use the alternative <code>return</code>.</p>



<a name="269083574"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/for%2C%20unexpected%20need%20for%20type%20ascription/near/269083574" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/for.2C.20unexpected.20need.20for.20type.20ascription.html#269083574">(Jan 24 2022 at 10:15)</a>:</h4>
<blockquote>
<p>think the auto pure is more trouble than it is worth.</p>
</blockquote>
<p>I kind of agree.  It's extremely neat when it works (and is unambiguous), but there's enough cases where the coercion doesn't trigger (numerals, arithmetical operations, anonymous constructors, structure instances, lambdas, etc.) that you need pure/return half of the time anyway, causing inconsistent coding style.</p>



<a name="269090997"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/for%2C%20unexpected%20need%20for%20type%20ascription/near/269090997" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Marcus Rossel <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/for.2C.20unexpected.20need.20for.20type.20ascription.html#269090997">(Jan 24 2022 at 11:21)</a>:</h4>
<p>And speaking from a beginner's perspective: learning monadic programming is more confusing with <code>&lt;-</code> working for non-monadic values.</p>



<a name="269092174"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/for%2C%20unexpected%20need%20for%20type%20ascription/near/269092174" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/for.2C.20unexpected.20need.20for.20type.20ascription.html#269092174">(Jan 24 2022 at 11:32)</a>:</h4>
<p>I have ambivalent feelings as well whenever I use it, even if the result looks nice. Not however that changing this would require more specialization of <code>do</code> syntax to the <code>Id</code> special case, as I think I outlined in the <code>Id.run</code> GH issue, because there you certainly do <em>not</em> want to worry about monadic lifting.</p>



<a name="269097203"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/for%2C%20unexpected%20need%20for%20type%20ascription/near/269097203" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/for.2C.20unexpected.20need.20for.20type.20ascription.html#269097203">(Jan 24 2022 at 12:22)</a>:</h4>
<p>Shouldn't that just work for <code>Id</code>?  (since <code>Id α</code> and <code>α</code> are defeq)</p>



<a name="269097907"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/for%2C%20unexpected%20need%20for%20type%20ascription/near/269097907" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/for.2C.20unexpected.20need.20for.20type.20ascription.html#269097907">(Jan 24 2022 at 12:29)</a>:</h4>
<p>you still have to worry about e.g. <code>HAdd Nat Nat (Id Nat)</code> not existing</p>



<a name="269098169"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/for%2C%20unexpected%20need%20for%20type%20ascription/near/269098169" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/for.2C.20unexpected.20need.20for.20type.20ascription.html#269098169">(Jan 24 2022 at 12:32)</a>:</h4>
<p>Yes, that's what I had in mind I think. But I believe the "pure lift" doesn't really help with that, so the issues might be more orthogonal than I thought.</p>



<a name="269098177"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/for%2C%20unexpected%20need%20for%20type%20ascription/near/269098177" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/for.2C.20unexpected.20need.20for.20type.20ascription.html#269098177">(Jan 24 2022 at 12:32)</a>:</h4>
<p>Regarding <code>pure</code> vs <code>return</code>: I like that lean 4 makes them not be synonyms any more, I always had trouble with keeping consistent style before in lean 3. Now I make a note to always use <code>pure</code> in both lean 3 and lean 4, unless I specifically want an early return</p>



<a name="269098281"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/for%2C%20unexpected%20need%20for%20type%20ascription/near/269098281" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/for.2C.20unexpected.20need.20for.20type.20ascription.html#269098281">(Jan 24 2022 at 12:33)</a>:</h4>
<p>That was my initial style as well, but Leo at least uses <code>return</code> extensively and it does save parentheses...</p>



<a name="269098292"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/for%2C%20unexpected%20need%20for%20type%20ascription/near/269098292" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/for.2C.20unexpected.20need.20for.20type.20ascription.html#269098292">(Jan 24 2022 at 12:33)</a>:</h4>
<p><span class="user-mention" data-user-id="110024">@Sebastian Ullrich</span> could you point me to the code that does the auto-pure? What is the scope of it?</p>



<a name="269098369"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/for%2C%20unexpected%20need%20for%20type%20ascription/near/269098369" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/for.2C.20unexpected.20need.20for.20type.20ascription.html#269098369">(Jan 24 2022 at 12:34)</a>:</h4>
<p>I will note that <code>pure $ ...</code>and <code>return ...</code> have the same number of characters :P</p>



<a name="269098502"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/for%2C%20unexpected%20need%20for%20type%20ascription/near/269098502" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/for.2C.20unexpected.20need.20for.20type.20ascription.html#269098502">(Jan 24 2022 at 12:36)</a>:</h4>
<p>Here's a thought: what if the last element of a do block was always a pure value? You would write <code>&lt;- foo</code> if you want to use a monadic value</p>



<a name="269098786"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/for%2C%20unexpected%20need%20for%20type%20ascription/near/269098786" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/for.2C.20unexpected.20need.20for.20type.20ascription.html#269098786">(Jan 24 2022 at 12:38)</a>:</h4>
<p>I believe we've discarded that option at some point. It sure looks inconvenient if all you want to do is run some <code>m Unit</code>s.</p>



<a name="269098799"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/for%2C%20unexpected%20need%20for%20type%20ascription/near/269098799" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/for.2C.20unexpected.20need.20for.20type.20ascription.html#269098799">(Jan 24 2022 at 12:38)</a>:</h4>
<p>if that was extended to internal ignores like <code>do _; ...</code>, then you would have the property that every monadic bind has a <code>&lt;-</code> which seems good for readability</p>



<a name="269098846"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/for%2C%20unexpected%20need%20for%20type%20ascription/near/269098846" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/for.2C.20unexpected.20need.20for.20type.20ascription.html#269098846">(Jan 24 2022 at 12:39)</a>:</h4>
<blockquote>
<p>what if the last element of a do block was always a pure value? You would write &lt;- foo if you want to use a monadic value</p>
</blockquote>
<p>I often write <code>do foo (← getBar) (← getBaz).b</code> etc.</p>



<a name="269098871"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/for%2C%20unexpected%20need%20for%20type%20ascription/near/269098871" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/for.2C.20unexpected.20need.20for.20type.20ascription.html#269098871">(Jan 24 2022 at 12:39)</a>:</h4>
<p>I very much like that style in fact</p>



<a name="269098953"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/for%2C%20unexpected%20need%20for%20type%20ascription/near/269098953" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/for.2C.20unexpected.20need.20for.20type.20ascription.html#269098953">(Jan 24 2022 at 12:40)</a>:</h4>
<p>but it doesn't seem much worse to have <code>do ← foo (← getBar) (← getBaz).b</code> when <code>foo</code> is also monadic</p>



<a name="269098980"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/for%2C%20unexpected%20need%20for%20type%20ascription/near/269098980" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/for.2C.20unexpected.20need.20for.20type.20ascription.html#269098980">(Jan 24 2022 at 12:40)</a>:</h4>
<p>and when it's not monadic you don't have this auto pure ambiguity</p>



<a name="269099018"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/for%2C%20unexpected%20need%20for%20type%20ascription/near/269099018" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/for.2C.20unexpected.20need.20for.20type.20ascription.html#269099018">(Jan 24 2022 at 12:40)</a>:</h4>
<p>(<code>foo</code> is often not monadic in those kinds of expressions)</p>



<a name="269099508"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/for%2C%20unexpected%20need%20for%20type%20ascription/near/269099508" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/for.2C.20unexpected.20need.20for.20type.20ascription.html#269099508">(Jan 24 2022 at 12:45)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110049">Mario Carneiro</span> <a href="#narrow/stream/270676-lean4/topic/for.2C.20unexpected.20need.20for.20type.20ascription/near/269098292">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="110024">Sebastian Ullrich</span> could you point me to the code that does the auto-pure? What is the scope of it?</p>
</blockquote>
<p>I'm actually not sure. It's not <code>do</code> though.</p>



<a name="269155494"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/for%2C%20unexpected%20need%20for%20type%20ascription/near/269155494" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kyle Miller <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/for.2C.20unexpected.20need.20for.20type.20ascription.html#269155494">(Jan 24 2022 at 19:14)</a>:</h4>
<p>Here's a fun gotcha:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">def</span> <span class="n">sumRange'''</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="n">Nat</span><span class="o">)</span> <span class="o">:</span> <span class="n">Nat</span> <span class="o">:=</span> <span class="n">Id.run</span> <span class="k">do</span>
  <span class="k">let</span> <span class="n">mut</span> <span class="n">acc</span> <span class="o">:=</span> <span class="mi">0</span>
  <span class="n">for</span> <span class="n">i</span> <span class="k">in</span> <span class="o">[</span><span class="mi">0</span><span class="o">:</span><span class="n">n</span><span class="o">]</span> <span class="k">do</span>
    <span class="n">acc</span> <span class="o">:=</span> <span class="n">acc</span> <span class="bp">+</span> <span class="n">i</span>
  <span class="n">acc</span>
</code></pre></div>
<p>Can you guess the error?</p>
<p>(This is not precisely an auto-pure problem, but it does suggest depending on it can lead to unanticipated errors!)</p>



<a name="269156445"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/for%2C%20unexpected%20need%20for%20type%20ascription/near/269156445" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/for.2C.20unexpected.20need.20for.20type.20ascription.html#269156445">(Jan 24 2022 at 19:20)</a>:</h4>
<p>The error is that you didn't explicit the type of <code>acc</code> so Lean thinks its of <code>Id Nat</code></p>



<a name="269156980"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/for%2C%20unexpected%20need%20for%20type%20ascription/near/269156980" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/for.2C.20unexpected.20need.20for.20type.20ascription.html#269156980">(Jan 24 2022 at 19:24)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">def</span> <span class="n">sumRange'''</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="n">Nat</span><span class="o">)</span> <span class="o">:</span> <span class="n">Nat</span> <span class="o">:=</span> <span class="n">Id.run</span> <span class="k">do</span>
  <span class="k">let</span> <span class="n">mut</span> <span class="n">acc</span> <span class="o">:=</span> <span class="o">(</span><span class="mi">0</span> <span class="o">:</span> <span class="n">Nat</span><span class="o">)</span>
  <span class="c1">-- let mut acc : Nat := 0 -- this works too</span>
  <span class="n">for</span> <span class="n">i</span> <span class="k">in</span> <span class="o">[</span><span class="mi">0</span><span class="o">:</span><span class="n">n</span><span class="o">]</span> <span class="k">do</span>
    <span class="n">acc</span> <span class="o">:=</span> <span class="n">acc</span> <span class="bp">+</span> <span class="n">i</span>
  <span class="n">acc</span>
</code></pre></div>



<a name="269157196"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/for%2C%20unexpected%20need%20for%20type%20ascription/near/269157196" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kyle Miller <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/for.2C.20unexpected.20need.20for.20type.20ascription.html#269157196">(Jan 24 2022 at 19:26)</a>:</h4>
<p>I meant to ask "where the error occurs" but, yeah, that's a root cause. Another fix is to use <code>pure</code>/<code>return</code> for <code>acc</code> at the end.</p>



<a name="269160001"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/for%2C%20unexpected%20need%20for%20type%20ascription/near/269160001" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/for.2C.20unexpected.20need.20for.20type.20ascription.html#269160001">(Jan 24 2022 at 19:29)</a>:</h4>
<p>It's not clear to me why <code>acc</code> is being inferred as <code>Id Nat</code> since the type of <code>sumRange'''</code> is explicitly <code>Nat → Nat</code></p>



<a name="269160234"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/for%2C%20unexpected%20need%20for%20type%20ascription/near/269160234" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kyle Miller <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/for.2C.20unexpected.20need.20for.20type.20ascription.html#269160234">(Jan 24 2022 at 19:30)</a>:</h4>
<p>The <code>Id.run</code> is making the do block be of type <code>Id Nat</code>, and the last line is <code>acc</code> by itself, so it infers it's an <code>Id Nat</code>.</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>