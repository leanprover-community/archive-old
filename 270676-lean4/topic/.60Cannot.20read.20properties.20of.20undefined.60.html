---
layout: archive
title: Zulip Chat Archive
permalink: /stream/270676-lean4/topic/.60Cannot.20read.20properties.20of.20undefined.60.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/index.html">lean4</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.60Cannot.20read.20properties.20of.20undefined.60.html">`Cannot read properties of undefined`</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="301983289"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%60Cannot%20read%20properties%20of%20undefined%60/near/301983289" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Juan Pablo Romero <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.60Cannot.20read.20properties.20of.20undefined.60.html#301983289">(Oct 02 2022 at 23:52)</a>:</h4>
<p>I noticed this error today in the infoview:</p>
<p><a href="/user_uploads/3121/jcdTPWOoJ15sZ-UoQwL_6uUi/image.png">image.png</a> </p>
<div class="message_inline_image"><a href="/user_uploads/3121/jcdTPWOoJ15sZ-UoQwL_6uUi/image.png" title="image.png"><img src="/user_uploads/3121/jcdTPWOoJ15sZ-UoQwL_6uUi/image.png"></a></div><p>Renaming the file makes it work, which makes me think something is cached on the VSCode side.</p>
<p>Has anyone seen this yet?</p>



<a name="302169808"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%60Cannot%20read%20properties%20of%20undefined%60/near/302169808" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.60Cannot.20read.20properties.20of.20undefined.60.html#302169808">(Oct 04 2022 at 00:01)</a>:</h4>
<p>I'm getting the same problem today.</p>



<a name="302170285"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%60Cannot%20read%20properties%20of%20undefined%60/near/302170285" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.60Cannot.20read.20properties.20of.20undefined.60.html#302170285">(Oct 04 2022 at 00:06)</a>:</h4>
<p>Curiously it is not for all files. Currently I am experiencing this for <code>Mathlib/Logic/Basic.lean</code>, but apparently nothing else.</p>



<a name="302170327"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%60Cannot%20read%20properties%20of%20undefined%60/near/302170327" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.60Cannot.20read.20properties.20of.20undefined.60.html#302170327">(Oct 04 2022 at 00:07)</a>:</h4>
<p>check that you have a clean lake build?</p>



<a name="302170535"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%60Cannot%20read%20properties%20of%20undefined%60/near/302170535" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.60Cannot.20read.20properties.20of.20undefined.60.html#302170535">(Oct 04 2022 at 00:09)</a>:</h4>
<p><code>lake clean</code> doesn't help</p>



<a name="302170551"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%60Cannot%20read%20properties%20of%20undefined%60/near/302170551" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.60Cannot.20read.20properties.20of.20undefined.60.html#302170551">(Oct 04 2022 at 00:09)</a>:</h4>
<p>I think this is a weird file name case issue.</p>



<a name="302170579"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%60Cannot%20read%20properties%20of%20undefined%60/near/302170579" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.60Cannot.20read.20properties.20of.20undefined.60.html#302170579">(Oct 04 2022 at 00:09)</a>:</h4>
<p>For <code>Mathlib/Logic/Basic.lean</code>, in the infoview it says it is looking at <code>basic.lean</code> (note the lowercase)</p>



<a name="302170599"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%60Cannot%20read%20properties%20of%20undefined%60/near/302170599" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.60Cannot.20read.20properties.20of.20undefined.60.html#302170599">(Oct 04 2022 at 00:09)</a>:</h4>
<p>whereas for all other files the infoview correctly reports the capitalised name.</p>



<a name="302170735"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%60Cannot%20read%20properties%20of%20undefined%60/near/302170735" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.60Cannot.20read.20properties.20of.20undefined.60.html#302170735">(Oct 04 2022 at 00:11)</a>:</h4>
<p>Possibly related: when I use F12 (jump to definition), VSCode opens that file, but shows the name of the file both in the tab label, and in the breadcrumb line, all in lower case.</p>



<a name="302170861"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%60Cannot%20read%20properties%20of%20undefined%60/near/302170861" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.60Cannot.20read.20properties.20of.20undefined.60.html#302170861">(Oct 04 2022 at 00:12)</a>:</h4>
<p>This is reproducible for me: I'm getting the <code>Cannot read properties of undefined</code> on all files that I open via F12 (and their filenames are displayed all in lowercase).</p>



<a name="302170914"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%60Cannot%20read%20properties%20of%20undefined%60/near/302170914" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.60Cannot.20read.20properties.20of.20undefined.60.html#302170914">(Oct 04 2022 at 00:13)</a>:</h4>
<p>(Given this may be a filename case issue, I should report this is on mac os. :-)</p>



<a name="302172309"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%60Cannot%20read%20properties%20of%20undefined%60/near/302172309" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.60Cannot.20read.20properties.20of.20undefined.60.html#302172309">(Oct 04 2022 at 00:27)</a>:</h4>
<p>I created <a href="https://github.com/leanprover/vscode-lean4/issues/254">https://github.com/leanprover/vscode-lean4/issues/254</a> to track this. :-(</p>



<a name="302333401"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%60Cannot%20read%20properties%20of%20undefined%60/near/302333401" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Chris Lovett <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.60Cannot.20read.20properties.20of.20undefined.60.html#302333401">(Oct 04 2022 at 19:37)</a>:</h4>
<p><span class="user-mention" data-user-id="395535">@Juan Pablo Romero</span> , what platform are you using (Linux, mac OS, Windows?) Can you also provide more details about which git repo and which file you are editing exactly when this happens? Thanks.</p>



<a name="302333767"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%60Cannot%20read%20properties%20of%20undefined%60/near/302333767" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Juan Pablo Romero <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.60Cannot.20read.20properties.20of.20undefined.60.html#302333767">(Oct 04 2022 at 19:39)</a>:</h4>
<p><span class="user-mention" data-user-id="434989">@Chris Lovett</span> I'm using macOS Monterey 12.6, on an M1 Chip</p>



<a name="302335329"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%60Cannot%20read%20properties%20of%20undefined%60/near/302335329" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Juan Pablo Romero <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.60Cannot.20read.20properties.20of.20undefined.60.html#302335329">(Oct 04 2022 at 19:49)</a>:</h4>
<p>The other day I had renamed a bunch of files; today I renamed back and things are working correctly, so I can't reproduce it any more</p>



<a name="302337283"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%60Cannot%20read%20properties%20of%20undefined%60/near/302337283" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Chris Lovett <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.60Cannot.20read.20properties.20of.20undefined.60.html#302337283">(Oct 04 2022 at 20:01)</a>:</h4>
<p>thanks and is this all your own lean project or are you also jumping back and forth to <code>~/lean4/src/Lean/Environment.lean</code> perhaps using F12 as Scott mentions in his repro is your case not involving goto definition at all ?</p>



<a name="302339573"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%60Cannot%20read%20properties%20of%20undefined%60/near/302339573" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Juan Pablo Romero <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.60Cannot.20read.20properties.20of.20undefined.60.html#302339573">(Oct 04 2022 at 20:17)</a>:</h4>
<p>Just on my own project;  (I happen to have a file named <code>Environment.lean</code>)</p>



<a name="302339644"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%60Cannot%20read%20properties%20of%20undefined%60/near/302339644" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Juan Pablo Romero <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.60Cannot.20read.20properties.20of.20undefined.60.html#302339644">(Oct 04 2022 at 20:17)</a>:</h4>
<p>but the issue happened in multiple files</p>



<a name="302384144"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%60Cannot%20read%20properties%20of%20undefined%60/near/302384144" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.60Cannot.20read.20properties.20of.20undefined.60.html#302384144">(Oct 05 2022 at 04:23)</a>:</h4>
<p>Can anyone follow my repro instructions? I'd like to know whether I'm crazy or not here. :-) For me this is a persistent problem, and I don't have a workaround to get the infoview working again for files this has affected.</p>



<a name="302397234"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%60Cannot%20read%20properties%20of%20undefined%60/near/302397234" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.60Cannot.20read.20properties.20of.20undefined.60.html#302397234">(Oct 05 2022 at 06:59)</a>:</h4>
<p>I have not encountered this issue, nor the filename lowercasing issue on linux</p>



<a name="302761360"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%60Cannot%20read%20properties%20of%20undefined%60/near/302761360" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.60Cannot.20read.20properties.20of.20undefined.60.html#302761360">(Oct 07 2022 at 00:02)</a>:</h4>
<p>This issue seems to go beyond vscode.  Leo just saw it in emacs on mac as well.</p>



<a name="302762551"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%60Cannot%20read%20properties%20of%20undefined%60/near/302762551" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.60Cannot.20read.20properties.20of.20undefined.60.html#302762551">(Oct 07 2022 at 00:15)</a>:</h4>
<p>what were the symptoms in emacs? The lowercasing, the error message text?</p>



<a name="302762602"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%60Cannot%20read%20properties%20of%20undefined%60/near/302762602" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.60Cannot.20read.20properties.20of.20undefined.60.html#302762602">(Oct 07 2022 at 00:16)</a>:</h4>
<p>The lowercasing, and then LSP didn't work.</p>



<a name="302762685"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%60Cannot%20read%20properties%20of%20undefined%60/near/302762685" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.60Cannot.20read.20properties.20of.20undefined.60.html#302762685">(Oct 07 2022 at 00:16)</a>:</h4>
<p>and I assume that's on linux?</p>



<a name="302763058"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%60Cannot%20read%20properties%20of%20undefined%60/near/302763058" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.60Cannot.20read.20properties.20of.20undefined.60.html#302763058">(Oct 07 2022 at 00:21)</a>:</h4>
<p>No, macos.</p>



<a name="302773390"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%60Cannot%20read%20properties%20of%20undefined%60/near/302773390" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Chris Lovett <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.60Cannot.20read.20properties.20of.20undefined.60.html#302773390">(Oct 07 2022 at 02:46)</a>:</h4>
<p>I also see the lower casing showing up in the VS code tabs, but I'm on windows, so it doesn't cause a problem.  But something is doing a lowercase conversion for example:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="sd">/-- Case-insensitive file system -/</span>
<span class="kd">def</span> <span class="n">isCaseInsensitive</span> <span class="o">:</span> <span class="n">Bool</span> <span class="o">:=</span> <span class="n">isWindows</span> <span class="bp">||</span> <span class="n">isOSX</span>

<span class="c1">-- TODO: normalize `a/`, `a//b`, etc.</span>
<span class="kd">def</span> <span class="n">normalize</span> <span class="o">(</span><span class="n">p</span> <span class="o">:</span> <span class="n">FilePath</span><span class="o">)</span> <span class="o">(</span><span class="n">normalizeCase</span> <span class="o">:=</span> <span class="n">isCaseInsensitive</span><span class="o">)</span> <span class="o">:</span> <span class="n">FilePath</span> <span class="o">:=</span>
  <span class="k">if</span> <span class="n">pathSeparators.length</span> <span class="bp">==</span> <span class="mi">1</span> <span class="bp">&amp;&amp;</span> <span class="bp">!</span><span class="n">normalizeCase</span> <span class="k">then</span> <span class="n">p</span>
  <span class="k">else</span> <span class="o">⟨</span><span class="n">p.toString.map</span> <span class="k">fun</span> <span class="n">c</span> <span class="bp">=&gt;</span>
    <span class="k">if</span> <span class="n">pathSeparators.contains</span> <span class="n">c</span> <span class="k">then</span> <span class="n">pathSeparator</span>
    <span class="k">else</span> <span class="k">if</span> <span class="n">normalizeCase</span> <span class="k">then</span> <span class="n">c.toLower</span>
    <span class="k">else</span> <span class="n">c</span><span class="o">⟩</span>

<span class="n">which</span> <span class="n">is</span> <span class="n">used</span> <span class="kd">by</span> <span class="n">moduleNameOfFileName</span> <span class="n">which</span> <span class="n">is</span> <span class="n">used</span> <span class="kd">by</span> <span class="n">findDefinitions.</span>
</code></pre></div>
<p>I'd really prefer this didn't exist and instead we did case insensitive comparisons instead of toLower conversions.</p>



<a name="302774426"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%60Cannot%20read%20properties%20of%20undefined%60/near/302774426" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.60Cannot.20read.20properties.20of.20undefined.60.html#302774426">(Oct 07 2022 at 03:05)</a>:</h4>
<p>and indeed, if <code>isOSX</code> is true then case is normalized, even though it's not always true that OSX filesystems are case insensitive IIUC</p>



<a name="302876292"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%60Cannot%20read%20properties%20of%20undefined%60/near/302876292" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.60Cannot.20read.20properties.20of.20undefined.60.html#302876292">(Oct 07 2022 at 15:20)</a>:</h4>
<p><a href="https://github.com/leanprover/lean4/pull/1701">https://github.com/leanprover/lean4/pull/1701</a></p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>