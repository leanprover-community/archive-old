---
layout: archive
title: Zulip Chat Archive
permalink: /stream/270676-lean4/topic/Visualization.20of.20typeclass.20inference.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/index.html">lean4</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Visualization.20of.20typeclass.20inference.html">Visualization of typeclass inference</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="266698004"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Visualization%20of%20typeclass%20inference/near/266698004" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Tomas Skrivan <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Visualization.20of.20typeclass.20inference.html#266698004">(Jan 03 2022 at 15:25)</a>:</h4>
<p>I would like to have some visual representation of typeclass inference. I find myself spending more and more time debugging order of class instances and it is getting really annoying. The main thing I want to see are large branches that do not lead to an answer and identify the instance that started it. This usually means a wrong order of instances. Also visually encode the order in which the graph is traversed.</p>
<p>I'm thinking about adding a tracing option <code>set_option trace.Meta.synthInstanceVis</code> that would generate some kind of string representation of a directed graph of goals/answers, consumer/generator nodes and then send it to some graph visualization tool, thinking about <a href="https://pyvis.readthedocs.io/en/latest/tutorial.html#example-visualizing-a-game-of-thrones-character-network">pyvis</a>.</p>
<p>Any tips on doing this? Or different approach?</p>
<p>Would it be possible to invoke the graph visualization automatically when I compile with <code>lake</code>? Maybe a good idea only for the <code>in</code> version of <code>set_option</code> as I do not want to accidentally spawn thousands of graph visualizations.</p>



<a name="266698475"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Visualization%20of%20typeclass%20inference/near/266698475" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Henrik Böving <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Visualization.20of.20typeclass.20inference.html#266698475">(Jan 03 2022 at 15:29)</a>:</h4>
<p>There is a (I believe graphviz based) visualization of solving a simple type class resolution goal in the "Tabled Typeclass Resolution" paper here: <a href="https://arxiv.org/abs/2001.04301">https://arxiv.org/abs/2001.04301</a> (page 11) but I don't know whether this was auto generated, if it was though it seems to me like your goal should already be solved?</p>



<a name="266700282"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Visualization%20of%20typeclass%20inference/near/266700282" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Tomas Skrivan <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Visualization.20of.20typeclass.20inference.html#266700282">(Jan 03 2022 at 15:44)</a>:</h4>
<p>Yes some thing like that would be great just different visual of it. I want to immediately see that the branch <code>A1</code> from <code>N2</code> node is a dead end and this should scale if I have hundreds or thousands of nodes. To skip the dead branch you should declare the parameter <code>C</code> before <code>B</code>. I'm doing lots of debugging that leads to just reordering of parameters in instance declarations.</p>



<a name="273265817"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Visualization%20of%20typeclass%20inference/near/273265817" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> James Gallicchio <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Visualization.20of.20typeclass.20inference.html#273265817">(Feb 25 2022 at 18:22)</a>:</h4>
<p>Wondering if this could be a widget a la <a href="https://www.edayers.com/thesis/widgets">https://www.edayers.com/thesis/widgets</a></p>
<p>A graph visualization directly in VS Code would be super useful for some collections stuff I'm working on...</p>



<a name="273266123"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Visualization%20of%20typeclass%20inference/near/273266123" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Henrik Böving <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Visualization.20of.20typeclass.20inference.html#273266123">(Feb 25 2022 at 18:25)</a>:</h4>
<p>Yes this widget type of stuff has been discussed about before but I don't know about it's current status, however people are very much aware of the possiblity</p>



<a name="273269381"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Visualization%20of%20typeclass%20inference/near/273269381" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Tomas Skrivan <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Visualization.20of.20typeclass.20inference.html#273269381">(Feb 25 2022 at 18:52)</a>:</h4>
<p>Currently, I'm again debugging a total tangle of messy typeclasses and it is driving me crazy. I think I will look into how to generate text representation of the graph and then we can try to figure out the best way to visualize it.</p>



<a name="273270608"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Visualization%20of%20typeclass%20inference/near/273270608" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Tomas Skrivan <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Visualization.20of.20typeclass.20inference.html#273270608">(Feb 25 2022 at 19:01)</a>:</h4>
<p>I see two approaches:</p>
<ol>
<li>Add a new tracing message like <code>trace.Meta.synthInstance.tcGraph</code> which would be just reformating of current messages so it is easier to parse and build the TC graph out of.</li>
<li>After TC is done, inspect the TC tables and spit out the nodes and edges into a file. Not sure if this approach gives you the information in which order is the graph traversed.</li>
</ol>
<p>Any thoughts? Another better approach?</p>



<a name="273270858"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Visualization%20of%20typeclass%20inference/near/273270858" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Tomas Skrivan <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Visualization.20of.20typeclass.20inference.html#273270858">(Feb 25 2022 at 19:02)</a>:</h4>
<p>The only way I see these two approaches is to modify Lean 4 code. Any idea how to avoid that?</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>