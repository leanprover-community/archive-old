---
layout: archive
title: Zulip Chat Archive
permalink: /stream/270676-lean4/topic/goal.20view.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/index.html">lean4</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/goal.20view.html">goal view</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="222309002"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/goal%20view/near/222309002" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/goal.20view.html#222309002">(Jan 11 2021 at 15:12)</a>:</h4>
<p>There's no goal view yet right?</p>



<a name="222310238"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/goal%20view/near/222310238" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/goal.20view.html#222310238">(Jan 11 2021 at 15:21)</a>:</h4>
<p>there is the problems panel on the bottom</p>



<a name="222310470"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/goal%20view/near/222310470" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/goal.20view.html#222310470">(Jan 11 2021 at 15:22)</a>:</h4>
<p>In emacs the "next error" window works.</p>



<a name="222311307"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/goal%20view/near/222311307" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/goal.20view.html#222311307">(Jan 11 2021 at 15:27)</a>:</h4>
<p>But there's no way to see the tactic state at positions where there wasn't an error?</p>



<a name="222311335"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/goal%20view/near/222311335" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/goal.20view.html#222311335">(Jan 11 2021 at 15:27)</a>:</h4>
<p>I guess "make an error happen" works</p>



<a name="222341952"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/goal%20view/near/222341952" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/goal.20view.html#222341952">(Jan 11 2021 at 19:02)</a>:</h4>
<p>(A good way to do this is to use the <code>done</code> tactic)</p>



<a name="222344392"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/goal%20view/near/222344392" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Julian Berman <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/goal.20view.html#222344392">(Jan 11 2021 at 19:21)</a>:</h4>
<p>I think the implementation of this relies on <code>hover</code> support (which was mentioned isn't there yet) -- I don't see the goal state either, just diagnostics</p>



<a name="232498890"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/goal%20view/near/232498890" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/goal.20view.html#232498890">(Mar 30 2021 at 21:12)</a>:</h4>
<p>In some ways, the comma was the most important token in a Lean 3 proof: everyone quickly learned to place their cursor on it whenever they wanted to see the goal resulting from execution of a tactic. Now you might know that Lean 4 does away with the comma, preferring tactic separation by whitespace instead. Which begs the question: which goal state should we display where?<br>
The simple solution is to still show the new state resulting from a tactic only strictly after it - even if there is no comma, you can place your cursor at the end of the line (except when you're in vim normal mode, oh well). However, I wanted to take the disappearance of the comma as an opportunity to advocate for showing the resulting state when located <em>anywhere</em> on the tactic instead: when I'm working <em>on</em> a tactic, e.g. refining the set of lemmas passed to <code>simp</code>, I really want to see the resulting state without having to move my cursor. All the same information as before is still accessible, it's just shifted - in the case of the initial state of a tactic block, it should be shifted onto the initial token such as <code>by</code>.</p>
<p>To illustrate the two approaches, using <code>|</code> to show where the tactic state changes:<br>
The adapted Lean 3 approach:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">by</span>
  <span class="n">intro</span> <span class="n">h</span><span class="bp">|</span>
  <span class="n">apply</span> <span class="n">h</span><span class="bp">|</span>
</code></pre></div>
<p>My proposal:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">by</span>
 <span class="bp">|</span><span class="n">intro</span> <span class="n">h</span>
 <span class="bp">|</span><span class="n">apply</span> <span class="n">h</span>
</code></pre></div>
<p>There has been some pushback against this idea :), so I would like to hear what behavior the community feels more intuitive and helpful (and not just familiar from Lean 3), but also in particular if you seen any specific UX issues in either of the approaches that the other one solves.</p>



<a name="232499325"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/goal%20view/near/232499325" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yakov Pechersky <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/goal.20view.html#232499325">(Mar 30 2021 at 21:14)</a>:</h4>
<p>What happens with <code>rw [lemma1, lemma2, lemma3]</code> blocks? Currently, one can scrub through the commas to see the effect of each cumulative rewrite.</p>



<a name="232499482"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/goal%20view/near/232499482" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/goal.20view.html#232499482">(Mar 30 2021 at 21:15)</a>:</h4>
<p>The first one certainly feels more intuitive. The tactic changes the proof state, hence I expect to see the new proof state <em>after</em> the tactic.</p>



<a name="232499638"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/goal%20view/near/232499638" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yakov Pechersky <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/goal.20view.html#232499638">(Mar 30 2021 at 21:16)</a>:</h4>
<p>Semantically -- cursor on top of the <code>rw</code> shows the state after 0, 1, or all of the rewrites?</p>



<a name="232499926"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/goal%20view/near/232499926" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/goal.20view.html#232499926">(Mar 30 2021 at 21:19)</a>:</h4>
<p>Zulip first duplicated, then deleted my message, oops. But <code>rw</code> would be shifted the same way - <code>rw [|lemma1, |lemma2, |lemma3]</code>.</p>



<a name="232500140"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/goal%20view/near/232500140" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/goal.20view.html#232500140">(Mar 30 2021 at 21:20)</a>:</h4>
<p>Another solution could be to more fundamentally change how the UI works - users could select whether to show the state before or after execution, or even a fancy diff of them. But I think there still should be a sensible default choice presented first.</p>



<a name="232500211"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/goal%20view/near/232500211" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/goal.20view.html#232500211">(Mar 30 2021 at 21:21)</a>:</h4>
<p>What about changing after the first character? i.e <code>i|ntro h</code> in your notation</p>



<a name="232500371"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/goal%20view/near/232500371" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/goal.20view.html#232500371">(Mar 30 2021 at 21:22)</a>:</h4>
<p>I think if you have the cursor at the beginning of the line, then this should be "before the tactic", but if you are any point after that then you are after the tactic</p>



<a name="232500449"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/goal%20view/near/232500449" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/goal.20view.html#232500449">(Mar 30 2021 at 21:23)</a>:</h4>
<p>This is useful when you are in the middle of writing the tactic application; in lean 3 you have to make your edit and then move the cursor to the end to see if the change had the desired effect (for example, when adding lemmas to a <code>simp only</code> call)</p>



<a name="232500593"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/goal%20view/near/232500593" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Daniel Fabian <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/goal.20view.html#232500593">(Mar 30 2021 at 21:24)</a>:</h4>
<p>for completeness, I'd like to also offer this option: <code>intro |h</code> and <code>simp [A|, B|, C|]</code>. This fixes the vim normal mode issue to a certain point.</p>



<a name="232500632"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/goal%20view/near/232500632" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/goal.20view.html#232500632">(Mar 30 2021 at 21:25)</a>:</h4>
<p><span class="user-mention" data-user-id="110049">@Mario Carneiro</span>  Interesting. At first it looks wrong to just hack apart the word "intro" like that, but as you said, being <em>on</em> the first character really means being <em>in front of</em> the tactic with the usual cursor semantics.</p>



<a name="232500686"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/goal%20view/near/232500686" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/goal.20view.html#232500686">(Mar 30 2021 at 21:25)</a>:</h4>
<p>The fact that it looks like I'm hacking apart the word is only a side effect of the semantics you applied to the <code>|</code>. I'm switching <code>&lt;</code> and <code>&lt;=</code></p>



<a name="232500833"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/goal%20view/near/232500833" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Julian Berman <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/goal.20view.html#232500833">(Mar 30 2021 at 21:26)</a>:</h4>
<p>(For the vim normal mode one, which I guess I care about... we're using | but the cursor is generally always <em>at</em> a particular character, so I guess to me are we saying the position after the last <code>h</code> then? i.e. the newline character itself? Not on the <code>h</code>?) Also maybe relatedly I'd love a way to iterate over the points at which the tactic state changes, but maybe that's a separate thing.</p>



<a name="232500834"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/goal%20view/near/232500834" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/goal.20view.html#232500834">(Mar 30 2021 at 21:26)</a>:</h4>
<p>That is, if the tactic has span <code>start..end</code> then you see the before if you are at <code>cursor &lt;= start</code></p>



<a name="232501014"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/goal%20view/near/232501014" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/goal.20view.html#232501014">(Mar 30 2021 at 21:28)</a>:</h4>
<p>For <code>intro |h</code> and things: The ability to support intra tactic states is something that is specific to the tactic itself. Any tactic could implement this, but in lean 3 only <code>rw</code> does</p>



<a name="232501245"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/goal%20view/near/232501245" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/goal.20view.html#232501245">(Mar 30 2021 at 21:30)</a>:</h4>
<p>You have to write the tactic in a certain way, such that intermediate states both (1) actually correspond to a moment in the middle of execution and (2) can be mapped to spans in the expression provided by the user. For most tactics this just doesn't make sense - for example in <code>simp [A, B, C]</code>, there is no moment when you have just <code>A</code> and <code>B</code> applied, because they can be applied in any order and as many times as necessary</p>



<a name="232501270"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/goal%20view/near/232501270" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/goal.20view.html#232501270">(Mar 30 2021 at 21:30)</a>:</h4>
<p>Another issue/question is duplication with error messages - when I'm working on a tactic, even if it displays the "pre state", I still usually see the "post state" in the "unsolved goals" message below - except when the pre state is so big that I would have to fold it first. Not sure if there is any fundamentally nicer way to present all this information.</p>



<a name="232501602"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/goal%20view/near/232501602" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/goal.20view.html#232501602">(Mar 30 2021 at 21:33)</a>:</h4>
<p>Another issue with error messages is that It is often hard to find the relevant information. For example, here's a random error message from a proof I'm working on now:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">Tactic</span> <span class="n">state</span><span class="o">:</span>
<span class="mi">4</span> <span class="n">goals</span>
<span class="n">BD</span> <span class="o">:</span> <span class="n">data</span><span class="o">,</span>
<span class="n">c'</span> <span class="o">:</span> <span class="n">ℕ</span> <span class="bp">→</span> <span class="n">ℝ</span><span class="bp">≥</span><span class="mi">0</span><span class="o">,</span>
<span class="n">_inst_1</span> <span class="o">:</span> <span class="n">BD.suitable</span> <span class="n">c'</span><span class="o">,</span>
<span class="n">r</span> <span class="o">:</span> <span class="n">ℝ</span><span class="bp">≥</span><span class="mi">0</span><span class="o">,</span>
<span class="n">V</span> <span class="o">:</span> <span class="n">NormedGroup</span><span class="o">,</span>
<span class="n">_inst_4</span> <span class="o">:</span> <span class="n">normed_with_aut</span> <span class="bp">↑</span><span class="n">r</span> <span class="n">V</span><span class="o">,</span>
<span class="n">_inst_5</span> <span class="o">:</span> <span class="n">fact</span> <span class="o">(</span><span class="mi">0</span> <span class="bp">&lt;</span> <span class="n">r</span><span class="o">),</span>
<span class="n">r'</span> <span class="o">:</span> <span class="n">ℝ</span><span class="bp">≥</span><span class="mi">0</span><span class="o">,</span>
<span class="n">_inst_6</span> <span class="o">:</span> <span class="n">fact</span> <span class="o">(</span><span class="mi">0</span> <span class="bp">&lt;</span> <span class="n">r'</span><span class="o">),</span>
<span class="n">_inst_7</span> <span class="o">:</span> <span class="n">fact</span> <span class="o">(</span><span class="n">r'</span> <span class="bp">≤</span> <span class="mi">1</span><span class="o">),</span>
<span class="n">M</span> <span class="o">:</span> <span class="n">ProFiltPseuNormGrpWithTinv</span> <span class="n">r'</span><span class="o">,</span>
<span class="n">c</span> <span class="n">N</span> <span class="o">:</span> <span class="n">ℝ</span><span class="bp">≥</span><span class="mi">0</span>
<span class="bp">⊢</span> <span class="n">bar</span> <span class="n">BD</span> <span class="n">r</span> <span class="n">V</span> <span class="n">M</span> <span class="o">(</span><span class="bp">λ</span> <span class="o">(</span><span class="n">i</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">),</span> <span class="n">r'</span> <span class="bp">*</span> <span class="o">(</span><span class="n">c</span> <span class="bp">*</span> <span class="o">(</span><span class="n">c'</span> <span class="n">i</span> <span class="bp">*</span> <span class="n">N</span><span class="bp">⁻¹</span><span class="o">)))</span> <span class="o">(</span><span class="bp">λ</span> <span class="o">(</span><span class="n">i</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">),</span> <span class="n">c</span> <span class="bp">*</span> <span class="o">(</span><span class="n">c'</span> <span class="n">i</span> <span class="bp">*</span> <span class="n">N</span><span class="bp">⁻¹</span><span class="o">))</span> <span class="bp">?</span><span class="n">m_1</span> <span class="bp">?</span><span class="n">m_2</span> <span class="n">_</span> <span class="n">_</span> <span class="bp">=</span> <span class="bp">?</span><span class="n">m_3</span>

<span class="n">BD</span> <span class="o">:</span> <span class="n">data</span><span class="o">,</span>
<span class="n">c'</span> <span class="o">:</span> <span class="n">ℕ</span> <span class="bp">→</span> <span class="n">ℝ</span><span class="bp">≥</span><span class="mi">0</span><span class="o">,</span>
<span class="n">_inst_1</span> <span class="o">:</span> <span class="n">BD.suitable</span> <span class="n">c'</span><span class="o">,</span>
<span class="n">r</span> <span class="o">:</span> <span class="n">ℝ</span><span class="bp">≥</span><span class="mi">0</span><span class="o">,</span>
<span class="n">V</span> <span class="o">:</span> <span class="n">NormedGroup</span><span class="o">,</span>
<span class="n">_inst_4</span> <span class="o">:</span> <span class="n">normed_with_aut</span> <span class="bp">↑</span><span class="n">r</span> <span class="n">V</span><span class="o">,</span>
<span class="n">_inst_5</span> <span class="o">:</span> <span class="n">fact</span> <span class="o">(</span><span class="mi">0</span> <span class="bp">&lt;</span> <span class="n">r</span><span class="o">),</span>
<span class="n">r'</span> <span class="o">:</span> <span class="n">ℝ</span><span class="bp">≥</span><span class="mi">0</span><span class="o">,</span>
<span class="n">_inst_6</span> <span class="o">:</span> <span class="n">fact</span> <span class="o">(</span><span class="mi">0</span> <span class="bp">&lt;</span> <span class="n">r'</span><span class="o">),</span>
<span class="n">_inst_7</span> <span class="o">:</span> <span class="n">fact</span> <span class="o">(</span><span class="n">r'</span> <span class="bp">≤</span> <span class="mi">1</span><span class="o">),</span>
<span class="n">M</span> <span class="o">:</span> <span class="n">ProFiltPseuNormGrpWithTinv</span> <span class="n">r'</span><span class="o">,</span>
<span class="n">c</span> <span class="n">N</span> <span class="o">:</span> <span class="n">ℝ</span><span class="bp">≥</span><span class="mi">0</span>
<span class="bp">⊢</span> <span class="bp">∀</span> <span class="o">(</span><span class="n">i</span> <span class="n">j</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">),</span> <span class="n">universal_map.suitable</span> <span class="o">(</span><span class="n">r'</span> <span class="bp">*</span> <span class="o">(</span><span class="n">c</span> <span class="bp">*</span> <span class="o">(</span><span class="n">c'</span> <span class="n">j</span> <span class="bp">*</span> <span class="n">N</span><span class="bp">⁻¹</span><span class="o">)))</span> <span class="o">(</span><span class="n">r'</span> <span class="bp">*</span> <span class="o">(</span><span class="n">c</span> <span class="bp">*</span> <span class="o">(</span><span class="n">c'</span> <span class="n">i</span> <span class="bp">*</span> <span class="n">N</span><span class="bp">⁻¹</span><span class="o">)))</span> <span class="o">(</span><span class="n">BD.d</span> <span class="n">j</span> <span class="n">i</span><span class="o">)</span>

<span class="n">BD</span> <span class="o">:</span> <span class="n">data</span><span class="o">,</span>
<span class="n">c'</span> <span class="o">:</span> <span class="n">ℕ</span> <span class="bp">→</span> <span class="n">ℝ</span><span class="bp">≥</span><span class="mi">0</span><span class="o">,</span>
<span class="n">_inst_1</span> <span class="o">:</span> <span class="n">BD.suitable</span> <span class="n">c'</span><span class="o">,</span>
<span class="n">r</span> <span class="o">:</span> <span class="n">ℝ</span><span class="bp">≥</span><span class="mi">0</span><span class="o">,</span>
<span class="n">V</span> <span class="o">:</span> <span class="n">NormedGroup</span><span class="o">,</span>
<span class="n">_inst_4</span> <span class="o">:</span> <span class="n">normed_with_aut</span> <span class="bp">↑</span><span class="n">r</span> <span class="n">V</span><span class="o">,</span>
<span class="n">_inst_5</span> <span class="o">:</span> <span class="n">fact</span> <span class="o">(</span><span class="mi">0</span> <span class="bp">&lt;</span> <span class="n">r</span><span class="o">),</span>
<span class="n">r'</span> <span class="o">:</span> <span class="n">ℝ</span><span class="bp">≥</span><span class="mi">0</span><span class="o">,</span>
<span class="n">_inst_6</span> <span class="o">:</span> <span class="n">fact</span> <span class="o">(</span><span class="mi">0</span> <span class="bp">&lt;</span> <span class="n">r'</span><span class="o">),</span>
<span class="n">_inst_7</span> <span class="o">:</span> <span class="n">fact</span> <span class="o">(</span><span class="n">r'</span> <span class="bp">≤</span> <span class="mi">1</span><span class="o">),</span>
<span class="n">M</span> <span class="o">:</span> <span class="n">ProFiltPseuNormGrpWithTinv</span> <span class="n">r'</span><span class="o">,</span>
<span class="n">c</span> <span class="n">N</span> <span class="o">:</span> <span class="n">ℝ</span><span class="bp">≥</span><span class="mi">0</span>
<span class="bp">⊢</span> <span class="bp">∀</span> <span class="o">(</span><span class="n">i</span> <span class="n">j</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">),</span> <span class="n">universal_map.suitable</span> <span class="o">(</span><span class="n">c</span> <span class="bp">*</span> <span class="o">(</span><span class="n">c'</span> <span class="n">j</span> <span class="bp">*</span> <span class="n">N</span><span class="bp">⁻¹</span><span class="o">))</span> <span class="o">(</span><span class="n">c</span> <span class="bp">*</span> <span class="o">(</span><span class="n">c'</span> <span class="n">i</span> <span class="bp">*</span> <span class="n">N</span><span class="bp">⁻¹</span><span class="o">))</span> <span class="o">(</span><span class="n">BD.d</span> <span class="n">j</span> <span class="n">i</span><span class="o">)</span>

<span class="n">BD</span> <span class="o">:</span> <span class="n">data</span><span class="o">,</span>
<span class="n">c'</span> <span class="o">:</span> <span class="n">ℕ</span> <span class="bp">→</span> <span class="n">ℝ</span><span class="bp">≥</span><span class="mi">0</span><span class="o">,</span>
<span class="n">_inst_1</span> <span class="o">:</span> <span class="n">BD.suitable</span> <span class="n">c'</span><span class="o">,</span>
<span class="n">r</span> <span class="o">:</span> <span class="n">ℝ</span><span class="bp">≥</span><span class="mi">0</span><span class="o">,</span>
<span class="n">V</span> <span class="o">:</span> <span class="n">NormedGroup</span><span class="o">,</span>
<span class="n">_inst_4</span> <span class="o">:</span> <span class="n">normed_with_aut</span> <span class="bp">↑</span><span class="n">r</span> <span class="n">V</span><span class="o">,</span>
<span class="n">_inst_5</span> <span class="o">:</span> <span class="n">fact</span> <span class="o">(</span><span class="mi">0</span> <span class="bp">&lt;</span> <span class="n">r</span><span class="o">),</span>
<span class="n">r'</span> <span class="o">:</span> <span class="n">ℝ</span><span class="bp">≥</span><span class="mi">0</span><span class="o">,</span>
<span class="n">_inst_6</span> <span class="o">:</span> <span class="n">fact</span> <span class="o">(</span><span class="mi">0</span> <span class="bp">&lt;</span> <span class="n">r'</span><span class="o">),</span>
<span class="n">_inst_7</span> <span class="o">:</span> <span class="n">fact</span> <span class="o">(</span><span class="n">r'</span> <span class="bp">≤</span> <span class="mi">1</span><span class="o">),</span>
<span class="n">M</span> <span class="o">:</span> <span class="n">ProFiltPseuNormGrpWithTinv</span> <span class="n">r'</span><span class="o">,</span>
<span class="n">c</span> <span class="n">N</span> <span class="o">:</span> <span class="n">ℝ</span><span class="bp">≥</span><span class="mi">0</span>
<span class="bp">⊢</span> <span class="bp">?</span><span class="n">m_1</span> <span class="bp">=</span>
    <span class="n">cochain_complex.mk</span>
      <span class="o">(</span><span class="bp">λ</span> <span class="o">(</span><span class="n">i</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">),</span>
         <span class="o">(</span><span class="n">BD.complex₂_X</span> <span class="n">r</span> <span class="n">V</span> <span class="n">r'</span> <span class="o">(</span><span class="bp">λ</span> <span class="o">(</span><span class="n">i</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">),</span> <span class="n">c</span> <span class="bp">*</span> <span class="n">c'</span> <span class="n">i</span><span class="o">)</span> <span class="o">(</span><span class="bp">λ</span> <span class="o">(</span><span class="n">i</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">),</span> <span class="n">r'</span> <span class="bp">*</span> <span class="o">(</span><span class="n">c</span> <span class="bp">*</span> <span class="n">c'</span> <span class="n">i</span><span class="o">))</span> <span class="n">i</span><span class="o">)</span><span class="bp">.</span><span class="n">obj</span>
           <span class="o">(</span><span class="n">opposite.op</span> <span class="o">(</span><span class="n">of</span> <span class="n">r'</span> <span class="o">(</span><span class="n">rescale</span> <span class="n">N</span> <span class="bp">↥</span><span class="n">M</span><span class="o">))))</span>
      <span class="o">(</span><span class="bp">λ</span> <span class="o">(</span><span class="n">i</span> <span class="n">j</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">),</span>
         <span class="o">(</span><span class="n">universal_map.eval_CLCFPTinv₂</span> <span class="n">r</span> <span class="n">V</span> <span class="n">r'</span> <span class="o">(</span><span class="n">c</span> <span class="bp">*</span> <span class="n">c'</span> <span class="n">i</span><span class="o">)</span> <span class="o">(</span><span class="n">r'</span> <span class="bp">*</span> <span class="o">(</span><span class="n">c</span> <span class="bp">*</span> <span class="n">c'</span> <span class="n">i</span><span class="o">))</span> <span class="o">(</span><span class="n">c</span> <span class="bp">*</span> <span class="n">c'</span> <span class="n">j</span><span class="o">)</span> <span class="o">(</span><span class="n">r'</span> <span class="bp">*</span> <span class="o">(</span><span class="n">c</span> <span class="bp">*</span> <span class="n">c'</span> <span class="n">j</span><span class="o">))</span>
            <span class="o">(</span><span class="n">BD.d</span> <span class="n">j</span> <span class="n">i</span><span class="o">))</span><span class="bp">.</span><span class="n">app</span>
           <span class="o">(</span><span class="n">opposite.op</span> <span class="o">(</span><span class="n">of</span> <span class="n">r'</span> <span class="o">(</span><span class="n">rescale</span> <span class="n">N</span> <span class="bp">↥</span><span class="n">M</span><span class="o">))))</span>
      <span class="n">_</span>
      <span class="n">_</span>

<span class="n">homotopy.lean</span><span class="o">:</span><span class="mi">165</span><span class="o">:</span><span class="mi">2</span>
<span class="n">simplify</span> <span class="n">tactic</span> <span class="n">failed</span> <span class="n">to</span> <span class="n">simplify</span>
<span class="n">state</span><span class="o">:</span>
<span class="mi">4</span> <span class="n">goals</span>
<span class="n">BD</span> <span class="o">:</span> <span class="n">data</span><span class="o">,</span>
<span class="n">c'</span> <span class="o">:</span> <span class="n">ℕ</span> <span class="bp">→</span> <span class="n">ℝ</span><span class="bp">≥</span><span class="mi">0</span><span class="o">,</span>
<span class="n">_inst_1</span> <span class="o">:</span> <span class="n">BD.suitable</span> <span class="n">c'</span><span class="o">,</span>
<span class="n">r</span> <span class="o">:</span> <span class="n">ℝ</span><span class="bp">≥</span><span class="mi">0</span><span class="o">,</span>
<span class="n">V</span> <span class="o">:</span> <span class="n">NormedGroup</span><span class="o">,</span>
<span class="n">_inst_4</span> <span class="o">:</span> <span class="n">normed_with_aut</span> <span class="bp">↑</span><span class="n">r</span> <span class="n">V</span><span class="o">,</span>
<span class="n">_inst_5</span> <span class="o">:</span> <span class="n">fact</span> <span class="o">(</span><span class="mi">0</span> <span class="bp">&lt;</span> <span class="n">r</span><span class="o">),</span>
<span class="n">r'</span> <span class="o">:</span> <span class="n">ℝ</span><span class="bp">≥</span><span class="mi">0</span><span class="o">,</span>
<span class="n">_inst_6</span> <span class="o">:</span> <span class="n">fact</span> <span class="o">(</span><span class="mi">0</span> <span class="bp">&lt;</span> <span class="n">r'</span><span class="o">),</span>
<span class="n">_inst_7</span> <span class="o">:</span> <span class="n">fact</span> <span class="o">(</span><span class="n">r'</span> <span class="bp">≤</span> <span class="mi">1</span><span class="o">),</span>
<span class="n">M</span> <span class="o">:</span> <span class="n">ProFiltPseuNormGrpWithTinv</span> <span class="n">r'</span><span class="o">,</span>
<span class="n">c</span> <span class="n">N</span> <span class="o">:</span> <span class="n">ℝ</span><span class="bp">≥</span><span class="mi">0</span>
<span class="bp">⊢</span> <span class="n">bar</span> <span class="n">BD</span> <span class="n">r</span> <span class="n">V</span> <span class="n">M</span> <span class="o">(</span><span class="bp">λ</span> <span class="o">(</span><span class="n">i</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">),</span> <span class="n">r'</span> <span class="bp">*</span> <span class="o">(</span><span class="n">c</span> <span class="bp">*</span> <span class="o">(</span><span class="n">c'</span> <span class="n">i</span> <span class="bp">*</span> <span class="n">N</span><span class="bp">⁻¹</span><span class="o">)))</span> <span class="o">(</span><span class="bp">λ</span> <span class="o">(</span><span class="n">i</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">),</span> <span class="n">c</span> <span class="bp">*</span> <span class="o">(</span><span class="n">c'</span> <span class="n">i</span> <span class="bp">*</span> <span class="n">N</span><span class="bp">⁻¹</span><span class="o">))</span> <span class="bp">?</span><span class="n">m_1</span> <span class="bp">?</span><span class="n">m_2</span> <span class="n">_</span> <span class="n">_</span> <span class="bp">=</span> <span class="bp">?</span><span class="n">m_3</span>

<span class="n">BD</span> <span class="o">:</span> <span class="n">data</span><span class="o">,</span>
<span class="n">c'</span> <span class="o">:</span> <span class="n">ℕ</span> <span class="bp">→</span> <span class="n">ℝ</span><span class="bp">≥</span><span class="mi">0</span><span class="o">,</span>
<span class="n">_inst_1</span> <span class="o">:</span> <span class="n">BD.suitable</span> <span class="n">c'</span><span class="o">,</span>
<span class="n">r</span> <span class="o">:</span> <span class="n">ℝ</span><span class="bp">≥</span><span class="mi">0</span><span class="o">,</span>
<span class="n">V</span> <span class="o">:</span> <span class="n">NormedGroup</span><span class="o">,</span>
<span class="n">_inst_4</span> <span class="o">:</span> <span class="n">normed_with_aut</span> <span class="bp">↑</span><span class="n">r</span> <span class="n">V</span><span class="o">,</span>
<span class="n">_inst_5</span> <span class="o">:</span> <span class="n">fact</span> <span class="o">(</span><span class="mi">0</span> <span class="bp">&lt;</span> <span class="n">r</span><span class="o">),</span>
<span class="n">r'</span> <span class="o">:</span> <span class="n">ℝ</span><span class="bp">≥</span><span class="mi">0</span><span class="o">,</span>
<span class="n">_inst_6</span> <span class="o">:</span> <span class="n">fact</span> <span class="o">(</span><span class="mi">0</span> <span class="bp">&lt;</span> <span class="n">r'</span><span class="o">),</span>
<span class="n">_inst_7</span> <span class="o">:</span> <span class="n">fact</span> <span class="o">(</span><span class="n">r'</span> <span class="bp">≤</span> <span class="mi">1</span><span class="o">),</span>
<span class="n">M</span> <span class="o">:</span> <span class="n">ProFiltPseuNormGrpWithTinv</span> <span class="n">r'</span><span class="o">,</span>
<span class="n">c</span> <span class="n">N</span> <span class="o">:</span> <span class="n">ℝ</span><span class="bp">≥</span><span class="mi">0</span>
<span class="bp">⊢</span> <span class="bp">∀</span> <span class="o">(</span><span class="n">i</span> <span class="n">j</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">),</span> <span class="n">universal_map.suitable</span> <span class="o">(</span><span class="n">r'</span> <span class="bp">*</span> <span class="o">(</span><span class="n">c</span> <span class="bp">*</span> <span class="o">(</span><span class="n">c'</span> <span class="n">j</span> <span class="bp">*</span> <span class="n">N</span><span class="bp">⁻¹</span><span class="o">)))</span> <span class="o">(</span><span class="n">r'</span> <span class="bp">*</span> <span class="o">(</span><span class="n">c</span> <span class="bp">*</span> <span class="o">(</span><span class="n">c'</span> <span class="n">i</span> <span class="bp">*</span> <span class="n">N</span><span class="bp">⁻¹</span><span class="o">)))</span> <span class="o">(</span><span class="n">BD.d</span> <span class="n">j</span> <span class="n">i</span><span class="o">)</span>

<span class="n">BD</span> <span class="o">:</span> <span class="n">data</span><span class="o">,</span>
<span class="n">c'</span> <span class="o">:</span> <span class="n">ℕ</span> <span class="bp">→</span> <span class="n">ℝ</span><span class="bp">≥</span><span class="mi">0</span><span class="o">,</span>
<span class="n">_inst_1</span> <span class="o">:</span> <span class="n">BD.suitable</span> <span class="n">c'</span><span class="o">,</span>
<span class="n">r</span> <span class="o">:</span> <span class="n">ℝ</span><span class="bp">≥</span><span class="mi">0</span><span class="o">,</span>
<span class="n">V</span> <span class="o">:</span> <span class="n">NormedGroup</span><span class="o">,</span>
<span class="n">_inst_4</span> <span class="o">:</span> <span class="n">normed_with_aut</span> <span class="bp">↑</span><span class="n">r</span> <span class="n">V</span><span class="o">,</span>
<span class="n">_inst_5</span> <span class="o">:</span> <span class="n">fact</span> <span class="o">(</span><span class="mi">0</span> <span class="bp">&lt;</span> <span class="n">r</span><span class="o">),</span>
<span class="n">r'</span> <span class="o">:</span> <span class="n">ℝ</span><span class="bp">≥</span><span class="mi">0</span><span class="o">,</span>
<span class="n">_inst_6</span> <span class="o">:</span> <span class="n">fact</span> <span class="o">(</span><span class="mi">0</span> <span class="bp">&lt;</span> <span class="n">r'</span><span class="o">),</span>
<span class="n">_inst_7</span> <span class="o">:</span> <span class="n">fact</span> <span class="o">(</span><span class="n">r'</span> <span class="bp">≤</span> <span class="mi">1</span><span class="o">),</span>
<span class="n">M</span> <span class="o">:</span> <span class="n">ProFiltPseuNormGrpWithTinv</span> <span class="n">r'</span><span class="o">,</span>
<span class="n">c</span> <span class="n">N</span> <span class="o">:</span> <span class="n">ℝ</span><span class="bp">≥</span><span class="mi">0</span>
<span class="bp">⊢</span> <span class="bp">∀</span> <span class="o">(</span><span class="n">i</span> <span class="n">j</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">),</span> <span class="n">universal_map.suitable</span> <span class="o">(</span><span class="n">c</span> <span class="bp">*</span> <span class="o">(</span><span class="n">c'</span> <span class="n">j</span> <span class="bp">*</span> <span class="n">N</span><span class="bp">⁻¹</span><span class="o">))</span> <span class="o">(</span><span class="n">c</span> <span class="bp">*</span> <span class="o">(</span><span class="n">c'</span> <span class="n">i</span> <span class="bp">*</span> <span class="n">N</span><span class="bp">⁻¹</span><span class="o">))</span> <span class="o">(</span><span class="n">BD.d</span> <span class="n">j</span> <span class="n">i</span><span class="o">)</span>

<span class="n">BD</span> <span class="o">:</span> <span class="n">data</span><span class="o">,</span>
<span class="n">c'</span> <span class="o">:</span> <span class="n">ℕ</span> <span class="bp">→</span> <span class="n">ℝ</span><span class="bp">≥</span><span class="mi">0</span><span class="o">,</span>
<span class="n">_inst_1</span> <span class="o">:</span> <span class="n">BD.suitable</span> <span class="n">c'</span><span class="o">,</span>
<span class="n">r</span> <span class="o">:</span> <span class="n">ℝ</span><span class="bp">≥</span><span class="mi">0</span><span class="o">,</span>
<span class="n">V</span> <span class="o">:</span> <span class="n">NormedGroup</span><span class="o">,</span>
<span class="n">_inst_4</span> <span class="o">:</span> <span class="n">normed_with_aut</span> <span class="bp">↑</span><span class="n">r</span> <span class="n">V</span><span class="o">,</span>
<span class="n">_inst_5</span> <span class="o">:</span> <span class="n">fact</span> <span class="o">(</span><span class="mi">0</span> <span class="bp">&lt;</span> <span class="n">r</span><span class="o">),</span>
<span class="n">r'</span> <span class="o">:</span> <span class="n">ℝ</span><span class="bp">≥</span><span class="mi">0</span><span class="o">,</span>
<span class="n">_inst_6</span> <span class="o">:</span> <span class="n">fact</span> <span class="o">(</span><span class="mi">0</span> <span class="bp">&lt;</span> <span class="n">r'</span><span class="o">),</span>
<span class="n">_inst_7</span> <span class="o">:</span> <span class="n">fact</span> <span class="o">(</span><span class="n">r'</span> <span class="bp">≤</span> <span class="mi">1</span><span class="o">),</span>
<span class="n">M</span> <span class="o">:</span> <span class="n">ProFiltPseuNormGrpWithTinv</span> <span class="n">r'</span><span class="o">,</span>
<span class="n">c</span> <span class="n">N</span> <span class="o">:</span> <span class="n">ℝ</span><span class="bp">≥</span><span class="mi">0</span>
<span class="bp">⊢</span> <span class="bp">?</span><span class="n">m_1</span> <span class="bp">=</span>
    <span class="n">cochain_complex.mk</span>
      <span class="o">(</span><span class="bp">λ</span> <span class="o">(</span><span class="n">i</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">),</span>
         <span class="o">(</span><span class="n">BD.complex₂_X</span> <span class="n">r</span> <span class="n">V</span> <span class="n">r'</span> <span class="o">(</span><span class="bp">λ</span> <span class="o">(</span><span class="n">i</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">),</span> <span class="n">c</span> <span class="bp">*</span> <span class="n">c'</span> <span class="n">i</span><span class="o">)</span> <span class="o">(</span><span class="bp">λ</span> <span class="o">(</span><span class="n">i</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">),</span> <span class="n">r'</span> <span class="bp">*</span> <span class="o">(</span><span class="n">c</span> <span class="bp">*</span> <span class="n">c'</span> <span class="n">i</span><span class="o">))</span> <span class="n">i</span><span class="o">)</span><span class="bp">.</span><span class="n">obj</span>
           <span class="o">(</span><span class="n">opposite.op</span> <span class="o">(</span><span class="n">of</span> <span class="n">r'</span> <span class="o">(</span><span class="n">rescale</span> <span class="n">N</span> <span class="bp">↥</span><span class="n">M</span><span class="o">))))</span>
      <span class="o">(</span><span class="bp">λ</span> <span class="o">(</span><span class="n">i</span> <span class="n">j</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">),</span>
         <span class="o">(</span><span class="n">universal_map.eval_CLCFPTinv₂</span> <span class="n">r</span> <span class="n">V</span> <span class="n">r'</span> <span class="o">(</span><span class="n">c</span> <span class="bp">*</span> <span class="n">c'</span> <span class="n">i</span><span class="o">)</span> <span class="o">(</span><span class="n">r'</span> <span class="bp">*</span> <span class="o">(</span><span class="n">c</span> <span class="bp">*</span> <span class="n">c'</span> <span class="n">i</span><span class="o">))</span> <span class="o">(</span><span class="n">c</span> <span class="bp">*</span> <span class="n">c'</span> <span class="n">j</span><span class="o">)</span> <span class="o">(</span><span class="n">r'</span> <span class="bp">*</span> <span class="o">(</span><span class="n">c</span> <span class="bp">*</span> <span class="n">c'</span> <span class="n">j</span><span class="o">))</span>
            <span class="o">(</span><span class="n">BD.d</span> <span class="n">j</span> <span class="n">i</span><span class="o">))</span><span class="bp">.</span><span class="n">app</span>
           <span class="o">(</span><span class="n">opposite.op</span> <span class="o">(</span><span class="n">of</span> <span class="n">r'</span> <span class="o">(</span><span class="n">rescale</span> <span class="n">N</span> <span class="bp">↥</span><span class="n">M</span><span class="o">))))</span>
      <span class="n">_</span>
      <span class="n">_</span>
</code></pre></div>



<a name="232501642"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/goal%20view/near/232501642" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/goal.20view.html#232501642">(Mar 30 2021 at 21:34)</a>:</h4>
<p>For the vim weirdos like me, perhaps the best solution would be to put explicit support into the extension to shift the goal request position appropriately when in normal mode. Doesn't work for the Lean 3 "at end of tactic" approach though.</p>



<a name="232501747"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/goal%20view/near/232501747" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/goal.20view.html#232501747">(Mar 30 2021 at 21:35)</a>:</h4>
<p>First, I have to scroll past the tactic state, which has four goals that have nothing wrong with them, to see the error message: "simplify tactic failed to simplify". Then I have to scroll some more past the long context to find the actual goal <code>⊢ bar BD r V M (λ (i : ℕ), r' * (c * (c' i * N⁻¹))) (λ (i : ℕ), c * (c' i * N⁻¹)) ?m_1 ?m_2 _ _ = ?m_3</code> that failed to simplify</p>



<a name="232501820"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/goal%20view/near/232501820" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/goal.20view.html#232501820">(Mar 30 2021 at 21:35)</a>:</h4>
<p>The information that is most relevant is buried under a mountain of noise</p>



<a name="232501956"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/goal%20view/near/232501956" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/goal.20view.html#232501956">(Mar 30 2021 at 21:36)</a>:</h4>
<p>This isn't even a particularly large context. It gets a lot worse than this</p>



<a name="232502137"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/goal%20view/near/232502137" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Daniel Fabian <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/goal.20view.html#232502137">(Mar 30 2021 at 21:38)</a>:</h4>
<p><span class="user-mention" data-user-id="110049">@Mario Carneiro</span> one thing that's an interesting observation is, that most of the state is actually duplicate. I wonder how much better it would look if we did a tree-like structure where the common things are shared and only the differences shown in each state?</p>



<a name="232502143"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/goal%20view/near/232502143" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Julian Berman <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/goal.20view.html#232502143">(Mar 30 2021 at 21:38)</a>:</h4>
<p>Is part of that to do with the goal state being included in the diagnostic message? Maybe the server should just respond with the error itself and the spot it occurs in the diagnostic, and if you want the tactic state too you do a hover separately?</p>



<a name="232502226"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/goal%20view/near/232502226" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/goal.20view.html#232502226">(Mar 30 2021 at 21:39)</a>:</h4>
<p>Putting the <code>|-</code> part first would also help with the long context problem, although it is a bit weird</p>



<a name="232502581"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/goal%20view/near/232502581" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/goal.20view.html#232502581">(Mar 30 2021 at 21:42)</a>:</h4>
<p>One way to address the duplicate context problem is to elide the context from all goals other than the first. That's not quite the same as doing a tree like thing but I don't know how to present that in a way such that you can reconstruct everything</p>



<a name="232502794"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/goal%20view/near/232502794" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/goal.20view.html#232502794">(Mar 30 2021 at 21:44)</a>:</h4>
<p>How about this:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="mi">3</span> <span class="n">goals</span>
<span class="bp">⊢</span> <span class="n">a</span> <span class="bp">=</span> <span class="n">b</span>
<span class="n">A</span> <span class="o">:</span> <span class="kt">Type</span>
<span class="n">a</span> <span class="o">:</span> <span class="n">A</span>
<span class="n">b</span> <span class="o">:</span> <span class="n">A</span>

<span class="bp">...</span> <span class="bp">⊢</span> <span class="n">c</span> <span class="bp">=</span> <span class="n">d</span>
<span class="bp">...</span> <span class="bp">⊢</span> <span class="n">a</span> <span class="bp">=</span> <span class="n">a</span>
</code></pre></div>



<a name="232502963"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/goal%20view/near/232502963" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Daniel Fabian <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/goal.20view.html#232502963">(Mar 30 2021 at 21:46)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">Tactic</span> <span class="n">state</span><span class="o">:</span>
<span class="mi">4</span> <span class="n">goals</span>
<span class="n">BD</span> <span class="o">:</span> <span class="n">data</span><span class="o">,</span>
<span class="n">c'</span> <span class="o">:</span> <span class="n">ℕ</span> <span class="bp">→</span> <span class="n">ℝ</span><span class="bp">≥</span><span class="mi">0</span><span class="o">,</span>
<span class="n">_inst_1</span> <span class="o">:</span> <span class="n">BD.suitable</span> <span class="n">c'</span><span class="o">,</span>
<span class="n">r</span> <span class="o">:</span> <span class="n">ℝ</span><span class="bp">≥</span><span class="mi">0</span><span class="o">,</span>
<span class="n">V</span> <span class="o">:</span> <span class="n">NormedGroup</span><span class="o">,</span>
<span class="n">_inst_4</span> <span class="o">:</span> <span class="n">normed_with_aut</span> <span class="bp">↑</span><span class="n">r</span> <span class="n">V</span><span class="o">,</span>
<span class="n">_inst_5</span> <span class="o">:</span> <span class="n">fact</span> <span class="o">(</span><span class="mi">0</span> <span class="bp">&lt;</span> <span class="n">r</span><span class="o">),</span>
<span class="n">r'</span> <span class="o">:</span> <span class="n">ℝ</span><span class="bp">≥</span><span class="mi">0</span><span class="o">,</span>
<span class="n">_inst_6</span> <span class="o">:</span> <span class="n">fact</span> <span class="o">(</span><span class="mi">0</span> <span class="bp">&lt;</span> <span class="n">r'</span><span class="o">),</span>
<span class="n">_inst_7</span> <span class="o">:</span> <span class="n">fact</span> <span class="o">(</span><span class="n">r'</span> <span class="bp">≤</span> <span class="mi">1</span><span class="o">),</span>
<span class="n">M</span> <span class="o">:</span> <span class="n">ProFiltPseuNormGrpWithTinv</span> <span class="n">r'</span><span class="o">,</span>
<span class="n">c</span> <span class="n">N</span> <span class="o">:</span> <span class="n">ℝ</span><span class="bp">≥</span><span class="mi">0</span>
<span class="c1">---------------</span>
<span class="bp">⊢</span> <span class="n">bar</span> <span class="n">BD</span> <span class="n">r</span> <span class="n">V</span> <span class="n">M</span> <span class="o">(</span><span class="bp">λ</span> <span class="o">(</span><span class="n">i</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">),</span> <span class="n">r'</span> <span class="bp">*</span> <span class="o">(</span><span class="n">c</span> <span class="bp">*</span> <span class="o">(</span><span class="n">c'</span> <span class="n">i</span> <span class="bp">*</span> <span class="n">N</span><span class="bp">⁻¹</span><span class="o">)))</span> <span class="o">(</span><span class="bp">λ</span> <span class="o">(</span><span class="n">i</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">),</span> <span class="n">c</span> <span class="bp">*</span> <span class="o">(</span><span class="n">c'</span> <span class="n">i</span> <span class="bp">*</span> <span class="n">N</span><span class="bp">⁻¹</span><span class="o">))</span> <span class="bp">?</span><span class="n">m_1</span> <span class="bp">?</span><span class="n">m_2</span> <span class="n">_</span> <span class="n">_</span> <span class="bp">=</span> <span class="bp">?</span><span class="n">m_3</span>

<span class="bp">⊢</span> <span class="bp">∀</span> <span class="o">(</span><span class="n">i</span> <span class="n">j</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">),</span> <span class="n">universal_map.suitable</span> <span class="o">(</span><span class="n">r'</span> <span class="bp">*</span> <span class="o">(</span><span class="n">c</span> <span class="bp">*</span> <span class="o">(</span><span class="n">c'</span> <span class="n">j</span> <span class="bp">*</span> <span class="n">N</span><span class="bp">⁻¹</span><span class="o">)))</span> <span class="o">(</span><span class="n">r'</span> <span class="bp">*</span> <span class="o">(</span><span class="n">c</span> <span class="bp">*</span> <span class="o">(</span><span class="n">c'</span> <span class="n">i</span> <span class="bp">*</span> <span class="n">N</span><span class="bp">⁻¹</span><span class="o">)))</span> <span class="o">(</span><span class="n">BD.d</span> <span class="n">j</span> <span class="n">i</span><span class="o">)</span>

<span class="bp">⊢</span> <span class="bp">∀</span> <span class="o">(</span><span class="n">i</span> <span class="n">j</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">),</span> <span class="n">universal_map.suitable</span> <span class="o">(</span><span class="n">c</span> <span class="bp">*</span> <span class="o">(</span><span class="n">c'</span> <span class="n">j</span> <span class="bp">*</span> <span class="n">N</span><span class="bp">⁻¹</span><span class="o">))</span> <span class="o">(</span><span class="n">c</span> <span class="bp">*</span> <span class="o">(</span><span class="n">c'</span> <span class="n">i</span> <span class="bp">*</span> <span class="n">N</span><span class="bp">⁻¹</span><span class="o">))</span> <span class="o">(</span><span class="n">BD.d</span> <span class="n">j</span> <span class="n">i</span><span class="o">)</span>
</code></pre></div>



<a name="232502991"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/goal%20view/near/232502991" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Daniel Fabian <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/goal.20view.html#232502991">(Mar 30 2021 at 21:46)</a>:</h4>
<p>you'd have the bar to separate shared from non-shared</p>



<a name="232503013"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/goal%20view/near/232503013" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Daniel Fabian <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/goal.20view.html#232503013">(Mar 30 2021 at 21:46)</a>:</h4>
<p>thus for the 2 other goals you might have additional context</p>



<a name="232503044"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/goal%20view/near/232503044" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/goal.20view.html#232503044">(Mar 30 2021 at 21:47)</a>:</h4>
<p>What if the main goal has more context than the other two?</p>



<a name="232503269"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/goal%20view/near/232503269" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Daniel Fabian <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/goal.20view.html#232503269">(Mar 30 2021 at 21:48)</a>:</h4>
<p>then you put the line higher.</p>



<a name="232503280"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/goal%20view/near/232503280" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Daniel Fabian <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/goal.20view.html#232503280">(Mar 30 2021 at 21:48)</a>:</h4>
<p>it's just a common-prefix thing</p>



<a name="232503285"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/goal%20view/near/232503285" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/goal.20view.html#232503285">(Mar 30 2021 at 21:49)</a>:</h4>
<p>Oh I see</p>



<a name="232503314"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/goal%20view/near/232503314" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/goal.20view.html#232503314">(Mar 30 2021 at 21:49)</a>:</h4>
<p>Also, can we remove the commas from the proof goal display? It's annoying to edit those out when copying it into a def or something</p>



<a name="232503340"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/goal%20view/near/232503340" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/goal.20view.html#232503340">(Mar 30 2021 at 21:49)</a>:</h4>
<p>especially since the last hypothesis doesn't have a comma</p>



<a name="232503644"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/goal%20view/near/232503644" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/goal.20view.html#232503644">(Mar 30 2021 at 21:52)</a>:</h4>
<p>What if you put the common context last:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">Tactic</span> <span class="n">state</span><span class="o">:</span>
<span class="mi">4</span> <span class="n">goals</span>
<span class="bp">⊢</span> <span class="n">bar</span> <span class="n">BD</span> <span class="n">r</span> <span class="n">V</span> <span class="n">M</span> <span class="o">(</span><span class="bp">λ</span> <span class="o">(</span><span class="n">i</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">),</span> <span class="n">r'</span> <span class="bp">*</span> <span class="o">(</span><span class="n">c</span> <span class="bp">*</span> <span class="o">(</span><span class="n">c'</span> <span class="n">i</span> <span class="bp">*</span> <span class="n">N</span><span class="bp">⁻¹</span><span class="o">)))</span> <span class="o">(</span><span class="bp">λ</span> <span class="o">(</span><span class="n">i</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">),</span> <span class="n">c</span> <span class="bp">*</span> <span class="o">(</span><span class="n">c'</span> <span class="n">i</span> <span class="bp">*</span> <span class="n">N</span><span class="bp">⁻¹</span><span class="o">))</span> <span class="bp">?</span><span class="n">m_1</span> <span class="bp">?</span><span class="n">m_2</span> <span class="n">_</span> <span class="n">_</span> <span class="bp">=</span> <span class="bp">?</span><span class="n">m_3</span>

<span class="n">i</span> <span class="n">j</span> <span class="o">:</span> <span class="n">ℕ</span>
<span class="bp">⊢</span> <span class="n">universal_map.suitable</span> <span class="o">(</span><span class="n">r'</span> <span class="bp">*</span> <span class="o">(</span><span class="n">c</span> <span class="bp">*</span> <span class="o">(</span><span class="n">c'</span> <span class="n">j</span> <span class="bp">*</span> <span class="n">N</span><span class="bp">⁻¹</span><span class="o">)))</span> <span class="o">(</span><span class="n">r'</span> <span class="bp">*</span> <span class="o">(</span><span class="n">c</span> <span class="bp">*</span> <span class="o">(</span><span class="n">c'</span> <span class="n">i</span> <span class="bp">*</span> <span class="n">N</span><span class="bp">⁻¹</span><span class="o">)))</span> <span class="o">(</span><span class="n">BD.d</span> <span class="n">j</span> <span class="n">i</span><span class="o">)</span>

<span class="bp">⊢</span> <span class="bp">∀</span> <span class="o">(</span><span class="n">i</span> <span class="n">j</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">),</span> <span class="n">universal_map.suitable</span> <span class="o">(</span><span class="n">c</span> <span class="bp">*</span> <span class="o">(</span><span class="n">c'</span> <span class="n">j</span> <span class="bp">*</span> <span class="n">N</span><span class="bp">⁻¹</span><span class="o">))</span> <span class="o">(</span><span class="n">c</span> <span class="bp">*</span> <span class="o">(</span><span class="n">c'</span> <span class="n">i</span> <span class="bp">*</span> <span class="n">N</span><span class="bp">⁻¹</span><span class="o">))</span> <span class="o">(</span><span class="n">BD.d</span> <span class="n">j</span> <span class="n">i</span><span class="o">)</span>

<span class="n">context</span><span class="o">:</span>
<span class="n">BD</span> <span class="o">:</span> <span class="n">data</span><span class="o">,</span>
<span class="n">c'</span> <span class="o">:</span> <span class="n">ℕ</span> <span class="bp">→</span> <span class="n">ℝ</span><span class="bp">≥</span><span class="mi">0</span><span class="o">,</span>
<span class="n">_inst_1</span> <span class="o">:</span> <span class="n">BD.suitable</span> <span class="n">c'</span><span class="o">,</span>
<span class="n">r</span> <span class="o">:</span> <span class="n">ℝ</span><span class="bp">≥</span><span class="mi">0</span><span class="o">,</span>
<span class="n">V</span> <span class="o">:</span> <span class="n">NormedGroup</span><span class="o">,</span>
<span class="n">_inst_4</span> <span class="o">:</span> <span class="n">normed_with_aut</span> <span class="bp">↑</span><span class="n">r</span> <span class="n">V</span><span class="o">,</span>
<span class="n">_inst_5</span> <span class="o">:</span> <span class="n">fact</span> <span class="o">(</span><span class="mi">0</span> <span class="bp">&lt;</span> <span class="n">r</span><span class="o">),</span>
<span class="n">r'</span> <span class="o">:</span> <span class="n">ℝ</span><span class="bp">≥</span><span class="mi">0</span><span class="o">,</span>
<span class="n">_inst_6</span> <span class="o">:</span> <span class="n">fact</span> <span class="o">(</span><span class="mi">0</span> <span class="bp">&lt;</span> <span class="n">r'</span><span class="o">),</span>
<span class="n">_inst_7</span> <span class="o">:</span> <span class="n">fact</span> <span class="o">(</span><span class="n">r'</span> <span class="bp">≤</span> <span class="mi">1</span><span class="o">),</span>
<span class="n">M</span> <span class="o">:</span> <span class="n">ProFiltPseuNormGrpWithTinv</span> <span class="n">r'</span><span class="o">,</span>
<span class="n">c</span> <span class="n">N</span> <span class="o">:</span> <span class="n">ℝ</span><span class="bp">≥</span><span class="mi">0</span>
</code></pre></div>
<p>Maybe the context is even in a separate dropdown</p>



<a name="232503652"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/goal%20view/near/232503652" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Daniel Fabian <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/goal.20view.html#232503652">(Mar 30 2021 at 21:52)</a>:</h4>
<p>come to think of it, if we did the compression by common prefix or something, then even showing the proof state both before and after might be feasible</p>



<a name="232503677"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/goal%20view/near/232503677" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Daniel Fabian <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/goal.20view.html#232503677">(Mar 30 2021 at 21:53)</a>:</h4>
<p>that blows up in your face if you have 20 goals</p>



<a name="232503706"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/goal%20view/near/232503706" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Daniel Fabian <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/goal.20view.html#232503706">(Mar 30 2021 at 21:53)</a>:</h4>
<p>but you could do it for just the first goal for instance</p>



<a name="232503714"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/goal%20view/near/232503714" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/goal.20view.html#232503714">(Mar 30 2021 at 21:53)</a>:</h4>
<p>that's true, it would be best to have the context after the first goal</p>



<a name="232503798"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/goal%20view/near/232503798" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/goal.20view.html#232503798">(Mar 30 2021 at 21:54)</a>:</h4>
<p>or even before the first goal, provided the first goal is always on screen first and there is a way to draw the reader's attention to it</p>



<a name="232503873"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/goal%20view/near/232503873" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/goal.20view.html#232503873">(Mar 30 2021 at 21:54)</a>:</h4>
<p>I do like the visual effect of the variable moving up into the context when you do an <code>intro</code></p>



<a name="232503879"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/goal%20view/near/232503879" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Daniel Fabian <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/goal.20view.html#232503879">(Mar 30 2021 at 21:55)</a>:</h4>
<p>like for instance clamped to the bottom of the window?</p>



<a name="232503922"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/goal%20view/near/232503922" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/goal.20view.html#232503922">(Mar 30 2021 at 21:55)</a>:</h4>
<p>right</p>



<a name="232503957"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/goal%20view/near/232503957" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Daniel Fabian <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/goal.20view.html#232503957">(Mar 30 2021 at 21:55)</a>:</h4>
<p>in fact, I do like the shared context for another reason, too.</p>



<a name="232503965"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/goal%20view/near/232503965" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/goal.20view.html#232503965">(Mar 30 2021 at 21:55)</a>:</h4>
<p>but you also want to show the error message and the other goals and they can't all fit</p>



<a name="232503973"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/goal%20view/near/232503973" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Daniel Fabian <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/goal.20view.html#232503973">(Mar 30 2021 at 21:55)</a>:</h4>
<p>say you have 5 similar goals.</p>



<a name="232504044"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/goal%20view/near/232504044" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Daniel Fabian <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/goal.20view.html#232504044">(Mar 30 2021 at 21:56)</a>:</h4>
<p>then doing an <code>all_goals {x y z}</code> becomes much easier if you see the goals instead of mostly context.</p>



<a name="232863144"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/goal%20view/near/232863144" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jasmin Blanchette <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/goal.20view.html#232863144">(Apr 02 2021 at 05:43)</a>:</h4>
<p>I'm in favor of <code>|intro</code> or, perhaps best, <code>i|ntro</code>. The old behavior, while "theoretically" justifiable, almost always showed the wrong subgoal until you learned to artificially move the cursor past the comma.</p>



<a name="232864143"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/goal%20view/near/232864143" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/goal.20view.html#232864143">(Apr 02 2021 at 06:01)</a>:</h4>
<p>I am also in favour of <code>i|ntro</code>: for me this is the best option!</p>



<a name="232918215"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/goal%20view/near/232918215" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Daniel Fabian <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/goal.20view.html#232918215">(Apr 02 2021 at 16:18)</a>:</h4>
<p>does anyone have feedback on the idea of collapsing shared context?</p>



<a name="232919353"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/goal%20view/near/232919353" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Greg Price <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/goal.20view.html#232919353">(Apr 02 2021 at 16:27)</a>:</h4>
<p>I think the common-prefix idea sounds great.</p>



<a name="232923188"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/goal%20view/near/232923188" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Julian Berman <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/goal.20view.html#232923188">(Apr 02 2021 at 16:57)</a>:</h4>
<p>Not sure if this is helpful or already considered but hopefully there's a difference between the message as presented in vscode and the actual response from the server? Like it'd be nice if one could separate the actual pieces of the context (because they're structurally separate in the server response), regardless of how they're ultimately showed to a human</p>



<a name="232928469"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/goal%20view/near/232928469" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Daniel Fabian <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/goal.20view.html#232928469">(Apr 02 2021 at 17:35)</a>:</h4>
<p>right now, the context in lean4 is passed almost verbatim from the server. This approach has both good and bad sides. One nice thing is, that you can write most of the logic in lean, the not-so-nice part is, that the extension is somewhat limited in what it can do. </p>
<p>In lean3 the object model with widgets is more complex, but I don't know the details there.</p>



<a name="232929310"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/goal%20view/near/232929310" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Julian Berman <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/goal.20view.html#232929310">(Apr 02 2021 at 17:42)</a>:</h4>
<p>I guess I don't know enough about widgets either, I thought they were more about how you create graphical interaction on the client-side, whereas I guess I'm asking more about ways the server communicates structured data -- similar I guess to how if you have the <code>simp?</code> tactic and it wants to say "here are my simp lemmas", in lean3 that's a bunch of hairy text, not structured data -- it's just "Try this: bla" and you get to parse that (simple) text. Rather than some protocol the server (or tactic definition) speaks, where you can say (e.g. in JSON): <code>{"response": {"simp-lemmas": ["foo", "bar"]}}</code> and then how you render that (e.g. as <code>Try this: foo\n Try this: bar\n</code>) is up to the client (vscode extension or whatever)</p>



<a name="232929433"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/goal%20view/near/232929433" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Julian Berman <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/goal.20view.html#232929433">(Apr 02 2021 at 17:43)</a>:</h4>
<p>(And here like <code>{"response": {"error": "whatever", "summary": thatCompressedTreeMessage, "state": justTheTacticState}}</code>)</p>



<a name="232929907"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/goal%20view/near/232929907" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/goal.20view.html#232929907">(Apr 02 2021 at 17:47)</a>:</h4>
<p>For "Try this" etc, the LSP spec already gives us the expected format (it should be a "code action"). The goal view is special in that it is a custom extension of the protocol.</p>



<a name="232930002"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/goal%20view/near/232930002" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Julian Berman <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/goal.20view.html#232930002">(Apr 02 2021 at 17:48)</a>:</h4>
<p>Makes sense -- and that custom extension just speaks plaintext essentially?</p>



<a name="232930071"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/goal%20view/near/232930071" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/goal.20view.html#232930071">(Apr 02 2021 at 17:49)</a>:</h4>
<p>Not quite <a href="https://github.com/leanprover/lean4/blob/master/src/Lean/Data/Lsp/Extra.lean#L40-L42">https://github.com/leanprover/lean4/blob/master/src/Lean/Data/Lsp/Extra.lean#L40-L42</a></p>



<a name="232930138"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/goal%20view/near/232930138" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Julian Berman <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/goal.20view.html#232930138">(Apr 02 2021 at 17:49)</a>:</h4>
<p>a ha, ok, so there's a couple more things, but this is about that <code>rendered</code> field</p>



<a name="232930227"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/goal%20view/near/232930227" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/goal.20view.html#232930227">(Apr 02 2021 at 17:50)</a>:</h4>
<p>which afaik is not used by either extension anymore</p>



<a name="232931665"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/goal%20view/near/232931665" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Daniel Fabian <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/goal.20view.html#232931665">(Apr 02 2021 at 18:01)</a>:</h4>
<p>Well, if we did go down the route of implementing the prefix compression, we should have a structure more or less like this:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">structure</span> <span class="n">PlainGoal</span> <span class="n">where</span>
  <span class="n">rendered</span> <span class="o">:</span> <span class="n">String</span>
  <span class="kd">prefix</span> <span class="o">:</span> <span class="n">String</span>
  <span class="n">goals</span> <span class="o">:</span> <span class="n">Array</span> <span class="n">String</span>
</code></pre></div>
<p>So that you can easily get the old behaviour but just <code>prefix.map (fun x =&gt; prefix ++ x)</code>, but you could also get the compressed prefix rendering if so desired.</p>



<a name="232932013"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/goal%20view/near/232932013" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Daniel Fabian <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/goal.20view.html#232932013">(Apr 02 2021 at 18:04)</a>:</h4>
<p>on the other hand, we still want lean's pretty printer to take care of the heavy lifting. That's not something you want to implement in the extension.</p>



<a name="232960087"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/goal%20view/near/232960087" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/goal.20view.html#232960087">(Apr 02 2021 at 22:39)</a>:</h4>
<p><span class="user-mention silent" data-user-id="121058">Jasmin Blanchette</span> <a href="#narrow/stream/270676-lean4/topic/goal.20view/near/232863144">said</a>:</p>
<blockquote>
<p>I'm in favor of <code>|intro</code> or, perhaps best, <code>i|ntro</code>. The old behavior, while "theoretically" justifiable, almost always showed the wrong subgoal until you learned to artificially move the cursor past the comma.</p>
</blockquote>
<p>Good to hear that someone else actually finds the Lean 3 behavior problematic :)</p>



<a name="232960277"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/goal%20view/near/232960277" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/goal.20view.html#232960277">(Apr 02 2021 at 22:41)</a>:</h4>
<p>I've now implemented Mario's <code>i|ntro</code> proposal, please give it a try. We also now show goals from all execution branches (e.g. after <code>&lt;;&gt;</code>) at the current position, feedback on that would be valuable as well.</p>



<a name="232965622"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/goal%20view/near/232965622" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Julian Berman <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/goal.20view.html#232965622">(Apr 02 2021 at 23:57)</a>:</h4>
<p>Well it works :) and I indeed got it working in vim normal mode hee hee <a href="https://asciinema.org/a/GARVUQZtmHeGeKxOBqVO18dAC">https://asciinema.org/a/GARVUQZtmHeGeKxOBqVO18dAC</a> (don't look at my newbie lean code but it does work hooray)</p>



<a name="232966645"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/goal%20view/near/232966645" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Julian Berman <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/goal.20view.html#232966645">(Apr 03 2021 at 00:14)</a>:</h4>
<p>I think after a few minutes though that in my case it's a bit awkward that it's on the second character, but I guess I'll try shifting the request by 1 on my side.</p>



<a name="237068787"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/goal%20view/near/237068787" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/goal.20view.html#237068787">(May 02 2021 at 17:45)</a>:</h4>
<p>I've now refined the <code>i|ntro</code> logic in <a href="https://github.com/leanprover/lean4/pull/434">https://github.com/leanprover/lean4/pull/434</a>: if the tactic looks like a combinator (has a nested tactic not surrounded by <code>by</code>), we default to showing the initial goal on the outer tactic. Thus if you put your cursor at <code>i|nduction ... with ...</code>, it will no longer show you a useless "goals accomplished". Combinators can and should override this default behavior where sensible, and we do so for induction/cases/case/match, showing the corresponding case goal on the <code>... =&gt;</code> part. Oh, and we show the initial goal on <code>by</code>, even if you haven't written anything after it yet.</p>



<a name="237366398"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/goal%20view/near/237366398" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Lucas V. <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/goal.20view.html#237366398">(May 04 2021 at 17:30)</a>:</h4>
<p><span class="user-mention silent" data-user-id="321696">Julian Berman</span> <a href="#narrow/stream/270676-lean4/topic/goal.20view/near/232965622">said</a>:</p>
<blockquote>
<p>Well it works :) and I indeed got it working in vim normal mode hee hee <a href="https://asciinema.org/a/GARVUQZtmHeGeKxOBqVO18dAC">https://asciinema.org/a/GARVUQZtmHeGeKxOBqVO18dAC</a> (don't look at my newbie lean code but it does work hooray)</p>
</blockquote>
<p>Hi, sorry if this is the wrong place to ask, but is there a way to have this infoview in emacs?</p>



<a name="237367137"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/goal%20view/near/237367137" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/goal.20view.html#237367137">(May 04 2021 at 17:35)</a>:</h4>
<p>Yes, press <code>C-c C-i</code> :)</p>



<a name="237367190"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/goal%20view/near/237367190" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/goal.20view.html#237367190">(May 04 2021 at 17:35)</a>:</h4>
<p>(<code>lean4-toggle-info</code> in recent lean4-mode)</p>



<a name="237369198"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/goal%20view/near/237369198" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Lucas V. <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/goal.20view.html#237369198">(May 04 2021 at 17:46)</a>:</h4>
<p>Thanks! So this <em>almost</em> works, it tries to display the goal but this error pops up in the message buffer instead:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">Error</span> <span class="n">processing</span> <span class="n">message</span> <span class="o">(</span><span class="n">wrong</span><span class="bp">-</span><span class="n">type</span><span class="bp">-</span><span class="n">argument</span> <span class="n">listp</span> <span class="bp">#</span><span class="n">s</span><span class="o">(</span><span class="n">hash</span><span class="bp">-</span><span class="n">table</span> <span class="n">size</span> <span class="mi">1</span> <span class="n">test</span> <span class="n">equal</span> <span class="n">rehash</span><span class="bp">-</span><span class="n">size</span> <span class="mi">1</span><span class="bp">.</span><span class="mi">5</span> <span class="n">rehash</span><span class="bp">-</span><span class="n">threshold</span> <span class="mi">0</span><span class="bp">.</span><span class="mi">8125</span> <span class="n">data</span> <span class="o">(</span><span class="s2">"rendered"</span> <span class="s2">"```lean</span>
<span class="s2">m n k : Nat</span>
<span class="s2">⊢ succ (n + (m + k)) = succ (n + (m + k))</span>
<span class="s2">```"</span><span class="o">)))</span><span class="bp">.</span>
</code></pre></div>
<p>I tried with lean4 stable and nighly. Maybe this is a problem with my lsp-mode? I'm using its latest version too.</p>



<a name="237369404"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/goal%20view/near/237369404" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Lucas V. <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/goal.20view.html#237369404">(May 04 2021 at 17:47)</a>:</h4>
<p>And I am also using the latest lean4-mode from the lean4 repo</p>



<a name="242264953"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/goal%20view/near/242264953" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Lucas Viana <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/goal.20view.html#242264953">(Jun 10 2021 at 20:20)</a>:</h4>
<p>Today I figured out the problem:</p>
<p>Maybe due to other package I am using or maybe because it's emacs 28, when the goal view is created the cursor moves to the goal view. So when <code>lean4-toggle-info</code> calls <code>(lean4-info-buffer-refresh)</code> it is not at the Lean4 buffer and some lsp functions throw the error.</p>
<p>Simply removing the <code>(lean4-info-buffer-refresh)</code> line solves the problem, but the right fix would probably be a bit more sophisticated</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>