---
layout: archive
title: Zulip Chat Archive
permalink: /stream/270676-lean4/topic/.E2.9C.94.20Definition.20Macro.3F.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/index.html">lean4</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.E2.9C.94.20Definition.20Macro.3F.html">✔ Definition Macro?</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="282993328"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%E2%9C%94%20Definition%20Macro%3F/near/282993328" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Notification Bot <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.E2.9C.94.20Definition.20Macro.3F.html#282993328">(May 19 2022 at 21:16)</a>:</h4>
<p><span class="user-mention silent" data-user-id="467926">Joseph O</span> has marked this topic as resolved.</p>



<a name="283030650"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%E2%9C%94%20Definition%20Macro%3F/near/283030650" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Raghuram <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.E2.9C.94.20Definition.20Macro.3F.html#283030650">(May 20 2022 at 06:50)</a>:</h4>
<p><span class="user-mention silent" data-user-id="451983">Arthur Paulino</span> <a href="#narrow/stream/270676-lean4/topic/.E2.9C.94.20Definition.20Macro.3F/near/282985928">said</a>:</p>
<blockquote>
<p>Here's a fun idea:</p>
<p><div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">syntax</span> <span class="n">binder</span> <span class="o">:=</span> <span class="s2">"["</span> <span class="n">ident</span> <span class="n">term</span> <span class="s2">"]"</span>
<span class="n">syntax</span> <span class="s2">"("</span> <span class="s2">"define"</span> <span class="s2">"("</span> <span class="n">binder</span><span class="bp">+</span> <span class="s2">")"</span> <span class="n">term</span> <span class="s2">")"</span> <span class="o">:</span> <span class="n">command</span>

<span class="n">macro_rules</span>
  <span class="bp">|</span> <span class="bp">`</span><span class="o">((</span><span class="n">define</span> <span class="o">([</span><span class="bp">$</span><span class="n">f</span><span class="o">:</span><span class="n">ident</span> <span class="bp">$</span><span class="n">ty'</span><span class="o">:</span><span class="n">term</span><span class="o">]</span> <span class="o">[</span><span class="bp">$</span><span class="n">nm</span><span class="o">:</span><span class="n">ident</span> <span class="bp">$</span><span class="n">ty</span><span class="o">:</span><span class="n">term</span><span class="o">])</span> <span class="bp">$</span><span class="n">v</span><span class="o">:</span><span class="n">term</span><span class="o">))</span> <span class="bp">=&gt;</span>
    <span class="bp">`</span><span class="o">(</span><span class="kd">def</span> <span class="bp">$</span><span class="n">f</span><span class="o">:</span><span class="n">ident</span> <span class="o">:</span> <span class="bp">$</span><span class="n">ty</span><span class="o">:</span><span class="n">term</span> <span class="bp">→</span> <span class="bp">$</span><span class="n">ty'</span><span class="o">:</span><span class="n">term</span> <span class="o">:=</span> <span class="k">fun</span> <span class="bp">$</span><span class="n">nm</span><span class="o">:</span><span class="n">ident</span> <span class="bp">=&gt;</span> <span class="bp">$</span><span class="n">v</span><span class="o">:</span><span class="n">term</span><span class="o">)</span>
  <span class="bp">|</span> <span class="bp">`</span><span class="o">((</span><span class="n">define</span> <span class="o">([</span><span class="bp">$</span><span class="n">f</span><span class="o">:</span><span class="n">ident</span> <span class="bp">$</span><span class="n">ty'</span><span class="o">:</span><span class="n">term</span><span class="o">]</span> <span class="o">[</span><span class="bp">$</span><span class="n">nm</span><span class="o">:</span><span class="n">ident</span> <span class="bp">$</span><span class="n">ty</span><span class="o">:</span><span class="n">term</span><span class="o">]</span> <span class="bp">$</span><span class="n">bs</span><span class="o">:</span><span class="n">binder</span><span class="bp">*</span><span class="o">)</span> <span class="bp">$</span><span class="n">v</span><span class="o">:</span><span class="n">term</span><span class="o">))</span> <span class="bp">=&gt;</span>
    <span class="bp">`</span><span class="o">((</span><span class="n">define</span> <span class="o">([</span><span class="bp">$</span><span class="n">f</span><span class="o">:</span><span class="n">ident</span> <span class="bp">$</span><span class="n">ty</span><span class="o">:</span><span class="n">term</span> <span class="bp">→</span> <span class="bp">$</span><span class="n">ty'</span><span class="o">:</span><span class="n">term</span><span class="o">]</span> <span class="bp">$</span><span class="n">bs</span><span class="o">:</span><span class="n">binder</span><span class="bp">*</span><span class="o">)</span> <span class="k">fun</span> <span class="bp">$</span><span class="n">nm</span> <span class="bp">=&gt;</span> <span class="bp">$</span><span class="n">v</span><span class="o">:</span><span class="n">term</span><span class="o">))</span>

<span class="o">(</span><span class="n">define</span> <span class="o">([</span><span class="n">add</span> <span class="n">Nat</span><span class="o">]</span> <span class="o">[</span><span class="n">x</span> <span class="n">Nat</span><span class="o">]</span> <span class="o">[</span><span class="n">y</span> <span class="n">Nat</span><span class="o">])</span> <span class="n">x</span> <span class="bp">+</span> <span class="n">y</span><span class="o">)</span>

<span class="k">#eval</span> <span class="n">add</span> <span class="mi">3</span> <span class="mi">5</span> <span class="c1">-- 8</span>
</code></pre></div><br>
</p>
</blockquote>
<p>I tried to modify this to allow the type to be omitted and inferred by _, but it doesn't work and I don't know why.</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">syntax</span> <span class="n">explicitBinder</span> <span class="o">:=</span> <span class="s2">"["</span> <span class="n">ident</span> <span class="n">term</span> <span class="s2">"]"</span>
<span class="n">syntax</span> <span class="n">binder</span> <span class="o">:=</span> <span class="n">explicitBinder</span> <span class="bp">&lt;|&gt;</span> <span class="n">ident</span>
<span class="n">syntax</span> <span class="o">(</span><span class="n">name</span> <span class="o">:=</span> <span class="n">defn</span><span class="o">)</span> <span class="c">/-</span><span class="cm"> (priority := high) -/</span> <span class="s2">"("</span> <span class="s2">"define"</span> <span class="s2">"("</span> <span class="n">binder</span><span class="bp">+</span> <span class="s2">")"</span> <span class="n">term</span> <span class="s2">")"</span> <span class="o">:</span> <span class="n">command</span>

<span class="n">macro_rules</span> <span class="o">(</span><span class="n">kind</span> <span class="o">:=</span> <span class="n">defn</span><span class="o">)</span>
<span class="bp">|</span> <span class="bp">`</span><span class="o">((</span><span class="n">define</span> <span class="o">([</span><span class="bp">$</span><span class="n">f</span><span class="o">:</span><span class="n">ident</span> <span class="bp">$</span><span class="n">ty</span><span class="o">:</span><span class="n">term</span><span class="o">])</span> <span class="bp">$</span><span class="n">v</span><span class="o">:</span><span class="n">term</span><span class="o">))</span> <span class="bp">=&gt;</span>
  <span class="bp">`</span><span class="o">(</span><span class="kd">def</span> <span class="bp">$</span><span class="n">f</span><span class="o">:</span><span class="n">ident</span> <span class="o">:</span> <span class="bp">$</span><span class="n">ty</span><span class="o">:</span><span class="n">term</span> <span class="o">:=</span> <span class="bp">$</span><span class="n">v</span><span class="o">:</span><span class="n">term</span><span class="o">)</span>
<span class="bp">|</span> <span class="bp">`</span><span class="o">((</span><span class="n">define</span> <span class="o">([</span><span class="bp">$</span><span class="n">f</span><span class="o">:</span><span class="n">ident</span> <span class="bp">$</span><span class="n">ty'</span><span class="o">:</span><span class="n">term</span><span class="o">]</span> <span class="bp">$</span><span class="n">bs</span><span class="o">:</span><span class="n">binder</span><span class="bp">*</span> <span class="o">[</span><span class="bp">$</span><span class="n">nm</span><span class="o">:</span><span class="n">ident</span> <span class="bp">$</span><span class="n">ty</span><span class="o">:</span><span class="n">term</span><span class="o">])</span> <span class="bp">$</span><span class="n">v</span><span class="o">:</span><span class="n">term</span><span class="o">))</span> <span class="bp">=&gt;</span>
  <span class="bp">`</span><span class="o">((</span><span class="n">define</span> <span class="o">([</span><span class="bp">$</span><span class="n">f</span><span class="o">:</span><span class="n">ident</span> <span class="o">(</span><span class="bp">$</span><span class="n">nm</span><span class="o">:</span><span class="n">ident</span> <span class="o">:</span> <span class="bp">$</span><span class="n">ty</span><span class="o">:</span><span class="n">term</span><span class="o">)</span> <span class="bp">→</span> <span class="bp">$</span><span class="n">ty'</span><span class="o">:</span><span class="n">term</span><span class="o">]</span> <span class="bp">$</span><span class="n">bs</span><span class="o">:</span><span class="n">binder</span><span class="bp">*</span><span class="o">)</span> <span class="k">fun</span> <span class="bp">$</span><span class="n">nm</span><span class="o">:</span><span class="n">ident</span> <span class="bp">=&gt;</span> <span class="bp">$</span><span class="n">v</span><span class="o">:</span><span class="n">term</span><span class="o">))</span>
<span class="c1">-- Insertion of _ type for plain idents</span>
<span class="bp">|</span> <span class="bp">`</span><span class="o">((</span><span class="n">define</span> <span class="o">(</span><span class="bp">$</span><span class="n">bs</span><span class="o">:</span><span class="n">binder</span><span class="bp">*</span> <span class="bp">$</span><span class="n">b</span><span class="o">:</span><span class="n">ident</span><span class="o">)</span> <span class="bp">$</span><span class="n">v</span><span class="o">:</span><span class="n">term</span><span class="o">))</span> <span class="bp">=&gt;</span>
  <span class="bp">`</span><span class="o">((</span><span class="n">define</span> <span class="o">(</span><span class="bp">$</span><span class="n">bs</span><span class="o">:</span><span class="n">binder</span><span class="bp">*</span> <span class="o">[</span><span class="bp">$</span><span class="n">b</span><span class="o">:</span><span class="n">ident</span> <span class="n">_</span><span class="o">])</span> <span class="bp">$</span><span class="n">v</span><span class="o">:</span><span class="n">term</span><span class="o">))</span>
<span class="bp">|</span> <span class="bp">`</span><span class="o">((</span><span class="n">define</span> <span class="o">(</span><span class="bp">$</span><span class="n">f</span><span class="o">:</span><span class="n">ident</span> <span class="bp">$</span><span class="n">bs</span><span class="o">:</span><span class="n">binder</span><span class="bp">*</span><span class="o">)</span> <span class="bp">$</span><span class="n">v</span><span class="o">:</span><span class="n">term</span><span class="o">))</span> <span class="bp">=&gt;</span>
  <span class="bp">`</span><span class="o">((</span><span class="n">define</span> <span class="o">([</span><span class="bp">$</span><span class="n">f</span><span class="o">:</span><span class="n">ident</span> <span class="n">_</span><span class="o">]</span> <span class="bp">$</span><span class="n">bs</span><span class="o">:</span><span class="n">binder</span><span class="bp">*</span><span class="o">)</span> <span class="bp">$</span><span class="n">v</span><span class="o">:</span><span class="n">term</span><span class="o">))</span>

<span class="kd">variable</span> <span class="o">{</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Sort</span> <span class="n">_</span><span class="o">}</span> <span class="o">{</span><span class="n">β</span> <span class="o">:</span> <span class="n">α</span> <span class="bp">→</span> <span class="kt">Sort</span> <span class="n">_</span><span class="o">}</span>
<span class="c1">-- Necessary to avoid strange errors - not sure exactly why</span>
<span class="kn">section</span> <span class="kd">end</span>

<span class="o">(</span><span class="n">define</span> <span class="o">(</span><span class="n">foo</span><span class="o">)</span> <span class="o">(</span><span class="mi">1</span><span class="o">:</span><span class="n">Nat</span><span class="o">))</span> <span class="c1">-- elaboration for 'defn' not implemented</span>
<span class="o">(</span><span class="n">define</span> <span class="o">([</span><span class="n">foo</span> <span class="n">_</span><span class="o">])</span> <span class="o">(</span><span class="mi">1</span><span class="o">:</span><span class="n">Nat</span><span class="o">))</span> <span class="c1">-- unable to fill the _, but successfully defines `foo : Nat`</span>

<span class="o">(</span><span class="n">define</span> <span class="o">(</span><span class="n">const</span> <span class="o">[</span><span class="n">a</span> <span class="n">α</span><span class="o">]</span> <span class="o">[</span><span class="n">b</span> <span class="n">β</span> <span class="n">a</span><span class="o">])</span> <span class="n">a</span><span class="o">)</span> <span class="c1">-- elaboration for 'defn' not implemented</span>
<span class="o">(</span><span class="n">define</span> <span class="o">([</span><span class="n">const</span> <span class="n">α</span><span class="o">]</span> <span class="n">a</span> <span class="o">[</span><span class="n">b</span> <span class="n">β</span> <span class="n">a</span><span class="o">])</span> <span class="n">a</span><span class="o">)</span> <span class="c1">-- same</span>
<span class="o">(</span><span class="n">define</span> <span class="o">([</span><span class="n">const</span> <span class="n">α</span><span class="o">]</span> <span class="o">[</span><span class="n">a</span> <span class="n">α</span><span class="o">]</span> <span class="n">b</span><span class="o">)</span> <span class="k">have</span> <span class="o">:</span> <span class="n">β</span> <span class="n">a</span> <span class="o">:=</span> <span class="n">b</span><span class="bp">;</span> <span class="n">a</span><span class="o">)</span> <span class="c1">-- same</span>
<span class="o">(</span><span class="n">define</span> <span class="o">([</span><span class="n">const</span> <span class="n">α</span><span class="o">]</span> <span class="o">[</span><span class="n">a</span> <span class="n">α</span><span class="o">]</span> <span class="o">[</span><span class="n">b</span> <span class="n">β</span> <span class="n">a</span><span class="o">])</span> <span class="n">a</span><span class="o">)</span> <span class="c1">-- works</span>
<span class="o">(</span><span class="n">define</span> <span class="o">([</span><span class="n">const</span> <span class="n">_</span><span class="o">]</span> <span class="o">[</span><span class="n">a</span> <span class="n">_</span><span class="o">]</span> <span class="o">[</span><span class="n">b</span> <span class="n">_</span><span class="o">])</span> <span class="k">have</span> <span class="o">:</span> <span class="n">β</span> <span class="n">a</span> <span class="o">:=</span> <span class="n">b</span><span class="bp">;</span> <span class="n">a</span><span class="o">)</span> <span class="c1">-- unable to fill all 3 _'s, but successfully defines `const`</span>
</code></pre></div>
<p>(Note: the warnings say that all holes in an explicitly given type for a declaration  are elaborated before looking at the body, so that an error there makes sense, although I'm not sure why those definitions work anyway if that's the case.)</p>
<p>What is going wrong here?</p>



<a name="283089044"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%E2%9C%94%20Definition%20Macro%3F/near/283089044" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joseph O <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.E2.9C.94.20Definition.20Macro.3F.html#283089044">(May 20 2022 at 15:50)</a>:</h4>
<p><span class="user-mention silent" data-user-id="451983">Arthur Paulino</span><br>
Hm do you find that weird?</p>



<a name="283090230"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%E2%9C%94%20Definition%20Macro%3F/near/283090230" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.E2.9C.94.20Definition.20Macro.3F.html#283090230">(May 20 2022 at 15:58)</a>:</h4>
<p>A little bit. I <em>think</em> it's because of the syntax of <code>#eval</code>. I tried to find it in the Lean 4 repo but I couldn't. Maybe it doesn't use <code>withPosition</code> and <code>colGt</code> and thus it's still trying to consume whatever comes in the next line if it starts with <code>(</code></p>



<a name="283090292"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%E2%9C%94%20Definition%20Macro%3F/near/283090292" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joseph O <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.E2.9C.94.20Definition.20Macro.3F.html#283090292">(May 20 2022 at 15:59)</a>:</h4>
<p>Oh i see</p>



<a name="283090329"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%E2%9C%94%20Definition%20Macro%3F/near/283090329" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joseph O <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.E2.9C.94.20Definition.20Macro.3F.html#283090329">(May 20 2022 at 15:59)</a>:</h4>
<p>That makes sense with some previous things that happened before</p>



<a name="283090338"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%E2%9C%94%20Definition%20Macro%3F/near/283090338" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Notification Bot <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.E2.9C.94.20Definition.20Macro.3F.html#283090338">(May 20 2022 at 15:59)</a>:</h4>
<p><span class="user-mention silent" data-user-id="467926">Joseph O</span> has marked this topic as resolved.</p>



<a name="283101737"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%E2%9C%94%20Definition%20Macro%3F/near/283101737" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.E2.9C.94.20Definition.20Macro.3F.html#283101737">(May 20 2022 at 17:27)</a>:</h4>
<p><span class="user-mention silent" data-user-id="451983">Arthur Paulino</span> <a href="#narrow/stream/270676-lean4/topic/.E2.9C.94.20Definition.20Macro.3F/near/283090230">said</a>:</p>
<blockquote>
<p>A little bit. I <em>think</em> it's because of the syntax of <code>#eval</code>. I tried to find it in the Lean 4 repo but I couldn't. Maybe it doesn't use <code>withPosition</code> and <code>colGt</code> and thus it's still trying to consume whatever comes in the next line if it starts with <code>(</code></p>
</blockquote>
<p>Neither do <code>def</code> etc. It is expected that commands start with a token not in <code>term</code>. <code>"(define"</code> would work as well.</p>



<a name="283103269"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%E2%9C%94%20Definition%20Macro%3F/near/283103269" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.E2.9C.94.20Definition.20Macro.3F.html#283103269">(May 20 2022 at 17:40)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110024">Sebastian Ullrich</span> <a href="#narrow/stream/270676-lean4/topic/.E2.9C.94.20Definition.20Macro.3F/near/283101737">said</a>:</p>
<blockquote>
<p><code>"(define"</code> would work as well.</p>
</blockquote>
<p>What do you mean by this? I couldn't make it work with <code>"(define"</code></p>



<a name="283103847"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%E2%9C%94%20Definition%20Macro%3F/near/283103847" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.E2.9C.94.20Definition.20Macro.3F.html#283103847">(May 20 2022 at 17:45)</a>:</h4>
<p>Works for me</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">syntax</span> <span class="n">binder</span> <span class="o">:=</span> <span class="n">ident</span> <span class="s2">" := "</span> <span class="n">term</span>
<span class="n">syntax</span> <span class="s2">"let"</span> <span class="n">binder</span><span class="o">,</span><span class="bp">+</span> <span class="s2">" in "</span> <span class="n">term</span> <span class="o">:</span> <span class="n">term</span>

<span class="n">macro_rules</span>
  <span class="bp">|</span> <span class="bp">`</span><span class="o">(</span><span class="k">let</span> <span class="bp">$</span><span class="n">name</span><span class="o">:</span><span class="n">ident</span> <span class="o">:=</span> <span class="bp">$</span><span class="n">v</span><span class="o">:</span><span class="n">term</span> <span class="k">in</span> <span class="bp">$</span><span class="n">t</span><span class="o">:</span><span class="n">term</span><span class="o">)</span> <span class="bp">=&gt;</span> <span class="bp">`</span><span class="o">(</span><span class="k">let</span> <span class="bp">$</span><span class="n">name</span> <span class="o">:=</span> <span class="bp">$</span><span class="n">v</span><span class="bp">;</span> <span class="bp">$</span><span class="n">t</span><span class="o">)</span>
  <span class="bp">|</span> <span class="bp">`</span><span class="o">(</span><span class="k">let</span> <span class="bp">$</span><span class="n">name</span><span class="o">:</span><span class="n">ident</span> <span class="o">:=</span> <span class="bp">$</span><span class="n">v</span><span class="o">:</span><span class="n">term</span><span class="o">,</span> <span class="bp">$</span><span class="n">bs</span><span class="o">:</span><span class="n">binder</span><span class="o">,</span><span class="bp">*</span> <span class="k">in</span> <span class="bp">$</span><span class="n">t</span><span class="o">:</span><span class="n">term</span><span class="o">)</span> <span class="bp">=&gt;</span>
    <span class="bp">`</span><span class="o">(</span><span class="k">let</span> <span class="bp">$</span><span class="n">name</span> <span class="o">:=</span> <span class="bp">$</span><span class="n">v</span><span class="bp">;</span> <span class="k">let</span> <span class="bp">$</span><span class="n">bs</span><span class="o">:</span><span class="n">binder</span><span class="o">,</span><span class="bp">*</span> <span class="k">in</span> <span class="bp">$</span><span class="n">t</span><span class="o">:</span><span class="n">term</span><span class="o">)</span>

<span class="n">syntax</span> <span class="n">binder'</span> <span class="o">:=</span> <span class="s2">"["</span> <span class="n">ident</span> <span class="n">term</span> <span class="s2">"]"</span>
<span class="n">syntax</span> <span class="s2">"(define"</span> <span class="s2">"("</span> <span class="n">binder'</span><span class="bp">+</span> <span class="s2">")"</span> <span class="n">term</span> <span class="s2">")"</span> <span class="o">:</span> <span class="n">command</span>

<span class="n">macro_rules</span>
  <span class="bp">|</span> <span class="bp">`</span><span class="o">((</span><span class="n">define</span> <span class="o">([</span><span class="bp">$</span><span class="n">f</span><span class="o">:</span><span class="n">ident</span> <span class="bp">$</span><span class="n">ty'</span><span class="o">:</span><span class="n">term</span><span class="o">]</span> <span class="o">[</span><span class="bp">$</span><span class="n">nm</span><span class="o">:</span><span class="n">ident</span> <span class="bp">$</span><span class="n">ty</span><span class="o">:</span><span class="n">term</span><span class="o">])</span> <span class="bp">$</span><span class="n">v</span><span class="o">:</span><span class="n">term</span><span class="o">))</span> <span class="bp">=&gt;</span>
    <span class="bp">`</span><span class="o">(</span><span class="kd">def</span> <span class="bp">$</span><span class="n">f</span><span class="o">:</span><span class="n">ident</span> <span class="o">:</span> <span class="bp">$</span><span class="n">ty</span><span class="o">:</span><span class="n">term</span> <span class="bp">→</span> <span class="bp">$</span><span class="n">ty'</span><span class="o">:</span><span class="n">term</span> <span class="o">:=</span> <span class="k">fun</span> <span class="bp">$</span><span class="n">nm</span><span class="o">:</span><span class="n">ident</span> <span class="bp">=&gt;</span> <span class="bp">$</span><span class="n">v</span><span class="o">:</span><span class="n">term</span><span class="o">)</span>
  <span class="bp">|</span> <span class="bp">`</span><span class="o">((</span><span class="n">define</span> <span class="o">([</span><span class="bp">$</span><span class="n">f</span><span class="o">:</span><span class="n">ident</span> <span class="bp">$</span><span class="n">ty'</span><span class="o">:</span><span class="n">term</span><span class="o">]</span> <span class="o">[</span><span class="bp">$</span><span class="n">nm</span><span class="o">:</span><span class="n">ident</span> <span class="bp">$</span><span class="n">ty</span><span class="o">:</span><span class="n">term</span><span class="o">]</span> <span class="bp">$</span><span class="n">bs</span><span class="o">:</span><span class="n">binder'</span><span class="bp">*</span><span class="o">)</span> <span class="bp">$</span><span class="n">v</span><span class="o">:</span><span class="n">term</span><span class="o">))</span> <span class="bp">=&gt;</span>
    <span class="bp">`</span><span class="o">((</span><span class="n">define</span> <span class="o">([</span><span class="bp">$</span><span class="n">f</span><span class="o">:</span><span class="n">ident</span> <span class="bp">$</span><span class="n">ty</span><span class="o">:</span><span class="n">term</span> <span class="bp">→</span> <span class="bp">$</span><span class="n">ty'</span><span class="o">:</span><span class="n">term</span><span class="o">]</span> <span class="bp">$</span><span class="n">bs</span><span class="o">:</span><span class="n">binder'</span><span class="bp">*</span><span class="o">)</span> <span class="k">fun</span> <span class="bp">$</span><span class="n">nm</span> <span class="bp">=&gt;</span> <span class="bp">$</span><span class="n">v</span><span class="o">:</span><span class="n">term</span><span class="o">))</span>

<span class="kd">def</span> <span class="n">test3</span> <span class="o">:</span> <span class="n">List</span> <span class="n">Nat</span> <span class="o">:=</span>
  <span class="k">let</span> <span class="n">x</span> <span class="o">:=</span> <span class="o">[</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">],</span> <span class="n">y</span> <span class="o">:=</span> <span class="o">[</span><span class="mi">3</span><span class="o">,</span> <span class="mi">4</span><span class="o">]</span> <span class="k">in</span> <span class="n">x</span> <span class="bp">++</span> <span class="n">y</span>

<span class="k">#eval</span> <span class="n">test3</span> <span class="c1">-- [1, 2, 3, 4]</span>

<span class="c1">-- try commenting and uncommenting this line, and see what happens to the eval</span>
<span class="o">(</span><span class="n">define</span> <span class="o">([</span><span class="n">add</span> <span class="n">Nat</span><span class="o">]</span> <span class="o">[</span><span class="n">x</span> <span class="n">Nat</span><span class="o">]</span> <span class="o">[</span><span class="n">y</span> <span class="n">Nat</span><span class="o">])</span> <span class="n">x</span> <span class="bp">+</span> <span class="n">y</span><span class="o">)</span>
</code></pre></div>



<a name="283107900"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%E2%9C%94%20Definition%20Macro%3F/near/283107900" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.E2.9C.94.20Definition.20Macro.3F.html#283107900">(May 20 2022 at 18:17)</a>:</h4>
<p>Oh, you replaced <code>"(" "define"</code> by <code>"(define"</code>. I wasn't understanding what you meant</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>