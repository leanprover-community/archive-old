---
layout: archive
title: Zulip Chat Archive
permalink: /stream/270676-lean4/topic/Should.20this.20be.20added.20to.20lean.204.3F.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/index.html">lean4</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Should.20this.20be.20added.20to.20lean.204.3F.html">Should this be added to lean 4?</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="272897082"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Should%20this%20be%20added%20to%20lean%204%3F/near/272897082" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joseph O <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Should.20this.20be.20added.20to.20lean.204.3F.html#272897082">(Feb 23 2022 at 02:30)</a>:</h4>
<p>I would appreciate feedback or confirmation whether this would be useful to add to lean 4</p>



<a name="272897285"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Should%20this%20be%20added%20to%20lean%204%3F/near/272897285" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Should.20this.20be.20added.20to.20lean.204.3F.html#272897285">(Feb 23 2022 at 02:33)</a>:</h4>
<p>A way to know is when you end up needing the same piece of code in 2~3 different contexts.</p>
<p>Example: this is how <code>HashMap.ofList</code> was born:<br>
<a href="#narrow/stream/270676-lean4/topic/easy.20HashMap.20instantiation/near/267786491">https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/easy.20HashMap.20instantiation/near/267786491</a></p>



<a name="272897560"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Should%20this%20be%20added%20to%20lean%204%3F/near/272897560" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Chris B <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Should.20this.20be.20added.20to.20lean.204.3F.html#272897560">(Feb 23 2022 at 02:38)</a>:</h4>
<p>I think it's generally preferable for that kind of thing on ranges to be a stream/iterator and not a concrete list.</p>



<a name="272898264"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Should%20this%20be%20added%20to%20lean%204%3F/near/272898264" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joseph O <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Should.20this.20be.20added.20to.20lean.204.3F.html#272898264">(Feb 23 2022 at 02:51)</a>:</h4>
<p>I have had my need for it. For  instance, I don't about everyone else, but I rarely use for loops in lean, and I have had to use Ranges before, piping it into a lot of list methods. I was using <code>List.range n</code>, but recently learned about the range syntax, and needed a use case with stepping, so I was making a <code>toList</code> function, and I assume other people would find it useful too</p>



<a name="272898284"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Should%20this%20be%20added%20to%20lean%204%3F/near/272898284" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joseph O <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Should.20this.20be.20added.20to.20lean.204.3F.html#272898284">(Feb 23 2022 at 02:51)</a>:</h4>
<p>Ranges in my opinion are meant to generate some sort of existing data structure, notably a list</p>



<a name="272898399"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Should%20this%20be%20added%20to%20lean%204%3F/near/272898399" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joseph O <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Should.20this.20be.20added.20to.20lean.204.3F.html#272898399">(Feb 23 2022 at 02:53)</a>:</h4>
<p><code>HashMap</code> even has a <code>toList</code> to allow easy manipulating.</p>



<a name="272975967"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Should%20this%20be%20added%20to%20lean%204%3F/near/272975967" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joseph O <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Should.20this.20be.20added.20to.20lean.204.3F.html#272975967">(Feb 23 2022 at 16:50)</a>:</h4>
<p>I would prefer some more opinions before I decide.</p>



<a name="272977869"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Should%20this%20be%20added%20to%20lean%204%3F/near/272977869" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Should.20this.20be.20added.20to.20lean.204.3F.html#272977869">(Feb 23 2022 at 17:02)</a>:</h4>
<p>it might help to have actual examples of use</p>



<a name="272978073"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Should%20this%20be%20added%20to%20lean%204%3F/near/272978073" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Should.20this.20be.20added.20to.20lean.204.3F.html#272978073">(Feb 23 2022 at 17:03)</a>:</h4>
<p>Most mathlib additions are done because they are dependencies for some other work that either exists in another PR or will be PR'd soon. What's your application?</p>



<a name="272999586"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Should%20this%20be%20added%20to%20lean%204%3F/near/272999586" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joseph O <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Should.20this.20be.20added.20to.20lean.204.3F.html#272999586">(Feb 23 2022 at 19:29)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110049">Mario Carneiro</span> <a href="#narrow/stream/270676-lean4/topic/Should.20this.20be.20added.20to.20lean.204.3F/near/272978073">said</a>:</p>
<blockquote>
<p>Most mathlib additions are done because they are dependencies for some other work that either exists in another PR or will be PR'd soon. What's your application?</p>
</blockquote>
<p>well this isnt for mathlib4 but lean4. Either way, my application is for usefulness</p>



<a name="272999622"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Should%20this%20be%20added%20to%20lean%204%3F/near/272999622" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Should.20this.20be.20added.20to.20lean.204.3F.html#272999622">(Feb 23 2022 at 19:30)</a>:</h4>
<p>that's not an answer</p>



<a name="272999754"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Should%20this%20be%20added%20to%20lean%204%3F/near/272999754" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joseph O <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Should.20this.20be.20added.20to.20lean.204.3F.html#272999754">(Feb 23 2022 at 19:30)</a>:</h4>
<p>What is the point of having ranges, that cant be converted for lists. A use case could be working with mod systems, or primes, and filtering out ranges and numbers, which is what I was doing, and found the need for</p>



<a name="272999788"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Should%20this%20be%20added%20to%20lean%204%3F/near/272999788" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Should.20this.20be.20added.20to.20lean.204.3F.html#272999788">(Feb 23 2022 at 19:31)</a>:</h4>
<p>could you show a concrete example?</p>



<a name="272999852"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Should%20this%20be%20added%20to%20lean%204%3F/near/272999852" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Should.20this.20be.20added.20to.20lean.204.3F.html#272999852">(Feb 23 2022 at 19:31)</a>:</h4>
<p>like a piece of code that you would like to write, that can't be written easily now and would be better with your additions</p>



<a name="272999867"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Should%20this%20be%20added%20to%20lean%204%3F/near/272999867" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Should.20this.20be.20added.20to.20lean.204.3F.html#272999867">(Feb 23 2022 at 19:31)</a>:</h4>
<p>that's what I mean by an application</p>



<a name="273000023"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Should%20this%20be%20added%20to%20lean%204%3F/near/273000023" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joseph O <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Should.20this.20be.20added.20to.20lean.204.3F.html#273000023">(Feb 23 2022 at 19:32)</a>:</h4>
<p>ok, give me a moment</p>



<a name="273002076"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Should%20this%20be%20added%20to%20lean%204%3F/near/273002076" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joseph O <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Should.20this.20be.20added.20to.20lean.204.3F.html#273002076">(Feb 23 2022 at 19:49)</a>:</h4>
<p>very basic example</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">def</span> <span class="n">foo</span> <span class="o">:=</span>
  <span class="o">[</span><span class="mi">28</span><span class="o">:</span><span class="mi">1000</span><span class="o">]</span>
  <span class="bp">|&gt;.</span><span class="n">toList</span>
  <span class="bp">|&gt;.</span><span class="n">map</span> <span class="o">(</span><span class="k">fun</span> <span class="n">n</span> <span class="bp">=&gt;</span> <span class="o">[:</span><span class="n">n</span><span class="o">]</span> <span class="bp">|&gt;.</span><span class="n">toList</span> <span class="bp">|&gt;.</span><span class="n">filter</span> <span class="o">(</span><span class="n">n</span> <span class="bp">%</span> <span class="bp">·</span> <span class="bp">=</span> <span class="mi">0</span><span class="o">))</span>
  <span class="bp">|&gt;.</span><span class="n">filter</span> <span class="o">(</span><span class="bp">·.</span><span class="n">length</span> <span class="bp">=</span> <span class="mi">2</span><span class="o">)</span>
</code></pre></div>
<p>i am unlikely this will convince you. If you want another better example, let me know</p>



<a name="273003017"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Should%20this%20be%20added%20to%20lean%204%3F/near/273003017" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joseph O <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Should.20this.20be.20added.20to.20lean.204.3F.html#273003017">(Feb 23 2022 at 19:56)</a>:</h4>
<p>I will get an example with the step feature. But can I ask you something: What was the point of ranges when they can only be looped through, explain that to me. My idea may not be "useful", but the current version is even worse! barely any functionality!</p>



<a name="273003597"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Should%20this%20be%20added%20to%20lean%204%3F/near/273003597" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Henrik Böving <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Should.20this.20be.20added.20to.20lean.204.3F.html#273003597">(Feb 23 2022 at 20:00)</a>:</h4>
<p>I feel like the <code>for x in [a:b]</code> is an amazing functionality by itself already, sure it could be improved but it's already very useful when you are writing code in a more imperative style</p>



<a name="273004272"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Should%20this%20be%20added%20to%20lean%204%3F/near/273004272" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joseph O <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Should.20this.20be.20added.20to.20lean.204.3F.html#273004272">(Feb 23 2022 at 20:06)</a>:</h4>
<p><span class="user-mention silent" data-user-id="395550">Henrik Böving</span> <a href="#narrow/stream/270676-lean4/topic/Should.20this.20be.20added.20to.20lean.204.3F/near/273003597">said</a>:</p>
<blockquote>
<p>I feel like the <code>for x in [a:b]</code> is an amazing functionality by itself already, sure it could be improved but it's already very useful when you are writing code in a more imperative style</p>
</blockquote>
<p>How many people here write in an imperative style? Are we going to exclude functional style for ranges just because we feel like it?</p>



<a name="273004361"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Should%20this%20be%20added%20to%20lean%204%3F/near/273004361" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joseph O <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Should.20this.20be.20added.20to.20lean.204.3F.html#273004361">(Feb 23 2022 at 20:07)</a>:</h4>
<p>You arent really giving good arguments</p>



<a name="273004650"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Should%20this%20be%20added%20to%20lean%204%3F/near/273004650" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Henrik Böving <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Should.20this.20be.20added.20to.20lean.204.3F.html#273004650">(Feb 23 2022 at 20:09)</a>:</h4>
<p>I've for example written code with for loops in doc-gen 4, besides I'm not making a point against extending the functionality, I'm merely making a point against "barely any functionality"</p>



<a name="273004790"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Should%20this%20be%20added%20to%20lean%204%3F/near/273004790" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Should.20this.20be.20added.20to.20lean.204.3F.html#273004790">(Feb 23 2022 at 20:10)</a>:</h4>
<p>One reason to prefer the for loop over the list operations, at least in current lean 4, is that the latter uses a lot more memory. For loops actually compile roughly to for loops, while list operations also compile to creating big linked lists and consuming them</p>



<a name="273005023"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Should%20this%20be%20added%20to%20lean%204%3F/near/273005023" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Should.20this.20be.20added.20to.20lean.204.3F.html#273005023">(Feb 23 2022 at 20:12)</a>:</h4>
<p>But that's not to say that we shouldn't have a <code>Range.toList</code>, that seems like a simple addition. I don't think you posted an implementation of this anywhere though</p>



<a name="273005105"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Should%20this%20be%20added%20to%20lean%204%3F/near/273005105" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joseph O <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Should.20this.20be.20added.20to.20lean.204.3F.html#273005105">(Feb 23 2022 at 20:12)</a>:</h4>
<p>I can do that now if you want</p>



<a name="273005158"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Should%20this%20be%20added%20to%20lean%204%3F/near/273005158" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Should.20this.20be.20added.20to.20lean.204.3F.html#273005158">(Feb 23 2022 at 20:13)</a>:</h4>
<p>All of the other functions there exist already, right?</p>



<a name="273005277"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Should%20this%20be%20added%20to%20lean%204%3F/near/273005277" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Should.20this.20be.20added.20to.20lean.204.3F.html#273005277">(Feb 23 2022 at 20:14)</a>:</h4>
<p>You can write a <code>toList</code> function generic over <code>Stream</code>, although I think you can't prove it terminates in general</p>



<a name="273005408"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Should%20this%20be%20added%20to%20lean%204%3F/near/273005408" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Should.20this.20be.20added.20to.20lean.204.3F.html#273005408">(Feb 23 2022 at 20:15)</a>:</h4>
<p>it is a bit easier to translate to an array instead of a list, because you push to the end of an array</p>



<a name="273005516"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Should%20this%20be%20added%20to%20lean%204%3F/near/273005516" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Should.20this.20be.20added.20to.20lean.204.3F.html#273005516">(Feb 23 2022 at 20:16)</a>:</h4>
<p>plus arrays have just as much functional API as lists in lean 4</p>



<a name="273005660"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Should%20this%20be%20added%20to%20lean%204%3F/near/273005660" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joseph O <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Should.20this.20be.20added.20to.20lean.204.3F.html#273005660">(Feb 23 2022 at 20:17)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">private</span> <span class="kd">def</span> <span class="n">List.range'</span> <span class="o">(</span><span class="n">start</span> <span class="n">stop</span> <span class="o">:</span> <span class="n">Nat</span><span class="o">)</span> <span class="o">:=</span>
  <span class="n">List.drop</span> <span class="n">start</span> <span class="bp">$</span> <span class="n">List.range</span> <span class="n">stop</span>

<span class="kn">private</span> <span class="kd">def</span> <span class="n">List.range''</span> <span class="o">(</span><span class="n">start</span> <span class="n">stop</span> <span class="o">:</span> <span class="n">Nat</span><span class="o">)</span> <span class="o">:</span> <span class="n">Nat</span> <span class="bp">→</span> <span class="n">List</span> <span class="n">Nat</span>
  <span class="bp">|</span> <span class="mi">1</span> <span class="bp">=&gt;</span> <span class="n">List.range'</span> <span class="n">start</span> <span class="n">stop</span>
  <span class="bp">|</span> <span class="n">step</span> <span class="bp">=&gt;</span> <span class="o">(</span><span class="n">List.range'</span> <span class="n">start</span> <span class="n">stop</span><span class="o">)</span><span class="bp">.</span><span class="n">filter</span> <span class="o">(</span><span class="k">fun</span> <span class="n">x</span> <span class="bp">=&gt;</span> <span class="o">(</span><span class="n">x</span> <span class="bp">=</span> <span class="mi">0</span><span class="o">)</span> <span class="bp">||</span> <span class="o">(</span><span class="n">x</span> <span class="bp">%</span> <span class="n">step</span> <span class="bp">=</span> <span class="mi">0</span><span class="o">))</span>

<span class="kd">def</span> <span class="n">toList</span> <span class="o">:</span> <span class="n">Range</span> <span class="bp">→</span> <span class="n">List</span> <span class="n">Nat</span>
  <span class="bp">|</span> <span class="o">{</span> <span class="n">start</span> <span class="o">:=</span> <span class="n">m</span><span class="o">,</span> <span class="n">stop</span> <span class="o">:=</span> <span class="n">n</span><span class="o">,</span> <span class="n">step</span> <span class="o">:=</span> <span class="n">o</span><span class="o">}</span> <span class="bp">=&gt;</span> <span class="n">List.range''</span> <span class="n">m</span> <span class="n">n</span> <span class="n">o</span>

<span class="k">#eval</span> <span class="o">[</span><span class="mi">4</span><span class="o">:</span><span class="mi">1000</span><span class="o">:</span><span class="mi">5</span><span class="o">]</span><span class="bp">.</span><span class="n">toList</span>
</code></pre></div>



<a name="273005712"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Should%20this%20be%20added%20to%20lean%204%3F/near/273005712" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joseph O <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Should.20this.20be.20added.20to.20lean.204.3F.html#273005712">(Feb 23 2022 at 20:17)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110049">Mario Carneiro</span> <a href="#narrow/stream/270676-lean4/topic/Should.20this.20be.20added.20to.20lean.204.3F/near/273005158">said</a>:</p>
<blockquote>
<p>All of the other functions there exist already, right?</p>
</blockquote>
<p>not really</p>



<a name="273007532"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Should%20this%20be%20added%20to%20lean%204%3F/near/273007532" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Should.20this.20be.20added.20to.20lean.204.3F.html#273007532">(Feb 23 2022 at 20:32)</a>:</h4>
<p>Hm, if your step size is large then that creates a lot of elements. You can leverage the <code>ForIn</code> instance to construct the array for you:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">def</span> <span class="n">Std.Range.toArray</span> <span class="o">(</span><span class="n">r</span> <span class="o">:</span> <span class="n">Std.Range</span><span class="o">)</span> <span class="o">:</span> <span class="n">Array</span> <span class="n">Nat</span> <span class="o">:=</span> <span class="n">Id.run</span> <span class="k">do</span>
  <span class="k">let</span> <span class="n">mut</span> <span class="n">arr</span> <span class="o">:=</span> <span class="bp">#</span><span class="o">[]</span>
  <span class="n">for</span> <span class="n">i</span> <span class="k">in</span> <span class="n">r</span> <span class="k">do</span>
    <span class="n">arr</span> <span class="o">:=</span> <span class="n">arr.push</span> <span class="n">i</span>
  <span class="n">pure</span> <span class="n">arr</span>

<span class="kd">def</span> <span class="n">Std.Range.toList</span> <span class="o">(</span><span class="n">r</span> <span class="o">:</span> <span class="n">Std.Range</span><span class="o">)</span> <span class="o">:</span> <span class="n">List</span> <span class="n">Nat</span> <span class="o">:=</span> <span class="n">r.toArray.toList</span>

<span class="kd">def</span> <span class="n">foo</span> <span class="o">:</span> <span class="n">List</span> <span class="o">(</span><span class="n">List</span> <span class="n">Nat</span><span class="o">)</span> <span class="o">:=</span>
  <span class="o">[</span><span class="mi">28</span><span class="o">:</span><span class="mi">1000</span><span class="o">]</span>
  <span class="bp">|&gt;.</span><span class="n">toList</span>
  <span class="bp">|&gt;.</span><span class="n">map</span> <span class="o">(</span><span class="k">fun</span> <span class="n">n</span> <span class="bp">=&gt;</span> <span class="o">[:</span><span class="n">n</span><span class="o">]</span> <span class="bp">|&gt;.</span><span class="n">toList</span> <span class="bp">|&gt;.</span><span class="n">filter</span> <span class="o">(</span><span class="n">n</span> <span class="bp">%</span> <span class="bp">·</span> <span class="bp">=</span> <span class="mi">0</span><span class="o">))</span>
  <span class="bp">|&gt;.</span><span class="n">filter</span> <span class="o">(</span><span class="bp">·.</span><span class="n">length</span> <span class="bp">=</span> <span class="mi">2</span><span class="o">)</span>
</code></pre></div>



<a name="273007760"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Should%20this%20be%20added%20to%20lean%204%3F/near/273007760" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joseph O <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Should.20this.20be.20added.20to.20lean.204.3F.html#273007760">(Feb 23 2022 at 20:34)</a>:</h4>
<p>I guess that makes sense</p>



<a name="273007793"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Should%20this%20be%20added%20to%20lean%204%3F/near/273007793" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Should.20this.20be.20added.20to.20lean.204.3F.html#273007793">(Feb 23 2022 at 20:34)</a>:</h4>
<p>Note that the indirection through arrays is deliberate. Even if you want to construct a list in the end, it's more efficient to construct the array first and tail-recursively convert it to a list at the end</p>



<a name="273007808"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Should%20this%20be%20added%20to%20lean%204%3F/near/273007808" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joseph O <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Should.20this.20be.20added.20to.20lean.204.3F.html#273007808">(Feb 23 2022 at 20:35)</a>:</h4>
<p>I see</p>



<a name="273007844"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Should%20this%20be%20added%20to%20lean%204%3F/near/273007844" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joseph O <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Should.20this.20be.20added.20to.20lean.204.3F.html#273007844">(Feb 23 2022 at 20:35)</a>:</h4>
<p>You might as well make the pr now.</p>



<a name="273007854"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Should%20this%20be%20added%20to%20lean%204%3F/near/273007854" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Should.20this.20be.20added.20to.20lean.204.3F.html#273007854">(Feb 23 2022 at 20:35)</a>:</h4>
<p>Here's another way to write the <code>toArray</code> function:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">def</span> <span class="n">Std.Range.toArray</span> <span class="o">(</span><span class="n">r</span> <span class="o">:</span> <span class="n">Std.Range</span><span class="o">)</span> <span class="o">:</span> <span class="n">Array</span> <span class="n">Nat</span> <span class="o">:=</span>
  <span class="n">Id.run</span> <span class="bp">&lt;|</span> <span class="n">r.forIn</span> <span class="bp">#</span><span class="o">[]</span> <span class="k">fun</span> <span class="n">i</span> <span class="n">arr</span> <span class="bp">=&gt;</span> <span class="n">ForInStep.yield</span> <span class="o">(</span><span class="n">arr.push</span> <span class="n">i</span><span class="o">)</span>
</code></pre></div>



<a name="273007872"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Should%20this%20be%20added%20to%20lean%204%3F/near/273007872" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Should.20this.20be.20added.20to.20lean.204.3F.html#273007872">(Feb 23 2022 at 20:35)</a>:</h4>
<p>it's the same thing but without the do notation sugar</p>



<a name="273008029"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Should%20this%20be%20added%20to%20lean%204%3F/near/273008029" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Should.20this.20be.20added.20to.20lean.204.3F.html#273008029">(Feb 23 2022 at 20:37)</a>:</h4>
<p>This is a collaboration not a competition. This is still your PR, there is still documentation and examples, and maybe there are other streams that could also use <code>toArray</code> or <code>toList</code> functions</p>



<a name="273008044"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Should%20this%20be%20added%20to%20lean%204%3F/near/273008044" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joseph O <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Should.20this.20be.20added.20to.20lean.204.3F.html#273008044">(Feb 23 2022 at 20:37)</a>:</h4>
<p>If you think this is useful to add,  you can add it. I am not going to copy someone's code and claim it to be mine</p>



<a name="273008135"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Should%20this%20be%20added%20to%20lean%204%3F/near/273008135" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Should.20this.20be.20added.20to.20lean.204.3F.html#273008135">(Feb 23 2022 at 20:38)</a>:</h4>
<p>You do realize that most of mathlib's files have multiple authors, right?</p>



<a name="273008176"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Should%20this%20be%20added%20to%20lean%204%3F/near/273008176" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joseph O <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Should.20this.20be.20added.20to.20lean.204.3F.html#273008176">(Feb 23 2022 at 20:38)</a>:</h4>
<p>Yes I do, but I didn't author anything here</p>



<a name="273008250"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Should%20this%20be%20added%20to%20lean%204%3F/near/273008250" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Should.20this.20be.20added.20to.20lean.204.3F.html#273008250">(Feb 23 2022 at 20:39)</a>:</h4>
<p>Sure you did, you came up with the idea and wrote a v1 implementation, which makes you first author by mathlib rules</p>



<a name="273008363"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Should%20this%20be%20added%20to%20lean%204%3F/near/273008363" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Should.20this.20be.20added.20to.20lean.204.3F.html#273008363">(Feb 23 2022 at 20:40)</a>:</h4>
<p>and like I said this isn't a PR yet</p>



<a name="273008373"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Should%20this%20be%20added%20to%20lean%204%3F/near/273008373" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Should.20this.20be.20added.20to.20lean.204.3F.html#273008373">(Feb 23 2022 at 20:40)</a>:</h4>
<p>this is a function</p>



<a name="273008724"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Should%20this%20be%20added%20to%20lean%204%3F/near/273008724" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joseph O <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Should.20this.20be.20added.20to.20lean.204.3F.html#273008724">(Feb 23 2022 at 20:43)</a>:</h4>
<p>Hmm. So this will be added to mathlib not lean4?</p>



<a name="273008762"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Should%20this%20be%20added%20to%20lean%204%3F/near/273008762" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Should.20this.20be.20added.20to.20lean.204.3F.html#273008762">(Feb 23 2022 at 20:43)</a>:</h4>
<p>Yes, as you can see it works just as well if it's not in core</p>



<a name="273008839"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Should%20this%20be%20added%20to%20lean%204%3F/near/273008839" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Should.20this.20be.20added.20to.20lean.204.3F.html#273008839">(Feb 23 2022 at 20:44)</a>:</h4>
<p>lean 4 is designed to be extensible from outside the core distribution</p>



<a name="273008908"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Should%20this%20be%20added%20to%20lean%204%3F/near/273008908" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Should.20this.20be.20added.20to.20lean.204.3F.html#273008908">(Feb 23 2022 at 20:44)</a>:</h4>
<p>You also suggested a <code>ToString</code> and a <code>Repr</code> instance above. Can you use the <code>s!</code> macro to write that?</p>



<a name="273008988"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Should%20this%20be%20added%20to%20lean%204%3F/near/273008988" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joseph O <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Should.20this.20be.20added.20to.20lean.204.3F.html#273008988">(Feb 23 2022 at 20:45)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110049">Mario Carneiro</span> <a href="#narrow/stream/270676-lean4/topic/Should.20this.20be.20added.20to.20lean.204.3F/near/273008908">said</a>:</p>
<blockquote>
<p>You also suggested a <code>ToString</code> and a <code>Repr</code> instance above. Can you use the <code>s!</code> macro to write that?</p>
</blockquote>
<p>I mean, the instances would have been simple</p>



<a name="273008995"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Should%20this%20be%20added%20to%20lean%204%3F/near/273008995" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joseph O <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Should.20this.20be.20added.20to.20lean.204.3F.html#273008995">(Feb 23 2022 at 20:45)</a>:</h4>
<p>to write</p>



<a name="273009008"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Should%20this%20be%20added%20to%20lean%204%3F/near/273009008" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Should.20this.20be.20added.20to.20lean.204.3F.html#273009008">(Feb 23 2022 at 20:45)</a>:</h4>
<p>okay, then write them</p>



<a name="273009024"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Should%20this%20be%20added%20to%20lean%204%3F/near/273009024" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Should.20this.20be.20added.20to.20lean.204.3F.html#273009024">(Feb 23 2022 at 20:45)</a>:</h4>
<p>you have to start somewhere</p>



<a name="273009100"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Should%20this%20be%20added%20to%20lean%204%3F/near/273009100" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Should.20this.20be.20added.20to.20lean.204.3F.html#273009100">(Feb 23 2022 at 20:46)</a>:</h4>
<p>API design is more than you are giving credit for</p>



<a name="273009214"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Should%20this%20be%20added%20to%20lean%204%3F/near/273009214" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Should.20this.20be.20added.20to.20lean.204.3F.html#273009214">(Feb 23 2022 at 20:47)</a>:</h4>
<p>for instance, is it printed like <code>[1, 3, 5, ..., 17]</code> or <code>[1 : 17 : 2]</code> or <code>[1:17:2]</code></p>



<a name="273009326"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Should%20this%20be%20added%20to%20lean%204%3F/near/273009326" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Should.20this.20be.20added.20to.20lean.204.3F.html#273009326">(Feb 23 2022 at 20:48)</a>:</h4>
<p>the function is easy to write, but there are bikeshedding issues everywhere you look</p>



<a name="273009989"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Should%20this%20be%20added%20to%20lean%204%3F/near/273009989" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joseph O <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Should.20this.20be.20added.20to.20lean.204.3F.html#273009989">(Feb 23 2022 at 20:53)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110049">Mario Carneiro</span> <a href="#narrow/stream/270676-lean4/topic/Should.20this.20be.20added.20to.20lean.204.3F/near/273009214">said</a>:</p>
<blockquote>
<p>for instance, is it printed like <code>[1, 3, 5, ..., 17]</code> or <code>[1 : 17 : 2]</code> or <code>[1:17:2]</code></p>
</blockquote>
<p>I was thinking <code>[1:17:2]</code></p>



<a name="273010854"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Should%20this%20be%20added%20to%20lean%204%3F/near/273010854" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Should.20this.20be.20added.20to.20lean.204.3F.html#273010854">(Feb 23 2022 at 21:00)</a>:</h4>
<p>I think you're right. (It should look like the input syntax and have the same style, more or less.) Small PRs like that are generally uncontroversial, and will help you get practice for larger changes</p>



<a name="273011038"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Should%20this%20be%20added%20to%20lean%204%3F/near/273011038" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joseph O <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Should.20this.20be.20added.20to.20lean.204.3F.html#273011038">(Feb 23 2022 at 21:02)</a>:</h4>
<p>Im having trouble with repr. I have a repr instance for my tuple type, and it takes a string, but this isnt workng</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">instance</span> <span class="o">:</span> <span class="n">Repr</span> <span class="n">Range</span> <span class="n">where</span>
  <span class="n">reprPrec</span> <span class="n">range</span> <span class="o">:=</span> <span class="s2">"["</span> <span class="bp">++</span> <span class="n">reprPrec</span> <span class="n">range.start</span> <span class="mi">0</span> <span class="bp">++</span> <span class="s2">":"</span> <span class="bp">++</span> <span class="n">reprPrec</span> <span class="n">range.stop</span> <span class="mi">0</span> <span class="bp">++</span> <span class="s2">":"</span> <span class="bp">++</span> <span class="n">reprPrec</span> <span class="n">range.step</span> <span class="mi">0</span> <span class="bp">++</span> <span class="s2">"]"</span>
</code></pre></div>



<a name="273011058"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Should%20this%20be%20added%20to%20lean%204%3F/near/273011058" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joseph O <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Should.20this.20be.20added.20to.20lean.204.3F.html#273011058">(Feb 23 2022 at 21:02)</a>:</h4>
<p>(i tried using the s! macro, but that didnt work)</p>



<a name="273011321"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Should%20this%20be%20added%20to%20lean%204%3F/near/273011321" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Should.20this.20be.20added.20to.20lean.204.3F.html#273011321">(Feb 23 2022 at 21:04)</a>:</h4>
<p>is that a MWE? Because if so you are missing an <code>open</code></p>



<a name="273011409"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Should%20this%20be%20added%20to%20lean%204%3F/near/273011409" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joseph O <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Should.20this.20be.20added.20to.20lean.204.3F.html#273011409">(Feb 23 2022 at 21:05)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110049">Mario Carneiro</span> <a href="#narrow/stream/270676-lean4/topic/Should.20this.20be.20added.20to.20lean.204.3F/near/273011321">said</a>:</p>
<blockquote>
<p>is that a MWE? Because if so you are missing an <code>open</code></p>
</blockquote>
<p>here is a MWE:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">namespace</span> <span class="n">Std</span>

<span class="kd">instance</span> <span class="o">:</span> <span class="n">Repr</span> <span class="n">Range</span> <span class="n">where</span>
  <span class="n">reprPrec</span> <span class="n">range</span> <span class="o">:=</span> <span class="s2">"["</span> <span class="bp">++</span> <span class="n">reprPrec</span> <span class="n">range.start</span> <span class="mi">0</span> <span class="bp">++</span> <span class="s2">":"</span> <span class="bp">++</span> <span class="n">reprPrec</span> <span class="n">range.stop</span> <span class="mi">0</span> <span class="bp">++</span> <span class="s2">":"</span> <span class="bp">++</span> <span class="n">reprPrec</span> <span class="n">range.step</span> <span class="mi">0</span> <span class="bp">++</span> <span class="s2">"]"</span>

<span class="kd">end</span>  <span class="n">Std</span>
</code></pre></div>



<a name="273011597"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Should%20this%20be%20added%20to%20lean%204%3F/near/273011597" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Should.20this.20be.20added.20to.20lean.204.3F.html#273011597">(Feb 23 2022 at 21:07)</a>:</h4>
<p>If you write</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">namespace</span> <span class="n">Std</span>
<span class="kd">instance</span> <span class="o">:</span> <span class="n">Repr</span> <span class="n">Range</span> <span class="n">where</span>
  <span class="n">reprPrec</span> <span class="n">range</span> <span class="o">:=</span> <span class="n">_</span>
</code></pre></div>
<p>and put your cursor over the <code>_</code> you will see that it is expecting a <code>Nat -&gt; Format</code>, which means it is expecting another argument</p>



<a name="273011623"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Should%20this%20be%20added%20to%20lean%204%3F/near/273011623" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joseph O <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Should.20this.20be.20added.20to.20lean.204.3F.html#273011623">(Feb 23 2022 at 21:07)</a>:</h4>
<p>Ah, I got it</p>



<a name="273011667"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Should%20this%20be%20added%20to%20lean%204%3F/near/273011667" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joseph O <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Should.20this.20be.20added.20to.20lean.204.3F.html#273011667">(Feb 23 2022 at 21:07)</a>:</h4>
<p>Should the <code>s!</code> macro work now?</p>



<a name="273011712"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Should%20this%20be%20added%20to%20lean%204%3F/near/273011712" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joseph O <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Should.20this.20be.20added.20to.20lean.204.3F.html#273011712">(Feb 23 2022 at 21:08)</a>:</h4>
<p>Let me try</p>



<a name="273011751"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Should%20this%20be%20added%20to%20lean%204%3F/near/273011751" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Should.20this.20be.20added.20to.20lean.204.3F.html#273011751">(Feb 23 2022 at 21:08)</a>:</h4>
<p>the second argument is the precedence under which to display the expression by the way. Since this is a bracketed expression, it looks the same regardless of precedence so you can ignore it</p>



<a name="273011801"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Should%20this%20be%20added%20to%20lean%204%3F/near/273011801" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joseph O <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Should.20this.20be.20added.20to.20lean.204.3F.html#273011801">(Feb 23 2022 at 21:09)</a>:</h4>
<p>Yeah, it does. Ok, it all works</p>



<a name="273011814"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Should%20this%20be%20added%20to%20lean%204%3F/near/273011814" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Should.20this.20be.20added.20to.20lean.204.3F.html#273011814">(Feb 23 2022 at 21:09)</a>:</h4>
<p>also, since it wants a <code>Format</code> and not a <code>String</code> you should use <code>f!</code> instead of <code>s!</code></p>



<a name="273011839"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Should%20this%20be%20added%20to%20lean%204%3F/near/273011839" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joseph O <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Should.20this.20be.20added.20to.20lean.204.3F.html#273011839">(Feb 23 2022 at 21:09)</a>:</h4>
<p><code>s!</code> worked though</p>



<a name="273011953"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Should%20this%20be%20added%20to%20lean%204%3F/near/273011953" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Should.20this.20be.20added.20to.20lean.204.3F.html#273011953">(Feb 23 2022 at 21:10)</a>:</h4>
<p><span class="user-mention silent" data-user-id="387244">Yaël Dillies</span> <a href="#narrow/stream/113488-general/topic/Replacing.20Git.2BGitHub/near/273006122">said</a>:</p>
<blockquote>
<p>That makes a good motto: Code that compiles is not code that works.</p>
</blockquote>



<a name="273011954"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Should%20this%20be%20added%20to%20lean%204%3F/near/273011954" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joseph O <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Should.20this.20be.20added.20to.20lean.204.3F.html#273011954">(Feb 23 2022 at 21:10)</a>:</h4>
<p>And is it ok if I do</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="k">#eval</span> <span class="o">[:</span><span class="mi">17</span><span class="o">]</span>
</code></pre></div>
<p>it evaluates that to <code>[0:17:1]</code>, or should it just evaluate to <code>[:17]</code></p>



<a name="273011994"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Should%20this%20be%20added%20to%20lean%204%3F/near/273011994" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Should.20this.20be.20added.20to.20lean.204.3F.html#273011994">(Feb 23 2022 at 21:10)</a>:</h4>
<p>I think it should print as <code>[:17]</code> if possible</p>



<a name="273014144"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Should%20this%20be%20added%20to%20lean%204%3F/near/273014144" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joseph O <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Should.20this.20be.20added.20to.20lean.204.3F.html#273014144">(Feb 23 2022 at 21:31)</a>:</h4>
<p>Do you have an idea for a nice way of doing that. I would prefer some verbal context, as to try it out mainly myself, but I don't mind if you share code yourself.</p>



<a name="273022023"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Should%20this%20be%20added%20to%20lean%204%3F/near/273022023" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Should.20this.20be.20added.20to.20lean.204.3F.html#273022023">(Feb 23 2022 at 22:39)</a>:</h4>
<p><span class="user-mention" data-user-id="467926">@Joseph O</span> Do a pattern match on range, with cases for <code>&lt;0, stop, 1&gt;</code>, <code>&lt;0, stop, step&gt;</code>, <code>&lt;start, stop, 1&gt;</code>, <code>&lt;start, stop, step&gt;</code></p>



<a name="273025323"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Should%20this%20be%20added%20to%20lean%204%3F/near/273025323" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yakov Pechersky <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Should.20this.20be.20added.20to.20lean.204.3F.html#273025323">(Feb 23 2022 at 23:13)</a>:</h4>
<blockquote>
<p>I think you're right. (It should look like the input syntax and have the same style, more or less.)</p>
</blockquote>
<p>Is there a nice way in lean4 to prove that repr roundtrips?</p>



<a name="273035973"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Should%20this%20be%20added%20to%20lean%204%3F/near/273035973" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joseph O <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Should.20this.20be.20added.20to.20lean.204.3F.html#273035973">(Feb 24 2022 at 01:21)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110049">Mario Carneiro</span> <a href="#narrow/stream/270676-lean4/topic/Should.20this.20be.20added.20to.20lean.204.3F/near/273022023">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="467926">Joseph O</span> Do a pattern match on range, with cases for <code>&lt;0, stop, 1&gt;</code>, <code>&lt;0, stop, step&gt;</code>, <code>&lt;start, stop, 1&gt;</code>, <code>&lt;start, stop, step&gt;</code></p>
</blockquote>
<p>ok</p>



<a name="273036043"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Should%20this%20be%20added%20to%20lean%204%3F/near/273036043" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joseph O <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Should.20this.20be.20added.20to.20lean.204.3F.html#273036043">(Feb 24 2022 at 01:22)</a>:</h4>
<p>Should I make an auxiliary function to do that?</p>



<a name="273036234"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Should%20this%20be%20added%20to%20lean%204%3F/near/273036234" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joseph O <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Should.20this.20be.20added.20to.20lean.204.3F.html#273036234">(Feb 24 2022 at 01:26)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110049">Mario Carneiro</span> <a href="#narrow/stream/270676-lean4/topic/Should.20this.20be.20added.20to.20lean.204.3F/near/273007854">said</a>:</p>
<blockquote>
<p>Here's another way to write the <code>toArray</code> function:</p>
<p><div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">def</span> <span class="n">Std.Range.toArray</span> <span class="o">(</span><span class="n">r</span> <span class="o">:</span> <span class="n">Std.Range</span><span class="o">)</span> <span class="o">:</span> <span class="n">Array</span> <span class="n">Nat</span> <span class="o">:=</span>
  <span class="n">Id.run</span> <span class="bp">&lt;|</span> <span class="n">r.forIn</span> <span class="bp">#</span><span class="o">[]</span> <span class="k">fun</span> <span class="n">i</span> <span class="n">arr</span> <span class="bp">=&gt;</span> <span class="n">ForInStep.yield</span> <span class="o">(</span><span class="n">arr.push</span> <span class="n">i</span><span class="o">)</span>
</code></pre></div><br>
</p>
</blockquote>
<p>Does doing it this way provide any benefit?</p>



<a name="273036370"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Should%20this%20be%20added%20to%20lean%204%3F/near/273036370" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joseph O <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Should.20this.20be.20added.20to.20lean.204.3F.html#273036370">(Feb 24 2022 at 01:28)</a>:</h4>
<p>Also, is there anywhere I can learn how to use generators like you used here in lean 4?</p>



<a name="273038374"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Should%20this%20be%20added%20to%20lean%204%3F/near/273038374" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joseph O <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Should.20this.20be.20added.20to.20lean.204.3F.html#273038374">(Feb 24 2022 at 02:03)</a>:</h4>
<p>Is it ok to have to Pull requests open at the same time?</p>



<a name="273038473"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Should%20this%20be%20added%20to%20lean%204%3F/near/273038473" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joseph O <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Should.20this.20be.20added.20to.20lean.204.3F.html#273038473">(Feb 24 2022 at 02:04)</a>:</h4>
<p>But are you sure something like this shouldn't be added to <code>lean4</code> itself? Like, why was <code>Hashmap.ofList</code> deemed good enough to add to the core std, for instance?</p>



<a name="273041178"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Should%20this%20be%20added%20to%20lean%204%3F/near/273041178" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Should.20this.20be.20added.20to.20lean.204.3F.html#273041178">(Feb 24 2022 at 02:58)</a>:</h4>
<p>I don't think it's a matter of something being "good enough" or not. If something isn't good enough, it won't make it to mathlib either.</p>
<p>As I said in the issue, it's standard for programming languages to provide easy interfaces to instantiate their own versions of hash maps out of the box</p>



<a name="273045286"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Should%20this%20be%20added%20to%20lean%204%3F/near/273045286" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Siddhartha Gadgil <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Should.20this.20be.20added.20to.20lean.204.3F.html#273045286">(Feb 24 2022 at 04:10)</a>:</h4>
<p>Just a possibility (following scala design) - one can have a typeclass <code>Seq α</code> with a <code>toArray</code> field, with methods like <code>Seq.toList</code>implemented using this. Also from <code>Seq (α × Nat)</code> we can generate a HashMap. <code>Range</code> should then have a <code>Seq</code> instance.  I would be happy to make rough implementations for discussion.</p>
<p>Incidentally I also needed <code>HashMap.fromList</code> and <code>HashMap.fromArray</code>.</p>



<a name="273045434"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Should%20this%20be%20added%20to%20lean%204%3F/near/273045434" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Should.20this.20be.20added.20to.20lean.204.3F.html#273045434">(Feb 24 2022 at 04:12)</a>:</h4>
<p><span class="user-mention silent" data-user-id="467926">Joseph O</span> <a href="#narrow/stream/270676-lean4/topic/Should.20this.20be.20added.20to.20lean.204.3F/near/273002076">said</a>:</p>
<blockquote>
<p>very basic example</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">def</span> <span class="n">foo</span> <span class="o">:=</span>
  <span class="o">[</span><span class="mi">28</span><span class="o">:</span><span class="mi">1000</span><span class="o">]</span>
  <span class="bp">|&gt;.</span><span class="n">toList</span>
  <span class="bp">|&gt;.</span><span class="n">map</span> <span class="o">(</span><span class="k">fun</span> <span class="n">n</span> <span class="bp">=&gt;</span> <span class="o">[:</span><span class="n">n</span><span class="o">]</span> <span class="bp">|&gt;.</span><span class="n">toList</span> <span class="bp">|&gt;.</span><span class="n">filter</span> <span class="o">(</span><span class="n">n</span> <span class="bp">%</span> <span class="bp">·</span> <span class="bp">=</span> <span class="mi">0</span><span class="o">))</span>
  <span class="bp">|&gt;.</span><span class="n">filter</span> <span class="o">(</span><span class="bp">·.</span><span class="n">length</span> <span class="bp">=</span> <span class="mi">2</span><span class="o">)</span>
</code></pre></div>
<p>i am unlikely this will convince you. If you want another better example, let me know</p>
</blockquote>
<p>You might find my  WIP <a href="https://github.com/tydeu/lean4-itertools">lean4-itertools</a> library to be of interest. I was designed exactly to help do this kind of thing.</p>



<a name="273078459"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Should%20this%20be%20added%20to%20lean%204%3F/near/273078459" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joseph O <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Should.20this.20be.20added.20to.20lean.204.3F.html#273078459">(Feb 24 2022 at 11:46)</a>:</h4>
<p><span class="user-mention silent" data-user-id="451983">Arthur Paulino</span> <a href="#narrow/stream/270676-lean4/topic/Should.20this.20be.20added.20to.20lean.204.3F/near/273041178">said</a>:</p>
<blockquote>
<p>I don't think it's a matter of something being "good enough" or not. If something isn't good enough, it won't make it to mathlib either.</p>
<p>As I said in the <code>HashMap.ofList</code> issue, it's standard for programming languages to provide easy interfaces to instantiate their own versions of hash maps out of the box</p>
</blockquote>
<p>Converting ranges to lists are standard in languages as well, in fact, most ranges in langs are lists from the start, just written in shorter notation</p>



<a name="273080655"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Should%20this%20be%20added%20to%20lean%204%3F/near/273080655" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joseph O <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Should.20this.20be.20added.20to.20lean.204.3F.html#273080655">(Feb 24 2022 at 12:11)</a>:</h4>
<p><span class="user-mention silent" data-user-id="266304">Siddhartha Gadgil</span> <a href="#narrow/stream/270676-lean4/topic/Should.20this.20be.20added.20to.20lean.204.3F/near/273045286">said</a>:</p>
<blockquote>
<p>Just a possibility (following scala design) - one can have a typeclass <code>Seq α</code> with a <code>toArray</code> field, with methods like <code>Seq.toList</code>implemented using this. Also from <code>Seq (α × Nat)</code> we can generate a HashMap. <code>Range</code> should then have a <code>Seq</code> instance.  I would be happy to make rough implementations for discussion.</p>
<p>Incidentally I also needed <code>HashMap.fromList</code> and <code>HashMap.fromArray</code>.</p>
</blockquote>
<p>Interesting idea. This means that Seq (a x Nat) for example would have a method toArray and generate a hash map?</p>



<a name="273090884"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Should%20this%20be%20added%20to%20lean%204%3F/near/273090884" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Siddhartha Gadgil <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Should.20this.20be.20added.20to.20lean.204.3F.html#273090884">(Feb 24 2022 at 13:48)</a>:</h4>
<p>That is what I mean. Indeed one can have an instance of <code>Seq a</code> from an instance of <code>ForIn</code> at least with the correct parameters (I am struggling to understand what <code>ForIn</code> means in general, having only used it in imperative <code>for</code> loops).</p>



<a name="273093070"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Should%20this%20be%20added%20to%20lean%204%3F/near/273093070" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joseph O <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Should.20this.20be.20added.20to.20lean.204.3F.html#273093070">(Feb 24 2022 at 14:05)</a>:</h4>
<p>I guess I should add it to mathlib4 for now and it may be added to the lean 4 std?</p>



<a name="273094585"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Should%20this%20be%20added%20to%20lean%204%3F/near/273094585" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yakov Pechersky <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Should.20this.20be.20added.20to.20lean.204.3F.html#273094585">(Feb 24 2022 at 14:18)</a>:</h4>
<p>A range in python3 is surely not a list by default. Maybe we're talking past each other. Joseph, when you think about and mention lists, are you just referring to any datatype that has indexing, iteration, a length, appending, insertion, mutation at an index; or do you mean some particular implementation like a linked list, doubly linked list, indexed tree?</p>



<a name="273096165"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Should%20this%20be%20added%20to%20lean%204%3F/near/273096165" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Siddhartha Gadgil <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Should.20this.20be.20added.20to.20lean.204.3F.html#273096165">(Feb 24 2022 at 14:31)</a>:</h4>
<p>There are probably better ways in lean than the below, but this is what I meant.</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">universe</span> <span class="n">u</span>
<span class="kd">class</span> <span class="n">Iterable</span> <span class="o">(</span><span class="n">l</span><span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span> <span class="bp">→</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">)</span> <span class="n">where</span>
  <span class="n">toArray</span> <span class="o">:</span> <span class="n">l</span> <span class="n">α</span> <span class="bp">→</span> <span class="n">Array</span> <span class="n">α</span>

<span class="kd">instance</span> <span class="o">:</span> <span class="n">Iterable</span> <span class="n">List</span> <span class="o">:=</span>
  <span class="o">⟨</span><span class="k">fun</span> <span class="n">l</span> <span class="bp">=&gt;</span> <span class="n">l.toArray</span><span class="o">⟩</span>

<span class="kd">instance</span> <span class="o">:</span> <span class="n">Iterable</span> <span class="n">Array</span> <span class="o">:=</span>
  <span class="o">⟨</span><span class="k">fun</span> <span class="n">l</span> <span class="bp">=&gt;</span> <span class="n">l</span><span class="o">⟩</span>

<span class="kd">def</span> <span class="n">mkArray</span> <span class="o">[</span><span class="n">it</span> <span class="o">:</span> <span class="n">Iterable</span> <span class="n">l</span><span class="o">]</span> <span class="o">(</span><span class="n">l</span><span class="o">:</span> <span class="n">l</span> <span class="n">α</span><span class="o">):</span> <span class="n">Array</span> <span class="n">α</span> <span class="o">:=</span>
  <span class="n">it.toArray</span> <span class="n">l</span>

<span class="kd">def</span> <span class="n">mkList</span> <span class="o">[</span><span class="n">it</span> <span class="o">:</span> <span class="n">Iterable</span> <span class="n">l</span><span class="o">]</span> <span class="o">(</span><span class="n">l</span><span class="o">:</span> <span class="n">l</span> <span class="n">α</span><span class="o">):</span> <span class="n">List</span> <span class="n">α</span> <span class="o">:=</span>
  <span class="o">(</span><span class="n">mkArray</span> <span class="n">l</span><span class="o">)</span><span class="bp">.</span><span class="n">toList</span>

<span class="kn">open</span> <span class="n">Std</span>

<span class="kd">def</span> <span class="n">mkHashMap</span> <span class="o">[</span><span class="n">it</span> <span class="o">:</span> <span class="n">Iterable</span> <span class="n">l</span><span class="o">][</span><span class="n">Hashable</span> <span class="n">α</span><span class="o">][</span><span class="n">BEq</span> <span class="n">α</span><span class="o">][</span><span class="n">BEq</span> <span class="n">β</span><span class="o">](</span><span class="n">l</span><span class="o">:</span> <span class="n">l</span> <span class="o">(</span><span class="n">α</span> <span class="bp">×</span> <span class="n">β</span><span class="o">)):</span> <span class="n">HashMap</span> <span class="n">α</span> <span class="n">β</span>   <span class="o">:=</span>
  <span class="o">(</span><span class="n">mkArray</span> <span class="n">l</span><span class="o">)</span><span class="bp">.</span><span class="n">foldl</span> <span class="o">(</span><span class="k">fun</span> <span class="n">acc</span> <span class="o">(</span><span class="n">k</span><span class="o">,</span> <span class="n">v</span><span class="o">)</span> <span class="bp">=&gt;</span> <span class="n">acc.insert</span> <span class="n">k</span> <span class="n">v</span><span class="o">)</span> <span class="n">HashMap.empty</span>
</code></pre></div>



<a name="273096608"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Should%20this%20be%20added%20to%20lean%204%3F/near/273096608" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yakov Pechersky <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Should.20this.20be.20added.20to.20lean.204.3F.html#273096608">(Feb 24 2022 at 14:34)</a>:</h4>
<p>Probably you want mkList and mkHashMap to be fields in the structure that have default implementations, so that one can override. For example, a List's mkList shouldn't need to go through an Array and then to a List</p>



<a name="273097212"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Should%20this%20be%20added%20to%20lean%204%3F/near/273097212" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Siddhartha Gadgil <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Should.20this.20be.20added.20to.20lean.204.3F.html#273097212">(Feb 24 2022 at 14:38)</a>:</h4>
<p>Thanks <span class="user-mention" data-user-id="308899">@Yakov Pechersky</span> I agree and this is something I am learning now.</p>



<a name="273097834"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Should%20this%20be%20added%20to%20lean%204%3F/near/273097834" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Should.20this.20be.20added.20to.20lean.204.3F.html#273097834">(Feb 24 2022 at 14:43)</a>:</h4>
<p><span class="user-mention silent" data-user-id="266304">Siddhartha Gadgil</span> <a href="#narrow/stream/270676-lean4/topic/Should.20this.20be.20added.20to.20lean.204.3F/near/273090884">said</a>:</p>
<blockquote>
<p>That is what I mean. Indeed one can have an instance of <code>Seq a</code> from an instance of <code>ForIn</code> at least with the correct parameters (I am struggling to understand what <code>ForIn</code> means in general, having only used it in imperative <code>for</code> loops).</p>
</blockquote>
<p>A <code>ForIn</code> impl is nothing more or less than the natural requirement for desugaring <code>for</code> loops. You give it a monadic function which reports whether to update the state or early-return, and it folds the function over the data structure or iterable or what have you.</p>



<a name="273098171"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Should%20this%20be%20added%20to%20lean%204%3F/near/273098171" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Should.20this.20be.20added.20to.20lean.204.3F.html#273098171">(Feb 24 2022 at 14:45)</a>:</h4>
<p>It's a bit more general than "iterators" such as you would find in e.g. Rust, because it's not just a <code>next</code> function that gets called repeatedly, you get the loop body itself and can do funny business like reuse old state values or apply the function a transfinite number of times</p>



<a name="273098250"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Should%20this%20be%20added%20to%20lean%204%3F/near/273098250" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yakov Pechersky <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Should.20this.20be.20added.20to.20lean.204.3F.html#273098250">(Feb 24 2022 at 14:46)</a>:</h4>
<p>So like a python generator but with more introspection?</p>



<a name="273098335"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Should%20this%20be%20added%20to%20lean%204%3F/near/273098335" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Should.20this.20be.20added.20to.20lean.204.3F.html#273098335">(Feb 24 2022 at 14:47)</a>:</h4>
<p>I don't think imperative languages without a monad abstraction can express this</p>



<a name="273098419"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Should%20this%20be%20added%20to%20lean%204%3F/near/273098419" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Should.20this.20be.20added.20to.20lean.204.3F.html#273098419">(Feb 24 2022 at 14:48)</a>:</h4>
<p>Python generators are generalized along a different axis, what with the yield point stuff</p>



<a name="273098603"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Should%20this%20be%20added%20to%20lean%204%3F/near/273098603" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Should.20this.20be.20added.20to.20lean.204.3F.html#273098603">(Feb 24 2022 at 14:49)</a>:</h4>
<p>I can imagine <code>do</code> notation gaining the ability to desugar <code>yield</code> expressions as well, but generators are not currently supported</p>



<a name="273099514"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Should%20this%20be%20added%20to%20lean%204%3F/near/273099514" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joseph O <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Should.20this.20be.20added.20to.20lean.204.3F.html#273099514">(Feb 24 2022 at 14:55)</a>:</h4>
<p><span class="user-mention silent" data-user-id="266304">Siddhartha Gadgil</span> <a href="#narrow/stream/270676-lean4/topic/Should.20this.20be.20added.20to.20lean.204.3F/near/273096165">said</a>:</p>
<blockquote>
<p>There are probably better ways in lean than the below, but this is what I meant.</p>
<p><div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">universe</span> <span class="n">u</span>
<span class="kd">class</span> <span class="n">Iterable</span> <span class="o">(</span><span class="n">l</span><span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span> <span class="bp">→</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">)</span> <span class="n">where</span>
  <span class="n">toArray</span> <span class="o">:</span> <span class="n">l</span> <span class="n">α</span> <span class="bp">→</span> <span class="n">Array</span> <span class="n">α</span>

<span class="kd">instance</span> <span class="o">:</span> <span class="n">Iterable</span> <span class="n">List</span> <span class="o">:=</span>
  <span class="o">⟨</span><span class="k">fun</span> <span class="n">l</span> <span class="bp">=&gt;</span> <span class="n">l.toArray</span><span class="o">⟩</span>

<span class="kd">instance</span> <span class="o">:</span> <span class="n">Iterable</span> <span class="n">Array</span> <span class="o">:=</span>
  <span class="o">⟨</span><span class="k">fun</span> <span class="n">l</span> <span class="bp">=&gt;</span> <span class="n">l</span><span class="o">⟩</span>

<span class="kd">def</span> <span class="n">mkArray</span> <span class="o">[</span><span class="n">it</span> <span class="o">:</span> <span class="n">Iterable</span> <span class="n">l</span><span class="o">]</span> <span class="o">(</span><span class="n">l</span><span class="o">:</span> <span class="n">l</span> <span class="n">α</span><span class="o">):</span> <span class="n">Array</span> <span class="n">α</span> <span class="o">:=</span>
  <span class="n">it.toArray</span> <span class="n">l</span>

<span class="kd">def</span> <span class="n">mkList</span> <span class="o">[</span><span class="n">it</span> <span class="o">:</span> <span class="n">Iterable</span> <span class="n">l</span><span class="o">]</span> <span class="o">(</span><span class="n">l</span><span class="o">:</span> <span class="n">l</span> <span class="n">α</span><span class="o">):</span> <span class="n">List</span> <span class="n">α</span> <span class="o">:=</span>
  <span class="o">(</span><span class="n">mkArray</span> <span class="n">l</span><span class="o">)</span><span class="bp">.</span><span class="n">toList</span>

<span class="kn">open</span> <span class="n">Std</span>

<span class="kd">def</span> <span class="n">mkHashMap</span> <span class="o">[</span><span class="n">it</span> <span class="o">:</span> <span class="n">Iterable</span> <span class="n">l</span><span class="o">][</span><span class="n">Hashable</span> <span class="n">α</span><span class="o">][</span><span class="n">BEq</span> <span class="n">α</span><span class="o">][</span><span class="n">BEq</span> <span class="n">β</span><span class="o">](</span><span class="n">l</span><span class="o">:</span> <span class="n">l</span> <span class="o">(</span><span class="n">α</span> <span class="bp">×</span> <span class="n">β</span><span class="o">)):</span> <span class="n">HashMap</span> <span class="n">α</span> <span class="n">β</span>   <span class="o">:=</span>
  <span class="o">(</span><span class="n">mkArray</span> <span class="n">l</span><span class="o">)</span><span class="bp">.</span><span class="n">foldl</span> <span class="o">(</span><span class="k">fun</span> <span class="n">acc</span> <span class="o">(</span><span class="n">k</span><span class="o">,</span> <span class="n">v</span><span class="o">)</span> <span class="bp">=&gt;</span> <span class="n">acc.insert</span> <span class="n">k</span> <span class="n">v</span><span class="o">)</span> <span class="n">HashMap.empty</span>
</code></pre></div><br>
</p>
</blockquote>
<p>This is pretty neat.</p>



<a name="273099592"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Should%20this%20be%20added%20to%20lean%204%3F/near/273099592" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joseph O <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Should.20this.20be.20added.20to.20lean.204.3F.html#273099592">(Feb 24 2022 at 14:56)</a>:</h4>
<p>Yeah, and ranges are not usually lists by default. In F#, they are sequences</p>



<a name="273099687"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Should%20this%20be%20added%20to%20lean%204%3F/near/273099687" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Siddhartha Gadgil <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Should.20this.20be.20added.20to.20lean.204.3F.html#273099687">(Feb 24 2022 at 14:57)</a>:</h4>
<p>Thanks. But the above does not take care of <code>Range</code>,  for which it has to be tweaked.<br>
I'll take a shot at this.</p>



<a name="273100228"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Should%20this%20be%20added%20to%20lean%204%3F/near/273100228" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Should.20this.20be.20added.20to.20lean.204.3F.html#273100228">(Feb 24 2022 at 15:00)</a>:</h4>
<p>You can implement <code>Iterable</code> for anything with a suitable <code>Stream</code> or <code>ForIn</code> implementation</p>



<a name="273100232"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Should%20this%20be%20added%20to%20lean%204%3F/near/273100232" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Should.20this.20be.20added.20to.20lean.204.3F.html#273100232">(Feb 24 2022 at 15:01)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110049">Mario Carneiro</span> <a href="#narrow/stream/270676-lean4/topic/Should.20this.20be.20added.20to.20lean.204.3F/near/273098171">said</a>:</p>
<blockquote>
<p>It's a bit more general than "iterators" such as you would find in e.g. Rust, because it's not just a <code>next</code> function that gets called repeatedly, you get the loop body itself and can do funny business like reuse old state values or apply the function a transfinite number of times</p>
</blockquote>
<p>This is external vs. internal iteration. Internal iteration like <code>ForM</code> is relatively simple to set up and generate good code for, but limited in other regards - you cannot implement <code>zip</code> on two internal iterators, for example. I'd love to see a robust external iteration library for Lean in the future.</p>



<a name="273100294"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Should%20this%20be%20added%20to%20lean%204%3F/near/273100294" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Should.20this.20be.20added.20to.20lean.204.3F.html#273100294">(Feb 24 2022 at 15:01)</a>:</h4>
<p><code>Stream</code> is external iteration, is it not?</p>



<a name="273100668"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Should%20this%20be%20added%20to%20lean%204%3F/near/273100668" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Should.20this.20be.20added.20to.20lean.204.3F.html#273100668">(Feb 24 2022 at 15:04)</a>:</h4>
<p>Hah yes, I forgot we already have it because it is so barebones and therefore barely used</p>



<a name="273101604"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Should%20this%20be%20added%20to%20lean%204%3F/near/273101604" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Should.20this.20be.20added.20to.20lean.204.3F.html#273101604">(Feb 24 2022 at 15:11)</a>:</h4>
<p>We would at least need a new typeclass for bounded streams if we want to make them as useful as <code>ForM</code></p>



<a name="273101648"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Should%20this%20be%20added%20to%20lean%204%3F/near/273101648" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joseph O <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Should.20this.20be.20added.20to.20lean.204.3F.html#273101648">(Feb 24 2022 at 15:11)</a>:</h4>
<p><span class="user-mention silent" data-user-id="266304">Siddhartha Gadgil</span> <a href="#narrow/stream/270676-lean4/topic/Should.20this.20be.20added.20to.20lean.204.3F/near/273099687">said</a>:</p>
<blockquote>
<p>Thanks. But the above does not take care of <code>Range</code>,  for which it has to be tweaked.<br>
I'll take a shot at this.</p>
</blockquote>
<p>It shouldn't take to much tweaking</p>



<a name="273101665"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Should%20this%20be%20added%20to%20lean%204%3F/near/273101665" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joseph O <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Should.20this.20be.20added.20to.20lean.204.3F.html#273101665">(Feb 24 2022 at 15:11)</a>:</h4>
<p>At least if I think about it</p>



<a name="273101910"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Should%20this%20be%20added%20to%20lean%204%3F/near/273101910" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Siddhartha Gadgil <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Should.20this.20be.20added.20to.20lean.204.3F.html#273101910">(Feb 24 2022 at 15:13)</a>:</h4>
<p><span class="user-mention" data-user-id="110049">@Mario Carneiro</span> but does <code>Range</code> have a suitable <code>ForIn</code>. A <code>Range</code> is only an <code>Iterable Nat</code> so if the only parameter of an <code>Iterable</code> is the type family I do not see an implementation.</p>



<a name="273103482"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Should%20this%20be%20added%20to%20lean%204%3F/near/273103482" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Should.20this.20be.20added.20to.20lean.204.3F.html#273103482">(Feb 24 2022 at 15:25)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110049">Mario Carneiro</span> <a href="#narrow/stream/270676-lean4/topic/Should.20this.20be.20added.20to.20lean.204.3F/near/273100294">said</a>:</p>
<blockquote>
<p><code>Stream</code> is external iteration, is it not?</p>
</blockquote>
<p>There is also an interesting comparison to lazy lists, which have a very similar but simpler interface (which may or may not be a problem for code generation). The big difference is of course that lazy lists are provably finite if not defined coinductively. You can still make them infinite using <code>partial</code>, you just won't be able to prove anything about them.</p>



<a name="273103808"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Should%20this%20be%20added%20to%20lean%204%3F/near/273103808" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Siddhartha Gadgil <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Should.20this.20be.20added.20to.20lean.204.3F.html#273103808">(Feb 24 2022 at 15:27)</a>:</h4>
<p>Another take - this is getting more complicated, but includes <code>Range</code>. I am happy to learn how to simplify.</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">universe</span> <span class="n">u</span>
<span class="kd">class</span> <span class="n">Iterable</span> <span class="o">(</span><span class="n">l</span><span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">)(</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">)</span> <span class="n">where</span>
  <span class="n">toArray</span> <span class="o">:</span> <span class="n">l</span>  <span class="bp">→</span> <span class="n">Array</span> <span class="n">α</span>

<span class="kd">class</span> <span class="n">IterableFamily</span> <span class="o">(</span><span class="n">l</span><span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span> <span class="bp">→</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">)</span> <span class="n">where</span>
  <span class="n">toArray</span> <span class="o">:</span> <span class="n">l</span> <span class="n">α</span>  <span class="bp">→</span> <span class="n">Array</span> <span class="n">α</span>

<span class="kd">instance</span> <span class="o">{</span><span class="n">l</span><span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span> <span class="bp">→</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">}[</span><span class="n">it</span> <span class="o">:</span> <span class="n">IterableFamily</span> <span class="n">l</span><span class="o">]</span> <span class="o">(</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">)</span> <span class="o">:</span> <span class="n">Iterable</span> <span class="o">(</span><span class="n">l</span> <span class="n">α</span><span class="o">)</span> <span class="n">α</span> <span class="o">:=</span>
  <span class="o">⟨</span><span class="k">fun</span> <span class="n">x</span> <span class="bp">=&gt;</span> <span class="n">it.toArray</span> <span class="n">x</span><span class="o">⟩</span>

<span class="kd">instance</span> <span class="o">:</span> <span class="n">IterableFamily</span> <span class="n">List</span>    <span class="o">:=</span>
  <span class="o">⟨</span><span class="k">fun</span> <span class="n">l</span> <span class="bp">=&gt;</span> <span class="n">l.toArray</span><span class="o">⟩</span>

<span class="kd">instance</span> <span class="o">:</span> <span class="n">IterableFamily</span> <span class="n">Array</span>   <span class="o">:=</span>
  <span class="o">⟨</span><span class="k">fun</span> <span class="n">l</span> <span class="bp">=&gt;</span> <span class="n">l</span><span class="o">⟩</span>

<span class="kd">def</span> <span class="n">mkArray</span> <span class="o">{</span><span class="n">l</span><span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span> <span class="bp">→</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">}[</span><span class="n">it</span> <span class="o">:</span> <span class="n">Iterable</span> <span class="o">(</span><span class="n">l</span> <span class="n">α</span><span class="o">)</span> <span class="n">α</span><span class="o">]</span> <span class="o">(</span><span class="n">l</span><span class="o">:</span> <span class="n">l</span> <span class="n">α</span><span class="o">):</span> <span class="n">Array</span> <span class="n">α</span> <span class="o">:=</span>
  <span class="n">it.toArray</span> <span class="n">l</span>

<span class="kd">def</span> <span class="n">mkList</span> <span class="o">{</span><span class="n">l</span><span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span> <span class="bp">→</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">}[</span><span class="n">it</span> <span class="o">:</span> <span class="n">Iterable</span> <span class="o">(</span><span class="n">l</span> <span class="n">α</span><span class="o">)</span> <span class="n">α</span><span class="o">]</span> <span class="o">(</span><span class="n">l</span><span class="o">:</span> <span class="n">l</span> <span class="n">α</span><span class="o">):</span> <span class="n">List</span> <span class="n">α</span> <span class="o">:=</span>
  <span class="o">(</span><span class="n">mkArray</span> <span class="n">l</span><span class="o">)</span><span class="bp">.</span><span class="n">toList</span>

<span class="kd">def</span> <span class="n">mkHashMap</span> <span class="o">{</span><span class="n">l</span><span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span> <span class="bp">→</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">}{</span><span class="n">α</span> <span class="n">β</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">}</span>
  <span class="o">[</span><span class="n">it</span> <span class="o">:</span> <span class="n">Iterable</span> <span class="o">(</span><span class="n">l</span> <span class="o">(</span><span class="n">α</span> <span class="bp">×</span> <span class="n">β</span><span class="o">))</span> <span class="o">(</span><span class="n">α</span> <span class="bp">×</span> <span class="n">β</span> <span class="o">)][</span><span class="n">Hashable</span> <span class="n">α</span><span class="o">][</span><span class="n">BEq</span> <span class="n">α</span><span class="o">][</span><span class="n">BEq</span> <span class="n">β</span><span class="o">](</span><span class="n">l</span><span class="o">:</span> <span class="n">l</span> <span class="o">(</span><span class="n">α</span> <span class="bp">×</span> <span class="n">β</span><span class="o">)):</span> <span class="n">HashMap</span> <span class="n">α</span> <span class="n">β</span>   <span class="o">:=</span>
    <span class="o">(</span><span class="n">mkArray</span> <span class="n">l</span><span class="o">)</span><span class="bp">.</span><span class="n">foldl</span> <span class="o">(</span><span class="k">fun</span> <span class="n">acc</span> <span class="o">(</span><span class="n">k</span><span class="o">,</span> <span class="n">v</span><span class="o">)</span> <span class="bp">=&gt;</span> <span class="n">acc.insert</span> <span class="n">k</span> <span class="n">v</span><span class="o">)</span> <span class="n">HashMap.empty</span>

<span class="kd">def</span> <span class="n">ForIn.toArray</span> <span class="o">[</span><span class="n">ForIn</span> <span class="n">Id</span> <span class="n">l</span> <span class="n">α</span><span class="o">](</span><span class="n">x</span> <span class="o">:</span> <span class="n">l</span><span class="o">):</span> <span class="o">(</span><span class="n">Array</span> <span class="n">α</span><span class="o">)</span> <span class="o">:=</span> <span class="n">Id.run</span>
  <span class="k">do</span>
    <span class="k">let</span> <span class="n">mut</span> <span class="n">arr</span> <span class="o">:=</span> <span class="n">Array.mk</span> <span class="o">[]</span>
    <span class="n">for</span> <span class="n">a</span> <span class="k">in</span> <span class="n">x</span> <span class="k">do</span>
      <span class="n">arr</span> <span class="o">:=</span> <span class="n">arr.push</span> <span class="n">a</span>
    <span class="n">return</span> <span class="n">arr</span>

<span class="kd">instance</span> <span class="o">:</span> <span class="n">Iterable</span> <span class="n">Range</span> <span class="n">Nat</span> <span class="o">:=</span>
  <span class="o">⟨</span><span class="k">fun</span> <span class="n">r</span> <span class="bp">=&gt;</span> <span class="n">ForIn.toArray</span> <span class="n">r</span><span class="o">⟩</span>
</code></pre></div>



<a name="273107626"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Should%20this%20be%20added%20to%20lean%204%3F/near/273107626" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joseph O <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Should.20this.20be.20added.20to.20lean.204.3F.html#273107626">(Feb 24 2022 at 15:53)</a>:</h4>
<p>interesting</p>



<a name="273107936"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Should%20this%20be%20added%20to%20lean%204%3F/near/273107936" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joseph O <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Should.20this.20be.20added.20to.20lean.204.3F.html#273107936">(Feb 24 2022 at 15:55)</a>:</h4>
<p>Do you mind showing an example of using this to convert a <code>Range</code> to an <code>Array</code> of some sort?</p>



<a name="273108872"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Should%20this%20be%20added%20to%20lean%204%3F/near/273108872" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Should.20this.20be.20added.20to.20lean.204.3F.html#273108872">(Feb 24 2022 at 16:01)</a>:</h4>
<p>One thing I still haven't understood: if you want a list of numbers, why not make a function that creates one directly instead of instantiating a Range and then converting it into a list?</p>



<a name="273109286"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Should%20this%20be%20added%20to%20lean%204%3F/near/273109286" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Should.20this.20be.20added.20to.20lean.204.3F.html#273109286">(Feb 24 2022 at 16:04)</a>:</h4>
<p>The use of <code>Range</code> is too straightforward to me. It supports trivial iterations for <code>for</code> loops.<br>
If you want <em>data</em> to play with, <code>Range</code> is not the shortest path</p>



<a name="273109721"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Should%20this%20be%20added%20to%20lean%204%3F/near/273109721" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Should.20this.20be.20added.20to.20lean.204.3F.html#273109721">(Feb 24 2022 at 16:07)</a>:</h4>
<p>I'm not on my PC, but I think we already have <code>List.range</code>, which might serve as an inspiration if you want something more plastic/generic</p>



<a name="273109969"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Should%20this%20be%20added%20to%20lean%204%3F/near/273109969" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Siddhartha Gadgil <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Should.20this.20be.20added.20to.20lean.204.3F.html#273109969">(Feb 24 2022 at 16:08)</a>:</h4>
<p>The above had a problem because of my switching back and forth. The following version of <code>mkArray</code> gives an example:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">def</span> <span class="n">mkArray</span> <span class="o">[</span><span class="n">it</span> <span class="o">:</span> <span class="n">Iterable</span> <span class="n">l</span> <span class="n">α</span><span class="o">]</span> <span class="o">(</span><span class="n">x</span><span class="o">:</span> <span class="n">l</span><span class="o">):</span> <span class="n">Array</span> <span class="n">α</span> <span class="o">:=</span>
  <span class="n">it.toArray</span> <span class="n">x</span>

<span class="kd">instance</span> <span class="o">:</span> <span class="n">Iterable</span> <span class="n">Range</span> <span class="n">Nat</span> <span class="o">:=</span>
  <span class="o">⟨</span><span class="k">fun</span> <span class="n">r</span> <span class="bp">=&gt;</span> <span class="n">ForIn.toArray</span> <span class="n">r</span><span class="o">⟩</span>

<span class="kd">def</span> <span class="n">r</span> <span class="o">:</span> <span class="n">Range</span> <span class="o">:=</span> <span class="o">[</span><span class="mi">0</span><span class="o">:</span><span class="mi">3</span><span class="o">]</span>
<span class="kd">def</span> <span class="n">arr</span> <span class="o">:</span> <span class="n">Array</span> <span class="n">Nat</span> <span class="o">:=</span> <span class="n">mkArray</span> <span class="n">r</span>
</code></pre></div>



<a name="273110641"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Should%20this%20be%20added%20to%20lean%204%3F/near/273110641" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Siddhartha Gadgil <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Should.20this.20be.20added.20to.20lean.204.3F.html#273110641">(Feb 24 2022 at 16:13)</a>:</h4>
<p>In cleaned up form, here is the code again. <span class="user-mention" data-user-id="451983">@Arthur Paulino</span> I agree that for <code>Range</code> this seems to not make sense. May be useful occasionally though.</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">universe</span> <span class="n">u</span>
<span class="kd">class</span> <span class="n">Iterable</span> <span class="o">(</span><span class="n">l</span><span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">)(</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">)</span> <span class="n">where</span>
  <span class="n">toArray</span> <span class="o">:</span> <span class="n">l</span>  <span class="bp">→</span> <span class="n">Array</span> <span class="n">α</span>

<span class="kd">class</span> <span class="n">IterableFamily</span> <span class="o">(</span><span class="n">l</span><span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span> <span class="bp">→</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">)</span> <span class="n">where</span>
  <span class="n">toArray</span> <span class="o">:</span> <span class="n">l</span> <span class="n">α</span>  <span class="bp">→</span> <span class="n">Array</span> <span class="n">α</span>

<span class="kd">instance</span> <span class="o">{</span><span class="n">l</span><span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span> <span class="bp">→</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">}[</span><span class="n">it</span> <span class="o">:</span> <span class="n">IterableFamily</span> <span class="n">l</span><span class="o">]</span> <span class="o">(</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">)</span> <span class="o">:</span> <span class="n">Iterable</span> <span class="o">(</span><span class="n">l</span> <span class="n">α</span><span class="o">)</span> <span class="n">α</span> <span class="o">:=</span>
  <span class="o">⟨</span><span class="k">fun</span> <span class="n">x</span> <span class="bp">=&gt;</span> <span class="n">it.toArray</span> <span class="n">x</span><span class="o">⟩</span>

<span class="kd">instance</span> <span class="o">:</span> <span class="n">IterableFamily</span> <span class="n">List</span>    <span class="o">:=</span>
  <span class="o">⟨</span><span class="k">fun</span> <span class="n">l</span> <span class="bp">=&gt;</span> <span class="n">l.toArray</span><span class="o">⟩</span>

<span class="kd">instance</span> <span class="o">:</span> <span class="n">IterableFamily</span> <span class="n">Array</span>   <span class="o">:=</span>
  <span class="o">⟨</span><span class="k">fun</span> <span class="n">l</span> <span class="bp">=&gt;</span> <span class="n">l</span><span class="o">⟩</span>

<span class="kd">def</span> <span class="n">mkArray</span> <span class="o">[</span><span class="n">it</span> <span class="o">:</span> <span class="n">Iterable</span> <span class="n">l</span> <span class="n">α</span><span class="o">]</span> <span class="o">(</span><span class="n">x</span><span class="o">:</span> <span class="n">l</span><span class="o">):</span> <span class="n">Array</span> <span class="n">α</span> <span class="o">:=</span>
  <span class="n">it.toArray</span> <span class="n">x</span>

<span class="kd">def</span> <span class="n">mkList</span> <span class="o">[</span><span class="n">it</span> <span class="o">:</span> <span class="n">Iterable</span> <span class="n">l</span> <span class="n">α</span><span class="o">]</span> <span class="o">(</span><span class="n">x</span><span class="o">:</span> <span class="n">l</span><span class="o">):</span> <span class="n">List</span> <span class="n">α</span> <span class="o">:=</span>
  <span class="o">(</span><span class="n">mkArray</span> <span class="n">x</span><span class="o">)</span><span class="bp">.</span><span class="n">toList</span>

<span class="kd">def</span> <span class="n">mkHashMap</span>
  <span class="o">[</span><span class="n">it</span> <span class="o">:</span> <span class="n">Iterable</span> <span class="n">l</span>  <span class="o">(</span><span class="n">α</span> <span class="bp">×</span> <span class="n">β</span> <span class="o">)][</span><span class="n">Hashable</span> <span class="n">α</span><span class="o">][</span><span class="n">BEq</span> <span class="n">α</span><span class="o">][</span><span class="n">BEq</span> <span class="n">β</span><span class="o">](</span><span class="n">x</span><span class="o">:</span> <span class="n">l</span> <span class="o">):</span> <span class="n">HashMap</span> <span class="n">α</span> <span class="n">β</span>   <span class="o">:=</span>
    <span class="k">let</span> <span class="n">arr</span> <span class="o">:</span> <span class="n">Array</span> <span class="o">(</span><span class="n">α</span> <span class="bp">×</span> <span class="n">β</span><span class="o">)</span> <span class="o">:=</span> <span class="n">mkArray</span> <span class="n">x</span>
    <span class="n">arr.foldl</span> <span class="o">(</span><span class="k">fun</span> <span class="n">acc</span> <span class="o">(</span><span class="n">k</span><span class="o">,</span> <span class="n">v</span><span class="o">)</span> <span class="bp">=&gt;</span> <span class="n">acc.insert</span> <span class="n">k</span> <span class="n">v</span><span class="o">)</span> <span class="n">HashMap.empty</span>

<span class="kd">def</span> <span class="n">ForIn.toArray</span> <span class="o">[</span><span class="n">ForIn</span> <span class="n">Id</span> <span class="n">l</span> <span class="n">α</span><span class="o">](</span><span class="n">x</span> <span class="o">:</span> <span class="n">l</span><span class="o">):</span> <span class="o">(</span><span class="n">Array</span> <span class="n">α</span><span class="o">)</span> <span class="o">:=</span> <span class="n">Id.run</span>
  <span class="k">do</span>
    <span class="k">let</span> <span class="n">mut</span> <span class="n">arr</span> <span class="o">:=</span> <span class="n">Array.mk</span> <span class="o">[]</span>
    <span class="n">for</span> <span class="n">a</span> <span class="k">in</span> <span class="n">x</span> <span class="k">do</span>
      <span class="n">arr</span> <span class="o">:=</span> <span class="n">arr.push</span> <span class="n">a</span>
    <span class="n">return</span> <span class="n">arr</span>

<span class="kd">instance</span> <span class="o">:</span> <span class="n">Iterable</span> <span class="n">Range</span> <span class="n">Nat</span> <span class="o">:=</span>
  <span class="o">⟨</span><span class="k">fun</span> <span class="n">r</span> <span class="bp">=&gt;</span> <span class="n">ForIn.toArray</span> <span class="n">r</span><span class="o">⟩</span>

<span class="kd">def</span> <span class="n">r</span> <span class="o">:</span> <span class="n">Range</span> <span class="o">:=</span> <span class="o">[</span><span class="mi">0</span><span class="o">:</span><span class="mi">3</span><span class="o">]</span>
<span class="kd">def</span> <span class="n">arr</span> <span class="o">:</span> <span class="n">Array</span> <span class="n">Nat</span> <span class="o">:=</span> <span class="n">mkArray</span> <span class="n">r</span>
</code></pre></div>



<a name="273110982"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Should%20this%20be%20added%20to%20lean%204%3F/near/273110982" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Should.20this.20be.20added.20to.20lean.204.3F.html#273110982">(Feb 24 2022 at 16:15)</a>:</h4>
<p><span class="user-mention silent" data-user-id="451983">Arthur Paulino</span> <a href="#narrow/stream/270676-lean4/topic/Should.20this.20be.20added.20to.20lean.204.3F/near/273108872">said</a>:</p>
<blockquote>
<p>One thing I still haven't understood: if you want a list of numbers, why not make a function that creates one directly instead of instantiating a Range and then converting it into a list?</p>
</blockquote>
<p>There isn't much overhead to creating a <code>Range</code>, it is just a trivial struct, so I would say that this is just a convenient syntax for calling <code>List.range</code></p>



<a name="273111169"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Should%20this%20be%20added%20to%20lean%204%3F/near/273111169" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Should.20this.20be.20added.20to.20lean.204.3F.html#273111169">(Feb 24 2022 at 16:16)</a>:</h4>
<p>you would need four versions of the function to get the same behavior with direct list functions</p>



<a name="273111626"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Should%20this%20be%20added%20to%20lean%204%3F/near/273111626" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joseph O <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Should.20this.20be.20added.20to.20lean.204.3F.html#273111626">(Feb 24 2022 at 16:19)</a>:</h4>
<p>I would say 3 actually</p>



<a name="273111677"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Should%20this%20be%20added%20to%20lean%204%3F/near/273111677" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joseph O <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Should.20this.20be.20added.20to.20lean.204.3F.html#273111677">(Feb 24 2022 at 16:19)</a>:</h4>
<p>One for just stop, one for start and stop, and one for start, stop and step</p>



<a name="273113706"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Should%20this%20be%20added%20to%20lean%204%3F/near/273113706" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Should.20this.20be.20added.20to.20lean.204.3F.html#273113706">(Feb 24 2022 at 16:33)</a>:</h4>
<p>I suspect there's a solution with just one function and optional parameters with default values</p>



<a name="273114016"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Should%20this%20be%20added%20to%20lean%204%3F/near/273114016" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Should.20this.20be.20added.20to.20lean.204.3F.html#273114016">(Feb 24 2022 at 16:35)</a>:</h4>
<p>sure, <code>Range</code>'s constructor itself has default values like that</p>



<a name="273114169"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Should%20this%20be%20added%20to%20lean%204%3F/near/273114169" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Should.20this.20be.20added.20to.20lean.204.3F.html#273114169">(Feb 24 2022 at 16:36)</a>:</h4>
<p>but <code>Range</code> also has fancy syntax which a custom function wouldn't have</p>



<a name="273114597"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Should%20this%20be%20added%20to%20lean%204%3F/near/273114597" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joseph O <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Should.20this.20be.20added.20to.20lean.204.3F.html#273114597">(Feb 24 2022 at 16:39)</a>:</h4>
<p>yes</p>



<a name="273114802"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Should%20this%20be%20added%20to%20lean%204%3F/near/273114802" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Should.20this.20be.20added.20to.20lean.204.3F.html#273114802">(Feb 24 2022 at 16:40)</a>:</h4>
<p>You can also use <code>@[csimp]</code> lemmas to rewrite calls to <code>[:n].toList</code> to <code>List.range n</code></p>



<a name="273115436"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Should%20this%20be%20added%20to%20lean%204%3F/near/273115436" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Should.20this.20be.20added.20to.20lean.204.3F.html#273115436">(Feb 24 2022 at 16:44)</a>:</h4>
<p>Why would <code>List.range</code> be any more efficient than <code>Range.toList</code>?  Because of the step size?</p>



<a name="273116076"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Should%20this%20be%20added%20to%20lean%204%3F/near/273116076" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joseph O <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Should.20this.20be.20added.20to.20lean.204.3F.html#273116076">(Feb 24 2022 at 16:48)</a>:</h4>
<p>No customizable start of step</p>



<a name="273119225"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Should%20this%20be%20added%20to%20lean%204%3F/near/273119225" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Should.20this.20be.20added.20to.20lean.204.3F.html#273119225">(Feb 24 2022 at 17:09)</a>:</h4>
<p>Well, <code>List.range</code> as it exists today probably isn't that efficient, since it's not tail recursive IIRC. But if we assume that all the functions are given the most efficient implementations given their spec, it would be advantageous to call <code>List.range</code> when we know at compile time that the step is 1 and the start is 0</p>



<a name="273122667"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Should%20this%20be%20added%20to%20lean%204%3F/near/273122667" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joseph O <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Should.20this.20be.20added.20to.20lean.204.3F.html#273122667">(Feb 24 2022 at 17:33)</a>:</h4>
<p>A lot of conversation, yet im not sure we have made a decision yet</p>



<a name="273123620"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Should%20this%20be%20added%20to%20lean%204%3F/near/273123620" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Should.20this.20be.20added.20to.20lean.204.3F.html#273123620">(Feb 24 2022 at 17:40)</a>:</h4>
<p><code>Range.toArray</code> and <code>Range.toList</code> are no-brainers (in that the spec is clear and there is no downside to providing the function), everything else is speculative / comes as part of a larger untested infrastructure</p>



<a name="273128232"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Should%20this%20be%20added%20to%20lean%204%3F/near/273128232" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Should.20this.20be.20added.20to.20lean.204.3F.html#273128232">(Feb 24 2022 at 18:13)</a>:</h4>
<p>Just to give an idea of what I had in mind, this quick draft already generates <em>pretty good code</em>. The only improvements I can see would be to pass the <code>Range</code> object by value/as separate parameters through the loop (which is a general missing compiler optimization), and to introduce an <code>ExactSizeIterator</code> on top that allows the array to be created with the correct capacity from the beginning.</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">def</span> <span class="n">Stream.drop</span> <span class="o">[</span><span class="n">Stream</span> <span class="n">stream</span> <span class="n">value</span><span class="o">]</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="n">Nat</span><span class="o">)</span> <span class="o">(</span><span class="n">s</span> <span class="o">:</span> <span class="n">stream</span><span class="o">)</span> <span class="o">:</span> <span class="n">stream</span> <span class="o">:=</span>
  <span class="k">match</span> <span class="n">n</span> <span class="k">with</span>
  <span class="bp">|</span> <span class="mi">0</span> <span class="bp">=&gt;</span> <span class="n">s</span>
  <span class="bp">|</span> <span class="n">n</span> <span class="bp">+</span> <span class="mi">1</span> <span class="bp">=&gt;</span> <span class="n">drop</span> <span class="n">n</span> <span class="n">s</span>

<span class="kd">class</span> <span class="n">BoundedStream</span> <span class="o">(</span><span class="n">stream</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">)</span> <span class="o">(</span><span class="n">value</span> <span class="o">:</span> <span class="n">outParam</span> <span class="o">(</span><span class="kt">Type</span> <span class="n">v</span><span class="o">))</span> <span class="kd">extends</span> <span class="n">Stream</span> <span class="n">stream</span> <span class="n">value</span> <span class="n">where</span>
  <span class="n">is_bounded</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">s</span><span class="o">,</span> <span class="bp">∃</span> <span class="n">n</span><span class="o">,</span> <span class="n">next</span><span class="bp">?</span> <span class="o">(</span><span class="n">Stream.drop</span> <span class="n">n</span> <span class="n">s</span><span class="o">)</span> <span class="bp">|&gt;.</span><span class="n">isNone</span>

<span class="kd">instance</span> <span class="o">:</span> <span class="n">BoundedStream</span> <span class="n">Std.Range</span> <span class="n">Nat</span> <span class="n">where</span>
  <span class="n">is_bounded</span> <span class="o">:=</span> <span class="gr">sorry</span>

<span class="kd">structure</span> <span class="n">Stream.Map</span> <span class="o">(</span><span class="n">stream</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">)</span> <span class="o">(</span><span class="n">value</span> <span class="n">value'</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">v</span><span class="o">)</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">value</span> <span class="bp">→</span> <span class="n">value'</span><span class="o">)</span> <span class="n">where</span>
  <span class="n">s</span> <span class="o">:</span> <span class="n">stream</span>

<span class="kd">instance</span> <span class="o">[</span><span class="n">BoundedStream</span> <span class="n">stream</span> <span class="n">value</span><span class="o">]</span> <span class="o">:</span> <span class="n">BoundedStream</span> <span class="o">(</span><span class="n">Stream.Map</span> <span class="n">stream</span> <span class="n">value</span> <span class="n">value'</span> <span class="n">f</span><span class="o">)</span> <span class="n">value'</span> <span class="n">where</span>
  <span class="n">next</span><span class="bp">?</span> <span class="n">s</span> <span class="o">:=</span> <span class="o">(</span><span class="k">fun</span> <span class="o">(</span><span class="n">a</span><span class="o">,</span> <span class="n">s</span><span class="o">)</span> <span class="bp">=&gt;</span> <span class="o">(</span><span class="n">f</span> <span class="n">a</span><span class="o">,</span> <span class="o">⟨</span><span class="n">s</span><span class="o">⟩))</span> <span class="bp">&lt;$&gt;</span> <span class="n">Stream.next</span><span class="bp">?</span> <span class="n">s.1</span>
  <span class="n">is_bounded</span> <span class="o">:=</span> <span class="gr">sorry</span>

<span class="kd">def</span> <span class="n">Stream.map</span> <span class="o">[</span><span class="n">Stream</span> <span class="n">stream</span> <span class="n">value</span><span class="o">]</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">value</span> <span class="bp">→</span> <span class="n">value'</span><span class="o">)</span> <span class="o">(</span><span class="n">s</span> <span class="o">:</span> <span class="n">stream</span><span class="o">)</span> <span class="o">:</span> <span class="n">Stream.Map</span> <span class="n">stream</span> <span class="n">value</span> <span class="n">value'</span> <span class="n">f</span> <span class="o">:=</span> <span class="o">⟨</span><span class="n">s</span><span class="o">⟩</span>

<span class="kd">def</span> <span class="n">BoundedStream.toArray</span> <span class="o">[</span><span class="n">BoundedStream</span> <span class="n">stream</span> <span class="n">value</span><span class="o">]</span> <span class="o">(</span><span class="n">s</span> <span class="o">:</span> <span class="n">stream</span><span class="o">)</span> <span class="o">:</span> <span class="n">Array</span> <span class="n">value</span> <span class="o">:=</span>
  <span class="n">go</span> <span class="n">s</span> <span class="bp">#</span><span class="o">[]</span>
<span class="n">where</span>
  <span class="n">go</span> <span class="n">s</span> <span class="n">arr</span> <span class="o">:=</span> <span class="k">match</span> <span class="n">h</span> <span class="o">:</span> <span class="n">Stream.next</span><span class="bp">?</span> <span class="n">s</span> <span class="k">with</span>
    <span class="bp">|</span> <span class="n">none</span> <span class="bp">=&gt;</span> <span class="n">arr</span>
    <span class="bp">|</span> <span class="n">some</span> <span class="o">(</span><span class="n">a</span><span class="o">,</span> <span class="n">s'</span><span class="o">)</span> <span class="bp">=&gt;</span>
      <span class="k">have</span> <span class="o">:</span> <span class="n">Classical.choose</span> <span class="o">(</span><span class="n">BoundedStream.is_bounded</span> <span class="n">s'</span><span class="o">)</span> <span class="bp">&lt;</span> <span class="n">Classical.choose</span> <span class="o">(</span><span class="n">BoundedStream.is_bounded</span> <span class="n">s</span><span class="o">)</span> <span class="o">:=</span> <span class="kd">by</span>
        <span class="gr">sorry</span>
      <span class="n">go</span> <span class="n">s'</span> <span class="o">(</span><span class="n">arr.push</span> <span class="n">a</span><span class="o">)</span>
<span class="n">termination_by</span> <span class="n">go</span> <span class="n">_</span> <span class="bp">=&gt;</span> <span class="n">Classical.choose</span> <span class="o">(</span><span class="n">BoundedStream.is_bounded</span> <span class="n">s</span><span class="o">)</span>

<span class="kd">set_option</span> <span class="n">trace.compiler.ir.result</span> <span class="n">true</span>
<span class="k">#eval</span> <span class="n">BoundedStream.toArray</span> <span class="o">[</span><span class="mi">3</span><span class="o">:</span><span class="mi">5</span><span class="o">]</span>
<span class="k">#eval</span> <span class="n">BoundedStream.toArray</span> <span class="o">(</span><span class="n">Stream.map</span> <span class="o">(</span><span class="bp">·</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)</span> <span class="o">[</span><span class="mi">3</span><span class="o">:</span><span class="mi">5</span><span class="o">])</span>
</code></pre></div>
<p>Those sorries? Oh, nothing to worry, especially not that last one...</p>



<a name="273128497"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Should%20this%20be%20added%20to%20lean%204%3F/near/273128497" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Should.20this.20be.20added.20to.20lean.204.3F.html#273128497">(Feb 24 2022 at 18:15)</a>:</h4>
<p><code>Stream.drop</code> is the identity function</p>



<a name="273128641"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Should%20this%20be%20added%20to%20lean%204%3F/near/273128641" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Should.20this.20be.20added.20to.20lean.204.3F.html#273128641">(Feb 24 2022 at 18:16)</a>:</h4>
<p>probably simpler to define <code>Stream.nth</code> instead of <code>drop</code></p>



<a name="273129421"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Should%20this%20be%20added%20to%20lean%204%3F/near/273129421" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joseph O <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Should.20this.20be.20added.20to.20lean.204.3F.html#273129421">(Feb 24 2022 at 18:22)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110049">Mario Carneiro</span> <a href="#narrow/stream/270676-lean4/topic/Should.20this.20be.20added.20to.20lean.204.3F/near/273123620">said</a>:</p>
<blockquote>
<p><code>Range.toArray</code> and <code>Range.toList</code> are no-brainers (in that the spec is clear and there is no downside to providing the function), everything else is speculative / comes as part of a larger untested infrastructure</p>
</blockquote>
<p>What do you mean by "everything else"? Did I miss something in the conversation?</p>



<a name="273129463"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Should%20this%20be%20added%20to%20lean%204%3F/near/273129463" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Should.20this.20be.20added.20to.20lean.204.3F.html#273129463">(Feb 24 2022 at 18:22)</a>:</h4>
<p>I mean all the other proposals and ideas on this thread</p>



<a name="273129538"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Should%20this%20be%20added%20to%20lean%204%3F/near/273129538" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Should.20this.20be.20added.20to.20lean.204.3F.html#273129538">(Feb 24 2022 at 18:23)</a>:</h4>
<p>If you are looking for something to PR you can safely ignore them</p>



<a name="273130068"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Should%20this%20be%20added%20to%20lean%204%3F/near/273130068" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Should.20this.20be.20added.20to.20lean.204.3F.html#273130068">(Feb 24 2022 at 18:27)</a>:</h4>
<p><span class="user-mention" data-user-id="110024">@Sebastian Ullrich</span> Setting aside the sketchy <code>Classical.choose (BoundedStream.is_bounded s)</code> termination measure, I wonder whether it would be advantageous to have something like rust's <code>ExactSizeIterator</code>: make the bound an explicit part of the structure and use it to pre-seed the size of the array</p>



<a name="273130243"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Should%20this%20be%20added%20to%20lean%204%3F/near/273130243" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Should.20this.20be.20added.20to.20lean.204.3F.html#273130243">(Feb 24 2022 at 18:28)</a>:</h4>
<p>Also the bound could depend on the input stream value</p>



<a name="273135672"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Should%20this%20be%20added%20to%20lean%204%3F/near/273135672" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joseph O <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Should.20this.20be.20added.20to.20lean.204.3F.html#273135672">(Feb 24 2022 at 19:14)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110049">Mario Carneiro</span> <a href="#narrow/stream/270676-lean4/topic/Should.20this.20be.20added.20to.20lean.204.3F/near/273129538">said</a>:</p>
<blockquote>
<p>If you are looking for something to PR you can safely ignore them</p>
</blockquote>
<p>Question is, where should i PR to. Mathlib4 or lean4?</p>



<a name="273136519"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Should%20this%20be%20added%20to%20lean%204%3F/near/273136519" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Should.20this.20be.20added.20to.20lean.204.3F.html#273136519">(Feb 24 2022 at 19:21)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110049">Mario Carneiro</span> <a href="#narrow/stream/287929-mathlib4/topic/adding.20to.20std/near/272550463">said</a>:</p>
<blockquote>
<p>My suggestion is to add to mathlib4, for example here -&gt; <a href="https://github.com/leanprover-community/mathlib4/blob/master/Mathlib/Data/List/Defs.lean">https://github.com/leanprover-community/mathlib4/blob/master/Mathlib/Data/List/Defs.lean</a></p>
</blockquote>



<a name="273138257"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Should%20this%20be%20added%20to%20lean%204%3F/near/273138257" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joseph O <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Should.20this.20be.20added.20to.20lean.204.3F.html#273138257">(Feb 24 2022 at 19:34)</a>:</h4>
<p>Ah I  missed that. I was thinking about adding a file called <code>Range.lean</code>, in <code>Init.Data</code>, wince the <code>toList</code> and <code>toArray</code> methods have to be underst the <code>Std.Range</code> namespace</p>



<a name="273142271"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Should%20this%20be%20added%20to%20lean%204%3F/near/273142271" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Should.20this.20be.20added.20to.20lean.204.3F.html#273142271">(Feb 24 2022 at 20:03)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110049">Mario Carneiro</span> <a href="#narrow/stream/270676-lean4/topic/Should.20this.20be.20added.20to.20lean.204.3F/near/273130068">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="110024">Sebastian Ullrich</span> Setting aside the sketchy <code>Classical.choose (BoundedStream.is_bounded s)</code> termination measure, I wonder whether it would be advantageous to have something like rust's <code>ExactSizeIterator</code>: make the bound an explicit part of the structure and use it to pre-seed the size of the array</p>
</blockquote>
<p>Yes, I mentioned that :) . But it should not be mandatory, you still want <code>toArray</code> to work on <code>filter</code>. Good point with <code>drop</code> though, haha, I'll leave that and fixing the metric as an exercise to the reader.</p>



<a name="273298751"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Should%20this%20be%20added%20to%20lean%204%3F/near/273298751" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jay Sulzberger <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Should.20this.20be.20added.20to.20lean.204.3F.html#273298751">(Feb 25 2022 at 23:24)</a>:</h4>
<p>I do not know what Common Lisp's loop is, but I have heard talk of its mysteries.</p>



<a name="273299506"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Should%20this%20be%20added%20to%20lean%204%3F/near/273299506" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jay Sulzberger <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Should.20this.20be.20added.20to.20lean.204.3F.html#273299506">(Feb 25 2022 at 23:31)</a>:</h4>
<p>I sent above in answer to Mario Carneiro's remark about the power of LEAN's "iterator" 'for in'.</p>



<a name="273360480"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Should%20this%20be%20added%20to%20lean%204%3F/near/273360480" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Should.20this.20be.20added.20to.20lean.204.3F.html#273360480">(Feb 26 2022 at 20:10)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110024">Sebastian Ullrich</span> <a href="#narrow/stream/270676-lean4/topic/Should.20this.20be.20added.20to.20lean.204.3F/near/273100232">said</a>:</p>
<blockquote>
<p>I'd love to see a robust external iteration library for Lean in the future.</p>
</blockquote>
<p>I see that everyone just ignored my post:</p>
<p><span class="user-mention silent" data-user-id="315577">Mac</span> <a href="#narrow/stream/270676-lean4/topic/Should.20this.20be.20added.20to.20lean.204.3F/near/273045434">said</a>:</p>
<blockquote>
<p>You might find my  WIP <a href="https://github.com/tydeu/lean4-itertools">lean4-itertools</a> library to be of interest. I was designed exactly to help do this kind of thing.</p>
</blockquote>
<p>It <em>is</em> an external iteration library that is attempting to do much of what is being discussed here. For example:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">def</span> <span class="n">foo</span> <span class="o">:=</span>
  <span class="n">range</span> <span class="mi">10</span>
  <span class="bp">|&gt;</span> <span class="n">filter</span> <span class="o">(</span><span class="bp">·</span> <span class="bp">%</span> <span class="mi">2</span> <span class="bp">==</span> <span class="mi">0</span><span class="o">)</span>
  <span class="bp">|&gt;</span> <span class="n">map</span> <span class="o">(</span><span class="bp">·</span> <span class="bp">*</span> <span class="mi">2</span><span class="o">)</span>
  <span class="bp">|&gt;</span> <span class="n">array</span>
</code></pre></div>
<p>I would be really curious what people think of my approach to fill this need and how it could be improved.</p>



<a name="273363064"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Should%20this%20be%20added%20to%20lean%204%3F/near/273363064" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Should.20this.20be.20added.20to.20lean.204.3F.html#273363064">(Feb 26 2022 at 21:07)</a>:</h4>
<p>Am I missing something? I only see <code>ForIn</code> methods in your library, which is internal iteration</p>



<a name="273363874"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Should%20this%20be%20added%20to%20lean%204%3F/near/273363874" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Should.20this.20be.20added.20to.20lean.204.3F.html#273363874">(Feb 26 2022 at 21:28)</a>:</h4>
<p><span class="user-mention" data-user-id="110024">@Sebastian Ullrich</span> Huh?  <strong><em>Does some research.</em></strong> Oh, sorry! I had never heard of the distinction between internal vs external iteration before (at least with those terms). I thought by "external iteration library" you meant an external library (i.e., one outside the Lean core) for iteration. My apologies for the misunderstanding.</p>



<a name="273364086"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Should%20this%20be%20added%20to%20lean%204%3F/near/273364086" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Should.20this.20be.20added.20to.20lean.204.3F.html#273364086">(Feb 26 2022 at 21:31)</a>:</h4>
<p>Hah, that indeed was a little ambiguous. I did mention the distinction in the very same comment though... :)</p>



<a name="273364149"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Should%20this%20be%20added%20to%20lean%204%3F/near/273364149" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Should.20this.20be.20added.20to.20lean.204.3F.html#273364149">(Feb 26 2022 at 21:32)</a>:</h4>
<p>The mentioned <code>ExactSizeIterator</code> looks like another use case that should be hard to pull off using internal iteration btw</p>



<a name="273364308"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Should%20this%20be%20added%20to%20lean%204%3F/near/273364308" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Should.20this.20be.20added.20to.20lean.204.3F.html#273364308">(Feb 26 2022 at 21:37)</a>:</h4>
<p>There is also an interesting blog post about Rust switching from internal to external iteration, and then later adding back internal iteration as an optional optimization of external iterators. Some of the described problems are specific to Rust though. <a href="https://medium.com/@veedrac/rust-is-slow-and-i-am-the-cure-32facc0fdcb">https://medium.com/@veedrac/rust-is-slow-and-i-am-the-cure-32facc0fdcb</a></p>



<a name="273364816"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Should%20this%20be%20added%20to%20lean%204%3F/near/273364816" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Should.20this.20be.20added.20to.20lean.204.3F.html#273364816">(Feb 26 2022 at 21:49)</a>:</h4>
<p><span class="user-mention" data-user-id="110024">@Sebastian Ullrich</span> I would kind of expect that from an imperative low-level language like Rust. As I see it, external iteration is the natural form of iteration in imperative languages (as it is explicitly stateful) whereas internal iteration is the natural form of iteration for functional languages (as it appears stateless). External iteration is still useful in functional languages, it is just more unnatural (and, depending on the language, can be quite cumbersome).</p>



<a name="273373962"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Should%20this%20be%20added%20to%20lean%204%3F/near/273373962" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> James Gallicchio <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Should.20this.20be.20added.20to.20lean.204.3F.html#273373962">(Feb 27 2022 at 01:16)</a>:</h4>
<p>^ Is there even a good use case for external iterators in Lean? Plenty of functional languages' collections libraries get away with just an internal iterators.</p>
<p>Scala collections, most of the library functions are based on internal iteration but there's a class that all collections implement to expose an external iterator. Might be a valid design for Lean as well to give flexibility when people want it, at the cost of a bit of overhead</p>



<a name="273378729"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Should%20this%20be%20added%20to%20lean%204%3F/near/273378729" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> James Gallicchio <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Should.20this.20be.20added.20to.20lean.204.3F.html#273378729">(Feb 27 2022 at 03:22)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110024">Sebastian Ullrich</span> <a href="#narrow/stream/270676-lean4/topic/Should.20this.20be.20added.20to.20lean.204.3F/near/273364149">said</a>:</p>
<blockquote>
<p>The mentioned <code>ExactSizeIterator</code> looks like another use case that should be hard to pull off using internal iteration btw</p>
</blockquote>
<p>Also RE: this, some Scala collections have a "sizeHint" interface for mutable buffers, which I think would be fine here. Basically just lets you get a buffer given an expected size to be pre-allocated. This could probably be implemented for Lean's native arrays?</p>



<a name="273379824"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Should%20this%20be%20added%20to%20lean%204%3F/near/273379824" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> James Gallicchio <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Should.20this.20be.20added.20to.20lean.204.3F.html#273379824">(Feb 27 2022 at 03:48)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">class</span> <span class="n">ExpectedSize</span> <span class="o">(</span><span class="n">ρ</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">)</span> <span class="n">where</span>
  <span class="n">expectedSize</span> <span class="o">:</span> <span class="n">ρ</span> <span class="bp">→</span> <span class="n">Nat</span>

<span class="kd">class</span> <span class="n">ToArray</span> <span class="o">(</span><span class="n">ρ</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">)</span> <span class="o">(</span><span class="n">α</span> <span class="o">:</span> <span class="n">outParam</span> <span class="o">(</span><span class="kt">Type</span> <span class="n">v</span><span class="o">))</span> <span class="n">where</span>
  <span class="n">toArray</span> <span class="o">:</span> <span class="n">ρ</span> <span class="bp">→</span> <span class="n">Array</span> <span class="n">α</span>

<span class="kd">instance</span> <span class="o">[</span><span class="n">ForIn</span> <span class="n">Id</span> <span class="n">ρ</span> <span class="n">α</span><span class="o">]</span> <span class="o">[</span><span class="n">ExpectedSize</span> <span class="n">ρ</span><span class="o">]</span> <span class="o">:</span> <span class="n">ToArray</span> <span class="n">ρ</span> <span class="n">α</span> <span class="n">where</span>
  <span class="n">toArray</span> <span class="n">r</span> <span class="o">:=</span> <span class="n">Id.run</span> <span class="k">do</span>
    <span class="k">let</span> <span class="n">mut</span> <span class="n">a</span> <span class="o">:=</span> <span class="n">Array.mkEmpty</span> <span class="o">(</span><span class="n">ExpectedSize.expectedSize</span> <span class="n">r</span><span class="o">)</span>
    <span class="n">for</span> <span class="n">x</span> <span class="k">in</span> <span class="n">r</span> <span class="k">do</span>
      <span class="n">a</span> <span class="o">:=</span> <span class="n">a.push</span> <span class="n">x</span>
    <span class="n">return</span> <span class="n">a</span>
</code></pre></div>
<p>something simple like this?</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>