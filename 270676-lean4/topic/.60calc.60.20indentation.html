---
layout: archive
title: Zulip Chat Archive
permalink: /stream/270676-lean4/topic/.60calc.60.20indentation.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/index.html">lean4</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.60calc.60.20indentation.html">`calc` indentation</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="315614226"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%60calc%60%20indentation/near/315614226" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adrien Champion <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.60calc.60.20indentation.html#315614226">(Dec 13 2022 at 15:14)</a>:</h4>
<p>This is a continuation of the discussion started in <a href="#narrow/stream/270676-lean4/topic/indenting.20after.20.22by.22">a previous Zulip thread</a> which spawned <a href="https://github.com/leanprover/lean4/pull/1844">issue #1844</a>. The issues pointed out in the thread appeared after <a href="https://github.com/leanprover/lean4/pull/1811">#1811</a> was merged.</p>
<p>The discussion is about indentation in <code>calc</code>'s relations and proofs. As mentioned <a href="https://github.com/leanprover/lean4/pull/1844#issuecomment-1321171553">in the issue</a>, I gathered examples of how indentation could be/is used in <code>calc</code> here:</p>
<ul>
<li><a href="https://github.com/AdrienChampion/experimentalean4/blob/main/discussions/ByCalcIndent/ByCalcIndent.lean">https://github.com/AdrienChampion/experimentalean4/blob/main/discussions/ByCalcIndent/ByCalcIndent.lean</a></li>
</ul>
<p>This thread is an attempt to gather feedback to see if there's a solution that everyone would be comfortable with.</p>



<a name="315614881"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%60calc%60%20indentation/near/315614881" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adrien Champion <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.60calc.60.20indentation.html#315614881">(Dec 13 2022 at 15:17)</a>:</h4>
<p>The problem is that when the <code>_</code>-s in <code>calc</code> are indented past the "normal" indentation of the "block", like <a href="https://github.com/AdrienChampion/experimentalean4/blob/main/discussions/ByCalcIndent/ByCalcIndent.lean#L49-L52">here</a>, then <code>by</code> can get confused (thanks to <a href="https://github.com/leanprover/lean4/pull/1811">#1811</a>)</p>



<a name="315615556"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%60calc%60%20indentation/near/315615556" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adrien Champion <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.60calc.60.20indentation.html#315615556">(Dec 13 2022 at 15:20)</a>:</h4>
<p>More generally, as pointed out <a href="https://github.com/leanprover/lean4/pull/1844#issuecomment-1320163138">here</a>, there is a potential problem of strong indentation drifting in the proof following each relation due to the often large padding introduced before the <code>_</code></p>



<a name="315644605"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%60calc%60%20indentation/near/315644605" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.60calc.60.20indentation.html#315644605">(Dec 13 2022 at 17:30)</a>:</h4>
<p>Speaking as someone who is about to impose a lot of Lean 4 calc blocks on new-to-Lean undergraduates (see <a href="https://hrmacbeth.github.io/math2001/01_Proofs_by_Calculation.html">here</a> for the Lean 3 version), I would like writing a calc block to be as fast and robust as possible.</p>
<p>So I would like to <em>not</em> require that the column of <code>&lt;</code>/<code>=</code>/etc line up in rows 2+ with the position in row 1: whether you do this by padding before the <code>_</code> or after, it is fiddly and I imagine it would cause headaches.</p>



<a name="315645471"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%60calc%60%20indentation/near/315645471" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.60calc.60.20indentation.html#315645471">(Dec 13 2022 at 17:33)</a>:</h4>
<p>(Padding after <code>_</code> seems like it would be more painful than padding before <code>_</code>.)</p>



<a name="315646288"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%60calc%60%20indentation/near/315646288" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.60calc.60.20indentation.html#315646288">(Dec 13 2022 at 17:37)</a>:</h4>
<p>Do you ever use multi-line tactic blocks inside <code>calc</code>? How would you want to style them in Lean 4?</p>



<a name="315646460"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%60calc%60%20indentation/near/315646460" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.60calc.60.20indentation.html#315646460">(Dec 13 2022 at 17:38)</a>:</h4>
<p>Just to reiterate: the central issue is how to distinguish the end of a tactic block inside <code>calc</code> from the next equation</p>



<a name="315646470"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%60calc%60%20indentation/near/315646470" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.60calc.60.20indentation.html#315646470">(Dec 13 2022 at 17:38)</a>:</h4>
<p>I do use them quite often in my own contributions to mathlib, but I don't use them in teaching.  So I'm more flexible on style there.</p>



<a name="315647104"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%60calc%60%20indentation/near/315647104" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.60calc.60.20indentation.html#315647104">(Dec 13 2022 at 17:41)</a>:</h4>
<p>is it okay to have all the <code>_</code> on rows 2+ line up?</p>



<a name="315647229"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%60calc%60%20indentation/near/315647229" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.60calc.60.20indentation.html#315647229">(Dec 13 2022 at 17:42)</a>:</h4>
<p>Using a token like <code>...</code> that is not valid anywhere else, and that ironically I think I'm responsible for having replaced with <code>_</code>, would be a very robust way to achieve just that. So we might want to include that variant in the discussion, even if it requires some parser tricks to implement.</p>



<a name="315647396"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%60calc%60%20indentation/near/315647396" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.60calc.60.20indentation.html#315647396">(Dec 13 2022 at 17:43)</a>:</h4>
<p>the current proposal enforces that rows 2+ line up vertically <em>at the start</em>, not at the relation symbol</p>



<a name="315647486"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%60calc%60%20indentation/near/315647486" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.60calc.60.20indentation.html#315647486">(Dec 13 2022 at 17:43)</a>:</h4>
<p>so if you want them to line up at the relation symbol you have to insert space between the <code>_</code> and the <code>&lt;</code></p>



<a name="315647985"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%60calc%60%20indentation/near/315647985" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.60calc.60.20indentation.html#315647985">(Dec 13 2022 at 17:45)</a>:</h4>
<p>Just to be clear, the version I am hoping lands supports the following pattern:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="k">calc</span> <span class="o">(</span><span class="n">firstTerm</span><span class="o">)</span><span class="bp">?</span>
  <span class="n">alsoFirstTerm</span> <span class="bp">=</span> <span class="n">secondTerm</span> <span class="o">:=</span> <span class="kd">by</span>
    <span class="n">proof_continues</span>
  <span class="n">alsoSecondTerm</span> <span class="bp">=</span> <span class="n">thirdTerm</span> <span class="o">:=</span> <span class="n">oneLineProof</span>
</code></pre></div>
<p>the <code>also</code> terms will usually be <code>_</code> but they don't have to be</p>



<a name="315648134"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%60calc%60%20indentation/near/315648134" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.60calc.60.20indentation.html#315648134">(Dec 13 2022 at 17:46)</a>:</h4>
<p>Is it possible to make hitting \newline in VS Code clever, so that when you do that within a calc block it makes a new line with the cursor in the right spot?  (whatever syntax is ultimately decided on as "the right spot")</p>



<a name="315648368"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%60calc%60%20indentation/near/315648368" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.60calc.60.20indentation.html#315648368">(Dec 13 2022 at 17:47)</a>:</h4>
<p>I think that needs vscode support, but in principle I don't see why not</p>



<a name="315648531"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%60calc%60%20indentation/near/315648531" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.60calc.60.20indentation.html#315648531">(Dec 13 2022 at 17:47)</a>:</h4>
<p>we just need to register <code>by</code> as a keyword after which to indent, similar to <code>{</code> handling in C code</p>



<a name="315649643"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%60calc%60%20indentation/near/315649643" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.60calc.60.20indentation.html#315649643">(Dec 13 2022 at 17:52)</a>:</h4>
<p>But maybe that gets annoying when you have reached the end of your calc-block and now need to de-indent.  I guess typing in a text editor which automatically continues a list of bullet points with more bullet points is the same situation -- when you reach the end of the list, you backspace to delete the unneeded bullet point.</p>



<a name="315651111"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%60calc%60%20indentation/near/315651111" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.60calc.60.20indentation.html#315651111">(Dec 13 2022 at 18:00)</a>:</h4>
<p>In fact, if hitting \newline takes you to the right horizontal position (and maybe even inserts the <code>_</code> for you), this one should be easy to type, and I think it's quite pretty:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="c1">-- align on rel-ops with arbitrary `_` indentation</span>
<span class="c1">-- nightly ✅ #1844 ❌ pre #1811 ✅</span>
<span class="kd">example</span> <span class="o">:</span> <span class="n">t1</span> <span class="bp">&lt;</span> <span class="n">t5</span> <span class="o">:=</span>
  <span class="k">let</span> <span class="n">_</span> <span class="o">:=</span> <span class="k">calc</span>
    <span class="n">t1</span> <span class="bp">=</span> <span class="n">t2</span> <span class="o">:=</span> <span class="n">pf12</span>
     <span class="n">_</span> <span class="bp">&lt;</span> <span class="n">t3</span> <span class="o">:=</span> <span class="n">pf23</span>
     <span class="n">_</span> <span class="bp">=</span> <span class="n">t4</span> <span class="o">:=</span> <span class="n">pf34</span>
     <span class="n">_</span> <span class="bp">&lt;</span> <span class="n">t5</span> <span class="o">:=</span> <span class="n">pf45</span>
  <span class="k">let</span> <span class="n">p</span> <span class="o">:=</span> <span class="k">calc</span>
    <span class="n">longId</span> <span class="n">t1</span> <span class="bp">=</span> <span class="n">t2</span> <span class="o">:=</span> <span class="n">pf12</span>
            <span class="n">_</span> <span class="bp">&lt;</span> <span class="n">t3</span> <span class="o">:=</span> <span class="n">pf23</span>
            <span class="n">_</span> <span class="bp">=</span> <span class="n">t4</span> <span class="o">:=</span> <span class="n">pf34</span>
            <span class="n">_</span> <span class="bp">&lt;</span> <span class="n">t5</span> <span class="o">:=</span> <span class="n">pf45</span>
  <span class="c1">-- dedent terminates the block</span>
  <span class="n">p</span>
</code></pre></div>



<a name="315651379"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%60calc%60%20indentation/near/315651379" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.60calc.60.20indentation.html#315651379">(Dec 13 2022 at 18:01)</a>:</h4>
<p>But it might get painful if you slightly adjust <code>t1</code> and it changes length by one character.</p>



<a name="315653217"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%60calc%60%20indentation/near/315653217" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.60calc.60.20indentation.html#315653217">(Dec 13 2022 at 18:10)</a>:</h4>
<p>So in fact I think my requests are:</p>
<ul>
<li>no padding required between the <code>_</code> and the relation</li>
<li>remains valid under a change in the length of <code>t1</code></li>
<li>cursor is in a valid position after a \newline</li>
</ul>



<a name="315654515"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%60calc%60%20indentation/near/315654515" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.60calc.60.20indentation.html#315654515">(Dec 13 2022 at 18:16)</a>:</h4>
<p>The challenge with supporting that one is that if <code>pf12</code> spans multiple lines  it is difficult to distinguish the <code>_ &lt; t3</code> from the continuation of the proof <code>pf12</code></p>



<a name="315655567"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%60calc%60%20indentation/near/315655567" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.60calc.60.20indentation.html#315655567">(Dec 13 2022 at 18:21)</a>:</h4>
<p>In Lean 3 I think that didn't arise because of the <code>...</code>.  But writing that syntax also has a user-friendliness problem (which I did encounter in Lean 3): if you want to transform an existing left-justified calc block into that syntax, you might need to indent a whole block (rows 2+) by an odd number of spaces, and I never found an easy way to do that in VS Code.</p>



<a name="315656602"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%60calc%60%20indentation/near/315656602" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.60calc.60.20indentation.html#315656602">(Dec 13 2022 at 18:27)</a>:</h4>
<p>the trick I use when that comes up is alt-shift-click to vertical select and then insert spaces to taste</p>



<a name="315719882"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%60calc%60%20indentation/near/315719882" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adrien Champion <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.60calc.60.20indentation.html#315719882">(Dec 14 2022 at 01:27)</a>:</h4>
<p>For what it's worth (which is not much), ease-of-typing points are super odd to me. Eventually Lean will have a formatter, which is how you actually achieve ease-of-typing, right?</p>



<a name="315720024"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%60calc%60%20indentation/near/315720024" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adrien Champion <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.60calc.60.20indentation.html#315720024">(Dec 14 2022 at 01:28)</a>:</h4>
<p>My two cents is that I think arbitrary indentation is bad because it breaks the convention that, by looking at the indentation of a line, I can know which blocks/scope/entity it belongs to.<br>
I think that's valuable, especially for beginners, people unfamiliar with a given piece of <code>calc</code> code, or anyone that's skimming to find something in the code.</p>



<a name="315720569"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%60calc%60%20indentation/near/315720569" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adrien Champion <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.60calc.60.20indentation.html#315720569">(Dec 14 2022 at 01:34)</a>:</h4>
<p>By "arbitrary indentation" I meant <em><code>calc</code> indentation + 2 + whatever the length of first LHS is</em></p>



<a name="315723866"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%60calc%60%20indentation/near/315723866" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.60calc.60.20indentation.html#315723866">(Dec 14 2022 at 02:11)</a>:</h4>
<p><span class="user-mention silent" data-user-id="380302">Adrien Champion</span> <a href="#narrow/stream/270676-lean4/topic/.60calc.60.20indentation/near/315719882">said</a>:</p>
<blockquote>
<p>For what it's worth (which is not much), ease-of-typing points are super odd to me. Eventually Lean will have a formatter, which is how you actually achieve ease-of-typing, right?</p>
</blockquote>
<p>To make a distinction I have often heard from Mario: I think it is very important that it be easy to type <em>valid</em> calc blocks (and that's what I was <a href="#narrow/stream/270676-lean4/topic/.60calc.60.20indentation/near/315653217">emphasizing above</a>).  I think it is less important that it be easy to type style-guide-approved calc blocks.</p>
<p>You're saying here that because of the potential existence of a formatter, you think it is less important that it be easy to type style-guide-approved calc blocks.  So I don't think our positions conflict? :-)</p>



<a name="315723875"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%60calc%60%20indentation/near/315723875" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.60calc.60.20indentation.html#315723875">(Dec 14 2022 at 02:11)</a>:</h4>
<p>PS What do you use calc blocks for?</p>



<a name="315724412"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%60calc%60%20indentation/near/315724412" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adrien Champion <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.60calc.60.20indentation.html#315724412">(Dec 14 2022 at 02:18)</a>:</h4>
<p>I was referring to these</p>
<p><span class="user-mention silent" data-user-id="260507">Heather Macbeth</span> <a href="#narrow/stream/270676-lean4/topic/.60calc.60.20indentation/near/315644605">said</a>:</p>
<blockquote>
<p>Speaking as someone who is about to impose a lot of Lean 4 calc blocks on new-to-Lean undergraduates (see <a href="https://hrmacbeth.github.io/math2001/01_Proofs_by_Calculation.html">here</a> for the Lean 3 version), I would like writing a calc block to be as fast and robust as possible.</p>
<p>So I would like to <em>not</em> require that the column of <code>&lt;</code>/<code>=</code>/etc line up in rows 2+ with the position in row 1: whether you do this by padding before the <code>_</code> or after, it is fiddly and I imagine it would cause headaches.</p>
</blockquote>
<p><span class="user-mention silent" data-user-id="260507">Heather Macbeth</span> <a href="#narrow/stream/270676-lean4/topic/.60calc.60.20indentation/near/315645471">said</a>:</p>
<blockquote>
<p>(Padding after <code>_</code> seems like it would be more painful than padding before <code>_</code>.)</p>
</blockquote>



<a name="315724436"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%60calc%60%20indentation/near/315724436" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adrien Champion <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.60calc.60.20indentation.html#315724436">(Dec 14 2022 at 02:18)</a>:</h4>
<p>But I agree there's no conflict, at least not necessarily</p>



<a name="315724526"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%60calc%60%20indentation/near/315724526" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adrien Champion <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.60calc.60.20indentation.html#315724526">(Dec 14 2022 at 02:20)</a>:</h4>
<p><span class="user-mention silent" data-user-id="260507">Heather Macbeth</span> <a href="#narrow/stream/270676-lean4/topic/.60calc.60.20indentation/near/315723875">said</a>:</p>
<blockquote>
<p>PS What do you use calc blocks for?</p>
</blockquote>
<p>I don't really, I ended up having to deal with this issue which I do find interesting</p>



<a name="315724700"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%60calc%60%20indentation/near/315724700" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.60calc.60.20indentation.html#315724700">(Dec 14 2022 at 02:22)</a>:</h4>
<p>I'm talking in those snippets about requirements (i.e., requirements for the code to be valid).  I do think the things I was describing there are painful to type, so I'd like there to be some valid syntax which avoids them.  Perhaps I was ambiguous, did it sound like I was describing what I wanted in the style guide?</p>



<a name="315724839"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%60calc%60%20indentation/near/315724839" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adrien Champion <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.60calc.60.20indentation.html#315724839">(Dec 14 2022 at 02:24)</a>:</h4>
<p>I think I misunderstood then, any of the three variants I listed allow the plain (I would argue "natural") writing style I think most write spontaneously:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">example</span> <span class="o">:</span> <span class="n">t1</span> <span class="bp">&lt;</span> <span class="n">t5</span> <span class="o">:=</span>
  <span class="k">let</span> <span class="n">_</span> <span class="o">:=</span> <span class="k">calc</span>
    <span class="n">t1</span> <span class="bp">=</span> <span class="n">t2</span> <span class="o">:=</span> <span class="n">pf12</span>
    <span class="n">_</span> <span class="bp">&lt;</span> <span class="n">t3</span> <span class="o">:=</span> <span class="n">pf23</span>
    <span class="n">_</span> <span class="bp">=</span> <span class="n">t4</span> <span class="o">:=</span> <span class="n">pf34</span>
    <span class="n">_</span> <span class="bp">&lt;</span> <span class="n">t5</span> <span class="o">:=</span> <span class="n">pf45</span>
</code></pre></div>



<a name="315725015"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%60calc%60%20indentation/near/315725015" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adrien Champion <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.60calc.60.20indentation.html#315725015">(Dec 14 2022 at 02:26)</a>:</h4>
<p>What I meant is that "how to align symbols" is irrelevant ease-of-typing-wise because you're not doing it (eventually). Unless the formatter introduces arbitrary indentation of course, because that wrecks <code>by</code>, function application...</p>



<a name="315725778"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%60calc%60%20indentation/near/315725778" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.60calc.60.20indentation.html#315725778">(Dec 14 2022 at 02:36)</a>:</h4>
<p>Anyway, I hope that someday there will be further automation to type calc blocks, well beyond just a formatter.  For example, I'd like to be able to easily add a line to a calc block which differs from the previous line only in having a certain term (selected by clicking in the infoview) blanked out, ready for replacement.</p>
<p><span class="user-mention" data-user-id="128280">@Wojciech Nawrocki</span> was telling me that such things should be possible once we have <a href="https://github.com/leanprover/lean4/issues/1494">code actions</a> (or maybe it was <a href="https://github.com/leanprover/lean4/issues/1223">contextual suggestions</a> ...).</p>



<a name="315842184"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%60calc%60%20indentation/near/315842184" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Dan Velleman <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.60calc.60.20indentation.html#315842184">(Dec 14 2022 at 15:13)</a>:</h4>
<p>I think the difficult issue is the case in which the first term is long, as in:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code>  <span class="k">calc</span>
    <span class="n">longId</span> <span class="n">t1</span> <span class="bp">=</span> <span class="n">t2</span> <span class="o">:=</span> <span class="n">pf12</span>
            <span class="n">_</span> <span class="bp">&lt;</span> <span class="n">t3</span> <span class="o">:=</span> <span class="n">pf23</span>
            <span class="n">_</span> <span class="bp">=</span> <span class="n">t4</span> <span class="o">:=</span> <span class="n">pf34</span>
            <span class="n">_</span> <span class="bp">&lt;</span> <span class="n">t5</span> <span class="o">:=</span> <span class="n">pf45</span>
  <span class="c1">-- dedent terminates the block</span>
</code></pre></div>
<p>For that case, I am inclined to use this formatting:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="k">calc</span> <span class="n">longId</span> <span class="n">t1</span>
    <span class="bp">=</span> <span class="n">t2</span> <span class="o">:=</span> <span class="n">pf12</span>
  <span class="n">_</span> <span class="bp">&lt;</span> <span class="n">t3</span> <span class="o">:=</span> <span class="n">pf23</span>
  <span class="n">_</span> <span class="bp">=</span> <span class="n">t4</span> <span class="o">:=</span> <span class="n">pf34</span>
  <span class="n">_</span> <span class="bp">&lt;</span> <span class="n">t5</span> <span class="o">:=</span> <span class="n">pf45</span>
<span class="c1">-- dedent terminates the block</span>
</code></pre></div>
<p>Or, if you don't care that much about lining up the relation symbols:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="k">calc</span> <span class="n">longId</span> <span class="n">t1</span>
  <span class="bp">=</span> <span class="n">t2</span> <span class="o">:=</span> <span class="n">pf12</span>
  <span class="n">_</span> <span class="bp">&lt;</span> <span class="n">t3</span> <span class="o">:=</span> <span class="n">pf23</span>
  <span class="n">_</span> <span class="bp">=</span> <span class="n">t4</span> <span class="o">:=</span> <span class="n">pf34</span>
  <span class="n">_</span> <span class="bp">&lt;</span> <span class="n">t5</span> <span class="o">:=</span> <span class="n">pf45</span>
<span class="c1">-- dedent terminates the block</span>
</code></pre></div>
<p>The last one is easy to type in VSCode:  once you indent the first <code>=</code>, VSCode will indent the later lines the same amount.  The previous one is only slightly harder, and looks nicer.  The advantage of this style is that there's no need to leave large gaps if you want the relation symbols to line up.  Also, it leaves you a lot of room in case any of pf12, pf23, etc. are long.</p>



<a name="315842508"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%60calc%60%20indentation/near/315842508" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ruben Van de Velde <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.60calc.60.20indentation.html#315842508">(Dec 14 2022 at 15:14)</a>:</h4>
<p>If only</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="k">calc</span> <span class="n">longId</span> <span class="n">t1</span>
  <span class="n">_</span> <span class="bp">=</span> <span class="n">t2</span> <span class="o">:=</span> <span class="n">pf12</span>
  <span class="n">_</span> <span class="bp">&lt;</span> <span class="n">t3</span> <span class="o">:=</span> <span class="n">pf23</span>
  <span class="n">_</span> <span class="bp">=</span> <span class="n">t4</span> <span class="o">:=</span> <span class="n">pf34</span>
  <span class="n">_</span> <span class="bp">&lt;</span> <span class="n">t5</span> <span class="o">:=</span> <span class="n">pf45</span>
</code></pre></div>
<p>worked</p>



<a name="315843829"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%60calc%60%20indentation/near/315843829" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.60calc.60.20indentation.html#315843829">(Dec 14 2022 at 15:20)</a>:</h4>
<p>(just to be clear, <span class="user-mention silent" data-user-id="307953">Ruben Van de Velde</span> 's example <em>does</em> work under the proposal, and is my preferred solution to the issues <span class="user-mention" data-user-id="453098">@Dan Velleman</span> raises)</p>



<a name="315844070"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%60calc%60%20indentation/near/315844070" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Dan Velleman <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.60calc.60.20indentation.html#315844070">(Dec 14 2022 at 15:20)</a>:</h4>
<p>Is it really necessary to have the underscores?  What would be closest to what mathematicians actually write is:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="k">calc</span> <span class="n">longId</span> <span class="n">t1</span>
  <span class="bp">=</span> <span class="n">t2</span> <span class="o">:=</span> <span class="n">pf12</span>
  <span class="bp">&lt;</span> <span class="n">t3</span> <span class="o">:=</span> <span class="n">pf23</span>
  <span class="bp">=</span> <span class="n">t4</span> <span class="o">:=</span> <span class="n">pf34</span>
  <span class="bp">&lt;</span> <span class="n">t5</span> <span class="o">:=</span> <span class="n">pf45</span>
</code></pre></div>
<p>Would that be regarded as too confusing, or too much of a departure from previous notation?</p>



<a name="315844200"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%60calc%60%20indentation/near/315844200" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.60calc.60.20indentation.html#315844200">(Dec 14 2022 at 15:21)</a>:</h4>
<p>yes, the underscores are necessary. Otherwise the stuff on the left will be considered as a continuation of the stuff on the right</p>



<a name="315844346"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%60calc%60%20indentation/near/315844346" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.60calc.60.20indentation.html#315844346">(Dec 14 2022 at 15:21)</a>:</h4>
<p>and you don't want <code>pf12 &lt; t3</code> to be considered as the proof of <code>longId t1 = t2</code></p>



<a name="315845089"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%60calc%60%20indentation/near/315845089" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.60calc.60.20indentation.html#315845089">(Dec 14 2022 at 15:24)</a>:</h4>
<p>Well, we could support it, using a <code>withPosition</code> to terminate  <code>pf12</code> and then a trailing_parser to parse <code>&lt; t3</code>. But then we can't support terms on the left, which is not nice</p>



<a name="315846022"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%60calc%60%20indentation/near/315846022" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Dan Velleman <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.60calc.60.20indentation.html#315846022">(Dec 14 2022 at 15:28)</a>:</h4>
<p>In that case, I also like <span class="user-mention silent" data-user-id="307953">Ruben Van de Velde</span>'s proposal: easy to type, looks good, doesn't waste a lot of space with large blank spaces needed to align things.</p>



<a name="315847506"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%60calc%60%20indentation/near/315847506" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Dan Velleman <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.60calc.60.20indentation.html#315847506">(Dec 14 2022 at 15:34)</a>:</h4>
<p>I might  decide to use this style for all calc proofs, even if <code>t1</code> isn't long.<br>
<span class="user-mention" data-user-id="260507">@Heather Macbeth</span> :  Does this style meet your criteria?</p>



<a name="315850626"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%60calc%60%20indentation/near/315850626" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.60calc.60.20indentation.html#315850626">(Dec 14 2022 at 15:48)</a>:</h4>
<p>Yes -- bonus points if when you hit <code>\newline</code> during such a proof it automatically indents you to the right position and types the <code>_</code>!  Is that possible?</p>



<a name="315850790"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%60calc%60%20indentation/near/315850790" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.60calc.60.20indentation.html#315850790">(Dec 14 2022 at 15:49)</a>:</h4>
<p>not yet, but it's feasible</p>



<a name="315856015"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%60calc%60%20indentation/near/315856015" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jireh Loreaux <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.60calc.60.20indentation.html#315856015">(Dec 14 2022 at 16:11)</a>:</h4>
<p>Mario, is the reason you want to support things like <code>alsoSecondTerm</code> on the left-hand side because you will / want to be able to write an alternative second term that is defeq to the first term (and this would be checked automatically?) or do you mean that <code>alsoSecondTerm</code> is syntactically equal to <code>secondTerm</code> and you are just optionally writing it again for clarity?</p>



<a name="315859194"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%60calc%60%20indentation/near/315859194" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.60calc.60.20indentation.html#315859194">(Dec 14 2022 at 16:25)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110049">Mario Carneiro</span> <a href="#narrow/stream/270676-lean4/topic/.60calc.60.20indentation/near/315844200">said</a>:</p>
<blockquote>
<p>yes, the underscores are necessary. Otherwise the stuff on the left will be considered as a continuation of the stuff on the right</p>
</blockquote>
<p>I thought whitespace was now important. Can't we use that somehow?</p>



<a name="315859335"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%60calc%60%20indentation/near/315859335" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.60calc.60.20indentation.html#315859335">(Dec 14 2022 at 16:25)</a>:</h4>
<p>I don't think the column is checked before binops</p>



<a name="319560721"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%60calc%60%20indentation/near/319560721" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adrien Champion <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.60calc.60.20indentation.html#319560721">(Jan 05 2023 at 11:07)</a>:</h4>
<p><span class="user-mention silent" data-user-id="307953">Ruben Van de Velde</span> <a href="#narrow/stream/270676-lean4/topic/.60calc.60.20indentation/near/315842508">said</a>:</p>
<blockquote>
<p>If only</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="k">calc</span> <span class="n">longId</span> <span class="n">t1</span>
  <span class="n">_</span> <span class="bp">=</span> <span class="n">t2</span> <span class="o">:=</span> <span class="n">pf12</span>
  <span class="n">_</span> <span class="bp">&lt;</span> <span class="n">t3</span> <span class="o">:=</span> <span class="n">pf23</span>
  <span class="n">_</span> <span class="bp">=</span> <span class="n">t4</span> <span class="o">:=</span> <span class="n">pf34</span>
  <span class="n">_</span> <span class="bp">&lt;</span> <span class="n">t5</span> <span class="o">:=</span> <span class="n">pf45</span>
</code></pre></div>
<p>worked</p>
</blockquote>
<p>I implemented support for this: <a href="https://github.com/AdrienChampion/lean4/commit/ba391209f9ae1362393c76f1c992570b5d6968ff">https://github.com/AdrienChampion/lean4/commit/ba391209f9ae1362393c76f1c992570b5d6968ff</a></p>



<a name="319560936"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%60calc%60%20indentation/near/319560936" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adrien Champion <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.60calc.60.20indentation.html#319560936">(Jan 05 2023 at 11:08)</a>:</h4>
<p>I'm not sure whether someone had arguments against this syntax, and/or if it would cover everyone's bases. Feedback would be greatly appreciated</p>



<a name="319668466"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%60calc%60%20indentation/near/319668466" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adrien Champion <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.60calc.60.20indentation.html#319668466">(Jan 05 2023 at 20:37)</a>:</h4>
<p><span class="user-mention" data-user-id="307953">@Ruben Van de Velde</span> <span class="user-mention" data-user-id="453098">@Dan Velleman</span> <span class="user-mention" data-user-id="260507">@Heather Macbeth</span></p>



<a name="319787447"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%60calc%60%20indentation/near/319787447" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Dan Velleman <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.60calc.60.20indentation.html#319787447">(Jan 06 2023 at 14:05)</a>:</h4>
<p>That syntax is fine with me.  I hope this would also work:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="k">calc</span> <span class="n">longId</span> <span class="n">t1</span>
    <span class="bp">=</span> <span class="n">t2</span> <span class="o">:=</span> <span class="n">pf12</span>
  <span class="n">_</span> <span class="bp">&lt;</span> <span class="n">t3</span> <span class="o">:=</span> <span class="n">pf23</span>
  <span class="n">_</span> <span class="bp">=</span> <span class="n">t4</span> <span class="o">:=</span> <span class="n">pf34</span>
  <span class="n">_</span> <span class="bp">&lt;</span> <span class="n">t5</span> <span class="o">:=</span> <span class="n">pf45</span>
</code></pre></div>
<p>My main concern is actually indenting after <code>by</code>--an earlier change made it necessary to indent very far after <code>by</code>.  I assume that will also be fixed by this change.</p>



<a name="319813998"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%60calc%60%20indentation/near/319813998" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adrien Champion <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.60calc.60.20indentation.html#319813998">(Jan 06 2023 at 16:23)</a>:</h4>
<p><span class="user-mention" data-user-id="453098">@Dan Velleman</span> well it became necessary to indent very far after <code>by</code> only if you indented your <code>_</code> very far. One of the main point of this change is to not need to do that anymore, so that both the <code>_</code> and <code>by</code>'s body are properly indented</p>



<a name="319814400"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%60calc%60%20indentation/near/319814400" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adrien Champion <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.60calc.60.20indentation.html#319814400">(Jan 06 2023 at 16:25)</a>:</h4>
<p>Like so</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="k">calc</span> <span class="n">longId</span> <span class="n">t1</span>
  <span class="n">_</span> <span class="bp">=</span> <span class="n">t2</span> <span class="o">:=</span> <span class="kd">by</span>
    <span class="n">simp</span>
    <span class="n">exact</span> <span class="n">pf12</span>
  <span class="n">_</span> <span class="bp">&lt;</span> <span class="n">t3</span> <span class="o">:=</span> <span class="n">pf23</span>
  <span class="n">_</span> <span class="bp">=</span> <span class="n">t4</span> <span class="o">:=</span> <span class="n">pf34</span>
  <span class="n">_</span> <span class="bp">&lt;</span> <span class="n">t5</span> <span class="o">:=</span> <span class="n">pf45</span>
</code></pre></div>



<a name="319820278"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%60calc%60%20indentation/near/319820278" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.60calc.60.20indentation.html#319820278">(Jan 06 2023 at 16:56)</a>:</h4>
<p>(deleted)</p>



<a name="319831389"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%60calc%60%20indentation/near/319831389" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.60calc.60.20indentation.html#319831389">(Jan 06 2023 at 17:57)</a>:</h4>
<p><span class="user-mention silent" data-user-id="453098">Dan Velleman</span> <a href="#narrow/stream/270676-lean4/topic/.60calc.60.20indentation/near/319787447">said</a>:</p>
<blockquote>
<p>I hope this would also work:</p>
<p><div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="k">calc</span> <span class="n">longId</span> <span class="n">t1</span>
    <span class="bp">=</span> <span class="n">t2</span> <span class="o">:=</span> <span class="n">pf12</span>
  <span class="n">_</span> <span class="bp">&lt;</span> <span class="n">t3</span> <span class="o">:=</span> <span class="n">pf23</span>
  <span class="n">_</span> <span class="bp">=</span> <span class="n">t4</span> <span class="o">:=</span> <span class="n">pf34</span>
  <span class="n">_</span> <span class="bp">&lt;</span> <span class="n">t5</span> <span class="o">:=</span> <span class="n">pf45</span>
</code></pre></div><br>
</p>
</blockquote>
<p>The issue with this syntax is that you don't know at what indentation we should stop parsing <code>pf12</code> as we don't know the <code>_</code> indentation yet</p>



<a name="319849613"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%60calc%60%20indentation/near/319849613" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adrien Champion <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.60calc.60.20indentation.html#319849613">(Jan 06 2023 at 19:38)</a>:</h4>
<p><span class="user-mention silent" data-user-id="453098">Dan Velleman</span> <a href="#narrow/stream/270676-lean4/topic/.60calc.60.20indentation/near/319787447">said</a>:</p>
<blockquote>
<p>That syntax is fine with me.  I hope this would also work:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="k">calc</span> <span class="n">longId</span> <span class="n">t1</span>
    <span class="bp">=</span> <span class="n">t2</span> <span class="o">:=</span> <span class="n">pf12</span>
  <span class="n">_</span> <span class="bp">&lt;</span> <span class="n">t3</span> <span class="o">:=</span> <span class="n">pf23</span>
  <span class="n">_</span> <span class="bp">=</span> <span class="n">t4</span> <span class="o">:=</span> <span class="n">pf34</span>
  <span class="n">_</span> <span class="bp">&lt;</span> <span class="n">t5</span> <span class="o">:=</span> <span class="n">pf45</span>
</code></pre></div>
<p>My main concern is actually indenting after <code>by</code>--an earlier change made it necessary to indent very far after <code>by</code>.  I assume that will also be fixed by this change.</p>
</blockquote>
<p>So if you want to use <code>by</code> on the <code>= t2</code> line, you need to indent <em>after</em> the start of the line, <em>i.e.</em> the <code>=</code>.</p>
<p>This works</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">example</span> <span class="o">:</span> <span class="n">t1</span> <span class="bp">&lt;</span> <span class="n">t4</span> <span class="o">:=</span>
  <span class="k">calc</span> <span class="n">t1</span>
      <span class="bp">=</span> <span class="n">t2</span> <span class="o">:=</span> <span class="kd">by</span>
        <span class="n">exact</span> <span class="n">pf12</span>
    <span class="n">_</span> <span class="bp">&lt;</span> <span class="n">t3</span> <span class="o">:=</span> <span class="n">pf23</span>
    <span class="n">_</span> <span class="bp">=</span> <span class="n">t4</span> <span class="o">:=</span> <span class="n">pf34</span>
</code></pre></div>
<p>but this does not</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">example</span> <span class="o">:</span> <span class="n">t1</span> <span class="bp">&lt;</span> <span class="n">t4</span> <span class="o">:=</span>
  <span class="k">calc</span> <span class="n">t1</span>
      <span class="bp">=</span> <span class="n">t2</span> <span class="o">:=</span> <span class="kd">by</span>
      <span class="n">exact</span> <span class="n">pf12</span>
    <span class="n">_</span> <span class="bp">&lt;</span> <span class="n">t3</span> <span class="o">:=</span> <span class="n">pf23</span>
    <span class="n">_</span> <span class="bp">=</span> <span class="n">t4</span> <span class="o">:=</span> <span class="n">pf34</span>
</code></pre></div>



<a name="319850710"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%60calc%60%20indentation/near/319850710" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adrien Champion <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.60calc.60.20indentation.html#319850710">(Jan 06 2023 at 19:45)</a>:</h4>
<p>IMHO it seems like</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">example</span> <span class="o">:</span> <span class="n">t1</span> <span class="bp">&lt;</span> <span class="n">t4</span> <span class="o">:=</span>
  <span class="k">calc</span> <span class="n">t1</span>
    <span class="n">_</span> <span class="bp">=</span> <span class="n">t2</span> <span class="o">:=</span> <span class="kd">by</span>
      <span class="n">exact</span> <span class="n">pf12</span>
    <span class="n">_</span> <span class="bp">&lt;</span> <span class="n">t3</span> <span class="o">:=</span> <span class="n">pf23</span>
    <span class="n">_</span> <span class="bp">=</span> <span class="n">t4</span> <span class="o">:=</span> <span class="n">pf34</span>
</code></pre></div>
<p>if merged would be preferable or <em>"more idiomatic"</em> as it makes everything quite consistent, especially indentation</p>



<a name="319867066"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%60calc%60%20indentation/near/319867066" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Dan Velleman <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.60calc.60.20indentation.html#319867066">(Jan 06 2023 at 21:33)</a>:</h4>
<p>Yes, I can see that this is more consistent.  OK, I'm happy with this.</p>



<a name="319938414"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%60calc%60%20indentation/near/319938414" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adrien Champion <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.60calc.60.20indentation.html#319938414">(Jan 07 2023 at 11:09)</a>:</h4>
<p><span class="user-mention" data-user-id="260507">@Heather Macbeth</span> <span class="user-mention" data-user-id="307953">@Ruben Van de Velde</span> it would be great to have your feedback <span aria-label="smiley cat" class="emoji emoji-1f63a" role="img" title="smiley cat">:smiley_cat:</span></p>



<a name="319942934"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%60calc%60%20indentation/near/319942934" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adrien Champion <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.60calc.60.20indentation.html#319942934">(Jan 07 2023 at 11:44)</a>:</h4>
<p><span class="user-mention" data-user-id="110024">@Sebastian Ullrich</span> how much feedback do you think we should get on this point by the way? And do you have suggestions on how to get enough of it besides this thread so far?</p>



<a name="319946628"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%60calc%60%20indentation/near/319946628" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ruben Van de Velde <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.60calc.60.20indentation.html#319946628">(Jan 07 2023 at 12:10)</a>:</h4>
<p>Feedback on what exactly? I think the underscore before every operator is nice, because I often add and remove steps while iterating on a proof</p>



<a name="321502184"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%60calc%60%20indentation/near/321502184" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Dan Velleman <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.60calc.60.20indentation.html#321502184">(Jan 15 2023 at 15:44)</a>:</h4>
<p>Are there now two competing proposals, <a href="https://github.com/leanprover/lean4/pull/1844">#1844</a> and <a href="https://github.com/AdrienChampion/lean4/commit/ba391209f9ae1362393c76f1c992570b5d6968ff">allow underscore in 1st relation</a>?  Perhaps, to get more feedback, you could show us some tests illustrating what works under each proposal?  As I understand it, the second proposal adds a new option: using underscores in the 1st relation.  But does it also rule out anything that is allowed under the first proposal?</p>



<a name="321503063"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%60calc%60%20indentation/near/321503063" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.60calc.60.20indentation.html#321503063">(Jan 15 2023 at 15:53)</a>:</h4>
<p>No, things which work under <a href="https://github.com/leanprover/lean4/pull/1844">lean4#1844</a> should also work in the new version</p>



<a name="321505536"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%60calc%60%20indentation/near/321505536" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Dan Velleman <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.60calc.60.20indentation.html#321505536">(Jan 15 2023 at 16:18)</a>:</h4>
<p><span class="user-mention" data-user-id="380302">@Adrien Champion</span> 's list of examples <a href="https://github.com/AdrienChampion/experimentalean4/blob/main/discussions/ByCalcIndent/ByCalcIndent.lean">here</a> included this example as working under <a href="https://github.com/leanprover/lean4/pull/1844">lean4#1844</a>:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">example</span> <span class="o">:</span> <span class="n">t1</span> <span class="bp">&lt;</span> <span class="n">t4</span> <span class="o">:=</span>
  <span class="k">calc</span>  <span class="n">longId</span> <span class="n">t1</span>
      <span class="bp">=</span> <span class="n">longerId</span> <span class="n">t2</span>
        <span class="o">:=</span> <span class="n">pf12</span>
    <span class="n">_</span> <span class="bp">&lt;</span> <span class="n">t3</span>
        <span class="o">:=</span> <span class="n">id</span> <span class="n">pf23</span>
    <span class="n">_</span> <span class="bp">=</span> <span class="n">t4</span>
        <span class="o">:=</span> <span class="n">id</span> <span class="n">pf34</span>
</code></pre></div>
<p>A previous comment from <span class="user-mention" data-user-id="110024">@Sebastian Ullrich</span> gave me the impression that this wouldn't work under the new version, because when parsing pf12 you don't yet know the indenting level for _.  Is that wrong, or did I misunderstand Sebastian's comment?</p>



<a name="321507450"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%60calc%60%20indentation/near/321507450" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adrien Champion <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.60calc.60.20indentation.html#321507450">(Jan 15 2023 at 16:35)</a>:</h4>
<p><span class="user-mention" data-user-id="453098">@Dan Velleman</span> this works fine, but it will start to break apart if you <code>by</code> + newline</p>



<a name="321507612"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%60calc%60%20indentation/near/321507612" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adrien Champion <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.60calc.60.20indentation.html#321507612">(Jan 15 2023 at 16:37)</a>:</h4>
<p>IMHO it should be discouraged and considered non-idiomatic for the same reasons as above (inconsistent and breaks usual indentation rules)</p>



<a name="321508132"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%60calc%60%20indentation/near/321508132" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.60calc.60.20indentation.html#321508132">(Jan 15 2023 at 16:42)</a>:</h4>
<p>To be clear, this kind of example has exactly the same weird behavior under both versions</p>



<a name="321508179"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%60calc%60%20indentation/near/321508179" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.60calc.60.20indentation.html#321508179">(Jan 15 2023 at 16:43)</a>:</h4>
<p>if you aren't using a multiline <code>by</code>, you might be able to avoid noticing the weird behavior</p>



<a name="321508372"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%60calc%60%20indentation/near/321508372" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Dan Velleman <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.60calc.60.20indentation.html#321508372">(Jan 15 2023 at 16:45)</a>:</h4>
<p>OK, I think I understand.  The "weird behavior" is that after <code>by</code> you would have to indent beyond the <code>=</code>?</p>
<p>If the new proposal just adds a new attractive option without breaking anything, I can't see any reason not to prefer it.</p>



<a name="321508429"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%60calc%60%20indentation/near/321508429" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.60calc.60.20indentation.html#321508429">(Jan 15 2023 at 16:46)</a>:</h4>
<p>you have to indent beyond the column where <code>longId</code> starts</p>



<a name="321508494"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%60calc%60%20indentation/near/321508494" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Dan Velleman <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.60calc.60.20indentation.html#321508494">(Jan 15 2023 at 16:46)</a>:</h4>
<p>Oh, that makes sense.</p>



<a name="321524425"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%60calc%60%20indentation/near/321524425" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adrien Champion <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.60calc.60.20indentation.html#321524425">(Jan 15 2023 at 19:32)</a>:</h4>
<p><span class="user-mention silent" data-user-id="453098">Dan Velleman</span> <a href="#narrow/stream/270676-lean4/topic/.60calc.60.20indentation/near/321502184">said</a>:</p>
<blockquote>
<p>Are there now two competing proposals, <a href="https://github.com/leanprover/lean4/pull/1844">#1844</a> and <a href="https://github.com/AdrienChampion/lean4/commit/ba391209f9ae1362393c76f1c992570b5d6968ff">allow underscore in 1st relation</a>?  Perhaps, to get more feedback, you could show us some tests illustrating what works under each proposal?  As I understand it, the second proposal adds a new option: using underscores in the 1st relation.  But does it also rule out anything that is allowed under the first proposal?</p>
</blockquote>
<p>Underscore in first relation will be added to  <a href="https://github.com/leanprover/lean4/pull/1844">#1844</a> shortly <span aria-label="smile" class="emoji emoji-1f642" role="img" title="smile">:smile:</span></p>



<a name="323051893"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%60calc%60%20indentation/near/323051893" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Dan Velleman <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.60calc.60.20indentation.html#323051893">(Jan 23 2023 at 15:39)</a>:</h4>
<p>I wonder if <a href="https://github.com/leanprover/lean4/pull/1844">#1844</a> will fix the following problem.</p>
<p>The error message I get in this example is very unhelpful:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">Mathlib</span>

<span class="kd">example</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="o">:</span> <span class="n">Nat</span><span class="o">)</span> <span class="o">:</span> <span class="n">a</span> <span class="bp">&gt;</span> <span class="n">b</span> <span class="o">:=</span> <span class="kd">by</span>
  <span class="n">exact</span>
    <span class="k">calc</span>
      <span class="n">a</span> <span class="bp">&gt;</span> <span class="n">b</span> <span class="o">:=</span> <span class="kd">by</span> <span class="n">linarith</span>
  <span class="n">done</span>

<span class="kd">example</span> <span class="o">:</span> <span class="mi">2</span> <span class="bp">+</span> <span class="mi">2</span> <span class="bp">=</span> <span class="mi">4</span> <span class="o">:=</span> <span class="n">rfl</span>
</code></pre></div>
<p>There is no red squiggle anywhere in the first example, even though <code>linarith</code> obviously cannot prove <code>a &gt; b</code>.  The red squiggle appears under the second <code>example</code>.  I assume what's happening here is that Lean thinks that <code>done</code> and the second <code>example</code> are part of the tactic proof of <code>a &gt; b</code>, and it can't parse it, so <code>linarith</code> never actually gets called.  Is that right?</p>



<a name="323088051"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%60calc%60%20indentation/near/323088051" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adrien Champion <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.60calc.60.20indentation.html#323088051">(Jan 23 2023 at 18:22)</a>:</h4>
<p>I'm looking into it, even this is broken</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">example</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="o">:</span> <span class="n">Nat</span><span class="o">)</span> <span class="o">:</span> <span class="n">a</span> <span class="bp">&gt;</span> <span class="n">b</span> <span class="o">:=</span> <span class="kd">by</span>
  <span class="n">exact</span>
    <span class="k">calc</span>
      <span class="n">a</span> <span class="bp">&gt;</span> <span class="n">b</span> <span class="o">:=</span> <span class="kd">by</span> <span class="n">trivial</span>
  <span class="n">done</span>
</code></pre></div>
<p>gives me <code>unexpected end of input; expected ':='</code> after the <code>done</code></p>



<a name="323088508"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%60calc%60%20indentation/near/323088508" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adrien Champion <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.60calc.60.20indentation.html#323088508">(Jan 23 2023 at 18:25)</a>:</h4>
<p><span class="user-mention" data-user-id="453098">@Dan Velleman</span> it does not seem related to the second <code>by</code>:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">example</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="o">:</span> <span class="n">Nat</span><span class="o">)</span> <span class="o">:</span> <span class="n">a</span> <span class="bp">&gt;</span> <span class="n">b</span> <span class="o">:=</span> <span class="kd">by</span>
  <span class="n">exact</span>
    <span class="k">calc</span>
      <span class="n">a</span> <span class="bp">&gt;</span> <span class="n">b</span> <span class="o">:=</span> <span class="gr">sorry</span>
  <span class="n">done</span>
</code></pre></div>
<p>also gives me <code>unexpected end of input; expected ':='</code></p>



<a name="323088631"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%60calc%60%20indentation/near/323088631" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.60calc.60.20indentation.html#323088631">(Jan 23 2023 at 18:25)</a>:</h4>
<p>this is on the PR or on the original?</p>



<a name="323088782"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%60calc%60%20indentation/near/323088782" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adrien Champion <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.60calc.60.20indentation.html#323088782">(Jan 23 2023 at 18:26)</a>:</h4>
<p>That's on nightly</p>



<a name="323088806"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%60calc%60%20indentation/near/323088806" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Dan Velleman <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.60calc.60.20indentation.html#323088806">(Jan 23 2023 at 18:26)</a>:</h4>
<p>I'm using leanprover/lean4:nightly-2023-01-16.</p>



<a name="323088874"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%60calc%60%20indentation/near/323088874" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adrien Champion <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.60calc.60.20indentation.html#323088874">(Jan 23 2023 at 18:27)</a>:</h4>
<p>If you add a second <code>calc</code> line the issue goes away</p>



<a name="323088923"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%60calc%60%20indentation/near/323088923" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adrien Champion <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.60calc.60.20indentation.html#323088923">(Jan 23 2023 at 18:27)</a>:</h4>
<p>It seems to be a problem in <code>calc</code> expecting at least 2 relations to prove</p>



<a name="323089124"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%60calc%60%20indentation/near/323089124" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.60calc.60.20indentation.html#323089124">(Jan 23 2023 at 18:28)</a>:</h4>
<p>that works in lean 3 FWIW</p>



<a name="323089168"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%60calc%60%20indentation/near/323089168" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adrien Champion <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.60calc.60.20indentation.html#323089168">(Jan 23 2023 at 18:28)</a>:</h4>
<p>That would definitely (I think) be a different PR though. <span class="user-mention" data-user-id="110049">@Mario Carneiro</span> want me to investigate this?</p>



<a name="323089209"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%60calc%60%20indentation/near/323089209" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.60calc.60.20indentation.html#323089209">(Jan 23 2023 at 18:28)</a>:</h4>
<p><code>calc term := proof</code> is treated as <code>show term from proof</code></p>



<a name="323089261"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%60calc%60%20indentation/near/323089261" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.60calc.60.20indentation.html#323089261">(Jan 23 2023 at 18:28)</a>:</h4>
<p>I imagine it's a <code>+</code> where there should be a <code>*</code></p>



<a name="323089370"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%60calc%60%20indentation/near/323089370" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.60calc.60.20indentation.html#323089370">(Jan 23 2023 at 18:29)</a>:</h4>
<p>Since you are working on a better version <span class="user-mention" data-user-id="380302">@Adrien Champion</span> I think it suffices to ensure that your version does not inherit the issue</p>



<a name="323089648"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%60calc%60%20indentation/near/323089648" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adrien Champion <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.60calc.60.20indentation.html#323089648">(Jan 23 2023 at 18:30)</a>:</h4>
<p>Could it be the <code>stx[2].getArgs</code> in <a href="https://github.com/leanprover/lean4/blob/master/src/Lean/Elab/Calc.lean#L73">the elaboration</a>?</p>



<a name="323089722"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%60calc%60%20indentation/near/323089722" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adrien Champion <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.60calc.60.20indentation.html#323089722">(Jan 23 2023 at 18:31)</a>:</h4>
<p>That's the term version but the tactic version has the same thing</p>



<a name="323089834"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%60calc%60%20indentation/near/323089834" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.60calc.60.20indentation.html#323089834">(Jan 23 2023 at 18:32)</a>:</h4>
<p>no that's a pure function. The only thing pure functions can do to fail is <code>panic!</code> and this looks quite different</p>



<a name="323090030"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%60calc%60%20indentation/near/323090030" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.60calc.60.20indentation.html#323090030">(Jan 23 2023 at 18:32)</a>:</h4>
<p>it's most likely the <code>syntax</code> declaration for calc</p>



<a name="323090046"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%60calc%60%20indentation/near/323090046" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adrien Champion <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.60calc.60.20indentation.html#323090046">(Jan 23 2023 at 18:33)</a>:</h4>
<p>Just tested and that's only a tactic version issue</p>



<a name="323090081"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%60calc%60%20indentation/near/323090081" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adrien Champion <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.60calc.60.20indentation.html#323090081">(Jan 23 2023 at 18:33)</a>:</h4>
<p>Term <code>calc</code> is happy with just one relation to prove</p>



<a name="323091936"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%60calc%60%20indentation/near/323091936" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adrien Champion <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.60calc.60.20indentation.html#323091936">(Jan 23 2023 at 18:43)</a>:</h4>
<p>This works:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">example</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="o">:</span> <span class="n">Nat</span><span class="o">)</span> <span class="o">:</span> <span class="n">a</span> <span class="bp">&gt;</span> <span class="n">b</span> <span class="o">:=</span> <span class="kd">by</span>
  <span class="n">exact</span>
  <span class="o">(</span><span class="k">calc</span>
    <span class="n">a</span> <span class="bp">&gt;</span> <span class="n">b</span> <span class="o">:=</span> <span class="gr">sorry</span><span class="o">)</span>
  <span class="n">done</span>
</code></pre></div>



<a name="323092075"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%60calc%60%20indentation/near/323092075" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.60calc.60.20indentation.html#323092075">(Jan 23 2023 at 18:44)</a>:</h4>
<p>my guess is that it has something to do with the empty <code>withPosition</code> after the calc</p>



<a name="323192547"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%60calc%60%20indentation/near/323192547" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adrien Champion <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.60calc.60.20indentation.html#323192547">(Jan 24 2023 at 08:42)</a>:</h4>
<p>Still looking into it, but maybe we should open an issue?</p>



<a name="323194837"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%60calc%60%20indentation/near/323194837" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adrien Champion <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.60calc.60.20indentation.html#323194837">(Jan 24 2023 at 08:54)</a>:</h4>
<p><span class="user-mention silent" data-user-id="380302">Adrien Champion</span> <a href="#narrow/stream/270676-lean4/topic/.60calc.60.20indentation/near/323090046">said</a>:</p>
<blockquote>
<p>Just tested and that's only a tactic version issue</p>
</blockquote>
<p>Actually that's not true. The problem triggers whenever there's a <code>calc</code> with a single relation, <strong>and</strong> it is followed by something that could be the start of another relation (regardless of indentation).</p>



<a name="323195031"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%60calc%60%20indentation/near/323195031" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adrien Champion <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.60calc.60.20indentation.html#323195031">(Jan 24 2023 at 08:55)</a>:</h4>
<p>For instance, on term-<code>calc</code>, this works</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">example</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="o">:</span> <span class="n">Nat</span><span class="o">)</span> <span class="o">:</span> <span class="n">a</span> <span class="bp">&gt;</span> <span class="n">b</span> <span class="o">:=</span>
  <span class="k">calc</span>
    <span class="n">a</span> <span class="bp">&gt;</span> <span class="n">b</span> <span class="o">:=</span> <span class="gr">sorry</span>
</code></pre></div>
<p>but this does not</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">example</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="o">:</span> <span class="n">Nat</span><span class="o">)</span> <span class="o">:</span> <span class="n">a</span> <span class="bp">&gt;</span> <span class="n">b</span> <span class="o">:=</span>
  <span class="k">let</span> <span class="n">res</span> <span class="o">:=</span>
    <span class="k">calc</span>
      <span class="n">a</span> <span class="bp">&gt;</span> <span class="n">b</span> <span class="o">:=</span> <span class="gr">sorry</span>
  <span class="n">res</span>
<span class="c1">-- expected ':='</span>
</code></pre></div>



<a name="323195398"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%60calc%60%20indentation/near/323195398" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adrien Champion <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.60calc.60.20indentation.html#323195398">(Jan 24 2023 at 08:56)</a>:</h4>
<p>And on tactic-<code>calc</code>, this works:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">example</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="o">:</span> <span class="n">Nat</span><span class="o">)</span> <span class="o">:</span> <span class="n">a</span> <span class="bp">&gt;</span> <span class="n">b</span> <span class="o">:=</span> <span class="kd">by</span>
  <span class="k">calc</span>
    <span class="n">a</span> <span class="bp">&gt;</span> <span class="n">b</span> <span class="o">:=</span> <span class="gr">sorry</span>

<span class="kd">example</span> <span class="o">:</span> <span class="n">True</span> <span class="o">:=</span> <span class="kd">by</span> <span class="gr">sorry</span>
</code></pre></div>
<p>and as reported this does not</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">example</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="o">:</span> <span class="n">Nat</span><span class="o">)</span> <span class="o">:</span> <span class="n">a</span> <span class="bp">&gt;</span> <span class="n">b</span> <span class="o">:=</span> <span class="kd">by</span>
  <span class="k">calc</span>
    <span class="n">a</span> <span class="bp">&gt;</span> <span class="n">b</span> <span class="o">:=</span> <span class="gr">sorry</span>
  <span class="n">done</span>

<span class="c1">-- expected ':='</span>
<span class="kd">example</span> <span class="o">:</span> <span class="n">True</span> <span class="o">:=</span> <span class="kd">by</span> <span class="gr">sorry</span>
</code></pre></div>



<a name="323196790"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%60calc%60%20indentation/near/323196790" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.60calc.60.20indentation.html#323196790">(Jan 24 2023 at 09:04)</a>:</h4>
<p>The separate <code>withPosition</code>s were requested in <a href="https://github.com/leanprover/lean4/issues/1342#issuecomment-1192114799">https://github.com/leanprover/lean4/issues/1342#issuecomment-1192114799</a></p>



<a name="323196828"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%60calc%60%20indentation/near/323196828" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.60calc.60.20indentation.html#323196828">(Jan 24 2023 at 09:04)</a>:</h4>
<p>The second one should probably be preceded by <code>colGt</code> though</p>



<a name="323197417"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%60calc%60%20indentation/near/323197417" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adrien Champion <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.60calc.60.20indentation.html#323197417">(Jan 24 2023 at 09:07)</a>:</h4>
<p>That's exactly the kind of thing I'm experimenting with, but it's tricky to get it right (especially for a noob like me)</p>



<a name="323197436"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%60calc%60%20indentation/near/323197436" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adrien Champion <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.60calc.60.20indentation.html#323197436">(Jan 24 2023 at 09:07)</a>:</h4>
<p>I'm not far though (hopefully)</p>



<a name="323197819"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%60calc%60%20indentation/near/323197819" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adrien Champion <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.60calc.60.20indentation.html#323197819">(Jan 24 2023 at 09:09)</a>:</h4>
<p>But maybe if the "correctly indented" <code>_</code>-in-first-relation ends up being considered the most idiomatic syntax, <code>calc</code>'s syntax definition could be significantly simpler at the cost of forcing <code>calc</code> "items" to have the same/<code>colGe</code> indentation</p>



<a name="323197955"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%60calc%60%20indentation/near/323197955" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adrien Champion <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.60calc.60.20indentation.html#323197955">(Jan 24 2023 at 09:10)</a>:</h4>
<p>Which I'm all for but I understand that reasonable minds can disagree</p>



<a name="323200798"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%60calc%60%20indentation/near/323200798" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adrien Champion <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.60calc.60.20indentation.html#323200798">(Jan 24 2023 at 09:24)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110024">Sebastian Ullrich</span> <a href="#narrow/stream/270676-lean4/topic/.60calc.60.20indentation/near/323196828">said</a>:</p>
<blockquote>
<p>The second one should probably be preceded by <code>colGt</code> though</p>
</blockquote>
<p>The problem I'm having is that having <code>colGt</code> outside of the repetition in</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">syntax</span> <span class="o">(</span><span class="n">name</span> <span class="o">:=</span> <span class="n">calcTactic</span><span class="o">)</span> <span class="s2">"calc"</span>
  <span class="n">ppLine</span> <span class="n">withPosition</span><span class="o">(</span><span class="n">calcStep</span><span class="o">)</span>
  <span class="n">ppLine</span> <span class="n">withPosition</span><span class="o">((</span><span class="n">calcStep</span> <span class="n">ppLine</span><span class="o">)</span><span class="bp">*</span><span class="o">)</span> <span class="c1">-- ppLine colGt withPosition(...)</span>
  <span class="o">:</span> <span class="n">tactic</span>
</code></pre></div>
<p>means the <code>done</code> (in the examples) will fail the check and produce an error.</p>



<a name="323200990"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%60calc%60%20indentation/near/323200990" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adrien Champion <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.60calc.60.20indentation.html#323200990">(Jan 24 2023 at 09:25)</a>:</h4>
<p>But then if I put the <code>colGt</code> inside the repetition, then it comes after the <code>withPosition</code> and it will always fail</p>



<a name="323201306"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%60calc%60%20indentation/near/323201306" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.60calc.60.20indentation.html#323201306">(Jan 24 2023 at 09:26)</a>:</h4>
<p><span class="user-mention silent" data-user-id="380302">Adrien Champion</span> <a href="#narrow/stream/270676-lean4/topic/.60calc.60.20indentation/near/323197819">said</a>:</p>
<blockquote>
<p>But maybe if the "correctly indented" <code>_</code>-in-first-relation ends up being considered the most idiomatic syntax, <code>calc</code>'s syntax definition could be significantly simpler at the cost of forcing <code>calc</code> "items" to have the same/<code>colGe</code> indentation</p>
</blockquote>
<p>Yes, we should agree on that first</p>



<a name="323201542"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%60calc%60%20indentation/near/323201542" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adrien Champion <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.60calc.60.20indentation.html#323201542">(Jan 24 2023 at 09:27)</a>:</h4>
<p>The closest I have to something working atm is</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">syntax</span> <span class="o">(</span><span class="n">name</span> <span class="o">:=</span> <span class="n">calcTactic</span><span class="o">)</span> <span class="s2">"calc"</span>
  <span class="n">withPosition</span><span class="o">(</span><span class="n">calcStep</span><span class="o">)</span>
  <span class="o">(</span><span class="n">colGt</span> <span class="n">withPosition</span><span class="o">(</span><span class="n">calcStep</span><span class="o">)</span> <span class="n">ppLine</span><span class="o">)</span><span class="bp">*</span>
  <span class="o">:</span> <span class="n">tactic</span>
</code></pre></div>
<p>which passes <strong>my</strong> tests but, I think, allows a bunch of things we don't want, and/or might mis-recognize lines or at least produces bad errors at times</p>



<a name="323202467"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%60calc%60%20indentation/near/323202467" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adrien Champion <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.60calc.60.20indentation.html#323202467">(Jan 24 2023 at 09:32)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110024">Sebastian Ullrich</span> <a href="#narrow/stream/270676-lean4/topic/.60calc.60.20indentation/near/323201306">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="380302">Adrien Champion</span> <a href="#narrow/stream/270676-lean4/topic/.60calc.60.20indentation/near/323197819">said</a>:</p>
<blockquote>
<p>But maybe if the "correctly indented" <code>_</code>-in-first-relation ends up being considered the most idiomatic syntax, <code>calc</code>'s syntax definition could be significantly simpler at the cost of forcing <code>calc</code> "items" to have the same/<code>colGe</code> indentation</p>
</blockquote>
<p>Yes, we should agree on that first</p>
</blockquote>
<p>To sabotage my own point, note that <code>_</code>-in-first-relation forces (I'm pretty sure) to consider the first <code>calcStep</code> separately anyways</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>