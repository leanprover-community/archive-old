---
layout: archive
title: Zulip Chat Archive
permalink: /stream/270676-lean4/topic/How.20to.20use.20.60registerSimpAttr.60.3F.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/index.html">lean4</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/How.20to.20use.20.60registerSimpAttr.60.3F.html">How to use `registerSimpAttr`?</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="275912288"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/How%20to%20use%20%60registerSimpAttr%60%3F/near/275912288" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Tomas Skrivan <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/How.20to.20use.20.60registerSimpAttr.60.3F.html#275912288">(Mar 19 2022 at 14:08)</a>:</h4>
<p>Are simp sets supported and how am I supposed to use <code>registerSimpAttr</code>?</p>
<ul>
<li>It is unclear to me where am I supposed to call <code>registerSimpAttr</code> to properly register a simp attribute.</li>
<li>Looking at <code>Notation.lean</code> it looks like that <code>simp</code> does not define <code>simp  (with simp sets)?</code>, so simp sets are not  currently supported? How difficult would it be to add the support?</li>
</ul>
<p>My attempt, the stuff I would like to get working is commented out.</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">Lean</span>

<span class="kn">open</span> <span class="n">Lean.Meta</span>

<span class="n">initialize</span> <span class="n">mySimpExtension</span> <span class="o">:</span> <span class="n">SimpExtension</span>  <span class="bp">←</span> <span class="n">registerSimpAttr</span> <span class="bp">`</span><span class="n">mysimp</span> <span class="s2">"My simp set"</span>

<span class="c1">-- @[mysimp]</span>
<span class="kd">theorem</span> <span class="n">expand_mul_add</span> <span class="o">(</span><span class="n">x</span> <span class="n">y</span> <span class="n">z</span> <span class="o">:</span> <span class="n">Nat</span><span class="o">)</span> <span class="o">:</span> <span class="n">x</span> <span class="bp">*</span> <span class="o">(</span><span class="n">y</span> <span class="bp">+</span> <span class="n">z</span><span class="o">)</span> <span class="bp">=</span> <span class="n">x</span> <span class="bp">*</span> <span class="n">y</span> <span class="bp">+</span> <span class="n">x</span> <span class="bp">*</span> <span class="n">y</span> <span class="o">:=</span> <span class="gr">sorry</span>

<span class="c1">-- @[mysimp]</span>
<span class="kd">theorem</span> <span class="n">expand_add_mul</span> <span class="o">(</span><span class="n">x</span> <span class="n">y</span> <span class="n">z</span> <span class="o">:</span> <span class="n">Nat</span><span class="o">)</span> <span class="o">:</span> <span class="o">(</span><span class="n">x</span> <span class="bp">+</span> <span class="n">y</span><span class="o">)</span> <span class="bp">*</span> <span class="n">z</span> <span class="bp">=</span> <span class="n">x</span> <span class="bp">*</span> <span class="n">z</span> <span class="bp">+</span> <span class="n">y</span> <span class="bp">*</span> <span class="n">z</span> <span class="o">:=</span> <span class="gr">sorry</span>

<span class="c1">-- @[mysimp]</span>
<span class="kd">theorem</span> <span class="n">lassoc_add</span> <span class="o">(</span><span class="n">x</span> <span class="n">y</span> <span class="n">z</span> <span class="o">:</span> <span class="n">Nat</span><span class="o">)</span> <span class="o">:</span> <span class="n">x</span> <span class="bp">+</span> <span class="o">(</span><span class="n">y</span> <span class="bp">+</span> <span class="n">z</span><span class="o">)</span> <span class="bp">=</span> <span class="n">x</span> <span class="bp">+</span> <span class="n">y</span> <span class="bp">+</span> <span class="n">z</span> <span class="o">:=</span> <span class="gr">sorry</span>

<span class="kd">example</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="n">Nat</span><span class="o">)</span> <span class="o">:</span> <span class="o">(</span><span class="n">x</span> <span class="bp">+</span> <span class="n">x</span><span class="o">)</span> <span class="bp">*</span> <span class="o">(</span><span class="n">x</span> <span class="bp">+</span> <span class="n">x</span><span class="o">)</span> <span class="bp">=</span> <span class="n">x</span> <span class="bp">*</span> <span class="n">x</span> <span class="bp">+</span> <span class="n">x</span> <span class="bp">*</span> <span class="n">x</span> <span class="bp">+</span> <span class="n">x</span> <span class="bp">*</span> <span class="n">x</span> <span class="bp">+</span> <span class="n">x</span> <span class="bp">*</span> <span class="n">x</span> <span class="o">:=</span>
<span class="kd">by</span>
  <span class="n">simp</span> <span class="n">only</span> <span class="o">[</span><span class="n">expand_mul_add</span><span class="o">,</span> <span class="n">expand_add_mul</span><span class="o">,</span> <span class="n">lassoc_add</span><span class="o">]</span>
  <span class="c1">-- simp with mysimp</span>
  <span class="n">done</span>
</code></pre></div>



<a name="275917324"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/How%20to%20use%20%60registerSimpAttr%60%3F/near/275917324" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/How.20to.20use.20.60registerSimpAttr.60.3F.html#275917324">(Mar 19 2022 at 16:15)</a>:</h4>
<p>I think this is close:<br>
First, declare this in a file:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">Lean</span>
<span class="kn">open</span> <span class="n">Lean</span> <span class="n">Meta</span> <span class="k">in</span>
<span class="n">initialize</span> <span class="n">mySimpExtension</span> <span class="o">:</span> <span class="n">TagAttribute</span> <span class="bp">←</span> <span class="n">registerTagAttribute</span> <span class="bp">`</span><span class="n">mysimp</span> <span class="s2">"My simp set"</span>
</code></pre></div>
<p>Then you should be able to use it in another file:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">open</span> <span class="n">Lean</span> <span class="n">Elab.Tactic</span> <span class="n">Parser.Tactic</span>

<span class="k">#check</span> <span class="n">simpLemma</span>

<span class="kd">def</span> <span class="n">toSimpLemma</span> <span class="o">(</span><span class="n">name</span> <span class="o">:</span> <span class="n">Name</span><span class="o">)</span> <span class="o">:</span> <span class="n">Syntax</span> <span class="o">:=</span>
  <span class="gr">sorry</span>

<span class="kd">set_option</span> <span class="n">hygiene</span> <span class="n">false</span> <span class="k">in</span>
<span class="n">elab</span> <span class="s2">"simp "</span> <span class="s2">"with "</span> <span class="n">tag</span><span class="o">:</span><span class="n">ident</span> <span class="o">:</span> <span class="n">tactic</span> <span class="bp">=&gt;</span> <span class="k">do</span>
  <span class="k">let</span> <span class="n">tagName</span> <span class="o">:=</span> <span class="n">tag.getId</span>
  <span class="k">let</span> <span class="n">env</span> <span class="bp">←</span> <span class="n">Lean.getEnv</span>
  <span class="k">let</span> <span class="n">simpMap</span> <span class="o">:=</span> <span class="n">mySimpExtension.ext.getState</span> <span class="n">env</span>
  <span class="k">let</span> <span class="n">mut</span> <span class="n">decls</span> <span class="o">:</span> <span class="n">Array</span> <span class="n">Name</span> <span class="o">:=</span> <span class="bp">#</span><span class="o">[]</span>
  <span class="n">for</span> <span class="n">declName</span> <span class="k">in</span> <span class="n">simpMap</span> <span class="k">do</span>
    <span class="n">decls</span> <span class="o">:=</span> <span class="n">decls.push</span> <span class="n">declName</span>
  <span class="n">dbg_trace</span> <span class="n">decls</span>
  <span class="k">let</span> <span class="n">simpLemmas</span> <span class="o">:</span> <span class="n">Array</span> <span class="n">Syntax</span> <span class="o">:=</span> <span class="bp">#</span><span class="o">[]</span> <span class="c1">-- decls.map toSimpLemma</span>
  <span class="n">evalTactic</span> <span class="bp">$</span> <span class="bp">←</span> <span class="bp">`</span><span class="o">(</span><span class="n">tactic</span><span class="bp">|</span><span class="n">simp</span> <span class="n">only</span> <span class="o">[</span><span class="bp">$</span><span class="n">simpLemmas</span><span class="o">,</span><span class="bp">*</span><span class="o">])</span>


<span class="kd">@[mysimp]</span>
<span class="kd">theorem</span> <span class="n">expand_mul_add</span> <span class="o">(</span><span class="n">x</span> <span class="n">y</span> <span class="n">z</span> <span class="o">:</span> <span class="n">Nat</span><span class="o">)</span> <span class="o">:</span> <span class="n">x</span> <span class="bp">*</span> <span class="o">(</span><span class="n">y</span> <span class="bp">+</span> <span class="n">z</span><span class="o">)</span> <span class="bp">=</span> <span class="n">x</span> <span class="bp">*</span> <span class="n">y</span> <span class="bp">+</span> <span class="n">x</span> <span class="bp">*</span> <span class="n">y</span> <span class="o">:=</span> <span class="gr">sorry</span>

<span class="kd">@[mysimp]</span>
<span class="kd">theorem</span> <span class="n">expand_add_mul</span> <span class="o">(</span><span class="n">x</span> <span class="n">y</span> <span class="n">z</span> <span class="o">:</span> <span class="n">Nat</span><span class="o">)</span> <span class="o">:</span> <span class="o">(</span><span class="n">x</span> <span class="bp">+</span> <span class="n">y</span><span class="o">)</span> <span class="bp">*</span> <span class="n">z</span> <span class="bp">=</span> <span class="n">x</span> <span class="bp">*</span> <span class="n">z</span> <span class="bp">+</span> <span class="n">y</span> <span class="bp">*</span> <span class="n">z</span> <span class="o">:=</span> <span class="gr">sorry</span>

<span class="kd">@[mysimp]</span>
<span class="kd">theorem</span> <span class="n">lassoc_add</span> <span class="o">(</span><span class="n">x</span> <span class="n">y</span> <span class="n">z</span> <span class="o">:</span> <span class="n">Nat</span><span class="o">)</span> <span class="o">:</span> <span class="n">x</span> <span class="bp">+</span> <span class="o">(</span><span class="n">y</span> <span class="bp">+</span> <span class="n">z</span><span class="o">)</span> <span class="bp">=</span> <span class="n">x</span> <span class="bp">+</span> <span class="n">y</span> <span class="bp">+</span> <span class="n">z</span> <span class="o">:=</span> <span class="gr">sorry</span>

<span class="kd">example</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="n">Nat</span><span class="o">)</span> <span class="o">:</span> <span class="o">(</span><span class="n">x</span> <span class="bp">+</span> <span class="n">x</span><span class="o">)</span> <span class="bp">*</span> <span class="o">(</span><span class="n">x</span> <span class="bp">+</span> <span class="n">x</span><span class="o">)</span> <span class="bp">=</span> <span class="n">x</span> <span class="bp">*</span> <span class="n">x</span> <span class="bp">+</span> <span class="n">x</span> <span class="bp">*</span> <span class="n">x</span> <span class="bp">+</span> <span class="n">x</span> <span class="bp">*</span> <span class="n">x</span> <span class="bp">+</span> <span class="n">x</span> <span class="bp">*</span> <span class="n">x</span> <span class="o">:=</span>
<span class="kd">by</span>
  <span class="c1">-- simp only [expand_mul_add, expand_add_mul, lassoc_add]</span>
  <span class="n">simp</span> <span class="k">with</span> <span class="n">mysimp</span>
</code></pre></div>



<a name="275917392"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/How%20to%20use%20%60registerSimpAttr%60%3F/near/275917392" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/How.20to.20use.20.60registerSimpAttr.60.3F.html#275917392">(Mar 19 2022 at 16:17)</a>:</h4>
<p>Someone else more skillful with terms of type <code>Syntax</code> might be able to help you with the implementation of <code>toSimpLemma</code></p>



<a name="275917911"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/How%20to%20use%20%60registerSimpAttr%60%3F/near/275917911" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/How.20to.20use.20.60registerSimpAttr.60.3F.html#275917911">(Mar 19 2022 at 16:31)</a>:</h4>
<p>A flaw in my code: I'm not using <code>tagName</code>. I went straight to <code>mySimpExtension</code>.<br>
Ideally <code>mySimpExtension</code> should be retrieved by using <code>tagName</code></p>



<a name="275918112"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/How%20to%20use%20%60registerSimpAttr%60%3F/near/275918112" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Tomas Skrivan <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/How.20to.20use.20.60registerSimpAttr.60.3F.html#275918112">(Mar 19 2022 at 16:36)</a>:</h4>
<p>Cool this looks good! </p>
<blockquote>
<p>First, declare this in a file:</p>
</blockquote>
<p>In what file? How do I reference that file in the file where I want to use the <code>mysimp</code> attribute?</p>



<a name="275918209"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/How%20to%20use%20%60registerSimpAttr%60%3F/near/275918209" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/How.20to.20use.20.60registerSimpAttr.60.3F.html#275918209">(Mar 19 2022 at 16:39)</a>:</h4>
<p>Make a "dummy file" with that declaration alone. You can't use <code>mySimpExtension</code> in the same file it was registered</p>



<a name="275918280"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/How%20to%20use%20%60registerSimpAttr%60%3F/near/275918280" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/How.20to.20use.20.60registerSimpAttr.60.3F.html#275918280">(Mar 19 2022 at 16:40)</a>:</h4>
<p>Then make another file B with the syntax declaration and tactic implementation, which imports the previous file A. And to use your new <code>simp</code>, just import the file B (which will import the tag attribute transitively)</p>



<a name="275918353"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/How%20to%20use%20%60registerSimpAttr%60%3F/near/275918353" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Tomas Skrivan <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/How.20to.20use.20.60registerSimpAttr.60.3F.html#275918353">(Mar 19 2022 at 16:42)</a>:</h4>
<p>Ok, so I have to use lake to set up the project. There is no other way how to import a file, right?</p>



<a name="275918365"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/How%20to%20use%20%60registerSimpAttr%60%3F/near/275918365" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/How.20to.20use.20.60registerSimpAttr.60.3F.html#275918365">(Mar 19 2022 at 16:43)</a>:</h4>
<p>Not that I know of, at least</p>



<a name="275918443"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/How%20to%20use%20%60registerSimpAttr%60%3F/near/275918443" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Tomas Skrivan <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/How.20to.20use.20.60registerSimpAttr.60.3F.html#275918443">(Mar 19 2022 at 16:45)</a>:</h4>
<p>Great, so I have the attribute working!</p>



<a name="275918839"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/How%20to%20use%20%60registerSimpAttr%60%3F/near/275918839" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/How.20to.20use.20.60registerSimpAttr.60.3F.html#275918839">(Mar 19 2022 at 16:54)</a>:</h4>
<p><span class="user-mention" data-user-id="346070">@Tomas Skrivan</span> if you figure out how to implement <code>toSimpLemma</code> please let me know <span aria-label="eyes" class="emoji emoji-1f440" role="img" title="eyes">:eyes:</span></p>



<a name="275919022"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/How%20to%20use%20%60registerSimpAttr%60%3F/near/275919022" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Tomas Skrivan <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/How.20to.20use.20.60registerSimpAttr.60.3F.html#275919022">(Mar 19 2022 at 16:58)</a>:</h4>
<p>I'm looking at Lean's internals. It looks like that alternatively it would be possible to modify <code>mkSimpContext</code></p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">def</span> <span class="n">mkSimpContext</span> <span class="o">(</span><span class="n">stx</span> <span class="o">:</span> <span class="n">Syntax</span><span class="o">)</span> <span class="o">(</span><span class="n">eraseLocal</span> <span class="o">:</span> <span class="n">Bool</span><span class="o">)</span> <span class="o">(</span><span class="n">ctx</span> <span class="o">:=</span> <span class="n">false</span><span class="o">)</span> <span class="o">(</span><span class="n">ignoreStarArg</span> <span class="o">:</span> <span class="n">Bool</span> <span class="o">:=</span> <span class="n">false</span><span class="o">)</span> <span class="o">:</span> <span class="n">TacticM</span> <span class="n">MkSimpContextResult</span> <span class="o">:=</span> <span class="k">do</span>
  <span class="k">if</span> <span class="n">ctx</span> <span class="bp">&amp;&amp;</span> <span class="bp">!</span><span class="n">stx</span><span class="o">[</span><span class="mi">2</span><span class="o">]</span><span class="bp">.</span><span class="n">isNone</span> <span class="k">then</span>
    <span class="n">throwError</span> <span class="s2">"'simp_all' tactic does not support 'discharger' option"</span>
  <span class="k">let</span> <span class="n">dischargeWrapper</span> <span class="bp">←</span> <span class="n">mkDischargeWrapper</span> <span class="n">stx</span><span class="o">[</span><span class="mi">2</span><span class="o">]</span>
  <span class="k">let</span> <span class="n">simpOnly</span> <span class="o">:=</span> <span class="bp">!</span><span class="n">stx</span><span class="o">[</span><span class="mi">3</span><span class="o">]</span><span class="bp">.</span><span class="n">isNone</span>
  <span class="k">let</span> <span class="n">simpTheorems</span> <span class="bp">←</span>
    <span class="k">if</span> <span class="n">simpOnly</span> <span class="k">then</span>
      <span class="o">({}</span> <span class="o">:</span> <span class="n">SimpTheorems</span><span class="o">)</span><span class="bp">.</span><span class="n">addConst</span> <span class="bp">``</span><span class="n">eq_self</span>
    <span class="k">else</span>
      <span class="n">getSimpTheorems</span>
   <span class="bp">...</span>
</code></pre></div>
<p>I would modify <code>getSimpTheorems</code> to accept <code>Name</code> of the simp extension with default value <code>simp</code>.</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">def</span> <span class="n">getSimpTheorems</span> <span class="o">(</span><span class="n">attrName</span> <span class="o">:=</span> <span class="bp">`</span><span class="n">simp</span><span class="o">)</span> <span class="o">:</span> <span class="n">CoreM</span> <span class="n">SimpTheorems</span> <span class="o">:=</span>
  <span class="o">(</span><span class="bp">&lt;-</span> <span class="n">getSimpExtension</span> <span class="n">attrName</span><span class="o">)</span><span class="bp">.</span><span class="n">getTheorems</span>
</code></pre></div>
<p>The question is:</p>
<ul>
<li>How to turn <code>Name</code> to <code>SimpExtension</code>?</li>
<li>How to get <code>attrName</code> from the syntax <code>stx</code> inside <code>mkSimpContext</code>. This probably requires modifying the syntax definition of <code>simp</code> in Notation.lean</li>
</ul>



<a name="275919368"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/How%20to%20use%20%60registerSimpAttr%60%3F/near/275919368" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Tomas Skrivan <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/How.20to.20use.20.60registerSimpAttr.60.3F.html#275919368">(Mar 19 2022 at 17:05)</a>:</h4>
<p>I'm getting an error:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">failed</span> <span class="n">to</span> <span class="n">synthesize</span> <span class="kd">instance</span> <span class="n">for</span> <span class="bp">'</span><span class="n">for_in</span><span class="bp">%'</span> <span class="kd">notation</span>
  <span class="n">ForIn</span> <span class="o">(</span><span class="n">ReaderT</span> <span class="n">Context</span> <span class="o">(</span><span class="n">StateRefT'</span> <span class="n">IO.RealWorld</span> <span class="n">State</span> <span class="n">Elab.TermElabM</span><span class="o">))</span>
    <span class="o">(</span><span class="n">ScopedEnvExtension.StateStack</span> <span class="n">Meta.SimpEntry</span> <span class="n">Meta.SimpEntry</span> <span class="n">Meta.SimpTheorems</span><span class="o">)</span> <span class="bp">?</span><span class="n">m.221</span>
</code></pre></div>
<p>on the line <code>for declName in simpMap do</code></p>



<a name="275919560"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/How%20to%20use%20%60registerSimpAttr%60%3F/near/275919560" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Tomas Skrivan <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/How.20to.20use.20.60registerSimpAttr.60.3F.html#275919560">(Mar 19 2022 at 17:10)</a>:</h4>
<p>Ohh, I was using <code>SimpExtension</code> instead of <code>TagAttribute</code>. With <code>TagAttribute</code> it works.</p>



<a name="275920555"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/How%20to%20use%20%60registerSimpAttr%60%3F/near/275920555" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/How.20to.20use.20.60registerSimpAttr.60.3F.html#275920555">(Mar 19 2022 at 17:34)</a>:</h4>
<p>But then do you want to implement another tactic? I was trying to delegate the task to <code>simp</code> as is</p>



<a name="275920642"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/How%20to%20use%20%60registerSimpAttr%60%3F/near/275920642" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Tomas Skrivan <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/How.20to.20use.20.60registerSimpAttr.60.3F.html#275920642">(Mar 19 2022 at 17:37)</a>:</h4>
<p><span class="user-mention silent" data-user-id="451983">Arthur Paulino</span> <a href="#narrow/stream/270676-lean4/topic/How.20to.20use.20.60registerSimpAttr.60.3F/near/275918839">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="346070">Tomas Skrivan</span> if you figure out how to implement <code>toSimpLemma</code> please let me know <span aria-label="eyes" class="emoji emoji-1f440" role="img" title="eyes">:eyes:</span></p>
</blockquote>
<p>This code reveals what needs to be created:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code>  <span class="k">let</span> <span class="n">tc</span> <span class="bp">←</span> <span class="bp">`</span><span class="o">(</span><span class="n">tactic</span><span class="bp">|</span><span class="n">simp</span> <span class="n">only</span> <span class="o">[</span><span class="n">expand_mul_add</span><span class="o">])</span>
  <span class="n">dbg_trace</span> <span class="n">tc</span>
</code></pre></div>
<p>The result is:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="o">(</span><span class="n">Tactic.simp</span> <span class="s2">"simp"</span> <span class="o">[]</span> <span class="o">[]</span> <span class="o">[</span><span class="s2">"only"</span><span class="o">]</span> <span class="o">[</span><span class="s2">"["</span> <span class="o">[(</span><span class="n">Tactic.simpLemma</span> <span class="o">[]</span> <span class="o">[]</span> <span class="bp">`</span><span class="n">expand_mul_add._</span><span class="bp">@.</span><span class="n">Main._hyg.869</span><span class="o">)]</span> <span class="s2">"]"</span><span class="o">]</span> <span class="o">[])</span>
</code></pre></div>



<a name="275920660"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/How%20to%20use%20%60registerSimpAttr%60%3F/near/275920660" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/How.20to.20use.20.60registerSimpAttr.60.3F.html#275920660">(Mar 19 2022 at 17:37)</a>:</h4>
<p>I think the <code>._@.Main._hyg.869</code> part can be ignored</p>



<a name="275920727"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/How%20to%20use%20%60registerSimpAttr%60%3F/near/275920727" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/How.20to.20use.20.60registerSimpAttr.60.3F.html#275920727">(Mar 19 2022 at 17:38)</a>:</h4>
<p>And yeah, the question is how to turn </p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="bp">`</span><span class="n">expand_mul_add</span>
</code></pre></div>
<p>into</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="o">(</span><span class="n">Tactic.simpLemma</span> <span class="o">[]</span> <span class="o">[]</span> <span class="bp">`</span><span class="n">expand_mul_add</span><span class="o">)</span>
</code></pre></div>



<a name="275921203"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/How%20to%20use%20%60registerSimpAttr%60%3F/near/275921203" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/How.20to.20use.20.60registerSimpAttr.60.3F.html#275921203">(Mar 19 2022 at 17:51)</a>:</h4>
<blockquote>
<p>How to turn Name to SimpExtension?</p>
</blockquote>
<p>This would be part of the <code>simp with</code> implementation: an environment extension for tracking associations of names to SimpExtensions</p>



<a name="275921325"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/How%20to%20use%20%60registerSimpAttr%60%3F/near/275921325" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Tomas Skrivan <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/How.20to.20use.20.60registerSimpAttr.60.3F.html#275921325">(Mar 19 2022 at 17:53)</a>:</h4>
<p><span class="user-mention silent" data-user-id="451983">Arthur Paulino</span> <a href="#narrow/stream/270676-lean4/topic/How.20to.20use.20.60registerSimpAttr.60.3F/near/275920727">said</a>:</p>
<blockquote>
<p>And yeah, the question is how to turn </p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="bp">`</span><span class="n">expand_mul_add</span>
</code></pre></div>
<p>into</p>
<p><div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="o">(</span><span class="n">Tactic.simpLemma</span> <span class="o">[]</span> <span class="o">[]</span> <span class="bp">`</span><span class="n">expand_mul_add</span><span class="o">)</span>
</code></pre></div><br>
</p>
</blockquote>
<p>Maybe something like this:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">mkNode</span> <span class="bp">`</span><span class="n">Lean.Parser.Tactic.simpLemma</span> <span class="bp">#</span><span class="o">[</span><span class="n">Syntax.node</span> <span class="n">default</span> <span class="n">nullKind</span> <span class="bp">#</span><span class="o">[],</span> <span class="n">Syntax.node</span> <span class="n">default</span> <span class="n">nullKind</span> <span class="bp">#</span><span class="o">[],</span> <span class="n">Syntax.ident</span> <span class="n">SourceInfo.none</span> <span class="n">default</span> <span class="s2">"expand_mul_add"</span> <span class="o">[]]</span>
</code></pre></div>
<p>It is producing correct output on <code>dbg_trace</code> not sure if it is valid <code>Syntax</code>. I have to go now, so I can't test it.</p>



<a name="275921501"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/How%20to%20use%20%60registerSimpAttr%60%3F/near/275921501" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/How.20to.20use.20.60registerSimpAttr.60.3F.html#275921501">(Mar 19 2022 at 17:57)</a>:</h4>
<p>You shouldn't create a syntax to pass to <code>simp</code>, the point of <code>SimpExtension</code> is to store a compiled <code>SimpLemmas</code> object that can be passed directly to <code>simp</code> without having to break it down into lemmas again</p>



<a name="275921659"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/How%20to%20use%20%60registerSimpAttr%60%3F/near/275921659" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Tomas Skrivan <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/How.20to.20use.20.60registerSimpAttr.60.3F.html#275921659">(Mar 19 2022 at 18:00)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110049">Mario Carneiro</span> <a href="#narrow/stream/270676-lean4/topic/How.20to.20use.20.60registerSimpAttr.60.3F/near/275921501">said</a>:</p>
<blockquote>
<p>You shouldn't create a syntax to pass to <code>simp</code>, the point of <code>SimpExtension</code> is to store a compiled <code>SimpLemmas</code> object that can be passed directly to <code>simp</code> without having to break it down into lemmas again</p>
</blockquote>
<p>I agree with that, but I'm just trying to finish Arthur's approach and learning about Lean in the process :)</p>



<a name="275921719"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/How%20to%20use%20%60registerSimpAttr%60%3F/near/275921719" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/How.20to.20use.20.60registerSimpAttr.60.3F.html#275921719">(Mar 19 2022 at 18:01)</a>:</h4>
<p><span class="user-mention" data-user-id="110049">@Mario Carneiro</span> I'm interested in knowing the proper way of doing this <span aria-label="eyes" class="emoji emoji-1f440" role="img" title="eyes">:eyes:</span></p>



<a name="275922342"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/How%20to%20use%20%60registerSimpAttr%60%3F/near/275922342" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Tomas Skrivan <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/How.20to.20use.20.60registerSimpAttr.60.3F.html#275922342">(Mar 19 2022 at 18:17)</a>:</h4>
<p>I think the correct way is to modify  <code>mkSimpContext</code> to use the correct <code>SimpExtension</code> in <code>getSimpTheorems</code>.</p>
<p>This would also involve modifying the parser for simp such that it can accept the simp attribute.</p>



<a name="275922657"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/How%20to%20use%20%60registerSimpAttr%60%3F/near/275922657" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Tomas Skrivan <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/How.20to.20use.20.60registerSimpAttr.60.3F.html#275922657">(Mar 19 2022 at 18:24)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110049">Mario Carneiro</span> <a href="#narrow/stream/270676-lean4/topic/How.20to.20use.20.60registerSimpAttr.60.3F/near/275921203">said</a>:</p>
<blockquote>
<blockquote>
<p>How to turn Name to SimpExtension?</p>
</blockquote>
<p>This would be part of the <code>simp with</code> implementation: an environment extension for tracking associations of names to SimpExtensions</p>
</blockquote>
<p>Where can I find an example of an environment extension? I have no clue how to do that.</p>



<a name="275925106"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/How%20to%20use%20%60registerSimpAttr%60%3F/near/275925106" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/How.20to.20use.20.60registerSimpAttr.60.3F.html#275925106">(Mar 19 2022 at 19:20)</a>:</h4>
<p>This worked:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="c1">-- file A</span>
<span class="kn">import</span> <span class="n">Lean</span>
<span class="kn">open</span> <span class="n">Lean</span> <span class="n">Meta</span> <span class="k">in</span>
<span class="n">initialize</span> <span class="n">mySimpExtension</span> <span class="o">:</span> <span class="n">SimpExtension</span> <span class="bp">←</span> <span class="n">registerSimpAttr</span> <span class="bp">`</span><span class="n">mysimp</span> <span class="s2">"My simp set"</span>
</code></pre></div>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">Lean</span>
<span class="c1">-- import file A</span>
<span class="kn">open</span> <span class="n">Lean</span> <span class="n">Elab.Tactic</span> <span class="n">Parser.Tactic</span>

<span class="kd">def</span> <span class="n">toSimpLemma</span> <span class="o">(</span><span class="n">name</span> <span class="o">:</span> <span class="n">Name</span><span class="o">)</span> <span class="o">:</span> <span class="n">Syntax</span> <span class="o">:=</span>
  <span class="n">mkNode</span> <span class="bp">`</span><span class="n">Lean.Parser.Tactic.simpLemma</span>
    <span class="bp">#</span><span class="o">[</span><span class="n">mkNullNode</span><span class="o">,</span> <span class="n">mkNullNode</span><span class="o">,</span> <span class="n">mkIdent</span> <span class="n">name</span><span class="o">]</span>

<span class="n">elab</span> <span class="s2">"simp "</span> <span class="s2">"with "</span> <span class="n">tag</span><span class="o">:</span><span class="n">ident</span> <span class="o">:</span> <span class="n">tactic</span> <span class="bp">=&gt;</span> <span class="k">do</span>
  <span class="k">let</span> <span class="n">tagName</span> <span class="o">:=</span> <span class="n">tag.getId</span>
  <span class="k">let</span> <span class="n">simpTheorems</span> <span class="bp">←</span> <span class="n">mySimpExtension.getTheorems</span>
  <span class="k">let</span> <span class="n">lemmas</span> <span class="o">:=</span> <span class="n">simpTheorems.lemmaNames.fold</span>
    <span class="o">(</span><span class="n">init</span> <span class="o">:=</span> <span class="bp">#</span><span class="o">[])</span> <span class="o">(</span><span class="k">fun</span> <span class="n">acc</span> <span class="n">n</span> <span class="bp">=&gt;</span> <span class="n">acc.push</span> <span class="o">(</span><span class="n">toSimpLemma</span> <span class="n">n</span><span class="o">))</span>
  <span class="n">evalTactic</span> <span class="bp">$</span> <span class="bp">←</span> <span class="bp">`</span><span class="o">(</span><span class="n">tactic</span><span class="bp">|</span><span class="n">simp</span> <span class="n">only</span> <span class="o">[</span><span class="bp">$</span><span class="n">lemmas.reverse</span><span class="o">,</span><span class="bp">*</span><span class="o">])</span>

<span class="kd">@[mysimp]</span>
<span class="kd">theorem</span> <span class="n">expand_mul_add</span> <span class="o">(</span><span class="n">x</span> <span class="n">y</span> <span class="n">z</span> <span class="o">:</span> <span class="n">Nat</span><span class="o">)</span> <span class="o">:</span> <span class="n">x</span> <span class="bp">*</span> <span class="o">(</span><span class="n">y</span> <span class="bp">+</span> <span class="n">z</span><span class="o">)</span> <span class="bp">=</span> <span class="n">x</span> <span class="bp">*</span> <span class="n">y</span> <span class="bp">+</span> <span class="n">x</span> <span class="bp">*</span> <span class="n">y</span> <span class="o">:=</span> <span class="gr">sorry</span>

<span class="kd">@[mysimp]</span>
<span class="kd">theorem</span> <span class="n">expand_add_mul</span> <span class="o">(</span><span class="n">x</span> <span class="n">y</span> <span class="n">z</span> <span class="o">:</span> <span class="n">Nat</span><span class="o">)</span> <span class="o">:</span> <span class="o">(</span><span class="n">x</span> <span class="bp">+</span> <span class="n">y</span><span class="o">)</span> <span class="bp">*</span> <span class="n">z</span> <span class="bp">=</span> <span class="n">x</span> <span class="bp">*</span> <span class="n">z</span> <span class="bp">+</span> <span class="n">y</span> <span class="bp">*</span> <span class="n">z</span> <span class="o">:=</span> <span class="gr">sorry</span>

<span class="kd">@[mysimp]</span>
<span class="kd">theorem</span> <span class="n">lassoc_add</span> <span class="o">(</span><span class="n">x</span> <span class="n">y</span> <span class="n">z</span> <span class="o">:</span> <span class="n">Nat</span><span class="o">)</span> <span class="o">:</span> <span class="n">x</span> <span class="bp">+</span> <span class="o">(</span><span class="n">y</span> <span class="bp">+</span> <span class="n">z</span><span class="o">)</span> <span class="bp">=</span> <span class="n">x</span> <span class="bp">+</span> <span class="n">y</span> <span class="bp">+</span> <span class="n">z</span> <span class="o">:=</span> <span class="gr">sorry</span>

<span class="kd">example</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="n">Nat</span><span class="o">)</span> <span class="o">:</span>
    <span class="o">(</span><span class="n">x</span> <span class="bp">+</span> <span class="n">x</span><span class="o">)</span> <span class="bp">*</span> <span class="o">(</span><span class="n">x</span> <span class="bp">+</span> <span class="n">x</span><span class="o">)</span> <span class="bp">=</span> <span class="n">x</span> <span class="bp">*</span> <span class="n">x</span> <span class="bp">+</span> <span class="n">x</span> <span class="bp">*</span> <span class="n">x</span> <span class="bp">+</span> <span class="n">x</span> <span class="bp">*</span> <span class="n">x</span> <span class="bp">+</span> <span class="n">x</span> <span class="bp">*</span> <span class="n">x</span> <span class="o">:=</span> <span class="kd">by</span>
  <span class="n">simp</span> <span class="k">with</span> <span class="n">mysimp</span>
</code></pre></div>



<a name="275925215"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/How%20to%20use%20%60registerSimpAttr%60%3F/near/275925215" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/How.20to.20use.20.60registerSimpAttr.60.3F.html#275925215">(Mar 19 2022 at 19:23)</a>:</h4>
<p>But I still don't know how to retrieve <code>mySimpExtension</code> using <code>tagName</code>. I just hardcoded it instead</p>



<a name="275925739"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/How%20to%20use%20%60registerSimpAttr%60%3F/near/275925739" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/How.20to.20use.20.60registerSimpAttr.60.3F.html#275925739">(Mar 19 2022 at 19:36)</a>:</h4>
<p>So this is just as good for now:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">elab</span> <span class="s2">"mysimp"</span> <span class="o">:</span> <span class="n">tactic</span> <span class="bp">=&gt;</span> <span class="k">do</span>
  <span class="k">let</span> <span class="n">lemmas</span> <span class="o">:=</span> <span class="o">(</span><span class="bp">←</span> <span class="n">mySimpExtension.getTheorems</span><span class="o">)</span><span class="bp">.</span><span class="n">lemmaNames.fold</span>
    <span class="o">(</span><span class="n">init</span> <span class="o">:=</span> <span class="bp">#</span><span class="o">[])</span> <span class="o">(</span><span class="k">fun</span> <span class="n">acc</span> <span class="n">n</span> <span class="bp">=&gt;</span> <span class="n">acc.push</span> <span class="o">(</span><span class="n">toSimpLemma</span> <span class="n">n</span><span class="o">))</span>
  <span class="n">evalTactic</span> <span class="bp">$</span> <span class="bp">←</span> <span class="bp">`</span><span class="o">(</span><span class="n">tactic</span><span class="bp">|</span><span class="n">simp</span> <span class="n">only</span> <span class="o">[</span><span class="bp">$</span><span class="n">lemmas.reverse</span><span class="o">,</span><span class="bp">*</span><span class="o">])</span>

<span class="kd">@[mysimp]</span> <span class="kd">theorem</span> <span class="n">expand_mul_add</span> <span class="o">(</span><span class="n">x</span> <span class="n">y</span> <span class="n">z</span> <span class="o">:</span> <span class="n">Nat</span><span class="o">)</span> <span class="o">:</span> <span class="n">x</span> <span class="bp">*</span> <span class="o">(</span><span class="n">y</span> <span class="bp">+</span> <span class="n">z</span><span class="o">)</span> <span class="bp">=</span> <span class="n">x</span> <span class="bp">*</span> <span class="n">y</span> <span class="bp">+</span> <span class="n">x</span> <span class="bp">*</span> <span class="n">y</span> <span class="o">:=</span> <span class="gr">sorry</span>
<span class="kd">@[mysimp]</span> <span class="kd">theorem</span> <span class="n">expand_add_mul</span> <span class="o">(</span><span class="n">x</span> <span class="n">y</span> <span class="n">z</span> <span class="o">:</span> <span class="n">Nat</span><span class="o">)</span> <span class="o">:</span> <span class="o">(</span><span class="n">x</span> <span class="bp">+</span> <span class="n">y</span><span class="o">)</span> <span class="bp">*</span> <span class="n">z</span> <span class="bp">=</span> <span class="n">x</span> <span class="bp">*</span> <span class="n">z</span> <span class="bp">+</span> <span class="n">y</span> <span class="bp">*</span> <span class="n">z</span> <span class="o">:=</span> <span class="gr">sorry</span>
<span class="kd">@[mysimp]</span> <span class="kd">theorem</span> <span class="n">lassoc_add</span> <span class="o">(</span><span class="n">x</span> <span class="n">y</span> <span class="n">z</span> <span class="o">:</span> <span class="n">Nat</span><span class="o">)</span> <span class="o">:</span> <span class="n">x</span> <span class="bp">+</span> <span class="o">(</span><span class="n">y</span> <span class="bp">+</span> <span class="n">z</span><span class="o">)</span> <span class="bp">=</span> <span class="n">x</span> <span class="bp">+</span> <span class="n">y</span> <span class="bp">+</span> <span class="n">z</span> <span class="o">:=</span> <span class="gr">sorry</span>

<span class="kd">example</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="n">Nat</span><span class="o">)</span> <span class="o">:</span> <span class="o">(</span><span class="n">x</span> <span class="bp">+</span> <span class="n">x</span><span class="o">)</span> <span class="bp">*</span> <span class="o">(</span><span class="n">x</span> <span class="bp">+</span> <span class="n">x</span><span class="o">)</span> <span class="bp">=</span> <span class="n">x</span> <span class="bp">*</span> <span class="n">x</span> <span class="bp">+</span> <span class="n">x</span> <span class="bp">*</span> <span class="n">x</span> <span class="bp">+</span> <span class="n">x</span> <span class="bp">*</span> <span class="n">x</span> <span class="bp">+</span> <span class="n">x</span> <span class="bp">*</span> <span class="n">x</span> <span class="o">:=</span> <span class="kd">by</span>
  <span class="n">mysimp</span>
</code></pre></div>



<a name="275925912"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/How%20to%20use%20%60registerSimpAttr%60%3F/near/275925912" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Leonardo de Moura <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/How.20to.20use.20.60registerSimpAttr.60.3F.html#275925912">(Mar 19 2022 at 19:40)</a>:</h4>
<p><span class="user-mention silent" data-user-id="451983">Arthur Paulino</span> <a href="#narrow/stream/270676-lean4/topic/How.20to.20use.20.60registerSimpAttr.60.3F/near/275925215">said</a>:</p>
<blockquote>
<p>But I still don't know how to retrieve <code>mySimpExtension</code> using <code>tagName</code>. I just hardcoded it instead</p>
</blockquote>
<p>I will add an API for this.</p>



<a name="275926034"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/How%20to%20use%20%60registerSimpAttr%60%3F/near/275926034" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/How.20to.20use.20.60registerSimpAttr.60.3F.html#275926034">(Mar 19 2022 at 19:43)</a>:</h4>
<p><span class="user-mention" data-user-id="112857">@Leonardo de Moura</span> My motivation was rather manual though. Mario said that this solution of building the sintax nodes for each lemma was not ideal</p>



<a name="275926099"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/How%20to%20use%20%60registerSimpAttr%60%3F/near/275926099" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/How.20to.20use.20.60registerSimpAttr.60.3F.html#275926099">(Mar 19 2022 at 19:44)</a>:</h4>
<p>Or do you intend to add an API for the native support of <code>simp with &lt;ident&gt;</code>?</p>



<a name="275926121"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/How%20to%20use%20%60registerSimpAttr%60%3F/near/275926121" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Leonardo de Moura <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/How.20to.20use.20.60registerSimpAttr.60.3F.html#275926121">(Mar 19 2022 at 19:44)</a>:</h4>
<p><span class="user-mention" data-user-id="451983">@Arthur Paulino</span> I didn't read the thread, but I am assuming the API is independently useful.</p>



<a name="275926198"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/How%20to%20use%20%60registerSimpAttr%60%3F/near/275926198" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Leonardo de Moura <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/How.20to.20use.20.60registerSimpAttr.60.3F.html#275926198">(Mar 19 2022 at 19:46)</a>:</h4>
<p><span class="user-mention silent" data-user-id="451983">Arthur Paulino</span> <a href="#narrow/stream/270676-lean4/topic/How.20to.20use.20.60registerSimpAttr.60.3F/near/275926099">said</a>:</p>
<blockquote>
<p>Or do you intend to add an API for the native support of <code>simp with &lt;ident&gt;</code>?</p>
</blockquote>
<p>We can add this to the core repo too, but I barely used this feature in Lean 3. If it is a popular, we can add it.</p>



<a name="275926476"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/How%20to%20use%20%60registerSimpAttr%60%3F/near/275926476" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/How.20to.20use.20.60registerSimpAttr.60.3F.html#275926476">(Mar 19 2022 at 19:53)</a>:</h4>
<p>I found <a href="#narrow/stream/270676-lean4/topic/.E2.9C.94.20mkSimpAttr/near/266189490">this thread</a>.</p>
<p>And this answer from Mario:</p>
<p><span class="user-mention silent" data-user-id="110049">Mario Carneiro</span> <a href="#narrow/stream/270676-lean4/topic/.E2.9C.94.20mkSimpAttr/near/266230920">said</a>:</p>
<blockquote>
<p>Correct me if I'm wrong, but although <code>registerSimpAttr</code> can be used to declare simp sets, it isn't possible to <em>use</em> simp sets currently, because <code>simp</code> does not support the syntax <code>simp [] with my_simp_set</code></p>
</blockquote>



<a name="275940510"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/How%20to%20use%20%60registerSimpAttr%60%3F/near/275940510" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/How.20to.20use.20.60registerSimpAttr.60.3F.html#275940510">(Mar 20 2022 at 01:31)</a>:</h4>
<p><span class="user-mention" data-user-id="112857">@Leonardo de Moura</span> <a href="#narrow/stream/270676-lean4/topic/How.20to.20use.20.60registerSimpAttr.60.3F/near/275926198">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="451983">Arthur Paulino</span> <a href="#narrow/stream/270676-lean4/topic/How.20to.20use.20.60registerSimpAttr.60.3F/near/275926099">said</a>:</p>
<blockquote>
<p>Or do you intend to add an API for the native support of <code>simp with &lt;ident&gt;</code>?</p>
</blockquote>
<p>We can add this to the core repo too, but I barely used this feature in Lean 3. If it is a popular, we can add it.</p>
</blockquote>
<p>It isn't very common but it is used by mathlib enough that we need it for mathport. Let me also take the opportunity to propose the alternative syntax <code>simp [..my_simp_set]</code> if you do implement this, I think it's a more intuitive way to write it than <code>with</code> since a simp set is basically a set of lemmas.</p>



<a name="275944483"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/How%20to%20use%20%60registerSimpAttr%60%3F/near/275944483" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/How.20to.20use.20.60registerSimpAttr.60.3F.html#275944483">(Mar 20 2022 at 03:22)</a>:</h4>
<p>Good one. Another point is that <code>simpa</code> has both <code>using</code> and <code>with</code> arguments. So either of those could be conflicting</p>



<a name="275955304"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/How%20to%20use%20%60registerSimpAttr%60%3F/near/275955304" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/How.20to.20use.20.60registerSimpAttr.60.3F.html#275955304">(Mar 20 2022 at 08:29)</a>:</h4>
<p>I think that could even work without the <code>..</code></p>



<a name="275976766"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/How%20to%20use%20%60registerSimpAttr%60%3F/near/275976766" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/How.20to.20use.20.60registerSimpAttr.60.3F.html#275976766">(Mar 20 2022 at 16:57)</a>:</h4>
<p>Although the absence of <code>..</code> can add some overhead: since we can't know explicitly whether an argument is a simp set ot a simp lemma, we'd need to check everytime even though most of the times it won't be a simp set.</p>
<p>Regarding readability, I'd prefer the <code>..my_simp_set</code> so I know before hand that <code>my_simp_set</code> is not a theorem (taking into consideration that the simp set name might not be so obvious)</p>



<a name="275977249"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/How%20to%20use%20%60registerSimpAttr%60%3F/near/275977249" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/How.20to.20use.20.60registerSimpAttr.60.3F.html#275977249">(Mar 20 2022 at 17:07)</a>:</h4>
<p>I don't think the overhead is anything to be concerned about. We already have to check the argument to see if it is a definition or a lemma; much more important is the effect on the user experience: is it important to visibly indicate that a simp set is not a lemma? Note that lemmas can sometimes act like simp sets all on their own, if they happen to be conjunctions of equalities</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>