---
layout: archive
title: Zulip Chat Archive
permalink: /stream/270676-lean4/topic/Yet.20another.20expression.20quotation.20package.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/index.html">lean4</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Yet.20another.20expression.20quotation.20package.html">Yet another expression quotation package</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="237980431"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Yet%20another%20expression%20quotation%20package/near/237980431" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Yet.20another.20expression.20quotation.20package.html#237980431">(May 08 2021 at 19:53)</a>:</h4>
<p>In Lean 3, it often annoyed me that <code> `(%%x = %%y) </code> didn't work.  And even if it did work, you couldn't use it to implement functions such as <code>mk_pairwise_equality : list expr → expr</code> (because there is no way to provide the universe level to the quotation).</p>
<p>Fortunately, such syntax extensions are <a href="https://github.com/gebner/quote4">easy to implement</a> in Lean 4 these days:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">Quote</span>
<span class="kn">open</span> <span class="n">Quote</span>

<span class="kd">def</span> <span class="n">mkPairwiseEquality</span> <span class="o">{</span><span class="n">α</span> <span class="o">:</span> <span class="n">quote</span> <span class="kt">Sort</span> <span class="n">u</span><span class="o">}</span> <span class="o">:</span> <span class="n">List</span> <span class="o">(</span><span class="n">quote</span> <span class="n">α</span><span class="o">)</span> <span class="bp">→</span> <span class="n">quote</span> <span class="kt">Prop</span>
  <span class="bp">|</span> <span class="o">[</span><span class="n">a</span><span class="o">,</span> <span class="n">b</span><span class="o">]</span> <span class="bp">=&gt;</span> <span class="n">quote</span> <span class="n">a</span> <span class="bp">=</span> <span class="n">b</span>
  <span class="bp">|</span> <span class="n">a</span> <span class="o">::</span> <span class="n">b</span> <span class="o">::</span> <span class="n">cs</span> <span class="bp">=&gt;</span>
    <span class="k">let</span> <span class="n">bEqCs</span> <span class="o">:=</span> <span class="n">mkPairwiseEquality</span> <span class="o">(</span><span class="n">b</span> <span class="o">::</span> <span class="n">cs</span><span class="o">)</span>
    <span class="n">quote</span> <span class="n">a</span> <span class="bp">=</span> <span class="n">b</span> <span class="bp">∧</span> <span class="n">bEqCs</span>
  <span class="bp">|</span> <span class="n">_</span> <span class="bp">=&gt;</span> <span class="n">quote</span> <span class="n">True</span>
</code></pre></div>



<a name="237984055"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Yet%20another%20expression%20quotation%20package/near/237984055" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Yet.20another.20expression.20quotation.20package.html#237984055">(May 08 2021 at 20:56)</a>:</h4>
<blockquote>
<p>This has almost certainly been done before somewhere else, by somebody else.</p>
</blockquote>
<p>I think there is something similar in a haskell extension (that is, a type-safe splice operator)</p>



<a name="237985024"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Yet%20another%20expression%20quotation%20package/near/237985024" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Yet.20another.20expression.20quotation.20package.html#237985024">(May 08 2021 at 21:12)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110049">Mario Carneiro</span> <a href="#narrow/stream/270676-lean4/topic/Yet.20another.20expression.20quotation.20package/near/237984055">said</a>:</p>
<blockquote>
<p>I think there is something similar in a haskell extension (that is, a type-safe splice operator)</p>
</blockquote>
<p>Thanks for the pointer, but it is indeed only similar.  The Template Haskell type is <code>Q : Type → Type</code>, while my type is <code>QQ : Expr → Type</code>.  The <code>Type → Type</code> version doesn't work in Lean due to universe polymorphism: we might only know at runtime which universe the type is in, but the <code>Type u → Type</code> version fixes it at compile time.</p>



<a name="237985358"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Yet%20another%20expression%20quotation%20package/near/237985358" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Yet.20another.20expression.20quotation.20package.html#237985358">(May 08 2021 at 21:19)</a>:</h4>
<p>There seems to be a syntactic ambiguity between the two uses of <code>quote</code> for terms and types. How are they disambiguated?</p>



<a name="237985427"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Yet%20another%20expression%20quotation%20package/near/237985427" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Yet.20another.20expression.20quotation.20package.html#237985427">(May 08 2021 at 21:20)</a>:</h4>
<p>Also what are the actual types of <code>quote x : quote α</code> and <code>quote α : Type</code>?</p>



<a name="238015533"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Yet%20another%20expression%20quotation%20package/near/238015533" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Yet.20another.20expression.20quotation.20package.html#238015533">(May 09 2021 at 07:11)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110049">Mario Carneiro</span> <a href="#narrow/stream/270676-lean4/topic/Yet.20another.20expression.20quotation.20package/near/237985358">said</a>:</p>
<blockquote>
<p>There seems to be a syntactic ambiguity between the two uses of <code>quote</code> for terms and types. How are they disambiguated?</p>
</blockquote>
<p>By the expected type.  Maybe it would be less confusing to use capitalization as in <code>quote x : Quote α</code>.</p>



<a name="238015640"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Yet%20another%20expression%20quotation%20package/near/238015640" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Yet.20another.20expression.20quotation.20package.html#238015640">(May 09 2021 at 07:14)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110049">Mario Carneiro</span> <a href="#narrow/stream/270676-lean4/topic/Yet.20another.20expression.20quotation.20package/near/237985427">said</a>:</p>
<blockquote>
<p>Also what are the actual types of <code>quote x : quote α</code> and <code>quote α : Type</code>?</p>
</blockquote>
<p>For example, <code>quote Type : Type</code> expands to <code>QQ (mkSort (mkLevelSucc levelZero))</code>.<br>
And <code>quote Nat : quote Type</code> expands to <code>QQ.mk (mkConst ``Nat)</code></p>



<a name="238040293"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Yet%20another%20expression%20quotation%20package/near/238040293" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Yet.20another.20expression.20quotation.20package.html#238040293">(May 09 2021 at 14:42)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110049">Mario Carneiro</span> <a href="#narrow/stream/270676-lean4/topic/Yet.20another.20expression.20quotation.20package/near/237985358">said</a>:</p>
<blockquote>
<p>There seems to be a syntactic ambiguity between the two uses of <code>quote</code> for terms and types. How are they disambiguated?</p>
</blockquote>
<p>I am also somewhat concerned with the name clash between this <code>quote</code>/<code>Quote</code> and the built-in Lean <code>quote</code>/<code>Quote</code> for generating <code>Syntax</code>.</p>



<a name="238040881"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Yet%20another%20expression%20quotation%20package/near/238040881" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Yet.20another.20expression.20quotation.20package.html#238040881">(May 09 2021 at 14:53)</a>:</h4>
<p>This is literally one of the todo items:</p>
<blockquote>
<p>Pick another name. There is already a <code>Lean.Quote</code> type, which means something slightly different.</p>
</blockquote>
<p>Unfortunately, I only learned of <code>Lean.Quote</code> after I wrote this.  Suggestions for other names are welcome.</p>



<a name="238042009"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Yet%20another%20expression%20quotation%20package/near/238042009" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Yet.20another.20expression.20quotation.20package.html#238042009">(May 09 2021 at 15:12)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110043">Gabriel Ebner</span> <a href="#narrow/stream/270676-lean4/topic/Yet.20another.20expression.20quotation.20package/near/238040881">said</a>:</p>
<blockquote>
<p>Unfortunately, I only learned of <code>Lean.Quote</code> after I wrote this.  Suggestions for other names are welcome.</p>
</blockquote>
<p>I believe <span class="user-mention" data-user-id="110049">@Mario Carneiro</span>  was using <code>reflect</code> as his name for exhibiting a similar concept so that might fit here.</p>
<p>EDIT: Though now looking through the repository, I see that you are already using that terminology for untyped <code>Expr</code> quotations.</p>



<a name="238042907"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Yet%20another%20expression%20quotation%20package/near/238042907" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Yet.20another.20expression.20quotation.20package.html#238042907">(May 09 2021 at 15:30)</a>:</h4>
<p>Since you are already naming the class <code>QQ</code> why not name the whole thing <code>QQ</code> and the command <code>qq</code> as well?</p>



<a name="238042940"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Yet%20another%20expression%20quotation%20package/near/238042940" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Yet.20another.20expression.20quotation.20package.html#238042940">(May 09 2021 at 15:31)</a>:</h4>
<p>Alternatively, since it is a typed <code>reflect</code> you could name it <code>reflectT</code>/<code>ReflectT</code></p>



<a name="238051382"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Yet%20another%20expression%20quotation%20package/near/238051382" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Yet.20another.20expression.20quotation.20package.html#238051382">(May 09 2021 at 18:10)</a>:</h4>
<p>Ever since the postfix <code>!</code> on macros went away, I've had difficulty mentally parsing expressions involving macros, and this one is an example.</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code>    <span class="k">let</span> <span class="n">bEqCs</span> <span class="o">:=</span> <span class="n">mkPairwiseEquality</span> <span class="o">(</span><span class="n">b</span> <span class="o">::</span> <span class="n">cs</span><span class="o">)</span>
    <span class="n">quote</span> <span class="n">a</span> <span class="bp">=</span> <span class="n">b</span> <span class="bp">∧</span> <span class="n">bEqCs</span>
</code></pre></div>
<p>If I didn't know <code>quote</code> was a macro, then this would be returning <code>(quote a) = b ∧ bEqCs</code>, which has the wrong binding and also does not make it obvious that some major syntactic magic is happening. I would prefer that this use a notation closer to <code> `(...) </code>, which already has an association to quotation in lean. Another possible way to signal the use of a macro is to have mandatory parens and no space, as in <code>quote(a = b ∧ bEqCs)</code>. Since this is no longer a valid way to write application of a regular function that seems like a good candidate for "special" functions</p>



<a name="238051457"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Yet%20another%20expression%20quotation%20package/near/238051457" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Yet.20another.20expression.20quotation.20package.html#238051457">(May 09 2021 at 18:11)</a>:</h4>
<p>How about <code>q!(...)</code>?</p>



<a name="238051868"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Yet%20another%20expression%20quotation%20package/near/238051868" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Yet.20another.20expression.20quotation.20package.html#238051868">(May 09 2021 at 18:19)</a>:</h4>
<p>Yeah, it's confusing that the default precedence for macros is different from functions.</p>
<blockquote>
<p>Since this is no longer a valid way to write application of a regular function that seems like a good candidate for "special" functions</p>
</blockquote>
<p>Wait, what?!?  You're right..</p>



<a name="238051995"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Yet%20another%20expression%20quotation%20package/near/238051995" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Yet.20another.20expression.20quotation.20package.html#238051995">(May 09 2021 at 18:22)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110049">Mario Carneiro</span> <a href="#narrow/stream/270676-lean4/topic/Yet.20another.20expression.20quotation.20package/near/238051457">said</a>:</p>
<blockquote>
<p>How about <code>q!(...)</code>?</p>
</blockquote>
<p>I think I'll go with <code>q(...)</code>, since <code>!</code> is no longer supposed to be used for macros.</p>



<a name="238052249"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Yet%20another%20expression%20quotation%20package/near/238052249" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Yet.20another.20expression.20quotation.20package.html#238052249">(May 09 2021 at 18:26)</a>:</h4>
<p>I think we should make an exception for that rule for one-letter macros to accomodate <code>s!</code> and <code>m!</code></p>



<a name="238052276"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Yet%20another%20expression%20quotation%20package/near/238052276" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Yet.20another.20expression.20quotation.20package.html#238052276">(May 09 2021 at 18:28)</a>:</h4>
<p>Tbh, I'd prefer <code>s"foo: {x}"</code> like in Scala.</p>



<a name="238052277"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Yet%20another%20expression%20quotation%20package/near/238052277" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Yet.20another.20expression.20quotation.20package.html#238052277">(May 09 2021 at 18:28)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110049">Mario Carneiro</span> <a href="#narrow/stream/270676-lean4/topic/Yet.20another.20expression.20quotation.20package/near/238052249">said</a>:</p>
<blockquote>
<p>I think we should make an exception for that rule for one-letter macros to accomodate <code>s!</code> and <code>m!</code></p>
</blockquote>
<p><a href="https://github.com/leanprover/lean4/issues/406">https://github.com/leanprover/lean4/issues/406</a></p>



<a name="238052316"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Yet%20another%20expression%20quotation%20package/near/238052316" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Yet.20another.20expression.20quotation.20package.html#238052316">(May 09 2021 at 18:28)</a>:</h4>
<p>but if <code>name(...)</code> catches on as a signal for macros then I can get behind that as well</p>



<a name="238052349"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Yet%20another%20expression%20quotation%20package/near/238052349" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Yet.20another.20expression.20quotation.20package.html#238052349">(May 09 2021 at 18:29)</a>:</h4>
<p><code>s"..."</code> also seems good. Generally, no space after = funny syntax is happening</p>



<a name="238052404"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Yet%20another%20expression%20quotation%20package/near/238052404" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Yet.20another.20expression.20quotation.20package.html#238052404">(May 09 2021 at 18:30)</a>:</h4>
<p>(also, <a href="https://github.com/leanprover/lean4/issues/407">https://github.com/leanprover/lean4/issues/407</a>)</p>



<a name="238052408"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Yet%20another%20expression%20quotation%20package/near/238052408" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Yet.20another.20expression.20quotation.20package.html#238052408">(May 09 2021 at 18:30)</a>:</h4>
<p>also <code>name[...]</code> and <code>name{...}</code> (depending on the macro) a la rust</p>



<a name="238052509"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Yet%20another%20expression%20quotation%20package/near/238052509" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Yet.20another.20expression.20quotation.20package.html#238052509">(May 09 2021 at 18:32)</a>:</h4>
<p>The <code>quote a = b</code> was much easier to parse in the editor because <code>quote</code> is highlighted as a keyword.  Now with <code>q(a = b)</code>, only the first <code>q(</code> is highlighted.  The second <code>)</code> remains black. <span aria-label="bug" class="emoji emoji-1f41b" role="img" title="bug">:bug:</span></p>



<a name="238052512"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Yet%20another%20expression%20quotation%20package/near/238052512" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Yet.20another.20expression.20quotation.20package.html#238052512">(May 09 2021 at 18:32)</a>:</h4>
<p>re: escaping in format strings, rust uses <code>"{{foo}}"</code>, although <code>"\{foo\}"</code> would also be reasonable</p>



<a name="238052677"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Yet%20another%20expression%20quotation%20package/near/238052677" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Yet.20another.20expression.20quotation.20package.html#238052677">(May 09 2021 at 18:35)</a>:</h4>
<p>I suppose you technically only have to escape the open brace</p>



<a name="238054597"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Yet%20another%20expression%20quotation%20package/near/238054597" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Yet.20another.20expression.20quotation.20package.html#238054597">(May 09 2021 at 19:07)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110049">Mario Carneiro</span> <a href="#narrow/stream/270676-lean4/topic/Yet.20another.20expression.20quotation.20package/near/238052677">said</a>:</p>
<blockquote>
<p>I suppose you technically only have to escape the open brace</p>
</blockquote>
<p>True, and <code>"\{foo}"</code> looks better than <code>"\{foo\}"</code> to me. Rust's <code>"{{foo}}"</code> is harder to parse because it could just as easily mean interpolate <code>{foo}</code>.</p>



<a name="238055182"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Yet%20another%20expression%20quotation%20package/near/238055182" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Yet.20another.20expression.20quotation.20package.html#238055182">(May 09 2021 at 19:16)</a>:</h4>
<p>I agree (although I think the escape <code>\}</code> should still be defined and mean <code>}</code>, even if it isn't required, just so people can use the other version if they prefer). Since we already have backslash-escapes in strings it seems needlessly complicated to have more than one kind of escape</p>



<a name="238061852"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Yet%20another%20expression%20quotation%20package/near/238061852" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Isaia Nisoli <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Yet.20another.20expression.20quotation.20package.html#238061852">(May 09 2021 at 21:07)</a>:</h4>
<p>Hi, I'm having some problems with the installation of lean on Ubuntu and some uncaught exception messages in leanpkg...</p>



<a name="238061943"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Yet%20another%20expression%20quotation%20package/near/238061943" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Isaia Nisoli <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Yet.20another.20expression.20quotation.20package.html#238061943">(May 09 2021 at 21:08)</a>:</h4>
<p>what is the best channel to ask help/relate bugs?</p>



<a name="238061978"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Yet%20another%20expression%20quotation%20package/near/238061978" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Yet.20another.20expression.20quotation.20package.html#238061978">(May 09 2021 at 21:08)</a>:</h4>
<p>which lean?</p>



<a name="238062011"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Yet%20another%20expression%20quotation%20package/near/238062011" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Isaia Nisoli <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Yet.20another.20expression.20quotation.20package.html#238062011">(May 09 2021 at 21:09)</a>:</h4>
<p>lean4</p>



<a name="239230353"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Yet%20another%20expression%20quotation%20package/near/239230353" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Yet.20another.20expression.20quotation.20package.html#239230353">(May 18 2021 at 10:26)</a>:</h4>
<p>I have now also implemented pattern matching (though I had to do some creative hacks to extend the match and do notation):</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">Qq</span>
<span class="kn">open</span> <span class="n">Qq</span> <span class="n">Lean</span>

<span class="kd">def</span> <span class="n">frob</span> <span class="o">:</span> <span class="n">Q</span><span class="o">(</span><span class="kt">Prop</span><span class="o">)</span> <span class="bp">→</span> <span class="n">MetaM</span> <span class="n">Q</span><span class="o">(</span><span class="kt">Prop</span><span class="o">)</span>
  <span class="bp">|</span> <span class="bp">~</span><span class="n">q</span><span class="o">(</span><span class="bp">∃</span> <span class="n">x</span> <span class="n">y</span> <span class="o">:</span> <span class="n">α</span><span class="o">,</span> <span class="n">p</span> <span class="n">x</span> <span class="n">y</span><span class="o">)</span> <span class="bp">=&gt;</span> <span class="n">q</span><span class="o">(</span><span class="bp">∀</span> <span class="n">x</span> <span class="n">y</span><span class="o">,</span> <span class="n">p</span> <span class="n">y</span> <span class="n">x</span><span class="o">)</span>
  <span class="bp">|</span> <span class="bp">~</span><span class="n">q</span><span class="o">(</span><span class="bp">∃</span> <span class="n">x</span> <span class="n">y</span><span class="o">,</span> <span class="n">p</span> <span class="n">x</span> <span class="n">y</span><span class="o">)</span> <span class="bp">=&gt;</span> <span class="n">q</span><span class="o">(</span><span class="bp">∀</span> <span class="n">x</span> <span class="n">y</span><span class="o">,</span> <span class="n">p</span> <span class="n">x</span> <span class="n">y</span><span class="o">)</span>
  <span class="bp">|</span> <span class="n">e</span> <span class="bp">=&gt;</span> <span class="n">throwError</span> <span class="s2">"{e}"</span>

<span class="k">#eval</span> <span class="n">frob</span> <span class="n">q</span><span class="o">(</span><span class="bp">∃</span> <span class="n">x</span> <span class="n">y</span><span class="o">,</span> <span class="n">x</span> <span class="bp">≤</span> <span class="n">y</span> <span class="bp">+</span> <span class="mi">0</span><span class="o">)</span>
<span class="k">#eval</span> <span class="n">frob</span> <span class="n">q</span><span class="o">(</span><span class="bp">∃</span> <span class="n">x</span> <span class="o">:</span> <span class="n">String</span><span class="o">,</span> <span class="k">let</span> <span class="n">x</span> <span class="o">:=</span> <span class="n">x.length</span><span class="bp">;</span> <span class="bp">∃</span> <span class="n">y</span><span class="o">,</span> <span class="n">x</span> <span class="bp">≤</span> <span class="n">y</span> <span class="bp">+</span> <span class="mi">42</span><span class="o">)</span>
</code></pre></div>



<a name="239230423"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Yet%20another%20expression%20quotation%20package/near/239230423" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Yet.20another.20expression.20quotation.20package.html#239230423">(May 18 2021 at 10:27)</a>:</h4>
<p>The syntax has changed a bit.  The example at the beginning of the thread is now written as follows:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">Qq</span>
<span class="kn">open</span> <span class="n">Qq</span>

<span class="kd">def</span> <span class="n">mkPairwiseEquality</span> <span class="o">{</span><span class="n">α</span> <span class="o">:</span> <span class="n">Q</span><span class="o">(</span><span class="kt">Sort</span> <span class="n">u</span><span class="o">)}</span> <span class="o">:</span> <span class="n">List</span> <span class="n">Q</span><span class="o">(</span><span class="n">α</span><span class="o">)</span> <span class="bp">→</span> <span class="n">Q</span><span class="o">(</span><span class="kt">Prop</span><span class="o">)</span>
  <span class="bp">|</span> <span class="o">[</span><span class="n">a</span><span class="o">,</span> <span class="n">b</span><span class="o">]</span> <span class="bp">=&gt;</span> <span class="n">q</span><span class="o">(</span><span class="n">a</span> <span class="bp">=</span> <span class="n">b</span><span class="o">)</span>
  <span class="bp">|</span> <span class="n">a</span> <span class="o">::</span> <span class="n">b</span> <span class="o">::</span> <span class="n">cs</span> <span class="bp">=&gt;</span> <span class="n">q</span><span class="o">(</span><span class="n">a</span> <span class="bp">=</span> <span class="n">b</span> <span class="bp">∧</span> <span class="bp">%</span><span class="o">(</span><span class="n">mkPairwiseEquality</span> <span class="o">(</span><span class="n">b</span> <span class="o">::</span> <span class="n">cs</span><span class="o">)))</span>
  <span class="bp">|</span> <span class="n">_</span> <span class="bp">=&gt;</span> <span class="n">q</span><span class="o">(</span><span class="n">True</span><span class="o">)</span>
</code></pre></div>



<a name="239305253"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Yet%20another%20expression%20quotation%20package/near/239305253" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Yet.20another.20expression.20quotation.20package.html#239305253">(May 18 2021 at 18:44)</a>:</h4>
<p>Is there a reason why you have to use <code>%(...)</code> instead of <code>$(...)</code> for antiquotation? The latter would be better for consistency, of course</p>



<a name="239305726"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Yet%20another%20expression%20quotation%20package/near/239305726" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Yet.20another.20expression.20quotation.20package.html#239305726">(May 18 2021 at 18:47)</a>:</h4>
<p>Because that would break the syntax matchers (because <code>$(...)</code> is now parsed as a term).</p>



<a name="239305961"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Yet%20another%20expression%20quotation%20package/near/239305961" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Yet.20another.20expression.20quotation.20package.html#239305961">(May 18 2021 at 18:48)</a>:</h4>
<p>doesn't <code>$(...)</code> work on any syntax class?</p>



<a name="239306076"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Yet%20another%20expression%20quotation%20package/near/239306076" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Yet.20another.20expression.20quotation.20package.html#239306076">(May 18 2021 at 18:49)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">syntax</span> <span class="s2">"$("</span> <span class="n">term</span> <span class="s2">")"</span> <span class="o">:</span> <span class="n">term</span>
<span class="n">macro_rules</span> <span class="bp">|</span> <span class="bp">`</span><span class="o">(</span><span class="bp">$</span><span class="o">(</span><span class="n">foo</span><span class="o">)</span> <span class="bp">+</span> <span class="bp">$</span><span class="o">(</span><span class="n">bar</span><span class="o">))</span> <span class="bp">=&gt;</span> <span class="n">foo</span>
<span class="c">/-</span><span class="cm"> unknown identifier 'foo' -/</span>
</code></pre></div>



<a name="239306107"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Yet%20another%20expression%20quotation%20package/near/239306107" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Yet.20another.20expression.20quotation.20package.html#239306107">(May 18 2021 at 18:49)</a>:</h4>
<p>can you avoid the <code>syntax "$(" term ")" : term</code> part?</p>



<a name="239306181"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Yet%20another%20expression%20quotation%20package/near/239306181" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Yet.20another.20expression.20quotation.20package.html#239306181">(May 18 2021 at 18:50)</a>:</h4>
<p>antiquotation already exists in the grammar</p>



<a name="239306241"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Yet%20another%20expression%20quotation%20package/near/239306241" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Yet.20another.20expression.20quotation.20package.html#239306241">(May 18 2021 at 18:50)</a>:</h4>
<p>you just need to attach a meaning to it in your macro</p>



<a name="239306308"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Yet%20another%20expression%20quotation%20package/near/239306308" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Yet.20another.20expression.20quotation.20package.html#239306308">(May 18 2021 at 18:51)</a>:</h4>
<p>I get a parsing error:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="k">#check</span> <span class="n">q</span><span class="o">(</span> <span class="bp">$</span><span class="n">x</span> <span class="o">)</span>
<span class="c1">-- expected '`(tactic|'</span>
</code></pre></div>



<a name="239306356"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Yet%20another%20expression%20quotation%20package/near/239306356" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Yet.20another.20expression.20quotation.20package.html#239306356">(May 18 2021 at 18:51)</a>:</h4>
<p>Same with <code>$(x)</code>.  Even if it worked, it would be really ugly to match using macro_rules.</p>



<a name="239306507"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Yet%20another%20expression%20quotation%20package/near/239306507" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Yet.20another.20expression.20quotation.20package.html#239306507">(May 18 2021 at 18:52)</a>:</h4>
<p>Probably, but I'd really like this to work from the user side of things</p>



<a name="239306601"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Yet%20another%20expression%20quotation%20package/near/239306601" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Yet.20another.20expression.20quotation.20package.html#239306601">(May 18 2021 at 18:53)</a>:</h4>
<p>The implementation of <code> `(x) </code> itself might give some clues</p>



<a name="239306759"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Yet%20another%20expression%20quotation%20package/near/239306759" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Yet.20another.20expression.20quotation.20package.html#239306759">(May 18 2021 at 18:54)</a>:</h4>
<p>The ability to use the antiquotation syntax outside of quotations was removed in a previous update: <a href="https://github.com/leanprover/lean4/commit/f0960b7f89c61ba4e28ea8239076812255b078be">https://github.com/leanprover/lean4/commit/f0960b7f89c61ba4e28ea8239076812255b078be</a></p>



<a name="239306933"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Yet%20another%20expression%20quotation%20package/near/239306933" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Yet.20another.20expression.20quotation.20package.html#239306933">(May 18 2021 at 18:55)</a>:</h4>
<p>so in that case the <code>q</code> macro just needs to use <code>incQuotDepth</code></p>



<a name="239307023"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Yet%20another%20expression%20quotation%20package/near/239307023" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Yet.20another.20expression.20quotation.20package.html#239307023">(May 18 2021 at 18:55)</a>:</h4>
<p>however, that may result in a clash with the normal antiquotation expansion</p>



<a name="239307120"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Yet%20another%20expression%20quotation%20package/near/239307120" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Yet.20another.20expression.20quotation.20package.html#239307120">(May 18 2021 at 18:56)</a>:</h4>
<p>(especially in nested quotations)</p>



<a name="239307144"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Yet%20another%20expression%20quotation%20package/near/239307144" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Yet.20another.20expression.20quotation.20package.html#239307144">(May 18 2021 at 18:56)</a>:</h4>
<p>Yes, if you have mixed <code>q(...)</code> and <code> `(...)</code> things might get weird</p>



<a name="239307198"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Yet%20another%20expression%20quotation%20package/near/239307198" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Yet.20another.20expression.20quotation.20package.html#239307198">(May 18 2021 at 18:56)</a>:</h4>
<p>I will let sebastian handle the macro macro stuff, that's a bit too mind bending for me</p>



<a name="239307300"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Yet%20another%20expression%20quotation%20package/near/239307300" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Yet.20another.20expression.20quotation.20package.html#239307300">(May 18 2021 at 18:57)</a>:</h4>
<p>You don't <em>need</em> quotations to implement <code>q(...)</code>, it's just a convenience, you can always just wrangle <code>Syntax</code> objects directly</p>



<a name="239307411"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Yet%20another%20expression%20quotation%20package/near/239307411" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Yet.20another.20expression.20quotation.20package.html#239307411">(May 18 2021 at 18:58)</a>:</h4>
<p>so I would just fall back on that when the syntax gets mixed up</p>



<a name="239307541"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Yet%20another%20expression%20quotation%20package/near/239307541" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Yet.20another.20expression.20quotation.20package.html#239307541">(May 18 2021 at 18:59)</a>:</h4>
<p>I'll see if I can make this incQuotDepth work.  I'm not happy about the zoo of antiquotations either.</p>



<a name="239307600"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Yet%20another%20expression%20quotation%20package/near/239307600" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Yet.20another.20expression.20quotation.20package.html#239307600">(May 18 2021 at 18:59)</a>:</h4>
<p>BTW, what do you think of the <code>q(x + y)</code>.  Would you prefer <code>q($x + $y)</code>?</p>



<a name="239307832"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Yet%20another%20expression%20quotation%20package/near/239307832" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Yet.20another.20expression.20quotation.20package.html#239307832">(May 18 2021 at 19:00)</a>:</h4>
<p>I don't see that example above, but if <code>x</code> and <code>y</code> are coming from the context then I think they should be <code>$x</code> and <code>$y</code></p>



<a name="239307984"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Yet%20another%20expression%20quotation%20package/near/239307984" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Yet.20another.20expression.20quotation.20package.html#239307984">(May 18 2021 at 19:01)</a>:</h4>
<p>In short, it should act roughly like lean 3 expr quotation but with better typing</p>



<a name="239308178"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Yet%20another%20expression%20quotation%20package/near/239308178" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Yet.20another.20expression.20quotation.20package.html#239308178">(May 18 2021 at 19:02)</a>:</h4>
<p>Having no sigils like your original version looks nice but talking about the different meta levels is confusing as it is and syntax that is too sugary may obscure this</p>



<a name="239308594"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Yet%20another%20expression%20quotation%20package/near/239308594" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Yet.20another.20expression.20quotation.20package.html#239308594">(May 18 2021 at 19:05)</a>:</h4>
<p>One motivation was that you could do <code>q(by rwa [add_zero] at h)</code> but <code>q(by rwa [add_zero] at %h)</code> would have been a parse error (because I don't think you can declare additional ident parsers).  With the dollar, <code>q(by rwa [add_zero] at $h)</code> should parse though.</p>



<a name="239309051"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Yet%20another%20expression%20quotation%20package/near/239309051" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Yet.20another.20expression.20quotation.20package.html#239309051">(May 18 2021 at 19:08)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110043">Gabriel Ebner</span> <a href="#narrow/stream/270676-lean4/topic/Yet.20another.20expression.20quotation.20package/near/239308594">said</a>:</p>
<blockquote>
<p>(because I don't think you can declare additional ident parsers). </p>
</blockquote>
<p>Nope, sadly. <span aria-label="sad" class="emoji emoji-2639" role="img" title="sad">:sad:</span> I already ran into this issue in this thread: <a href="#narrow/stream/270676-lean4/topic/Custom.20identifiers.3F/near/234409388">https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Custom.20identifiers.3F/near/234409388</a>.</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>