---
layout: archive
title: Zulip Chat Archive
permalink: /stream/270676-lean4/topic/.E2.9C.94.20macro.20problem.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/index.html">lean4</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.E2.9C.94.20macro.20problem.html">âœ” macro problem</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="282947923"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%E2%9C%94%20macro%20problem/near/282947923" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joseph O <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.E2.9C.94.20macro.20problem.html#282947923">(May 19 2022 at 15:42)</a>:</h4>
<p>Ah yes i see</p>



<a name="282949077"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%E2%9C%94%20macro%20problem/near/282949077" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joseph O <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.E2.9C.94.20macro.20problem.html#282949077">(May 19 2022 at 15:50)</a>:</h4>
<p>Well now I have </p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">syntax</span> <span class="s2">"let"</span> <span class="n">ident</span> <span class="s2">" := "</span> <span class="n">term</span> <span class="s2">" in "</span> <span class="n">term</span> <span class="o">:</span> <span class="n">term</span>
<span class="n">syntax</span> <span class="s2">"let"</span> <span class="o">(</span><span class="n">ident</span> <span class="s2">" := "</span> <span class="n">term</span><span class="o">),</span><span class="bp">*</span> <span class="n">ident</span> <span class="s2">" := "</span> <span class="n">term</span> <span class="s2">" in "</span> <span class="n">term</span> <span class="o">:</span> <span class="n">term</span>

<span class="n">macro_rules</span>
  <span class="bp">|</span> <span class="bp">`</span><span class="o">(</span><span class="k">let</span> <span class="bp">$</span><span class="n">name1</span><span class="o">:</span><span class="n">ident</span> <span class="o">:=</span> <span class="bp">$</span><span class="n">v1</span><span class="o">:</span><span class="n">term</span><span class="o">,</span>
      <span class="o">(</span><span class="bp">$</span><span class="n">names</span><span class="o">:</span><span class="n">ident</span> <span class="o">:=</span> <span class="bp">$</span><span class="n">vs</span><span class="o">:</span><span class="n">term</span><span class="o">),</span><span class="bp">*</span>
      <span class="bp">$</span><span class="n">name</span><span class="o">:</span><span class="n">ident</span> <span class="o">:=</span> <span class="bp">$</span><span class="n">v</span><span class="o">:</span><span class="n">term</span> <span class="k">in</span> <span class="bp">$</span><span class="n">e</span><span class="o">:</span><span class="n">term</span><span class="o">)</span> <span class="bp">=&gt;</span>
    <span class="bp">`</span><span class="o">(</span><span class="k">let</span> <span class="bp">$</span><span class="n">name1</span> <span class="o">:=</span> <span class="bp">$</span><span class="n">v1</span><span class="bp">;</span>
      <span class="k">let</span> <span class="o">(</span><span class="bp">$</span><span class="n">names</span><span class="o">:</span><span class="n">ident</span> <span class="o">:=</span> <span class="bp">$</span><span class="n">vs</span><span class="o">:</span><span class="n">term</span><span class="o">),</span><span class="bp">*</span>
      <span class="bp">$</span><span class="n">name</span><span class="o">:</span><span class="n">ident</span> <span class="o">:=</span> <span class="bp">$</span><span class="n">v</span><span class="o">:</span><span class="n">term</span> <span class="k">in</span> <span class="bp">$</span><span class="n">e</span><span class="o">:</span><span class="n">term</span><span class="o">)</span>
  <span class="bp">|</span> <span class="bp">`</span><span class="o">(</span><span class="k">let</span> <span class="bp">$</span><span class="n">name</span><span class="o">:</span><span class="n">ident</span> <span class="o">:=</span> <span class="bp">$</span><span class="n">v</span><span class="o">:</span><span class="n">term</span> <span class="k">in</span> <span class="bp">$</span><span class="n">e</span><span class="o">:</span><span class="n">term</span><span class="o">)</span> <span class="bp">=&gt;</span>
    <span class="bp">`</span><span class="o">(</span><span class="k">let</span> <span class="bp">$</span><span class="n">name</span> <span class="o">:=</span> <span class="bp">$</span><span class="n">v</span><span class="bp">;</span> <span class="bp">$</span><span class="n">e</span><span class="o">)</span>
</code></pre></div>
<p>Which gives the error</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">expected</span> <span class="n">identifier</span>
</code></pre></div>
<p>Hopefully this is not a silly mistake this time</p>



<a name="282952083"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%E2%9C%94%20macro%20problem/near/282952083" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.E2.9C.94.20macro.20problem.html#282952083">(May 19 2022 at 16:10)</a>:</h4>
<p>Try this:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">syntax</span> <span class="n">binder</span> <span class="o">:=</span> <span class="n">ident</span> <span class="s2">" := "</span> <span class="n">term</span>
<span class="n">syntax</span> <span class="s2">"let"</span> <span class="n">binder</span><span class="o">,</span><span class="bp">*</span> <span class="s2">" in "</span> <span class="n">term</span> <span class="o">:</span> <span class="n">term</span>

<span class="n">macro_rules</span>
  <span class="bp">|</span> <span class="bp">`</span><span class="o">(</span><span class="k">let</span> <span class="bp">$</span><span class="n">name</span><span class="o">:</span><span class="n">ident</span> <span class="o">:=</span> <span class="bp">$</span><span class="n">v</span><span class="o">:</span><span class="n">term</span> <span class="k">in</span> <span class="bp">$</span><span class="n">t</span><span class="o">:</span><span class="n">term</span><span class="o">)</span> <span class="bp">=&gt;</span> <span class="bp">`</span><span class="o">(</span><span class="k">let</span> <span class="bp">$</span><span class="n">name</span> <span class="o">:=</span> <span class="bp">$</span><span class="n">v</span><span class="bp">;</span> <span class="bp">$</span><span class="n">t</span><span class="o">)</span>
  <span class="bp">|</span> <span class="bp">`</span><span class="o">(</span><span class="k">let</span> <span class="bp">$</span><span class="n">name</span><span class="o">:</span><span class="n">ident</span> <span class="o">:=</span> <span class="bp">$</span><span class="n">v</span><span class="o">:</span><span class="n">term</span><span class="o">,</span> <span class="bp">$</span><span class="n">bs</span><span class="o">:</span><span class="n">binder</span><span class="o">,</span><span class="bp">*</span> <span class="k">in</span> <span class="bp">$</span><span class="n">t</span><span class="o">:</span><span class="n">term</span><span class="o">)</span> <span class="bp">=&gt;</span>
    <span class="bp">`</span><span class="o">(</span><span class="k">let</span> <span class="bp">$</span><span class="n">name</span> <span class="o">:=</span> <span class="bp">$</span><span class="n">v</span><span class="bp">;</span> <span class="k">let</span> <span class="bp">$</span><span class="n">bs</span><span class="o">:</span><span class="n">binder</span><span class="o">,</span><span class="bp">*</span> <span class="k">in</span> <span class="bp">$</span><span class="n">t</span><span class="o">:</span><span class="n">term</span><span class="o">)</span>

<span class="kd">def</span> <span class="n">test</span> <span class="o">:=</span> <span class="k">let</span> <span class="n">x</span> <span class="o">:=</span> <span class="mi">1</span><span class="o">,</span> <span class="n">y</span> <span class="o">:=</span> <span class="mi">2</span> <span class="k">in</span> <span class="n">x</span> <span class="bp">+</span> <span class="n">y</span>

<span class="k">#eval</span> <span class="n">test</span> <span class="c1">-- 3</span>
</code></pre></div>



<a name="282952129"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%E2%9C%94%20macro%20problem/near/282952129" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joseph O <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.E2.9C.94.20macro.20problem.html#282952129">(May 19 2022 at 16:10)</a>:</h4>
<p>What is binder?</p>



<a name="282952220"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%E2%9C%94%20macro%20problem/near/282952220" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.E2.9C.94.20macro.20problem.html#282952220">(May 19 2022 at 16:11)</a>:</h4>
<p><code>binder</code> is a syntax being defined right there</p>



<a name="282952269"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%E2%9C%94%20macro%20problem/near/282952269" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.E2.9C.94.20macro.20problem.html#282952269">(May 19 2022 at 16:11)</a>:</h4>
<p>This also works:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">syntax</span> <span class="n">bla</span> <span class="o">:=</span> <span class="n">ident</span> <span class="s2">" := "</span> <span class="n">term</span>
<span class="n">syntax</span> <span class="s2">"let"</span> <span class="n">bla</span><span class="o">,</span><span class="bp">*</span> <span class="s2">" in "</span> <span class="n">term</span> <span class="o">:</span> <span class="n">term</span>

<span class="n">macro_rules</span>
  <span class="bp">|</span> <span class="bp">`</span><span class="o">(</span><span class="k">let</span> <span class="bp">$</span><span class="n">name</span><span class="o">:</span><span class="n">ident</span> <span class="o">:=</span> <span class="bp">$</span><span class="n">v</span><span class="o">:</span><span class="n">term</span> <span class="k">in</span> <span class="bp">$</span><span class="n">t</span><span class="o">:</span><span class="n">term</span><span class="o">)</span> <span class="bp">=&gt;</span> <span class="bp">`</span><span class="o">(</span><span class="k">let</span> <span class="bp">$</span><span class="n">name</span> <span class="o">:=</span> <span class="bp">$</span><span class="n">v</span><span class="bp">;</span> <span class="bp">$</span><span class="n">t</span><span class="o">)</span>
  <span class="bp">|</span> <span class="bp">`</span><span class="o">(</span><span class="k">let</span> <span class="bp">$</span><span class="n">name</span><span class="o">:</span><span class="n">ident</span> <span class="o">:=</span> <span class="bp">$</span><span class="n">v</span><span class="o">:</span><span class="n">term</span><span class="o">,</span> <span class="bp">$</span><span class="n">bs</span><span class="o">:</span><span class="n">bla</span><span class="o">,</span><span class="bp">*</span> <span class="k">in</span> <span class="bp">$</span><span class="n">t</span><span class="o">:</span><span class="n">term</span><span class="o">)</span> <span class="bp">=&gt;</span>
    <span class="bp">`</span><span class="o">(</span><span class="k">let</span> <span class="bp">$</span><span class="n">name</span> <span class="o">:=</span> <span class="bp">$</span><span class="n">v</span><span class="bp">;</span> <span class="k">let</span> <span class="bp">$</span><span class="n">bs</span><span class="o">:</span><span class="n">bla</span><span class="o">,</span><span class="bp">*</span> <span class="k">in</span> <span class="bp">$</span><span class="n">t</span><span class="o">:</span><span class="n">term</span><span class="o">)</span>

<span class="kd">def</span> <span class="n">test</span> <span class="o">:=</span> <span class="k">let</span> <span class="n">x</span> <span class="o">:=</span> <span class="mi">1</span><span class="o">,</span> <span class="n">y</span> <span class="o">:=</span> <span class="mi">2</span> <span class="k">in</span> <span class="n">x</span> <span class="bp">+</span> <span class="n">y</span>

<span class="k">#eval</span> <span class="n">test</span> <span class="c1">-- 3</span>
</code></pre></div>



<a name="282952270"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%E2%9C%94%20macro%20problem/near/282952270" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joseph O <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.E2.9C.94.20macro.20problem.html#282952270">(May 19 2022 at 16:11)</a>:</h4>
<p>oh</p>



<a name="282952458"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%E2%9C%94%20macro%20problem/near/282952458" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.E2.9C.94.20macro.20problem.html#282952458">(May 19 2022 at 16:12)</a>:</h4>
<p>It's similar to creating a syntax category, but it's simpler, more suited for when you don't want to expand it</p>



<a name="282952573"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%E2%9C%94%20macro%20problem/near/282952573" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joseph O <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.E2.9C.94.20macro.20problem.html#282952573">(May 19 2022 at 16:13)</a>:</h4>
<p>Yeah it makes sense</p>



<a name="282952580"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%E2%9C%94%20macro%20problem/near/282952580" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joseph O <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.E2.9C.94.20macro.20problem.html#282952580">(May 19 2022 at 16:13)</a>:</h4>
<p>Thanks!</p>



<a name="282952581"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%E2%9C%94%20macro%20problem/near/282952581" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Notification Bot <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.E2.9C.94.20macro.20problem.html#282952581">(May 19 2022 at 16:13)</a>:</h4>
<p><span class="user-mention silent" data-user-id="467926">Joseph O</span> has marked this topic as resolved.</p>



<a name="282953735"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%E2%9C%94%20macro%20problem/near/282953735" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.E2.9C.94.20macro.20problem.html#282953735">(May 19 2022 at 16:21)</a>:</h4>
<p><span class="user-mention" data-user-id="467926">@Joseph O</span> you probably want to do this actually:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">syntax</span> <span class="s2">"let "</span> <span class="n">binder</span><span class="o">,</span><span class="bp">+</span> <span class="s2">" in "</span> <span class="n">term</span> <span class="o">:</span> <span class="n">term</span>
</code></pre></div>
<p>Notice the <code>+</code> instead of <code>*</code><br>
That will require at least a binder to match<br>
So <code>let in 0</code> will give you a better error message</p>



<a name="282953969"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%E2%9C%94%20macro%20problem/near/282953969" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joseph O <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.E2.9C.94.20macro.20problem.html#282953969">(May 19 2022 at 16:22)</a>:</h4>
<p>I see</p>



<a name="282954008"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%E2%9C%94%20macro%20problem/near/282954008" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joseph O <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.E2.9C.94.20macro.20problem.html#282954008">(May 19 2022 at 16:22)</a>:</h4>
<p>Btw, how do I import a macro in lean 4?</p>



<a name="282954057"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%E2%9C%94%20macro%20problem/near/282954057" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.E2.9C.94.20macro.20problem.html#282954057">(May 19 2022 at 16:23)</a>:</h4>
<p>You just import the file where it's defined</p>



<a name="282956604"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%E2%9C%94%20macro%20problem/near/282956604" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joseph O <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.E2.9C.94.20macro.20problem.html#282956604">(May 19 2022 at 16:38)</a>:</h4>
<p>ah yes, I forgot to refresh imports</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>