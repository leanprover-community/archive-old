---
layout: archive
title: Zulip Chat Archive
permalink: /stream/270676-lean4/topic/Expected.20Lean.204.20build.20time.3F.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/index.html">lean4</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Expected.20Lean.204.20build.20time.3F.html">Expected Lean 4 build time?</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="242164478"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Expected%20Lean%204%20build%20time%3F/near/242164478" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Expected.20Lean.204.20build.20time.3F.html#242164478">(Jun 10 2021 at 06:32)</a>:</h4>
<p>I just timed how long it takes for my computer to build Lean 4 from scratch (in a Windows 10 MSYS2 environment) using <code>time make</code> and got the following result:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">real</span>    <span class="mi">117</span><span class="n">m21.664s</span>
<span class="n">user</span>    <span class="mi">1</span><span class="n">m34.093s</span>
<span class="n">sys</span>     <span class="mi">6</span><span class="n">m36.292s</span>
</code></pre></div>
<p>Is this comparable to others' build times? Or is there perhaps a bottleneck I may be missing that resulted in my times? I am curious if these times seem reasonable or not.</p>



<a name="242164740"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Expected%20Lean%204%20build%20time%3F/near/242164740" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Expected.20Lean.204.20build.20time.3F.html#242164740">(Jun 10 2021 at 06:36)</a>:</h4>
<p>Six minutes of cpu time sounds about right.   The real time is crazy though--did you put your computer to sleep while it was building?</p>



<a name="242164895"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Expected%20Lean%204%20build%20time%3F/near/242164895" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Expected.20Lean.204.20build.20time.3F.html#242164895">(Jun 10 2021 at 06:39)</a>:</h4>
<p>nope, I ran the build in the background while doing other things on my computer (though not particularly CPU intensive things -- just watching YouTube videos and coding)</p>



<a name="242165626"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Expected%20Lean%204%20build%20time%3F/near/242165626" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Expected.20Lean.204.20build.20time.3F.html#242165626">(Jun 10 2021 at 06:50)</a>:</h4>
<p>Definitely not expected, even the GitHub Actions Windows runner is way faster</p>



<a name="242165793"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Expected%20Lean%204%20build%20time%3F/near/242165793" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Expected.20Lean.204.20build.20time.3F.html#242165793">(Jun 10 2021 at 06:53)</a>:</h4>
<p>okay, I will explore more into the bottlenecks may be -- I did try this in a different location from my normal build setup, so I will try build again there and seeing if I get more reasonable times.</p>



<a name="242166879"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Expected%20Lean%204%20build%20time%3F/near/242166879" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Expected.20Lean.204.20build.20time.3F.html#242166879">(Jun 10 2021 at 07:07)</a>:</h4>
<p>also, what, for reference, would be consider reasonable from scratch build times for Lean 4? (<em>without</em> running <code>make</code> in parallel with <code>-jN</code>)</p>



<a name="242167555"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Expected%20Lean%204%20build%20time%3F/near/242167555" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Daniel Fabian <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Expected.20Lean.204.20build.20time.3F.html#242167555">(Jun 10 2021 at 07:17)</a>:</h4>
<p>@Mac, would it be possible for you to try and build with WSL (ideally Wsl2) too? It would at least help us confirm that it has something to do with MSYS</p>



<a name="242167679"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Expected%20Lean%204%20build%20time%3F/near/242167679" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Expected.20Lean.204.20build.20time.3F.html#242167679">(Jun 10 2021 at 07:18)</a>:</h4>
<p>The Actions runner takes something like 15min with and 30min without ccache cache, which is on two cores</p>



<a name="242167817"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Expected%20Lean%204%20build%20time%3F/near/242167817" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Expected.20Lean.204.20build.20time.3F.html#242167817">(Jun 10 2021 at 07:20)</a>:</h4>
<p>Btw, I would be very suspicious of those 1m34s user time. Perhaps msys2 is not measuring the right thing there.</p>



<a name="242170295"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Expected%20Lean%204%20build%20time%3F/near/242170295" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Expected.20Lean.204.20build.20time.3F.html#242170295">(Jun 10 2021 at 07:47)</a>:</h4>
<p>I just built current Lean 4 with plain <code>make</code>, and it took 26.86 mins (on linux, no caches).  So 1.5 hours seems awfully long, even for a single-threaded build on windows.</p>



<a name="242170419"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Expected%20Lean%204%20build%20time%3F/near/242170419" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Expected.20Lean.204.20build.20time.3F.html#242170419">(Jun 10 2021 at 07:48)</a>:</h4>
<p>But Gabriel, your machine also builds mathlib 5 faster than my server...</p>



<a name="242170486"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Expected%20Lean%204%20build%20time%3F/near/242170486" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Expected.20Lean.204.20build.20time.3F.html#242170486">(Jun 10 2021 at 07:49)</a>:</h4>
<p>I don't trust any numbers coming from you to be representative of normal build times <span aria-label="joy" class="emoji emoji-1f602" role="img" title="joy">:joy:</span> You clearly have some quantum computer under your desk or something. <span aria-label="stuck out tongue wink" class="emoji emoji-1f61c" role="img" title="stuck out tongue wink">:stuck_out_tongue_wink:</span></p>



<a name="242170854"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Expected%20Lean%204%20build%20time%3F/near/242170854" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Expected.20Lean.204.20build.20time.3F.html#242170854">(Jun 10 2021 at 07:53)</a>:</h4>
<p>The <em>single-threaded</em> performance should be comparable though. (A build with all cores is of course much faster and only takes 3 minutes, 37 seconds.)</p>



<a name="242170992"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Expected%20Lean%204%20build%20time%3F/near/242170992" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Expected.20Lean.204.20build.20time.3F.html#242170992">(Jun 10 2021 at 07:55)</a>:</h4>
<p>/me is still cautious <span aria-label="laughing" class="emoji emoji-1f606" role="img" title="laughing">:laughing:</span></p>



<a name="242171142"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Expected%20Lean%204%20build%20time%3F/near/242171142" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Expected.20Lean.204.20build.20time.3F.html#242171142">(Jun 10 2021 at 07:56)</a>:</h4>
<p>fyi, I am also currently building on a hard disk rather than an SSD so that may also be a factor.</p>



<a name="242172045"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Expected%20Lean%204%20build%20time%3F/near/242172045" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Expected.20Lean.204.20build.20time.3F.html#242172045">(Jun 10 2021 at 08:05)</a>:</h4>
<p>Upgrade straight to a RAM disk then <span aria-label="laughing" class="emoji emoji-1f606" role="img" title="laughing">:laughing:</span></p>



<a name="242172344"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Expected%20Lean%204%20build%20time%3F/near/242172344" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Expected.20Lean.204.20build.20time.3F.html#242172344">(Jun 10 2021 at 08:08)</a>:</h4>
<p>note that I do have an SSD in this computer, I am just (for some reason) not building on it XD</p>



<a name="242172443"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Expected%20Lean%204%20build%20time%3F/near/242172443" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Daniel Fabian <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Expected.20Lean.204.20build.20time.3F.html#242172443">(Jun 10 2021 at 08:09)</a>:</h4>
<p>Disk IO can be a drastic contribution to build times. We usually use NVMe drives for that reason and it helps a lot. Also, WSL1 was severely slower with disk IO than WSL2. I'm not sure if MSYS has similar struggles, but it may be worth double-checking.</p>



<a name="242172737"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Expected%20Lean%204%20build%20time%3F/near/242172737" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Julian Berman <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Expected.20Lean.204.20build.20time.3F.html#242172737">(Jun 10 2021 at 08:12)</a>:</h4>
<p>Here (M1 ARM, not-very-powerful MB Air, <code>make -j4</code>):      <code>111.61 real       281.10 user        33.49 sys</code> (where the units are seconds).</p>



<a name="242172832"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Expected%20Lean%204%20build%20time%3F/near/242172832" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Expected.20Lean.204.20build.20time.3F.html#242172832">(Jun 10 2021 at 08:13)</a>:</h4>
<p>This is surprisingly fast, is this with ccache or a debug build?</p>



<a name="242173435"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Expected%20Lean%204%20build%20time%3F/near/242173435" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Julian Berman <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Expected.20Lean.204.20build.20time.3F.html#242173435">(Jun 10 2021 at 08:20)</a>:</h4>
<p>I have <code>ccache</code> installed, but didn't do anything particularly to tell it to use it -- does it normally announce it used it in the output?</p>



<a name="242173472"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Expected%20Lean%204%20build%20time%3F/near/242173472" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Julian Berman <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Expected.20Lean.204.20build.20time.3F.html#242173472">(Jun 10 2021 at 08:21)</a>:</h4>
<p>anecdotally this build time I just got "feels" like what I normally get when pulling and rebuilding, it's typically fast enough that I just go do some small thing and come back and it's done.</p>



<a name="242173621"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Expected%20Lean%204%20build%20time%3F/near/242173621" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Expected.20Lean.204.20build.20time.3F.html#242173621">(Jun 10 2021 at 08:22)</a>:</h4>
<p>I think it uses ccache by default, yes.</p>



<a name="242173658"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Expected%20Lean%204%20build%20time%3F/near/242173658" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Julian Berman <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Expected.20Lean.204.20build.20time.3F.html#242173658">(Jun 10 2021 at 08:23)</a>:</h4>
<p>Aha, got it.</p>



<a name="242173663"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Expected%20Lean%204%20build%20time%3F/near/242173663" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Expected.20Lean.204.20build.20time.3F.html#242173663">(Jun 10 2021 at 08:23)</a>:</h4>
<p>In fact Lean only prints out something if it <em>can't</em> enable ccache, since usually it's a no-brainer to use it</p>



<a name="242173725"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Expected%20Lean%204%20build%20time%3F/near/242173725" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Expected.20Lean.204.20build.20time.3F.html#242173725">(Jun 10 2021 at 08:24)</a>:</h4>
<p>Like, the CI has a 98% cache hit rate :)</p>



<a name="242174201"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Expected%20Lean%204%20build%20time%3F/near/242174201" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Expected.20Lean.204.20build.20time.3F.html#242174201">(Jun 10 2021 at 08:29)</a>:</h4>
<p>There's also a massive difference with compilers and build options.  With gcc and RelWithDebInfo it's 220s, with gcc and Release it's 185s, and with clang and Release it's 167s.  Interestingly, the cpu time is actually higher with the clang build.</p>



<a name="242174574"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Expected%20Lean%204%20build%20time%3F/near/242174574" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Expected.20Lean.204.20build.20time.3F.html#242174574">(Jun 10 2021 at 08:33)</a>:</h4>
<p>So I tested it out in my usual setup and got:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">real</span>    <span class="mi">74</span><span class="n">m34.808s</span>
<span class="n">user</span>    <span class="mi">1</span><span class="n">m31.529s</span>
<span class="n">sys</span>     <span class="mi">6</span><span class="n">m23.311s</span>
</code></pre></div>
<p>My next test will be on WSL(2) (still on HDD) and the test after that will be on the SSD.  I probably won't do that until 8-10 hours from now as I intend to head off to sleep soon.</p>



<a name="242174677"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Expected%20Lean%204%20build%20time%3F/near/242174677" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Expected.20Lean.204.20build.20time.3F.html#242174677">(Jun 10 2021 at 08:34)</a>:</h4>
<p>I will probably try installing <code>ccache</code> (if I don't already have it) and try after those two tests.</p>



<a name="242174696"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Expected%20Lean%204%20build%20time%3F/near/242174696" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Expected.20Lean.204.20build.20time.3F.html#242174696">(Jun 10 2021 at 08:34)</a>:</h4>
<p>Just make sure to build on the Linux partition with WSL2, since accessing the Windows one is even slower than WSL1 afaik</p>



<a name="242174786"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Expected%20Lean%204%20build%20time%3F/near/242174786" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Expected.20Lean.204.20build.20time.3F.html#242174786">(Jun 10 2021 at 08:35)</a>:</h4>
<p>oh, in that case, I probably should do a MSYS2 SSD test first as I think the WSL2 partition is on my SSD as well.</p>



<a name="242175073"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Expected%20Lean%204%20build%20time%3F/near/242175073" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Julian Berman <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Expected.20Lean.204.20build.20time.3F.html#242175073">(Jun 10 2021 at 08:38)</a>:</h4>
<p>With <code>export CCACHE_DISABLE=1</code>, I get:       <code>358.54 real      1299.16 user        51.34 sys</code></p>



<a name="242175326"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Expected%20Lean%204%20build%20time%3F/near/242175326" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Expected.20Lean.204.20build.20time.3F.html#242175326">(Jun 10 2021 at 08:41)</a>:</h4>
<p>Ah, that actually sounds more realistic than my guessed CI numbers. For a single module and in release mode, C compilation time absolutely dominates Lean compilation time, but it is also much more parallelizable (average stdlib .olean parallelism is something like ~3?)</p>



<a name="242175389"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Expected%20Lean%204%20build%20time%3F/near/242175389" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Expected.20Lean.204.20build.20time.3F.html#242175389">(Jun 10 2021 at 08:41)</a>:</h4>
<p>There are several C file that take almost a minute to compile on my machine, they really reduce the parallelism.</p>



<a name="242175520"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Expected%20Lean%204%20build%20time%3F/near/242175520" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Expected.20Lean.204.20build.20time.3F.html#242175520">(Jun 10 2021 at 08:43)</a>:</h4>
<p>Yeah, I want to take a look at them soon since I'm not planning to upgrade my hardware again anytime soon...</p>



<a name="242175554"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Expected%20Lean%204%20build%20time%3F/near/242175554" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Expected.20Lean.204.20build.20time.3F.html#242175554">(Jun 10 2021 at 08:43)</a>:</h4>
<p>Elab.Do is the worst offender since it transitively depends on basically everything but the server</p>



<a name="242184457"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Expected%20Lean%204%20build%20time%3F/near/242184457" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Expected.20Lean.204.20build.20time.3F.html#242184457">(Jun 10 2021 at 10:13)</a>:</h4>
<p>The MSYS2 SSD build got the following times:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">real</span>    <span class="mi">79</span><span class="n">m1.068s</span>
<span class="n">user</span>    <span class="mi">1</span><span class="n">m33.734s</span>
<span class="n">sys</span>     <span class="mi">6</span><span class="n">m51.160s</span>
</code></pre></div>
<p>As such, SSD vs HDD doesn't really seem to have a significant effect on the build time (at least in my setup).</p>



<a name="242184640"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Expected%20Lean%204%20build%20time%3F/near/242184640" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Daniel Fabian <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Expected.20Lean.204.20build.20time.3F.html#242184640">(Jun 10 2021 at 10:15)</a>:</h4>
<p>wow, I sure am interested in the WSL2 test then :D</p>



<a name="242184875"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Expected%20Lean%204%20build%20time%3F/near/242184875" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Expected.20Lean.204.20build.20time.3F.html#242184875">(Jun 10 2021 at 10:17)</a>:</h4>
<p>also, by the way, I did have ccache installed (in MSYS2)</p>



<a name="242185071"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Expected%20Lean%204%20build%20time%3F/near/242185071" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Expected.20Lean.204.20build.20time.3F.html#242185071">(Jun 10 2021 at 10:20)</a>:</h4>
<p>On a slightly unrelated note, the link for <a href="https://leanprover.github.io/lean4/doc/make/ubuntu.html">Linux (Ubuntu)</a> in the <a href="https://leanprover.github.io/lean4/doc/make/index.html">Building Lean</a> documentation is broken. The <a href="https://github.com/leanprover/lean4/blob/master/doc/make/ubuntu-16.04.md">actual file</a> has the version number in its name, but the link doesn't.</p>



<a name="242186441"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Expected%20Lean%204%20build%20time%3F/near/242186441" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Expected.20Lean.204.20build.20time.3F.html#242186441">(Jun 10 2021 at 10:33)</a>:</h4>
<p>also, interestingly enough, the lastest cmake on Ubuntu (18.04) <code>apt</code> is 3.10.2 which is too old for Lean.</p>



<a name="242186571"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Expected%20Lean%204%20build%20time%3F/near/242186571" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Daniel Fabian <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Expected.20Lean.204.20build.20time.3F.html#242186571">(Jun 10 2021 at 10:35)</a>:</h4>
<p>i mean... on ubuntu, <code>nix</code> be thy friend ;-)</p>



<a name="242186833"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Expected%20Lean%204%20build%20time%3F/near/242186833" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Expected.20Lean.204.20build.20time.3F.html#242186833">(Jun 10 2021 at 10:38)</a>:</h4>
<p>I am not sure I want to go through the process of learning nix just to do some build time tests XD</p>



<a name="242187252"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Expected%20Lean%204%20build%20time%3F/near/242187252" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Expected.20Lean.204.20build.20time.3F.html#242187252">(Jun 10 2021 at 10:43)</a>:</h4>
<p>We try to support the latest Ubuntu LTS, which is 20.04</p>



<a name="242190828"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Expected%20Lean%204%20build%20time%3F/near/242190828" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Expected.20Lean.204.20build.20time.3F.html#242190828">(Jun 10 2021 at 11:23)</a>:</h4>
<p>ah, makes sense</p>



<a name="242264160"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Expected%20Lean%204%20build%20time%3F/near/242264160" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Expected.20Lean.204.20build.20time.3F.html#242264160">(Jun 10 2021 at 20:14)</a>:</h4>
<p>I'm curious: are any of the other times people gave tests on MSYS2 Windows or are these all comparisons to a Linux OS build times? I wonder if this may be a "not optimized for MSYS2" problem.</p>



<a name="242270034"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Expected%20Lean%204%20build%20time%3F/near/242270034" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Andrew Ashworth <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Expected.20Lean.204.20build.20time.3F.html#242270034">(Jun 10 2021 at 20:58)</a>:</h4>
<p>if build time is an issue</p>



<a name="242270046"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Expected%20Lean%204%20build%20time%3F/near/242270046" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Andrew Ashworth <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Expected.20Lean.204.20build.20time.3F.html#242270046">(Jun 10 2021 at 20:59)</a>:</h4>
<p>i would try Clang first</p>



<a name="242270132"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Expected%20Lean%204%20build%20time%3F/near/242270132" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Andrew Ashworth <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Expected.20Lean.204.20build.20time.3F.html#242270132">(Jun 10 2021 at 20:59)</a>:</h4>
<p>or maybe not first, but "in addition to"</p>



<a name="242271680"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Expected%20Lean%204%20build%20time%3F/near/242271680" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Expected.20Lean.204.20build.20time.3F.html#242271680">(Jun 10 2021 at 21:10)</a>:</h4>
<p><span class="user-mention silent" data-user-id="315577">Mac</span> <a href="#narrow/stream/270676-lean4/topic/Expected.20Lean.204.20build.20time.3F/near/242264160">said</a>:</p>
<blockquote>
<p>I'm curious: are any of the other times people gave tests on MSYS2 Windows or are these all comparisons to a Linux OS build times? I wonder if this may be a "not optimized for MSYS2" problem.</p>
</blockquote>
<p>The CI uses MSYS2, take a look for yourself</p>



<a name="242274176"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Expected%20Lean%204%20build%20time%3F/near/242274176" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Expected.20Lean.204.20build.20time.3F.html#242274176">(Jun 10 2021 at 21:32)</a>:</h4>
<p>I finished running a test on WSL2 Ubuntu (LTS 20.04) and got the following times:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">real</span>    <span class="mi">46</span><span class="n">m8.091s</span>
<span class="n">user</span>    <span class="mi">44</span><span class="n">m46.209s</span>
<span class="n">sys</span>     <span class="mi">1</span><span class="n">m17.504s</span>
</code></pre></div>



<a name="242274324"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Expected%20Lean%204%20build%20time%3F/near/242274324" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Expected.20Lean.204.20build.20time.3F.html#242274324">(Jun 10 2021 at 21:33)</a>:</h4>
<p>So, yes, WSL2 build times appear to be much faster than MSYS2.</p>



<a name="242274652"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Expected%20Lean%204%20build%20time%3F/near/242274652" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Expected.20Lean.204.20build.20time.3F.html#242274652">(Jun 10 2021 at 21:36)</a>:</h4>
<p>However, unless WSL2 can cross-compile Lean for regular Window/MSYS2,  I am not sure how much this helps (as the currently built executable, I believe, can only be run within WSL2).</p>



<a name="242274788"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Expected%20Lean%204%20build%20time%3F/near/242274788" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Expected.20Lean.204.20build.20time.3F.html#242274788">(Jun 10 2021 at 21:38)</a>:</h4>
<p>Also note, for reference, that my WSL2 is using GCC 9 whereas my MSYS2 is using GCC 10.</p>



<a name="242275228"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Expected%20Lean%204%20build%20time%3F/near/242275228" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Expected.20Lean.204.20build.20time.3F.html#242275228">(Jun 10 2021 at 21:42)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110024">Sebastian Ullrich</span> <a href="#narrow/stream/270676-lean4/topic/Expected.20Lean.204.20build.20time.3F/near/242271680">said</a>:</p>
<blockquote>
<p>The CI uses MSYS2, take a look for yourself</p>
</blockquote>
<p>On this point, is the GitHub CI for Lean 4 really comparable to a regular machine? I didn't really expect that.</p>



<a name="242275670"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Expected%20Lean%204%20build%20time%3F/near/242275670" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Expected.20Lean.204.20build.20time.3F.html#242275670">(Jun 10 2021 at 21:47)</a>:</h4>
<p>Actually, looking at the Windows CI build times. They are generally on the order of 15m for <code>make -j4</code> so if we naively single-thread that by multiplying the time by 4, it would come to around an 1hr/60m build time. This is worse than my WSL2 build time and better than my MSYS2 build time (thus further indicating that WSL2 build times are, in fact, likely significantly faster than MSYS2 build times). It is also better than my MSYS2 by about ~15-20m which, while significant, is not <em>that</em> big of a difference (i.e. my times are about 30% worse). I certainly would still like to improve my times, but this at least suggests that my times are not that insanely off base.</p>



<a name="242276390"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Expected%20Lean%204%20build%20time%3F/near/242276390" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Wojciech Nawrocki <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Expected.20Lean.204.20build.20time.3F.html#242276390">(Jun 10 2021 at 21:54)</a>:</h4>
<p><span class="user-mention" data-user-id="315577">@Mac</span> MinGW emulates some Unix system calls in userland in a way that's not very efficient -- see <a href="https://stackoverflow.com/a/29766609">here</a>. On the other hand, WSL1 used to <a href="https://news.ycombinator.com/item?id=11391797">call directly</a> into the NT kernel and WSL2 is just a VM running natively.</p>



<a name="242276397"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Expected%20Lean%204%20build%20time%3F/near/242276397" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Daniel Fabian <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Expected.20Lean.204.20build.20time.3F.html#242276397">(Jun 10 2021 at 21:54)</a>:</h4>
<p>Well that's only half the story, though</p>



<a name="242276441"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Expected%20Lean%204%20build%20time%3F/near/242276441" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Daniel Fabian <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Expected.20Lean.204.20build.20time.3F.html#242276441">(Jun 10 2021 at 21:55)</a>:</h4>
<p>Because nix shortens build times to 5 min or usually</p>



<a name="242276497"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Expected%20Lean%204%20build%20time%3F/near/242276497" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Daniel Fabian <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Expected.20Lean.204.20build.20time.3F.html#242276497">(Jun 10 2021 at 21:55)</a>:</h4>
<p>So wsl2 would still help a lot before we replicate something clever in lake</p>



<a name="242276508"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Expected%20Lean%204%20build%20time%3F/near/242276508" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Expected.20Lean.204.20build.20time.3F.html#242276508">(Jun 10 2021 at 21:55)</a>:</h4>
<p>In fact, the <code>update stage0</code> times on the CI can take on the order of 30m with <code>make -j4</code> which could be about 120m single-threaded. So, in fact, my from-scratch build times on MSYS2 may, in fact, be much faster than the CI.</p>



<a name="242276683"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Expected%20Lean%204%20build%20time%3F/near/242276683" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Expected.20Lean.204.20build.20time.3F.html#242276683">(Jun 10 2021 at 21:57)</a>:</h4>
<p>The only reason that normal CI builds take 10-15 minutes (with <code>make -j4</code>) may be due to some form of caching (ex. <code>ccache</code>?)</p>



<a name="242276865"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Expected%20Lean%204%20build%20time%3F/near/242276865" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Expected.20Lean.204.20build.20time.3F.html#242276865">(Jun 10 2021 at 21:59)</a>:</h4>
<p>One thing I differently learned form this though is that I should be passing <code>-jN</code> to <code>make</code> at all times. I do have 6 dual-thread cores on my machine so <code>-j10</code> would probably significantly decrease build times. <span aria-label="grinning" class="emoji emoji-1f600" role="img" title="grinning">:grinning:</span></p>



<a name="242277274"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Expected%20Lean%204%20build%20time%3F/near/242277274" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Daniel Fabian <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Expected.20Lean.204.20build.20time.3F.html#242277274">(Jun 10 2021 at 22:03)</a>:</h4>
<p>I thought the rule of thumb was n virtual cores + 1</p>



<a name="242277465"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Expected%20Lean%204%20build%20time%3F/near/242277465" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Expected.20Lean.204.20build.20time.3F.html#242277465">(Jun 10 2021 at 22:05)</a>:</h4>
<p>Maybe it is? I don't have enough experience/knowledge in that area to know. I also would like to be be doing other things while being so (I did <code>n-2</code>) to avoid maximally taxing my machine. But that may be unnecessary.</p>



<a name="242279817"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Expected%20Lean%204%20build%20time%3F/near/242279817" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Expected.20Lean.204.20build.20time.3F.html#242279817">(Jun 10 2021 at 22:31)</a>:</h4>
<p>With <code>make -j10</code> (on a 6 physical/12 logical core machine) using MSYS2 I got:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">real</span>    <span class="mi">10</span><span class="n">m24.999s</span>
<span class="n">user</span>    <span class="mi">1</span><span class="n">m58.663s</span>
<span class="n">sys</span>     <span class="mi">8</span><span class="n">m29.935s</span>
</code></pre></div>



<a name="242280072"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Expected%20Lean%204%20build%20time%3F/near/242280072" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Daniel Fabian <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Expected.20Lean.204.20build.20time.3F.html#242280072">(Jun 10 2021 at 22:34)</a>:</h4>
<p>That feels better than 1 hour?</p>



<a name="242280105"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Expected%20Lean%204%20build%20time%3F/near/242280105" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Expected.20Lean.204.20build.20time.3F.html#242280105">(Jun 10 2021 at 22:34)</a>:</h4>
<p>Yeah 10min is better than an 1hr 20m. XD</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>