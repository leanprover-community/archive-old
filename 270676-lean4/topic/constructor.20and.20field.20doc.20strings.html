---
layout: archive
title: Zulip Chat Archive
permalink: /stream/270676-lean4/topic/constructor.20and.20field.20doc.20strings.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/index.html">lean4</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/constructor.20and.20field.20doc.20strings.html">constructor and field doc strings</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="278415708"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/constructor%20and%20field%20doc%20strings/near/278415708" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Henrik Böving <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/constructor.20and.20field.20doc.20strings.html#278415708">(Apr 09 2022 at 15:39)</a>:</h4>
<p>After seeing the compiler team add so many doc strings especially to fields of structure types etc. in the past few days I decided to take a look into rendering these in doc-gen4 as well, however I'm not 100% sure yet how to do this visually (since I suck at UX and webdev after all :p) So for example with the doc string of <a href="https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Lean.Meta.Context#doc">docs4#Lean.Meta.Context</a> would you prefer to have the giant blob of a doc string inline into the structure declaration as it is within the code: <a href="https://github.com/leanprover/lean4/blob/6aee3fb30465da8e0e3df12651832f548cb0159b/src/Lean/Meta/Basic.lean#L176-L192">https://github.com/leanprover/lean4/blob/6aee3fb30465da8e0e3df12651832f548cb0159b/src/Lean/Meta/Basic.lean#L176-L192</a> or something different? If yes, what's your alternatives?</p>
<p>Same question for doc strings on inductive type ctors.</p>



<a name="278415994"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/constructor%20and%20field%20doc%20strings/near/278415994" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/constructor.20and.20field.20doc.20strings.html#278415994">(Apr 09 2022 at 15:45)</a>:</h4>
<p>you could have doc text between the lines of monospace text</p>



<a name="278423771"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/constructor%20and%20field%20doc%20strings/near/278423771" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Henrik Böving <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/constructor.20and.20field.20doc.20strings.html#278423771">(Apr 09 2022 at 18:27)</a>:</h4>
<p>Minus the indendation (that's missing some dark CSS magic) (I'm also not sure why the markdown renderer made a code block out of the remark) that would look like this: <a href="/user_uploads/3121/1PLIg_xY99RwoVEBfGOemRq3/image.png">image.png</a> </p>
<div class="message_inline_image"><a href="/user_uploads/3121/1PLIg_xY99RwoVEBfGOemRq3/image.png" title="image.png"><img src="/user_uploads/3121/1PLIg_xY99RwoVEBfGOemRq3/image.png"></a></div><p>Which is fine ish I'd say?</p>



<a name="278424288"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/constructor%20and%20field%20doc%20strings/near/278424288" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ruben Van de Velde <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/constructor.20and.20field.20doc.20strings.html#278424288">(Apr 09 2022 at 18:39)</a>:</h4>
<p>Is the remark indented?</p>



<a name="278424596"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/constructor%20and%20field%20doc%20strings/near/278424596" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Henrik Böving <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/constructor.20and.20field.20doc.20strings.html#278424596">(Apr 09 2022 at 18:47)</a>:</h4>
<p>You can see the markdown in the github link above, it shouldn't be rendering as a code block IMO.</p>



<a name="278424765"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/constructor%20and%20field%20doc%20strings/near/278424765" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/constructor.20and.20field.20doc.20strings.html#278424765">(Apr 09 2022 at 18:50)</a>:</h4>
<p>Is there another occurrence of a comment block with two+ paragraphs? It might be related. What's the corresponding markdown that was generated?</p>



<a name="278425063"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/constructor%20and%20field%20doc%20strings/near/278425063" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> James Gallicchio <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/constructor.20and.20field.20doc.20strings.html#278425063">(Apr 09 2022 at 18:58)</a>:</h4>
<p><span class="user-mention silent" data-user-id="395550">Henrik Böving</span> <a href="#narrow/stream/270676-lean4/topic/constructor.20and.20field.20doc.20strings/near/278423771">said</a>:</p>
<blockquote>
<p>Which is fine ish I'd say?</p>
</blockquote>
<p>IMO it is a little hard to tell whether the comment is about the field above or below it</p>



<a name="278425092"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/constructor%20and%20field%20doc%20strings/near/278425092" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> James Gallicchio <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/constructor.20and.20field.20doc.20strings.html#278425092">(Apr 09 2022 at 18:59)</a>:</h4>
<p>(Is it possible to make the vertical offset different above vs below?)</p>



<a name="278425208"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/constructor%20and%20field%20doc%20strings/near/278425208" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Henrik Böving <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/constructor.20and.20field.20doc.20strings.html#278425208">(Apr 09 2022 at 19:00)</a>:</h4>
<p>First things first this is how it looks without the CSS messing up the generated indentation: <a href="/user_uploads/3121/62vfco8-oN362i6qnLoBnKpV/image.png">image.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/3121/62vfco8-oN362i6qnLoBnKpV/image.png" title="image.png"><img src="/user_uploads/3121/62vfco8-oN362i6qnLoBnKpV/image.png"></a></div>



<a name="278425244"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/constructor%20and%20field%20doc%20strings/near/278425244" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Henrik Böving <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/constructor.20and.20field.20doc.20strings.html#278425244">(Apr 09 2022 at 19:01)</a>:</h4>
<p><span class="user-mention silent" data-user-id="407274">James Gallicchio</span> <a href="#narrow/stream/270676-lean4/topic/constructor.20and.20field.20doc.20strings/near/278425092">said</a>:</p>
<blockquote>
<p>(Is it possible to make the vertical offset different above vs below?)</p>
</blockquote>
<p>Oh for sure it is I just dont know how..yet</p>



<a name="278425392"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/constructor%20and%20field%20doc%20strings/near/278425392" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Henrik Böving <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/constructor.20and.20field.20doc.20strings.html#278425392">(Apr 09 2022 at 19:04)</a>:</h4>
<p><span class="user-mention silent" data-user-id="451983">Arthur Paulino</span> <a href="#narrow/stream/270676-lean4/topic/constructor.20and.20field.20doc.20strings/near/278424765">said</a>:</p>
<blockquote>
<p>Is there another occurrence of a comment block with two+ paragraphs? It might be related. What's the corresponding markdown that was generated?</p>
</blockquote>
<p>I did look through a bunch of mathlib and compiler files but I couldnt find one yet, seems they are rather rare which would also explain why I didnt notice this happening before.</p>



<a name="278425495"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/constructor%20and%20field%20doc%20strings/near/278425495" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/constructor.20and.20field.20doc.20strings.html#278425495">(Apr 09 2022 at 19:07)</a>:</h4>
<p>Another option would be to emit separate definition documentation blocks for the projections, and only show the docstrings there</p>



<a name="278425569"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/constructor%20and%20field%20doc%20strings/near/278425569" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/constructor.20and.20field.20doc.20strings.html#278425569">(Apr 09 2022 at 19:09)</a>:</h4>
<p>That has the advantage of making the behavior more uniform between projections and definitions; consider how <a href="https://leanprover-community.github.io/mathlib_docs/find/subtype.prop">docs#subtype.prop</a> and <a href="https://leanprover-community.github.io/mathlib_docs/find/subtype.property">docs#subtype.property</a> currently link to differently presented information.</p>



<a name="278425653"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/constructor%20and%20field%20doc%20strings/near/278425653" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> James Gallicchio <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/constructor.20and.20field.20doc.20strings.html#278425653">(Apr 09 2022 at 19:10)</a>:</h4>
<p>I'm also not sure that the docstrings should come before the relevant field, rather than after. For functions it makes sense to give the docstring beforehand since the arguments are in a negative position, but with a structure the fields are in a positive position.</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="sd">/-- Pair -/</span>
<span class="kd">structure</span> <span class="n">Pair</span> <span class="n">where</span>
  <span class="n">fst</span> <span class="o">:</span> <span class="n">Nat</span> <span class="sd">/-- the first number -/</span>
  <span class="n">snd</span> <span class="o">:</span> <span class="n">Nat</span> <span class="sd">/-- the second number -/</span>
</code></pre></div>
<p>But allowing both seems incredibly annoying to handle in doc generation. Doxygen allows this by requiring a &lt; at the start docstring token (like <code>/--&lt; -/</code></p>



<a name="278425744"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/constructor%20and%20field%20doc%20strings/near/278425744" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Henrik Böving <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/constructor.20and.20field.20doc.20strings.html#278425744">(Apr 09 2022 at 19:12)</a>:</h4>
<p>Its actually not annoying for us at all, we don't ever parse the code ourselves, doc-gen4 is a lean meta program that asks the compiler for all the information including the doc string, if the compiler has the information we can get it without issue</p>



<a name="278425813"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/constructor%20and%20field%20doc%20strings/near/278425813" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/constructor.20and.20field.20doc.20strings.html#278425813">(Apr 09 2022 at 19:14)</a>:</h4>
<p>TBH I thought those comment blocks that weren't placed right before a declaration (a function, structure, theorem etc) were meant for in-code documentation only (for those who are reading the source code) rather than to be extracted to a documentation page</p>



<a name="278425902"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/constructor%20and%20field%20doc%20strings/near/278425902" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> James Gallicchio <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/constructor.20and.20field.20doc.20strings.html#278425902">(Apr 09 2022 at 19:16)</a>:</h4>
<p><span class="user-mention silent" data-user-id="395550">Henrik Böving</span> <a href="#narrow/stream/270676-lean4/topic/constructor.20and.20field.20doc.20strings/near/278425744">said</a>:</p>
<blockquote>
<p>Its actually not annoying for us at all</p>
</blockquote>
<p>But I think it gets funky if for example you have a docstring after the last field of a structure and then a function immediately after. Not sure how we would differentiate where the docstring should go in something like</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="sd">/-- Pair -/</span>
<span class="kd">structure</span> <span class="n">Pair</span> <span class="n">where</span>
  <span class="n">fst</span> <span class="o">:</span> <span class="n">Nat</span> <span class="sd">/-- the first number -/</span>
  <span class="n">snd</span> <span class="o">:</span> <span class="n">Nat</span> <span class="sd">/-- the second number -/</span>
<span class="kd">def</span> <span class="n">myFn</span> <span class="o">()</span> <span class="o">:=</span> <span class="o">()</span>
</code></pre></div>



<a name="278425932"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/constructor%20and%20field%20doc%20strings/near/278425932" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Henrik Böving <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/constructor.20and.20field.20doc.20strings.html#278425932">(Apr 09 2022 at 19:17)</a>:</h4>
<p>Oh with "us" I was referring to the doc-gen4 people, it sure is annoying to parse :p</p>



<a name="278425934"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/constructor%20and%20field%20doc%20strings/near/278425934" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/constructor.20and.20field.20doc.20strings.html#278425934">(Apr 09 2022 at 19:17)</a>:</h4>
<p>By extracting those to a documentation page we might end up with a bunch of paragraphs with statements out of context, containing explanations about implementation details</p>



<a name="278426005"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/constructor%20and%20field%20doc%20strings/near/278426005" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Henrik Böving <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/constructor.20and.20field.20doc.20strings.html#278426005">(Apr 09 2022 at 19:18)</a>:</h4>
<p><span class="user-mention silent" data-user-id="451983">Arthur Paulino</span> <a href="#narrow/stream/270676-lean4/topic/constructor.20and.20field.20doc.20strings/near/278425934">said</a>:</p>
<blockquote>
<p>By extracting those to a documentation page we might end up with a bunch of paragraphs with statements out of context</p>
</blockquote>
<p>Lean does have the <code>/- -/</code> multi line comment blocks and the <code>--</code> single line comments for one line stuff, if its marked with a <code>/-- -/</code> its explicitly different from <code>/- -/</code> and meant to be interpreted as a doc string so whether it shows up here or not is the authors choice</p>



<a name="278426010"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/constructor%20and%20field%20doc%20strings/near/278426010" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> James Gallicchio <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/constructor.20and.20field.20doc.20strings.html#278426010">(Apr 09 2022 at 19:18)</a>:</h4>
<p>(deleted)</p>



<a name="278426013"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/constructor%20and%20field%20doc%20strings/near/278426013" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Henrik Böving <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/constructor.20and.20field.20doc.20strings.html#278426013">(Apr 09 2022 at 19:18)</a>:</h4>
<p>correct</p>



<a name="278426019"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/constructor%20and%20field%20doc%20strings/near/278426019" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> James Gallicchio <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/constructor.20and.20field.20doc.20strings.html#278426019">(Apr 09 2022 at 19:19)</a>:</h4>
<p>whoops henrik sniped me :p</p>



<a name="278426111"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/constructor%20and%20field%20doc%20strings/near/278426111" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> James Gallicchio <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/constructor.20and.20field.20doc.20strings.html#278426111">(Apr 09 2022 at 19:21)</a>:</h4>
<p><span class="user-mention silent" data-user-id="395550">Henrik Böving</span> <a href="#narrow/stream/270676-lean4/topic/constructor.20and.20field.20doc.20strings/near/278425932">said</a>:</p>
<blockquote>
<p>Oh with "us" I was referring to the doc-gen4 people, it sure is annoying to parse :p</p>
</blockquote>
<p>So the compiler decides where in the AST a docstring is bound? (If so, where do the docstrings get bound in the example above?)</p>



<a name="278426191"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/constructor%20and%20field%20doc%20strings/near/278426191" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/constructor.20and.20field.20doc.20strings.html#278426191">(Apr 09 2022 at 19:22)</a>:</h4>
<p><span class="user-mention silent" data-user-id="407274">James Gallicchio</span> <a href="#narrow/stream/270676-lean4/topic/constructor.20and.20field.20doc.20strings/near/278425063">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="395550">Henrik Böving</span> <a href="#narrow/stream/270676-lean4/topic/constructor.20and.20field.20doc.20strings/near/278423771">said</a>:</p>
<blockquote>
<p>Which is fine ish I'd say?</p>
</blockquote>
<p>IMO it is a little hard to tell whether the comment is about the field above or below it</p>
</blockquote>
<p>I'm used to think that Lean docstrings come before the object being documented. Maybe it's worth it to keep this pattern for the sake of simplicity</p>



<a name="278426210"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/constructor%20and%20field%20doc%20strings/near/278426210" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Henrik Böving <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/constructor.20and.20field.20doc.20strings.html#278426210">(Apr 09 2022 at 19:23)</a>:</h4>
<p><span class="user-mention silent" data-user-id="310045">Eric Wieser</span> <a href="#narrow/stream/270676-lean4/topic/constructor.20and.20field.20doc.20strings/near/278425569">said</a>:</p>
<blockquote>
<p>That has the advantage of making the behavior more uniform between projections and definitions; consider how <a href="https://leanprover-community.github.io/mathlib_docs/find/subtype.prop">docs#subtype.prop</a> and <a href="https://leanprover-community.github.io/mathlib_docs/find/subtype.property">docs#subtype.property</a> currently link to differently presented information.</p>
</blockquote>
<p>I did think of this as well but once I end up implementing this feature for inductive constructors as well we would either:</p>
<ul>
<li>have to do it like I implemented it for structures rn</li>
<li>render inductive ctors as a seperate definition again as well with a doc string, which I don't think is too sensible because you usually want to see them in context with the others (its an inductive after all)</li>
</ul>
<p>and since I wanted to keep behaviour consistent between the two (its of course open to debate whether that should be the case) I decided against it</p>



<a name="278426351"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/constructor%20and%20field%20doc%20strings/near/278426351" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Henrik Böving <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/constructor.20and.20field.20doc.20strings.html#278426351">(Apr 09 2022 at 19:26)</a>:</h4>
<p><span class="user-mention silent" data-user-id="407274">James Gallicchio</span> <a href="#narrow/stream/270676-lean4/topic/constructor.20and.20field.20doc.20strings/near/278426111">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="395550">Henrik Böving</span> <a href="#narrow/stream/270676-lean4/topic/constructor.20and.20field.20doc.20strings/near/278425932">said</a>:</p>
<blockquote>
<p>Oh with "us" I was referring to the doc-gen4 people, it sure is annoying to parse :p</p>
</blockquote>
<p>So the compiler decides where in the AST a docstring is bound? (If so, where do the docstrings get bound in the example above?)</p>
</blockquote>
<p>Yes and to answer this question we can just ask the compiler:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">Lean</span>

<span class="kn">open</span> <span class="n">Lean</span> <span class="n">Meta</span>

<span class="sd">/-- Pair -/</span>
<span class="kd">structure</span> <span class="n">Pair</span> <span class="n">where</span>
  <span class="n">fst</span> <span class="o">:</span> <span class="n">Nat</span> <span class="sd">/-- the first number -/</span>
  <span class="n">snd</span> <span class="o">:</span> <span class="n">Nat</span> <span class="sd">/-- the second number -/</span>

<span class="kd">def</span> <span class="n">foo</span> <span class="o">:=</span> <span class="o">()</span>

<span class="k">#eval</span> <span class="k">show</span> <span class="n">MetaM</span> <span class="n">_</span> <span class="k">from</span> <span class="k">do</span>
  <span class="k">let</span> <span class="n">env</span> <span class="bp">←</span> <span class="n">getEnv</span>
  <span class="n">IO.println</span> <span class="bp">$</span> <span class="bp">←</span><span class="n">findDocString</span><span class="bp">?</span> <span class="n">env</span> <span class="bp">`</span><span class="n">Pair.fst</span>
  <span class="n">IO.println</span> <span class="bp">$</span> <span class="bp">←</span><span class="n">findDocString</span><span class="bp">?</span> <span class="n">env</span> <span class="bp">`</span><span class="n">Pair.snd</span>
  <span class="n">IO.println</span> <span class="bp">$</span> <span class="bp">←</span><span class="n">findDocString</span><span class="bp">?</span> <span class="n">env</span> <span class="bp">`</span><span class="n">foo</span>
</code></pre></div>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">none</span>
<span class="o">(</span><span class="n">some</span> <span class="o">(</span><span class="n">the</span> <span class="n">first</span> <span class="n">number</span> <span class="o">))</span>
<span class="o">(</span><span class="n">some</span> <span class="o">(</span><span class="n">the</span> <span class="n">second</span> <span class="n">number</span> <span class="o">))</span>
</code></pre></div>



<a name="278426446"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/constructor%20and%20field%20doc%20strings/near/278426446" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> James Gallicchio <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/constructor.20and.20field.20doc.20strings.html#278426446">(Apr 09 2022 at 19:28)</a>:</h4>
<p>Ah, yeah, so we'd have to change the parser's behavior for that</p>



<a name="278426610"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/constructor%20and%20field%20doc%20strings/near/278426610" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Henrik Böving <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/constructor.20and.20field.20doc.20strings.html#278426610">(Apr 09 2022 at 19:32)</a>:</h4>
<p><span class="user-mention silent" data-user-id="407274">James Gallicchio</span> <a href="#narrow/stream/270676-lean4/topic/constructor.20and.20field.20doc.20strings/near/278425092">said</a>:</p>
<blockquote>
<p>(Is it possible to make the vertical offset different above vs below?)</p>
</blockquote>
<p><a href="/user_uploads/3121/HRnn6rVQeFaAsQi0eaPGS1Zw/image.png">image.png</a> </p>
<div class="message_inline_image"><a href="/user_uploads/3121/HRnn6rVQeFaAsQi0eaPGS1Zw/image.png" title="image.png"><img src="/user_uploads/3121/HRnn6rVQeFaAsQi0eaPGS1Zw/image.png"></a></div><p>good? more? less?</p>



<a name="278426940"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/constructor%20and%20field%20doc%20strings/near/278426940" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> James Gallicchio <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/constructor.20and.20field.20doc.20strings.html#278426940">(Apr 09 2022 at 19:40)</a>:</h4>
<p>That definitely looks better. The space below could be smaller IMO, but space above looks good</p>



<a name="278432693"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/constructor%20and%20field%20doc%20strings/near/278432693" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/constructor.20and.20field.20doc.20strings.html#278432693">(Apr 09 2022 at 21:49)</a>:</h4>
<p>I think a subtle filled box background around the docstring and element would work to separate the elements</p>



<a name="278437485"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/constructor%20and%20field%20doc%20strings/near/278437485" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kyle Miller <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/constructor.20and.20field.20doc.20strings.html#278437485">(Apr 09 2022 at 23:52)</a>:</h4>
<p><span class="user-mention silent" data-user-id="407274">James Gallicchio</span> <a href="#narrow/stream/270676-lean4/topic/constructor.20and.20field.20doc.20strings/near/278425653">said</a>:</p>
<blockquote>
<p>I'm also not sure that the docstrings should come before the relevant field, rather than after. </p>
</blockquote>
<p>In Haddock (a Haskell documentation generator), it has separate syntax for each: <a href="https://haskell-haddock.readthedocs.io/en/latest/markup.html#constructors-and-record-fields">https://haskell-haddock.readthedocs.io/en/latest/markup.html#constructors-and-record-fields</a></p>



<a name="278437668"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/constructor%20and%20field%20doc%20strings/near/278437668" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kyle Miller <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/constructor.20and.20field.20doc.20strings.html#278437668">(Apr 09 2022 at 23:57)</a>:</h4>
<p>Here's an example of how Haddock handles constructor with documented fields: <a href="https://hackage.haskell.org/package/parsec-3.1.15.0/docs/Text-ParserCombinators-Parsec-Token.html">https://hackage.haskell.org/package/parsec-3.1.15.0/docs/Text-ParserCombinators-Parsec-Token.html</a> (it shows the type name, followed by the type's documentation right below it, followed by a table for each constructor showing all the fields with their documentation to the right. For classes Haddock seems to put the field documentation below each field.)</p>



<a name="278455696"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/constructor%20and%20field%20doc%20strings/near/278455696" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> David Thrane Christiansen <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/constructor.20and.20field.20doc.20strings.html#278455696">(Apr 10 2022 at 08:25)</a>:</h4>
<p>A downside of Haddock's flexibility is that teams then end up needing to rely on tooling to enforce the particular choice that they have made for their codebase, and most non-tiny projects end up adopting just one of the options in each possible context anyway.</p>



<a name="278478926"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/constructor%20and%20field%20doc%20strings/near/278478926" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> James Gallicchio <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/constructor.20and.20field.20doc.20strings.html#278478926">(Apr 10 2022 at 17:10)</a>:</h4>
<p>^Yeah, we should definitely pick something and stick with it. I like that Lean is quite opinionated about docstrings, it makes the docs experience very smooth</p>



<a name="278750104"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/constructor%20and%20field%20doc%20strings/near/278750104" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Henrik Böving <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/constructor.20and.20field.20doc.20strings.html#278750104">(Apr 12 2022 at 20:38)</a>:</h4>
<p>Aha! <a href="https://leanprover-community.github.io/mathlib4_docs/Lean/Syntax.html#Lean.Syntax.updateLeading">https://leanprover-community.github.io/mathlib4_docs/Lean/Syntax.html#Lean.Syntax.updateLeading</a> found another one <span class="user-mention" data-user-id="451983">@Arthur Paulino</span>  the double paragraph is indeed at fault</p>



<a name="278750253"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/constructor%20and%20field%20doc%20strings/near/278750253" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/constructor.20and.20field.20doc.20strings.html#278750253">(Apr 12 2022 at 20:40)</a>:</h4>
<p>I suspected of the double paragraph because the second one started at 4 white spaces from the left border and that qualifies for a code block according to markdown syntax</p>



<a name="278778071"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/constructor%20and%20field%20doc%20strings/near/278778071" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Xubai Wang <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/constructor.20and.20field.20doc.20strings.html#278778071">(Apr 13 2022 at 02:41)</a>:</h4>
<p>The first one is parsed with no space as I test it.</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">def</span> <span class="n">printDoc</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="n">Name</span><span class="o">)</span> <span class="o">:</span> <span class="n">MetaM</span> <span class="n">Unit</span> <span class="o">:=</span> <span class="k">do</span>
  <span class="k">match</span> <span class="bp">←</span> <span class="n">findDocString</span><span class="bp">?</span> <span class="o">(</span><span class="bp">←</span> <span class="n">getEnv</span><span class="o">)</span> <span class="n">n</span> <span class="k">with</span>
  <span class="bp">|</span> <span class="n">some</span> <span class="n">docs</span> <span class="bp">=&gt;</span> <span class="n">IO.println</span> <span class="n">docs</span>
  <span class="bp">|</span> <span class="n">_</span> <span class="bp">=&gt;</span> <span class="n">throwError</span> <span class="s2">"not found"</span>

<span class="k">#eval</span> <span class="n">printDoc</span> <span class="bp">`</span><span class="n">Lean.Syntax.updateLeading</span>
</code></pre></div>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">Set</span> <span class="bp">`</span><span class="n">SourceInfo.leading</span><span class="bp">`</span> <span class="n">according</span> <span class="n">to</span> <span class="n">the</span> <span class="n">trailing</span> <span class="n">stop</span> <span class="n">of</span> <span class="n">the</span> <span class="n">preceding</span> <span class="n">token.</span>
    <span class="n">The</span> <span class="n">result</span> <span class="n">is</span> <span class="n">a</span> <span class="n">round</span><span class="bp">-</span><span class="n">tripping</span> <span class="n">syntax</span> <span class="n">tree</span> <span class="n">IF</span><span class="o">,</span> <span class="k">in</span> <span class="n">the</span> <span class="n">input</span> <span class="n">syntax</span> <span class="n">tree</span><span class="o">,</span>
    <span class="bp">*</span> <span class="n">all</span> <span class="n">leading</span> <span class="n">stops</span><span class="o">,</span> <span class="n">atom</span> <span class="n">contents</span><span class="o">,</span> <span class="n">and</span> <span class="n">trailing</span> <span class="n">starts</span> <span class="n">are</span> <span class="n">correct</span>
    <span class="bp">*</span> <span class="n">trailing</span> <span class="n">stops</span> <span class="n">are</span> <span class="n">between</span> <span class="n">the</span> <span class="n">trailing</span> <span class="n">start</span> <span class="n">and</span> <span class="n">the</span> <span class="n">next</span> <span class="n">leading</span> <span class="n">stop.</span>

    <span class="n">Remark</span><span class="o">:</span> <span class="n">after</span> <span class="n">parsing</span><span class="o">,</span> <span class="n">all</span> <span class="bp">`</span><span class="n">SourceInfo.leading</span><span class="bp">`</span> <span class="n">fields</span> <span class="n">are</span> <span class="n">empty.</span>
    <span class="n">The</span> <span class="bp">`</span><span class="n">Syntax</span><span class="bp">`</span> <span class="n">argument</span> <span class="n">is</span> <span class="n">the</span> <span class="n">output</span> <span class="n">produced</span> <span class="kd">by</span> <span class="n">the</span> <span class="n">parser</span> <span class="n">for</span> <span class="bp">`</span><span class="n">source</span><span class="bp">`.</span>
    <span class="n">This</span> <span class="n">function</span> <span class="s2">"fixes"</span> <span class="n">the</span> <span class="bp">`</span><span class="n">source.leading</span><span class="bp">`</span> <span class="n">field.</span>
<span class="bp">......</span>
</code></pre></div>
<p>And the <a href="https://spec.commonmark.org/dingus/?text=Set%20%60SourceInfo.leading%60%20according%20to%20the%20trailing%20stop%20of%20the%20preceding%20token.%0A%20%20%20%20The%20result%20is%20a%20round-tripping%20syntax%20tree%20IF%2C%20in%20the%20input%20syntax%20tree%2C%0A%20%20%20%20*%20all%20leading%20stops%2C%20atom%20contents%2C%20and%20trailing%20starts%20are%20correct%0A%20%20%20%20*%20trailing%20stops%20are%20between%20the%20trailing%20start%20and%20the%20next%20leading%20stop.%0A%0A%20%20%20%20Remark%3A%20after%20parsing%2C%20all%20%60SourceInfo.leading%60%20fields%20are%20empty.%0A%20%20%20%20The%20%60Syntax%60%20argument%20is%20the%20output%20produced%20by%20the%20parser%20for%20%60source%60.%0A%20%20%20%20This%20function%20%22fixes%22%20the%20%60source.leading%60%20field.%0A%0A%20%20%20%20Additionally%2C%20we%20try%20to%20choose%20%22nicer%22%20splits%20between%20leading%20and%20trailing%20stops%0A%20%20%20%20according%20to%20some%20heuristics%20so%20that%20e.g.%20comments%20are%20associated%20to%20the%20(intuitively)%0A%20%20%20%20correct%20token.%0A%0A%20%20%20%20Note%20that%20the%20%60SourceInfo.trailing%60%20fields%20must%20be%20correct.%0A%20%20%20%20The%20implementation%20of%20this%20Function%20relies%20on%20this%20property.%20">rendered sample</a> with commonmark spec</p>



<a name="278778486"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/constructor%20and%20field%20doc%20strings/near/278778486" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Xubai Wang <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/constructor.20and.20field.20doc.20strings.html#278778486">(Apr 13 2022 at 02:50)</a>:</h4>
<p>The docComment parser is here:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">def</span> <span class="n">docComment</span> <span class="o">:=</span> <span class="n">leading_parser</span> <span class="n">ppDedent</span> <span class="bp">$</span> <span class="s2">"/--"</span> <span class="bp">&gt;&gt;</span> <span class="n">ppSpace</span> <span class="bp">&gt;&gt;</span> <span class="n">commentBody</span> <span class="bp">&gt;&gt;</span> <span class="n">ppLine</span>
</code></pre></div>
<p>We may remove the <code>ppSpace</code> and then clean up the indentations. But I'm not sure if we can get position of the <code>/--</code> parser.</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>